<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Configuration | APM Android Agent Reference [master] | Elastic</title>
<meta class="elastic" name="content" content="Configuration | APM Android Agent Reference [master]">

<link rel="home" href="index.html" title="APM Android Agent Reference [master]"/>
<link rel="up" href="index.html" title="APM Android Agent Reference [master]"/>
<link rel="prev" href="supported-technologies.html" title="Supported technologies"/>
<link rel="next" href="faq.html" title="Frequently asked questions"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Android Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="supported-technologies.html">« Supported technologies</a>
</span>
<span class="next">
<a href="faq.html">Frequently asked questions »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">Android Agent Reference<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configuration</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuration"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h2>
</div></div></div>
<h3><a id="_gradle_configuration"></a>Gradle configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h3>
<p>Configure your application at compile time within your application&#8217;s <code class="literal">build.gradle</code> file:</p>
<div class="pre_wrapper lang-groovy">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-groovy">// Android app's build.gradle file
plugins {
    //...
    id "co.elastic.apm.android" version "[latest_version]" <a id="CO3-1"></a><i class="conum" data-value="1"></i>
}

elasticApm {
    // Minimal configuration
    serverUrl = "https://your.elastic.server"

    // Optional
    serviceName = "your app name" <a id="CO3-2"></a><i class="conum" data-value="2"></i>
    serviceVersion = "0.0.0" <a id="CO3-3"></a><i class="conum" data-value="3"></i>
    apiKey = "your server api key" <a id="CO3-4"></a><i class="conum" data-value="4"></i>
    secretToken = "your server auth token" <a id="CO3-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO3-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>You can find the latest version in the <a href="https://plugins.gradle.org/plugin/co.elastic.apm.android" class="ulink" target="_top">Gradle plugin portal</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO3-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to your <code class="literal">android.defaultConfig.applicationId</code> value.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO3-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to your <code class="literal">android.defaultConfig.versionName</code> value.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO3-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to null.
More info on API Keys <a href="/guide/en/elasticsearch/reference/8.15/security-api-create-api-key.html" class="ulink" target="_top">here</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO3-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to null.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When both <code class="literal">secretToken</code> and <code class="literal">apiKey</code> are provided, apiKey has priority and secretToken is ignored.</p>
</div>
</div>
<p>All of the values provided in the Gradle configuration can be overridden with the following environment variables:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Config</th>
<th align="left" valign="top">Associated Environment variable</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>serviceName</p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SERVICE_NAME</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>serviceVersion</p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SERVICE_VERSION</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>serverUrl</p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SERVER_URL</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>apiKey</p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_API_KEY</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>secretToken</p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SECRET_TOKEN</code></p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="_runtime_configuration"></a>Runtime configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h3>
<p>The runtime configuration is provided within your <a href="https://developer.android.com/reference/android/app/Application" class="ulink" target="_top">Application</a> class when initializing the Elastic agent.
This configuration overrides any previously-set compile time configuration.</p>
<p>Runtime configuration works by providing your own instance of the <code class="literal">ElasticApmConfiguration</code> class as shown below:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">// Application class

class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        ElasticApmAgent.initialize(this, ElasticApmConfiguration.builder().build());
    }
}</pre>
</div>
<h4><a id="app-server-connectivity"></a>APM Server connectivity<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>The APM Server connectivity parameters can be provided at compile time, either by using the Gradle DSL configuration or by providing the APM Server connectivity-related environment variables as mentioned above.
Later on, when the app is running, the connectivity parameters can be overridden by providing a custom <code class="literal">Connectivity</code> instance when initializing the Elastic agent.</p>
<p>Once you&#8217;ve created your <code class="literal">Connectivity</code> instance, you can set it into the agent&#8217;s initialization as show below:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        Connectivity myCustomConnectivity = Connectivity.simple(/*params*/);
        ElasticApmAgent.initialize(this, myCustomConnectivity);

        // Optionally if you also define a custom configuration:
        // ElasticApmAgent.initialize(this, ElasticApmConfiguration.builder().build(), myCustomConnectivity);
    }
}</pre>
</div>
<h4><a id="opentelemetry-resource"></a>OpenTelemetry resource<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>You can provide your own <a href="https://opentelemetry.io/docs/languages/java/resources/" class="ulink" target="_top">resource</a> object which will be used for all of the OpenTelemetry signals (Spans, Metrics and Logs) as shown below:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();

        Resource myResource = Resource.create(Attributes.builder().put(RESOURCE_KEY, RESOURCE_VALUE).build());
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .setResource(myResource)
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<h4><a id="server-export-protocol"></a>APM Server export protocol<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>Signals are exported using the gRPC protocol by default.
You can change the export protocol to HTTP by using the ExportProtocol configuration as shown below:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .setExportProtocol(ExportProtocol.HTTP) <a id="CO4-1"></a><i class="conum" data-value="1"></i>
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO4-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note that this configuration may not work if a <a class="xref" href="configuration.html#custom-signal-configuration" title="Custom SignalConfiguration">custom signal configuration</a> is set.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>OTLP over HTTP is supported in APM server versions 8.3.0+.
OTLP over gRPC is supported in APM Server versions 7.12.0+.</p>
</div>
</div>
<h4><a id="persistence-configuration"></a>Persistence configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>By default, all APM data is sent to the backend right away.
However, this may not be possible or feasible for an Android application.
For example, an Android device may run into network issues or the device may need to handle resources in a particular way due to mobile data connectivity and battery life.
To prevent these issues, the agent provides disk persistence or local cache support.
This enables you to store APM data in disk first, and define how often data should be exported to the backend.</p>
<p>The example below shows how to enable and configure the persistence feature.</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        PersistenceConfiguration persistenceConfiguration = PersistenceConfiguration.builder()
                .setEnabled(true) <a id="CO5-1"></a><i class="conum" data-value="1"></i>
                .setMaxCacheSize(60 * 1024 * 1024) <a id="CO5-2"></a><i class="conum" data-value="2"></i>
                .setExportScheduler(ExportScheduler.getDefault(60 * 1000)) <a id="CO5-3"></a><i class="conum" data-value="3"></i>
                .build();
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .setPersistenceConfiguration(persistenceConfiguration)
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO5-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to <code class="literal">false</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO5-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to 60 MB.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO5-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to one minute.
The default <code class="literal">ExportScheduler</code> will run only when the host app is running, though you can create your own implementation of it in order to provide a better-suited scheduler for your app.</p>
</td>
</tr>
</table>
</div>
<h4><a id="app-id-configuration"></a>Application ID configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>You can provide your application name, version, and environment dynamically when building your <code class="literal">ElasticApmConfiguration</code> instance as shown below:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .setServiceName("my-custom-name")
                .setServiceVersion("1.0.0")
                .setDeploymentEnvironment("debug")
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<h4><a id="sample-rate-configuration"></a>Sample rate configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>Sample rates are applied to <a href="https://opentelemetry.io/docs/specs/semconv/general/session/" class="ulink" target="_top">sessions</a>, meaning that, if the sample rate value is <code class="literal">0.5</code>, then only half of the sessions would get sampled.
You can set a session sample rate that will be evaluated on every new session creation to determine whether the full session is exported or ignored.
Sessions are currently time-based and will kept alive for at least 30 mins.
A <code class="literal">session.id</code> attribute will be sent on every signal until the timer ends, resetting the timer whenever a new signal is created.</p>
<p>When the time&#8217;s up, a new session ID will be generated and the sample rate will be evaluated to determine whether the new session&#8217;s signals will get exported or ignored.</p>
<p>You can set the sample rate value at runtime either programmatically, as shown below, or remotely through the <a class="xref" href="configuration.html#configuration-dynamic" title="Dynamic configuration">Central configuration</a>.
Values set through Central configuration will override the ones set programmatically.</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .setSampleRate(0.5) <a id="CO6-1"></a><i class="conum" data-value="1"></i>
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO6-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Only values between 0 and 1.</p>
</td>
</tr>
</table>
</div>
<h4><a id="_signal_filtering"></a>Signal filtering<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>You can provide your own filters to specify which spans, logs, and metrics are allowed to be exported to the backend.
With this tool, you could essentially turn some of these signals (or all) on and off at runtime depending on your own business logic.</p>
<p>In order to do so, you need to provide your own filters for each signal in the agent configuration as shown below:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .addLogFilter(new LogFilter(){/*...*/})
                .addMetricFilter(new MetricFilter(){/*...*/})
//                .addMetricFilter(new MetricFilter(){/*...*/}) You can add multiple filters per signal.
                .addSpanFilter(new SpanFilter() {
                    @Override
                    public boolean shouldInclude(ReadableSpan readableSpan) {
                        if (thisSpanIsAllowedToContinue(readableSpan)) {
                            return true;
                        }
                        return false;
                    }
                })
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<p>Each filter will contain a <code class="literal">shouldInclude</code> function which provides the signal item to be evaluated.
This function must return a boolean value--<code class="literal">true</code> when the provided item is allowed to continue or <code class="literal">false</code> when it must be discarded.</p>
<p>You can add multiple filters per signal which will be iterated over (in the order they were added) until all the filters are checked or until one of them decides to discard the signal item provided.</p>
<h4><a id="_automatic_instrumentation_enablingdisabling"></a>Automatic instrumentation enabling/disabling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>The agent provides automatic instrumentation for its <a class="xref" href="supported-technologies.html" title="Supported technologies"><em>Supported technologies</em></a> which are all enabled by default.
You can choose which ones to keep enabled, as well as and disabling those you don&#8217;t need, at runtime, like so:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();

        // When building an InstrumentationConfiguration object using `InstrumentationConfiguration.builder()`
        // all of the instrumentations are disabled by default, so you only need to enable the ones you need.
        InstrumentationConfiguration instrumentations = InstrumentationConfiguration.builder()
            .enableHttpTracing(true)
            .build();
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .setInstrumentationConfiguration(instrumentations)
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When building an InstrumentationConfiguration object using <code class="literal">InstrumentationConfiguration.builder()</code>, all instrumentations are disabled by default.
Only enable the instrumentations you need using the builder setter methods.</p>
</div>
</div>
<h4><a id="_http_configuration"></a>HTTP Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>The agent provides a configuration object for HTTP-related spans named <code class="literal">HttpTraceConfiguration</code>.
You can pass an instance of it to the <code class="literal">ElasticApmConfiguration</code> object when initializing the agent in order to customize how the HTTP spans should be handled.</p>
<h5><a id="_filtering_http_requests_from_getting_traced"></a>Filtering HTTP requests from getting traced<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h5>
<p>By default, all of your app&#8217;s HTTP requests will get traced.
You can avoid some requests from getting traced by creating your own <code class="literal">HttpExclusionRule</code>.
For example, this is an exclusion rule that prevents all requests with the host <code class="literal">127.0.0.1</code> from getting traced:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyHttpExclusionRule extends HttpExclusionRule {

    @Override
    public boolean exclude(HttpRequest request) {
        return request.url.getHost().equals("127.0.0.1");
    }
}</pre>
</div>
<p>Then you&#8217;d need to add it to Elastic&#8217;s Agent config through its <code class="literal">HttpTraceConfiguration</code>, like so:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        HttpTraceConfiguration httpConfig = HttpTraceConfiguration.builder()
            .addExclusionRule(new MyHttpExclusionRule())
            .build();
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .setHttpTraceConfiguration(httpConfig)
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<h5><a id="_adding_extra_attributes_to_your_http_requests_spans"></a>Adding extra attributes to your HTTP requests' spans<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h5>
<p>If the HTTP span attributes <a href="https://github.com/elastic/apm/tree/main/specs/agents/mobile" class="ulink" target="_top">provided by default</a> aren&#8217;t enough, you can attach your own <code class="literal">HttpAttributesVisitor</code> to add extra params to each HTTP request being traced.
For example:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyHttpAttributesVisitor implements HttpAttributesVisitor {

    public void visit(AttributesBuilder attrsBuilder, HttpRequest request) {
        attrsBuilder.put("my_custom_attr_key", "my_custom_attr_value");
    }
}</pre>
</div>
<p>Then you&#8217;d need to add it to Elastic&#8217;s Agent config through its <code class="literal">HttpTraceConfiguration</code>, like so:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        HttpTraceConfiguration httpConfig = HttpTraceConfiguration.builder()
        .addHttpAttributesVisitor(new MyHttpAttributesVisitor())
        .build();
        ElasticApmConfiguration configuration = ElasticApmConfiguration.builder()
                .setHttpTraceConfiguration(httpConfig)
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<h4><a id="_trace_spans_attributes_notes"></a>Trace spans attributes notes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>There are <a href="https://github.com/elastic/apm/tree/main/specs/agents/mobile" class="ulink" target="_top">common attributes</a> that the Elastic APM agent gathers for every Span.
However, due to the nature of Android&#8217;s OS, to collect some device-related data some of the above-mentioned resources require the Host app (your app) to have specific runtime permissions granted.
If the corresponding permissions aren&#8217;t granted, then the device data won&#8217;t be collected, and nothing will be sent for those attributes.
This table outlines the attributes and their corresponding permissions:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Used in</th>
<th align="left" valign="top">Requires permission</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">net.host.connection.subtype</code></p></td>
<td align="left" valign="top"><p>All Spans</p></td>
<td align="left" valign="top"><p><a href="https://developer.android.com/reference/android/Manifest.permission#READ_PHONE_STATE" class="ulink" target="_top">READ_PHONE_STATE</a></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="_internal_logging_policy"></a>Internal logging policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>By default, all logs created by this library are printed for a debuggable app build.
In the case of non-debuggable builds, only logs at the INFO level and above are printed.</p>
<p>If you would like to create a custom log policy or even disable all of the logs from this library altogether, you can do so by providing your own <code class="literal">LoggingPolicy</code> configuration.
The below example policy will allow all logs of level WARN and higher to be printed.
Levels below WARN will be ignored.</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        // This example policy will allow all logs of level WARN and higher to get printed, ignoring levels below it.
        LoggingPolicy loggingPolicy = LoggingPolicy.enabled(LogLevel.WARN);

        ElasticApmConfiguration.builder()
                .setLibraryLoggingPolicy(loggingPolicy)
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<h3><a id="_advanced_configurable_options"></a>Advanced configurable options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h3>
<h4><a id="custom-signal-configuration"></a>Custom SignalConfiguration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>A SignalConfiguration object contains OpenTelemetry&#8217;s processors for all signals: spans, metrics, and logs.
The agent takes care of creating a default SignalConfiguration implementation based on the <a class="xref" href="configuration.html#app-server-connectivity" title="APM Server connectivity">Connectivity parameters</a> passed during the agent&#8217;s initialization, as well as the <a class="xref" href="configuration.html#server-export-protocol" title="APM Server export protocol">export protocol</a> chosen for sending data to the APM Server.
However, if you need more control over OpenTelemetry&#8217;s processors and exporters, you can override the default SignalConfiguration object and provide your own with custom processors and/or exporters, as shown below:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">class MyApp extends android.app.Application {

    @Override
    public void onCreate() {
        super.onCreate();
        SpanExporter mySpanExporter;
        LogRecordExporter myLogRecordExporter;
        MetricExporter myMetricExporter;

        // You could also pass processors instead of exporters.
        SignalConfiguration mySignalConfiguration = SignalConfiguration.custom(mySpanExporter, myLogRecordExporter, myMetricExporter); <a id="CO7-1"></a><i class="conum" data-value="1"></i>

        ElasticApmConfiguration.builder()
                .setSignalConfiguration(mySignalConfiguration)
                .build();
        ElasticApmAgent.initialize(this, configuration);
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO7-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>You can either create your own implementation for the SignalConfiguration interface, or you can use the <code class="literal">SignalConfiguration.custom</code> function and pass your implementations for OpenTelemetry&#8217;s processors and/or exporters.</p>
</td>
</tr>
</table>
</div>
<h4><a id="opentelemetry-sdk-configuration"></a>Further configurations from the OpenTelemetry SDK.<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>The configurable parameters provided by the Elastic APM agent aim to help configuring common use cases in an easy way, in most of the cases it means to act as a facade between your application and the OpenTelemetry Java SDK that this agent is built on top.
If your project requires to configure more advanced aspects of the overall APM processes, you could directly apply that configuration using the <a href="https://opentelemetry.io/docs/instrumentation/java/getting-started/" class="ulink" target="_top">OpenTelemetry SDK</a>, which becomes available for you to use within your project by adding the Elastic agent plugin, as explained in <a class="xref" href="setup.html" title="Set up the Agent">the agent setup guide</a>.
Said configuration will be used by the Elastic agent for the <a href="https://opentelemetry.io/docs/concepts/signals/" class="ulink" target="_top">signals</a> it sends out of the box.</p>
<h3><a id="configuration-dynamic"></a>Dynamic configuration <span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h3>
<p>Configuration options marked with Dynamic true can be changed at runtime when set from Kibana&#8217;s <a href="/guide/en/kibana/8.15/agent-configuration.html" class="ulink" target="_top">central configuration</a>.</p>
<h3><a id="_option_reference"></a>Option reference<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h3>
<p>This is a list of all configuration options.</p>
<h4><a id="config-recording"></a><code class="literal">recording</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">0.4.0</span>]
<span class="Admonishment-detail">
Added in 0.4.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>A boolean specifying if the agent should be recording or not.
When recording, the agent instruments incoming HTTP requests, tracks errors and collects and sends metrics.
When not recording, the agent works as a noop, not collecting data and not communicating with the APM sever, except for polling the central configuration endpoint.
As this is a reversible switch, agent threads are not being killed when inactivated, but they will be mostly idle in this state, so the overhead should be negligible.</p>
<p>You can use this setting to dynamically disable Elastic APM at runtime.</p>
<p><a class="xref" href="configuration.html#configuration-dynamic" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p>Boolean</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-session-sample-rate"></a><code class="literal">session_sample_rate</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">0.9.0</span>]
<span class="Admonishment-detail">
Added in 0.9.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-android/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>By default, the agent will sample all signals generated by your application (e.g. spans, metrics, and logs).
To reduce overhead and storage requirements, you can set the sample rate to a value between 0.0 and 1.0. When reduced below 1.0, data will be sampled per session.
This is so context in a given session isn&#8217;t lost.
You can use this setting to dynamically disable Elastic APM at runtime by setting the sample rate to <code class="literal">0</code>.</p>
<p><a class="xref" href="configuration.html#configuration-dynamic" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">1.0</code></p></td>
<td align="left" valign="top"><p>Float</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="supported-technologies.html">« Supported technologies</a>
</span>
<span class="next">
<a href="faq.html">Frequently asked questions »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
