<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>OpenTracing API | APM Go Agent Reference [1.x] | Elastic</title>
<link rel="home" href="index.html" title="APM Go Agent Reference [1.x]"/>
<link rel="up" href="index.html" title="APM Go Agent Reference [1.x]"/>
<link rel="prev" href="metrics.html" title="Metrics"/>
<link rel="next" href="log-correlation.html" title="Log Correlation"/>
<meta name="DC.type" content="Learn/Docs/APM Go Agent/Reference/1.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="1.x"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Go Agent Reference [1.x]</a></span>
»
<span class="breadcrumb-node">OpenTracing API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="metrics.html">« Metrics</a>
</span>
<span class="next">
<a href="log-correlation.html">Log Correlation »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="opentracing"></a>OpenTracing API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h1>
</div></div></div>
<p>The Elastic APM Go agent provides an implementation of the <a href="https://opentracing.io" class="ulink" target="_top">OpenTracing API</a>,
building on top of the core Elastic APM API.</p>
<p>Spans created through the OpenTracing API will be translated to Elastic APM transactions or spans.
Root spans, and spans created with a remote span context, will be translated to Elastic APM
transactions; all others will be created as Elastic APM spans.</p>
<h3><a id="opentracing-init"></a>Initializing the tracer<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h3>
<p>The OpenTracing API implementation is implemented as a bridge on top of the core Elastic APM API.
To initialize the OpenTracing tracer implementation, you must first import the <code class="literal">apmot</code> package:</p>
<div class="pre_wrapper lang-go">
<pre class="programlisting prettyprint lang-go">import (
	"go.elastic.co/apm/module/apmot"
)</pre>
</div>
<p>The apmot package exports a function, "New", which returns an implementation of the
<code class="literal">opentracing.Tracer</code> interface. If you simply call <code class="literal">apmot.New()</code> without any arguments,
the returned tracer will wrap <code class="literal">apm.DefaultTracer</code>. If you wish to use a different
<code class="literal">apm.Tracer</code>, then you can pass it with <code class="literal">apmot.New(apmot.WithTracer(t))</code>.</p>
<div class="pre_wrapper lang-go">
<pre class="programlisting prettyprint lang-go">otTracer := apmot.New()</pre>
</div>
<p>Once you have obtained an <code class="literal">opentracing.Tracer</code>, you can use the standard OpenTracing API
to report spans to Elastic APM. Please refer to <a href="https://github.com/opentracing/opentracing-go" class="ulink" target="_top">opentracing-go</a>
for documentation on the OpenTracing Go API.</p>
<div class="pre_wrapper lang-go">
<pre class="programlisting prettyprint lang-go">import (
	"context"

	"go.elastic.co/apm/module/apmot"

	"github.com/opentracing/opentracing-go"
)

func main() {
	opentracing.SetGlobalTracer(apmot.New())

	parent, ctx := opentracing.StartSpanFromContext(context.Background(), "parent")
	child, _ := opentracing.StartSpanFromContext(ctx, "child")
	child.Finish()
	parent.Finish()
}</pre>
</div>
<h3><a id="opentracing-mixed"></a>Mixing Native and OpenTracing APIs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h3>
<p>When you import <code class="literal">apmot</code>, transactions and spans created with the <a class="xref" href="api.html" title="API Documentation">native API</a>
will be made available as OpenTracing spans, enabling you to mix the use of the
native and OpenTracing APIs. e.g.:</p>
<div class="pre_wrapper lang-go">
<pre class="programlisting prettyprint lang-go">// Transaction created through native API.
transaction := apm.DefaultTracer.StartTransaction("GET /", "request")
ctx := apm.ContextWithTransaction(context.Background(), transaction)

// Span created through OpenTracing API will be a child of the transaction.
otSpan, ctx := opentracing.StartSpanFromContext(ctx, "ot-span")

// Span created through the native API will be a child of the span created
// above via the OpenTracing API.
apmSpan, ctx := apm.StartSpan(ctx, "apm-span", "apm-span")</pre>
</div>
<p>The <code class="literal">opentracing.SpanFromContext</code> function will return an <code class="literal">opentracing.Span</code>
that wraps either an <code class="literal">apm.Span</code> or <code class="literal">apm.Transaction</code>. These span objects are
intended only for passing in context when creating a new span through the
OpenTracing API, and are not fully functional spans. In particular, the <code class="literal">Finish</code>
and <code class="literal">Log*</code> methods are no-ops, and the <code class="literal">Tracer</code> method returns a no-op tracer.</p>
<h3><a id="opentracing-apm-tags"></a>Elastic APM specific tags<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h3>
<p>Elastic APM defines some tags which are not included in the OpenTracing API,
but are relevant in the context of Elastic APM. Some tags are relevant only
to Elastic APM transactions.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">type</code> - sets the type of the transaction or span, e.g. "request", or "ext.http".
If <code class="literal">type</code> is not specified, then the type may be inferred from other
tags. e.g. if "http.url" is specified, then the type will be "request"
for transactions, and "ext.http" for spans. If no type can be inferred,
it is set to "unknown".
</li>
</ul>
</div>
<p>The following tags are relevant only to root or service-entry spans, which are
translated to Elastic APM transactions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">user.id</code> - sets the user ID, which appears in the "User" tab in the transaction details in the Elastic APM app
</li>
<li class="listitem">
<code class="literal">user.email</code> - sets the user email, appears in the "User" tab in the transaction details in the Elastic APM app
</li>
<li class="listitem">
<code class="literal">user.username</code> - sets the user name, appears in the "User" tab in the transaction details in the Elastic APM app
</li>
<li class="listitem">
<code class="literal">result</code> - sets the result of the transaction. If <code class="literal">result</code> is <em>not</em> specified, but <code class="literal">error</code> tag is set to <code class="literal">true</code>,
then the transaction result will be set to "error"
</li>
</ul>
</div>
<h3><a id="opentracing-logs"></a>Span Logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h3>
<p>The <code class="literal">Span.LogKV</code> and <code class="literal">Span.LogFields</code> methods will send error events to Elastic APM for logs
with the "event" field set to "error".</p>
<p>The deprecated log methods <code class="literal">Span.Log</code>, <code class="literal">Span.LogEvent</code>, and <code class="literal">Span.LogEventWithPayload</code> are no-ops.</p>
<h3><a id="opentracing-caveats"></a>Caveats<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h3>
<h4><a id="opentracing-caveats-propagation"></a>Context Propagation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h4>
<p>We support the <code class="literal">TextMap</code> and <code class="literal">HTTPHeaders</code> propagation formats; <code class="literal">Binary</code> is not currently supported.</p>
<h4><a id="opentracing-caveats-spanrefs"></a>Span References<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h4>
<p>We support only <code class="literal">ChildOf</code> references. Other references, e.g. <code class="literal">FollowsFrom</code>, are not currently supported.</p>
<h4><a id="opentracing-caveats-baggage"></a>Baggage<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-go/edit/1.x/docs/opentracing.asciidoc">edit</a></h4>
<p><code class="literal">Span.SetBaggageItem</code> is a no-op; baggage items are silently dropped.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="metrics.html">« Metrics</a>
</span>
<span class="next">
<a href="log-correlation.html">Log Correlation »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
