<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Node.js Agent version 3.x | APM Node.js Agent Reference [3.x] | Elastic</title>
<link rel="home" href="index.html" title="APM Node.js Agent Reference [3.x]"/>
<link rel="up" href="release-notes.html" title="Release notes"/>
<link rel="prev" href="release-notes.html" title="Release notes"/>
<link rel="next" href="release-notes-2.x.html" title="Node.js Agent version 2.x"/>
<meta name="DC.type" content="Learn/Docs/APM Node.js Agent/Reference/3.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="3.x"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Node.js Agent Reference [3.x]</a></span>
»
<span class="breadcrumb-link"><a href="release-notes.html">Release notes</a></span>
»
<span class="breadcrumb-node">Node.js Agent version 3.x</span>
</div>
<div class="navheader">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-2.x.html">Node.js Agent version 2.x »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="release-notes-3.x"></a>Node.js Agent version 3.x<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.12.1"></a>3.12.1 - 2020/02/25<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_bug_fixes"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix: Update <a href="https://github.com/elastic/apm-nodejs-http-client/blob/master/CHANGELOG.md#v951" class="ulink" target="_top">apm-server client</a>
to fix a <a href="https://github.com/elastic/apm-agent-nodejs/issues/1749" class="ulink" target="_top">possible crash</a> when polling for central config.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.12.0"></a>3.12.0 - 2020/02/21<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: Set span outcome to success or failure depending on whether an error
was captured during when the span was active. <a href="https://github.com/elastic/apm-agent-nodejs/issues/1814" class="ulink" target="_top">#1814</a>
</li>
<li class="listitem">
feat: Adds public <code class="literal">setOutcome</code> method to span and transaction APIs, and
adds a top level <code class="literal">setTransactionOutcome</code> and <code class="literal">setSpanOutcome</code> to set
outcome values for the current active transaction or active span.
</li>
<li class="listitem">
Limit the <code class="literal">transactionSampleRate</code> value to 4 decimal places of precision
according to the shared <a href="https://github.com/elastic/apm/blob/master/specs/agents/tracing-sampling.md#transaction_sample_rate-configuration" class="ulink" target="_top">APM spec</a>. This ensures that propagated sampling rate
in the <code class="literal">tracestate</code> header is short and consistent. <a href="https://github.com/elastic/apm-agent-nodejs/pull/1979" class="ulink" target="_top">#1979</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_2"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix: It was possible for fetching central config to result in the
<code class="literal">cloudProvider</code> config value being reset to its default. <a href="https://github.com/elastic/apm-agent-nodejs/issues/1976" class="ulink" target="_top">#1976</a>
</li>
<li class="listitem">
fix: fixes bug where tedious could crash the agent on bulk inserts <a href="https://github.com/elastic/apm-agent-nodejs/pull/1935" class="ulink" target="_top">#1935</a><br>
Reported <a href="https://discuss.elastic.co/t/apm-agent-crashes-nodejs-after-reporting-exception-in-tedious-instrumentation-code/259851" class="ulink" target="_top">via the forum</a>.
The error symptom was: <code class="literal">Cannot read property 'statement' of undefined</code>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.11.0"></a>3.11.0 - 2021/02/08<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_2"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: add <code class="literal">apm.getServiceName()</code> <a href="https://github.com/elastic/apm-agent-nodejs/pull/1949" class="ulink" target="_top">#1949</a><br>
This will be used by <a href="https://github.com/elastic/ecs-logging-js" class="ulink" target="_top">ecs-logging packages</a>
to integrate with APM.
</li>
<li class="listitem">
feat: support numeric and boolean labels <a href="https://github.com/elastic/apm-agent-nodejs/pull/1909" class="ulink" target="_top">#1909</a><br>
Add an optional <code class="literal">stringify</code> option to <code class="literal">apm.setLabel(name, version, stringify = true)</code>
and <code class="literal">apm.addLabels(labels, stringify = true)</code>, which can be set <code class="literal">false</code> to
allow numeric and boolean labels. Stringify defaults to true for backwards
compatibility&#8201;&#8212;&#8201;stringification will be removed in a future major version.
</li>
<li class="listitem">
feat: added support for cloud metadata fetching <a href="https://github.com/elastic/apm-agent-nodejs/pull/1937" class="ulink" target="_top">#1937</a><br>
Agent now collects information about its cloud environment and includes this
data in the APM Server&#8217;s metadata payload. See
<a href="https://github.com/elastic/apm/blob/3acd10afa0a9d3510e819229dfce0764133083d3/specs/agents/metadata.md#cloud-provider-metadata" class="ulink" target="_top">the spec</a>
for more information.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.10.0"></a>3.10.0 - 2021/01/11<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_3"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: Improve handling of raw body parsing
The agent will now report raw/<code class="literal">Buffer</code> encoded post bodies as <em>&lt;Buffer&gt;</em>.
</li>
<li class="listitem">
feat: Add support for api keys <a href="https://github.com/elastic/apm-agent-nodejs/pull/1818" class="ulink" target="_top">#1818</a><br>
This allows the usage of API keys for authentication to the APM server
</li>
<li class="listitem">
<p>feat: Add automatic instrumentation of the <a href="https://github.com/elastic/elasticsearch-js" class="ulink" target="_top">@elastic/elasticsearch</a> package <a href="https://github.com/elastic/apm-agent-nodejs/pull/1877" class="ulink" target="_top">#1870</a></p>
<p>The instrumentation of the legacy "elasticsearch" package has also changed
slightly to commonalize:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
"span.context.destination" is set on all Elasticsearch spans, not just a
subset of query-like API endpoints.
</li>
<li class="listitem">
For query-like API endpoints (e.g. <code class="literal">/_search</code>), the capturing of query details
on "span.context.db.statement" has changed (a) to include <span class="strong strong"><strong>both</strong></span> the
query params and the request body if both exist (separated by <code class="literal">\n\n</code>) and
(b) to <span class="strong strong"><strong>URL encode</strong></span> the query params, rather than JSON encoding.
</li>
</ul>
</div>
</li>
<li class="listitem">
feat: Add <code class="literal">captureAttributes</code> boolean option to <code class="literal">apm.captureError()</code> to
allow <span class="strong strong"><strong>disabling</strong></span> the automatic capture of Error object properties. This
is useful for cases where those properties should not be sent to the APM
Server, e.g. for performance (large string fields) or security (PII data).
<a href="https://github.com/elastic/apm-agent-nodejs/pull/1912" class="ulink" target="_top">#1912</a>
</li>
<li class="listitem">
feat: Add <code class="literal">log_level</code> central config support. <a href="https://github.com/elastic/apm-agent-nodejs/pull/1908" class="ulink" target="_top">#1908</a><br>
Spec: <a href="https://github.com/elastic/apm/blob/master/specs/agents/logging.md" class="ulink" target="_top">https://github.com/elastic/apm/blob/master/specs/agents/logging.md</a>
</li>
<li class="listitem">
<p>feat: implemented sanitize_feature_names specification<br>
Allows users to configure a list of wildcard patterns to <em>remove</em> items
from the agent&#8217;s HTTP header and <code class="literal">application/x-www-form-urlencoded</code> payloads.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/apm/blob/master/specs/agents/sanitization.md" class="ulink" target="_top">spec</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/apm-agent-nodejs/blob/master/docs/configuration.asciidoc#sanitize-field-names" class="ulink" target="_top">docs</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_3"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>fix: Fix parsing of comma-separated strings for relevant config vars to allow
whitespace around the commas. E.g.:</p>
<pre class="screen">export ELASTIC_APM_TRANSACTION_IGNORE_URLS='/ping, /metrics*'</pre>
<p>Config vars affected are: <code class="literal">disableInstrumentations</code>, <code class="literal">transactionIgnoreUrls</code>
<code class="literal">addPatch</code>, and <code class="literal">globalLabels</code>.</p>
</li>
<li class="listitem">
fix: Correct the environment variable for setting <code class="literal">transactionIgnoreUrl</code>
(added in v3.9.0) from <code class="literal">ELASTIC_TRANSACTION_IGNORE_URLS</code> to
<code class="literal">ELASTIC_APM_TRANSACTION_IGNORE_URLS</code>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.9.0"></a>3.9.0 - 2020/11/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_4"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: support fastify 3 <a href="https://github.com/elastic/apm-agent-nodejs/pull/1891" class="ulink" target="_top">#1891</a><br>
Adds .default and .fastify module.exports to instrumented fastify function
for 3.x line, and prefers req.routerMethod and req.routerPath for
transaction name
</li>
<li class="listitem">
feat: Set "destination" context on spans for "mongodb". <a href="https://github.com/elastic/apm-agent-nodejs/pull/1893" class="ulink" target="_top">#1893</a><br>
This allows Kibana APM Service Maps to show a "mongodb" node for services using
the <a href="https://www.npmjs.com/package/mongodb" class="ulink" target="_top">mongodb</a> package (which includes
mongoose and mongojs).
</li>
<li class="listitem">
feat: transactionIgnoreUrl wildcard matching <a href="https://github.com/elastic/apm-agent-nodejs/pull/1870" class="ulink" target="_top">#1870</a><br>
Allows users to ignore URLs using simple wildcard matching patterns that behave
the same across language agents. See <a href="https://github.com/elastic/apm/issues/144" class="ulink" target="_top">https://github.com/elastic/apm/issues/144</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_4"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix: treat set-cookie in response headers as sensitive data <a href="https://github.com/elastic/apm-agent-nodejs/pull/1886" class="ulink" target="_top">#1886</a>
</li>
<li class="listitem">
fix: Synchronous spans would never have <code class="literal">span.sync == true</code>. <a href="https://github.com/elastic/apm-agent-nodejs/pull/1879" class="ulink" target="_top">#1879</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.8.0"></a>3.8.0 - 2020/11/09<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_5"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: expand k8s pod ID discovery regex <a href="https://github.com/elastic/apm-agent-nodejs/pull/1863" class="ulink" target="_top">#1863</a>
</li>
<li class="listitem">
feat: implements tracestate <a href="https://github.com/elastic/apm-agent-nodejs/pull/1828" class="ulink" target="_top">#1828</a><br>
Expands support for the W3C Trace Context specification by adding a tracestate
header implementation, and uses this new header to track the Elastic
transaction sample rate across a trace&#8217;s service boundaries.
</li>
<li class="listitem">
feat: add span and transaction outcome <a href="https://github.com/elastic/apm-agent-nodejs/pull/1824" class="ulink" target="_top">#1824</a><br>
This adds an "outcome" field to HTTP(S)
<a href="https://github.com/elastic/apm/blob/master/specs/agents/tracing-transactions.md#transaction-outcome" class="ulink" target="_top">transactions</a>
and <a href="https://github.com/elastic/apm/blob/master/specs/agents/tracing-spans.md#span-outcome" class="ulink" target="_top">spans</a>.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_5"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix(pg): prevent unhandled promise rejection <a href="https://github.com/elastic/apm-agent-nodejs/pull/1846" class="ulink" target="_top">#1846</a>
</li>
<li class="listitem">
fix: redis@2.x instrumentation was broken <a href="https://github.com/elastic/apm-agent-nodejs/pull/1852" class="ulink" target="_top">#1852</a>
</li>
<li class="listitem">
A number of fixes to the test suite.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.7.0"></a>3.7.0 - 2020/8/10<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat(knex): add support for 0.21.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1801" class="ulink" target="_top">#1801</a>
</li>
<li class="listitem">
feat(redis): add support for v3.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1641" class="ulink" target="_top">#1641</a>
</li>
<li class="listitem">
feat(graphql): add support for 15.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1795" class="ulink" target="_top">#1795</a>
</li>
<li class="listitem">
feat(koa-router): add support for 9.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1772" class="ulink" target="_top">#1772</a>
</li>
<li class="listitem">
fix(elasticsearch): ensure requests can be aborted <a href="https://github.com/elastic/apm-agent-nodejs/pull/1566" class="ulink" target="_top">#1566</a>
</li>
<li class="listitem">
fix: end span if outgoing http request ends prematurely <a href="https://github.com/elastic/apm-agent-nodejs/pull/1583" class="ulink" target="_top">#1583</a>
</li>
<li class="listitem">
fix: don&#8217;t throw on invalid URL <a href="https://github.com/elastic/apm-agent-nodejs/pull/1771" class="ulink" target="_top">#1771</a>
</li>
<li class="listitem">
fix: patch apollo-server-core &gt; 2.14 correctly <a href="https://github.com/elastic/apm-agent-nodejs/pull/1796" class="ulink" target="_top">#1796</a>
</li>
<li class="listitem">
fix: add currentTraceIds to typings <a href="https://github.com/elastic/apm-agent-nodejs/pull/1733" class="ulink" target="_top">#1733</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.6.1"></a>3.6.1 - 2020/5/20<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix(package): bump elastic-apm-http-client to ^9.4.0 <a href="https://github.com/elastic/apm-agent-nodejs/pull/1756" class="ulink" target="_top">#1756</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.6.0"></a>3.6.0 - 2020/5/18<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: add destination metadata for db spans <a href="https://github.com/elastic/apm-agent-nodejs/pull/1687" class="ulink" target="_top">#1687</a>
</li>
<li class="listitem">
feat: add support for Node.js 14 <a href="https://github.com/elastic/apm-agent-nodejs/pull/1742" class="ulink" target="_top">#1742</a>
</li>
<li class="listitem">
feat(pg): add support for pg v8.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1743" class="ulink" target="_top">#1743</a>
</li>
<li class="listitem">
feat: add metrics for external memory <a href="https://github.com/elastic/apm-agent-nodejs/pull/1724" class="ulink" target="_top">#1724</a>
</li>
<li class="listitem">
feat: enrich spans with destination info <a href="https://github.com/elastic/apm-agent-nodejs/pull/1685" class="ulink" target="_top">#1685</a>
</li>
<li class="listitem">
fix(instrumentation): add .js to module path <a href="https://github.com/elastic/apm-agent-nodejs/pull/1711" class="ulink" target="_top">#1711</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.5.0"></a>3.5.0 - 2020/3/9<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat(error): get stack trace from Error-like objects <a href="https://github.com/elastic/apm-agent-nodejs/pull/1613" class="ulink" target="_top">#1613</a>
</li>
<li class="listitem">
fix: add logUncaughtExceptions conf option to TypeScript typings <a href="https://github.com/elastic/apm-agent-nodejs/pull/1668" class="ulink" target="_top">#1668</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.4.0"></a>3.4.0 - 2020/2/21<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: support W3C TraceContext traceparent header <a href="https://github.com/elastic/apm-agent-nodejs/pull/1587" class="ulink" target="_top">#1587</a>
</li>
<li class="listitem">
feat: add custom metrics API (experimental) <a href="https://github.com/elastic/apm-agent-nodejs/pull/1571" class="ulink" target="_top">#1571</a>
</li>
<li class="listitem">
feat(koa-router): add support for v8.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1642" class="ulink" target="_top">#1642</a>
</li>
<li class="listitem">
fix(cassandra): improve support for cassandra-driver v4.4.0+ <a href="https://github.com/elastic/apm-agent-nodejs/pull/1636" class="ulink" target="_top">#1636</a>
</li>
<li class="listitem">
fix: support promisifying setTimeout and friends <a href="https://github.com/elastic/apm-agent-nodejs/pull/1636" class="ulink" target="_top">#1636</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.3.0"></a>3.3.0 - 2019/12/13<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat(config): add serverCaCertFile config <a href="https://github.com/elastic/apm-agent-nodejs/pull/1560" class="ulink" target="_top">#1560</a>
</li>
<li class="listitem">
feat(config): add central config support for transactionMaxSpans and captureBody <a href="https://github.com/elastic/apm-agent-nodejs/pull/1555" class="ulink" target="_top">#1555</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.2.0"></a>3.2.0 - 2019/11/19<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix(metrics): only register collectors if enabled <a href="https://github.com/elastic/apm-agent-nodejs/pull/1520" class="ulink" target="_top">#1520</a>
</li>
<li class="listitem">
fix(ioredis): prevent unhandled promise rejection <a href="https://github.com/elastic/apm-agent-nodejs/pull/1523" class="ulink" target="_top">#1523</a>
</li>
<li class="listitem">
chore: add Node 13 to supported engines <a href="https://github.com/elastic/apm-agent-nodejs/pull/1524" class="ulink" target="_top">#1524</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.1.0"></a>3.1.0 - 2019/10/16<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_6"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat(mongodb): instrumentation <a href="https://github.com/elastic/apm-agent-nodejs/pull/1423" class="ulink" target="_top">#1423</a>
</li>
<li class="listitem">
fix(package): update elastic-apm-http-client to version 9.0.0 <a href="https://github.com/elastic/apm-agent-nodejs/pull/1419" class="ulink" target="_top">#1419</a>
</li>
<li class="listitem">
perf: cache <em>ids</em> value of transactions and spans <a href="https://github.com/elastic/apm-agent-nodejs/pull/1434" class="ulink" target="_top">#1434</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_6"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix: always end transaction when socket is closed prematurely <a href="https://github.com/elastic/apm-agent-nodejs/pull/1439" class="ulink" target="_top">#1439</a>
</li>
<li class="listitem">
fix: change logUncaughtExceptions default to false <a href="https://github.com/elastic/apm-agent-nodejs/pull/1432" class="ulink" target="_top">#1432</a>
</li>
<li class="listitem">
fix: write stack trace of uncaught exceptions to STDERR <a href="https://github.com/elastic/apm-agent-nodejs/pull/1429" class="ulink" target="_top">#1429</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.0.0"></a>3.0.0 - 2019/9/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: allow manual instrumentation with <code class="literal">instrument: false</code> <a href="https://github.com/elastic/apm-agent-nodejs/pull/1114" class="ulink" target="_top">#1114</a>
</li>
<li class="listitem">
feat: allow setting span/transaction <code class="literal">type</code>, <code class="literal">subtype</code>, and <code class="literal">action</code> separately (the behavior of the old <code class="literal">type</code> has changed) <a href="https://github.com/elastic/apm-agent-nodejs/pull/1292" class="ulink" target="_top">#1292</a>
</li>
<li class="listitem">
feat: use <code class="literal">external</code> as span type instead of <code class="literal">ext</code> <a href="https://github.com/elastic/apm-agent-nodejs/pull/1291" class="ulink" target="_top">#1291</a>
</li>
<li class="listitem">
refactor(graphql): use custom transaction type <code class="literal">graphql</code> for graphql requests instead of <code class="literal">request</code> <a href="https://github.com/elastic/apm-agent-nodejs/pull/1245" class="ulink" target="_top">#1245</a>
</li>
<li class="listitem">
feat(http): add <code class="literal">instrumentIncomingHTTPRequests</code> config (<code class="literal">disableInstrumentations</code> now behaves differently) <a href="https://github.com/elastic/apm-agent-nodejs/pull/1298" class="ulink" target="_top">#1298</a>
</li>
<li class="listitem">
chore: remove deprecated APIs <a href="https://github.com/elastic/apm-agent-nodejs/pull/1413" class="ulink" target="_top">#1413</a>
</li>
<li class="listitem">
chore: drop support for older Node.js versions <a href="https://github.com/elastic/apm-agent-nodejs/pull/1383" class="ulink" target="_top">#1383</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-2.x.html">Node.js Agent version 2.x »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
