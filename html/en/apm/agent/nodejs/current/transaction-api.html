<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Transaction API | APM Node.js Agent Reference [3.x] | Elastic</title>
<meta class="elastic" name="content" content="Transaction API | APM Node.js Agent Reference [3.x]">

<link rel="home" href="index.html" title="APM Node.js Agent Reference [3.x]"/>
<link rel="up" href="api.html" title="API Reference"/>
<link rel="prev" href="agent-api.html" title="Agent API"/>
<link rel="next" href="span-api.html" title="Span API"/>
<meta class="elastic" name="product_version" content="3.x"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Node.js Agent/Reference/3.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="3.x"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
    <div class="related-products-title">APM:</div>
    <div class="dropdown-anchor" tabindex="0">Node.js Agent Reference<span class="dropdown-icon"></span></div>
    <div class="dropdown-content">
      <ul>
        <li class="dropdown-category">APM</li>
        <ul>
          <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
        </ul>
        <li class="dropdown-category">APM agents</li>
        <ul>
          <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
        </ul>
        <li class="dropdown-category">APM extensions</li>
        <ul>
          <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
          <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
        </ul>
      </ul>
    </div>
  </div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="api.html">API Reference</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="agent-api.html">« <code class="literal">Agent</code> API</a>
</span>
<span class="next">
<a href="span-api.html"><code class="literal">Span</code> API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="transaction-api"></a><code class="literal">Transaction</code> API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h2>
</div></div></div>
<p>A transaction groups multiple spans in a logical group.</p>
<p>To get a <code class="literal">Transaction</code> object,
you need to call <a class="xref" href="agent-api.html#apm-start-transaction" title="apm.startTransaction([name][, type][, subtype][, action][, options])"><code class="literal">apm.startTransaction()</code></a>.</p>
<p>To see an example of using custom transactions,
see the <a class="xref" href="custom-transactions.html" title="Custom transactions">Custom Transactions in Node.js</a> article.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-name"></a><code class="literal">transaction.name</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v0.1.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> <span class="strong strong"><strong>Default:</strong></span> <code class="literal">unnamed</code>
</li>
</ul>
</div>
<p>The name of the transaction.</p>
<p>Can be used to set or overwrite the name of the transaction (visible in the performance monitoring breakdown).
If you don&#8217;t have access to the current transaction,
you can also set the name using <a class="xref" href="agent-api.html#apm-set-transaction-name" title="apm.setTransactionName(name)"><code class="literal">apm.setTransactionName()</code></a>.</p>
<p>Transactions with the same name and <a class="xref" href="transaction-api.html#transaction-type" title="transaction.type">type</a> are grouped together.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-type"></a><code class="literal">transaction.type</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v0.1.0</span></p>
<p><span class="small">Split components into <code class="literal">type</code>, <code class="literal">subtype</code> and <code class="literal">action</code> in: v3.0.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> <span class="strong strong"><strong>Default:</strong></span> <code class="literal">custom</code>
</li>
</ul>
</div>
<p>The type of the transaction.</p>
<p>There&#8217;s a special type called <code class="literal">request</code> which is used by the agent for the transactions automatically created when an incoming HTTP request is detected.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-subtype"></a><code class="literal">transaction.subtype</code> <span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">v3.25.0</span>]
<span class="Admonishment-detail">
Deprecated in v3.25.0.
</span>
</span><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v3.0.0</span><br>
<span class="small">Deprecated in: v3.25.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> <span class="strong strong"><strong>Default:</strong></span> <code class="literal">custom</code>
</li>
</ul>
</div>
<p>The subtype of the transaction.
The transaction <code class="literal">subtype</code> field is deprecated: it is not used and will be
removed in the next major version.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-action"></a><code class="literal">transaction.action</code> <span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">v3.25.0</span>]
<span class="Admonishment-detail">
Deprecated in v3.25.0.
</span>
</span><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v3.0.0</span><br>
<span class="small">Deprecated in: v3.25.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> <span class="strong strong"><strong>Default:</strong></span> <code class="literal">custom</code>
</li>
</ul>
</div>
<p>The action of the transaction.
The transaction <code class="literal">action</code> field is deprecated: it is not used and will be removed
in the next major version.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-traceparent"></a><code class="literal">transaction.traceparent</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v2.9.0</span></p>
<p>Get the serialized traceparent string of the transaction.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-result"></a><code class="literal">transaction.result</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v0.1.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> <span class="strong strong"><strong>Default:</strong></span> <code class="literal">success</code>
</li>
</ul>
</div>
<p>A string describing the result of the transaction.
This is typically the HTTP status code,
or e.g. "success" or "failure" for a background task.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-start-span"></a><code class="literal">transaction.startSpan([name][, type][, subtype][, action][, options])</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v2.0.0</span></p>
<p><span class="small">Split <code class="literal">type</code> into <code class="literal">type</code>, <code class="literal">subtype</code> and <code class="literal">action</code> in: v3.0.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">name</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> The name of the span.
You can alternatively set this via <a class="xref" href="span-api.html#span-name" title="span.name"><code class="literal">span.name</code></a>.
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">unnamed</code>
</li>
<li class="listitem">
<code class="literal">type</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> The type of the span.
You can alternatively set this via <a class="xref" href="span-api.html#span-type" title="span.type"><code class="literal">span.type</code></a>.
</li>
<li class="listitem">
<code class="literal">subtype</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> The subtype of the span.
You can alternatively set this via <a class="xref" href="span-api.html#span-subtype" title="span.subtype"><code class="literal">span.subtype</code></a>.
</li>
<li class="listitem">
<code class="literal">action</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> The action of the span.
You can alternatively set this via <a class="xref" href="span-api.html#span-action" title="span.action"><code class="literal">span.action</code></a>.
</li>
<li class="listitem">
<p><code class="literal">options</code> - The following options are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">startTime</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="ulink" target="_top">&lt;number&gt;</a></code> The time when the span started.
Must be a Unix Time Stamp representing the number of milliseconds since January 1, 1970, 00:00:00 UTC.
Sub-millisecond precision can be achieved using decimals.
If not provided,
the current time will be used
</li>
<li class="listitem">
<code class="literal">exitSpan</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="ulink" target="_top">&lt;boolean&gt;</a></code> Make an "exit span".
Exit spans represent outgoing communication. They are used to create a node
in the <a href="/guide/en/kibana/8.6/service-maps.html" class="ulink" target="_top">Service Map</a> and a downstream service
in the <a href="/guide/en/kibana/8.6/dependencies.html" class="ulink" target="_top">Dependencies Table</a>. The provided subtype
will be used as the downstream service name.
</li>
<li class="listitem">
<code class="literal">links</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="ulink" target="_top">&lt;Array&gt;</a></code> Span links.
A span can refer to zero or more other transactions or spans (separate from
its parent). Span links will be shown in the Kibana APM app trace view. The
<code class="literal">links</code> argument is an array of objects with a single "context" field that is a
<code class="literal">Transaction</code>, <code class="literal">Span</code>, or W3C trace-context <em>traceparent</em> string.  For example:
<code class="literal">transaction.startSpan('aName', { links: [{ context: anotherSpan }] })</code>.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Start and return a new custom span associated with this transaction.
When a span is started it will measure the time until <a class="xref" href="span-api.html#span-end" title="span.end([endTime])"><code class="literal">span.end()</code></a> is called.</p>
<p>See <a class="xref" href="span-api.html" title="Span API">Span API</a> docs for details on how to use custom spans.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-set-label"></a><code class="literal">transaction.setLabel(name, value[, stringify = true])</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v0.1.0</span><br>
<span class="small">Renamed from <code class="literal">transaction.setTag()</code> to <code class="literal">transaction.setLabel()</code>: v2.10.0</span><br>
<span class="small">Added <code class="literal">stringify</code> argument in: v3.11.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">name</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code>
Any periods (<code class="literal">.</code>), asterisks (<code class="literal">*</code>), or double quotation marks (<code class="literal">"</code>) will be replaced by underscores (<code class="literal">_</code>),
as those characters have special meaning in Elasticsearch
</li>
<li class="listitem">
<code class="literal">value</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> | <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="ulink" target="_top">&lt;number&gt;</a></code> | <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="ulink" target="_top">&lt;boolean&gt;</a></code>
</li>
<li class="listitem">
<code class="literal">stringify</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="ulink" target="_top">&lt;boolean&gt;</a></code>
Defaults to <code class="literal">true</code>. When true, if a non-string <code class="literal">value</code> is given, it is
converted to a string before being sent to the APM Server
</li>
</ul>
</div>
<p>Set a label on the transaction.
You can set multiple labels on the same transaction.
If an error happens during the transaction,
it will also get tagged with the same labels.</p>
<p>Tags are key/value pairs that are indexed by Elasticsearch and therefore searchable (as opposed to data set via <a class="xref" href="agent-api.html#apm-set-custom-context" title="apm.setCustomContext(context)"><code class="literal">apm.setCustomContext()</code></a>).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-add-labels"></a><code class="literal">transaction.addLabels({ [name]: value }[, stringify = true])</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v1.5.0</span><br>
<span class="small">Renamed from <code class="literal">transaction.addTags()</code> to <code class="literal">transaction.addLabels()</code>: v2.10.0</span><br>
<span class="small">Added <code class="literal">stringify</code> argument in: v3.11.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">labels</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="ulink" target="_top">&lt;Object&gt;</a></code> Contains key/value pairs:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">name</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code>
Any periods (<code class="literal">.</code>), asterisks (<code class="literal">*</code>), or double quotation marks (<code class="literal">"</code>) will be replaced by underscores (<code class="literal">_</code>),
as those characters have special meaning in Elasticsearch
</li>
<li class="listitem">
<code class="literal">value</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> | <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="ulink" target="_top">&lt;number&gt;</a></code> | <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="ulink" target="_top">&lt;boolean&gt;</a></code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<code class="literal">stringify</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="ulink" target="_top">&lt;boolean&gt;</a></code>
Defaults to <code class="literal">true</code>. When true, if a non-string <code class="literal">value</code> is given, it is
converted to a string before being sent to the APM Server.
</li>
</ul>
</div>
<p>Add several labels on the transaction.
You can add labels multiple times.
If an error happens during the transaction,
it will also get tagged with the same labels.</p>
<p>Labels are key/value pairs that are indexed by Elasticsearch and therefore searchable (as opposed to data set via <a class="xref" href="agent-api.html#apm-set-custom-context" title="apm.setCustomContext(context)"><code class="literal">apm.setCustomContext()</code></a>).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-ensure-parent-id"></a><code class="literal">transaction.ensureParentId()</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v2.0.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code>
</li>
</ul>
</div>
<p>If the transaction does not already have a parent id,
calling this method generates a new parent id,
sets it as the parent id of this transaction,
and returns it as a <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code>.</p>
<p>This enables the correlation of the spans the JavaScript Real User Monitoring (RUM) agent creates for the initial page load with the transaction of the backend service.
If your backend service generates the HTML page dynamically,
initializing the JavaScript RUM agent with the value of this method allows analyzing the time spent in the browser vs in the backend services.</p>
<p>To enable the JavaScript RUM agent,
add a snippet similar to this to the body of your HTML page,
preferably before other JavaScript libraries:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">elasticApm.init({
  serviceName: 'my-frontend-app', // Name of your frontend app
  serverUrl: 'https://example.com:8200', // APM Server host
  pageLoadTraceId: '${transaction.traceId}',
  pageLoadSpanId: '${transaction.ensureParentId()}',
  pageLoadSampled: ${transaction.sampled}
})</pre>
</div>
<p>See the <a href="/guide/en/apm/agent/rum-js/current" class="ulink" target="_top">JavaScript RUM agent documentation</a> for more information.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-ids"></a><code class="literal">transaction.ids</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v2.17.0</span></p>
<p>Produces an object containing <code class="literal">transaction.id</code> and <code class="literal">trace.id</code>.
This enables log correlation to APM traces with structured loggers.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "trace.id": "abc123",
  "transaction.id": "abc123"
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-to-string"></a><code class="literal">transaction.toString()</code> <span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">v3.23.0</span>]
<span class="Admonishment-detail">
Deprecated in v3.23.0.
</span>
</span><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v2.17.0</span><br>
<span class="small">Deprecated in: v3.23.0</span></p>
<p>Produces a string representation of the transaction to inject in log messages.
This enables log correlation to APM traces with text-only loggers.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"trace.id=abc123 transaction.id=abc123"</pre>
</div>
<p>Relying on the format of <code class="literal">transaction.toString()</code> has been <span class="strong strong"><strong>deprecated</strong></span> and may
change in v4 of the agent. Prefer the use of <a class="xref" href="transaction-api.html#transaction-ids" title="transaction.ids"><code class="literal">transaction.ids</code></a> or
<a class="xref" href="agent-api.html#apm-current-trace-ids" title="apm.currentTraceIds"><code class="literal">apm.currentTraceIds</code></a>. The v3 format may be reproduced
via:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { stringify } = require('querystring')
console.log( stringify(transaction.ids, ' ', '=')) )</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-end"></a><code class="literal">transaction.end([result][, endTime])</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v0.1.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">result</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code> Describes the result of the transaction.
This is typically the HTTP status code,
or e.g. "success" or "failure" for a background task
</li>
<li class="listitem">
<code class="literal">endTime</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="ulink" target="_top">&lt;number&gt;</a></code> The time when the transaction ended.
Must be a Unix Time Stamp representing the number of milliseconds since January 1, 1970, 00:00:00 UTC.
Sub-millisecond precision can be achieved using decimals.
If not provided,
the current time will be used
</li>
</ul>
</div>
<p>Ends the transaction.
If the transaction has already ended,
nothing happens.</p>
<p>Alternatively you can call <a class="xref" href="agent-api.html#apm-end-transaction" title="apm.endTransaction([result][, endTime])"><code class="literal">apm.endTransaction()</code></a> to end the active transaction.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-outcome"></a><code class="literal">transaction.outcome</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v3.12.0</span></p>
<p>The Node.js agent automatically sets an <code class="literal">outcome</code> property on transactions.  This property will be one of three values:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">success</code>: Indicates the transaction&#8217;s operation was a success.
</li>
<li class="listitem">
<code class="literal">failure</code>: Indicates the transaction&#8217;s operation was <em>not</em> a success.
</li>
<li class="listitem">
<code class="literal">unknown</code>: Indicates we were unable to determine if the transaction&#8217;s operation was a success or not.  An <code class="literal">unknown</code> outcome removes a transaction from error rate considerations.
</li>
</ul>
</div>
<p>A transaction is considered a success if the underlying HTTP request handling produces a response with a status code that is less than <code class="literal">500</code>.  A status code of <code class="literal">500</code> or greater is considered a failure.</p>
<p>Non-HTTP transactions will begin with an outcome of <code class="literal">unknown</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="transaction-setoutcome"></a><code class="literal">transaction.setOutcome(outcome)</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/3.x/docs/transaction-api.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="small">Added in: v3.12.0</span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">outcome</code> <code class="literal"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="ulink" target="_top">&lt;string&gt;</a></code>
</li>
</ul>
</div>
<p>The <code class="literal">setOutcome</code> method allows an end user to override the Node.js agent&#8217;s default setting of a transaction&#8217;s <code class="literal">outcome</code> property.  The <code class="literal">setOutcome</code> method accepts a string of either <code class="literal">success</code>, <code class="literal">failure</code>, or <code class="literal">unknown</code>, and will force the agent to report this value for a specific span.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="agent-api.html">« <code class="literal">Agent</code> API</a>
</span>
<span class="next">
<a href="span-api.html"><code class="literal">Span</code> API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
