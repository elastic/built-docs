<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Starlette/FastAPI Support | APM Python Agent Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="APM Python Agent Reference [master]"/>
<link rel="up" href="set-up.html" title="Set up the Agent"/>
<link rel="prev" href="tornado-support.html" title="Tornado Support"/>
<link rel="next" href="supported-technologies.html" title="Supported Technologies"/>
<meta name="DC.type" content="Learn/Docs/APM Python Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Python Agent Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="set-up.html">Set up the Agent</a></span>
»
<span class="breadcrumb-node">Starlette/FastAPI Support</span>
</div>
<div class="navheader">
<span class="prev">
<a href="tornado-support.html">« Tornado Support</a>
</span>
<span class="next">
<a href="supported-technologies.html">Supported Technologies »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="starlette-support"></a>Starlette/FastAPI Support<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/master/docs/starlette.asciidoc">edit</a></h2>
</div></div></div>
<p>Incorporating Elastic APM into your Starlette project only requires a few easy
steps.</p>
<h4><a id="starlette-installation"></a>Installation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/master/docs/starlette.asciidoc">edit</a></h4>
<p>Install the Elastic APM agent using pip:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">$ pip install elastic-apm</pre>
</div>
<p>or add <code class="literal">elastic-apm</code> to your project&#8217;s <code class="literal">requirements.txt</code> file.</p>
<h4><a id="starlette-setup"></a>Setup<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/master/docs/starlette.asciidoc">edit</a></h4>
<p>To set up the agent, you need to initialize it with appropriate settings.</p>
<p>The settings are configured either via environment variables, or as
initialization arguments.</p>
<p>You can find a list of all available settings in the
<a class="xref" href="configuration.html" title="Configuration">Configuration</a> page.</p>
<p>To initialize the agent for your application using environment variables:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from starlette.applications import Starlette
from elasticapm.contrib.starlette import make_apm_client, ElasticAPM

apm = make_apm_client()
app = Starlette()
app.add_middleware(ElasticAPM, client=apm)</pre>
</div>
<p>To configure the agent using initialization arguments:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from starlette.applications import Starlette
from elasticapm.contrib.starlette import make_apm_client, ElasticAPM

apm = make_apm_client({
    'SERVICE_NAME': '&lt;SERVICE-NAME&gt;',
    'SECRET_TOKEN': '&lt;SECRET-TOKEN&gt;',
})
app = Starlette()
app.add_middleware(ElasticAPM, client=apm)</pre>
</div>
<h4><a id="starlette-fastapi"></a>FastAPI<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/master/docs/starlette.asciidoc">edit</a></h4>
<p>Because FastAPI supports Starlette middleware, using the agent with FastAPI
is almost exactly the same as with Starlette:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from fastapi import FastAPI
from elasticapm.contrib.starlette import make_apm_client, ElasticAPM

apm = make_apm_client()
app = FastAPI()
app.add_middleware(ElasticAPM, client=apm)</pre>
</div>
<h4><a id="starlette-usage"></a>Usage<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/master/docs/starlette.asciidoc">edit</a></h4>
<p>Once you have configured the agent, it will automatically track transactions
and capture uncaught exceptions within starlette.</p>
<p>Capture an arbitrary exception by calling
<a class="xref" href="api.html#client-api-capture-exception" title="Client.capture_exception()"><code class="literal">capture_exception</code></a>:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">try:
    1 / 0
except ZeroDivisionError:
    apm.client.capture_exception()</pre>
</div>
<p>Log a generic message with <a class="xref" href="api.html#client-api-capture-message" title="Client.capture_message()"><code class="literal">capture_message</code></a>:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">apm.client.capture_message('hello, world!')</pre>
</div>
<h4><a id="starlette-performance-metrics"></a>Performance metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/master/docs/starlette.asciidoc">edit</a></h4>
<p>If you&#8217;ve followed the instructions above, the agent has installed our
instrumentation middleware which will process all requests through your app.
This will measure response times, as well as detailed performance data for
all supported technologies.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Due to the fact that <code class="literal">asyncio</code> drivers are usually separate from their
synchronous counterparts, specific instrumentation is needed for all drivers.
The support for asynchronous drivers is currently quite limited.</p>
</div>
</div>
<h5><a id="starlette-ignoring-specific-views"></a>Ignoring specific routes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/master/docs/starlette.asciidoc">edit</a></h5>
<p>You can use the
<a class="xref" href="configuration.html#config-transactions-ignore-patterns" title="transactions_ignore_patterns"><code class="literal">TRANSACTIONS_IGNORE_PATTERNS</code></a>
configuration option to ignore specific routes. The list given should be a
list of regular expressions which are matched against the transaction name:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">apm = make_apm_client({
    # ...
    'TRANSACTIONS_IGNORE_PATTERNS': ['^GET /secret', '/extra_secret']
    # ...
})</pre>
</div>
<p>This would ignore any requests using the <code class="literal">GET /secret</code> route
and any requests containing <code class="literal">/extra_secret</code>.</p>
<h4><a id="supported-starlette-and-python-versions"></a>Supported Starlette and Python versions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/master/docs/starlette.asciidoc">edit</a></h4>
<p>A list of supported <a class="xref" href="supported-technologies.html#supported-starlette" title="Starlette/FastAPI">Starlette</a> and
<a class="xref" href="supported-technologies.html#supported-python" title="Python">Python</a> versions can be found on our
<a class="xref" href="supported-technologies.html" title="Supported Technologies">Supported Technologies</a> page.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elastic APM only supports <code class="literal">asyncio</code> when using Python 3.7+</p>
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="tornado-support.html">« Tornado Support</a>
</span>
<span class="next">
<a href="supported-technologies.html">Supported Technologies »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
