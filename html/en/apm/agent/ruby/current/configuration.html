<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Configuration | APM Ruby Agent Reference [3.x] | Elastic</title>
<link rel="home" href="index.html" title="APM Ruby Agent Reference [3.x]"/>
<link rel="up" href="index.html" title="APM Ruby Agent Reference [3.x]"/>
<link rel="prev" href="supported-technologies.html" title="Supported technologies"/>
<link rel="next" href="advanced.html" title="Advanced Topics"/>
<meta name="DC.type" content="Learn/Docs/APM Ruby Agent/Reference/3.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="3.x"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Ruby Agent Reference [3.x]</a></span>
»
<span class="breadcrumb-node">Configuration</span>
</div>
<div class="navheader">
<span class="prev">
<a href="supported-technologies.html">« Supported technologies</a>
</span>
<span class="next">
<a href="advanced.html">Advanced Topics »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="configuration"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h1>
</div></div></div>
<p>There are several ways to configure how Elastic APM behaves.
The recommended way is to specify options in a <code class="literal">config/elastic_apm.yml</code> file:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">server_url: 'http://localhost:8200'
secret_token: &lt;%= ENV["VERY_SECRET_TOKEN"] %&gt;</pre>
</div>
<p>Some options can be set with <code class="literal">ENV</code> variables.
When using this method, strings are split by comma, e.g.,
<code class="literal">ELASTIC_APM_SANITIZE_FIELD_NAMES="a,b" # =&gt; [/a/, /b/]</code>.</p>
<h3><a id="configuration-precedence"></a>Configuration precedence<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h3>
<p>Options are applied in the following order (last one wins):</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Defaults
</li>
<li class="listitem">
Arguments to <code class="literal">ElasticAPM.start</code> / <code class="literal">Config.new</code>
</li>
<li class="listitem">
Config file, e.g., <code class="literal">config/elastic_apm.yml</code>
</li>
<li class="listitem">
Environment variables
</li>
<li class="listitem">
<a href="/guide/en/kibana/7.10/agent-configuration.html" class="ulink" target="_top">Central configuration</a>
(supported options are marked with <a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a>)
</li>
</ol>
</div>
<h3><a id="dynamic-configuration"></a>Dynamic configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h3>
<p>Configuration options marked with the <span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> badge can be changed at runtime
when set from a supported source.</p>
<p>The Agent supports <a href="/guide/en/kibana/7.10/agent-configuration.html" class="ulink" target="_top">Central configuration</a>,
which allows you to fine-tune certain configurations via the APM app.
This feature is enabled in the Agent by default, with <a class="xref" href="configuration.html#config-central-config" title="central_config"><code class="literal">central_config</code></a>.</p>
<h3><a id="_ruby_on_rails"></a>Ruby on Rails<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h3>
<p>When using Rails, it&#8217;s possible to specify options inside
<code class="literal">config/application.rb</code>:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby"># config/application.rb
config.elastic_apm.service_name = 'MyApp'</pre>
</div>
<h3><a id="_sinatra_and_rack"></a>Sinatra and Rack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h3>
<p>When using Sinatra and Rack, you can configure when starting
the agent:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby"># config.ru or similar
ElasticAPM.start(
  app: MyApp,
  service_name: 'SomeOtherName'
)</pre>
</div>
<p>Alternatively, you can use the <code class="literal">ElasticAPM::Sinatra.start</code> API:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby"># config.ru or similar
ElasticAPM::Sinatra.start(
  MyApp,
  service_name: 'SomeOtherName'
)</pre>
</div>
<p>See <a class="xref" href="getting-started-rack.html" title="Getting started with Rack">Getting started with Rack</a>.</p>
<h3><a id="_grape_and_rack"></a>Grape and Rack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h3>
<p>When using Grape and Rack (without Rails), you can configure when starting
the agent:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby"># config.ru or similar
ElasticAPM::Grape.start(
  MyApp,
  service_name: 'SomeOtherName'
)</pre>
</div>
<p>See <a class="xref" href="getting-started-rack.html" title="Getting started with Rack">Getting started with Rack</a>.</p>
<h3><a id="_options"></a>Options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h3>
<h4><a id="config-config-file"></a><code class="literal">config_file</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_CONFIG_FILE</code></p></td>
<td align="left" valign="top"><p><code class="literal">config_file</code></p></td>
<td align="left" valign="top"><p><code class="literal">config/elastic_apm.yml</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Path to the configuration YAML-file.
Elastic APM will load config options from this if the file exists.
The file will be evaluated as ERB, so you can include <code class="literal">ENV</code> variables like in
your <code class="literal">database.yml</code>, eg:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">secret_token: &lt;%= ENV['VERY_SECRET_TOKEN'] %&gt;</pre>
</div>
<h4><a id="config-server-url"></a><code class="literal">server_url</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SERVER_URL</code></p></td>
<td align="left" valign="top"><p><code class="literal">server_url</code></p></td>
<td align="left" valign="top"><p><code class="literal">'http://localhost:8200'</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The URL for your APM Server.
The URL must be fully qualified, including protocol (<code class="literal">http</code> or <code class="literal">https</code>)
and port.</p>
<h4><a id="config-secret-token"></a><code class="literal">secret_token</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SECRET_TOKEN</code></p></td>
<td align="left" valign="top"><p><code class="literal">secret_token</code></p></td>
<td align="left" valign="top"><p><code class="literal">nil</code></p></td>
<td align="left" valign="top"><p>A random string</p></td>
</tr>
</tbody>
</table>
</div>
<p>This string is used to ensure that only your agents can send data to your APM server.
Both the agents and the APM server have to be configured with the same secret token.
One example to generate a secure secret token is:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">ruby -r securerandom -e 'print SecureRandom.uuid'</pre>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Secret tokens only provide any real security if your APM server uses TLS.</p>
</div>
</div>
<h4><a id="config-api-key"></a><code class="literal">api_key</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_API_KEY</code></p></td>
<td align="left" valign="top"><p><code class="literal">api_key</code></p></td>
<td align="left" valign="top"><p><code class="literal">nil</code></p></td>
<td align="left" valign="top"><p>A base64-encoded string</p></td>
</tr>
</tbody>
</table>
</div>
<p>This base64-encoded string is used to ensure that only your agents can send data to your APM server.
You must have created the api key using the APM server command line tool. Please see the APM server
documentation for details on how to do that. Please note that this feature is experimental in the
APM server in version 7.6.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Api keys only provide any real security if your APM server uses TLS.</p>
</div>
</div>
<h4><a id="config-active"></a><code class="literal">active</code> <span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">3.7.0</span>]
<span class="Admonishment-detail">
Deprecated in 3.7.0. See <a class="xref" href="configuration.html#config-enabled" title="enabled"><code class="literal">enabled</code></a> instead.
</span>
</span><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_ACTIVE</code></p></td>
<td align="left" valign="top"><p><code class="literal">active</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Whether or not to start the agent.
If <code class="literal">active</code> is <code class="literal">false</code>, <code class="literal">ElasticAPM.start</code> will do nothing and all calls to the root API will return <code class="literal">nil</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This option is being removed. See <a class="xref" href="configuration.html#config-enabled" title="enabled"><code class="literal">enabled</code></a> instead.</p>
</div>
</div>
<h4><a id="config-api-buffer-size"></a><code class="literal">api_buffer_size</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_API_BUFFER_SIZE</code></p></td>
<td align="left" valign="top"><p><code class="literal">api_buffer_size</code></p></td>
<td align="left" valign="top"><p><code class="literal">256</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Maximum amount of objects kept in queue, before sending to APM Server.</p>
<p>If you hit this limit you either have to increase the agent&#8217;s
<a class="xref" href="configuration.html#config-pool-size" title="pool_size">worker pool size</a> or it could mean the agent has trouble
connecting to APM Server. The <a class="xref" href="configuration.html#config-log-path" title="log_path">logs</a> should tell you what
went wrong.</p>
<h4><a id="config-api-request-size"></a><code class="literal">api_request_size</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_API_REQUEST_SIZE</code></p></td>
<td align="left" valign="top"><p><code class="literal">api_request_size</code></p></td>
<td align="left" valign="top"><p><code class="literal">"750kb"</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Maximum amount of bytes sent over one request to APM Server. When reached the agent
will open a new request.</p>
<p>It has to be provided in <span class="strong strong"><strong><a class="xref" href="configuration.html#config-format-size" title="Size format">size format</a></strong></span>.</p>
<h4><a id="config-api-request-time"></a><code class="literal">api_request_time</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_API_REQUEST_TIME</code></p></td>
<td align="left" valign="top"><p><code class="literal">api_request_time</code></p></td>
<td align="left" valign="top"><p><code class="literal">"10s"</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Maximum duration of a single streaming request to APM Server before opening
a new one.</p>
<p>APM Server has its own limit of 30 seconds before it will close requests.</p>
<p>It has to be provided in <span class="strong strong"><strong><a class="xref" href="configuration.html#config-format-duration" title="Duration format">duration format</a></strong></span>.</p>
<h4><a id="config-breakdown-metrics"></a><code class="literal">breakdown-metrics</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_BREAKDOWN_METRICS</code></p></td>
<td align="left" valign="top"><p><code class="literal">breakdown_metrics</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Enable/disable the tracking and collection of breakdown metrics.
By setting this to <code class="literal">False</code>, tracking this metric is completely disabled, which can reduce the overhead of the agent.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature requires APM Server and Kibana &gt;= 7.3.</p>
</div>
</div>
<h4><a id="config-capture-body"></a><code class="literal">capture_body</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
<col class="col_5"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
<td align="left" valign="top"><p>Example</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>For transactions that are HTTP requests,
the Ruby agent can optionally capture the request body (e.g. <code class="literal">POST</code> variables or JSON data).</p>
<p>Possible values: <code class="literal">"errors"</code>, <code class="literal">"transactions"</code>, <code class="literal">"all"</code>, <code class="literal">"off"</code>.</p>
<p>If the request has a body and this setting is disabled, the body will be shown as <code class="literal">[SKIPPED]</code>.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>request bodies often contain sensitive values like passwords, credit card numbers etc.
We try to strip sensitive looking data from form bodies but don&#8217;t touch text bodies like JSON.
If your service handles data like this, we advise to only enable this feature with care.</p>
</div>
</div>
<h4><a id="config-capture-headers"></a><code class="literal">capture_headers</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_CAPTURE_HEADERS</code></p></td>
<td align="left" valign="top"><p><code class="literal">capture_headers</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Whether or not to attach the request headers to transactions and errors.</p>
<h4><a id="config-capture-elasticsearch-queries"></a><code class="literal">capture_elasticsearch_queries</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_CAPTURE_ELASTICSEARCH_QUERIES</code></p></td>
<td align="left" valign="top"><p><code class="literal">capture_elasticsearch_queries</code></p></td>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Whether or not to capture the body from requests in Elasticsearch.</p>
<h4><a id="config-capture-env"></a><code class="literal">capture_env</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_CAPTURE_ENV</code></p></td>
<td align="left" valign="top"><p><code class="literal">capture_env</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Whether or not to attach <code class="literal">ENV</code> from Rack to transactions and errors.</p>
<h4><a id="config-central-config"></a><code class="literal">central_config</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_CENTRAL_CONFIG</code></p></td>
<td align="left" valign="top"><p><code class="literal">central_config</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Enables <a href="/guide/en/kibana/7.10/agent-configuration.html" class="ulink" target="_top">APM Agent Configuration via Kibana</a>.
If set to <code class="literal">true</code>, the client will poll the APM Server regularly for new agent configuration.</p>
<p>Usually APM Server determines how often to poll, but if not the default interval is 5 minutes.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature requires APM Server v7.3 or later and that the APM Server is configured with <code class="literal">kibana.enabled: true</code>.</p>
</div>
</div>
<h4><a id="config-custom-key-filters"></a><code class="literal">custom_key_filters</code> <span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">3.5.0</span>]
<span class="Admonishment-detail">
Deprecated in 3.5.0. See <a class="xref" href="configuration.html#config-sanitize-field-names" title="sanitize_field_names"><code class="literal">sanitize_field_names</code></a> instead.
</span>
</span><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_CUSTOM_KEY_FILTERS</code></p></td>
<td align="left" valign="top"><p><code class="literal">custom_key_filters</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">['MyAuthHeader']</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Elastic APM strips
<a href="https://github.com/elastic/apm-agent-ruby/blob/1.x/lib/elastic_apm/filters/secrets_filter.rb" class="ulink" target="_top">
what looks like confidential information</a> from the request/response headers.
Use this option to add your own custom header keys to the list of filtered keys.</p>
<p>When setting this option via <code class="literal">ENV</code>, use a comma separated string.
Eg. <code class="literal">ELASTIC_APM_CUSTOM_KEY_FILTERS="a,b" # =&gt; [/a/, /b/]</code></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This option is being removed. See <a class="xref" href="configuration.html#config-sanitize-field-names" title="sanitize_field_names"><code class="literal">sanitize_field_names</code></a> instead.</p>
</div>
</div>
<h4><a id="config-default-tags"></a><code class="literal">default_tags</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_DEFAULT_LABELS</code></p></td>
<td align="left" valign="top"><p><code class="literal">default_labels</code></p></td>
<td align="left" valign="top"><p><code class="literal">{}</code></p></td>
<td align="left" valign="top"><p><code class="literal">region=us1</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Add default labels to every transaction. Note that this will eventually be deprecated in favor of <code class="literal">global_labels</code>.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Be aware that labels are indexed in Elasticsearch. Using too many unique keys will result in <span class="strong strong"><strong><a href="/blog/found-crash-elasticsearch#mapping-explosion" class="ulink" target="_top">Mapping explosion</a></strong></span>.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">global_labels</code> are supported as of APM server version 7.2. <code class="literal">default_tags</code> and <code class="literal">default_labels</code> will eventually be
deprecated so please transition to using <code class="literal">global_labels</code> instead. In the meantime, any <code class="literal">default_labels</code>
that are set will override <code class="literal">global_labels</code>.</p>
</div>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_DEFAULT_TAGS</code></p></td>
<td align="left" valign="top"><p><code class="literal">default_tags</code></p></td>
<td align="left" valign="top"><p><code class="literal">{}</code></p></td>
<td align="left" valign="top"><p><code class="literal">region=us1</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Add default tags to add to every transaction. Note that this option has been deprecated in favor of <code class="literal">default_labels</code>.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Be aware that tags are indexed in Elasticsearch. Using too many unique keys will result in <span class="strong strong"><strong><a href="/blog/found-crash-elasticsearch#mapping-explosion" class="ulink" target="_top">Mapping explosion</a></strong></span>.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">global_labels</code> are supported as of APM server version 7.2. <code class="literal">default_tags</code> and <code class="literal">default_labels</code> will eventually be
deprecated so please transition to using <code class="literal">global_labels</code> instead. In the meantime, any <code class="literal">default_tags</code>
that are set will override <code class="literal">global_labels</code>.</p>
</div>
</div>
<h4><a id="config-disable_metrics"></a><code class="literal">disable_metrics</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
<td align="left" valign="top"><p>Example</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_DISABLE_METRICS</code></p></td>
<td align="left" valign="top"><p><code class="literal">disable_metrics</code></p></td>
<td align="left" valign="top"><p>[]</p></td>
<td align="left" valign="top"><p><code class="literal">"*.cpu.*,system.memory.total"</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>A comma-separated list of dotted metrics names that should not be sent to the APM Server.
You can use <code class="literal">*</code> to match multiple metrics.
Matching is case-insensitive.</p>
<h4><a id="config-disable-send"></a><code class="literal">disable_send</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_DISABLE_SEND</code></p></td>
<td align="left" valign="top"><p><code class="literal">disable_send</code></p></td>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Disables sending payloads to APM Server.</p>
<h4><a id="config-disable-start-message"></a><code class="literal">disable_start_message</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_DISABLE_START_MESSAGE</code></p></td>
<td align="left" valign="top"><p><code class="literal">disable_start_message</code></p></td>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Disables the agent&#8217;s startup message announcing itself.</p>
<h4><a id="config-disabled-instrumentations"></a><code class="literal">disable_instrumentations</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_DISABLE_INSTRUMENTATIONS</code></p></td>
<td align="left" valign="top"><p><code class="literal">disable_instrumentations</code></p></td>
<td align="left" valign="top"><p><code class="literal">['json']</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Elastic APM automatically instruments select third party libraries.
Use this option to disable any of these.</p>
<p>Get an array of enabled instrumentations with <code class="literal">ElasticAPM.agent.config.enabled_instrumentations</code>.</p>
<h4><a id="config-enabled"></a><code class="literal">enabled</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_ENABLED</code></p></td>
<td align="left" valign="top"><p><code class="literal">enabled</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Whether or not to start the agent.
If <code class="literal">enabled</code> is <code class="literal">false</code>, <code class="literal">ElasticAPM.start</code> will do nothing and all calls to the root API will return <code class="literal">nil</code>.</p>
<h4><a id="config-environment"></a><code class="literal">environment</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_ENVIRONMENT</code></p></td>
<td align="left" valign="top"><p><code class="literal">environment</code></p></td>
<td align="left" valign="top"><p>From <code class="literal">ENV</code></p></td>
<td align="left" valign="top"><p><code class="literal">"production"</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The name of the environment this service is deployed in,
e.g. "production" or "staging".</p>
<p>Environments allow you to easily filter data on a global level in the APM app.
It&#8217;s important to be consistent when naming environments across agents.
See <a href="/guide/en/kibana/7.10/filters.html#environment-selector" class="ulink" target="_top">environment selector</a> in the APM app for more information.</p>
<p>Defaults to <code class="literal">ENV['RAILS_ENV'] || ENV['RACK_ENV']</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature is fully supported in the APM app in Kibana versions &gt;= 7.2.
You must use the query bar to filter for a specific environment in versions prior to 7.2.</p>
</div>
</div>
<h4><a id="config-filter-exception-types"></a><code class="literal">filter_exception_types</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
<td align="left" valign="top"><p>Example</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>N/A</p></td>
<td align="left" valign="top"><p><code class="literal">filter_exception_types</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">[MyApp::Errors::IgnoredError]</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Use this to filter error tracking for specific error constants.</p>
<h4><a id="config-framework-name"></a><code class="literal">framework_name</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_FRAMEWORK_NAME</code></p></td>
<td align="left" valign="top"><p><code class="literal">framework_name</code></p></td>
<td align="left" valign="top"><p>Depending on framework</p></td>
</tr>
</tbody>
</table>
</div>
<p>Name of the used framework.
For Rails or Sinatra, this defaults to <code class="literal">Ruby on Rails</code> and <code class="literal">Sinatra</code> respectively,
otherwise defaults to <code class="literal">nil</code>.</p>
<h4><a id="config-framework-version"></a><code class="literal">framework_version</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_FRAMEWORK_VERSION</code></p></td>
<td align="left" valign="top"><p><code class="literal">framework_version</code></p></td>
<td align="left" valign="top"><p>Depending on framework</p></td>
</tr>
</tbody>
</table>
</div>
<p>Version number of the used framework.
For Ruby on Rails and Sinatra, this defaults to the used version of the framework,
otherwise, the default is <code class="literal">nil</code>.</p>
<h4><a id="config-global-labels"></a><code class="literal">global_labels</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_GLOBAL_LABELS</code></p></td>
<td align="left" valign="top"><p><code class="literal">global_labels</code></p></td>
<td align="left" valign="top"><p><code class="literal">nil</code></p></td>
<td align="left" valign="top"><p><code class="literal">dept=engineering,rack=number8</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Labels added to all events, with the format key=value[,key=value[,&#8230;&#8203;]].</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This option requires APM Server 7.2 or greater, and will have no effect when using older
server versions. <code class="literal">default_tags</code> will eventually be deprecated but in the meantime, their value
will override any <code class="literal">global_labels</code>. Please transition to using <code class="literal">global_labels</code> instead of
<code class="literal">default_tags</code> in light of this deprecation.</p>
</div>
</div>
<h4><a id="config-hostname"></a><code class="literal">hostname</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_HOSTNAME</code></p></td>
<td align="left" valign="top"><p><code class="literal">hostname</code></p></td>
<td align="left" valign="top"><p><code class="literal">hostname</code></p></td>
<td align="left" valign="top"><p><code class="literal">app-server01.example.com</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The host name to use when sending error and transaction data to the APM server.</p>
<h4><a id="config-custom-ignore-url-patterns"></a><code class="literal">ignore_url_patterns</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_IGNORE_URL_PATTERNS</code></p></td>
<td align="left" valign="top"><p><code class="literal">ignore_url_patterns</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">['^/ping', %r{^/admin}]</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Use this option to ignore certain URL patterns eg. healthchecks or admin sections.</p>
<p><em>Ignoring</em> in this context means <em>don&#8217;t wrap in a <a class="xref" href="api.html#api-transaction" title="Transaction">Transaction</a></em>.
Errors will still be reported.</p>
<p>When setting this option via <code class="literal">ENV</code>, use a comma separated string.
Eg. <code class="literal">ELASTIC_APM_IGNORE_URL_PATTERNS="a,b" # =&gt; [/a/, /b/]</code></p>
<h4><a id="config-instrument"></a><code class="literal">instrument</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_INSTRUMENT</code></p></td>
<td align="left" valign="top"><p><code class="literal">instrument</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p><code class="literal">0</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Use this option to ignore certain URL patterns eg. healthchecks or admin sections.</p>
<h4><a id="config-instrumented-rake-tasks"></a><code class="literal">instrumented_rake_tasks</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_INSTRUMENTED_RAKE_TASKS</code></p></td>
<td align="left" valign="top"><p><code class="literal">instrumented_rake_tasks</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">['my_task']</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Elastic APM can instrument your Rake tasks but given that they are used for a multitude of sometimes very different and not always relevant things, this is opt in.</p>
<h4><a id="config-log-level"></a><code class="literal">log_level</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_LOG_LEVEL</code></p></td>
<td align="left" valign="top"><p><code class="literal">log_level</code></p></td>
<td align="left" valign="top"><p><code class="literal">Logger::INFO # =&gt; 1</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>By default Elastic APM logs to <code class="literal">stdout</code> or uses <code class="literal">Rails.log</code> when used with Rails.</p>
<h4><a id="config-log-path"></a><code class="literal">log_path</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_LOG_PATH</code></p></td>
<td align="left" valign="top"><p><code class="literal">log_path</code></p></td>
<td align="left" valign="top"><p><code class="literal">nil</code></p></td>
<td align="left" valign="top"><p><code class="literal">log/elastic_apm.log</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>A path to a log file.</p>
<p>By default Elastic APM logs to <code class="literal">stdout</code> or uses <code class="literal">Rails.log</code> when used with Rails.</p>
<p>Should support both absolute and relative paths. Just make sure the directory exists.</p>
<h4><a id="config-logger"></a><code class="literal">logger</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>N/A</p></td>
<td align="left" valign="top"><p><code class="literal">logger</code></p></td>
<td align="left" valign="top"><p>Depends</p></td>
<td align="left" valign="top"><p><code class="literal">Logger.new('path/to_file.log')</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>By default Elastic APM logs to <code class="literal">stdout</code> or uses <code class="literal">Rails.log</code> when used with Rails.</p>
<p>Use this to provide another logger. Expected to have the same API as Ruby&#8217;s built-in <code class="literal">Logger</code>.</p>
<h4><a id="config-metrics-interval"></a><code class="literal">metrics_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_METRICS_INTERVAL</code></p></td>
<td align="left" valign="top"><p><code class="literal">metrics_interval</code></p></td>
<td align="left" valign="top"><p><code class="literal">'30s'</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Specify the interval for reporting metrics to APM Server.
The interval should be in seconds,
or should include a time suffix.</p>
<p>To disable metrics reporting,
set the interval to <code class="literal">0</code>.</p>
<h4><a id="config-pool-size"></a><code class="literal">pool_size</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_POOL_SIZE</code></p></td>
<td align="left" valign="top"><p><code class="literal">pool_size</code></p></td>
<td align="left" valign="top"><p><code class="literal">1</code></p></td>
<td align="left" valign="top"><p><code class="literal">2</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Elastic APM uses a thread pool to send its data to APM Server.</p>
<p>This makes sure the agent doesn&#8217;t block the main thread any more than necessary.</p>
<p>If you have high load and get warnings about the buffer being full, increasing
the worker pool size might help.</p>
<h4><a id="config-proxy-address"></a><code class="literal">proxy_address</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_PROXY_ADDRESS</code></p></td>
<td align="left" valign="top"><p><code class="literal">proxy_address</code></p></td>
<td align="left" valign="top"><p><code class="literal">nil</code></p></td>
<td align="left" valign="top"><p><code class="literal">"example.com"</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>An address to use as a proxy for the HTTP client.</p>
<p>Options available are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">proxy_address</code>
</li>
<li class="listitem">
<code class="literal">proxy_headers</code>
</li>
<li class="listitem">
<code class="literal">proxy_password</code>
</li>
<li class="listitem">
<code class="literal">proxy_port</code>
</li>
<li class="listitem">
<code class="literal">proxy_username</code>
</li>
</ul>
</div>
<p>There are also <code class="literal">ENV</code> version of these following the same pattern of putting <code class="literal">ELASTIC_APM_</code> in front.</p>
<p>See <a href="https://github.com/httprb/http/wiki/Proxy-Support" class="ulink" target="_top">Http.rb&#8217;s docs</a>.</p>
<h4><a id="config-recording"></a><code class="literal">recording</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_RECORDING</code></p></td>
<td align="left" valign="top"><p><code class="literal">recording</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Enable or disable the recording of events.
If set to false, then the agent does not create or send any events to the Elastic APM server,
and instrumentation overhead is minimized. The agent continues to poll the server for configuration changes
when this option is false.</p>
<h4><a id="config-sanitize-field-names"></a><code class="literal">sanitize_field_names</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SANITIZE_FIELD_NAMES</code></p></td>
<td align="left" valign="top"><p><code class="literal">sanitize_field_names</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">Auth*tion,abc*,*xyz</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Sometimes it is necessary to sanitize the data sent to Elastic APM, e.g. remove sensitive data.</p>
<p>Configure a list of wildcard patterns of field names which should be sanitized. These apply to HTTP headers and bodies (if you&#8217;re capturing those.)</p>
<p>Supports the wildcard <code class="literal">*</code>, which matches zero or more characters.
Examples: <code class="literal">/foo/*/bar/*/baz*</code>, <code class="literal">*foo*</code>.
Matching is case insensitive.</p>
<h4><a id="config-service-name"></a><code class="literal">service_name</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SERVICE_NAME</code></p></td>
<td align="left" valign="top"><p><code class="literal">service_name</code></p></td>
<td align="left" valign="top"><p>App&#8217;s name</p></td>
<td align="left" valign="top"><p><code class="literal">MyApp</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The name of your service.
This is used to keep all the errors and transactions of your service together and is
the primary filter in the Elastic APM user interface.</p>
<p>If you&#8217;re using Ruby on Rails this will default to your app&#8217;s name.
If you&#8217;re using Sinatra it will default to the name of your app&#8217;s class.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The service name must conform to this regular expression: <code class="literal">^[a-zA-Z0-9 _-]+$</code>.
In layman&#8217;s terms: Your service name must only contain characters from the ASCII
alphabet, numbers, dashes, underscores and spaces.</p>
</div>
</div>
<h4><a id="config-service-node-name"></a><code class="literal">service_node_name</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<pre class="literallayout">[options="header"]</pre>

<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
<td align="left" valign="top"><p>Example</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SERVICE_NODE_NAME</code></p></td>
<td align="left" valign="top"><p><code class="literal">service_node_name</code></p></td>
<td align="left" valign="top"><p><code class="literal">nil</code></p></td>
<td align="left" valign="top"><p><code class="literal">"my-app-1"</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The name of the given service node. This is optional, and if omitted, the APM
Server will fall back on <code class="literal">system.container.id</code> if available, and finally
<code class="literal">host.name</code> if necessary.</p>
<p>This option allows you to set the node name manually to ensure uniqueness and
meaningfulness.</p>
<h4><a id="config-service-version"></a><code class="literal">service_version</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SERVICE_VERSION</code></p></td>
<td align="left" valign="top"><p><code class="literal">service_version</code></p></td>
<td align="left" valign="top"><p><code class="literal">git</code> sha</p></td>
<td align="left" valign="top"><p>A string indicating the version of the deployed service</p></td>
</tr>
</tbody>
</table>
</div>
<p>Deployed version of your service.
Defaults to <code class="literal">git rev-parse --verify HEAD</code>.</p>
<h4><a id="config-source-lines-error-app-frames"></a><code class="literal">source_lines_error_app_frames</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<h4><a id="config-source-lines-error-library-frames"></a><code class="literal">source_lines_error_library_frames</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<h4><a id="config-source-lines-span-app-frames"></a><code class="literal">source_lines_span_app_frames</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<h4><a id="config-source-lines-span-library-frames"></a><code class="literal">source_lines_span_library_frames</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SOURCE_LINES_ERROR_APP_FRAMES</code></p></td>
<td align="left" valign="top"><p><code class="literal">source_lines_error_app_frames</code></p></td>
<td align="left" valign="top"><p><code class="literal">5</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SOURCE_LINES_ERROR_LIBRARY_FRAMES</code></p></td>
<td align="left" valign="top"><p><code class="literal">source_lines_error_library_frames</code></p></td>
<td align="left" valign="top"><p><code class="literal">5</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SOURCE_LINES_SPAN_APP_FRAMES</code></p></td>
<td align="left" valign="top"><p><code class="literal">source_lines_span_app_frames</code></p></td>
<td align="left" valign="top"><p><code class="literal">0</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SOURCE_LINES_SPAN_LIBRARY_FRAMES</code></p></td>
<td align="left" valign="top"><p><code class="literal">source_lines_span_library_frames</code></p></td>
<td align="left" valign="top"><p><code class="literal">0</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>By default, the APM agent collects source code snippets for errors.
With the above settings, you can modify how many lines of source code is collected.</p>
<p>We differ between errors and spans, as well as library frames and app frames.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Especially for spans, collecting source code can have a large impact on
storage use in your Elasticsearch cluster.</p>
</div>
</div>
<h4><a id="config-span-frames-min-duration-ms"></a><code class="literal">span_frames_min_duration</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SPAN_FRAMES_MIN_DURATION</code></p></td>
<td align="left" valign="top"><p><code class="literal">span_frames_min_duration</code></p></td>
<td align="left" valign="top"><p><code class="literal">"5ms"</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Use this to disable stacktrace frame collection for spans with a duration shorter
than or equal to the given amount of milleseconds.</p>
<p>The default is <code class="literal">"5ms"</code>.</p>
<p>Set it to <code class="literal">-1</code> to collect stack traces for all spans.
Set it to <code class="literal">0</code> to disable stack trace collection for all spans.</p>
<p>It has to be provided in <span class="strong strong"><strong><a class="xref" href="configuration.html#config-format-duration" title="Duration format">duration format</a></strong></span>.</p>
<h4><a id="config-ssl-ca-cert"></a><code class="literal">server_ca_cert</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_SERVER_CA_CERT</code></p></td>
<td align="left" valign="top"><p><code class="literal">server_ca_cert</code></p></td>
<td align="left" valign="top"><p><code class="literal">nil</code></p></td>
<td align="left" valign="top"><p><code class="literal">'/path/to/ca.pem'</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The path to a custom CA certificate for connecting to APM Server.</p>
<h4><a id="config-stack-trace-limit"></a><code class="literal">stack_trace_limit</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment</th>
<th align="left" valign="top"><code class="literal">Config</code> key</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_STACK_TRACE_LIMIT</code></p></td>
<td align="left" valign="top"><p><code class="literal">stack_trace_limit</code></p></td>
<td align="left" valign="top"><p><code class="literal">999999</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The maximum number of stack trace lines per span/error.</p>
<h4><a id="config-transaction-max-spans"></a><code class="literal">transaction_max_spans</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_TRANSACTION_MAX_SPANS</code></p></td>
<td align="left" valign="top"><p><code class="literal">transaction_max_spans</code></p></td>
<td align="left" valign="top"><p><code class="literal">500</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Limits the amount of spans that are recorded per transaction.
This is helpful in cases where a transaction creates a very high amount of spans
(e.g. thousands of SQL queries).
Setting an upper limit will prevent overloading the agent and the APM server with
too much work for such edge cases.</p>
<h4><a id="config-transaction-sample-rate"></a><code class="literal">transaction_sample_rate</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p><a class="xref" href="configuration.html#dynamic-configuration" title="Dynamic configuration"><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span> </a></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_TRANSACTION_SAMPLE_RATE</code></p></td>
<td align="left" valign="top"><p><code class="literal">transaction_sample_rate</code></p></td>
<td align="left" valign="top"><p><code class="literal">1.0</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>By default, the agent will sample every transaction (e.g. request to your service).
To reduce overhead and storage requirements, you can set the sample rate to a value
between <code class="literal">0.0</code> and <code class="literal">1.0</code>.
We still record overall time and the result for unsampled transactions, but no
context information, tags, or spans.
Note that the sample rate will be rounded to 4 digits of precision.</p>
<h4><a id="config-use-experimental-sql-parser"></a><code class="literal">use_legacy_sql_parser</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_USE_LEGACY_SQL_PARSER</code></p></td>
<td align="left" valign="top"><p><code class="literal">use_legacy_sql_parser</code></p></td>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>Use the older, less precise approach to generating summaries of your app&#8217;s SQL statements.
Try this if you&#8217;re experiencing trouble using the new default.</p>
<h4><a id="config-verify-server-cert"></a><code class="literal">verify_server_cert</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment</p></td>
<td align="left" valign="top"><p><code class="literal">Config</code> key</p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_VERIFY_SERVER_CERT</code></p></td>
<td align="left" valign="top"><p><code class="literal">verify_server_cert</code></p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>By default, the agent verifies the SSL certificate if you use an HTTPS connection to
the APM server.
Verification can be disabled by changing this setting to <code class="literal">false</code>.</p>
<h3><a id="config-formats"></a>Configuration formats<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h3>
<p>Some options require a unit, either duration or size.
These need to be provided in a specific format.</p>
<h4><a id="config-format-duration"></a>Duration format<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p>The <em>duration</em> format is used for options like timeouts.
The unit is provided as suffix directly after the number, without any separation by whitespace.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">"5ms"</code></p>
<p><span class="strong strong"><strong>Supported units</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ms</code> (milliseconds)
</li>
<li class="listitem">
<code class="literal">s</code> (seconds)
</li>
<li class="listitem">
<code class="literal">m</code> (minutes)
</li>
</ul>
</div>
<h4><a id="config-format-size"></a>Size format<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h4>
<p>The <em>size</em> format is used for options like maximum buffer sizes.
The unit is provided as suffix directly after the number, without any separation by whitespace.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">10kb</code></p>
<p><span class="strong strong"><strong>Supported units</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">b</code> (bytes)
</li>
<li class="listitem">
<code class="literal">kb</code> (kilobytes)
</li>
<li class="listitem">
<code class="literal">mb</code> (megabytes)
</li>
<li class="listitem">
<code class="literal">gb</code> (gigabytes)
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>we use the power-of-two sizing convention, e.g. <code class="literal">1 kilobyte == 1024 bytes</code></p>
</div>
</div>
<h3><a id="special-configuration"></a>Special configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/3.x/docs/configuration.asciidoc">edit</a></h3>
<p>Elastic APM patches <code class="literal">Kernel#require</code> to auto-detect and instrument supported third party libraries. It does so with the utmost care but in rare cases it can conflict with some libraries.</p>
<p>To get around this patch, set the environment variable <code class="literal">ELASTIC_APM_SKIP_REQUIRE_PATCH</code> to <code class="literal">"1"</code>.</p>
<p>If you choose to do so, the agent might need some additional tweaking to make sure the third party libraries are picked up and instrumented. Make sure you require the agent <em>after</em> you require your other dependencies.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="supported-technologies.html">« Supported technologies</a>
</span>
<span class="next">
<a href="advanced.html">Advanced Topics »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
