<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Ruby Agent version 4.x | APM Ruby Agent Reference [master] | Elastic</title>
<meta class="elastic" name="content" content="Ruby Agent version 4.x | APM Ruby Agent Reference [master]">

<link rel="home" href="index.html" title="APM Ruby Agent Reference [master]"/>
<link rel="up" href="release-notes.html" title="Release notes"/>
<link rel="prev" href="release-notes.html" title="Release notes"/>
<link rel="next" href="release-notes-3.x.html" title="Ruby Agent version 3.x"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Ruby Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
    <div class="related-products-title">APM:</div>
    <div class="dropdown-anchor" tabindex="0">Ruby Agent Reference<span class="dropdown-icon"></span></div>
    <div class="dropdown-content">
      <ul>
        <li class="dropdown-category">APM</li>
        <ul>
          <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
        </ul>
        <li class="dropdown-category">APM agents</li>
        <ul>
          <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
        </ul>
        <li class="dropdown-category">APM extensions</li>
        <ul>
          <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
          <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
        </ul>
      </ul>
    </div>
  </div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="release-notes.html">Release notes</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-3.x.html">Ruby Agent version 3.x »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="release-notes-4.x"></a>Ruby Agent version 4.x<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.6.1"></a>4.6.1<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_fixed"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix growing number of open file descriptors when HTTP request to APM is never sent <a href="https://github.com/elastic/apm-agent-ruby/pull/1351" class="ulink" target="_top">#1351</a>
</li>
<li class="listitem">
Fix setting span http status code when Faraday Middleware is used <a href="https://github.com/elastic/apm-agent-ruby/pull/1368" class="ulink" target="_top">#1368</a>
</li>
<li class="listitem">
Handle whitespace when splitting tracestate entries <a href="https://github.com/elastic/apm-agent-ruby/pull/1353" class="ulink" target="_top">#1353</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.6.0"></a>4.6.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_added"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added transaction_name to reported error to allow grouping by transaction name <a href="https://github.com/elastic/apm-agent-ruby/pull/1267" class="ulink" target="_top">#1267</a>
</li>
<li class="listitem">
Added ability to query server for version (useful in the future) <a href="https://github.com/elastic/apm-agent-ruby/pull/1278" class="ulink" target="_top">#1278</a>
</li>
<li class="listitem">
Added instrumentation for <a href="https://github.com/zendesk/racecar/" class="ulink" target="_top">https://github.com/zendesk/racecar/</a> Racecar Kafka library <a href="https://github.com/elastic/apm-agent-ruby/pull/1284" class="ulink" target="_top">#1284</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_changed"></a>Changed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Expanded filtering to sanitize any key that contains the string <em>auth</em> <a href="https://github.com/elastic/apm-agent-ruby/pull/1266" class="ulink" target="_top">#1266</a>
</li>
<li class="listitem">
Rename <code class="literal">log_ecs_formatting</code> option to <code class="literal">log_ecs_reformatting</code>, deprecate old option name <a href="https://github.com/elastic/apm-agent-ruby/pull/1248" class="ulink" target="_top">#1248</a>
</li>
<li class="listitem">
When the configuration value for <code class="literal">log_path</code> is set, override the <code class="literal">logger</code> to point to that path instead of using e.g. Rails logger <a href="https://github.com/elastic/apm-agent-ruby/pull/1247" class="ulink" target="_top">#1247</a>
</li>
<li class="listitem">
Only send tracestate header for distributed tracing when it has content <a href="https://github.com/elastic/apm-agent-ruby/pull/1277" class="ulink" target="_top">#1277</a>
</li>
<li class="listitem">
Use the hostname as the Kubernetes pod name in the Container Info metadata if the pod id is parsed from cgroup <a href="https://github.com/elastic/apm-agent-ruby/pull/1314" class="ulink" target="_top">#1314</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_fixed_2"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Small change to Sidekiq tests to handle new configuration passing method <a href="https://github.com/elastic/apm-agent-ruby/pull/1283" class="ulink" target="_top">#1283</a>
</li>
<li class="listitem">
Set transaction sample rate to 0 when it&#8217;s unsampled <a href="https://github.com/elastic/apm-agent-ruby/pull/1339" class="ulink" target="_top">#1339</a>
</li>
<li class="listitem">
Don&#8217;t send unsampled transactions to APM server &gt;= 8.0 <a href="https://github.com/elastic/apm-agent-ruby/pull/1341" class="ulink" target="_top">#1341</a>
</li>
</ul>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.5.1"></a>4.5.1<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_changed_2"></a>Changed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update elasticsearch spy to use new transport gem name <a href="https://github.com/elastic/apm-agent-ruby/pull/1257" class="ulink" target="_top">#1257</a>
</li>
<li class="listitem">
Standardize placeholder for phone numbers as [PHONENUMBER] per <a href="https://github.com/elastic/apm/blob/main/specs/agents/tracing-instrumentation-aws.md" class="ulink" target="_top">https://github.com/elastic/apm/blob/main/specs/agents/tracing-instrumentation-aws.md</a> <a href="https://github.com/elastic/apm-agent-ruby/pull/1246" class="ulink" target="_top">#1246</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_fixed_3"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixed dependencies to allow CI to build successfully <a href="https://github.com/elastic/apm-agent-ruby/pull/1259" class="ulink" target="_top">#1259</a>
</li>
<li class="listitem">
Fixed warnings related to TimeTask timeouts <a href="https://github.com/elastic/apm-agent-ruby/pull/1255" class="ulink" target="_top">#1255</a>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.5.0"></a>4.5.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_changed_3"></a>Changed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Stop collecting the field <code class="literal">http.request.socket.encrypted</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/1181" class="ulink" target="_top">#1181</a>
</li>
</ul>
</div>
<h5><a id="_fixed_4"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixed MongoDB spy thread safety <a href="https://github.com/elastic/apm-agent-ruby/pull/1202" class="ulink" target="_top">#1202</a>
</li>
<li class="listitem">
Fixed span context fields for DynamoDB instrumentation <a href="https://github.com/elastic/apm-agent-ruby/pull/1178" class="ulink" target="_top">#1178</a>
</li>
<li class="listitem">
Fixed span context fields for S3 instrumentation <a href="https://github.com/elastic/apm-agent-ruby/pull/1179" class="ulink" target="_top">#1179</a>
</li>
<li class="listitem">
Update user agent info to match spec <a href="https://github.com/elastic/apm-agent-ruby/pull/1182" class="ulink" target="_top">#1182</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.4.0"></a>4.4.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_added_2"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Optional span to be ended instead of current span <a href="https://github.com/elastic/apm-agent-ruby/pull/1039" class="ulink" target="_top">#1039</a>
</li>
<li class="listitem">
Config option <code class="literal">log_ecs_formatting</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/1053" class="ulink" target="_top">#1053</a>
</li>
</ul>
</div>
<h5><a id="_fixed_5"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixed detecting Linux on Alpine for CPU/MEM metrics <a href="https://github.com/elastic/apm-agent-ruby/pull/1057" class="ulink" target="_top">#1057</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.3.0"></a>4.3.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_added_3"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add JVM memory metrics <a href="https://github.com/elastic/apm-agent-ruby/pull/1040" class="ulink" target="_top">#1040</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.2.0"></a>4.2.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_added_4"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add support for AWS Storage Table/CosmosDB <a href="https://github.com/elastic/apm-agent-ruby/pull/999" class="ulink" target="_top">#999</a>
</li>
</ul>
</div>
<h5><a id="_fixed_6"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Align HTTP span types/subtypes with spec <a href="https://github.com/elastic/apm-agent-ruby/pull/1014" class="ulink" target="_top">#1014</a>
</li>
<li class="listitem">
Passing a full URL as a path to <code class="literal">Net::HTTP</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/1029" class="ulink" target="_top">#1029</a>
</li>
<li class="listitem">
Fix growing number of open file descriptors <a href="https://github.com/elastic/apm-agent-ruby/pull/1033" class="ulink" target="_top">#1033</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.1.0"></a>4.1.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_added_5"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Azure App Services instance metadata <a href="https://github.com/elastic/apm-agent-ruby/pull/1007" class="ulink" target="_top">#1007</a>
</li>
</ul>
</div>
<h5><a id="_changed_4"></a>Changed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">hostname</code> is now reported split by <code class="literal">configured_hostname</code> and <code class="literal">detected_hostname</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/1009" class="ulink" target="_top">#1009</a>
</li>
</ul>
</div>
<h5><a id="_fixed_7"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">service_node_name</code> is now correctly reported as <code class="literal">service.node.configured_name</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/1009" class="ulink" target="_top">#1009</a>
</li>
<li class="listitem">
Fix JSON parsing when using yajl-ruby <a href="https://github.com/elastic/apm-agent-ruby/pull/1012" class="ulink" target="_top">#1012</a>
</li>
<li class="listitem">
Fix SpanHelpers when methods take blocks <a href="https://github.com/elastic/apm-agent-ruby/pull/1013" class="ulink" target="_top">#1013</a>
</li>
<li class="listitem">
Fix missing <code class="literal">environment</code> param when fetching from Central Config <a href="https://github.com/elastic/apm-agent-ruby/pull/1014" class="ulink" target="_top">#1014</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.0.0"></a>4.0.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_upgrading"></a>Upgrading<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<p>Be aware that this release changes the agent&#8217;s general approach to instrumenting third
party libraries.
It now uses <code class="literal">Module#prepend</code> over alias method chaining.</p>
<p>This doesn&#8217;t necessarily impact your application but it could if you are using other gems
that use the old approach to patch the same method.
Mixing the two approaches can lead to infinite recursion.</p>
<h5><a id="_removed"></a>Removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Removed support for Ruby 2.3 and JRuby 9.1 <a href="https://github.com/elastic/apm-agent-ruby/pull/901" class="ulink" target="_top">#901</a>
</li>
<li class="listitem">
Config option <code class="literal">active</code>, see <code class="literal">enabled</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">custom_key_filters</code>, see <code class="literal">sanitize_field_names</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">default_tags</code>, see <code class="literal">global_labels</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">default_labels</code>, see <code class="literal">global_labels</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">ignore_url_patterns</code>, see <code class="literal">transaction_ignore_urls</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">use_legacy_sql_parser</code>, legacy parser no longer included <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
</ul>
</div>
<h5><a id="_changed_5"></a>Changed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Integrations (Spies) use Module#prepend over class_eval <a href="https://github.com/elastic/apm-agent-ruby/pull/890" class="ulink" target="_top">#890</a>
</li>
<li class="listitem">
The secrets filter no longer filters based on values, see <code class="literal">sanitize_field_names</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
The secrets filter is aligned with other agents, see <code class="literal">sanitize_field_names</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
</ul>
</div>
<h5><a id="_added_6"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added <code class="literal">set_service</code> API <a href="https://github.com/elastic/apm-agent-ruby/pull/1006" class="ulink" target="_top">#1006</a>
</li>
</ul>
</div>
<h5><a id="_fixed_8"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
AWS S3 spy accepts symbol bucket names <a href="https://github.com/elastic/apm-agent-ruby/pull/998" class="ulink" target="_top">#998</a>
</li>
<li class="listitem">
AWS S3 spy passing on blocks <a href="https://github.com/elastic/apm-agent-ruby/pull/998" class="ulink" target="_top">#998</a>
</li>
<li class="listitem">
SQL scanner now recognizes CQL style comments <a href="https://github.com/elastic/apm-agent-ruby/pull/1004" class="ulink" target="_top">#1004</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-3.x.html">Ruby Agent version 3.x »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
