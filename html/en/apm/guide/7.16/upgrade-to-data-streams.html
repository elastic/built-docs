<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Upgrade to data streams | APM User Guide [7.16] | Elastic</title>
<meta class="elastic" name="content" content="Upgrade to data streams | APM User Guide [7.16]">

<link rel="home" href="index.html" title="APM User Guide [7.16]"/>
<link rel="up" href="upgrade.html" title="Upgrade"/>
<link rel="prev" href="apm-breaking.html" title="Breaking Changes"/>
<link rel="next" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration"/>
<meta class="elastic" name="product_version" content="7.16"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/7.16"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="7.16"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="apm-breaking.html">« Breaking Changes</a>
</span>
<span class="next">
<a href="upgrade-to-apm-integration.html">Switch to the Elastic APM integration »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="upgrade.html">Upgrade</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Upgrade to data streams</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="upgrade-to-data-streams"></a>Upgrade to data streams</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#why-upgrade-to-data-streams" title="Why upgrade?">Why upgrade?</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#considerations-data-streams" title="Data streams considerations">Data streams considerations</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-steps" title="Upgrade a self-managed APM Server">Upgrade a self-managed APM Server</a>
</li>
</ul>
</div>
<p>Classic indices are deprecated starting in version 7.16.0.
Users that are not ready to <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">Switch to the Elastic APM integration</a> should
upgrade to data streams in the meantime.</p>
<div class="position-relative"><h3><a id="why-upgrade-to-data-streams"></a>Why upgrade?</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
<p>Data streams offer a number of benefits over classic indices:</p>
<p><span class="strong strong"><strong>Data streams</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Reduced number of fields per index, better space efficiency, and faster queries
</li>
<li class="listitem">
More granular data control
</li>
<li class="listitem">
Errors and metrics data streams are shared with other data sources&#8201;&#8212;&#8201;which means better long-term integration with the logs and metrics apps
</li>
<li class="listitem">
Removes template inheritance for ILM policies and makes use of new Elasticsearch index and component templates
</li>
<li class="listitem">
Fixes <a class="xref" href="common-problems.html#server-resource-exists-not-alias" title="resource 'apm-7.16.3-$type' exists, but it is not an alias"><code class="literal">resource 'apm-7.16.3-$type' exists, but it is not an alias</code></a>
</li>
</ul>
</div>
<div class="position-relative"><h3><a id="considerations-data-streams"></a>Data streams considerations</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Users on Elastic Cloud Enterprise require additional steps prior to migrating, like configuring TLS certificates for the connection between APM Server and Elasticsearch
</li>
<li class="listitem">
RUM sourcemaps are not working with data streams in 7.16&#8201;&#8212;&#8201;this will be fixed in 8.0
</li>
</ul>
</div>
<div class="position-relative"><h3><a id="apm-data-streams-upgrade-steps"></a>Upgrade a self-managed APM Server</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-1" title="Upgrade the Elastic Stack">Upgrade the Elastic Stack</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-2" title="Add the APM integration">Add the APM integration</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-3" title="Configure APM Server to use data streams">Configure APM Server to use data streams</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-4" title="Configure resources">Configure resources</a>
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="apm-data-streams-upgrade-1"></a>Upgrade the Elastic Stack</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
<p>The Elastic Stack (Elasticsearch and Kibana) must be upgraded prior to APM Server.
See the <a href="/guide/en/elastic-stack/7.16/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a> for guidance.</p>
<p>Review the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a>,
and Observability <a href="/guide/en/observability/7.16/whats-new.html" class="ulink" target="_top">What&#8217;s new</a> content for important changes between
your current APM version and this one.</p>
<div class="position-relative"><h4><a id="apm-data-streams-upgrade-2"></a>Add the APM integration</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
<p>Before enabling data streams in APM Server, the APM integration must be added to your cluster.
This enables Fleet to set up ingest templates, ILM policies,
and ingest pipelines when APM Server tries to connect.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, navigate to <span class="strong strong"><strong>Management</strong></span> &gt; <span class="strong strong"><strong>Fleet</strong></span>.
First time? The page may take a few minutes to load.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Agent policies</strong></span> &gt; <span class="strong strong"><strong>Default policy</strong></span> and click <span class="strong strong"><strong>Add integration</strong></span>.
</li>
<li class="listitem">
Search for and select <span class="strong strong"><strong>Elastic APM</strong></span>. Under step one, select <span class="strong strong"><strong>APM integration</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic APM</strong></span>. Configuring the integration is not required as we&#8217;re only using the integration to set up Elasticsearch resources. Click <span class="strong strong"><strong>Save and Continue</strong></span> and then <span class="strong strong"><strong>Add Elastic Agent later</strong></span> (you don&#8217;t need to add an Elastic Agent later).
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="apm-data-streams-upgrade-3"></a>Configure APM Server to use data streams</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Stop APM Server and set <a class="xref" href="configuration-process.html#_configuration_options_data_streams" title="Configuration options: data_streams"><code class="literal">data_streams.enabled: true</code></a> in apm-server.yml:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apm-server:
  data_streams.enabled: true</pre>
</div>
</li>
<li class="listitem">
<a class="xref" href="apm-server-starting.html" title="Step 3: Start">Restart APM Server</a>.
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="apm-data-streams-upgrade-4"></a>Configure resources</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/apm-server/upgrading-to-datastreams.asciidoc">edit</a></div>
<p>Need to customize anything?</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
See <a class="xref" href="ilm-how-to.html" title="Index lifecycle management">Index lifecycle management</a> to learn about the new default Index lifecycle management (ILM) policies applied to data streams and how to customize them.
</li>
<li class="listitem">
See <a class="xref" href="ingest-pipelines.html" title="Parse data using ingest pipelines">Parse data using ingest pipelines</a> for more information on how to edit or view ingest pipelines.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="apm-breaking.html">« Breaking Changes</a>
</span>
<span class="next">
<a href="upgrade-to-apm-integration.html">Switch to the Elastic APM integration »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
