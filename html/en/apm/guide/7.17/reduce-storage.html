<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Reduce storage | APM User Guide [7.17] | Elastic</title>
<meta class="elastic" name="content" content="Reduce storage | APM User Guide [7.17]">

<link rel="home" href="index.html" title="APM User Guide [7.17]"/>
<link rel="up" href="storage-management.html" title="Storage Management"/>
<link rel="prev" href="processing-performance.html" title="Processing and performance"/>
<link rel="next" href="manage-indices-kibana.html" title="Manage Indices via Kibana"/>
<meta class="elastic" name="product_version" content="7.17"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/7.17"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="7.17"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="overview.html">Legacy APM Server Reference</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="howto-guides.html">How-to guides</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="storage-management.html">Storage Management</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="processing-performance.html">« Processing and performance</a>
</span>
<span class="next">
<a href="manage-indices-kibana.html">Manage Indices via Kibana »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="reduce-storage"></a>Reduce storage<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This documentation refers to the standalone (legacy) method of running APM Server. This method of running APM Server will be deprecated and removed in a future release. Please consider <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">upgrading to the Elastic APM integration</a>.
If you&#8217;ve already upgraded, please see <a class="xref" href="reduce-apm-storage.html" title="Reduce storage">Reduce storage</a> instead.</p>
</div>
</div>
<p>The amount of storage for APM data depends on several factors:
the number of services you are instrumenting, how much traffic the services see, agent and server settings,
and the length of time you store your data.</p>
<h5><a id="reduce-sample-rate"></a>Reduce the sample rate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h5>
<p>The transaction sample rate directly influences the number of documents (more precisely, spans) to be indexed.
It is the easiest way to reduce storage.</p>
<p>The transaction sample rate is a configuration setting of each agent.
Reducing it does not affect the collection of metrics such as <em>Transactions per second</em>.</p>
<h5><a id="reduce-stacktrace"></a>Reduce collected stacktrace information<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h5>
<p>Elastic APM agents collect <code class="literal">stacktrace</code> information under certain circumstances.
This can be very helpful in identifying issues in your code,
but it also comes with an overhead at collection time and increases the storage usage.</p>
<p>Stacktrace collection settings are managed in each agent.</p>
<h5><a id="delete-data"></a>Delete data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h5>
<p>You might want to only keep data for a defined time period.
This might mean deleting old documents periodically,
deleting data collected for specific services or customers,
or deleting specific indices.</p>
<p>Depending on your use case,
you can delete data periodically with <a class="xref" href="reduce-storage.html#delete-data-ilm" title="Delete data with ILM">index lifecycle management</a>,
<a href="/guide/en/elasticsearch/client/curator/current" class="ulink" target="_top">Curator</a>, the <a href="/guide/en/elasticsearch/reference/7.17/docs-delete-by-query.html" class="ulink" target="_top">Delete By Query API</a>,
or in the <a href="/guide/en/kibana/7.17/managing-indices.html" class="ulink" target="_top">Kibana Index Management UI</a>.</p>
<h6><a id="delete-data-ilm"></a>Delete data with ILM<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h6>
<p>Index Lifecycle management (ILM) enables you to automate how you want to manage your indices over time.
You can base actions on factors such as shard size and performance requirements.
See <a class="xref" href="ilm.html" title="Custom index lifecycle management with APM Server">Customize index lifecycle management</a> to learn more.</p>
<h6><a id="delete-data-periodically"></a>Delete data periodically<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h6>
<p>To delete data periodically you can use <a href="/guide/en/elasticsearch/client/curator/current" class="ulink" target="_top">Curator</a> and set up a cron job to run it.</p>
<p>By default, APM indices have the pattern <code class="literal">apm-%{[observer.version]}-{type}-%{+yyyy.MM.dd}</code>.
With the curator command line interface you can, for instance, see all your existing indices:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curator_cli --host localhost show_indices --filter_list '[{"filtertype":"pattern","kind":"prefix","value":"apm-"}]'

apm-7.17.11-error-2019.10.20
apm-7.17.11-error-2019.10.21
apm-7.17.11-error-2019.10.22
apm-7.17.11-sourcemap
apm-7.17.11-span-2019.10.20
apm-7.17.11-span-2019.10.21
apm-7.17.11-span-2019.10.22
apm-7.17.11-transaction-2019.10.20
apm-7.17.11-transaction-2019.10.21
apm-7.17.11-transaction-2019.10.22</pre>
</div>
<p>And then delete any span indices older than 1 day:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curator_cli --host localhost delete_indices --filter_list '[{"filtertype":"pattern","kind":"prefix","value":"apm-7.17.11-span-"}, {"filtertype":"age","source":"name","timestring":"%Y.%m.%d","unit":"days","unit_count":1,"direction":"older"}]'

INFO      Deleting selected indices: [apm-7.17.11-span-2019.10.20, apm-7.17.11-span-2019.10.21]
INFO      ---deleting index apm-7.17.11-span-2019.10.20
INFO      ---deleting index apm-7.17.11-span-2019.10.21
INFO      "delete_indices" action completed.</pre>
</div>
<h6><a id="delete-data-by-query"></a>Delete data matching a query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h6>
<p>You can delete documents matching a specific query.
For example, all documents with a given <code class="literal">context.service.name</code> use the following request:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">POST /apm-*/_delete_by_query
{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "context.service.name": {
              "value": "old-service-name"
            }
          }
        }
      ]
    }
  }
}</pre>
</div>
<p>See <a href="/guide/en/elasticsearch/reference/7.17/docs-delete-by-query.html" class="ulink" target="_top">delete by query</a> for further information on this topic.</p>
<h6><a id="delete-other-apm-data"></a>Delete other APM data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h6>
<p>In addition to trace event data, there are other APM indices that you may wish to delete data from.</p>
<p>APM <a href="/guide/en/kibana/7.17/custom-links.html" class="ulink" target="_top">custom links</a> are stored in the <code class="literal">.apm-custom-link</code> index.
To delete all custom links, run:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /.apm-custom-link/_delete_by_query
{
  "query": {
    "match_all": {}
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/13.console"></div>
<p>APM agent <a href="/guide/en/kibana/7.17/agent-configuration.html" class="ulink" target="_top">central configuration</a> data is stored in the <code class="literal">.apm-agent-configuration</code> index.
Follow these steps to delete all central agent configurations.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Delete all documents in the <code class="literal">.apm-agent-configuration</code> index:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /.apm-agent-configuration/_delete_by_query
{
  "query": {
    "match_all": {}
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/14.console"></div>
</li>
<li class="listitem">
<p>Sync the changes with Fleet.</p>
<p>Fleet does not routinely sync agent configuration variables,
so you must force a sync by creating (and then deleting) a new agent configuration.
In Kibana, navigate to <span class="strong strong"><strong>Observability</strong></span> &gt; <span class="strong strong"><strong>APM</strong></span> &gt; <span class="strong strong"><strong>Settings</strong></span> &gt; <span class="strong strong"><strong>Agent Configuration</strong></span> &gt; <span class="strong strong"><strong>Create configuration</strong></span>.
Create and save any agent configuration. You can then use the trash icon to delete the configuration.
Creating or deleting a configuration via this method will sync the <code class="literal">.apm-agent-configuration</code> index with Fleet.</p>
</li>
</ol>
</div>
<h6><a id="delete-data-kibana"></a>Delete data via Kibana Index Management UI<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/legacy/storage-management.asciidoc">edit</a></h6>
<p>Select the indices you want to delete, and click <span class="strong strong"><strong>Manage indices</strong></span> to see the available actions.
Then click <span class="strong strong"><strong>delete indices</strong></span>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="processing-performance.html">« Processing and performance</a>
</span>
<span class="next">
<a href="manage-indices-kibana.html">Manage Indices via Kibana »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
