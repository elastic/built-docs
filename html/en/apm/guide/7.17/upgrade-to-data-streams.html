<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Upgrade to data streams | APM User Guide [7.17] | Elastic</title>
<link rel="home" href="index.html" title="APM User Guide [7.17]"/>
<link rel="up" href="upgrade.html" title="Upgrade"/>
<link rel="prev" href="upgrade-717-cloud-integration.html" title="Upgrade Elastic Cloud with the APM integration to 717"/>
<link rel="next" href="upgrade-to-apm-integration.html" title="Upgrade to the Elastic APM integration"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/7.17"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="7.17"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->
  
  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM User Guide [7.17]</a></span>
»
<span class="breadcrumb-link"><a href="upgrade.html">Upgrade</a></span>
»
<span class="breadcrumb-node">Upgrade to data streams</span>
</div>
<div class="navheader">
<span class="prev">
<a href="upgrade-717-cloud-integration.html">« Upgrade Elastic Cloud with the APM integration to 717</a>
</span>
<span class="next">
<a href="upgrade-to-apm-integration.html">Upgrade to the Elastic APM integration »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="upgrade-to-data-streams"></a>Upgrade to data streams<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/upgrading-to-datastreams.asciidoc">edit</a></h2>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#why-upgrade-to-data-streams" title="Why upgrade?">Why upgrade?</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#considerations-data-streams" title="Data streams considerations">Data streams considerations</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-steps" title="Upgrade a self-managed APM Server">Upgrade a self-managed APM Server</a>
</li>
</ul>
</div>
<p>Classic indices are deprecated starting in version 7.16.0.
Users that are not ready to <a class="xref" href="upgrade-to-apm-integration.html" title="Upgrade to the Elastic APM integration">Upgrade to the Elastic APM integration</a> should
upgrade to data streams in the meantime.</p>
<h3><a id="why-upgrade-to-data-streams"></a>Why upgrade?<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/upgrading-to-datastreams.asciidoc">edit</a></h3>
<p>Data streams offer a number of benefits over classic indices:</p>
<p><span class="strong strong"><strong>Data streams</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Reduced number of fields per index, better space efficiency, and faster queries
</li>
<li class="listitem">
More granular data control
</li>
<li class="listitem">
Errors and metrics data streams are shared with other data sources&#8201;&#8212;&#8201;which means better long-term integration with the logs and metrics apps
</li>
<li class="listitem">
Removes template inheritance for ILM policies and makes use of new Elasticsearch index and component templates
</li>
<li class="listitem">
Fixes <a class="xref" href="common-problems.html#server-resource-exists-not-alias" title="resource 'apm-7.17.3-$type' exists, but it is not an alias"><code class="literal">resource 'apm-7.17.3-$type' exists, but it is not an alias</code></a>
</li>
</ul>
</div>
<h3><a id="considerations-data-streams"></a>Data streams considerations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/upgrading-to-datastreams.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Users on Elastic Cloud Enterprise require additional steps prior to migrating, like configuring TLS certificates for the connection between APM Server and Elasticsearch
</li>
<li class="listitem">
RUM sourcemaps are not working with data streams in 7.16&#8201;&#8212;&#8201;this will be fixed in 8.0
</li>
</ul>
</div>
<h3><a id="apm-data-streams-upgrade-steps"></a>Upgrade a self-managed APM Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/upgrading-to-datastreams.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-1" title="Upgrade the Elastic Stack">Upgrade the Elastic Stack</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-2" title="Add the APM integration">Add the APM integration</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-3" title="Configure APM Server to use data streams">Configure APM Server to use data streams</a>
</li>
<li class="listitem">
<a class="xref" href="upgrade-to-data-streams.html#apm-data-streams-upgrade-4" title="Configure resources">Configure resources</a>
</li>
</ol>
</div>
<h4><a id="apm-data-streams-upgrade-1"></a>Upgrade the Elastic Stack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/upgrading-to-datastreams.asciidoc">edit</a></h4>
<p>The Elastic Stack (Elasticsearch and Kibana) must be upgraded prior to APM Server.
See the <a href="/guide/en/elastic-stack/7.17/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a> for guidance.</p>
<p>Review the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a>,
and Observability <a href="/guide/en/observability/7.17/whats-new.html" class="ulink" target="_top">What&#8217;s new</a> content for important changes between
your current APM version and this one.</p>
<h4><a id="apm-data-streams-upgrade-2"></a>Add the APM integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/upgrading-to-datastreams.asciidoc">edit</a></h4>
<p>Before enabling data streams in APM Server, the APM integration must be added to your cluster.
This enables Fleet to set up ingest templates, ILM policies,
and ingest pipelines when APM Server tries to connect.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, navigate to <span class="strong strong"><strong>Management</strong></span> &gt; <span class="strong strong"><strong>Fleet</strong></span>.
First time? The page may take a few minutes to load.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Agent policies</strong></span> &gt; <span class="strong strong"><strong>Default policy</strong></span> and click <span class="strong strong"><strong>Add integration</strong></span>.
</li>
<li class="listitem">
Search for and select <span class="strong strong"><strong>Elastic APM</strong></span>. Under step one, select <span class="strong strong"><strong>APM integration</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic APM</strong></span>. Configuring the integration is not required as we&#8217;re only using the integration to set up Elasticsearch resources. Click <span class="strong strong"><strong>Save and Continue</strong></span> and then <span class="strong strong"><strong>Add Elastic Agent later</strong></span> (you don&#8217;t need to add an Elastic Agent later).
</li>
</ol>
</div>
<h4><a id="apm-data-streams-upgrade-3"></a>Configure APM Server to use data streams<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/upgrading-to-datastreams.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Stop APM Server and set <a class="xref" href="configuration-process.html#_configuration_options_data_streams" title="Configuration options: data_streams"><code class="literal">data_streams.enabled: true</code></a> in apm-server.yml:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server:
  data_streams.enabled: true</pre>
</div>
</li>
<li class="listitem">
<a class="xref" href="apm-server-starting.html" title="Step 3: Start">Restart APM Server</a>.
</li>
</ol>
</div>
<h4><a id="apm-data-streams-upgrade-4"></a>Configure resources<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.17/docs/upgrading-to-datastreams.asciidoc">edit</a></h4>
<p>Need to customize anything?</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
See <a class="xref" href="ilm-how-to.html" title="Index lifecycle management">Index lifecycle management</a> to learn about the new default Index lifecycle management (ILM) policies applied to data streams and how to customize them.
</li>
<li class="listitem">
See <a class="xref" href="ingest-pipelines.html" title="Parse data using ingest pipelines">Parse data using ingest pipelines</a> for more information on how to edit or view ingest pipelines.
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="upgrade-717-cloud-integration.html">« Upgrade Elastic Cloud with the APM integration to 717</a>
</span>
<span class="next">
<a href="upgrade-to-apm-integration.html">Upgrade to the Elastic APM integration »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
