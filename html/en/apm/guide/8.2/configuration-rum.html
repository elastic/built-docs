<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Configure Real User Monitoring (RUM) | APM User Guide [8.2] | Elastic</title>
<link rel="home" href="index.html" title="APM User Guide [8.2]"/>
<link rel="up" href="configuring-howto-apm-server.html" title="Configure APM Server"/>
<link rel="prev" href="configuration-path.html" title="Configure project paths"/>
<link rel="next" href="configuration-ssl-landing.html" title="SSL/TLS settings"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.2"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.2"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">APM User Guide [8.2]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="overview.html">Legacy APM Server Reference</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="configuring-howto-apm-server.html">Configure APM Server</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="configuration-path.html">« Configure project paths</a>
</span>
<span class="next">
<a href="configuration-ssl-landing.html">SSL/TLS settings »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuration-rum"></a>Configure Real User Monitoring (RUM)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h2>
</div></div></div>

<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This documentation refers to configuring the standalone (legacy) APM Server. This method of running APM Server will be deprecated and removed in a future release. Please consider <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">upgrading to Fleet and the APM integration</a>.
If you&#8217;re using Fleet and the Elastic APM integration, please see <a class="xref" href="apm-rum.html" title="Real User Monitoring (RUM)">Real User Monitoring (RUM)</a> instead.</p>
</div>
</div>
<p>The <a href="/guide/en/apm/agent/rum-js/5.x/index.html" class="ulink" target="_top">Real User Monitoring (RUM) agent</a> captures user interactions with clients such as web browsers.
These interactions are sent as events to the APM Server.
Because the RUM agent runs on the client side, the connection between agent and server is unauthenticated.
As a security precaution, RUM is therefore disabled by default.
To enable it, set <code class="literal">apm-server.rum.enabled</code> to <code class="literal">true</code> in your APM Server configuration file.</p>
<p>In addition, if APM Server is deployed in an origin different than the page’s origin,
you will need to configure <a href="/guide/en/apm/agent/rum-js/5.x/configuring-cors.html" class="ulink" target="_top">Cross-Origin Resource Sharing (CORS)</a> in the Agent.</p>
<p>Example config with RUM enabled:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server.rum.enabled: true
apm-server.auth.anonymous.rate_limit.event_limit: 300
apm-server.auth.anonymous.rate_limit.ip_limit: 1000
apm-server.auth.anonymous.allow_service: [your_service_name]
apm-server.rum.allow_origins: ['*']
apm-server.rum.allow_headers: ["header1", "header2"]
apm-server.rum.library_pattern: "node_modules|bower_components|~"
apm-server.rum.exclude_from_grouping: "^/webpack"
apm-server.rum.source_mapping.enabled: true
apm-server.rum.source_mapping.cache.expiration: 5m</pre>
</div>
<h4><a id="enable-rum-support"></a>Configuration reference<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h4>
<p>Specify the following options in the <code class="literal">apm-server.rum</code> section of the <code class="literal">apm-server.yml</code> config file:</p>
<h5><a id="rum-enable"></a><code class="literal">enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>To enable RUM support, set <code class="literal">apm-server.rum.enabled</code> to <code class="literal">true</code>.
By default this is disabled.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Enabling RUM support automatically enables <a class="xref" href="configuration-anonymous.html" title="Anonymous auth configuration options">Anonymous authentication</a>.
Anonymous access is required as the RUM agent runs in end users' browsers.</p>
</div>
</div>
<h5><a id="event_rate.limit"></a><code class="literal">event_rate.limit</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.15.0.</h3>
<p>Replaced by &lt;&lt;config-auth-anon-event-limit</p>
</div>
</div>
<p>The maximum number of events allowed per second, per agent IP address.</p>
<p>Default: <code class="literal">300</code></p>
<h5><a id="_event_rate_lru_size"></a><code class="literal">event_rate.lru_size</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.15.0.</h3>
<p>Replaced by &lt;&lt;config-auth-anon-ip-limit</p>
</div>
</div>
<p>The number of unique IP addresses to track in an LRU cache.
IP addresses in the cache will be rate limited according to the <a class="xref" href="configuration-anonymous.html#config-auth-anon-event-limit" title="rate_limit.event_limit"><code class="literal">rate_limit.event_limit</code></a> setting.
Consider increasing this default if your site has many concurrent clients.</p>
<p>Default: <code class="literal">1000</code></p>
<h5><a id="rum-allow-service-names"></a><code class="literal">allow_service_names</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.15.0.</h3>
<p>Replaced by &lt;&lt;config-auth-anon-allow-service</p>
</div>
</div>
<p>A list of permitted service names for RUM support.
Names in this list must match the agent&#8217;s <code class="literal">service.name</code>.
This can be set to restrict RUM events to those with one of a set of known service names,
in order to limit the number of service-specific indices or data streams created.</p>
<p>Default: Not set (any service name is accepted)</p>
<h5><a id="rum-allow-origins"></a><code class="literal">allow_origins</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>A list of permitted origins for RUM support.
User-agents send an Origin header that will be validated against this list.
This is done automatically by modern browsers as part of the <a href="https://www.w3.org/TR/cors/" class="ulink" target="_top">CORS specification</a>.
An origin is made of a protocol scheme, host and port, without the URL path.</p>
<p>Default: <code class="literal">['*']</code> (allows everything)</p>
<h5><a id="rum-allow-headers"></a><code class="literal">allow_headers</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>HTTP requests made from the RUM agent to the APM Server are limited in the HTTP headers they are allowed to have.
If any other headers are added, the request will be rejected by the browser due to Cross-Origin Resource Sharing (CORS) restrictions.
Use this setting to allow additional headers.
The default list of allowed headers includes "Content-Type", "Content-Encoding", and "Accept";
custom values configured here are appended to the default list and used as the value for the <code class="literal">Access-Control-Allow-Headers</code> header.</p>
<p>Default: <code class="literal">[]</code></p>
<h5><a id="rum-response-headers"></a><code class="literal">response_headers</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>Custom HTTP headers to add to RUM responses.
This can be useful for security policy compliance.</p>
<p>Values set for the same key will be concatenated.</p>
<p>Default: Not set</p>
<h5><a id="rum-library-pattern"></a><code class="literal">library_pattern</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>RegExp to be matched against a stack trace frame&#8217;s <code class="literal">file_name</code> and <code class="literal">abs_path</code> attributes.
If the RegExp matches, the stack trace frame is considered to be a library frame.
When source mapping is applied, the <code class="literal">error.culprit</code> is set to reflect the <em>function</em> and the <em>filename</em>
of the first non library frame.
This aims to provide an entry point for identifying issues.</p>
<p>Default: <code class="literal">"node_modules|bower_components|~"</code></p>
<h5><a id="_exclude_from_grouping"></a><code class="literal">exclude_from_grouping</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>RegExp to be matched against a stack trace frame&#8217;s <code class="literal">file_name</code>.
If the RegExp matches, the stack trace frame is excluded from being used for calculating error groups.</p>
<p>Default: <code class="literal">"^/webpack"</code> (excludes stack trace frames that have a filename starting with <code class="literal">/webpack</code>)</p>
<h5><a id="config-sourcemapping-enabled"></a><code class="literal">source_mapping.enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>Used to enable/disable <a class="xref" href="sourcemaps.html" title="How to apply source maps to error stack traces when using minified bundles">source mapping</a> for RUM events.
When enabled, the APM Server needs additional privileges to read source maps.
See <a class="xref" href="privileges-to-publish-events.html" title="Grant privileges and roles needed for writing events">Create a <em>writer</em> user</a> for more details.</p>
<p>Default: <code class="literal">true</code></p>
<h5><a id="config-sourcemapping-elasticsearch"></a><code class="literal">source_mapping.elasticsearch</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>Configure the Elasticsearch source map retrieval location, taking the same options as <a class="xref" href="elasticsearch-output.html" title="Configure the Elasticsearch output">output.elasticsearch</a>.
This must be set when using an output other than Elasticsearch, and that output is writing to Elasticsearch.
Otherwise leave this section empty.</p>
<h5><a id="rum-sourcemap-cache"></a><code class="literal">source_mapping.cache.expiration</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>If a source map has been uploaded to the APM Server,
<a class="xref" href="sourcemaps.html" title="How to apply source maps to error stack traces when using minified bundles">source mapping</a> is automatically applied to documents sent to the RUM endpoint.
Source maps are fetched from Elasticsearch and then kept in an in-memory cache for the configured time.
Values configured without a time unit are treated as seconds.</p>
<p>Default: <code class="literal">5m</code> (5 minutes)</p>
<h5><a id="_source_mapping_index_pattern"></a><code class="literal">source_mapping.index_pattern</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h5>
<p>Previous versions of APM Server stored source maps in <code class="literal">apm-%{[observer.version]}-sourcemap</code> indices.
Search source maps stored in an older version with this setting.</p>
<p>Default: <code class="literal">"apm-*-sourcemap*"</code></p>
<h4><a id="_ingest_pipelines"></a>Ingest pipelines<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.2/docs/legacy/configuration-rum.asciidoc">edit</a></h4>
<p>The default APM Server pipeline includes processors that enrich RUM data prior to indexing in Elasticsearch.
See <a class="xref" href="ingest-pipelines.html" title="Parse data using ingest pipelines">Parse data using ingest pipelines</a> for details on how to locate, edit, or disable this preprocessing.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="configuration-path.html">« Configure project paths</a>
</span>
<span class="next">
<a href="configuration-ssl-landing.html">SSL/TLS settings »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
