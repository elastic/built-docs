<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Switch a self-installation to the APM integration | APM User Guide [8.3] | Elastic</title>
<link rel="home" href="index.html" title="APM User Guide [8.3]"/>
<link rel="up" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration"/>
<link rel="prev" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration"/>
<link rel="next" href="apm-integration-upgrade-steps-ess.html" title="Switch an Elastic Cloud cluster to the APM integration"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.3"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.3"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">APM User Guide [8.3]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="upgrade.html">Upgrade</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="upgrade-to-apm-integration.html">Switch to the Elastic APM integration</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="upgrade-to-apm-integration.html">« Switch to the Elastic APM integration</a>
</span>
<span class="next">
<a href="apm-integration-upgrade-steps-ess.html">Switch an Elastic Cloud cluster to the APM integration »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="apm-integration-upgrade-steps"></a>Switch a self-installation to the APM integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.3/docs/upgrading-to-integration.asciidoc">edit</a></h3>
</div></div></div>

<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="apm-integration-upgrade-steps.html#apm-integration-upgrade-1" title="Upgrade the Elastic Stack">Upgrade the Elastic Stack</a>
</li>
<li class="listitem">
<a class="xref" href="apm-integration-upgrade-steps.html#apm-integration-upgrade-2" title="Add a Fleet Server">Add a Fleet Server</a>
</li>
<li class="listitem">
<a class="xref" href="apm-integration-upgrade-steps.html#apm-integration-upgrade-3" title="Install a Fleet-managed Elastic Agent">Install a Fleet-managed Elastic Agent</a>
</li>
<li class="listitem">
<a class="xref" href="apm-integration-upgrade-steps.html#apm-integration-upgrade-4" title="Add the APM integration">Add the APM integration</a>
</li>
<li class="listitem">
<a class="xref" href="apm-integration-upgrade-steps.html#apm-integration-upgrade-5" title="Stop the legacy APM Server">Stop the legacy APM Server</a>
</li>
</ol>
</div>
<h4><a id="apm-integration-upgrade-1"></a>Upgrade the Elastic Stack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.3/docs/upgrading-to-integration.asciidoc">edit</a></h4>
<p>The Elastic Stack (Elasticsearch and Kibana) must be upgraded to version 7.14 or higher.
See the <a href="/guide/en/elastic-stack/8.3/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a> for guidance.</p>
<p>Review the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a>,
and Observability <a href="/guide/en/observability/8.3/whats-new.html" class="ulink" target="_top">What&#8217;s new</a> content for important changes between
your current APM version and this one.</p>
<h4><a id="apm-integration-upgrade-2"></a>Add a Fleet Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.3/docs/upgrading-to-integration.asciidoc">edit</a></h4>
<p>Fleet Server is a component of the Elastic Stack used to centrally manage Elastic Agents.
The APM integration requires a Fleet Server to be running and accessible to your hosts.
Add a Fleet Server by following <a href="/guide/en/fleet/8.3/add-a-fleet-server.html" class="ulink" target="_top">this guide</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you&#8217;re upgrading a self-managed deployment of the Elastic Stack, you&#8217;ll need to enable
<a href="/guide/en/elasticsearch/reference/8.3/configuring-stack-security.html" class="ulink" target="_top">Elasticsearch security</a> and the
<a href="/guide/en/elasticsearch/reference/8.3/security-settings.html" class="ulink" target="_top">API key service</a>.</p>
</div>
</div>
<p>After adding your Fleet Server host and generating a service token, the in-product help in Kibana
will provide a command to run to start an Elastic Agent as a Fleet Server.
Commands may require administrator privileges.</p>
<p>Verify Fleet Server is running by navigating to <span class="strong strong"><strong>Fleet</strong></span> &gt; <span class="strong strong"><strong>Agents</strong></span> in Kibana.</p>
<h4><a id="apm-integration-upgrade-3"></a>Install a Fleet-managed Elastic Agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.3/docs/upgrading-to-integration.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>It&#8217;s possible to install the Elastic APM integration on the same Elastic Agent that is running the Fleet Server integration. For this use case, skip this step.</p>
</div>
</div>
<p>The Fleet-managed Elastic Agent will run the Elastic APM integration on your edge nodes, next to your applications.
To install a Fleet-managed Elastic Agent, follow <a href="/guide/en/fleet/8.3/install-fleet-managed-elastic-agent.html" class="ulink" target="_top">this guide</a>.</p>
<h4><a id="apm-integration-upgrade-4"></a>Add the APM integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.3/docs/upgrading-to-integration.asciidoc">edit</a></h4>
<p>The APM integration receives performance data from your APM agents,
validates and processes it, and then transforms the data into Elasticsearch documents.</p>
<p>To add the APM integration, see <a class="xref" href="apm-quick-start.html#add-apm-integration" title="Step 2: Configure the APM integration">Step 2: Configure the APM integration</a>.
Only complete the linked step (not the entire quick start guide).
If you&#8217;re adding the APM integration to a Fleet-managed Elastic Agent, you can use the default policy.
If you&#8217;re adding the APM integration to the Fleet Server, use the policy that the Fleet Server is running on.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You&#8217;ll configure the APM integration in this step.
See <a class="xref" href="input-apm.html" title="APM input settings"><em>Input settings</em></a> for a reference of all available settings.
As long as the APM integration is configured with the same secret token or you have API keys enabled on the same host,
no reconfiguration is required in your APM agents.</p>
</div>
</div>
<h4><a id="apm-integration-upgrade-5"></a>Stop the legacy APM Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.3/docs/upgrading-to-integration.asciidoc">edit</a></h4>
<p>Once data from upgraded APM agents is visible in the APM app,
it&#8217;s safe to stop the legacy APM Server process.</p>
<p>Congratulations&#8201;&#8212;&#8201;you now have the latest and greatest in Elastic APM!</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="upgrade-to-apm-integration.html">« Switch to the Elastic APM integration</a>
</span>
<span class="next">
<a href="apm-integration-upgrade-steps-ess.html">Switch an Elastic Cloud cluster to the APM integration »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
