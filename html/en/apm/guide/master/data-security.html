<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Data security | APM User Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="APM User Guide [master]"/>
<link rel="up" href="apm-features.html" title="Elastic APM features"/>
<link rel="prev" href="apm-features.html" title="Elastic APM features"/>
<link rel="next" href="distributed-tracing.html" title="Distributed tracing"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">APM User Guide [master]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="legacy-apm-overview.html">Legacy APM Overview</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="apm-features.html">Elastic APM features</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="apm-features.html">« Elastic APM features</a>
</span>
<span class="next">
<a href="distributed-tracing.html">Distributed tracing »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="data-security"></a>Data security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h2>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This documentation refers to the standalone (legacy) method of running APM Server. This method of running APM Server will be deprecated and removed in a future release. Please consider <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">upgrading to the Elastic APM integration</a>.
If you&#8217;ve already upgraded, see <a class="xref" href="apm-data-security.html" title="Data security">Data security</a>.</p>
</div>
</div>
<p>When setting up Elastic APM, it&#8217;s essential to review all captured data carefully to ensure
it does not contain sensitive information.
When it does, we offer several different ways to filter, manipulate, or obfuscate this data.</p>
<p><span class="strong strong"><strong>Built-in data filters</strong></span></p>
<p>Elastic APM provides built-in support for filtering the following types of data:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Data type</th>
<th align="left" valign="top">Common sensitive data</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><a class="xref" href="data-security.html#filter-http-header" title="HTTP headers">HTTP headers</a></p></td>
<td align="left" valign="top"><p>Passwords, credit card numbers, authorization, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="data-security.html#filter-http-body" title="HTTP bodies">HTTP bodies</a></p></td>
<td align="left" valign="top"><p>Passwords, credit card numbers, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="data-security.html#filter-personal-data" title="Personal data">Personal data</a></p></td>
<td align="left" valign="top"><p>Client IP address and user agent.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="data-security.html#filter-real-user-data" title="Real user monitoring data">Real user monitoring data</a></p></td>
<td align="left" valign="top"><p>URLs visited, click events, user browser errors, resources used, etc.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="data-security.html#filter-database-statements" title="Database statements">Database statements</a></p></td>
<td align="left" valign="top"><p>Sensitive user or business information</p></td>
</tr>
</tbody>
</table>
</div>
<p><span class="strong strong"><strong>Custom filters</strong></span></p>
<p>There are two ways to filter other types APM data:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><a class="xref" href="data-security.html#filter-ingest-pipeline" title="Create an ingest node pipeline filter">Ingest node pipeline</a></p></td>
<td align="left" valign="top"><p>Applied at ingestion time.
All agents and fields are supported. Data leaves the instrumented service.
There are no performance overhead implications on the instrumented service.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="data-security.html#filter-in-agent" title="APM agent filters">APM agent filters</a></p></td>
<td align="left" valign="top"><p>Not supported by all agents.
Data is sanitized before leaving the instrumented service.
Potential overhead implications on the instrumented service</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="built-in-filtering"></a>Built-in data filtering<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h3>
<p>Elastic APM provides built-in support for filtering or obfuscating the following types of data.</p>
<h4><a id="filter-http-header"></a>HTTP headers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h4>
<p>By default, APM agents capture HTTP request and response headers (including cookies).
Most Elastic APM agents provide the ability to sanitize HTTP header fields,
including cookies and <code class="literal">application/x-www-form-urlencoded</code> data (POST form fields).
Query string and captured request bodies, like <code class="literal">application/json</code> data, are not sanitized.</p>
<p>The default list of sanitized fields attempts to target common field names for data relating to
passwords, credit card numbers, authorization, etc., but can be customized to fit your data.
This sensitive data never leaves the instrumented service.</p>
<p>This setting supports <a href="/guide/en/kibana/master/agent-configuration.html" class="ulink" target="_top">Central configuration</a>,
which means the list of sanitized fields can be updated without needing to redeploy your services:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go: <a href="/guide/en/apm/agent/go/2.x/configuration.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">ELASTIC_APM_SANITIZE_FIELD_NAMES</code></a>
</li>
<li class="listitem">
Java: <a href="/guide/en/apm/agent/java/1.x/config-core.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitize_field_names</code></a>
</li>
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.12/config-core.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitizeFieldNames</code></a>
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/3.x/configuration.html#sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitizeFieldNames</code></a>
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/configuration.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitize_field_names</code></a>
</li>
<li class="listitem">
Ruby: <a href="/guide/en/apm/agent/ruby/4.x/configuration.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">sanitize_field_names</code></a>
</li>
</ul>
</div>
<p>Alternatively, you can completely disable the capturing of HTTP headers.
This setting also supports <a href="/guide/en/kibana/master/agent-configuration.html" class="ulink" target="_top">Central configuration</a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go: <a href="/guide/en/apm/agent/go/2.x/configuration.html#config-capture-headers" class="ulink" target="_top"><code class="literal">ELASTIC_APM_CAPTURE_HEADERS</code></a>
</li>
<li class="listitem">
Java: <a href="/guide/en/apm/agent/java/1.x/config-core.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">capture_headers</code></a>
</li>
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.12/config-http.html#config-capture-headers" class="ulink" target="_top"><code class="literal">CaptureHeaders</code></a>
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/3.x/configuration.html#capture-headers" class="ulink" target="_top"><code class="literal">captureHeaders</code></a>
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/configuration.html#config-capture-headers" class="ulink" target="_top"><code class="literal">capture_headers</code></a>
</li>
<li class="listitem">
Ruby: <a href="/guide/en/apm/agent/ruby/4.x/configuration.html#config-capture-headers" class="ulink" target="_top"><code class="literal">capture_headers</code></a>
</li>
</ul>
</div>
<h4><a id="filter-http-body"></a>HTTP bodies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h4>
<p>By default, the body of HTTP requests is not recorded.
Request bodies often contain sensitive data like passwords or credit card numbers,
so use care when enabling this feature.</p>
<p>This setting supports <a href="/guide/en/kibana/master/agent-configuration.html" class="ulink" target="_top">Central configuration</a>,
which means the list of sanitized fields can be updated without needing to redeploy your services:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go: <a href="/guide/en/apm/agent/go/2.x/configuration.html#config-capture-body" class="ulink" target="_top"><code class="literal">ELASTIC_APM_CAPTURE_BODY</code></a>
</li>
<li class="listitem">
Java: <a href="/guide/en/apm/agent/java/1.x/config-core.html#config-sanitize-field-names" class="ulink" target="_top"><code class="literal">capture_body</code></a>
</li>
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.12/config-http.html#config-capture-body" class="ulink" target="_top"><code class="literal">CaptureBody</code></a>
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/3.x//configuration.html#capture-body" class="ulink" target="_top"><code class="literal">captureBody</code></a>
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/configuration.html#config-capture-body" class="ulink" target="_top"><code class="literal">capture_body</code></a>
</li>
<li class="listitem">
Ruby: <a href="/guide/en/apm/agent/ruby/4.x/configuration.html#config-capture-body" class="ulink" target="_top"><code class="literal">capture_body</code></a>
</li>
</ul>
</div>
<h4><a id="filter-personal-data"></a>Personal data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h4>
<p>By default, the APM Server captures some personal data associated with trace events:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">client.ip</code>: The client&#8217;s IP address. Typically derived from the HTTP headers of incoming requests.
<code class="literal">client.ip</code> is also used in conjunction with the <a href="/guide/en/elasticsearch/reference/master/geoip-processor.html" class="ulink" target="_top"><code class="literal">geoip</code> processor</a> to assign
geographical information to trace events. To learn more about how <code class="literal">client.ip</code> is derived,
see <a class="xref" href="configuration-anonymous.html#config-auth-anon-client-ip" title="Deriving an incoming request&#8217;s client.ip address">Deriving an incoming request&#8217;s <code class="literal">client.ip</code> address</a>.
</li>
<li class="listitem">
<code class="literal">user_agent</code>: User agent data, including the client operating system, device name, vendor, and version.
</li>
</ul>
</div>
<p>The capturing of this data can be turned off by setting
&lt;&lt;<code class="literal">capture_personal_data</code>,capture_personal_data&gt;&gt; to <code class="literal">false</code>.</p>
<h4><a id="filter-real-user-data"></a>Real user monitoring data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h4>
<p>Protecting user data is important.
For that reason, individual RUM instrumentations can be disabled in the RUM agent with the
<a href="/guide/en/apm/agent/rum-js/5.x/configuration.html#disable-instrumentations" class="ulink" target="_top"><code class="literal">disableInstrumentations</code></a> configuration variable.
Disabled instrumentations produce no spans or transactions.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Disable</th>
<th align="left" valign="top">Configuration value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>HTTP requests</p></td>
<td align="left" valign="top"><p><code class="literal">fetch</code> and <code class="literal">xmlhttprequest</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Page load metrics including static resources</p></td>
<td align="left" valign="top"><p><code class="literal">page-load</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>JavaScript errors on the browser</p></td>
<td align="left" valign="top"><p><code class="literal">error</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>User click events including URLs visited, mouse clicks, and navigation events</p></td>
<td align="left" valign="top"><p><code class="literal">eventtarget</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Single page application route changes</p></td>
<td align="left" valign="top"><p><code class="literal">history</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="filter-database-statements"></a>Database statements<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h4>
<p>For SQL databases, APM agents do not capture the parameters of prepared statements.
Note that Elastic APM currently does not make an effort to strip parameters of regular statements.
Not using prepared statements makes your code vulnerable to SQL injection attacks,
so be sure to use prepared statements.</p>
<p>For non-SQL data stores, such as Elasticsearch or MongoDB,
Elastic APM captures the full statement for queries.
For inserts or updates, the full document is not stored.
To filter or obfuscate data in non-SQL database statements,
or to remove the statement entirely,
you can set up an ingest node pipeline.</p>
<h4><a id="filter-agent-specific"></a>Agent-specific options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h4>
<p>Certain agents offer additional filtering and obfuscating options:</p>
<p><span class="strong strong"><strong>Agent configuration options</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
(Node.js) Remove errors raised by the server-side process:
Disable with <a href="/guide/en/apm/agent/nodejs/3.x/configuration.html#capture-exceptions" class="ulink" target="_top">captureExceptions</a>.
</li>
<li class="listitem">
(Java) Remove process arguments from transactions:
</li>
<li class="listitem">
Disabled by default with <a href="/guide/en/apm/agent/java/1.x/config-reporter.html#config-include-process-args" class="ulink" target="_top"><code class="literal">include_process_args</code></a>.
</li>
</ul>
</div>
<h3><a id="custom-filters"></a>Custom filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h3>
<p>There are two ways to filter or obfuscate other types of APM data:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="data-security.html#filter-ingest-pipeline" title="Create an ingest node pipeline filter">Create an ingest node pipeline filter</a>
</li>
<li class="listitem">
<a class="xref" href="data-security.html#filter-in-agent" title="APM agent filters">APM agent filters</a>
</li>
</ul>
</div>
<h4><a id="filter-ingest-pipeline"></a>Create an ingest node pipeline filter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h4>
<p>Ingest node pipelines specify a series of processors that transform data in a specific way.
Transformation happens prior to indexing–inflicting no performance overhead on the monitored application.
Pipelines are a flexible and easy way to filter or obfuscate Elastic APM data.</p>
<p><span class="strong strong"><strong>Example</strong></span></p>
<p>Say you decide to <a class="xref" href="data-security.html#filter-http-body" title="HTTP bodies">enable the capturing of HTTP request bodies</a>,
but quickly notice that sensitive information is being collected in the
<code class="literal">http.request.body.original</code> field:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "email": "test@abc.com",
  "password": "hunter2"
}</pre>
</div>
<p>To obfuscate the passwords stored in the request body,
use a series of <a href="/guide/en/elasticsearch/reference/master/processors.html" class="ulink" target="_top">ingest processors</a>.
To start, create a pipeline with a simple description and an empty array of processors:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "pipeline": {
    "description": "redact http.request.body.original.password",
    "processors": [] <a id="CO40-1"></a><i class="conum" data-value="1"></i>
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The processors defined below will go in this array</p>
</td>
</tr>
</table>
</div>
<p>Add the first processor to the processors array.
Because the agent captures the request body as a string, use the
<a href="/guide/en/elasticsearch/reference/master/json-processor.html" class="ulink" target="_top">JSON processor</a> to convert the original field value into a structured JSON object.
Save this JSON object in a new field:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "json": {
    "field": "http.request.body.original",
    "target_field": "http.request.body.original_json",
    "ignore_failure": true
  }
}</pre>
</div>
<p>If <code class="literal">body.original_json</code> is not <code class="literal">null</code>, redact the <code class="literal">password</code> with the <a href="/guide/en/elasticsearch/reference/master/set-processor.html" class="ulink" target="_top">set processor</a>,
by setting the value of <code class="literal">body.original_json.password</code> to <code class="literal">"redacted"</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "set": {
    "field": "http.request.body.original_json.password",
    "value": "redacted",
    "if": "ctx?.http?.request?.body?.original_json != null"
  }
}</pre>
</div>
<p>Use the <a href="/guide/en/elasticsearch/reference/master/convert-processor.html" class="ulink" target="_top">convert processor</a> to convert the JSON value of <code class="literal">body.original_json</code> to a string and set it as the <code class="literal">body.original</code> value:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "convert": {
    "field": "http.request.body.original_json",
    "target_field": "http.request.body.original",
    "type": "string",
    "if": "ctx?.http?.request?.body?.original_json != null",
    "ignore_failure": true
  }
}</pre>
</div>
<p>Finally, use the <a href="/guide/en/elasticsearch/reference/master/remove-processor.html" class="ulink" target="_top">remove processor</a> to remove the <code class="literal">body.original_json</code> field:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "remove": {
    "field": "http.request.body.original",
    "if": "ctx?.http?.request?.body?.original_json != null",
    "ignore_failure": true
  }
}</pre>
</div>
<p>Now that the pipeline has been defined,
use the <a href="/guide/en/elasticsearch/reference/master/put-pipeline-api.html" class="ulink" target="_top">create or update pipeline API</a> to register the new pipeline in Elasticsearch.
Name the pipeline <code class="literal">apm_redacted_body_password</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/apm_redacted_body_password
{
  "description": "redact http.request.body.original.password",
  "processors": [
    {
      "json": {
        "field": "http.request.body.original",
        "target_field": "http.request.body.original_json",
        "ignore_failure": true
      }
    },
    {
      "set": {
        "field": "http.request.body.original_json.password",
        "value": "redacted",
        "if": "ctx?.http?.request?.body?.original_json != null"
      }
    },
    {
      "convert": {
        "field": "http.request.body.original_json",
        "target_field": "http.request.body.original",
        "type": "string",
        "if": "ctx?.http?.request?.body?.original_json != null",
        "ignore_failure": true
      }
    },
    {
      "remove": {
        "field": "http.request.body.original_json",
        "if": "ctx?.http?.request?.body?.original_json != null",
        "ignore_failure": true
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/8.console"></div>
<p>To make sure the <code class="literal">apm_redacted_body_password</code> pipeline works correctly,
test it with the <a href="/guide/en/elasticsearch/reference/master/simulate-pipeline-api.html" class="ulink" target="_top">simulate pipeline API</a>.
This API allows you to run multiple documents through a pipeline to ensure it is working correctly.</p>
<p>The request below simulates running three different documents through the pipeline:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ingest/pipeline/apm_redacted_body_password/_simulate
{
  "docs": [
    {
      "_source": { <a id="CO41-1"></a><i class="conum" data-value="1"></i>
        "http": {
          "request": {
            "body": {
              "original": """{"email": "test@abc.com", "password": "hunter2"}"""
            }
          }
        }
      }
    },
    {
      "_source": { <a id="CO41-2"></a><i class="conum" data-value="2"></i>
        "some-other-field": true
      }
    },
    {
      "_source": { <a id="CO41-3"></a><i class="conum" data-value="3"></i>
        "http": {
          "request": {
            "body": {
              "original": """["invalid json" """
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/9.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This document features the same sensitive data from the original example above</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This document only contains an unrelated field</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>This document contains invalid JSON</p>
</td>
</tr>
</table>
</div>
<p>The API response should be similar to this:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "docs" : [
    {
      "doc" : {
        "_source" : {
          "http" : {
            "request" : {
              "body" : {
                "original" : {
                  "password" : "redacted",
                  "email" : "test@abc.com"
                }
              }
            }
          }
        }
      }
    },
    {
      "doc" : {
        "_source" : {
          "nobody" : true
        }
      }
    },
    {
      "doc" : {
        "_source" : {
          "http" : {
            "request" : {
              "body" : {
                "original" : """["invalid json" """
              }
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<p>As you can see, only the first simulated document has a redacted password field.
As expected, all other documents are unaffected.</p>
<p>The final step in this process is to add the newly created <code class="literal">apm_redacted_body_password</code> pipeline
to the default <code class="literal">apm</code> pipeline. This ensures that all APM data ingested into Elasticsearch runs through the pipeline.</p>
<p>Get the current list of <code class="literal">apm</code> pipelines:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ingest/pipeline/apm</pre>
</div>
<div class="console_widget" data-snippet="snippets/10.console"></div>
<p>Append the newly created pipeline to the end of the processors array and register the <code class="literal">apm</code> pipeline.
Your request will look similar to this:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">{
  "apm" : {
    "processors" : [
      {
        "pipeline" : {
          "name" : "apm_user_agent"
        }
      },
      {
        "pipeline" : {
          "name" : "apm_user_geo"
        }
      },
      {
        "pipeline": {
        "name": "apm_redacted_body_password"
      }
    ],
    "description" : "Default enrichment for APM events"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/11.console"></div>
<p>That&#8217;s it! Sit back and relax–passwords have been redacted from your APM HTTP body data.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>See <a href="/guide/en/apm/guide/master/configuring-ingest-node.html" class="ulink" target="_top">parse data using ingest node pipelines</a>
to learn more about the default <code class="literal">apm</code> pipeline.</p>
</div>
</div>
<h4><a id="filter-in-agent"></a>APM agent filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/guide/data-security.asciidoc">edit</a></h4>
<p>Some APM agents offer a way to manipulate or drop APM events <em>before</em> they are sent to the APM Server.
Please see the relevant agent&#8217;s documentation for more information and examples:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
.NET: <a href="/guide/en/apm/agent/dotnet/1.12/public-api.html#filter-api" class="ulink" target="_top">Filter API</a>.
</li>
<li class="listitem">
Node.js: <a href="/guide/en/apm/agent/nodejs/3.x/agent-api.html#apm-add-filter" class="ulink" target="_top"><code class="literal">addFilter()</code></a>.
</li>
<li class="listitem">
Python: <a href="/guide/en/apm/agent/python/6.x/sanitizing-data.html" class="ulink" target="_top">custom processors</a>.
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="apm-features.html">« Elastic APM features</a>
</span>
<span class="next">
<a href="distributed-tracing.html">Distributed tracing »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
