<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tune APM Server | APM Server Reference [6.7] | Elastic</title>
<link rel="home" href="index.html" title="APM Server Reference [6.7]"/>
<link rel="up" href="tune-data-ingestion.html" title="Tune Data Ingestion"/>
<link rel="prev" href="tune-data-ingestion.html" title="Tune Data Ingestion"/>
<link rel="next" href="tune-es.html" title="Tune Elasticsearch"/>
<meta name="DC.type" content="Learn/Docs/APM Server/Reference/6.7"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="6.7"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Server Reference [6.7]</a></span>
»
<span class="breadcrumb-link"><a href="tune-data-ingestion.html">Tune Data Ingestion</a></span>
»
<span class="breadcrumb-node">Tune APM Server</span>
</div>
<div class="navheader">
<span class="prev">
<a href="tune-data-ingestion.html">« Tune Data Ingestion</a>
</span>
<span class="next">
<a href="tune-es.html">Tune Elasticsearch »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="tune-apm-server"></a>Tune APM Server<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/6.7/docs/data-ingestion.asciidoc">edit</a></h2>
</div></div></div>
<p>Version 6.5 of the APM Server introduced a new <a class="xref" href="intake-api.html" title="Intake API">intake API</a>. If you have not upgraded your APM Agent, you&#8217;ll continue to use the deprecated v1 intake API endpoint. If you have upgraded your agent, you&#8217;ll use the new v2 intake API endpoint. Understanding which endpoint your APM Agents use to communicate with your APM Server is vital to correctly tuning your data ingestion. Read the <a class="xref" href="upgrading-to-65.html#intake-api-changes-65" title="Intake API Changes">intake API changes</a> documentation to learn more.</p>
<p>Tuning topics:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="tune-apm-server.html#tune-output-config" title="Tune APM Server output parameters for your Elasticsearch cluster">Tune APM Server output parameters for your Elasticsearch cluster</a>
</li>
<li class="listitem">
<a class="xref" href="tune-apm-server.html#adjust-queue-size" title="Adjust internal queue size">Adjust internal queue size</a>
</li>
<li class="listitem">
<a class="xref" href="tune-apm-server.html#adjust-concurrent-requests" title="Adjust concurrent requests">Adjust concurrent requests <span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.5</span>]
<span class="Admonishment-detail">
Deprecated in 6.5.
</span>
</span></a>
</li>
<li class="listitem">
<a class="xref" href="tune-apm-server.html#add-apm-server-instances" title="Add APM Server instances">Add APM Server instances</a>
</li>
<li class="listitem">
<a class="xref" href="tune-apm-server.html#reduce-payload-size" title="Reduce the payload size">Reduce the payload size</a>
</li>
<li class="listitem">
<a class="xref" href="tune-apm-server.html#adjust-event-rate" title="Adjust RUM event rate limit">Adjust RUM event rate limit</a>
</li>
<li class="listitem">
<a class="xref" href="tune-apm-server.html#use-v1-and-v2" title="Tuning APM Server using both v1 and v2 intake API">Tuning APM Server using both v1 and v2 intake API</a>
</li>
</ul>
</div>
<h3><a id="tune-output-config"></a>Tune APM Server output parameters for your Elasticsearch cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/6.7/docs/data-ingestion.asciidoc">edit</a></h3>
<p>If your Elasticsearch cluster is not ingesting the amount of data you expect,
you can tweak a few APM Server settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Adjust <code class="literal">output.elasticsearch.workers</code>.
See <a href="/guide/en/elasticsearch/reference/6.7/tune-for-indexing-speed.html" class="ulink" target="_top">tune for indexing speed</a> for an overview.
</li>
<li class="listitem">
Ensure <code class="literal">output.elasticsearch.bulk_max_size</code> is set to a high value, for example 5120.
The default of 50 is very conservative.
</li>
<li class="listitem">
Ensure that <code class="literal">queue.mem.events</code> is set to a reasonable value compared to your other settings.
A good rule of thumb is that <code class="literal">queue.mem.events</code> should equal <code class="literal">output.elasticsearch.worker</code> multiplied by <code class="literal">output.elasticsearch.bulk_max_size</code>.
</li>
</ul>
</div>
<p>The <a class="xref" href="configuring-output.html" title="Configure the output">output configuration</a> section shows more details.</p>
<h3><a id="adjust-queue-size"></a>Adjust internal queue size<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/6.7/docs/data-ingestion.asciidoc">edit</a></h3>
<p>APM Server uses an internal queue to buffer incoming events.
A larger queue can retain more data if Elasticsearch is unavailable for longer periods,
and it alleviates problems that might result from sudden spikes of traffic.
You can adjust the queue size by overriding <a class="xref" href="configuration-process.html#mem.events" title="events"><code class="literal">queue.mem.events</code></a>.
Increasing <a class="xref" href="configuration-process.html#mem.events" title="events"><code class="literal">queue.mem.events</code></a> can significantly affect APM Server memory usage.</p>
<h3><a id="adjust-concurrent-requests"></a>Adjust concurrent requests <span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.5</span>]
<span class="Admonishment-detail">
Deprecated in 6.5.
</span>
</span><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/6.7/docs/data-ingestion.asciidoc">edit</a></h3>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This setting only impacts agents using <span class="strong strong"><strong>v1</strong></span> of the APM Server <a class="xref" href="intake-api.html" title="Intake API">intake API</a>.</p>
</div>
</div>
<p>APM Server has a limit to how many requests can be processed concurrently.
This limit is determined by the <a class="xref" href="configuration-process.html#concurrent_requests" title="concurrent_request"><code class="literal">apm-server.concurrent_requests</code></a> setting.
Increasing this value will improve throughput, but it can significantly affect APM Server memory usage.</p>
<h3><a id="add-apm-server-instances"></a>Add APM Server instances<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/6.7/docs/data-ingestion.asciidoc">edit</a></h3>
<p>If the APM Server cannot process data quickly enough,
you will see request timeouts.</p>
<p>One way to solve this problem is to increase processing power.
This can be done by either migrating your APM Server to a more powerful machine
or adding more APM Server instances.
Having several instances will also increase <a class="xref" href="high-availability.html" title="High Availability">availability</a>.</p>
<h3><a id="reduce-payload-size"></a>Reduce the payload size<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/6.7/docs/data-ingestion.asciidoc">edit</a></h3>
<p>Large payloads may result in request timeouts.
You can reduce the payload size by decreasing the flush interval in the agents.
This will cause agents to send smaller and more frequent requests.</p>
<p>Optionally you can also <a class="xref" href="reduce-storage.html#reduce-sample-rate" title="Reduce the sample rate">reduce the sample rate</a> or <a class="xref" href="reduce-storage.html#reduce-stacktrace" title="Reduce collected stacktrace information">reduce the amount of stacktraces</a>.</p>
<p>Read more in the <a href="/guide/en/apm/agent/index.html" class="ulink" target="_top">agents documentation</a>.</p>
<h3><a id="adjust-event-rate"></a>Adjust RUM event rate limit<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/6.7/docs/data-ingestion.asciidoc">edit</a></h3>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This setting impacts agents using <span class="strong strong"><strong>v2</strong></span> of the APM Server <a class="xref" href="intake-api.html" title="Intake API">intake API</a>. If you&#8217;re using an agent that supports v1, see the <a class="xref" href="upgrading-to-65.html#server-config-changes-65" title="Server Configuration Changes">server configuration changes</a> documentation.</p>
</div>
</div>
<p>Agents make use of long running requests and flush as many events over a single request as possible. Thus, the rate limiter for RUM is bound to the number of <em>events</em> sent per second, per IP.</p>
<p>If the rate limit is hit while events on an established request are sent, the request is not immediately terminated. The intake of events is only throttled to <a class="xref" href="configuration-rum.html#event_rate.limit" title="event_rate.limit"><code class="literal">event_rate.limit</code></a>, which means that events are queued and processed slower. Only when the allowed buffer queue is also full, does the request get terminated with a <code class="literal">429 - rate limit exceeded</code> HTTP response. If an agent tries to establish a new request, but the rate limit is already hit, a <code class="literal">429</code> will be sent immediately.</p>
<p>Increasing the <a class="xref" href="configuration-rum.html#event_rate.limit" title="event_rate.limit"><code class="literal">event_rate.limit</code></a> default value will help avoid <code class="literal">rate limit exceeded</code> errors.</p>
<h3><a id="use-v1-and-v2"></a>Tuning APM Server using both v1 and v2 intake API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/6.7/docs/data-ingestion.asciidoc">edit</a></h3>
<p>Depending on your agent versions, it is possible that the APM Server may need to communicate with the agents by using both of the intake API versions.</p>
<p>For example, if you have a v1.x Node.js agent, and a v4.x Python agent, the Node.js agent will communicate via the v1 endpoint, and the Python agent will communicate via the v2 endpoint.</p>
<p>In this instance, you&#8217;ll need to adjust both the deprecated, and newly introduced <a class="xref" href="configuration-process.html" title="General configuration options">configuration options</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Check the <a href="/guide/en/apm/get-started/6.7/agent-server-compatibility.html" class="ulink" target="_top">agent/server compatibility matrix</a> for compatibility information.</p>
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="tune-data-ingestion.html">« Tune Data Ingestion</a>
</span>
<span class="next">
<a href="tune-es.html">Tune Elasticsearch »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
