<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Crawl a private network using a web crawler on Elastic Cloud | Elastic App Search Documentation [8.1] | Elastic</title>
<link rel="home" href="index.html" title="Elastic App Search Documentation [8.1]"/>
<link rel="up" href="guides.html" title="Guides"/>
<link rel="prev" href="crawl-web-content.html" title="Crawl web content"/>
<link rel="next" href="curations-guide.html" title="Curations"/>
<meta name="DC.type" content="Learn/Docs/App Search/Guide/8.1"/>
<meta name="DC.subject" content="App Search"/>
<meta name="DC.identifier" content="8.1"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elastic App Search Documentation [8.1]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="guides.html">Guides</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="crawl-web-content.html">« Crawl web content</a>
</span>
<span class="next">
<a href="curations-guide.html">Curations »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="crawl-private-network-cloud"></a>Crawl a private network using a web crawler on Elastic Cloud<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.1/app-search-docs/guides/crawl-private-network-cloud.asciidoc">edit</a></h2>
</div></div></div>
<p>Since version 7.16.1, the Elastic web crawler can crawl content on a private network if the content is accessible through an HTTP proxy.</p>
<p>This document explains how to configure the web crawler to crawl a private network by walking through a detailed example.</p>
<p>The <a href="/guide/en/app-search/8.1/web-crawler.html" class="ulink" target="_top">Enterprise Search web crawler</a> is hosted on Elastic Cloud, but has access to protected resources in private networks and other non-public environments.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="crawl-private-network-cloud-overview"></a>Infrastructure overview<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.1/app-search-docs/guides/crawl-private-network-cloud.asciidoc">edit</a></h3>
</div></div></div>
<p>To demonstrate the authenticated proxy server functionality for Enterprise Search web crawler, we will use the infrastructure outlined in this schematic diagram:</p>
<div class="imageblock">
<div class="content">
<img src="images/app-search/crawler-proxy-schematic.png" alt="crawler proxy schematic">
</div>
</div>
<p>This example has all the components needed to understand the use case:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A VPC (virtual private network) deployed within Google Cloud
</li>
<li class="listitem">
<p>The VPC contains two cloud instances: <code class="literal">web-server</code> and <code class="literal">proxy</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The web-server hosts a private website, that is only accessible from within the VPC, using a private domain name: <a href="http://marlin-docs.internal" class="ulink" target="_top">http://marlin-docs.internal</a>.
</li>
<li class="listitem">
The proxy server has basic HTTP authentication set up with the <span class="strong strong"><strong>username</strong></span> <code class="literal">proxyuser</code> and <span class="strong strong"><strong>password</strong></span> <code class="literal">proxypass</code>.
It is accessible from the public internet using the <span class="strong strong"><strong>host name</strong></span> <code class="literal">proxy.example.com</code> and the <span class="strong strong"><strong>port number</strong></span> <code class="literal">3128</code>.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>An Enterprise Search deployment running outside of the VPC, in Elastic Cloud.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This deployment has no access to the private network hosting our content.
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Enterprise Search web crawler supports both HTTP and HTTPS.
However, we recommend configuring TLS to protect your content and proxy server credentials.</p>
<p>Refer to your proxy server software documentation for more details on how to set this up.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="crawl-private-network-cloud-test-proxy"></a>Testing proxy connections<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.1/app-search-docs/guides/crawl-private-network-cloud.asciidoc">edit</a></h3>
</div></div></div>
<p>Before changing your Enterprise Search deployment configuration to use the HTTP proxy described above,
first make sure the proxy works and allows access to the private website.</p>
<p>You can configure your web browser to use the proxy and then try to access the private website.
Alternatively, use the following command to fetch the home page from the site using a given proxy:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">curl --head --proxy https://proxyuser:proxypass@proxy.example.com http://marlin-docs.internal</pre>
</div>
<p>This request makes a <code class="literal">HEAD</code> request to the website, using the proxy.
The response should be an <code class="literal">HTTP 200</code> with a set of additional headers.
Here is an example response:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 42337
Accept-Ranges: bytes
Server: nginx/1.14.2
Date: Tue, 30 Nov 2021 19:19:14 GMT
Last-Modified: Tue, 30 Nov 2021 17:57:39 GMT
ETag: "61a66613-a561"
Age: 4
X-Cache: HIT from test-proxy
X-Cache-Lookup: HIT from test-proxy:3128
Via: 1.1 test-proxy (squid/4.6)
Connection: keep-alive</pre>
</div>
<p>We have confirmed that our proxy credentials and connection parameters are correct, and can now change the Enterprise Search configuration.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="crawl-private-network-cloud-configure-ent-search"></a>Configuring Enterprise Search<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.1/app-search-docs/guides/crawl-private-network-cloud.asciidoc">edit</a></h3>
</div></div></div>
<p>To prepare our Enterprise Search deployment to use the HTTP proxy for all {crawler }operations, we need to add the following <a href="/guide/en/cloud/current/ec-manage-enterprise-search-settings.html" class="ulink" target="_top">user settings</a>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">crawler.http.proxy.host: proxy.example.com
crawler.http.proxy.port: 3128
crawler.http.proxy.protocol: https
crawler.http.proxy.username: proxyuser
crawler.http.proxy.password: proxypass</pre>
</div>
<p>When this configuration is added, the deployment will perform a graceful restart.
You can find detailed instructions on how to work with custom configurations in our <a href="/guide/en/cloud/current/ec-manage-enterprise-search-settings.html" class="ulink" target="_top">official Elastic Cloud documentation</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>HTTP proxy with basic authentication requires an appropriate Elastic subscription level.
Refer to the Elastic subscriptions pages for <a href="/subscriptions/cloud" class="ulink" target="_blank" rel="noopener">Elastic Cloud</a> and <a href="/subscriptions" class="ulink" target="_top">self-managed</a> deployments.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="crawl-private-network-cloud-test-solution"></a>Testing the solution<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.1/app-search-docs/guides/crawl-private-network-cloud.asciidoc">edit</a></h3>
</div></div></div>
<p>With the configuration complete, we can now test the solution.
Create an App Search engine and use the Web Crawler feature to ingest content into the engine:</p>
<div class="imageblock">
<div class="content">
<img src="images/app-search/crawler-proxy-validation.png" alt="crawler proxy validation">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The validation process for adding a domain to the Enterprise Search web crawler configuration will skip a number of networking-related checks, since these do not work through a proxy.
If you do not see the warning in the above image, check your deployment configuration to ensure you have configured the proxy correctly.</p>
</div>
</div>
<p>Our private domain is now added to the configuration.
We can start the crawl, and the content should be ingested into the deployment.
If there are failures, check your <a href="/guide/en/app-search/8.1/" class="ulink" target="_top">crawler logs</a> and proxy server&#8217;s logs for clues about what might be going wrong.</p>
<p>If you are using a Squid proxy server, the logs should look like this:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">1638298043.202      1 99.250.74.78 TCP_MISS/200 65694 GET http://marlin-docs.internal/docs/gcode/M951.html proxyuser HIER_DIRECT/10.188.0.2 text/html
1638298045.286      1 99.250.74.78 TCP_MISS/200 64730 GET http://marlin-docs.internal/docs/gcode/M997.html proxyuser HIER_DIRECT/10.188.0.2 text/html
1638298045.373      1 99.250.74.78 TCP_MISS/200 63609 GET http://marlin-docs.internal/docs/gcode/M999.html proxyuser HIER_DIRECT/10.188.0.2 text/html</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="crawl-web-content.html">« Crawl web content</a>
</span>
<span class="next">
<a href="curations-guide.html">Curations »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
