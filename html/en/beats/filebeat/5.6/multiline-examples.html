<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Managing Multiline Messages | Filebeat Reference [5.6] | Elastic</title>
<link rel="home" href="index.html" title="Filebeat Reference [5.6]"/>
<link rel="up" href="configuring-howto-filebeat.html" title="Configuring Filebeat"/>
<link rel="prev" href="filtering-and-enhancing-data.html" title="Filtering and Enhancing the Exported Data"/>
<link rel="next" href="configuring-ingest-node.html" title="Configuring Filebeat to Use Ingest Node"/>
<meta name="DC.type" content="Learn/Docs/Filebeat/Reference/5.6"/>
<meta name="DC.subject" content="Filebeat"/>
<meta name="DC.identifier" content="5.6"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<p>
  <strong>WARNING</strong>: Version 5.6 of Filebeat has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Filebeat Reference [5.6]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="configuring-howto-filebeat.html">Configuring Filebeat</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="filtering-and-enhancing-data.html">« Filtering and Enhancing the Exported Data</a>
</span>
<span class="next">
<a href="configuring-ingest-node.html">Configuring Filebeat to Use Ingest Node »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="multiline-examples"></a>Managing Multiline Messages<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/5.6/filebeat/docs/multiline.asciidoc">edit</a></h2>
</div></div></div>
<p>The files harvested by Filebeat may contain messages that span multiple lines of text. In order to correctly handle
these multiline events, you need to configure <code class="literal">multiline</code> settings in the <code class="literal">filebeat.yml</code> file to specify which
lines are part of a single event.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are sending multiline events to Logstash, use the options described here to handle multiline events
before sending the event data to Logstash. Trying to implement multiline event handling in Logstash (for example, by
using the Logstash multiline codec) may result in the mixing of streams and corrupted data.</p>
</div>
</div>
<p>At a minimum, you need to configure these <code class="literal">multiline</code> options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
the <code class="literal">pattern</code> option, which specifies a regular expression. Depending on how you configure other multiline options,
lines that match the specified regular expression are considered either continuations of a previous line or the start of a new multiline event. You can set the <code class="literal">negate</code> option to negate the pattern.
</li>
<li class="listitem">
the <code class="literal">match</code> option, which specifies how Filebeat combines matching lines into an event. You can specify <code class="literal">before</code> or <code class="literal">after</code>.
</li>
</ul>
</div>
<p>See the full documentation for <a class="xref" href="configuration-filebeat-options.html#multiline" title="multiline">multiline</a> to learn more about these options. Also read <a class="xref" href="yaml-tips.html" title="YAML Tips and Gotchas"><em>YAML Tips and Gotchas</em></a> and
<a class="xref" href="regexp-support.html" title="Regular Expression Support"><em>Regular Expression Support</em></a> to avoid common mistakes.</p>
<h3><a id="_testing_your_regexp_pattern_for_multiline"></a>Testing Your Regexp Pattern for Multiline<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/5.6/filebeat/docs/multiline.asciidoc">edit</a></h3>
<p>To make it easier for you to test the regexp patterns in your multiline config, we&#8217;ve created a
<a href="https://play.golang.org/p/uAd5XHxscu" class="ulink" target="_top">Go Playground</a>. You can simply plug in the regexp pattern along with
the <code class="literal">negate</code> setting that you plan to use, and paste a sample message between the content backticks (` `).
Then click Run, and you&#8217;ll see which lines in the message match your specified configuration. For example:</p>
<p><span class="image"><img src="images/go-playground.png" alt="go playground"></span></p>
<h3><a id="_examples_of_multiline_configuration"></a>Examples of Multiline Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/5.6/filebeat/docs/multiline.asciidoc">edit</a></h3>
<p>The examples in this section cover the following use cases:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Combining a Java stack trace into a single event
</li>
<li class="listitem">
Combining C-style line continuations into a single event
</li>
<li class="listitem">
Combining multiple lines from time-stamped events
</li>
</ul>
</div>
<h4><a id="_java_stack_traces"></a>Java Stack Traces<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/5.6/filebeat/docs/multiline.asciidoc">edit</a></h4>
<p>Java stack traces consist of multiple lines, with each line after the initial line beginning with whitespace, as in
this example:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Exception in thread "main" java.lang.NullPointerException
        at com.example.myproject.Book.getTitle(Book.java:16)
        at com.example.myproject.Author.getBookTitles(Author.java:25)
        at com.example.myproject.Bootstrap.main(Bootstrap.java:14)</pre>
</div>
<p>To consolidate these lines into a single event in Filebeat, use the following multiline configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">multiline.pattern: '^[[:space:]]'
multiline.negate: false
multiline.match: after</pre>
</div>
<p>This configuration merges any line that begins with whitespace up to the previous line.</p>
<p>Here&#8217;s a Java stack trace that presents a slightly more complex example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">Exception in thread "main" java.lang.IllegalStateException: A book has a null property
       at com.example.myproject.Author.getBookIds(Author.java:38)
       at com.example.myproject.Bootstrap.main(Bootstrap.java:14)
Caused by: java.lang.NullPointerException
       at com.example.myproject.Book.getId(Book.java:22)
       at com.example.myproject.Author.getBookIds(Author.java:35)
       ... 1 more</pre>
</div>
<p>To consolidate these lines into a single event in Filebeat, use the following multiline configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">multiline.pattern: '^[[:space:]]+(at|\.{3})\b|^Caused by:'
multiline.negate: false
multiline.match: after</pre>
</div>
<p>In this example, the pattern matches the following lines:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
a line that begins with spaces followed by the word <code class="literal">at</code> or <code class="literal">...</code>
</li>
<li class="listitem">
a line that begins with the words <code class="literal">Caused by:</code>
</li>
</ul>
</div>
<h4><a id="_line_continuations"></a>Line Continuations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/5.6/filebeat/docs/multiline.asciidoc">edit</a></h4>
<p>Several programming languages use the backslash (<code class="literal">\</code>) character at the end of a line to denote that the line continues,
as in this example:</p>
<div class="pre_wrapper lang-c">
<pre class="programlisting prettyprint lang-c">printf ("%10.10ld  \t %10.10ld \t %s\
  %f", w, x, y, z );</pre>
</div>
<p>To consolidate these lines into a single event in Filebeat, use the following multiline configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">multiline.pattern: '\\$'
multiline.negate: false
multiline.match: before</pre>
</div>
<p>This configuration merges any line that ends with the <code class="literal">\</code> character with the line that follows.</p>
<h4><a id="_timestamps"></a>Timestamps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/5.6/filebeat/docs/multiline.asciidoc">edit</a></h4>
<p>Activity logs from services such as Elasticsearch typically begin with a timestamp, followed by information on the
specific activity, as in this example:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">[2015-08-24 11:49:14,389][INFO ][env                      ] [Letha] using [1] data paths, mounts [[/
(/dev/disk1)]], net usable_space [34.5gb], net total_space [118.9gb], types [hfs]</pre>
</div>
<p>To consolidate these lines into a single event in Filebeat, use the following multiline configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">multiline.pattern: '^\[[0-9]{4}-[0-9]{2}-[0-9]{2}'
multiline.negate: true
multiline.match: after</pre>
</div>
<p>This configuration uses the <code class="literal">negate: true</code> and <code class="literal">match: after</code> settings to specify that any line that does not match the
specified pattern belongs to the previous line.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="filtering-and-enhancing-data.html">« Filtering and Enhancing the Exported Data</a>
</span>
<span class="next">
<a href="configuring-ingest-node.html">Configuring Filebeat to Use Ingest Node »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
