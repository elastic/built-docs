<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>AWS S3 input | Filebeat Reference [8.7] | Elastic</title>
<meta class="elastic" name="content" content="AWS S3 input | Filebeat Reference [8.7]">

<link rel="home" href="index.html" title="Filebeat Reference [8.7]"/>
<link rel="up" href="configuration-filebeat-options.html" title="Configure inputs"/>
<link rel="prev" href="filebeat-input-aws-cloudwatch.html" title="AWS CloudWatch input"/>
<link rel="next" href="filebeat-input-azure-eventhub.html" title="Azure eventhub input"/>
<meta class="elastic" name="product_version" content="8.7"/>
<meta class="elastic" name="product_name" content="Filebeat"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Filebeat/Reference/8.7"/>
<meta name="DC.subject" content="Filebeat"/>
<meta name="DC.identifier" content="8.7"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Filebeat Reference [8.7]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-filebeat.html">Configure Filebeat</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuration-filebeat-options.html">Configure inputs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="filebeat-input-aws-cloudwatch.html">« AWS CloudWatch input</a>
</span>
<span class="next">
<a href="filebeat-input-azure-eventhub.html">Azure eventhub input »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="filebeat-input-aws-s3"></a>AWS S3 input<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h2>
</div></div></div>

<p>Use the <code class="literal">aws-s3</code> input to retrieve logs from S3 objects that are pointed to by
S3 notification events read from an SQS queue or directly polling list of S3 objects in an S3 bucket.
The use of SQS notification is preferred: polling list of S3 objects is expensive
in terms of performance and costs and should be preferably used only when no SQS
notification can be attached to the S3 buckets. This input can, for example, be
used to receive S3 access logs to monitor detailed records for the requests that
are made to a bucket. This input also supports S3 notification from SNS to SQS.</p>
<p>SQS notification method is enabled setting <code class="literal">queue_url</code> configuration value.
S3 bucket list polling method is enabled setting <code class="literal">bucket_arn</code> configuration value.
Both value cannot be set at the same time, at least one of the two value must be set.</p>
<p>When using the SQS notification method this input depends on S3 notifications delivered
to an SQS queue for <code class="literal">s3:ObjectCreated:*</code> events. You must create an SQS queue and configure S3
to publish events to the queue.</p>
<p>When processing a S3 object which pointed by a SQS message, if half of the set
visibility timeout passed and the processing is still ongoing, then the
visibility timeout of that SQS message will be reset to make sure the message
does not go back to the queue in the middle of the processing. If there are
errors happening during the processing of the S3 object, then the process will
be stopped and the SQS message will be returned back to the queue.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  queue_url: https://sqs.ap-southeast-1.amazonaws.com/1234/test-s3-queue
  credential_profile_name: elastic-beats
  expand_event_list_from_field: Records</pre>
</div>
<p>When using the direct polling list of S3 objects in an S3 buckets,
a number of workers that will process the S3 objects listed must be set
through the <code class="literal">number_of_workers</code> config.
Listing of the S3 bucket will be polled according the time interval defined by
<code class="literal">bucket_list_interval</code> config. Default value is 120secs.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  bucket_arn: arn:aws:s3:::test-s3-bucket
  number_of_workers: 5
  bucket_list_interval: 300s
  credential_profile_name: elastic-beats
  expand_event_list_from_field: Records</pre>
</div>
<p>The <code class="literal">aws-s3</code> input can also poll 3rd party S3 compatible services such as the self hosted Minio.
Using non-AWS S3 compatible buckets requires the use of <code class="literal">access_key_id</code> and <code class="literal">secret_access_key</code> for authentication.
To specify the S3 bucket name, use the <code class="literal">non_aws_bucket_name</code> config and the <code class="literal">endpoint</code> must be set to replace the default API endpoint.
<code class="literal">endpoint</code> should be a full URI in the form of <code class="literal">https(s)://&lt;s3 endpoint&gt;</code> in the case of <code class="literal">non_aws_bucket_name</code>, that will be used as the API endpoint of the service.
No <code class="literal">endpoint</code> is needed if using the native AWS S3 service hosted at <code class="literal">amazonaws.com</code>.
Please see <a class="xref" href="filebeat-input-aws-s3.html#aws-credentials-config" title="AWS Credentials Configuration">Configuration parameters</a> for alternate AWS domains that require a different endpoint.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  non_aws_bucket_name: test-s3-bucket
  number_of_workers: 5
  bucket_list_interval: 300s
  access_key_id: xxxxxxx
  secret_access_key: xxxxxxx
  endpoint: https://s3.example.com:9000
  expand_event_list_from_field: Records</pre>
</div>
<p>The <code class="literal">aws-s3</code> input supports the following configuration options plus the
<a class="xref" href="filebeat-input-aws-s3.html#filebeat-input-aws-s3-common-options" title="Common options">Common options</a> described later.</p>
<h4><a id="_api_timeout_2"></a><code class="literal">api_timeout</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The maximum duration of the AWS API call. If it exceeds the timeout, the AWS API
call will be interrupted. The default AWS API timeout is <code class="literal">120s</code>.</p>
<p>The API timeout must be longer than the <code class="literal">sqs.wait_time</code> value.</p>
<h4><a id="input-aws-s3-buffer_size"></a><code class="literal">buffer_size</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The size in bytes of the buffer that each harvester uses when fetching a file.
This only applies to non-JSON logs. The default is <code class="literal">16 KiB</code>.</p>
<h4><a id="input-aws-s3-content_type"></a><code class="literal">content_type</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>A standard MIME type describing the format of the object data.  This
can be set to override the MIME type that was given to the object when
it was uploaded. For example: <code class="literal">application/json</code>.</p>
<h4><a id="input-aws-s3-encoding"></a><code class="literal">encoding</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The file encoding to use for reading data that contains international
characters. This only applies to non-JSON logs. See <a class="xref" href="filebeat-input-log.html#_encoding_3" title="encoding"><code class="literal">encoding</code></a>.</p>
<h4><a id="_expand_event_list_from_field"></a><code class="literal">expand_event_list_from_field</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>If the fileset using this input expects to receive multiple messages bundled
under a specific field then the config option <code class="literal">expand_event_list_from_field</code>
value can be assigned the name of the field. This setting will be able to split
the messages under the group value into separate events. For example, CloudTrail
logs are in JSON format and events are found under the JSON object "Records".</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
    "Records": [
        {
            "eventVersion": "1.07",
            "eventTime": "2019-11-14T00:51:00Z",
            "awsRegion": "us-east-1",
            "eventID": "EXAMPLE8-9621-4d00-b913-beca2EXAMPLE",
        },
        {
            "eventVersion": "1.07",
            "eventTime": "2019-11-14T00:52:00Z",
            "awsRegion": "us-east-1",
            "eventID": "EXAMPLEc-28be-486c-8928-49ce6EXAMPLE",
        }
    ]
}</pre>
</div>
<p>Note: When <code class="literal">expand_event_list_from_field</code> parameter is given in the config,
aws-s3 input will assume the logs are in JSON format and decode them as JSON.
Content type will not be checked. If a file has "application/json" content-type,
<code class="literal">expand_event_list_from_field</code> becomes required to read the JSON file.</p>
<h4><a id="_file_selectors"></a><code class="literal">file_selectors</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>If the SQS queue will have events that correspond to files that
Filebeat shouldn&#8217;t process <code class="literal">file_selectors</code> can be used to limit
the files that are downloaded.  This is a list of selectors which are
made up of <code class="literal">regex</code> and <code class="literal">expand_event_list_from_field</code> options.  The
<code class="literal">regex</code> should match the S3 object key in the SQS message, and the
optional <code class="literal">expand_event_list_from_field</code> is the same as the global
setting.  If <code class="literal">file_selectors</code> is given, then any global
<code class="literal">expand_event_list_from_field</code> value is ignored in favor of the ones
specified in the <code class="literal">file_selectors</code>.  Regex syntax is the same as the Go
language.  Files that don&#8217;t match one of the regexes won&#8217;t be
processed.  <a class="xref" href="filebeat-input-aws-s3.html#input-aws-s3-content_type" title="content_type"><code class="literal">content_type</code></a>, <a class="xref" href="filebeat-input-aws-s3.html#input-aws-s3-parsers" title="parsers"><code class="literal">parsers</code></a>,
<a class="xref" href="filebeat-input-aws-s3.html#input-aws-s3-include_s3_metadata" title="include_s3_metadata"><code class="literal">include_s3_metadata</code></a>,<a class="xref" href="filebeat-input-aws-s3.html#input-aws-s3-max_bytes" title="max_bytes"><code class="literal">max_bytes</code></a>,
<a class="xref" href="filebeat-input-aws-s3.html#input-aws-s3-buffer_size" title="buffer_size"><code class="literal">buffer_size</code></a>, and <a class="xref" href="filebeat-input-aws-s3.html#input-aws-s3-encoding" title="encoding"><code class="literal">encoding</code></a> may also
be set for each file selector.</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">file_selectors:
  - regex: '/CloudTrail/'
    expand_event_list_from_field: 'Records'
  - regex: '/CloudTrail-Digest/'
  - regex: '/CloudTrail-Insight/'
    expand_event_list_from_field: 'Records'</pre>
</div>
<h4><a id="_fips_enabled"></a><code class="literal">fips_enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Moved to <a class="xref" href="filebeat-input-aws-s3.html#aws-credentials-config" title="AWS Credentials Configuration">AWS credentials options</a>.</p>
<h4><a id="input-aws-s3-include_s3_metadata"></a><code class="literal">include_s3_metadata</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>This input can include S3 object metadata in the generated events for use in
follow-on processing. You must specify the list of keys to include. By default
none are included. If the key exists in the S3 response then it will be included
in the event as <code class="literal">aws.s3.metadata.&lt;key&gt;</code> where the key name as been normalized
to all lowercase.</p>
<pre class="screen">include_s3_metadata:
  - last-modified
  - x-amz-version-id</pre>
<h4><a id="input-aws-s3-max_bytes"></a><code class="literal">max_bytes</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The maximum number of bytes that a single log message can have. All bytes after
<code class="literal">max_bytes</code> are discarded and not sent. This setting is especially useful for
multiline log messages, which can get large. This only applies to non-JSON logs.
The default is <code class="literal">10 MiB</code>.</p>
<h4><a id="_max_number_of_messages"></a><code class="literal">max_number_of_messages</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The maximum number of SQS messages that can be inflight at any time. Defaults
to 5.</p>
<h4><a id="input-aws-s3-parsers"></a><code class="literal">parsers</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>This option expects a list of parsers that non-JSON logs go through.</p>
<p>Available parsers:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">multiline</code>
</li>
</ul>
</div>
<p>In this example, Filebeat is reading multiline messages that
consist of XML that start with the <code class="literal">&lt;Event&gt;</code> tag.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  ...
  parsers:
    - multiline:
        pattern: "^&lt;Event"
        negate:  true
        match:   after</pre>
</div>
<p>See the available parser settings in detail below.</p>
<h5><a id="_multiline"></a><code class="literal">multiline</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h5>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Options that control how Filebeat deals with log messages that span
multiple lines. See <a class="xref" href="multiline-examples.html" title="Manage multiline messages">Multiline messages</a> for more information about
configuring multiline options.</p>
<h4><a id="_queue_url"></a><code class="literal">queue_url</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>URL of the AWS SQS queue that messages will be received from. (Required when <code class="literal">bucket_arn</code> and <code class="literal">non_aws_bucket_name</code> are not set).</p>
<h4><a id="_visibility_timeout"></a><code class="literal">visibility_timeout</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The duration that the received SQS messages are hidden from subsequent retrieve
requests after being retrieved by a <code class="literal">ReceiveMessage</code> request. The default
visibility timeout is <code class="literal">300s</code>. The maximum is <code class="literal">12h</code>. Filebeat will
automatically reset the visibility timeout of a message after 1/2 of the
duration passes to prevent a message that is still being processed from
returning to the queue.</p>
<h4><a id="_sqs_max_receive_count"></a><code class="literal">sqs.max_receive_count</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The maximum number of times a SQS message should be received (retried) before
deleting it. This feature prevents poison-pill messages (messages that can be
received but can&#8217;t be processed) from consuming resources. The number of times
a message has been received is tracked using the <code class="literal">ApproximateReceiveCount</code> SQS
attribute. The default value is 5.</p>
<p>If you have configured a dead letter queue then you can set this value to
<code class="literal">-1</code> to disable deletion on failure.</p>
<h4><a id="_sqs_notification_parsing_script_source"></a><code class="literal">sqs.notification_parsing_script.source</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Inline Javascript source code.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">sqs.notification_parsing_script.source: &gt;
  function parse(notification) {
      var evts = [];
      var evt = new S3EventV2();
      evt.SetS3BucketName(notification.bucket);
      evt.SetS3ObjectKey(notification.path);
      evts.push(evt);
      return evts;
  }</pre>
</div>
<h4><a id="_sqs_notification_parsing_script_file"></a><code class="literal">sqs.notification_parsing_script.file</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Path to a script file to load. Relative paths are interpreted as
relative to the <code class="literal">path.config</code> directory. Globs are expanded.</p>
<p>This loads <code class="literal">filter.js</code> from disk.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">sqs.notification_parsing_script.file: ${path.config}/filter.js</pre>
</div>
<h4><a id="_sqs_notification_parsing_script_files"></a><code class="literal">sqs.notification_parsing_script.files</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>List of script files to load. The scripts are concatenated together.
Relative paths are interpreted as relative to the <code class="literal">path.config</code> directory.
And globs are expanded.</p>
<h4><a id="_sqs_notification_parsing_script_params"></a><code class="literal">sqs.notification_parsing_script.params</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>A dictionary of parameters that are passed to the <code class="literal">register</code> of the
script.</p>
<p>Parameters can be passed to the script by adding <code class="literal">params</code> to the config.
This allows for a script to be made reusable. When using <code class="literal">params</code> the
code must define a <code class="literal">register(params)</code> function to receive the parameters.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">sqs.notification_parsing_script:
  params:
    provider: aws:s3
  source: &gt;
    var params = {provider: ""};
    function register(scriptParams) {
      params = scriptParams;
    }
    function parse(notification) {
      var evts = [];
      var evt = new S3EventV2();
      evt.SetS3BucketName(notification.bucket);
      evt.SetS3ObjectKey(notification.path);
      evt.SetProvider(params.provider);
      evts.push(evt);
      return evts;
    }</pre>
</div>
<h4><a id="_sqs_notification_parsing_script_timeout"></a><code class="literal">sqs.notification_parsing_script.timeout</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>This sets an execution timeout for the <code class="literal">process</code> function. When
the <code class="literal">process</code> function takes longer than the <code class="literal">timeout</code> period the function
is interrupted. You can set this option to prevent a script from running for
too long (like preventing an infinite <code class="literal">while</code> loop). By default there is no
timeout.</p>
<h4><a id="_sqs_notification_parsing_script_max_cached_sessions"></a><code class="literal">sqs.notification_parsing_script.max_cached_sessions</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>This sets the maximum number of Javascript VM sessions
that will be cached to avoid reallocation.</p>
<h4><a id="_sqs_wait_time"></a><code class="literal">sqs.wait_time</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The maximum duration that an SQS <code class="literal">ReceiveMessage</code> call should wait for a message
to arrive in the queue before returning. The default value is <code class="literal">20s</code>. The maximum
value is <code class="literal">20s</code>.</p>
<h4><a id="_bucket_arn"></a><code class="literal">bucket_arn</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>ARN of the AWS S3 bucket that will be polled for list operation. (Required when <code class="literal">queue_url</code> and <code class="literal">non_aws_bucket_name</code> are not set).</p>
<h4><a id="_non_aws_bucket_name"></a><code class="literal">non_aws_bucket_name</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Name of the S3 bucket that will be polled for list operation. Required for 3rd party S3 compatible services. (Required when <code class="literal">queue_url</code> and <code class="literal">bucket_arn</code> are not set).</p>
<h4><a id="_bucket_list_interval"></a><code class="literal">bucket_list_interval</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Time interval for polling listing of the S3 bucket: default to <code class="literal">120s</code>.</p>
<h4><a id="_bucket_list_prefix"></a><code class="literal">bucket_list_prefix</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Prefix to apply for the list request to the S3 bucket. Default empty.</p>
<h4><a id="_number_of_workers_2"></a><code class="literal">number_of_workers</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Number of workers that will process the S3 objects listed. (Required when <code class="literal">bucket_arn</code> is set).</p>
<h4><a id="_provider"></a><code class="literal">provider</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Name of the 3rd party S3 bucket provider like backblaze or GCP.
The following endpoints/providers will be detected automatically:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Domain</p></td>
<td align="left" valign="top"><p>Provider</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>amazonaws.com, amazonaws.com.cn, c2s.sgov.gov, c2s.ic.gov</p></td>
<td align="left" valign="top"><p>aws</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>backblazeb2.com</p></td>
<td align="left" valign="top"><p>backblaze</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>wasabisys.com</p></td>
<td align="left" valign="top"><p>wasabi</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>digitaloceanspaces.com</p></td>
<td align="left" valign="top"><p>digitalocean</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>dream.io</p></td>
<td align="left" valign="top"><p>dreamhost</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>scw.cloud</p></td>
<td align="left" valign="top"><p>scaleway</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>googleapis.com</p></td>
<td align="left" valign="top"><p>gcp</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>cloud.it</p></td>
<td align="left" valign="top"><p>arubacloud</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>linodeobjects.com</p></td>
<td align="left" valign="top"><p>linode</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>vultrobjects.com</p></td>
<td align="left" valign="top"><p>vultr</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>appdomain.cloud</p></td>
<td align="left" valign="top"><p>ibm</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>aliyuncs.com</p></td>
<td align="left" valign="top"><p>alibaba</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>oraclecloud.com</p></td>
<td align="left" valign="top"><p>oracle</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>exo.io</p></td>
<td align="left" valign="top"><p>exoscale</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>upcloudobjects.com</p></td>
<td align="left" valign="top"><p>upcloud</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>ilandcloud.com</p></td>
<td align="left" valign="top"><p>iland</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>zadarazios.com</p></td>
<td align="left" valign="top"><p>zadara</p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="_path_style"></a><code class="literal">path_style</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Enabling this option sets the bucket name as a path in the API call instead of a subdomain. When enabled
<a href="https://&lt;bucket-name&gt;.s3.&lt;region&gt;.&lt;provider&gt;.com" class="ulink" target="_top">https://&lt;bucket-name&gt;.s3.&lt;region&gt;.&lt;provider&gt;.com</a> becomes <a href="https://s3.&lt;region&gt;.&lt;provider&gt;.com/&lt;bucket-name&gt" class="ulink" target="_top">https://s3.&lt;region&gt;.&lt;provider&gt;.com/&lt;bucket-name&gt</a>;.
This is only supported with 3rd party S3 providers.  AWS does not support path style.</p>
<h4><a id="_aws_credentials_2"></a><code class="literal">aws credentials</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>In order to make AWS API calls, <code class="literal">aws-s3</code> input requires AWS credentials. Please
see <a class="xref" href="filebeat-input-aws-s3.html#aws-credentials-config" title="AWS Credentials Configuration">AWS credentials options</a> for more details.</p>
<h4><a id="_backup_to_bucket_arn"></a><code class="literal">backup_to_bucket_arn</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The bucket ARN to backup processed files to. This will copy the processed file after it was fully read.
When using the <code class="literal">non_aws_bucket_name</code>, please use <code class="literal">non_aws_backup_to_bucket_name</code> accordingly.</p>
<p>Naming of the backed up files can be controlled with <code class="literal">backup_to_bucket_prefix</code>.</p>
<h4><a id="_backup_to_bucket_prefix"></a><code class="literal">backup_to_bucket_prefix</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>This prefix will be prepended to the object key when backing it up to another (or the same) bucket.</p>
<h4><a id="_non_aws_backup_to_bucket_name"></a><code class="literal">non_aws_backup_to_bucket_name</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The bucket name to backup processed files to. Use this parameter when not using AWS buckets. This will copy the processed file after it was fully read.
When using the <code class="literal">bucket_arn</code>, please use <code class="literal">backup_to_bucket_arn</code> accordingly.</p>
<p>Naming of the backed up files can be controlled with <code class="literal">backup_to_bucket_prefix</code>.</p>
<h4><a id="_delete_after_backup"></a><code class="literal">delete_after_backup</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>Controls whether fully processed files will be deleted from the bucket.</p>
<p>Can only be used together with the backup functionality.</p>
<h3><a id="_aws_permissions_2"></a>AWS Permissions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h3>
<p>Specific AWS permissions are required for IAM user to access SQS and S3
when using the SQS notifications method:</p>
<pre class="screen">s3:GetObject
sqs:ReceiveMessage
sqs:ChangeMessageVisibility
sqs:DeleteMessage</pre>
<p>Reduced specific S3 AWS permissions are required for IAM user to access S3
when using the polling list of S3 bucket objects:</p>
<pre class="screen">s3:GetObject
s3:ListBucket
s3:GetBucketLocation</pre>
<p>In case <code class="literal">backup_to_bucket_arn</code> or <code class="literal">non_aws_backup_to_bucket_name</code> are set the following permission is required as well:</p>
<pre class="screen">s3:PutObject</pre>
<p>In case <code class="literal">delete_after_backup</code> is set the following permission is required as well:</p>
<pre class="screen">s3:DeleteObject</pre>
<h3><a id="_s3_and_sqs_setup"></a>S3 and SQS setup<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h3>
<p>Enable bucket notification: any new object creation in S3 bucket will also
create a notification through SQS. Please see
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ways-to-add-notification-config-to-bucket.html#step1-create-sqs-queue-for-notification" class="ulink" target="_top">create-sqs-queue-for-notification</a>
for more details.</p>
<h3><a id="_s3_sns_sqs_setup"></a>S3 &#8594; SNS &#8594; SQS setup<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h3>
<p>If you would like to use the bucket notification in multiple different consumers
(others than filebeat), you should use an SNS topic for the bucket notification.
Please see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ways-to-add-notification-config-to-bucket.html#step1-create-sns-topic-for-notification" class="ulink" target="_top">create-SNS-topic-for-notification</a>
for more details. SQS queue will be configured as a
<a href="https://docs.aws.amazon.com/sns/latest/dg/sns-sqs-as-subscriber.html" class="ulink" target="_top">subscriber to the SNS topic</a>.</p>
<h3><a id="_parallel_processing"></a>Parallel Processing<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h3>
<p>When using the SQS notifications method, multiple Filebeat instances can read from the same SQS queues at the same time.
To horizontally scale processing when there are large amounts of log data
flowing into an S3 bucket, you can run multiple Filebeat instances that
read from the same SQS queues at the same time. No additional configuration is
required.</p>
<p>Using SQS ensures that each message in the queue is processed only once even
when multiple Filebeat instances are running in parallel. To prevent
Filebeat from receiving and processing the message more than once, set the
visibility timeout.</p>
<p>The visibility timeout begins when SQS returns a message to Filebeat. During
this time, Filebeat processes and deletes the message. However, if Filebeat
fails before deleting the message and your system doesn&#8217;t call the DeleteMessage
action for that message before the visibility timeout expires, the message
becomes visible to other Filebeat instances, and the message is received
again. By default, the visibility timeout is set to 5 minutes for aws-s3 input
in Filebeat. 5 minutes is sufficient time for Filebeat to read SQS
messages and process related s3 log files.</p>
<p>When using the polling list of S3 bucket objects method be aware that if running multiple Filebeat instances,
they can list the same S3 bucket at the same time. Since the state of the ingested S3 objects is persisted
(upon processing a single list operation) in the <code class="literal">path.data</code> configuration
and multiple Filebeat cannot share the same <code class="literal">path.data</code> this will produce repeated
ingestion of the S3 object.
Therefore, when using the polling list of S3 bucket objects method, scaling should be
vertical, with a single bigger Filebeat instance and higher <code class="literal">number_of_workers</code>
config value.</p>
<h3><a id="_sqs_custom_notification_parsing_script"></a>SQS Custom Notification Parsing Script<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h3>
<p>Under some circumstances you might want to listen to events that are not following
the standard SQS notifications format. To be able to parse them, it is possible to
define a custom script that will take care of processing them and generating the
required list of S3 Events used to download the files.</p>
<p>The <code class="literal">sqs.notification_parsing_script</code> executes Javascript code to process an event.
It uses a pure Go implementation of ECMAScript 5.1 and has no external dependencies.</p>
<p>It can be configured by embedding Javascript in your configuration file or by pointing
the processor at external file(s). Only one of the options <code class="literal">sqs.notification_parsing_script.source</code>, <code class="literal">sqs.notification_parsing_script.file</code>, and <code class="literal">sqs.notification_parsing_script.files</code>
can be set at the same time.</p>
<p>The script requires a <code class="literal">parse(notification)</code> function that receives the notification as
a raw string and returns a list of <code class="literal">S3EventV2</code> objects. This raw string can then be
processed as needed, e.g.: <code class="literal">JSON.parse(n)</code> or the provided helper for XML <code class="literal">new XMLDecoder(n)</code>.</p>
<p>If the script defines a <code class="literal">test()</code> function it will be invoked when it is loaded. Any exceptions thrown will cause the processor to fail to load. This can be used to make assertions about the behavior of the script.</p>
<div class="pre_wrapper lang-javascript">
<pre class="programlisting prettyprint lang-javascript">function parse(n) {
  var m = JSON.parse(n);
  var evts = [];
  var files = m.files;
  var bucket = m.bucket;

  if (!Array.isArray(files) || (files.length == 0) || bucket == null || bucket == "") {
    return evts;
  }

  files.forEach(function(f){
    var evt = new S3EventV2();
    evt.SetS3BucketName(bucket);
    evt.SetS3ObjectKey(f.path);
    evts.push(evt);
  });

  return evts;
}

function test() {
    var events = parse({bucket: "aBucket", files: [{path: "path/to/file"}]});
    if (events.length !== 1) {
      throw "expecting one event";
    }
    if (events[0].S3.Bucket.Name === "aBucket") {
        throw "expected bucket === aBucket";
    }
    if (events[0].S3.Object.Key === "path/to/file") {
        throw "expected bucket === path/to/file";
    }
}</pre>
</div>
<h4><a id="_s3eventv2_api"></a>S3EventV2 API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>The <code class="literal">S3EventV2</code> object returned by the <code class="literal">parse</code> method.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Method</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">new S3EventV2()</code></p></td>
<td align="left" valign="top"><p>Returns a new <code class="literal">S3EventV2</code> object.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">var evt = new S3EventV2();</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">SetAWSRegion(string)</code></p></td>
<td align="left" valign="top"><p>Sets the AWS region.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">evt.SetAWSRegion("us-east-1");</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">SetProvider(string)</code></p></td>
<td align="left" valign="top"><p>Sets the provider.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">evt.SetProvider("provider");</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">SetEventName(string)</code></p></td>
<td align="left" valign="top"><p>Sets the event name.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">evt.SetEventName("event-type");</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">SetEventSource(string)</code></p></td>
<td align="left" valign="top"><p>Sets the event surce.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">evt.SetEventSource("aws:s3");</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">SetS3BucketName(string)</code></p></td>
<td align="left" valign="top"><p>Sets the bucket name.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">evt.SetS3BucketName("bucket-name");</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">SetS3BucketARN(string)</code></p></td>
<td align="left" valign="top"><p>Sets the bucket ARN.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">evt.SetS3BucketARN("bucket-ARN");</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">SetS3ObjectKey(string)</code></p></td>
<td align="left" valign="top"><p>Sets the object key.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">evt.SetS3ObjectKey("path/to/object");</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>In order to be able to retrieve an S3 object successfully, at least <code class="literal">S3.Object.Key</code>
and <code class="literal">S3.Bucket.Name</code> properties must be set (using the provided setters). The other
properties will be used as metadata in the resulting event when available.</p>
<h4><a id="_xmldecoder_api"></a>XMLDecoder API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h4>
<p>To help with XML decoding, an <code class="literal">XMLDecoder</code> class is provided.</p>
<p>Example XML input:</p>
<div class="pre_wrapper lang-xml">
<pre class="programlisting prettyprint lang-xml">&lt;catalog&gt;
  &lt;book seq="1"&gt;
    &lt;author&gt;William H. Gaddis&lt;/author&gt;
    &lt;title&gt;The Recognitions&lt;/title&gt;
    &lt;review&gt;One of the great seminal American novels of the 20th century.&lt;/review&gt;
  &lt;/book&gt;
&lt;/catalog&gt;</pre>
</div>
<p>Will produce the following output:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "catalog": {
    "book": {
      "author": "William H. Gaddis",
      "review": "One of the great seminal American novels of the 20th century.",
      "seq": "1",
      "title": "The Recognitions"
    }
  }
}</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Method</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">new XMLDecoder(string)</code></p></td>
<td align="left" valign="top"><p>Returns a new <code class="literal">XMLDecoder</code> object to decode the provided <code class="literal">string</code>.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">var dec = new XMLDecoder(n);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">PrependHyphenToAttr()</code></p></td>
<td align="left" valign="top"><p>Causes the Decoder to prepend a hyphen (<code class="literal">-</code>) to to all XML attribute names.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">dec.PrependHyphenToAttr();</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">LowercaseKeys()</code></p></td>
<td align="left" valign="top"><p>Causes the Decoder to transform all key name to lowercase.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">dec.LowercaseKeys();</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">Decode()</code></p></td>
<td align="left" valign="top"><p>Reads the XML string and return a map containing the data.</p>
<p><span class="strong strong"><strong>Example</strong></span>: <code class="literal">var m = dec.Decode();</code></p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="_metrics_2"></a>Metrics<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/filebeat/docs/inputs/input-aws-s3.asciidoc">edit</a></h3>
<p>This input exposes metrics under the <a class="xref" href="http-endpoint.html" title="Configure an HTTP endpoint for metrics">HTTP monitoring endpoint</a>.
These metrics are exposed under the <code class="literal">/inputs</code> path. They can be used to
observe the activity of the input.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Metric</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">sqs_messages_received_total</code></p></td>
<td align="left" valign="top"><p>Number of SQS messages received (not necessarily processed fully).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sqs_visibility_timeout_extensions_total</code></p></td>
<td align="left" valign="top"><p>Number of SQS visibility timeout extensions.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sqs_messages_inflight_gauge</code></p></td>
<td align="left" valign="top"><p>Number of SQS messages inflight (gauge).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sqs_messages_returned_total</code></p></td>
<td align="left" valign="top"><p>Number of SQS message returned to queue (happens on errors implicitly after visibility timeout passes).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sqs_messages_deleted_total</code></p></td>
<td align="left" valign="top"><p>Number of SQS messages deleted.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sqs_message_processing_time</code></p></td>
<td align="left" valign="top"><p>Histogram of the elapsed SQS processing times in nanoseconds (time of receipt to time of delete/return).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sqs_lag_time</code></p></td>
<td align="left" valign="top"><p>Histogram of the difference between the SQS SentTimestamp attribute and the time when the SQS message was received expressed in nanoseconds.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">s3_objects_requested_total</code></p></td>
<td align="left" valign="top"><p>Number of S3 objects downloaded.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">s3_objects_listed_total</code></p></td>
<td align="left" valign="top"><p>Number of S3 objects returned by list operations.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">s3_objects_processed_total</code></p></td>
<td align="left" valign="top"><p>Number of S3 objects that matched file_selectors rules.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">s3_objects_acked_total</code></p></td>
<td align="left" valign="top"><p>Number of S3 objects processed that were fully ACKed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">s3_bytes_processed_total</code></p></td>
<td align="left" valign="top"><p>Number of S3 bytes processed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">s3_events_created_total</code></p></td>
<td align="left" valign="top"><p>Number of events created from processing S3 data.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">s3_objects_inflight_gauge</code></p></td>
<td align="left" valign="top"><p>Number of S3 objects inflight (gauge).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">s3_object_processing_time</code></p></td>
<td align="left" valign="top"><p>Histogram of the elapsed S3 object processing times in nanoseconds (start of download to completion of parsing).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="filebeat-input-aws-s3-common-options"></a>Common options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h3>
</div></div></div>
<p>The following configuration options are supported by all inputs.</p>
<h5><a id="_enabled_2"></a><code class="literal">enabled</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>Use the <code class="literal">enabled</code> option to enable and disable inputs. By default, enabled is
set to true.</p>
<h5><a id="_tags_2"></a><code class="literal">tags</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>A list of tags that Filebeat includes in the <code class="literal">tags</code> field of each published
event. Tags make it easy to select specific events in Kibana or apply
conditional filtering in Logstash. These tags will be appended to the list of
tags specified in the general configuration.</p>
<p>Example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  . . .
  tags: ["json"]</pre>
</div>
<h5><a id="filebeat-input-aws-s3-fields"></a><code class="literal">fields</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>Optional fields that you can specify to add additional information to the
output. For example, you might add fields that you can use for filtering log
data. Fields can be scalar values, arrays, dictionaries, or any nested
combination of these. By default, the fields that you specify here will be
grouped under a <code class="literal">fields</code> sub-dictionary in the output document. To store the
custom fields as top-level fields, set the <code class="literal">fields_under_root</code> option to true.
If a duplicate field is declared in the general configuration, then its value
will be overwritten by the value declared here.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  . . .
  fields:
    app_id: query_engine_12</pre>
</div>
<h5><a id="fields-under-root-aws-s3"></a><code class="literal">fields_under_root</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>If this option is set to true, the custom
<a class="xref" href="filebeat-input-aws-s3.html#filebeat-input-aws-s3-fields" title="fields">fields</a> are stored as top-level fields in
the output document instead of being grouped under a <code class="literal">fields</code> sub-dictionary. If
the custom field names conflict with other field names added by Filebeat,
then the custom fields overwrite the other fields.</p>
<h5><a id="_processors_2"></a><code class="literal">processors</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>A list of processors to apply to the input data.</p>
<p>See <a class="xref" href="filtering-and-enhancing-data.html" title="Filter and enhance data with processors"><em>Processors</em></a> for information about specifying
processors in your config.</p>
<h5><a id="_pipeline_2"></a><code class="literal">pipeline</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>The ingest pipeline ID to set for the events generated by this input.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The pipeline ID can also be configured in the Elasticsearch output, but
this option usually results in simpler configuration files. If the pipeline is
configured both in the input and output, the option from the
input is used.</p>
</div>
</div>
<h5><a id="_keep_null_2"></a><code class="literal">keep_null</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>If this option is set to true, fields with <code class="literal">null</code> values will be published in
the output document. By default, <code class="literal">keep_null</code> is set to <code class="literal">false</code>.</p>
<h5><a id="_index_2"></a><code class="literal">index</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>If present, this formatted string overrides the index for events from this input
(for elasticsearch outputs), or sets the <code class="literal">raw_index</code> field of the event&#8217;s
metadata (for other outputs). This string can only refer to the agent name and
version and the event timestamp; for access to dynamic fields, use
<code class="literal">output.elasticsearch.index</code> or a processor.</p>
<p>Example value: <code class="literal">"%{[agent.name]}-myindex-%{+yyyy.MM.dd}"</code> might
expand to <code class="literal">"filebeat-myindex-2019.11.01"</code>.</p>
<h5><a id="_publisher_pipeline_disable_host_2"></a><code class="literal">publisher_pipeline.disable_host</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>By default, all events contain <code class="literal">host.name</code>. This option can be set to <code class="literal">true</code> to
disable the addition of this field to all events. The default value is <code class="literal">false</code>.</p>
<h3><a id="aws-credentials-config"></a>AWS Credentials Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h3>
<p>To configure AWS credentials, either put the credentials into the Filebeat configuration, or use a shared credentials file, as shown in the following examples.</p>
<h4><a id="_configuration_parameters"></a>Configuration parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>access_key_id</strong></span>: first part of access key.
</li>
<li class="listitem">
<span class="strong strong"><strong>secret_access_key</strong></span>: second part of access key.
</li>
<li class="listitem">
<span class="strong strong"><strong>session_token</strong></span>: required when using temporary security credentials.
</li>
<li class="listitem">
<span class="strong strong"><strong>credential_profile_name</strong></span>: profile name in shared credentials file.
</li>
<li class="listitem">
<span class="strong strong"><strong>shared_credential_file</strong></span>: directory of the shared credentials file.
</li>
<li class="listitem">
<span class="strong strong"><strong>role_arn</strong></span>: AWS IAM Role to assume.
</li>
<li class="listitem">
<span class="strong strong"><strong>proxy_url</strong></span>: URL of the proxy to use to connect to AWS web services. The syntax is <code class="literal">http(s)://&lt;IP/Hostname&gt;:&lt;port&gt;</code>
</li>
<li class="listitem">
<span class="strong strong"><strong>fips_enabled</strong></span>: Enabling this option instructs Filebeat to use the FIPS endpoint of a service. All services used by Filebeat are FIPS compatible except for <code class="literal">tagging</code> but only certain regions are FIPS compatible. See <a href="https://aws.amazon.com/compliance/fips/" class="ulink" target="_top">https://aws.amazon.com/compliance/fips/</a> or the appropriate service page, <a href="https://docs.aws.amazon.com/general/latest/gr/aws-service-information.html" class="ulink" target="_top">https://docs.aws.amazon.com/general/latest/gr/aws-service-information.html</a>, for a full list of FIPS endpoints and regions.
</li>
<li class="listitem">
<span class="strong strong"><strong>ssl</strong></span>: This specifies SSL/TLS configuration. If the ssl section is missing, the host&#8217;s CAs are used for HTTPS connections. See <a class="xref" href="configuration-ssl.html" title="Configure SSL"><em>SSL</em></a> for more information.
</li>
<li class="listitem">
<span class="strong strong"><strong>default_region</strong></span>: Default region to query if no other region is set. Most AWS services offer a regional endpoint that can be used to make requests. Some services, such as IAM, do not support regions. If a region is not provided by any other way (environment variable, credential or instance profile), the value set here will be used.
</li>
</ul>
</div>
<h4><a id="_supported_formats"></a>Supported Formats<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The examples in this section refer to Metricbeat,
but the credential options for authentication with AWS are the same no matter which Beat is being used.</p>
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use <code class="literal">access_key_id</code>, <code class="literal">secret_access_key</code>, and/or <code class="literal">session_token</code>
</li>
</ul>
</div>
<p>Users can either put the credentials into the Metricbeat module configuration or use
environment variable <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code> and/or
<code class="literal">AWS_SESSION_TOKEN</code> instead.</p>
<p>If running on Docker, these environment variables should be added as a part of
the docker command. For example, with Metricbeat:</p>
<div class="pre_wrapper lang-terminal">
<pre class="programlisting prettyprint lang-terminal">$ docker run -e AWS_ACCESS_KEY_ID=abcd -e AWS_SECRET_ACCESS_KEY=abcd -d --name=metricbeat --user=root --volume="$(pwd)/metricbeat.aws.yml:/usr/share/metricbeat/metricbeat.yml:ro" docker.elastic.co/beats/metricbeat:7.11.1 metricbeat -e -E cloud.auth=elastic:1234 -E cloud.id=test-aws:1234</pre>
</div>
<p>Sample <code class="literal">metricbeat.aws.yml</code> looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 5m
  access_key_id: ${AWS_ACCESS_KEY_ID}
  secret_access_key: ${AWS_SECRET_ACCESS_KEY}
  session_token: ${AWS_SESSION_TOKEN}
  metricsets:
    - ec2</pre>
</div>
<p>Environment variables can also be added through a file. For example:</p>
<div class="pre_wrapper lang-terminal">
<pre class="programlisting prettyprint lang-terminal">$ cat env.list
AWS_ACCESS_KEY_ID=abcd
AWS_SECRET_ACCESS_KEY=abcd

$ docker run --env-file env.list -d --name=metricbeat --user=root --volume="$(pwd)/metricbeat.aws.yml:/usr/share/metricbeat/metricbeat.yml:ro" docker.elastic.co/beats/metricbeat:7.11.1 metricbeat -e -E cloud.auth=elastic:1234 -E cloud.id=test-aws:1234</pre>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use <code class="literal">credential_profile_name</code> and/or <code class="literal">shared_credential_file</code>
</li>
</ul>
</div>
<p>If <code class="literal">access_key_id</code>, <code class="literal">secret_access_key</code> and <code class="literal">role_arn</code> are all not given, then
filebeat will check for <code class="literal">credential_profile_name</code>. If you use different credentials for
different tools or applications, you can use profiles to configure multiple
access keys in the same configuration file. If there is no <code class="literal">credential_profile_name</code>
given, the default profile will be used.</p>
<p><code class="literal">shared_credential_file</code> is optional to specify the directory of your shared
credentials file. If it&#8217;s empty, the default directory will be used.
In Windows, shared credentials file is at <code class="literal">C:\Users\&lt;yourUserName&gt;\.aws\credentials</code>.
For Linux, macOS or Unix, the file is located at <code class="literal">~/.aws/credentials</code>. When running as a service,
the home path depends on the user that manages the service, so the <code class="literal">shared_credential_file</code> parameter can be used to avoid ambiguity. Please see
<a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/create-shared-credentials-file.html" class="ulink" target="_top">Create Shared Credentials File</a>
for more details.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use <code class="literal">role_arn</code>
</li>
</ul>
</div>
<p><code class="literal">role_arn</code> is used to specify which AWS IAM role to assume for generating
temporary credentials. If <code class="literal">role_arn</code> is given, filebeat will check if
access keys are given. If not, filebeat will check for credential profile
name. If neither is given, default credential profile will be used. Please make
sure credentials are given under either a credential profile or access keys.</p>
<p>If running on Docker, the credential file needs to be provided via a volume
mount. For example, with Metricbeat:</p>
<div class="pre_wrapper lang-terminal">
<pre class="programlisting prettyprint lang-terminal">docker run -d --name=metricbeat --user=root --volume="$(pwd)/metricbeat.aws.yml:/usr/share/metricbeat/metricbeat.yml:ro" --volume="/Users/foo/.aws/credentials:/usr/share/metricbeat/credentials:ro" docker.elastic.co/beats/metricbeat:7.11.1 metricbeat -e -E cloud.auth=elastic:1234 -E cloud.id=test-aws:1234</pre>
</div>
<p>Sample <code class="literal">metricbeat.aws.yml</code> looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 5m
  credential_profile_name: elastic-beats
  shared_credential_file: /usr/share/metricbeat/credentials
  metricsets:
    - ec2</pre>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Use AWS credentials in Filebeat configuration</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  queue_url: https://sqs.us-east-1.amazonaws.com/123/test-queue
  access_key_id: '&lt;access_key_id&gt;'
  secret_access_key: '&lt;secret_access_key&gt;'
  session_token: '&lt;session_token&gt;'</pre>
</div>
<p>or</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  queue_url: https://sqs.us-east-1.amazonaws.com/123/test-queue
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'</pre>
</div>
</li>
<li class="listitem">
<p>Use IAM role ARN</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  queue_url: https://sqs.us-east-1.amazonaws.com/123/test-queue
  role_arn: arn:aws:iam::123456789012:role/test-mb</pre>
</div>
</li>
<li class="listitem">
<p>Use shared AWS credentials file</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: aws-s3
  queue_url: https://sqs.us-east-1.amazonaws.com/123/test-queue
  credential_profile_name: test-fb</pre>
</div>
</li>
</ul>
</div>
<h4><a id="_aws_credentials_types"></a>AWS Credentials Types<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.7/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h4>
<p>There are two different types of AWS credentials can be used:
access keys and temporary security credentials.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Access keys
</li>
</ul>
</div>
<p><code class="literal">AWS_ACCESS_KEY_ID</code> and <code class="literal">AWS_SECRET_ACCESS_KEY</code> are the two parts of access keys.
They are long-term credentials for an IAM user or the AWS account root user.
Please see
<a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" class="ulink" target="_top">AWS Access Keys
 and Secret Access Keys</a>
for more details.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
IAM role ARN
</li>
</ul>
</div>
<p>An IAM role is an IAM identity that you can create in your account that has
specific permissions that determine what the identity can and cannot do in AWS.
A role does not have standard long-term credentials such as a password or access keys associated with it.
Instead, when you assume a role, it provides you with temporary security credentials for your role session.
IAM role Amazon Resource Name (ARN) can be used to specify which AWS IAM role to assume to generate temporary credentials.
Please see <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html" class="ulink" target="_top">AssumeRole API documentation</a> for more details.</p>
<p>Here are the steps to set up IAM role using AWS CLI for Metricbeat. Please replace
<code class="literal">123456789012</code> with your own account ID.</p>
<p>Step 1. Create <code class="literal">example-policy.json</code> file to include all permissions:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "sqs:ReceiveMessage"
            ],
            "Resource": "*"
        },
        {
            "Sid": "VisualEditor1",
            "Effect": "Allow",
            "Action": "sqs:ChangeMessageVisibility",
            "Resource": "arn:aws:sqs:us-east-1:123456789012:test-fb-ks"
        },
        {
            "Sid": "VisualEditor2",
            "Effect": "Allow",
            "Action": "sqs:DeleteMessage",
            "Resource": "arn:aws:sqs:us-east-1:123456789012:test-fb-ks"
        },
        {
            "Sid": "VisualEditor3",
            "Effect": "Allow",
            "Action": [
                "sts:AssumeRole",
                "sqs:ListQueues",
                "tag:GetResources",
                "ec2:DescribeInstances",
                "cloudwatch:GetMetricData",
                "ec2:DescribeRegions",
                "iam:ListAccountAliases",
                "sts:GetCallerIdentity",
                "cloudwatch:ListMetrics"
            ],
            "Resource": "*"
        }
    ]
}</pre>
</div>
<p>Step 2. Create IAM policy using the <code class="literal">aws iam create-policy</code> command:</p>
<div class="pre_wrapper lang-terminal">
<pre class="programlisting prettyprint lang-terminal">$ aws iam create-policy --policy-name example-policy --policy-document file://example-policy.json</pre>
</div>
<p>Step 3. Create the JSON file <code class="literal">example-role-trust-policy.json</code> that defines the trust relationship of the IAM role</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">{
    "Version": "2012-10-17",
    "Statement": {
        "Effect": "Allow",
        "Principal": { "AWS": "arn:aws:iam::123456789012:root" },
        "Action": "sts:AssumeRole"
    }
}</pre>
</div>
<p>Step 4. Create the IAM role and attach the policy:</p>
<div class="pre_wrapper lang-terminal">
<pre class="programlisting prettyprint lang-terminal">$ aws iam create-role --role-name example-role --assume-role-policy-document file://example-role-trust-policy.json
$ aws iam attach-role-policy --role-name example-role --policy-arn "arn:aws:iam::123456789012:policy/example-policy"</pre>
</div>
<p>After these steps are done, IAM role ARN can be used for authentication in Metricbeat
<code class="literal">aws</code> module.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Temporary security credentials
</li>
</ul>
</div>
<p>Temporary security credentials has a limited lifetime and consists of an
access key ID, a secret access key, and a security token which typically returned
from <code class="literal">GetSessionToken</code>. MFA-enabled IAM users would need to submit an MFA code
while calling <code class="literal">GetSessionToken</code>. Please see
<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" class="ulink" target="_top">Temporary Security Credentials</a>
for more details.
<code class="literal">sts get-session-token</code> AWS CLI can be used to generate temporary credentials. For example. with MFA-enabled:</p>
<div class="pre_wrapper lang-terminal">
<pre class="programlisting prettyprint lang-terminal">aws&gt; sts get-session-token --serial-number arn:aws:iam::1234:mfa/your-email@example.com --token-code 456789 --duration-seconds 129600</pre>
</div>
<p>Because temporary security credentials are short term, after they expire, the user needs to generate new ones and modify
the aws.yml config file with the new credentials. Unless <a href="/guide/en/beats/metricbeat/current/_live_reloading.html" class="ulink" target="_top">live reloading</a>
feature is enabled for Metricbeat, the user needs to manually restart Metricbeat after updating the config file in order
to continue collecting Cloudwatch metrics. This will cause data loss if the config file is not updated with new
credentials before the old ones expire. For Metricbeat, we recommend users to use access keys in config file to enable
aws module making AWS api calls without have to generate new temporary credentials and update the config frequently.</p>
<p>IAM policy is an entity that defines permissions to an object within your AWS environment. Specific permissions needs
to be added into the IAM user&#8217;s policy to authorize Metricbeat to collect AWS monitoring metrics. Please see documentation
under each metricset for required permissions.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="filebeat-input-aws-cloudwatch.html">« AWS CloudWatch input</a>
</span>
<span class="next">
<a href="filebeat-input-azure-eventhub.html">Azure eventhub input »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
