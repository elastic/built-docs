<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>aws module | Metricbeat Reference [7.2] | Elastic</title>
<link rel="home" href="index.html" title="Metricbeat Reference [7.2]"/>
<link rel="up" href="metricbeat-modules.html" title="Modules"/>
<link rel="prev" href="metricbeat-metricset-apache-status.html" title="Apache status metricset"/>
<link rel="next" href="metricbeat-metricset-aws-cloudwatch.html" title="aws cloudwatch metricset"/>
<meta name="DC.type" content="Learn/Docs/Metricbeat/Reference/7.2"/>
<meta name="DC.subject" content="Metricbeat"/>
<meta name="DC.identifier" content="7.2"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Metricbeat Reference [7.2]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="metricbeat-modules.html">Modules</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="metricbeat-metricset-apache-status.html">« Apache status metricset</a>
</span>
<span class="next">
<a href="metricbeat-metricset-aws-cloudwatch.html">aws cloudwatch metricset »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="metricbeat-module-aws"></a>aws module<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h2>
</div></div></div>
<p>This module periodically fetches monitoring metrics from AWS Cloudwatch using
<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricData.html" class="ulink" target="_top">GetMetricData API</a> for AWS services.
Note: extra AWS charges on GetMetricData API requests will be generated by this module.</p>
<p>The default metricsets are <code class="literal">ec2</code>, <code class="literal">sqs</code>, <code class="literal">s3_request</code>, <code class="literal">s3_daily_storage</code> and <code class="literal">cloudwatch</code>.</p>
<h3><a id="_module_specific_configuration_notes"></a>Module-specific configuration notes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>This module uses environment variable <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code>, <code class="literal">AWS_SESSION_TOKEN</code> and <code class="literal">AWS_REGION</code>
that are referenced in the config file to set values that need to be configurable during deployment. It also
accept optional configuration <code class="literal">regions</code> to specify what are the AWS regions to query metrics from. If <code class="literal">regions</code>
parameter is not set in the config file, then by default, aws module will query metrics from all available
AWS regions.</p>
<p>There are two different kinds of AWS credentials can be used here: <code class="literal">access keys</code> and <code class="literal">temporary security credentials</code>.
<code class="literal">AWS_ACCESS_KEY_ID</code> and <code class="literal">AWS_SECRET_ACCESS_KEY</code> are the two parts of <code class="literal">access keys</code>. They are long-term credentials for
an IAM user or the AWS account root user. Please see
<a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" class="ulink" target="_top">AWS Access Keys
 and Secret Access Keys</a> for more details. <code class="literal">temporary security credentials</code> has a limited lifetime and consists of an access key ID,
a secret access key, and a security token which typically returned from <code class="literal">GetSessionToken</code>. MFA-enabled IAM users would
need to submit an MFA code while calling <code class="literal">GetSessionToken</code>. <code class="literal">default_region</code> identifies the AWS Region whose servers you want to send
your first API request to by default. This is typically the Region closest to you, but it can be any Region.
Please see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" class="ulink" target="_top">Temporary Security Credentials</a> for more details.
<code class="literal">sts get-session-token</code> AWS CLI can be used to generate temporary credentials. For example. with MFA-enabled:</p>
<pre class="screen">aws&gt; sts get-session-token --serial-number arn:aws:iam::1234:mfa/your-email@example.com --token-code 456789 --duration-seconds 129600</pre>
<p>Because temporary security credentials are short term, after they expire, the user needs to generate new ones and modify
the aws.yml config file with the new credentials. Unless <a href="/guide/en/beats/metricbeat/current/_live_reloading.html" class="ulink" target="_top">live reloading</a>
feature is enabled for Metricbeat, the user needs to manually restart Metricbeat after updating the config file in order
to continue collecting Cloudwatch metrics. This will cause data loss if the config file is not updated with new
credentials before the old ones expire. For Metricbeat, we recommend users to use access keys in config file to enable
aws module making AWS api calls without have to generate new temporary credentials and update the config frequently.</p>
<p>IAM policy is an entity that defines permissions to an object within your AWS environment. Specific permissions needs
to be added into the IAM user&#8217;s policy to authorize Metricbeat to collect AWS monitoring metrics. Please see documentation
under each metricset for required permissions.</p>
<p>Here is an example of aws metricbeat module configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
    - sqs
  access_key_id: '${AWS_ACCESS_KEY_ID}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY}'
  session_token: '${AWS_SESSION_TOKEN}'
  default_region: '${AWS_REGION:us-west-1}'
- module: aws
  period: 300s
  metricsets:
    - s3_daily_storage
  access_key_id: '${AWS_ACCESS_KEY_ID}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY}'
  session_token: '${AWS_SESSION_TOKEN}'
  default_region: '${AWS_REGION:us-west-1}'
  regions:
    - us-west-1
    - us-east-1</pre>
</div>
<h2><a id="_metricsets_4"></a>Metricsets<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h2>
<p>The following Metricsets are already included:</p>
<h3><a id="_ec2"></a><code class="literal">ec2</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>By default, Amazon EC2 sends metric data to CloudWatch every 5 minutes. With this basic monitoring, <code class="literal">period</code> in aws module
configuration should be larger or equal than <code class="literal">300s</code>. If <code class="literal">period</code> is set to be less than <code class="literal">300s</code>, the same cloudwatch metrics
will be collected more than once which will cause extra fees without getting more granular metrics. For example, in <code class="literal">US East (N. Virginia)</code> region, it costs
$0.01/1000 metrics requested using GetMetricData. Please see <a href="https://aws.amazon.com/cloudwatch/pricing/" class="ulink" target="_top">AWS Cloudwatch Pricing</a>
for more details. To avoid unnecessary charges, <code class="literal">period</code> is preferred to be set to <code class="literal">300s</code> or multiples of <code class="literal">300s</code>, such as
<code class="literal">600s</code> and <code class="literal">900s</code>. For more granular monitoring data you can enable detailed monitoring on the instance to get metrics every 1 minute. Please see
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-cloudwatch-new.html" class="ulink" target="_top">Enabling Detailed Monitoring</a> for instructions
on how to enable detailed monitoring. With detailed monitoring enabled, <code class="literal">period</code> in aws module configuration can be any number
larger than <code class="literal">60s</code>. Since AWS sends metric data to CloudWatch in 1-minute periods, setting metricbeat module <code class="literal">period</code> less
than <code class="literal">60s</code> will cause extra API requests which means extra charges on AWS. To avoid unnecessary charges, <code class="literal">period</code> is
preferred to be set to <code class="literal">60s</code> or multiples of <code class="literal">60s</code>, such as <code class="literal">120s</code> and <code class="literal">180s</code>.</p>
<p>The ec2 metricset comes with a predefined dashboard. For example:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-ec2-overview.png" alt="metricbeat aws ec2 overview">
</div>
</div>
<h3><a id="_sqs"></a><code class="literal">sqs</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Cloudwatch metrics for Amazon SQS queues are automatically collected and pushed to CloudWatch every 5 minutes,
the <code class="literal">period</code> for <code class="literal">sqs</code> metricset is recommended to be <code class="literal">300s</code> or multiples of <code class="literal">300s</code>.</p>
<h3><a id="_s3_daily_storage"></a><code class="literal">s3_daily_storage</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Daily storage metrics for S3 buckets are reported once per day with no additional cost. Since they are daily metrics,
<code class="literal">period</code> for <code class="literal">s3_daily_storage</code> metricset is recommended to be <code class="literal">86400s</code> or multiples of <code class="literal">86400s</code>.</p>
<h3><a id="_s3_request"></a><code class="literal">s3_request</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Request metrics are available
at 1-minute intervals with additional charges. The s3_request metricset will give more
granular data to track S3 bucket usage. The <code class="literal">period</code> for <code class="literal">s3_request</code> metricset can be set to <code class="literal">60s</code> or multiples of <code class="literal">60s</code>.
But because of the extra charges for querying these metrics, the <code class="literal">period</code> is recommended to set to <code class="literal">86400s</code>. The user can
always adjust this to the granularity they want. Request metrics are not enabled by default for S3 buckets. Please see
<a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/configure-metrics.html" class="ulink" target="_top">How to
Configure Request Metrics for S3</a> for instructions on how to enable request metrics for
each S3 bucket.</p>
<h3><a id="_cloudwatch"></a><code class="literal">cloudwatch</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>This metricset gives users the freedom to query metrics from AWS Cloudwatch with
any given namespaces or specific instance with a given period.</p>
<h3><a id="_example_configuration_3"></a>Example configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The aws module supports the standard configuration options that are described
in <a class="xref" href="configuration-metricbeat.html" title="Specify which modules to run"><em>Specify which modules to run</em></a>. Here is an example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'
- module: aws
  period: 300s
  metricsets:
    - sqs
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'
  #regions:
  #  - us-west-1
- module: aws
  period: 86400s
  metricsets:
    - s3_request
    - s3_daily_storage
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'
  #regions:
  #  - us-west-1
- module: aws
  period: 300s
  metricsets:
    - cloudwatch
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'
  cloudwatch_metrics:
    - namespace: AWS/EC2
      metricname: CPUUtilization
      dimensions:
        - name: InstanceId
          value: i-0686946e22cf9494a
    - namespace: AWS/EBS
  #regions:
  #  - us-east-1
  #  - us-east-2</pre>
</div>
<h3><a id="_metricsets_5"></a>Metricsets<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.2/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The following metricsets are available:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-cloudwatch.html" title="aws cloudwatch metricset">cloudwatch</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-ec2.html" title="aws ec2 metricset">ec2</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-s3_daily_storage.html" title="aws s3_daily_storage metricset">s3_daily_storage</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-s3_request.html" title="aws s3_request metricset">s3_request</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-sqs.html" title="aws sqs metricset">sqs</a>
</li>
</ul>
</div>





</div>
<div class="navfooter">
<span class="prev">
<a href="metricbeat-metricset-apache-status.html">« Apache status metricset</a>
</span>
<span class="next">
<a href="metricbeat-metricset-aws-cloudwatch.html">aws cloudwatch metricset »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
