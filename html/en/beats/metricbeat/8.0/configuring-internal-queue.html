<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Configure the internal queue | Metricbeat Reference [8.0] | Elastic</title>
<meta class="elastic" name="content" content="Configure the internal queue | Metricbeat Reference [8.0]">

<link rel="home" href="index.html" title="Metricbeat Reference [8.0]"/>
<link rel="up" href="configuring-howto-metricbeat.html" title="Configure Metricbeat"/>
<link rel="prev" href="configuration-autodiscover-advanced.html" title="Advanced usage"/>
<link rel="next" href="configuration-logging.html" title="Configure logging"/>
<meta class="elastic" name="product_version" content="8.0"/>
<meta class="elastic" name="product_name" content="Metricbeat"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Metricbeat/Reference/8.0"/>
<meta name="DC.subject" content="Metricbeat"/>
<meta name="DC.identifier" content="8.0"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="icon" href="/favicon.ico" sizes="32x32"/>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml"/>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="configuration-autodiscover-advanced.html">« Advanced usage</a>
</span>
<span class="next">
<a href="configuration-logging.html">Configure logging »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Metricbeat Reference [8.0]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-metricbeat.html">Configure Metricbeat</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configure the internal queue</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/beats/metricbeat/configuring-internal-queue">latest documentation</a>.
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="configuring-internal-queue"></a>Configure the internal queue</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
</div></div></div>

<p>Metricbeat uses an internal queue to store events before publishing them. The
queue is responsible for buffering and combining events into batches that can
be consumed by the outputs. The outputs will use bulk operations to send a
batch of events in one transaction.</p>
<p>You can configure the type and behavior of the internal queue by setting
options in the <code class="literal">queue</code> section of the <code class="literal">metricbeat.yml</code> config file. Only one
queue type can be configured.</p>
<p>This sample configuration sets the memory queue to buffer up to 4096 events:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">queue.mem:
  events: 4096</pre>
</div>
<div class="position-relative"><h3><a id="configuration-internal-queue-memory"></a>Configure the memory queue</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>The memory queue keeps all events in memory.</p>
<p>If no flush interval and no number of events to flush is configured,
all events published to this queue will be directly consumed by the outputs.
To enforce spooling in the queue, set the <code class="literal">flush.min_events</code> and <code class="literal">flush.timeout</code> options.</p>
<p>By default <code class="literal">flush.min_events</code> is set to 2048 and <code class="literal">flush.timeout</code> is set to 1s.</p>
<p>The output&#8217;s <code class="literal">bulk_max_size</code> setting limits the number of events being processed at once.</p>
<p>The memory queue waits for the output to acknowledge or drop events. If
the queue is full, no new events can be inserted into the memory queue. Only
after the signal from the output will the queue free up space for more events to be accepted.</p>
<p>This sample configuration forwards events to the output if 512 events are
available or the oldest available event has been waiting for 5s in the queue:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">queue.mem:
  events: 4096
  flush.min_events: 512
  flush.timeout: 5s</pre>
</div>
<div class="position-relative"><h4><a id="_configuration_options_13"></a>Configuration options</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>You can specify the following options in the <code class="literal">queue.mem</code> section of the <code class="literal">metricbeat.yml</code> config file:</p>
<div class="position-relative"><h5><a id="_events"></a><code class="literal">events</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>Number of events the queue can store.</p>
<p>The default value is 4096 events.</p>
<div class="position-relative"><h5><a id="_flush_min_events"></a><code class="literal">flush.min_events</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>Minimum number of events required for publishing. If this value is set to 0, the
output can start publishing events without additional waiting times. Otherwise
the output has to wait for more events to become available.</p>
<p>The default value is 2048.</p>
<div class="position-relative"><h5><a id="_flush_timeout"></a><code class="literal">flush.timeout</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>Maximum wait time for <code class="literal">flush.min_events</code> to be fulfilled. If set to 0s, events
will be immediately available for consumption.</p>
<p>The default value is 1s.</p>
<div class="position-relative"><h3><a id="configuration-internal-queue-disk"></a>Configure the disk queue</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>The disk queue stores pending events on the disk rather than main memory.
This allows Beats to queue a larger number of events than is possible with
the memory queue, and to save events when a Beat or device is restarted.
This increased reliability comes with a performance tradeoff, as every
incoming event must be written and read from the device&#8217;s disk. However,
for setups where the disk is not the main bottleneck, the disk queue gives
a simple and relatively low-overhead way to add a layer of robustness to
incoming event data.</p>
<p>To enable the disk queue with default settings, specify a maximum size:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">queue.disk:
  max_size: 10GB</pre>
</div>
<p>The queue will use up to the specified maximum size on disk. It will only
use as much space as required. For example, if the queue is only storing
1GB of events, then it will only occupy 1GB on disk no matter how high the
maximum is. Queue data is deleted from disk after it has been successfully
sent to the output.</p>
<div class="position-relative"><h4><a id="configuration-internal-queue-disk-reference"></a>Configuration options</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>You can specify the following options in the <code class="literal">queue.disk</code> section of the
<code class="literal">metricbeat.yml</code> config file:</p>
<div class="position-relative"><h5><a id="_path"></a><code class="literal">path</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>The path to the directory where the disk queue should store its data files.
The directory is created on startup if it doesn&#8217;t exist.</p>
<p>The default value is <code class="literal">"${path.data}/diskqueue"</code>.</p>
<div class="position-relative"><h5><a id="_max_size_required"></a><code class="literal">max_size</code> (required)</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>The maximum size the queue should use on disk. Events that exceed this
maximum will either pause their input or be discarded, depending on
the input&#8217;s configuration.</p>
<p>A value of <code class="literal">0</code> means that no maximum size is enforced, and the queue can
grow up to the amount of free space on the disk. This value should be used
with caution, as completely filling a system&#8217;s main disk can make it
inoperable. It is best to use this setting only with a dedicated data or
backup partition that will not interfere with Metricbeat or the rest
of the host system.</p>
<p>The default value is <code class="literal">10GB</code>.</p>
<div class="position-relative"><h5><a id="_segment_size"></a><code class="literal">segment_size</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>Data added to the queue is stored in segment files. Each segment contains
some number of events waiting to be sent to the outputs, and is deleted when
all its events are sent. By default, segment size is limited to 1/10 of the
maximum queue size. Using a smaller size means that the queue will use more
data files, but they will be deleted more quickly after use. Using a larger
size means some data will take longer to delete, but the queue will use
fewer auxiliary files. It is usually fine to leave this value unchanged.</p>
<p>The default value is <code class="literal">max_size / 10</code>.</p>
<div class="position-relative"><h5><a id="_read_ahead"></a><code class="literal">read_ahead</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>The number of events that should be read from disk into memory while
waiting for an output to request them. If you find outputs are slowing
down because they can&#8217;t read as many events at a time, adjusting this
setting upward may help, at the cost of higher memory usage.</p>
<p>The default value is <code class="literal">512</code>.</p>
<div class="position-relative"><h5><a id="_write_ahead"></a><code class="literal">write_ahead</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>The number of events the queue should accept and store in memory while
waiting for them to be written to disk. If you find the queue&#8217;s memory
use is too high because events are waiting too long to be written to
disk, adjusting this setting downward may help, at the cost of reduced
event throughput. On the other hand, if inputs are waiting or discarding
events because they are being produced faster than the disk can handle,
adjusting this setting upward may help, at the cost of higher memory
usage.</p>
<p>The default value is <code class="literal">2048</code>.</p>
<div class="position-relative"><h5><a id="_retry_interval"></a><code class="literal">retry_interval</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>Some disk errors may block operation of the queue, for example a permission
error writing to the data directory, or a disk full error while writing an
event. In this case, the queue reports the error and retries after pausing
for the time specified in <code class="literal">retry_interval</code>.</p>
<p>The default value is <code class="literal">1s</code> (one second).</p>
<div class="position-relative"><h5><a id="_max_retry_interval"></a><code class="literal">max_retry_interval</code></h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/8.0/libbeat/docs/queueconfig.asciidoc">edit</a></div>
<p>When there are multiple consecutive errors writing to the disk, the queue
increases the retry interval by factors of 2 up to a maximum of
<code class="literal">max_retry_interval</code>. Increase this value if you are concerned about logging
too many errors or overloading the host system if the target disk becomes
unavailable for an extended time.</p>
<p>The default value is <code class="literal">30s</code> (thirty seconds).</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="configuration-autodiscover-advanced.html">« Advanced usage</a>
</span>
<span class="next">
<a href="configuration-logging.html">Configure logging »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
