<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Updating custom templates to support node_roles and autoscaling | Elastic Cloud Enterprise Reference [2.12] | Elastic</title>
<meta class="elastic" name="content" content="Updating custom templates to support node_roles and autoscaling | Elastic Cloud Enterprise Reference [2.12]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.12]"/>
<link rel="up" href="ece-configuring-ece-templates.html" title="Configure deployment templates"/>
<link rel="prev" href="ece-configure-templates-index-management.html" title="Configure index management for templates"/>
<link rel="next" href="ece-configuring-ece-instance-configurations-default.html" title="Default instance configurations"/>
<meta class="elastic" name="product_version" content="2.12"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.12"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="2.12"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
<p>
  <strong>It is time to say goodbye</strong>: This version of Elastic Cloud Enterprise 
  has reached <a href="https://www.elastic.co/support/eol">end-of-life (EOL)</a>
  and is no longer supported. 
</p>  
<p>
  The documentation for this version is no longer being maintained. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div class="navheader">
<span class="prev">
<a href="ece-configure-templates-index-management.html">« Configure index management for templates</a>
</span>
<span class="next">
<a href="ece-configuring-ece-instance-configurations-default.html">Default instance configurations »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [2.12]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-configuring-ece.html">Configuring your installation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-configuring-ece-templates.html">Configure deployment templates</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Updating custom templates to support node_roles and autoscaling</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ce-add-support-for-node-roles-and-autoscaling"></a>Updating custom templates to support <code class="literal">node_roles</code> and autoscaling<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h2>
</div></div></div>
<p>Custom deployment templates should be updated in order to take advantage of new Elastic Cloud Enterprise features, such as <a href="/guide/en/elasticsearch/reference/8.15/data-tiers.html" class="ulink" target="_top">Data tiers</a> (that is, the new cold and frozen data tiers) and <a class="xref" href="ece-autoscaling.html" title="Deployment autoscaling">Deployment autoscaling</a>.
By updating these templates we also ensure forward compatibility with future Elastic Cloud Enterprise versions that will require certain fields such as <code class="literal">node_roles</code> and <code class="literal">id</code> to be present in the deployment configuration.</p>
<p>System owned deployment templates have already been updated to support both data tiers with <code class="literal">node_roles</code> and autoscaling.
However, the custom templates that you created need to be manually updated by following the steps in this guide.</p>
<h4><a id="ece_adding_support_for_node_roles"></a>Adding support for node_roles<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h4>
<p>The <code class="literal">node_roles</code> field defines the roles that an Elasticsearch topology element can have, which is used in place of <code class="literal">node_type</code>
when a new feature such as autoscaling is enabled, or when a new data tier is added.
This field is supported on <a class="xref" href="ece-node-types.html" title="Changes to index allocation and API">Elastic stack versions 7.10 and above</a>.</p>
<p>There are a number of fields that need to be added to each Elasticsearch node in order to support <code class="literal">node_roles</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>id</strong></span>: Unique identifier of the topology element. This field, along with the <code class="literal">node_roles</code>, identifies an Elasticsearch topology element.
</li>
<li class="listitem">
<span class="strong strong"><strong>node_roles</strong></span>: The list of node roles. Allowable roles are: <code class="literal">master</code>, <code class="literal">ingest</code>, <code class="literal">ml</code>, <code class="literal">data_hot</code>, <code class="literal">data_content</code>,
<code class="literal">data_warm</code>, <code class="literal">data_cold</code>, <code class="literal">data_frozen</code>, <code class="literal">remote_cluster_client</code>, and <code class="literal">transform</code>. For details, see <a href="/guide/en/elasticsearch/reference/8.15/modules-node.html#node-roles" class="ulink" target="_top">Node roles</a>.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>topology_element_control</strong></span>: Controls for the topology element.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>min</strong></span>: The absolute minimum size limit for a topology element.
If the value is <code class="literal">0</code>, that means the topology element can be disabled.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>The following example is based on the <code class="literal">default</code> system owned deployment template that already supports <code class="literal">node_roles</code>. This template will be used as a reference for the next sections:</p>
<details id="ece-node-roles-support-example">
<summary class="title">Reference example with support for <code class="literal">node_roles</code></summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  ...
  "deployment_template": {
    "resources": {
      "elasticsearch": [
        {
          "plan": {
            "cluster_topology": [
              {
                "id": "hot_content",
                "instance_configuration_id": "data.default",
                "zone_count": 1,
                "node_roles": [
                  "master",
                  "ingest",
                  "data_hot",
                  "data_content",
                  "remote_cluster_client",
                  "transform"
                ],
                "node_type": {
                  "master": true,
                  "data": true,
                  "ingest": true
                },
                "elasticsearch": {
                  "node_attributes": {
                  "data": "hot"
                  }
                },
                "size": {
                  "value": 4096,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                  "value": 1024,
                  "resource": "memory"
                  }
                }
              },
              {
                "id": "warm",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_warm",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                  "data": "warm"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                  "value": 0,
                  "resource": "memory"
                  }
                }
              },
              {
                "id": "cold",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_cold",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                  "data": "cold"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                  "value": 0,
                  "resource": "memory"
                  }
                }
              },
              {
                "id": "frozen",
                "instance_configuration_id": "data.frozen",
                "zone_count": 1,
                "node_roles": [
                  "data_frozen"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                  "data": "frozen"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                  "value": 0,
                  "resource": "memory"
                  }
                }
              },
              {
                "id": "coordinating",
                "zone_count": 1,
                "instance_configuration_id": "coordinating",
                "node_roles": [
                  "ingest",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                  "value": 0,
                  "resource": "memory"
                  }
                }
              },
              {
                "id": "master",
                "zone_count": 1,
                "instance_configuration_id": "master",
                "node_roles": [
                  "master",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": true,
                  "data": false,
                  "ingest": false
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                  "value": 0,
                  "resource": "memory"
                  }
                }
              },
              {
                "id": "ml",
                "zone_count": 1,
                "instance_configuration_id": "ml",
                "node_roles": [
                  "ml",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": false,
                  "ml": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                  "value": 0,
                  "resource": "memory"
                  }
                }
              }
            ],
            "elasticsearch": {}
          },
          ...
        }
      ],
      "kibana": [
        {
          "ref_id": "kibana-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "zone_count": 1,
            "cluster_topology": [
              {
                "instance_configuration_id": "kibana",
                "size": {
                  "value": 1024,
                  "resource": "memory"
                }
              }
            ],
            "kibana": {}
          }
        }
      ],
      "apm": [
        {
          "ref_id": "apm-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "instance_configuration_id": "apm",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 1
              }
            ],
            "apm": {}
          }
        }
      ],
      "enterprise_search": [
        {
          "ref_id": "enterprise_search-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "node_type": {
                  "appserver": true,
                  "connector": true,
                  "worker": true
                },
                "instance_configuration_id": "enterprise.search",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 2
              }
            ],
            "enterprise_search": {}
          }
        }
      ]
    }
  }
}</pre>
</div>
</div>
</details>
<p>In the reference example there are seven different <em>Elasticsearch topology elements</em>: <code class="literal">hot_content</code>, <code class="literal">warm</code>, <code class="literal">cold</code>, <code class="literal">frozen</code>, <code class="literal">coordinating</code>, <code class="literal">master</code>, and <code class="literal">ml</code>.
These names map to the <code class="literal">id</code> field of each topology element.
In addition, this template contains four different <em>resources</em>: <code class="literal">elasticsearch</code>, <code class="literal">kibana</code>, <code class="literal">apm</code>, and <code class="literal">enterprise_search</code>.</p>
<h5><a id="ece_requirements"></a>Requirements<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h5>
<p>To add support for <code class="literal">node_roles</code>, the deployment template has to meet the following requirements:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains all four <code class="literal">resources</code>: <code class="literal">elasticsearch</code>, <code class="literal">kibana</code>, <code class="literal">apm</code>, and <code class="literal">enterprise_search</code>.
</li>
<li class="listitem">
<p>The <code class="literal">elasticsearch</code> resource contains all seven topology elements: <code class="literal">hot_content</code>, <code class="literal">warm</code>, <code class="literal">cold</code>, <code class="literal">frozen</code>, <code class="literal">coordinating</code>, <code class="literal">master</code>, and <code class="literal">ml</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The IDs <code class="literal">hot_content</code>, <code class="literal">warm</code>, <code class="literal">cold</code>, <code class="literal">frozen</code>, <code class="literal">coordinating</code>, <code class="literal">master</code>, and <code class="literal">ml</code> are the <span class="strong strong"><strong>only</strong></span> ones supported in an Elasticsearch topology element. In addition, there may not be topology elements with duplicate IDs inside the <code class="literal">elasticsearch</code> resource.</p>
</div>
</div>
</li>
<li class="listitem">
Each topology element contains the <code class="literal">id</code>, <code class="literal">node_roles</code>, and <code class="literal">topology_element_control</code> fields.
</li>
</ul>
</div>
<p>It is also recommended that all Elasticsearch topology elements have the <code class="literal">node_attributes</code> field. This field can be useful in ILM
policies, when creating a deployment using a version below 7.10, that does not support <code class="literal">node_roles</code>.</p>
<p>Except for the <code class="literal">id</code> and <code class="literal">node_roles</code>, all fields can be configured by the user. Also, the topology elements must contain the exact same <code class="literal">id</code> and <code class="literal">node_roles</code> that are present in the reference example.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Although it is required for the template to contain all resources and topology elements, it is possible to disable certain
components by setting their <code class="literal">size.value</code> (and <code class="literal">topology_element_control.size</code> in the case of the topology elements) to <code class="literal">0</code>.</p>
</div>
</div>
<h5><a id="ece_updating_an_ece_custom_template_to_support_node_roles"></a>Updating an ECE custom template to support <code class="literal">node_roles</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h5>
<p>To update a custom deployment template:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the <code class="literal">id</code>, <code class="literal">node_roles</code>, <code class="literal">node_attributes</code>, and <code class="literal">topology_element_control</code> fields to the existing Elasticsearch topology elements. Keep in mind that these fields must match the Elasticsearch topology element in question:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the <code class="literal">id</code> of the topology elements in the existing templates already match any of the seven mentioned in the
requirements, then simply add the <code class="literal">node_roles</code> and <code class="literal">topology_element_control</code> to those elements, based on the reference example.
</li>
<li class="listitem">
Otherwise, map each of the existing topology elements to one of the seven Elasticsearch topology elements, based on their <code class="literal">node_type</code>, and add the fields accordingly.
</li>
</ul>
</div>
</li>
<li class="listitem">
Add the <code class="literal">elasticsearch</code> topology elements that are missing.
</li>
<li class="listitem">
Add the <code class="literal">resources</code> that are missing.
</li>
</ol>
</div>
<h5><a id="ece-ce-add-support-to-node-roles-example"></a>Example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h5>
<p>The existing template contains three Elasticsearch topology elements and two resources (<code class="literal">elasticsearch</code> and <code class="literal">kibana</code>).</p>
<details>
<summary class="title">Custom example without support for <code class="literal">node_roles</code></summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  ...
  "deployment_template": {
    "resources": {
      "elasticsearch": [
        {
          "plan": {
            "cluster_topology": [
              {
                "instance_configuration_id": "custom.data",
                "zone_count": 2,
                "node_type": {
                  "master": true,
                  "data": true,
                  "ingest": true
                },
                "size": {
                  "value": 8192,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 1024,
                    "resource": "memory"
                  }
                }
              },
              {
                "zone_count": 1,
                "instance_configuration_id": "custom.master",
                "node_type": {
                  "master": true,
                  "data": false,
                  "ingest": false
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "zone_count": 1,
                "instance_configuration_id": "custom.ml",
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": false,
                  "ml": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              }
            ],
            "elasticsearch": {}
          },
          ...
        }
      ],
      "kibana": [
        {
          "ref_id": "kibana-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "zone_count": 1,
            "cluster_topology": [
              {
                "instance_configuration_id": "kibana",
                "size": {
                  "value": 1024,
                  "resource": "memory"
                }
              }
            ],
            "kibana": {}
          }
        }
      ]
    }
  }
}</pre>
</div>
</div>
</details>
<p>In this case we can match the three existing Elasticsearch topology elements to <code class="literal">hot_content</code>, <code class="literal">master</code>, and <code class="literal">ml</code>, respectively, based on their <code class="literal">node_type</code> field. Therefore,
we can simply add the <code class="literal">id</code>, <code class="literal">node_roles</code>, <code class="literal">topology_element_control</code>, and <code class="literal">node_attributes</code> that are already associated
with these topology elements in the reference example.</p>
<p>Then, it is only necessary to add the four Elasticsearch topology elements (<code class="literal">warm</code>, <code class="literal">cold</code>, <code class="literal">frozen</code>, and <code class="literal">coordinating</code>) and two resources
(<code class="literal">apm</code> and <code class="literal">enterprise_search</code>) that are missing. These fields can also be added based on the reference example.</p>
<p>After adding support for <code class="literal">node_roles</code>, the resulting deployment template should look similar to the following:</p>
<details id="example-with-support-for-node-roles">
<summary class="title">Custom example with support for <code class="literal">node_roles</code></summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  ...
  "deployment_template": {
    "resources": {
      "elasticsearch": [
        {
          "plan": {
            "cluster_topology": [
              {
                "id": "hot_content",
                "instance_configuration_id": "custom.data",
                "zone_count": 2,
                "node_roles": [
                  "master",
                  "ingest",
                  "data_hot",
                  "data_content",
                  "remote_cluster_client",
                  "transform"
                ],
                "node_type": {
                  "master": true,
                  "data": true,
                  "ingest": true
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "hot"
                  }
                },
                "size": {
                  "value": 8192,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 1024,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "warm",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_warm",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "warm"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "cold",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_cold",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "cold"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "frozen",
                "instance_configuration_id": "data.frozen",
                "zone_count": 1,
                "node_roles": [
                  "data_frozen"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "frozen"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "coordinating",
                "zone_count": 1,
                "instance_configuration_id": "coordinating",
                "node_roles": [
                  "ingest",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "master",
                "zone_count": 1,
                "instance_configuration_id": "custom.master",
                "node_roles": [
                  "master",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": true,
                  "data": false,
                  "ingest": false
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "ml",
                "zone_count": 1,
                "instance_configuration_id": "custom.ml",
                "node_roles": [
                  "ml",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": false,
                  "ml": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              }
            ],
            "elasticsearch": {}
          },
          ...
        }
      ],
      "kibana": [
        {
          "ref_id": "kibana-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "zone_count": 1,
            "cluster_topology": [
              {
                "instance_configuration_id": "kibana",
                "size": {
                  "value": 1024,
                  "resource": "memory"
                }
              }
            ],
            "kibana": {}
          }
        }
      ],
      "apm": [
        {
          "ref_id": "apm-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "instance_configuration_id": "apm",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 1
              }
            ],
            "apm": {}
          }
        }
      ],
      "enterprise_search": [
        {
          "ref_id": "enterprise_search-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "node_type": {
                  "appserver": true,
                  "connector": true,
                  "worker": true
                },
                "instance_configuration_id": "enterprise.search",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 2
              }
            ],
            "enterprise_search": {}
          }
        }
      ]
    }
  }
}</pre>
</div>
</div>
</details>
<h4><a id="ece_adding_support_for_autoscaling"></a>Adding support for autoscaling<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h4>
<p>After adding support for <code class="literal">node_roles</code> we can then update the template to support autoscaling.
Autoscaling is used to automatically adjust the available resources in the deployments.
Currently, this feature is available for Elasticsearch data tiers and machine learning node in <a class="xref" href="ece-autoscaling.html" title="Deployment autoscaling">Elastic stack versions 7.11 and above</a>.</p>
<p>There are a number of autoscaling fields that need to be added in order to support autoscaling:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>autoscaling_min</strong></span>: The default minimum size of an Elasticsearch topology element when autoscaling is enabled.
This setting is currently available only for machine learning nodes, since these are the only nodes that support scaling down.
</li>
<li class="listitem">
<span class="strong strong"><strong>autoscaling_max</strong></span>: The default maximum size of an Elasticsearch topology element when autoscaling is enabled.
This setting is currently available only for data tiers and machine learning nodes, since these are the only nodes that support scaling up.
</li>
<li class="listitem">
<span class="strong strong"><strong>autoscaling_enabled</strong></span>: When set to <code class="literal">true</code>, autoscaling is enabled by default on an Elasticsearch cluster.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>These fields represent the default settings for the deployment. However, autoscaling can be enabled/disabled and the maximum and minimum autoscaling sizes can be adjusted in the deployment settings.</p>
</div>
</div>
<p>Similar to the <code class="literal">node_roles</code> example, the following one is also based on the <code class="literal">default</code> deployment template that already supports <code class="literal">node_roles</code> and autoscaling.
This template will be used as a reference for the next sections:</p>
<details>
<summary class="title">Reference example with support for <code class="literal">node_roles</code> and autoscaling</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  ...
  "deployment_template": {
    "resources": {
      "elasticsearch": [
        {
          "plan": {
            "cluster_topology": [
              {
                "id": "hot_content",
                "instance_configuration_id": "data.default",
                "zone_count": 1,
                "node_roles": [
                  "master",
                  "ingest",
                  "data_hot",
                  "data_content",
                  "remote_cluster_client",
                  "transform"
                ],
                "node_type": {
                  "master": true,
                  "data": true,
                  "ingest": true
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "hot"
                  }
                },
                "size": {
                  "value": 4096,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 1024,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "warm",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_warm",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "warm"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "cold",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_cold",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "cold"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "frozen",
                "instance_configuration_id": "data.frozen",
                "zone_count": 1,
                "node_roles": [
                  "data_frozen"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "frozen"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "coordinating",
                "zone_count": 1,
                "instance_configuration_id": "coordinating",
                "node_roles": [
                  "ingest",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "master",
                "zone_count": 1,
                "instance_configuration_id": "master",
                "node_roles": [
                  "master",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": true,
                  "data": false,
                  "ingest": false
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "ml",
                "zone_count": 1,
                "instance_configuration_id": "ml",
                "node_roles": [
                  "ml",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": false,
                  "ml": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_min": {
                  "resource": "memory",
                  "value": 0
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              }
            ],
            "elasticsearch": {},
            "autoscaling_enabled": true
          },
          ...
        }
      ],
      "kibana": [
        {
          "ref_id": "kibana-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "zone_count": 1,
            "cluster_topology": [
              {
                "instance_configuration_id": "kibana",
                "size": {
                  "value": 1024,
                  "resource": "memory"
                }
              }
            ],
            "kibana": {}
          }
        }
      ],
      "apm": [
        {
          "ref_id": "apm-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "instance_configuration_id": "apm",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 1
              }
            ],
            "apm": {}
          }
        }
      ],
      "enterprise_search": [
        {
          "ref_id": "enterprise_search-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "node_type": {
                  "appserver": true,
                  "connector": true,
                  "worker": true
                },
                "instance_configuration_id": "enterprise.search",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 2
              }
            ],
            "enterprise_search": {}
          }
        }
      ]
    }
  }
}</pre>
</div>
</div>
</details>
<h5><a id="ece_requirements_2"></a>Requirements<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h5>
<p>To add support for autoscaling, the deployment template has to meet the following requirements:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Already has support for <code class="literal">node_roles</code>.
</li>
<li class="listitem">
Contains the <code class="literal">size</code>, <code class="literal">autoscaling_min</code>, and <code class="literal">autoscaling_max</code> fields, according to the rules specified in the
<a class="xref" href="ece-autoscaling-api-example.html#ece-autoscaling-api-example-requirements-table">autoscaling requirements table</a>.
</li>
<li class="listitem">
Contains the <code class="literal">autoscaling_enabled</code> fields on the <code class="literal">elasticsearch</code> resource.
</li>
</ol>
</div>
<p>If necessary, the values chosen for each field can be based on the reference example.</p>
<h5><a id="ece_updating_an_ece_custom_template_to_support_autoscaling"></a>Updating an ECE custom template to support autoscaling<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h5>
<p>To update a custom deployment template:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Add the <code class="literal">autoscaling_min</code> and <code class="literal">autoscaling_max</code> fields to the Elasticsearch topology elements (see
<a class="xref" href="ece-autoscaling-api-example.html" title="Autoscaling through the API">Autoscaling through the API</a>).
</li>
<li class="listitem">
Add the <code class="literal">autoscaling_enabled</code> fields to the <code class="literal">elasticsearch</code> resource. Set this field to <code class="literal">true</code> in case you want autoscaling enabled by default, and to <code class="literal">false</code> otherwise.
</li>
</ol>
</div>
<h5><a id="ece_example"></a>Example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h5>
<p>After adding support for autoscaling to the <a class="xref" href="ce-add-support-for-node-roles-and-autoscaling.html#ece-node-roles-support-example" title="Reference example with support for node_roles">example</a> presented in the previous section, the resulting deployment template should look similar to the following:</p>
<details>
<summary class="title">Custom example with support for <code class="literal">node_roles</code> and autoscaling</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  ...
  "deployment_template": {
    "resources": {
      "elasticsearch": [
        {
          "plan": {
            "cluster_topology": [
              {
                "id": "hot_content",
                "instance_configuration_id": "custom.data",
                "zone_count": 2,
                "node_roles": [
                  "master",
                  "ingest",
                  "data_hot",
                  "data_content",
                  "remote_cluster_client",
                  "transform"
                ],
                "node_type": {
                  "master": true,
                  "data": true,
                  "ingest": true
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "hot"
                  }
                },
                "size": {
                  "value": 8192,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 1024,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "warm",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_warm",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "warm"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "cold",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_cold",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "cold"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "frozen",
                "instance_configuration_id": "data.frozen",
                "zone_count": 1,
                "node_roles": [
                  "data_frozen"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "frozen"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "coordinating",
                "zone_count": 1,
                "instance_configuration_id": "coordinating",
                "node_roles": [
                  "ingest",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "master",
                "zone_count": 1,
                "instance_configuration_id": "custom.master",
                "node_roles": [
                  "master",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": true,
                  "data": false,
                  "ingest": false
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "ml",
                "zone_count": 1,
                "instance_configuration_id": "custom.ml",
                "node_roles": [
                  "ml",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": false,
                  "ml": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_min": {
                  "resource": "memory",
                  "value": 0
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              }
            ],
            "elasticsearch": {},
            "autoscaling_enabled": true
          },
          ...
        }
      ],
      "kibana": [
        {
          "ref_id": "kibana-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "zone_count": 1,
            "cluster_topology": [
              {
                "instance_configuration_id": "kibana",
                "size": {
                  "value": 1024,
                  "resource": "memory"
                }
              }
            ],
            "kibana": {}
          }
        }
      ],
      "apm": [
        {
          "ref_id": "apm-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "instance_configuration_id": "apm",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 1
              }
            ],
            "apm": {}
          }
        }
      ],
      "enterprise_search": [
        {
          "ref_id": "enterprise_search-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "node_type": {
                  "appserver": true,
                  "connector": true,
                  "worker": true
                },
                "instance_configuration_id": "enterprise.search",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 2
              }
            ],
            "enterprise_search": {}
          }
        }
      ]
    }
  }
}</pre>
</div>
</div>
</details>
<h4><a id="ece_updating_a_custom_template_through_the_restful_api"></a>Updating a custom template through the RESTful API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h4>
<p>Having added support for <code class="literal">node_roles</code> and autoscaling to your custom template, it is possible to perform the update through the RESTful API, by following these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Obtain the existing deployment templates by sending the following <code class="literal">GET</code> request, and take note of the <code class="literal">id</code> of the template you wish to update.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -k -X GET -H "Authorization: ApiKey $ECE_API_KEY" https://COORDINATOR_HOST:12443/api/v1/deployments/templates?region=ece-region</pre>
</div>
</li>
<li class="listitem">
<p>Send a <code class="literal">PUT</code> request with the updated template on the payload, in order to effectively replace the outdated template with the new one.
Note that the following request is just an example, you have to replace <code class="literal">{template_id}</code> with the <code class="literal">id</code> you collected on step 1. and
set the payload to the updated template JSON. See <a class="xref" href="set-deployment-template-v2.html" title="Set deployment template">set deployment template API</a> for more details.</p>
<details>
<summary class="title">Update template API request example</summary>
<div class="content">
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -k -X PUT -H "Authorization: ApiKey $ECE_API_KEY" https://$COORDINATOR_HOST:12443/api/v1/deployments/templates/{template_id}?region=ece-region -H 'content-type: application/json' -d '
{
  "name": "ECE Custom Template",
  "description": "ECE custom template with support for node_roles and autoscaling",
  "deployment_template": {
    "resources": {
      "elasticsearch": [
        {
          "ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "id": "hot_content",
                "instance_configuration_id": "custom.data",
                "zone_count": 2,
                "node_roles": [
                  "master",
                  "ingest",
                  "data_hot",
                  "data_content",
                  "remote_cluster_client",
                  "transform"
                ],
                "node_type": {
                  "master": true,
                  "data": true,
                  "ingest": true
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "hot"
                  }
                },
                "size": {
                  "value": 8192,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 1024,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "warm",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_warm",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "warm"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "cold",
                "instance_configuration_id": "data.highstorage",
                "zone_count": 1,
                "node_roles": [
                  "data_cold",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "cold"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "frozen",
                "instance_configuration_id": "data.frozen",
                "zone_count": 1,
                "node_roles": [
                  "data_frozen"
                ],
                "node_type": {
                  "data": true,
                  "ingest": false,
                  "master": false
                },
                "elasticsearch": {
                  "node_attributes": {
                    "data": "frozen"
                  }
                },
                "size": {
                  "resource": "memory",
                  "value": 0
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              },
              {
                "id": "coordinating",
                "zone_count": 1,
                "instance_configuration_id": "coordinating",
                "node_roles": [
                  "ingest",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "master",
                "zone_count": 1,
                "instance_configuration_id": "custom.master",
                "node_roles": [
                  "master",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": true,
                  "data": false,
                  "ingest": false
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                }
              },
              {
                "id": "ml",
                "zone_count": 1,
                "instance_configuration_id": "custom.ml",
                "node_roles": [
                  "ml",
                  "remote_cluster_client"
                ],
                "node_type": {
                  "master": false,
                  "data": false,
                  "ingest": false,
                  "ml": true
                },
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "topology_element_control": {
                  "min": {
                    "value": 0,
                    "resource": "memory"
                  }
                },
                "autoscaling_min": {
                  "resource": "memory",
                  "value": 0
                },
                "autoscaling_max": {
                  "value": 2097152,
                  "resource": "memory"
                }
              }
            ],
            "elasticsearch": {},
            "autoscaling_enabled": true
          },
          "settings": {
            "dedicated_masters_threshold": 6
          }
        }
      ],
      "kibana": [
        {
          "ref_id": "kibana-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "zone_count": 1,
            "cluster_topology": [
              {
                "instance_configuration_id": "kibana",
                "size": {
                  "value": 1024,
                  "resource": "memory"
                }
              }
            ],
            "kibana": {}
          }
        }
      ],
      "apm": [
        {
          "ref_id": "apm-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "instance_configuration_id": "apm",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 1
              }
            ],
            "apm": {}
          }
        }
      ],
      "enterprise_search": [
        {
          "ref_id": "enterprise_search-ref-id",
          "elasticsearch_cluster_ref_id": "es-ref-id",
          "region": "ece-region",
          "plan": {
            "cluster_topology": [
              {
                "node_type": {
                  "appserver": true,
                  "worker": true,
                  "connector": true
                },
                "instance_configuration_id": "enterprise.search",
                "size": {
                  "value": 0,
                  "resource": "memory"
                },
                "zone_count": 2
              }
            ],
            "enterprise_search": {}
          }
        }
      ]
    }
  },
  "system_owned": false
}'</pre>
</div>
</div>
</details>
</li>
</ol>
</div>
<p>After the template is updated, you can start <a class="xref" href="ece-create-deployment.html" title="Create your deployment">creating new deployments</a> or <a class="xref" href="ce-add-support-for-node-roles-and-autoscaling.html#ece-migrating-a-deployment-to-node-roles" title="Migrating a deployment to node_roles">migrating existing ones to <code class="literal">node_roles</code></a>.</p>
<p>Although <code class="literal">node_roles</code> and autoscaling are only available in more recent Elastic stack versions, an updated template can still be used with deployments that have versions below 7.10.
In these cases, the data tiers and autoscaling features will only take effect once the deployment is upgraded to versions 7.10 and 7.11, respectively.</p>
<h4><a id="ece-migrating-a-deployment-to-node-roles"></a>Migrating a deployment to <code class="literal">node_roles</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h4>
<p>Once a custom template is updated with <code class="literal">node_roles</code>, the existing deployments associated with this template can be migrated to <code class="literal">node_roles</code>.
This migration can be done automatically by performing one of the following actions through the UI:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Enable a warm, cold, or frozen tier.
</li>
<li class="listitem">
Upgrade the deployment.
</li>
<li class="listitem">
Enable autoscaling (only possible if the custom template has support for autoscaling).
</li>
</ul>
</div>
<p>If you do not intend to perform any of these actions, the migration can only be done by manually updating the necessary fields in the deployment plan.
This can be performed either through the API or using the deployment <span class="strong strong"><strong>Advanced edit</strong></span> page.</p>
<p><span class="strong strong"><strong>Using the API:</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the deployment <span class="strong strong"><strong>Edit</strong></span> page.
</li>
<li class="listitem">
Get the deployment update payload by clicking <span class="strong strong"><strong>Equivalent API request</strong></span> at the bottom of the page.
</li>
<li class="listitem">
Update the payload by replacing <code class="literal">node_type</code> with <code class="literal">node_roles</code> in each Elasticsearch topology element.
To know which <code class="literal">node_roles</code> to add to each topology element, refer to the <a class="xref" href="ce-add-support-for-node-roles-and-autoscaling.html#ece-ce-add-support-to-node-roles-example" title="Example">custom template example</a> where support for <code class="literal">node_roles</code> is added.
</li>
<li class="listitem">
Send a <code class="literal">PUT</code> request with the updated deployment payload to conclude the migration. Check the <a class="xref" href="update-deployment.html" title="Update Deployment">Update Deployment</a> API documentation for more details.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Using the Advanced edit:</strong></span></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To follow this approach you need to have administrator privileges.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the deployment <span class="strong strong"><strong>Edit</strong></span> page.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Advanced edit</strong></span> at the bottom of the page.
</li>
<li class="listitem">
Update the <span class="strong strong"><strong>Deployment configuration</strong></span> by replacing <code class="literal">node_type</code> with <code class="literal">node_roles</code> in each Elasticsearch topology element.
To know which <code class="literal">node_roles</code> to add to each topology element, refer to the <a class="xref" href="ce-add-support-for-node-roles-and-autoscaling.html#ece-ce-add-support-to-node-roles-example" title="Example">custom template example</a> where support for <code class="literal">node_roles</code> is added.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save</strong></span> to conclude the migration.
</li>
</ol>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Once a deployment is migrated to node roles, it is not possible to roll back.</p>
</div>
</div>
<p>After the migration plan has finished, we recommend following the <a href="/guide/en/elasticsearch/reference/8.15/migrate-index-allocation-filters.html" class="ulink" target="_top">Migrate index allocation filters to node roles</a> guide.
Step 1 of this guide was already accomplished by adding support for <code class="literal">node_roles</code>.
However, performing steps 2, 3, and 4, which involves updating index settings, index templates, and ILM policies, can prevent shard allocation issues caused by conflicting ILM policies.</p>
<h5><a id="ece_example_2"></a>Example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h5>
<p>The following is an example of a deployment plan that does not contain <code class="literal">node_roles</code>:</p>
<details>
<summary class="title">Example deployment plan with <code class="literal">node_type</code></summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "name": "Example deployment",
  "prune_orphans": true,
  "metadata": {
    "system_owned": false,
    "hidden": false
  },
  "resources": {
    "elasticsearch": [
      {
        "ref_id": "es-ref-id",
        "region": "ece-region",
        "plan": {
          "tiebreaker_topology": {
            "memory_per_node": 1024
          },
          "cluster_topology": [
            {
              "id": "hot_content",
              "instance_configuration_id": "custom.data",
              "zone_count": 2,
              "node_type": {
                "master": true,
                "data": true,
                "ingest": true
              },
              "elasticsearch": {
                "node_attributes": {
                  "data": "hot"
                }
              },
              "size": {
                "value": 8192,
                "resource": "memory"
              }
            },
            {
              "id": "warm",
              "instance_configuration_id": "data.highstorage",
              "zone_count": 1,
              "node_type": {
                "data": true,
                "ingest": false,
                "master": false
              },
              "elasticsearch": {
                "node_attributes": {
                  "data": "warm"
                }
              },
              "size": {
                "resource": "memory",
                "value": 0
              }
            },
            {
              "id": "coordinating",
              "zone_count": 1,
              "instance_configuration_id": "coordinating",
              "node_type": {
                "master": false,
                "data": false,
                "ingest": true
              },
              "size": {
                "value": 0,
                "resource": "memory"
              }
            },
            {
              "id": "master",
              "zone_count": 1,
              "instance_configuration_id": "custom.master",
              "node_type": {
                "master": true,
                "data": false,
                "ingest": false
              },
              "size": {
                "value": 0,
                "resource": "memory"
              }
            },
            {
              "id": "ml",
              "zone_count": 1,
              "instance_configuration_id": "custom.ml",
              "node_type": {
                "master": false,
                "data": false,
                "ingest": false,
                "ml": true
              },
              "size": {
                "value": 0,
                "resource": "memory"
              }
            }
          ],
          "elasticsearch": {
            "version": "7.17.0"
          },
          "deployment_template": {
            "id": "custom-template"
          }
        }
      }
    ],
    "kibana": [
      {
        "region": "ece-region",
        "ref_id": "kibana-ref-id",
        "elasticsearch_cluster_ref_id": "es-ref-id",
        "plan": {
          "cluster_topology": [
            {
              "instance_configuration_id": "kibana",
              "size": {
                "value": 1024,
                "resource": "memory"
              },
              "zone_count": 1,
              "kibana": {}
            }
          ],
          "kibana": {
            "version": "7.17.0"
          }
        }
      }
    ],
    "apm": [],
    "enterprise_search": []
  }
}</pre>
</div>
</div>
</details>
<p>After adding support for <code class="literal">node_roles</code> to the example deployment plan, the resulting plan should look similar to the following:</p>
<details>
<summary class="title">Example deployment plan with <code class="literal">node_roles</code></summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "name": "Example deployment",
  "prune_orphans": true,
  "metadata": {
    "system_owned": false,
    "hidden": false
  },
  "resources": {
    "elasticsearch": [
      {
        "ref_id": "es-ref-id",
        "region": "ece-region",
        "plan": {
          "tiebreaker_topology": {
            "memory_per_node": 1024
          },
          "cluster_topology": [
            {
              "id": "hot_content",
              "instance_configuration_id": "custom.data",
              "zone_count": 2,
              "node_roles": [
                "master",
                "ingest",
                "data_hot",
                "data_content",
                "remote_cluster_client",
                "transform"
              ],
              "elasticsearch": {
                "node_attributes": {
                  "data": "hot"
                }
              },
              "size": {
                "value": 8192,
                "resource": "memory"
              }
            },
            {
              "id": "warm",
              "instance_configuration_id": "data.highstorage",
              "zone_count": 1,
              "node_roles": [
                "data_warm",
                "remote_cluster_client"
              ],
              "elasticsearch": {
                "node_attributes": {
                  "data": "warm"
                }
              },
              "size": {
                "resource": "memory",
                "value": 0
              }
            },
            {
              "id": "coordinating",
              "zone_count": 1,
              "instance_configuration_id": "coordinating",
              "node_roles": [
                "ingest",
                "remote_cluster_client"
              ],
              "size": {
                "value": 0,
                "resource": "memory"
              }
            },
            {
              "id": "master",
              "zone_count": 1,
              "instance_configuration_id": "custom.master",
              "node_roles": [
                "master",
                "remote_cluster_client"
              ],
              "size": {
                "value": 0,
                "resource": "memory"
              }
            },
            {
              "id": "ml",
              "zone_count": 1,
              "instance_configuration_id": "custom.ml",
              "node_roles": [
                "ml",
                "remote_cluster_client"
              ],
              "size": {
                "value": 0,
                "resource": "memory"
              }
            }
          ],
          "elasticsearch": {
            "version": "7.17.0"
          },
          "deployment_template": {
            "id": "custom-template"
          }
        }
      }
    ],
    "kibana": [
      {
        "region": "ece-region",
        "ref_id": "kibana-ref-id",
        "elasticsearch_cluster_ref_id": "es-ref-id",
        "plan": {
          "cluster_topology": [
            {
              "instance_configuration_id": "kibana",
              "size": {
                "value": 1024,
                "resource": "memory"
              },
              "zone_count": 1,
              "kibana": {}
            }
          ],
          "kibana": {
            "version": "7.17.0"
          }
        }
      }
    ],
    "apm": [],
    "enterprise_search": []
  }
}</pre>
</div>
</div>
</details>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</div><div class="navfooter">
<span class="prev">
<a href="ece-configure-templates-index-management.html">« Configure index management for templates</a>
</span>
<span class="next">
<a href="ece-configuring-ece-instance-configurations-default.html">Default instance configurations »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":false},"go":{"hasAny":false},"ruby":{"hasAny":false},"java":{"hasAny":false},"javascript":{"hasAny":false},"python":{"hasAny":false},"csharp":{"hasAny":false}}}}</script>
  </body>
</html>
