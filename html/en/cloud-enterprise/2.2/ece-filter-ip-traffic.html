<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Filter IP traffic | Elastic Cloud Enterprise Reference [2.2] | Elastic</title>
<meta class="elastic" name="content" content="Filter IP traffic | Elastic Cloud Enterprise Reference [2.2]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.2]"/>
<link rel="up" href="ece-securing-clusters.html" title="Secure your clusters"/>
<link rel="prev" href="security-transport.html" title="Configure the Java Transport client"/>
<link rel="next" href="ece-configuring-keystore.html" title="Secure your settings"/>
<meta class="elastic" name="product_version" content="2.2"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.2"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="2.2"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<p>
  <strong>It is time to say goodbye</strong>: This version of Elastic Cloud Enterprise 
  has reached <a href="https://www.elastic.co/support/eol">end-of-life (EOL)</a>
  and is no longer supported. 
</p>  
<p>
  The documentation for this version is no longer being maintained. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [2.2]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-administering-deployments.html">Administering deployments</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-securing-clusters.html">Secure your clusters</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="security-transport.html">« Configure the Java Transport client</a>
</span>
<span class="next">
<a href="ece-configuring-keystore.html">Secure your settings »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-filter-ip-traffic"></a>Filter IP traffic<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/2.2/docs/cloud-enterprise/ce-filter-ip-traffic.asciidoc">edit</a></h2>
</div></div></div>
<p>After you have defined your rule sets at the platform level, now you must associate them with deployments. You can apply multiple rule sets to each deployment and manage those associations at the deployment level.</p>
<p>Internal traffic between Kibana instances, APM Servers, and the Elasticsearch clusters is automatically allowed.</p>
<h4><a id="ece-ip-filter-5x"></a>Filter traffic for deployments at 5.x or later<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/2.2/docs/cloud-enterprise/ce-filter-ip-traffic.asciidoc">edit</a></h4>
<p>You can add IP filtering associations through the UI or the <a class="xref" href="ece-filter-ip-traffic.html#ece-ip-filter-2x" title="Filter traffic for 2.4.6 deployments">API</a> for deployments at version 5.x or later.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li>
<li class="listitem">
<p>From the <span class="strong strong"><strong>Deployments</strong></span> page, select your deployment.</p>
<p>Narrow the list by name, ID, or choose from several other filters. To further define the list, use a combination of filters.</p>
</li>
<li class="listitem">
From your deployment menu, select <span class="strong strong"><strong>Security</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Apply rule set</strong></span> and then select the sets that you want.
</li>
<li class="listitem">
If the deployment had an existing Kibana instance, you must restart it.
</li>
</ol>
</div>
<p>All other traffic is now blocked.</p>
<h4><a id="ece-ip-filter-2x"></a>Filter traffic for 2.4.6 deployments<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/2.2/docs/cloud-enterprise/ce-filter-ip-traffic.asciidoc">edit</a></h4>
<p>Manage the IP filtering associations for deployments at version 2.4.6 through the API.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Get the rule set ID:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -X GET -u USERNAME:PASSWORD https://ECE_HOST:12433/api/v1/deployments/ip-filtering/rulesets</pre>
</div>
</li>
<li class="listitem">
<p>Get the cluster ID from the string at the end of the deployment page URL or use the API:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -X GET -u USERNAME:PASSWORD https://ECE_HOST:12433/api/v1/clusters/elasticsearch</pre>
</div>
</li>
<li class="listitem">
<p>Associate the rule set by running:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -X POST -u USERNAME:PASSWORD https://ECE_HOST:12433/api/v1/deployments/ip-filtering/rulesets/RULE_SET_ID/associations -H 'content-type: application/json' -d '{
  "entity_type": "cluster",
  "id": "CLUSTER-ID"
}'</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">RULE_SET_ID</code>
</span>
</dt>
<dd>
The rule set ID returned from step 1
</dd>
<dt>
<span class="term">
<code class="literal">CLUSTER-ID</code>
</span>
</dt>
<dd>
The cluster or deployment ID from step 2
</dd>
</dl>
</div>
</li>
</ol>
</div>
<h4><a id="ece-remove-association"></a>Remove an association<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/2.2/docs/cloud-enterprise/ce-filter-ip-traffic.asciidoc">edit</a></h4>
<p>You can remove a rule set association from a deployment use the UI or API. When all sets are gone, the deployment inbound traffic is unrestricted again.</p>
<p>To remove an association through the Cloud UI:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the deployment.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Security</strong></span> page, under <span class="strong strong"><strong>Action</strong></span> simply click the <span class="strong strong"><strong>X</strong></span>.
</li>
</ol>
</div>
<p>To remove an association through the API:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Identify all rule sets associated with the deployment:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -X GET -u USERNAME:PASSWORD https://ECE_HOST:12433/api/v1/deployments/ip-filtering/associations/cluster/CLUSTER_ID/rulesets</pre>
</div>
</li>
<li class="listitem">
<p>For each rule set, run:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -X DELETE -u USERNAME:PASSWORD https://ECE_HOST:12433/api/v1/deployments/ip-filtering/rulesets/RULE_SET_ID/associations/cluster/CLUSTER_ID</pre>
</div>
</li>
</ol>
</div>
<p>If you want to remove the rule set from the platform, you&#8217;ll need remove all associations and then <a class="xref" href="ece-manage-ip-traffic.html#ece-delete-rule-set" title="Delete a rule set or rules">delete it</a>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="security-transport.html">« Configure the Java Transport client</a>
</span>
<span class="next">
<a href="ece-configuring-keystore.html">Secure your settings »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":false},"go":{"hasAny":false},"ruby":{"hasAny":false},"java":{"hasAny":false},"javascript":{"hasAny":false},"python":{"hasAny":false},"csharp":{"hasAny":false}}}}</script>
  </body>
</html>
