<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Access clusters of a self-managed environment | Elastic Cloud Enterprise Reference [3.7] | Elastic</title>
<meta class="elastic" name="content" content="Access clusters of a self-managed environment | Elastic Cloud Enterprise Reference [3.7]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.7]"/>
<link rel="up" href="ece-enable-ccs.html" title="Enable cross-cluster search and cross-cluster replication"/>
<link rel="prev" href="ece-remote-cluster-ece-ess.html" title="Access deployments of an Elasticsearch Service organization"/>
<link rel="next" href="ece-enable-ccs-for-eck.html" title="Enabling CCS/R between Elastic Cloud Enterprise and ECK"/>
<meta class="elastic" name="product_version" content="3.7"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.7"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.7"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="ece-remote-cluster-ece-ess.html">« Access deployments of an Elasticsearch Service organization</a>
</span>
<span class="next">
<a href="ece-enable-ccs-for-eck.html">Enabling CCS/R between Elastic Cloud Enterprise and ECK »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.7]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-administering-deployments.html">Administering deployments</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-enable-ccs.html">Enable cross-cluster search and cross-cluster replication</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Access clusters of a self-managed environment</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-remote-cluster-self-managed"></a>Access clusters of a self-managed environment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h2>
</div></div></div>
<p>This section explains how to configure a deployment to connect remotely to self-managed clusters.</p>
<h4><a id="ece_allow_the_remote_connection_4"></a>Allow the remote connection<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h4>
<p>Before you start, consider the security model that you would prefer to use for authenticating remote connections between clusters, and follow the corresponding steps.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
API key
</span>
</dt>
<dd>
<span class="Admonishment Admonishment--beta">
[<span class="Admonishment-title u-mono">beta</span>]
<span class="Admonishment-detail">
This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.
</span>
</span>
For deployments based on Elastic Stack version 8.10 or later, you can use an API key to authenticate
and authorize cross-cluster operations to a remote cluster. This model offers
administrators of both the local and the remote deployment fine-grained access
controls.
</dd>
<dt>
<span class="term">
TLS certificate
</span>
</dt>
<dd>
This model uses mutual TLS authentication for cross-cluster operations. User authentication
is performed on the local cluster and a user&#8217;s role names are passed to the
remote cluster. A superuser on the local deployment gains total
read access to the remote deployment, so it is only suitable for deployments
that are in the same security domain.
</dd>
</dl>
</div>
<div class="tabs" data-tab-group="os">
  <div role="tablist" aria-label="Add a trusted environment">
    <button role="tab"
            aria-selected="true"
            aria-controls="certificate-tab-allow-remote-connection"
            id="certificate-allow-remote-connection">
      TLS certificate
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="api-key-tab-allow-remote-connection"
            id="api-key-allow-remote-connection"
            tabindex="-1">
      API key (beta)
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="certificate-tab-allow-remote-connection"
       aria-labelledby="certificate-allow-remote-connection">
<h5><a id="ece-trust-self-managed"></a>Specify the deployments trusted to be used as remote clusters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/tab-widgets/ccs-ccr/to-self-managed-content.asciidoc">edit</a></h5>
<p>A deployment can be configured to trust all or specific deployments in any environment:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
From the <span class="strong strong"><strong>Security</strong></span> menu, select <span class="strong strong"><strong>Remote Connections &gt; Add trusted environment</strong></span> and choose <span class="strong strong"><strong>Self-managed</strong></span>, then click <span class="strong strong"><strong>Next</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Certificates</strong></span> as authentication mechanism and click <span class="strong strong"><strong>Next</strong></span>.
</li>
<li class="listitem">
Upload the public certificate for the Certificate Authority of the self-managed environment (the one used to sign all the cluster certificates). The certificate needs to be in PEM format and should not contain the private key. If you only have the key in p12 format, then you can create the necessary file like this: <code class="literal">openssl pkcs12 -in elastic-stack-ca.p12 -out newfile.crt.pem -clcerts -nokeys</code>
</li>
<li class="listitem">
<p>Select the clusters to trust. There are two options here depending on the subject name of the certificates presented by the nodes in your self managed cluster:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Following the Elastic Cloud pattern. In Elastic Cloud, the certificates of all Elasticsearch nodes follow this convention: <code class="literal">CN = {node_id}.node.{cluster_id}.cluster.{scope_id}</code>. If you follow the same convention in your self-managed environment, then choose this option and you will be able to select all or specific clusters to trust.
</li>
<li class="listitem">
<p>If your clusters don&#8217;t follow the previous convention for the certificates subject name of your nodes, you can still specify the node name of each of the nodes that should be trusted by this deployment. (Keep in mind that following this convention will simplify the management of this cluster since otherwise this configuration will need to be updated every time the topology of your self-managed cluster changes along with the trust restriction file. For this reason, it is recommended migrating your cluster certificates to follow the previous convention).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Trust management will not work properly in clusters without an <code class="literal">otherName</code> value specified, as is the case by default in an out-of-the-box <a href="/guide/en/elasticsearch/reference/8.15/install-elasticsearch.html" class="ulink" target="_top">Elasticsearch installation</a>. To have the Elasticsearch certutil generate new certificates with the <code class="literal">otherName</code> attribute, use the file input with the <code class="literal">cn</code> attribute as in the example below.</p>
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
. Provide a name for the trusted environment. That name will appear in the trust summary of your deployment&#8217;s Security page.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create trust</strong></span> to complete the configuration.
</li>
<li class="listitem">
<p>Configure the self-managed cluster to trust this deployment, so that both deployments are configured to trust each other:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Download the Certificate Authority used to sign the certificates of your deployment nodes (it can be found in the Security page of your deployment)
</li>
<li class="listitem">
Trust this CA either using the <a href="/guide/en/elasticsearch/reference/8.15/security-settings.html" class="ulink" target="_top">setting</a> <code class="literal">xpack.security.transport.ssl.certificate_authorities</code> in <code class="literal">elasticsearch.yml</code> or by <a href="/guide/en/elasticsearch/reference/8.15/update-node-certs-different.html" class="ulink" target="_top">adding it to the trust store</a>.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Generate certificates with an <code class="literal">otherName</code> attribute using the Elasticsearch certutil. Create a file called <code class="literal">instances.yaml</code> with all the details of the nodes in your on-premise cluster like below. The <code class="literal">dns</code> and <code class="literal">ip</code> settings are optional, but <code class="literal">cn</code> is mandatory for use with the <code class="literal">trust_restrictions</code> path setting in the next step. Next, run <code class="literal">./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12 -in instances.yaml</code> to create new certificates for all the nodes at once. You can then copy the resulting files into each node.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">instances:
  - name: "node1"
    dns: ["node1.mydomain.com"]
    ip: ["192.168.1.1"]
    cn: ["node1.node.1234567abcd.cluster.myscope.account"]
  - name: "node2"
    dns: ["node2.mydomain.com"]
    ip: ["192.168.1.2"]
    cn: ["node2.node.1234567abcd.cluster.myscope.account"]</pre>
</div>
</li>
<li class="listitem">
<p>Restrict the trusted clusters to allow only the ones which your self-managed cluster should trust.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
All the clusters in your Elastic Cloud Enterprise environment are signed by the same certificate authority. Therefore, adding this CA would make the self-managed cluster trust all your clusters in your ECE environment. This should be limited using the setting <code class="literal">xpack.security.transport.ssl.trust_restrictions.path</code> in <code class="literal">elasticsearch.yml</code>, which points to a file that limits the certificates to trust based on their <code class="literal">otherName</code>-attribute.
</li>
<li class="listitem">
<p>For example, the following file would trust:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
two specific clusters with cluster ids <code class="literal">aaaabbbbaaaabbbb</code>&lt;1&gt; and <code class="literal">xxxxyyyyxxxxyyyy</code>&lt;2&gt; in an ECE environment with Environment ID <code class="literal">1053523734</code>:
</li>
<li class="listitem">
&lt;3&gt; any cluster from an ECE environment with Environment ID <code class="literal">83988631</code>:
</li>
<li class="listitem">
&lt;4&gt; The nodes from its own cluster (whose certificates follow a different convention: <code class="literal">CN = node1.example.com</code>, <code class="literal">CN = node2.example.com</code> and <code class="literal">CN = node3.example.com</code>)
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<pre class="screen">  trust.subject_name:
  - *.node.aaaabbbbaaaabbbb.cluster.1053523734.account <a id="CO79-1"></a><i class="conum" data-value="1"></i>
  - *.node.xxxxyyyyxxxxyyyy.cluster.1053523734.account <a id="CO79-2"></a><i class="conum" data-value="2"></i>
  - *.node.*.cluster.83988631.account <a id="CO79-3"></a><i class="conum" data-value="3"></i>
  - node*.example.com <a id="CO79-4"></a><i class="conum" data-value="4"></i></pre>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Generate new node certificates for an entire cluster using the file input mode of the certutil.</p>
</div>
</div>
<details>
<summary class="title"><span class="strong strong"><strong>Using the API</strong></span></summary>
<div class="content">
<p>You can <a class="xref" href="update-deployment.html" title="Update Deployment">update a deployment</a> using the appropriate <a class="xref" href="ElasticsearchClusterSettings.html" title="ElasticsearchClusterSettings">trust settings</a> for the elasticsearch payload.</p>
<p>In order to trust a cluster whose nodes present certificates with the subject names: "CN = node1.example.com", "CN = node2.example.com" and "CN = node3.example.com" in a self-managed environment, you could update the trust settings with an <a class="xref" href="DirectTrustRelationship.html" title="DirectTrustRelationship">additional direct trust relationship</a> like this:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "trust":{
    "accounts":[
      {
         "account_id":"ec38dd0aa45f4a69909ca5c81c27138a",
         "trust_all":true
      }
    ],
    "direct": [
      {
        "type" : "generic",
        "name" : "My Self-managed environment",
        "additional_node_names" : ["node1.example.com", "node2.example.com", "node3.example.com",],
        "certificates" : [
            {
                "pem" : "-----BEGIN CERTIFICATE-----\nMIIDTzCCA...H0=\n-----END CERTIFICATE-----"
            }
         ],
         "trust_all":false
       }
    ]
  }
}</pre>
</div>
</div>
</details>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="api-key-tab-allow-remote-connection"
       aria-labelledby="api-key-allow-remote-connection"
       hidden="">
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>API key authentication enables a local cluster to authenticate itself with a
remote cluster via a
<a href="/guide/en/elasticsearch/reference/8.15/security-api-create-cross-cluster-api-key.html" class="ulink" target="_top">cross-cluster API key</a>. The
API key needs to be created by an administrator of the remote cluster. The local
cluster is configured to provide this API key on each request to the remote
cluster. The remote cluster verifies the API key and grants access, based on the
API key&#8217;s privileges.</p>
<p>All cross-cluster requests from the local cluster are bound by the API key&#8217;s
privileges, regardless of local users associated with the requests. For example,
if the API key only allows read access to <code class="literal">my-index</code> on the remote cluster, even
a superuser from the local cluster is limited by this constraint. This mechanism
enables the remote cluster&#8217;s administrator to have full control over who can
access what data with cross-cluster search and/or cross-cluster replication. The
remote cluster&#8217;s administrator can be confident that no access is possible
beyond what is explicitly assigned to the API key.</p>
<p>On the local cluster side, not every local user needs to access every piece of
data allowed by the API key. An administrator of the local cluster can further
configure additional permission constraints on local users so each user only
gets access to the necessary remote data. Note it is only possible to further
reduce the permissions allowed by the API key for individual local users. It is
impossible to increase the permissions to go beyond what is allowed by the API
key.</p>
<p>If you run into any issues, refer to
<a href="/guide/en/elasticsearch/reference/8.15/remote-clusters-troubleshooting.html" class="ulink" target="_top">Troubleshooting</a>.</p>
<h5><a id="ece_prerequisites_and_limitations_4"></a>Prerequisites and limitations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-common-api-key-trust-steps.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The local and remote deployments must be on version 8.12 or later.
</li>
</ul>
</div>
<h5><a id="ece_create_a_cross_cluster_api_key_on_the_remote_deployment_4"></a>Create a cross-cluster API key on the remote deployment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-common-api-key-trust-steps.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
On the deployment you will use as remote, use the
<a href="/guide/en/elasticsearch/reference/8.15/security-api-create-cross-cluster-api-key.html" class="ulink" target="_top">Elasticsearch API</a> or <a href="/guide/en/kibana/8.15/api-keys.html" class="ulink" target="_top">Kibana</a> to create a cross-cluster API key.
Configure it with access to the indices you want to use for cross-cluster search or cross-cluster replication.
</li>
<li class="listitem">
Copy the encoded key (<code class="literal">encoded</code> in the response) to a safe location. You will
need it in the next step.
</li>
</ul>
</div>
<h5><a id="ece_configure_the_local_deployment_2"></a>Configure the local deployment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-trust-with-api-key-to-self-managed.asciidoc">edit</a></h5>
<p>The API key created previously will be used by the local deployment to authenticate with the corresponding set of permissions to the remote deployment. For that, you need to add the API key to the local deployment&#8217;s keystore.</p>
<p>The steps to follow depend on whether the Certificate Authority (CA) of the remote environment&#8217;s Elasticsearch HTTPS server, proxy or, load balancing infrastructure is public or private.</p>
<p><span class="strong strong"><strong>The CA is public</strong></span></p>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li>
<li class="listitem">
<p>On the deployments page, select your deployment.</p>
<p>Narrow the list by name, ID, or choose from several other filters. To further define the list, use a combination of filters.</p>
</li>
<li class="listitem">
From the deployment menu, select <span class="strong strong"><strong>Security</strong></span>.
</li>
<li class="listitem">
<p>Locate <span class="strong strong"><strong>Remote connections</strong></span> and select <span class="strong strong"><strong>Add an API key</strong></span>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add a setting:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For the <span class="strong strong"><strong>Setting name</strong></span>, enter the the alias of your choice. You will use this alias to connect to the remote cluster later. It must be lowercase and only contain letters, numbers, dashes and underscores.
</li>
<li class="listitem">
For the <span class="strong strong"><strong>Secret</strong></span>, paste the encoded cross-cluster API key.
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add</strong></span> to save the API key to the keystore.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Restart the local deployment to reload the keystore with its new setting. To do that, go to the deployment&#8217;s main page (named after your deployment&#8217;s name), locate the <span class="strong strong"><strong>Actions</strong></span> menu, and select <span class="strong strong"><strong>Restart Elasticsearch</strong></span>.<br></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the local deployment runs on version 8.13 or greater, you no longer need to perform this step because the keystore is reloaded automatically with the new API keys.</p>
</div>
</div>
</li>
</ol>
</div>
<p>If you later need to update the remote connection with different permissions, you can replace the API key as detailed in <a class="xref" href="ece-edit-remove-trusted-environment.html#ece-edit-remove-trusted-environment-api-key" title="Change a cross-cluster API key used for a remote connection">Update the access level of a remote cluster connection relying on a cross-cluster API key</a>.</p>
</div>
</details>
<p><span class="strong strong"><strong>The CA is private</strong></span></p>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li>
<li class="listitem">
<p>On the deployments page, select your deployment.</p>
<p>Narrow the list by name, ID, or choose from several other filters. To further define the list, use a combination of filters.</p>
</li>
<li class="listitem">
Access the <span class="strong strong"><strong>Security</strong></span> page of the deployment.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Remote Connections &gt; Add trusted environment</strong></span> and choose <span class="strong strong"><strong>Self-managed</strong></span>. Then click <span class="strong strong"><strong>Next</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>API keys</strong></span> as authentication mechanism and click <span class="strong strong"><strong>Next</strong></span>.
</li>
<li class="listitem">
<p>Add a the API key:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Fill both fields.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For the <span class="strong strong"><strong>Setting name</strong></span>, enter the the alias of your choice. You will use this alias to connect to the remote cluster later. It must be lowercase and only contain letters, numbers, dashes and underscores.
</li>
<li class="listitem">
For the <span class="strong strong"><strong>Secret</strong></span>, paste the encoded cross-cluster API key.
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add</strong></span> to save the API key to the keystore.
</li>
<li class="listitem">
Repeat these steps for each API key you want to add. For example, if you want to use several clusters of the remote environment for CCR or CCS.
</li>
</ol>
</div>
</li>
<li class="listitem">
Add the CA certificate of the remote self-managed environment.
</li>
<li class="listitem">
Provide a name for the trusted environment. That name will appear in the trust summary of your deployment&#8217;s Security page.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create trust</strong></span> to complete the configuration.
</li>
<li class="listitem">
<p>Restart the local deployment to reload the keystore with its new setting. To do that, go to the deployment&#8217;s main page (named after your deployment&#8217;s name), locate the <span class="strong strong"><strong>Actions</strong></span> menu, and select <span class="strong strong"><strong>Restart Elasticsearch</strong></span>.<br></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the local deployment runs on version 8.13 or greater, you no longer need to perform this step because the keystore is reloaded automatically with the new API keys.</p>
</div>
</div>
</li>
</ol>
</div>
<p>If you later need to update the remote connection with different permissions, you can replace the API key as detailed in <a class="xref" href="ece-edit-remove-trusted-environment.html#ece-edit-remove-trusted-environment-api-key" title="Change a cross-cluster API key used for a remote connection">Update the access level of a remote cluster connection relying on a cross-cluster API key</a>.</p>
</div>
</details>
  </div>
</div>
<p>You can now connect remotely to the trusted clusters.</p>
<h4><a id="ece_connect_to_the_remote_cluster_4"></a>Connect to the remote cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-connect-to-remote-cluster.asciidoc">edit</a></h4>
<p>On the local cluster, add the remote cluster using Kibana or the Elasticsearch API.</p>
<h5><a id="ece_using_kibana_4"></a>Using Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-enable-ccs-add-remote-cluster.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the Kibana main menu, and select <span class="strong strong"><strong>Stack Management &gt; Data &gt; Remote Clusters &gt; Add a remote cluster</strong></span>.
</li>
<li class="listitem">
Enable <span class="strong strong"><strong>Manually enter proxy address and server name</strong></span>.
</li>
<li class="listitem">
<p>Fill in the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Name</strong></span>: This <em>cluster alias</em> is a unique identifier that represents the
connection to the remote cluster and is used to distinguish between local and
remote indices.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Proxy address</strong></span>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elastic Cloud Enterprise deployment you want to use as a remote.<br></p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you&#8217;re using API keys as security model, change the port into <code class="literal">9443</code>.</p>
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Server name</strong></span>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elastic Cloud Enterprise deployment you want to use as a remote.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ce-copy-remote-cluster-parameters.png" alt="Remote Cluster Parameters in Deployment">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you&#8217;re having issues establishing the connection and the remote cluster is part of an Elastic Cloud Enterprise environment with a private certificate, make sure that the proxy address and server name match with the the certificate information. For more information, refer to <a href="/guide/en/cloud-enterprise/current/ece-administering-endpoints.html" class="ulink" target="_top">Administering endpoints in Elastic Cloud Enterprise</a>.</p>
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Next</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add remote cluster</strong></span> (you have already established trust in a previous step).
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This configuration of remote clusters uses the <a href="/guide/en/elasticsearch/reference/8.15/remote-clusters.html#proxy-mode" class="ulink" target="_top">Proxy mode</a> and it requires that the allocators can communicate via http with the proxies.</p>
</div>
</div>
<h5><a id="ece_using_the_elasticsearch_api_4"></a>Using the Elasticsearch API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-enable-ccs-add-remote-cluster.asciidoc">edit</a></h5>
<p>To configure a deployment as a remote cluster, use the <a href="/guide/en/elasticsearch/reference/8.15/cluster-update-settings.html" class="ulink" target="_top">cluster update settings API</a>. Configure the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">mode</code>: <code class="literal">proxy</code>
</li>
<li class="listitem">
<code class="literal">proxy_address</code>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elastic Cloud Enterprise deployment you want to use as a remote.
Also, using the API, this value can be obtained from the Elasticsearch resource info, concatenating the field <code class="literal">metadata.endpoint</code> and port <code class="literal">9300</code> using a semicolon.
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you&#8217;re using API keys as security model, change the port into <code class="literal">9443</code>.</p>
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">server_name</code>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elastic Cloud Enterprise deployment you want to use as a remote. Also, using the API, this can be obtained from the Elasticsearch resource info field <code class="literal">metadata.endpoint</code>.
</li>
</ul>
</div>
<p>This is an example of the API call to <code class="literal">_cluster/settings</code>:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">PUT /_cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "alias-for-my-remote-cluster": {
          "mode":"proxy",
          "proxy_address": "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io:9300",
          "server_name": "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io"
        }
      }
    }
  }
}</pre>
</div>
<details>
<summary class="title"><span class="strong strong"><strong>Stack Version above 6.7.0 and below 7.6.0</strong></span></summary>
<div class="content">
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This section only applies if you&#8217;re using TLS certificates as cross-cluster security model.</p>
</div>
</div>
<p>When the cluster to be configured as a remote is above 6.7.0 and below 7.6.0, the remote cluster must be configured using the <a href="/guide/en/elasticsearch/reference/8.15/remote-clusters.html#sniff-mode" class="ulink" target="_top">sniff mode</a> with the proxy field.
For each remote cluster you need to pass the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Proxy</strong></span>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the deployment you want to use as a remote under the name <code class="literal">Proxy Address</code>. Also, using the API, this can be obtained from the elasticsearch resource info, concatenating the fields <code class="literal">metadata.endpoint</code> and <code class="literal">metadata.ports.transport_passthrough</code> using a semicolon.
</li>
<li class="listitem">
<span class="strong strong"><strong>Seeds</strong></span>: This field is an array that must contain only one value, which is the <code class="literal">server name</code> that can be found on the <span class="strong strong"><strong>Security</strong></span> page of the ECE deployment you want to use as a remote concatenated with <code class="literal">:1</code>. Also, using the API, this can be obtained from the Elasticsearch resource info, concatenating the fields <code class="literal">metadata.endpoint</code> and <code class="literal">1</code> with a semicolon.
</li>
<li class="listitem">
<span class="strong strong"><strong>Mode</strong></span>: sniff (or empty, since sniff is the default value)
</li>
</ul>
</div>
<p>This is an example of the API call to <code class="literal">_cluster/settings</code>:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "persistent": {
    "cluster": {
      "remote": {
        "my-remote-cluster-1": {
          "seeds": [
            "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io:1"
          ],
          "proxy": "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io:9400"
        }
      }
    }
  }
}</pre>
</div>
</div>
</details>
<h5><a id="ece_using_the_elastic_cloud_enterprise_restful_api_4"></a>Using the Elastic Cloud Enterprise RESTful API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-enable-ccs-add-remote-cluster.asciidoc">edit</a></h5>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This section only applies if you&#8217;re using TLS certificates as cross-cluster security model and when both clusters belong to the same ECE environment (for other scenarios, the Elasticsearch API should be used instead):</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -k -H 'Content-Type: application/json' -X PUT -H "Authorization: ApiKey $ECE_API_KEY" https://COORDINATOR_HOST:12443/api/v1/deployments/$DEPLOYMENT_ID/elasticsearch/$REF_ID/remote-clusters -d '
{
  "resources" : [
    {
      "deployment_id": "$DEPLOYMENT_ID_REMOTE",
      "elasticsearch_ref_id": "$REF_ID_REMOTE",
      "alias": "alias-your-remote",
      "skip_unavailable" : true
    }
  ]
}'</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">DEPLOYMENT_ID_REMOTE</code>
</span>
</dt>
<dd>
The ID of your remote deployment, as shown in the Cloud UI or obtained through the API.
</dd>
<dt>
<span class="term">
<code class="literal">REF_ID_REMOTE</code>
</span>
</dt>
<dd>
The unique ID of the Elasticsearch resources inside your remote deployment (you can obtain these values through the API).
</dd>
</dl>
</div>
<p>Note the following when using the Elastic Cloud Enterprise RESTful API:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
A cluster alias must contain only letters, numbers, dashes (-), or underscores (_).
</li>
<li class="listitem">
To learn about skipping disconnected clusters, refer to the <a href="/guide/en/elasticsearch/reference/8.15/modules-cross-cluster-search.html#skip-unavailable-clusters" class="ulink" target="_top">Elasticsearch documentation</a>.
</li>
<li class="listitem">
When remote clusters are already configured for a deployment, the <code class="literal">PUT</code> request replaces the existing configuration with the new configuration passed. Passing an empty array of resources will remove all remote clusters.
</li>
</ol>
</div>
<p>The following API request retrieves the remote clusters configuration:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -k -X GET -H "Authorization: ApiKey $ECE_API_KEY" https://COORDINATOR_HOST:12443/api/v1/deployments/$DEPLOYMENT_ID/elasticsearch/$REF_ID/remote-clusters</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The response includes just the remote clusters from the same ECE environment.
In order to obtain the whole list of remote clusters, use Kibana or the Elasticsearch API <a href="/guide/en/elasticsearch/reference/8.15/cluster-remote-info.html" class="ulink" target="_top">Elasticsearch API</a> directly.</p>
</div>
</div>
<h4><a id="ece_configure_roles_and_users_4"></a>Configure roles and users<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/shared/ec-ce-connect-to-remote-cluster.asciidoc">edit</a></h4>
<p>To use a remote cluster for cross-cluster replication or cross-cluster search, you need to create user roles with
<a href="/guide/en/elasticsearch/reference/8.15/defining-roles.html#roles-remote-indices-priv" class="ulink" target="_top">remote indices privileges</a>
on the local cluster. Refer to
<a href="/guide/en/elasticsearch/reference/8.15/remote-clusters-api-key.html#remote-clusters-privileges-api-key" class="ulink" target="_top">Configure
roles and users</a>.</p>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</div><div class="navfooter">
<span class="prev">
<a href="ece-remote-cluster-ece-ess.html">« Access deployments of an Elasticsearch Service organization</a>
</span>
<span class="next">
<a href="ece-enable-ccs-for-eck.html">Enabling CCS/R between Elastic Cloud Enterprise and ECK »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":false},"go":{"hasAny":false},"ruby":{"hasAny":false},"java":{"hasAny":false},"javascript":{"hasAny":false},"python":{"hasAny":false},"csharp":{"hasAny":false}}}}</script>
  </body>
</html>
