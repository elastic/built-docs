<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Secure your clusters with OpenID Connect
        | Elasticsearch Add-On for Heroku Documentation
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Add-On for Heroku Documentation" /><link rel="up" href="ech-security.html" title="Securing your deployment" /><link rel="prev" href="echsign_outgoing_saml_message.html" title="Sign Outgoing SAML Message" /><link rel="next" href="ech-monitoring.html" title="Keeping your cluster healthy" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Cloud-Heroku/Reference" /><meta name="DC.subject" content="Elasticsearch Add-On for Heroku" /><meta name="DC.identifier" content="release-ms-24" /><meta name="robots" content="noindex,nofollow" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">The documentation you are looking at is in the process of being revised.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Add-On for Heroku Documentation</a></span> » <span class="breadcrumb-link"><a href="ech-security.html">Securing your deployment</a></span> » <span class="breadcrumb-node">Secure your clusters with OpenID Connect</span></div><div class="navheader"><span class="prev"><a href="echsign_outgoing_saml_message.html">
              « 
              Sign Outgoing SAML Message</a>
           
        </span><span class="next">
           
          <a href="ech-monitoring.html">Keeping your cluster healthy
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="ech-secure-clusters-oidc"></a>Secure your clusters with OpenID Connect</h2></div></div></div><p>You can secure your deployment using OpenID Connect for single sign-on. OpenID Connect is an identity layer on top of the OAuth 2.0 protocol. The end user identity gets verified by an authorization server and basic profile information is sent back to the client.</p><h3><a id="echbefore_you_begin_14"></a>Before you begin</h3><p>To prepare for using OpenID Connect for authentication for deployments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Create or use an existing deployment version 7.2 and later. Make note of the Kibana endpoint URL, it will be referenced as <code class="literal">&lt;KIBANA_ENDPOINT_URL&gt;</code> in the following steps.
</li><li class="listitem"><p class="simpara">
The steps in this section required a moderate understanding of
<a class="ulink" href="https://openid.net/specs/openid-connect-core-1_0.html#Authentication" target="_top">OpenID Connect</a> in general and
the Authorization Code Grant flow specifically. For more information about OpenID Connect and how it works with the Elastic Stack see:
</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
Our <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/master/oidc-guide-authentication.html#oidc-guide-authentication" target="_top">configuration guide for Elasticsearch</a>.

</li></ul></div></li></ul></div><h3><a id="ech-configure-oidc-provider"></a>Configure the OpenID Connect Provider</h3><p>The OpenID <span class="emphasis"><em>Connect Provider</em></span> (OP) is the entity in OpenID Connect that is responsible for authenticating the user and for granting the necessary tokens with the authentication and user information to be consumed by the <span class="emphasis"><em>Relying Parties</em></span> (RP).</p><p>In order for Elasticsearch Add-On for Heroku (acting as an RP) to be able use your OpenID Connect Provider for authentication, a trust relationship needs to be established between the OP and the RP. In the OpenID Connect Provider, this means registering the RP as a client.</p><p>The process for registering the Elasticsearch Add-On for Heroku RP will be different from OP to OP and following the provider’s relevant documentation is prudent. The information for the RP that you commonly need to provide for registration are the following:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">Relying Party Name</code>
</span></dt><dd>
An arbitrary identifier for the relying party. Neither the specification nor our implementation impose any constraints on this value.
</dd><dt><span class="term">
<code class="literal">Redirect URI</code>
</span></dt><dd>
This is the URI where the OP will redirect the user’s browser after authentication. The appropriate value for this is <code class="literal">&lt;KIBANA_ENDPOINT_URL&gt;/api/security/v1/oidc</code>. You might also see this called as the <code class="literal">Callback URI</code>.
</dd></dl></div><p>At the end of the registration process, the OP assigns a Client Identifier and a Client Secret for the RP (Elasticsearch Add-On for Heroku) to use. Note these two values as they are used in the cluster configuration.</p><h3><a id="ech-secure-deployment-oidc"></a>Configure your cluster to use OpenID Connect</h3><p>You’ll need to <a class="link" href="ech-secure-clusters-oidc.html#ech-oidc-client-secret" title="Configure the Client Secret">add the client secret</a> to the keystore and then <a class="link" href="ech-secure-clusters-oidc.html#ech-oidc-user-settings" title="Configure the user settings">update the Elasticsearch user settings</a> to refer to that secret and use the OpenID Connect realm.</p><h4><a id="ech-oidc-client-secret"></a>Configure the Client Secret</h4><p>Configure the Client Secret that was assigned to the PR by the OP during registration to the Elasticsearch keystore.</p><p>This is a sensitive setting, it won’t be stored in plaintext in the cluster configuration but rather as a secure setting. In order to do so,
follow the steps below:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
From the <span class="strong strong"><strong>Deployments</strong></span> page, select your deployment.
</p><p class="simpara">Narrow your deployments by name, ID, or choose from several other filters. To customize your view, use a combination of filters, or change the format from a grid to a list.</p></li><li class="listitem">
From your deployment menu, select <span class="strong strong"><strong>Security</strong></span>.
</li><li class="listitem">
Under the <span class="strong strong"><strong>Elasticsearch Keystore</strong></span> section, click <span class="strong strong"><strong>Create settings</strong></span>.
</li><li class="listitem">
On the <span class="strong strong"><strong>Create setting</strong></span> window, select the secret <span class="strong strong"><strong>Type</strong></span> to be <code class="literal">Secret String</code>.
</li><li class="listitem"><p class="simpara">
Set the <span class="strong strong"><strong>Setting name</strong></span>` to <code class="literal">xpack.security.authc.realms.oidc.cloud-oidc.rp.client_secret</code> and add the Client Secret you received
   from the OP during registration in the <code class="literal">secret</code> field.
</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>After you configure the Client Secret, any attempt to restart the deployement will fail until you complete the rest of the
configuration steps. If you wish to rollback the OpenID Connect related configuration effort, you need to remove the
<code class="literal">xpack.security.authc.realms.oidc.cloud-oidc.rp.client_secret</code> that was just added by clicking on the "remove" button by the
setting name under <code class="literal">Existing Keystores</code>.</p></div></div></li><li class="listitem">
You must also edit your cluster configuration, sometimes also referred to as the deployment plan, in order to add the appropriate settings.
</li></ol></div><h4><a id="ech-oidc-user-settings"></a>Configure the user settings</h4><p>The Elasticsearch cluster needs to be configured to use the OpenID Connect realm for user authentication and to map the applicable roles to the users.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
<a class="link" href="ech-add-user-settings.html" title="Add Elasticsearch user settings">Update your Elasticsearch user settings</a> for the <code class="literal">oidc</code> realm and specify the relevant configuration:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        oidc:
          cloud-oidc: <a id="CO7-4"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            order: 2
            rp.client_id: "client-id" <a id="CO7-5"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            rp.response_type: "code"
            rp.redirect_uri: "&lt;KIBANA_ENDPOINT_URL&gt;/api/security/v1/oidc" <a id="CO7-6"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
            op.issuer: "&lt;check with your OpenID Connect Provider&gt;" <a id="CO7-7"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
            op.authorization_endpoint: "&lt;check with your OpenID Connect Provider&gt;" <a id="CO7-8"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
            op.token_endpoint: "&lt;check with your OpenID Connect Provider&gt;" <a id="CO7-9"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
            op.userinfo_endpoint: "&lt;check with your OpenID Connect Provider&gt;" <a id="CO7-10"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
            op.jwkset_path: "&lt;check with your OpenID Connect Provider&gt;" <a id="CO7-11"></a><span><img src="images/icons/callouts/8.png" alt="" /></span>
            claims.principal: sub <a id="CO7-12"></a><span><img src="images/icons/callouts/9.png" alt="" /></span>
            claims.groups: "http://example.info/claims/groups" <a id="CO7-13"></a><span><img src="images/icons/callouts/10.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO7-3"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> <a href="#CO7-4"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
You can only use the <code class="literal">oidc</code> realm name: <code class="literal">cloud-oidc</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> <a href="#CO7-5"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This, usually opaque, arbitrary string, is the Client Identifier that was assigned to the Elasticsearch Add-On for Heroku RP by the OP upon registration.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-6"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Replace <code class="literal">&lt;KIBANA_ENDPOINT_URL&gt;</code> with the value noted in the previous step
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-7"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A url, used as a unique identifier for the OP. The value for this setting should be
provided by your OpenID Connect Provider.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-8"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The URL for the Authorization Endpoint in the OP. This is where the user’s browser
will be redirected to start the authentication process. The value for this setting should be provided by your OpenID Connect Provider.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-9"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The URL for the Token Endpoint in the OpenID Connect Provider. This is the endpoint where
Elasticsearch Add-On for Heroku will send a request to exchange the code for an ID Token, as part of the Authorization Code flow. The value for this setting should be provided by your OpenID Connect Provider.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-10"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
(Optional) The URL for the UserInfo Endpoint in the OpenID Connect Provider. This is the
endpoint of the OP that can be queried to get further user information, if required. The value
for this setting should be provided by your OpenID Connect Provider.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-11"><span><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The path to a file or an HTTPS URL pointing to a JSON Web Key Set with the key material
that the OpenID Connect Provider uses for signing tokens and claims responses. Your OpenID Connect Provider should provide you with this file.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-12"><span><img src="images/icons/callouts/9.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Defines the OpenID Connect claim that is going to be mapped to the principal (username) of the authenticated user in Kibana. In this example, we map the value of the <code class="literal">sub</code> claim, but this is not a requirement, other claims can be used too. See
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/master/oidc-guide-authentication.html#oidc-claims-mapping" target="_top">the claims mapping documentation</a> for details and available options.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-13"><span><img src="images/icons/callouts/10.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Defines the OpenID Connect claim that is going to be used for role mapping. Note that the value <code class="literal">"http://example.info/claims/groups"</code>
that is used here, is an arbitrary example. See <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/master/oidc-guide-authentication.html#oidc-claims-mapping" target="_top">the claims mapping documentation</a> for a very detailed description of how the claim mapping works and how can these be used for role mapping. The name of this claim should be determined by the configuration of your OpenID Connect Provider.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>According to the OpenID Connect specification, the OP should also make their configuration available at a well known URL, which is the concatenation of their <code class="literal">Issuer</code> value with the <code class="literal">.well-known/openid-configuration</code> string. For example: <code class="literal">https://op.org.com/.well-known/openid-configuration</code>. That document should contain all the necessary information to configure the OpenID Connect realm above.</p></div></div></li><li class="listitem"><p class="simpara">
By default, users authenticating via OpenID Connect have no roles assigned to them. For example, if you want all your users authenticating with OpenID Connect to get access to Kibana, issue the following request to Elasticsearch:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">POST /_xpack/security/role_mapping/CLOUD_OIDC_TO_KIBANAUSER <a id="CO8-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
{
   "enabled": true,
    "roles": [ "kibana_user" ], <a id="CO8-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "rules": { <a id="CO8-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "field": { "realm.name": "cloud-oidc" } <a id="CO8-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
    },
    "metadata": { "version": 1 }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The name of the new role mapping.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The role mapped to the users.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The fields to match against.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The name of the OpenID Connect realm. This must be <code class="literal">cloud-oidc</code>.
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
Update Kibana in the
<a class="link" href="ech-manage-kibana-settings.html" title="Add Kibana user settings">user settings configuration</a>
to use OpenID Connect as the authentication provider:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">xpack.security.authProviders: [oidc]
xpack.security.authc.oidc.realm: "cloud-oidc" <a id="CO9-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
server.xsrf.whitelist: [/api/security/v1/oidc]</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This needs to be the same value as the one used in the cluster configuration, so the only
allowed value is: <code class="literal">cloud-oidc</code>.
</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>This configuration disables all other realms and only allows users to authenticate with OpenID Connect. If you wish to allow your native realm users to authenticate, you need to also enable the <code class="literal">basic</code> <code class="literal">authProvider</code> by setting <code class="literal">xpack.security.authProviders: [oidc, basic]</code> in the configuration of Kibana.
You can then access the Kibana login screen at <code class="literal">&lt;KIBANA_ENDPOINT_URL&gt;/login</code></p></div></div></td></tr></table></div></li><li class="listitem"><p class="simpara">
Optional: If your OpenID Connect Provider doesn’t publish its JWKS at an https URL, or if you want to use a local copy, you can upload the JWKS as a file.
</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
Prepare a ZIP file with a
<a class="link" href="ech-custom-bundles.html" title="Upload custom plugins, dictionaries, and scripts">custom bundle</a>
that contains your OpenID Connect Provider’s JWKS file (<code class="literal">op_jwks.json</code>) inside of an <code class="literal">oidc</code> folder.
</p><p class="simpara">This bundle allows all Elasticsearch containers to access the metadata file.</p></li><li class="listitem"><p class="simpara">
Update your Elasticsearch cluster on the <a class="link" href="ech-adding-plugins.html" title="Add plugins">deployments page</a> to use the bundle you prepared in the previous step.
</p><p class="simpara">Custom bundles are unzipped under the path <code class="literal">/app/config/BUNDLE_DIRECTORY_STRUCTURE</code>, where <code class="literal">BUNDLE_DIRECTORY_STRUCTURE</code> is the directory structure in the ZIP file. Make sure to save the file location where custom bundles get unzipped, as you will need it in the next step.</p><p class="simpara">In our example, the OpenID Connect Provider JWK set file will be located in the path <code class="literal">/app/config/oidc/op_jwks.json</code>:</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">$ tree .
.
└── oidc
      └── op_jwks.json</pre></div></li><li class="listitem"><p class="simpara">
Adjust your <code class="literal">oidc</code> realm configuration accordingly:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        oidc:
          cloud-oidc:
            ...
            op.jwks_path: /app/config/oidc/op_jwks.json <a id="CO10-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The path to the JWKS file that was uploaded
</p></td></tr></table></div></li></ol></div></li></ol></div><h3><a id="ech-oidc-ssl-configuration"></a>Configure SSL</h3><p>OpenID Connect depends on TLS to provider security properties such as encryption in transit and endpoint authentication. The RP
is required to establish back-channel communication with the OP in order to exchange the code for an ID Token during the
Authorization code grant flow and in order to get additional user information from the UserInfo endpoint. As such, it is
important that Elasticsearch Add-On for Heroku can validate and trust the server certificate that the OP uses for TLS. Since the system truststore is
used for the client context of outgoing https connections, if you OP is using a certificate from a trusted CA, no additional
configuration is needed.</p><p>However, if your OP uses a certificate that is issued for instance, by a CA used only in your Organization, you must configure
Elasticsearch Add-On for Heroku to trust that CA.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Prepare a ZIP file with a
<a class="link" href="ech-custom-bundles.html" title="Upload custom plugins, dictionaries, and scripts">custom bundle</a>
that contains the CA certificate (<code class="literal">company-ca.pem</code>) that signed the certificate your OpenID Connect Provider uses for TLS inside
of an <code class="literal">oidc-tls</code> folder
</li><li class="listitem"><p class="simpara">
Update your Elasticsearch cluster on the <a class="link" href="ech-adding-plugins.html" title="Add plugins">deployments page</a> to use the bundle you prepared in the previous step.
</p><p class="simpara">Custom bundles are unzipped under the path <code class="literal">/app/config/BUNDLE_DIRECTORY_STRUCTURE</code>, where <code class="literal">BUNDLE_DIRECTORY_STRUCTURE</code> is the directory structure in the ZIP file. Make sure to save the file location where custom bundles get unzipped, as you will need it in the next step.</p><p class="simpara">In our example, the CA certificate file will be located in the path <code class="literal">/app/config/oidc-tls/company-ca.pem</code>:</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">$ tree .
.
└── oidc-tls
      └── company-ca.pem</pre></div></li><li class="listitem"><p class="simpara">
Adjust your <code class="literal">oidc</code> realm configuration accordingly:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        oidc:
          cloud-oidc:
            ...
            ssl.certificate_authorities: ["/app/config/oidc-tls/company-ca.pem"] <a id="CO11-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The path where the CA Certificate file was uploaded
</p></td></tr></table></div></li></ol></div><h3><a id="ech-oidc-optional-settings"></a>Optional Settings</h3><p>The following optional oidc realm settings are supported and can be set if needed:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">op.endsession_endpoint</code> The URL to the End Session Endpoint in the OpenID Connect Provider. This is the endpoint
   where the user’s browser will be redirected after local logout, if the realm is configured for RP initiated
   Single Logout and the OP supports it. The value for this setting should be provided by your OpenID Connect Provider.
</li><li class="listitem">
<code class="literal">rp.post_logout_redirect_uri</code> The Redirect URL where the OpenID Connect Provider should redirect the user after a
   successful Single Logout. This should be set to a value that will not trigger a new OpenID Connect Authentication,
   <code class="literal">&lt;KIBANA_ENDPOINT_URL&gt;/logged_out</code> is a good choice for this parameter.
</li><li class="listitem">
<code class="literal">rp.signature_algorithm</code> The signature algorithm that will be used by Elasticsearch in order to verify the signature of the ID
  tokens it will receive from the OpenID Connect Provider. Defaults to <code class="literal">RSA256</code>.
</li><li class="listitem">
<code class="literal">rp.requested_scopes</code> The scope values that will be requested by the OpenID Connect Provider as part of the
   Authentication Request. Defaults to <code class="literal">openid</code>, which is the only required scope for authentication. If your use case
   requires that you receive additional claims, you might need to request additional scopes, one of <code class="literal">profile</code>, <code class="literal">email</code>,
   <code class="literal">address</code>, <code class="literal">phone</code>. Note that <code class="literal">openid</code> should always be included in the list of requested scopes.
</li></ul></div></div><div class="navfooter"><span class="prev"><a href="echsign_outgoing_saml_message.html">
              « 
              Sign Outgoing SAML Message</a>
           
        </span><span class="next">
           
          <a href="ech-monitoring.html">Keeping your cluster healthy
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
