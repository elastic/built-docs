<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Scenario: How do I resolve configuration change failures? | Elasticsearch Service Documentation | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Service Documentation"/>
<link rel="up" href="ec-monitoring.html" title="Keeping your deployment healthy"/>
<link rel="prev" href="ec-deployment-no-op.html" title="Scenario: How do I resolve deployment health warnings?"/>
<link rel="next" href="ec-deployment-node-move.html" title="Scenario: Why did my node move to a different host?"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="latest"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="ec-monitoring.html">Keeping your deployment healthy</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ec-deployment-no-op.html">« Scenario: How do I resolve deployment health warnings?</a>
</span>
<span class="next">
<a href="ec-deployment-node-move.html">Scenario: Why did my node move to a different host? »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ec-config-change-errors"></a>Scenario: How do I resolve configuration change failures?<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h2>
</div></div></div>
<p>When you attempt to apply a configuration change to a deployment, the attempt may fail with an error indicating that the change could not be applied, and deployment resources may be unable to restart. In some cases, bootlooping may result, where the deployment resources cycle through a continual reboot process.</p>
<div class="imageblock">
<div class="content">
<img src="images/ec-ce-configuration-change-failure.png" alt="A screen capture of the deployment page showing an error: Latest change to Elasticsearch configuration failed.">
</div>
</div>
<p>To help diagnose these and any other types of issues in your deployments, we recommend <a class="xref" href="ec-monitoring-setup.html" title="How to set up monitoring">setting up monitoring</a>. Then, you can easily view your deployment health and access log files.</p>
<p>To confirm if your Elasticsearch cluster is bootlooping, you can check the most recent plan under your <a class="xref" href="ec-activity-page.html" title="Keep track of deployment activity">Deployment Activity page</a> for the error:</p>
<pre class="screen">Plan change failed: Some instances were not running</pre>
<p>Following are some frequent causes of a failed configuration change:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ec-config-change-errors.html#ec-config-change-errors-secure-settings" title="Secure settings">Secure settings</a>
</li>
<li class="listitem">
<a class="xref" href="ec-config-change-errors.html#ec-config-change-errors-expired-bundle-extension" title="Expired custom plugins or bundles">Expired custom plugins or bundles</a>
</li>
<li class="listitem">
<a class="xref" href="ec-config-change-errors.html#ec-config-change-errors-oom-errors" title="OOM errors">OOM errors</a>
</li>
<li class="listitem">
<a class="xref" href="ec-config-change-errors.html#ec-config-change-errors-existing-index" title="Existing index">Existing index</a>
</li>
</ol>
</div>
<h3><a id="ec-config-change-errors-secure-settings"></a>Secure settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h3>
<p>The most frequent cause of a failed deployment configuration change is due to invalid or mislocated <a class="xref" href="ec-configuring-keystore.html" title="Secure your settings">secure settings</a>. These are settings typically added to the keystore for the purpose of:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Setting up third-party authentication, for example <a class="xref" href="ec-securing-clusters-SAML.html" title="Secure your clusters with SAML">SAML</a>, <a class="xref" href="ec-secure-clusters-oidc.html" title="Secure your clusters with OpenID Connect">OpenID Connect</a>, or <a class="xref" href="ec-secure-clusters-kerberos.html" title="Secure your clusters with Kerberos">Kerberos</a>.
</li>
<li class="listitem">
Setting up a <a class="xref" href="ec-custom-repository.html" title="Snapshot and restore with custom repositories">custom repository</a>.
</li>
</ol>
</div>
<p>The keystore allows you to safely store sensitive settings, such as passwords, as a key/value pair. You can then access a secret value from a settings file by referencing its key. Importantly, not all settings can be stored in the keystore, and the keystore does not validate the settings that you add. Adding unsupported settings can cause Elasticsearch or other components to fail to restart. To check whether a setting is supported in the keystore, look for a "Secure" qualifier in the <a href="/guide/en/elasticsearch/reference/8.3/secure-settings.html" class="ulink" target="_top">lists of reloadable settings</a>.</p>
<p>The following sections detail some secure settings problems that can result in a configuration change error that can prevent a deployment from restarting.</p>
<h4><a id="ec-config-change-errors-old-values"></a>Invalid or outdated values<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h4>
<p>The keystore does not validate any settings that you add, so invalid or outdated values are a common source of errors when you apply a configuration change to a deployment.</p>
<p>To check the current set of stored settings:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the deployment <span class="strong strong"><strong>Security</strong></span> page.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Elasticsearch keystore</strong></span> section, check the <span class="strong strong"><strong>Security keys</strong></span> list. The list is shown only if you currently have settings configured in the keystore.
</li>
</ol>
</div>
<p>One frequent cause of errors is when settings in the keystore are no longer valid, such as when SAML settings are added for a test environment, but the settings are either not carried over or no longer valid in a production environment.</p>
<h4><a id="ec-config-change-errors-snapshot-repos"></a>Snapshot repositories<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h4>
<p>Sometimes, settings added to the keystore to connect to a snapshot repository may not be valid. When this happens, you may get an error such as <code class="literal">SettingsException[Neither a secret key nor a shared access token was set.]</code></p>
<p>For example, when adding an <a href="/guide/en/elasticsearch/reference/8.3/repository-azure.html#repository-azure-usage" class="ulink" target="_top">Azure repository storage setting</a> such as <code class="literal">azure.client.default.account</code> to the keystore, the associated setting <code class="literal">azure.client.default.key</code> must also be added for the configuration to be valid.</p>
<h4><a id="ec-config-change-errors-third-party-auth"></a>Third-party authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h4>
<p>When you configure third-party authentication, it&#8217;s important that all required configuration elements that are stored in the keystore are included in the Elasticsearch user settings file. For example, when you <a href="/guide/en/elasticsearch/reference/8.3/saml-guide-stack.html#saml-create-realm" class="ulink" target="_top">create a SAML realm</a>, omitting a field such as <code class="literal">idp.entity_id</code> when that setting is present in the keystore results in a failed configuration change.</p>
<h4><a id="ec-config-change-errors-wrong-location"></a>Wrong location<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h4>
<p>In some cases, settings may accidentally be added to the keystore that should have been added to the <a class="xref" href="ec-add-user-settings.html" title="Edit Elasticsearch user settings">Elasticsearch user settings file</a>. It&#8217;s always a good idea to check the <a href="/guide/en/elasticsearch/reference/8.3/secure-settings.html" class="ulink" target="_top">lists of reloadable settings</a> to determine if a setting can be stored in the keystore. Settings that can safely be added to the keystore are flagged as <code class="literal">Secure</code>.</p>
<h3><a id="ec-config-change-errors-expired-bundle-extension"></a>Expired custom plugins or bundles<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h3>
<p>During the process of applying a configuration change, Elasticsearch Service checks to determine if any <a class="xref" href="ec-custom-bundles.html" title="Upload custom plugins and bundles">uploaded custom plugins or bundles</a> are expired.</p>
<p>To view any added plugins or bundles:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the <span class="strong strong"><strong>Features</strong></span> page and open the <span class="strong strong"><strong>Extensions</strong></span> tab.
</li>
<li class="listitem">
Select any extension and then choose <span class="strong strong"><strong>Update extension</strong></span> to renew it. No other changes are needed, and any associated configuration change failures should now be able to succeed.
</li>
</ol>
</div>
<h3><a id="ec-config-change-errors-oom-errors"></a>OOM errors<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h3>
<p>Configuration change errors can occur when there is insufficient RAM configured for a data tier. In this case, the cluster typically also shows OOM (out of memory) errors. To resolve thes, you need to increase the amount of heap memory, which is half of the amount of memory allocated to a cluster. Check the <a class="xref" href="ec-customize-deployment-components.html#ec-cluster-size" title="Elasticsearch">Elasticsearch cluster size</a> and the <a class="xref" href="ec-memory-pressure.html" title="JVM memory pressure indicator">JVM memory pressure indicator</a> documentation to learn more. As well, you can read our detailed blog <a href="/blog/managing-and-troubleshooting-elasticsearch-memory" class="ulink" target="_top">Managing and troubleshooting Elasticsearch memory</a>.</p>
<h3><a id="ec-config-change-errors-existing-index"></a>Existing index<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-77/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></h3>
<p>In rare cases, when you attempt to upgrade the version of a deployment and the upgrade fails on the first attempt, subsequent attempts to upgrade may fail due to already existing resources. The problem may be due to the system preventing itself from overwriting existing indices, resulting in an error such as this: <code class="literal">Another Kibana instance appears to be migrating the index. Waiting for that migration to complete. If no other Kibana instance is attempting migrations, you can get past this message by deleting index .kibana_2 and restarting Kibana</code>.</p>
<p>To resolve this:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Check that you don&#8217;t need the content.
</li>
<li class="listitem">
<p>Run an Elasticsearch <a href="/guide/en/elasticsearch/reference/8.3/indices-delete-index.html" class="ulink" target="_top">Delete index request</a> to remove the existing index.</p>
<p>In this example, the <code class="literal">.kibana_2</code> index is the rollover of saved objects (such as Kibana visualizations or dashboards) from the original <code class="literal">.kibana_1</code> index. Since <code class="literal">.kibana_2</code> was created as part of the failed upgrade process, this index does not yet contain any pertinent data and it can safely be deleted.</p>
</li>
<li class="listitem">
Retry the deployment configuration change.
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ec-deployment-no-op.html">« Scenario: How do I resolve deployment health warnings?</a>
</span>
<span class="next">
<a href="ec-deployment-node-move.html">Scenario: Why did my node move to a different host? »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"go":{"hasAny":true},"ruby":{"hasAny":true},"java":{"hasAny":true},"javascript":{"hasAny":true},"python":{"hasAny":true},"csharp":{"hasAny":true}}}}</script>
  </body>
</html>
