<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Migrate from Amazon OpenSearch Service (formerly Amazon Elasticsearch Service) | Elasticsearch Service Documentation | Elastic</title>
<meta class="elastic" name="content" content="Migrate from Amazon OpenSearch Service (formerly Amazon Elasticsearch Service) | Elasticsearch Service Documentation">

<link rel="home" href="index.html" title="Elasticsearch Service Documentation"/>
<link rel="up" href="ec-migrating-data.html" title="Migrating data"/>
<link rel="prev" href="ec-migrating-data.html" title="Migrating data"/>
<link rel="next" href="ec-remote-reindex.html" title="Migrate from a self-managed cluster with a self-signed certificate using remote reindex"/>
<meta class="elastic" name="product_version" content="latest"/>
<meta class="elastic" name="product_name" content="Elastic Cloud"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="latest"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-cloud-ingest-data.html">Adding data to Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-migrating-data.html">Migrating data</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ec-migrating-data.html">« Migrating data</a>
</span>
<span class="next">
<a href="ec-remote-reindex.html">Migrate from a self-managed cluster with a self-signed certificate using remote reindex »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ec-migrate-from-aws"></a>Migrate from Amazon OpenSearch Service (formerly Amazon Elasticsearch Service)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-90/docs/saas/ec-migrating-from-aws.asciidoc">edit</a></h2>
</div></div></div>
<p>This is a fairly technical guide for migrating from Amazon OpenSearch Service (formerly referred to as Amazon Elasticsearch Service, Amazon ES, or AWS ES) to Elasticsearch Service on Elastic Cloud. These steps may require some programming experience. Amazon OpenSearch Service clusters are commonly provisioned into a Virtual Private Cloud (VPC) with a private IP address. They can also be located on a public-facing endpoint. In order to keep this guide universal, we describe how to migrate your data in either scenario. Please note, these steps assume that your Amazon OpenSearch Service domain runs an Elasticsearch OSS version.</p>
<h4><a id="ec_before_you_begin_3"></a>Before you begin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-90/docs/saas/ec-migrating-from-aws.asciidoc">edit</a></h4>
<p>Following are a few things to make note of before you proceed with the steps to migrate your Amazon OpenSearch Service data.</p>
<p><a id="ec-migrate-from-aws-es-security-steps"></a><span class="strong strong"><strong>Permissions</strong></span></p>
<p>It’s important to understand the IAM security steps in this process. First, in order to snapshot an AWS ES cluster into S3, your AWS ES cluster needs permission to write to a private S3 bucket. This requires an IAM role and policy with those permissions. Next, you’ll need to attach an IAM policy to an IAM user. Create a new user if necessary. Use that IAM user to connect to your AWS ES cluster, and later your Elastic-managed deployment can use the same credentials to read the snapshot from your S3 bucket.</p>
<p>To learn more about setting up an IAM role, policy, and user, check <a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-managedomains-snapshots.html" class="ulink" target="_top">Creating index snapshots in Amazon OpenSearch Service</a> in the AWS documentation.</p>
<p><a id="ec-migrate-from-aws-es-tools"></a><span class="strong strong"><strong>Tools</strong></span></p>
<p>During this procedure, you run a manual snapshot request on your AWS Elasticsearch cluster. If you can access your ES cluster directly, use the Postman client to run the request. If your ES cluster is inside a Virtual Private Cloud (VPC), use the Python AWS SDK. Details about each tool are provided in <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-part2" title="Part 2 - Take a snapshot of your Elasticsearch data">Part 2</a>.</p>
<p><a id="ec-migrate-from-aws-es-variables-table"></a><span class="strong strong"><strong>AWS variables</strong></span></p>
<p>There are several variables to make note of along the way. We suggest that you copy and paste the following table to a notes file, to make it easy to fill in the values specific for your migration.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Expand to view the variables table</strong></span></summary>
<div class="content">
<div class="table">
<p class="title"><strong>Table 1. Data migration variables</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Data migration variables">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Description</p></td>
<td align="left" valign="top"><p>Variable</p></td>
<td align="left" valign="top"><p>Value</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS ES Domain ARN</p></td>
<td align="left" valign="top"><p>DOMAIN_ARN</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS ES Endpoint URL</p></td>
<td align="left" valign="top"><p>ES_ENDPOINT</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS ES Region</p></td>
<td align="left" valign="top"><p>ES_REGION</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS S3 Bucket Name</p></td>
<td align="left" valign="top"><p>S3_BUCKET_NAME</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS S3 Region</p></td>
<td align="left" valign="top"><p>S3_REGION_NAME</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS IAM Role ARN</p></td>
<td align="left" valign="top"><p>ROLE_ARN</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS IAM Access Key ID</p></td>
<td align="left" valign="top"><p>ACCESS_KEY</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS IAM Secret Access Key</p></td>
<td align="left" valign="top"><p>SECRET_KEY</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS ES Snapshot Repository</p></td>
<td align="left" valign="top"><p>SNAPSHOT_REPO</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>AWS ES Snapshot Name</p></td>
<td align="left" valign="top"><p>SNAPSHOT_NAME</p></td>
<td align="left" valign="top"><p>-</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</details>
<p>You can change the values of <code class="literal">SNAPSHOT_REPO</code> and <code class="literal">SNAPSHOT_NAME</code> or use the values provided in these examples, namely <code class="literal">my-snapshot-repo</code> and <code class="literal">my-snapshot</code>.</p>
<h4><a id="ec-migrate-from-aws-es-procedure"></a>Procedure<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-90/docs/saas/ec-migrating-from-aws.asciidoc">edit</a></h4>
<p>Migrating from AWS involves three main tasks.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Part 1
</span>
</dt>
<dd>
Set up an AWS Identity and Access Management (IAM) user with access to an AWS S3 storage bucket.
</dd>
<dt>
<span class="term">
Part 2
</span>
</dt>
<dd>
Take a snapshot of the existing Elasticsearch data. If you can&#8217;t run commands on the Elasticsearch instance because it&#8217;s within a VPC that you can&#8217;t access, you&#8217;ll need to run a lightweight client on a host within your VPC.
</dd>
<dt>
<span class="term">
Part 3
</span>
</dt>
<dd>
Set up a deployment on Elasticsearch Service and restore the snapshot data to the new Elasticsearch cluster.
</dd>
</dl>
</div>
<p>If you already have your Amazon OpenSearch Service cluster manually snapshotted to S3, skip ahead to <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-part3" title="Part 3 - Restore your snapshot to a new deployment">Part 3</a> of this guide.</p>
<p><span class="strong strong"><strong>Part 1 - Set up an IAM user with access to an S3 bucket</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-1-1">Get your AWS ES details</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-1-2">Create an AWS S3 bucket</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-1-3">Create an IAM role</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-1-4">Create an IAM policy</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-1-5">Create an IAM user</a>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Part 2 - Take a snapshot of your Elasticsearch data</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>If you can access your Elasticsearch cluster directly:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-2-1a">Register a snapshot repository using Postman</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-2-1b">Take a snapshot of your data</a>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>If your Elasticsearch cluster is inside a VPC that you don&#8217;t have access to (such as through a VPN):</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-2-2a">Configure the Python AWS SDK</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-2-2b">Manually snapshot AWS ES</a>
</li>
</ol>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Part 3 - Restore your snapshot to a new deployment</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-3-1">Create a deployment in Elasticsearch Service</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-3-2">Add your secrets to the keystore</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-3-3">Register your snapshot repository in your new deployment</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-3-4">Restore from your new snapshot repository</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-3-5">Explore Elasticsearch Service</a>
</li>
</ol>
</div>
<h4><a id="ec-migrate-from-aws-es-part1"></a>Part 1 - Set up an IAM user with access to an S3 bucket<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-90/docs/saas/ec-migrating-from-aws.asciidoc">edit</a></h4>
<p><a id="ec-migrate-from-aws-es-1-1"></a><span class="strong strong"><strong>1. Get your AWS ES details</strong></span></p>
<p>You need some basic information about your Amazon OpenSearch Service cluster to snapshot it to S3.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the Amazon OpenSearch Service, in your AWS Console.
</li>
<li class="listitem">
Select on the domain of the cluster you want to snapshot.
</li>
<li class="listitem">
Copy the <code class="literal">Endpoint</code> URL value to your <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-variables-table">notes file</a> (ES_ENDPOINT).
</li>
<li class="listitem">
Copy the <code class="literal">Domain ARN</code> value to your <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-variables-table">notes file</a> (DOMAIN_ARN).
</li>
<li class="listitem">
Note which AWS region (for example, <em>us-east-1</em>) your AWS ES cluster is located in (ES_REGION).
</li>
</ol>
</div>
<p>This information is used later. First in the IAM policy creation, and then to issue commands to the cluster.</p>
<p><a id="ec-migrate-from-aws-es-1-2"></a><span class="strong strong"><strong>2. Create an AWS S3 bucket</strong></span></p>
<p>You&#8217;ll need an S3 bucket to store the snapshot.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Ensure your S3 bucket is the same region as your Amazon OpenSearch Service cluster. From there you are able to restore to an Elastic-managed deployment in any region or cloud provider (AWS, GCP, or Azure).</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the S3 service, in your AWS Console.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create bucket</strong></span> to create a private S3 bucket.
</li>
<li class="listitem">
Choose your privacy and security settings.
</li>
<li class="listitem">
Copy the name of the bucket to your <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-variables-table">notes file</a> (S3_BUCKET_NAME).
</li>
<li class="listitem">
Copy the region of the bucket to your <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-variables-table">notes file</a> (S3_REGION_NAME).
</li>
</ol>
</div>
<p><a id="ec-migrate-from-aws-es-1-3"></a><span class="strong strong"><strong>3. Create an IAM role</strong></span></p>
<p>Create a role to delegate permission to Amazon OpenSearch Service to take a snapshot into S3.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the IAM service, in your AWS Console.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>Roles</strong></span> page.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create role</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>EC2</strong></span> as the service to use this new role (you change it later).
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Next: Permissions</strong></span>.
</li>
<li class="listitem">
Leave the policies on the role empty for now.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Next: Tags</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Next: Review</strong></span>.
</li>
<li class="listitem">
Name the role: <code class="literal">TheSnapshotRole</code>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create role</strong></span>.
</li>
<li class="listitem">
From the list of roles, choose the role you just created: <code class="literal">TheSnapshotRole</code>.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>Trust relationships</strong></span> tab.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Edit trust relationship</strong></span>.
</li>
<li class="listitem">
<p>Copy and paste the following JSON into the Policy Document field, replacing the sample text:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">{
 "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Principal": {
      "Service": "es.amazonaws.com"
    },
    "Action": "sts:AssumeRole"
  }]
}</pre>
</div>
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Update Trust Policy</strong></span>.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>Permissions</strong></span> tab.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Add inline policy</strong></span>.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>JSON</strong></span> tab.
</li>
<li class="listitem">
<p>Copy and paste the following JSON, replacing the sample text.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Replace <code class="literal">S3_BUCKET_NAME</code> with the correct value.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">{
  "Version": "2012-10-17",
  "Statement": [{
      "Action": [
        "s3:ListBucket"
      ],
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::S3_BUCKET_NAME"
      ]
    },
    {
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::S3_BUCKET_NAME/*"
      ]
    }
  ]
}</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Review policy</strong></span>.
</li>
<li class="listitem">
Name the policy: <code class="literal">TheSnapshotS3Policy</code>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create policy</strong></span>.
</li>
<li class="listitem">
Copy the <code class="literal">Role ARN</code> value to your <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-variables-table">notes file</a> (ROLE_ARN).
</li>
</ol>
</div>
<p>An IAM role is created inline policy that can read and write to your S3 bucket.</p>
<p><a id="ec-migrate-from-aws-es-1-4"></a><span class="strong strong"><strong>4. Create an IAM policy</strong></span></p>
<p>Create a new IAM policy with permission to assume the IAM role created in the previous step, to register the snapshot repository.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the IAM service, in your AWS Console.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>Policies</strong></span> page.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create policy</strong></span>.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>JSON</strong></span> tab.
</li>
<li class="listitem">
<p>Copy and paste the following JSON, replacing the sample text.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Replace <code class="literal">ROLE_ARN</code> with the correct value.
</li>
<li class="listitem">
<p>Replace <code class="literal">DOMAIN_ARN</code> with the correct value.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "ROLE_ARN"
    },
    {
      "Effect": "Allow",
      "Action": "es:ESHttpPut",
      "Resource": "DOMAIN_ARN/*"
    }
  ]
}</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Review policy</strong></span>.
</li>
<li class="listitem">
Name the policy: <code class="literal">TheSnapshotPolicy</code>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create policy</strong></span>.
</li>
</ol>
</div>
<p>An IAM policy is created that allows the IAM role to talk to the Amazon OpenSearch Service domain.</p>
<p><a id="ec-migrate-from-aws-es-1-5"></a><span class="strong strong"><strong>5. Create an IAM user</strong></span></p>
<p>Create an IAM user and give it access to your private S3 bucket. If you already have an IAM user, simply attach the following IAM policy to it.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your AWS Console, go to the IAM service.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>Users</strong></span> page.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Add user</strong></span>.
</li>
<li class="listitem">
Name the user: <code class="literal">TheSnapshotUser</code>.
</li>
<li class="listitem">
For the access type, select <span class="strong strong"><strong>Programmatic access</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Next: Permissions</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Attach existing policies directly</strong></span>.
</li>
<li class="listitem">
Filter the policies by entering <code class="literal">TheSnapshot</code> in the search field.
</li>
<li class="listitem">
Select the checkbox next to the policy <code class="literal">TheSnapshotPolicy</code>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Next: Tags</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Next: Review</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create user</strong></span>.
</li>
<li class="listitem">
Copy the <span class="strong strong"><strong>Access key ID</strong></span> value to your <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-variables-table">notes file</a> (ACCESS_KEY).
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Secret access key</strong></span>, select <span class="strong strong"><strong>Show</strong></span>.
</li>
<li class="listitem">
Copy the <code class="literal">Secret access key</code> value to your <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-variables-table">notes file</a> (SECRET_KEY).
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Close</strong></span>.
</li>
<li class="listitem">
From the list, choose the user that you created: <code class="literal">TheSnapshotUser</code>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Add inline policy</strong></span>.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>JSON</strong></span> tab.
</li>
<li class="listitem">
<p>Copy and paste the following JSON, replacing the sample text.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Replace <code class="literal">S3_BUCKET_NAME</code> with the correct value.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">{
  "Version": "2012-10-17",
  "Statement": [{
      "Action": [
        "s3:ListBucket"
      ],
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::S3_BUCKET_NAME"
      ]
    },
    {
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::S3_BUCKET_NAME/*"
      ]
    }
  ]
}</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Review policy</strong></span>.
</li>
<li class="listitem">
Name the policy: <code class="literal">TheSnapshotUserS3Policy</code>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create policy</strong></span>.
</li>
</ol>
</div>
<p>Your AWS S3 bucket is set up, along with an IAM role, policy, and user to access it.</p>
<h4><a id="ec-migrate-from-aws-es-part2"></a>Part 2 - Take a snapshot of your Elasticsearch data<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-90/docs/saas/ec-migrating-from-aws.asciidoc">edit</a></h4>
<p>Take a snapshot to record the latest state of your Amazon OpenSearch Service indices.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Choose the instructions to use depending on your Amazon OpenSearch Service configuration. If your cluster is accessed directly, follow steps <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-2-1a">1a</a> and <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-2-1b">1b</a>. If your cluster is in a VPC that you can&#8217;t access directly, follow steps <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-2-2a">2a</a> and <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-2-2b">2b</a></p>
</div>
</div>
<p><a id="ec-migrate-from-aws-es-2-1a"></a><span class="strong strong"><strong>1a. Register a snapshot repository using Postman</strong></span></p>
<p>Before running a manual snapshot, you need to register a snapshot repository with your deployment. This requires sending a signed request to your AWS ES domain.</p>
<p><span class="strong strong"><strong>If your Amazon OpenSearch Service cluster is accessed directly</strong></span>, execute a snapshot request manually by calling the Elasticsearch snapshot API. <a href="https://www.postman.com/" class="ulink" target="_top">Postman</a> is a great tool for managing and running API requests. It&#8217;s used here to simplify the signing of our AWS API requests.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create a new Postman request.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>AWS Signature</strong></span> in the <span class="strong strong"><strong>TYPE</strong></span> drop-down menu, under the <span class="strong strong"><strong>Authorization</strong></span> tab.
</li>
<li class="listitem">
Enter your <code class="literal">ACCESS_KEY</code>, <code class="literal">SECRET_KEY</code>, <code class="literal">AWS_REGION</code>, and <code class="literal">es</code> as the Service Name. Leave the <span class="strong strong"><strong>Session Token</strong></span> field blank.
</li>
<li class="listitem">
<p>Select <span class="strong strong"><strong>raw</strong></span> and set the format to <span class="strong strong"><strong>JSON</strong></span> under the <span class="strong strong"><strong>Body</strong></span> tab.
Add the following payload, replacing the values for <code class="literal">S3_REGION_NAME</code>, <code class="literal">S3_BUCKET_NAME</code>, <code class="literal">ROLE_ARN</code>, <code class="literal">ES_ENDPOINT</code>, and <code class="literal">SNAPSHOT_REPO</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">{
        "type": "s3",
        "settings": {
                "region": S3_REGION_NAME,
                "bucket": S3_BUCKET_NAME,
                "role_arn": ROLE_ARN
        }
}</pre>
</div>
</li>
<li class="listitem">
<p>Set the request type to <code class="literal">PUT</code> and enter:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">https://ES_ENDPOINT/_snapshot/SNAPSHOT_REPO</pre>
</div>
<p>where:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ES_ENDPOINT</code> is the Elasticsearch endpoint URL
</li>
<li class="listitem">
<code class="literal">SNAPSHOT_REPO</code> is a name of your choosing for the new repository.
</li>
</ul>
</div>
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Send</strong></span>.
</li>
</ol>
</div>
<p>The snapshot repo for your S3 bucket is created.</p>
<p><a id="ec-migrate-from-aws-es-2-1b"></a><span class="strong strong"><strong>1b. Take a snapshot of your data</strong></span></p>
<p>Take a snapshot of the your current ES data and store it in the newly registered repository.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Using Postman, create a new request.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>AWS Signature</strong></span> in the <span class="strong strong"><strong>TYPE</strong></span> drop-down menu, under the <span class="strong strong"><strong>Authorization</strong></span> tab.
</li>
<li class="listitem">
Enter your <code class="literal">ACCESS_KEY</code>, <code class="literal">SECRET_KEY</code>, <code class="literal">AWS_REGION</code>, and <code class="literal">es</code> as the Service Name. Leave the <span class="strong strong"><strong>Session Token</strong></span> field blank.
</li>
<li class="listitem">
<p>Set the request type to <code class="literal">PUT</code> and enter:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">https://ES_ENDPOINT/_snapshot/SNAPSHOT_REPO/SNAPSHOT_NAME</pre>
</div>
<p>where:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ES_ENDPOINT</code> is the Elasticsearch endpoint URL.
</li>
<li class="listitem">
<code class="literal">SNAPSHOT_REPO</code> is a name of the repository that you registered.
</li>
<li class="listitem">
<code class="literal">SNAPSHOT_NAME</code> is the name of the snapshot to create. The actual snapshot name must be lower-case.
</li>
</ul>
</div>
</li>
</ol>
</div>
<p>The time required to take a snapshot depends on the size of the AWS ES domain. According to AWS documentation, long-running snapshot operations sometimes show a <code class="literal">504 GATEWAY_TIMEOUT</code>. That documentation suggests that you ignore this error and just wait for the snapshot to complete successfully.</p>
<p>Check the status of your snapshot by calling:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">GET https://ES_ENDPOINT/_snapshot/SNAPSHOT_REPO/SNAPSHOT_NAME?pretty</pre>
</div>
<p>Once you&#8217;ve taken a snapshot successfully, skip ahead to <a class="xref" href="ec-migrate-from-aws.html#ec-migrate-from-aws-es-part3" title="Part 3 - Restore your snapshot to a new deployment">Part 3</a>.</p>
<p><a id="ec-migrate-from-aws-es-2-2a"></a><span class="strong strong"><strong>2a. Configure the Python AWS SDK</strong></span></p>
<p>Before running a manual snapshot, you need to register a snapshot repository with your deployment. This requires sending a signed request to your Amazon OpenSearch Service cluster.</p>
<p><span class="strong strong"><strong>If your Elasticsearch cluster is in a VPC that you can&#8217;t access directly</strong></span>, you need access to a host, such as EC2, that is within your VPC and that execute the scripts that follow. In these steps and examples we use the Python AWS SDK, but you can use any language that has an AWS SDK (for example, Java, Ruby, Go, or others).</p>
<p>Install the Python AWS SDK using Python’s package installer PIP (<em>pip3</em>). If you get stuck, refer to the <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-linux-python.html" class="ulink" target="_top">Python installation documentation</a>.</p>
<p><span class="strong strong"><strong>Install pip3</strong></span></p>
<p>To install <code class="literal">pip3</code> on <span class="strong strong"><strong>Red Hat and derivatives</strong></span>, use <code class="literal">yum</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ sudo yum -y install python3-pip</pre>
</div>
<p>Some Fedora distributions label the <code class="literal">pip3</code> package differently:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ sudo yum -y install python36-pip</pre>
</div>
<p>In case neither of the previous Python package install commands work, search for the correct package name:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">yum search pip</pre>
</div>
<p>On <span class="strong strong"><strong>Debian derivatives such as Ubuntu</strong></span>, use <code class="literal">apt-get</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo apt-get -y install python3-pip</pre>
</div>
<p><span class="strong strong"><strong>Install the Python AWS SDK</strong></span></p>
<p>Once <code class="literal">pip3</code> is installed, you can install the Python AWS SDK, named <code class="literal">boto3</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ pip3 install --user boto3 requests_aws4auth
Collecting boto3
...
Successfully installed boto3-1.9.106 requests-aws4auth-0.9 ...</pre>
</div>
<p>Note that <code class="literal">root</code> access is not needed if you specify the <code class="literal">--user</code> flag.</p>
<p>Create an <code class="literal">~/.aws</code> directory to hold your AWS credentials. Run the following command to create the directory:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ mkdir ~/.aws</pre>
</div>
<p>Create a file called <code class="literal">credentials</code> with your favorite editor.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ nano ~/.aws/credentials</pre>
</div>
<p>Copy and paste the following contents into the file, replacing <code class="literal">ACCESS_KEY</code> and <code class="literal">SECRET_KEY</code> with the actual values:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">[default]
aws_access_key_id = ACCESS_KEY
aws_secret_access_key = SECRET_KEY</pre>
</div>
<p>Type <code class="literal">Control</code> + <code class="literal">X</code> to exit nano, and follow the prompts to save the file.</p>
<p><a id="ec-migrate-from-aws-es-2-2b"></a><span class="strong strong"><strong>2b. Manually snapshot AWS ES</strong></span></p>
<p>Run a quick test using a Python script to list the indices in your AWS ES cluster. This ensures that your AWS credentials are working and you have access the cluster.</p>
<p>Create a file called <code class="literal">indices.py</code> with your favorite editor.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ nano indices.py</pre>
</div>
<p>Copy and paste the following contents, replacing <code class="literal">ES_ENDPOINT</code> and <code class="literal">ES_REGION</code> with your values:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">import boto3, requests
from requests_aws4auth import AWS4Auth
host = 'ES_ENDPOINT'
region = 'ES_REGION'
creds = boto3.Session().get_credentials()
auth = AWS4Auth(creds.access_key, creds.secret_key, region, 'es', session_token=creds.token)
print("Listing Indices from AWS ES ...")
req = requests.get(host + '/_cat/indices?v', auth=auth)
print("HTTP Response Code: " + str(req.status_code) + '\n' + req.text)</pre>
</div>
<p>Type <code class="literal">Control</code> + <code class="literal">X</code> to exit nano, and follow the prompts to save the file.</p>
<p>Run the Python script.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ python3 indices.py</pre>
</div>
<p>Your output should look similar to the following:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">Listing Indices from AWS ES ...
HTTP Response Code: 200
health status index     uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   testindex yME2BphgR3Gt1ln6n03nHQ   5   1          1            0      4.4kb          4.4kb</pre>
</div>
<p>Create a file called <code class="literal">register.py</code> with your favorite editor.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ nano register.py</pre>
</div>
<p>Copy and paste the following contents, replacing <code class="literal">ES_ENDPOINT</code>, <code class="literal">ES_REGION</code>, <code class="literal">SNAPSHOT_REPO</code>, <code class="literal">SNAPSHOT_NAME</code>, <code class="literal">S3_REGION_NAME</code>, <code class="literal">S3_BUCKET_NAME</code>, and <code class="literal">ROLE_ARN</code> with your values:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">import boto3, requests
from requests_aws4auth import AWS4Auth
host = 'ES_ENDPOINT'
region = 'ES_REGION'
repo_name = 'SNAPSHOT_REPO'
snapshot_name = 'SNAPSHOT_NAME'
s3_region_name = 'S3_REGION_NAME'
s3_bucket_name = 'S3_BUCKET_NAME'
role_arn = 'ROLE_ARN'
creds = boto3.Session().get_credentials()
auth = AWS4Auth(creds.access_key, creds.secret_key, region, 'es', session_token=creds.token)
headers = {"Content-Type": "application/json"}
payload = {
        "type": "s3",
        "settings": {
                "region": s3_region_name,
                "bucket": s3_bucket_name,
                "role_arn": role_arn
        }
}
print("Registering Snapshot with AWS ES ...")
url = host + '/_snapshot/' + repo_name
req = requests.put(url, auth=auth, json=payload, headers=headers)
print("HTTP Response Code: " + str(req.status_code) + '\n' + req.text)</pre>
</div>
<p>Type <code class="literal">Control</code> + <code class="literal">X</code> to exit nano, and follow the prompts to save the file.</p>
<p>Run the Python script.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ python3 register.py</pre>
</div>
<p>Your output should look similar to the following:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">Registering Snapshot with AWS ES ...
HTTP Response Code: 200
{"acknowledged":true}</pre>
</div>
<p>Create a file called <code class="literal">snapshot.py</code> with your favorite editor.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ nano snapshot.py</pre>
</div>
<p>Copy and paste the following contents, replacing <code class="literal">ES_ENDPOINT</code>, <code class="literal">ES_REGION</code>, <code class="literal">SNAPSHOT_REPO</code>, and <code class="literal">SNAPSHOT_NAME</code> with your values:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">import boto3, requests
from requests_aws4auth import AWS4Auth
host = 'ES_ENDPOINT'
region = 'ES_REGION'
repo_name = 'SNAPSHOT_REPO'
snapshot_name = 'SNAPSHOT_NAME'
creds = boto3.Session().get_credentials()
auth = AWS4Auth(creds.access_key, creds.secret_key, region, 'es', session_token=creds.token)
print("Starting Snapshot with AWS ES ...")
url = host + '/_snapshot/' + repo_name + '/' + snapshot_name
req = requests.put(url, auth=auth)
print("HTTP Response Code: " + str(req.status_code) + '\n' + req.text)</pre>
</div>
<p>Type <code class="literal">Control</code> + <code class="literal">X</code> to exit nano, and follow the prompts to save the file.</p>
<p>Run the Python script:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ python3 snapshot.py</pre>
</div>
<p>Your output should look similar to the following:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">Starting Snapshot with AWS ES ...
HTTP Response Code: 200
{"accepted":true}</pre>
</div>
<p>The time required to take a snapshot depends on the size of the AWS ES domain. According to AWS documentation, long-running snapshot operations sometimes show a <code class="literal">504 GATEWAY_TIMEOUT</code>. That documentation suggests that you ignore this error and just wait for the snapshot to complete successfully.</p>
<p>Finally, check the status of our snapshot. Create a file called <code class="literal">status.py</code>.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ nano status.py</pre>
</div>
<p>Copy and paste the following contents, replacing <code class="literal">ES_ENDPOINT</code>, <code class="literal">ES_REGION</code>, <code class="literal">SNAPSHOT_REPO</code>, and <code class="literal">SNAPSHOT_NAME</code> with your values:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">import boto3, requests
from requests_aws4auth import AWS4Auth
host = 'ES_ENDPOINT'
region = 'ES_REGION'
repo_name = 'SNAPSHOT_REPO'
snapshot_name = 'SNAPSHOT_NAME'
creds = boto3.Session().get_credentials()
auth = AWS4Auth(creds.access_key, creds.secret_key, region, 'es', session_token=creds.token)
print("Getting Status of Snapshot with AWS ES ...")
url = host + '/_snapshot/' + repo_name + '/' + snapshot_name + '?pretty'
req = requests.get(url, auth=auth)
print("HTTP Response Code: " + str(req.status_code) + '\n' + req.text)</pre>
</div>
<p>Type <code class="literal">Control</code> + <code class="literal">X</code> to exit nano, and follow the prompts to save the file.</p>
<p>Run the Python script.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ python3 status.py</pre>
</div>
<p>Your output should look similar to the following:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">Getting Status of Snapshot with AWS ES ...
HTTP Response Code: 200
{
  "snapshots" : [ {
    "snapshot" : "my-snapshot",
    "uuid" : "ClYKt5g8QFO6r3kTCEzjqw",
    "version_id" : 6040299,
    "version" : "6.4.2",
    "indices" : [ "testindex" ],
    "include_global_state" : true,
    "state" : "SUCCESS",
    "start_time" : "2019-03-03T14:46:04.094Z",
    "start_time_in_millis" : 1551624364094,
    "end_time" : "2019-03-03T14:46:04.847Z",
    "end_time_in_millis" : 1551624364847,
    "duration_in_millis" : 753,
    "failures" : [ ],
    "shards" : {
      "total" : 5,
      "failed" : 0,
      "successful" : 5
    }
  } ]
}</pre>
</div>
<p>If you get <code class="literal">"state":"SUCCESS"</code> then you have successfully taken a snapshot to S3 and are ready for Part 3!</p>
<h4><a id="ec-migrate-from-aws-es-part3"></a>Part 3 - Restore your snapshot to a new deployment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-90/docs/saas/ec-migrating-from-aws.asciidoc">edit</a></h4>
<p><a id="ec-migrate-from-aws-es-3-1"></a><span class="strong strong"><strong>1. Create a deployment in Elasticsearch Service</strong></span></p>
<p>Navigate to <a href="http://cloud.elastic.co" class="ulink" target="_top">Elastic Cloud</a> and register for an account to gain access to the 14-day free trial. Once you’ve logged in, follow the instructions to create a deployment in AWS, Google Cloud, or Microsoft Azure.</p>
<p>For detailed instructions and descriptions of all of the options, check <a class="xref" href="ec-create-deployment.html" title="Create a deployment">Create your deployment</a>.</p>
<p><a id="ec-migrate-from-aws-es-3-2"></a><span class="strong strong"><strong>2. Add your secrets to the keystore</strong></span></p>
<p>Once your deployment is ready, store your <code class="literal">ACCESS_KEY</code> and <code class="literal">SECRET_KEY</code> in the Keystore.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Security</strong></span> page of your new deployment.
</li>
<li class="listitem">
Locate <span class="strong strong"><strong>Elasticsearch keystore</strong></span> and select <span class="strong strong"><strong>Add settings</strong></span>.
</li>
<li class="listitem">
<p>With <span class="strong strong"><strong>Type</strong></span> set to <span class="strong strong"><strong>Single string</strong></span>, add the following keys and their values:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">s3.client.default.access_key</code>
</li>
<li class="listitem">
<code class="literal">s3.client.default.secret_key</code>
</li>
</ul>
</div>
</li>
</ol>
</div>
<p><a id="ec-migrate-from-aws-es-3-3"></a><span class="strong strong"><strong>3. Register your snapshot repository in your new deployment</strong></span></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To follow this step your deployment must be at Elastic Stack version 7.2 or higher. If you are using an earlier deployment version, check our more detailed instructions for <a class="xref" href="ec-aws-custom-repository.html#ec-create-aws-repository" title="Create the repository">configuring a snapshot repository using AWS</a>.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your same deployment in Elasticsearch Service, open Kibana and go to <span class="strong strong"><strong>Management</strong></span> &gt; <span class="strong strong"><strong>Snapshot and Restore</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Register a repository</strong></span>, on the <span class="strong strong"><strong>Repositories</strong></span> tab.
</li>
<li class="listitem">
Provide a name for for your repository and select type <span class="strong strong"><strong>AWS S3</strong></span>.
</li>
<li class="listitem">
<p>Provide the following settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Client: <code class="literal">default</code>
</li>
<li class="listitem">
Bucket: <code class="literal">YOUR_S3_BUCKET_NAME</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
Add any other settings that you wish to configure.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Register</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Verify</strong></span> to confirm that your settings are correct and the deployment can connect to your repository.
</li>
</ol>
</div>
<p><a id="ec-migrate-from-aws-es-3-4"></a><span class="strong strong"><strong>4. Restore from your new snapshot repository</strong></span></p>
<p>Still on the <span class="strong strong"><strong>Snapshot and Restore</strong></span> page in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the <span class="strong strong"><strong>Snapshots</strong></span> tab.
</li>
<li class="listitem">
Search for the snapshot that you created earlier.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Restore</strong></span>.
</li>
<li class="listitem">
Select the indices you wish to restore.
</li>
<li class="listitem">
Configure any other relevant settings.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Restore snapshot</strong></span> to begin the process.
</li>
</ol>
</div>
<p>The time required to restore from a snapshot varies based on the size of your data.</p>
<p><a id="ec-migrate-from-aws-es-3-5"></a><span class="strong strong"><strong>5. Explore Elasticsearch Service</strong></span></p>
<p>Now that you are up and running with your own data, explore the power of the latest version of the Elastic Stack by trying: SIEM, Lens, Machine Learning, APM, Maps, Index Lifecycle Management, Snapshot Lifecycle Management, Logs, Metrics, Monitoring, Canvas, Uptime, and more!</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ec-migrating-data.html">« Migrating data</a>
</span>
<span class="next">
<a href="ec-remote-reindex.html">Migrate from a self-managed cluster with a self-signed certificate using remote reindex »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
