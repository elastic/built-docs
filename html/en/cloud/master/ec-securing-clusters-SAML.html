<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Secure your clusters with SAML | Elasticsearch Service Documentation [master] | Elastic</title>
<meta class="elastic" name="content" content="Secure your clusters with SAML | Elasticsearch Service Documentation [master]">

<link rel="home" href="index.html" title="Elasticsearch Service Documentation [master]"/>
<link rel="up" href="ec-security.html" title="Securing your deployment"/>
<link rel="prev" href="ec-password-reset.html" title="Reset the elastic user password"/>
<link rel="next" href="ec-sign_outgoing_saml_message.html" title="Sign Outgoing SAML Message"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elastic Cloud"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference/master"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-security.html">Securing your deployment</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ec-password-reset.html">« Reset the <code class="literal">elastic</code> user password</a>
</span>
<span class="next">
<a href="ec-sign_outgoing_saml_message.html">Sign Outgoing SAML Message »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ec-securing-clusters-SAML"></a>Secure your clusters with SAML<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/master/docs/shared/ec-ce-securing-clusters-saml.asciidoc">edit</a></h2>
</div></div></div>
<p>These steps show how you can secure your Elasticsearch clusters, Kibana, and Enterprise Search instances in a deployment by using a Security Assertion Markup Language (SAML) identity provider (IdP) for cross-domain, single sign-on authentication.</p>
<p>For a detailed walk-through of how to implement SAML authentication for Kibana and Enterprise Search with Azure AD as an identity provider, refer to our guide <a class="xref" href="ec-securing-clusters-saml-azure.html" title="Set up SAML with Azure Active Directory">Set up SAML with Azure Active Directory</a>.</p>
<h3><a id="ec_before_you_begin_12"></a>Before you begin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/master/docs/shared/ec-ce-securing-clusters-saml.asciidoc">edit</a></h3>
<p>Elasticsearch Service supports SAML with Elastic Stack version 6.4 and later.</p>
<h3><a id="ec_configure_your_8_0_or_above_cluster_to_use_saml"></a>Configure your 8.0 or above cluster to use SAML<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/master/docs/shared/ec-ce-securing-clusters-saml.asciidoc">edit</a></h3>
<p>You must edit your cluster configuration, sometimes also referred to as the deployment plan, to point to the SAML IdP before you can complete the configuration in Kibana. If you are using machine learning or a deployment with hot-warm architecture, you must include this SAML IdP configuration in the user settings section for each node type.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create or use an existing deployment that includes a Kibana instance version 6.4 or later.
</li>
<li class="listitem">
Copy the Kibana endpoint URL.
</li>
<li class="listitem">
<p><a id="step-3"></a><a class="xref" href="ec-add-user-settings.html" title="Edit Elasticsearch user settings">Update your Elasticsearch user settings</a> for the <code class="literal">saml</code> realm and specify your IdP provider configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        saml: <a id="CO16-1"></a><i class="conum" data-value="1"></i>
          saml-realm-name: <a id="CO16-2"></a><i class="conum" data-value="2"></i>
            order: 2 <a id="CO16-3"></a><i class="conum" data-value="3"></i>
            attributes.principal: "nameid:persistent" <a id="CO16-4"></a><i class="conum" data-value="4"></i>
            attributes.groups: "groups" <a id="CO16-5"></a><i class="conum" data-value="5"></i>
            idp.metadata.path: "&lt;check with your identity provider&gt;" <a id="CO16-6"></a><i class="conum" data-value="6"></i>
            idp.entity_id: "&lt;check with your identity provider&gt;" <a id="CO16-7"></a><i class="conum" data-value="7"></i>
            sp.entity_id: "KIBANA_ENDPOINT_URL/" <a id="CO16-8"></a><i class="conum" data-value="8"></i>
            sp.acs: "KIBANA_ENDPOINT_URL/api/security/saml/callback"
            sp.logout: "KIBANA_ENDPOINT_URL/logout"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies the authentication realm service.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the SAML realm name. The SAML realm name can only contain alphanumeric characters, underscores, and hyphens.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The order of the SAML realm in your authentication chain. Allowed values are between <code class="literal">2</code> and <code class="literal">100</code>. Set to <code class="literal">2</code> unless you plan on configuring multiple SSO realms for this cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the SAML attribute that is going to be mapped to the principal (username) of the authenticated user in Kibana. In this  non-normative example, <code class="literal">nameid:persistent</code> maps the <code class="literal">NameID</code> with the <code class="literal">urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</code> format from the Subject of the SAML Assertion. You can use any SAML attribute that carries the necessary value for your use case in this setting, such as <code class="literal">uid</code> or <code class="literal">mail</code>. Refer to <a href="/guide/en/elasticsearch/reference/8.7/saml-guide-stack.html#saml-attributes-mapping" class="ulink" target="_top">the attribute mapping documentation</a> for details and available options.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the SAML attribute used for role mapping when configured in Kibana. Common choices are <code class="literal">groups</code> or <code class="literal">roles</code>. The values for both <code class="literal">attributes.principal</code> and <code class="literal">attributes.groups</code> depend on the IdP provider, so be sure to review their documentation. Refer to <a href="/guide/en/elasticsearch/reference/8.7/saml-guide-stack.html#saml-attributes-mapping" class="ulink" target="_top">the attribute mapping documentation</a> for details and available options.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>The file path or the HTTPS URL where your IdP metadata is available, such as <code class="literal">https://idpurl.com/sso/saml/metadata</code>. If you configure a URL you need to make ensure that your Elasticsearch cluster can access it.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-7"><i class="conum" data-value="7"></i></a></p>
</td>
<td align="left" valign="top">
<p>The SAML EntityID of your IdP. This can be read from the configuration page of the IdP, or its SAML metadata, such as <code class="literal">https://idpurl.com/entity_id</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-8"><i class="conum" data-value="8"></i></a></p>
</td>
<td align="left" valign="top">
<p>Replace <code class="literal">KIBANA_ENDPOINT_URL</code> with the one noted in the previous step, such as <code class="literal">sp.entity_id: https://eddac6b924f5450c91e6ecc6d247b514.us-east-1.aws.found.io:9243/</code> including the slash at the end.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>By default, users authenticating through SAML have no roles assigned to them. For example, if you want all your users authenticating with SAML to get access to Kibana, issue the following request to Elasticsearch:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">POST /_security/role_mapping/CLOUD_SAML_TO_KIBANA_ADMIN <a id="CO17-1"></a><i class="conum" data-value="1"></i>
{
   "enabled": true,
    "roles": [ "kibana_admin" ], <a id="CO17-2"></a><i class="conum" data-value="2"></i>
    "rules": { <a id="CO17-3"></a><i class="conum" data-value="3"></i>
        "field": { "realm.name": "saml-realm-name" } <a id="CO17-4"></a><i class="conum" data-value="4"></i>
    },
    "metadata": { "version": 1 }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO17-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The mapping name.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO17-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The Elastic Stack role to map to.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO17-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>A rule specifying the SAML role to map from.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO17-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">realm.name</code> can be any string containing only alphanumeric characters, underscores, and hyphens.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Alternatively, if you want the users that belong to the group <code class="literal">elasticadmins</code> in your identity provider to be assigned the <code class="literal">superuser</code> role in your Elasticsearch cluster, issue the following request to Elasticsearch:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">POST /_security/role_mapping/CLOUD_SAML_ELASTICADMIN_TO_SUPERUSER <a id="CO18-1"></a><i class="conum" data-value="1"></i>
{
   "enabled": true,
    "roles": [ "superuser" ], <a id="CO18-2"></a><i class="conum" data-value="2"></i>
    "rules": { "all" : [ <a id="CO18-3"></a><i class="conum" data-value="3"></i>
        { "field": { "realm.name": "saml-realm-name" } }, <a id="CO18-4"></a><i class="conum" data-value="4"></i>
        { "field": { "groups": "elasticadmins" } }
    ]},
    "metadata": { "version": 1 }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The mapping name.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The Elastic Stack role to map to.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>A rule specifying the SAML role to map from.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">realm.name</code> can be any string containing only alphanumeric characters, underscores, and hyphens.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In order to use the field <code class="literal">groups</code> in the mapping rule, you need to have mapped the SAML Attribute that conveys the group membership to <code class="literal">attributes.groups</code> in the previous step.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Update Kibana in the
<a class="xref" href="ec-manage-kibana-settings.html" title="Edit Kibana user settings">user settings configuration</a>
to use SAML as the authentication provider:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If you are using a Kibana instance of version 7.7 or later:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">xpack.security.authc.providers:
  saml.saml1:
    order: 0
    realm: saml-realm-name <a id="CO19-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO19-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the SAML realm that you have configured earlier, for instance <code class="literal">saml-realm-name</code>. The SAML realm name can only contain alphanumeric characters, underscores, and hyphens.</p>
</td>
</tr>
</table>
</div>
<p>This configuration disables all other realms and only allows users to authenticate with SAML. If you wish to allow your native realm users to authenticate, you need to also enable the <code class="literal">basic</code> <code class="literal">provider</code> like this:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">xpack.security.authc.providers:
  saml.saml1:
    order: 0
    realm: saml-realm-name
    description: "Log in with my SAML" <a id="CO20-1"></a><i class="conum" data-value="1"></i>
  basic.basic1:
    order: 1</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO20-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This arbitrary string defines how SAML login is titled in the Login Selector UI that is shown when you enable multiple authentication providers in Kibana. If you have a Kibana instance of version 7.8 or later, you can also configure the optional <code class="literal">icon</code> and <code class="literal">hint</code> settings for any authentication provider.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>If you are using a Kibana instance of version 7.3 - 7.6:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">xpack.security.authc.providers: [saml]
server.xsrf.whitelist: [/api/security/v1/saml]
xpack.security.authc.saml.realm: saml-realm-name <a id="CO21-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO21-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the SAML realm that you have configured earlier, for instance <code class="literal">saml-realm-name</code>. The SAML realm name can only contain alphanumeric characters, underscores, and hyphens.</p>
</td>
</tr>
</table>
</div>
<p>This configuration disables all other realms and only allows users to authenticate with SAML. If you wish to allow your native realm users to authenticate, you need to also enable the <code class="literal">basic</code> <code class="literal">provider</code> by setting <code class="literal">xpack.security.authc.providers: [saml, basic]</code> in the configuration of Kibana.</p>
</li>
<li class="listitem">
<p>If you are using a Kibana instance of version 7.2 or earlier:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">xpack.security.authProviders: [saml]
server.xsrf.whitelist: [/api/security/v1/saml]
xpack.security.public:
  protocol: https
  hostname: d1a45bf330b74c248d7cc2e0ead8e159.192.168.44.10.ip.es.io <a id="CO22-1"></a><i class="conum" data-value="1"></i>
  port: 9243</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO22-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The hostname from your Kibana endpoint URL.</p>
</td>
</tr>
</table>
</div>
<p>This configuration disables all other realms and only allows users to authenticate with SAML. If you wish to allow your native realm users to authenticate, you need to also enable the <code class="literal">basic</code> <code class="literal">authProvider</code> by setting <code class="literal">xpack.security.authProviders: [saml, basic]</code> in the configuration of Kibana.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Recommended: If you are using Enterprise Search, we recommend you set up SAML 2.0 single sign-on (SSO) for the solution. This allows you to manage access to App Search and Workplace Search for your existing SAML users.</p>
<p><a class="xref" href="ec-manage-enterprise-search-settings.html" title="Add Enterprise Search user settings">Configure your Enterprise Search user settings</a> with the following parameters:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If you are using an Enterprise Search deployment of version 7.14.0 or later:</p>
<p>Check <a href="/guide/en/enterprise-search/8.7/saml-idp.html" class="ulink" target="_blank" rel="noopener">Set up Enterprise Search with SAML 2.0 single sign-on (SSO)</a> in the Enterprise Search documentation.
This document covers the Elastic Cloud user settings for Elasticsearch, Kibana, and Enterprise Search.
It also explains how to manage access to App Search and Workplace Search for your existing SAML users.</p>
</li>
<li class="listitem">
<p>If you are using an Enterprise Search deployment of version 7.9.2 or later:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">ent_search.auth.saml1.source: elasticsearch-saml <a id="CO23-1"></a><i class="conum" data-value="1"></i>
ent_search.auth.saml1.order: 1 <a id="CO23-2"></a><i class="conum" data-value="2"></i>
ent_search.auth.saml1.description: "SAML login" <a id="CO23-3"></a><i class="conum" data-value="3"></i>
ent_search.auth.saml1.icon: "https://my-company.org/company-logo.png" <a id="CO23-4"></a><i class="conum" data-value="4"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO23-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the SAML realm that you have configured earlier, for instance <code class="literal">saml-realm-name</code>. The SAML realm name can only contain alphanumeric characters, underscores, and hyphens. To reference an <code class="literal">ent_search.auth.&lt;auth_name&gt;.source</code>, you must create a separate application in your third-party SAML provider first and then set up a new SAML realm in Elasticsearch for Enterprise Search. To learn more, check <a href="/guide/en/app-search/7.13/security-and-users.html#app-search-self-managed-security-and-user-management-elasticsearch-saml" class="ulink" target="_blank" rel="noopener">Elasticsearch SAML</a> in the App Search documentation.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO23-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The order in which to display this provider on the login screen.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO23-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name to be displayed on the login screen associated with this provider.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO23-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The URL to an icon to be displayed on the login screen associated with this provider.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>If you are using an Enterprise Search deployment of version 7.9.1 or earlier:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">ent_search.auth.source: elasticsearch-saml
ent_search.auth.name: saml-realm-name <a id="CO24-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO24-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the SAML realm that you have configured earlier, for instance <code class="literal">saml-realm-name</code>. The SAML realm name can only contain alphanumeric characters, underscores, and hyphens. To reference an <code class="literal">ent_search.auth.name</code>, you generally must create a separate application in your third-party SAML provider first and then set up a new SAML realm in Elasticsearch for Enterprise Search. To learn more, check <a href="/guide/en/app-search/7.8/security-and-users.html#app-search-self-managed-security-and-user-management-elasticsearch-saml" class="ulink" target="_blank" rel="noopener">Elasticsearch SAML</a> in the App Search documentation.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Optional: If you have an App Search deployment (App Search 7.6 and earlier), you can set it to also use SAML single sign-on authentication. <a class="xref" href="ec-manage-appsearch-settings.html" title="Add App Search user settings">Configure your App Search user settings</a> with the following parameters:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">app_search.auth.source: elasticsearch-saml
app_search.auth.name: saml-realm-name <a id="CO25-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO25-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the SAML realm that you have configured earlier, for instance <code class="literal">saml-realm-name</code>. The SAML realm name can only contain alphanumeric characters, underscores, and hyphens. To reference an <code class="literal">app_search.auth.name</code>, you generally must create a separate application in your third-party SAML provider first and then set up a new SAML realm in Elasticsearch for App Search. To learn more, check <a href="/guide/en/app-search/7.7/security-and-users.html#app-search-self-managed-security-and-user-management-elasticsearch-saml" class="ulink" target="_blank" rel="noopener">Elasticsearch SAML</a> in the App Search documentation.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Optional: Generate SAML metadata for the Service Provider.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This endpoint is only available for deployments on version 7.11 or later.</p>
</div>
</div>
<p>The SAML 2.0 specification provides a mechanism for Service Providers to describe their capabilities and configuration using a metadata file. If your SAML Identity Provider requires or allows you to configure it to trust the Elastic Stack Service Provider through the use of a metadata file, you can generate the SAML metadata by issuing the following request to Elasticsearch:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_security/saml/metadata/realm_name <a id="CO26-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="console_widget" data-snippet="snippets/1.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO26-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the SAML realm in Elasticsearch.</p>
</td>
</tr>
</table>
</div>
<p>You can generate the SAML metadata by issuing the API request to Elasticsearch and storing metadata as an XML file using tools like <code class="literal">jq</code>.</p>
<p>The following command, for example, generates the metadata for the SAML realm <code class="literal">saml1</code> and saves it to <code class="literal">metadata.xml</code> file:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">curl -X GET -H "Content-Type: application/json" -u user_name:password https://&lt;elasticsearch_endpoint&gt;:9243/_security/saml/metadata/saml1 <a id="CO27-1"></a><i class="conum" data-value="1"></i>
|jq -r '.[]' &gt; metadata.xml</pre>
</div>
<div class="console_widget" data-snippet="snippets/2.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The elasticsearch endpoint for the given deployment where the <code class="literal">saml1</code> realm is configured.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Optional: If your Identity Provider doesn&#8217;t publish its SAML metadata at an HTTP URL, or if your Elasticsearch cluster cannot reach that URL, you can upload the SAML metadata as a file.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Prepare a ZIP file with a <a class="xref" href="ec-custom-bundles.html" title="Upload custom plugins and bundles">custom bundle</a> that contains your Identity Provider&#8217;s metadata (<code class="literal">metadata.xml</code>) inside of a <code class="literal">saml</code> folder.</p>
<p>This bundle allows all Elasticsearch containers to access the metadata file.</p>
</li>
<li class="listitem">
<p>Update your Elasticsearch cluster on the <a class="xref" href="ec-adding-plugins.html" title="Add plugins and extensions">deployments page</a> to use the bundle you prepared in the previous step.</p>

<p>Custom bundles are unzipped under the path <code class="literal">/app/config/BUNDLE_DIRECTORY_STRUCTURE</code>, where <code class="literal">BUNDLE_DIRECTORY_STRUCTURE</code> is the directory structure in the ZIP file. Make sure to save the file location where custom bundles get unzipped, as you will need it in the next step.</p>
<p>In our example, the SAML metadata file will be located in the path <code class="literal">/app/config/saml/metadata.xml</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ tree .
.
└── saml
      └── metadata.xml</pre>
</div>
</li>
<li class="listitem">
<p>Adjust your <code class="literal">saml</code> realm configuration accordingly:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">    idp.metadata.path: /app/config/saml/metadata.xml <a id="CO28-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO28-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The path to the SAML metadata file that was uploaded.</p>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Use the Kibana endpoint URL to log in.
</li>
</ol>
</div>
<h3><a id="ec-7x-saml"></a>Configure your 7.x cluster to use SAML<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/master/docs/shared/ec-ce-securing-clusters-saml.asciidoc">edit</a></h3>
<p>For 7.x deployments, the instructions are similar to those for 8.x, but your Elasticsearch request should use <code class="literal">POST /_xpack/security/role_mapping/CLOUD_SAML_TO_KIBANA_ADMIN</code> (for Step 4) or <code class="literal">POST /_xpack/xsecurity/role_mapping/CLOUD_SAML_ELASTICADMIN_TO_SUPERUSER</code> (for Step 5).</p>
<p>All of the other steps are the same.</p>
<h3><a id="ec-6x-saml"></a>Configure your 6.x cluster to use SAML<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/master/docs/shared/ec-ce-securing-clusters-saml.asciidoc">edit</a></h3>
<p>For 6.x deployments the configuration is slightly different. For <a class="xref" href="ec-securing-clusters-SAML.html#step-3">step 3</a>, you must specify the realm name, then define the realm <code class="literal">type</code> using the following example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        cloud-saml: <a id="CO29-1"></a><i class="conum" data-value="1"></i>
          type: saml
            order: 2 <a id="CO29-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>For 6.x clusters you must use <code class="literal">cloud-saml</code> as realm name.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>For 6.x clusters, you must set the <code class="literal">order</code> to <code class="literal">2</code>.</p>
</td>
</tr>
</table>
</div>
<p>All of the other steps are the same.</p>


</div>
<div class="navfooter">
<span class="prev">
<a href="ec-password-reset.html">« Reset the <code class="literal">elastic</code> user password</a>
</span>
<span class="next">
<a href="ec-sign_outgoing_saml_message.html">Sign Outgoing SAML Message »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
