<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Networking | Deploying with Azure Marketplace and Resource Manager (ARM) template [6.4] | Elastic</title>
<link rel="home" href="index.html" title="Deploying with Azure Marketplace and Resource Manager (ARM) template [6.4]"/>
<link rel="up" href="azure-arm-template.html" title="Azure Resource Manager (ARM) template"/>
<link rel="prev" href="azure-arm-template-availability.html" title="Availability"/>
<link rel="next" href="azure-arm-template-load-balancing.html" title="Load balancing"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Azure/6.4"/>
<meta name="DC.subject" content="Azure Marketplace and Resource Manager (ARM) template"/>
<meta name="DC.identifier" content="6.4"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Deploying with Azure Marketplace and Resource Manager (ARM) template [6.4]</a></span>
»
<span class="breadcrumb-link"><a href="azure-arm-template.html">Azure Resource Manager (ARM) template</a></span>
»
<span class="breadcrumb-node">Networking</span>
</div>
<div class="navheader">
<span class="prev">
<a href="azure-arm-template-availability.html">« Availability</a>
</span>
<span class="next">
<a href="azure-arm-template-load-balancing.html">Load balancing »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="azure-arm-template-networking"></a>Networking<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/azure-marketplace/edit/6.4/docs/azure-arm-template.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="virtual-network"></a>Virtual network<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/azure-marketplace/edit/6.4/docs/azure-arm-template.asciidoc">edit</a></h3>
</div></div></div>
<p>The template can deploy a new virtual network and attach Elasticsearch and Kibana
to it, or can use an existing virtual network in the same Azure region as the
resource group being deployed to.</p>
<p>Using an existing virtual network requires a subnet to exist to which to attach the deployed resources and a known available private IP address to use as the static address for the internal load balancer, which Kibana will use to communicate with the cluster.
The subnet also needs to have a sufficient number of available IP addresses for all of the resources that will be attached. The following parameters are related to virtual
network configuration</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">vNetNewOrExisting</code>
</span>
</dt>
<dd>
Select <code class="literal">new</code> or <code class="literal">existing</code> to deploy a new virtual network or use an existing virtual
network, respectively. An existing virtual network in another resource group must exist
in the same Azure location as the target location to be valid. Default is <code class="literal">new</code>.
</dd>
<dt>
<span class="term">
<code class="literal">vNetName</code>
</span>
</dt>
<dd>
The name of the virtual network. Defaults to <code class="literal">es-net</code>.
</dd>
<dt>
<span class="term">
<code class="literal">vNetClusterSubnetName</code>
</span>
</dt>
<dd>
The name of the subnet to which deployed VMs and load balancers will be attached.
When using an existing virtual network, the subnet must already exist. Defaults
to <code class="literal">es-subnet</code>.
</dd>
<dt>
<span class="term">
<code class="literal">vNetLoadBalancerIp</code>
</span>
</dt>
<dd>
The private IP address to use when configuring the internal load balancer.
<a class="xref" href="azure-arm-template-networking.html#check-private-ip-address-availability" title="Check private IP address availability">Must be an available IP address</a> on
the provided vNetClusterSubnetName. Defaults to <code class="literal">10.0.0.4</code>.
</dd>
</dl>
</div>
<p>When deploying a new virtual network, the following parameters also apply</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">vNetNewAddressPrefix</code>
</span>
</dt>
<dd>
The address space when creating a new virtual network. Defaults to <code class="literal">10.0.0.0/24</code>.
</dd>
<dt>
<span class="term">
<code class="literal">vNetNewClusterSubnetAddressPrefix</code>
</span>
</dt>
<dd>
The address space of the <code class="literal">vNetClusterSubnetName</code> subnet. Defaults to <code class="literal">10.0.0.0/25</code>.
</dd>
</dl>
</div>
<p>When attaching to an existing resource group, the following parameter also applies</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">vNetExistingResourceGroup</code>
</span>
</dt>
<dd>
The name of the resource group in which the existing virtual network is deployed.
The resource group must exist in the same Azure location as the target location.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="check-private-ip-address-availability"></a>Check private IP address availability<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/azure-marketplace/edit/6.4/docs/azure-arm-template.asciidoc">edit</a></h3>
</div></div></div>
<p>A private IP address can be checked to see if it&#8217;s available within a virtual network
with</p>
<p><strong>Azure CLI 2.0.</strong></p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">az network vnet check-ip-address --name "&lt;vnet name&gt;" \
  --ip-address "&lt;ip address&gt;" \
  --resource-group "&lt;resource group&gt;"</pre>
</div>
<p><strong>Azure PowerShell.</strong></p>
<div class="pre_wrapper lang-powershell">
<pre class="programlisting prettyprint lang-powershell">Test-AzureRmPrivateIPAddressAvailability -VirtualNetworkName "&lt;vnet name&gt;" `
  -IPAddress "&lt;ip address&gt;" `
  -ResourceGroupName "&lt;resource group&gt;"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="dns-resolution"></a>Azure DNS resolution<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/azure-marketplace/edit/6.4/docs/azure-arm-template.asciidoc">edit</a></h3>
</div></div></div>
<p>Azure DNS resolution can resolve VMs within a virtual network by hostname, and
is relied upon by the template to form an Elasticsearch cluster, by seeding each
node with the hostnames of each master-eligible node. IP addresses are not used
since they are dynamically allocated to VMs within the template.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The template uses a predictable convention when assigning hostnames to VMs, naming
them <code class="literal">master-</code>, <code class="literal">data-</code> and <code class="literal">client-</code> for master, data and coordinating nodes,
respectively, followed by an incrementing integer starting at 0.</p>
<p>Such a convention is problematic when it comes to deploying more than one cluster
to the same virtual network however; Azure infrastructure does not prevent you
from creating a new VM with the same hostname as an existing VM attached to the
target virtual network, leading to Azure DNS resolving the hostname to the last
attached VM.</p>
<p>For this reason, the template exposes the following parameter</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">vmHostNamePrefix</code>
</span>
</dt>
<dd>
Prefix the name of each hostname in the cluster. The prefix can be up to 5
characters in length, must begin with an alphanumeric character and can contain alphanumeric and hyphen characters.
</dd>
</dl>
</div>
</div>
</div>
<p>If a custom DNS is specified, it&#8217;s possible to configure your own DNS servers to
resolve hostnames correctly, by <a href="https://docs.microsoft.com/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances#name-resolution-that-uses-your-own-dns-server" class="ulink" target="_top">forwarding DNS queries to Azure to resolve</a>.
This should be configured on the virtual network so that if VMs are shut down or
moved around, they will have the correct configuration when starting up.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="azure-arm-template-availability.html">« Availability</a>
</span>
<span class="next">
<a href="azure-arm-template-load-balancing.html">Load balancing »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
