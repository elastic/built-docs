<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tutorial 2: Securing a self-managed Elastic Stack | Elastic Installation and Upgrade Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Tutorial 2: Securing a self-managed Elastic Stack | Elastic Installation and Upgrade Guide [master]">

<link rel="home" href="index.html" title="Elastic Installation and Upgrade Guide [master]"/>
<link rel="up" href="installing-elastic-stack.html" title="Installing the Elastic Stack"/>
<link rel="prev" href="installing-stack-demo-self.html" title="Tutorial 1: Installing a self-managed Elastic Stack"/>
<link rel="next" href="air-gapped-install.html" title="Installing in an air-gapped environment"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elastic Stack"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Installation and Upgrade/master"/>
<meta name="DC.subject" content="Elastic Stack"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Installation and Upgrade Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="installing-elastic-stack.html">Installing the Elastic Stack</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="installing-stack-demo-self.html">« Tutorial 1: Installing a self-managed Elastic Stack</a>
</span>
<span class="next">
<a href="air-gapped-install.html">Installing in an air-gapped environment »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="install-stack-demo-secure"></a>Tutorial 2: Securing a self-managed Elastic Stack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
</div></div></div>
<p>This tutorial is a follow-on to <a class="xref" href="installing-stack-demo-self.html" title="Tutorial 1: Installing a self-managed Elastic Stack">Tutorial 1: Installing a self-managed Elastic Stack</a>. The first tutorial describes how to configure a multi-node Elasticsearch cluster and then set up Kibana, followed by Fleet Server and Elastic Agent. In a production environment, it&#8217;s recommended after completing the Kibana setup to proceed directly to this tutorial to configure your SSL certificates. These steps guide you through that process, and then describe how to configure Fleet Server and Elastic Agent with the certificates in place.</p>
<p><span class="strong strong"><strong>Securing the Elastic Stack</strong></span></p>
<p>Beginning with Elastic 8.0, security is enabled in the Elastic Stack by default, meaning that traffic between Elasticsearch nodes and between Kibana and Elasticsearch is SSL-encrypted. While this is suitable for testing non-production viability of the Elastic platform, most production networks have requirements for the use of trusted CA-signed certificates. These steps demonstrate how to update the out-of-the-box self-signed certificates with your own trusted CA-signed certificates.</p>
<p>For traffic to be encrypted between Elasticsearch cluster nodes and between Kibana and Elasticsearch, SSL certificates must be created for the transport (Elasticsearch inter-node communication) and HTTP (for the Elasticsearch REST API) layers. Similarly, when setting up Fleet Server you&#8217;ll generate and configure a new certificate bundle, and then Elastic Agent uses the generated certificates to communicate with both Fleet Server and Elasticsearch. The process to set things up is as follows:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-prereqs" title="Prerequisites and assumptions">Prerequisites and assumptions</a>
</li>
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-ca" title="Step 1: Generate a new self-signed CA certificate">Step 1: Generate a new self-signed CA certificate</a>
</li>
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-transport" title="Step 2: Generate a new certificate for the transport layer">Step 2: Generate a new certificate for the transport layer</a>
</li>
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-http" title="Step 3: Generate new certificate(s) for the HTTP layer">Step 3: Generate new certificate(s) for the HTTP layer</a>
</li>
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-second-node" title="Step 4: Configure security on additional Elasticsearch nodes">Step 4: Configure security on additional Elasticsearch nodes</a>
</li>
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-kib-es" title="Step 5: Generate server-side and client-side certificates for Kibana">Step 5: Generate server-side and client-side certificates for Kibana</a>
</li>
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-fleet" title="Step 6: Install Fleet with SSL certificates configured">Step 6: Install Fleet with SSL certificates configured</a>
</li>
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-agent" title="Step 7: Install Elastic Agent">Step 7: Install Elastic Agent</a>
</li>
<li class="listitem">
<a class="xref" href="install-stack-demo-secure.html#install-stack-demo-secure-view-data" title="Step 8: View your system data">Step 8: View your system data</a>
</li>
</ul>
</div>
<p>It should take between one and two hours to complete these steps.</p>
<h2><a id="install-stack-demo-secure-prereqs"></a>Prerequisites and assumptions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>Before starting, you&#8217;ll need to have set up an on-premises Elasticsearch cluster with Kibana, following the steps in <a class="xref" href="installing-stack-demo-self.html" title="Tutorial 1: Installing a self-managed Elastic Stack">Tutorial 1: Installing a self-managed Elastic Stack</a>.</p>
<p>The examples in this guide use RPM packages to install the Elastic Stack components on hosts running Red Hat Enterprise Linux 8. The steps for other install methods and operating systems are similar, and can be found in the documentation linked from each section.</p>
<p>Special considerations such as firewalls and proxy servers are not covered here.</p>
<h2><a id="install-stack-demo-secure-ca"></a>Step 1: Generate a new self-signed CA certificate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>In a production environment you would typically use the CA certificate from your own organization, along with the certificate files generated for the hosts where the Elastic Stack is being installed. For demonstration purposes, we&#8217;ll use the Elastic certificate utility to configure a self-signed CA certificate.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On the first node in your Elasticsearch cluster, stop the Elasticsearch service:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl stop elasticsearch.service</pre>
</div>
</li>
<li class="listitem">
<p>Generate a CA certificate using the provided certificate utility, <code class="literal">elasticsearch-certutil</code>. Note that the location of the utility depends on the installation method you used to install Elasticsearch. Refer to <a href="/guide/en/elasticsearch/reference/master/certutil.html" class="ulink" target="_top">elasticsearch-certutil</a> for the command details and to <a href="/guide/en/elasticsearch/reference/master/update-node-certs-different.html" class="ulink" target="_top">Update security certificates with a different CA</a> for details about the procedure as a whole.</p>
<p>Run the following command. When prompted, specify a unique name for the output file, such as <code class="literal">elastic-stack-ca.zip</code>:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil ca -pem</pre>
</div>
</li>
<li class="listitem">
<p>Move the output file to the <code class="literal">/etc/elasticsearch/certs</code> directory. This directory is created automatically when you install Elasticsearch.</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo mv /usr/share/elasticsearch/elastic-stack-ca.zip /etc/elasticsearch/certs/</pre>
</div>
</li>
<li class="listitem">
<p>Unzip the file:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo unzip -d /etc/elasticsearch/certs /etc/elasticsearch/certs/elastic-stack-ca.zip</pre>
</div>
</li>
<li class="listitem">
<p>View the files that were unpacked into a new <code class="literal">ca</code> directory:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo ls /etc/elasticsearch/certs/ca/</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">ca.crt</code>
</span>
</dt>
<dd>
The generated certificate (or you can substitute this with your own certificate, signed by your organizations&#8217;s certificate authority)
</dd>
<dt>
<span class="term">
<code class="literal">ca.key</code>
</span>
</dt>
<dd>
The certificate authority&#8217;s private key
</dd>
</dl>
</div>
<p>These steps to generate new self-signed CA certificates need to be done only on the first Elasticsearch node. The other Elasticsearch nodes will use the same <code class="literal">ca.crt</code> and <code class="literal">ca.key</code> files.</p>
</li>
<li class="listitem">
<p>From the <code class="literal">/etc/elasticsearch/certs/ca/</code> directory, import the newly created CA certificate into the Elasticsearch truststore. This step ensures that your cluster trusts the new CA certificate.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>On a new installation a new keystore and truststore are created automatically. If you&#8217;re running these steps on an existing Elasticsearch installation and you know the password to the keystore and the truststore, follow the instructions in <a href="/guide/en/elasticsearch/reference/master/update-node-certs-different.html" class="ulink" target="_top">Update security certificates with a different CA</a> to import the CA certificate.</p>
</div>
</div>
<p>Run the <code class="literal">keytool</code> command as shown, replacing <code class="literal">&lt;password&gt;</code> with a unique password for the truststore, and store the password securely:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/jdk/bin/keytool -importcert -trustcacerts -noprompt -keystore /etc/elasticsearch/certs/elastic-stack-ca.p12 -storepass &lt;password&gt; -alias new-ca -file /etc/elasticsearch/certs/ca/ca.crt</pre>
</div>
</li>
<li class="listitem">
<p>Ensure that the new key was added to the keystore:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">keytool -keystore elastic-stack-ca.p12 -list</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The keytool utility is provided as part of the Elasticsearch installation and is located at: <code class="literal">/usr/share/elasticsearch/jdk/bin/keytool</code> on RPM installations.</p>
</div>
</div>
<p>Enter your password when prompted. The result should show the details for your newly added key:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">Keystore type: jks
Keystore provider: SUN
Your keystore contains 1 entry
new-ca, Jul 12, 2023, trustedCertEntry,
Certificate fingerprint (SHA-256): F0:86:6B:57:FC...</pre>
</div>
</li>
</ol>
</div>
<h2><a id="install-stack-demo-secure-transport"></a>Step 2: Generate a new certificate for the transport layer<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>This guide assumes the use of self-signed certificates, but the process to import CA-signed certificates is the same. If you&#8217;re using a CA provided by your organization, you need to generate Certificate Signing Requests (CSRs) and then use the signed certificates in this step. Once the certificates are generated, whether self-signed or CA-signed, the steps are the same.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the Elasticsearch installation directory, using the newly-created CA certificate and private key, create a new certificate for your elasticsearch node:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert --ca-cert /etc/elasticsearch/certs/ca/ca.crt --ca-key /etc/elasticsearch/certs/ca/ca.key</pre>
</div>
<p>When prompted, choose an output file name (you can use the default <code class="literal">elastic-certificates.p12</code>) and a password for the certificate.</p>
</li>
<li class="listitem">
<p>Move the generated file to the <code class="literal">/etc/elasticsearch/certs</code> directory:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo mv /usr/share/elasticsearch/elastic-certificates.p12 /etc/elasticsearch/certs/</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you&#8217;re running these steps on a production cluster that already contains data:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
In a cluster with multiple Elasticsearch nodes, before proceeding you first need to perform a <a href="/guide/en/elasticsearch/reference/master/restart-cluster.html#restart-cluster-rolling" class="ulink" target="_top">Rolling restart</a> beginning with the node where you&#8217;re updating the keystore. Stop at the <code class="literal">Perform any needed changes</code> step, and then proceed to the next step in this guide.
</li>
<li class="listitem">
In a single node cluster, always stop Elasticsearch before proceeding.
</li>
</ul>
</div>
</div>
</div>
</li>
<li class="listitem">
<p>Because you&#8217;ve created a new truststore and keystore, you need to update the <code class="literal">/etc/elasticsearch/elasticsearch.yml</code> settings file with the new truststore and keystore filenames.</p>
<p>Open the Elasticsearch configuration file in a text editor and adjust the following values to reflect the newly created keystore and truststore filenames and paths:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">xpack.security.transport.ssl:
   ...
   keystore.path: /etc/elasticsearch/certs/elastic-certificates.p12
   truststore.path: /etc/elasticsearch/certs/elastic-stack-ca.p12</pre>
</div>
</li>
</ol>
</div>
<h3><a id="install-stack-demo-secure-transport-es-keystore"></a>Update the Elasticsearch keystore<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h3>
<p>Elasticsearch uses a separate keystore to hold the passwords of the keystores and truststores holding the CA and node certificates created in the previous steps. Access to this keystore is through the use of a utility called <code class="literal">elasticsearch-keystore</code>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the Elasticsearch installation directory, list the contents of the existing keystore:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore list</pre>
</div>
<p>The results should be like the following:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">keystore.seed
xpack.security.http.ssl.keystore.secure_password
xpack.security.transport.ssl.keystore.secure_password
xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
<p>Notice that there are entries for:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">transport.ssl.truststore</code> that holds the CA certificate
</li>
<li class="listitem">
The <code class="literal">transport.ssl.keystore</code> that holds the CA-signed certificates
</li>
<li class="listitem">
<p>The <code class="literal">http.ssl.keystore</code> for the HTTP layer</p>
<p>These entries were created at installation and need to be replaced with the passwords to the newly-created truststore and keystores.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Remove the existing keystore values for the default transport keystore and truststore:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password

sudo /usr/share/elasticsearch/bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
</li>
<li class="listitem">
<p>Update the <code class="literal">elasticsearch-keystore</code> with the passwords for the new keystore and truststore created in the previous steps. This ensures that Elasticsearch can read the new stores:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password

sudo /usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
</li>
</ol>
</div>
<h2><a id="install-stack-demo-secure-http"></a>Step 3: Generate new certificate(s) for the HTTP layer<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>Now that communication between Elasticsearch nodes (the transport layer) has been secured with SSL certificates, the same must be done for the communications that use the REST API, including Kibana, clients, and any other components on the HTTP layer.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Similar to the process for the transport layer, on the first node in your Elasticsearch cluster use the certificate utility to generate a CA certificate for HTTP communications:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil http</pre>
</div>
<p>Respond to the command prompts as follows:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
When asked if you want to generate a CSR, enter <code class="literal">n</code>.
</li>
<li class="listitem">
<p>When asked if you want to use an existing CA, enter <code class="literal">y</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you&#8217;re using your organization&#8217;s CA certificate, specify that certificate and key in the following two steps.</p>
</div>
</div>
</li>
<li class="listitem">
Provide the absolute path to your newly created CA certificate: <code class="literal">/etc/elasticsearch/certs/ca/ca.crt</code>.
</li>
<li class="listitem">
Provide the absolute path to your newly created CA key: <code class="literal">/etc/elasticsearch/certs/ca/ca.key</code>.
</li>
<li class="listitem">
Enter an expiration value for your certificate. You can enter the validity period in years, months, or days. For example, enter <code class="literal">1y</code> for one year.
</li>
<li class="listitem">
<p>When asked if you want to generate one certificate per node, enter <code class="literal">y</code>.</p>
<p>You&#8217;ll be guided through the creation of certificates for each node. Each certificate will have its own private key, and will be issued for a specific hostname or IP address.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Enter the hostname for your first Elasticsearch node, for example <code class="literal">mynode-es1</code>.</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">mynode-es1</pre>
</div>
</li>
<li class="listitem">
When prompted, confirm that the settings are correct.
</li>
<li class="listitem">
<p>Add the network IP address that clients can use to connect to the first Elasticsearch node. This is the same value that&#8217;s described in Step 2 of <a class="xref" href="installing-stack-demo-self.html" title="Tutorial 1: Installing a self-managed Elastic Stack">Tutorial 1: Installing a self-managed Elastic Stack</a>, for example <code class="literal">10.128.0.84</code>:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">10.128.0.84</pre>
</div>
</li>
<li class="listitem">
When prompted, confirm that the settings are correct.
</li>
<li class="listitem">
When prompted, choose to generate additional certificates, and then repeat the previous steps to add hostname and IP settings for each node in your Elasticsearch cluster.
</li>
<li class="listitem">
Provide a password for the generated <code class="literal">http.p12</code> keystore file.
</li>
<li class="listitem">
<p>The generated files will be included in a zip archive. At the prompt, provide a path and filename for where the archive should be created.</p>
<p>For this example we use: <code class="literal">/etc/elasticsearch/certs/elasticsearch-ssl-http.zip</code>:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">What filename should be used for the output zip file? [/usr/share/elasticsearch/elasticsearch-ssl-http.zip] /etc/elasticsearch/certs/elasticsearch-ssl-http.zip</pre>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Earlier, when you generated the certificate for the transport layer, the default filename was <code class="literal">elastic-certificates.p12</code>. Now, when generating a certificate for the HTTP layer, the default filename is <code class="literal">http.p12</code>. This matches the name of the existing HTTP layer certificate file from when the initial Elasticsearch cluster was first installed.</p>
<p>Just to avoid any possible name collisions, rename the existing <code class="literal">http.p12</code> file to distinguish it from the newly-created keystore:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo mv /etc/elasticsearch/certs/http.p12 /etc/elasticsearch/certs/http-old.p12</pre>
</div>
</li>
<li class="listitem">
<p>Unzip the generated <code class="literal">elasticsearch-ssl-http.zip</code> archive:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo unzip -d /usr/share/elasticsearch/ /etc/elasticsearch/certs/elasticsearch-ssl-http.zip</pre>
</div>
</li>
<li class="listitem">
<p>When the archive is unpacked, the certificate files are located in separate directories for each Elasticsearch node and for the Kibana node.</p>
<p>You can run a recursive <code class="literal">ls</code> command to view the file structure:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">ls -lR /usr/share/elasticsearch/{elasticsearch,kibana}</pre>
</div>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">elasticsearch:
total 0
drwxr-xr-x. 2 root root 56 Dec 12 19:13 mynode-es1
drwxr-xr-x. 2 root root 72 Dec 12 19:04 mynode-es2
drwxr-xr-x. 2 root root 72 Dec 12 19:04 mynode-es3

elasticsearch/mynode-es1:
total 8
-rw-r--r--. 1 root root 1365 Dec 12 19:04 README.txt
-rw-r--r--. 1 root root  845 Dec 12 19:04 sample-elasticsearch.yml

elasticsearch/mynode-es2:
total 12
-rw-r--r--. 1 root root 3652 Dec 12 19:04 http.p12
-rw-r--r--. 1 root root 1365 Dec 12 19:04 README.txt
-rw-r--r--. 1 root root  845 Dec 12 19:04 sample-elasticsearch.yml

elasticsearch/mynode-es3:
total 12
-rw-r--r--. 1 root root 3652 Dec 12 19:04 http.p12
-rw-r--r--. 1 root root 1365 Dec 12 19:04 README.txt
-rw-r--r--. 1 root root  845 Dec 12 19:04 sample-elasticsearch.yml

kibana:
total 12
-rw-r--r--. 1 root root 1200 Dec 12 19:04 elasticsearch-ca.pem
-rw-r--r--. 1 root root 1306 Dec 12 19:04 README.txt
-rw-r--r--. 1 root root 1052 Dec 12 19:04 sample-kibana.yml</pre>
</div>
</li>
<li class="listitem">
<p>Replace your existing keystore with the new keystore. The location of your certificate directory may be different than what is shown here, depending on the installation method you chose.</p>
<p>Run the <code class="literal">mv</code> command, replacing <code class="literal">&lt;es1-hostname&gt;</code> with the hostname of your initial Elasticsearch node:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo mv /usr/share/elasticsearch/elasticsearch/&lt;es1-hostname&gt;/http.p12 /etc/elasticsearch/certs/</pre>
</div>
</li>
<li class="listitem">
<p>Because this is a new keystore, the Elasticsearch configuration file needs to be updated with the path to its location. Open <code class="literal">/etc/elasticsearch/elasticsearch.yml</code> and update the HTTP SSL settings with the new path:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.security.http.ssl:
  enabled: true
  #keystore.path: certs/http.p12
  keystore.path: /etc/elasticsearch/certs/http.p12</pre>
</div>
</li>
<li class="listitem">
<p>Since you also generated a new keystore password, the Elasticsearch keystore needs to be updated as well. From the Elasticsearch installation directory, first remove the existing HTTP keystore entry:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</pre>
</div>
</li>
<li class="listitem">
<p>Add the updated HTTP keystore password, using the password you generated for this keystore:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password</pre>
</div>
</li>
<li class="listitem">
<p>Because we&#8217;ve added files to the Elasticsearch configuration directory during this tutorial, we need to ensure that the permissions and ownership are correct before restarting Elasticsearch.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Change the files to be owned by <code class="literal">root:elasticsearch</code>:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo chown -R root:elasticsearch /etc/elasticsearch/certs/</pre>
</div>
</li>
<li class="listitem">
<p>Set the files in <code class="literal">/etc/elasticsearch/certs</code> to have read and write permissions by the owner (<code class="literal">root</code>) and read permission by the <code class="literal">elastic</code> user:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo chmod 640 /etc/elasticsearch/certs/elastic-certificates.p12
sudo chmod 640 /etc/elasticsearch/certs/elastic-stack-ca.p12
sudo chmod 640 /etc/elasticsearch/certs/http_ca.crt
sudo chmod 640 /etc/elasticsearch/certs/http.p12</pre>
</div>
</li>
<li class="listitem">
<p>Change the <code class="literal">/etc/elasticsearch/certs</code> and <code class="literal">/etc/elasticsearch/certs/ca</code> directories to be executable by the owner:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo chmod 750 /etc/elasticsearch/certs
sudo chmod 750 /etc/elasticsearch/certs/ca</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Restart the Elasticsearch service:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl start elasticsearch.service</pre>
</div>
</li>
<li class="listitem">
<p>Run the status command to confirm that Elasticsearch is running:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl status elasticsearch.service</pre>
</div>
<p>In the event of any problems, you can also monitor the Elasticsearch logs for any issues by tailing the Elasticsearch log file:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo tail -f /var/log/elasticsearch/elasticsearch-demo.log</pre>
</div>
<p>A line in the log file like the following indicates that SSL has been properly configured:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">[2023-07-12T13:11:29,154][INFO ][o.e.x.s.Security         ] [es-ssl-test] Security is enabled</pre>
</div>
</li>
</ol>
</div>
<h2><a id="install-stack-demo-secure-second-node"></a>Step 4: Configure security on additional Elasticsearch nodes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>Now that the security is configured for the first Elasticsearch node, some steps need to be repeated on each additional Elasticsearch node.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To avoid filename collisions, on each additional Elasticsearch node rename the existing <code class="literal">http.p12</code> file in the <code class="literal">/etc/elasticsearch/certs/</code> directory:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">mv http.p12 http-old.p12</pre>
</div>
</li>
<li class="listitem">
<p>Copy the CA and truststore files that you generated on the first Elasticsearch node so that they can be reused on all other nodes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Copy the <code class="literal">/ca</code> directory (that contains <code class="literal">ca.crt</code> and <code class="literal">ca.key</code>) from <code class="literal">/etc/elasticsearch/certs/</code> on the first Elasticsearch node to the same path on all other Elasticsearch nodes.
</li>
<li class="listitem">
Copy the <code class="literal">elastic-stack-ca.p12</code> file from <code class="literal">/etc/elasticsearch/certs/</code> to the <code class="literal">/etc/elasticsearch/certs/</code> directory on all other Elasticsearch nodes.
</li>
<li class="listitem">
Copy the <code class="literal">http.p12</code> file from each node directory in <code class="literal">/usr/share/elasticsearch/elasticsearch</code> (that is, <code class="literal">elasticsearch/mynode-es1</code>, <code class="literal">elasticsearch/mynode-es2</code> and <code class="literal">elasticsearch/mynode-es3</code>) to the <code class="literal">/etc/elasticsearch/certs/</code> directory on each corresponding cluster node.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>On each Elasticsearch node, repeat the steps to generate a new certificate for the transport layer:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Stop the Elasticsearch service:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl stop elasticsearch.service</pre>
</div>
</li>
<li class="listitem">
<p>From the <code class="literal">/etc/elasticsearch/certs</code> directory, create a new certificate for the Elasticsearch node:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert --ca-cert /etc/elasticsearch/certs/ca/ca.crt --ca-key /etc/elasticsearch/certs/ca/ca.key</pre>
</div>
<p>When prompted, choose an output file name and specify a password for the certificate. For this example, we&#8217;ll use <code class="literal">/etc/elasticsearch/certs/elastic-certificates.p12</code>.</p>
</li>
<li class="listitem">
<p>Update the <code class="literal">/etc/elasticsearch/elasticsearch.yml</code> settings file with the new truststore and keystore filename and path:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">xpack.security.transport.ssl:
   ...
   keystore.path: /etc/elasticsearch/certs/elastic-certificates.p12
   truststore.path: /etc/elasticsearch/certs/elastic-stack-ca.p12</pre>
</div>
</li>
<li class="listitem">
<p>List the content of the Elasticsearch keystore:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">/usr/share/elasticsearch/bin/elasticsearch-keystore list</pre>
</div>
<p>The results should be like the following:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">keystore.seed
xpack.security.http.ssl.keystore.secure_password
xpack.security.transport.ssl.keystore.secure_password
xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
</li>
<li class="listitem">
<p>Remove the existing keystore values for the default transport keystore and truststore:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password

sudo /usr/share/elasticsearch/bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
</li>
<li class="listitem">
<p>Update the <code class="literal">elasticsearch-keystore</code> with the passwords for the new keystore and truststore:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password

sudo /usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>For the HTTP layer, the certificates have been generated already on the first Elasticsearch node. Each additional Elasticsearch node just needs to be configured to use the new certificates.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update the <code class="literal">/etc/elasticsearch/elasticsearch.yml</code> settings file with the new truststore and keystore filenames:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">xpack.security.http.ssl:
  enabled: true
  #keystore.path: certs/http.p12
  keystore.path: /etc/elasticsearch/certs/http.p12</pre>
</div>
</li>
<li class="listitem">
<p>Remove the existing HTTP keystore entry:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</pre>
</div>
</li>
<li class="listitem">
<p>Add the updated HTTP keystore password:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password</pre>
</div>
</li>
<li class="listitem">
<p>Change the certificate files to be owned by the <code class="literal">root:elasticsearch</code> group:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo chown -R root:elasticsearch /etc/elasticsearch/certs/</pre>
</div>
</li>
<li class="listitem">
<p>Set the files in <code class="literal">/etc/elasticsearch/certs</code> to have read and write permissions by the owner (<code class="literal">root</code>) and read permission by the <code class="literal">elastic</code> user:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">chmod 640 *</pre>
</div>
</li>
<li class="listitem">
<p>Change the <code class="literal">/etc/elasticsearch/certs</code> and <code class="literal">/etc/elasticsearch/certs/ca</code> directories to be executable by the owner:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">chmod 750 /etc/elasticsearch/certs
chmod 750 /etc/elasticsearch/certs/ca</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Restart the Elasticsearch service.</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl start elasticsearch.service</pre>
</div>
</li>
<li class="listitem">
<p>Run the status command to confirm that Elasticsearch is running.</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl status elasticsearch.service</pre>
</div>
</li>
</ol>
</div>
<h2><a id="install-stack-demo-secure-kib-es"></a>Step 5: Generate server-side and client-side certificates for Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>Now that the transport and HTTP layers are configured with encryption using the new certificates, there are two more tasks that must be accomplished for end-to-end connectivity to Elasticsearch: Set up certificates for encryption between Kibana and Elasticsearch, and between the client browser and Kibana. For additional details about any of these steps, refer to <a href="/guide/en/kibana/master/elasticsearch-mutual-tls.html" class="ulink" target="_top">Mutual TLS authentication between Kibana and Elasticsearch</a> and <a href="/guide/en/elasticsearch/reference/master/security-basic-setup-https.html#encrypt-kibana-browser" class="ulink" target="_top">Encrypt traffic between your browser and Kibana</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In Step 3, when you generated a new certificate for the HTTP layer, the process created an archive <code class="literal">elasticsearch-ssl-http.zip</code>.</p>
<p>From the <code class="literal">kibana</code> directory in the expanded archive, copy the <code class="literal">elasticsearch-ca.pem</code> private key file to the Kibana host machine.</p>
</li>
<li class="listitem">
<p>On the Kibana host machine, copy <code class="literal">elasticsearch-ca.pem</code> to the Kibana configuration directory (depending on the installation method that you used, the location of the configuration directory may be different from what&#8217;s shown):</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">mv elasticsearch-ca.pem /etc/kibana</pre>
</div>
</li>
<li class="listitem">
<p>Stop the Kibana service:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl stop kibana.service</pre>
</div>
</li>
<li class="listitem">
<p>Update the <code class="literal">/etc/kibana/kibana.yml</code> settings file to reflect the location of the <code class="literal">elasticsearch-ca.pem</code>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">elasticsearch.ssl.certificateAuthorities: [/etc/kibana/elasticsearch-ca.pem]</pre>
</div>
</li>
<li class="listitem">
<p>Log in to the first Elasticsearch node and use the certificate utility to generate a certificate bundle for the Kibana server. This certificate will be used to encrypt the traffic between Kibana and the client&#8217;s browser. In the command, replace &lt;DNS name&gt; and &lt;IP address&gt; with the name and IP address of your Kibana server host:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert --name kibana-server --ca-cert /etc/elasticsearch/certs/ca/ca.crt --ca-key /etc/elasticsearch/certs/ca/ca.key  --dns &lt;DNS name&gt; --ip &lt;IP address&gt; --pem</pre>
</div>
<p>When prompted, specify a unique name for the output file, such as <code class="literal">kibana-cert-bundle.zip</code>.</p>
</li>
<li class="listitem">
<p>Copy the generated archive over to your Kibana host and unpack it:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo unzip kibana-cert-bundle.zip</pre>
</div>
<p>The unpacked archive will create a directory, <code class="literal">kibana-server</code>,  containing the new Kibana key and certificate:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">ls -l kibana-server/
total 8
-rw-r--r--. 1 root root 1208 May  3 16:08 kibana-server.crt
-rw-r--r--. 1 root root 1675 May  3 16:08 kibana-server.key</pre>
</div>
</li>
<li class="listitem">
<p>Copy the certificate and key into <code class="literal">/etc/kibana</code>:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo cp kibana-server.crt /etc/kibana/
sudo cp kibana-server.key /etc/kibana/</pre>
</div>
</li>
<li class="listitem">
<p>Update the permissions on the certificate files to ensure that they’re readable. From inside the <code class="literal">/etc/kibana</code> directory, run:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo chmod 640 *.crt
sudo chmod 640 *.key</pre>
</div>
</li>
<li class="listitem">
<p>Open <code class="literal">/etc/kibana/kibana.yml</code> and make the following changes:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">server.ssl.certificate: /etc/kibana/kibana-server.crt
server.ssl.key: /etc/kibana/kibana-server.key
server.ssl.enabled: true</pre>
</div>
<p>Keep the file open for the next step.</p>
</li>
<li class="listitem">
<p>To ensure that Kibana sessions are not invalidated, set up an encryption key by assigning any string of 32 characters or longer to the <code class="literal">xpack.security.encryptionKey</code> setting (this string will be configured in <code class="literal">kibana.yml</code> and does not need to be remembered). To generate a random string, you can use the following bash commands:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">cat /dev/urandom | tr -dc 'a-z0-9' | fold -w 32 | head -n 1</pre>
</div>
<p>Using your own string or the output of the above command sequence, add the encryption key setting to <code class="literal">/etc/kibana/kibana.yml</code>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">xpack.security.encryptionKey: previously_create_string</pre>
</div>
<p>Save and close the file.</p>
</li>
<li class="listitem">
<p>Restart the Kibana service:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl start kibana.service</pre>
</div>
</li>
<li class="listitem">
<p>Confirm that Kibana is running:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl status kibana.service</pre>
</div>
<p>If everything is configured correctly, connection to Elasticsearch will be established and Kibana will start normally.</p>
</li>
<li class="listitem">
<p>You can also view the Kibana log file to gather more detail:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">tail -f /var/log/kibana/kibana.log</pre>
</div>
<p>In the log file you should find a <code class="literal">Kibana is now available</code> message.</p>
</li>
<li class="listitem">
<p>You should now have an end-to-end ecnrypted deployment with Elasticsearch and Kibana that provides encryption between both the cluster nodes and Kibana, and HTTPS access to Kibana.</p>
<p>Open a web browser to the external IP address of the Kibana host machine: <code class="literal">https://&lt;kibana-host-address&gt;:5601</code>. Note that the URL should use the <code class="literal">https</code> and not the <code class="literal">http</code> protocol.</p>
</li>
<li class="listitem">
Log in using the <code class="literal">elastic</code> user and password that you configured in Step 1 of <a class="xref" href="installing-stack-demo-self.html" title="Tutorial 1: Installing a self-managed Elastic Stack">Tutorial 1: Installing a self-managed Elastic Stack</a>.
</li>
</ol>
</div>
<p>Congratulations! You&#8217;ve successfully updated the SSL certificates between Elasticsearch and Kibana.</p>
<h2><a id="install-stack-demo-secure-fleet"></a>Step 6: Install Fleet with SSL certificates configured<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>Now that Kibana is up and running, you can proceed to install Fleet Server, which will manage the Elastic Agent that we&#8217;ll set up in a later step.</p>
<p>If you&#8217;d like to learn more about these steps, refer to <a href="/guide/en/fleet/master/add-fleet-server-on-prem.html" class="ulink" target="_top">Deploy on-premises and self-managed</a> in the Fleet and Elastic Agent Guide. You can find detailed steps to generate and configure certificates in <a href="/guide/en/fleet/master/secure-connections.html" class="ulink" target="_top">Configure SSL/TLS for self-managed Fleet Servers</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Log in to the first Elasticsearch node and use the certificate utility to generate a certificate bundle for Fleet Server. In the command, replace <code class="literal">&lt;DNS name&gt;</code> and <code class="literal">IP address</code> with the name and IP address of your Fleet Server host:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert --name fleet-server --ca-cert /etc/elasticsearch/certs/ca/ca.crt --ca-key /etc/elasticsearch/certs/ca/ca.key  --dns &lt;DNS name&gt; --ip &lt;IP address&gt; --pem</pre>
</div>
<p>When prompted, specify a unique name for the output file, such as <code class="literal">fleet-cert-bundle.zip</code>.</p>
</li>
<li class="listitem">
<p>On your Fleet Server host, create a directory for the certificate files:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo mkdir /etc/fleet</pre>
</div>
</li>
<li class="listitem">
<p>Copy the generated archive over to your Fleet Server host and unpack it into <code class="literal">/etc/fleet/</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/etc/fleet/fleet-server.crt</code>
</li>
<li class="listitem">
<code class="literal">/etc/fleet/fleet-server.key`</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>From the first Elasticsearch node, copy the <code class="literal">ca.crt</code> file, and paste it into the <code class="literal">/etc/fleet/</code> directory on the Fleet Server host. Just to help identify the file we&#8217;ll also rename it to <code class="literal">es-ca.crt</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/etc/fleet/es-ca.crt</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Update the permissions on the certificate files to ensure that they&#8217;re readable. From inside the <code class="literal">/etc/fleet</code> directory, run:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo chmod 640 *.crt
sudo chmod 640 *.key</pre>
</div>
</li>
<li class="listitem">
<p>Now that the certificate files are in place, on the Fleet Server host create a working directory for the installation package:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">mkdir fleet-install-files</pre>
</div>
</li>
<li class="listitem">
<p>Change into the new directory:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">cd fleet-install-files</pre>
</div>
</li>
<li class="listitem">
In the terminal, run the <code class="literal">ifconfig</code> command and copy the value for the host inet IP address (for example, <code class="literal">10.128.0.84</code>). You&#8217;ll need this value later.
</li>
<li class="listitem">
Back in your web browser, open the Kibana menu and go to <span class="strong strong"><strong>Management &#8594; Fleet</strong></span>. Fleet opens with a message that you need to add a Fleet Server.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Fleet Server</strong></span>. The <span class="strong strong"><strong>Add a Fleet Server</strong></span> flyout opens.
</li>
<li class="listitem">
In the flyout, select the <span class="strong strong"><strong>Advanced</strong></span> tab.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>Create a policy for Fleet Server</strong></span> step, keep the default Fleet Server policy name and all advanced options at their defaults.</p>
<p>Leave the option to collect system logs and metrics selected. Click <span class="strong strong"><strong>Create policy</strong></span>. The policy takes a minute or so to create.</p>
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Choose a deployment mode for security</strong></span> step, select the <span class="strong strong"><strong>Production</strong></span> option. This enables you to provide your own certificates.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>Add your Fleet Server host</strong></span> step:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Specify a name for your Fleet Server host, for example <code class="literal">Fleet Server</code>.
</li>
<li class="listitem">
<p>Specify the host URL and where Elastic Agents will reach Fleet Server, including the default port <code class="literal">8220</code>. For example, <code class="literal">https://10.128.0.203:8220</code>.</p>
<p>The URL is the inet value that you copied from the <code class="literal">ifconfig</code> output.</p>
<p>For details about default port assignments, refer to <a href="/guide/en/fleet/master/add-fleet-server-on-prem.html#default-port-assignments-on-prem" class="ulink" target="_top">Default port assignments</a> in the on-premises Fleet Server install documentation.</p>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add host</strong></span>.
</li>
</ol>
</div>
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Generate a service token</strong></span> step, generate the token and save the output. The token will also be propagated automatically to the command to install Fleet Server.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>Install Fleet Server to a centralized host</strong></span> step, for this example we select the <span class="strong strong"><strong>Linux Tar</strong></span> tab, but you can instead select the tab appropriate to the host operating system where you&#8217;re setting up Fleet Server.</p>
<p>Note that TAR/ZIP packages are recommended over RPM/DEB system packages, since only the former support upgrading Fleet Server using Fleet.</p>
</li>
<li class="listitem">
<p>Run the first three commands one-by-one in the terminal on your Fleet Server host.</p>
<p>These commands will, respectively:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the Fleet Server package from the Elastic Artifact Registry.
</li>
<li class="listitem">
Unpack the package archive.
</li>
<li class="listitem">
Change into the directory containing the install binaries.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Before running the provided <code class="literal">elastic-agent install</code> command, you&#8217;ll need to make a few changes:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update the paths to the correct file locations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The Elasticsearch CA file (<code class="literal">es-ca.crt</code>)
</li>
<li class="listitem">
The Fleet Server certificate (<code class="literal">fleet-server.crt</code>)
</li>
<li class="listitem">
The Fleet Server key (<code class="literal">fleet-server.key</code>)
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>The <code class="literal">fleet-server-es-ca-trusted-fingerprint</code> also needs to be updated. On any of your Elasticsearch hosts, run the following command to get the correct fingerprint to use:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">grep -v ^- /etc/elasticsearch/certs/ca/ca.crt | base64 -d | sha256sum</pre>
</div>
<p>Save the fingerprint value. You&#8217;ll need it in a later step.</p>
<p>Replace the <code class="literal">fleet-server-es-ca-trusted-fingerprint</code> setting with the returned value. Your updated command should be similar to the following:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo ./elastic-agent install -url=https://10.128.0.208:8220 \
  --fleet-server-es=https://10.128.0.84:9200 \
  --fleet-server-service-token=AAEAAWVsYXN0aWMvZmxlZXQtc2VydmPyL6Rva2VuLTE5OTg4NzAxOTM4NDU6X1I0Q1RrRHZTSWlyNHhkSXQwNEJoQQ \
  --fleet-server-policy=fleet-server-policy \
  --fleet-server-es-ca-trusted-fingerprint=92b51cf91e7fa311f8c84849224d448ca44824eb \
  --certificate-authorities=/etc/fleet/es-ca.crt \
  --fleet-server-cert=/etc/fleet/fleet-server.crt \
  --fleet-server-cert-key=/etc/fleet/fleet-server.key \
  --fleet-server-port=8220</pre>
</div>
<p>For details about all of the install command options, refer to <a href="/guide/en/fleet/master/elastic-agent-cmd-options.html#elastic-agent-install-command" class="ulink" target="_top"><code class="literal">elastic-agent install</code></a> in the Elastic Agent command reference.</p>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>After you&#8217;ve made the required updates, run the <code class="literal">elastic-agent install</code> command to install Fleet Server.</p>
<p>When prompted, confirm that Elastic Agent should run as a service. If everything goes well, the install will complete successfully:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">Elastic Agent has been successfully installed.</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Wondering why the command refers to Elastic Agent rather than Fleet Server? Fleet Server is actually a subprocess that runs inside Elastic Agent with a special Fleet Server policy. Refer to <a href="/guide/en/fleet/master/fleet-server.html" class="ulink" target="_top">What is Fleet Server</a> to learn more.</p>
</div>
</div>
</li>
<li class="listitem">
Return to the Kibana <span class="strong strong"><strong>Add a Fleet Server</strong></span> flyout and wait for confirmation that Fleet Server has connected.
</li>
<li class="listitem">
Once the connection is confirmed, ignore the <span class="strong strong"><strong>Continue enrolling Elastic Agent</strong></span> option and close the flyout.
</li>
</ol>
</div>
<p>Fleet Server is now fully set up!</p>
<p>Before proceeding to install Elastic Agent, there are a few steps needed to update the <code class="literal">kibana.yml</code> settings file with the Elasticsearch CA fingerprint:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On your Kibana host, stop the Kibana service:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl stop kibana.service</pre>
</div>
</li>
<li class="listitem">
Open <code class="literal">/etc/kibana/kibana.yml</code> for editing.
</li>
<li class="listitem">
Find the <code class="literal">xpack.fleet.outputs</code> setting.
</li>
<li class="listitem">
<p>Update <code class="literal">ca_trusted_fingerprint</code> to the value you captured earlier, when you ran the <code class="literal">grep</code> command on the Elasticsearch <code class="literal">ca.crt</code> file.</p>
<p>The updated entry in <code class="literal">kibana.yml</code> should be like the following:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.fleet.outputs: [{id: fleet-default-output, name: default, is_default: true, is_default_monitoring: true, type: elasticsearch, hosts: [`https://10.128.0.84:9200`], ca_trusted_fingerprint: 92b51cf91e7fa311f8c84849224d448ca44824eb}]</pre>
</div>
</li>
<li class="listitem">
Save your changes.
</li>
<li class="listitem">
<p>Restart Kibana:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo systemctl start kibana.service</pre>
</div>
<p>Kibana is now configured with the correct fingerprint for Elastic Agent to access Elasticsearch. You&#8217;re now ready to set up Elastic Agent!</p>
</li>
</ol>
</div>
<h2><a id="install-stack-demo-secure-agent"></a>Step 7: Install Elastic Agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>Next, we&#8217;ll install Elastic Agent on another host and use the System integration to monitor system logs and metrics. You can find additional details about these steps in <a href="/guide/en/fleet/master/secure-connections.html" class="ulink" target="_top">Configure SSL/TLS for self-managed Fleet Servers</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to the host where you&#8217;d like to set up Elastic Agent.
</li>
<li class="listitem">
<p>Create a directory for the Elasticsearch certificate file:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo mkdir /etc/agent</pre>
</div>
</li>
<li class="listitem">
<p>From the first Elasticsearch node, copy the <code class="literal">ca.crt</code> file, and paste it into the <code class="literal">/etc/agent/</code> directory on the Fleet Server host. Just to help identify the file we&#8217;ll also rename it to <code class="literal">es-ca.crt</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/etc/fleet/es-ca.crt</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Create a working directory for the installation package:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">mkdir agent-install-files</pre>
</div>
</li>
<li class="listitem">
<p>Change into the new directory:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">cd agent-install-files</pre>
</div>
</li>
<li class="listitem">
Open Kibana and go to <span class="strong strong"><strong>Management &#8594; Fleet</strong></span>.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Agents</strong></span> tab, you should see your new Fleet Server policy running with a healthy status.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add agent</strong></span>. The <span class="strong strong"><strong>Add agent</strong></span> flyout opens.
</li>
<li class="listitem">
In the flyout, choose an agent policy name, for example <code class="literal">Demo Agent Policy</code>.
</li>
<li class="listitem">
Leave <span class="strong strong"><strong>Collect system logs and metrics</strong></span> enabled. This will add the <a href="https://docs.elastic.co/integrations/system" class="ulink" target="_top">System integration</a> to the Elastic Agent policy.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create policy</strong></span>.
</li>
<li class="listitem">
For the <span class="strong strong"><strong>Enroll in Fleet?</strong></span> step, leave <span class="strong strong"><strong>Enroll in Fleet</strong></span> selected.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>Install Elastic Agent on your host</strong></span> step, for this example we select the <span class="strong strong"><strong>Linux Tar</strong></span> tab, but you can instead select the tab appropriate to the host operating system where you&#8217;re setting up Fleet Server.</p>
<p>As with Fleet Server, note that TAR/ZIP packages are recommended over RPM/DEB system packages, since only the former support upgrading Elastic Agent using Fleet.</p>
</li>
<li class="listitem">
<p>Run the first three commands one-by-one in the terminal on your Elastic Agent host.</p>
<p>These commands will, respectively:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the Elastic Agent package from the Elastic Artifact Registry.
</li>
<li class="listitem">
Unpack the package archive.
</li>
<li class="listitem">
Change into the directory containing the install binaries.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Before running the provided <code class="literal">elastic-agent install</code> command, you&#8217;ll need to make a few changes:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
For the <code class="literal">--url</code> parameter, confirm that the port number is <code class="literal">8220</code> (this is the default port for on-premises Fleet Server).
</li>
<li class="listitem">
<p>Add a <code class="literal">--certificate-authorities</code> parameter with the full path of your CA certificate file. For example, <code class="literal">--certificate-authorities=/etc/agent/es-ca.crt</code>.</p>
<p>The result should be like the following:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo ./elastic-agent install \
--url=https://10.128.0.203:8220 \
--enrollment-token=VWCobFhKd0JuUnppVYQxX0VKV5E6UmU3BGk0ck9RM2HzbWEmcS4Bc1YUUM== \
--certificate-authorities=/etc/agent/es-ca.crt</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Run the <code class="literal">elastic-agent install</code> command.</p>
<p>At the prompt, enter <code class="literal">Y</code> to install Elastic Agent and run it as a service. wait for the installation to complete.</p>
<p>If everything goes well, the install will complete successfully:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">Elastic Agent has been successfully installed.</pre>
</div>
</li>
<li class="listitem">
In the Kibana <span class="strong strong"><strong>Add agent</strong></span> flyout, wait for confirmation that Elastic Agent has connected.
</li>
<li class="listitem">
Wait for the <span class="strong strong"><strong>Confirm incoming data</strong></span> step to complete. This may take a couple of minutes.
</li>
<li class="listitem">
Once data is confirmed to be flowing, close the flyout.
</li>
</ol>
</div>
<p>Your new Elastic Agent is now installed an enrolled with Fleet Server.</p>
<h2><a id="install-stack-demo-secure-view-data"></a>Step 8: View your system data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<p>Now that all of the components have been installed, it&#8217;s time to view your system data.</p>
<p>View your system log data:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the Kibana menu and go to <span class="strong strong"><strong>Analytics &#8594; Dashboard</strong></span>.
</li>
<li class="listitem">
In the query field, search for <code class="literal">Logs System</code>.
</li>
<li class="listitem">
Select the <code class="literal">[Logs System] Syslog dashboard</code> link. The Kibana Dashboard opens with visualizations of Syslog events, hostnames and processes, and more.
</li>
</ol>
</div>
<p>View your system metrics data:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the Kibana menu and return to <span class="strong strong"><strong>Analytics &#8594; Dashboard</strong></span>.
</li>
<li class="listitem">
In the query field, search for <code class="literal">Metrics System</code>.
</li>
<li class="listitem">
<p>Select the <code class="literal">[Metrics System] Host overview</code> link. The Kibana Dashboard opens with visualizations of host metrics including CPU usage, memory usage, running processes, and more.</p>
<div class="imageblock">
<div class="content">
<img src="images/install-stack-metrics-dashboard.png" alt="The System metrics host overview showing CPU usage, memory usage, and other visualizations">
</div>
</div>
</li>
</ol>
</div>
<p>Congratulations! You&#8217;ve successfully configured security for Elasticsearch, Kibana, Fleet, and Elastic Agent using your own trusted CA-signed certificates.</p>
<h2><a id="_whats_next"></a>What&#8217;s next?<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/install-upgrade/installing-stack-demo-secure.asciidoc">edit</a></h2>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Do you have data ready to ingest into your newly set up Elastic Stack? Learn how to <a href="/guide/en/cloud/current/ec-cloud-ingest-data.html" class="ulink" target="_top">add data to Elasticsearch</a>.
</li>
<li class="listitem">
Use <a href="/observability" class="ulink" target="_top">Elastic Observability</a>
to unify your logs, infrastructure metrics, uptime, and application performance data.
</li>
<li class="listitem">
Want to protect your endpoints from security threats? Try
<a href="/security" class="ulink" target="_top">Elastic Security</a>. Adding endpoint protection is
just another integration that you add to the agent policy!
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="installing-stack-demo-self.html">« Tutorial 1: Installing a self-managed Elastic Stack</a>
</span>
<span class="next">
<a href="air-gapped-install.html">Installing in an air-gapped environment »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
