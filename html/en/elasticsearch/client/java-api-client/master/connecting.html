<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Connecting | Elasticsearch Java API Client [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Java API Client [master]"/>
<link rel="up" href="_getting_started.html" title="Getting started"/>
<link rel="prev" href="installation.html" title="Installation"/>
<link rel="next" href="migrate-hlrc.html" title="Migrating from the High Level Rest Client"/>
<meta name="DC.type" content="Learn/Docs/Clients/Java/master"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Java API Client [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="_getting_started.html">Getting started</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="installation.html">« Installation</a>
</span>
<span class="next">
<a href="migrate-hlrc.html">Migrating from the High Level Rest Client »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="connecting"></a>Connecting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/getting-started/connecting.asciidoc">edit</a></h2>
</div></div></div>
<p>The Java API Client is structured around three main components:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>API client classes</strong></span>. These provide strongly typed data structures and
methods for Elasticsearch APIs. Since the Elasticsearch API is large, it is structured in feature
groups (also called “namespaces”), each having its own client class. Elasticsearch core
features are implemented in the <code class="literal">ElasticsearchClient</code> class.
</li>
<li class="listitem">
<span class="strong strong"><strong>A JSON object mapper</strong></span>. This maps your application classes to JSON and
seamlessly integrates them with the API client.
</li>
<li class="listitem">
<span class="strong strong"><strong>A transport layer implementation</strong></span>. This is where all HTTP request handling
takes place.
</li>
</ul>
</div>
<p>This code snippet creates and wires together these three components:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// Create the low-level client
RestClient restClient = RestClient.builder(
    new HttpHost("localhost", 9200)).build();

// Create the transport with a Jackson mapper
ElasticsearchTransport transport = new RestClientTransport(
    restClient, new JacksonJsonpMapper());

// And create the API client
ElasticsearchClient client = new ElasticsearchClient(transport);</pre>
</div>
<p>Authentication is managed by the <a class="xref" href="java-rest-low.html" title="Java Low Level REST Client">Java Low Level REST Client</a>. For further details on
configuring authentication, refer to
<a href="/guide/en/elasticsearch/client/java-api-client/master/_basic_authentication.html" class="ulink" target="_top">its documentation</a>.</p>
<h4><a id="_your_first_request"></a>Your first request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/getting-started/connecting.asciidoc">edit</a></h4>
<p>The code snippet below searches all items from a “product” index whose name
matches “bicycle” and return them as instances of a <code class="literal">Product</code> application class.</p>
<p>It illustrates the use of fluent functional builders to write search queries as
concise DSL-like code. This pattern is explained in more detail in
<a class="xref" href="api-conventions.html" title="API conventions"><em>API conventions</em></a>.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchResponse&lt;Product&gt; search = client.search(s -&gt; s
    .index("products")
    .query(q -&gt; q
        .term(t -&gt; t
            .field("name")
            .value(v -&gt; v.stringValue("bicycle"))
        )),
    Product.class);

for (Hit&lt;Product&gt; hit: search.hits().hits()) {
    processProduct(hit.source());
}</pre>
</div>
<h4><a id="using-a-secure-connection"></a>Using a secure connection<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/getting-started/connecting.asciidoc">edit</a></h4>
<p>The <a class="xref" href="java-rest-low.html" title="Java Low Level REST Client">Java Low Level REST Client</a> documentation explains how to set up encrypted communications in detail.</p>
<p>In self-managed installations, Elasticsearch will start with security features like authentication and TLS enabled. To connect to the Elasticsearch cluster you’ll need to configure the Java API Client to use HTTPS with the generated CA certificate in order to make requests successfully.</p>
<p>When you start Elasticsearch for the first time you’ll see a distinct block like the one below in the output from Elasticsearch (you may have to scroll up if it’s been a while):</p>
<div class="pre_wrapper lang-xml">
<pre class="programlisting prettyprint lang-xml">-&gt; Elasticsearch security features have been automatically configured!
-&gt; Authentication is enabled and cluster connections are encrypted.

-&gt;  Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):
  lhQpLELkjkrawaBoaz0Q

-&gt;  HTTP CA certificate SHA-256 fingerprint:
  a52dd93511e8c6045e21f16654b77c9ee0f34aea26d9f40320b531c474676228
...</pre>
</div>
<p>Note down the elastic user password and HTTP CA fingerprint for the next sections. In the examples below they will be stored in the variables <code class="literal">password</code> and <code class="literal">fingerprint</code> respectively.</p>
<p>Depending on the context, you have two options for verifying the HTTPS connection: either verifying with the CA certificate itself or using the CA certificate fingerprint. For both cases, the Java API Client&#8217;s <code class="literal">TransportUtils</code> class provides convenience methods to easily create an <code class="literal">SSLContext</code>.</p>
<h5><a id="_verifying_https_with_a_certificate_fingerprint"></a>Verifying HTTPS with a certificate fingerprint<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/getting-started/connecting.asciidoc">edit</a></h5>
<p>This method of verifying the HTTPS connection uses the certificate fingerprint value noted down earlier.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String fingerprint = "&lt;certificate fingerprint&gt;";

SSLContext sslContext = TransportUtils
    .sslContextFromCaFingerprint(fingerprint); <a id="CO1-1"></a><i class="conum" data-value="1"></i>

BasicCredentialsProvider credsProv = new BasicCredentialsProvider(); <a id="CO1-2"></a><i class="conum" data-value="2"></i>
credsProv.setCredentials(
    AuthScope.ANY, new UsernamePasswordCredentials(login, password)
);

RestClient restClient = RestClient
    .builder(new HttpHost(host, port, "https")) <a id="CO1-3"></a><i class="conum" data-value="3"></i>
    .setHttpClientConfigCallback(hc -&gt; hc
        .setSSLContext(sslContext) <a id="CO1-4"></a><i class="conum" data-value="4"></i>
        .setDefaultCredentialsProvider(credsProv)
    )
    .build();

// Create the transport and the API client
ElasticsearchTransport transport = new RestClientTransport(restClient, new JacksonJsonpMapper());
ElasticsearchClient client = new ElasticsearchClient(transport);</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create an <code class="literal">SSLContext</code> with the certificate fingerprint.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set up authentication.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Do not forget to set the protocol to <code class="literal">https</code>!</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Configure the http client with the SSL and authentication configurations.</p>
</td>
</tr>
</table>
</div>
<p>Note that the certificate fingerprint can also be calculated using <code class="literal">openssl x509</code> with the certificate file:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">openssl x509 -fingerprint -sha256 -noout -in /path/to/http_ca.crt</pre>
</div>
<p>If you don’t have access to the generated CA file from Elasticsearch you can use the following script to output the root CA fingerprint of the Elasticsearch instance with <code class="literal">openssl s_client</code>:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">openssl s_client -connect localhost:9200 -servername localhost -showcerts &lt;/dev/null 2&gt;/dev/null \
  | openssl x509 -fingerprint -sha256 -noout -in /dev/stdin</pre>
</div>
<h5><a id="_verifying_https_with_a_ca_certificate"></a>Verifying HTTPS with a CA certificate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/getting-started/connecting.asciidoc">edit</a></h5>
<p>The generated root CA certificate can be found in the <code class="literal">certs</code> directory in your Elasticsearch config location. If you’re running Elasticsearch in Docker there is <a href="/guide/en/elasticsearch/reference/master/docker.html" class="ulink" target="_top">additional documentation</a> for retrieving the CA certificate.</p>
<p>Once you have made the <code class="literal">http_ca.crt</code> file available to your application, you can use it to set up the client:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">File certFile = new File("/path/to/http_ca.crt");

SSLContext sslContext = TransportUtils
    .sslContextFromHttpCaCrt(certFile); <a id="CO2-1"></a><i class="conum" data-value="1"></i>

BasicCredentialsProvider credsProv = new BasicCredentialsProvider(); <a id="CO2-2"></a><i class="conum" data-value="2"></i>
credsProv.setCredentials(
    AuthScope.ANY, new UsernamePasswordCredentials(login, password)
);

RestClient restClient = RestClient
    .builder(new HttpHost(host, port, "https")) <a id="CO2-3"></a><i class="conum" data-value="3"></i>
    .setHttpClientConfigCallback(hc -&gt; hc
        .setSSLContext(sslContext) <a id="CO2-4"></a><i class="conum" data-value="4"></i>
        .setDefaultCredentialsProvider(credsProv)
    )
    .build();

// Create the transport and the API client
ElasticsearchTransport transport = new RestClientTransport(restClient, new JacksonJsonpMapper());
ElasticsearchClient client = new ElasticsearchClient(transport);</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO2-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create an <code class="literal">SSLContext</code> with the <code class="literal">http_ca.crt</code> file.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO2-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set up authentication.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO2-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Do not forget to set the protocol to <code class="literal">https</code>!</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO2-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Configure the http client with the SSL and authentication configurations.</p>
</td>
</tr>
</table>
</div>
<p>The source code for the examples above can be found in the <a href="https://github.com/elastic/elasticsearch-java/tree/master/java-client/src/test/java/co/elastic/clients/documentation" class="ulink" target="_top">Java API Client tests</a>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="installation.html">« Installation</a>
</span>
<span class="next">
<a href="migrate-hlrc.html">Migrating from the High Level Rest Client »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
