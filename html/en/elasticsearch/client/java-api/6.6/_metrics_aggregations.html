<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Metrics aggregations | Java API [6.6] | Elastic</title>
<link rel="home" href="index.html" title="Java API [6.6]"/>
<link rel="up" href="java-aggs.html" title="Aggregations"/>
<link rel="prev" href="_structuring_aggregations.html" title="Structuring aggregations"/>
<link rel="next" href="_bucket_aggregations.html" title="Bucket aggregations"/>
<meta name="DC.type" content="Learn/Docs/Clients/Java/6.6"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="6.6"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Java API [6.6]</a></span>
»
<span class="breadcrumb-link"><a href="java-aggs.html">Aggregations</a></span>
»
<span class="breadcrumb-node">Metrics aggregations</span>
</div>
<div class="navheader">
<span class="prev">
<a href="_structuring_aggregations.html">« Structuring aggregations</a>
</span>
<span class="next">
<a href="_bucket_aggregations.html">Bucket aggregations »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_metrics_aggregations"></a>Metrics aggregations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggs.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-min"></a>Min Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/min-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-min-aggregation.html" class="ulink" target="_top">Min Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/min-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">MinAggregationBuilder aggregation =
        AggregationBuilders
                .min("agg")
                .field("height");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/min-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.min.Min;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Min agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-max"></a>Max Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/max-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-max-aggregation.html" class="ulink" target="_top">Max Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_2"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/max-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">MaxAggregationBuilder aggregation =
        AggregationBuilders
                .max("agg")
                .field("height");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_2"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/max-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.max.Max;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Max agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-sum"></a>Sum Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-sum-aggregation.html" class="ulink" target="_top">Sum Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_3"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SumAggregationBuilder aggregation =
        AggregationBuilders
                .sum("agg")
                .field("height");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_3"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.sum.Sum;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Sum agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-avg"></a>Avg Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-avg-aggregation.html" class="ulink" target="_top">Avg Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_4"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">AvgAggregationBuilder aggregation =
        AggregationBuilders
                .avg("agg")
                .field("height");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_4"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.avg.Avg;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Avg agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-stats"></a>Stats Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-stats-aggregation.html" class="ulink" target="_top">Stats Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_5"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">StatsAggregationBuilder aggregation =
        AggregationBuilders
                .stats("agg")
                .field("height");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_5"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.stats.Stats;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Stats agg = sr.getAggregations().get("agg");
double min = agg.getMin();
double max = agg.getMax();
double avg = agg.getAvg();
double sum = agg.getSum();
long count = agg.getCount();</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-extendedstats"></a>Extended Stats Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-extendedstats-aggregation.html" class="ulink" target="_top">Extended Stats Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_6"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">ExtendedStatsAggregationBuilder aggregation =
        AggregationBuilders
                .extendedStats("agg")
                .field("height");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_6"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.stats.extended.ExtendedStats;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
ExtendedStats agg = sr.getAggregations().get("agg");
double min = agg.getMin();
double max = agg.getMax();
double avg = agg.getAvg();
double sum = agg.getSum();
long count = agg.getCount();
double stdDeviation = agg.getStdDeviation();
double sumOfSquares = agg.getSumOfSquares();
double variance = agg.getVariance();</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-valuecount"></a>Value Count Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-valuecount-aggregation.html" class="ulink" target="_top">Value Count Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_7"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">ValueCountAggregationBuilder aggregation =
        AggregationBuilders
                .count("agg")
                .field("height");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_7"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.valuecount.ValueCount;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
ValueCount agg = sr.getAggregations().get("agg");
long value = agg.getValue();</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-percentile"></a>Percentile Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-percentile-aggregation.html" class="ulink" target="_top">Percentile Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_8"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">PercentilesAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles("agg")
                .field("height");</pre>
</div>
<p>You can provide your own percentiles instead of using defaults:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">PercentilesAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles("agg")
                .field("height")
                .percentiles(1.0, 5.0, 10.0, 20.0, 30.0, 75.0, 95.0, 99.0);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_8"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.percentiles.Percentile;
import org.elasticsearch.search.aggregations.metrics.percentiles.Percentiles;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Percentiles agg = sr.getAggregations().get("agg");
// For each entry
for (Percentile entry : agg) {
    double percent = entry.getPercent();    // Percent
    double value = entry.getValue();        // Value

    logger.info("percent [{}], value [{}]", percent, value);
}</pre>
</div>
<p>This will basically produce for the first example:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">percent [1.0], value [0.814338896154595]
percent [5.0], value [0.8761912455821302]
percent [25.0], value [1.173346540141847]
percent [50.0], value [1.5432023318692198]
percent [75.0], value [1.923915462033674]
percent [95.0], value [2.2273644908535335]
percent [99.0], value [2.284989339108279]</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-percentile-rank"></a>Percentile Ranks Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-percentile-rank-aggregation.html" class="ulink" target="_top">Percentile Ranks Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_9"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">PercentileRanksAggregationBuilder aggregation =
        AggregationBuilders
                .percentileRanks("agg")
                .field("height")
                .values(1.24, 1.91, 2.22);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_9"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.percentiles.Percentile;
import org.elasticsearch.search.aggregations.metrics.percentiles.PercentileRanks;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
PercentileRanks agg = sr.getAggregations().get("agg");
// For each entry
for (Percentile entry : agg) {
    double percent = entry.getPercent();    // Percent
    double value = entry.getValue();        // Value

    logger.info("percent [{}], value [{}]", percent, value);
}</pre>
</div>
<p>This will basically produce:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">percent [29.664353095090945], value [1.24]
percent [73.9335313461868], value [1.91]
percent [94.40095147327283], value [2.22]</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-cardinality"></a>Cardinality Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-cardinality-aggregation.html" class="ulink" target="_top">Cardinality Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_10"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">CardinalityAggregationBuilder aggregation =
        AggregationBuilders
                .cardinality("agg")
                .field("tags");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_10"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.cardinality.Cardinality;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Cardinality agg = sr.getAggregations().get("agg");
long value = agg.getValue();</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-geobounds"></a>Geo Bounds Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-geobounds-aggregation.html" class="ulink" target="_top">Geo Bounds Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_11"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">GeoBoundsBuilder aggregation =
        GeoBoundsAggregationBuilder
                .geoBounds("agg")
                .field("address.location")
                .wrapLongitude(true);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_11"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.geobounds.GeoBounds;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
GeoBounds agg = sr.getAggregations().get("agg");
GeoPoint bottomRight = agg.bottomRight();
GeoPoint topLeft = agg.topLeft();
logger.info("bottomRight {}, topLeft {}", bottomRight, topLeft);</pre>
</div>
<p>This will basically produce:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">bottomRight [40.70500764381921, 13.952946866893775], topLeft [53.49603022435221, -4.190029308156676]</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-tophits"></a>Top Hits Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-top-hits-aggregation.html" class="ulink" target="_top">Top Hits Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_12"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms("agg").field("gender")
        .subAggregation(
            AggregationBuilders.topHits("top")
        );</pre>
</div>
<p>You can use most of the options available for standard search such as <code class="literal">from</code>, <code class="literal">size</code>, <code class="literal">sort</code>, <code class="literal">highlight</code>, <code class="literal">explain</code>&#8230;&#8203;</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms("agg").field("gender")
        .subAggregation(
            AggregationBuilders.topHits("top")
                .explain(true)
                .size(1)
                .from(10)
        );</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_12"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;
import org.elasticsearch.search.aggregations.metrics.tophits.TopHits;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Terms agg = sr.getAggregations().get("agg");

// For each entry
for (Terms.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // bucket key
    long docCount = entry.getDocCount();            // Doc count
    logger.info("key [{}], doc_count [{}]", key, docCount);

    // We ask for top_hits for each bucket
    TopHits topHits = entry.getAggregations().get("top");
    for (SearchHit hit : topHits.getHits().getHits()) {
        logger.info(" -&gt; id [{}], _source [{}]", hit.getId(), hit.getSourceAsString());
    }
}</pre>
</div>
<p>This will basically produce for the first example:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">key [male], doc_count [5107]
 -&gt; id [AUnzSZze9k7PKXtq04x2], _source [{"gender":"male",...}]
 -&gt; id [AUnzSZzj9k7PKXtq04x4], _source [{"gender":"male",...}]
 -&gt; id [AUnzSZzl9k7PKXtq04x5], _source [{"gender":"male",...}]
key [female], doc_count [4893]
 -&gt; id [AUnzSZzM9k7PKXtq04xy], _source [{"gender":"female",...}]
 -&gt; id [AUnzSZzp9k7PKXtq04x8], _source [{"gender":"female",...}]
 -&gt; id [AUnzSZ0W9k7PKXtq04yS], _source [{"gender":"female",...}]</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-aggs-metrics-scripted-metric"></a>Scripted Metric Aggregation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc">edit</a></h3>
</div></div></div>
<p>Here is how you can use
<a href="/guide/en/elasticsearch/reference/6.6/search-aggregations-metrics-scripted-metric-aggregation.html" class="ulink" target="_top">Scripted Metric Aggregation</a>
with Java API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_aggregation_request_13"></a>Prepare aggregation request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Here is an example on how to create the aggregation request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">ScriptedMetricAggregationBuilder aggregation = AggregationBuilders
    .scriptedMetric("agg")
    .initScript(new Script("state.heights = []"))
    .mapScript(new Script("state.heights.add(doc.gender.value == 'male' ? doc.height.value : -1.0 * doc.height.value)"));</pre>
</div>
<p>You can also specify a <code class="literal">combine</code> script which will be executed on each shard:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">ScriptedMetricAggregationBuilder aggregation = AggregationBuilders
    .scriptedMetric("agg")
    .initScript(new Script("state.heights = []"))
    .mapScript(new Script("state.heights.add(doc.gender.value == 'male' ? doc.height.value : -1.0 * doc.height.value)"))
    .combineScript(new Script("double heights_sum = 0.0; for (t in state.heights) { heights_sum += t } return heights_sum"));</pre>
</div>
<p>You can also specify a <code class="literal">reduce</code> script which will be executed on the node which gets the request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">ScriptedMetricAggregationBuilder aggregation = AggregationBuilders
    .scriptedMetric("agg")
    .initScript(new Script("state.heights = []"))
    .mapScript(new Script("state.heights.add(doc.gender.value == 'male' ? doc.height.value : -1.0 * doc.height.value)"))
    .combineScript(new Script("double heights_sum = 0.0; for (t in state.heights) { heights_sum += t } return heights_sum"))
    .reduceScript(new Script("double heights_sum = 0.0; for (a in states) { heights_sum += a } return heights_sum"));</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_use_aggregation_response_13"></a>Use aggregation response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.6/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc">edit</a></h4>
</div></div></div>
<p>Import Aggregation definition classes:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;
import org.elasticsearch.search.aggregations.metrics.tophits.TopHits;</pre>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
ScriptedMetric agg = sr.getAggregations().get("agg");
Object scriptedResult = agg.aggregation();
logger.info("scriptedResult [{}]", scriptedResult);</pre>
</div>
<p>Note that the result depends on the script you built.
For the first example, this will basically produce:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">scriptedResult object [ArrayList]
scriptedResult [ {
"heights" : [ 1.122218480146643, -1.8148918111233887, -1.7626731575142909, ... ]
}, {
"heights" : [ -0.8046067304119863, -2.0785486707864553, -1.9183567430207953, ... ]
}, {
"heights" : [ 2.092635728868694, 1.5697545960886536, 1.8826954461968808, ... ]
}, {
"heights" : [ -2.1863201099468403, 1.6328549117346856, -1.7078288405893842, ... ]
}, {
"heights" : [ 1.6043904836424177, -2.0736538674414025, 0.9898266674373053, ... ]
} ]</pre>
</div>
<p>The second example will produce:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">scriptedResult object [ArrayList]
scriptedResult [-41.279615707402876,
                -60.88007362339038,
                38.823270659734256,
                14.840192739445632,
                11.300902755741326]</pre>
</div>
<p>The last example will produce:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">scriptedResult object [Double]
scriptedResult [2.171917696507009]</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="_structuring_aggregations.html">« Structuring aggregations</a>
</span>
<span class="next">
<a href="_bucket_aggregations.html">Bucket aggregations »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
