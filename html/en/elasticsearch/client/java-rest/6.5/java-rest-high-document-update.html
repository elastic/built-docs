<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Update API | Java REST Client [6.5] | Elastic</title>
<link rel="home" href="index.html" title="Java REST Client [6.5]"/>
<link rel="up" href="java-rest-high-supported-apis.html" title="Document APIs"/>
<link rel="prev" href="java-rest-high-document-delete.html" title="Delete API"/>
<link rel="next" href="java-rest-high-document-bulk.html" title="Bulk API"/>
<meta name="DC.type" content="Learn/Docs/Clients/JavaREST/6.5"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="6.5"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Java REST Client [6.5]</a></span>
»
<span class="breadcrumb-link"><a href="java-rest-high.html">Java High Level REST Client</a></span>
»
<span class="breadcrumb-link"><a href="java-rest-high-supported-apis.html">Document APIs</a></span>
»
<span class="breadcrumb-node">Update API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="java-rest-high-document-delete.html">« Delete API</a>
</span>
<span class="next">
<a href="java-rest-high-document-bulk.html">Bulk API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="java-rest-high-document-update"></a>Update API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/document/update.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-document-update-request"></a>Update Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/document/update.asciidoc">edit</a></h3>
</div></div></div>
<p>An <code class="literal">UpdateRequest</code> requires the following arguments:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">UpdateRequest request = new UpdateRequest(
        "posts", <a id="CO65-1"></a><i class="conum" data-value="1"></i>
        "doc",  <a id="CO65-2"></a><i class="conum" data-value="2"></i>
        "1");   <a id="CO65-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO65-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Index</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO65-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Type</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO65-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Document id</p>
</td>
</tr>
</table>
</div>
<p>The Update API allows to update an existing document by using a script
or by passing a partial document.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_updates_with_a_script"></a>Updates with a script<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/document/update.asciidoc">edit</a></h3>
</div></div></div>
<p>The script can be provided as an inline script:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Map&lt;String, Object&gt; parameters = singletonMap("count", 4); <a id="CO66-1"></a><i class="conum" data-value="1"></i>

Script inline = new Script(ScriptType.INLINE, "painless",
        "ctx._source.field += params.count", parameters);  <a id="CO66-2"></a><i class="conum" data-value="2"></i>
request.script(inline);  <a id="CO66-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO66-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Script parameters provided as a <code class="literal">Map</code> of objects</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO66-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create an inline script using the <code class="literal">painless</code> language and the previous parameters</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO66-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Sets the script to the update request</p>
</td>
</tr>
</table>
</div>
<p>Or as a stored script:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Script stored = new Script(
        ScriptType.STORED, null, "increment-field", parameters);  <a id="CO67-1"></a><i class="conum" data-value="1"></i>
request.script(stored);  <a id="CO67-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO67-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Reference to a script stored under the name <code class="literal">increment-field</code> in the <code class="literal">painless</code> language</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO67-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Sets the script in the update request</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_updates_with_a_partial_document"></a>Updates with a partial document<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/document/update.asciidoc">edit</a></h3>
</div></div></div>
<p>When using updates with a partial document, the partial document will be merged with the
existing document.</p>
<p>The partial document can be provided in different ways:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">UpdateRequest request = new UpdateRequest("posts", "doc", "1");
String jsonString = "{" +
        "\"updated\":\"2017-01-01\"," +
        "\"reason\":\"daily update\"" +
        "}";
request.doc(jsonString, XContentType.JSON); <a id="CO68-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO68-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Partial document source provided as a <code class="literal">String</code> in JSON format</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Map&lt;String, Object&gt; jsonMap = new HashMap&lt;&gt;();
jsonMap.put("updated", new Date());
jsonMap.put("reason", "daily update");
UpdateRequest request = new UpdateRequest("posts", "doc", "1")
        .doc(jsonMap); <a id="CO69-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO69-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Partial document source provided as a <code class="literal">Map</code> which gets automatically converted
to JSON format</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">XContentBuilder builder = XContentFactory.jsonBuilder();
builder.startObject();
{
    builder.timeField("updated", new Date());
    builder.field("reason", "daily update");
}
builder.endObject();
UpdateRequest request = new UpdateRequest("posts", "doc", "1")
        .doc(builder);  <a id="CO70-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO70-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Partial document source provided as an <code class="literal">XContentBuilder</code> object, the Elasticsearch
built-in helpers to generate JSON content</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">UpdateRequest request = new UpdateRequest("posts", "doc", "1")
        .doc("updated", new Date(),
             "reason", "daily update"); <a id="CO71-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO71-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Partial document source provided as <code class="literal">Object</code> key-pairs, which gets converted to
JSON format</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_upserts"></a>Upserts<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/document/update.asciidoc">edit</a></h3>
</div></div></div>
<p>If the document does not already exist, it is possible to define some content that
will be inserted as a new document using the <code class="literal">upsert</code> method:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String jsonString = "{\"created\":\"2017-01-01\"}";
request.upsert(jsonString, XContentType.JSON);  <a id="CO72-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO72-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Upsert document source provided as a <code class="literal">String</code></p>
</td>
</tr>
</table>
</div>
<p>Similarly to the partial document updates, the content of the <code class="literal">upsert</code> document
can be defined using methods that accept <code class="literal">String</code>, <code class="literal">Map</code>, <code class="literal">XContentBuilder</code> or
<code class="literal">Object</code> key-pairs.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_optional_arguments_3"></a>Optional arguments<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/document/update.asciidoc">edit</a></h3>
</div></div></div>
<p>The following arguments can optionally be provided:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.routing("routing"); <a id="CO73-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO73-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Routing value</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.parent("parent"); <a id="CO74-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO74-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Parent value</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.timeout(TimeValue.timeValueSeconds(1)); <a id="CO75-1"></a><i class="conum" data-value="1"></i>
request.timeout("1s"); <a id="CO75-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO75-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Timeout to wait for primary shard to become available as a <code class="literal">TimeValue</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO75-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Timeout to wait for primary shard to become available as a <code class="literal">String</code></p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.setRefreshPolicy(WriteRequest.RefreshPolicy.WAIT_UNTIL); <a id="CO76-1"></a><i class="conum" data-value="1"></i>
request.setRefreshPolicy("wait_for");                            <a id="CO76-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO76-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Refresh policy as a <code class="literal">WriteRequest.RefreshPolicy</code> instance</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO76-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Refresh policy as a <code class="literal">String</code></p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.retryOnConflict(3); <a id="CO77-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO77-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>How many times to retry the update operation if the document to update has
been changed by another operation between the get and indexing phases of the
update operation</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.fetchSource(true); <a id="CO78-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO78-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enable source retrieval, disabled by default</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String[] includes = new String[]{"updated", "r*"};
String[] excludes = Strings.EMPTY_ARRAY;
request.fetchSource(
        new FetchSourceContext(true, includes, excludes)); <a id="CO79-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO79-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Configure source inclusion for specific fields</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String[] includes = Strings.EMPTY_ARRAY;
String[] excludes = new String[]{"updated"};
request.fetchSource(
        new FetchSourceContext(true, includes, excludes)); <a id="CO80-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO80-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Configure source exclusion for specific fields</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.version(2); <a id="CO81-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO81-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Version</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.detectNoop(false); <a id="CO82-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO82-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Disable the noop detection</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.scriptedUpsert(true); <a id="CO83-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO83-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Indicate that the script must run regardless of whether the document exists or not,
ie the script takes care of creating the document if it does not already exist.</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.docAsUpsert(true); <a id="CO84-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO84-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Indicate that the partial document must be used as the upsert document if it
does not exist yet.</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">request.waitForActiveShards(2); <a id="CO85-1"></a><i class="conum" data-value="1"></i>
request.waitForActiveShards(ActiveShardCount.ALL); <a id="CO85-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO85-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Sets the number of shard copies that must be active before proceeding with
the update operation.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO85-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Number of shard copies provided as a <code class="literal">ActiveShardCount</code>: can be <code class="literal">ActiveShardCount.ALL</code>,
<code class="literal">ActiveShardCount.ONE</code> or <code class="literal">ActiveShardCount.DEFAULT</code> (default)</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-document-update-sync"></a>Synchronous Execution<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/execution.asciidoc">edit</a></h3>
</div></div></div>
<p>When executing a <code class="literal">UpdateRequest</code> in the following manner, the client waits
for the <code class="literal">UpdateResponse</code> to be returned before continuing with code execution:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">UpdateResponse updateResponse = client.update(
        request, RequestOptions.DEFAULT);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-document-update-async"></a>Asynchronous Execution<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/execution.asciidoc">edit</a></h3>
</div></div></div>
<p>Executing a <code class="literal">UpdateRequest</code> can also be done in an asynchronous fashion so that
the client can return directly. Users need to specify how the response or
potential failures will be handled by passing the request and a listener to the
asynchronous update method:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">client.updateAsync(request, RequestOptions.DEFAULT, listener); <a id="CO86-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO86-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">UpdateRequest</code> to execute and the <code class="literal">ActionListener</code> to use when
the execution completes</p>
</td>
</tr>
</table>
</div>
<p>The asynchronous method does not block and returns immediately. Once it is
completed the <code class="literal">ActionListener</code> is called back using the <code class="literal">onResponse</code> method
if the execution successfully completed or using the <code class="literal">onFailure</code> method if
it failed.</p>
<p>A typical listener for <code class="literal">update</code> looks like:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">listener = new ActionListener&lt;UpdateResponse&gt;() {
    @Override
    public void onResponse(UpdateResponse updateResponse) {
        <a id="CO87-1"></a><i class="conum" data-value="1"></i>
    }

    @Override
    public void onFailure(Exception e) {
        <a id="CO87-2"></a><i class="conum" data-value="2"></i>
    }
};</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO87-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Called when the execution is successfully completed.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO87-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Called when the whole <code class="literal">UpdateRequest</code> fails.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-document-update-response"></a>Update Response<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.5/docs/java-rest/high-level/document/update.asciidoc">edit</a></h3>
</div></div></div>
<p>The returned <code class="literal">UpdateResponse</code> allows to retrieve information about the executed
operation as follows:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String index = updateResponse.getIndex();
String type = updateResponse.getType();
String id = updateResponse.getId();
long version = updateResponse.getVersion();
if (updateResponse.getResult() == DocWriteResponse.Result.CREATED) {
    <a id="CO88-1"></a><i class="conum" data-value="1"></i>
} else if (updateResponse.getResult() == DocWriteResponse.Result.UPDATED) {
    <a id="CO88-2"></a><i class="conum" data-value="2"></i>
} else if (updateResponse.getResult() == DocWriteResponse.Result.DELETED) {
    <a id="CO88-3"></a><i class="conum" data-value="3"></i>
} else if (updateResponse.getResult() == DocWriteResponse.Result.NOOP) {
    <a id="CO88-4"></a><i class="conum" data-value="4"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO88-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Handle the case where the document was created for the first time (upsert)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO88-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Handle the case where the document was updated</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO88-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Handle the case where the document was deleted</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO88-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Handle the case where the document was not impacted by the update,
ie no operation (noop) was executed on the document</p>
</td>
</tr>
</table>
</div>
<p>When the source retrieval is enabled in the <code class="literal">UpdateRequest</code>
through the fetchSource method, the response contains the
source of the updated document:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">GetResult result = updateResponse.getGetResult(); <a id="CO89-1"></a><i class="conum" data-value="1"></i>
if (result.isExists()) {
    String sourceAsString = result.sourceAsString(); <a id="CO89-2"></a><i class="conum" data-value="2"></i>
    Map&lt;String, Object&gt; sourceAsMap = result.sourceAsMap(); <a id="CO89-3"></a><i class="conum" data-value="3"></i>
    byte[] sourceAsBytes = result.source(); <a id="CO89-4"></a><i class="conum" data-value="4"></i>
} else {
    <a id="CO89-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO89-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the updated document as a <code class="literal">GetResult</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO89-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the source of the updated document as a <code class="literal">String</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO89-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the source of the updated document as a <code class="literal">Map&lt;String, Object&gt;</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO89-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the source of the updated document as a <code class="literal">byte[]</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO89-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Handle the scenario where the source of the document is not present in
the response (this is the case by default)</p>
</td>
</tr>
</table>
</div>
<p>It is also possible to check for shard failures:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">ReplicationResponse.ShardInfo shardInfo = updateResponse.getShardInfo();
if (shardInfo.getTotal() != shardInfo.getSuccessful()) {
    <a id="CO90-1"></a><i class="conum" data-value="1"></i>
}
if (shardInfo.getFailed() &gt; 0) {
    for (ReplicationResponse.ShardInfo.Failure failure :
            shardInfo.getFailures()) {
        String reason = failure.reason(); <a id="CO90-2"></a><i class="conum" data-value="2"></i>
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO90-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Handle the situation where number of successful shards is less than
total shards</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO90-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Handle the potential failures</p>
</td>
</tr>
</table>
</div>
<p>When a <code class="literal">UpdateRequest</code> is performed against a document that does not exist,
the response has <code class="literal">404</code> status code, an <code class="literal">ElasticsearchException</code> gets thrown
which needs to be handled as follows:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">UpdateRequest request = new UpdateRequest("posts", "type", "does_not_exist")
        .doc("field", "value");
try {
    UpdateResponse updateResponse = client.update(
            request, RequestOptions.DEFAULT);
} catch (ElasticsearchException e) {
    if (e.status() == RestStatus.NOT_FOUND) {
        <a id="CO91-1"></a><i class="conum" data-value="1"></i>
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO91-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Handle the exception thrown because the document not exist</p>
</td>
</tr>
</table>
</div>
<p>If there is a version conflict, an <code class="literal">ElasticsearchException</code> will
be thrown:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">UpdateRequest request = new UpdateRequest("posts", "doc", "1")
        .doc("field", "value")
        .version(1);
try {
    UpdateResponse updateResponse = client.update(
            request, RequestOptions.DEFAULT);
} catch(ElasticsearchException e) {
    if (e.status() == RestStatus.CONFLICT) {
        <a id="CO92-1"></a><i class="conum" data-value="1"></i>
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO92-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The raised exception indicates that a version conflict error was returned.</p>
</td>
</tr>
</table>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="java-rest-high-document-delete.html">« Delete API</a>
</span>
<span class="next">
<a href="java-rest-high-document-bulk.html">Bulk API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
