<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Search API | Java REST Client [7.1] | Elastic</title>
<link rel="home" href="index.html" title="Java REST Client [7.1]"/>
<link rel="up" href="_search_apis.html" title="Search APIs"/>
<link rel="prev" href="_search_apis.html" title="Search APIs"/>
<link rel="next" href="java-rest-high-search-scroll.html" title="Search Scroll API"/>
<meta name="DC.type" content="Learn/Docs/Clients/JavaREST/7.1"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="7.1"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Java REST Client [7.1]</a></span>
»
<span class="breadcrumb-link"><a href="java-rest-high.html">Java High Level REST Client</a></span>
»
<span class="breadcrumb-link"><a href="_search_apis.html">Search APIs</a></span>
»
<span class="breadcrumb-node">Search API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="_search_apis.html">« Search APIs</a>
</span>
<span class="next">
<a href="java-rest-high-search-scroll.html">Search Scroll API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="java-rest-high-search"></a>Search API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-search-request"></a>Search Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">SearchRequest</code> is used for any operation that has to do with searching
documents, aggregations, suggestions and also offers ways of requesting
highlighting on the resulting documents.</p>
<p>In its most basic form, we can add a query to the request:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchRequest searchRequest = new SearchRequest(); <a id="CO182-1"></a><i class="conum" data-value="1"></i>
SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder(); <a id="CO182-2"></a><i class="conum" data-value="2"></i>
searchSourceBuilder.query(QueryBuilders.matchAllQuery()); <a id="CO182-3"></a><i class="conum" data-value="3"></i>
searchRequest.source(searchSourceBuilder); <a id="CO182-4"></a><i class="conum" data-value="4"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO182-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates the <code class="literal">SeachRequest</code>. Without arguments this runs against all indices.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO182-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Most search parameters are added to the <code class="literal">SearchSourceBuilder</code>. It offers setters for everything that goes into the search request body.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO182-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Add a <code class="literal">match_all</code> query to the <code class="literal">SearchSourceBuilder</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO182-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Add the <code class="literal">SearchSourceBuilder</code> to the <code class="literal">SeachRequest</code>.</p>
</td>
</tr>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-request-optional"></a>Optional arguments<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>Let&#8217;s first look at some of the optional arguments of a <code class="literal">SearchRequest</code>:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchRequest searchRequest = new SearchRequest("posts"); <a id="CO183-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO183-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Restricts the request to an index</p>
</td>
</tr>
</table>
</div>
<p>There are a couple of other interesting optional parameters:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">searchRequest.routing("routing"); <a id="CO184-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO184-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set a routing parameter</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">searchRequest.indicesOptions(IndicesOptions.lenientExpandOpen()); <a id="CO185-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO185-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Setting <code class="literal">IndicesOptions</code> controls how unavailable indices are resolved and
how wildcard expressions are expanded</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">searchRequest.preference("_local"); <a id="CO186-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO186-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use the preference parameter e.g. to execute the search to prefer local
shards. The default is to randomize across shards.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_using_the_searchsourcebuilder"></a>Using the SearchSourceBuilder<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>Most options controlling the search behavior can be set on the
<code class="literal">SearchSourceBuilder</code>,
which contains more or less the equivalent of the options in the search request
body of the Rest API.</p>
<p>Here are a few examples of some common options:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchSourceBuilder sourceBuilder = new SearchSourceBuilder(); <a id="CO187-1"></a><i class="conum" data-value="1"></i>
sourceBuilder.query(QueryBuilders.termQuery("user", "kimchy")); <a id="CO187-2"></a><i class="conum" data-value="2"></i>
sourceBuilder.from(0); <a id="CO187-3"></a><i class="conum" data-value="3"></i>
sourceBuilder.size(5); <a id="CO187-4"></a><i class="conum" data-value="4"></i>
sourceBuilder.timeout(new TimeValue(60, TimeUnit.SECONDS)); <a id="CO187-5"></a><i class="conum" data-value="5"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO187-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create a <code class="literal">SearchSourceBuilder</code> with default options.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO187-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set the query. Can be any type of <code class="literal">QueryBuilder</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO187-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set the <code class="literal">from</code> option that determines the result index to start searching
from. Defaults to 0.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO187-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set the <code class="literal">size</code> option that determines the number of search hits to return.
Defaults to 10.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO187-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set an optional timeout that controls how long the search is allowed to
take.</p>
</td>
</tr>
</table>
</div>
<p>After this, the <code class="literal">SearchSourceBuilder</code> only needs to be added to the
<code class="literal">SearchRequest</code>:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchRequest searchRequest = new SearchRequest();
searchRequest.indices("posts");
searchRequest.source(sourceBuilder);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-request-building-queries"></a>Building queries<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>Search queries are created using <code class="literal">QueryBuilder</code> objects. A <code class="literal">QueryBuilder</code> exists
 for every search query type supported by Elasticsearch&#8217;s <a href="/guide/en/elasticsearch/reference/7.1/query-dsl.html" class="ulink" target="_top">Query DSL</a>.</p>
<p>A <code class="literal">QueryBuilder</code> can be created using its constructor:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">MatchQueryBuilder matchQueryBuilder = new MatchQueryBuilder("user", "kimchy"); <a id="CO188-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO188-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create a full text <a href="/guide/en/elasticsearch/reference/7.1/query-dsl-match-query.html" class="ulink" target="_top">Match Query</a> that matches
the text "kimchy" over the field "user".</p>
</td>
</tr>
</table>
</div>
<p>Once created, the <code class="literal">QueryBuilder</code> object provides methods to configure the options
of the search query it creates:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">matchQueryBuilder.fuzziness(Fuzziness.AUTO); <a id="CO189-1"></a><i class="conum" data-value="1"></i>
matchQueryBuilder.prefixLength(3); <a id="CO189-2"></a><i class="conum" data-value="2"></i>
matchQueryBuilder.maxExpansions(10); <a id="CO189-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO189-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enable fuzzy matching on the match query</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO189-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set the prefix length option on the match query</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO189-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set the max expansion options to control the fuzzy
process of the query</p>
</td>
</tr>
</table>
</div>
<p><code class="literal">QueryBuilder</code> objects can also be created using the <code class="literal">QueryBuilders</code> utility class.
This class provides helper methods that can be used to create <code class="literal">QueryBuilder</code> objects
 using a fluent programming style:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">QueryBuilder matchQueryBuilder = QueryBuilders.matchQuery("user", "kimchy")
                                                .fuzziness(Fuzziness.AUTO)
                                                .prefixLength(3)
                                                .maxExpansions(10);</pre>
</div>
<p>Whatever the method used to create it, the <code class="literal">QueryBuilder</code> object must be added
to the <code class="literal">SearchSourceBuilder</code> as follows:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">searchSourceBuilder.query(matchQueryBuilder);</pre>
</div>
<p>The <a class="xref" href="java-rest-high-query-builders.html" title="Building Queries">Building Queries</a> page gives a list of all available search queries with
their corresponding <code class="literal">QueryBuilder</code> objects and <code class="literal">QueryBuilders</code> helper methods.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_specifying_sorting"></a>Specifying Sorting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">SearchSourceBuilder</code> allows to add one or more <code class="literal">SortBuilder</code> instances. There are four special implementations (Field-, Score-, GeoDistance- and ScriptSortBuilder).</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">sourceBuilder.sort(new ScoreSortBuilder().order(SortOrder.DESC)); <a id="CO190-1"></a><i class="conum" data-value="1"></i>
sourceBuilder.sort(new FieldSortBuilder("_id").order(SortOrder.ASC));  <a id="CO190-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO190-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Sort descending by <code class="literal">_score</code> (the default)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO190-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Also sort ascending by <code class="literal">_id</code> field</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_source_filtering"></a>Source filtering<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, search requests return the contents of the document <code class="literal">_source</code> but like in the Rest API you can overwrite this behavior. For example, you can turn off <code class="literal">_source</code> retrieval completely:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">sourceBuilder.fetchSource(false);</pre>
</div>
<p>The method also accepts an array of one or more wildcard patterns to control which fields get included or excluded in a more fine grained way:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String[] includeFields = new String[] {"title", "innerObject.*"};
String[] excludeFields = new String[] {"user"};
sourceBuilder.fetchSource(includeFields, excludeFields);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-request-highlighting"></a>Requesting Highlighting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>Highlighting search results can be achieved by setting a <code class="literal">HighlightBuilder</code> on the
<code class="literal">SearchSourceBuilder</code>. Different highlighting behaviour can be defined for each
fields by adding one or more <code class="literal">HighlightBuilder.Field</code> instances to a <code class="literal">HighlightBuilder</code>.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();
HighlightBuilder highlightBuilder = new HighlightBuilder(); <a id="CO191-1"></a><i class="conum" data-value="1"></i>
HighlightBuilder.Field highlightTitle =
        new HighlightBuilder.Field("title"); <a id="CO191-2"></a><i class="conum" data-value="2"></i>
highlightTitle.highlighterType("unified");  <a id="CO191-3"></a><i class="conum" data-value="3"></i>
highlightBuilder.field(highlightTitle);  <a id="CO191-4"></a><i class="conum" data-value="4"></i>
HighlightBuilder.Field highlightUser = new HighlightBuilder.Field("user");
highlightBuilder.field(highlightUser);
searchSourceBuilder.highlighter(highlightBuilder);</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO191-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates a new <code class="literal">HighlightBuilder</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO191-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create a field highlighter for the <code class="literal">title</code> field</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO191-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set the field highlighter type</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO191-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Add the field highlighter to the highlight builder</p>
</td>
</tr>
</table>
</div>
<p>There are many options which are explained in detail in the Rest API documentation. The Rest
API parameters (e.g. <code class="literal">pre_tags</code>) are usually changed by
setters with a similar name (e.g. <code class="literal">#preTags(String ...)</code>).</p>
<p>Highlighted text fragments can <a class="xref" href="java-rest-high-search.html#java-rest-high-search-response-highlighting" title="Retrieving Highlighting">later be retrieved</a> from the <code class="literal">SearchResponse</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-request-building-aggs"></a>Requesting Aggregations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>Aggregations can be added to the search by first creating the appropriate
<code class="literal">AggregationBuilder</code> and then setting it on the <code class="literal">SearchSourceBuilder</code>. In the
following example we create a <code class="literal">terms</code> aggregation on company names with a
sub-aggregation on the average age of employees in the company:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();
TermsAggregationBuilder aggregation = AggregationBuilders.terms("by_company")
        .field("company.keyword");
aggregation.subAggregation(AggregationBuilders.avg("average_age")
        .field("age"));
searchSourceBuilder.aggregation(aggregation);</pre>
</div>
<p>The <a class="xref" href="java-rest-high-aggregation-builders.html" title="Building Aggregations">Building Aggregations</a> page gives a list of all available aggregations with
their corresponding <code class="literal">AggregationBuilder</code> objects and <code class="literal">AggregationBuilders</code> helper methods.</p>
<p>We will later see how to <a class="xref" href="java-rest-high-search.html#java-rest-high-search-response-aggs" title="Retrieving Aggregations">access aggregations</a> in the <code class="literal">SearchResponse</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_requesting_suggestions"></a>Requesting Suggestions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>To add Suggestions to the search request, use one of the <code class="literal">SuggestionBuilder</code> implementations
that are easily accessible from the <code class="literal">SuggestBuilders</code> factory class. Suggestion builders
need to be added to the top level <code class="literal">SuggestBuilder</code>, which itself can be set on the  <code class="literal">SearchSourceBuilder</code>.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();
SuggestionBuilder termSuggestionBuilder =
    SuggestBuilders.termSuggestion("user").text("kmichy"); <a id="CO192-1"></a><i class="conum" data-value="1"></i>
SuggestBuilder suggestBuilder = new SuggestBuilder();
suggestBuilder.addSuggestion("suggest_user", termSuggestionBuilder); <a id="CO192-2"></a><i class="conum" data-value="2"></i>
searchSourceBuilder.suggest(suggestBuilder);</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO192-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates a new <code class="literal">TermSuggestionBuilder</code> for the <code class="literal">user</code> field and
the text <code class="literal">kmichy</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO192-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds the suggestion builder and names it <code class="literal">suggest_user</code></p>
</td>
</tr>
</table>
</div>
<p>We will later see how to <a class="xref" href="java-rest-high-search.html#java-rest-high-search-response-suggestions" title="Retrieving Suggestions">retrieve suggestions</a> from the
<code class="literal">SearchResponse</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_profiling_queries_and_aggregations"></a>Profiling Queries and Aggregations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>The <a href="/guide/en/elasticsearch/reference/7.1/search-profile.html" class="ulink" target="_top">Profile API</a> can be used to profile the execution of queries and aggregations for
a specific search request. in order to use it, the profile flag must be set to true on the <code class="literal">SearchSourceBuilder</code>:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();
searchSourceBuilder.profile(true);</pre>
</div>
<p>Once the <code class="literal">SearchRequest</code> is executed the corresponding <code class="literal">SearchResponse</code> will
<a class="xref" href="java-rest-high-search.html#java-rest-high-search-response-profile" title="Retrieving Profiling Results">contain the profiling results</a>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-search-sync"></a>Synchronous Execution<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/execution.asciidoc">edit</a></h3>
</div></div></div>
<p>When executing a <code class="literal">SearchRequest</code> in the following manner, the client waits
for the <code class="literal">SearchResponse</code> to be returned before continuing with code execution:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);</pre>
</div>
<p>Synchronous calls may throw an <code class="literal">IOException</code> in case of either failing to
parse the REST response in the high-level REST client, the request times out
or similar cases where there is no response coming back from the server.</p>
<p>In cases where the server returns a <code class="literal">4xx</code> or <code class="literal">5xx</code> error code, the high-level
client tries to parse the response body error details instead and then throws
a generic <code class="literal">ElasticsearchException</code> and adds the original <code class="literal">ResponseException</code> as a
suppressed exception to it.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-search-async"></a>Asynchronous Execution<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/execution.asciidoc">edit</a></h3>
</div></div></div>
<p>Executing a <code class="literal">SearchRequest</code> can also be done in an asynchronous fashion so that
the client can return directly. Users need to specify how the response or
potential failures will be handled by passing the request and a listener to the
asynchronous search method:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">client.searchAsync(searchRequest, RequestOptions.DEFAULT, listener); <a id="CO193-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO193-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">SearchRequest</code> to execute and the <code class="literal">ActionListener</code> to use when
the execution completes</p>
</td>
</tr>
</table>
</div>
<p>The asynchronous method does not block and returns immediately. Once it is
completed the <code class="literal">ActionListener</code> is called back using the <code class="literal">onResponse</code> method
if the execution successfully completed or using the <code class="literal">onFailure</code> method if
it failed. Failure scenarios and expected exceptions are the same as in the
synchronous execution case.</p>
<p>A typical listener for <code class="literal">search</code> looks like:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">ActionListener&lt;SearchResponse&gt; listener = new ActionListener&lt;SearchResponse&gt;() {
    @Override
    public void onResponse(SearchResponse searchResponse) {
        <a id="CO194-1"></a><i class="conum" data-value="1"></i>
    }

    @Override
    public void onFailure(Exception e) {
        <a id="CO194-2"></a><i class="conum" data-value="2"></i>
    }
};</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO194-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Called when the execution is successfully completed.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO194-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Called when the whole <code class="literal">SearchRequest</code> fails.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-search-response"></a>SearchResponse<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">SearchResponse</code> that is returned by executing the search provides details
about the search execution itself as well as access to the documents returned.
First, there is useful information about the request execution itself, like the
HTTP status code, execution time or whether the request terminated early or timed
out:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">RestStatus status = searchResponse.status();
TimeValue took = searchResponse.getTook();
Boolean terminatedEarly = searchResponse.isTerminatedEarly();
boolean timedOut = searchResponse.isTimedOut();</pre>
</div>
<p>Second, the response also provides information about the execution on the
shard level by offering statistics about the total number of shards that were
affected by the search, and the successful vs. unsuccessful shards. Possible
failures can also be handled by iterating over an array off
<code class="literal">ShardSearchFailures</code> like in the following example:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">int totalShards = searchResponse.getTotalShards();
int successfulShards = searchResponse.getSuccessfulShards();
int failedShards = searchResponse.getFailedShards();
for (ShardSearchFailure failure : searchResponse.getShardFailures()) {
    // failures should be handled here
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-response-search-hits"></a>Retrieving SearchHits<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>To get access to the returned documents, we need to first get the <code class="literal">SearchHits</code>
contained in the response:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchHits hits = searchResponse.getHits();</pre>
</div>
<p>The <code class="literal">SearchHits</code> provides global information about all hits, like total number
of hits or the maximum score:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">TotalHits totalHits = hits.getTotalHits();
// the total number of hits, must be interpreted in the context of totalHits.relation
long numHits = totalHits.value;
// whether the number of hits is accurate (EQUAL_TO) or a lower bound of the total (GREATER_THAN_OR_EQUAL_TO)
TotalHits.Relation relation = totalHits.relation;
float maxScore = hits.getMaxScore();</pre>
</div>
<p>Nested inside the <code class="literal">SearchHits</code> are the individual search results that can
be iterated over:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchHit[] searchHits = hits.getHits();
for (SearchHit hit : searchHits) {
    // do something with the SearchHit
}</pre>
</div>
<p>The <code class="literal">SearchHit</code> provides access to basic information like index, document ID
and score of each search hit:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String index = hit.getIndex();
String id = hit.getId();
float score = hit.getScore();</pre>
</div>
<p>Furthermore, it lets you get back the document source, either as a simple
JSON-String or as a map of key/value pairs. In this map, regular fields
are keyed by the field name and contain the field value. Multi-valued fields are
returned as lists of objects, nested objects as another key/value map. These
cases need to be cast accordingly:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String sourceAsString = hit.getSourceAsString();
Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
String documentTitle = (String) sourceAsMap.get("title");
List&lt;Object&gt; users = (List&lt;Object&gt;) sourceAsMap.get("user");
Map&lt;String, Object&gt; innerObject =
        (Map&lt;String, Object&gt;) sourceAsMap.get("innerObject");</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-response-highlighting"></a>Retrieving Highlighting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>If <a class="xref" href="java-rest-high-search.html#java-rest-high-search-request-highlighting" title="Requesting Highlighting">requested</a>, highlighted text fragments can be retrieved from each <code class="literal">SearchHit</code> in the result. The hit object offers
access to a map of field names to <code class="literal">HighlightField</code> instances, each of which contains one
or many highlighted text fragments:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">SearchHits hits = searchResponse.getHits();
for (SearchHit hit : hits.getHits()) {
    Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();
    HighlightField highlight = highlightFields.get("title"); <a id="CO195-1"></a><i class="conum" data-value="1"></i>
    Text[] fragments = highlight.fragments();  <a id="CO195-2"></a><i class="conum" data-value="2"></i>
    String fragmentString = fragments[0].string();
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO195-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Get the highlighting for the <code class="literal">title</code> field</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO195-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Get one or many fragments containing the highlighted field content</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-response-aggs"></a>Retrieving Aggregations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>Aggregations can be retrieved from the <code class="literal">SearchResponse</code> by first getting the
root of the aggregation tree, the <code class="literal">Aggregations</code> object, and then getting the
aggregation by name.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Aggregations aggregations = searchResponse.getAggregations();
Terms byCompanyAggregation = aggregations.get("by_company"); <a id="CO196-1"></a><i class="conum" data-value="1"></i>
Bucket elasticBucket = byCompanyAggregation.getBucketByKey("Elastic"); <a id="CO196-2"></a><i class="conum" data-value="2"></i>
Avg averageAge = elasticBucket.getAggregations().get("average_age"); <a id="CO196-3"></a><i class="conum" data-value="3"></i>
double avg = averageAge.getValue();</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Get the <code class="literal">by_company</code> terms aggregation</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Get the buckets that is keyed with <code class="literal">Elastic</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Get the <code class="literal">average_age</code> sub-aggregation from that bucket</p>
</td>
</tr>
</table>
</div>
<p>Note that if you access aggregations by name, you need to specify the
aggregation interface according to the type of aggregation you requested,
otherwise a <code class="literal">ClassCastException</code> will be thrown:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Range range = aggregations.get("by_company"); <a id="CO197-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO197-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This will throw an exception because "by_company" is a <code class="literal">terms</code> aggregation
but we try to retrieve it as a <code class="literal">range</code> aggregation</p>
</td>
</tr>
</table>
</div>
<p>It is also possible to access all aggregations as a map that is keyed by the
aggregation name. In this case, the cast to the proper aggregation interface
needs to happen explicitly:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Map&lt;String, Aggregation&gt; aggregationMap = aggregations.getAsMap();
Terms companyAggregation = (Terms) aggregationMap.get("by_company");</pre>
</div>
<p>There are also getters that return all top level aggregations as a list:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">List&lt;Aggregation&gt; aggregationList = aggregations.asList();</pre>
</div>
<p>And last but not least you can iterate over all aggregations and then e.g.
decide how to further process them based on their type:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">for (Aggregation agg : aggregations) {
    String type = agg.getType();
    if (type.equals(TermsAggregationBuilder.NAME)) {
        Bucket elasticBucket = ((Terms) agg).getBucketByKey("Elastic");
        long numberOfDocs = elasticBucket.getDocCount();
    }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-response-suggestions"></a>Retrieving Suggestions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>To get back the suggestions from a <code class="literal">SearchResponse</code>, use the <code class="literal">Suggest</code> object as an entry point and then retrieve the nested suggestion objects:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Suggest suggest = searchResponse.getSuggest(); <a id="CO198-1"></a><i class="conum" data-value="1"></i>
TermSuggestion termSuggestion = suggest.getSuggestion("suggest_user"); <a id="CO198-2"></a><i class="conum" data-value="2"></i>
for (TermSuggestion.Entry entry : termSuggestion.getEntries()) { <a id="CO198-3"></a><i class="conum" data-value="3"></i>
    for (TermSuggestion.Entry.Option option : entry) { <a id="CO198-4"></a><i class="conum" data-value="4"></i>
        String suggestText = option.getText().string();
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO198-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use the <code class="literal">Suggest</code> class to access suggestions</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO198-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Suggestions can be retrieved by name. You need to assign them to the correct
type of Suggestion class (here <code class="literal">TermSuggestion</code>), otherwise a <code class="literal">ClassCastException</code> is thrown</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO198-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Iterate over the suggestion entries</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO198-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Iterate over the options in one entry</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="java-rest-high-search-response-profile"></a>Retrieving Profiling Results<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.1/docs/java-rest/high-level/search/search.asciidoc">edit</a></h4>
</div></div></div>
<p>Profiling results are retrieved from a <code class="literal">SearchResponse</code> using the <code class="literal">getProfileResults()</code> method. This
 method returns a <code class="literal">Map</code> containing a <code class="literal">ProfileShardResult</code> object for every shard involved in the
 <code class="literal">SearchRequest</code> execution. <code class="literal">ProfileShardResult</code> are stored in the <code class="literal">Map</code> using a key that uniquely
 identifies the shard the profile result corresponds to.</p>
<p>Here is a sample code that shows how to iterate over all the profiling results of every shard:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">Map&lt;String, ProfileShardResult&gt; profilingResults =
        searchResponse.getProfileResults(); <a id="CO199-1"></a><i class="conum" data-value="1"></i>
for (Map.Entry&lt;String, ProfileShardResult&gt; profilingResult : profilingResults.entrySet()) { <a id="CO199-2"></a><i class="conum" data-value="2"></i>
    String key = profilingResult.getKey(); <a id="CO199-3"></a><i class="conum" data-value="3"></i>
    ProfileShardResult profileShardResult = profilingResult.getValue(); <a id="CO199-4"></a><i class="conum" data-value="4"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO199-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the <code class="literal">Map</code> of <code class="literal">ProfileShardResult</code> from the <code class="literal">SearchResponse</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO199-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Profiling results can be retrieved by shard&#8217;s key if the key is known, otherwise it might be simpler
to iterate over all the profiling results</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO199-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the key that identifies which shard the <code class="literal">ProfileShardResult</code> belongs to</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO199-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the <code class="literal">ProfileShardResult</code> for the given shard</p>
</td>
</tr>
</table>
</div>
<p>The <code class="literal">ProfileShardResult</code> object itself contains one or more query profile results, one for each query
executed against the underlying Lucene index:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">List&lt;QueryProfileShardResult&gt; queryProfileShardResults =
        profileShardResult.getQueryProfileResults(); <a id="CO200-1"></a><i class="conum" data-value="1"></i>
for (QueryProfileShardResult queryProfileResult : queryProfileShardResults) { <a id="CO200-2"></a><i class="conum" data-value="2"></i>

}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO200-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the list of <code class="literal">QueryProfileShardResult</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO200-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Iterate over each <code class="literal">QueryProfileShardResult</code></p>
</td>
</tr>
</table>
</div>
<p>Each <code class="literal">QueryProfileShardResult</code> gives access to the detailed query tree execution, returned as a list of
<code class="literal">ProfileResult</code> objects:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">for (ProfileResult profileResult : queryProfileResult.getQueryResults()) { <a id="CO201-1"></a><i class="conum" data-value="1"></i>
    String queryName = profileResult.getQueryName(); <a id="CO201-2"></a><i class="conum" data-value="2"></i>
    long queryTimeInMillis = profileResult.getTime(); <a id="CO201-3"></a><i class="conum" data-value="3"></i>
    List&lt;ProfileResult&gt; profiledChildren = profileResult.getProfiledChildren(); <a id="CO201-4"></a><i class="conum" data-value="4"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO201-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Iterate over the profile results</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO201-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the name of the Lucene query</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO201-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the time in millis spent executing the Lucene query</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO201-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the profile results for the sub-queries (if any)</p>
</td>
</tr>
</table>
</div>
<p>The Rest API documentation contains more information about <a href="/guide/en/elasticsearch/reference/7.1/search-profile-queries.html" class="ulink" target="_top">Profiling Queries</a> with
a description of the query profiling information.</p>
<p>The <code class="literal">QueryProfileShardResult</code> also gives access to the profiling information for the Lucene collectors:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">CollectorResult collectorResult = queryProfileResult.getCollectorResult();  <a id="CO202-1"></a><i class="conum" data-value="1"></i>
String collectorName = collectorResult.getName();  <a id="CO202-2"></a><i class="conum" data-value="2"></i>
Long collectorTimeInMillis = collectorResult.getTime(); <a id="CO202-3"></a><i class="conum" data-value="3"></i>
List&lt;CollectorResult&gt; profiledChildren = collectorResult.getProfiledChildren(); <a id="CO202-4"></a><i class="conum" data-value="4"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO202-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the profiling result of the Lucene collector</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO202-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the name of the Lucene collector</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO202-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the time in millis spent executing the Lucene collector</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO202-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the profile results for the sub-collectors (if any)</p>
</td>
</tr>
</table>
</div>
<p>The Rest API documentation contains more information about profiling information
for Lucene collectors. See <a href="/guide/en/elasticsearch/reference/7.1/search-profile-queries.html" class="ulink" target="_top">Profiling queries</a>.</p>
<p>In a very similar manner to the query tree execution, the <code class="literal">QueryProfileShardResult</code> objects gives access
to the detailed aggregations tree execution:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">AggregationProfileShardResult aggsProfileResults =
        profileShardResult.getAggregationProfileResults(); <a id="CO203-1"></a><i class="conum" data-value="1"></i>
for (ProfileResult profileResult : aggsProfileResults.getProfileResults()) { <a id="CO203-2"></a><i class="conum" data-value="2"></i>
    String aggName = profileResult.getQueryName(); <a id="CO203-3"></a><i class="conum" data-value="3"></i>
    long aggTimeInMillis = profileResult.getTime(); <a id="CO203-4"></a><i class="conum" data-value="4"></i>
    List&lt;ProfileResult&gt; profiledChildren = profileResult.getProfiledChildren(); <a id="CO203-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO203-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the <code class="literal">AggregationProfileShardResult</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO203-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Iterate over the aggregation profile results</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO203-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the type of the aggregation (corresponds to Java class used to execute the aggregation)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO203-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the time in millis spent executing the Lucene collector</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO203-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve the profile results for the sub-aggregations (if any)</p>
</td>
</tr>
</table>
</div>
<p>The Rest API documentation contains more information about
<a href="/guide/en/elasticsearch/reference/7.1/search-profile-aggregations.html" class="ulink" target="_top">Profiling aggregations</a>.</p>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="_search_apis.html">« Search APIs</a>
</span>
<span class="next">
<a href="java-rest-high-search-scroll.html">Search Scroll API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
