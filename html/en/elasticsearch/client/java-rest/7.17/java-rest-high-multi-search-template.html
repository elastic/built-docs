<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Multi-Search-Template API | Java REST Client [7.17] | Elastic</title>
<link rel="home" href="index.html" title="Java REST Client [7.17]"/>
<link rel="up" href="_search_apis.html" title="Search APIs"/>
<link rel="prev" href="java-rest-high-search-template.html" title="Search Template API"/>
<link rel="next" href="java-rest-high-field-caps.html" title="Field Capabilities API"/>
<meta name="DC.type" content="Learn/Docs/Clients/JavaREST/7.17"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="7.17"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<p>
  <strong>WARNING</strong>: Deprecated in 7.15.0. 
</p>  
<p>
  The Java REST Client is deprecated in favor of the 
  <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/index.html">Java API Client</a>.
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Java REST Client [7.17]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="java-rest-high.html">Java High Level REST Client</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="_search_apis.html">Search APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="java-rest-high-search-template.html">« Search Template API</a>
</span>
<span class="next">
<a href="java-rest-high-field-caps.html">Field Capabilities API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="java-rest-high-multi-search-template"></a>Multi-Search-Template API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.17/docs/java-rest/high-level/search/multi-search-template.asciidoc">edit</a></h2>
</div></div></div>
<p>The <code class="literal">multiSearchTemplate</code> API executes multiple <a class="xref" href="java-rest-high-search-template.html" title="Search Template API"><code class="literal">search template</code></a>
requests in a single http request in parallel.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-multi-search-template-request"></a>Multi-Search-Template Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.17/docs/java-rest/high-level/search/multi-search-template.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">MultiSearchTemplateRequest</code> is built empty and you add all of the searches that
you wish to execute to it:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">String [] searchTerms = {"elasticsearch", "logstash", "kibana"};

MultiSearchTemplateRequest multiRequest = new MultiSearchTemplateRequest(); <a id="CO217-1"></a><i class="conum" data-value="1"></i>
for (String searchTerm : searchTerms) {
    SearchTemplateRequest request = new SearchTemplateRequest();  <a id="CO217-2"></a><i class="conum" data-value="2"></i>
    request.setRequest(new SearchRequest("posts"));

    request.setScriptType(ScriptType.INLINE);
    request.setScript(
        "{" +
        "  \"query\": { \"match\" : { \"{{field}}\" : \"{{value}}\" } }," +
        "  \"size\" : \"{{size}}\"" +
        "}");

    Map&lt;String, Object&gt; scriptParams = new HashMap&lt;&gt;();
    scriptParams.put("field", "title");
    scriptParams.put("value", searchTerm);
    scriptParams.put("size", 5);
    request.setScriptParams(scriptParams);

    multiRequest.add(request);  <a id="CO217-3"></a><i class="conum" data-value="3"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO217-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create an empty <code class="literal">MultiSearchTemplateRequest</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO217-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create one or more <code class="literal">SearchTemplateRequest</code> objects and populate them just like you
would for a regular <a class="xref" href="java-rest-high-search-template.html" title="Search Template API"><code class="literal">search template</code></a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO217-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Add the <code class="literal">SearchTemplateRequest</code> to the <code class="literal">MultiSearchTemplateRequest</code>.</p>
</td>
</tr>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_optional_arguments_13"></a>Optional arguments<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.17/docs/java-rest/high-level/search/multi-search-template.asciidoc">edit</a></h4>
</div></div></div>
<p>The multiSearchTemplate&#8217;s <code class="literal">max_concurrent_searches</code> request parameter can be used to control
the maximum number of concurrent searches the multi search api will execute.
This default is based on the number of data nodes and the default search thread pool size.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-multi-search-template-sync"></a>Synchronous Execution<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.17/docs/java-rest/high-level/search/multi-search-template.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">multiSearchTemplate</code> method executes `MultiSearchTemplateRequest`s synchronously:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">MultiSearchTemplateResponse multiResponse = client.msearchTemplate(multiRequest, RequestOptions.DEFAULT);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="java-rest-high-multi-search-template-async"></a>Asynchronous Execution<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.17/docs/java-rest/high-level/search/multi-search-template.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">multiSearchTemplateAsync</code> method executes <code class="literal">MultiSearchTemplateRequest`s asynchronously,
calling the provided `ActionListener</code> when the response is ready.</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">client.msearchTemplateAsync(multiRequest, RequestOptions.DEFAULT, listener);</pre>
</div>
<p>The parameters are the <code class="literal">MultiSearchTemplateRequest</code> to execute and the <code class="literal">ActionListener</code> to use when
the execution completes</p>
<p>The asynchronous method does not block and returns immediately. Once it is
completed the <code class="literal">ActionListener</code> is called back using the <code class="literal">onResponse</code> method
if the execution successfully completed or using the <code class="literal">onFailure</code> method if
it failed.</p>
<p>A typical listener for <code class="literal">MultiSearchTemplateResponse</code> looks like:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">ActionListener&lt;MultiSearchTemplateResponse&gt; listener = new ActionListener&lt;MultiSearchTemplateResponse&gt;() {
    @Override
    public void onResponse(MultiSearchTemplateResponse response) {
        <a id="CO218-1"></a><i class="conum" data-value="1"></i>
    }

    @Override
    public void onFailure(Exception e) {
        <a id="CO218-2"></a><i class="conum" data-value="2"></i>
    }
};</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO218-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Called when the execution is successfully completed.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO218-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Called when the whole <code class="literal">MultiSearchTemplateRequest</code> fails.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_multisearchtemplateresponse"></a>MultiSearchTemplateResponse<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.17/docs/java-rest/high-level/search/multi-search-template.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">MultiSearchTemplateResponse</code> that is returned by executing the <code class="literal">multiSearchTemplate</code> method contains
a <code class="literal">MultiSearchTemplateResponse.Item</code> for each <code class="literal">SearchTemplateRequest</code> in the
<code class="literal">MultiSearchTemplateRequest</code>. Each <code class="literal">MultiSearchTemplateResponse.Item</code> contains an
exception in <code class="literal">getFailure</code> if the request failed or a
<a class="xref" href="java-rest-high-search.html#java-rest-high-search-response" title="SearchResponse"><code class="literal">SearchResponse</code></a> in <code class="literal">getResponse</code> if
the request succeeded:</p>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">for (Item item : multiResponse.getResponses()) { <a id="CO219-1"></a><i class="conum" data-value="1"></i>
    if (item.isFailure()) {
        String error = item.getFailureMessage(); <a id="CO219-2"></a><i class="conum" data-value="2"></i>
    } else {
        SearchTemplateResponse searchTemplateResponse = item.getResponse(); <a id="CO219-3"></a><i class="conum" data-value="3"></i>
        SearchResponse searchResponse = searchTemplateResponse.getResponse();
        searchResponse.getHits();
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO219-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>An array of responses is returned - one response for each request</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO219-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Failed search template requests have error messages</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO219-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Successful requests contain a <a class="xref" href="java-rest-high-search.html#java-rest-high-search-response" title="SearchResponse"><code class="literal">SearchResponse</code></a> in
<code class="literal">getResponse</code>.</p>
</td>
</tr>
</table>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="java-rest-high-search-template.html">« Search Template API</a>
</span>
<span class="next">
<a href="java-rest-high-field-caps.html">Field Capabilities API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
