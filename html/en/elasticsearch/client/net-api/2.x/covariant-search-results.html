<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Covariant search results | Elasticsearch.Net and NEST: the .NET clients [2.x] | Elastic</title>
<meta class="elastic" name="content" content="Covariant search results | Elasticsearch.Net and NEST: the .NET clients [2.x]">

<link rel="home" href="index.html" title="Elasticsearch.Net and NEST: the .NET clients [2.x]"/>
<link rel="up" href="search.html" title="Search"/>
<link rel="prev" href="returned-fields.html" title="Selecting fields to return"/>
<link rel="next" href="aggregations.html" title="Aggregations"/>
<meta class="elastic" name="product_version" content="2.x"/>
<meta class="elastic" name="product_name" content="Clients"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Clients/.Net/2.x"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="2.x"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="icon" href="/favicon.ico" sizes="32x32"/>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml"/>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
<p>
  <strong>WARNING</strong>: Version 5.x has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div class="navheader">
<span class="prev">
<a href="returned-fields.html">« Selecting fields to return</a>
</span>
<span class="next">
<a href="aggregations.html">Aggregations »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch.Net and NEST:  the .NET clients [2.x]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="nest.html">NEST - High level client</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="search.html">Search</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Covariant search results</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/2.x/docs/client-concepts/high-level/covariant-hits/covariant-search-results.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="covariant-search-results"></a>Covariant search results</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/2.x/docs/client-concepts/high-level/covariant-hits/covariant-search-results.asciidoc">edit</a></div>
</div></div></div>
<p>NEST directly supports returning covariant result sets.
Meaning a result can be typed to an interface or base class
but the actual instance type of the result can be that of the subclass directly</p>
<p>Let&#8217;s look at an example; Imagine we want to search over multiple types that all implement
<code class="literal">ISearchResult</code></p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">public interface ISearchResult
{
    string Name { get; set; }
}</pre>
</div>
<p>We have three implementations of <code class="literal">ISearchResult</code> namely <code class="literal">A</code>, <code class="literal">B</code> and <code class="literal">C</code></p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">public class A : ISearchResult
{
    public string Name { get; set; }
    public int PropertyOnA { get; set; }
}

public class B : ISearchResult
{
    public string Name { get; set; }
    public int PropertyOnB { get; set; }
}

public class C : ISearchResult
{
    public string Name { get; set; }
    public int PropertyOnC { get; set; }
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_using_types"></a>Using types</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/2.x/docs/client-concepts/high-level/covariant-hits/covariant-search-results.asciidoc">edit</a></div>
</div></div></div>
<p>The most straightforward way to search over multiple types is to
type the response to the parent interface or base class
and pass the actual types we want to search over using <code class="literal">.Type()</code></p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var result = this._client.Search&lt;ISearchResult&gt;(s =&gt; s
    .Type(Types.Type(typeof(A), typeof(B), typeof(C)))
    .Size(100)
);</pre>
</div>
<p>NEST will translate this to a search over <code class="literal">/index/a,b,c/_search</code>;
hits that have <code class="literal">"_type" : "a"</code> will be serialized to <code class="literal">A</code> and so forth</p>
<p>Here we assume our response is valid and that we received the 100 documents
we are expecting. Remember <code class="literal">result.Documents</code> is an <code class="literal">IReadOnlyCollection&lt;ISearchResult&gt;</code></p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">result.ShouldBeValid();
result.Documents.Count().Should().Be(100);</pre>
</div>
<p>To prove the returned result set is covariant we filter the documents based on their
actual type and assert the returned subsets are the expected sizes</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var aDocuments = result.Documents.OfType&lt;A&gt;();
var bDocuments = result.Documents.OfType&lt;B&gt;();
var cDocuments = result.Documents.OfType&lt;C&gt;();

aDocuments.Count().Should().Be(25);
bDocuments.Count().Should().Be(25);
cDocuments.Count().Should().Be(50);</pre>
</div>
<p>and assume that properties that only exist on the subclass itself are properly filled</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">aDocuments.Should().OnlyContain(a =&gt; a.PropertyOnA &gt; 0);
bDocuments.Should().OnlyContain(a =&gt; a.PropertyOnB &gt; 0);
cDocuments.Should().OnlyContain(a =&gt; a.PropertyOnC &gt; 0);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_using_concretetypeselector"></a>Using ConcreteTypeSelector</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/2.x/docs/client-concepts/high-level/covariant-hits/covariant-search-results.asciidoc">edit</a></div>
</div></div></div>
<p>A more low level approach is to inspect the hit yourself and determine the CLR type to deserialize to</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var result = this._client.Search&lt;ISearchResult&gt;(s =&gt; s
    .ConcreteTypeSelector((d, h) =&gt; h.Type == "a" ? typeof(A) : h.Type == "b" ? typeof(B) : typeof(C))
    .Size(100)
);</pre>
</div>
<p>here for each hit we&#8217;ll call the delegate passed to <code class="literal">ConcreteTypeSelector</code> where</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">d</code> is a representation of the <code class="literal">_source</code> exposed as a <code class="literal">dynamic</code> type
</li>
<li class="listitem">
a typed <code class="literal">h</code> which represents the encapsulating hit of the source i.e. <code class="literal">Hit&lt;dynamic&gt;</code>
</li>
</ul>
</div>
<p>Here we assume our response is valid and that we received the 100 documents
we are expecting. Remember <code class="literal">result.Documents</code> is an <code class="literal">IReadOnlyCollection&lt;ISearchResult&gt;</code></p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">result.ShouldBeValid();
result.Documents.Count().Should().Be(100);</pre>
</div>
<p>To prove the returned result set is covariant we filter the documents based on their
actual type and assert the returned subsets are the expected sizes</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var aDocuments = result.Documents.OfType&lt;A&gt;();
var bDocuments = result.Documents.OfType&lt;B&gt;();
var cDocuments = result.Documents.OfType&lt;C&gt;();

aDocuments.Count().Should().Be(25);
bDocuments.Count().Should().Be(25);
cDocuments.Count().Should().Be(50);</pre>
</div>
<p>and assume that properties that only exist on the subclass itself are properly filled</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">aDocuments.Should().OnlyContain(a =&gt; a.PropertyOnA &gt; 0);
bDocuments.Should().OnlyContain(a =&gt; a.PropertyOnB &gt; 0);
cDocuments.Should().OnlyContain(a =&gt; a.PropertyOnC &gt; 0);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_using_covarianttypes"></a>Using CovariantTypes</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/2.x/docs/client-concepts/high-level/covariant-hits/covariant-search-results.asciidoc">edit</a></div>
</div></div></div>
<p>The Scroll API is a continuation of the previous Search example so Types() are lost.
You can hint at the types using <code class="literal">.CovariantTypes()</code></p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var result = this._client.Scroll&lt;ISearchResult&gt;(TimeSpan.FromMinutes(60), "scrollId", s =&gt; s
    .CovariantTypes(Types.Type(typeof(A), typeof(B), typeof(C)))
);</pre>
</div>
<p>NEST will translate this to a search over <code class="literal">/index/a,b,c/_search</code>;
hits that have <code class="literal">"_type" : "a"</code> will be serialized to <code class="literal">A</code> and so forth</p>
<p>Here we assume our response is valid and that we received the 100 documents
we are expecting. Remember <code class="literal">result.Documents</code> is an <code class="literal">IReadOnlyCollection&lt;ISearchResult&gt;</code></p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">result.ShouldBeValid();
result.Documents.Count().Should().Be(100);</pre>
</div>
<p>To prove the returned result set is covariant we filter the documents based on their
actual type and assert the returned subsets are the expected sizes</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var aDocuments = result.Documents.OfType&lt;A&gt;();
var bDocuments = result.Documents.OfType&lt;B&gt;();
var cDocuments = result.Documents.OfType&lt;C&gt;();

aDocuments.Count().Should().Be(25);
bDocuments.Count().Should().Be(25);
cDocuments.Count().Should().Be(50);</pre>
</div>
<p>and assume that properties that only exist on the subclass itself are properly filled</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">aDocuments.Should().OnlyContain(a =&gt; a.PropertyOnA &gt; 0);
bDocuments.Should().OnlyContain(a =&gt; a.PropertyOnB &gt; 0);
cDocuments.Should().OnlyContain(a =&gt; a.PropertyOnC &gt; 0);</pre>
</div>
<p>The more low level concrete type selector can also be specified on scroll</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var result = this._client.Scroll&lt;ISearchResult&gt;(TimeSpan.FromMinutes(1), "scrollid", s =&gt; s
    .ConcreteTypeSelector((d, h) =&gt; h.Type == "a" ? typeof(A) : h.Type == "b" ? typeof(B) : typeof(C))
);</pre>
</div>
<p>As before, within the delegate passed to <code class="literal">.ConcreteTypeSelector</code></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">d</code> is the <code class="literal">_source</code> typed as <code class="literal">dynamic</code>
</li>
<li class="listitem">
<code class="literal">h</code> is the encapsulating typed hit
</li>
</ul>
</div>
<p>Here we assume our response is valid and that we received the 100 documents
we are expecting. Remember <code class="literal">result.Documents</code> is an <code class="literal">IReadOnlyCollection&lt;ISearchResult&gt;</code></p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">result.ShouldBeValid();
result.Documents.Count().Should().Be(100);</pre>
</div>
<p>To prove the returned result set is covariant we filter the documents based on their
actual type and assert the returned subsets are the expected sizes</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var aDocuments = result.Documents.OfType&lt;A&gt;();
var bDocuments = result.Documents.OfType&lt;B&gt;();
var cDocuments = result.Documents.OfType&lt;C&gt;();

aDocuments.Count().Should().Be(25);
bDocuments.Count().Should().Be(25);
cDocuments.Count().Should().Be(50);</pre>
</div>
<p>and assume that properties that only exist on the subclass itself are properly filled</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">aDocuments.Should().OnlyContain(a =&gt; a.PropertyOnA &gt; 0);
bDocuments.Should().OnlyContain(a =&gt; a.PropertyOnB &gt; 0);
cDocuments.Should().OnlyContain(a =&gt; a.PropertyOnC &gt; 0);</pre>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="returned-fields.html">« Selecting fields to return</a>
</span>
<span class="next">
<a href="aggregations.html">Aggregations »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
