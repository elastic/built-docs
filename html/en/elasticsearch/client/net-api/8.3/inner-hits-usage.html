<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Inner Hits Usage | Elasticsearch .NET Client [8.3] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch .NET Client [8.3]"/>
<link rel="up" href="reference-search.html" title="Search"/>
<link rel="prev" href="indices-boost-usage.html" title="Indices Boost Usage"/>
<link rel="next" href="min-score-usage.html" title="Min Score Usage"/>
<meta name="DC.type" content="Learn/Docs/Clients/.Net/8.3"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="8.3"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch .NET Client [8.3]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="reference-search.html">Search</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="indices-boost-usage.html">« Indices Boost Usage</a>
</span>
<span class="next">
<a href="min-score-usage.html">Min Score Usage »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="inner-hits-usage"></a>Inner Hits Usage<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-net/edit/8.3/docs/search/request/inner-hits-usage.asciidoc">edit</a></h2>
</div></div></div>
<p>The <a href="/guide/en/elasticsearch/reference/master/parent-join.html" class="ulink" target="_top">parent/child</a> and <a href="/guide/en/elasticsearch/reference/master/nested.html" class="ulink" target="_top">nested</a> features allow the
return of documents that have matches in a different scope.
In the parent/child case, parent document are returned based on matches in child documents or child document
are returned based on matches in parent documents. In the nested case, documents are returned based on matches in nested inner objects.</p>
<p>In both cases, the actual matches in the different scopes that caused a document to be returned is hidden.
In many cases, it’s very useful to know <em>which</em> inner nested objects (in the case of nested) or children/parent
documents (in the case of parent/child) caused certain information to be returned.
The inner hits feature can be used for this. This feature returns per search hit in the search response additional
nested hits that caused a search hit to match in a different scope.</p>
<p>Inner hits can be used by defining an <code class="literal">inner_hits</code> definition on a <code class="literal">nested</code>, <code class="literal">has_child</code> or <code class="literal">has_parent</code> query and filter.</p>
<p>See the Elasticsearch documentation on <a href="/guide/en/elasticsearch/reference/master/search-request-body.html#request-body-search-inner-hits" class="ulink" target="_top">Inner hits</a> for more detail.</p>
<h3><a id="_query_inner_hits"></a>Query Inner Hits<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-net/edit/8.3/docs/search/request/inner-hits-usage.asciidoc">edit</a></h3>
<h3><a id="_fluent_dsl_example_8"></a>Fluent DSL example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-net/edit/8.3/docs/search/request/inner-hits-usage.asciidoc">edit</a></h3>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">s =&gt; s
.Index(Index)
.Query(q =&gt;
    q.HasChild&lt;Prince&gt;(hc =&gt; hc
        .Query(hcq =&gt; hcq.Match(m =&gt; m.Field(p =&gt; p.FullTextField).Query("default")))
        .InnerHits(ih =&gt; ih
            .DocValueFields(f =&gt; f.Field(p =&gt; p.Name))
            .Name("princes")
            .Highlight(h =&gt; h.Fields(f =&gt; f.Field(p =&gt; p.FullTextField)))
            .IgnoreUnmapped(false)
            .Version()
        )
    ) || q.Nested(n =&gt; n
        .Path(p =&gt; p.Foes)
        .Query(nq =&gt; nq.MatchAll())
        .InnerHits(i =&gt; i.Version())
    )
)
.Version()</pre>
</div>
<h3><a id="_object_initializer_syntax_example_8"></a>Object Initializer syntax example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-net/edit/8.3/docs/search/request/inner-hits-usage.asciidoc">edit</a></h3>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">new SearchRequest&lt;King&gt;(Index)
{
    Query = new HasChildQuery
    {
        Type = typeof(Prince),
        Query = new MatchQuery { Field = Field&lt;Prince&gt;(p =&gt; p.FullTextField), Query = "default" },
        InnerHits = new InnerHits
        {
            Name = "princes",
            DocValueFields = Field&lt;Prince&gt;(p =&gt; p.Name),
            Highlight = Highlight.Field(Field&lt;Prince&gt;(p =&gt; p.FullTextField)),
            IgnoreUnmapped = false,
            Version = true
        }
    } || new NestedQuery
    {
        Path = Field&lt;King&gt;(p =&gt; p.Foes),
        Query = new MatchAllQuery(),
        InnerHits = new InnerHits()
        {
            Version = true
        }
    },
    Version = true
}</pre>
</div>
<p><strong>Example json output.</strong></p>
<div class="pre_wrapper lang-javascript">
<pre class="programlisting prettyprint lang-javascript">{
  "query": {
    "bool": {
      "should": [
        {
          "has_child": {
            "type": "prince",
            "query": {
              "match": {
                "fullTextField": {
                  "query": "default"
                }
              }
            },
            "inner_hits": {
              "name": "princes",
              "docvalue_fields": [
                "name"
              ],
              "highlight": {
                "fields": {
                  "fullTextField": {}
                }
              },
              "ignore_unmapped": false,
              "version": true
            }
          }
        },
        {
          "nested": {
            "query": {
              "match_all": {}
            },
            "path": "foes",
            "inner_hits": {
              "version": true
            }
          }
        }
      ]
    }
  },
  "version": true
}</pre>
</div>
<h3><a id="_handling_responses_3"></a>Handling Responses<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-net/edit/8.3/docs/search/request/inner-hits-usage.asciidoc">edit</a></h3>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">response.Hits.Should().NotBeEmpty();
foreach (var hit in response.Hits)
{
    hit.Id.Should().NotBeNullOrEmpty();
    hit.Index.Should().NotBeNullOrEmpty();
    hit.Version.Should().Be(1);

    var princes = hit.InnerHits["princes"].Documents&lt;Prince&gt;();
    princes.Should().NotBeEmpty();
    foreach (var princeHit in hit.InnerHits["princes"].Hits.Hits)
    {
        var highlights = princeHit.Highlight;
        highlights.Should().NotBeNull("princes should have highlights");
        highlights.Should().ContainKey("fullTextField", "we are highlighting this field");
        var hl = highlights["fullTextField"];
        hl.Should()
            .NotBeEmpty("all docs have the same text so should all highlight")
            .And.Contain(s =&gt; s.Contains("&lt;em&gt;default&lt;/em&gt;"), "default to be highlighted as its part of the query");

        princeHit.Fields.Should().NotBeNull("all princes have a keyword name so fields should be returned");
        var docValueName = princeHit.Fields.ValueOf&lt;Prince, string&gt;(p =&gt; p.Name);
        docValueName.Should().NotBeNullOrWhiteSpace("value of name on Fields");

        princeHit.Version.Should().Be(1);
    }

    var foes = hit.InnerHits["foes"].Documents&lt;King&gt;();
    foes.Should().NotBeEmpty();
}</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="indices-boost-usage.html">« Indices Boost Usage</a>
</span>
<span class="next">
<a href="min-score-usage.html">Min Score Usage »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
