<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Using Future Mode | Elasticsearch-PHP [6.x] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch-PHP [6.x]"/>
<link rel="up" href="future_mode.html" title="Future Mode"/>
<link rel="prev" href="future_mode.html" title="Future Mode"/>
<link rel="next" href="_changing_batch_size.html" title="Changing batch size"/>
<meta name="DC.type" content="Learn/Docs/Clients/PHP/6.x"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="6.x"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch-PHP [6.x]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="future_mode.html">Future Mode</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="future_mode.html">« Future Mode</a>
</span>
<span class="next">
<a href="_changing_batch_size.html">Changing batch size »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_using_future_mode"></a>Using Future Mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-php/edit/6.x/docs/futures.asciidoc">edit</a></h2>
</div></div></div>
<p>Utilizing this feature is relatively straightforward, but it does introduce more responsibility into your code.  To enable
future mode, set the <code class="literal">future</code> flag in the client options to <code class="literal">'lazy'</code>:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$client = ClientBuilder::create()-&gt;build();

$params = [
    'index' =&gt; 'test',
    'type' =&gt; 'test',
    'id' =&gt; 1,
    'client' =&gt; [
        'future' =&gt; 'lazy'
    ]
];

$future = $client-&gt;get($params);</pre>
</div>
<p>This will return a <em>future</em>, rather than the actual response.  A future represents a <em>future computation</em> and acts like
a placeholder.  You can pass a future around your code like a regular object.  When you need the result values, you
can <em>resolve</em> the future.  If the future has already resolved (due to some other activity), the values will be immediately
available.  If the future has not resolved yet, the resolution will block until those values have become available (e.g.
after the API call completes).</p>
<p>In practice, this means you can queue up a batch of requests by using <code class="literal">future: lazy</code> and they will pend until you resolve
the futures, at which time all requests will be sent in parallel to the cluster and return asynchronously to curl.</p>
<p>This sounds tricky, but it is actually very simple thanks to RingPHP&#8217;s <code class="literal">FutureArray</code> interface, which makes the future
act like a simple associative array.  For example:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$client = ClientBuilder::create()-&gt;build();

$params = [
    'index' =&gt; 'test',
    'type' =&gt; 'test',
    'id' =&gt; 1,
    'client' =&gt; [
        'future' =&gt; 'lazy'
    ]
];

$future = $client-&gt;get($params);

$doc = $future['_source'];    // This call will block and force the future to resolve</pre>
</div>
<p>Interacting with the future as an associative array, just like a normal response, will cause the future to resolve
that particular value (which in turn resolves all pending requests and values).  This allows patterns such as:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$client = ClientBuilder::create()-&gt;build();
$futures = [];

for ($i = 0; $i &lt; 1000; $i++) {
    $params = [
        'index' =&gt; 'test',
        'type' =&gt; 'test',
        'id' =&gt; $i,
        'client' =&gt; [
            'future' =&gt; 'lazy'
        ]
    ];

    $futures[] = $client-&gt;get($params);     //queue up the request
}


foreach ($futures as $future) {
    // access future's values, causing resolution if necessary
    echo $future['_source'];
}</pre>
</div>
<p>The queued requests will execute in parallel and populate their futures after execution.  Batch size defaults to
100 requests-per-batch.</p>
<p>If you wish to force future resolution, but don&#8217;t actually need the values immediately, you can call <code class="literal">wait()</code> on the future
to force resolution too:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$client = ClientBuilder::create()-&gt;build();
$futures = [];

for ($i = 0; $i &lt; 1000; $i++) {
    $params = [
        'index' =&gt; 'test',
        'type' =&gt; 'test',
        'id' =&gt; $i,
        'client' =&gt; [
            'future' =&gt; 'lazy'
        ]
    ];

    $futures[] = $client-&gt;get($params);     //queue up the request
}

//wait() forces future resolution and will execute the underlying curl batch
$futures[999]-&gt;wait();</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="future_mode.html">« Future Mode</a>
</span>
<span class="next">
<a href="_changing_batch_size.html">Changing batch size »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
