<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Connecting | Elasticsearch Python Client [8.3] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Python Client [8.3]"/>
<link rel="up" href="index.html" title="Elasticsearch Python Client [8.3]"/>
<link rel="prev" href="installation.html" title="Installation"/>
<link rel="next" href="config.html" title="Configuration"/>
<meta name="DC.type" content="Learn/Docs/Clients/Python/8.3"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="8.3"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Python Client [8.3]</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="installation.html">« Installation</a>
</span>
<span class="next">
<a href="config.html">Configuration »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="connecting"></a>Connecting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h1>
</div></div></div>
<p>This page contains the information you need to connect the Client with Elasticsearch.</p>
<h3><a id="connect-ec"></a>Connecting to Elastic Cloud<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h3>
<p><a href="/guide/en/cloud/current/ec-getting-started.html" class="ulink" target="_top">Elastic Cloud</a>
is the easiest way to get started with Elasticsearch. When connecting to Elastic Cloud
with the Python Elasticsearch client you should always use the <code class="literal">cloud_id</code>
parameter to connect. You can find this value within the "Manage Deployment"
page after you&#8217;ve created a cluster (look in the top-left if you&#8217;re in Kibana).</p>
<p>We recommend using a Cloud ID whenever possible because your client will be
automatically configured for optimal use with Elastic Cloud including HTTPS and
HTTP compression.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Password for the 'elastic' user generated by Elasticsearch
ELASTIC_PASSWORD = "&lt;password&gt;"

# Found in the 'Manage Deployment' page
CLOUD_ID = "deployment-name:dXMtZWFzdDQuZ2Nw..."

# Create the client instance
client = Elasticsearch(
    cloud_id=CLOUD_ID,
    basic_auth=("elastic", ELASTIC_PASSWORD)
)

# Successful response!
client.info()
# {'name': 'instance-0000000000', 'cluster_name': ...}</pre>
</div>
<h3><a id="connect-self-managed-new"></a>Connecting to a self-managed cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h3>
<p>By default Elasticsearch will start with security features like authentication and TLS
enabled. To connect to the Elasticsearch cluster you&#8217;ll need to configure the Python Elasticsearch
client to use HTTPS with the generated CA certificate in order to make requests
successfully.</p>
<p>If you&#8217;re just getting started with Elasticsearch we recommend reading the documentation
on <a href="/guide/en/elasticsearch/reference/current/settings.html" class="ulink" target="_top">configuring</a>
and
<a href="/guide/en/elasticsearch/reference/current/starting-elasticsearch.html" class="ulink" target="_top">starting Elasticsearch</a>
to ensure your cluster is running as expected.</p>
<p>When you start Elasticsearch for the first time you&#8217;ll see a distinct block like the one
below in the output from Elasticsearch (you may have to scroll up if it&#8217;s been a while):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">----------------------------------------------------------------
-&gt; Elasticsearch security features have been automatically configured!
-&gt; Authentication is enabled and cluster connections are encrypted.

-&gt;  Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):
  lhQpLELkjkrawaBoaz0Q

-&gt;  HTTP CA certificate SHA-256 fingerprint:
  a52dd93511e8c6045e21f16654b77c9ee0f34aea26d9f40320b531c474676228
...
----------------------------------------------------------------</pre>
</div>
<p>Note down the <code class="literal">elastic</code> user password and HTTP CA fingerprint for the next
sections. In the examples below they will be stored in the variables
<code class="literal">ELASTIC_PASSWORD</code> and <code class="literal">CERT_FINGERPRINT</code> respectively.</p>
<p>Depending on the circumstances there are two options for verifying the HTTPS
connection, either verifying with the CA certificate itself or via the HTTP CA
certificate fingerprint.</p>
<h4><a id="_verifying_https_with_ca_certificates"></a>Verifying HTTPS with CA certificates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h4>
<p>Using the <code class="literal">ca_certs</code> option is the default way the Python Elasticsearch client verifies
an HTTPS connection.</p>
<p>The generated root CA certificate can be found in the <code class="literal">certs</code> directory in your
Elasticsearch config location (<code class="literal">$ES_CONF_PATH/certs/http_ca.crt</code>). If you&#8217;re running Elasticsearch
in Docker there is
<a href="/guide/en/elasticsearch/reference/current/docker.html" class="ulink" target="_top">additional documentation for retrieving the CA certificate</a>.</p>
<p>Once you have the <code class="literal">http_ca.crt</code> file somewhere accessible pass the path to the
client via <code class="literal">ca_certs</code>:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Password for the 'elastic' user generated by Elasticsearch
ELASTIC_PASSWORD = "&lt;password&gt;"

# Create the client instance
client = Elasticsearch(
    "https://localhost:9200",
    ca_certs="/path/to/http_ca.crt",
    basic_auth=("elastic", ELASTIC_PASSWORD)
)

# Successful response!
client.info()
# {'name': 'instance-0000000000', 'cluster_name': ...}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you don&#8217;t specify <code class="literal">ca_certs</code> or <code class="literal">ssl_assert_fingerprint</code> then the
<a href="https://certifiio.readthedocs.io" class="ulink" target="_top">certifi package</a> will be used for <code class="literal">ca_certs</code> by
default if available.</p>
</div>
</div>
<h4><a id="_verifying_https_with_certificate_fingerprints_python_3_10_or_later"></a>Verifying HTTPS with certificate fingerprints (Python 3.10 or later)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using this method <span class="strong strong"><strong>requires using Python 3.10 or later</strong></span> and isn&#8217;t
available when using the <code class="literal">aiohttp</code> HTTP client library so can&#8217;t be used with
<code class="literal">AsyncElasticsearch</code>.</p>
</div>
</div>
<p>This method of verifying the HTTPS connection takes advantage of the certificate
fingerprint value noted down earlier. Take this SHA256 fingerprint value and
pass it to the Python Elasticsearch client via <code class="literal">ssl_assert_fingerprint</code>:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Fingerprint either from Elasticsearch startup or above script.
# Colons and uppercase/lowercase don't matter when using
# the 'ssl_assert_fingerprint' parameter
CERT_FINGERPRINT = "A5:2D:D9:35:11:E8:C6:04:5E:21:F1:66:54:B7:7C:9E:E0:F3:4A:EA:26:D9:F4:03:20:B5:31:C4:74:67:62:28"

# Password for the 'elastic' user generated by Elasticsearch
ELASTIC_PASSWORD = "&lt;password&gt;"

client = Elasticsearch(
    "https://localhost:9200",
    ssl_assert_fingerprint=CERT_FINGERPRINT,
    basic_auth=("elastic", ELASTIC_PASSWORD)
)

# Successful response!
client.info()
# {'name': 'instance-0000000000', 'cluster_name': ...}</pre>
</div>
<p>The certificate fingerprint can be calculated using <code class="literal">openssl x509</code> with the
certificate file:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">openssl x509 -fingerprint -sha256 -noout -in /path/to/http_ca.crt</pre>
</div>
<p>If you don&#8217;t have access to the generated CA file from Elasticsearch you can use the
following script to output the root CA fingerprint of the Elasticsearch instance with
<code class="literal">openssl s_client</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh"># Replace the values of 'localhost' and '9200' to the
# corresponding host and port values for the cluster.
openssl s_client -connect localhost:9200 -servername localhost -showcerts &lt;/dev/null 2&gt;/dev/null \
  | openssl x509 -fingerprint -sha256 -noout -in /dev/stdin</pre>
</div>
<p>The output of <code class="literal">openssl x509</code> will look something like this:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">SHA256 Fingerprint=A5:2D:D9:35:11:E8:C6:04:5E:21:F1:66:54:B7:7C:9E:E0:F3:4A:EA:26:D9:F4:03:20:B5:31:C4:74:67:62:28</pre>
</div>
<h3><a id="connect-no-security"></a>Connecting without security enabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h3>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Running Elasticsearch without security enabled is not recommended.</p>
</div>
</div>
<p>If your cluster is configured with
<a href="/guide/en/elasticsearch/reference/current/security-settings.html" class="ulink" target="_top">security explicitly disabled</a>
then you can connect via HTTP:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Create the client instance
client = Elasticsearch("http://localhost:9200")

# Successful response!
client.info()
# {'name': 'instance-0000000000', 'cluster_name': ...}</pre>
</div>
<h3><a id="connect-url"></a>Connecting to multiple nodes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h3>
<p>The Python Elasticsearch client supports sending API requests to multiple nodes in the
cluster. This means that work will be more evenly spread across the cluster
instead of hammering the same node over and over with requests. To configure the
client with multiple nodes you can pass a list of URLs, each URL will be used as
a separate node in the pool.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# List of nodes to connect use with different hosts and ports.
NODES = [
    "https://localhost:9200",
    "https://localhost:9201",
    "https://localhost:9202",
]

# Password for the 'elastic' user generated by Elasticsearch
ELASTIC_PASSWORD = "&lt;password&gt;"

client = Elasticsearch(
    NODES,
    ca_certs="/path/to/http_ca.crt",
    basic_auth=("elastic", ELASTIC_PASSWORD)
)</pre>
</div>
<p>By default nodes are selected using round-robin, but alternate node selection
strategies can be configured with <code class="literal">node_selector_class</code> parameter.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your Elasticsearch cluster is behind a load balancer like when using Elastic
Cloud you won&#8217;t need to configure multiple nodes. Instead use the load balancer
host and port.</p>
</div>
</div>
<h3><a id="authentication"></a>Authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h3>
<p>This section contains code snippets to show you how to connect to various Elasticsearch
providers. All authentication methods are supported on the client constructor
or via the per-request <code class="literal">.options()</code> method:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Authenticate from the constructor
es = Elasticsearch(
    "https://localhost:9200",
    ca_certs="/path/to/http_ca.crt",
    basic_auth=("username", "password")
)

# Authenticate via the .options() method:
es.options(
    basic_auth=("username", "password")
).indices.get(index="*")

# You can persist the authenticated client to use
# later or use for multiple API calls:
auth_client = es.options(
    api_key=("api-key-id", "api-key-secret")
)
for i in range(10):
    auth_client.index(
        index="example-index",
        document={"field": i}
    )</pre>
</div>
<h4><a id="auth-basic"></a>HTTP Basic authentication (Username and Password)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h4>
<p>HTTP Basic authentication uses the <code class="literal">basic_auth</code> parameter by passing in a
username and password within a tuple:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Adds the HTTP header 'Authorization: Basic &lt;base64 username:password&gt;'
es = Elasticsearch(
    "https://localhost:9200",
    ca_certs="/path/to/http_ca.crt",
    basic_auth=("username", "password")
)</pre>
</div>
<h4><a id="auth-bearer"></a>HTTP Bearer authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h4>
<p>HTTP Bearer authentication uses the <code class="literal">bearer_auth</code> parameter by passing the token
as a string. This authentication method is used by
<a href="/guide/en/elasticsearch/reference/master/security-api-create-service-token.html" class="ulink" target="_top">Service Account Tokens</a>
and <a href="/guide/en/elasticsearch/reference/master/security-api-get-token.html" class="ulink" target="_top">Bearer Tokens</a>.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Adds the HTTP header 'Authorization: Bearer token-value'
es = Elasticsearch(
    "https://localhost:9200",
    bearer_auth="token-value"
)</pre>
</div>
<h4><a id="auth-apikey"></a>API Key authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h4>
<p>You can configure the client to use Elasticsearch&#8217;s API Key for connecting to your
cluster. Note that you need the values of <code class="literal">id</code> and <code class="literal">api_key</code> to
<a href="/guide/en/elasticsearch/reference/current/security-api-create-api-key.html" class="ulink" target="_top">authenticate via an API Key</a>.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Adds the HTTP header 'Authorization: ApiKey &lt;base64 api_key.id:api_key.api_key&gt;'
es = Elasticsearch(
    "https://localhost:9200",
    ca_certs="/path/to/http_ca.crt",
    api_key=("api_key.id", "api_key.api_key")
)</pre>
</div>
<h3><a id="compatibility-mode"></a>Enabling the Compatibility Mode<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h3>
<p>The Elasticsearch server version 8.0 is introducing a new compatibility mode that allows
you a smoother upgrade experience from 7 to 8. In a nutshell, you can use the
latest 7.x Python Elasticsearch Elasticsearch client with an 8.x Elasticsearch server, giving more room to
coordinate the upgrade of your codebase to the next major version.</p>
<p>If you want to leverage this functionality, please make sure that you are using
the latest 7.x Python Elasticsearch client and set the environment variable
<code class="literal">ELASTIC_CLIENT_APIVERSIONING</code> to <code class="literal">true</code>. The client is handling the rest
internally. For every 8.0 and beyond Python Elasticsearch client, you&#8217;re all set! The
compatibility mode is enabled by default.</p>
<h3><a id="connecting-faas"></a>Using the Client in a Function-as-a-Service Environment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h3>
<p>This section illustrates the best practices for leveraging the Elasticsearch client in a
Function-as-a-Service (FaaS) environment.</p>
<p>The most influential optimization is to initialize the client outside of the
function, the global scope.</p>
<p>This practice does not only improve performance but also enables background
functionality as – for example –
<a href="/blog/elasticsearch-sniffing-best-practices-what-when-why-how" class="ulink" target="_top">sniffing</a>.
The following examples provide a skeleton for the best practices.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The async client shouldn&#8217;t be used within Function-as-a-Service as a new event
           loop must be started for each invocation. Instead the synchronous <code class="literal">Elasticsearch</code>
           client is recommended.</p>
</div>
</div>
<h4><a id="connecting-faas-gcp"></a>GCP Cloud Functions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Client initialization
client = Elasticsearch(
    cloud_id="deployment-name:ABCD...",
    api_key=...
)

def main(request):
    # Use the client
    client.search(index=..., query={"match_all": {}})</pre>
</div>
<h4><a id="connecting-faas-aws"></a>AWS Lambda<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Client initialization
client = Elasticsearch(
    cloud_id="deployment-name:ABCD...",
    api_key=...
)

def main(event, context):
    # Use the client
    client.search(index=..., query={"match_all": {}})</pre>
</div>
<h4><a id="connecting-faas-azure"></a>Azure Functions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-py/edit/8.3/docs/guide/connecting.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">import azure.functions as func
from elasticsearch import Elasticsearch

# Client initialization
client = Elasticsearch(
    cloud_id="deployment-name:ABCD...",
    api_key=...
)

def main(request: func.HttpRequest) -&gt; func.HttpResponse:
    # Use the client
    client.search(index=..., query={"match_all": {}})</pre>
</div>
<p>Resources used to assess these recommendations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://cloud.google.com/functions/docs/bestpractices/tips#use_global_variables_to_reuse_objects_in_future_invocations" class="ulink" target="_top">GCP Cloud Functions: Tips &amp; Tricks</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html" class="ulink" target="_top">Best practices for working with AWS Lambda functions</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-python?tabs=azurecli-linux%2Capplication-level#global-variables" class="ulink" target="_top">Azure Functions Python developer guide</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/lambda/latest/operatorguide/global-scope.html" class="ulink" target="_top">AWS Lambda: Comparing the effect of global scope</a>
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="installation.html">« Installation</a>
</span>
<span class="next">
<a href="config.html">Configuration »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
