<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Painless execute API | Painless Scripting Language [8.7] | Elastic</title>
<meta class="elastic" name="content" content="Painless execute API | Painless Scripting Language [8.7]">

<link rel="home" href="index.html" title="Painless Scripting Language [8.7]"/>
<link rel="up" href="painless-guide.html" title="Painless Guide"/>
<link rel="prev" href="painless-debugging.html" title="Painless Debugging"/>
<link rel="next" href="painless-ingest.html" title="Using ingest processors in Painless"/>
<meta class="elastic" name="product_version" content="8.7"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Painless/8.7"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.7"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Painless Scripting Language [8.7]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="painless-guide.html">Painless Guide</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="painless-debugging.html">« Painless Debugging</a>
</span>
<span class="next">
<a href="painless-ingest.html">Using ingest processors in Painless »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="painless-execute-api"></a>Painless execute API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>The Painless execute API runs a script and returns a result.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="painless-execute-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /_scripts/painless/_execute</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="painless-execute-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h3>
</div></div></div>
<p>Use this API to build and test scripts, such as when defining a script for a
<a href="/guide/en/elasticsearch/reference/8.7/runtime.html" class="ulink" target="_top">runtime field</a>. This API requires very few dependencies, and is
especially useful if you don&#8217;t have permissions to write documents on a cluster.</p>
<p>The API uses several <em>contexts</em>, which control how scripts are executed, what
variables are available at runtime, and what the return type is.</p>
<p>Each context requires a script, but additional parameters depend on the context
you&#8217;re using for that script.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="painless-execute-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">script</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The Painless script to execute.
</p>
<div class="openblock">
<div class="title">Properties of <code class="literal">script</code></div>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">emit</code>
</span>
</dt>
<dd>
<p>
(Required)
Accepts the values from the script valuation. Scripts can call the
<code class="literal">emit</code> method multiple times to emit multiple values.
</p>
<p>The <code class="literal">emit</code> method applies only to scripts used in a
<a class="xref" href="painless-execute-api.html#painless-execute-runtime-context" title="Field contexts">runtime fields context</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">emit</code> method cannot accept <code class="literal">null</code> values. Do not call this
method if the referenced fields do not have any values.</p>
</div>
</div>
<details open>
<summary class="title">Signatures of <code class="literal">emit</code></summary>
<div class="content">
<p>The signature for <code class="literal">emit</code> depends on the <code class="literal">type</code> of the field.</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">boolean</code>
</p>
</td>
<td valign="top">
<p>
<code class="literal">emit(boolean)</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">date</code>
</p>
</td>
<td valign="top">
<p>
<code class="literal">emit(long)</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">double</code>
</p>
</td>
<td valign="top">
<p>
<code class="literal">emit(double)</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">geo_point</code>
</p>
</td>
<td valign="top">
<p>
<code class="literal">emit(double lat, double lon)</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">ip</code>
</p>
</td>
<td valign="top">
<p>
<code class="literal">emit(String)</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">long</code>
</p>
</td>
<td valign="top">
<p>
<code class="literal">emit(long)</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">keyword</code>
</p>
</td>
<td valign="top">
<p>
<code class="literal">emit(String)</code>
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="_contexts"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">context</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
The context that the script should run in. Defaults to <code class="literal">painless_test</code> if no
context is specified.
</p>
<details open>
<summary class="title">Properties of <code class="literal">context</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">painless_test</code>
</span>
</dt>
<dd>
The default context if no other context is specified. See
<a class="xref" href="painless-execute-api.html#painless-execute-test" title="Test context">test context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
Treats scripts as if they were run inside a <code class="literal">script</code> query. See
<a class="xref" href="painless-execute-api.html#painless-execute-filter-context" title="Filter context">filter context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">score</code>
</span>
</dt>
<dd>
Treats scripts as if they were run inside a <code class="literal">script_score</code> function in a
<code class="literal">function_score</code> query. See <a class="xref" href="painless-execute-api.html#painless-execute-core-context" title="Score context">score context</a>.
</dd>
</dl>
</div>
<details id="painless-execute-runtime-context" open>
<summary class="title">Field contexts</summary>
<div class="content">
<p>The following options are specific to the field contexts.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Result ordering in the field contexts is not guaranteed.</p>
</div>
</div>
<div class="sidebar">
<div class="titlepage"></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">boolean_field</code>
</span>
</dt>
<dd>
The context for <a href="/guide/en/elasticsearch/reference/8.7/boolean.html" class="ulink" target="_top"><code class="literal">boolean</code> fields</a>. The script returns a <code class="literal">true</code>
or <code class="literal">false</code> response. See
<a class="xref" href="painless-execute-api.html#painless-runtime-boolean" title="boolean_field">boolean_field context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">date_field</code>
</span>
</dt>
<dd>
The context for <a href="/guide/en/elasticsearch/reference/8.7/date.html" class="ulink" target="_top"><code class="literal">date</code> fields</a>. <code class="literal">emit</code> takes a <code class="literal">long</code> value and
the script returns a sorted list of dates. See
<a class="xref" href="painless-execute-api.html#painless-runtime-datetime" title="date_time">date_time context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">double_field</code>
</span>
</dt>
<dd>
The context for <code class="literal">double</code> <a href="/guide/en/elasticsearch/reference/8.7/number.html" class="ulink" target="_top">numeric fields</a>. The script returns a
sorted list of <code class="literal">double</code> values. See
<a class="xref" href="painless-execute-api.html#painless-runtime-double" title="double_field">double_field context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">geo_point_field</code>
</span>
</dt>
<dd>
The context for <a href="/guide/en/elasticsearch/reference/8.7/geo-point.html" class="ulink" target="_top"><code class="literal">geo-point</code> fields</a>. <code class="literal">emit</code> takes two double
parameters, the latitude and longitude values, and the script returns an object in
GeoJSON format containing the coordinates for the geo point. See
<a class="xref" href="painless-execute-api.html#painless-runtime-geo" title="geo_point_field">geo_point_field context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">ip_field</code>
</span>
</dt>
<dd>
The context for <a href="/guide/en/elasticsearch/reference/8.7/ip.html" class="ulink" target="_top"><code class="literal">ip</code> fields</a>. The script returns a sorted list of IP
addresses. See
<a class="xref" href="painless-execute-api.html#painless-runtime-ip" title="ip_field">ip_field context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">keyword_field</code>
</span>
</dt>
<dd>
The context for <a href="/guide/en/elasticsearch/reference/8.7/keyword.html" class="ulink" target="_top"><code class="literal">keyword</code> fields</a>. The script returns a sorted
list of <code class="literal">string</code> values. See
<a class="xref" href="painless-execute-api.html#painless-runtime-keyword" title="keyword_field">keyword_field context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">long_field</code>
</span>
</dt>
<dd>
The context for <code class="literal">long</code> <a href="/guide/en/elasticsearch/reference/8.7/number.html" class="ulink" target="_top">numeric fields</a>. The script returns a
sorted list of <code class="literal">long</code> values. See <a class="xref" href="painless-execute-api.html#painless-runtime-long" title="long_field">long_field context</a>.
</dd>
<dt>
<span class="term">
<code class="literal">composite_field</code>
</span>
</dt>
<dd>
The context for <code class="literal">composite</code> <a href="/guide/en/elasticsearch/reference/8.7/runtime.html" class="ulink" target="_top">runtime fields</a>. The script returns a
map of values. See <a class="xref" href="painless-execute-api.html#painless-runtime-composite" title="composite_field">composite_field context</a>.
</dd>
</dl>
</div>
</div>
</div>
</details>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">context_setup</code>
</span>
</dt>
<dd>
<p>
(Required, object)
Additional parameters for the <code class="literal">context</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This parameter is required for all contexts except <code class="literal">painless_test</code>,
which is the default if no value is provided for <code class="literal">context</code>.</p>
</div>
</div>
<details open>
<summary class="title">Properties of <code class="literal">context_setup</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">document</code>
</span>
</dt>
<dd>
(Required, string)
Document that&#8217;s temporarily indexed in-memory and accessible from the script.
</dd>
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Required, string)
Index containing a mapping that&#8217;s compatible with the indexed document.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">params</code>
</span>
</dt>
<dd>
(<code class="literal">Map</code>, read-only)
Specifies any named parameters that are passed into the script as variables.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This parameter only applies when <code class="literal">score</code> is specified as the script
<code class="literal">context</code>.</p>
</div>
</div>
<p>Use this parameter to specify a query for computing a score. Besides deciding
whether or not the document matches, the
<a href="/guide/en/elasticsearch/reference/8.7/query-filter-context.html#query-context" class="ulink" target="_top">query clause</a> also calculates a
relevance score in the <code class="literal">_score</code> metadata field.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="painless-execute-test"></a>Test context<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">painless_test</code> context runs scripts without additional parameters. The only
variable that is available is <code class="literal">params</code>, which can be used to access user defined
values. The result of the script is always converted to a string.</p>
<p>Because the default context is <code class="literal">painless_test</code>, you don&#8217;t need to specify the
<code class="literal">context</code> or <code class="literal">context_setup</code>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": "params.count / params.total",
    "params": {
      "count": 100.0,
      "total": 1000.0
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/24.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_response"></a>Response<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result": "0.1"
}</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="painless-execute-filter-context"></a>Filter context<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">filter</code> context treats scripts as if they were run inside a <code class="literal">script</code> query.
For testing purposes, a document must be provided so that it will be temporarily
indexed in-memory and is accessible from the script. More precisely, the
<code class="literal">_source</code>, stored fields and doc values of such a document are available to the
script being tested.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_request_2"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001
{
  "mappings": {
    "properties": {
      "field": {
        "type": "keyword"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/25.console"></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": "doc['field'].value.length() &lt;= params.max_length",
    "params": {
      "max_length": 4
    }
  },
  "context": "filter",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "field": "four"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/26.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_response_2"></a>Response<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result": true
}</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="painless-execute-core-context"></a>Score context<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">score</code> context treats scripts as if they were run inside a <code class="literal">script_score</code>
function in a <code class="literal">function_score</code> query.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_request_3"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001
{
  "mappings": {
    "properties": {
      "field": {
        "type": "keyword"
      },
      "rank": {
        "type": "long"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/27.console"></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": "doc['rank'].value / params.max_rank",
    "params": {
      "max_rank": 5.0
    }
  },
  "context": "score",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "rank": 4
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/28.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_response_3"></a>Response<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result": 0.8
}</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="painless-execute-runtime-field-context"></a>Field contexts<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h3>
</div></div></div>
<p>The field contexts treat scripts as if they were run inside the
<a href="/guide/en/elasticsearch/reference/8.7/runtime-search-request.html" class="ulink" target="_top"><code class="literal">runtime_mappings</code> section</a> of a search query.
You can use field contexts to test scripts for different field types, and then
include those scripts anywhere that they&#8217;re supported, such as  <a class="xref" href="painless-runtime-fields.html" title="Use Painless scripts in runtime fields">runtime fields</a>.</p>
<p>Choose a field context based on the data type you want to return.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="painless-runtime-boolean"></a><code class="literal">boolean_field</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<p>Use the <code class="literal">boolean_field</code> field context when you want to return a <code class="literal">true</code>
or <code class="literal">false</code> value from a script valuation. <a href="/guide/en/elasticsearch/reference/8.7/boolean.html" class="ulink" target="_top">Boolean fields</a>
accept <code class="literal">true</code> and <code class="literal">false</code> values, but can also accept strings that are
interpreted as either true or false.</p>
<p>Let&#8217;s say you have data for the top 100 science fiction books of all time. You
want to write scripts that return a boolean response such as whether books
exceed a certain page count, or if a book was published after a specific year.</p>
<p>Consider that your data is structured like this:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001
{
  "mappings": {
    "properties": {
      "name": {
        "type": "keyword"
      },
      "author": {
        "type": "keyword"
      },
      "release_date": {
        "type": "date"
      },
      "page_count": {
        "type": "double"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/29.console"></div>
<p>You can then write a script in the <code class="literal">boolean_field</code> context that indicates
whether a book was published before the year 1972:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": """
      emit(doc['release_date'].value.year &lt; 1972);
    """
  },
  "context": "boolean_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "name": "Dune",
      "author": "Frank Herbert",
      "release_date": "1965-06-01",
      "page_count": 604
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/30.console"></div>
<p>Because <em>Dune</em> was published in 1965, the result returns as <code class="literal">true</code>:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : [
    true
  ]
}</pre>
</div>
<p>Similarly, you could write a script that determines whether the first name of
an author exceeds a certain number of characters. The following script operates
on the <code class="literal">author</code> field to determine whether the author&#8217;s first name contains at
least one character, but is less than five characters:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": """
      int space = doc['author'].value.indexOf(' ');
      emit(space &gt; 0 &amp;&amp; space &lt; 5);
    """
  },
  "context": "boolean_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "name": "Dune",
      "author": "Frank Herbert",
      "release_date": "1965-06-01",
      "page_count": 604
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/31.console"></div>
<p>Because <code class="literal">Frank</code> is five characters, the response returns <code class="literal">false</code> for the script
valuation:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : [
    false
  ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="painless-runtime-datetime"></a><code class="literal">date_time</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<p>Several options are available for using
<a class="xref" href="painless-datetime.html" title="Using Datetime in Painless">using datetime in Painless</a>. In this example, you&#8217;ll
estimate when a particular author starting writing a book based on its release
date and the writing speed of that author. The example makes some assumptions,
but shows to write a script that operates on a date while incorporating
additional information.</p>
<p>Add the following fields to your index mapping to get started:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001
{
  "mappings": {
    "properties": {
      "name": {
        "type": "keyword"
      },
      "author": {
        "type": "keyword"
      },
      "release_date": {
        "type": "date"
      },
      "page_count": {
        "type": "long"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/32.console"></div>
<p>The following script makes the incredible assumption that when writing a book,
authors just write each page and don&#8217;t do research or revisions. Further, the
script assumes that the average time it takes to write a page is eight hours.</p>
<p>The script retrieves the <code class="literal">author</code> and makes another fantastic assumption to
either divide or multiply the <code class="literal">pageTime</code> value based on the author&#8217;s perceived
writing speed (yet another wild assumption).</p>
<p>The script subtracts the release date value (in milliseconds) from the
calculation of <code class="literal">pageTime</code> times the <code class="literal">page_count</code> to determine approximately
(based on numerous assumptions) when the author began writing the book.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": """
      String author = doc['author'].value;
      long pageTime = 28800000;  <a id="CO14-1"></a><i class="conum" data-value="1"></i>
      if (author == 'Robert A. Heinlein') {
        pageTime /= 2;           <a id="CO14-2"></a><i class="conum" data-value="2"></i>
      } else if (author == 'Alastair Reynolds') {
        pageTime *= 2;           <a id="CO14-3"></a><i class="conum" data-value="3"></i>
      }
      emit(doc['release_date'].value.toInstant().toEpochMilli() - pageTime * doc['page_count'].value);
    """
  },
  "context": "date_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "name": "Revelation Space",
      "author": "Alastair Reynolds",
      "release_date": "2000-03-15",
      "page_count": 585
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/33.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Eight hours, represented in milliseconds</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Incredibly fast writing from Robert A. Heinlein</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Alastair Reynolds writes space operas at a much slower speed</p>
</td>
</tr>
</table>
</div>
<p>In this case, the author is Alastair Reynolds. Based on a release date of
<code class="literal">2000-03-15</code>, the script calculates that the author started writing
<code class="literal">Revelation Space</code> on 19 February 1999. Writing a 585 page book in just over one
year is pretty impressive!</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : [
    "1999-02-19T00:00:00.000Z"
  ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="painless-runtime-double"></a><code class="literal">double_field</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<p>Use the <code class="literal">double_field</code> context for <a href="/guide/en/elasticsearch/reference/8.7/number.html" class="ulink" target="_top">numeric data</a> of type
<code class="literal">double</code>. For example, let&#8217;s say you have sensor data that includes a <code class="literal">voltage</code>
field with values like 5.6. After indexing millions of documents, you discover
that the sensor with model number <code class="literal">QVKC92Q</code> is under reporting its voltage by a
factor of 1.7. Rather than reindex your data, you can fix it with a
runtime field.</p>
<p>You need to multiply this value, but only for
sensors that match a specific model number.</p>
<p>Add the following fields to your index mapping. The <code class="literal">voltage</code> field is a
sub-field of the <code class="literal">measures</code> object.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my-index-000001
{
  "mappings": {
    "properties": {
      "@timestamp": {
        "type": "date"
      },
      "model_number": {
        "type": "keyword"
      },
      "measures": {
        "properties": {
          "voltage": {
            "type": "double"
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/34.console"></div>
<p>The following script matches on any documents where the <code class="literal">model_number</code> equals
<code class="literal">QVKC92Q</code>, and then multiplies the <code class="literal">voltage</code> value by <code class="literal">1.7</code>. This script is
useful when you want to select specific documents and only operate on values
that match the specified criteria.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": """
      if (doc['model_number'].value.equals('QVKC92Q'))
      {emit(1.7 * params._source['measures']['voltage']);}
      else{emit(params._source['measures']['voltage']);}
    """
  },
  "context": "double_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "@timestamp": 1516470094000,
      "model_number": "QVKC92Q",
      "measures": {
        "voltage": 5.6
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/35.console"></div>
<p>The result includes the calculated voltage, which was determined by multiplying
the original value of <code class="literal">5.6</code> by <code class="literal">1.7</code>:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : [
    9.52
  ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="painless-runtime-geo"></a><code class="literal">geo_point_field</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<p><a href="/guide/en/elasticsearch/reference/8.7/geo-point.html" class="ulink" target="_top">Geo-point</a> fields accept latitude-longitude pairs. You can
define a geo-point field in several ways, and include values for latitude and
longitude in the document for your script.</p>
<p>If you already have a known geo-point, it&#8217;s simpler to clearly state the
positions of <code class="literal">lat</code> and <code class="literal">lon</code> in your index mappings.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001/
{
  "mappings": {
    "properties": {
      "lat": {
        "type": "double"
      },
      "lon": {
        "type": "double"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/36.console"></div>
<p>You can then use the <code class="literal">geo_point_field</code> runtime field context to write a script
that retrieves the <code class="literal">lat</code> and <code class="literal">lon</code> values.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": """
      emit(doc['lat'].value, doc['lon'].value);
    """
  },
  "context": "geo_point_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "lat": 41.12,
      "lon": -71.34
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/37.console"></div>
<p>Because you&#8217;re working with a geo-point field type, the response includes
results that are formatted as <code class="literal">coordinates</code>.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : [
    {
      "coordinates" : [
        -71.34,
        41.12
      ],
      "type" : "Point"
    }
  ]
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The emit function for <a href="/guide/en/elasticsearch/reference/8.7/geo-point.html" class="ulink" target="_top">geo-point</a> fields takes two parameters ordered with
<code class="literal">lat</code> before <code class="literal">lon</code>, but the output GeoJSON format orders the <code class="literal">coordinates</code> as <code class="literal">[ lon, lat ]</code>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="painless-runtime-ip"></a><code class="literal">ip_field</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">ip_field</code> context is useful for data that includes IP addresses of type
<a href="/guide/en/elasticsearch/reference/8.7/ip.html" class="ulink" target="_top"><code class="literal">ip</code></a>. For example, let&#8217;s say you have a <code class="literal">message</code> field from an Apache
log. This field contains an IP address, but also other data that you don&#8217;t need.</p>
<p>You can add the <code class="literal">message</code> field to your index mappings as a <code class="literal">wildcard</code> to accept
pretty much any data you want to put in that field.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001/
{
  "mappings": {
    "properties": {
      "message": {
        "type": "wildcard"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/38.console"></div>
<p>You can then define a runtime script with a grok pattern that extracts
structured fields out of the <code class="literal">message</code> field.</p>
<p>The script matches on the <code class="literal">%{COMMONAPACHELOG}</code> log pattern, which understands
the structure of Apache logs. If the pattern matches, the script emits the
value matching the IP address. If the pattern doesn’t match
(<code class="literal">clientip != null</code>), the script just returns the field value without crashing.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": """
      String clientip=grok('%{COMMONAPACHELOG}').extract(doc["message"].value)?.clientip;
      if (clientip != null) emit(clientip);
    """
  },
  "context": "ip_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "message": "40.135.0.0 - - [30/Apr/2020:14:30:17 -0500] \"GET /images/hm_bg.jpg HTTP/1.0\" 200 24736"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/39.console"></div>
<p>The response includes only the IP address, ignoring all of the other data in the
<code class="literal">message</code> field.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : [
    "40.135.0.0"
  ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="painless-runtime-keyword"></a><code class="literal">keyword_field</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<p><a href="/guide/en/elasticsearch/reference/8.7/keyword.html" class="ulink" target="_top">Keyword fields</a> are often used in sorting, aggregations, and
term-level queries.</p>
<p>Let&#8217;s say you have a timestamp. You want to calculate the day of the week based
on that value and return it, such as <code class="literal">Thursday</code>. The following request adds a
<code class="literal">@timestamp</code> field of type <code class="literal">date</code> to the index mappings:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001
{
  "mappings": {
    "properties": {
      "@timestamp": {
        "type": "date"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/40.console"></div>
<p>To return the equivalent day of week based on your timestamp, you can create a
script in the <code class="literal">keyword_field</code> runtime field context:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": """
      emit(doc['@timestamp'].value.dayOfWeekEnum.getDisplayName(TextStyle.FULL, Locale.ROOT));
    """
  },
  "context": "keyword_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "@timestamp": "2020-04-30T14:31:43-05:00"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/41.console"></div>
<p>The script operates on the value provided for the <code class="literal">@timestamp</code> field to
calculate and return the day of the week:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : [
    "Thursday"
  ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="painless-runtime-long"></a><code class="literal">long_field</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<p>Let&#8217;s say you have sensor data that a <code class="literal">measures</code> object. This object includes
a <code class="literal">start</code> and <code class="literal">end</code> field, and you want to calculate the difference between
those values.</p>
<p>The following request adds a <code class="literal">measures</code> object to the mappings with two fields,
both of type <code class="literal">long</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001/
{
  "mappings": {
    "properties": {
      "measures": {
        "properties": {
          "start": {
            "type": "long"
          },
          "end": {
           "type": "long"
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/42.console"></div>
<p>You can then define a script that assigns values to the <code class="literal">start</code> and <code class="literal">end</code> fields
and operate on them. The following script extracts the value for the <code class="literal">end</code>
field from the <code class="literal">measures</code> object and subtracts it from the <code class="literal">start</code> field:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": """
      emit(doc['measures.end'].value - doc['measures.start'].value);
    """
  },
  "context": "long_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "measures": {
        "voltage": "4.0",
        "start": "400",
        "end": "8625309"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/43.console"></div>
<p>The response includes the calculated value from the script valuation:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : [
    8624909
  ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="painless-runtime-composite"></a><code class="literal">composite_field</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/painless/painless-guide/painless-execute-script.asciidoc">edit</a></h4>
</div></div></div>
<p>Let&#8217;s say you have logging data with a raw <code class="literal">message</code> field which you want to split
in multiple sub-fields that can be accessed separately.</p>
<p>The following request adds a <code class="literal">message</code> field to the mappings of type <code class="literal">keyword</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001/
{
  "mappings": {
    "properties": {
      "message": {
        "type" : "keyword"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/44.console"></div>
<p>You can then define a script that splits such message field into subfields using
the grok function:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_scripts/painless/_execute
{
  "script": {
    "source": "emit(grok(\"%{COMMONAPACHELOG}\").extract(doc[\"message\"].value));"
  },
  "context": "composite_field",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "timestamp":"2020-04-30T14:31:27-05:00",
      "message":"252.0.0.0 - - [30/Apr/2020:14:31:27 -0500] \"GET /images/hm_bg.jpg HTTP/1.0\" 200 24736"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/45.console"></div>
<p>The response includes the values that the script emitted:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "result" : {
    "composite_field.timestamp" : [
      "30/Apr/2020:14:31:27 -0500"
    ],
    "composite_field.auth" : [
      "-"
    ],
    "composite_field.response" : [
      "200"
    ],
    "composite_field.ident" : [
      "-"
    ],
    "composite_field.httpversion" : [
      "1.0"
    ],
    "composite_field.verb" : [
      "GET"
    ],
    "composite_field.bytes" : [
      "24736"
    ],
    "composite_field.clientip" : [
      "252.0.0.0"
    ],
    "composite_field.request" : [
      "/images/hm_bg.jpg"
    ]
  }
}</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="painless-debugging.html">« Painless Debugging</a>
</span>
<span class="next">
<a href="painless-ingest.html">Using ingest processors in Painless »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
