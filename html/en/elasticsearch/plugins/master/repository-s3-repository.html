<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Repository Settings | Elasticsearch Plugins and Integrations [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Plugins and Integrations [master]"/>
<link rel="up" href="repository-s3.html" title="S3 Repository Plugin"/>
<link rel="prev" href="repository-s3-client.html" title="Client Settings"/>
<link rel="next" href="repository-hdfs.html" title="Hadoop HDFS Repository Plugin"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Plugins/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Plugins and Integrations [master]</a></span>
»
<span class="breadcrumb-link"><a href="repository.html">Snapshot/Restore Repository Plugins</a></span>
»
<span class="breadcrumb-link"><a href="repository-s3.html">S3 Repository Plugin</a></span>
»
<span class="breadcrumb-node">Repository Settings</span>
</div>
<div class="navheader">
<span class="prev">
<a href="repository-s3-client.html">« Client Settings</a>
</span>
<span class="next">
<a href="repository-hdfs.html">Hadoop HDFS Repository Plugin »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="repository-s3-repository"></a>Repository Settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/repository-s3.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">s3</code> repository type supports a number of settings to customize how data is
stored in S3. These can be specified when creating the repository. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _snapshot/my_s3_repository
{
  "type": "s3",
  "settings": {
    "bucket": "my-bucket",
    "another_setting": "setting-value"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/49.console"></div>
<p>The following settings are supported:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">bucket</code>
</span>
</dt>
<dd>
<p>
(Required)
Name of the S3 bucket to use for snapshots.
</p>
<p>The bucket name must adhere to Amazon&#8217;s
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/BucketRestrictions.html#bucketnamingrules" class="ulink" target="_top">S3
bucket naming rules</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">client</code>
</span>
</dt>
<dd>
The name of the <a class="xref" href="repository-s3-client.html" title="Client Settings">S3 client</a> to use to connect to S3.
Defaults to <code class="literal">default</code>.
</dd>
<dt>
<span class="term">
<code class="literal">base_path</code>
</span>
</dt>
<dd>
Specifies the path to the repository data within its bucket. Defaults to an
empty string, meaning that the repository is at the root of the bucket. The
value of this setting should not start or end with a <code class="literal">/</code>.
</dd>
<dt>
<span class="term">
<code class="literal">chunk_size</code>
</span>
</dt>
<dd>
Big files can be broken down into chunks during snapshotting if needed.
Specify the chunk size as a value and unit, for example:
<code class="literal">1TB</code>, <code class="literal">1GB</code>, <code class="literal">10MB</code>. Defaults to the maximum size of a blob in the S3 which is <code class="literal">5TB</code>.
</dd>
<dt>
<span class="term">
<code class="literal">compress</code>
</span>
</dt>
<dd>
When set to <code class="literal">true</code> metadata files are stored in compressed format. This
setting doesn&#8217;t affect index files that are already compressed by default.
Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">max_restore_bytes_per_sec</code>
</span>
</dt>
<dd>
Throttles per node restore rate. Defaults to unlimited.
Note that restores are also throttled through <a href="/guide/en/elasticsearch/reference/master/recovery.html" class="ulink" target="_top">recovery settings</a>.
</dd>
<dt>
<span class="term">
<code class="literal">max_snapshot_bytes_per_sec</code>
</span>
</dt>
<dd>
Throttles per node snapshot rate. Defaults to <code class="literal">40mb</code> per second.
</dd>
<dt>
<span class="term">
<code class="literal">readonly</code>
</span>
</dt>
<dd>
Makes repository read-only.  Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">server_side_encryption</code>
</span>
</dt>
<dd>
When set to <code class="literal">true</code> files are encrypted on server side using AES256
algorithm. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">buffer_size</code>
</span>
</dt>
<dd>
Minimum threshold below which the chunk is uploaded using a single request.
Beyond this threshold, the S3 repository will use the
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/uploadobjusingmpu.html" class="ulink" target="_top">AWS
Multipart Upload API</a> to split the chunk into several parts, each of
<code class="literal">buffer_size</code> length, and to upload each part in its own request. Note that
setting a buffer size lower than <code class="literal">5mb</code> is not allowed since it will prevent
the use of the Multipart API and may result in upload errors. It is also not
possible to set a buffer size greater than <code class="literal">5gb</code> as it is the maximum upload
size allowed by S3. Defaults to the minimum between <code class="literal">100mb</code> and <code class="literal">5%</code> of the
heap size.
</dd>
<dt>
<span class="term">
<code class="literal">canned_acl</code>
</span>
</dt>
<dd>
The S3 repository supports all
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl" class="ulink" target="_top">S3
canned ACLs</a> : <code class="literal">private</code>, <code class="literal">public-read</code>, <code class="literal">public-read-write</code>,
<code class="literal">authenticated-read</code>, <code class="literal">log-delivery-write</code>, <code class="literal">bucket-owner-read</code>,
<code class="literal">bucket-owner-full-control</code>. Defaults to <code class="literal">private</code>.  You could specify a
canned ACL using the <code class="literal">canned_acl</code> setting. When the S3 repository creates
buckets and objects, it adds the canned ACL into the buckets and objects.
</dd>
<dt>
<span class="term">
<code class="literal">storage_class</code>
</span>
</dt>
<dd>
Sets the S3 storage class for objects stored in the snapshot repository.
Values may be <code class="literal">standard</code>, <code class="literal">reduced_redundancy</code>, <code class="literal">standard_ia</code>, <code class="literal">onezone_ia</code>
and <code class="literal">intelligent_tiering</code>. Defaults to <code class="literal">standard</code>.
Changing this setting on an existing repository only affects the
storage class for newly created objects, resulting in a mixed usage of
storage classes. Additionally, S3 Lifecycle Policies can be used to manage
the storage class of existing objects.  Due to the extra complexity with the
Glacier class lifecycle, it is not currently supported by the plugin.  For
more information about the different classes, see
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-class-intro.html" class="ulink" target="_top">AWS
Storage Classes Guide</a>
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The option of defining client settings in the repository settings as
documented below is considered deprecated, and will be removed in a future
version.</p>
</div>
</div>
<p>In addition to the above settings, you may also specify all non-secure client
settings in the repository settings.  In this case, the client settings found in
the repository settings will be merged with those of the named client used by
the repository.  Conflicts between client and repository settings are resolved
by the repository settings taking precedence over client settings.</p>
<p>For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _snapshot/my_s3_repository
{
  "type": "s3",
  "settings": {
    "client": "my-client",
    "bucket": "my-bucket",
    "endpoint": "my.s3.endpoint"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/50.console"></div>
<p>This sets up a repository that uses all client settings from the client
<code class="literal">my_client_name</code> except for the <code class="literal">endpoint</code> that is overridden to
<code class="literal">my.s3.endpoint</code> by the repository settings.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="repository-s3-permissions"></a>Recommended S3 Permissions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/repository-s3.asciidoc">edit</a></h4>
</div></div></div>
<p>In order to restrict the Elasticsearch snapshot process to the minimum required
resources, we recommend using Amazon IAM in conjunction with pre-existing S3
buckets. Here is an example policy which will allow the snapshot access to an S3
bucket named "snaps.example.com". This may be configured through the AWS IAM
console, by creating a Custom Policy, and using a Policy Document similar to
this (changing snaps.example.com to your bucket name).</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "Statement": [
    {
      "Action": [
        "s3:ListBucket",
        "s3:GetBucketLocation",
        "s3:ListBucketMultipartUploads",
        "s3:ListBucketVersions"
      ],
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::snaps.example.com"
      ]
    },
    {
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject",
        "s3:AbortMultipartUpload",
        "s3:ListMultipartUploadParts"
      ],
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::snaps.example.com/*"
      ]
    }
  ],
  "Version": "2012-10-17"
}</pre>
</div>
<p>You may further restrict the permissions by specifying a prefix within the
bucket, in this example, named "foo".</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "Statement": [
    {
      "Action": [
        "s3:ListBucket",
        "s3:GetBucketLocation",
        "s3:ListBucketMultipartUploads",
        "s3:ListBucketVersions"
      ],
      "Condition": {
        "StringLike": {
          "s3:prefix": [
            "foo/*"
          ]
        }
      },
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::snaps.example.com"
      ]
    },
    {
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject",
        "s3:AbortMultipartUpload",
        "s3:ListMultipartUploadParts"
      ],
      "Effect": "Allow",
      "Resource": [
        "arn:aws:s3:::snaps.example.com/foo/*"
      ]
    }
  ],
  "Version": "2012-10-17"
}</pre>
</div>
<p>The bucket needs to exist to register a repository for snapshots. If you did not
create the bucket then the repository registration will fail.</p>
<h4><a id="repository-s3-aws-vpc"></a>AWS VPC Bandwidth Settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/repository-s3.asciidoc">edit</a></h4>
<p>AWS instances resolve S3 endpoints to a public IP. If the Elasticsearch
instances reside in a private subnet in an AWS VPC then all traffic to S3 will
go through the VPC&#8217;s NAT instance. If your VPC&#8217;s NAT instance is a smaller
instance size (e.g. a t2.micro) or is handling a high volume of network traffic
your bandwidth to S3 may be limited by that NAT instance&#8217;s networking bandwidth
limitations. Instead we recommend creating a <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints.html" class="ulink" target="_top">VPC endpoint</a>
that enables connecting to S3 in instances that reside in a private subnet in
an AWS VPC. This will eliminate any limitations imposed by the network
bandwidth of your VPC&#8217;s NAT instance.</p>
<p>Instances residing in a public subnet in an AWS VPC will connect to S3 via the
VPC&#8217;s internet gateway and not be bandwidth limited by the VPC&#8217;s NAT instance.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="repository-s3-client.html">« Client Settings</a>
</span>
<span class="next">
<a href="repository-hdfs.html">Hadoop HDFS Repository Plugin »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
