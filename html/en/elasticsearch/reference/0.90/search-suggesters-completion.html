<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Completion Suggester | Reference [0.90] | Elastic</title>
<link rel="home" href="index.html" title="Reference [0.90]"/>
<link rel="up" href="search-suggesters.html" title="Suggesters"/>
<link rel="prev" href="search-suggesters-phrase.html" title="Phrase Suggester"/>
<link rel="next" href="search-multi-search.html" title="Multi Search API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/0.90"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="0.90"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<p>
  <strong>WARNING</strong>: Version 0.90 of Elasticsearch has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Reference [0.90]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="search.html">Search APIs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="search-suggesters.html">Suggesters</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="search-suggesters-phrase.html">« Phrase Suggester</a>
</span>
<span class="next">
<a href="search-multi-search.html">Multi Search API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-suggesters-completion"></a>Completion Suggester<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/0.90/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h2>
</div></div></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Added in 0.90.3.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In order to understand the format of suggestions, please
read the <a class="xref" href="search-suggesters.html" title="Suggesters"><em>Suggesters</em></a> page first.</p>
</div>
</div>
<p>The <code class="literal">completion</code> suggester is a so-called prefix suggester. It does not
do spell correction like the <code class="literal">term</code> or <code class="literal">phrase</code> suggesters but allows
basic <code class="literal">auto-complete</code> functionality.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature is marked as experimental. This means, that
the API is not considered stable, and that you might need to reindex
your data after an upgrade in order to get suggestions up and running
again. Please keep this in mind.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_why_another_suggester_why_not_prefix_queries"></a>Why another suggester? Why not prefix queries?<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/0.90/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h3>
</div></div></div>
<p>The first question which comes to mind when reading about a prefix
suggestion is, why you should use it all, if you have prefix queries
already. The answer is simple: Prefix suggestions are fast.</p>
<p>The data structures are internally backed by Lucenes
<code class="literal">AnalyzingSuggester</code>, which uses FSTs to execute suggestions. Usually
these data structures are costly to create, stored in-memory and need to
be rebuilt every now and then to reflect changes in your indexed
documents. The <code class="literal">completion</code> suggester circumvents this by storing the
FST as part of your index during index time. This allows for really fast
loads and executions.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="completion-suggester-mapping"></a>Mapping<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/0.90/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h3>
</div></div></div>
<p>In order to use this feature, you have to specify a special mapping for
this field, which enables the special storage of the field.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">curl -X PUT localhost:9200/music
curl -X PUT localhost:9200/music/song/_mapping -d '{
  "song" : {
        "properties" : {
            "name" : { "type" : "string" },
            "suggest" : { "type" : "completion",
                          "index_analyzer" : "simple",
                          "search_analyzer" : "simple",
                          "payloads" : true
            }
        }
    }
}'</pre>
</div>
<p>Mapping supports the following parameters:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index_analyzer</code>
</span>
</dt>
<dd>
The index analyzer to use, defaults to <code class="literal">simple</code>.
</dd>
<dt>
<span class="term">
<code class="literal">search_analyzer</code>
</span>
</dt>
<dd>
The search analyzer to use, defaults to <code class="literal">simple</code>.
In case you are wondering why we did not opt for the <code class="literal">standard</code>
analyzer: We try to have easy to understand behaviour here, and if you
index the field content <code class="literal">At the Drive-in</code>, you will not get any
suggestions for <code class="literal">a</code>, nor for <code class="literal">d</code> (the first non stopword).
</dd>
<dt>
<span class="term">
<code class="literal">payloads</code>
</span>
</dt>
<dd>
Enables the storing of payloads, defaults to <code class="literal">false</code>
</dd>
<dt>
<span class="term">
<code class="literal">preserve_separators</code>
</span>
</dt>
<dd>
Preserves the separators, defaults to <code class="literal">true</code>.
If disabled, you could find a field starting with <code class="literal">Foo Fighters</code>, if you
suggest for <code class="literal">foof</code>.
</dd>
<dt>
<span class="term">
<code class="literal">preserve_position_increments</code>
</span>
</dt>
<dd>
Enables position increments, defaults
to <code class="literal">true</code>. If disabled and using stopwords analyzer, you could get a
field starting with <code class="literal">The Beatles</code>, if you suggest for <code class="literal">b</code>. <span class="strong strong"><strong>Note</strong></span>: You
could also achieve this by indexing two inputs, <code class="literal">Beatles</code> and
<code class="literal">The Beatles</code>, no need to change a simple analyzer, if you are able to
enrich your data.
</dd>
<dt>
<span class="term">
<code class="literal">max_input_len</code>
</span>
</dt>
<dd>
Limits the length of a single input, defaults to <code class="literal">50</code> UTF-16 code points.
This limit is only used at index time to reduce the total number of
characters per input string in order to prevent massive inputs from
bloating the underlying datastructure. The most usecases won&#8217;t be influenced
by the default value since prefix completions hardly grow beyond prefixes longer
than a handful of characters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="indexing"></a>Indexing<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/0.90/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">curl -X PUT 'localhost:9200/music/song/1?refresh=true' -d '{
    "name" : "Nevermind",
    "suggest" : {
        "input": [ "Nevermind", "Nirvana" ],
        "output": "Nirvana - Nevermind",
        "payload" : { "artistId" : 2321 },
        "weight" : 34
    }
}'</pre>
</div>
<p>The following parameters are supported:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">input</code>
</span>
</dt>
<dd>
The input to store, this can be a an array of strings or just
a string. This field is mandatory.
</dd>
<dt>
<span class="term">
<code class="literal">output</code>
</span>
</dt>
<dd>
The string to return, if a suggestion matches. This is very
useful to normalize outputs (i.e. have them always in the format
<code class="literal">artist - songname</code>). The result is de-duplicated if several documents
have the same output, i.e. only one is returned as part of the
suggest result. This is optional.
</dd>
<dt>
<span class="term">
<code class="literal">payload</code>
</span>
</dt>
<dd>
An arbitrary JSON object, which is simply returned in the
suggest option. You could store data like the id of a document, in order
to load it from elasticsearch without executing another search (which
might not yield any results, if <code class="literal">input</code> and <code class="literal">output</code> differ strongly).
</dd>
<dt>
<span class="term">
<code class="literal">weight</code>
</span>
</dt>
<dd>
A positive integer, which defines a weight and allows you to
rank your suggestions. This field is optional.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Even though you are losing most of the features of the
completion suggest, you can opt in for the shortest form, which even
allows you to use inside of multi_field. But keep in mind, that you will
not be able to use several inputs, an output, payloads or weights.</p>
</div>
</div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "suggest" : "Nirvana"
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The suggest data structure might not reflect deletes on
documents immediately. You may need to do an <a class="xref" href="indices-optimize.html" title="Optimize"><em>Optimize</em></a> for that.
You can call optimize with the <code class="literal">only_expunge_deletes=true</code> to only cater for deletes
or alternatively call a <a class="xref" href="index-modules-merge.html" title="Merge"><em>Merge</em></a> operation.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="querying"></a>Querying<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/0.90/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h3>
</div></div></div>
<p>Suggesting works as usual, except that you have to specify the suggest
type as <code class="literal">completion</code>.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest"
        }
    }
}'

{
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "song-suggest" : [ {
    "text" : "n",
    "offset" : 0,
    "length" : 4,
    "options" : [ {
      "text" : "Nirvana - Nevermind",
      "score" : 34.0, "payload" : {"artistId":2321}
    } ]
  } ]
}</pre>
</div>
<p>As you can see, the payload is included in the response, if configured
appropriately. If you configured a weight for a suggestion, this weight
is used as <code class="literal">score</code>. Also the <code class="literal">text</code> field uses the <code class="literal">output</code> of your
indexed suggestion, if configured, otherwise the matched part of the
<code class="literal">input</code> field.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="fuzzy"></a>Fuzzy queries<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/0.90/docs/reference/search/suggesters/completion-suggest.asciidoc">edit</a></h3>
</div></div></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Added in 0.90.4.</p>
</div>
</div>
<p>The completion suggester also supports fuzzy queries - this means,
you can actually have a typo in your search and still get results back.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest",
            "fuzzy" : {
                "edit_distance" : 2
            }
        }
    }
}'</pre>
</div>
<p>The fuzzy query can take specific fuzzy parameters.
The following parameters are supported:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">edit_distance</code>
</p>
</td>
<td valign="top">
<p>
Maximum edit distance, defaults to <code class="literal">1</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">transpositions</code>
</p>
</td>
<td valign="top">
<p>
Sets if transpositions should be counted
as one or two changes, defaults to <code class="literal">true</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">min_length</code>
</p>
</td>
<td valign="top">
<p>
Minimum length of the input before fuzzy
suggestions are returned, defaults <code class="literal">3</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td>
<td valign="top">
<p>
Minimum length of the input, which is not
checked for fuzzy alternatives, defaults to <code class="literal">1</code>
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">unicode_aware</code>
</p>
</td>
<td valign="top">
<p>
Sets all are measurements (like edit distance,
transpositions and lengths) in unicode code points
(actual letters) instead of bytes.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you want to stick with the default values, but
      still use fuzzy, you can either use <code class="literal">fuzzy: {}</code>
      or <code class="literal">fuzzy: true</code>.</p>
</div>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="search-suggesters-phrase.html">« Phrase Suggester</a>
</span>
<span class="next">
<a href="search-multi-search.html">Multi Search API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
