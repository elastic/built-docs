<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>fielddata | Elasticsearch Reference [6.2] | Elastic</title>
<meta class="elastic" name="content" content="fielddata | Elasticsearch Reference [6.2]">

<link rel="home" href="index.html" title="Elasticsearch Reference [6.2]"/>
<link rel="up" href="mapping-params.html" title="Mapping parameters"/>
<link rel="prev" href="eager-global-ordinals.html" title="eager_global_ordinals"/>
<link rel="next" href="mapping-date-format.html" title="format"/>
<meta class="elastic" name="product_version" content="6.2"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/6.2"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="6.2"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="icon" href="/favicon.ico" sizes="32x32"/>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml"/>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
<p>
  <strong>WARNING</strong>: Version 6.2 of Elasticsearch has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div class="navheader">
<span class="prev">
<a href="eager-global-ordinals.html">« <code class="literal">eager_global_ordinals</code></a>
</span>
<span class="next">
<a href="mapping-date-format.html"><code class="literal">format</code> »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [6.2]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="mapping-params.html">Mapping parameters</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>fielddata</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.2/docs/reference/mapping/params/fielddata.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/text">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="fielddata"></a><code class="literal">fielddata</code></h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.2/docs/reference/mapping/params/fielddata.asciidoc">edit</a></div>
</div></div></div>
<p>Most fields are <a class="xref" href="mapping-index.html" title="index">indexed</a> by default, which makes them
searchable. Sorting, aggregations, and accessing field values in scripts,
however, requires a different access pattern from search.</p>
<p>Search needs to answer the question <em>"Which documents contain this term?"</em>,
while sorting and aggregations need to answer a different question: <em>"What is
the value of this field for <span class="strong strong"><strong>this</strong></span> document?"</em>.</p>
<p>Most fields can use index-time, on-disk <a class="xref" href="doc-values.html" title="doc_values"><code class="literal">doc_values</code></a> for this
data access pattern, but <a class="xref" href="text.html" title="Text datatype"><code class="literal">text</code></a> fields do not support <code class="literal">doc_values</code>.</p>
<p>Instead, <code class="literal">text</code> fields use a query-time <span class="strong strong"><strong>in-memory</strong></span> data structure called
<code class="literal">fielddata</code>.  This data structure is built on demand the first time that a
field is used for aggregations, sorting, or in a script.  It is built by
reading the entire inverted index for each segment from disk, inverting the
term ↔︎ document relationship, and storing the result in memory, in the JVM
heap.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="fielddata-disabled-text-fields"></a>Fielddata is disabled on <code class="literal">text</code> fields by default</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.2/docs/reference/mapping/params/fielddata.asciidoc">edit</a></div>
</div></div></div>
<p>Fielddata can consume a <span class="strong strong"><strong>lot</strong></span> of heap space, especially when loading high
cardinality <code class="literal">text</code> fields.  Once fielddata has been loaded into the heap, it
remains there for the lifetime of the segment. Also, loading fielddata is an
expensive process which can cause users to experience latency hits.  This is
why fielddata is disabled by default.</p>
<p>If you try to sort, aggregate, or access values from a script on a <code class="literal">text</code>
field, you will see this exception:</p>
<div class="quoteblock">
<blockquote>
<p>Fielddata is disabled on text fields by default.  Set <code class="literal">fielddata=true</code> on
[<code class="literal">your_field_name</code>] in order to load  fielddata in memory by uninverting the
inverted index. Note that this can however use significant memory.</p>
</blockquote>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="before-enabling-fielddata"></a>Before enabling fielddata</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.2/docs/reference/mapping/params/fielddata.asciidoc">edit</a></div>
</div></div></div>
<p>Before you enable fielddata, consider why you are using a <code class="literal">text</code> field for
aggregations, sorting, or in a script.  It usually doesn&#8217;t make sense to do
so.</p>
<p>A text field is analyzed before indexing so that a value like
<code class="literal">New York</code> can be found by searching for <code class="literal">new</code> or for <code class="literal">york</code>.  A <code class="literal">terms</code>
aggregation on this field will return a <code class="literal">new</code> bucket and a <code class="literal">york</code> bucket, when
you probably want a single bucket called <code class="literal">New York</code>.</p>
<p>Instead, you should have a <code class="literal">text</code> field for full text searches, and an
unanalyzed <a class="xref" href="keyword.html" title="Keyword datatype"><code class="literal">keyword</code></a> field with <a class="xref" href="doc-values.html" title="doc_values"><code class="literal">doc_values</code></a>
enabled for aggregations, as follows:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "my_field": { <a id="CO265-1"></a><i class="conum" data-value="1"></i>
          "type": "text",
          "fields": {
            "keyword": { <a id="CO265-2"></a><i class="conum" data-value="2"></i>
              "type": "keyword"
            }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1031.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO265-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use the <code class="literal">my_field</code> field for searches.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO265-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use the <code class="literal">my_field.keyword</code> field for aggregations, sorting, or in scripts.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="enable-fielddata-text-fields"></a>Enabling fielddata on <code class="literal">text</code> fields</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.2/docs/reference/mapping/params/fielddata.asciidoc">edit</a></div>
</div></div></div>
<p>You can enable fielddata on an existing <code class="literal">text</code> field using the
<a class="xref" href="indices-put-mapping.html" title="Put Mapping">PUT mapping API</a> as follows:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT my_index/_mapping/_doc
{
  "properties": {
    "my_field": { <a id="CO266-1"></a><i class="conum" data-value="1"></i>
      "type":     "text",
      "fielddata": true
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1032.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO266-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The mapping that you specify for <code class="literal">my_field</code> should consist of the existing
mapping for that field, plus the <code class="literal">fielddata</code> parameter.</p>
</td>
</tr>
</table>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">fielddata.*</code> parameter must have the same settings for fields of the
same name in the same index.  Its value can be updated on existing fields
using the <a class="xref" href="indices-put-mapping.html" title="Put Mapping">PUT mapping API</a>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="field-data-filtering"></a><code class="literal">fielddata_frequency_filter</code></h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.2/docs/reference/mapping/params/fielddata.asciidoc">edit</a></div>
</div></div></div>
<p>Fielddata filtering can be used to reduce the number of terms loaded into
memory, and thus reduce memory usage. Terms can be filtered by <em>frequency</em>:</p>
<p>The frequency filter allows you to only load terms whose document frequency falls
between a <code class="literal">min</code> and <code class="literal">max</code> value, which can be expressed an absolute
number (when the number is bigger than 1.0) or as a percentage
(eg <code class="literal">0.01</code> is <code class="literal">1%</code> and <code class="literal">1.0</code> is <code class="literal">100%</code>). Frequency is calculated
<span class="strong strong"><strong>per segment</strong></span>. Percentages are based on the number of docs which have a
value for the field, as opposed to all docs in the segment.</p>
<p>Small segments can be excluded completely by specifying the minimum
number of docs that the segment should contain with <code class="literal">min_segment_size</code>:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "tag": {
          "type": "text",
          "fielddata": true,
          "fielddata_frequency_filter": {
            "min": 0.001,
            "max": 0.1,
            "min_segment_size": 500
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1033.console"></div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="eager-global-ordinals.html">« <code class="literal">eager_global_ordinals</code></a>
</span>
<span class="next">
<a href="mapping-date-format.html"><code class="literal">format</code> »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
