<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>join datatype
        | Elasticsearch Reference [6.6]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [6.6]" /><link rel="up" href="mapping-types.html" title="Field datatypes" /><link rel="prev" href="percolator.html" title="Percolator type" /><link rel="next" href="mapping-fields.html" title="Meta-Fields" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/6.6" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="6.6" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [6.6]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-types.html">Field datatypes</a></span> » <span class="breadcrumb-node"><code class="literal">join</code> datatype</span></div><div class="navheader"><span class="prev"><a href="percolator.html">
              « 
              Percolator type</a>
           
        </span><span class="next">
           
          <a href="mapping-fields.html">Meta-Fields
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="parent-join"></a><code class="literal">join</code> datatype<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/mapping/types/parent-join.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">join</code> datatype is a special field that creates
parent/child relation within documents of the same index.
The <code class="literal">relations</code> section defines a set of possible relations within the documents,
each relation being a parent name and a child name.
A parent/child relation can be defined as follows:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "my_join_field": { <a id="CO256-1"></a><i class="conum" data-value="1"></i>
          "type": "join",
          "relations": {
            "question": "answer" <a id="CO256-2"></a><i class="conum" data-value="2"></i>
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1036.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO256-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The name for the field</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO256-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Defines a single relation where <code class="literal">question</code> is parent of <code class="literal">answer</code>.</p></td></tr></table></div><p>To index a document with a join, the name of the relation and the optional parent
of the document must be provided in the <code class="literal">source</code>.
For instance the following example creates two <code class="literal">parent</code> documents in the <code class="literal">question</code> context:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index/_doc/1?refresh
{
  "text": "This is a question",
  "my_join_field": {
    "name": "question" <a id="CO257-1"></a><i class="conum" data-value="1"></i>
  }
}

PUT my_index/_doc/2?refresh
{
  "text": "This is another question",
  "my_join_field": {
    "name": "question"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1037.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO257-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>This document is a <code class="literal">question</code> document.</p></td></tr></table></div><p>When indexing parent documents, you can choose to specify just the name of the relation
as a shortcut instead of encapsulating it in the normal object notation:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index/_doc/1?refresh
{
  "text": "This is a question",
  "my_join_field": "question" <a id="CO258-1"></a><i class="conum" data-value="1"></i>
}

PUT my_index/_doc/2?refresh
{
  "text": "This is another question",
  "my_join_field": "question"
}</pre></div><div class="console_widget" data-snippet="snippets/1038.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO258-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Simpler notation for a parent document just uses the relation name.</p></td></tr></table></div><p>When indexing a child, the name of the relation as well as the parent id of the document
must be added in the <code class="literal">_source</code>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>It is required to index the lineage of a parent in the same shard so you must
always route child documents using their greater parent id.</p></div></div><p>For instance the following example shows how to index two <code class="literal">child</code> documents:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index/_doc/3?routing=1&amp;refresh <a id="CO259-1"></a><i class="conum" data-value="1"></i>
{
  "text": "This is an answer",
  "my_join_field": {
    "name": "answer", <a id="CO259-2"></a><i class="conum" data-value="2"></i>
    "parent": "1" <a id="CO259-3"></a><i class="conum" data-value="3"></i>
  }
}

PUT my_index/_doc/4?routing=1&amp;refresh
{
  "text": "This is another answer",
  "my_join_field": {
    "name": "answer",
    "parent": "1"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1039.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO259-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The routing value is mandatory because parent and child documents must be indexed on the same shard</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO259-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p><code class="literal">answer</code> is the name of the join for this document</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO259-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>The parent id of this child document</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_parent_join_and_performance"></a>Parent-join and performance.<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/mapping/types/parent-join.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The join field shouldn’t be used like joins in a relation database. In Elasticsearch the key to good performance
is to de-normalize your data into documents. Each join field, <code class="literal">has_child</code> or <code class="literal">has_parent</code> query adds a
significant tax to your query performance.</p><p>The only case where the join field makes sense is if your data contains a one-to-many relationship where
one entity significantly outnumbers the other entity. An example of such case is a use case with products
and offers for these products. In the case that offers significantly outnumbers the number of products then
it makes sense to model the product as parent document and the offer as child document.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_parent_join_restrictions"></a>Parent-join restrictions<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/mapping/types/parent-join.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Only one <code class="literal">join</code> field mapping is allowed per index.</li><li class="listitem">Parent and child documents must be indexed on the same shard.
This means that the same <code class="literal">routing</code> value needs to be provided when
<a class="link" href="docs-get.html" title="Get API">getting</a>, <a class="link" href="docs-delete.html" title="Delete API">deleting</a>, or <a class="link" href="docs-update.html" title="Update API">updating</a>
a child document.</li><li class="listitem">An element can have multiple children but only one parent.</li><li class="listitem">It is possible to add a new relation to an existing <code class="literal">join</code> field.</li><li class="listitem">It is also possible to add a child to an existing element
but only if the element is already a parent.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_searching_with_parent_join"></a>Searching with parent-join<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/mapping/types/parent-join.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The parent-join creates one field to index the name of the relation
within the document (<code class="literal">my_parent</code>, <code class="literal">my_child</code>, …​).</p><p>It also creates one field per parent/child relation.
The name of this field is the name of the <code class="literal">join</code> field followed by <code class="literal">#</code> and the
name of the parent in the relation.
So for instance for the <code class="literal">my_parent</code> ⇒ [<code class="literal">my_child</code>, <code class="literal">another_child</code>] relation,
the <code class="literal">join</code> field creates an additional field named <code class="literal">my_join_field#my_parent</code>.</p><p>This field contains the parent <code class="literal">_id</code> that the document links to
if the document is a child (<code class="literal">my_child</code> or <code class="literal">another_child</code>) and the <code class="literal">_id</code> of
document if it’s a parent (<code class="literal">my_parent</code>).</p><p>When searching an index that contains a <code class="literal">join</code> field, these two fields are always
returned in the search response:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "match_all": {}
  },
  "sort": ["_id"]
}</pre></div><div class="console_widget" data-snippet="snippets/1040.console"></div><p>Will return:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
    ...,
    "hits": {
        "total": 4,
        "max_score": null,
        "hits": [
            {
                "_index": "my_index",
                "_type": "_doc",
                "_id": "1",
                "_score": null,
                "_source": {
                    "text": "This is a question",
                    "my_join_field": "question" <a id="CO260-1"></a><i class="conum" data-value="1"></i>
                },
                "sort": [
                    "1"
                ]
            },
            {
                "_index": "my_index",
                "_type": "_doc",
                "_id": "2",
                "_score": null,
                "_source": {
                    "text": "This is another question",
                    "my_join_field": "question" <a id="CO260-2"></a><i class="conum" data-value="2"></i>
                },
                "sort": [
                    "2"
                ]
            },
            {
                "_index": "my_index",
                "_type": "_doc",
                "_id": "3",
                "_score": null,
                "_routing": "1",
                "_source": {
                    "text": "This is an answer",
                    "my_join_field": {
                        "name": "answer", <a id="CO260-3"></a><i class="conum" data-value="3"></i>
                        "parent": "1"  <a id="CO260-4"></a><i class="conum" data-value="4"></i>
                    }
                },
                "sort": [
                    "3"
                ]
            },
            {
                "_index": "my_index",
                "_type": "_doc",
                "_id": "4",
                "_score": null,
                "_routing": "1",
                "_source": {
                    "text": "This is another answer",
                    "my_join_field": {
                        "name": "answer",
                        "parent": "1"
                    }
                },
                "sort": [
                    "4"
                ]
            }
        ]
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO260-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>This document belongs to the <code class="literal">question</code> join</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO260-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>This document belongs to the <code class="literal">question</code> join</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO260-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>This document belongs to the <code class="literal">answer</code> join</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO260-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>The linked parent id for the child document</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_parent_join_queries_and_aggregations"></a>Parent-join queries and aggregations<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/mapping/types/parent-join.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>See the <a class="link" href="query-dsl-has-child-query.html" title="Has Child Query"><code class="literal">has_child</code></a> and
<a class="link" href="query-dsl-has-parent-query.html" title="Has Parent Query"><code class="literal">has_parent</code></a> queries,
the <a class="link" href="search-aggregations-bucket-children-aggregation.html" title="Children Aggregation"><code class="literal">children</code></a> aggregation,
and <a class="link" href="search-request-inner-hits.html#parent-child-inner-hits" title="Parent/child inner hits">inner hits</a> for more information.</p><p>The value of the <code class="literal">join</code> field is accessible in aggregations
and scripts, and may be queried with the
<a class="link" href="query-dsl-parent-id-query.html" title="Parent Id Query"><code class="literal">parent_id</code> query</a>:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "parent_id": { <a id="CO261-1"></a><i class="conum" data-value="1"></i>
      "type": "answer",
      "id": "1"
    }
  },
  "aggs": {
    "parents": {
      "terms": {
        "field": "my_join_field#question", <a id="CO261-2"></a><i class="conum" data-value="2"></i>
        "size": 10
      }
    }
  },
  "script_fields": {
    "parent": {
      "script": {
         "source": "doc['my_join_field#question']" <a id="CO261-3"></a><i class="conum" data-value="3"></i>
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1041.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO261-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Querying the <code class="literal">parent id</code> field (also see the <a class="link" href="query-dsl-has-parent-query.html" title="Has Parent Query"><code class="literal">has_parent</code> query</a> and the <a class="link" href="query-dsl-has-child-query.html" title="Has Child Query"><code class="literal">has_child</code> query</a>)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO261-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Aggregating on the <code class="literal">parent id</code> field (also see the <a class="link" href="search-aggregations-bucket-children-aggregation.html" title="Children Aggregation"><code class="literal">children</code></a> aggregation)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO261-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>Accessing the parent id` field in scripts</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_global_ordinals"></a>Global ordinals<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/mapping/types/parent-join.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">join</code> field uses <a class="link" href="eager-global-ordinals.html" title="eager_global_ordinals">global ordinals</a> to speed up joins.
Global ordinals need to be rebuilt after any change to a shard. The more
parent id values are stored in a shard, the longer it takes to rebuild the
global ordinals for the <code class="literal">join</code> field.</p><p>Global ordinals, by default, are built eagerly: if the index has changed,
global ordinals for the <code class="literal">join</code> field will be rebuilt as part of the refresh.
This can add significant time to the refresh. However most of the times this is the
right trade-off, otherwise global ordinals are rebuilt when the first parent-join
query or aggregation is used. This can introduce a significant latency spike for
your users and usually this is worse as multiple global ordinals for the <code class="literal">join</code>
field may be attempt rebuilt within a single refresh interval when many writes
are occurring.</p><p>When the <code class="literal">join</code> field is used infrequently and writes occur frequently it may
make sense to disable eager loading:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "my_join_field": {
          "type": "join",
          "relations": {
             "question": "answer"
          },
          "eager_global_ordinals": false
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1042.console"></div><p>The amount of heap used by global ordinals can be checked per parent relation
as follows:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console"># Per-index
GET _stats/fielddata?human&amp;fields=my_join_field#question

# Per-node per-index
GET _nodes/stats/indices/fielddata?human&amp;fields=my_join_field#question</pre></div><div class="console_widget" data-snippet="snippets/1043.console"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multiple_children_per_parent"></a>Multiple children per parent<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/mapping/types/parent-join.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It is also possible to define multiple children for a single parent:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "my_join_field": {
          "type": "join",
          "relations": {
            "question": ["answer", "comment"]  <a id="CO262-1"></a><i class="conum" data-value="1"></i>
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1044.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO262-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p><code class="literal">question</code> is parent of <code class="literal">answer</code> and <code class="literal">comment</code>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multiple_levels_of_parent_join"></a>Multiple levels of parent join<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/mapping/types/parent-join.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Using multiple levels of relations to replicate a relational model is not recommended.
Each level of relation adds an overhead at query time in terms of memory and computation.
You should de-normalize your data if you care about performance.</p></div></div><p>Multiple levels of parent/child:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "my_join_field": {
          "type": "join",
          "relations": {
            "question": ["answer", "comment"],  <a id="CO263-1"></a><i class="conum" data-value="1"></i>
            "answer": "vote" <a id="CO263-2"></a><i class="conum" data-value="2"></i>
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1045.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO263-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p><code class="literal">question</code> is parent of <code class="literal">answer</code> and <code class="literal">comment</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO263-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p><code class="literal">answer</code> is parent of <code class="literal">vote</code></p></td></tr></table></div><p>The mapping above represents the following tree:</p><pre class="literallayout">   question
    /    \
   /      \
comment  answer
           |
           |
          vote</pre><p>Indexing a grandchild document requires a <code class="literal">routing</code> value equals
to the grand-parent (the greater parent of the lineage):</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index/_doc/3?routing=1&amp;refresh <a id="CO264-1"></a><i class="conum" data-value="1"></i>
{
  "text": "This is a vote",
  "my_join_field": {
    "name": "vote",
    "parent": "2" <a id="CO264-2"></a><i class="conum" data-value="2"></i>
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1046.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO264-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>This child document must be on the same shard than its grand-parent and parent</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO264-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>The parent id of this document (must points to an <code class="literal">answer</code> document)</p></td></tr></table></div></div></div><div class="navfooter"><span class="prev"><a href="percolator.html">
              « 
              Percolator type</a>
           
        </span><span class="next">
           
          <a href="mapping-fields.html">Meta-Fields
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>

  
            <script type="text/javascript" src="/guide/static/docs.js"></script>

            </body>
        
</html>
