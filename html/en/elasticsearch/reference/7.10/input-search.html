<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Watcher search input | Elasticsearch Guide [7.10] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [7.10]"/>
<link rel="up" href="input.html" title="Watcher inputs"/>
<link rel="prev" href="input-simple.html" title="Watcher simple input"/>
<link rel="next" href="input-http.html" title="Watcher HTTP input"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.10"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.10"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [7.10]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="xpack-alerting.html">Watch for cluster and index events</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="input.html">Watcher inputs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="input-simple.html">« Watcher simple input</a>
</span>
<span class="next">
<a href="input-http.html">Watcher HTTP input »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="input-search"></a>Watcher search input<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/watcher/input/search.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>Use the <code class="literal">search</code> input to load the results of an Elasticsearch search request
into the execution context when the watch is triggered. See
<a class="xref" href="input-search.html#search-input-attributes" title="Search Input Attributes">Search Input Attributes</a> for all of the supported attributes.</p>
<p>In the search input&#8217;s <code class="literal">request</code> object, you specify:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The indices you want to search
</li>
<li class="listitem">
The <a class="xref" href="search-search.html#search-type">search type</a>
</li>
<li class="listitem">
The search request body
</li>
</ul>
</div>
<p>The search request body supports the full Elasticsearch Query DSL&#8212;&#8203;it&#8217;s the
same as the body of an Elasticsearch <code class="literal">_search</code> request.</p>
<p>For example, the following input retrieves all <code class="literal">event</code>
documents from the <code class="literal">logs</code> index:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input" : {
  "search" : {
    "request" : {
      "indices" : [ "logs" ],
      "body" : {
        "query" : { "match_all" : {}}
      }
    }
  }
}</pre>
</div>
<p>You can use date math and wildcards when specifying indices. For example,
the following input loads the latest VIXZ quote from today&#8217;s daily quotes index:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "&lt;stock-quotes-{now/d}&gt;" ],
        "body" : {
          "size" : 1,
          "sort" : {
            "timestamp" : { "order" : "desc"}
          },
          "query" : {
            "term" : { "symbol" : "vix"}
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_extracting_specific_fields"></a>Extracting specific fields<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<p>You can specify which fields in the search response you want to load into the
watch payload with the <code class="literal">extract</code> attribute. This is useful when a search
generates a large response and you are only interested in particular fields.</p>
<p>For example, the following input loads only the total number of hits into the
watch payload:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"input": {
    "search": {
      "request": {
        "indices": [ ".watcher-history*" ]
      },
      "extract": [ "hits.total.value" ]
    }
  },</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_using_templates"></a>Using Templates<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">search</code> input supports <a class="xref" href="search-template.html" title="Search template API">search templates</a>. For
example, the following snippet references the indexed template called
<code class="literal">my_template</code> and passes a value of 23 to fill in the template&#8217;s <code class="literal">value</code>
parameter:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "logs" ],
        "template" : {
          "id" : "my_template",
          "params" : {
            "value" : 23
          }
        }
      }
    }
  }
  ...
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_applying_conditions"></a>Applying conditions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">search</code> input is often used in conjunction with the
<a class="xref" href="condition-script.html" title="Watcher script condition"><code class="literal">script</code></a> condition. For example, the following snippet adds
a condition to check if the search returned more than five hits:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "logs" ],
        "body" : {
          "query" : { "match_all" : {} }
        }
      }
    }
  },
  "condition" : {
    "compare" : { "ctx.payload.hits.total" : { "gt" : 5 }}
  }
  ...
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_accessing_the_search_results"></a>Accessing the search results<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<p>Conditions, transforms, and actions can access the search results through the
watch execution context. For example:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To load all of the search hits into an email body, use <code class="literal">ctx.payload.hits</code>.
</li>
<li class="listitem">
To reference the total number of hits, use <code class="literal">ctx.payload.hits.total</code>.
</li>
<li class="listitem">
To access a particular hit, use its zero-based array index. For example, to
get the third hit, use <code class="literal">ctx.payload.hits.hits.2</code>.
</li>
<li class="listitem">
To get a field value from a particular hit, use
<code class="literal">ctx.payload.hits.hits.&lt;index&gt;.fields.&lt;fieldname&gt;</code>. For example, to get the
message field from the first hit, use <code class="literal">ctx.payload.hits.hits.0.fields.message</code>.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The total number of hits in the search response is returned as an object
in the response. It contains a <code class="literal">value</code>, the number of hits, and a <code class="literal">relation</code> that
indicates if the value is accurate (<code class="literal">"eq"</code>) or a lower bound of the total hits
that match the query (<code class="literal">"gte"</code>). You can set <code class="literal">track_total_hits</code> to true in
the search request to tell Elasticsearch to always track the number of hits
accurately.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="search-input-attributes"></a>Search Input Attributes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.10/x-pack/docs/en/watcher/input/search.asciidoc">edit</a></h3>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">request.search_type</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">query_then_fetch</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="search-search.html#search-type">type</a>
                                                                                    of search request to perform. Valid values are: <code class="literal">dfs_query_and_fetch</code>,
                                                                                    <code class="literal">dfs_query_then_fetch</code>, <code class="literal">query_and_fetch</code>, and <code class="literal">query_then_fetch</code>. The
                                                                                    Elasticsearch default is <code class="literal">query_then_fetch</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.indices</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The indices to search. If omitted, all indices are searched, which is the
                                                                                    default behaviour in Elasticsearch.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.body</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The body of the request. The <a class="xref" href="search-request-body.html" title="Request body search">request body</a>
                                                                                    follows the same structure you normally send in the body of a REST <code class="literal">_search</code>
                                                                                    request. The body can be static text or include <code class="literal">mustache</code> <a class="xref" href="how-watcher-works.html#templates" title="Using templates">templates</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.template</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The body of the search template. See <a class="xref" href="how-watcher-works.html#templates" title="Using templates">configure templates</a>
                                                                                    for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.indices_options.expand_wildcards</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">open</code></p></td>
<td align="left" valign="top"><p>How to expand wildcards. Valid values are: <code class="literal">all</code>, <code class="literal">open</code>, <code class="literal">closed</code>, and <code class="literal">none</code>
                                                                                    See <a class="xref" href="multi-index.html" title="Multi-target syntax"><code class="literal">expand_wildcards</code></a> for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.indices_options.ignore_unavailable</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p>Whether the search should ignore unavailable indices. See
                                                                                    <a class="xref" href="multi-index.html" title="Multi-target syntax"><code class="literal">ignore_unavailable</code></a> for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request.indices_options.allow_no_indices</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p>Whether to allow a search where a wildcard indices expression results in no
                                                                                    concrete indices. See <a class="xref" href="multi-index.html" title="Multi-target syntax">allow_no_indices</a>
                                                                                    for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">extract</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>A array of JSON keys to extract from the search response and load as the payload.
                                                                                    When a search generates a large response, you can use <code class="literal">extract</code> to select the
                                                                                    relevant fields instead of loading the entire response.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">timeout</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>30s</p></td>
<td align="left" valign="top"><p>The timeout for waiting for the search api call to return. If no response is
                                                                                    returned within this time, the search input times out and fails. This setting
                                                                                    overrides the default search operations timeouts.</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can reference the following variables in the execution context when
specifying the request <code class="literal">body</code>:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.watch_id</code></p></td>
<td align="left" valign="top"><p>The id of the watch that is currently executing.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.execution_time</code></p></td>
<td align="left" valign="top"><p>The time execution of this watch started.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.trigger.triggered_time</code></p></td>
<td align="left" valign="top"><p>The time this watch was triggered.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.trigger.scheduled_time</code></p></td>
<td align="left" valign="top"><p>The time this watch was supposed to be triggered.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ctx.metadata.*</code></p></td>
<td align="left" valign="top"><p>Any metadata associated with the watch.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="input-simple.html">« Watcher simple input</a>
</span>
<span class="next">
<a href="input-http.html">Watcher HTTP input »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
