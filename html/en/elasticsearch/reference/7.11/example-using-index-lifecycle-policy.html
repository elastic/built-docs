<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tutorial: Manage Filebeat time-based indices | Elasticsearch Reference [7.11] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.11]"/>
<link rel="up" href="index-lifecycle-management.html" title="ILM: Manage the index lifecycle"/>
<link rel="prev" href="getting-started-index-lifecycle-management.html" title="Tutorial: Automate rollover with ILM"/>
<link rel="next" href="ilm-actions.html" title="Index lifecycle actions"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.11"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.11"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.11]</a></span>
»
<span class="breadcrumb-link"><a href="index-lifecycle-management.html">ILM: Manage the index lifecycle</a></span>
»
<span class="breadcrumb-node">Tutorial: Manage Filebeat time-based indices</span>
</div>
<div class="navheader">
<span class="prev">
<a href="getting-started-index-lifecycle-management.html">« Tutorial: Automate rollover with ILM</a>
</span>
<span class="next">
<a href="ilm-actions.html">Index lifecycle actions »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="example-using-index-lifecycle-policy"></a>Tutorial: Manage Filebeat time-based indices<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.11/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>With index lifecycle management (ILM), you can create policies that perform actions automatically
on indices as they age and grow. ILM policies help you to manage
performance, resilience, and retention of your data during its lifecycle. This tutorial shows
you how to use Kibana’s <span class="strong strong"><strong>Index Lifecycle Policies</strong></span> to modify and create ILM
policies. You can learn more about all of the actions, benefits, and lifecycle
phases in the <a class="xref" href="overview-index-lifecycle-management.html" title="ILM overview">ILM overview</a>.</p>
<h3><a id="example-using-index-lifecycle-policy-scenario"></a>Scenario<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.11/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>You’re tasked with sending syslog files to an Elasticsearch cluster. This
log data has the following data retention guidelines:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Keep logs on hot data nodes for 30 days
</li>
<li class="listitem">
Roll over to a new index if the size reaches 50GB
</li>
<li class="listitem">
<p>After 30 days:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Move the logs to warm data nodes
</li>
<li class="listitem">
Set <a class="xref" href="glossary.html#glossary-replica-shard">replica shards</a> to 1
</li>
<li class="listitem">
<a class="xref" href="indices-forcemerge.html" title="Force merge API">Force merge</a> multiple index segments to free up the space used by deleted documents
</li>
</ul>
</div>
</li>
<li class="listitem">
Delete logs after 90 days
</li>
</ul>
</div>
<h3><a id="example-using-index-lifecycle-policy-prerequisites"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.11/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>To complete this tutorial, you&#8217;ll need:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>An Elasticsearch cluster with hot and warm nodes configured for shard allocation
awareness.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elasticsearch Service:
Choose the Elastic Stack and then the <a href="/guide/en/cloud/current/ec-getting-started-profiles.html#ec-getting-started-profiles-hot-warm" class="ulink" target="_top">hot-warm architecture</a> hardware profile.
</li>
<li class="listitem">
<p>Self-managed cluster:
Add node attributes as described for <a href="/guide/en/elasticsearch/reference/7.11/shard-allocation-filtering.html" class="ulink" target="_top">shard allocation filtering</a>.</p>
<p>For example, you can set this in your <code class="literal">elasticsearch.yml</code> for each data node:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">node.attr.data: "warm"</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
A server with Filebeat installed and configured to send logs to the <code class="literal">elasticsearch</code>
output as described in the <a href="/guide/en/beats/filebeat/7.11/filebeat-installation-configuration.html" class="ulink" target="_top">Filebeat quick start</a>.
</li>
</ul>
</div>
<h3><a id="example-using-index-lifecycle-policy-view-fb-ilm-policy"></a>View the Filebeat ILM policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.11/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>Filebeat includes a default ILM policy that enables rollover. ILM
is enabled automatically if you’re using the default <code class="literal">filebeat.yml</code> and index template.</p>
<p>To view the default policy in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to Management and select <span class="strong strong"><strong>Index Lifecycle Policies</strong></span>.
</li>
<li class="listitem">
Search for <em>filebeat</em>
</li>
<li class="listitem">
Select the <em>filebeat-version</em> policy.
</li>
</ol>
</div>
<p>This policy initiates the rollover action when the index size reaches 50GB or
becomes 30 days old.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-hotphaserollover-default.png" alt="Default policy">
</div>
</div>
<h3><a id="_modify_the_policy"></a>Modify the policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.11/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>The default policy is enough to prevent the creation of many tiny daily indices.
You can modify the policy to meet more complex requirements.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Activate the warm phase.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-modify-default-warm-phase-rollover.png" alt="Modify to add warm phase">
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Set one of the following options to control when the index moves to the warm phase:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Provide a value for <span class="strong strong"><strong>Timing for warm phase</strong></span>. Setting this to <span class="strong strong"><strong>15</strong></span> keeps the
indices on hot nodes for a range of  15-45 days, depending on when the initial
rollover occurred.
</li>
<li class="listitem">
Enable <span class="strong strong"><strong>Move to warm phase on rollover</strong></span>. The index might move to the warm phase
more quickly than intended if it reaches the <span class="strong strong"><strong>Maximum index size</strong></span> before the
the <span class="strong strong"><strong>Maximum age</strong></span>.
</li>
</ul>
</div>
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Select a node attribute to control shard allocation</strong></span> dropdown, select
<span class="strong strong"><strong>data:warm(2)</strong></span> to migrate shards to warm data nodes.
</li>
<li class="listitem">
Change <span class="strong strong"><strong>Number of replicas</strong></span> to <span class="strong strong"><strong>1</strong></span>.
</li>
<li class="listitem">
Enable <span class="strong strong"><strong>Force merge data</strong></span> and set <span class="strong strong"><strong>Number of segments</strong></span> to <span class="strong strong"><strong>1</strong></span>.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When rollover is enabled in the hot phase, action timing in the other phases
is based on the rollover date.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Activate the delete phase and set <span class="strong strong"><strong>Timing for delete phase</strong></span> to <span class="strong strong"><strong>90</strong></span> days.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-delete-rollover.png" alt="Add a delete phase">
</div>
</div>
</li>
</ol>
</div>
<h3><a id="_create_a_custom_policy"></a>Create a custom policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.11/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>If meeting a specific retention time period is most important, you can create a
custom policy.  For this option, you use Filebeat daily indices without
rollover.</p>
<p>To create a custom policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to Management and select <span class="strong strong"><strong>Index Lifecycle Policies</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create policy</strong></span>.
</li>
<li class="listitem">
<p>Activate the warm phase and configure it as follows:</p>
<p><span class="strong strong"><strong>Timing for warm phase</strong></span>: 30 days from index creation</p>
<p><span class="strong strong"><strong>Node attribute</strong></span>: <code class="literal">data:warm</code></p>
<p><span class="strong strong"><strong>Number of replicas</strong></span>: 1</p>
<p><span class="strong strong"><strong>Force merge data</strong></span>: enable</p>
<p><span class="strong strong"><strong>Number of segments</strong></span>: 1</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-custom-policy.png" alt="Modify the custom policy to add a warm phase">
</div>
</div>
</li>
<li class="listitem">
<p>Activate the delete phase and set the timing to 90 days.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-delete-phase-creation.png" alt="Delete phase">
</div>
</div>
</li>
</ol>
</div>
<p>To configure the index to use the new policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to Management and select <span class="strong strong"><strong>Index Lifecycle Policies</strong></span>.
</li>
<li class="listitem">
Find your ILM policy and click its <span class="strong strong"><strong>Actions</strong></span> link.
</li>
<li class="listitem">
Choose <span class="strong strong"><strong>Add policy to index template</strong></span>.
</li>
<li class="listitem">
Select your Filebeat index template name from the <span class="strong strong"><strong>Index template</strong></span> list. For example, <code class="literal">filebeat-7.5.x</code>.
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Add Policy</strong></span> to save the changes.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you initially used the default Filebeat ILM policy, you will
see a notice that the template already has a policy associated with it. Confirm
that you want to overwrite that configuration.</p>
</div>
</div>
</li>
</ol>
</div>
<p>When you change the policy associated with the index template, the active
index will continue to use the policy it was associated with at index creation
unless you manually update it. The next new index will use the updated policy.
For more reasons that your ILM policy changes might be delayed, see
<a class="xref" href="update-lifecycle-policy.html" title="Lifecycle policy updates">Update Lifecycle Policy</a>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="getting-started-index-lifecycle-management.html">« Tutorial: Automate rollover with ILM</a>
</span>
<span class="next">
<a href="ilm-actions.html">Index lifecycle actions »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
