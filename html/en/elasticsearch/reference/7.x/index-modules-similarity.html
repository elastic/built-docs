<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Similarity module
        | Elasticsearch Reference [7.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [7.x]" /><link rel="up" href="index-modules.html" title="Index modules" /><link rel="prev" href="index-modules-merge.html" title="Merge" /><link rel="next" href="index-modules-slowlog.html" title="Slow Log" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.x" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="7.x" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [7.x]
    </a></span> » <span class="breadcrumb-link"><a href="index-modules.html">Index modules</a></span> » <span class="breadcrumb-node">Similarity module</span></div><div class="navheader"><span class="prev"><a href="index-modules-merge.html">
              « 
              Merge</a>
           
        </span><span class="next">
           
          <a href="index-modules-slowlog.html">Slow Log
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index-modules-similarity"></a>Similarity module<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A similarity (scoring / ranking model) defines how matching documents
are scored. Similarity is per field, meaning that via the mapping one
can define a different similarity per field.</p><p>Configuring a custom similarity is considered an expert feature and the
builtin similarities are most likely sufficient as is described in
<a class="xref" href="similarity.html" title="similarity"><code class="literal">similarity</code></a>.</p><h3><a id="configuration"></a>Configuring a similarity<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Most existing or custom Similarities have configuration options which
can be configured via the index settings as shown below. The index
options can be provided when creating an index or updating index
settings.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">PUT /index
{
    "settings" : {
        "index" : {
            "similarity" : {
              "my_similarity" : {
                "type" : "DFR",
                "basic_model" : "g",
                "after_effect" : "l",
                "normalization" : "h2",
                "normalization.h2.c" : "3.0"
              }
            }
        }
    }
}</pre></div><div class="console_widget" data-snippet="snippets/884.console"></div><p>Here we configure the DFRSimilarity so it can be referenced as
<code class="literal">my_similarity</code> in mappings as is illustrate in the below example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">PUT /index/_mapping
{
  "properties" : {
    "title" : { "type" : "text", "similarity" : "my_similarity" }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/885.console"></div><h3><a id="_available_similarities"></a>Available similarities<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><h4><a id="bm25"></a>BM25 similarity (<span class="strong strong"><strong>default</strong></span>)<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>TF/IDF based similarity that has built-in tf normalization and
is supposed to work better for short fields (like names). See
<a class="ulink" href="http://en.wikipedia.org/wiki/Okapi_BM25" target="_top">Okapi_BM25</a> for more details.
This similarity has the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">k1</code></p>
</td><td valign="top">
<p>Controls non-linear term frequency normalization
(saturation). The default value is <code class="literal">1.2</code>.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">b</code></p>
</td><td valign="top">
<p>Controls to what degree document length normalizes tf values.
The default value is <code class="literal">0.75</code>.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">discount_overlaps</code></p>
</td><td valign="top">
<p>Determines whether overlap tokens (Tokens with
0 position increment) are ignored when computing norm. By default this
is true, meaning overlap tokens do not count when computing norms.</p>
</td></tr></tbody></table></div><p>Type name: <code class="literal">BM25</code></p><h4><a id="dfr"></a>DFR similarity<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Similarity that implements the
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/DFRSimilarity.html" target="_top">divergence
from randomness</a> framework. This similarity has the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">basic_model</code></p>
</td><td valign="top">
<p>Possible values: <a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/BasicModelG.html" target="_top"><code class="literal">g</code></a>,
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/BasicModelIF.html" target="_top"><code class="literal">if</code></a>,
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/BasicModelIn.html" target="_top"><code class="literal">in</code></a> and
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/BasicModelIne.html" target="_top"><code class="literal">ine</code></a>.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">after_effect</code></p>
</td><td valign="top">
<p>Possible values: <a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/AfterEffectB.html" target="_top"><code class="literal">b</code></a> and
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/AfterEffectB.html" target="_top"><code class="literal">l</code></a>.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">normalization</code></p>
</td><td valign="top">
<p>Possible values: <a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/Normalization.NoNormalization.html" target="_top"><code class="literal">no</code></a>,
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/NormalizationH1.html" target="_top"><code class="literal">h1</code></a>,
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/NormalizationH2.html" target="_top"><code class="literal">h2</code></a>,
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/NormalizationH1.html" target="_top"><code class="literal">h3</code></a> and
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/NormalizationZ.html" target="_top"><code class="literal">z</code></a>.</p>
</td></tr></tbody></table></div><p>All options but the first option need a normalization value.</p><p>Type name: <code class="literal">DFR</code></p><h4><a id="dfi"></a>DFI similarity<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Similarity that implements the <a class="ulink" href="http://trec.nist.gov/pubs/trec21/papers/irra.web.nb.pdf" target="_top">divergence from independence</a>
model.
This similarity has the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">independence_measure</code></p>
</td><td valign="top">
<p>Possible values
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/IndependenceStandardized.html" target="_top"><code class="literal">standardized</code></a>,
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/IndependenceSaturated.html" target="_top"><code class="literal">saturated</code></a>,
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/IndependenceChiSquared.html" target="_top"><code class="literal">chisquared</code></a>.</p>
</td></tr></tbody></table></div><p>When using this similarity, it is highly recommended to remove stop words to get
good relevance. Also beware that terms whose frequency is less than the expected
frequency will get a score equal to 0.</p><p>Type name: <code class="literal">DFI</code></p><h4><a id="ib"></a>IB similarity.<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p><a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/IBSimilarity.html" target="_top">Information
based model</a> . The algorithm is based on the concept that the information content in any symbolic <span class="emphasis"><em>distribution</em></span>
sequence is primarily determined by the repetitive usage of its basic elements.
For written texts this challenge would correspond to comparing the writing styles of different authors.
This similarity has the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">distribution</code></p>
</td><td valign="top">
<p>Possible values:
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/DistributionLL.html" target="_top"><code class="literal">ll</code></a> and
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/DistributionSPL.html" target="_top"><code class="literal">spl</code></a>.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">lambda</code></p>
</td><td valign="top">
<p>Possible values:
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/LambdaDF.html" target="_top"><code class="literal">df</code></a> and
<a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/LambdaTTF.html" target="_top"><code class="literal">ttf</code></a>.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">normalization</code></p>
</td><td valign="top">
<p>Same as in <code class="literal">DFR</code> similarity.</p>
</td></tr></tbody></table></div><p>Type name: <code class="literal">IB</code></p><h4><a id="lm_dirichlet"></a>LM Dirichlet similarity.<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p><a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/org/apache/lucene/search/similarities/LMDirichletSimilarity.html" target="_top">LM
Dirichlet similarity</a> . This similarity has the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">mu</code></p>
</td><td valign="top">
<p>Default to <code class="literal">2000</code>.</p>
</td></tr></tbody></table></div><p>The scoring formula in the paper assigns negative scores to terms that have
fewer occurrences than predicted by the language model, which is illegal to
Lucene, so such terms get a score of 0.</p><p>Type name: <code class="literal">LMDirichlet</code></p><h4><a id="lm_jelinek_mercer"></a>LM Jelinek Mercer similarity.<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p><a class="ulink" href="http://lucene.apache.org/core/8_2_0/core/core/org/apache/lucene/search/similarities/LMJelinekMercerSimilarity.html" target="_top">LM
Jelinek Mercer similarity</a> . The algorithm attempts to capture important patterns in the text, while leaving out noise. This similarity has the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">lambda</code></p>
</td><td valign="top">
<p>The optimal value depends on both the collection and the query. The optimal value is around <code class="literal">0.1</code>
for title queries and <code class="literal">0.7</code> for long queries. Default to <code class="literal">0.1</code>. When value approaches <code class="literal">0</code>, documents that match more query terms will be ranked higher than those that match fewer terms.</p>
</td></tr></tbody></table></div><p>Type name: <code class="literal">LMJelinekMercer</code></p><h4><a id="scripted_similarity"></a>Scripted similarity<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>A similarity that allows you to use a script in order to specify how scores
should be computed. For instance, the below example shows how to reimplement
TF-IDF:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">PUT /index
{
  "settings": {
    "number_of_shards": 1,
    "similarity": {
      "scripted_tfidf": {
        "type": "scripted",
        "script": {
          "source": "double tf = Math.sqrt(doc.freq); double idf = Math.log((field.docCount+1.0)/(term.docFreq+1.0)) + 1.0; double norm = 1/Math.sqrt(doc.length); return query.boost * tf * idf * norm;"
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "field": {
        "type": "text",
        "similarity": "scripted_tfidf"
      }
    }
  }
}

PUT /index/_doc/1
{
  "field": "foo bar foo"
}

PUT /index/_doc/2
{
  "field": "bar baz"
}

POST /index/_refresh

GET /index/_search?explain=true
{
  "query": {
    "query_string": {
      "query": "foo^1.7",
      "default_field": "field"
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/886.console"></div><p>Which yields:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "took": 12,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
        "value": 1,
        "relation": "eq"
    },
    "max_score": 1.9508477,
    "hits": [
      {
        "_shard": "[index][0]",
        "_node": "OzrdjxNtQGaqs4DmioFw9A",
        "_index": "index",
        "_type": "_doc",
        "_id": "1",
        "_score": 1.9508477,
        "_source": {
          "field": "foo bar foo"
        },
        "_explanation": {
          "value": 1.9508477,
          "description": "weight(field:foo in 0) [PerFieldSimilarity], result of:",
          "details": [
            {
              "value": 1.9508477,
              "description": "score from ScriptedSimilarity(weightScript=[null], script=[Script{type=inline, lang='painless', idOrCode='double tf = Math.sqrt(doc.freq); double idf = Math.log((field.docCount+1.0)/(term.docFreq+1.0)) + 1.0; double norm = 1/Math.sqrt(doc.length); return query.boost * tf * idf * norm;', options={}, params={}}]) computed from:",
              "details": [
                {
                  "value": 1.0,
                  "description": "weight",
                  "details": []
                },
                {
                  "value": 1.7,
                  "description": "query.boost",
                  "details": []
                },
                {
                  "value": 2,
                  "description": "field.docCount",
                  "details": []
                },
                {
                  "value": 4,
                  "description": "field.sumDocFreq",
                  "details": []
                },
                {
                  "value": 5,
                  "description": "field.sumTotalTermFreq",
                  "details": []
                },
                {
                  "value": 1,
                  "description": "term.docFreq",
                  "details": []
                },
                {
                  "value": 2,
                  "description": "term.totalTermFreq",
                  "details": []
                },
                {
                  "value": 2.0,
                  "description": "doc.freq",
                  "details": []
                },
                {
                  "value": 3,
                  "description": "doc.length",
                  "details": []
                }
              ]
            }
          ]
        }
      }
    ]
  }
}</pre></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>While scripted similarities provide a lot of flexibility, there is
a set of rules that they need to satisfy. Failing to do so could make
Elasticsearch silently return wrong top hits or fail with internal errors at
search time:</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Returned scores must be positive.</li><li class="listitem">All other variables remaining equal, scores must not decrease when
<code class="literal">doc.freq</code> increases.</li><li class="listitem">All other variables remaining equal, scores must not increase when
<code class="literal">doc.length</code> increases.</li></ul></div><p>You might have noticed that a significant part of the above script depends on
statistics that are the same for every document. It is possible to make the
above slightly more efficient by providing an <code class="literal">weight_script</code> which will
compute the document-independent part of the score and will be available
under the <code class="literal">weight</code> variable. When no <code class="literal">weight_script</code> is provided, <code class="literal">weight</code>
is equal to <code class="literal">1</code>. The <code class="literal">weight_script</code> has access to the same variables as
the <code class="literal">script</code> except <code class="literal">doc</code> since it is supposed to compute a
document-independent contribution to the score.</p><p>The below configuration will give the same tf-idf scores but is slightly
more efficient:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">PUT /index
{
  "settings": {
    "number_of_shards": 1,
    "similarity": {
      "scripted_tfidf": {
        "type": "scripted",
        "weight_script": {
          "source": "double idf = Math.log((field.docCount+1.0)/(term.docFreq+1.0)) + 1.0; return query.boost * idf;"
        },
        "script": {
          "source": "double tf = Math.sqrt(doc.freq); double norm = 1/Math.sqrt(doc.length); return weight * tf * norm;"
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "field": {
        "type": "text",
        "similarity": "scripted_tfidf"
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/887.console"></div><p>Type name: <code class="literal">scripted</code></p><h4><a id="default-base"></a>Default Similarity<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/index-modules/similarity.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>By default, Elasticsearch will use whatever similarity is configured as
<code class="literal">default</code>.</p><p>You can change the default similarity for all fields in an index when
it is <a class="link" href="indices-create-index.html" title="Create Index">created</a>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">PUT /index
{
  "settings": {
    "index": {
      "similarity": {
        "default": {
          "type": "boolean"
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/888.console"></div><p>If you want to change the default similarity after creating the index
you must <a class="link" href="indices-open-close.html" title="Open / Close Index API">close</a> your index, send the following
request and <a class="link" href="indices-open-close.html" title="Open / Close Index API">open</a> it again afterwards:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">POST /index/_close

PUT /index/_settings
{
  "index": {
    "similarity": {
      "default": {
        "type": "boolean"
      }
    }
  }
}

POST /index/_open</pre></div><div class="console_widget" data-snippet="snippets/889.console"></div></div><div class="navfooter"><span class="prev"><a href="index-modules-merge.html">
              « 
              Merge</a>
           
        </span><span class="next">
           
          <a href="index-modules-slowlog.html">Slow Log
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
