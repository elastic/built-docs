<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Evaluate data frame analytics API | Elasticsearch Guide [8.0] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [8.0]"/>
<link rel="up" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"/>
<link rel="prev" href="delete-dfanalytics.html" title="Delete data frame analytics jobs API"/>
<link rel="next" href="explain-dfanalytics.html" title="Explain data frame analytics API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.0"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.0"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.0]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="ml-df-analytics-apis.html">Machine learning data frame analytics APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="delete-dfanalytics.html">« Delete data frame analytics jobs API</a>
</span>
<span class="next">
<a href="explain-dfanalytics.html">Explain data frame analytics API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="evaluate-dfanalytics"></a>Evaluate data frame analytics API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h2>
</div></div></div>

<p>Evaluates the data frame analytics for an annotated index.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-request"></a>Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/data_frame/_evaluate</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-prereq"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the following privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
cluster: <code class="literal">monitor_ml</code> (the <code class="literal">machine_learning_user</code> built-in role grants this
privilege)
</li>
<li class="listitem">
destination index: <code class="literal">read</code>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-desc"></a>Description<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p>The API packages together commonly used evaluation metrics for various types of
machine learning features. This has been designed for use on indexes created by
data frame analytics. Evaluation requires both a ground truth field and an analytics
result field to be present.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-request-body"></a>Request body<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">evaluation</code>
</span>
</dt>
<dd>
<p>
(Required, object) Defines the type of evaluation you want to perform.
See <a class="xref" href="evaluate-dfanalytics.html#ml-evaluate-dfanalytics-resources" title="Data frame analytics evaluation resources">Data frame analytics evaluation resources</a>.
</p>
<p>Available evaluation types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">outlier_detection</code>
</li>
<li class="listitem">
<code class="literal">regression</code>
</li>
<li class="listitem">
<code class="literal">classification</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Required, object) Defines the <code class="literal">index</code> in which the evaluation will be
performed.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object) A query clause that retrieves a subset of data from the
source index. See <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-resources"></a>Data frame analytics evaluation resources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="oldetection-resources"></a>Outlier detection evaluation objects<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>Outlier detection evaluates the results of an outlier detection analysis which
outputs the probability that each document is an outlier.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actual_field</code>
</span>
</dt>
<dd>
(Required, string) The field of the <code class="literal">index</code> which contains the <code class="literal">ground truth</code>.
The data type of this field can be boolean or integer. If the data type is
integer, the value has to be either <code class="literal">0</code> (false) or <code class="literal">1</code> (true).
</dd>
<dt>
<span class="term">
<code class="literal">predicted_probability_field</code>
</span>
</dt>
<dd>
(Required, string) The field of the <code class="literal">index</code> that defines the probability of
whether the item belongs to the class in question or not. It&#8217;s the field that
contains the results of the analysis.
</dd>
<dt>
<span class="term">
<code class="literal">metrics</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Specifies the metrics that are used for the evaluation. If
no metrics are specified, the following are returned by default:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">auc_roc</code> (<code class="literal">include_curve</code>: false),
</li>
<li class="listitem">
<code class="literal">precision</code> (<code class="literal">at</code>: [0.25, 0.5, 0.75]),
</li>
<li class="listitem">
<code class="literal">recall</code> (<code class="literal">at</code>: [0.25, 0.5, 0.75]),
</li>
<li class="listitem">
<p><code class="literal">confusion_matrix</code> (<code class="literal">at</code>: [0.25, 0.5, 0.75]).</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">auc_roc</code>
</span>
</dt>
<dd>
(Optional, object) The AUC ROC (area under the curve of the receiver
operating characteristic) score and optionally the curve. Default value is
{"include_curve": false}.
</dd>
<dt>
<span class="term">
<code class="literal">confusion_matrix</code>
</span>
</dt>
<dd>
(Optional, object) Set the different thresholds of the outlier score at where
the metrics (<code class="literal">tp</code> - true positive, <code class="literal">fp</code> - false positive, <code class="literal">tn</code> - true
negative, <code class="literal">fn</code> - false negative) are calculated. Default value is
{"at": [0.25, 0.50, 0.75]}.
</dd>
<dt>
<span class="term">
<code class="literal">precision</code>
</span>
</dt>
<dd>
(Optional, object) Set the different thresholds of the outlier score at where
the metric is calculated. Default value is {"at": [0.25, 0.50, 0.75]}.
</dd>
<dt>
<span class="term">
<code class="literal">recall</code>
</span>
</dt>
<dd>
(Optional, object) Set the different thresholds of the outlier score at where
the metric is calculated. Default value is {"at": [0.25, 0.50, 0.75]}.
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="regression-evaluation-resources"></a>Regression evaluation objects<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>Regression evaluation evaluates the results of a regression analysis
which outputs a prediction of values.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actual_field</code>
</span>
</dt>
<dd>
(Required, string) The field of the <code class="literal">index</code> which contains the <code class="literal">ground truth</code>.
The data type of this field must be numerical.
</dd>
<dt>
<span class="term">
<code class="literal">predicted_field</code>
</span>
</dt>
<dd>
(Required, string) The field in the <code class="literal">index</code> that contains the predicted value,
in other words the results of the regression analysis.
</dd>
<dt>
<span class="term">
<code class="literal">metrics</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Specifies the metrics that are used for the evaluation. For
more information on <code class="literal">mse</code>, <code class="literal">msle</code>, and <code class="literal">huber</code>, consult
<a href="https://github.com/elastic/examples/tree/master/Machine%20Learning/Regression%20Loss%20Functions" class="ulink" target="_top">the Jupyter notebook on regression loss functions</a>.
If no metrics are specified, the following are returned by default:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">mse</code>,
</li>
<li class="listitem">
<code class="literal">r_squared</code>,
</li>
<li class="listitem">
<p><code class="literal">huber</code> (<code class="literal">delta</code>: 1.0).</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">mse</code>
</span>
</dt>
<dd>
(Optional, object) Average squared difference between the predicted values
and the actual (<code class="literal">ground truth</code>) value. For more information, read
<a href="https://en.wikipedia.org/wiki/Mean_squared_error" class="ulink" target="_top">this wiki article</a>.
</dd>
<dt>
<span class="term">
<code class="literal">msle</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Average squared difference between the logarithm of the
predicted values and the logarithm of the actual (<code class="literal">ground truth</code>) value.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">offset</code>
</span>
</dt>
<dd>
(Optional, double) Defines the transition point at which you switch from
minimizing quadratic error to minimizing quadratic log error. Defaults to
<code class="literal">1</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">huber</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Pseudo Huber loss function. For more information, read
<a href="https://en.wikipedia.org/wiki/Huber_loss#Pseudo-Huber_loss_function" class="ulink" target="_top">this wiki article</a>.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">delta</code>
</span>
</dt>
<dd>
(Optional, double) Approximates 1/2 (prediction - actual)<sup>2</sup> for values
much less than delta and approximates a straight line with slope delta for
values much larger than delta. Defaults to <code class="literal">1</code>. Delta needs to be greater
than <code class="literal">0</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">r_squared</code>
</span>
</dt>
<dd>
(Optional, object) Proportion of the variance in the dependent variable that
is predictable from the independent variables. For more information, read
<a href="https://en.wikipedia.org/wiki/Coefficient_of_determination" class="ulink" target="_top">this wiki article</a>.
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="classification-evaluation-resources"></a>Classification evaluation objects<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p>Classification evaluation evaluates the results of a classification analysis which
outputs a prediction that identifies to which of the classes each document
belongs.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actual_field</code>
</span>
</dt>
<dd>
(Required, string) The field of the <code class="literal">index</code> which contains the <code class="literal">ground truth</code>.
The data type of this field must be categorical.
</dd>
<dt>
<span class="term">
<code class="literal">predicted_field</code>
</span>
</dt>
<dd>
(Optional, string) The field in the <code class="literal">index</code> which contains the predicted value,
in other words the results of the classification analysis.
</dd>
<dt>
<span class="term">
<code class="literal">top_classes_field</code>
</span>
</dt>
<dd>
(Optional, string) The field of the <code class="literal">index</code> which is an array of documents
of the form <code class="literal">{ "class_name": XXX, "class_probability": YYY }</code>.
This field must be defined as <code class="literal">nested</code> in the mappings.
</dd>
<dt>
<span class="term">
<code class="literal">metrics</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Specifies the metrics that are used for the evaluation. If
no metrics are specificed, the following are returned by default:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">accuracy</code>,
</li>
<li class="listitem">
<code class="literal">multiclass_confusion_matrix</code>,
</li>
<li class="listitem">
<code class="literal">precision</code>,
</li>
<li class="listitem">
<p><code class="literal">recall</code>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">accuracy</code>
</span>
</dt>
<dd>
(Optional, object) Accuracy of predictions (per-class and overall).
</dd>
<dt>
<span class="term">
<code class="literal">auc_roc</code>
</span>
</dt>
<dd>
<p>
(Optional, object) The AUC ROC (area under the curve of the receiver
operating characteristic) score and optionally the curve.
It is calculated for a specific class (provided as "class_name") treated as
positive.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">class_name</code>
</span>
</dt>
<dd>
(Required, string) Name of the only class that is treated as positive
during AUC ROC calculation. Other classes are treated as negative
("one-vs-all" strategy). All the evaluated documents must have
<code class="literal">class_name</code> in the list of their top classes.
</dd>
<dt>
<span class="term">
<code class="literal">include_curve</code>
</span>
</dt>
<dd>
(Optional, Boolean) Whether or not the curve should be returned in
addition to the score. Default value is false.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">multiclass_confusion_matrix</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Multiclass confusion matrix.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
(Optional, double) Specifies the size of the multiclass confusion matrix.
Defaults to <code class="literal">10</code> which results in a matrix of size 10x10.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">precision</code>
</span>
</dt>
<dd>
(Optional, object) Precision of predictions (per-class and average).
</dd>
<dt>
<span class="term">
<code class="literal">recall</code>
</span>
</dt>
<dd>
(Optional, object) Recall of predictions (per-class and average).
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-example"></a>Examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-evaluate-oldetection-example"></a>Outlier detection<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<a id="d4b405ef0302227e050ac8f0e39068e1"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
  "index": "my_analytics_dest_index",
  "evaluation": {
    "outlier_detection": {
      "actual_field": "is_outlier",
      "predicted_probability_field": "ml.outlier_score"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2318.console"></div>
<p>The API returns the following results:</p>
<a id="3b486424d5469101f3f9fde3fcdb8203"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "outlier_detection": {
    "auc_roc": {
      "value": 0.92584757746414444
    },
    "confusion_matrix": {
      "0.25": {
          "tp": 5,
          "fp": 9,
          "tn": 204,
          "fn": 5
      },
      "0.5": {
          "tp": 1,
          "fp": 5,
          "tn": 208,
          "fn": 9
      },
      "0.75": {
          "tp": 0,
          "fp": 4,
          "tn": 209,
          "fn": 10
      }
    },
    "precision": {
        "0.25": 0.35714285714285715,
        "0.5": 0.16666666666666666,
        "0.75": 0
    },
    "recall": {
        "0.25": 0.5,
        "0.5": 0.1,
        "0.75": 0
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-evaluate-regression-example"></a>Regression<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<a id="0502284d4685c478eb68761f979f4303"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
  "index": "house_price_predictions", <a id="CO643-1"></a><i class="conum" data-value="1"></i>
  "query": {
      "bool": {
        "filter": [
          { "term":  { "ml.is_training": false } } <a id="CO643-2"></a><i class="conum" data-value="2"></i>
        ]
      }
  },
  "evaluation": {
    "regression": {
      "actual_field": "price", <a id="CO643-3"></a><i class="conum" data-value="3"></i>
      "predicted_field": "ml.price_prediction", <a id="CO643-4"></a><i class="conum" data-value="4"></i>
      "metrics": {
        "r_squared": {},
        "mse": {},
        "msle": {"offset": 10},
        "huber": {"delta": 1.5}
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2319.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO643-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The output destination index from a data frame analytics regression analysis.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO643-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>In this example, a test/train split (<code class="literal">training_percent</code>) was defined for the
regression analysis. This query limits evaluation to be performed on the test split
only.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO643-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The ground truth value for the actual house price. This is required in order
to evaluate results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO643-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The predicted value for house price calculated by the regression analysis.</p>
</td>
</tr>
</table>
</div>
<p>The following example calculates the training error:</p>
<a id="24ad3c234f69f55a3fbe2d488e70178a"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
  "index": "student_performance_mathematics_reg",
  "query": {
    "term": {
      "ml.is_training": {
        "value": true <a id="CO644-1"></a><i class="conum" data-value="1"></i>
      }
    }
  },
  "evaluation": {
    "regression": {
      "actual_field": "G3", <a id="CO644-2"></a><i class="conum" data-value="2"></i>
      "predicted_field": "ml.G3_prediction", <a id="CO644-3"></a><i class="conum" data-value="3"></i>
      "metrics": {
        "r_squared": {},
        "mse": {},
        "msle": {},
        "huber": {}
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2320.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO644-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>In this example, a test/train split (<code class="literal">training_percent</code>) was defined for the
regression analysis. This query limits evaluation to be performed on the train split
only. It means that a training error will be calculated.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO644-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the ground truth value for the actual student
performance. This is required in order to evaluate results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO644-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the predicted value for student performance
calculated by the regression analysis.</p>
</td>
</tr>
</table>
</div>
<p>The next example calculates the testing error. The only difference compared with
the previous example is that <code class="literal">ml.is_training</code> is set to <code class="literal">false</code> this time, so
the query excludes the train split from the evaluation.</p>
<a id="64622409407316d2d47094e692d9b516"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
  "index": "student_performance_mathematics_reg",
  "query": {
    "term": {
      "ml.is_training": {
        "value": false <a id="CO645-1"></a><i class="conum" data-value="1"></i>
      }
    }
  },
  "evaluation": {
    "regression": {
      "actual_field": "G3", <a id="CO645-2"></a><i class="conum" data-value="2"></i>
      "predicted_field": "ml.G3_prediction", <a id="CO645-3"></a><i class="conum" data-value="3"></i>
      "metrics": {
        "r_squared": {},
        "mse": {},
        "msle": {},
        "huber": {}
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2321.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO645-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>In this example, a test/train split (<code class="literal">training_percent</code>) was defined for the
regression analysis. This query limits evaluation to be performed on the test split
only. It means that a testing error will be calculated.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO645-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the ground truth value for the actual student
performance. This is required in order to evaluate results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO645-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the predicted value for student performance
calculated by the regression analysis.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-evaluate-classification-example"></a>Classification<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<a id="388d3eda4f792d3fce044777739217e6"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
   "index": "animal_classification",
   "evaluation": {
      "classification": { <a id="CO646-1"></a><i class="conum" data-value="1"></i>
         "actual_field": "animal_class", <a id="CO646-2"></a><i class="conum" data-value="2"></i>
         "predicted_field": "ml.animal_class_prediction", <a id="CO646-3"></a><i class="conum" data-value="3"></i>
         "metrics": {
           "multiclass_confusion_matrix" : {} <a id="CO646-4"></a><i class="conum" data-value="4"></i>
         }
      }
   }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2322.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO646-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The evaluation type.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO646-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the ground truth value for the actual animal
classification. This is required in order to evaluate results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO646-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the predicted value for animal classification by
the classification analysis.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO646-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies the metric for the evaluation.</p>
</td>
</tr>
</table>
</div>
<p>The API returns the following result:</p>
<a id="c9b0865574c0db1f8ea02d507e215bfe"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "classification" : {
      "multiclass_confusion_matrix" : {
         "confusion_matrix" : [
         {
            "actual_class" : "cat", <a id="CO647-1"></a><i class="conum" data-value="1"></i>
            "actual_class_doc_count" : 12, <a id="CO647-2"></a><i class="conum" data-value="2"></i>
            "predicted_classes" : [ <a id="CO647-3"></a><i class="conum" data-value="3"></i>
              {
                "predicted_class" : "cat",
                "count" : 12 <a id="CO647-4"></a><i class="conum" data-value="4"></i>
              },
              {
                "predicted_class" : "dog",
                "count" : 0 <a id="CO647-5"></a><i class="conum" data-value="5"></i>
              }
            ],
            "other_predicted_class_doc_count" : 0 <a id="CO647-6"></a><i class="conum" data-value="6"></i>
          },
          {
            "actual_class" : "dog",
            "actual_class_doc_count" : 11,
            "predicted_classes" : [
              {
                "predicted_class" : "dog",
                "count" : 7
              },
              {
                "predicted_class" : "cat",
                "count" : 4
              }
            ],
            "other_predicted_class_doc_count" : 0
          }
        ],
        "other_actual_class_count" : 0
      }
    }
  }</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO647-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the actual class that the analysis tried to predict.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO647-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of documents in the index that belong to the <code class="literal">actual_class</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO647-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>This object contains the list of the predicted classes and the number of
predictions associated with the class.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO647-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of cats in the dataset that are correctly identified as cats.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO647-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of cats in the dataset that are incorrectly classified as dogs.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO647-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of documents that are classified as a class that is not listed as
a <code class="literal">predicted_class</code>.</p>
</td>
</tr>
</table>
</div>
<a id="09e6e06ba562f4b9bac59455e9151a80"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
   "index": "animal_classification",
   "evaluation": {
      "classification": { <a id="CO648-1"></a><i class="conum" data-value="1"></i>
         "actual_field": "animal_class", <a id="CO648-2"></a><i class="conum" data-value="2"></i>
         "metrics": {
            "auc_roc" : { <a id="CO648-3"></a><i class="conum" data-value="3"></i>
              "class_name": "dog" <a id="CO648-4"></a><i class="conum" data-value="4"></i>
            }
         }
      }
   }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2323.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The evaluation type.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the ground truth value for the actual animal
classification. This is required in order to evaluate results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies the metric for the evaluation.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies the class name that is treated as positive during the evaluation,
all the other classes are treated as negative.</p>
</td>
</tr>
</table>
</div>
<p>The API returns the following result:</p>
<a id="70fe53e23c2ff4c7c22709e16879bac0"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "classification" : {
    "auc_roc" : {
      "value" : 0.8941788639536681
    }
  }
}</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="delete-dfanalytics.html">« Delete data frame analytics jobs API</a>
</span>
<span class="next">
<a href="explain-dfanalytics.html">Explain data frame analytics API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"csharp":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
