<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tutorial: semantic search with a deployed model | Elasticsearch Guide [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Tutorial: semantic search with a deployed model | Elasticsearch Guide [8.15]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.15]"/>
<link rel="up" href="semantic-search.html" title="Semantic search"/>
<link rel="prev" href="cohere-es.html" title="Tutorial: Using Cohere with Elasticsearch"/>
<link rel="next" href="retrievers-reranking-overview.html" title="Retrievers and reranking"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.15"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.15"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="cohere-es.html">« Tutorial: Using Cohere with Elasticsearch</a>
</span>
<span class="next">
<a href="retrievers-reranking-overview.html">Retrievers and reranking »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="search-with-elasticsearch.html">Search your data</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="semantic-search.html">Semantic search</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Tutorial: semantic search with a deployed model</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/search/search-your-data/semantic-search-deploy-model.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="semantic-search-deployed-nlp-model"></a>Tutorial: semantic search with a deployed model</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/search/search-your-data/semantic-search-deploy-model.asciidoc">edit</a></div>
</div></div></div>

<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For the easiest way to perform semantic search in the Elastic Stack, refer to the <a class="xref" href="semantic-search-semantic-text.html" title="Tutorial: semantic search with semantic_text"><code class="literal">semantic_text</code></a> end-to-end tutorial.
</li>
<li class="listitem">
This tutorial was written before the <a class="xref" href="inference-apis.html" title="Inference APIs">inference endpoint</a> and <a class="xref" href="semantic-text.html" title="Semantic text field type"><code class="literal">semantic_text</code> field type</a> was introduced.
Today we have simpler options for performing semantic search.
</li>
</ul>
</div>
</div>
</div>
<p>This guide shows you how to implement semantic search with models deployed in Elasticsearch: from selecting an NLP model, to writing queries.</p>
<div class="position-relative"><h4><a id="deployed-select-nlp-model"></a>Select an NLP model</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/search/search-your-data/semantic-search-deploy-model.asciidoc">edit</a></div>
<p>Elasticsearch offers the usage of a <a href="/guide/en/machine-learning/8.15/ml-nlp-model-ref.html#ml-nlp-model-ref-text-embedding" class="ulink" target="_top">wide range of NLP models</a>, including both dense and sparse vector models.
Your choice of the language model is critical for implementing semantic search successfully.</p>
<p>While it is possible to bring your own text embedding model, achieving good search results through model tuning is challenging.
Selecting an appropriate model from our third-party model list is the first step.
Training the model on your own data is essential to ensure better search results than using only BM25.
However, the model training process requires a team of data scientists and ML experts, making it expensive and time-consuming.</p>
<p>To address this issue, Elastic provides a pre-trained representational model called <a href="/guide/en/machine-learning/8.15/ml-nlp-elser.html" class="ulink" target="_top">Elastic Learned Sparse EncodeR (ELSER)</a>.
ELSER, currently available only for English, is an out-of-domain sparse vector model that does not require fine-tuning.
This adaptability makes it suitable for various NLP use cases out of the box.
Unless you have a team of ML specialists, it is highly recommended to use the ELSER model.</p>
<p>In the case of sparse vector representation, the vectors mostly consist of zero values, with only a small subset containing non-zero values.
This representation is commonly used for textual data.
In the case of ELSER, each document in an index and the query text itself are represented by high-dimensional sparse vectors.
Each non-zero element of the vector corresponds to a term in the model vocabulary.
The ELSER vocabulary contains around 30000 terms, so the sparse vectors created by ELSER contain about 30000 values, the majority of which are zero.
Effectively the ELSER model is replacing the terms in the original query with other terms that have been learnt to exist in the documents that best match the original search terms in a training dataset, and weights to control how important each is.</p>
<div class="position-relative"><h4><a id="deployed-deploy-nlp-model"></a>Deploy the model</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/search/search-your-data/semantic-search-deploy-model.asciidoc">edit</a></div>
<p>After you decide which model you want to use for implementing semantic search, you need to deploy the model in Elasticsearch.</p>
<div class="tabs" data-tab-group="model">
  <div role="tablist" aria-label="model">
    <button role="tab"
            aria-selected="true"
            aria-controls="elser-tab-deploy-nlp-model"
            id="elser-deploy-nlp-model">
      ELSER
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="dense-vector-tab-deploy-nlp-model"
            id="dense-vector-deploy-nlp-model">
      Dense vector models
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="elser-tab-deploy-nlp-model"
       aria-labelledby="elser-deploy-nlp-model">
<p>To deploy ELSER, refer to
<a href="/guide/en/machine-learning/8.15/ml-nlp-elser.html#download-deploy-elser" class="ulink" target="_top">Download and deploy ELSER</a>.</p>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="dense-vector-tab-deploy-nlp-model"
       aria-labelledby="dense-vector-deploy-nlp-model"
       hidden="">
<p>To deploy a third-party text embedding model, refer to
<a href="/guide/en/machine-learning/8.15/ml-nlp-text-emb-vector-search-example.html#ex-te-vs-deploy" class="ulink" target="_top">Deploy a text embedding model</a>.</p>
  </div>
</div>
<div class="position-relative"><h4><a id="deployed-field-mappings"></a>Map a field for the text embeddings</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/search/search-your-data/semantic-search-deploy-model.asciidoc">edit</a></div>
<p>Before you start using the deployed model to generate embeddings based on your input text, you need to prepare your index mapping first.
The mapping of the index depends on the type of model.</p>
<div class="tabs" data-tab-group="model">
  <div role="tablist" aria-label="model">
    <button role="tab"
            aria-selected="true"
            aria-controls="elser-tab-field-mappings"
            id="elser-field-mappings">
      ELSER
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="dense-vector-tab-field-mappings"
            id="dense-vector-field-mappings">
      Dense vector models
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="elser-tab-field-mappings"
       aria-labelledby="elser-field-mappings">
<p>ELSER produces token-weight pairs as output from the input text and the query.
The Elasticsearch <a class="xref" href="sparse-vector.html" title="Sparse vector field type"><code class="literal">sparse_vector</code></a> field type can store these
token-weight pairs as numeric feature vectors. The index must have a field with
the <code class="literal">sparse_vector</code> field type to index the tokens that ELSER generates.</p>
<p>To create a mapping for your ELSER index, refer to the
<a class="xref" href="semantic-search-elser.html#elser-mappings" title="Create the index mapping">Create the index mapping section</a> of the tutorial. The example
shows how to create an index mapping for <code class="literal">my-index</code> that defines the
<code class="literal">my_embeddings.tokens</code> field - which will contain the ELSER output - as a
<code class="literal">sparse_vector</code> field.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="my-index",
    mappings={
        "properties": {
            "my_tokens": {
                "type": "sparse_vector"
            },
            "my_text_field": {
                "type": "text"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'my-index',
  body: {
    mappings: {
      properties: {
        my_tokens: {
          type: 'sparse_vector'
        },
        my_text_field: {
          type: 'text'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "my-index",
  mappings: {
    properties: {
      my_tokens: {
        type: "sparse_vector",
      },
      my_text_field: {
        type: "text",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="31a79a57b242713edec6795599ba0d5d"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT my-index
{
  "mappings": {
    "properties": {
      "my_tokens": { <a id="CO278-1"></a><i class="conum" data-value="1"></i>
        "type": "sparse_vector" <a id="CO278-2"></a><i class="conum" data-value="2"></i>
      },
      "my_text_field": { <a id="CO278-3"></a><i class="conum" data-value="3"></i>
        "type": "text" <a id="CO278-4"></a><i class="conum" data-value="4"></i>
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1077.console"></div>
<div class="calloutlist default has-python has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO278-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the field that will contain the tokens generated by ELSER.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO278-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the tokens must be a <code class="literal">sparse_vector</code> field.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO278-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the field from which to create the sparse vector representation.
In this example, the name of the field is <code class="literal">my_text_field</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO278-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field type is <code class="literal">text</code> in this example.</p>
</td>
</tr>
</table>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="dense-vector-tab-field-mappings"
       aria-labelledby="dense-vector-field-mappings"
       hidden="">
<p>The models compatible with Elasticsearch NLP generate dense vectors as output. The
<a class="xref" href="dense-vector.html" title="Dense vector field type"><code class="literal">dense_vector</code></a> field type is suitable for storing dense vectors
of numeric values. The index must have a field with the <code class="literal">dense_vector</code> field
type to index the embeddings that the supported third-party model that you
selected generates. Keep in mind that the model produces embeddings with a
certain number of dimensions. The <code class="literal">dense_vector</code> field must be configured with
the same number of dimensions using the <code class="literal">dims</code> option. Refer to the respective
model documentation to get information about the number of dimensions of the
embeddings.</p>
<p>To review a mapping of an index for an NLP model, refer to the mapping code
snippet in the
<a href="/guide/en/machine-learning/8.15/ml-nlp-text-emb-vector-search-example.html#ex-text-emb-ingest" class="ulink" target="_top">Add the text embedding model to an ingest inference pipeline</a>
section of the tutorial. The example shows how to create an index mapping that
defines the <code class="literal">my_embeddings.predicted_value</code> field - which will contain the model
output - as a <code class="literal">dense_vector</code> field.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="my-index",
    mappings={
        "properties": {
            "my_embeddings.predicted_value": {
                "type": "dense_vector",
                "dims": 384
            },
            "my_text_field": {
                "type": "text"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'my-index',
  body: {
    mappings: {
      properties: {
        'my_embeddings.predicted_value' =&gt; {
          type: 'dense_vector',
          dims: 384
        },
        my_text_field: {
          type: 'text'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "my-index",
  mappings: {
    properties: {
      "my_embeddings.predicted_value": {
        type: "dense_vector",
        dims: 384,
      },
      my_text_field: {
        type: "text",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="a6b2815d54df34b6b8d00226e9a1af0c"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT my-index
{
  "mappings": {
    "properties": {
      "my_embeddings.predicted_value": { <a id="CO279-1"></a><i class="conum" data-value="1"></i>
        "type": "dense_vector", <a id="CO279-2"></a><i class="conum" data-value="2"></i>
        "dims": 384 <a id="CO279-3"></a><i class="conum" data-value="3"></i>
      },
      "my_text_field": { <a id="CO279-4"></a><i class="conum" data-value="4"></i>
        "type": "text" <a id="CO279-5"></a><i class="conum" data-value="5"></i>
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1078.console"></div>
<div class="calloutlist default has-python has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO279-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the field that will contain the embeddings generated by the
model.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO279-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the embeddings must be a <code class="literal">dense_vector</code> field.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO279-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The model produces embeddings with a certain number of dimensions. The
<code class="literal">dense_vector</code> field must be configured with the same number of dimensions by
the <code class="literal">dims</code> option. Refer to the respective model documentation to get
information about the number of dimensions of the embeddings.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO279-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the field from which to create the dense vector representation.
In this example, the name of the field is <code class="literal">my_text_field</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO279-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field type is <code class="literal">text</code> in this example.</p>
</td>
</tr>
</table>
</div>
  </div>
</div>
<div class="position-relative"><h4><a id="deployed-generate-embeddings"></a>Generate text embeddings</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/search/search-your-data/semantic-search-deploy-model.asciidoc">edit</a></div>
<p>Once you have created the mappings for the index, you can generate text embeddings from your input text.
This can be done by using an
<a class="xref" href="ingest.html" title="Ingest pipelines">ingest pipeline</a> with an <a class="xref" href="inference-processor.html" title="Inference processor">inference processor</a>.
The ingest pipeline processes the input data and indexes it into the destination index.
At index time, the inference ingest processor uses the trained model to infer against the data ingested through the pipeline.
After you created the ingest pipeline with the inference processor, you can ingest your data through it to generate the model output.</p>
<div class="tabs" data-tab-group="model">
  <div role="tablist" aria-label="model">
    <button role="tab"
            aria-selected="true"
            aria-controls="elser-tab-generate-embeddings"
            id="elser-generate-embeddings">
      ELSER
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="dense-vector-tab-generate-embeddings"
            id="dense-vector-generate-embeddings">
      Dense vector models
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="elser-tab-generate-embeddings"
       aria-labelledby="elser-generate-embeddings">
<p>This is how an ingest pipeline that uses the ELSER model is created:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.ingest.put_pipeline(
    id="my-text-embeddings-pipeline",
    description="Text embedding pipeline",
    processors=[
        {
            "inference": {
                "model_id": ".elser_model_2",
                "input_output": [
                    {
                        "input_field": "my_text_field",
                        "output_field": "my_tokens"
                    }
                ]
            }
        }
    ],
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ingest.put_pipeline(
  id: 'my-text-embeddings-pipeline',
  body: {
    description: 'Text embedding pipeline',
    processors: [
      {
        inference: {
          model_id: '.elser_model_2',
          input_output: [
            {
              input_field: 'my_text_field',
              output_field: 'my_tokens'
            }
          ]
        }
      }
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ingest.putPipeline({
  id: "my-text-embeddings-pipeline",
  description: "Text embedding pipeline",
  processors: [
    {
      inference: {
        model_id: ".elser_model_2",
        input_output: [
          {
            input_field: "my_text_field",
            output_field: "my_tokens",
          },
        ],
      },
    },
  ],
});
console.log(response);</pre>
</div>
<a id="8d064eda2199de52e5be9ee68a5b7c68"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT _ingest/pipeline/my-text-embeddings-pipeline
{
  "description": "Text embedding pipeline",
  "processors": [
    {
      "inference": {
        "model_id": ".elser_model_2",
        "input_output": [ <a id="CO280-1"></a><i class="conum" data-value="1"></i>
          {
            "input_field": "my_text_field",
            "output_field": "my_tokens"
          }
        ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1079.console"></div>
<div class="calloutlist default has-python has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO280-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Configuration object that defines the <code class="literal">input_field</code> for the inference process
and the <code class="literal">output_field</code> that will contain the inference results.</p>
</td>
</tr>
</table>
</div>
<p>To ingest data through the pipeline to generate tokens with ELSER, refer to the
<a class="xref" href="semantic-search-elser.html#reindexing-data-elser" title="Ingest the data through the inference ingest pipeline">Ingest the data through the inference ingest pipeline</a> section of the tutorial. After you successfully
ingested documents by using the pipeline, your index will contain the tokens
generated by ELSER. Tokens are learned associations capturing relevance, they
are not synonyms. To learn more about what tokens are, refer to
<a href="/guide/en/machine-learning/8.15/ml-nlp-elser.html#elser-tokens" class="ulink" target="_top">this page</a>.</p>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="dense-vector-tab-generate-embeddings"
       aria-labelledby="dense-vector-generate-embeddings"
       hidden="">
<p>This is how an ingest pipeline that uses a text embedding model is created:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.ingest.put_pipeline(
    id="my-text-embeddings-pipeline",
    description="Text embedding pipeline",
    processors=[
        {
            "inference": {
                "model_id": "sentence-transformers__msmarco-minilm-l-12-v3",
                "target_field": "my_embeddings",
                "field_map": {
                    "my_text_field": "text_field"
                }
            }
        }
    ],
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ingest.put_pipeline(
  id: 'my-text-embeddings-pipeline',
  body: {
    description: 'Text embedding pipeline',
    processors: [
      {
        inference: {
          model_id: 'sentence-transformers__msmarco-minilm-l-12-v3',
          target_field: 'my_embeddings',
          field_map: {
            my_text_field: 'text_field'
          }
        }
      }
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ingest.putPipeline({
  id: "my-text-embeddings-pipeline",
  description: "Text embedding pipeline",
  processors: [
    {
      inference: {
        model_id: "sentence-transformers__msmarco-minilm-l-12-v3",
        target_field: "my_embeddings",
        field_map: {
          my_text_field: "text_field",
        },
      },
    },
  ],
});
console.log(response);</pre>
</div>
<a id="256eba7a77c8890a43afeda8ce8a3225"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT _ingest/pipeline/my-text-embeddings-pipeline
{
  "description": "Text embedding pipeline",
  "processors": [
    {
      "inference": {
        "model_id": "sentence-transformers__msmarco-minilm-l-12-v3", <a id="CO281-1"></a><i class="conum" data-value="1"></i>
        "target_field": "my_embeddings",
        "field_map": { <a id="CO281-2"></a><i class="conum" data-value="2"></i>
          "my_text_field": "text_field"
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1080.console"></div>
<div class="calloutlist default has-python has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO281-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The model ID of the text embedding model you want to use.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO281-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">field_map</code> object maps the input document field name (which is
<code class="literal">my_text_field</code> in this example) to the name of the field that the model expects
(which is always <code class="literal">text_field</code>).</p>
</td>
</tr>
</table>
</div>
<p>To ingest data through the pipeline to generate text embeddings with your chosen
model, refer to the
<a href="/guide/en/machine-learning/8.15/ml-nlp-text-emb-vector-search-example.html#ex-text-emb-ingest" class="ulink" target="_top">Add the text embedding model to an inference ingest pipeline</a>
section. The example shows how to create the pipeline with the inference
processor and reindex your data through the pipeline. After you successfully
ingested documents by using the pipeline, your index will contain the text
embeddings generated by the model.</p>
  </div>
</div>
<p>Now it is time to perform semantic search!</p>
<div class="position-relative"><h4><a id="deployed-search"></a>Search the data</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/search/search-your-data/semantic-search-deploy-model.asciidoc">edit</a></div>
<p>Depending on the type of model you have deployed, you can query rank features with a <a class="xref" href="query-dsl-sparse-vector-query.html" title="Sparse vector query">sparse vector</a> query, or dense vectors with a kNN search.</p>
<div class="tabs" data-tab-group="model">
  <div role="tablist" aria-label="model">
    <button role="tab"
            aria-selected="true"
            aria-controls="elser-tab-search"
            id="elser-search">
      ELSER
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="dense-vector-tab-search"
            id="dense-vector-search">
      Dense vector models
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="elser-tab-search"
       aria-labelledby="elser-search">
<p>ELSER text embeddings can be queried using a
<a class="xref" href="query-dsl-sparse-vector-query.html" title="Sparse vector query">sparse vector query</a>. The sparse vector
query enables you to query a <a class="xref" href="sparse-vector.html" title="Sparse vector field type">sparse vector</a> field, by
providing the inference ID associated with the NLP model you want to use, and the query text:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="my-index",
    query={
        "sparse_vector": {
            "field": "my_tokens",
            "inference_id": "my-elser-endpoint",
            "query": "the query string"
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "my-index",
  query: {
    sparse_vector: {
      field: "my_tokens",
      inference_id: "my-elser-endpoint",
      query: "the query string",
    },
  },
});
console.log(response);</pre>
</div>
<a id="5ddc26da6e163fda54f52d33b5157051"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET my-index/_search
{
   "query":{
    "sparse_vector": {
        "field": "my_tokens",
        "inference_id": "my-elser-endpoint",
        "query": "the query string"
      }
   }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/1081.console"></div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="dense-vector-tab-search"
       aria-labelledby="dense-vector-search"
       hidden="">
<p>Text embeddings produced by dense vector models can be queried using a
<a class="xref" href="knn-search.html#knn-semantic-search" title="Perform semantic search">kNN search</a>. In the <code class="literal">knn</code> clause, provide the name of the
dense vector field, and a <code class="literal">query_vector_builder</code> clause with the model ID and
the query text.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="my-index",
    knn={
        "field": "my_embeddings.predicted_value",
        "k": 10,
        "num_candidates": 100,
        "query_vector_builder": {
            "text_embedding": {
                "model_id": "sentence-transformers__msmarco-minilm-l-12-v3",
                "model_text": "the query string"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  index: 'my-index',
  body: {
    knn: {
      field: 'my_embeddings.predicted_value',
      k: 10,
      num_candidates: 100,
      query_vector_builder: {
        text_embedding: {
          model_id: 'sentence-transformers__msmarco-minilm-l-12-v3',
          model_text: 'the query string'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "my-index",
  knn: {
    field: "my_embeddings.predicted_value",
    k: 10,
    num_candidates: 100,
    query_vector_builder: {
      text_embedding: {
        model_id: "sentence-transformers__msmarco-minilm-l-12-v3",
        model_text: "the query string",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="d952ac7c73219d8cabc080679e035514"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET my-index/_search
{
  "knn": {
    "field": "my_embeddings.predicted_value",
    "k": 10,
    "num_candidates": 100,
    "query_vector_builder": {
      "text_embedding": {
        "model_id": "sentence-transformers__msmarco-minilm-l-12-v3",
        "model_text": "the query string"
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1082.console"></div>
  </div>
</div>
<div class="position-relative"><h4><a id="deployed-hybrid-search"></a>Beyond semantic search with hybrid search</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/search/search-your-data/semantic-search-deploy-model.asciidoc">edit</a></div>
<p>In some situations, lexical search may perform better than semantic search.
For example, when searching for single words or IDs, like product numbers.</p>
<p>Combining semantic and lexical search into one hybrid search request using <a class="xref" href="rrf.html" title="Reciprocal rank fusion">reciprocal rank fusion</a> provides the best of both worlds.
Not only that, but hybrid search using reciprocal rank fusion <a href="/blog/improving-information-retrieval-elastic-stack-hybrid" class="ulink" target="_top">has been shown to perform better in general</a>.</p>
<div class="tabs" data-tab-group="model">
  <div role="tablist" aria-label="model">
    <button role="tab"
            aria-selected="true"
            aria-controls="elser-tab-hybrid-search"
            id="elser-hybrid-search">
      ELSER
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="dense-vector-tab-hybrid-search"
            id="dense-vector-hybrid-search">
      Dense vector models
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="elser-tab-hybrid-search"
       aria-labelledby="elser-hybrid-search">
<p>Hybrid search between a semantic and lexical query can be achieved by using an
<a class="xref" href="retriever.html#rrf-retriever" title="RRF Retriever"><code class="literal">rrf</code> retriever</a> as part of your search request. Provide a
<code class="literal">sparse_vector</code> query and a full-text query as
<a class="xref" href="retriever.html#standard-retriever" title="Standard Retriever"><code class="literal">standard</code> retrievers</a> for the <code class="literal">rrf</code> retriever. The <code class="literal">rrf</code>
retriever uses <a class="xref" href="rrf.html" title="Reciprocal rank fusion">reciprocal rank fusion</a> to rank the top documents.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="my-index",
    retriever={
        "rrf": {
            "retrievers": [
                {
                    "standard": {
                        "query": {
                            "match": {
                                "my_text_field": "the query string"
                            }
                        }
                    }
                },
                {
                    "standard": {
                        "query": {
                            "sparse_vector": {
                                "field": "my_tokens",
                                "inference_id": "my-elser-endpoint",
                                "query": "the query string"
                            }
                        }
                    }
                }
            ]
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "my-index",
  retriever: {
    rrf: {
      retrievers: [
        {
          standard: {
            query: {
              match: {
                my_text_field: "the query string",
              },
            },
          },
        },
        {
          standard: {
            query: {
              sparse_vector: {
                field: "my_tokens",
                inference_id: "my-elser-endpoint",
                query: "the query string",
              },
            },
          },
        },
      ],
    },
  },
});
console.log(response);</pre>
</div>
<a id="4e4608ae4ce93c27bd174a9ea078cab2"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET my-index/_search
{
  "retriever": {
    "rrf": {
      "retrievers": [
        {
          "standard": {
            "query": {
              "match": {
                "my_text_field": "the query string"
              }
            }
          }
        },
        {
          "standard": {
            "query": {
             "sparse_vector": {
                "field": "my_tokens",
                "inference_id": "my-elser-endpoint",
                "query": "the query string"
              }
            }
          }
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/1083.console"></div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="dense-vector-tab-hybrid-search"
       aria-labelledby="dense-vector-hybrid-search"
       hidden="">
<p>Hybrid search between a semantic and lexical query can be achieved by providing:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
an <code class="literal">rrf</code> retriever to rank top documents using <a class="xref" href="rrf.html" title="Reciprocal rank fusion">reciprocal rank fusion</a>
</li>
<li class="listitem">
a <code class="literal">standard</code> retriever as a child retriever with <code class="literal">query</code> clause for the full-text query
</li>
<li class="listitem">
a <code class="literal">knn</code> retriever as a child retriever with the kNN search that queries the dense vector field
</li>
</ul>
</div>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="my-index",
    retriever={
        "rrf": {
            "retrievers": [
                {
                    "standard": {
                        "query": {
                            "match": {
                                "my_text_field": "the query string"
                            }
                        }
                    }
                },
                {
                    "knn": {
                        "field": "text_embedding.predicted_value",
                        "k": 10,
                        "num_candidates": 100,
                        "query_vector_builder": {
                            "text_embedding": {
                                "model_id": "sentence-transformers__msmarco-minilm-l-12-v3",
                                "model_text": "the query string"
                            }
                        }
                    }
                }
            ]
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "my-index",
  retriever: {
    rrf: {
      retrievers: [
        {
          standard: {
            query: {
              match: {
                my_text_field: "the query string",
              },
            },
          },
        },
        {
          knn: {
            field: "text_embedding.predicted_value",
            k: 10,
            num_candidates: 100,
            query_vector_builder: {
              text_embedding: {
                model_id: "sentence-transformers__msmarco-minilm-l-12-v3",
                model_text: "the query string",
              },
            },
          },
        },
      ],
    },
  },
});
console.log(response);</pre>
</div>
<a id="fdf7cfdf1c92d21ee710675596eac6fd"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET my-index/_search
{
  "retriever": {
    "rrf": {
      "retrievers": [
        {
          "standard": {
            "query": {
              "match": {
                "my_text_field": "the query string"
              }
            }
          }
        },
        {
          "knn": {
            "field": "text_embedding.predicted_value",
            "k": 10,
            "num_candidates": 100,
            "query_vector_builder": {
              "text_embedding": {
                "model_id": "sentence-transformers__msmarco-minilm-l-12-v3",
                "model_text": "the query string"
              }
            }
          }
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/1084.console"></div>
  </div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="cohere-es.html">« Tutorial: Using Cohere with Elasticsearch</a>
</span>
<span class="next">
<a href="retrievers-reranking-overview.html">Retrievers and reranking »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
