<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Create data frame analytics jobs API | Elasticsearch Guide [8.2] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [8.2]"/>
<link rel="up" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"/>
<link rel="prev" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"/>
<link rel="next" href="delete-dfanalytics.html" title="Delete data frame analytics jobs API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.2"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.2"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.2]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="ml-df-analytics-apis.html">Machine learning data frame analytics APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-df-analytics-apis.html">« Machine learning data frame analytics APIs</a>
</span>
<span class="next">
<a href="delete-dfanalytics.html">Delete data frame analytics jobs API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="put-dfanalytics"></a>Create data frame analytics jobs API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h2>
</div></div></div>

<p>Instantiates a data frame analytics job.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-request"></a>Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _ml/data_frame/analytics/&lt;data_frame_analytics_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-prereq"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the following privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
cluster: <code class="literal">manage_ml</code> (the <code class="literal">machine_learning_admin</code> built-in role grants this
privilege)
</li>
<li class="listitem">
source indices: <code class="literal">read</code>, <code class="literal">view_index_metadata</code>
</li>
<li class="listitem">
destination index: <code class="literal">read</code>, <code class="literal">create_index</code>, <code class="literal">manage</code> and <code class="literal">index</code>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The data frame analytics job remembers which roles the user who created it had at
the time of creation. When you start the job, it performs the analysis using
those same roles. If you provide
<a class="xref" href="http-clients.html#http-clients-secondary-authorization" title="Secondary authorization">secondary authorization headers</a>,
those credentials are used instead.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-desc"></a>Description<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p>This API creates a data frame analytics job that performs an analysis on the source
indices and stores the outcome in a destination index.</p>
<p>If the destination index does not exist, it is created automatically when you
start the job. See <a class="xref" href="start-dfanalytics.html" title="Start data frame analytics jobs API">Start data frame analytics jobs</a>.</p>
<p>If you supply only a subset of the regression or classification parameters,
<a href="/guide/en/machine-learning/8.2/hyperparameters.html" class="ulink" target="_top">hyperparameter optimization</a> occurs. It
determines a value for each of the undefined parameters.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-path-params"></a>Path parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;data_frame_analytics_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the data frame analytics job. This identifier can contain lowercase
alphanumeric characters (a-z and 0-9), hyphens, and underscores. It must start
and end with alphanumeric characters.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-request-body"></a>Request body<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_lazy_start</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Specifies whether this job can start when there is insufficient machine learning node
capacity for it to be immediately assigned to a node. The default is <code class="literal">false</code>; if
a machine learning node with capacity to run the job cannot immediately be found, the API
returns an error. However, this is also subject to the cluster-wide
<code class="literal">xpack.ml.max_lazy_ml_nodes</code> setting. See <a class="xref" href="ml-settings.html#advanced-ml-settings" title="Advanced machine learning settings">Advanced machine learning settings</a>. If this
option is set to <code class="literal">true</code>, the API does not return an error and the job waits in
the <code class="literal">starting</code> state until sufficient machine learning node capacity is available.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analysis</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The analysis configuration, which contains the information necessary to perform
one of the following types of analysis: classification, outlier detection, or
regression.
</p>
<details open>
<summary class="title">Properties of <code class="literal">analysis</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">classification</code>
</span>
</dt>
<dd>
<p>
(Required<sup>*</sup>, object)
The configuration information necessary to perform
<a href="/guide/en/machine-learning/8.2/ml-dfa-classification.html" class="ulink" target="_top">classification</a>.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Advanced parameters are for fine-tuning classification analysis. They are set
automatically by hyperparameter optimization to give the minimum validation
error. It is highly recommended to use the default values unless you fully
understand the function of these parameters.</p>
</div>
</div>
<details open>
<summary class="title">Properties of <code class="literal">classification</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">alpha</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Machine learning uses loss guided tree growing, which
means that the decision trees grow where the regularized loss decreases most
quickly. This parameter affects loss calculations by acting as a multiplier of
the tree depth. Higher alpha values result in shallower trees and faster
training times. By default, this value is calculated during hyperparameter
optimization. It must be greater than or equal to zero.
</dd>
<dt>
<span class="term">
<code class="literal">class_assignment_objective</code>
</span>
</dt>
<dd>
(Optional, string)
Defines the objective to optimize when assigning class labels:
<code class="literal">maximize_accuracy</code> or <code class="literal">maximize_minimum_recall</code>. When maximizing accuracy,
class labels are chosen to maximize the number of correct predictions. When
maximizing minimum recall, labels are chosen to maximize the minimum recall for
any class. Defaults to <code class="literal">maximize_minimum_recall</code>.
</dd>
<dt>
<span class="term">
<code class="literal">dependent_variable</code>
</span>
</dt>
<dd>
<p>
(Required, string)
</p>
<p>Defines which field of the document is to be predicted.
This parameter is supplied by field name and must match one of the fields in
the index being used to train. If this field is missing from a document, then
that document will not be used for training, but a prediction with the trained
model will be generated for it. It is also known as continuous target variable.</p>
<p>The data type of the field must be numeric (<code class="literal">integer</code>, <code class="literal">short</code>, <code class="literal">long</code>, <code class="literal">byte</code>),
categorical (<code class="literal">ip</code> or <code class="literal">keyword</code>), or boolean. There must be no more than 30
different values in this field.</p>
</dd>
<dt>
<span class="term">
<code class="literal">downsample_factor</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Controls the fraction of data that is used to
compute the derivatives of the loss function for tree training. A small value
results in the use of a small fraction of the data. If this value is set to be
less than 1, accuracy typically improves. However, too small a value may result
in poor convergence for the ensemble and so require more trees. For more
information about shrinkage, refer to
<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Stochastic_gradient_boosting" class="ulink" target="_top">this wiki article</a>.
By default, this value is calculated during hyperparameter optimization. It
must be greater than zero and less than or equal to 1.
</dd>
<dt>
<span class="term">
<code class="literal">early_stopping_enabled</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Advanced configuration option.
Specifies whether the training process should finish if it is not finding any
better performing models. If disabled, the training process can take significantly
longer and the chance of finding a better performing model is unremarkable.
By default, early stoppping is enabled.
</dd>
<dt>
<span class="term">
<code class="literal">eta</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. The shrinkage applied to the weights. Smaller
values result in larger forests which have a better generalization error.
However, larger forests cause slower training. For more information about
shrinkage, refer to
<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Shrinkage" class="ulink" target="_top">this wiki article</a>.
By default, this value is calculated during hyperparameter optimization. It must
be a value between 0.001 and 1.
</dd>
<dt>
<span class="term">
<code class="literal">eta_growth_rate_per_tree</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Specifies the rate at which <code class="literal">eta</code> increases for
each new tree that is added to the forest. For example, a rate of 1.05
increases <code class="literal">eta</code> by 5% for each extra tree. By default, this value is calculated
during hyperparameter optimization. It must be between 0.5 and 2.
</dd>
<dt>
<span class="term">
<code class="literal">feature_bag_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Defines the fraction of features that will be
used when selecting a random bag for each candidate split. By default, this
value is calculated during hyperparameter optimization.
</dd>
<dt>
<span class="term">
<code class="literal">feature_processors</code>
</span>
</dt>
<dd>
<p>
(Optional, list)
Advanced configuration option. A collection of feature preprocessors that modify
one or more included fields. The analysis uses the resulting one or more
features instead of the original document field. However, these features are
ephemeral; they are not stored in the destination index. Multiple
<code class="literal">feature_processors</code> entries can refer to the same document fields. Automatic
categorical <a href="/guide/en/machine-learning/8.2/ml-feature-encoding.html" class="ulink" target="_top">feature encoding</a> still occurs
for the fields that are unprocessed by a custom processor or that have
categorical values. Use this property only if you want to override the automatic
feature encoding of the specified fields. Refer to
<a href="/guide/en/machine-learning/8.2/ml-feature-processors.html" class="ulink" target="_top">data frame analytics feature processors</a> to learn
more.
</p>
<details open>
<summary class="title">Properties of <code class="literal">feature_processors</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">frequency_encoding</code>
</span>
</dt>
<dd>
<p>
(object)
The configuration information necessary to perform frequency encoding.
</p>
<details open>
<summary class="title">Properties of <code class="literal">frequency_encoding</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">feature_name</code>
</span>
</dt>
<dd>
(Required, string)
The resulting feature name.
</dd>
<dt>
<span class="term">
<code class="literal">field</code>
</span>
</dt>
<dd>
(Required, string)
The name of the field to encode.
</dd>
<dt>
<span class="term">
<code class="literal">frequency_map</code>
</span>
</dt>
<dd>
(Required, object)
The resulting frequency map for the field value. If the field value is missing
from the <code class="literal">frequency_map</code>, the resulting value is <code class="literal">0</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">multi_encoding</code>
</span>
</dt>
<dd>
<p>
(object)
The configuration information necessary to perform multi encoding. It allows
multiple processors to be changed together. This way the output of a processor
can then be passed to another as an input.
</p>
<details open>
<summary class="title">Properties of <code class="literal">multi_encoding</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">processors</code>
</span>
</dt>
<dd>
(Required, array)
The ordered array of custom processors to execute. Must be more than 1.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">n_gram_encoding</code>
</span>
</dt>
<dd>
<p>
(object)
The configuration information necessary to perform n-gram encoding. Features
created by this encoder have the following name format:
<code class="literal">&lt;feature_prefix&gt;.&lt;ngram&gt;&lt;string position&gt;</code>. For example, if the
<code class="literal">feature_prefix</code> is <code class="literal">f</code>, the feature name for the second unigram in a string is
<code class="literal">f.11</code>.
</p>
<details open>
<summary class="title">Properties of <code class="literal">n_gram_encoding</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">feature_prefix</code>
</span>
</dt>
<dd>
(Optional, string)
The feature name prefix. Defaults to <code class="literal">ngram_&lt;start&gt;_&lt;length&gt;</code>.
</dd>
<dt>
<span class="term">
<code class="literal">field</code>
</span>
</dt>
<dd>
(Required, string)
The name of the text field to encode.
</dd>
<dt>
<span class="term">
<code class="literal">length</code>
</span>
</dt>
<dd>
(Optional, integer)
Specifies the length of the n-gram substring. Defaults to <code class="literal">50</code>. Must be greater
than <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">n_grams</code>
</span>
</dt>
<dd>
(Required, array)
Specifies which n-grams to gather. It’s an array of integer values where the
minimum value is 1, and a maximum value is 5.
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, integer)
Specifies the zero-indexed start of the n-gram substring. Negative values are
allowed for encoding n-grams of string suffixes. Defaults to <code class="literal">0</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">one_hot_encoding</code>
</span>
</dt>
<dd>
<p>
(object)
The configuration information necessary to perform one hot encoding.
</p>
<details open>
<summary class="title">Properties of <code class="literal">one_hot_encoding</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">field</code>
</span>
</dt>
<dd>
(Required, string)
The name of the field to encode.
</dd>
<dt>
<span class="term">
<code class="literal">hot_map</code>
</span>
</dt>
<dd>
(Required, string)
The one hot map mapping the field value with the column name.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">target_mean_encoding</code>
</span>
</dt>
<dd>
<p>
(object)
The configuration information necessary to perform target mean encoding.
</p>
<details open>
<summary class="title">Properties of <code class="literal">target_mean_encoding</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">default_value</code>
</span>
</dt>
<dd>
(Required, integer)
The default value if field value is not found in the <code class="literal">target_map</code>.
</dd>
<dt>
<span class="term">
<code class="literal">feature_name</code>
</span>
</dt>
<dd>
(Required, string)
The resulting feature name.
</dd>
<dt>
<span class="term">
<code class="literal">field</code>
</span>
</dt>
<dd>
(Required, string)
The name of the field to encode.
</dd>
<dt>
<span class="term">
<code class="literal">target_map</code>
</span>
</dt>
<dd>
(Required, object)
The field value to target mean transition map.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">gamma</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Regularization parameter to prevent overfitting
on the training data set. Multiplies a linear penalty associated with the size
of individual trees in the forest. A high gamma value causes training to prefer
small trees. A small gamma value results in larger individual trees and slower
training. By default, this value is calculated during hyperparameter
optimization. It must be a nonnegative value.
</dd>
<dt>
<span class="term">
<code class="literal">lambda</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Regularization parameter to prevent overfitting
on the training data set. Multiplies an L2 regularization term which applies to
leaf weights of the individual trees in the forest. A high lambda value causes
training to favor small leaf weights. This behavior makes the prediction
function smoother at the expense of potentially not being able to capture
relevant relationships between the features and the dependent variable. A small lambda
value results in large individual trees and slower training. By default, this
value is calculated during hyperparameter optimization. It must be a nonnegative
value.
</dd>
<dt>
<span class="term">
<code class="literal">max_optimization_rounds_per_hyperparameter</code>
</span>
</dt>
<dd>
(Optional, integer)
Advanced configuration option.
A multiplier responsible for determining the maximum number of
hyperparameter optimization steps in the Bayesian optimization procedure.
The maximum number of steps is determined based on the number of undefined
hyperparameters times the maximum optimization rounds per hyperparameter.
By default, this value is calculated during hyperparameter optimization.
</dd>
<dt>
<span class="term">
<code class="literal">max_trees</code>
</span>
</dt>
<dd>
(Optional, integer)
Advanced configuration option. Defines the maximum number of decision trees in
the forest. The maximum value is 2000. By default, this value is calculated
during hyperparameter optimization.
</dd>
<dt>
<span class="term">
<code class="literal">num_top_classes</code>
</span>
</dt>
<dd>
<p>
(Optional, integer)
Defines the number of categories for which the predicted probabilities are
reported. It must be non-negative or -1. If it is -1 or greater than the total
number of categories, probabilities are reported for all categories; if you have
a large number of categories, there could be a significant effect on the size of your destination index. Defaults to 2.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To use the
<a href="/guide/en/machine-learning/8.2/ml-dfa-classification.html#ml-dfanalytics-class-aucroc" class="ulink" target="_top">AUC ROC</a>
evaluation method, <code class="literal">num_top_classes</code> must be set to <code class="literal">-1</code> or a value greater than
or equal to the total number of categories.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">num_top_feature_importance_values</code>
</span>
</dt>
<dd>
(Optional, integer)
Advanced configuration option. Specifies the maximum number of
<a href="/guide/en/machine-learning/8.2/ml-feature-importance.html" class="ulink" target="_top">feature importance</a> values per document to return.
By default, it is zero and no feature importance calculation occurs.
</dd>
<dt>
<span class="term">
<code class="literal">prediction_field_name</code>
</span>
</dt>
<dd>
(Optional, string)
Defines the name of the prediction field in the results.
Defaults to <code class="literal">&lt;dependent_variable&gt;_prediction</code>.
</dd>
<dt>
<span class="term">
<code class="literal">randomize_seed</code>
</span>
</dt>
<dd>
(Optional, long)
Defines the seed for the random generator that is used to pick training data. By
default, it is randomly generated. Set it to a specific value to use the same
training data each time you start a job (assuming other related parameters such
as <code class="literal">source</code> and <code class="literal">analyzed_fields</code> are the same).
</dd>
<dt>
<span class="term">
<code class="literal">soft_tree_depth_limit</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Machine learning uses loss guided tree growing, which
means that the decision trees grow where the regularized loss decreases most
quickly. This soft limit combines with the <code class="literal">soft_tree_depth_tolerance</code> to
penalize trees that exceed the specified depth; the regularized loss increases
quickly beyond this depth. By default, this value is calculated during
hyperparameter optimization. It must be greater than or equal to 0.
</dd>
<dt>
<span class="term">
<code class="literal">soft_tree_depth_tolerance</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. This option controls how quickly the regularized
loss increases when the tree depth exceeds <code class="literal">soft_tree_depth_limit</code>. By default,
this value is calculated during hyperparameter optimization. It must be greater
than or equal to 0.01.
</dd>
<dt>
<span class="term">
<code class="literal">training_percent</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines what percentage of the eligible documents that will
be used for training. Documents that are ignored by the analysis (for example
those that contain arrays with more than one value) won’t be included in the
calculation for used percentage. Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">outlier_detection</code>
</span>
</dt>
<dd>
<p>
(Required<sup>*</sup>, object)
The configuration information necessary to perform
<a href="/guide/en/machine-learning/8.2/ml-dfa-finding-outliers.html" class="ulink" target="_top">outlier detection</a>:
</p>
<details open>
<summary class="title">Properties of <code class="literal">outlier_detection</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">compute_feature_influence</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Specifies whether the feature influence calculation is enabled. Defaults to
<code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">feature_influence_threshold</code>
</span>
</dt>
<dd>
(Optional, double)
The minimum outlier score that a document needs to have in order to calculate its
feature influence score. Value range: 0-1 (<code class="literal">0.1</code> by default).
</dd>
<dt>
<span class="term">
<code class="literal">method</code>
</span>
</dt>
<dd>
(Optional, string)
The method that outlier detection uses. Available methods are <code class="literal">lof</code>, <code class="literal">ldof</code>,
<code class="literal">distance_kth_nn</code>, <code class="literal">distance_knn</code>, and <code class="literal">ensemble</code>. The default value is
<code class="literal">ensemble</code>, which means that outlier detection uses an ensemble of different methods
and normalises and combines their individual outlier scores to obtain the overall
outlier score.
</dd>
<dt>
<span class="term">
<code class="literal">n_neighbors</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines the value for how many nearest neighbors each method of outlier detection
uses to calculate its outlier score. When the value is not set, different values are
used for different ensemble members. This default behavior helps improve the
diversity in the ensemble; only override it if you are confident that the value
you choose is appropriate for the data set.
</dd>
<dt>
<span class="term">
<code class="literal">outlier_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
The proportion of the data set that is assumed to be outlying prior to
outlier detection. For example, 0.05 means it is assumed that 5% of values are real
outliers and 95% are inliers.
</dd>
<dt>
<span class="term">
<code class="literal">standardization_enabled</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, the following operation is performed on the columns before computing
outlier scores: (x_i - mean(x_i)) / sd(x_i). Defaults to <code class="literal">true</code>. For more
information about this concept, see
<a href="https://en.wikipedia.org/wiki/Feature_scaling#Standardization_(Z-score_Normalization)" class="ulink" target="_top">Wikipedia</a>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">regression</code>
</span>
</dt>
<dd>
<p>
(Required<sup>*</sup>, object)
The configuration information necessary to perform
<a href="/guide/en/machine-learning/8.2/ml-dfa-regression.html" class="ulink" target="_top">regression</a>.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Advanced parameters are for fine-tuning regression analysis. They are set
automatically by hyperparameter optimization to give the minimum validation
error. It is highly recommended to use the default values unless you fully
understand the function of these parameters.</p>
</div>
</div>
<details open>
<summary class="title">Properties of <code class="literal">regression</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">alpha</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Machine learning uses loss guided tree growing, which
means that the decision trees grow where the regularized loss decreases most
quickly. This parameter affects loss calculations by acting as a multiplier of
the tree depth. Higher alpha values result in shallower trees and faster
training times. By default, this value is calculated during hyperparameter
optimization. It must be greater than or equal to zero.
</dd>
<dt>
<span class="term">
<code class="literal">dependent_variable</code>
</span>
</dt>
<dd>
<p>
(Required, string)
</p>
<p>Defines which field of the document is to be predicted.
This parameter is supplied by field name and must match one of the fields in
the index being used to train. If this field is missing from a document, then
that document will not be used for training, but a prediction with the trained
model will be generated for it. It is also known as continuous target variable.</p>
<p>The data type of the field must be numeric.</p>
</dd>
<dt>
<span class="term">
<code class="literal">downsample_factor</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Controls the fraction of data that is used to
compute the derivatives of the loss function for tree training. A small value
results in the use of a small fraction of the data. If this value is set to be
less than 1, accuracy typically improves. However, too small a value may result
in poor convergence for the ensemble and so require more trees. For more
information about shrinkage, refer to
<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Stochastic_gradient_boosting" class="ulink" target="_top">this wiki article</a>.
By default, this value is calculated during hyperparameter optimization. It
must be greater than zero and less than or equal to 1.
</dd>
<dt>
<span class="term">
<code class="literal">early_stopping_enabled</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Advanced configuration option.
Specifies whether the training process should finish if it is not finding any
better performing models. If disabled, the training process can take significantly
longer and the chance of finding a better performing model is unremarkable.
By default, early stoppping is enabled.
</dd>
<dt>
<span class="term">
<code class="literal">eta</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. The shrinkage applied to the weights. Smaller
values result in larger forests which have a better generalization error.
However, larger forests cause slower training. For more information about
shrinkage, refer to
<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Shrinkage" class="ulink" target="_top">this wiki article</a>.
By default, this value is calculated during hyperparameter optimization. It must
be a value between 0.001 and 1.
</dd>
<dt>
<span class="term">
<code class="literal">eta_growth_rate_per_tree</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Specifies the rate at which <code class="literal">eta</code> increases for
each new tree that is added to the forest. For example, a rate of 1.05
increases <code class="literal">eta</code> by 5% for each extra tree. By default, this value is calculated
during hyperparameter optimization. It must be between 0.5 and 2.
</dd>
<dt>
<span class="term">
<code class="literal">feature_bag_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Defines the fraction of features that will be
used when selecting a random bag for each candidate split. By default, this
value is calculated during hyperparameter optimization.
</dd>
<dt>
<span class="term">
<code class="literal">feature_processors</code>
</span>
</dt>
<dd>
(Optional, list)
Advanced configuration option. A collection of feature preprocessors that modify
one or more included fields. The analysis uses the resulting one or more
features instead of the original document field. However, these features are
ephemeral; they are not stored in the destination index. Multiple
<code class="literal">feature_processors</code> entries can refer to the same document fields. Automatic
categorical <a href="/guide/en/machine-learning/8.2/ml-feature-encoding.html" class="ulink" target="_top">feature encoding</a> still occurs
for the fields that are unprocessed by a custom processor or that have
categorical values. Use this property only if you want to override the automatic
feature encoding of the specified fields. Refer to
<a href="/guide/en/machine-learning/8.2/ml-feature-processors.html" class="ulink" target="_top">data frame analytics feature processors</a> to learn
more.
</dd>
<dt>
<span class="term">
<code class="literal">gamma</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Regularization parameter to prevent overfitting
on the training data set. Multiplies a linear penalty associated with the size
of individual trees in the forest. A high gamma value causes training to prefer
small trees. A small gamma value results in larger individual trees and slower
training. By default, this value is calculated during hyperparameter
optimization. It must be a nonnegative value.
</dd>
<dt>
<span class="term">
<code class="literal">lambda</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Regularization parameter to prevent overfitting
on the training data set. Multiplies an L2 regularization term which applies to
leaf weights of the individual trees in the forest. A high lambda value causes
training to favor small leaf weights. This behavior makes the prediction
function smoother at the expense of potentially not being able to capture
relevant relationships between the features and the dependent variable. A small lambda
value results in large individual trees and slower training. By default, this
value is calculated during hyperparameter optimization. It must be a nonnegative
value.
</dd>
<dt>
<span class="term">
<code class="literal">loss_function</code>
</span>
</dt>
<dd>
(Optional, string)
The loss function used during regression. Available options are <code class="literal">mse</code> (mean
squared error), <code class="literal">msle</code> (mean squared logarithmic error),  <code class="literal">huber</code> (Pseudo-Huber
loss). Defaults to <code class="literal">mse</code>.
Refer to
<a href="/guide/en/machine-learning/8.2/dfa-regression-lossfunction.html" class="ulink" target="_top">Loss functions for regression analyses</a>
to learn more.
</dd>
<dt>
<span class="term">
<code class="literal">loss_function_parameter</code>
</span>
</dt>
<dd>
(Optional, double)
A positive number that is used as a parameter to the <code class="literal">loss_function</code>.
</dd>
<dt>
<span class="term">
<code class="literal">max_optimization_rounds_per_hyperparameter</code>
</span>
</dt>
<dd>
(Optional, integer)
Advanced configuration option.
A multiplier responsible for determining the maximum number of
hyperparameter optimization steps in the Bayesian optimization procedure.
The maximum number of steps is determined based on the number of undefined
hyperparameters times the maximum optimization rounds per hyperparameter.
By default, this value is calculated during hyperparameter optimization.
</dd>
<dt>
<span class="term">
<code class="literal">max_trees</code>
</span>
</dt>
<dd>
(Optional, integer)
Advanced configuration option. Defines the maximum number of decision trees in
the forest. The maximum value is 2000. By default, this value is calculated
during hyperparameter optimization.
</dd>
<dt>
<span class="term">
<code class="literal">num_top_feature_importance_values</code>
</span>
</dt>
<dd>
(Optional, integer)
Advanced configuration option. Specifies the maximum number of
<a href="/guide/en/machine-learning/8.2/ml-feature-importance.html" class="ulink" target="_top">feature importance</a> values per document to return.
By default, it is zero and no feature importance calculation occurs.
</dd>
<dt>
<span class="term">
<code class="literal">prediction_field_name</code>
</span>
</dt>
<dd>
(Optional, string)
Defines the name of the prediction field in the results.
Defaults to <code class="literal">&lt;dependent_variable&gt;_prediction</code>.
</dd>
<dt>
<span class="term">
<code class="literal">randomize_seed</code>
</span>
</dt>
<dd>
(Optional, long)
Defines the seed for the random generator that is used to pick training data. By
default, it is randomly generated. Set it to a specific value to use the same
training data each time you start a job (assuming other related parameters such
as <code class="literal">source</code> and <code class="literal">analyzed_fields</code> are the same).
</dd>
<dt>
<span class="term">
<code class="literal">soft_tree_depth_limit</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Machine learning uses loss guided tree growing, which
means that the decision trees grow where the regularized loss decreases most
quickly. This soft limit combines with the <code class="literal">soft_tree_depth_tolerance</code> to
penalize trees that exceed the specified depth; the regularized loss increases
quickly beyond this depth. By default, this value is calculated during
hyperparameter optimization. It must be greater than or equal to 0.
</dd>
<dt>
<span class="term">
<code class="literal">soft_tree_depth_tolerance</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. This option controls how quickly the regularized
loss increases when the tree depth exceeds <code class="literal">soft_tree_depth_limit</code>. By default,
this value is calculated during hyperparameter optimization. It must be greater
than or equal to 0.01.
</dd>
<dt>
<span class="term">
<code class="literal">training_percent</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines what percentage of the eligible documents that will
be used for training. Documents that are ignored by the analysis (for example
those that contain arrays with more than one value) won’t be included in the
calculation for used percentage. Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analyzed_fields</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specify <code class="literal">includes</code> and/or <code class="literal">excludes</code> patterns to select which fields will be
included in the analysis. The patterns specified in <code class="literal">excludes</code> are applied last,
therefore <code class="literal">excludes</code> takes precedence. In other words, if the same field is
specified in both <code class="literal">includes</code> and <code class="literal">excludes</code>, then the field will not be included
in the analysis.
</p>
<p><a id="dfa-supported-fields"></a>The supported fields for each type of analysis are as follows:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Outlier detection requires numeric or boolean data to analyze. The algorithms
don&#8217;t support missing values therefore fields that have data types other than
numeric or boolean are ignored. Documents where included fields contain missing
values, null values, or an array are also ignored. Therefore the <code class="literal">dest</code> index
may contain documents that don&#8217;t have an outlier score.
</li>
<li class="listitem">
Regression supports fields that are numeric, <code class="literal">boolean</code>, <code class="literal">text</code>,
<code class="literal">keyword</code>, and <code class="literal">ip</code>. It is also tolerant of missing values. Fields that are
supported are included in the analysis, other fields are ignored. Documents
where included fields contain an array with two or more values are also
ignored. Documents in the <code class="literal">dest</code> index that don’t contain a results field are
not included in the regression analysis.
</li>
<li class="listitem">
Classification supports fields that are numeric, <code class="literal">boolean</code>, <code class="literal">text</code>,
<code class="literal">keyword</code>, and <code class="literal">ip</code>. It is also tolerant of missing values. Fields that are
supported are included in the analysis, other fields are ignored. Documents
where included fields contain an array with two or more values are also ignored.
Documents in the <code class="literal">dest</code> index that don’t contain a results field are not
included in the classification analysis. Classification analysis can be improved by mapping
ordinal variable values to a single number. For example, in case of age ranges,
you can model the values as "0-14" = 0, "15-24" = 1, "25-34" = 2, and so on.
</li>
</ul>
</div>
<p>If <code class="literal">analyzed_fields</code> is not set, only the relevant fields will be included. For
example, all the numeric fields for outlier detection. For more information about
field selection, see <a class="xref" href="explain-dfanalytics.html" title="Explain data frame analytics API">Explain data frame analytics</a>.</p>
<details open>
<summary class="title">Properties of <code class="literal">analyzed_fields</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">excludes</code>
</span>
</dt>
<dd>
(Optional, array)
An array of strings that defines the fields that will be excluded from the
analysis. You do not need to add fields with unsupported data types to
<code class="literal">excludes</code>, these fields are excluded from the analysis automatically.
</dd>
<dt>
<span class="term">
<code class="literal">includes</code>
</span>
</dt>
<dd>
(Optional, array)
An array of strings that defines the fields that will be included in the
analysis.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string)
A description of the job.
</dd>
<dt>
<span class="term">
<code class="literal">dest</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The destination configuration, consisting of <code class="literal">index</code> and optionally
<code class="literal">results_field</code> (<code class="literal">ml</code> by default).
</p>
<details open>
<summary class="title">Properties of <code class="literal">dest</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Required, string) Defines the <em>destination index</em> to store the results of the
data frame analytics job.
</dd>
<dt>
<span class="term">
<code class="literal">results_field</code>
</span>
</dt>
<dd>
(Optional, string) Defines the name of the field in which to store the results
of the analysis. Defaults to <code class="literal">ml</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">max_num_threads</code>
</span>
</dt>
<dd>
(Optional, integer)
The maximum number of threads to be used by the analysis.
The default value is <code class="literal">1</code>. Using more threads may decrease the time
necessary to complete the analysis at the cost of using more CPU.
Note that the process may use additional threads for operational
functionality other than the analysis itself.
</dd>
<dt>
<span class="term">
<code class="literal">model_memory_limit</code>
</span>
</dt>
<dd>
(Optional, string)
The approximate maximum amount of memory resources that are permitted for
analytical processing. The default value for data frame analytics jobs is <code class="literal">1gb</code>. If
you specify a value for the <code class="literal">xpack.ml.max_model_memory_limit</code> setting, an error
occurs when you try to create jobs that have <code class="literal">model_memory_limit</code> values greater
than that setting value. For more information, see
<a class="xref" href="ml-settings.html" title="Machine learning settings in Elasticsearch">Machine learning settings</a>.
</dd>
<dt>
<span class="term">
<code class="literal">source</code>
</span>
</dt>
<dd>
<p>
(object)
The configuration of how to source the analysis data. It requires an <code class="literal">index</code>.
Optionally, <code class="literal">query</code>, <code class="literal">runtime_mappings</code>, and <code class="literal">_source</code> may be specified.
</p>
<details open>
<summary class="title">Properties of <code class="literal">source</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
<p>
(Required, string or array) Index or indices on which to perform the analysis.
It can be a single index or index pattern as well as an array of indices or
patterns.
</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your source indices contain documents with the same IDs, only the
document that is indexed last appears in the destination index.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object) The Elasticsearch query domain-specific language (<a class="xref" href="query-dsl.html" title="Query DSL">DSL</a>).
This value corresponds to the query object in an Elasticsearch search POST body. All the
options that are supported by Elasticsearch can be used, as this object is passed
verbatim to Elasticsearch. By default, this property has the following value:
<code class="literal">{"match_all": {}}</code>.
</dd>
<dt>
<span class="term">
<code class="literal">runtime_mappings</code>
</span>
</dt>
<dd>
(Optional, object) Definitions of runtime fields that will become part of the
mapping of the destination index.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Specify <code class="literal">includes</code> and/or <code class="literal">excludes</code> patterns to select which
fields will be present in the destination. Fields that are excluded cannot be
included in the analysis.
</p>
<details open>
<summary class="title">Properties of <code class="literal">_source</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">includes</code>
</span>
</dt>
<dd>
(array) An array of strings that defines the fields that will be included in the
destination.
</dd>
<dt>
<span class="term">
<code class="literal">excludes</code>
</span>
</dt>
<dd>
(array) An array of strings that defines the fields that will be excluded from
the destination.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-example"></a>Examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-put-dfanalytics-example-preprocess"></a>Preprocessing actions example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example shows how to limit the scope of the analysis to certain
fields, specify excluded fields in the destination index, and use a query to
filter your data before analysis.</p>
<a id="8c6f3bb8abae9ff1d21e776f16ad1c86"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/model-flight-delays-pre
{
  "source": {
    "index": [
      "kibana_sample_data_flights" <a id="CO648-1"></a><i class="conum" data-value="1"></i>
    ],
    "query": { <a id="CO648-2"></a><i class="conum" data-value="2"></i>
      "range": {
        "DistanceKilometers": {
          "gt": 0
        }
      }
    },
    "_source": { <a id="CO648-3"></a><i class="conum" data-value="3"></i>
      "includes": [],
      "excludes": [
        "FlightDelay",
        "FlightDelayType"
      ]
    }
  },
  "dest": { <a id="CO648-4"></a><i class="conum" data-value="4"></i>
    "index": "df-flight-delays",
    "results_field": "ml-results"
  },
  "analysis": {
  "regression": {
    "dependent_variable": "FlightDelayMin",
    "training_percent": 90
    }
  },
  "analyzed_fields": { <a id="CO648-5"></a><i class="conum" data-value="5"></i>
    "includes": [],
    "excludes": [
      "FlightNum"
    ]
  },
  "model_memory_limit": "100mb"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2346.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Source index to analyze.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This query filters out entire documents that will not be present in the
destination index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">_source</code> object defines fields in the data set that will be included or
excluded in the destination index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the destination index that contains the results of the analysis and
the fields of the source index specified in the <code class="literal">_source</code> object. Also defines
the name of the <code class="literal">results_field</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO648-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies fields to be included in or excluded from the analysis. This does
not affect whether the fields will be present in the destination index, only
affects whether they are used in the analysis.</p>
</td>
</tr>
</table>
</div>
<p>In this example, we can see that all the fields of the source index are included
in the destination index except <code class="literal">FlightDelay</code> and <code class="literal">FlightDelayType</code> because
these are defined as excluded fields by the <code class="literal">excludes</code> parameter of the
<code class="literal">_source</code> object. The <code class="literal">FlightNum</code> field is included in the destination index,
however it is not included in the analysis because it is explicitly specified as
excluded field by the <code class="literal">excludes</code> parameter of the <code class="literal">analyzed_fields</code> object.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-put-dfanalytics-example-od"></a>Outlier detection example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example creates the <code class="literal">loganalytics</code> data frame analytics job, the analysis
type is <code class="literal">outlier_detection</code>:</p>
<a id="ce3c391c2b1915cfc44a2917bca71d19"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/loganalytics
{
  "description": "Outlier detection on log data",
  "source": {
    "index": "logdata"
  },
  "dest": {
    "index": "logdata_out"
  },
  "analysis": {
    "outlier_detection": {
      "compute_feature_influence": true,
      "outlier_fraction": 0.05,
      "standardization_enabled": true
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2347.console"></div>
<p>The API returns the following result:</p>
<a id="eb82e2ad6479c02d04bdd75cd99117da"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "loganalytics",
  "description": "Outlier detection on log data",
  "source": {
    "index": [ "logdata" ],
    "query": {
      "match_all": {}
    }
  },
  "dest": {
    "index": "logdata_out",
    "results_field": "ml"
  },
  "analysis": {
    "outlier_detection": {
      "compute_feature_influence": true,
      "outlier_fraction": 0.05,
      "standardization_enabled": true
    }
  },
  "model_memory_limit": "1gb",
  "create_time": 1562265491319,
  "version": "8.0.0",
  "allow_lazy_start": false,
  "max_num_threads": 1
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-put-dfanalytics-example-r"></a>Regression examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example creates the <code class="literal">house_price_regression_analysis</code>
data frame analytics job, the analysis type is <code class="literal">regression</code>:</p>
<a id="e8211247c280a3fbbbdd32850b743b7b"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/house_price_regression_analysis
{
  "source": {
    "index": "houses_sold_last_10_yrs"
  },
  "dest": {
    "index": "house_price_predictions"
  },
  "analysis":
    {
      "regression": {
        "dependent_variable": "price"
      }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2348.console"></div>
<p>The API returns the following result:</p>
<a id="4ff328150800d40f323aa57c871362d7"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id" : "house_price_regression_analysis",
  "source" : {
    "index" : [
      "houses_sold_last_10_yrs"
    ],
    "query" : {
      "match_all" : { }
    }
  },
  "dest" : {
    "index" : "house_price_predictions",
    "results_field" : "ml"
  },
  "analysis" : {
    "regression" : {
      "dependent_variable" : "price",
      "training_percent" : 100
    }
  },
  "model_memory_limit" : "1gb",
  "create_time" : 1567168659127,
  "version" : "8.0.0",
  "allow_lazy_start" : false
}</pre>
</div>
<p>The following example creates a job and specifies a training percent:</p>
<a id="ae82eb17c23cb8e5761cb6240a5ed0a6"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/student_performance_mathematics_0.3
{
 "source": {
   "index": "student_performance_mathematics"
 },
 "dest": {
   "index":"student_performance_mathematics_reg"
 },
 "analysis":
   {
     "regression": {
       "dependent_variable": "G3",
       "training_percent": 70,  <a id="CO649-1"></a><i class="conum" data-value="1"></i>
       "randomize_seed": 19673948271  <a id="CO649-2"></a><i class="conum" data-value="2"></i>
     }
   }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2349.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO649-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The percentage of the data set that is used for training the model.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO649-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The seed that is used to randomly pick which data is used for training.</p>
</td>
</tr>
</table>
</div>
<p>The following example uses custom feature processors to transform the
categorical values for <code class="literal">DestWeather</code> into numerical values using one-hot,
target-mean, and frequency encoding techniques:</p>
<a id="dac8ec8547bc446637fd97d9fa872f4f"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/flight_prices
{
  "source": {
    "index": [
      "kibana_sample_data_flights"
    ]
  },
  "dest": {
    "index": "kibana_sample_flight_prices"
  },
  "analysis": {
    "regression": {
      "dependent_variable": "AvgTicketPrice",
      "num_top_feature_importance_values": 2,
      "feature_processors": [
        {
          "frequency_encoding": {
            "field": "DestWeather",
            "feature_name": "DestWeather_frequency",
            "frequency_map": {
              "Rain": 0.14604811155570188,
              "Heavy Fog": 0.14604811155570188,
              "Thunder &amp; Lightning": 0.14604811155570188,
              "Cloudy": 0.14604811155570188,
              "Damaging Wind": 0.14604811155570188,
              "Hail": 0.14604811155570188,
              "Sunny": 0.14604811155570188,
              "Clear": 0.14604811155570188
            }
          }
        },
        {
          "target_mean_encoding": {
            "field": "DestWeather",
            "feature_name": "DestWeather_targetmean",
            "target_map": {
              "Rain": 626.5588814585794,
              "Heavy Fog": 626.5588814585794,
              "Thunder &amp; Lightning": 626.5588814585794,
              "Hail": 626.5588814585794,
              "Damaging Wind": 626.5588814585794,
              "Cloudy": 626.5588814585794,
              "Clear": 626.5588814585794,
              "Sunny": 626.5588814585794
            },
            "default_value": 624.0249512020454
          }
        },
        {
          "one_hot_encoding": {
            "field": "DestWeather",
            "hot_map": {
              "Rain": "DestWeather_Rain",
              "Heavy Fog": "DestWeather_Heavy Fog",
              "Thunder &amp; Lightning": "DestWeather_Thunder &amp; Lightning",
              "Cloudy": "DestWeather_Cloudy",
              "Damaging Wind": "DestWeather_Damaging Wind",
              "Hail": "DestWeather_Hail",
              "Clear": "DestWeather_Clear",
              "Sunny": "DestWeather_Sunny"
            }
          }
        }
      ]
    }
  },
  "analyzed_fields": {
    "includes": [
      "AvgTicketPrice",
      "Cancelled",
      "DestWeather",
      "FlightDelayMin",
      "DistanceMiles"
    ]
  },
  "model_memory_limit": "30mb"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2350.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>These custom feature processors are optional; automatic
<a href="/guide/en/machine-learning/8.2/ml-feature-encoding.html" class="ulink" target="_top">feature encoding</a> still occurs for all
categorical features.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-put-dfanalytics-example-c"></a>Classification example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.2/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example creates the <code class="literal">loan_classification</code> data frame analytics job, the
analysis type is <code class="literal">classification</code>:</p>
<a id="4fb0629146ca78b85e823edd405497bb"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/loan_classification
{
  "source" : {
    "index": "loan-applicants"
  },
  "dest" : {
    "index": "loan-applicants-classified"
  },
  "analysis" : {
    "classification": {
      "dependent_variable": "label",
      "training_percent": 75,
      "num_top_classes": 2
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2351.console"></div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ml-df-analytics-apis.html">« Machine learning data frame analytics APIs</a>
</span>
<span class="next">
<a href="delete-dfanalytics.html">Delete data frame analytics jobs API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"csharp":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
