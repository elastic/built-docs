<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch, high watermark, low watermark, full disk">
<title>Mapping explosion | Elasticsearch Guide [8.8] | Elastic</title>
<meta class="elastic" name="content" content="Mapping explosion | Elasticsearch Guide [8.8]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.8]"/>
<link rel="up" href="fix-common-cluster-issues.html" title="Fix common cluster issues"/>
<link rel="prev" href="task-queue-backlog.html" title="Task queue backlog"/>
<link rel="next" href="hotspotting.html" title="Hot spotting"/>
<meta class="elastic" name="product_version" content="8.8"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.8"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.8"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.8]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="troubleshooting.html">Troubleshooting</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="fix-common-cluster-issues.html">Fix common cluster issues</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="task-queue-backlog.html">« Task queue backlog</a>
</span>
<span class="next">
<a href="hotspotting.html">Hot spotting »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="mapping-explosion"></a>Mapping explosion<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.8/docs/reference/troubleshooting/common-issues/mapping-explosion.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch&#8217;s search and <a href="/guide/en/kibana/8.8/discover.html" class="ulink" target="_top">Kibana&#8217;s discover</a> Javascript rendering are
dependent on the search&#8217;s backing indices total amount of
<a class="xref" href="mapping-types.html" title="Field data types">mapped fields</a>, of all mapping depths. When this total
amount is too high or is exponentially climbing, we refer to it as
experiencing mapping explosion. Field counts going this high are uncommon
and usually suggest an upstream document formatting issue as
<a href="/blog/found-crash-elasticsearch#mapping-explosion" class="ulink" target="_top">shown in this blog</a>.</p>
<p>Mapping explosion may surface as the following performance symptoms:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="cat-nodes.html" title="cat nodes API">CAT nodes</a> reporting high heap or CPU on the main node
and/or nodes hosting the indices shards. This may potentially
escalate to temporary node unresponsiveness and/or main overwhelm.
</li>
<li class="listitem">
<a class="xref" href="cat-tasks.html" title="cat task management API">CAT tasks</a> reporting long search durations only related to
this index or indices, even on simple searches.
</li>
<li class="listitem">
<a class="xref" href="cat-tasks.html" title="cat task management API">CAT tasks</a> reporting long index durations only related to
this index or indices. This usually relates to <a class="xref" href="cluster-pending.html" title="Pending cluster tasks API">pending tasks</a>
reporting that the coordinating node is waiting for all other nodes to
confirm they are on mapping update request.
</li>
<li class="listitem">
Discover&#8217;s <span class="strong strong"><strong>Fields for wildcard</strong></span> page-loading API command or <a href="/guide/en/kibana/8.8/console-kibana.html" class="ulink" target="_top">Dev Tools</a> page-refreshing Autocomplete API commands are taking a long time (more than 10 seconds) or
timing out in the browser&#8217;s Developer Tools Network tab.
</li>
<li class="listitem">
Discover&#8217;s <span class="strong strong"><strong>Available fields</strong></span> taking a long time to compile Javascript in the browser&#8217;s Developer Tools Performance tab. This may potentially escalate to temporary browser page unresponsiveness.
</li>
<li class="listitem">
Kibana&#8217;s <a href="/guide/en/kibana/8.8/alerting-getting-started.html" class="ulink" target="_top">alerting</a> or <a href="/guide/en/security/8.8/detection-engine-overview.html" class="ulink" target="_top">security rules</a> may error <code class="literal">The content length (X) is bigger than the maximum allowed string (Y)</code> where <code class="literal">X</code> is attempted payload and <code class="literal">Y</code> is Kibana&#8217;s <a href="/guide/en/kibana/8.8/settings.html#server-maxPayload" class="ulink" target="_top"><code class="literal">server-maxPayload</code></a>.
</li>
<li class="listitem">
Long Elasticsearch start-up durations.
</li>
</ul>
</div>
<h4><a id="prevent"></a>Prevent or prepare<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.8/docs/reference/troubleshooting/common-issues/mapping-explosion.asciidoc">edit</a></h4>
<p><a class="xref" href="mapping.html" title="Mapping">Mappings</a> cannot be field-reduced once initialized.
Elasticsearch indices default to <a class="xref" href="dynamic-mapping.html" title="Dynamic mapping">dynamic mappings</a> which
doesn&#8217;t normally cause problems unless it&#8217;s combined with overriding
<a class="xref" href="mapping-settings-limit.html" title="Mapping limit settings"><code class="literal">index.mapping.total_fields.limit</code></a>. The
default <code class="literal">1000</code> limit is considered generous, though overriding to <code class="literal">10000</code>
doesn&#8217;t cause noticable impact depending on use case. However, to give
a bad example, overriding to <code class="literal">100000</code> and this limit being hit
by mapping totals would usually have strong performance implications.</p>
<p>If your index mapped fields expect to contain a large, arbitrary set of
keys, you may instead consider:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Using the <a class="xref" href="flattened.html" title="Flattened field type">flattened</a> data type. Please note,
however, that flattened objects is <a href="https://github.com/elastic/kibana/issues/25820" class="ulink" target="_top">not fully supported in Kibana</a> yet. For example, this could apply to sub-mappings like { <code class="literal">host.name</code> ,
<code class="literal">host.os</code>, <code class="literal">host.version</code> }. Desired fields are still accessed by
<a class="xref" href="runtime-search-request.html" title="Define runtime fields in a search request">runtime fields</a>.
</li>
<li class="listitem">
Using the <a class="xref" href="object.html" title="Object field type">object data type</a>. This is helpful when you&#8217;re
interested in storing but not searching a group of fields. This is commonly
used for unknown upstream scenarios which may induce however many fields.
For example, this is recommended when sub-mappings start showing new,
unexpected fields like { <code class="literal">o365.a01</code>, <code class="literal">o365.a02</code>, <code class="literal">o365.b01</code>, <code class="literal">o365.c99</code>}.
</li>
<li class="listitem">
Setting <a class="xref" href="mapping-index.html" title="index"><code class="literal">index:false</code></a> to disable a particular field&#8217;s
searchability. This cannot effect current index mapping, but can apply
going forward via an <a class="xref" href="index-templates.html" title="Index templates">index template</a>.
</li>
</ul>
</div>
<p>Modifying to the <a class="xref" href="nested.html" title="Nested field type">nested</a> data type would not resolve the core
issue.</p>
<h4><a id="check"></a>Check for issue<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.8/docs/reference/troubleshooting/common-issues/mapping-explosion.asciidoc">edit</a></h4>
<p>To confirm the field totals of an index to check for mapping explosion:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Check Elasticsearch cluster logs for errors <code class="literal">Limit of total fields [X] in index [Y] has been exceeded</code> where <code class="literal">X</code> is the value of  <code class="literal">index.mapping.total_fields.limit</code> and <code class="literal">Y</code> is your index. The correlated ingesting source log error would be <code class="literal">Limit of total fields [X] has been exceeded while adding new fields [Z]</code> where <code class="literal">Z</code> is attempted new fields.
</li>
<li class="listitem">
For top-level fields, poll <a class="xref" href="search-field-caps.html" title="Field capabilities API">field capabilities</a> for <code class="literal">fields=*</code>.
</li>
<li class="listitem">
Search the output of <a class="xref" href="indices-get-mapping.html" title="Get mapping API">get mapping</a> for <code class="literal">"type"</code>.
</li>
<li class="listitem">
<p>If you&#8217;re inclined to use the <a href="https://stedolan.github.io/jq" class="ulink" target="_top">third-party tool JQ</a>, you can process the <a class="xref" href="indices-get-mapping.html" title="Get mapping API">get mapping</a> <code class="literal">mapping.json</code> output.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ cat mapping.json | jq -c 'to_entries[]| .key as $index| [.value.mappings| to_entries[]|select(.key=="properties") | {(.key):([.value|..|.type?|select(.!=null)]|length)}]| map(to_entries)| flatten| from_entries| ([to_entries[].value]|add)| {index: $index, field_count: .}'</pre>
</div>
</li>
</ul>
</div>
<p>You can use <a class="xref" href="indices-disk-usage.html" title="Analyze index disk usage API">analyze index disk usage</a> to find fields which are never or rarely populated as easy wins.</p>
<h4><a id="complex"></a>Complex explosions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.8/docs/reference/troubleshooting/common-issues/mapping-explosion.asciidoc">edit</a></h4>
<p>Mapping explosions also covers when an individual index field totals are within limits but combined indices fields totals are very high. It&#8217;s very common for symptoms to first be noticed on a <a href="/guide/en/kibana/8.8/data-views.html" class="ulink" target="_top">data view</a> and be traced back to an individual index or a subset of indices via the
<a class="xref" href="indices-resolve-index-api.html" title="Resolve index API">resolve index API</a>.</p>
<p>However, though less common, it is possible to only experience mapping explosions on the combination of backing indices. For example, if a <a class="xref" href="data-streams.html" title="Data streams">data stream</a>'s backing indices are all at field total limit but each contain unique fields from one another.</p>
<p>This situation most easily surfaces by adding a <a href="/guide/en/kibana/8.8/data-views.html" class="ulink" target="_top">data view</a> and checking its <span class="strong strong"><strong>Fields</strong></span> tab for its total fields count. This statistic does tells you overall fields and not only where <a class="xref" href="mapping-index.html" title="index"><code class="literal">index:true</code></a>, but serves as a good baseline.</p>
<p>If your issue only surfaces via a <a href="/guide/en/kibana/8.8/data-views.html" class="ulink" target="_top">data view</a>, you may consider this menu&#8217;s <span class="strong strong"><strong>Field filters</strong></span> if you&#8217;re not using <a class="xref" href="mapping-types.html" title="Field data types">multi-fields</a>. Alternatively, you may consider a more targeted index pattern or using a negative pattern to filter-out problematic indices. For example, if <code class="literal">logs-*</code> has too high a field count because of problematic backing indices <code class="literal">logs-lotsOfFields-*</code>, then you could update to either <code class="literal">logs-*,-logs-lotsOfFields-*</code> or <code class="literal">logs-iMeantThisAnyway-*</code>.</p>
<h4><a id="resolve"></a>Resolve<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.8/docs/reference/troubleshooting/common-issues/mapping-explosion.asciidoc">edit</a></h4>
<p>Mapping explosion is not easily resolved, so it is better prevented via the above. Encountering it usually indicates unexpected upstream data changes or planning failures. If encountered, we recommend reviewing your data architecture. The following options are additional to the ones discussed earlier on this page; they should be applied as best use-case applicable:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Disable <a class="xref" href="dynamic-mapping.html" title="Dynamic mapping">dynamic mappings</a>.
</li>
<li class="listitem">
<a class="xref" href="docs-reindex.html" title="Reindex API">Reindex</a> into an index with a corrected mapping,
either via <a class="xref" href="index-templates.html" title="Index templates">index template</a> or <a class="xref" href="explicit-mapping.html" title="Explicit mapping">explicitly set</a>.
</li>
<li class="listitem">
If index is unneeded and/or historical, consider <a class="xref" href="indices-delete-index.html" title="Delete index API">deleting</a>.
</li>
<li class="listitem">
<a href="/guide/en/logstash/8.8/plugins-inputs-elasticsearch.html" class="ulink" target="_top">Export</a> and <a href="/guide/en/logstash/8.8/plugins-outputs-elasticsearch.html" class="ulink" target="_top">re-import</a> data into a mapping-corrected index after <a href="/guide/en/logstash/8.8/plugins-filters-prune.html" class="ulink" target="_top">pruning</a>
problematic fields via Logstash.
</li>
</ul>
</div>
<p><a class="xref" href="indices-split-index.html" title="Split index API">Splitting index</a> would not resolve the core issue.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="task-queue-backlog.html">« Task queue backlog</a>
</span>
<span class="next">
<a href="hotspotting.html">Hot spotting »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
