<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Analyze eCommerce data with aggregations using Query DSL | Elasticsearch Guide [8.x] | Elastic</title>
<meta class="elastic" name="content" content="Analyze eCommerce data with aggregations using Query DSL | Elasticsearch Guide [8.x]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.x]"/>
<link rel="up" href="quickstart.html" title="Quick starts"/>
<link rel="prev" href="esql-search-tutorial.html" title="Tutorial: Search and filter with ES|QL"/>
<link rel="next" href="setup.html" title="Set up Elasticsearch"/>
<meta class="elastic" name="product_version" content="8.x"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.x"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="esql-search-tutorial.html">« Tutorial: Search and filter with ES|QL</a>
</span>
<span class="next">
<a href="setup.html">Set up Elasticsearch »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.x]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="quickstart.html">Quick starts</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Analyze eCommerce data with aggregations using Query DSL</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="aggregations-tutorial"></a>Analyze eCommerce data with aggregations using Query DSL</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
</div></div></div>

<p>This hands-on tutorial shows you how to analyze eCommerce data using Elasticsearch <a class="xref" href="search-aggregations.html" title="Aggregations">aggregations</a> with the <code class="literal">_search</code> API and Query DSL.</p>
<p>You&#8217;ll learn how to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Calculate key business metrics such as average order value
</li>
<li class="listitem">
Analyze sales patterns over time
</li>
<li class="listitem">
Compare performance across product categories
</li>
<li class="listitem">
Track moving averages and cumulative totals
</li>
</ul>
</div>
<div class="position-relative"><h3><a id="aggregations-tutorial-requirements"></a>Requirements</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>You&#8217;ll need:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>A running instance of <a class="xref" href="elasticsearch-intro-deploy.html" title="Run Elasticsearch">Elasticsearch</a>, either on Elastic Cloud Serverless or together with Kibana on Elastic Cloud Hosted/Self Managed deployments.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If you don&#8217;t have a deployment, you can run the following command in your terminal to set up a <a class="xref" href="run-elasticsearch-locally.html" title="Run Elasticsearch locally">local dev environment</a>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -fsSL https://elastic.co/start-local | sh</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>The <a href="/guide/en/kibana/8.x/get-started.html#gs-get-data-into-kibana" class="ulink" target="_top">sample eCommerce data</a> loaded into Elasticsearch. To load sample data follow these steps in your UI:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Open the <span class="strong strong"><strong>Integrations</strong></span> pages by searching in the global search field.
</li>
<li class="listitem">
Search for <code class="literal">sample data</code> in the <span class="strong strong"><strong>Integrations</strong></span> search field.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>Sample data</strong></span> page.
</li>
<li class="listitem">
Select the <span class="strong strong"><strong>Other sample data sets</strong></span> collapsible.
</li>
<li class="listitem">
Add the <span class="strong strong"><strong>Sample eCommerce orders</strong></span> data set.
This will create and populate an index called <code class="literal">kibana_sample_data_ecommerce</code>.
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="position-relative"><h3><a id="aggregations-tutorial-inspect-data"></a>Inspect index structure</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Before we start analyzing the data, let&#8217;s examine the structure of the documents in our sample eCommerce index. Run this command to see the field <a class="xref" href="documents-indices.html#elasticsearch-intro-documents-fields-mappings" title="Mappings and data types">mappings</a>:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.get_mapping(
    index="kibana_sample_data_ecommerce",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.getMapping({
  index: "kibana_sample_data_ecommerce",
});
console.log(response);</pre>
</div>
<a id="0722b302b2b3275a988d858044f99d5d"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_mapping</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/27.console"></div>
<p>The response shows the field mappings for the <code class="literal">kibana_sample_data_ecommerce</code> index.</p>
<details>
<summary class="title">Example response</summary>
<div class="content">
<div class="pre_wrapper lang-console-response">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-response">{
  "kibana_sample_data_ecommerce": {
    "mappings": {
      "properties": {
        "category": {
          "type": "text",
          "fields": { <a id="CO26-1"></a><i class="conum" data-value="1"></i>
            "keyword": {
              "type": "keyword"
            }
          }
        },
        "currency": {
          "type": "keyword"
        },
        "customer_birth_date": {
          "type": "date"
        },
        "customer_first_name": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 256
            }
          }
        },
        "customer_full_name": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 256
            }
          }
        },
        "customer_gender": {
          "type": "keyword"
        },
        "customer_id": {
          "type": "keyword"
        },
        "customer_last_name": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 256
            }
          }
        },
        "customer_phone": {
          "type": "keyword"
        },
        "day_of_week": {
          "type": "keyword"
        },
        "day_of_week_i": {
          "type": "integer"
        },
        "email": {
          "type": "keyword"
        },
        "event": {
          "properties": {
            "dataset": {
              "type": "keyword"
            }
          }
        },
        "geoip": {
          "properties": { <a id="CO26-2"></a><i class="conum" data-value="2"></i>
            "city_name": {
              "type": "keyword"
            },
            "continent_name": {
              "type": "keyword"
            },
            "country_iso_code": {
              "type": "keyword"
            },
            "location": {
              "type": "geo_point" <a id="CO26-3"></a><i class="conum" data-value="3"></i>
            },
            "region_name": {
              "type": "keyword"
            }
          }
        },
        "manufacturer": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword"
            }
          }
        },
        "order_date": {
          "type": "date"
        },
        "order_id": {
          "type": "keyword"
        },
        "products": {
          "properties": { <a id="CO26-4"></a><i class="conum" data-value="4"></i>
            "_id": {
              "type": "text",
              "fields": {
                "keyword": {
                  "type": "keyword",
                  "ignore_above": 256
                }
              }
            },
            "base_price": {
              "type": "half_float"
            },
            "base_unit_price": {
              "type": "half_float"
            },
            "category": {
              "type": "text",
              "fields": {
                "keyword": {
                  "type": "keyword"
                }
              }
            },
            "created_on": {
              "type": "date"
            },
            "discount_amount": {
              "type": "half_float"
            },
            "discount_percentage": {
              "type": "half_float"
            },
            "manufacturer": {
              "type": "text",
              "fields": {
                "keyword": {
                  "type": "keyword"
                }
              }
            },
            "min_price": {
              "type": "half_float"
            },
            "price": {
              "type": "half_float"
            },
            "product_id": {
              "type": "long"
            },
            "product_name": {
              "type": "text",
              "fields": {
                "keyword": {
                  "type": "keyword"
                }
              },
              "analyzer": "english"
            },
            "quantity": {
              "type": "integer"
            },
            "sku": {
              "type": "keyword"
            },
            "tax_amount": {
              "type": "half_float"
            },
            "taxful_price": {
              "type": "half_float"
            },
            "taxless_price": {
              "type": "half_float"
            },
            "unit_discount_amount": {
              "type": "half_float"
            }
          }
        },
        "sku": {
          "type": "keyword"
        },
        "taxful_total_price": {
          "type": "half_float"
        },
        "taxless_total_price": {
          "type": "half_float"
        },
        "total_quantity": {
          "type": "integer"
        },
        "total_unique_products": {
          "type": "integer"
        },
        "type": {
          "type": "keyword"
        },
        "user": {
          "type": "keyword"
        }
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO26-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">fields</code>: Multi-field mapping that allows both full text and exact matching</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO26-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">geoip.properties</code>: Object type field containing location-related properties</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO26-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">geoip.location</code>: Geographic coordinates stored as geo_point for location-based queries</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO26-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">products.properties</code>: Nested structure containing details about items in each order</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<p>The sample data includes the following <a class="xref" href="mapping-types.html" title="Field data types">field data types</a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><a class="xref" href="text.html" title="Text type family"><code class="literal">text</code></a> and <a class="xref" href="keyword.html" title="Keyword type family"><code class="literal">keyword</code></a> for text fields</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Most <code class="literal">text</code> fields have a <code class="literal">.keyword</code> subfield for exact matching using <a class="xref" href="multi-fields.html" title="fields">multi-fields</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<a class="xref" href="date.html" title="Date field type"><code class="literal">date</code></a> for date fields
</li>
<li class="listitem">
<p>3 <a class="xref" href="number.html" title="Numeric field types">numeric</a> types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">integer</code> for whole numbers
</li>
<li class="listitem">
<code class="literal">long</code> for large whole numbers
</li>
<li class="listitem">
<code class="literal">half_float</code> for floating-point numbers
</li>
</ul>
</div>
</li>
<li class="listitem">
<a class="xref" href="geo-point.html" title="Geopoint field type"><code class="literal">geo_point</code></a> for geographic coordinates
</li>
<li class="listitem">
<a class="xref" href="object.html" title="Object field type"><code class="literal">object</code></a> for nested structures such as <code class="literal">products</code>, <code class="literal">geoip</code>, <code class="literal">event</code>
</li>
</ul>
</div>
<p>Now that we understand the structure of our sample data, let&#8217;s start analyzing it.</p>
<div class="position-relative"><h3><a id="aggregations-tutorial-basic-metrics"></a>Get key business metrics</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Let&#8217;s start by calculating important metrics about orders and customers.</p>
<div class="position-relative"><h4><a id="aggregations-tutorial-order-value"></a>Get average order size</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Calculate the average order value across all orders in the dataset using the <a class="xref" href="search-aggregations-metrics-avg-aggregation.html" title="Avg aggregation"><code class="literal">avg</code></a> aggregation.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="kibana_sample_data_ecommerce",
    size=0,
    aggs={
        "avg_order_value": {
            "avg": {
                "field": "taxful_total_price"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "kibana_sample_data_ecommerce",
  size: 0,
  aggs: {
    avg_order_value: {
      avg: {
        field: "taxful_total_price",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="b590241c4296299b836fbb5a95bdd2dc"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_search
{
 "size": 0, <a id="CO27-1"></a><i class="conum" data-value="1"></i>
 "aggs": {
   "avg_order_value": { <a id="CO27-2"></a><i class="conum" data-value="2"></i>
     "avg": { <a id="CO27-3"></a><i class="conum" data-value="3"></i>
       "field": "taxful_total_price"
     }
   }
 }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/28.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set <code class="literal">size</code> to 0 to avoid returning matched documents in the response and return only the aggregation results</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>A meaningful name that describes what this metric represents</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Configures an <code class="literal">avg</code> aggregation, which calculates a simple arithmetic mean</p>
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Example response</summary>
<div class="content">
<a id="55987c54ff341e9a44b8466a384718ed"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 0,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675, <a id="CO28-1"></a><i class="conum" data-value="1"></i>
      "relation": "eq"
    },
    "max_score": null,
    "hits": [] <a id="CO28-2"></a><i class="conum" data-value="2"></i>
  },
  "aggregations": {
    "avg_order_value": { <a id="CO28-3"></a><i class="conum" data-value="3"></i>
      "value": 75.05542864304813 <a id="CO28-4"></a><i class="conum" data-value="4"></i>
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO28-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Total number of orders in the dataset</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO28-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">hits</code> is empty because we set <code class="literal">size</code> to 0</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO28-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Results appear under the name we specified in the request</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO28-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The average order value is calculated dynamically from all the orders in the dataset</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<div class="position-relative"><h4><a id="aggregations-tutorial-order-stats"></a>Get multiple order statistics at once</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Calculate multiple statistics about orders in one request using the <a class="xref" href="search-aggregations-metrics-stats-aggregation.html" title="Stats aggregation"><code class="literal">stats</code></a> aggregation.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="kibana_sample_data_ecommerce",
    size=0,
    aggs={
        "order_stats": {
            "stats": {
                "field": "taxful_total_price"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "kibana_sample_data_ecommerce",
  size: 0,
  aggs: {
    order_stats: {
      stats: {
        field: "taxful_total_price",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="3f9dcf2aa42f3ecfb5ebfe48c1774103"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_search
{
 "size": 0,
 "aggs": {
   "order_stats": { <a id="CO29-1"></a><i class="conum" data-value="1"></i>
     "stats": { <a id="CO29-2"></a><i class="conum" data-value="2"></i>
       "field": "taxful_total_price"
     }
   }
 }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/29.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A descriptive name for this set of statistics</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">stats</code> returns count, min, max, avg, and sum at once</p>
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Example response</summary>
<div class="content">
<a id="b9c9a225fee1a3105e7b468d9285a86b"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
 "aggregations": {
   "order_stats": {
     "count": 4675, <a id="CO30-1"></a><i class="conum" data-value="1"></i>
     "min": 6.98828125, <a id="CO30-2"></a><i class="conum" data-value="2"></i>
     "max": 2250, <a id="CO30-3"></a><i class="conum" data-value="3"></i>
     "avg": 75.05542864304813, <a id="CO30-4"></a><i class="conum" data-value="4"></i>
     "sum": 350884.12890625 <a id="CO30-5"></a><i class="conum" data-value="5"></i>
   }
 }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO30-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">"count"</code>: Total number of orders in the dataset</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO30-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">"min"</code>: Lowest individual order value in the dataset</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO30-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">"max"</code>: Highest individual order value in the dataset</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO30-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">"avg"</code>: Average value per order across all orders</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO30-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">"sum"</code>: Total revenue from all orders combined</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <a class="xref" href="search-aggregations-metrics-stats-aggregation.html" title="Stats aggregation">stats aggregation</a> is more efficient than running individual min, max, avg, and sum aggregations.</p>
</div>
</div>
<div class="position-relative"><h3><a id="aggregations-tutorial-sales-patterns"></a>Analyze sales patterns</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Let&#8217;s group orders in different ways to understand sales patterns.</p>
<div class="position-relative"><h4><a id="aggregations-tutorial-category-breakdown"></a>Break down sales by category</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Group orders by category to see which product categories are most popular, using the <a class="xref" href="search-aggregations-bucket-terms-aggregation.html" title="Terms aggregation"><code class="literal">terms</code></a> aggregation.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="kibana_sample_data_ecommerce",
    size=0,
    aggs={
        "sales_by_category": {
            "terms": {
                "field": "category.keyword",
                "size": 5,
                "order": {
                    "_count": "desc"
                }
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "kibana_sample_data_ecommerce",
  size: 0,
  aggs: {
    sales_by_category: {
      terms: {
        field: "category.keyword",
        size: 5,
        order: {
          _count: "desc",
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="bdc55256fa5f701680631a149dbb75a9"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_search
{
 "size": 0,
 "aggs": {
   "sales_by_category": { <a id="CO31-1"></a><i class="conum" data-value="1"></i>
     "terms": { <a id="CO31-2"></a><i class="conum" data-value="2"></i>
       "field": "category.keyword", <a id="CO31-3"></a><i class="conum" data-value="3"></i>
       "size": 5, <a id="CO31-4"></a><i class="conum" data-value="4"></i>
       "order": { "_count": "desc" } <a id="CO31-5"></a><i class="conum" data-value="5"></i>
     }
   }
 }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/30.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Name reflecting the business purpose of this breakdown</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">terms</code> aggregation groups documents by field values</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use <a class="xref" href="keyword.html" title="Keyword type family"><code class="literal">.keyword</code></a> field for exact matching on text fields</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Limit to top 5 categories</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Order by number of orders (descending)</p>
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Example response</summary>
<div class="content">
<a id="5bcb24e24ed5d879daa11feafaa2608d"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 4,
  "timed_out": false,
  "_shards": {
    "total": 5,
    "successful": 5,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "sales_by_category": {
      "doc_count_error_upper_bound": 0, <a id="CO32-1"></a><i class="conum" data-value="1"></i>
      "sum_other_doc_count": 572, <a id="CO32-2"></a><i class="conum" data-value="2"></i>
      "buckets": [ <a id="CO32-3"></a><i class="conum" data-value="3"></i>
        {
          "key": "Men's Clothing", <a id="CO32-4"></a><i class="conum" data-value="4"></i>
          "doc_count": 2024 <a id="CO32-5"></a><i class="conum" data-value="5"></i>
        },
        {
          "key": "Women's Clothing",
          "doc_count": 1903
        },
        {
          "key": "Women's Shoes",
          "doc_count": 1136
        },
        {
          "key": "Men's Shoes",
          "doc_count": 944
        },
        {
          "key": "Women's Accessories",
          "doc_count": 830
        }
      ]
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO32-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Due to Elasticsearch&#8217;s distributed architecture, when <a class="xref" href="search-aggregations-bucket-terms-aggregation.html" title="Terms aggregation">terms aggregations</a> run across multiple shards, the doc counts may have a small margin of error. This value indicates the maximum possible error in the counts.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO32-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Count of documents in categories beyond the requested size.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO32-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Array of category buckets, ordered by count.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO32-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Category name.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO32-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Number of orders in this category.</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<div class="position-relative"><h4><a id="aggregations-tutorial-daily-sales"></a>Track daily sales patterns</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Group orders by day to track daily sales patterns using the <a class="xref" href="search-aggregations-bucket-datehistogram-aggregation.html" title="Date histogram aggregation"><code class="literal">date_histogram</code></a> aggregation.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="kibana_sample_data_ecommerce",
    size=0,
    aggs={
        "daily_orders": {
            "date_histogram": {
                "field": "order_date",
                "calendar_interval": "day",
                "format": "yyyy-MM-dd",
                "min_doc_count": 0
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "kibana_sample_data_ecommerce",
  size: 0,
  aggs: {
    daily_orders: {
      date_histogram: {
        field: "order_date",
        calendar_interval: "day",
        format: "yyyy-MM-dd",
        min_doc_count: 0,
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="b6d278737d27973e498ac61cda9e5126"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_search
{
 "size": 0,
 "aggs": {
   "daily_orders": { <a id="CO33-1"></a><i class="conum" data-value="1"></i>
     "date_histogram": { <a id="CO33-2"></a><i class="conum" data-value="2"></i>
       "field": "order_date",
       "calendar_interval": "day", <a id="CO33-3"></a><i class="conum" data-value="3"></i>
       "format": "yyyy-MM-dd", <a id="CO33-4"></a><i class="conum" data-value="4"></i>
       "min_doc_count": 0 <a id="CO33-5"></a><i class="conum" data-value="5"></i>
     }
   }
 }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/31.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Descriptive name for the time-series aggregation results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">date_histogram</code> aggregration groups documents into time-based buckets, similar to terms aggregation but for dates.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Uses <a class="xref" href="search-aggregations-bucket-datehistogram-aggregation.html#calendar_and_fixed_intervals" title="Calendar and fixed intervals">calendar and fixed time intervals</a> to handle months with different lengths. <code class="literal">"day"</code> ensures consistent daily grouping regardless of timezone.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Formats dates in response using <a class="xref" href="mapping-date-format.html" title="format">date patterns</a> (e.g. "yyyy-MM-dd"). Refer to <a class="xref" href="common-options.html#date-math" title="Date Math">date math expressions</a> for additional options.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>When <code class="literal">min_doc_count</code> is 0, returns buckets for days with no orders, useful for continuous time series visualization.</p>
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Example response</summary>
<div class="content">
<a id="e048410f5b93866fd2d1f9a77f64e41f"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 2,
  "timed_out": false,
  "_shards": {
    "total": 5,
    "successful": 5,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "daily_orders": { <a id="CO34-1"></a><i class="conum" data-value="1"></i>
      "buckets": [ <a id="CO34-2"></a><i class="conum" data-value="2"></i>
        {
          "key_as_string": "2024-11-28", <a id="CO34-3"></a><i class="conum" data-value="3"></i>
          "key": 1732752000000, <a id="CO34-4"></a><i class="conum" data-value="4"></i>
          "doc_count": 146 <a id="CO34-5"></a><i class="conum" data-value="5"></i>
        },
        {
          "key_as_string": "2024-11-29",
          "key": 1732838400000,
          "doc_count": 153
        },
        {
          "key_as_string": "2024-11-30",
          "key": 1732924800000,
          "doc_count": 143
        },
        {
          "key_as_string": "2024-12-01",
          "key": 1733011200000,
          "doc_count": 140
        },
        {
          "key_as_string": "2024-12-02",
          "key": 1733097600000,
          "doc_count": 139
        },
        {
          "key_as_string": "2024-12-03",
          "key": 1733184000000,
          "doc_count": 157
        },
        {
          "key_as_string": "2024-12-04",
          "key": 1733270400000,
          "doc_count": 145
        },
        {
          "key_as_string": "2024-12-05",
          "key": 1733356800000,
          "doc_count": 152
        },
        {
          "key_as_string": "2024-12-06",
          "key": 1733443200000,
          "doc_count": 163
        },
        {
          "key_as_string": "2024-12-07",
          "key": 1733529600000,
          "doc_count": 141
        },
        {
          "key_as_string": "2024-12-08",
          "key": 1733616000000,
          "doc_count": 151
        },
        {
          "key_as_string": "2024-12-09",
          "key": 1733702400000,
          "doc_count": 143
        },
        {
          "key_as_string": "2024-12-10",
          "key": 1733788800000,
          "doc_count": 143
        },
        {
          "key_as_string": "2024-12-11",
          "key": 1733875200000,
          "doc_count": 142
        },
        {
          "key_as_string": "2024-12-12",
          "key": 1733961600000,
          "doc_count": 161
        },
        {
          "key_as_string": "2024-12-13",
          "key": 1734048000000,
          "doc_count": 144
        },
        {
          "key_as_string": "2024-12-14",
          "key": 1734134400000,
          "doc_count": 157
        },
        {
          "key_as_string": "2024-12-15",
          "key": 1734220800000,
          "doc_count": 158
        },
        {
          "key_as_string": "2024-12-16",
          "key": 1734307200000,
          "doc_count": 144
        },
        {
          "key_as_string": "2024-12-17",
          "key": 1734393600000,
          "doc_count": 151
        },
        {
          "key_as_string": "2024-12-18",
          "key": 1734480000000,
          "doc_count": 145
        },
        {
          "key_as_string": "2024-12-19",
          "key": 1734566400000,
          "doc_count": 157
        },
        {
          "key_as_string": "2024-12-20",
          "key": 1734652800000,
          "doc_count": 158
        },
        {
          "key_as_string": "2024-12-21",
          "key": 1734739200000,
          "doc_count": 153
        },
        {
          "key_as_string": "2024-12-22",
          "key": 1734825600000,
          "doc_count": 165
        },
        {
          "key_as_string": "2024-12-23",
          "key": 1734912000000,
          "doc_count": 153
        },
        {
          "key_as_string": "2024-12-24",
          "key": 1734998400000,
          "doc_count": 158
        },
        {
          "key_as_string": "2024-12-25",
          "key": 1735084800000,
          "doc_count": 160
        },
        {
          "key_as_string": "2024-12-26",
          "key": 1735171200000,
          "doc_count": 159
        },
        {
          "key_as_string": "2024-12-27",
          "key": 1735257600000,
          "doc_count": 152
        },
        {
          "key_as_string": "2024-12-28",
          "key": 1735344000000,
          "doc_count": 142
        }
      ]
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Results of our named aggregation "daily_orders"</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Time-based buckets from date_histogram aggregation</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">key_as_string</code> is the human-readable date for this bucket</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">key</code> is the same date represented as the Unix timestamp for this bucket</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">doc_count</code> counts the number of documents that fall into this time bucket</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<div class="position-relative"><h3><a id="aggregations-tutorial-combined-analysis"></a>Combine metrics with groupings</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Now let&#8217;s calculate <a class="xref" href="search-aggregations-metrics.html" title="Metrics aggregations">metrics</a> within each group to get deeper insights.</p>
<div class="position-relative"><h4><a id="aggregations-tutorial-category-metrics"></a>Compare category performance</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Calculate metrics within each category to compare performance across categories.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="kibana_sample_data_ecommerce",
    size=0,
    aggs={
        "categories": {
            "terms": {
                "field": "category.keyword",
                "size": 5,
                "order": {
                    "total_revenue": "desc"
                }
            },
            "aggs": {
                "total_revenue": {
                    "sum": {
                        "field": "taxful_total_price"
                    }
                },
                "avg_order_value": {
                    "avg": {
                        "field": "taxful_total_price"
                    }
                },
                "total_items": {
                    "sum": {
                        "field": "total_quantity"
                    }
                }
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "kibana_sample_data_ecommerce",
  size: 0,
  aggs: {
    categories: {
      terms: {
        field: "category.keyword",
        size: 5,
        order: {
          total_revenue: "desc",
        },
      },
      aggs: {
        total_revenue: {
          sum: {
            field: "taxful_total_price",
          },
        },
        avg_order_value: {
          avg: {
            field: "taxful_total_price",
          },
        },
        total_items: {
          sum: {
            field: "total_quantity",
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="8c639d3eef5c2de29e12bd9c6a42d3d4"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_search
{
 "size": 0,
 "aggs": {
   "categories": {
     "terms": {
       "field": "category.keyword",
       "size": 5,
       "order": { "total_revenue": "desc" } <a id="CO35-1"></a><i class="conum" data-value="1"></i>
     },
     "aggs": { <a id="CO35-2"></a><i class="conum" data-value="2"></i>
       "total_revenue": { <a id="CO35-3"></a><i class="conum" data-value="3"></i>
         "sum": {
           "field": "taxful_total_price"
         }
       },
       "avg_order_value": { <a id="CO35-4"></a><i class="conum" data-value="4"></i>
         "avg": {
           "field": "taxful_total_price"
         }
       },
       "total_items": { <a id="CO35-5"></a><i class="conum" data-value="5"></i>
         "sum": {
           "field": "total_quantity"
         }
       }
     }
   }
 }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/32.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO35-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Order categories by their total revenue instead of count</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO35-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Define metrics to calculate within each category</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO35-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Total revenue for the category</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO35-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Average order value in the category</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO35-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Total number of items sold</p>
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Example response</summary>
<div class="content">
<a id="1d751195219a393a494ba4ab4b4249f7"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
 "aggregations": {
   "categories": {
     "buckets": [
       {
         "key": "Men's Clothing", <a id="CO36-1"></a><i class="conum" data-value="1"></i>
         "doc_count": 2179, <a id="CO36-2"></a><i class="conum" data-value="2"></i>
         "total_revenue": { <a id="CO36-3"></a><i class="conum" data-value="3"></i>
           "value": 156729.453125
         },
         "avg_order_value": { <a id="CO36-4"></a><i class="conum" data-value="4"></i>
           "value": 71.92726898715927
         },
         "total_items": { <a id="CO36-5"></a><i class="conum" data-value="5"></i>
           "value": 8716
         }
       },
       {
         "key": "Women's Clothing",
         "doc_count": 2262,
         ...
       }
     ]
   }
 }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Category name</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Number of orders</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Total revenue for this category</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Average order value for this category</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Total quantity of items sold</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<div class="position-relative"><h4><a id="aggregations-tutorial-daily-metrics"></a>Analyze daily sales performance</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Let&#8217;s combine metrics to track daily trends: daily revenue, unique customers, and average basket size.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="kibana_sample_data_ecommerce",
    size=0,
    aggs={
        "daily_sales": {
            "date_histogram": {
                "field": "order_date",
                "calendar_interval": "day",
                "format": "yyyy-MM-dd"
            },
            "aggs": {
                "revenue": {
                    "sum": {
                        "field": "taxful_total_price"
                    }
                },
                "unique_customers": {
                    "cardinality": {
                        "field": "customer_id"
                    }
                },
                "avg_basket_size": {
                    "avg": {
                        "field": "total_quantity"
                    }
                }
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "kibana_sample_data_ecommerce",
  size: 0,
  aggs: {
    daily_sales: {
      date_histogram: {
        field: "order_date",
        calendar_interval: "day",
        format: "yyyy-MM-dd",
      },
      aggs: {
        revenue: {
          sum: {
            field: "taxful_total_price",
          },
        },
        unique_customers: {
          cardinality: {
            field: "customer_id",
          },
        },
        avg_basket_size: {
          avg: {
            field: "total_quantity",
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="7dd0d9cc6c5982a2c003d301e90feeba"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_search
{
 "size": 0,
 "aggs": {
   "daily_sales": {
     "date_histogram": {
       "field": "order_date",
       "calendar_interval": "day",
       "format": "yyyy-MM-dd"
     },
     "aggs": {
       "revenue": { <a id="CO37-1"></a><i class="conum" data-value="1"></i>
         "sum": {
           "field": "taxful_total_price"
         }
       },
       "unique_customers": { <a id="CO37-2"></a><i class="conum" data-value="2"></i>
         "cardinality": {
           "field": "customer_id"
         }
       },
       "avg_basket_size": { <a id="CO37-3"></a><i class="conum" data-value="3"></i>
         "avg": {
           "field": "total_quantity"
         }
       }
     }
   }
 }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/33.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Daily revenue</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Uses the <a class="xref" href="search-aggregations-metrics-cardinality-aggregation.html" title="Cardinality aggregation"><code class="literal">cardinality</code></a> aggregation to count unique customers per day</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Average number of items per order</p>
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Example response</summary>
<div class="content">
<a id="70ba1c9c937bf91039c63d97c5d89ef8"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 119,
  "timed_out": false,
  "_shards": {
    "total": 5,
    "successful": 5,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "daily_sales": {
      "buckets": [
        {
          "key_as_string": "2024-11-14",
          "key": 1731542400000,
          "doc_count": 146,
          "unique_customers": { <a id="CO38-1"></a><i class="conum" data-value="1"></i>
            "value": 42
          },
          "revenue": { <a id="CO38-2"></a><i class="conum" data-value="2"></i>
            "value": 10578.53125
          },
          "avg_basket_size": { <a id="CO38-3"></a><i class="conum" data-value="3"></i>
            "value": 2.1780821917808217
          }
        },
        {
          "key_as_string": "2024-11-15",
          "key": 1731628800000,
          "doc_count": 153,
          "unique_customers": {
            "value": 44
          },
          "revenue": {
            "value": 10448
          },
          "avg_basket_size": {
            "value": 2.183006535947712
          }
        },
        {
          "key_as_string": "2024-11-16",
          "key": 1731715200000,
          "doc_count": 143,
          "unique_customers": {
            "value": 45
          },
          "revenue": {
            "value": 10283.484375
          },
          "avg_basket_size": {
            "value": 2.111888111888112
          }
        },
        {
          "key_as_string": "2024-11-17",
          "key": 1731801600000,
          "doc_count": 140,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 10145.5234375
          },
          "avg_basket_size": {
            "value": 2.142857142857143
          }
        },
        {
          "key_as_string": "2024-11-18",
          "key": 1731888000000,
          "doc_count": 139,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 12012.609375
          },
          "avg_basket_size": {
            "value": 2.158273381294964
          }
        },
        {
          "key_as_string": "2024-11-19",
          "key": 1731974400000,
          "doc_count": 157,
          "unique_customers": {
            "value": 43
          },
          "revenue": {
            "value": 11009.45703125
          },
          "avg_basket_size": {
            "value": 2.0955414012738856
          }
        },
        {
          "key_as_string": "2024-11-20",
          "key": 1732060800000,
          "doc_count": 145,
          "unique_customers": {
            "value": 44
          },
          "revenue": {
            "value": 10720.59375
          },
          "avg_basket_size": {
            "value": 2.179310344827586
          }
        },
        {
          "key_as_string": "2024-11-21",
          "key": 1732147200000,
          "doc_count": 152,
          "unique_customers": {
            "value": 43
          },
          "revenue": {
            "value": 11185.3671875
          },
          "avg_basket_size": {
            "value": 2.1710526315789473
          }
        },
        {
          "key_as_string": "2024-11-22",
          "key": 1732233600000,
          "doc_count": 163,
          "unique_customers": {
            "value": 44
          },
          "revenue": {
            "value": 13560.140625
          },
          "avg_basket_size": {
            "value": 2.2576687116564416
          }
        },
        {
          "key_as_string": "2024-11-23",
          "key": 1732320000000,
          "doc_count": 141,
          "unique_customers": {
            "value": 45
          },
          "revenue": {
            "value": 9884.78125
          },
          "avg_basket_size": {
            "value": 2.099290780141844
          }
        },
        {
          "key_as_string": "2024-11-24",
          "key": 1732406400000,
          "doc_count": 151,
          "unique_customers": {
            "value": 44
          },
          "revenue": {
            "value": 11075.65625
          },
          "avg_basket_size": {
            "value": 2.0927152317880795
          }
        },
        {
          "key_as_string": "2024-11-25",
          "key": 1732492800000,
          "doc_count": 143,
          "unique_customers": {
            "value": 41
          },
          "revenue": {
            "value": 10323.8515625
          },
          "avg_basket_size": {
            "value": 2.167832167832168
          }
        },
        {
          "key_as_string": "2024-11-26",
          "key": 1732579200000,
          "doc_count": 143,
          "unique_customers": {
            "value": 44
          },
          "revenue": {
            "value": 10369.546875
          },
          "avg_basket_size": {
            "value": 2.167832167832168
          }
        },
        {
          "key_as_string": "2024-11-27",
          "key": 1732665600000,
          "doc_count": 142,
          "unique_customers": {
            "value": 46
          },
          "revenue": {
            "value": 11711.890625
          },
          "avg_basket_size": {
            "value": 2.1971830985915495
          }
        },
        {
          "key_as_string": "2024-11-28",
          "key": 1732752000000,
          "doc_count": 161,
          "unique_customers": {
            "value": 43
          },
          "revenue": {
            "value": 12612.6640625
          },
          "avg_basket_size": {
            "value": 2.1180124223602483
          }
        },
        {
          "key_as_string": "2024-11-29",
          "key": 1732838400000,
          "doc_count": 144,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 10176.87890625
          },
          "avg_basket_size": {
            "value": 2.0347222222222223
          }
        },
        {
          "key_as_string": "2024-11-30",
          "key": 1732924800000,
          "doc_count": 157,
          "unique_customers": {
            "value": 43
          },
          "revenue": {
            "value": 11480.33203125
          },
          "avg_basket_size": {
            "value": 2.159235668789809
          }
        },
        {
          "key_as_string": "2024-12-01",
          "key": 1733011200000,
          "doc_count": 158,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 11533.265625
          },
          "avg_basket_size": {
            "value": 2.0822784810126582
          }
        },
        {
          "key_as_string": "2024-12-02",
          "key": 1733097600000,
          "doc_count": 144,
          "unique_customers": {
            "value": 43
          },
          "revenue": {
            "value": 10499.8125
          },
          "avg_basket_size": {
            "value": 2.201388888888889
          }
        },
        {
          "key_as_string": "2024-12-03",
          "key": 1733184000000,
          "doc_count": 151,
          "unique_customers": {
            "value": 40
          },
          "revenue": {
            "value": 12111.6875
          },
          "avg_basket_size": {
            "value": 2.172185430463576
          }
        },
        {
          "key_as_string": "2024-12-04",
          "key": 1733270400000,
          "doc_count": 145,
          "unique_customers": {
            "value": 40
          },
          "revenue": {
            "value": 10530.765625
          },
          "avg_basket_size": {
            "value": 2.0965517241379312
          }
        },
        {
          "key_as_string": "2024-12-05",
          "key": 1733356800000,
          "doc_count": 157,
          "unique_customers": {
            "value": 43
          },
          "revenue": {
            "value": 11872.5625
          },
          "avg_basket_size": {
            "value": 2.1464968152866244
          }
        },
        {
          "key_as_string": "2024-12-06",
          "key": 1733443200000,
          "doc_count": 158,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 12109.453125
          },
          "avg_basket_size": {
            "value": 2.151898734177215
          }
        },
        {
          "key_as_string": "2024-12-07",
          "key": 1733529600000,
          "doc_count": 153,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 11057.40625
          },
          "avg_basket_size": {
            "value": 2.111111111111111
          }
        },
        {
          "key_as_string": "2024-12-08",
          "key": 1733616000000,
          "doc_count": 165,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 13095.609375
          },
          "avg_basket_size": {
            "value": 2.1818181818181817
          }
        },
        {
          "key_as_string": "2024-12-09",
          "key": 1733702400000,
          "doc_count": 153,
          "unique_customers": {
            "value": 41
          },
          "revenue": {
            "value": 12574.015625
          },
          "avg_basket_size": {
            "value": 2.2287581699346406
          }
        },
        {
          "key_as_string": "2024-12-10",
          "key": 1733788800000,
          "doc_count": 158,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 11188.1875
          },
          "avg_basket_size": {
            "value": 2.151898734177215
          }
        },
        {
          "key_as_string": "2024-12-11",
          "key": 1733875200000,
          "doc_count": 160,
          "unique_customers": {
            "value": 42
          },
          "revenue": {
            "value": 12117.65625
          },
          "avg_basket_size": {
            "value": 2.20625
          }
        },
        {
          "key_as_string": "2024-12-12",
          "key": 1733961600000,
          "doc_count": 159,
          "unique_customers": {
            "value": 45
          },
          "revenue": {
            "value": 11558.25
          },
          "avg_basket_size": {
            "value": 2.1823899371069184
          }
        },
        {
          "key_as_string": "2024-12-13",
          "key": 1734048000000,
          "doc_count": 152,
          "unique_customers": {
            "value": 45
          },
          "revenue": {
            "value": 11921.1171875
          },
          "avg_basket_size": {
            "value": 2.289473684210526
          }
        },
        {
          "key_as_string": "2024-12-14",
          "key": 1734134400000,
          "doc_count": 142,
          "unique_customers": {
            "value": 45
          },
          "revenue": {
            "value": 11135.03125
          },
          "avg_basket_size": {
            "value": 2.183098591549296
          }
        }
      ]
    }
  }
}</pre>
</div>
</div>
</details>
<div class="position-relative"><h3><a id="aggregations-tutorial-trends"></a>Track trends and patterns</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>You can use <a class="xref" href="search-aggregations-pipeline.html" title="Pipeline aggregations">pipeline aggregations</a> on the results of other aggregations.
Let&#8217;s analyze how metrics change over time.</p>
<div class="position-relative"><h4><a id="aggregations-tutorial-moving-average"></a>Smooth out daily fluctuations</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Moving averages help identify trends by reducing day-to-day noise in the data.
Let&#8217;s observe sales trends more clearly by smoothing daily revenue variations, using the <a class="xref" href="search-aggregations-pipeline-movfn-aggregation.html" title="Moving function aggregation">Moving Function</a> aggregation.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="kibana_sample_data_ecommerce",
    size=0,
    aggs={
        "daily_sales": {
            "date_histogram": {
                "field": "order_date",
                "calendar_interval": "day"
            },
            "aggs": {
                "daily_revenue": {
                    "sum": {
                        "field": "taxful_total_price"
                    }
                },
                "smoothed_revenue": {
                    "moving_fn": {
                        "buckets_path": "daily_revenue",
                        "window": 3,
                        "script": "MovingFunctions.unweightedAvg(values)"
                    }
                }
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "kibana_sample_data_ecommerce",
  size: 0,
  aggs: {
    daily_sales: {
      date_histogram: {
        field: "order_date",
        calendar_interval: "day",
      },
      aggs: {
        daily_revenue: {
          sum: {
            field: "taxful_total_price",
          },
        },
        smoothed_revenue: {
          moving_fn: {
            buckets_path: "daily_revenue",
            window: 3,
            script: "MovingFunctions.unweightedAvg(values)",
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="7478ff69113fb53f41ea07cdf911fa67"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_search
{
  "size": 0,
  "aggs": {
    "daily_sales": {
      "date_histogram": {
        "field": "order_date",
        "calendar_interval": "day"
      },
      "aggs": {
        "daily_revenue": {  <a id="CO38-4"></a><i class="conum" data-value="1"></i>
          "sum": {
            "field": "taxful_total_price"
          }
        },
        "smoothed_revenue": { <a id="CO38-5"></a><i class="conum" data-value="2"></i>
          "moving_fn": { <a id="CO38-6"></a><i class="conum" data-value="3"></i>
            "buckets_path": "daily_revenue", <a id="CO38-7"></a><i class="conum" data-value="4"></i>
            "window": 3, <a id="CO38-8"></a><i class="conum" data-value="5"></i>
            "script": "MovingFunctions.unweightedAvg(values)" <a id="CO38-9"></a><i class="conum" data-value="6"></i>
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/34.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-1"><i class="conum" data-value="1"></i></a><a href="#CO38-4"></a></p>
</td>
<td align="left" valign="top">
<p>Calculate daily revenue first.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-2"><i class="conum" data-value="2"></i></a><a href="#CO38-5"></a></p>
</td>
<td align="left" valign="top">
<p>Create a smoothed version of the daily revenue.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-3"><i class="conum" data-value="3"></i></a><a href="#CO38-6"></a></p>
</td>
<td align="left" valign="top">
<p>Use <code class="literal">moving_fn</code> for moving window calculations.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-7"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Reference the revenue from our date histogram.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-8"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use a 3-day window — use different window sizes to see trends at different time scales.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-9"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use the built-in unweighted average function in the <code class="literal">moving_fn</code> aggregation.</p>
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Example response</summary>
<div class="content">
<a id="d72ea8435d3d44d8d16c96a998824da8"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 13,
  "timed_out": false,
  "_shards": {
    "total": 5,
    "successful": 5,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "daily_sales": {
      "buckets": [
        {
          "key_as_string": "2024-11-14T00:00:00.000Z",  <a id="CO39-1"></a><i class="conum" data-value="1"></i>
          "key": 1731542400000,
          "doc_count": 146, <a id="CO39-2"></a><i class="conum" data-value="2"></i>
          "daily_revenue": { <a id="CO39-3"></a><i class="conum" data-value="3"></i>
            "value": 10578.53125
          },
          "smoothed_revenue": { <a id="CO39-4"></a><i class="conum" data-value="4"></i>
            "value": null
          }
        },
        {
          "key_as_string": "2024-11-15T00:00:00.000Z",
          "key": 1731628800000,
          "doc_count": 153,
          "daily_revenue": {
            "value": 10448
          },
          "smoothed_revenue": { <a id="CO39-5"></a><i class="conum" data-value="5"></i>
            "value": 10578.53125
          }
        },
        {
          "key_as_string": "2024-11-16T00:00:00.000Z",
          "key": 1731715200000,
          "doc_count": 143,
          "daily_revenue": {
            "value": 10283.484375
          },
          "smoothed_revenue": {
            "value": 10513.265625
          }
        },
        {
          "key_as_string": "2024-11-17T00:00:00.000Z",
          "key": 1731801600000,
          "doc_count": 140,
          "daily_revenue": {
            "value": 10145.5234375
          },
          "smoothed_revenue": {
            "value": 10436.671875
          }
        },
        {
          "key_as_string": "2024-11-18T00:00:00.000Z",
          "key": 1731888000000,
          "doc_count": 139,
          "daily_revenue": {
            "value": 12012.609375
          },
          "smoothed_revenue": {
            "value": 10292.3359375
          }
        },
        {
          "key_as_string": "2024-11-19T00:00:00.000Z",
          "key": 1731974400000,
          "doc_count": 157,
          "daily_revenue": {
            "value": 11009.45703125
          },
          "smoothed_revenue": {
            "value": 10813.872395833334
          }
        },
        {
          "key_as_string": "2024-11-20T00:00:00.000Z",
          "key": 1732060800000,
          "doc_count": 145,
          "daily_revenue": {
            "value": 10720.59375
          },
          "smoothed_revenue": {
            "value": 11055.86328125
          }
        },
        {
          "key_as_string": "2024-11-21T00:00:00.000Z",
          "key": 1732147200000,
          "doc_count": 152,
          "daily_revenue": {
            "value": 11185.3671875
          },
          "smoothed_revenue": {
            "value": 11247.553385416666
          }
        },
        {
          "key_as_string": "2024-11-22T00:00:00.000Z",
          "key": 1732233600000,
          "doc_count": 163,
          "daily_revenue": {
            "value": 13560.140625
          },
          "smoothed_revenue": {
            "value": 10971.805989583334
          }
        },
        {
          "key_as_string": "2024-11-23T00:00:00.000Z",
          "key": 1732320000000,
          "doc_count": 141,
          "daily_revenue": {
            "value": 9884.78125
          },
          "smoothed_revenue": {
            "value": 11822.033854166666
          }
        },
        {
          "key_as_string": "2024-11-24T00:00:00.000Z",
          "key": 1732406400000,
          "doc_count": 151,
          "daily_revenue": {
            "value": 11075.65625
          },
          "smoothed_revenue": {
            "value": 11543.4296875
          }
        },
        {
          "key_as_string": "2024-11-25T00:00:00.000Z",
          "key": 1732492800000,
          "doc_count": 143,
          "daily_revenue": {
            "value": 10323.8515625
          },
          "smoothed_revenue": {
            "value": 11506.859375
          }
        },
        {
          "key_as_string": "2024-11-26T00:00:00.000Z",
          "key": 1732579200000,
          "doc_count": 143,
          "daily_revenue": {
            "value": 10369.546875
          },
          "smoothed_revenue": {
            "value": 10428.096354166666
          }
        },
        {
          "key_as_string": "2024-11-27T00:00:00.000Z",
          "key": 1732665600000,
          "doc_count": 142,
          "daily_revenue": {
            "value": 11711.890625
          },
          "smoothed_revenue": {
            "value": 10589.684895833334
          }
        },
        {
          "key_as_string": "2024-11-28T00:00:00.000Z",
          "key": 1732752000000,
          "doc_count": 161,
          "daily_revenue": {
            "value": 12612.6640625
          },
          "smoothed_revenue": {
            "value": 10801.763020833334
          }
        },
        {
          "key_as_string": "2024-11-29T00:00:00.000Z",
          "key": 1732838400000,
          "doc_count": 144,
          "daily_revenue": {
            "value": 10176.87890625
          },
          "smoothed_revenue": {
            "value": 11564.700520833334
          }
        },
        {
          "key_as_string": "2024-11-30T00:00:00.000Z",
          "key": 1732924800000,
          "doc_count": 157,
          "daily_revenue": {
            "value": 11480.33203125
          },
          "smoothed_revenue": {
            "value": 11500.477864583334
          }
        },
        {
          "key_as_string": "2024-12-01T00:00:00.000Z",
          "key": 1733011200000,
          "doc_count": 158,
          "daily_revenue": {
            "value": 11533.265625
          },
          "smoothed_revenue": {
            "value": 11423.291666666666
          }
        },
        {
          "key_as_string": "2024-12-02T00:00:00.000Z",
          "key": 1733097600000,
          "doc_count": 144,
          "daily_revenue": {
            "value": 10499.8125
          },
          "smoothed_revenue": {
            "value": 11063.4921875
          }
        },
        {
          "key_as_string": "2024-12-03T00:00:00.000Z",
          "key": 1733184000000,
          "doc_count": 151,
          "daily_revenue": {
            "value": 12111.6875
          },
          "smoothed_revenue": {
            "value": 11171.13671875
          }
        },
        {
          "key_as_string": "2024-12-04T00:00:00.000Z",
          "key": 1733270400000,
          "doc_count": 145,
          "daily_revenue": {
            "value": 10530.765625
          },
          "smoothed_revenue": {
            "value": 11381.588541666666
          }
        },
        {
          "key_as_string": "2024-12-05T00:00:00.000Z",
          "key": 1733356800000,
          "doc_count": 157,
          "daily_revenue": {
            "value": 11872.5625
          },
          "smoothed_revenue": {
            "value": 11047.421875
          }
        },
        {
          "key_as_string": "2024-12-06T00:00:00.000Z",
          "key": 1733443200000,
          "doc_count": 158,
          "daily_revenue": {
            "value": 12109.453125
          },
          "smoothed_revenue": {
            "value": 11505.005208333334
          }
        },
        {
          "key_as_string": "2024-12-07T00:00:00.000Z",
          "key": 1733529600000,
          "doc_count": 153,
          "daily_revenue": {
            "value": 11057.40625
          },
          "smoothed_revenue": {
            "value": 11504.260416666666
          }
        },
        {
          "key_as_string": "2024-12-08T00:00:00.000Z",
          "key": 1733616000000,
          "doc_count": 165,
          "daily_revenue": {
            "value": 13095.609375
          },
          "smoothed_revenue": {
            "value": 11679.807291666666
          }
        },
        {
          "key_as_string": "2024-12-09T00:00:00.000Z",
          "key": 1733702400000,
          "doc_count": 153,
          "daily_revenue": {
            "value": 12574.015625
          },
          "smoothed_revenue": {
            "value": 12087.489583333334
          }
        },
        {
          "key_as_string": "2024-12-10T00:00:00.000Z",
          "key": 1733788800000,
          "doc_count": 158,
          "daily_revenue": {
            "value": 11188.1875
          },
          "smoothed_revenue": {
            "value": 12242.34375
          }
        },
        {
          "key_as_string": "2024-12-11T00:00:00.000Z",
          "key": 1733875200000,
          "doc_count": 160,
          "daily_revenue": {
            "value": 12117.65625
          },
          "smoothed_revenue": {
            "value": 12285.9375
          }
        },
        {
          "key_as_string": "2024-12-12T00:00:00.000Z",
          "key": 1733961600000,
          "doc_count": 159,
          "daily_revenue": {
            "value": 11558.25
          },
          "smoothed_revenue": {
            "value": 11959.953125
          }
        },
        {
          "key_as_string": "2024-12-13T00:00:00.000Z",
          "key": 1734048000000,
          "doc_count": 152,
          "daily_revenue": {
            "value": 11921.1171875
          },
          "smoothed_revenue": {
            "value": 11621.364583333334
          }
        },
        {
          "key_as_string": "2024-12-14T00:00:00.000Z",
          "key": 1734134400000,
          "doc_count": 142,
          "daily_revenue": {
            "value": 11135.03125
          },
          "smoothed_revenue": {
            "value": 11865.674479166666
          }
        }
      ]
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Date of the bucket is in default ISO format because we didn&#8217;t specify a format</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Number of orders for this day</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Raw daily revenue before smoothing</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>First day has no smoothed value as it needs previous days for the calculation</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Moving average starts from second day, using a 3-day window</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Notice how the smoothed values lag behind the actual values - this is because they need previous days' data to calculate. The first day will always be null when using moving averages.</p>
</div>
</div>
<div class="position-relative"><h4><a id="aggregations-tutorial-cumulative"></a>Track running totals</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Track running totals over time using the <a class="xref" href="search-aggregations-pipeline-cumulative-sum-aggregation.html" title="Cumulative sum aggregation"><code class="literal">cumulative_sum</code></a> aggregation.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="kibana_sample_data_ecommerce",
    size=0,
    aggs={
        "daily_sales": {
            "date_histogram": {
                "field": "order_date",
                "calendar_interval": "day"
            },
            "aggs": {
                "revenue": {
                    "sum": {
                        "field": "taxful_total_price"
                    }
                },
                "cumulative_revenue": {
                    "cumulative_sum": {
                        "buckets_path": "revenue"
                    }
                }
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "kibana_sample_data_ecommerce",
  size: 0,
  aggs: {
    daily_sales: {
      date_histogram: {
        field: "order_date",
        calendar_interval: "day",
      },
      aggs: {
        revenue: {
          sum: {
            field: "taxful_total_price",
          },
        },
        cumulative_revenue: {
          cumulative_sum: {
            buckets_path: "revenue",
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="bdd28276618235487ac96bd6679bc206"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET kibana_sample_data_ecommerce/_search
{
 "size": 0,
 "aggs": {
   "daily_sales": {
     "date_histogram": {
       "field": "order_date",
       "calendar_interval": "day"
     },
     "aggs": {
       "revenue": {
         "sum": {
           "field": "taxful_total_price"
         }
       },
       "cumulative_revenue": { <a id="CO40-1"></a><i class="conum" data-value="1"></i>
         "cumulative_sum": { <a id="CO40-2"></a><i class="conum" data-value="2"></i>
           "buckets_path": "revenue" <a id="CO40-3"></a><i class="conum" data-value="3"></i>
         }
       }
     }
   }
 }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/35.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Name for our running total</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">cumulative_sum</code> adds up values across buckets</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Reference the revenue we want to accumulate</p>
</td>
</tr>
</table>
</div>
<details>
<summary class="title">Example response</summary>
<div class="content">
<a id="e1f550cfb6eddd29366fcbebf2bf4d9c"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 4,
  "timed_out": false,
  "_shards": {
    "total": 5,
    "successful": 5,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4675,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "daily_sales": { <a id="CO41-1"></a><i class="conum" data-value="1"></i>
      "buckets": [ <a id="CO41-2"></a><i class="conum" data-value="2"></i>
        {
          "key_as_string": "2024-11-14T00:00:00.000Z", <a id="CO41-3"></a><i class="conum" data-value="3"></i>
          "key": 1731542400000,
          "doc_count": 146,
          "revenue": { <a id="CO41-4"></a><i class="conum" data-value="4"></i>
            "value": 10578.53125
          },
          "cumulative_revenue": { <a id="CO41-5"></a><i class="conum" data-value="5"></i>
            "value": 10578.53125
          }
        },
        {
          "key_as_string": "2024-11-15T00:00:00.000Z",
          "key": 1731628800000,
          "doc_count": 153,
          "revenue": {
            "value": 10448
          },
          "cumulative_revenue": {
            "value": 21026.53125
          }
        },
        {
          "key_as_string": "2024-11-16T00:00:00.000Z",
          "key": 1731715200000,
          "doc_count": 143,
          "revenue": {
            "value": 10283.484375
          },
          "cumulative_revenue": {
            "value": 31310.015625
          }
        },
        {
          "key_as_string": "2024-11-17T00:00:00.000Z",
          "key": 1731801600000,
          "doc_count": 140,
          "revenue": {
            "value": 10145.5234375
          },
          "cumulative_revenue": {
            "value": 41455.5390625
          }
        },
        {
          "key_as_string": "2024-11-18T00:00:00.000Z",
          "key": 1731888000000,
          "doc_count": 139,
          "revenue": {
            "value": 12012.609375
          },
          "cumulative_revenue": {
            "value": 53468.1484375
          }
        },
        {
          "key_as_string": "2024-11-19T00:00:00.000Z",
          "key": 1731974400000,
          "doc_count": 157,
          "revenue": {
            "value": 11009.45703125
          },
          "cumulative_revenue": {
            "value": 64477.60546875
          }
        },
        {
          "key_as_string": "2024-11-20T00:00:00.000Z",
          "key": 1732060800000,
          "doc_count": 145,
          "revenue": {
            "value": 10720.59375
          },
          "cumulative_revenue": {
            "value": 75198.19921875
          }
        },
        {
          "key_as_string": "2024-11-21T00:00:00.000Z",
          "key": 1732147200000,
          "doc_count": 152,
          "revenue": {
            "value": 11185.3671875
          },
          "cumulative_revenue": {
            "value": 86383.56640625
          }
        },
        {
          "key_as_string": "2024-11-22T00:00:00.000Z",
          "key": 1732233600000,
          "doc_count": 163,
          "revenue": {
            "value": 13560.140625
          },
          "cumulative_revenue": {
            "value": 99943.70703125
          }
        },
        {
          "key_as_string": "2024-11-23T00:00:00.000Z",
          "key": 1732320000000,
          "doc_count": 141,
          "revenue": {
            "value": 9884.78125
          },
          "cumulative_revenue": {
            "value": 109828.48828125
          }
        },
        {
          "key_as_string": "2024-11-24T00:00:00.000Z",
          "key": 1732406400000,
          "doc_count": 151,
          "revenue": {
            "value": 11075.65625
          },
          "cumulative_revenue": {
            "value": 120904.14453125
          }
        },
        {
          "key_as_string": "2024-11-25T00:00:00.000Z",
          "key": 1732492800000,
          "doc_count": 143,
          "revenue": {
            "value": 10323.8515625
          },
          "cumulative_revenue": {
            "value": 131227.99609375
          }
        },
        {
          "key_as_string": "2024-11-26T00:00:00.000Z",
          "key": 1732579200000,
          "doc_count": 143,
          "revenue": {
            "value": 10369.546875
          },
          "cumulative_revenue": {
            "value": 141597.54296875
          }
        },
        {
          "key_as_string": "2024-11-27T00:00:00.000Z",
          "key": 1732665600000,
          "doc_count": 142,
          "revenue": {
            "value": 11711.890625
          },
          "cumulative_revenue": {
            "value": 153309.43359375
          }
        },
        {
          "key_as_string": "2024-11-28T00:00:00.000Z",
          "key": 1732752000000,
          "doc_count": 161,
          "revenue": {
            "value": 12612.6640625
          },
          "cumulative_revenue": {
            "value": 165922.09765625
          }
        },
        {
          "key_as_string": "2024-11-29T00:00:00.000Z",
          "key": 1732838400000,
          "doc_count": 144,
          "revenue": {
            "value": 10176.87890625
          },
          "cumulative_revenue": {
            "value": 176098.9765625
          }
        },
        {
          "key_as_string": "2024-11-30T00:00:00.000Z",
          "key": 1732924800000,
          "doc_count": 157,
          "revenue": {
            "value": 11480.33203125
          },
          "cumulative_revenue": {
            "value": 187579.30859375
          }
        },
        {
          "key_as_string": "2024-12-01T00:00:00.000Z",
          "key": 1733011200000,
          "doc_count": 158,
          "revenue": {
            "value": 11533.265625
          },
          "cumulative_revenue": {
            "value": 199112.57421875
          }
        },
        {
          "key_as_string": "2024-12-02T00:00:00.000Z",
          "key": 1733097600000,
          "doc_count": 144,
          "revenue": {
            "value": 10499.8125
          },
          "cumulative_revenue": {
            "value": 209612.38671875
          }
        },
        {
          "key_as_string": "2024-12-03T00:00:00.000Z",
          "key": 1733184000000,
          "doc_count": 151,
          "revenue": {
            "value": 12111.6875
          },
          "cumulative_revenue": {
            "value": 221724.07421875
          }
        },
        {
          "key_as_string": "2024-12-04T00:00:00.000Z",
          "key": 1733270400000,
          "doc_count": 145,
          "revenue": {
            "value": 10530.765625
          },
          "cumulative_revenue": {
            "value": 232254.83984375
          }
        },
        {
          "key_as_string": "2024-12-05T00:00:00.000Z",
          "key": 1733356800000,
          "doc_count": 157,
          "revenue": {
            "value": 11872.5625
          },
          "cumulative_revenue": {
            "value": 244127.40234375
          }
        },
        {
          "key_as_string": "2024-12-06T00:00:00.000Z",
          "key": 1733443200000,
          "doc_count": 158,
          "revenue": {
            "value": 12109.453125
          },
          "cumulative_revenue": {
            "value": 256236.85546875
          }
        },
        {
          "key_as_string": "2024-12-07T00:00:00.000Z",
          "key": 1733529600000,
          "doc_count": 153,
          "revenue": {
            "value": 11057.40625
          },
          "cumulative_revenue": {
            "value": 267294.26171875
          }
        },
        {
          "key_as_string": "2024-12-08T00:00:00.000Z",
          "key": 1733616000000,
          "doc_count": 165,
          "revenue": {
            "value": 13095.609375
          },
          "cumulative_revenue": {
            "value": 280389.87109375
          }
        },
        {
          "key_as_string": "2024-12-09T00:00:00.000Z",
          "key": 1733702400000,
          "doc_count": 153,
          "revenue": {
            "value": 12574.015625
          },
          "cumulative_revenue": {
            "value": 292963.88671875
          }
        },
        {
          "key_as_string": "2024-12-10T00:00:00.000Z",
          "key": 1733788800000,
          "doc_count": 158,
          "revenue": {
            "value": 11188.1875
          },
          "cumulative_revenue": {
            "value": 304152.07421875
          }
        },
        {
          "key_as_string": "2024-12-11T00:00:00.000Z",
          "key": 1733875200000,
          "doc_count": 160,
          "revenue": {
            "value": 12117.65625
          },
          "cumulative_revenue": {
            "value": 316269.73046875
          }
        },
        {
          "key_as_string": "2024-12-12T00:00:00.000Z",
          "key": 1733961600000,
          "doc_count": 159,
          "revenue": {
            "value": 11558.25
          },
          "cumulative_revenue": {
            "value": 327827.98046875
          }
        },
        {
          "key_as_string": "2024-12-13T00:00:00.000Z",
          "key": 1734048000000,
          "doc_count": 152,
          "revenue": {
            "value": 11921.1171875
          },
          "cumulative_revenue": {
            "value": 339749.09765625
          }
        },
        {
          "key_as_string": "2024-12-14T00:00:00.000Z",
          "key": 1734134400000,
          "doc_count": 142,
          "revenue": {
            "value": 11135.03125
          },
          "cumulative_revenue": {
            "value": 350884.12890625
          }
        }
      ]
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">daily_sales</code>: Results from our daily sales date histogram</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">buckets</code>: Array of time-based buckets</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">key_as_string</code>: Date for this bucket (in ISO format since no format specified)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">revenue</code>: Daily revenue for this date</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">cumulative_revenue</code>: Running total of revenue up to this date</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<div class="position-relative"><h3><a id="aggregations-tutorial-next-steps"></a>Next steps</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/quickstart/aggs-tutorial.asciidoc">edit</a></div>
<p>Refer to the <a class="xref" href="search-aggregations.html" title="Aggregations">aggregations reference</a> for more details on all available aggregation types.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="esql-search-tutorial.html">« Tutorial: Search and filter with ES|QL</a>
</span>
<span class="next">
<a href="setup.html">Set up Elasticsearch »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
