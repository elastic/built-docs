<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Chat completion inference API | Elasticsearch Guide [8.x] | Elastic</title>
<meta class="elastic" name="content" content="Chat completion inference API | Elasticsearch Guide [8.x]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.x]"/>
<link rel="up" href="inference-apis.html" title="Inference APIs"/>
<link rel="prev" href="post-inference-api.html" title="Perform inference API"/>
<link rel="next" href="put-inference-api.html" title="Create inference API"/>
<meta class="elastic" name="product_version" content="8.x"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.x"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="post-inference-api.html">« Perform inference API</a>
</span>
<span class="next">
<a href="put-inference-api.html">Create inference API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.x]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="inference-apis.html">Inference APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Chat completion inference API</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="chat-completion-inference-api"></a>Chat completion inference API</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
</div></div></div>
<p>Streams a chat completion response.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The inference APIs enable you to use certain services, such as built-in machine learning models (ELSER, E5), models uploaded through Eland, Cohere, OpenAI, Azure, Google AI Studio, Google Vertex AI, Anthropic, Watsonx.ai, or Hugging Face.
For built-in models and models uploaded through Eland, the inference APIs offer an alternative way to use and manage trained models.
However, if you do not plan to use the inference APIs to use these models or if you want to use non-NLP models, use the <a class="xref" href="ml-df-trained-models-apis.html" title="Machine learning trained model APIs"><em>Machine learning trained model APIs</em></a>.</p>
</div>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-request"></a>Request</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<p><code class="literal">POST /_inference/&lt;inference_id&gt;/_unified</code></p>
<p><code class="literal">POST /_inference/chat_completion/&lt;inference_id&gt;/_unified</code></p>
<div class="position-relative"><h4><a id="chat-completion-inference-api-prereqs"></a>Prerequisites</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires the <code class="literal">monitor_inference</code> <a class="xref" href="security-privileges.html#privileges-list-cluster" title="Cluster privileges">cluster privilege</a>
(the built-in <code class="literal">inference_admin</code> and <code class="literal">inference_user</code> roles grant this privilege)
</li>
<li class="listitem">
You must use a client that supports streaming.
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-desc"></a>Description</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<p>The chat completion inference API enables real-time responses for chat completion tasks by delivering answers incrementally, reducing response times during computation.
It only works with the <code class="literal">chat_completion</code> task type for <code class="literal">openai</code> and <code class="literal">elastic</code> inference services.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">chat_completion</code> task type is only available within the _unified API and only supports streaming.
</li>
<li class="listitem">
The Chat completion inference API and the Stream inference API differ in their response structure and capabilities.
The Chat completion inference API provides more comprehensive customization options through more fields and function calling support.
If you use the <code class="literal">openai</code> service or the <code class="literal">elastic</code> service, use the Chat completion inference API.
</li>
</ul>
</div>
</div>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-path-params"></a>Path parameters</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;inference_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
The unique identifier of the inference endpoint.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;task_type&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
The type of inference task that the model performs. If included, this must be set to the value <code class="literal">chat_completion</code>.
</dd>
</dl>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-request-body"></a>Request body</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">messages</code>
</span>
</dt>
<dd>
<p>
(Required, array of objects) A list of objects representing the conversation.
Requests should generally only add new messages from the user (role <code class="literal">user</code>). The other message roles (<code class="literal">assistant</code>, <code class="literal">system</code>, or <code class="literal">tool</code>) should generally only be copied from the response to a previous completion request, such that the messages array is built up throughout a conversation.
</p>
<details>
<summary class="title">Assistant message</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">content</code>
</span>
</dt>
<dd>
<p>
(Required unless <code class="literal">tool_calls</code> is specified, string or array of objects)
The contents of the message.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<p>String example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": "Some string"
}</pre>
</div>
<p>Object example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": [
        {
            "text": "Some text",
            "type": "text"
        }
    ]
}</pre>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">text</code>
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
This must be set to the value <code class="literal">text</code>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">role</code>
</span>
</dt>
<dd>
(Required, string)
The role of the message author. This should be set to <code class="literal">assistant</code> for this type of message.
</dd>
<dt>
<span class="term">
<code class="literal">tool_calls</code>
</span>
</dt>
<dd>
<p>
(Optional, array of objects)
The tool calls generated by the model.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "tool_calls": [
        {
            "id": "call_KcAjWtAww20AihPHphUh46Gd",
            "type": "function",
            "function": {
                "name": "get_current_weather",
                "arguments": "{\"location\":\"Boston, MA\"}"
            }
        }
    ]
}</pre>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
(Required, string)
The identifier of the tool call.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
The type of tool call. This must be set to the value <code class="literal">function</code>.
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The function that the model called.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string)
The name of the function to call.
</dd>
<dt>
<span class="term">
<code class="literal">arguments</code>
</span>
</dt>
<dd>
(Required, string)
The arguments to call the function with in JSON format.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">System message</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">content</code>
</span>
</dt>
<dd>
<p>
(Required, string or array of objects)
The contents of the message.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<p>String example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": "Some string"
}</pre>
</div>
<p>Object example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": [
        {
            "text": "Some text",
            "type": "text"
        }
    ]
}</pre>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">text</code>
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
This must be set to the value <code class="literal">text</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">role</code>
</span>
</dt>
<dd>
(Required, string)
The role of the message author. This should be set to <code class="literal">system</code> for this type of message.
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">Tool message</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">content</code>
</span>
</dt>
<dd>
<p>
(Required, string or array of objects)
The contents of the message.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<p>String example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": "Some string"
}</pre>
</div>
<p>Object example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": [
        {
            "text": "Some text",
            "type": "text"
        }
    ]
}</pre>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">text</code>
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
This must be set to the value <code class="literal">text</code>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">role</code>
</span>
</dt>
<dd>
(Required, string)
The role of the message author. This should be set to <code class="literal">tool</code> for this type of message.
</dd>
<dt>
<span class="term">
<code class="literal">tool_call_id</code>
</span>
</dt>
<dd>
(Required, string)
The tool call that this message is responding to.
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">User message</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">content</code>
</span>
</dt>
<dd>
<p>
(Required, string or array of objects)
The contents of the message.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<p>String example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": "Some string"
}</pre>
</div>
<p>Object example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": [
        {
            "text": "Some text",
            "type": "text"
        }
    ]
}</pre>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">text</code>
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
This must be set to the value <code class="literal">text</code>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">role</code>
</span>
</dt>
<dd>
(Required, string)
The role of the message author. This should be set to <code class="literal">user</code> for this type of message.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">model</code>
</span>
</dt>
<dd>
(Optional, string)
The ID of the model to use. By default, the model ID is set to the value included when creating the inference endpoint.
</dd>
<dt>
<span class="term">
<code class="literal">max_completion_tokens</code>
</span>
</dt>
<dd>
(Optional, integer)
The upper bound limit for the number of tokens that can be generated for a completion request.
</dd>
<dt>
<span class="term">
<code class="literal">stop</code>
</span>
</dt>
<dd>
(Optional, array of strings)
A sequence of strings to control when the model should stop generating additional tokens.
</dd>
<dt>
<span class="term">
<code class="literal">temperature</code>
</span>
</dt>
<dd>
(Optional, float)
The sampling temperature to use.
</dd>
<dt>
<span class="term">
<code class="literal">tools</code>
</span>
</dt>
<dd>
<p>
(Optional, array of objects)
A list of tools that the model can call.
</p>
<details>
<summary class="title">Structure</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
The type of tool, must be set to the value <code class="literal">function</code>.
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The function definition.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string)
A description of what the function does. This is used by the model to choose when and how to call the function.
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string)
The name of the function.
</dd>
<dt>
<span class="term">
<code class="literal">parameters</code>
</span>
</dt>
<dd>
(Optional, object)
The parameters the functional accepts. This should be formatted as a JSON object.
</dd>
<dt>
<span class="term">
<code class="literal">strict</code>
</span>
</dt>
<dd>
(Optional, boolean)
Whether to enable schema adherence when generating the function call.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">Examples</summary>
<div class="content">
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "tools": [
        {
            "type": "function",
            "function": {
                "name": "get_price_of_item",
                "description": "Get the current price of an item",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "item": {
                            "id": "12345"
                        },
                        "unit": {
                            "type": "currency"
                        }
                    }
                }
            }
        }
    ]
}</pre>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">tool_choice</code>
</span>
</dt>
<dd>
<p>
(Optional, string or object)
Controls which tool is called by the model.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
One of <code class="literal">auto</code>, <code class="literal">none</code>, or <code class="literal">requrired</code>. <code class="literal">auto</code> allows the model to choose between calling tools and generating a message. <code class="literal">none</code> causes the model to not call any tools. <code class="literal">required</code> forces the model to call one or more tools.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<details>
<summary class="title">Structure</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
The type of the tool. This must be set to the value <code class="literal">function</code>.
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
<p>
(Required, object)
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string)
The name of the function to call.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">Examples</summary>
<div class="content">
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "tool_choice": {
        "type": "function",
        "function": {
            "name": "get_current_weather"
        }
    }
}</pre>
</div>
</div>
</details>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">top_p</code>
</span>
</dt>
<dd>
(Optional, float)
Nucleus sampling, an alternative to sampling with temperature.
</dd>
</dl>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-example"></a>Examples</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<p>The following example performs a chat completion on the example question with streaming.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.perform_request(
    "POST",
    "/_inference/chat_completion/openai-completion/_stream",
    headers={"Content-Type": "application/json"},
    body={
        "model": "gpt-4o",
        "messages": [
            {
                "role": "user",
                "content": "What is Elastic?"
            }
        ]
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.transport.request({
  method: "POST",
  path: "/_inference/chat_completion/openai-completion/_stream",
  body: {
    model: "gpt-4o",
    messages: [
      {
        role: "user",
        content: "What is Elastic?",
      },
    ],
  },
});
console.log(response);</pre>
</div>
<a id="120fcf9f55128d6a81d5e87a9c235bbd"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST _inference/chat_completion/openai-completion/_stream
{
    "model": "gpt-4o",
    "messages": [
        {
            "role": "user",
            "content": "What is Elastic?"
        }
    ]
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2932.console"></div>
<p>The following example performs a chat completion using an Assistant message with <code class="literal">tool_calls</code>.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.perform_request(
    "POST",
    "/_inference/chat_completion/openai-completion/_stream",
    headers={"Content-Type": "application/json"},
    body={
        "messages": [
            {
                "role": "assistant",
                "content": "Let's find out what the weather is",
                "tool_calls": [
                    {
                        "id": "call_KcAjWtAww20AihPHphUh46Gd",
                        "type": "function",
                        "function": {
                            "name": "get_current_weather",
                            "arguments": "{\"location\":\"Boston, MA\"}"
                        }
                    }
                ]
            },
            {
                "role": "tool",
                "content": "The weather is cold",
                "tool_call_id": "call_KcAjWtAww20AihPHphUh46Gd"
            }
        ]
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.transport.request({
  method: "POST",
  path: "/_inference/chat_completion/openai-completion/_stream",
  body: {
    messages: [
      {
        role: "assistant",
        content: "Let's find out what the weather is",
        tool_calls: [
          {
            id: "call_KcAjWtAww20AihPHphUh46Gd",
            type: "function",
            function: {
              name: "get_current_weather",
              arguments: '{"location":"Boston, MA"}',
            },
          },
        ],
      },
      {
        role: "tool",
        content: "The weather is cold",
        tool_call_id: "call_KcAjWtAww20AihPHphUh46Gd",
      },
    ],
  },
});
console.log(response);</pre>
</div>
<a id="82bb6c61dab959f4446dc5ecab7ecbdf"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST _inference/chat_completion/openai-completion/_stream
{
    "messages": [
        {
            "role": "assistant",
            "content": "Let's find out what the weather is",
            "tool_calls": [ <a id="CO818-1"></a><i class="conum" data-value="1"></i>
                {
                    "id": "call_KcAjWtAww20AihPHphUh46Gd",
                    "type": "function",
                    "function": {
                        "name": "get_current_weather",
                        "arguments": "{\"location\":\"Boston, MA\"}"
                    }
                }
            ]
        },
        { <a id="CO818-2"></a><i class="conum" data-value="2"></i>
            "role": "tool",
            "content": "The weather is cold",
            "tool_call_id": "call_KcAjWtAww20AihPHphUh46Gd"
        }
    ]
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2933.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO818-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Each tool call needs a corresponding Tool message.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO818-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The corresponding Tool message.</p>
</td>
</tr>
</table>
</div>
<p>The following example performs a chat completion using a User message with <code class="literal">tools</code> and <code class="literal">tool_choice</code>.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.perform_request(
    "POST",
    "/_inference/chat_completion/openai-completion/_stream",
    headers={"Content-Type": "application/json"},
    body={
        "messages": [
            {
                "role": "user",
                "content": [
                    {
                        "type": "text",
                        "text": "What's the price of a scarf?"
                    }
                ]
            }
        ],
        "tools": [
            {
                "type": "function",
                "function": {
                    "name": "get_current_price",
                    "description": "Get the current price of a item",
                    "parameters": {
                        "type": "object",
                        "properties": {
                            "item": {
                                "id": "123"
                            }
                        }
                    }
                }
            }
        ],
        "tool_choice": {
            "type": "function",
            "function": {
                "name": "get_current_price"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.transport.request({
  method: "POST",
  path: "/_inference/chat_completion/openai-completion/_stream",
  body: {
    messages: [
      {
        role: "user",
        content: [
          {
            type: "text",
            text: "What's the price of a scarf?",
          },
        ],
      },
    ],
    tools: [
      {
        type: "function",
        function: {
          name: "get_current_price",
          description: "Get the current price of a item",
          parameters: {
            type: "object",
            properties: {
              item: {
                id: "123",
              },
            },
          },
        },
      },
    ],
    tool_choice: {
      type: "function",
      function: {
        name: "get_current_price",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="45954b8aaedfed57012be8b6538b0a24"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST _inference/chat_completion/openai-completion/_stream
{
    "messages": [
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "What's the price of a scarf?"
                }
            ]
        }
    ],
    "tools": [
        {
            "type": "function",
            "function": {
                "name": "get_current_price",
                "description": "Get the current price of a item",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "item": {
                            "id": "123"
                        }
                    }
                }
            }
        }
    ],
    "tool_choice": {
        "type": "function",
        "function": {
            "name": "get_current_price"
        }
    }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2934.console"></div>
<p>The API returns the following response when a request is made to the OpenAI service:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">event: message
data: {"chat_completion":{"id":"chatcmpl-Ae0TWsy2VPnSfBbv5UztnSdYUMFP3","choices":[{"delta":{"content":"","role":"assistant"},"index":0}],"model":"gpt-4o-2024-08-06","object":"chat.completion.chunk"}}

event: message
data: {"chat_completion":{"id":"chatcmpl-Ae0TWsy2VPnSfBbv5UztnSdYUMFP3","choices":[{"delta":{"content":Elastic"},"index":0}],"model":"gpt-4o-2024-08-06","object":"chat.completion.chunk"}}

event: message
data: {"chat_completion":{"id":"chatcmpl-Ae0TWsy2VPnSfBbv5UztnSdYUMFP3","choices":[{"delta":{"content":" is"},"index":0}],"model":"gpt-4o-2024-08-06","object":"chat.completion.chunk"}}

(...)

event: message
data: {"chat_completion":{"id":"chatcmpl-Ae0TWsy2VPnSfBbv5UztnSdYUMFP3","choices":[],"model":"gpt-4o-2024-08-06","object":"chat.completion.chunk","usage":{"completion_tokens":28,"prompt_tokens":16,"total_tokens":44}}} <a id="CO819-1"></a><i class="conum" data-value="1"></i>

event: message
data: [DONE]</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO819-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The last object message of the stream contains the token usage information.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="post-inference-api.html">« Perform inference API</a>
</span>
<span class="next">
<a href="put-inference-api.html">Create inference API »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
