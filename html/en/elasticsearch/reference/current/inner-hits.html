<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Retrieve inner hits | Elasticsearch Guide [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Retrieve inner hits | Elasticsearch Guide [8.19]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.19]"/>
<link rel="up" href="search-your-data.html" title="The search API"/>
<link rel="prev" href="near-real-time.html" title="Near real-time search"/>
<link rel="next" href="search-shard-routing.html" title="Search shard routing"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.19"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.19"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="icon" href="/favicon.ico" sizes="32x32"/>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml"/>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/>
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="near-real-time.html">« Near real-time search</a>
</span>
<span class="next">
<a href="search-shard-routing.html">Search shard routing »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="search-with-elasticsearch.html">Search your data</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="search-your-data.html">The search API</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Retrieve inner hits</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/search/search-your-data/retrieve-inner-hits.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/elasticsearch/rest-apis/retrieve-inner-hits">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="inner-hits"></a>Retrieve inner hits</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/search/search-your-data/retrieve-inner-hits.asciidoc">edit</a></div>
</div></div></div>
<p>The <a class="xref" href="parent-join.html" title="Join field type">parent-join</a> and <a class="xref" href="nested.html" title="Nested field type">nested</a> features allow the return of documents that
have matches in a different scope. In the parent/child case, parent documents are returned based on matches in child
documents or child documents are returned based on matches in parent documents. In the nested case, documents are returned
based on matches in nested inner objects.</p>
<p>In both cases, the actual matches in the different scopes that caused a document to be returned are hidden. In many cases,
it&#8217;s very useful to know which inner nested objects (in the case of nested) or children/parent documents (in the case
of parent/child) caused certain information to be returned. The inner hits feature can be used for this. This feature
returns per search hit in the search response additional nested hits that caused a search hit to match in a different scope.</p>
<p>Inner hits can be used by defining an <code class="literal">inner_hits</code> definition on a <code class="literal">nested</code>, <code class="literal">has_child</code> or <code class="literal">has_parent</code> query and filter.
The structure looks like this:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">"&lt;query&gt;" : {
    "inner_hits" : {
        &lt;inner_hits_options&gt;
    }
}</pre>
</div>
<p>If <code class="literal">inner_hits</code> is defined on a query that supports it then each search hit will contain an <code class="literal">inner_hits</code> json object with the following structure:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">"hits": [
     {
        "_index": ...,
        "_type": ...,
        "_id": ...,
        "inner_hits": {
           "&lt;inner_hits_name&gt;": {
              "hits": {
                 "total": ...,
                 "hits": [
                    {
                       "_id": ...,
                       ...
                    },
                    ...
                 ]
              }
           }
        },
        ...
     },
     ...
]</pre>
</div>
<div class="position-relative"><h4><a id="inner-hits-options"></a>Options</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/search/search-your-data/retrieve-inner-hits.asciidoc">edit</a></div>
<p>Inner hits support the following options:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">from</code>
</p>
</td>
<td valign="top">
<p>
The offset from where the first hit to fetch for each <code class="literal">inner_hits</code> in the returned regular search hits.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">size</code>
</p>
</td>
<td valign="top">
<p>
The maximum number of hits to return per <code class="literal">inner_hits</code>. By default the top three matching hits are returned.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">sort</code>
</p>
</td>
<td valign="top">
<p>
How the inner hits should be sorted per <code class="literal">inner_hits</code>. By default the hits are sorted by the score.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">name</code>
</p>
</td>
<td valign="top">
<p>
The name to be used for the particular inner hit definition in the response. Useful when multiple inner hits
have been defined in a single search request. The default depends in which query the inner hit is defined.
For <code class="literal">has_child</code> query and filter this is the child type, <code class="literal">has_parent</code> query and filter this is the parent type
and the nested query and filter this is the nested path.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>Inner hits also supports the following per document features:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="highlighting.html" title="Highlighting">Highlighting</a>
</li>
<li class="listitem">
<a class="xref" href="search-search.html#request-body-search-explain">Explain</a>
</li>
<li class="listitem">
<a class="xref" href="search-fields.html#search-fields-param" title="The fields option">Search fields</a>
</li>
<li class="listitem">
<a class="xref" href="search-fields.html#source-filtering" title="The _source option">Source filtering</a>
</li>
<li class="listitem">
<a class="xref" href="search-fields.html#script-fields" title="Script fields">Script fields</a>
</li>
<li class="listitem">
<a class="xref" href="search-fields.html#docvalue-fields" title="Doc value fields">Doc value fields</a>
</li>
<li class="listitem">
<a class="xref" href="search-search.html#request-body-search-version">Include versions</a>
</li>
<li class="listitem">
<a class="xref" href="search-search.html#request-body-search-seq-no-primary-term">Include Sequence Numbers and Primary Terms</a>
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="nested-inner-hits"></a>Nested inner hits</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/search/search-your-data/retrieve-inner-hits.asciidoc">edit</a></div>
<p>The nested <code class="literal">inner_hits</code> can be used to include nested inner objects as inner hits to a search hit.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="test",
    mappings={
        "properties": {
            "comments": {
                "type": "nested"
            }
        }
    },
)
print(resp)

resp1 = client.index(
    index="test",
    id="1",
    refresh=True,
    document={
        "title": "Test title",
        "comments": [
            {
                "author": "kimchy",
                "number": 1
            },
            {
                "author": "nik9000",
                "number": 2
            }
        ]
    },
)
print(resp1)

resp2 = client.search(
    index="test",
    query={
        "nested": {
            "path": "comments",
            "query": {
                "match": {
                    "comments.number": 2
                }
            },
            "inner_hits": {}
        }
    },
)
print(resp2)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'test',
  body: {
    mappings: {
      properties: {
        comments: {
          type: 'nested'
        }
      }
    }
  }
)
puts response

response = client.index(
  index: 'test',
  id: 1,
  refresh: true,
  body: {
    title: 'Test title',
    comments: [
      {
        author: 'kimchy',
        number: 1
      },
      {
        author: 'nik9000',
        number: 2
      }
    ]
  }
)
puts response

response = client.search(
  index: 'test',
  body: {
    query: {
      nested: {
        path: 'comments',
        query: {
          match: {
            'comments.number' =&gt; 2
          }
        },
        inner_hits: {}
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "test",
  mappings: {
    properties: {
      comments: {
        type: "nested",
      },
    },
  },
});
console.log(response);

const response1 = await client.index({
  index: "test",
  id: 1,
  refresh: "true",
  document: {
    title: "Test title",
    comments: [
      {
        author: "kimchy",
        number: 1,
      },
      {
        author: "nik9000",
        number: 2,
      },
    ],
  },
});
console.log(response1);

const response2 = await client.search({
  index: "test",
  query: {
    nested: {
      path: "comments",
      query: {
        match: {
          "comments.number": 2,
        },
      },
      inner_hits: {},
    },
  },
});
console.log(response2);</pre>
</div>
<a id="2a91e1fb8ad93a188fa9d77ec01bc431"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT test
{
  "mappings": {
    "properties": {
      "comments": {
        "type": "nested"
      }
    }
  }
}

PUT test/_doc/1?refresh
{
  "title": "Test title",
  "comments": [
    {
      "author": "kimchy",
      "number": 1
    },
    {
      "author": "nik9000",
      "number": 2
    }
  ]
}

POST test/_search
{
  "query": {
    "nested": {
      "path": "comments",
      "query": {
        "match": {"comments.number" : 2}
      },
      "inner_hits": {} <a id="CO314-1"></a><i class="conum" data-value="1"></i>
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1055.console"></div>
<div class="calloutlist default has-python has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO314-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The inner hit definition in the nested query. No other options need to be defined.</p>
</td>
</tr>
</table>
</div>
<p>An example of a response snippet that could be generated from the above search request:</p>
<a id="cb58a734d14c0a1e2743f7449d42e9c9"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  ...,
  "hits": {
    "total" : {
        "value": 1,
        "relation": "eq"
    },
    "max_score": 1.0,
    "hits": [
      {
        "_index": "test",
        "_id": "1",
        "_score": 1.0,
        "_source": ...,
        "inner_hits": {
          "comments": { <a id="CO315-1"></a><i class="conum" data-value="1"></i>
            "hits": {
              "total" : {
                  "value": 1,
                  "relation": "eq"
              },
              "max_score": 1.0,
              "hits": [
                {
                  "_index": "test",
                  "_id": "1",
                  "_nested": {
                    "field": "comments",
                    "offset": 1
                  },
                  "_score": 1.0,
                  "_source": {
                    "author": "nik9000",
                    "number": 2
                  }
                }
              ]
            }
          }
        }
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO315-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name used in the inner hit definition in the search request. A custom key can be used via the <code class="literal">name</code> option.</p>
</td>
</tr>
</table>
</div>
<p>The <code class="literal">_nested</code> metadata is crucial in the above example, because it defines from what inner nested object this inner hit
came from. The <code class="literal">field</code> defines the object array field the nested hit is from and the <code class="literal">offset</code> relative to its location
in the <code class="literal">_source</code>. Due to sorting and scoring the actual location of the hit objects in the <code class="literal">inner_hits</code> is usually
different than the location a nested inner object was defined.</p>
<p>By default the <code class="literal">_source</code> is returned also for the hit objects in <code class="literal">inner_hits</code>, but this can be changed. Either via
<code class="literal">_source</code> filtering feature part of the source can be returned or be disabled. If stored fields are defined on the
nested level these can also be returned via the <code class="literal">fields</code> feature.</p>
<p>An important default is that the <code class="literal">_source</code> returned in hits inside <code class="literal">inner_hits</code> is relative to the <code class="literal">_nested</code> metadata.
So in the above example only the comment part is returned per nested hit and not the entire source of the top level
document that contained the comment.</p>
<div class="position-relative"><h5><a id="nested-inner-hits-source"></a>Nested inner hits and <code class="literal">_source</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/search/search-your-data/retrieve-inner-hits.asciidoc">edit</a></div>
<p>Nested document don&#8217;t have a <code class="literal">_source</code> field, because the entire source of document is stored with the root document under
its <code class="literal">_source</code> field. To include the source of just the nested document, the source of the root document is parsed and just
the relevant bit for the nested document is included as source in the inner hit. Doing this for each matching nested document
has an impact on the time it takes to execute the entire search request, especially when <code class="literal">size</code> and the inner hits' <code class="literal">size</code>
are set higher than the default. To avoid the relatively expensive source extraction for nested inner hits, one can disable
including the source and solely rely on doc values fields. Like this:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="test",
    mappings={
        "properties": {
            "comments": {
                "type": "nested"
            }
        }
    },
)
print(resp)

resp1 = client.index(
    index="test",
    id="1",
    refresh=True,
    document={
        "title": "Test title",
        "comments": [
            {
                "author": "kimchy",
                "text": "comment text"
            },
            {
                "author": "nik9000",
                "text": "words words words"
            }
        ]
    },
)
print(resp1)

resp2 = client.search(
    index="test",
    query={
        "nested": {
            "path": "comments",
            "query": {
                "match": {
                    "comments.text": "words"
                }
            },
            "inner_hits": {
                "_source": False,
                "docvalue_fields": [
                    "comments.text.keyword"
                ]
            }
        }
    },
)
print(resp2)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'test',
  body: {
    mappings: {
      properties: {
        comments: {
          type: 'nested'
        }
      }
    }
  }
)
puts response

response = client.index(
  index: 'test',
  id: 1,
  refresh: true,
  body: {
    title: 'Test title',
    comments: [
      {
        author: 'kimchy',
        text: 'comment text'
      },
      {
        author: 'nik9000',
        text: 'words words words'
      }
    ]
  }
)
puts response

response = client.search(
  index: 'test',
  body: {
    query: {
      nested: {
        path: 'comments',
        query: {
          match: {
            'comments.text' =&gt; 'words'
          }
        },
        inner_hits: {
          _source: false,
          docvalue_fields: [
            'comments.text.keyword'
          ]
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "test",
  mappings: {
    properties: {
      comments: {
        type: "nested",
      },
    },
  },
});
console.log(response);

const response1 = await client.index({
  index: "test",
  id: 1,
  refresh: "true",
  document: {
    title: "Test title",
    comments: [
      {
        author: "kimchy",
        text: "comment text",
      },
      {
        author: "nik9000",
        text: "words words words",
      },
    ],
  },
});
console.log(response1);

const response2 = await client.search({
  index: "test",
  query: {
    nested: {
      path: "comments",
      query: {
        match: {
          "comments.text": "words",
        },
      },
      inner_hits: {
        _source: false,
        docvalue_fields: ["comments.text.keyword"],
      },
    },
  },
});
console.log(response2);</pre>
</div>
<a id="983fbb78e57e8fe98db38cf2d217e943"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT test
{
  "mappings": {
    "properties": {
      "comments": {
        "type": "nested"
      }
    }
  }
}

PUT test/_doc/1?refresh
{
  "title": "Test title",
  "comments": [
    {
      "author": "kimchy",
      "text": "comment text"
    },
    {
      "author": "nik9000",
      "text": "words words words"
    }
  ]
}

POST test/_search
{
  "query": {
    "nested": {
      "path": "comments",
      "query": {
        "match": {"comments.text" : "words"}
      },
      "inner_hits": {
        "_source" : false,
        "docvalue_fields" : [
          "comments.text.keyword"
        ]
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1056.console"></div>
<div class="position-relative"><h4><a id="hierarchical-nested-inner-hits"></a>Hierarchical levels of nested object fields and inner hits.</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/search/search-your-data/retrieve-inner-hits.asciidoc">edit</a></div>
<p>If a mapping has multiple levels of hierarchical nested object fields each level can be accessed via dot notated path.
For example if there is a <code class="literal">comments</code> nested field that contains a <code class="literal">votes</code> nested field and votes should directly be returned
with the root hits then the following path can be defined:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="test",
    mappings={
        "properties": {
            "comments": {
                "type": "nested",
                "properties": {
                    "votes": {
                        "type": "nested"
                    }
                }
            }
        }
    },
)
print(resp)

resp1 = client.index(
    index="test",
    id="1",
    refresh=True,
    document={
        "title": "Test title",
        "comments": [
            {
                "author": "kimchy",
                "text": "comment text",
                "votes": []
            },
            {
                "author": "nik9000",
                "text": "words words words",
                "votes": [
                    {
                        "value": 1,
                        "voter": "kimchy"
                    },
                    {
                        "value": -1,
                        "voter": "other"
                    }
                ]
            }
        ]
    },
)
print(resp1)

resp2 = client.search(
    index="test",
    query={
        "nested": {
            "path": "comments.votes",
            "query": {
                "match": {
                    "comments.votes.voter": "kimchy"
                }
            },
            "inner_hits": {}
        }
    },
)
print(resp2)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'test',
  body: {
    mappings: {
      properties: {
        comments: {
          type: 'nested',
          properties: {
            votes: {
              type: 'nested'
            }
          }
        }
      }
    }
  }
)
puts response

response = client.index(
  index: 'test',
  id: 1,
  refresh: true,
  body: {
    title: 'Test title',
    comments: [
      {
        author: 'kimchy',
        text: 'comment text',
        votes: []
      },
      {
        author: 'nik9000',
        text: 'words words words',
        votes: [
          {
            value: 1,
            voter: 'kimchy'
          },
          {
            value: -1,
            voter: 'other'
          }
        ]
      }
    ]
  }
)
puts response

response = client.search(
  index: 'test',
  body: {
    query: {
      nested: {
        path: 'comments.votes',
        query: {
          match: {
            'comments.votes.voter' =&gt; 'kimchy'
          }
        },
        inner_hits: {}
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "test",
  mappings: {
    properties: {
      comments: {
        type: "nested",
        properties: {
          votes: {
            type: "nested",
          },
        },
      },
    },
  },
});
console.log(response);

const response1 = await client.index({
  index: "test",
  id: 1,
  refresh: "true",
  document: {
    title: "Test title",
    comments: [
      {
        author: "kimchy",
        text: "comment text",
        votes: [],
      },
      {
        author: "nik9000",
        text: "words words words",
        votes: [
          {
            value: 1,
            voter: "kimchy",
          },
          {
            value: -1,
            voter: "other",
          },
        ],
      },
    ],
  },
});
console.log(response1);

const response2 = await client.search({
  index: "test",
  query: {
    nested: {
      path: "comments.votes",
      query: {
        match: {
          "comments.votes.voter": "kimchy",
        },
      },
      inner_hits: {},
    },
  },
});
console.log(response2);</pre>
</div>
<a id="79feb4a0c0a21b7015a52f9736cd4683"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT test
{
  "mappings": {
    "properties": {
      "comments": {
        "type": "nested",
        "properties": {
          "votes": {
            "type": "nested"
          }
        }
      }
    }
  }
}

PUT test/_doc/1?refresh
{
  "title": "Test title",
  "comments": [
    {
      "author": "kimchy",
      "text": "comment text",
      "votes": []
    },
    {
      "author": "nik9000",
      "text": "words words words",
      "votes": [
        {"value": 1 , "voter": "kimchy"},
        {"value": -1, "voter": "other"}
      ]
    }
  ]
}

POST test/_search
{
  "query": {
    "nested": {
      "path": "comments.votes",
        "query": {
          "match": {
            "comments.votes.voter": "kimchy"
          }
        },
        "inner_hits" : {}
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1057.console"></div>
<p>Which would look like:</p>
<a id="bb924187bb9a4f4f07e55042f1f4b639"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  ...,
  "hits": {
    "total" : {
        "value": 1,
        "relation": "eq"
    },
    "max_score": 0.6931471,
    "hits": [
      {
        "_index": "test",
        "_id": "1",
        "_score": 0.6931471,
        "_source": ...,
        "inner_hits": {
          "comments.votes": { <a id="CO316-1"></a><i class="conum" data-value="1"></i>
            "hits": {
              "total" : {
                  "value": 1,
                  "relation": "eq"
              },
              "max_score": 0.6931471,
              "hits": [
                {
                  "_index": "test",
                  "_id": "1",
                  "_nested": {
                    "field": "comments",
                    "offset": 1,
                    "_nested": {
                      "field": "votes",
                      "offset": 0
                    }
                  },
                  "_score": 0.6931471,
                  "_source": {
                    "value": 1,
                    "voter": "kimchy"
                  }
                }
              ]
            }
          }
        }
      }
    ]
  }
}</pre>
</div>
<p>This indirect referencing is only supported for nested inner hits.</p>
<div class="position-relative"><h4><a id="parent-child-inner-hits"></a>Parent/child inner hits</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/search/search-your-data/retrieve-inner-hits.asciidoc">edit</a></div>
<p>The parent/child <code class="literal">inner_hits</code> can be used to include parent or child:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="test",
    mappings={
        "properties": {
            "my_join_field": {
                "type": "join",
                "relations": {
                    "my_parent": "my_child"
                }
            }
        }
    },
)
print(resp)

resp1 = client.index(
    index="test",
    id="1",
    refresh=True,
    document={
        "number": 1,
        "my_join_field": "my_parent"
    },
)
print(resp1)

resp2 = client.index(
    index="test",
    id="2",
    routing="1",
    refresh=True,
    document={
        "number": 1,
        "my_join_field": {
            "name": "my_child",
            "parent": "1"
        }
    },
)
print(resp2)

resp3 = client.search(
    index="test",
    query={
        "has_child": {
            "type": "my_child",
            "query": {
                "match": {
                    "number": 1
                }
            },
            "inner_hits": {}
        }
    },
)
print(resp3)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'test',
  body: {
    mappings: {
      properties: {
        my_join_field: {
          type: 'join',
          relations: {
            my_parent: 'my_child'
          }
        }
      }
    }
  }
)
puts response

response = client.index(
  index: 'test',
  id: 1,
  refresh: true,
  body: {
    number: 1,
    my_join_field: 'my_parent'
  }
)
puts response

response = client.index(
  index: 'test',
  id: 2,
  routing: 1,
  refresh: true,
  body: {
    number: 1,
    my_join_field: {
      name: 'my_child',
      parent: '1'
    }
  }
)
puts response

response = client.search(
  index: 'test',
  body: {
    query: {
      has_child: {
        type: 'my_child',
        query: {
          match: {
            number: 1
          }
        },
        inner_hits: {}
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "test",
  mappings: {
    properties: {
      my_join_field: {
        type: "join",
        relations: {
          my_parent: "my_child",
        },
      },
    },
  },
});
console.log(response);

const response1 = await client.index({
  index: "test",
  id: 1,
  refresh: "true",
  document: {
    number: 1,
    my_join_field: "my_parent",
  },
});
console.log(response1);

const response2 = await client.index({
  index: "test",
  id: 2,
  routing: 1,
  refresh: "true",
  document: {
    number: 1,
    my_join_field: {
      name: "my_child",
      parent: "1",
    },
  },
});
console.log(response2);

const response3 = await client.search({
  index: "test",
  query: {
    has_child: {
      type: "my_child",
      query: {
        match: {
          number: 1,
        },
      },
      inner_hits: {},
    },
  },
});
console.log(response3);</pre>
</div>
<a id="3f5b5bee692e7d4b0992dc0a64e95a60"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT test
{
  "mappings": {
    "properties": {
      "my_join_field": {
        "type": "join",
        "relations": {
          "my_parent": "my_child"
        }
      }
    }
  }
}

PUT test/_doc/1?refresh
{
  "number": 1,
  "my_join_field": "my_parent"
}

PUT test/_doc/2?routing=1&amp;refresh
{
  "number": 1,
  "my_join_field": {
    "name": "my_child",
    "parent": "1"
  }
}

POST test/_search
{
  "query": {
    "has_child": {
      "type": "my_child",
      "query": {
        "match": {
          "number": 1
        }
      },
      "inner_hits": {}    <a id="CO316-2"></a><i class="conum" data-value="1"></i>
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/1058.console"></div>
<div class="calloutlist default has-python has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO316-1"><i class="conum" data-value="1"></i></a><a href="#CO316-2"></a></p>
</td>
<td align="left" valign="top">
<p>The inner hit definition like in the nested example.</p>
</td>
</tr>
</table>
</div>
<p>An example of a response snippet that could be generated from the above search request:</p>
<a id="20250d7a4c6c199116eff4f8bf45cf28"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  ...,
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.0,
    "hits": [
      {
        "_index": "test",
        "_id": "1",
        "_score": 1.0,
        "_source": {
          "number": 1,
          "my_join_field": "my_parent"
        },
        "inner_hits": {
          "my_child": {
            "hits": {
              "total": {
                "value": 1,
                "relation": "eq"
              },
              "max_score": 1.0,
              "hits": [
                {
                  "_index": "test",
                  "_id": "2",
                  "_score": 1.0,
                  "_routing": "1",
                  "_source": {
                    "number": 1,
                    "my_join_field": {
                      "name": "my_child",
                      "parent": "1"
                    }
                  }
                }
              ]
            }
          }
        }
      }
    ]
  }
}</pre>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="near-real-time.html">« Near real-time search</a>
</span>
<span class="next">
<a href="search-shard-routing.html">Search shard routing »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
