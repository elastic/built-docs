<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="ELSER is a learned sparse ranking model trained by Elastic.">
<meta name="keywords" content="hot-spotting, hotspot, hot-spot, hot spot, hotspots, hotspotting">
<title>EQL search API | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="EQL search API | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="eql-apis.html" title="EQL APIs"/>
<link rel="prev" href="delete-async-eql-search-api.html" title="Delete async EQL search API"/>
<link rel="next" href="get-async-eql-search-api.html" title="Get async EQL search API"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="eql-apis.html">EQL APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="delete-async-eql-search-api.html">« Delete async EQL search API</a>
</span>
<span class="next">
<a href="get-async-eql-search-api.html">Get async EQL search API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="eql-search-api"></a>EQL search API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h2>
</div></div></div>

<p>Returns search results for an <a class="xref" href="eql.html" title="EQL search">Event Query Language (EQL)</a> query.</p>
<p>EQL assumes each document in a data stream or index corresponds to an
event.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.eql.search(
  index: 'my-data-stream',
  body: {
    query: "\n    process where process.name == \"regsvr32.exe\"\n  "
  }
)
puts response</pre>
</div>
<a id="b839f79a5d58506baed5714f1876ab55"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">GET /my-data-stream/_eql/search
{
  "query": """
    process where process.name == "regsvr32.exe"
  """
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/2327.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET /&lt;target&gt;/_eql/search</code></p>
<p><code class="literal">POST /&lt;target&gt;/_eql/search</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">read</code>
<a class="xref" href="security-privileges.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the target data stream, index,
or alias.
</li>
<li class="listitem">
See <a class="xref" href="eql.html#eql-required-fields" title="Required fields">Required fields</a>.
</li>
<li class="listitem">
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> For cross-cluster search, the local and remote clusters must
use the same Elasticsearch version if they have versions prior to 7.17.7 (included) or prior to 8.5.1 (included). For security, see <a class="xref" href="remote-clusters-security.html" title="Configure remote clusters with security">Configure remote clusters with security</a>.
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="eql-search-api-limitations"></a>Limitations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h4>
</div></div></div>
<p>See <a class="xref" href="eql-syntax.html#eql-syntax-limitations" title="Limitations">EQL limitations</a>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, string) Comma-separated list of data streams, indices, or aliases
used to limit the request. Supports wildcards (<code class="literal">*</code>). To search all data streams
and indices, use <code class="literal">*</code> or <code class="literal">_all</code>.
</p>
<p><span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> To search a remote cluster, use the <code class="literal">&lt;cluster&gt;:&lt;target&gt;</code> syntax.
See <a class="xref" href="eql.html#run-eql-search-across-clusters" title="Run an EQL search across clusters">Run an EQL search across clusters</a>.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_indices</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This parameter&#8217;s behavior differs from the <code class="literal">allow_no_indices</code> parameter
used in other <a class="xref" href="multi-index.html" title="Multi-target syntax">multi-target APIs</a>.</p>
</div>
</div>
<p>If <code class="literal">false</code>, the request returns an error if any wildcard pattern, alias, or
<code class="literal">_all</code> value targets only missing or closed indices. This behavior applies even
if the request targets other open indices. For example, a request targeting
<code class="literal">foo*,bar*</code> returns an error if an index starts with <code class="literal">foo</code> but no index starts
with <code class="literal">bar</code>.</p>
<p>If <code class="literal">true</code>, only requests that exclusively target missing or closed indices
return an error. For example, a request targeting <code class="literal">foo*,bar*</code> does not return an
error if an index starts with <code class="literal">foo</code> but no index starts with <code class="literal">bar</code>. However, a
request that targets only <code class="literal">bar*</code> still returns an error.</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ccs_minimize_roundtrips</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean) If <code class="literal">true</code>, network round-trips between the local and the
remote cluster are minimized when running cross-cluster search (CCS) requests.
</p>
<p>This option is effective for requests that target data fully contained in one
remote cluster; when data is spread across multiple clusters, the setting is
ignored.</p>
<p>Defaults to <code class="literal">true</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">expand_wildcards</code>
</span>
</dt>
<dd>
<p>(Optional, string)
Type of index that wildcard patterns can match. If the request can target data
streams, this argument determines whether wildcard expressions match hidden data
streams. Supports comma-separated values, such as <code class="literal">open,hidden</code>. Valid values
are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
Match any data stream or index, including <a class="xref" href="multi-index.html#hidden" title="Hidden data streams and indices">hidden</a> ones.
</dd>
<dt>
<span class="term">
<code class="literal">open</code>
</span>
</dt>
<dd>
Match open, non-hidden indices. Also matches any non-hidden data stream.
</dd>
<dt>
<span class="term">
<code class="literal">closed</code>
</span>
</dt>
<dd>
Match closed, non-hidden indices. Also matches any non-hidden data stream. Data
streams cannot be closed.
</dd>
<dt>
<span class="term">
<code class="literal">hidden</code>
</span>
</dt>
<dd>
Match hidden data streams and hidden indices. Must be combined with <code class="literal">open</code>,
<code class="literal">closed</code>, or both.
</dd>
<dt>
<span class="term">
<code class="literal">none</code>
</span>
</dt>
<dd>
Wildcard patterns are not accepted.
</dd>
</dl>
</div>
<p>Defaults to <code class="literal">open</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">filter_path</code>
</span>
</dt>
<dd>
(Optional, string)
Comma-separated list of filters for the API response. See
<a class="xref" href="common-options.html#common-options-response-filtering" title="Response Filtering">Response Filtering</a>.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unavailable</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">false</code>, the request returns an error if it targets a
missing or closed index. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">keep_alive</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period for which the search and its results are stored on the cluster. Defaults
to <code class="literal">5d</code> (five days).</p>
<p>When this period expires, the search and its results are deleted, even if the
search is still ongoing.</p>
<p>If the <a class="xref" href="eql-search-api.html#eql-search-api-keep-on-completion"><code class="literal">keep_on_completion</code></a> parameter is
<code class="literal">false</code>, Elasticsearch only stores <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async searches</a> that do not
complete within the period set by the
<a class="xref" href="eql-search-api.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter, regardless of this value.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">keep_alive</code> request body parameter.
If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">keep_on_completion</code>
</span>
</dt>
<dd>
<p>(Optional, Boolean)
If <code class="literal">true</code>, the search and its results are stored on the cluster.</p>
<p>If <code class="literal">false</code>, the search and its results are stored on the cluster only if the
request does not complete during the period set by the
<a class="xref" href="eql-search-api.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter. Defaults to <code class="literal">false</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">keep_on_completion</code> request body
parameter. If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_completion_timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Timeout duration to wait for the request to finish. Defaults to no
timeout, meaning the request waits for complete search results.</p>
<p>If this parameter is specified and the request completes during this period,
complete search results are returned.</p>
<p>If the request does not complete during this period, the search becomes an
<a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async search</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">wait_for_completion_timeout</code> request
body parameter. If both parameters are specified, only the query parameter is
used.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">event_category_field</code>
</span>
</dt>
<dd>
<p>
(Required*, string)
Field containing the event classification, such as <code class="literal">process</code>, <code class="literal">file</code>, or
<code class="literal">network</code>.
</p>
<p>Defaults to <code class="literal">event.category</code>, as defined in the <a href="/guide/en/ecs/master/ecs-event.html" class="ulink" target="_top">Elastic
Common Schema (ECS)</a>. If a data stream or index does not contain the
<code class="literal">event.category</code> field, this value is required.</p>
<p>The event category field must be mapped as a field type in the
<a class="xref" href="keyword.html" title="Keyword type family"><code class="literal">keyword</code></a> family.</p>
</dd>
<dt>
<span class="term">
<code class="literal">fetch_size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer)
Maximum number of events to search at a time for sequence queries. Defaults to
<code class="literal">1000</code>.
</p>
<p>This value must be greater than <code class="literal">2</code> but cannot exceed the value of the
<a class="xref" href="index-modules.html#index-max-result-window"><code class="literal">index.max_result_window</code></a> setting, which defaults to
<code class="literal">10000</code>.</p>
<p>Internally, a sequence query fetches and paginates sets of events to search for
matches. This parameter controls the size of those sets. This parameter does not
limit the total number of events searched or the number of matching events
returned.</p>
<p>A greater <code class="literal">fetch_size</code> value often increases search speed but uses more memory.</p>
</dd>
<dt>
<span class="term">
<code class="literal">fields</code>
</span>
</dt>
<dd>
<p>
(Optional, array of strings and objects)
Array of field patterns. The request returns values for field names matching
these patterns in the <code class="literal">hits.fields</code> property of the response.
</p>
<p>You can specify items in the array as a string or object. See
<a class="xref" href="search-fields.html#search-fields-param" title="The fields option">the <code class="literal">fields</code> option</a>.</p>
<details open>
<summary class="title">Properties of <code class="literal">fields</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">field</code>
</span>
</dt>
<dd>
(Required, string) Field to return. Supports wildcards (<code class="literal">*</code>).
</dd>
<dt>
<span class="term">
<code class="literal">format</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
Format for date and geospatial fields. Other field data types do not support
this parameter.
</p>
<p><a class="xref" href="date.html" title="Date field type"><code class="literal">date</code></a> and <a class="xref" href="date_nanos.html" title="Date nanoseconds field type"><code class="literal">date_nanos</code></a> fields accept a
<a class="xref" href="mapping-date-format.html" title="format">date format</a>. <a class="xref" href="geo-point.html" title="Geopoint field type"><code class="literal">geo_point</code></a> and
<a class="xref" href="geo-shape.html" title="Geoshape field type"><code class="literal">geo_shape</code></a> fields accept:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">geojson</code> (default)
</span>
</dt>
<dd>
<a href="http://www.geojson.org" class="ulink" target="_top">GeoJSON</a>
</dd>
<dt>
<span class="term">
<code class="literal">wkt</code>
</span>
</dt>
<dd>
<a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry" class="ulink" target="_top">Well Known Text</a>
</dd>
<dt>
<span class="term">
<code class="literal">mvt(&lt;spec&gt;)</code>
</span>
</dt>
<dd>
<p>
Binary
<a href="https://docs.mapbox.com/vector-tiles/specification" class="ulink" target="_top">Mapbox vector tile</a>. The API
returns the tile as a base64-encoded string.
The <code class="literal">&lt;spec&gt;</code> has the format <code class="literal">&lt;zoom&gt;/&lt;x&gt;/&lt;y&gt;</code> with two optional suffixes: <code class="literal">@&lt;extent&gt;</code> and/or <code class="literal">:&lt;buffer&gt;</code>. For example, <code class="literal">2/0/1</code> or <code class="literal">2/0/1@4096:5</code>.
</p>
<details open>
<summary class="title"><code class="literal">mvt</code> parameters</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;zoom&gt;</code>
</span>
</dt>
<dd>
(Required, integer) Zoom level for the tile. Accepts <code class="literal">0</code>-<code class="literal">29</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;x&gt;</code>
</span>
</dt>
<dd>
(Required, integer) X coordinate for the tile.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;y&gt;</code>
</span>
</dt>
<dd>
(Required, integer) Y coordinate for the tile.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;extent&gt;</code>
</span>
</dt>
<dd>
(Optional, integer) Size, in pixels, of a side of the tile. Vector tiles are
square with equal sides. Defaults to <code class="literal">4096</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;buffer&gt;</code>
</span>
</dt>
<dd>
(Optional, integer) Size, in pixels, of a clipping buffer outside the tile.
This allows renderers to avoid outline artifacts from geometries that extend past the extent of the tile. Defaults to <code class="literal">5</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL object</a>)
Query, written in Query DSL, used to filter the events on which the EQL query
runs.
</dd>
<dt>
<span class="term">
<code class="literal">keep_alive</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Period for which the search and its results are stored on the cluster. Defaults
to <code class="literal">5d</code> (five days).</p>
<p>When this period expires, the search and its results are deleted, even if the
search is still ongoing.</p>
<p>If the <a class="xref" href="eql-search-api.html#eql-search-api-keep-on-completion"><code class="literal">keep_on_completion</code></a> parameter is
<code class="literal">false</code>, Elasticsearch only stores <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async searches</a> that do not
complete within the period set by the
<a class="xref" href="eql-search-api.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter, regardless of this value.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">keep_alive</code> query parameter.
If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-keep-on-completion"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">keep_on_completion</code>
</span>
</dt>
<dd>
<p>(Optional, Boolean)
If <code class="literal">true</code>, the search and its results are stored on the cluster.</p>
<p>If <code class="literal">false</code>, the search and its results are stored on the cluster only if the
request does not complete during the period set by the
<a class="xref" href="eql-search-api.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter. Defaults to <code class="literal">false</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">keep_on_completion</code> query parameter.
If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-request-query-param"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Required, string)
<a class="xref" href="eql-syntax.html" title="EQL syntax reference">EQL</a> query you wish to run.
</dd>
<dt>
<span class="term">
<code class="literal">result_position</code>
</span>
</dt>
<dd>
<p>
(Optional, enum)
Set of matching events or sequences to return.
</p>
<details open>
<summary class="title">Valid values for <code class="literal">result_position</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">tail</code>
</span>
</dt>
<dd>
(Default)
Return the most recent matches, similar to the <a href="https://en.wikipedia.org/wiki/Tail_(Unix)" class="ulink" target="_top">Unix tail
command</a>.
</dd>
<dt>
<span class="term">
<code class="literal">head</code>
</span>
</dt>
<dd>
Return the earliest matches, similar to the <a href="https://en.wikipedia.org/wiki/Head_(Unix)" class="ulink" target="_top">Unix head
command</a>.
</dd>
</dl>
</div>
</div>
</details>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This parameter may change the set of returned hits. However, it does not
change the sort order of hits in the response.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">runtime_mappings</code>
</span>
</dt>
<dd>
<p>
(Optional, object of objects)
Defines one or more <a class="xref" href="runtime-search-request.html" title="Define runtime fields in a search request">runtime fields</a> in the search
request. These fields take precedence over mapped fields with the same name.
</p>
<details open>
<summary class="title">Properties of <code class="literal">runtime_mappings</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;field-name&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, object)
Configuration for the runtime field. The key is the field name.
</p>
<details open>
<summary class="title">Properties of <code class="literal">&lt;field-name&gt;</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
<p>
(Required, string)
<a class="xref" href="mapping-types.html" title="Field data types">Field type</a>, which can be any of the following:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">boolean</code>
</li>
<li class="listitem">
<code class="literal">composite</code>
</li>
<li class="listitem">
<code class="literal">date</code>
</li>
<li class="listitem">
<code class="literal">double</code>
</li>
<li class="listitem">
<code class="literal">geo_point</code>
</li>
<li class="listitem">
<code class="literal">ip</code>
</li>
<li class="listitem">
<code class="literal">keyword</code>
</li>
<li class="listitem">
<code class="literal">long</code>
</li>
<li class="listitem">
<a class="xref" href="runtime-retrieving-fields.html#lookup-runtime-fields" title="Retrieve fields from related indices"><code class="literal">lookup</code></a>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">script</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
<a class="xref" href="modules-scripting-using.html" title="How to write scripts">Painless script</a> executed at query time. The
script has access to the entire context of a document, including the original
<code class="literal">_source</code> and any mapped fields plus their values.
</p>
<p>This script must include <code class="literal">emit</code> to return calculated values. For example:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"script": "emit(doc['@timestamp'].value.dayOfWeekEnum.toString())"</pre>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-params-size"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">size</code>
</span>
</dt>
<dd>
<p>
(Optional, integer or float)
For <a class="xref" href="eql-syntax.html#eql-basic-syntax" title="Basic syntax">basic queries</a>, the maximum number of matching events to
return.
</p>
<p>For <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence queries</a>, the maximum number of matching sequences
to return.</p>
<p>Defaults to <code class="literal">10</code>. This value must be greater than <code class="literal">0</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot use <a class="xref" href="eql-pipe-ref.html" title="EQL pipe reference">pipes</a>, such as <code class="literal">head</code> or <code class="literal">tail</code>, to exceed
this value.</p>
</div>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-tiebreaker-field"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">tiebreaker_field</code>
</span>
</dt>
<dd>
(Optional, string)
Field used to sort hits with the same
<a class="xref" href="eql-search-api.html#eql-search-api-timestamp-field">timestamp</a> in ascending order. See
<a class="xref" href="eql.html#eql-search-specify-a-sort-tiebreaker" title="Specify a sort tiebreaker">Specify a sort tiebreaker</a>.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-timestamp-field"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">timestamp_field</code>
</span>
</dt>
<dd>
<p>(Required*, string)
Field containing event timestamp.</p>
<p>Defaults to <code class="literal">@timestamp</code>, as defined in the
<a href="/guide/en/ecs/master/ecs-event.html" class="ulink" target="_top">Elastic Common Schema (ECS)</a>. If a data stream or index
does not contain the <code class="literal">@timestamp</code> field, this value is required.</p>
<p>Events in the API response are sorted by this field&#8217;s value, converted to
milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix epoch</a>, in
ascending order.</p>
<p>The timestamp field should be mapped as a <a class="xref" href="date.html" title="Date field type"><code class="literal">date</code></a>. The
<a class="xref" href="date_nanos.html" title="Date nanoseconds field type"><code class="literal">date_nanos</code></a> field type is not supported.</p>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-wait-for-completion-timeout"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">wait_for_completion_timeout</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
Timeout duration to wait for the request to finish. Defaults to no
timeout, meaning the request waits for complete search results.</p>
<p>If this parameter is specified and the request completes during this period,
complete search results are returned.</p>
<p>If the request does not complete during this period, the search becomes an
<a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async search</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify this value using the <code class="literal">wait_for_completion_timeout</code> query
parameter. If both parameters are specified, only the query parameter is used.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-response-body"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<a id="eql-search-api-response-body-search-id"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
<p>(string)
Identifier for the search.</p>
<p>This search ID is only provided if one of the following conditions is met:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A search request does not return complete results during the
<a class="xref" href="eql-search-api.html#eql-search-api-wait-for-completion-timeout"><code class="literal">wait_for_completion_timeout</code></a>
parameter&#8217;s timeout period, becoming an <a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">async search</a>.
</li>
<li class="listitem">
The search request&#8217;s <a class="xref" href="eql-search-api.html#eql-search-api-keep-on-completion"><code class="literal">keep_on_completion</code></a>
parameter is <code class="literal">true</code>.
</li>
</ul>
</div>
<p>You can use this ID with the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get async EQL search
API</a> to get the current status and available results for the search or
<a class="xref" href="get-async-eql-status-api.html" title="Get async EQL status API">get async EQL status API</a> to get only
the current status.</p>
</dd>
<dt>
<span class="term">
<code class="literal">is_partial</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, the response does not contain complete search results.
</dd>
<dt>
<span class="term">
<code class="literal">is_running</code>
</span>
</dt>
<dd>
<p>(Boolean)
If <code class="literal">true</code>, the search request is still executing.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If this parameter and the <code class="literal">is_partial</code> parameter are <code class="literal">true</code>, the search is an
<a class="xref" href="eql.html#eql-search-async" title="Run an async EQL search">ongoing async search</a>. If the <code class="literal">keep_alive</code> period does not
pass, the complete search results will be available when the search completes.</p>
<p>If <code class="literal">is_partial</code> is <code class="literal">true</code> but <code class="literal">is_running</code> is <code class="literal">false</code>, the search returned
partial results due to a failure. Only some shards returned results or the node
coordinating the search failed.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">took</code>
</span>
</dt>
<dd>
<p>(integer)
Milliseconds it took Elasticsearch to execute the request.</p>
<p>This value is calculated by measuring the time elapsed
between receipt of a request on the coordinating node
and the time at which the coordinating node is ready to send the response.</p>
<p>Took time includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Communication time between the coordinating node and data nodes
</li>
<li class="listitem">
Time the request spends in the <code class="literal">search</code> <a class="xref" href="modules-threadpool.html" title="Thread pools">thread pool</a>,
queued for execution
</li>
<li class="listitem">
Actual execution time
</li>
</ul>
</div>
<p>Took time does <span class="strong strong"><strong>not</strong></span> include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Time needed to send the request to Elasticsearch
</li>
<li class="listitem">
Time needed to serialize the JSON response
</li>
<li class="listitem">
Time needed to send the response to a client
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">timed_out</code>
</span>
</dt>
<dd>
(Boolean)
If <code class="literal">true</code>, the request timed out before completion.
</dd>
<dt>
<span class="term">
<code class="literal">hits</code>
</span>
</dt>
<dd>
<p>
(object)
Contains matching events and sequences. Also contains related metadata.
</p>
<details open>
<summary class="title">Properties of <code class="literal">hits</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">total</code>
</span>
</dt>
<dd>
<p>
(object)
Metadata about the number of matching events or sequences.
</p>
<details open>
<summary class="title">Properties of <code class="literal">total</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">value</code>
</span>
</dt>
<dd>
<p>
(integer)
For <a class="xref" href="eql-syntax.html#eql-basic-syntax" title="Basic syntax">basic queries</a>, the total number of matching events.
</p>
<p>For <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence queries</a>, the total number of matching sequences.</p>
</dd>
<dt>
<span class="term">
<code class="literal">relation</code>
</span>
</dt>
<dd>
<p>(string)
Indicates whether the number of events or sequences returned is accurate or a
lower bound.</p>
<p>Returned values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">eq</code>
</span>
</dt>
<dd>
Accurate
</dd>
<dt>
<span class="term">
<code class="literal">gte</code>
</span>
</dt>
<dd>
Lower bound, including returned events or sequences
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">sequences</code>
</span>
</dt>
<dd>
<p>
(array of objects)
Contains event sequences matching the query. Each object represents a
matching sequence. This parameter is only returned for EQL queries containing
a <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence</a>.
</p>
<details open>
<summary class="title">Properties of <code class="literal">sequences</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">join_keys</code>
</span>
</dt>
<dd>
(array of values)
Shared field values used to constrain matches in the sequence. These are defined
using the <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences"><code class="literal">by</code> keyword</a> in the EQL query syntax.
</dd>
<dt>
<span class="term">
<code class="literal">events</code>
</span>
</dt>
<dd>
<p>
(array of objects)
Contains events matching the query. Each object represents a
matching event.
</p>
<details open>
<summary class="title">Properties of <code class="literal">events</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(string)
Name of the index containing the event.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(string)
Unique identifier for the event.
This ID is only unique within the index.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(object)
Original JSON body passed for the event at index time.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div class="variablelist">
<a id="eql-search-api-response-events"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">events</code>
</span>
</dt>
<dd>
<p>
(array of objects)
Contains events matching the query. Each object represents a
matching event.
</p>
<details open>
<summary class="title">Properties of <code class="literal">events</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(string)
Name of the index containing the event.
</dd>
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(string)
(string)
Unique identifier for the event.
This ID is only unique within the index.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(object)
Original JSON body passed for the event at index time.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="eql-search-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="eql-search-api-basic-query-ex"></a>Basic query example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h4>
</div></div></div>
<p>The following EQL search request searches for events with an <code class="literal">event.category</code> of
<code class="literal">process</code> that meet the following conditions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A <code class="literal">process.name</code> of <code class="literal">cmd.exe</code>
</li>
<li class="listitem">
An <code class="literal">process.pid</code> other than <code class="literal">2013</code>
</li>
</ul>
</div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.eql.search(
  index: 'my-data-stream',
  body: {
    query: "\n    process where (process.name == \"cmd.exe\" and process.pid != 2013)\n  "
  }
)
puts response</pre>
</div>
<a id="ec0e50f78390b8622cef4e0b0cd45967"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">GET /my-data-stream/_eql/search
{
  "query": """
    process where (process.name == "cmd.exe" and process.pid != 2013)
  """
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/2328.console"></div>
<p>The API returns the following response. Matching events in the <code class="literal">hits.events</code>
property are sorted by <a class="xref" href="eql-search-api.html#eql-search-api-timestamp-field">timestamp</a>, converted
to milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix epoch</a>,
in ascending order.</p>
<p>If two or more events share the same timestamp, the
<a class="xref" href="eql-search-api.html#eql-search-api-tiebreaker-field"><code class="literal">tiebreaker_field</code></a> field is used to sort
the events in ascending order.</p>
<a id="a6b7a8fa78199f14791c301b00526599"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 6,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "events": [
      {
        "_index": ".ds-my-data-stream-2099.12.07-000001",
        "_id": "babI3XMBI9IjHuIqU0S_",
        "_source": {
          "@timestamp": "2099-12-06T11:04:05.000Z",
          "event": {
            "category": "process",
            "id": "edwCRnyD",
            "sequence": 1
          },
          "process": {
            "pid": 2012,
            "name": "cmd.exe",
            "executable": "C:\\Windows\\System32\\cmd.exe"
          }
        }
      },
      {
        "_index": ".ds-my-data-stream-2099.12.07-000001",
        "_id": "b6bI3XMBI9IjHuIqU0S_",
        "_source": {
          "@timestamp": "2099-12-07T11:06:07.000Z",
          "event": {
            "category": "process",
            "id": "cMyt5SZ2",
            "sequence": 3
          },
          "process": {
            "pid": 2012,
            "name": "cmd.exe",
            "executable": "C:\\Windows\\System32\\cmd.exe"
          }
        }
      }
    ]
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="eql-search-api-sequence-ex"></a>Sequence query example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql-search-api.asciidoc">edit</a></h4>
</div></div></div>
<p>The following EQL search request matches a <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence</a> of events
that:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Start with an event with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">event.category</code> of <code class="literal">file</code>
</li>
<li class="listitem">
A <code class="literal">file.name</code> of <code class="literal">cmd.exe</code>
</li>
<li class="listitem">
An <code class="literal">process.pid</code> other than <code class="literal">2013</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Followed by an event with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">event.category</code> of <code class="literal">process</code>
</li>
<li class="listitem">
A <code class="literal">process.executable</code> that contains the substring <code class="literal">regsvr32</code>
</li>
</ul>
</div>
</li>
</ol>
</div>
<p>These events must also share the same <code class="literal">process.pid</code> value.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.eql.search(
  index: 'my-data-stream',
  body: {
    query: "\n    sequence by process.pid\n      [ file where file.name == \"cmd.exe\" and process.pid != 2013 ]\n      [ process where stringContains(process.executable, \"regsvr32\") ]\n  "
  }
)
puts response</pre>
</div>
<a id="8141b60ad245ece2ff5e8d0817400ee5"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">GET /my-data-stream/_eql/search
{
  "query": """
    sequence by process.pid
      [ file where file.name == "cmd.exe" and process.pid != 2013 ]
      [ process where stringContains(process.executable, "regsvr32") ]
  """
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/2329.console"></div>
<p>The API returns the following response. Matching sequences are included in the
<code class="literal">hits.sequences</code> property. The <code class="literal">hits.sequences.join_keys</code> property contains the
shared <code class="literal">process.pid</code> value for each matching event.</p>
<a id="40bcab67e5d3ff2cb572f99159349638"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 6,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "sequences": [
      {
        "join_keys": [
          2012
        ],
        "events": [
          {
            "_index": ".ds-my-data-stream-2099.12.07-000001",
            "_id": "AtOJ4UjUBAAx3XR5kcCM",
            "_source": {
              "@timestamp": "2099-12-06T11:04:07.000Z",
              "event": {
                "category": "file",
                "id": "dGCHwoeS",
                "sequence": 2
              },
              "file": {
                "accessed": "2099-12-07T11:07:08.000Z",
                "name": "cmd.exe",
                "path": "C:\\Windows\\System32\\cmd.exe",
                "type": "file",
                "size": 16384
              },
              "process": {
                "pid": 2012,
                "name": "cmd.exe",
                "executable": "C:\\Windows\\System32\\cmd.exe"
              }
            }
          },
          {
            "_index": ".ds-my-data-stream-2099.12.07-000001",
            "_id": "OQmfCaduce8zoHT93o4H",
            "_source": {
              "@timestamp": "2099-12-07T11:07:09.000Z",
              "event": {
                "category": "process",
                "id": "aR3NWVOs",
                "sequence": 4
              },
              "process": {
                "pid": 2012,
                "name": "regsvr32.exe",
                "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
                "executable": "C:\\Windows\\System32\\regsvr32.exe"
              }
            }
          }
        ]
      }
    ]
  }
}</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="delete-async-eql-search-api.html">« Delete async EQL search API</a>
</span>
<span class="next">
<a href="get-async-eql-search-api.html">Get async EQL search API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
