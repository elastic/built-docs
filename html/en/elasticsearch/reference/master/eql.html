<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>EQL search | Elasticsearch Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="prev" href="search-aggregations-pipeline-sum-bucket-aggregation.html" title="Sum bucket aggregation"/>
<link rel="next" href="eql-syntax.html" title="EQL syntax reference"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="search-aggregations-pipeline-sum-bucket-aggregation.html">« Sum bucket aggregation</a>
</span>
<span class="next">
<a href="eql-syntax.html">EQL syntax reference »</a>
</span>
</div>
<div class="part xpack">
<div class="titlepage"><div><div>
<h1 class="title"><a id="eql"></a>EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h1>
</div></div></div>
<div class="openblock partintro">
<div class="content">

<p>Event Query Language (EQL) is a query language for event-based time series
data, such as logs, metrics, and traces.</p>
<h3><a id="eql-advantages"></a>Advantages of EQL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>EQL lets you express relationships between events.</strong></span><br>
Many query languages allow you to match single events. EQL lets you match a
sequence of events across different event categories and time spans.
</li>
<li class="listitem">
<span class="strong strong"><strong>EQL has a low learning curve.</strong></span><br>
<a class="xref" href="eql-syntax.html" title="EQL syntax reference">EQL syntax</a> looks like other common query languages, such as SQL.
EQL lets you write and read queries intuitively, which makes for quick,
iterative searching.
</li>
<li class="listitem">
<span class="strong strong"><strong>EQL is designed for security use cases.</strong></span><br>
While you can use it for any event-based data, we created EQL for threat
hunting. EQL not only supports indicator of compromise (IOC) searches but can
describe activity that goes beyond IOCs.
</li>
</ul>
</div>
<h3><a id="eql-required-fields"></a>Required fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>With the exception of sample queries, EQL searches require that the searched
data stream or index  contains a <em>timestamp</em> field. By default, EQL uses the
<code class="literal">@timestamp</code> field from the <a href="/guide/en/ecs/8.6" class="ulink" target="_top">Elastic Common Schema (ECS)</a>.</p>
<p>EQL searches also require an <em>event category</em> field, unless you use the
<a class="xref" href="eql-syntax.html#eql-syntax-match-any-event-category" title="Match any event category"><code class="literal">any</code> keyword</a> to search for  documents
without an event category field. By default, EQL uses the ECS <code class="literal">event.category</code>
field.</p>
<p>To use a different timestamp or event category field, see
<a class="xref" href="eql.html#specify-a-timestamp-or-event-category-field" title="Specify a timestamp or event category field">Specify a timestamp or event category field</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>While no schema is required to use EQL, we recommend using the
<a href="/guide/en/ecs/8.6" class="ulink" target="_top">ECS</a>. EQL searches are designed to work with core ECS fields by
default.</p>
</div>
</div>
<h3><a id="run-an-eql-search"></a>Run an EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>Use the <a class="xref" href="eql-search-api.html" title="EQL search API">EQL search API</a> to run a <a class="xref" href="eql-syntax.html#eql-basic-syntax" title="Basic syntax">basic EQL
query</a>.</p>
<a id="b839f79a5d58506baed5714f1876ab55"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "query": """
    process where process.name == "regsvr32.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1419.console"></div>
<p>By default, basic EQL queries return the 10 most recent matching events in the
<code class="literal">hits.events</code> property. These hits are sorted by timestamp, converted to
milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix epoch</a>, in ascending order.</p>
<a id="26dda75335301caad781ce094e3046c0"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 60,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "events": [
      {
        "_index": ".ds-my-data-stream-2099.12.07-000001",
        "_id": "OQmfCaduce8zoHT93o4H",
        "_source": {
          "@timestamp": "2099-12-07T11:07:09.000Z",
          "event": {
            "category": "process",
            "id": "aR3NWVOs",
            "sequence": 4
          },
          "process": {
            "pid": 2012,
            "name": "regsvr32.exe",
            "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
            "executable": "C:\\Windows\\System32\\regsvr32.exe"
          }
        }
      },
      {
        "_index": ".ds-my-data-stream-2099.12.07-000001",
        "_id": "xLkCaj4EujzdNSxfYLbO",
        "_source": {
          "@timestamp": "2099-12-07T11:07:10.000Z",
          "event": {
            "category": "process",
            "id": "GTSmSqgz0U",
            "sequence": 6,
            "type": "termination"
          },
          "process": {
            "pid": 2012,
            "name": "regsvr32.exe",
            "executable": "C:\\Windows\\System32\\regsvr32.exe"
          }
        }
      }
    ]
  }
}</pre>
</div>
<p>Use the <code class="literal">size</code> parameter to get a smaller or larger set of hits:</p>
<a id="044b2f99e7438e408685b258db17f863"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "query": """
    process where process.name == "regsvr32.exe"
  """,
  "size": 50
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1420.console"></div>
<h3><a id="eql-search-sequence"></a>Search for a sequence of events<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>Use EQL&#8217;s <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence syntax</a> to search for a series of
ordered events. List the event items in ascending chronological order,
with the most recent event listed last:</p>
<a id="0ac295efdabd59e7b1f1a4577535d942"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "query": """
    sequence
      [ process where process.name == "regsvr32.exe" ]
      [ file where stringContains(file.name, "scrobj.dll") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1421.console"></div>
<p>The response&#8217;s <code class="literal">hits.sequences</code> property contains the 10 most recent matching
sequences.</p>
<a id="7723882df18f3ae86c50c14c671e601b"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  ...
  "hits": {
    "total": ...,
    "sequences": [
      {
        "events": [
          {
            "_index": ".ds-my-data-stream-2099.12.07-000001",
            "_id": "OQmfCaduce8zoHT93o4H",
            "_source": {
              "@timestamp": "2099-12-07T11:07:09.000Z",
              "event": {
                "category": "process",
                "id": "aR3NWVOs",
                "sequence": 4
              },
              "process": {
                "pid": 2012,
                "name": "regsvr32.exe",
                "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
                "executable": "C:\\Windows\\System32\\regsvr32.exe"
              }
            }
          },
          {
            "_index": ".ds-my-data-stream-2099.12.07-000001",
            "_id": "yDwnGIJouOYGBzP0ZE9n",
            "_source": {
              "@timestamp": "2099-12-07T11:07:10.000Z",
              "event": {
                "category": "file",
                "id": "tZ1NWVOs",
                "sequence": 5
              },
              "process": {
                "pid": 2012,
                "name": "regsvr32.exe",
                "executable": "C:\\Windows\\System32\\regsvr32.exe"
              },
              "file": {
                "path": "C:\\Windows\\System32\\scrobj.dll",
                "name": "scrobj.dll"
              }
            }
          }
        ]
      }
    ]
  }
}</pre>
</div>
<p>Use <a class="xref" href="eql-syntax.html#eql-with-maxspan-keywords" title="with maxspan statement"><code class="literal">with maxspan</code></a> to constrain matching sequences
to a timespan:</p>
<a id="937089157fc82cf08b68a954d0e6d52c"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "query": """
    sequence with maxspan=1h
      [ process where process.name == "regsvr32.exe" ]
      [ file where stringContains(file.name, "scrobj.dll") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1422.console"></div>
<p>Use the <a class="xref" href="eql-syntax.html#eql-by-keyword" title="by keyword"><code class="literal">by</code> keyword</a> to match events that share the
same field values:</p>
<a id="98621bea4765b1b838cc9daa914bf5c5"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "query": """
    sequence with maxspan=1h
      [ process where process.name == "regsvr32.exe" ] by process.pid
      [ file where stringContains(file.name, "scrobj.dll") ] by process.pid
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1423.console"></div>
<p>If a field value should be shared across all events, use the <code class="literal">sequence by</code>
keyword. The following query is equivalent to the previous one.</p>
<a id="8a4941cae0b32d68b22bec2d12c82860"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "query": """
    sequence by process.pid with maxspan=1h
      [ process where process.name == "regsvr32.exe" ]
      [ file where stringContains(file.name, "scrobj.dll") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1424.console"></div>
<p>The <code class="literal">hits.sequences.join_keys</code> property contains the shared field values.</p>
<a id="8ee1b18027673554458d3afe72538638"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  ...
  "hits": ...,
    "sequences": [
      {
        "join_keys": [
          2012
        ],
        "events": ...
      }
    ]
  }
}</pre>
</div>
<p>Use the <a class="xref" href="eql-syntax.html#eql-until-keyword" title="until keyword"><code class="literal">until</code> keyword</a> to specify an expiration
event for sequences. Matching sequences must end before this event.</p>
<a id="e494162e83ce041c56b2e2bc29d33474"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "query": """
    sequence by process.pid with maxspan=1h
      [ process where process.name == "regsvr32.exe" ]
      [ file where stringContains(file.name, "scrobj.dll") ]
    until [ process where event.type == "termination" ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1425.console"></div>
<h3><a id="eql-search-sample"></a>Sample chronologically unordered events<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>Use EQL&#8217;s <a class="xref" href="eql-syntax.html#eql-samples" title="Samples">sample syntax</a> to search for events that match one or
more join keys and a set of filters. Samples are similar to sequences, but do
not return events in chronological order. In fact, sample queries can run on
data without a timestamp. Sample queries can be useful to find correlations in
events that don&#8217;t always occur in the same sequence, or that occur across long
time spans.</p>
<details>
<summary class="title">Click to show the sample data used in the examples below</summary>
<div class="content">
<a id="36b26905c5f96d0b785c3267fb63838d"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001
{
    "mappings": {
        "properties": {
            "ip": {
                "type":"ip"
            },
            "version": {
                "type": "version"
            },
            "missing_keyword": {
                "type": "keyword"
            },
            "@timestamp": {
              "type": "date"
            },
            "type_test": {
                "type": "keyword"
            },
            "@timestamp_pretty": {
              "type": "date",
              "format": "dd-MM-yyyy"
            },
            "event_type": {
              "type": "keyword"
            },
            "event": {
              "properties": {
                "category": {
                  "type": "alias",
                  "path": "event_type"
                }
              }
            },
            "host": {
              "type": "keyword"
            },
            "os": {
              "type": "keyword"
            },
            "bool": {
              "type": "boolean"
            },
            "uptime" : {
              "type" : "long"
            },
            "port" : {
              "type" : "long"
            }
        }
    }
}

PUT /my-index-000002
{
    "mappings": {
        "properties": {
            "ip": {
                "type":"ip"
            },
            "@timestamp": {
              "type": "date"
            },
            "@timestamp_pretty": {
              "type": "date",
              "format": "yyyy-MM-dd"
            },
            "type_test": {
                "type": "keyword"
            },
            "event_type": {
              "type": "keyword"
            },
            "event": {
              "properties": {
                "category": {
                  "type": "alias",
                  "path": "event_type"
                }
              }
            },
            "host": {
              "type": "keyword"
            },
            "op_sys": {
              "type": "keyword"
            },
            "bool": {
              "type": "boolean"
            },
            "uptime" : {
              "type" : "long"
            },
            "port" : {
              "type" : "long"
            }
        }
    }
}

PUT /my-index-000003
{
    "mappings": {
        "properties": {
            "host_ip": {
                "type":"ip"
            },
            "@timestamp": {
              "type": "date"
            },
            "date": {
              "type": "date"
            },
            "event_type": {
              "type": "keyword"
            },
            "event": {
              "properties": {
                "category": {
                  "type": "alias",
                  "path": "event_type"
                }
              }
            },
            "missing_keyword": {
                "type": "keyword"
            },
            "host": {
              "type": "keyword"
            },
            "os": {
              "type": "keyword"
            },
            "bool": {
              "type": "boolean"
            },
            "uptime" : {
              "type" : "long"
            },
            "port" : {
              "type" : "long"
            }
        }
    }
}

POST /my-index-000001/_bulk?refresh
{"index":{"_id":1}}
{"@timestamp":"1234567891","@timestamp_pretty":"12-12-2022","missing_keyword":"test","type_test":"abc","ip":"10.0.0.1","event_type":"alert","host":"doom","uptime":0,"port":1234,"os":"win10","version":"1.0.0","id":11}
{"index":{"_id":2}}
{"@timestamp":"1234567892","@timestamp_pretty":"13-12-2022","event_type":"alert","type_test":"abc","host":"CS","uptime":5,"port":1,"os":"win10","version":"1.2.0","id":12}
{"index":{"_id":3}}
{"@timestamp":"1234567893","@timestamp_pretty":"12-12-2022","event_type":"alert","type_test":"abc","host":"farcry","uptime":1,"port":1234,"bool":false,"os":"win10","version":"2.0.0","id":13}
{"index":{"_id":4}}
{"@timestamp":"1234567894","@timestamp_pretty":"13-12-2022","event_type":"alert","type_test":"abc","host":"GTA","uptime":3,"port":12,"os":"slack","version":"10.0.0","id":14}
{"index":{"_id":5}}
{"@timestamp":"1234567895","@timestamp_pretty":"17-12-2022","event_type":"alert","host":"sniper 3d","uptime":6,"port":1234,"os":"fedora","version":"20.1.0","id":15}
{"index":{"_id":6}}
{"@timestamp":"1234568896","@timestamp_pretty":"17-12-2022","event_type":"alert","host":"doom","port":65123,"bool":true,"os":"redhat","version":"20.10.0","id":16}
{"index":{"_id":7}}
{"@timestamp":"1234567897","@timestamp_pretty":"17-12-2022","missing_keyword":"yyy","event_type":"failure","host":"doom","uptime":15,"port":1234,"bool":true,"os":"redhat","version":"20.2.0","id":17}
{"index":{"_id":8}}
{"@timestamp":"1234567898","@timestamp_pretty":"12-12-2022","missing_keyword":"test","event_type":"success","host":"doom","uptime":16,"port":512,"os":"win10","version":"1.2.3","id":18}
{"index":{"_id":9}}
{"@timestamp":"1234567899","@timestamp_pretty":"15-12-2022","missing_keyword":"test","event_type":"success","host":"GTA","port":12,"bool":true,"os":"win10","version":"1.2.3","id":19}
{"index":{"_id":10}}
{"@timestamp":"1234567893","missing_keyword":null,"ip":"10.0.0.5","event_type":"alert","host":"farcry","uptime":1,"port":1234,"bool":true,"os":"win10","version":"1.2.3","id":110}

POST /my-index-000002/_bulk?refresh
{"index":{"_id":1}}
{"@timestamp":"1234567991","type_test":"abc","ip":"10.0.0.1","event_type":"alert","host":"doom","uptime":0,"port":1234,"op_sys":"win10","id":21}
{"index":{"_id":2}}
{"@timestamp":"1234567992","type_test":"abc","event_type":"alert","host":"CS","uptime":5,"port":1,"op_sys":"win10","id":22}
{"index":{"_id":3}}
{"@timestamp":"1234567993","type_test":"abc","@timestamp_pretty":"2022-12-17","event_type":"alert","host":"farcry","uptime":1,"port":1234,"bool":false,"op_sys":"win10","id":23}
{"index":{"_id":4}}
{"@timestamp":"1234567994","event_type":"alert","host":"GTA","uptime":3,"port":12,"op_sys":"slack","id":24}
{"index":{"_id":5}}
{"@timestamp":"1234567995","event_type":"alert","host":"sniper 3d","uptime":6,"port":1234,"op_sys":"fedora","id":25}
{"index":{"_id":6}}
{"@timestamp":"1234568996","@timestamp_pretty":"2022-12-17","ip":"10.0.0.5","event_type":"alert","host":"doom","port":65123,"bool":true,"op_sys":"redhat","id":26}
{"index":{"_id":7}}
{"@timestamp":"1234567997","@timestamp_pretty":"2022-12-17","event_type":"failure","host":"doom","uptime":15,"port":1234,"bool":true,"op_sys":"redhat","id":27}
{"index":{"_id":8}}
{"@timestamp":"1234567998","ip":"10.0.0.1","event_type":"success","host":"doom","uptime":16,"port":512,"op_sys":"win10","id":28}
{"index":{"_id":9}}
{"@timestamp":"1234567999","ip":"10.0.0.1","event_type":"success","host":"GTA","port":12,"bool":false,"op_sys":"win10","id":29}

POST /my-index-000003/_bulk?refresh
{"index":{"_id":1}}
{"@timestamp":"1334567891","host_ip":"10.0.0.1","event_type":"alert","host":"doom","uptime":0,"port":12,"os":"win10","id":31}
{"index":{"_id":2}}
{"@timestamp":"1334567892","event_type":"alert","host":"CS","os":"win10","id":32}
{"index":{"_id":3}}
{"@timestamp":"1334567893","event_type":"alert","host":"farcry","bool":true,"os":"win10","id":33}
{"index":{"_id":4}}
{"@timestamp":"1334567894","event_type":"alert","host":"GTA","os":"slack","bool":true,"id":34}
{"index":{"_id":5}}
{"@timestamp":"1234567895","event_type":"alert","host":"sniper 3d","os":"fedora","id":35}
{"index":{"_id":6}}
{"@timestamp":"1234578896","host_ip":"10.0.0.1","event_type":"alert","host":"doom","bool":true,"os":"redhat","id":36}
{"index":{"_id":7}}
{"@timestamp":"1234567897","event_type":"failure","missing_keyword":"test","host":"doom","bool":true,"os":"redhat","id":37}
{"index":{"_id":8}}
{"@timestamp":"1234577898","event_type":"success","host":"doom","os":"win10","id":38,"date":"1671235200000"}
{"index":{"_id":9}}
{"@timestamp":"1234577899","host_ip":"10.0.0.5","event_type":"success","host":"GTA","bool":true,"os":"win10","id":39}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1426.console"></div>
</div>
</details>
<p>A sample query specifies at least one join key, using the <a class="xref" href="eql-syntax.html#eql-by-keyword" title="by keyword"><code class="literal">by</code>
keyword</a>, and up to five filters:</p>
<a id="5b1ae98ad03e2819fc7c3468840ef448"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index*/_eql/search
{
  "query": """
    sample by host
      [any where uptime &gt; 0]
      [any where port &gt; 100]
      [any where bool == true]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1427.console"></div>
<p>By default, the response’s <code class="literal">hits.sequences</code> property contains up to 10 samples.
Each sample has a set of <code class="literal">join_keys</code> and an array with one matching event for
each of the filters. Events are returned in the order of the filters they match:</p>
<a id="42a02f0cb23a9c62ab10343bbcdc09a1"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  ...
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "sequences": [
      {
        "join_keys": [
          "doom"                                      <a id="CO353-1"></a><i class="conum" data-value="1"></i>
        ],
        "events": [
          {                                           <a id="CO353-2"></a><i class="conum" data-value="2"></i>
            "_index": "my-index-000001",
            "_id": "7",
            "_source": {
              "@timestamp": "1234567897",
              "@timestamp_pretty": "17-12-2022",
              "missing_keyword": "yyy",
              "event_type": "failure",
              "host": "doom",
              "uptime": 15,
              "port": 1234,
              "bool": true,
              "os": "redhat",
              "version": "20.2.0",
              "id": 17
            }
          },
          {                                           <a id="CO353-3"></a><i class="conum" data-value="3"></i>
            "_index": "my-index-000001",
            "_id": "1",
            "_source": {
              "@timestamp": "1234567891",
              "@timestamp_pretty": "12-12-2022",
              "missing_keyword": "test",
              "type_test": "abc",
              "ip": "10.0.0.1",
              "event_type": "alert",
              "host": "doom",
              "uptime": 0,
              "port": 1234,
              "os": "win10",
              "version": "1.0.0",
              "id": 11
            }
          },
          {                                           <a id="CO353-4"></a><i class="conum" data-value="4"></i>
            "_index": "my-index-000001",
            "_id": "6",
            "_source": {
              "@timestamp": "1234568896",
              "@timestamp_pretty": "17-12-2022",
              "event_type": "alert",
              "host": "doom",
              "port": 65123,
              "bool": true,
              "os": "redhat",
              "version": "20.10.0",
              "id": 16
            }
          }
        ]
      },
      {
        "join_keys": [
          "farcry"                                    <a id="CO353-5"></a><i class="conum" data-value="5"></i>
        ],
        "events": [
          {
            "_index": "my-index-000001",
            "_id": "3",
            "_source": {
              "@timestamp": "1234567893",
              "@timestamp_pretty": "12-12-2022",
              "event_type": "alert",
              "type_test": "abc",
              "host": "farcry",
              "uptime": 1,
              "port": 1234,
              "bool": false,
              "os": "win10",
              "version": "2.0.0",
              "id": 13
            }
          },
          {
            "_index": "my-index-000001",
            "_id": "10",
            "_source": {
              "@timestamp": "1234567893",
              "missing_keyword": null,
              "ip": "10.0.0.5",
              "event_type": "alert",
              "host": "farcry",
              "uptime": 1,
              "port": 1234,
              "bool": true,
              "os": "win10",
              "version": "1.2.3",
              "id": 110
            }
          },
          {
            "_index": "my-index-000003",
            "_id": "3",
            "_source": {
              "@timestamp": "1334567893",
              "event_type": "alert",
              "host": "farcry",
              "bool": true,
              "os": "win10",
              "id": 33
            }
          }
        ]
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO353-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The events in the first sample have a value of <code class="literal">doom</code> for <code class="literal">host</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO353-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This event matches the first filter.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO353-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>This event matches the second filter.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO353-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>This event matches the third filter.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO353-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The events in the second sample have a value of <code class="literal">farcry</code> for <code class="literal">host</code>.</p>
</td>
</tr>
</table>
</div>
<p>You can specify multiple join keys:</p>
<a id="fef520cbc9b0656e6aac7b3dd3da9984"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index*/_eql/search
{
  "query": """
    sample by host
      [any where uptime &gt; 0]   by os
      [any where port &gt; 100]   by op_sys
      [any where bool == true] by os
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1428.console"></div>
<p>This query will return samples where each of the events shares the same value
for <code class="literal">os</code> or <code class="literal">op_sys</code>, as well as for <code class="literal">host</code>. For example:</p>
<a id="dfe4344099883d242c4b1580e0d22900"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  ...
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "sequences": [
      {
        "join_keys": [
          "doom",                                      <a id="CO354-1"></a><i class="conum" data-value="1"></i>
          "redhat"
        ],
        "events": [
          {
            "_index": "my-index-000001",
            "_id": "7",
            "_source": {
              "@timestamp": "1234567897",
              "@timestamp_pretty": "17-12-2022",
              "missing_keyword": "yyy",
              "event_type": "failure",
              "host": "doom",
              "uptime": 15,
              "port": 1234,
              "bool": true,
              "os": "redhat",
              "version": "20.2.0",
              "id": 17
            }
          },
          {
            "_index": "my-index-000002",
            "_id": "6",
            "_source": {
              "@timestamp": "1234568996",
              "@timestamp_pretty": "2022-12-17",
              "ip": "10.0.0.5",
              "event_type": "alert",
              "host": "doom",
              "port": 65123,
              "bool": true,
              "op_sys": "redhat",
              "id": 26
            }
          },
          {
            "_index": "my-index-000001",
            "_id": "6",
            "_source": {
              "@timestamp": "1234568896",
              "@timestamp_pretty": "17-12-2022",
              "event_type": "alert",
              "host": "doom",
              "port": 65123,
              "bool": true,
              "os": "redhat",
              "version": "20.10.0",
              "id": 16
            }
          }
        ]
      },
      {
        "join_keys": [
          "farcry",
          "win10"
        ],
        "events": [
          {
            "_index": "my-index-000001",
            "_id": "3",
            "_source": {
              "@timestamp": "1234567893",
              "@timestamp_pretty": "12-12-2022",
              "event_type": "alert",
              "type_test": "abc",
              "host": "farcry",
              "uptime": 1,
              "port": 1234,
              "bool": false,
              "os": "win10",
              "version": "2.0.0",
              "id": 13
            }
          },
          {
            "_index": "my-index-000002",
            "_id": "3",
            "_source": {
              "@timestamp": "1234567993",
              "type_test": "abc",
              "@timestamp_pretty": "2022-12-17",
              "event_type": "alert",
              "host": "farcry",
              "uptime": 1,
              "port": 1234,
              "bool": false,
              "op_sys": "win10",
              "id": 23
            }
          },
          {
            "_index": "my-index-000001",
            "_id": "10",
            "_source": {
              "@timestamp": "1234567893",
              "missing_keyword": null,
              "ip": "10.0.0.5",
              "event_type": "alert",
              "host": "farcry",
              "uptime": 1,
              "port": 1234,
              "bool": true,
              "os": "win10",
              "version": "1.2.3",
              "id": 110
            }
          }
        ]
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO354-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The events in this sample have a value of <code class="literal">doom</code> for <code class="literal">host</code> and a value of
<code class="literal">redhat</code> for <code class="literal">os</code> or <code class="literal">op_sys</code>.</p>
</td>
</tr>
</table>
</div>
<p>By default, the response of a sample query contains up to 10 samples, with one
sample per unique set of join keys. Use the <code class="literal">size</code> parameter to get a smaller or
larger set of samples. To retrieve more than one sample per set of join keys,
use the <code class="literal">max_samples_per_key</code> parameter. Pipes are not supported for sample
queries.</p>
<a id="1ceaa211756e2db3d48c6bc4b1a861b0"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index*/_eql/search
{
  "max_samples_per_key": 2,     <a id="CO355-1"></a><i class="conum" data-value="1"></i>
  "size": 20,                   <a id="CO355-2"></a><i class="conum" data-value="2"></i>
  "query": """
    sample
      [any where uptime &gt; 0]   by host,os
      [any where port &gt; 100]   by host,op_sys
      [any where bool == true] by host,os
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1429.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO355-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve up to 2 samples per set of join keys.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO355-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Retrieve up to 20 samples in total.</p>
</td>
</tr>
</table>
</div>
<h3><a id="retrieve-selected-fields"></a>Retrieve selected fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, each hit in the search response includes the document <code class="literal">_source</code>,
which is the entire JSON object that was provided when indexing the document.</p>
<p>You can use the <a class="xref" href="common-options.html#common-options-response-filtering" title="Response Filtering"><code class="literal">filter_path</code></a> query
parameter to filter the API response. For example, the following search returns
only the timestamp and PID from the <code class="literal">_source</code> of each matching event.</p>
<a id="d1ce66957f8bd84bf01c4bfaee3ba0c3"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search?filter_path=hits.events._source.@timestamp,hits.events._source.process.pid
{
  "query": """
    process where process.name == "regsvr32.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1430.console"></div>
<p>The API returns the following response.</p>
<a id="76ac33430196fa9ef98747874d1fe6aa"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "hits": {
    "events": [
      {
        "_source": {
          "@timestamp": "2099-12-07T11:07:09.000Z",
          "process": {
            "pid": 2012
          }
        }
      },
      {
        "_source": {
          "@timestamp": "2099-12-07T11:07:10.000Z",
          "process": {
            "pid": 2012
          }
        }
      }
    ]
  }
}</pre>
</div>
<p>You can also use the <code class="literal">fields</code> parameter to retrieve and format specific fields
in the response. This field is identical to the search API&#8217;s
<a class="xref" href="search-fields.html" title="Retrieve selected fields from a search"><code class="literal">fields</code> parameter</a>.</p>
<p>Because it consults the index mappings, the <code class="literal">fields</code> parameter provides several
advantages over referencing the <code class="literal">_source</code> directly. Specifically, the <code class="literal">fields</code>
parameter:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Returns each value in a standardized way that matches its mapping type
</li>
<li class="listitem">
Accepts <a class="xref" href="multi-fields.html" title="fields">multi-fields</a> and <a class="xref" href="field-alias.html" title="Alias field type">field aliases</a>
</li>
<li class="listitem">
Formats dates and spatial data types
</li>
<li class="listitem">
Retrieves <a class="xref" href="runtime-retrieving-fields.html" title="Retrieve a runtime field">runtime field values</a>
</li>
<li class="listitem">
Returns fields calculated by a script at index time
</li>
<li class="listitem">
Returns fields from related indices using <a class="xref" href="runtime-retrieving-fields.html#lookup-runtime-fields" title="Retrieve fields from related indices">lookup runtime fields</a>
</li>
</ul>
</div>
<p>The following search request uses the <code class="literal">fields</code> parameter to retrieve values for
the <code class="literal">event.type</code> field, all fields starting with <code class="literal">process.</code>, and the
<code class="literal">@timestamp</code> field. The request also uses the <code class="literal">filter_path</code> query parameter to
exclude the <code class="literal">_source</code> of each hit.</p>
<a id="ba8c3578613ae0bf890f6a05706ce776"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search?filter_path=-hits.events._source
{
  "query": """
    process where process.name == "regsvr32.exe"
  """,
  "fields": [
    "event.type",
    "process.*",                <a id="CO356-1"></a><i class="conum" data-value="1"></i>
    {
      "field": "@timestamp",
      "format": "epoch_millis"  <a id="CO356-2"></a><i class="conum" data-value="2"></i>
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1431.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO356-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Both full field names and wildcard patterns are accepted.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO356-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use the <code class="literal">format</code> parameter to apply a custom format for the field&#8217;s values.</p>
</td>
</tr>
</table>
</div>
<p>The response includes values as a flat list in the <code class="literal">fields</code> section for each
hit.</p>
<a id="e5407971d37c85df10671e764a609a4f"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  ...
  "hits": {
    "total": ...,
    "events": [
      {
        "_index": ".ds-my-data-stream-2099.12.07-000001",
        "_id": "OQmfCaduce8zoHT93o4H",
        "fields": {
          "process.name": [
            "regsvr32.exe"
          ],
          "process.name.keyword": [
            "regsvr32.exe"
          ],
          "@timestamp": [
            "4100324829000"
          ],
          "process.command_line": [
            "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll"
          ],
          "process.command_line.keyword": [
            "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll"
          ],
          "process.executable.keyword": [
            "C:\\Windows\\System32\\regsvr32.exe"
          ],
          "process.pid": [
            2012
          ],
          "process.executable": [
            "C:\\Windows\\System32\\regsvr32.exe"
          ]
        }
      },
      ....
    ]
  }
}</pre>
</div>
<h3><a id="eql-use-runtime-fields"></a>Use runtime fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>Use the <code class="literal">runtime_mappings</code> parameter to extract and create <a class="xref" href="runtime.html" title="Runtime fields">runtime
fields</a> during a search. Use the <code class="literal">fields</code> parameter to include runtime fields
in the response.</p>
<p>The following search creates a <code class="literal">day_of_week</code> runtime field from the <code class="literal">@timestamp</code>
and returns it in the response.</p>
<a id="cd6eee201a233b989ac1f2794fa6d640"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search?filter_path=-hits.events._source
{
  "runtime_mappings": {
    "day_of_week": {
      "type": "keyword",
      "script": "emit(doc['@timestamp'].value.dayOfWeekEnum.toString())"
    }
  },
  "query": """
    process where process.name == "regsvr32.exe"
  """,
  "fields": [
    "@timestamp",
    "day_of_week"
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1432.console"></div>
<p>The API returns:</p>
<a id="cc180c20e4daabbefd6cd6bf661173d1"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  ...
  "hits": {
    "total": ...,
    "events": [
      {
        "_index": ".ds-my-data-stream-2099.12.07-000001",
        "_id": "OQmfCaduce8zoHT93o4H",
        "fields": {
          "@timestamp": [
            "2099-12-07T11:07:09.000Z"
          ],
          "day_of_week": [
            "MONDAY"
          ]
        }
      },
      ....
    ]
  }
}</pre>
</div>
<h3><a id="specify-a-timestamp-or-event-category-field"></a>Specify a timestamp or event category field<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>The EQL search API uses the <code class="literal">@timestamp</code> and <code class="literal">event.category</code> fields from the
<a href="/guide/en/ecs/8.6" class="ulink" target="_top">ECS</a> by default. To specify different fields, use the
<code class="literal">timestamp_field</code> and <code class="literal">event_category_field</code> parameters:</p>
<a id="f3942d9b34138dfca79dff707af270b7"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "timestamp_field": "file.accessed",
  "event_category_field": "file.type",
  "query": """
    file where (file.size &gt; 1 and file.type == "file")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1433.console"></div>
<p>The event category field must be mapped as a <a class="xref" href="keyword.html" title="Keyword type family"><code class="literal">keyword</code></a> family field
type. The timestamp field should be mapped as a <a class="xref" href="date.html" title="Date field type"><code class="literal">date</code></a> field type.
<a class="xref" href="date_nanos.html" title="Date nanoseconds field type"><code class="literal">date_nanos</code></a> timestamp fields are not supported. You cannot use a
<a class="xref" href="nested.html" title="Nested field type"><code class="literal">nested</code></a> field or the sub-fields of a <code class="literal">nested</code> field as the timestamp
or event category field.</p>
<h3><a id="eql-search-specify-a-sort-tiebreaker"></a>Specify a sort tiebreaker<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, the EQL search API returns matching hits by timestamp. If two or
more events share the same timestamp, Elasticsearch uses a tiebreaker field value to sort
the events in ascending order. Elasticsearch orders events with no
tiebreaker value after events with a value.</p>
<p>If you don&#8217;t specify a tiebreaker field or the events also share the same
tiebreaker value, Elasticsearch considers the events concurrent and may
not return them in a consistent sort order.</p>
<p>To specify a tiebreaker field, use the <code class="literal">tiebreaker_field</code> parameter. If you use
the <a href="/guide/en/ecs/8.6" class="ulink" target="_top">ECS</a>, we recommend using <code class="literal">event.sequence</code> as the tiebreaker field.</p>
<a id="2ac37c3c572170ded67f1d5a0c8151ab"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "tiebreaker_field": "event.sequence",
  "query": """
    process where process.name == "cmd.exe" and stringContains(process.executable, "System32")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1434.console"></div>
<h3><a id="eql-search-filter-query-dsl"></a>Filter using Query DSL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>The <code class="literal">filter</code> parameter uses <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a> to limit the documents on
which an EQL query runs.</p>
<a id="8478c39c71bbb559ef6ab919f918f22b"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "filter": {
    "range": {
      "@timestamp": {
        "gte": "now-1d/d",
        "lt": "now/d"
      }
    }
  },
  "query": """
    file where (file.type == "file" and file.name == "cmd.exe")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1435.console"></div>
<h3><a id="eql-search-async"></a>Run an async EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, EQL search requests are synchronous and wait for complete results
before returning a response. However, complete results can take longer for
searches across large data sets or <a class="xref" href="data-tiers.html" title="Data tiers">frozen</a> data.</p>
<p>To avoid long waits, run an async EQL search. Set <code class="literal">wait_for_completion_timeout</code>
to a duration you&#8217;d like to wait for synchronous results.</p>
<a id="98f7525ec0bc8945eafa008a5a9c50c0"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1436.console"></div>
<p>If the request doesn&#8217;t finish within the timeout period, the search becomes async
and returns a response that includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A search ID
</li>
<li class="listitem">
An <code class="literal">is_partial</code> value of <code class="literal">true</code>, indicating the search results are
incomplete
</li>
<li class="listitem">
An <code class="literal">is_running</code> value of <code class="literal">true</code>, indicating the search is ongoing
</li>
</ul>
</div>
<p>The async search continues to run in the background without blocking other
requests.</p>
<a id="109c26a2fc0d07c401f5a94feab0fe39"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_partial": true,
  "is_running": true,
  "took": 2000,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
<p>To check the progress of an async search, use the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get
async EQL search API</a> with the search ID. Specify how long you&#8217;d like for
complete results in the <code class="literal">wait_for_completion_timeout</code> parameter.</p>
<a id="1cca4bb2f0ea7e43181be8bd965149d4"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?wait_for_completion_timeout=2s</pre>
</div>
<div class="console_widget" data-snippet="snippets/1437.console"></div>
<p>If the response&#8217;s <code class="literal">is_running</code> value is <code class="literal">false</code>, the async search has finished.
If the <code class="literal">is_partial</code> value is <code class="literal">false</code>, the returned search results are
complete.</p>
<a id="35f8ce328a42fecfb979e43fdc246516"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_partial": false,
  "is_running": false,
  "took": 2000,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
<p>Another more lightweight way to check the progress of an async search is to use
the <a class="xref" href="get-async-eql-status-api.html" title="Get async EQL status API">get async EQL status API</a> with the search ID.</p>
<a id="d37b065a94b3ff65a2a8a204fc3b097c"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/status/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=</pre>
</div>
<div class="console_widget" data-snippet="snippets/1438.console"></div>
<a id="fd2d60e9d92610cd510eae185a2a862b"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_running": false,
  "is_partial": false,
  "expiration_time_in_millis": 1611690295000,
  "completion_status": 200
}</pre>
</div>
<h3><a id="eql-search-store-async-eql-search"></a>Change the search retention period<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, the EQL search API stores async searches for five days. After this
period, any searches and their results are deleted. Use the <code class="literal">keep_alive</code>
parameter to change this retention period:</p>
<a id="f18248c181690b81d090275b072f0070"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "keep_alive": "2d",
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1439.console"></div>
<p>You can use the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get async EQL search API</a>'s
<code class="literal">keep_alive</code> parameter to later change the retention period. The new retention
period starts after the get request runs.</p>
<a id="6693f0ffa0de3229b5dedda197810e70"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?keep_alive=5d</pre>
</div>
<div class="console_widget" data-snippet="snippets/1440.console"></div>
<p>Use the <a class="xref" href="delete-async-eql-search-api.html" title="Delete async EQL search API">delete async EQL search API</a> to
manually delete an async EQL search before the <code class="literal">keep_alive</code> period ends. If the
search is still ongoing, Elasticsearch cancels the search request.</p>
<a id="c155d2670ff82b135c7dcec0fc8a3f23"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=</pre>
</div>
<div class="console_widget" data-snippet="snippets/1441.console"></div>
<h3><a id="eql-search-store-sync-eql-search"></a>Store synchronous EQL searches<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, the EQL search API only stores async searches. To save a synchronous
search, set <code class="literal">keep_on_completion</code> to <code class="literal">true</code>:</p>
<a id="cf75a880c749a2f2010a8ec3f348e5c3"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-data-stream/_eql/search
{
  "keep_on_completion": true,
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1442.console"></div>
<p>The response includes a search ID. <code class="literal">is_partial</code> and <code class="literal">is_running</code> are <code class="literal">false</code>,
indicating the EQL search was synchronous and returned complete results.</p>
<a id="d6afd0b695bfaba91e3b1bf71c1f9c9d"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FjlmbndxNmJjU0RPdExBTGg0elNOOEEaQk9xSjJBQzBRMldZa1VVQ2pPa01YUToxMDY=",
  "is_partial": false,
  "is_running": false,
  "took": 52,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
<p>Use the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get async EQL search API</a> to get the
same results later:</p>
<a id="a669e9d56e34c95ef4c780e92ed307f1"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FjlmbndxNmJjU0RPdExBTGg0elNOOEEaQk9xSjJBQzBRMldZa1VVQ2pPa01YUToxMDY=</pre>
</div>
<div class="console_widget" data-snippet="snippets/1443.console"></div>
<p>Saved synchronous searches are still subject to the <code class="literal">keep_alive</code> parameter&#8217;s
retention period. When this period ends, the search and its results are deleted.</p>
<p>You can also check only the status of the saved synchronous search without
results by using <a class="xref" href="get-async-eql-status-api.html" title="Get async EQL status API">get async EQL status API</a>.</p>
<p>You can also manually delete saved synchronous searches using the
<a class="xref" href="delete-async-eql-search-api.html" title="Delete async EQL search API">delete async EQL search API</a>.</p>
<h3><a id="run-eql-search-across-clusters"></a>Run an EQL search across clusters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>The EQL search API supports <a class="xref" href="modules-cross-cluster-search.html" title="Search across clusters">cross-cluster search</a>.
However, the local and <a class="xref" href="remote-clusters.html" title="Remote clusters">remote clusters</a>
must use the same Elasticsearch version
if they have versions prior to 7.17.7 (included) or prior to 8.5.1 (included).</p>
<p>The following <a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">cluster update settings</a> request
adds two remote clusters: <code class="literal">cluster_one</code> and <code class="literal">cluster_two</code>.</p>
<a id="f1bf3edbd9e6c7e01b00c74c99a58b61"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "cluster_one": {
          "seeds": [
            "127.0.0.1:9300"
          ]
        },
        "cluster_two": {
          "seeds": [
            "127.0.0.1:9301"
          ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1444.console"></div>
<p>To target a data stream or index on a remote cluster, use the
<code class="literal">&lt;cluster&gt;:&lt;target&gt;</code> syntax.</p>
<a id="5bb0d84185df2f276f01bb2fba709e1a"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /cluster_one:my-data-stream,cluster_two:my-data-stream/_eql/search
{
  "query": """
    process where process.name == "regsvr32.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1445.console"></div>
<h3><a id="eql-circuit-breaker"></a>EQL circuit breaker settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>The relevant circuit breaker settings can be found in the <a class="xref" href="circuit-breaker.html#circuit-breakers-page-eql" title="EQL circuit breaker">Circuit Breakers page</a>.</p>
</div>
</div>




</div>
<div class="navfooter">
<span class="prev">
<a href="search-aggregations-pipeline-sum-bucket-aggregation.html">« Sum bucket aggregation</a>
</span>
<span class="next">
<a href="eql-syntax.html">EQL syntax reference »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"csharp":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
