<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>ES|QL commands | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="ES|QL commands | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="esql-language.html" title="ES|QL reference"/>
<link rel="prev" href="esql-syntax.html" title="ES|QL syntax reference"/>
<link rel="next" href="esql-functions-operators.html" title="ES|QL functions and operators"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="esql-syntax.html">« ES|QL syntax reference</a>
</span>
<span class="next">
<a href="esql-functions-operators.html">ES|QL functions and operators »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql.html">ES|QL</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql-language.html">ES|QL reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>ES|QL commands</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-commands.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="esql-commands"></a>ES|QL commands<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-commands.asciidoc">edit</a></h2>
</div></div></div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="esql-source-commands"></a>Source commands<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-commands.asciidoc">edit</a></h3>
</div></div></div>
<p>An ES|QL source command produces a table, typically with data from Elasticsearch. An ES|QL query must start with a source command.</p>
<div class="imageblock text-center">
<div class="content">
<img src="images/esql/source-command.svg" alt="A source command producing a table from Elasticsearch">
</div>
</div>
<p>ES|QL supports these source commands:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-from" title="FROM"><code class="literal">FROM</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-row" title="ROW"><code class="literal">ROW</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-show" title="SHOW"><code class="literal">SHOW</code></a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="esql-processing-commands"></a>Processing commands<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-commands.asciidoc">edit</a></h3>
</div></div></div>
<p>ES|QL processing commands change an input table by adding, removing, or changing
rows and columns.</p>
<div class="imageblock text-center">
<div class="content">
<img src="images/esql/processing-command.svg" alt="A processing command changing an input table">
</div>
</div>
<p>ES|QL supports these processing commands:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-dissect" title="DISSECT"><code class="literal">DISSECT</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-drop" title="DROP"><code class="literal">DROP</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-enrich" title="ENRICH"><code class="literal">ENRICH</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-eval" title="EVAL"><code class="literal">EVAL</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-grok" title="GROK"><code class="literal">GROK</code></a>
</li>
<li class="listitem">
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> <a class="xref" href="esql-commands.html#esql-inlinestats-by" title="INLINESTATS ... BY"><code class="literal">INLINESTATS ... BY</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-keep" title="KEEP"><code class="literal">KEEP</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-limit" title="LIMIT"><code class="literal">LIMIT</code></a>
</li>
<li class="listitem">
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> <a class="xref" href="esql-commands.html#esql-lookup" title="LOOKUP"><code class="literal">LOOKUP</code></a>
</li>
<li class="listitem">
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> <a class="xref" href="esql-commands.html#esql-mv_expand" title="MV_EXPAND"><code class="literal">MV_EXPAND</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-rename" title="RENAME"><code class="literal">RENAME</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-sort" title="SORT"><code class="literal">SORT</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-stats-by" title="STATS ... BY"><code class="literal">STATS ... BY</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-commands.html#esql-where" title="WHERE"><code class="literal">WHERE</code></a>
</li>
</ul>
</div>
<h3><a id="esql-from"></a><code class="literal">FROM</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/source-commands/from.asciidoc">edit</a></h3>
<p>The <code class="literal">FROM</code> source command returns a table with data from a data stream, index,
or alias.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM index_pattern [METADATA fields]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index_pattern</code>
</span>
</dt>
<dd>
A list of indices, data streams or aliases. Supports wildcards and date math.
</dd>
<dt>
<span class="term">
<code class="literal">fields</code>
</span>
</dt>
<dd>
A comma-separated list of <a class="xref" href="esql-metadata-fields.html" title="ES|QL metadata fields">metadata fields</a> to retrieve.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p>The <code class="literal">FROM</code> source command returns a table with data from a data stream, index,
or alias. Each row in the resulting table represents a document. Each column
corresponds to a field, and can be accessed by the name of that field.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>By default, an ES|QL query without an explicit <a class="xref" href="esql-commands.html#esql-limit" title="LIMIT"><code class="literal">LIMIT</code></a> uses an implicit
limit of 1000. This applies to <code class="literal">FROM</code> too. A <code class="literal">FROM</code> command without <code class="literal">LIMIT</code>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees</pre>
</div>
<p>is executed as:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| LIMIT 1000</pre>
</div>
</div>
</div>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees</pre>
</div>
<p>You can use <a class="xref" href="api-conventions.html#api-date-math-index-names" title="Date math support in index and index alias names">date math</a> to refer to indices, aliases
and data streams. This can be useful for time series data, for example to access
today&#8217;s index:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM &lt;logs-{now/d}&gt;</pre>
</div>
<p>Use comma-separated lists or wildcards to <a class="xref" href="esql-multi-index.html" title="Using ES|QL to query multiple indices">query multiple data streams, indices,
or aliases</a>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees-00001,other-employees-*</pre>
</div>
<p>Use the format <code class="literal">&lt;remote_cluster_name&gt;:&lt;target&gt;</code> to <a class="xref" href="esql-cross-clusters.html" title="Using ES|QL across clusters">query data streams and indices
on remote clusters</a>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM cluster_one:employees-00001,cluster_two:other-employees-*</pre>
</div>
<p>Use the optional <code class="literal">METADATA</code> directive to enable <a class="xref" href="esql-metadata-fields.html" title="ES|QL metadata fields">metadata fields</a>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees METADATA _id</pre>
</div>
<p>Use enclosing double quotes (<code class="literal">"</code>) or three enclosing double quotes (<code class="literal">"""</code>) to escape index names
that contain special characters:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM "this=that", """this[that"""</pre>
</div>
<h3><a id="esql-row"></a><code class="literal">ROW</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/source-commands/row.asciidoc">edit</a></h3>
<p>The <code class="literal">ROW</code> source command produces a row with one or more columns with values
that you specify. This can be useful for testing.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">ROW column1 = value1[, ..., columnN = valueN]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">columnX</code>
</span>
</dt>
<dd>
The column name.
In case of duplicate column names, only the rightmost duplicate creates a column.
</dd>
<dt>
<span class="term">
<code class="literal">valueX</code>
</span>
</dt>
<dd>
The value for the column. Can be a literal, an expression, or a
<a class="xref" href="esql-functions-operators.html#esql-functions" title="Functions overview">function</a>.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = 1, b = "two", c = null</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">b:keyword</th>
<th align="left" valign="top">c:null</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>"two"</p></td>
<td align="left" valign="top"><p>null</p></td>
</tr>
</tbody>
</table>
</div>
<p>Use square brackets to create multi-value columns:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">ROW a = [2, 1]</pre>
</div>
<p><code class="literal">ROW</code> supports the use of <a class="xref" href="esql-functions-operators.html#esql-functions" title="Functions overview">functions</a>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">ROW a = ROUND(1.23, 0)</pre>
</div>
<h3><a id="esql-show"></a><code class="literal">SHOW</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/source-commands/show.asciidoc">edit</a></h3>
<p>The <code class="literal">SHOW</code> source command returns information about the deployment and
its capabilities.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">SHOW item</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">item</code>
</span>
</dt>
<dd>
Can only be <code class="literal">INFO</code>.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<p>Use <code class="literal">SHOW INFO</code> to return the deployment&#8217;s version, build date and hash.</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">SHOW INFO</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">version</th>
<th align="left" valign="top">date</th>
<th align="left" valign="top">hash</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>8.13.0</p></td>
<td align="left" valign="top"><p>2024-02-23T10:04:18.123117961Z</p></td>
<td align="left" valign="top"><p>04ba8c8db2507501c88f215e475de7b0798cb3b3</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-dissect"></a><code class="literal">DISSECT</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/dissect.asciidoc">edit</a></h3>
<p><code class="literal">DISSECT</code> enables you to <a class="xref" href="esql-process-data-with-dissect-and-grok.html" title="Data processing with DISSECT and GROK">extract
structured data out of a string</a>.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">DISSECT input "pattern" [APPEND_SEPARATOR="&lt;separator&gt;"]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">input</code>
</span>
</dt>
<dd>
The column that contains the string you want to structure.  If the column has
multiple values, <code class="literal">DISSECT</code> will process each value.
</dd>
<dt>
<span class="term">
<code class="literal">pattern</code>
</span>
</dt>
<dd>
A <a class="xref" href="esql-process-data-with-dissect-and-grok.html#esql-dissect-patterns" title="Dissect patterns">dissect pattern</a>.
If a field name conflicts with an existing column, the existing column is dropped.
If a field name is used more than once, only the rightmost duplicate creates a column.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;separator&gt;</code>
</span>
</dt>
<dd>
A string used as the separator between appended values, when using the <a class="xref" href="esql-process-data-with-dissect-and-grok.html#esql-append-modifier" title="Append modifier (+)">append modifier</a>.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p><code class="literal">DISSECT</code> enables you to <a class="xref" href="esql-process-data-with-dissect-and-grok.html" title="Data processing with DISSECT and GROK">extract
structured data out of a string</a>. <code class="literal">DISSECT</code> matches the string against a
delimiter-based pattern, and extracts the specified keys as columns.</p>
<p>Refer to <a class="xref" href="esql-process-data-with-dissect-and-grok.html#esql-process-data-with-dissect" title="Process data with DISSECT">Process data with <code class="literal">DISSECT</code></a> for the syntax of dissect patterns.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<p>The following example parses a string that contains a timestamp, some text, and
an IP address:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = "2023-01-23T12:15:00.000Z - some text - 127.0.0.1"
| DISSECT a "%{date} - %{msg} - %{ip}"
| KEEP date, msg, ip</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">date:keyword</th>
<th align="left" valign="top">msg:keyword</th>
<th align="left" valign="top">ip:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>2023-01-23T12:15:00.000Z</p></td>
<td align="left" valign="top"><p>some text</p></td>
<td align="left" valign="top"><p>127.0.0.1</p></td>
</tr>
</tbody>
</table>
</div>
<p>By default, <code class="literal">DISSECT</code> outputs keyword string columns. To convert to another
type, use <a class="xref" href="esql-functions-operators.html#esql-type-conversion-functions" title="ES|QL type conversion functions">Type conversion functions</a>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = "2023-01-23T12:15:00.000Z - some text - 127.0.0.1"
| DISSECT a "%{date} - %{msg} - %{ip}"
| KEEP date, msg, ip
| EVAL date = TO_DATETIME(date)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">msg:keyword</th>
<th align="left" valign="top">ip:keyword</th>
<th align="left" valign="top">date:date</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>some text</p></td>
<td align="left" valign="top"><p>127.0.0.1</p></td>
<td align="left" valign="top"><p>2023-01-23T12:15:00.000Z</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-drop"></a><code class="literal">DROP</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/drop.asciidoc">edit</a></h3>
<p>The <code class="literal">DROP</code> processing command removes one or more columns.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">DROP columns</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">columns</code>
</span>
</dt>
<dd>
A comma-separated list of columns to remove. Supports wildcards.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| DROP height</pre>
</div>
<p>Rather than specify each column by name, you can use wildcards to drop all
columns with a name that matches a pattern:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| DROP height*</pre>
</div>
<h3><a id="esql-enrich"></a><code class="literal">ENRICH</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/enrich.asciidoc">edit</a></h3>
<p><code class="literal">ENRICH</code> enables you to add data from existing indices as new columns using an
enrich policy.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">ENRICH policy [ON match_field] [WITH [new_name1 = ]field1, [new_name2 = ]field2, ...]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">policy</code>
</span>
</dt>
<dd>
The name of the enrich policy. You need to <a class="xref" href="esql-enrich-data.html#esql-set-up-enrich-policy" title="Set up an enrich policy">create</a>
and <a class="xref" href="esql-enrich-data.html#esql-execute-enrich-policy" title="Execute the enrich policy">execute</a> the enrich policy first.
</dd>
<dt>
<span class="term">
<code class="literal">mode</code>
</span>
</dt>
<dd>
The mode of the enrich command in cross cluster ES|QL.
See <a class="xref" href="esql-cross-clusters.html#ccq-enrich" title="Enrich across clusters">enrich across clusters</a>.
</dd>
<dt>
<span class="term">
<code class="literal">match_field</code>
</span>
</dt>
<dd>
The match field. <code class="literal">ENRICH</code> uses its value to look for records in the enrich
index. If not specified, the match will be performed on the column with the same
name as the <code class="literal">match_field</code> defined in the <a class="xref" href="esql-enrich-data.html#esql-enrich-policy">enrich policy</a>.
</dd>
<dt>
<span class="term">
<code class="literal">fieldX</code>
</span>
</dt>
<dd>
The enrich fields from the enrich index that are added to the result as new
columns. If a column with the same name as the enrich field already exists, the
existing column will be replaced by the new column. If not specified, each of
the enrich fields defined in the policy is added.
A column with the same name as the enrich field will be dropped unless the
enrich field is renamed.
</dd>
<dt>
<span class="term">
<code class="literal">new_nameX</code>
</span>
</dt>
<dd>
Enables you to change the name of the column that&#8217;s added for each of the enrich
fields. Defaults to the enrich field name.
If a column has the same name as the new name, it will be discarded.
If a name (new or original) occurs more than once, only the rightmost duplicate
creates a new column.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p><code class="literal">ENRICH</code> enables you to add data from existing indices as new columns using an
enrich policy. Refer to <a class="xref" href="esql-enrich-data.html" title="Data enrichment">Data enrichment</a> for information about setting up a
policy.</p>
<div class="imageblock text-center">
<div class="content">
<img src="images/esql/esql-enrich.png" alt="esql enrich">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Before you can use <code class="literal">ENRICH</code>, you need to <a class="xref" href="esql-enrich-data.html#esql-set-up-enrich-policy" title="Set up an enrich policy">create
and execute an enrich policy</a>.</p>
</div>
</div>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<p>The following example uses the <code class="literal">languages_policy</code> enrich policy to add a new
column for each enrich field defined in the policy. The match is performed using
the <code class="literal">match_field</code> defined in the <a class="xref" href="esql-enrich-data.html#esql-enrich-policy">enrich policy</a> and
requires that the input table has a column with the same name (<code class="literal">language_code</code>
in this example). <code class="literal">ENRICH</code> will look for records in the
<a class="xref" href="esql-enrich-data.html#esql-enrich-index">enrich index</a> based on the match field value.</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW language_code = "1"
| ENRICH languages_policy</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">language_code:keyword</th>
<th align="left" valign="top">language_name:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>English</p></td>
</tr>
</tbody>
</table>
</div>
<p>To use a column with a different name than the <code class="literal">match_field</code> defined in the
policy as the match field, use <code class="literal">ON &lt;column-name&gt;</code>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = "1"
| ENRICH languages_policy ON a</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">language_name:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>English</p></td>
</tr>
</tbody>
</table>
</div>
<p>By default, each of the enrich fields defined in the policy is added as a
column. To explicitly select the enrich fields that are added, use
<code class="literal">WITH &lt;field1&gt;, &lt;field2&gt;, ...</code>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = "1"
| ENRICH languages_policy ON a WITH language_name</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">language_name:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>English</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can rename the columns that are added using <code class="literal">WITH new_name=&lt;field1&gt;</code>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = "1"
| ENRICH languages_policy ON a WITH name = language_name</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">name:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>English</p></td>
</tr>
</tbody>
</table>
</div>
<p>In case of name collisions, the newly created columns will override existing
columns.</p>
<h3><a id="esql-eval"></a><code class="literal">EVAL</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/eval.asciidoc">edit</a></h3>
<p>The <code class="literal">EVAL</code> processing command enables you to append new columns with calculated
values.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">EVAL [column1 =] value1[, ..., [columnN =] valueN]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">columnX</code>
</span>
</dt>
<dd>
The column name.
If a column with the same name already exists, the existing column is dropped.
If a column name is used more than once, only the rightmost duplicate creates a column.
</dd>
<dt>
<span class="term">
<code class="literal">valueX</code>
</span>
</dt>
<dd>
The value for the column. Can be a literal, an expression, or a
<a class="xref" href="esql-functions-operators.html#esql-functions" title="Functions overview">function</a>. Can use columns defined left of this one.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p>The <code class="literal">EVAL</code> processing command enables you to append new columns with calculated
values. <code class="literal">EVAL</code> supports various functions for calculating values. Refer to
<a class="xref" href="esql-functions-operators.html#esql-functions" title="Functions overview">Functions</a> for more information.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| SORT emp_no
| KEEP first_name, last_name, height
| EVAL height_feet = height * 3.281, height_cm = height * 100</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
<col class="col_5"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">last_name:keyword</th>
<th align="left" valign="top">height:double</th>
<th align="left" valign="top">height_feet:double</th>
<th align="left" valign="top">height_cm:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Georgi</p></td>
<td align="left" valign="top"><p>Facello</p></td>
<td align="left" valign="top"><p>2.03</p></td>
<td align="left" valign="top"><p>6.66043</p></td>
<td align="left" valign="top"><p>202.99999999999997</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Bezalel</p></td>
<td align="left" valign="top"><p>Simmel</p></td>
<td align="left" valign="top"><p>2.08</p></td>
<td align="left" valign="top"><p>6.82448</p></td>
<td align="left" valign="top"><p>208.0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Parto</p></td>
<td align="left" valign="top"><p>Bamford</p></td>
<td align="left" valign="top"><p>1.83</p></td>
<td align="left" valign="top"><p>6.004230000000001</p></td>
<td align="left" valign="top"><p>183.0</p></td>
</tr>
</tbody>
</table>
</div>
<p>If the specified column already exists, the existing column will be dropped, and
the new column will be appended to the table:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| SORT emp_no
| KEEP first_name, last_name, height
| EVAL height = height * 3.281</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">last_name:keyword</th>
<th align="left" valign="top">height:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Georgi</p></td>
<td align="left" valign="top"><p>Facello</p></td>
<td align="left" valign="top"><p>6.66043</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Bezalel</p></td>
<td align="left" valign="top"><p>Simmel</p></td>
<td align="left" valign="top"><p>6.82448</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Parto</p></td>
<td align="left" valign="top"><p>Bamford</p></td>
<td align="left" valign="top"><p>6.004230000000001</p></td>
</tr>
</tbody>
</table>
</div>
<p>Specifying the output column name is optional. If not specified, the new column
name is equal to the expression. The following query adds a column named
<code class="literal">height*3.281</code>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| SORT emp_no
| KEEP first_name, last_name, height
| EVAL height * 3.281</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">last_name:keyword</th>
<th align="left" valign="top">height:double</th>
<th align="left" valign="top">height * 3.281:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Georgi</p></td>
<td align="left" valign="top"><p>Facello</p></td>
<td align="left" valign="top"><p>2.03</p></td>
<td align="left" valign="top"><p>6.66043</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Bezalel</p></td>
<td align="left" valign="top"><p>Simmel</p></td>
<td align="left" valign="top"><p>2.08</p></td>
<td align="left" valign="top"><p>6.82448</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Parto</p></td>
<td align="left" valign="top"><p>Bamford</p></td>
<td align="left" valign="top"><p>1.83</p></td>
<td align="left" valign="top"><p>6.004230000000001</p></td>
</tr>
</tbody>
</table>
</div>
<p>Because this name contains special characters, <a class="xref" href="esql-syntax.html#esql-identifiers" title="Identifiers">it needs to be
quoted</a> with backticks (<code class="literal">`</code>) when using it in subsequent commands:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| EVAL height * 3.281
| STATS avg_height_feet = AVG(`height * 3.281`)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">avg_height_feet:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>5.801464200000001</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-grok"></a><code class="literal">GROK</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/grok.asciidoc">edit</a></h3>
<p><code class="literal">GROK</code> enables you to <a class="xref" href="esql-process-data-with-dissect-and-grok.html" title="Data processing with DISSECT and GROK">extract
structured data out of a string</a>.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">GROK input "pattern"</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">input</code>
</span>
</dt>
<dd>
The column that contains the string you want to structure. If the column has
multiple values, <code class="literal">GROK</code> will process each value.
</dd>
<dt>
<span class="term">
<code class="literal">pattern</code>
</span>
</dt>
<dd>
A grok pattern.
If a field name conflicts with an existing column, the existing column is discarded.
If a field name is used more than once, a multi-valued column will be created with one value
per each occurrence of the field name.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p><code class="literal">GROK</code> enables you to <a class="xref" href="esql-process-data-with-dissect-and-grok.html" title="Data processing with DISSECT and GROK">extract
structured data out of a string</a>. <code class="literal">GROK</code> matches the string against patterns,
based on regular expressions, and extracts the specified patterns as columns.</p>
<p>Refer to <a class="xref" href="esql-process-data-with-dissect-and-grok.html#esql-process-data-with-grok" title="Process data with GROK">Process data with <code class="literal">GROK</code></a> for the syntax of grok patterns.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<p>The following example parses a string that contains a timestamp, an IP address,
an email address, and a number:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = "2023-01-23T12:15:00.000Z 127.0.0.1 some.email@foo.com 42"
| GROK a "%{TIMESTAMP_ISO8601:date} %{IP:ip} %{EMAILADDRESS:email} %{NUMBER:num}"
| KEEP date, ip, email, num</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">date:keyword</th>
<th align="left" valign="top">ip:keyword</th>
<th align="left" valign="top">email:keyword</th>
<th align="left" valign="top">num:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>2023-01-23T12:15:00.000Z</p></td>
<td align="left" valign="top"><p>127.0.0.1</p></td>
<td align="left" valign="top"><p><a href="mailto:some.email@foo.com" class="ulink" target="_top">some.email@foo.com</a></p></td>
<td align="left" valign="top"><p>42</p></td>
</tr>
</tbody>
</table>
</div>
<p>By default, <code class="literal">GROK</code> outputs keyword string columns. <code class="literal">int</code> and <code class="literal">float</code> types can
be converted by appending <code class="literal">:type</code> to the semantics in the pattern. For example
<code class="literal">{NUMBER:num:int}</code>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = "2023-01-23T12:15:00.000Z 127.0.0.1 some.email@foo.com 42"
| GROK a "%{TIMESTAMP_ISO8601:date} %{IP:ip} %{EMAILADDRESS:email} %{NUMBER:num:int}"
| KEEP date, ip, email, num</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">date:keyword</th>
<th align="left" valign="top">ip:keyword</th>
<th align="left" valign="top">email:keyword</th>
<th align="left" valign="top">num:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>2023-01-23T12:15:00.000Z</p></td>
<td align="left" valign="top"><p>127.0.0.1</p></td>
<td align="left" valign="top"><p><a href="mailto:some.email@foo.com" class="ulink" target="_top">some.email@foo.com</a></p></td>
<td align="left" valign="top"><p>42</p></td>
</tr>
</tbody>
</table>
</div>
<p>For other type conversions, use <a class="xref" href="esql-functions-operators.html#esql-type-conversion-functions" title="ES|QL type conversion functions">Type conversion functions</a>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = "2023-01-23T12:15:00.000Z 127.0.0.1 some.email@foo.com 42"
| GROK a "%{TIMESTAMP_ISO8601:date} %{IP:ip} %{EMAILADDRESS:email} %{NUMBER:num:int}"
| KEEP date, ip, email, num
| EVAL date = TO_DATETIME(date)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">ip:keyword</th>
<th align="left" valign="top">email:keyword</th>
<th align="left" valign="top">num:integer</th>
<th align="left" valign="top">date:date</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>127.0.0.1</p></td>
<td align="left" valign="top"><p><a href="mailto:some.email@foo.com" class="ulink" target="_top">some.email@foo.com</a></p></td>
<td align="left" valign="top"><p>42</p></td>
<td align="left" valign="top"><p>2023-01-23T12:15:00.000Z</p></td>
</tr>
</tbody>
</table>
</div>
<p>If a field name is used more than once, <code class="literal">GROK</code> creates a multi-valued
column:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM addresses
| KEEP city.name, zip_code
| GROK zip_code "%{WORD:zip_parts} %{WORD:zip_parts}"</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">city.name:keyword</th>
<th align="left" valign="top">zip_code:keyword</th>
<th align="left" valign="top">zip_parts:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Amsterdam</p></td>
<td align="left" valign="top"><p>1016 ED</p></td>
<td align="left" valign="top"><p>["1016", "ED"]</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>San Francisco</p></td>
<td align="left" valign="top"><p>CA 94108</p></td>
<td align="left" valign="top"><p>["CA", "94108"]</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Tokyo</p></td>
<td align="left" valign="top"><p>100-7014</p></td>
<td align="left" valign="top"><p>null</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-inlinestats-by"></a><code class="literal">INLINESTATS ... BY</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/inlinestats.asciidoc">edit</a></h3>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>INLINESTATS is highly experimental and only available in SNAPSHOT versions.</p>
</div>
</div>
<p>The <code class="literal">INLINESTATS</code> command calculates an aggregate result and adds new columns
with the result to the stream of input data.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">INLINESTATS [column1 =] expression1[, ..., [columnN =] expressionN]
[BY grouping_expression1[, ..., grouping_expressionN]]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">columnX</code>
</span>
</dt>
<dd>
The name by which the aggregated value is returned. If omitted, the name is
equal to the corresponding expression (<code class="literal">expressionX</code>). If multiple columns
have the same name, all but the rightmost column with this name will be ignored.
</dd>
<dt>
<span class="term">
<code class="literal">expressionX</code>
</span>
</dt>
<dd>
An expression that computes an aggregated value. If its name coincides with one
of the computed columns, that column will be ignored.
</dd>
<dt>
<span class="term">
<code class="literal">grouping_expressionX</code>
</span>
</dt>
<dd>
An expression that outputs the values to group by.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Individual <code class="literal">null</code> values are skipped when computing aggregations.</p>
</div>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p>The <code class="literal">INLINESTATS</code> command calculates an aggregate result and merges that result
back into the stream of input data. Without the optional <code class="literal">BY</code> clause this will
produce a single result which is appended to each row. With a <code class="literal">BY</code> clause this
will produce one result per grouping and merge the result into the stream based on
matching group keys.</p>
<p>All of the <a class="xref" href="esql-functions-operators.html#esql-agg-functions" title="ES|QL aggregate functions">aggregation functions</a> are supported.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<p>Find the employees that speak the most languages (it&#8217;s a tie!):</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| KEEP emp_no, languages
| INLINESTATS max_lang = MAX(languages)
| WHERE max_lang == languages
| SORT emp_no ASC
| LIMIT 5</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">emp_no:integer</th>
<th align="left" valign="top">languages:integer</th>
<th align="left" valign="top">max_lang:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>10002</p></td>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10004</p></td>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10011</p></td>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10012</p></td>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10014</p></td>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
</tbody>
</table>
</div>
<p>Find the longest tenured employee who&#8217;s last name starts with each letter of the alphabet:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| EVAL l = SUBSTRING(last_name, 0, 1)
| KEEP emp_no, avg_worked_seconds, l
| INLINESTATS max_avg_worked_seconds = MAX(avg_worked_seconds) BY l
| WHERE max_avg_worked_seconds == avg_worked_seconds
| SORT l ASC
| LIMIT 5</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">emp_no:integer</th>
<th align="left" valign="top">avg_worked_seconds:long</th>
<th align="left" valign="top">l:keyword</th>
<th align="left" valign="top">max_avg_worked_seconds:long</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>10065</p></td>
<td align="left" valign="top"><p>372660279</p></td>
<td align="left" valign="top"><p>A</p></td>
<td align="left" valign="top"><p>372660279</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10074</p></td>
<td align="left" valign="top"><p>382397583</p></td>
<td align="left" valign="top"><p>B</p></td>
<td align="left" valign="top"><p>382397583</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10044</p></td>
<td align="left" valign="top"><p>387408356</p></td>
<td align="left" valign="top"><p>C</p></td>
<td align="left" valign="top"><p>387408356</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10030</p></td>
<td align="left" valign="top"><p>394597613</p></td>
<td align="left" valign="top"><p>D</p></td>
<td align="left" valign="top"><p>394597613</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10087</p></td>
<td align="left" valign="top"><p>305782871</p></td>
<td align="left" valign="top"><p>E</p></td>
<td align="left" valign="top"><p>305782871</p></td>
</tr>
</tbody>
</table>
</div>
<p>Find the northern and southern most airports:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM airports
| MV_EXPAND type
| EVAL lat = ST_Y(location)
| INLINESTATS most_northern=MAX(lat), most_southern=MIN(lat) BY type
| WHERE lat == most_northern OR lat == most_southern
| SORT lat DESC
| KEEP type, name, location</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">type:keyword</th>
<th align="left" valign="top">name:text</th>
<th align="left" valign="top">location:geo_point</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>mid</p></td>
<td align="left" valign="top"><p>Svalbard Longyear</p></td>
<td align="left" valign="top"><p>POINT (15.495229 78.246717)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>major</p></td>
<td align="left" valign="top"><p>Tromsø Langnes</p></td>
<td align="left" valign="top"><p>POINT (18.9072624292132 69.6796790473478)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>military</p></td>
<td align="left" valign="top"><p>Severomorsk-3 (Murmansk N.E.)</p></td>
<td align="left" valign="top"><p>POINT (33.2903527616285 69.0168711826804)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>spaceport</p></td>
<td align="left" valign="top"><p>Baikonur Cosmodrome</p></td>
<td align="left" valign="top"><p>POINT (63.307354423875 45.9635739403124)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>small</p></td>
<td align="left" valign="top"><p>Dhamial</p></td>
<td align="left" valign="top"><p>POINT (73.0320498392002 33.5614146278861)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>small</p></td>
<td align="left" valign="top"><p>Sahnewal</p></td>
<td align="left" valign="top"><p>POINT (75.9570722403652 30.8503598561702)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>spaceport</p></td>
<td align="left" valign="top"><p>Centre Spatial Guyanais</p></td>
<td align="left" valign="top"><p>POINT (-52.7684296893452 5.23941001258035)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>military</p></td>
<td align="left" valign="top"><p>Santos Air Force Base</p></td>
<td align="left" valign="top"><p>POINT (-46.3052704931003 -23.9237590410637)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>major</p></td>
<td align="left" valign="top"><p>Christchurch Int&#8217;l</p></td>
<td align="left" valign="top"><p>POINT (172.538675565223 -43.4885486784104)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>mid</p></td>
<td align="left" valign="top"><p>Hermes Quijada Int&#8217;l</p></td>
<td align="left" valign="top"><p>POINT (-67.7530268462675 -53.7814746058316)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Our test data doesn&#8217;t have many "small" airports.</p>
</div>
</div>
<p>If a <code class="literal">BY</code> field is multivalued then <code class="literal">INLINESTATS</code> will put the row in <span class="strong strong"><strong>each</strong></span>
bucket like <a class="xref" href="esql-commands.html#esql-stats-by" title="STATS ... BY"><code class="literal">STATS ... BY</code></a>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM airports
| INLINESTATS min_scalerank=MIN(scalerank) BY type
| EVAL type=MV_SORT(type), min_scalerank=MV_SORT(min_scalerank)
| KEEP abbrev, type, scalerank, min_scalerank
| WHERE abbrev == "GWL"</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">abbrev:keyword</th>
<th align="left" valign="top">type:keyword</th>
<th align="left" valign="top">scalerank:integer</th>
<th align="left" valign="top">min_scalerank:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>GWL</p></td>
<td align="left" valign="top"><p>[mid, military]</p></td>
<td align="left" valign="top"><p>9</p></td>
<td align="left" valign="top"><p>[2, 4]</p></td>
</tr>
</tbody>
</table>
</div>
<p>To treat each group key as its own row use <a class="xref" href="esql-commands.html#esql-mv_expand" title="MV_EXPAND"><code class="literal">MV_EXPAND</code></a> before <code class="literal">INLINESTATS</code>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM airports
| KEEP abbrev, type, scalerank
| MV_EXPAND type
| INLINESTATS min_scalerank=MIN(scalerank) BY type
| SORT min_scalerank ASC
| WHERE abbrev == "GWL"</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">abbrev:keyword</th>
<th align="left" valign="top">type:keyword</th>
<th align="left" valign="top">scalerank:integer</th>
<th align="left" valign="top">min_scalerank:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>GWL</p></td>
<td align="left" valign="top"><p>mid</p></td>
<td align="left" valign="top"><p>9</p></td>
<td align="left" valign="top"><p>2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>GWL</p></td>
<td align="left" valign="top"><p>military</p></td>
<td align="left" valign="top"><p>9</p></td>
<td align="left" valign="top"><p>4</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-keep"></a><code class="literal">KEEP</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/keep.asciidoc">edit</a></h3>
<p>The <code class="literal">KEEP</code> processing command enables you to specify what columns are returned
and the order in which they are returned.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">KEEP columns</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">columns</code>
</span>
</dt>
<dd>
A comma-separated list of columns to keep. Supports wildcards.
See below for the behavior in case an existing column matches multiple
given wildcards or column names.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p>The <code class="literal">KEEP</code> processing command enables you to specify what columns are returned
and the order in which they are returned.</p>
<p>Precedence rules are applied when a field name matches multiple expressions.
Fields are added in the order they appear. If one field matches multiple expressions, the following precedence rules apply (from highest to lowest priority):</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Complete field name (no wildcards)
</li>
<li class="listitem">
Partial wildcard expressions (for example: <code class="literal">fieldNam*</code>)
</li>
<li class="listitem">
Wildcard only (<code class="literal">*</code>)
</li>
</ol>
</div>
<p>If a field matches two expressions with the same precedence, the rightmost expression wins.</p>
<p>Refer to the examples for illustrations of these precedence rules.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<p>The columns are returned in the specified order:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| KEEP emp_no, first_name, last_name, height</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">emp_no:integer</th>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">last_name:keyword</th>
<th align="left" valign="top">height:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>10001</p></td>
<td align="left" valign="top"><p>Georgi</p></td>
<td align="left" valign="top"><p>Facello</p></td>
<td align="left" valign="top"><p>2.03</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10002</p></td>
<td align="left" valign="top"><p>Bezalel</p></td>
<td align="left" valign="top"><p>Simmel</p></td>
<td align="left" valign="top"><p>2.08</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10003</p></td>
<td align="left" valign="top"><p>Parto</p></td>
<td align="left" valign="top"><p>Bamford</p></td>
<td align="left" valign="top"><p>1.83</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10004</p></td>
<td align="left" valign="top"><p>Chirstian</p></td>
<td align="left" valign="top"><p>Koblick</p></td>
<td align="left" valign="top"><p>1.78</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10005</p></td>
<td align="left" valign="top"><p>Kyoichi</p></td>
<td align="left" valign="top"><p>Maliniak</p></td>
<td align="left" valign="top"><p>2.05</p></td>
</tr>
</tbody>
</table>
</div>
<p>Rather than specify each column by name, you can use wildcards to return all
columns with a name that matches a pattern:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP h*</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
<col class="col_5"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">height:double</th>
<th align="left" valign="top">height.float:double</th>
<th align="left" valign="top">height.half_float:double</th>
<th align="left" valign="top">height.scaled_float:double</th>
<th align="left" valign="top">hire_date:date</th>
</tr>
</thead>
</table>
</div>
<p>The asterisk wildcard (<code class="literal">*</code>) by itself translates to all columns that do not
match the other arguments.</p>
<p>This query will first return all columns with a name
that starts with <code class="literal">h</code>, followed by all other columns:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP h*, *</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
<col class="col_5"/>
<col class="col_6"/>
<col class="col_7"/>
<col class="col_8"/>
<col class="col_9"/>
<col class="col_10"/>
<col class="col_11"/>
<col class="col_12"/>
<col class="col_13"/>
<col class="col_14"/>
<col class="col_15"/>
<col class="col_16"/>
<col class="col_17"/>
<col class="col_18"/>
<col class="col_19"/>
<col class="col_20"/>
<col class="col_21"/>
<col class="col_22"/>
<col class="col_23"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">height:double</th>
<th align="left" valign="top">height.float:double</th>
<th align="left" valign="top">height.half_float:double</th>
<th align="left" valign="top">height.scaled_float:double</th>
<th align="left" valign="top">hire_date:date</th>
<th align="left" valign="top">avg_worked_seconds:long</th>
<th align="left" valign="top">birth_date:date</th>
<th align="left" valign="top">emp_no:integer</th>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">gender:keyword</th>
<th align="left" valign="top">is_rehired:boolean</th>
<th align="left" valign="top">job_positions:keyword</th>
<th align="left" valign="top">languages:integer</th>
<th align="left" valign="top">languages.byte:integer</th>
<th align="left" valign="top">languages.long:long</th>
<th align="left" valign="top">languages.short:integer</th>
<th align="left" valign="top">last_name:keyword</th>
<th align="left" valign="top">salary:integer</th>
<th align="left" valign="top">salary_change:double</th>
<th align="left" valign="top">salary_change.int:integer</th>
<th align="left" valign="top">salary_change.keyword:keyword</th>
<th align="left" valign="top">salary_change.long:long</th>
<th align="left" valign="top">still_hired:boolean</th>
</tr>
</thead>
</table>
</div>
<p>The following examples show how precedence rules work when a field name matches multiple expressions.</p>
<p>Complete field name has precedence over wildcard expressions:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, first_name*</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">last_name:keyword</th>
</tr>
</thead>
</table>
</div>
<p>Wildcard expressions have the same priority, but last one wins (despite being less specific):</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name*, last_name, first_na*</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">last_name:keyword</th>
<th align="left" valign="top">first_name:keyword</th>
</tr>
</thead>
</table>
</div>
<p>A simple wildcard expression <code class="literal">*</code> has the lowest precedence.
Output order is determined by the other arguments:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP *, first_name</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
<col class="col_5"/>
<col class="col_6"/>
<col class="col_7"/>
<col class="col_8"/>
<col class="col_9"/>
<col class="col_10"/>
<col class="col_11"/>
<col class="col_12"/>
<col class="col_13"/>
<col class="col_14"/>
<col class="col_15"/>
<col class="col_16"/>
<col class="col_17"/>
<col class="col_18"/>
<col class="col_19"/>
<col class="col_20"/>
<col class="col_21"/>
<col class="col_22"/>
<col class="col_23"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">avg_worked_seconds:long</th>
<th align="left" valign="top">birth_date:date</th>
<th align="left" valign="top">emp_no:integer</th>
<th align="left" valign="top">gender:keyword</th>
<th align="left" valign="top">height:double</th>
<th align="left" valign="top">height.float:double</th>
<th align="left" valign="top">height.half_float:double</th>
<th align="left" valign="top">height.scaled_float:double</th>
<th align="left" valign="top">hire_date:date</th>
<th align="left" valign="top">is_rehired:boolean</th>
<th align="left" valign="top">job_positions:keyword</th>
<th align="left" valign="top">languages:integer</th>
<th align="left" valign="top">languages.byte:integer</th>
<th align="left" valign="top">languages.long:long</th>
<th align="left" valign="top">languages.short:integer</th>
<th align="left" valign="top">last_name:keyword</th>
<th align="left" valign="top">salary:integer</th>
<th align="left" valign="top">salary_change:double</th>
<th align="left" valign="top">salary_change.int:integer</th>
<th align="left" valign="top">salary_change.keyword:keyword</th>
<th align="left" valign="top">salary_change.long:long</th>
<th align="left" valign="top">still_hired:boolean</th>
<th align="left" valign="top">first_name:keyword</th>
</tr>
</thead>
</table>
</div>
<h3><a id="esql-limit"></a><code class="literal">LIMIT</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/limit.asciidoc">edit</a></h3>
<p>The <code class="literal">LIMIT</code> processing command enables you to limit the number of rows that are
returned.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">LIMIT max_number_of_rows</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">max_number_of_rows</code>
</span>
</dt>
<dd>
The maximum number of rows to return.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p>The <code class="literal">LIMIT</code> processing command enables you to limit the number of rows that are
returned.
Queries do not return more than 10,000 rows, regardless of the <code class="literal">LIMIT</code> command&#8217;s
value.</p>
<p>This limit only applies to the number of rows that are retrieved by the query.
Queries and aggregations run on the full data set.</p>
<p>To overcome this limitation:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Reduce the result set size by modifying the query to only return relevant
data. Use <a class="xref" href="esql-commands.html#esql-where" title="WHERE"><code class="literal">WHERE</code></a> to select a smaller subset of the data.
</li>
<li class="listitem">
Shift any post-query processing to the query itself. You can use the ES|QL
<a class="xref" href="esql-commands.html#esql-stats-by" title="STATS ... BY"><code class="literal">STATS ... BY</code></a> command to aggregate data in the query.
</li>
</ul>
</div>
<p>The default and maximum limits can be changed using these dynamic cluster
settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">esql.query.result_truncation_default_size</code>
</li>
<li class="listitem">
<code class="literal">esql.query.result_truncation_max_size</code>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Example</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| SORT emp_no ASC
| LIMIT 5</pre>
</div>
<h3><a id="esql-lookup"></a><code class="literal">LOOKUP</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/lookup.asciidoc">edit</a></h3>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>LOOKUP is highly experimental and only available in SNAPSHOT versions.</p>
</div>
</div>
<p><code class="literal">LOOKUP</code> matches values from the input against a <code class="literal">table</code> provided in the request,
adding the other fields from the <code class="literal">table</code> to the output.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">LOOKUP table ON match_field1[, match_field2, ...]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">table</code>
</span>
</dt>
<dd>
The name of the <code class="literal">table</code> provided in the request to match.
If the table&#8217;s column names conflict with existing columns, the existing columns will be dropped.
</dd>
<dt>
<span class="term">
<code class="literal">match_field</code>
</span>
</dt>
<dd>
The fields in the input to match against the table.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  format: "txt",
  query:
    "\n      FROM library\n    | SORT page_count DESC\n    | KEEP name, author\n    | LOOKUP era ON author\n    | LIMIT 5\n  ",
  tables: {
    era: {
      author: {
        keyword: [
          "Frank Herbert",
          "Peter F. Hamilton",
          "Vernor Vinge",
          "Alastair Reynolds",
          "James S.A. Corey",
        ],
      },
      era: {
        keyword: ["The New Wave", "Diamond", "Diamond", "Diamond", "Hadron"],
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="2577acb462b95bd4394523cf2f8a661f"></a>
<a id="esql-lookup-example"></a><div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query?format=txt
{
  "query": """
      FROM library
    | SORT page_count DESC
    | KEEP name, author
    | LOOKUP era ON author
    | LIMIT 5
  """,
  "tables": {
    "era": {
      "author": {"keyword": ["Frank Herbert", "Peter F. Hamilton", "Vernor Vinge", "Alastair Reynolds", "James S.A. Corey"]},
      "era":    {"keyword": [ "The New Wave",           "Diamond",      "Diamond",           "Diamond",           "Hadron"]}
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1713.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">        name        |     author      |      era
--------------------+-----------------+---------------
Pandora's Star      |Peter F. Hamilton|Diamond
A Fire Upon the Deep|Vernor Vinge     |Diamond
Dune                |Frank Herbert    |The New Wave
Revelation Space    |Alastair Reynolds|Diamond
Leviathan Wakes     |James S.A. Corey |Hadron</pre>
</div>
<h3><a id="esql-mv_expand"></a><code class="literal">MV_EXPAND</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/mv_expand.asciidoc">edit</a></h3>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>The <code class="literal">MV_EXPAND</code> processing command expands multivalued columns into one row per
value, duplicating other columns.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">MV_EXPAND column</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">column</code>
</span>
</dt>
<dd>
The multivalued column to expand.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Example</strong></span></p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a=[1,2,3], b="b", j=["a","b"]
| MV_EXPAND a</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">b:keyword</th>
<th align="left" valign="top">j:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>b</p></td>
<td align="left" valign="top"><p>["a", "b"]</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2</p></td>
<td align="left" valign="top"><p>b</p></td>
<td align="left" valign="top"><p>["a", "b"]</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>3</p></td>
<td align="left" valign="top"><p>b</p></td>
<td align="left" valign="top"><p>["a", "b"]</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-rename"></a><code class="literal">RENAME</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/rename.asciidoc">edit</a></h3>
<p>The <code class="literal">RENAME</code> processing command renames one or more columns.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">RENAME old_name1 AS new_name1[, ..., old_nameN AS new_nameN]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">old_nameX</code>
</span>
</dt>
<dd>
The name of a column you want to rename.
</dd>
<dt>
<span class="term">
<code class="literal">new_nameX</code>
</span>
</dt>
<dd>
The new name of the column. If it conflicts with an existing column name,
the existing column is dropped. If multiple columns are renamed to the same
name, all but the rightmost column with the same new name are dropped.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p>The <code class="literal">RENAME</code> processing command renames one or more columns. If a column with
the new name already exists, it will be replaced by the new column.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, still_hired
| RENAME  still_hired AS employed</pre>
</div>
<p>Multiple columns can be renamed with a single <code class="literal">RENAME</code> command:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name
| RENAME first_name AS fn, last_name AS ln</pre>
</div>
<h3><a id="esql-sort"></a><code class="literal">SORT</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/sort.asciidoc">edit</a></h3>
<p>The <code class="literal">SORT</code> processing command sorts a table on one or more columns.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">SORT column1 [ASC/DESC][NULLS FIRST/NULLS LAST][, ..., columnN [ASC/DESC][NULLS FIRST/NULLS LAST]]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">columnX</code>
</span>
</dt>
<dd>
The column to sort on.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p>The <code class="literal">SORT</code> processing command sorts a table on one or more columns.</p>
<p>The default sort order is ascending. Use <code class="literal">ASC</code> or <code class="literal">DESC</code> to specify an explicit
sort order.</p>
<p>Two rows with the same sort key are considered equal. You can provide additional
sort expressions to act as tie breakers.</p>
<p>Sorting on multivalued columns uses the lowest value when sorting ascending and
the highest value when sorting descending.</p>
<p>By default, <code class="literal">null</code> values are treated as being larger than any other value. With
an ascending sort order, <code class="literal">null</code> values are sorted last, and with a descending
sort order, <code class="literal">null</code> values are sorted first. You can change that by providing
<code class="literal">NULLS FIRST</code> or <code class="literal">NULLS LAST</code>.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, height
| SORT height</pre>
</div>
<p>Explicitly sorting in ascending order with <code class="literal">ASC</code>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, height
| SORT height DESC</pre>
</div>
<p>Providing additional sort expressions to act as tie breakers:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, height
| SORT height DESC, first_name ASC</pre>
</div>
<p>Sorting <code class="literal">null</code> values first using <code class="literal">NULLS FIRST</code>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, height
| SORT first_name ASC NULLS FIRST</pre>
</div>
<h3><a id="esql-stats-by"></a><code class="literal">STATS ... BY</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/stats.asciidoc">edit</a></h3>
<p>The <code class="literal">STATS ... BY</code> processing command groups rows according to a common value
and calculate one or more aggregated values over the grouped rows.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">STATS [column1 =] expression1[, ..., [columnN =] expressionN]
[BY grouping_expression1[, ..., grouping_expressionN]]</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">columnX</code>
</span>
</dt>
<dd>
The name by which the aggregated value is returned. If omitted, the name is
equal to the corresponding expression (<code class="literal">expressionX</code>).
If multiple columns have the same name, all but the rightmost column with this
name will be ignored.
</dd>
<dt>
<span class="term">
<code class="literal">expressionX</code>
</span>
</dt>
<dd>
An expression that computes an aggregated value.
</dd>
<dt>
<span class="term">
<code class="literal">grouping_expressionX</code>
</span>
</dt>
<dd>
An expression that outputs the values to group by.
If its name coincides with one of the computed columns, that column will be ignored.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Individual <code class="literal">null</code> values are skipped when computing aggregations.</p>
</div>
</div>
<p><span class="strong strong"><strong>Description</strong></span></p>
<p>The <code class="literal">STATS ... BY</code> processing command groups rows according to a common value
and calculate one or more aggregated values over the grouped rows. If <code class="literal">BY</code> is
omitted, the output table contains exactly one row with the aggregations applied
over the entire dataset.</p>
<p>The following <a class="xref" href="esql-functions-operators.html#esql-agg-functions" title="ES|QL aggregate functions">aggregation functions</a> are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-avg" title="AVG"><code class="literal">AVG</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-count" title="COUNT"><code class="literal">COUNT</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-count_distinct" title="COUNT_DISTINCT"><code class="literal">COUNT_DISTINCT</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-max" title="MAX"><code class="literal">MAX</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-median" title="MEDIAN"><code class="literal">MEDIAN</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-median_absolute_deviation" title="MEDIAN_ABSOLUTE_DEVIATION"><code class="literal">MEDIAN_ABSOLUTE_DEVIATION</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-min" title="MIN"><code class="literal">MIN</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-percentile" title="PERCENTILE"><code class="literal">PERCENTILE</code></a>
</li>
<li class="listitem">
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> <a class="xref" href="esql-functions-operators.html#esql-st_centroid_agg" title="ST_CENTROID_AGG"><code class="literal">ST_CENTROID_AGG</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-sum" title="SUM"><code class="literal">SUM</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-top" title="TOP"><code class="literal">TOP</code></a>
</li>
<li class="listitem">
<a class="xref" href="esql-functions-operators.html#esql-values" title="VALUES"><code class="literal">VALUES</code></a>
</li>
<li class="listitem">
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> <a class="xref" href="esql-functions-operators.html#esql-agg-weighted-avg" title="WEIGHTED_AVG"><code class="literal">WEIGHTED_AVG</code></a>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">STATS</code> without any groups is much much faster than adding a group.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Grouping on a single expression is currently much more optimized than grouping
      on many expressions. In some tests we have seen grouping on a single <code class="literal">keyword</code>
      column to be five times faster than grouping on two <code class="literal">keyword</code> columns. Do
      not try to work around this by combining the two columns together with
      something like <a class="xref" href="esql-functions-operators.html#esql-concat" title="CONCAT"><code class="literal">CONCAT</code></a> and then grouping - that is not going to be
      faster.</p>
</div>
</div>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<p>Calculating a statistic and grouping by the values of another column:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| STATS count = COUNT(emp_no) BY languages
| SORT languages</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">count:long</th>
<th align="left" valign="top">languages:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>15</p></td>
<td align="left" valign="top"><p>1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>19</p></td>
<td align="left" valign="top"><p>2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>17</p></td>
<td align="left" valign="top"><p>3</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>18</p></td>
<td align="left" valign="top"><p>4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>21</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10</p></td>
<td align="left" valign="top"><p>null</p></td>
</tr>
</tbody>
</table>
</div>
<p>Omitting <code class="literal">BY</code> returns one row with the aggregations applied over the entire
dataset:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| STATS avg_lang = AVG(languages)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">avg_lang:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>3.1222222222222222</p></td>
</tr>
</tbody>
</table>
</div>
<p>It&#8217;s possible to calculate multiple values:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| STATS avg_lang = AVG(languages), max_lang = MAX(languages)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">avg_lang:double</th>
<th align="left" valign="top">max_lang:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>3.1222222222222222</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
</tbody>
</table>
</div>
<p><a id="esql-stats-mv-group"></a>If the grouping key is multivalued then the input row is in all groups:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW i=1, a=["a", "b"] | STATS MIN(i) BY a | SORT a ASC</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">MIN(i):integer</th>
<th align="left" valign="top">a:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>a</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>b</p></td>
</tr>
</tbody>
</table>
</div>
<p>It&#8217;s also possible to group by multiple values:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| EVAL hired = DATE_FORMAT("YYYY", hire_date)
| STATS avg_salary = AVG(salary) BY hired, languages.long
| EVAL avg_salary = ROUND(avg_salary)
| SORT hired, languages.long</pre>
</div>
<p>If the all grouping keys are multivalued then the input row is in all groups:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW i=1, a=["a", "b"], b=[2, 3] | STATS MIN(i) BY a, b | SORT a ASC, b ASC</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">MIN(i):integer</th>
<th align="left" valign="top">a:keyword</th>
<th align="left" valign="top">b:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>a</p></td>
<td align="left" valign="top"><p>2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>a</p></td>
<td align="left" valign="top"><p>3</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>b</p></td>
<td align="left" valign="top"><p>2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>b</p></td>
<td align="left" valign="top"><p>3</p></td>
</tr>
</tbody>
</table>
</div>
<p>Both the aggregating functions and the grouping expressions accept other
functions. This is useful for using <code class="literal">STATS...BY</code> on multivalue columns.
For example, to calculate the average salary change, you can use <code class="literal">MV_AVG</code> to
first average the multiple values per employee, and use the result with the
<code class="literal">AVG</code> function:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| STATS avg_salary_change = ROUND(AVG(MV_AVG(salary_change)), 10)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">avg_salary_change:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1.3904535865</p></td>
</tr>
</tbody>
</table>
</div>
<p>An example of grouping by an expression is grouping employees on the first
letter of their last name:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| STATS my_count = COUNT() BY LEFT(last_name, 1)
| SORT `LEFT(last_name, 1)`</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">my_count:long</th>
<th align="left" valign="top">LEFT(last_name, 1):keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>2</p></td>
<td align="left" valign="top"><p>A</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>11</p></td>
<td align="left" valign="top"><p>B</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>C</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>D</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2</p></td>
<td align="left" valign="top"><p>E</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>4</p></td>
<td align="left" valign="top"><p>F</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>4</p></td>
<td align="left" valign="top"><p>G</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>6</p></td>
<td align="left" valign="top"><p>H</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2</p></td>
<td align="left" valign="top"><p>J</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>3</p></td>
<td align="left" valign="top"><p>K</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>L</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>12</p></td>
<td align="left" valign="top"><p>M</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>4</p></td>
<td align="left" valign="top"><p>N</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>O</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>7</p></td>
<td align="left" valign="top"><p>P</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>R</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>13</p></td>
<td align="left" valign="top"><p>S</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>4</p></td>
<td align="left" valign="top"><p>T</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2</p></td>
<td align="left" valign="top"><p>W</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>3</p></td>
<td align="left" valign="top"><p>Z</p></td>
</tr>
</tbody>
</table>
</div>
<p>Specifying the output column name is optional. If not specified, the new column
name is equal to the expression. The following query returns a column named
<code class="literal">AVG(salary)</code>:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| STATS AVG(salary)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">AVG(salary):double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>48248.55</p></td>
</tr>
</tbody>
</table>
</div>
<p>Because this name contains special characters, <a class="xref" href="esql-syntax.html#esql-identifiers" title="Identifiers">it needs to be
quoted</a> with backticks (<code class="literal">`</code>) when using it in subsequent commands:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| STATS AVG(salary)
| EVAL avg_salary_rounded = ROUND(`AVG(salary)`)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">AVG(salary):double</th>
<th align="left" valign="top">avg_salary_rounded:double</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>48248.55</p></td>
<td align="left" valign="top"><p>48249.0</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-where"></a><code class="literal">WHERE</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/processing-commands/where.asciidoc">edit</a></h3>
<p>The <code class="literal">WHERE</code> processing command produces a table that contains all the rows from
the input table for which the provided condition evaluates to <code class="literal">true</code>.</p>
<p><span class="strong strong"><strong>Syntax</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">WHERE expression</pre>
</div>
<p><span class="strong strong"><strong>Parameters</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">expression</code>
</span>
</dt>
<dd>
A boolean expression.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, still_hired
| WHERE still_hired == true</pre>
</div>
<p>Which, if <code class="literal">still_hired</code> is a boolean field, can be simplified to:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, still_hired
| WHERE still_hired</pre>
</div>
<p>Use date math to retrieve data from a specific time range. For example, to
retrieve the last hour of logs:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM sample_data
| WHERE @timestamp &gt; NOW() - 1 hour</pre>
</div>
<p><code class="literal">WHERE</code> supports various <a class="xref" href="esql-functions-operators.html#esql-functions" title="Functions overview">functions</a>. For example the
<a class="xref" href="esql-functions-operators.html#esql-length" title="LENGTH"><code class="literal">LENGTH</code></a> function:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees
| KEEP first_name, last_name, height
| WHERE LENGTH(first_name) &lt; 4</pre>
</div>
<p>For a complete list of all functions, refer to <a class="xref" href="esql-functions-operators.html#esql-functions" title="Functions overview">Functions overview</a>.</p>
<p>For NULL comparison, use the <code class="literal">IS NULL</code> and <code class="literal">IS NOT NULL</code> predicates:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| WHERE birth_date IS NULL
| KEEP first_name, last_name
| SORT first_name
| LIMIT 3</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">last_name:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Basil</p></td>
<td align="left" valign="top"><p>Tramer</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Florian</p></td>
<td align="left" valign="top"><p>Syrotiuk</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Lucien</p></td>
<td align="left" valign="top"><p>Rosenbaum</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| WHERE is_rehired IS NOT NULL
| STATS COUNT(emp_no)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">COUNT(emp_no):long</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>84</p></td>
</tr>
</tbody>
</table>
</div>
<p>Use <code class="literal">LIKE</code> to filter data based on string patterns using wildcards. <code class="literal">LIKE</code>
usually acts on a field placed on the left-hand side of the operator, but it can
also act on a constant (literal) expression. The right-hand side of the operator
represents the pattern.</p>
<p>The following wildcard characters are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">*</code> matches zero or more characters.
</li>
<li class="listitem">
<code class="literal">?</code> matches one character.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Supported types</strong></span></p>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">str</th>
<th align="left" valign="top">pattern</th>
<th align="left" valign="top">result</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>keyword</p></td>
<td align="left" valign="top"><p>keyword</p></td>
<td align="left" valign="top"><p>boolean</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>text</p></td>
<td align="left" valign="top"><p>text</p></td>
<td align="left" valign="top"><p>boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| WHERE first_name LIKE "?b*"
| KEEP first_name, last_name</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">last_name:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Ebbe</p></td>
<td align="left" valign="top"><p>Callaway</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Eberhardt</p></td>
<td align="left" valign="top"><p>Terkki</p></td>
</tr>
</tbody>
</table>
</div>
<p>Use <code class="literal">RLIKE</code> to filter data based on string patterns using using
<a class="xref" href="regexp-syntax.html" title="Regular expression syntax">regular expressions</a>. <code class="literal">RLIKE</code> usually acts on a field placed on
the left-hand side of the operator, but it can also act on a constant (literal)
expression. The right-hand side of the operator represents the pattern.</p>
<p><span class="strong strong"><strong>Supported types</strong></span></p>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">str</th>
<th align="left" valign="top">pattern</th>
<th align="left" valign="top">result</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>keyword</p></td>
<td align="left" valign="top"><p>keyword</p></td>
<td align="left" valign="top"><p>boolean</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>text</p></td>
<td align="left" valign="top"><p>text</p></td>
<td align="left" valign="top"><p>boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM employees
| WHERE first_name RLIKE ".leja.*"
| KEEP first_name, last_name</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">first_name:keyword</th>
<th align="left" valign="top">last_name:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Alejandro</p></td>
<td align="left" valign="top"><p>McAlpine</p></td>
</tr>
</tbody>
</table>
</div>
<p>The <code class="literal">IN</code> operator allows testing whether a field or expression equals
an element in a list of literals, fields or expressions:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">ROW a = 1, b = 4, c = 3
| WHERE c-a IN (3, b / 2, a)</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">a:integer</th>
<th align="left" valign="top">b:integer</th>
<th align="left" valign="top">c:integer</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>4</p></td>
<td align="left" valign="top"><p>3</p></td>
</tr>
</tbody>
</table>
</div>
<p>For a complete list of all operators, refer to <a class="xref" href="esql-functions-operators.html#esql-operators" title="ES|QL operators">Operators</a>.</p>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="esql-syntax.html">« ES|QL syntax reference</a>
</span>
<span class="next">
<a href="esql-functions-operators.html">ES|QL functions and operators »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
