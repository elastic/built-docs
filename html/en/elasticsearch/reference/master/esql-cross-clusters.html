<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Using ES|QL across clusters | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Using ES|QL across clusters | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="esql-using.html" title="Using ES|QL"/>
<link rel="prev" href="esql-multi-index.html" title="Using ES|QL to query multiple indices"/>
<link rel="next" href="esql-task-management.html" title="ES|QL task management"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="esql-multi-index.html">« Using ES|QL to query multiple indices</a>
</span>
<span class="next">
<a href="esql-task-management.html">ES|QL task management »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql.html">ES|QL</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql-using.html">Using ES|QL</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Using ES|QL across clusters</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="esql-cross-clusters"></a>Using ES|QL across clusters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h2>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Cross-cluster search for ES|QL is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For Cross-cluster search with ES|QL on version 8.16 or later, remote clusters must also be on version 8.16 or later.</p>
</div>
</div>
<p>With ES|QL, you can execute a single query across multiple clusters.</p>
<h4><a id="esql-ccs-prerequisites"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Cross-cluster search requires remote clusters. To set up remote clusters on Elasticsearch Service,
see <a href="/guide/en/cloud/current/ec-enable-ccs.html" class="ulink" target="_top">configure remote clusters on Elasticsearch Service</a>. If you
run Elasticsearch on your own hardware, see <a class="xref" href="remote-clusters.html" title="Remote clusters"><em>Remote clusters</em></a>.</p>
<p>To ensure your remote cluster configuration supports cross-cluster search, see
<a class="xref" href="modules-cross-cluster-search.html#ccs-supported-configurations" title="Supported cross-cluster search configurations">Supported cross-cluster search configurations</a>.</p>
</li>
<li class="listitem">
For full cross-cluster search capabilities, the local and remote cluster must be on the same
<a href="/subscriptions" class="ulink" target="_top">subscription level</a>.
</li>
<li class="listitem">
The local coordinating node must have the
<a class="xref" href="modules-node.html#remote-node" title="Remote-eligible node"><code class="literal">remote_cluster_client</code></a> node role.
</li>
<li class="listitem">
<p>If you use <a class="xref" href="remote-clusters.html#sniff-mode">sniff mode</a>, the local coordinating node
must be able to connect to seed and gateway nodes on the remote cluster.</p>
<p>We recommend using gateway nodes capable of serving as coordinating nodes.
The seed nodes can be a subset of these gateway nodes.</p>
</li>
<li class="listitem">
If you use <a class="xref" href="remote-clusters.html#proxy-mode">proxy mode</a>, the local coordinating node must be able
to connect to the configured <code class="literal">proxy_address</code>. The proxy at this address must be
able to route connections to gateway and coordinating nodes on the remote
cluster.
</li>
<li class="listitem">
Cross-cluster search requires different security privileges on the local cluster and
remote cluster. See <a class="xref" href="remote-clusters-cert.html#remote-clusters-privileges-ccs" title="Configure privileges for cross-cluster search">Configure privileges for cross-cluster search</a> and
<a class="xref" href="remote-clusters.html" title="Remote clusters"><em>Remote clusters</em></a>.
</li>
</ul>
</div>
<h4><a id="esql-ccs-security-model"></a>Security model<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h4>
<p>Elasticsearch supports two security models for cross-cluster search (CCS):</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="esql-cross-clusters.html#esql-ccs-security-model-certificate" title="TLS certificate authentication">TLS certificate authentication</a>
</li>
<li class="listitem">
<a class="xref" href="esql-cross-clusters.html#esql-ccs-security-model-api-key" title="API key authentication">API key authentication</a>
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To check which security model is being used to connect your clusters, run <code class="literal">GET _remote/info</code>.
If you&#8217;re using the API key authentication method, you&#8217;ll see the <code class="literal">"cluster_credentials"</code> key in the response.</p>
</div>
</div>
<h5><a id="esql-ccs-security-model-certificate"></a>TLS certificate authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h5>
<p>TLS certificate authentication secures remote clusters with mutual TLS.
This could be the preferred model when a single administrator has full control over both clusters.
We generally recommend that roles and their privileges be identical in both clusters.</p>
<p>Refer to <a class="xref" href="remote-clusters-cert.html" title="Add remote clusters using TLS certificate authentication">TLS certificate authentication</a> for prerequisites and detailed setup instructions.</p>
<h5><a id="esql-ccs-security-model-api-key"></a>API key authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h5>
<p>The following information pertains to using ES|QL across clusters with the <a class="xref" href="remote-clusters-api-key.html" title="Add remote clusters using API key authentication"><span class="strong strong"><strong>API key based security model</strong></span></a>. You&#8217;ll need to follow the steps on that page for the <span class="strong strong"><strong>full setup instructions</strong></span>. This page only contains additional information specific to ES|QL.</p>
<p>API key based cross-cluster search (CCS) enables more granular control over allowed actions between clusters.
This may be the preferred model when you have different administrators for different clusters and want more control over who can access what data. In this model, cluster administrators must explicitly define the access given to clusters and users.</p>
<p>You will need to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Create an API key on the <span class="strong strong"><strong>remote cluster</strong></span> using the <a class="xref" href="security-api-create-cross-cluster-api-key.html" title="Create Cross-Cluster API key API">Create cross-cluster API key</a> API or using the <a href="/guide/en/kibana/master/api-keys.html" class="ulink" target="_top">Kibana API keys UI</a>.
</li>
<li class="listitem">
Add the API key to the keystore on the <span class="strong strong"><strong>local cluster</strong></span>, as part of the steps in <a class="xref" href="remote-clusters-api-key.html#remote-clusters-security-api-key-local-actions" title="On the local cluster">configuring the local cluster</a>. All cross-cluster requests from the local cluster are bound by the API key’s privileges.
</li>
</ul>
</div>
<p>Using ES|QL with the API key based security model requires some additional permissions that may not be needed when using the traditional query DSL based search.
The following example API call creates a role that can query remote indices using ES|QL when using the API key based security model.
The final privilege, <code class="literal">remote_cluster</code>, is required to allow remote enrich operations.</p>
<a id="7f2d511cb64743c006225e5933a14bb4"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_security/role/remote1
{
  "cluster": ["cross_cluster_search"], <a id="CO455-1"></a><i class="conum" data-value="1"></i>
  "indices": [
    {
      "names" : [""], <a id="CO455-2"></a><i class="conum" data-value="2"></i>
      "privileges": ["read"]
    }
  ],
  "remote_indices": [ <a id="CO455-3"></a><i class="conum" data-value="3"></i>
    {
      "names": [ "logs-*" ],
      "privileges": [ "read","read_cross_cluster" ], <a id="CO455-4"></a><i class="conum" data-value="4"></i>
      "clusters" : ["my_remote_cluster"] <a id="CO455-5"></a><i class="conum" data-value="5"></i>
    }
  ],
   "remote_cluster": [ <a id="CO455-6"></a><i class="conum" data-value="6"></i>
        {
            "privileges": [
                "monitor_enrich"
            ],
            "clusters": [
                "my_remote_cluster"
            ]
        }
    ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1741.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO455-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">cross_cluster_search</code> cluster privilege is required for the <em>local</em> cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO455-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Typically, users will have permissions to read both local and remote indices. However, for cases where the role is intended to ONLY search the remote cluster, the <code class="literal">read</code> permission is still required for the local cluster. To provide read access to the local cluster, but disallow reading any indices in the local cluster, the <code class="literal">names</code> field may be an empty string.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO455-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The indices allowed read access to the remote cluster. The configured <a class="xref" href="security-api-create-cross-cluster-api-key.html" title="Create Cross-Cluster API key API">cross-cluster API key</a> must also allow this index to be read.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO455-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">read_cross_cluster</code> privilege is always required when using ES|QL across clusters with the API key based security model.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO455-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The remote clusters to which these privileges apply.
This remote cluster must be configured with a <a class="xref" href="security-api-create-cross-cluster-api-key.html" title="Create Cross-Cluster API key API">cross-cluster API key</a> and connected to the remote cluster before the remote index can be queried.
Verify connection using the <a class="xref" href="cluster-remote-info.html" title="Remote cluster info API">Remote cluster info</a> API.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO455-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Required to allow remote enrichment. Without this, the user cannot read from the <code class="literal">.enrich</code> indices on the remote cluster. The <code class="literal">remote_cluster</code> security privilege was introduced in version <span class="strong strong"><strong>8.15.0</strong></span>.</p>
</td>
</tr>
</table>
</div>
<p>You will then need a user or API key with the permissions you created above. The following example API call creates a user with the <code class="literal">remote1</code> role.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.security.putUser({
  username: "remote_user",
  password: "&lt;PASSWORD&gt;",
  roles: ["remote1"],
});
console.log(response);</pre>
</div>
<a id="bf1de9fa1b825fa875d27fa08821a6d1"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_security/user/remote_user
{
  "password" : "&lt;PASSWORD&gt;",
  "roles" : [ "remote1" ]
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1742.console"></div>
<p>Remember that all cross-cluster requests from the local cluster are bound by the cross cluster API key’s privileges, which are controlled by the remote cluster&#8217;s administrator.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Cross cluster API keys created in versions prior to 8.15.0 will need to replaced or updated to add the new permissions required for ES|QL with ENRICH.</p>
</div>
</div>
<h4><a id="ccq-remote-cluster-setup"></a>Remote cluster setup<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h4>
<p>Once the security model is configured, you can add remote clusters.</p>
<p>The following <a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">cluster update settings</a> API request
adds three remote clusters: <code class="literal">cluster_one</code>, <code class="literal">cluster_two</code>, and <code class="literal">cluster_three</code>.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.cluster.put_settings(
  body: {
    persistent: {
      cluster: {
        remote: {
          cluster_one: {
            seeds: [
              '35.238.149.1:9300'
            ],
            skip_unavailable: true
          },
          cluster_two: {
            seeds: [
              '35.238.149.2:9300'
            ],
            skip_unavailable: false
          },
          cluster_three: {
            seeds: [
              '35.238.149.3:9300'
            ]
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.cluster.putSettings({
  persistent: {
    cluster: {
      remote: {
        cluster_one: {
          seeds: ["35.238.149.1:9300"],
          skip_unavailable: true,
        },
        cluster_two: {
          seeds: ["35.238.149.2:9300"],
          skip_unavailable: false,
        },
        cluster_three: {
          seeds: ["35.238.149.3:9300"],
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="72a3668ddc95d9aec47cc679d1e7afc5"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "cluster_one": {
          "seeds": [
            "35.238.149.1:9300"
          ],
          "skip_unavailable": true
        },
        "cluster_two": {
          "seeds": [
            "35.238.149.2:9300"
          ],
          "skip_unavailable": false
        },
        "cluster_three": {  <a id="CO456-1"></a><i class="conum" data-value="1"></i>
          "seeds": [
            "35.238.149.3:9300"
          ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1743.console"></div>
<div class="calloutlist default has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO456-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Since <code class="literal">skip_unavailable</code> was not set on <code class="literal">cluster_three</code>, it uses
the default of <code class="literal">false</code>. See the <a class="xref" href="esql-cross-clusters.html#ccq-skip-unavailable-clusters" title="Optional remote clusters">Optional remote clusters</a>
section for details.</p>
</td>
</tr>
</table>
</div>
<h4><a id="ccq-from"></a>Query across multiple clusters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h4>
<p>In the <code class="literal">FROM</code> command, specify data streams and indices on remote clusters
using the format <code class="literal">&lt;remote_cluster_name&gt;:&lt;target&gt;</code>. For instance, the following
ES|QL request queries the <code class="literal">my-index-000001</code> index on a single remote cluster
named <code class="literal">cluster_one</code>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM cluster_one:my-index-000001
| LIMIT 10</pre>
</div>
<p>Similarly, this ES|QL request queries the <code class="literal">my-index-000001</code> index from
three clusters:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The local ("querying") cluster
</li>
<li class="listitem">
Two remote clusters, <code class="literal">cluster_one</code> and <code class="literal">cluster_two</code>
</li>
</ul>
</div>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster_one:my-index-000001,cluster_two:my-index-000001
| LIMIT 10</pre>
</div>
<p>Likewise, this ES|QL request queries the <code class="literal">my-index-000001</code> index from all
remote clusters (<code class="literal">cluster_one</code>, <code class="literal">cluster_two</code>, and <code class="literal">cluster_three</code>):</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM *:my-index-000001
| LIMIT 10</pre>
</div>
<h4><a id="ccq-enrich"></a>Enrich across clusters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h4>
<p>Enrich in ES|QL across clusters operates similarly to <a class="xref" href="esql-commands.html#esql-enrich" title="ENRICH">local enrich</a>.
If the enrich policy and its enrich indices are consistent across all clusters, simply
write the enrich command as you would without remote clusters. In this default mode,
ES|QL can execute the enrich command on either the local cluster or the remote
clusters, aiming to minimize computation or inter-cluster data transfer. Ensuring that
the policy exists with consistent data on both the local cluster and the remote
clusters is critical for ES|QL to produce a consistent query result.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Enrich in ES|QL across clusters using the API key based security model was introduced in version <span class="strong strong"><strong>8.15.0</strong></span>.
Cross cluster API keys created in versions prior to 8.15.0 will need to replaced or updated to use the new required permissions.
Refer to the example in the <a class="xref" href="esql-cross-clusters.html#esql-ccs-security-model-api-key" title="API key authentication">API key authentication</a> section.</p>
</div>
</div>
<p>In the following example, the enrich with <code class="literal">hosts</code> policy can be executed on
either the local cluster or the remote cluster <code class="literal">cluster_one</code>.</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster_one:my-index-000001
| ENRICH hosts ON ip
| LIMIT 10</pre>
</div>
<p>Enrich with an ES|QL query against remote clusters only can also happen on
the local cluster. This means the below query requires the <code class="literal">hosts</code> enrich
policy to exist on the local cluster as well.</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM cluster_one:my-index-000001,cluster_two:my-index-000001
| LIMIT 10
| ENRICH hosts ON ip</pre>
</div>
<h5><a id="esql-enrich-coordinator"></a>Enrich with coordinator mode<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h5>
<p>ES|QL provides the enrich <code class="literal">_coordinator</code> mode to force ES|QL to execute the enrich
command on the local cluster. This mode should be used when the enrich policy is
not available on the remote clusters or maintaining consistency of enrich indices
across clusters is challenging.</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster_one:my-index-000001
| ENRICH _coordinator:hosts ON ip
| SORT host_name
| LIMIT 10</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Enrich with the <code class="literal">_coordinator</code> mode usually increases inter-cluster data transfer and
workload on the local cluster.</p>
</div>
</div>
<h5><a id="esql-enrich-remote"></a>Enrich with remote mode<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h5>
<p>ES|QL also provides the enrich <code class="literal">_remote</code> mode to force ES|QL to execute the enrich
command independently on each remote cluster where the target indices reside.
This mode is useful for managing different enrich data on each cluster, such as detailed
information of hosts for each region where the target (main) indices contain
log events from these hosts.</p>
<p>In the below example, the <code class="literal">hosts</code> enrich policy is required to exist on all
remote clusters: the <code class="literal">querying</code> cluster (as local indices are included),
the remote cluster <code class="literal">cluster_one</code>, and <code class="literal">cluster_two</code>.</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster_one:my-index-000001,cluster_two:my-index-000001
| ENRICH _remote:hosts ON ip
| SORT host_name
| LIMIT 10</pre>
</div>
<p>A <code class="literal">_remote</code> enrich cannot be executed after a <a class="xref" href="esql-commands.html#esql-stats-by" title="STATS ... BY">stats</a>
command. The following example would result in an error:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster_one:my-index-000001,cluster_two:my-index-000001
| STATS COUNT(*) BY ip
| ENRICH _remote:hosts ON ip
| SORT host_name
| LIMIT 10</pre>
</div>
<h5><a id="esql-multi-enrich"></a>Multiple enrich commands<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h5>
<p>You can include multiple enrich commands in the same query with different
modes. ES|QL will attempt to execute them accordingly. For example, this
query performs two enriches, first with the <code class="literal">hosts</code> policy on any cluster
and then with the <code class="literal">vendors</code> policy on the local cluster.</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster_one:my-index-000001,cluster_two:my-index-000001
| ENRICH hosts ON ip
| ENRICH _coordinator:vendors ON os
| LIMIT 10</pre>
</div>
<p>A <code class="literal">_remote</code> enrich command can&#8217;t be executed after a <code class="literal">_coordinator</code> enrich
command. The following example would result in an error.</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster_one:my-index-000001,cluster_two:my-index-000001
| ENRICH _coordinator:hosts ON ip
| ENRICH _remote:vendors ON os
| LIMIT 10</pre>
</div>
<h4><a id="ccq-exclude"></a>Excluding clusters or indices from ES|QL query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h4>
<p>To exclude an entire cluster, prefix the cluster alias with a minus sign in
the <code class="literal">FROM</code> command, for example: <code class="literal">-my_cluster:*</code>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster*:my-index-000001,-cluster_three:*
| LIMIT 10</pre>
</div>
<p>To exclude a specific remote index, prefix the index with a minus sign in
the <code class="literal">FROM</code> command, such as <code class="literal">my_cluster:-my_index</code>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM my-index-000001,cluster*:my-index-*,cluster_three:-my-index-000001
| LIMIT 10</pre>
</div>
<h4><a id="ccq-skip-unavailable-clusters"></a>Optional remote clusters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h4>
<p>Cross-cluster search for ES|QL currently does not respect the <code class="literal">skip_unavailable</code>
setting. As a result, if a remote cluster specified in the request is
unavailable or failed, cross-cluster search for ES|QL queries will fail regardless of the setting.</p>
<p>We are actively working to align the behavior of cross-cluster search for ES|QL with other
cross-cluster search APIs. This includes providing detailed execution information for each cluster
in the response, such as execution time, selected target indices, and shards.</p>
<h4><a id="ccq-during-upgrade"></a>Query across clusters during an upgrade<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-across-clusters.asciidoc">edit</a></h4>
<p>You can still search a remote cluster while performing a
rolling upgrade on the local cluster. However, the local
coordinating node&#8217;s "upgrade from" and "upgrade to" version must be compatible
with the remote cluster&#8217;s gateway node.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Running multiple versions of Elasticsearch in the same cluster beyond the
duration of an upgrade is not supported.</p>
</div>
</div>
<p>For more information about upgrades, see
<a href="/guide/en/elastic-stack/master/upgrading-elasticsearch.html" class="ulink" target="_top">Upgrading Elasticsearch</a>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="esql-multi-index.html">« Using ES|QL to query multiple indices</a>
</span>
<span class="next">
<a href="esql-task-management.html">ES|QL task management »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
