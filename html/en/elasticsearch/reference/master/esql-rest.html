<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>ES|QL REST API | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="ES|QL REST API | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="esql-using.html" title="Using ES|QL"/>
<link rel="prev" href="esql-using.html" title="Using ES|QL"/>
<link rel="next" href="esql-kibana.html" title="Using ES|QL in Kibana"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="esql-using.html">« Using ES|QL</a>
</span>
<span class="next">
<a href="esql-kibana.html">Using ES|QL in Kibana »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql.html">ES|QL</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql-using.html">Using ES|QL</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>ES|QL REST API</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="esql-rest"></a>ES|QL REST API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h2>
</div></div></div>

<h3><a id="esql-rest-overview"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h3>
<p>The <a class="xref" href="esql-query-api.html" title="ES|QL query API">ES|QL query API</a> accepts an ES|QL query string in the
<code class="literal">query</code> parameter, runs it, and returns the results. For example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  format: "txt",
  query:
    "FROM library | KEEP author, name, page_count, release_date | SORT page_count DESC | LIMIT 5",
});
console.log(response);</pre>
</div>
<a id="a9541c64512ebc5fcff2dc48487dc0b7"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query?format=txt
{
  "query": "FROM library | KEEP author, name, page_count, release_date | SORT page_count DESC | LIMIT 5"
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1726.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">     author      |        name        |  page_count   | release_date
-----------------+--------------------+---------------+------------------------
Peter F. Hamilton|Pandora's Star      |768            |2004-03-02T00:00:00.000Z
Vernor Vinge     |A Fire Upon the Deep|613            |1992-06-01T00:00:00.000Z
Frank Herbert    |Dune                |604            |1965-06-01T00:00:00.000Z
Alastair Reynolds|Revelation Space    |585            |2000-03-15T00:00:00.000Z
James S.A. Corey |Leviathan Wakes     |561            |2011-06-02T00:00:00.000Z</pre>
</div>
<h4><a id="esql-kibana-console"></a>Kibana Console<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>If you are using <a href="/guide/en/kibana/master/console-kibana.html" class="ulink" target="_top">Kibana Console</a> (which is
highly recommended), take advantage of the triple quotes <code class="literal">"""</code> when creating the
query. This not only automatically escapes double quotes (<code class="literal">"</code>) inside the query
string but also supports multi-line requests:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  format: "txt",
  query:
    "\n    FROM library\n    | KEEP author, name, page_count, release_date\n    | SORT page_count DESC\n    | LIMIT 5\n  ",
});
console.log(response);</pre>
</div>
<a id="f7139b3c0e066be832b9100ae17157cc"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query?format=txt
{
  "query": """
    FROM library
    | KEEP author, name, page_count, release_date
    | SORT page_count DESC
    | LIMIT 5
  """
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1727.console"></div>
<h4><a id="esql-rest-format"></a>Response formats<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>ES|QL can return the data in the following human readable and binary formats.
You can set the format by specifying the <code class="literal">format</code> parameter in the URL or by
setting the <code class="literal">Accept</code> or <code class="literal">Content-Type</code> HTTP header.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The URL parameter takes precedence over the HTTP headers. If neither is
specified then the response is returned in the same format as the request.</p>
</div>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong><code class="literal">format</code></strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>HTTP header</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>Description</strong></span></p></td>
</tr>
<tr>
<td align="left" colspan="3" valign="top"><p><span class="strong strong"><strong>Human readable</strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">csv</code></p></td>
<td align="left" valign="top"><p><code class="literal">text/csv</code></p></td>
<td align="left" valign="top"><p><a href="https://en.wikipedia.org/wiki/Comma-separated_values" class="ulink" target="_top">Comma-separated values</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">json</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/json</code></p></td>
<td align="left" valign="top"><p><a href="https://www.json.org/" class="ulink" target="_top">JSON</a> (JavaScript Object Notation) human-readable format</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">tsv</code></p></td>
<td align="left" valign="top"><p><code class="literal">text/tab-separated-values</code></p></td>
<td align="left" valign="top"><p><a href="https://en.wikipedia.org/wiki/Tab-separated_values" class="ulink" target="_top">Tab-separated values</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">txt</code></p></td>
<td align="left" valign="top"><p><code class="literal">text/plain</code></p></td>
<td align="left" valign="top"><p>CLI-like representation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">yaml</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/yaml</code></p></td>
<td align="left" valign="top"><p><a href="https://en.wikipedia.org/wiki/YAML" class="ulink" target="_top">YAML</a> (YAML Ain&#8217;t Markup Language) human-readable format</p></td>
</tr>
<tr>
<td align="left" colspan="3" valign="top"><p><span class="strong strong"><strong>Binary</strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">cbor</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/cbor</code></p></td>
<td align="left" valign="top"><p><a href="https://cbor.io/" class="ulink" target="_top">Concise Binary Object Representation</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">smile</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/smile</code></p></td>
<td align="left" valign="top"><p><a href="https://en.wikipedia.org/wiki/Smile_(data_interchange_format)" class="ulink" target="_top">Smile</a> binary data format similar
to CBOR</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">arrow</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/vnd.apache.arrow.stream</code></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>Experimental.</strong></span> <a href="https://arrow.apache.org/" class="ulink" target="_top">Apache Arrow</a> dataframes, <a href="https://arrow.apache.org/docs/format/Columnar.html#ipc-streaming-format" class="ulink" target="_top">IPC streaming format</a></p></td>
</tr>
</tbody>
</table>
</div>
<p>The <code class="literal">csv</code> format accepts a formatting URL query attribute, <code class="literal">delimiter</code>, which
indicates which character should be used to separate the CSV values. It defaults
to comma (<code class="literal">,</code>) and cannot take any of the following values: double quote (<code class="literal">"</code>),
carriage-return (<code class="literal">\r</code>) and new-line (<code class="literal">\n</code>). The tab (<code class="literal">\t</code>) can also not be used.
Use the <code class="literal">tsv</code> format instead.</p>
<h4><a id="esql-rest-filtering"></a>Filtering using Elasticsearch Query DSL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>Specify a Query DSL query in the <code class="literal">filter</code> parameter to filter the set of
documents that an ES|QL query runs on.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  format: "txt",
  query:
    "\n    FROM library\n    | KEEP author, name, page_count, release_date\n    | SORT page_count DESC\n    | LIMIT 5\n  ",
  filter: {
    range: {
      page_count: {
        gte: 100,
        lte: 200,
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="3613f402ee63f0efb6b8d9c6a919b410"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query?format=txt
{
  "query": """
    FROM library
    | KEEP author, name, page_count, release_date
    | SORT page_count DESC
    | LIMIT 5
  """,
  "filter": {
    "range": {
      "page_count": {
        "gte": 100,
        "lte": 200
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1728.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">    author     |                name                |  page_count   | release_date
---------------+------------------------------------+---------------+------------------------
Douglas Adams  |The Hitchhiker's Guide to the Galaxy|180            |1979-10-12T00:00:00.000Z</pre>
</div>
<h4><a id="esql-rest-columnar"></a>Columnar results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>By default, ES|QL returns results as rows. For example, <code class="literal">FROM</code> returns each
individual document as one row. For the <code class="literal">json</code>, <code class="literal">yaml</code>, <code class="literal">cbor</code> and <code class="literal">smile</code>
<a class="xref" href="esql-rest.html#esql-rest-format" title="Response formats">formats</a>, ES|QL can return the results in a columnar
fashion where one row represents all the values of a certain column in the
results.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  format: "json",
  query:
    "\n    FROM library\n    | KEEP author, name, page_count, release_date\n    | SORT page_count DESC\n    | LIMIT 5\n  ",
  columnar: true,
});
console.log(response);</pre>
</div>
<a id="dc33160f4087443f867080a8f5b2cfbd"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query?format=json
{
  "query": """
    FROM library
    | KEEP author, name, page_count, release_date
    | SORT page_count DESC
    | LIMIT 5
  """,
  "columnar": true
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1729.console"></div>
<p>Which returns:</p>
<a id="716b89c135c054fb55cbc343fc1239b1"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    {"name": "author", "type": "text"},
    {"name": "name", "type": "text"},
    {"name": "page_count", "type": "integer"},
    {"name": "release_date", "type": "date"}
  ],
  "values": [
    ["Peter F. Hamilton", "Vernor Vinge", "Frank Herbert", "Alastair Reynolds", "James S.A. Corey"],
    ["Pandora's Star", "A Fire Upon the Deep", "Dune", "Revelation Space", "Leviathan Wakes"],
    [768, 613, 604, 585, 561],
    ["2004-03-02T00:00:00.000Z", "1992-06-01T00:00:00.000Z", "1965-06-01T00:00:00.000Z", "2000-03-15T00:00:00.000Z", "2011-06-02T00:00:00.000Z"]
  ]
}</pre>
</div>
<h4><a id="esql-locale-param"></a>Returning localized results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>Use the <code class="literal">locale</code> parameter in the request body to return results (especially dates) formatted per the conventions of the locale.
If <code class="literal">locale</code> is not specified, defaults to <code class="literal">en-US</code> (English).
Refer to <a href="https://www.oracle.com/java/technologies/javase/jdk17-suported-locales.html" class="ulink" target="_top">JDK Supported Locales</a>.</p>
<p>Syntax: the <code class="literal">locale</code> parameter accepts language tags in the (case-insensitive) format <code class="literal">xy</code> and <code class="literal">xy-XY</code>.</p>
<p>For example, to return a month name in French:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  locale: "fr-FR",
  query:
    '\n          ROW birth_date_string = "2023-01-15T00:00:00.000Z"\n          | EVAL birth_date = date_parse(birth_date_string)\n          | EVAL month_of_birth = DATE_FORMAT("MMMM",birth_date)\n          | LIMIT 5\n   ',
});
console.log(response);</pre>
</div>
<a id="c4607ca79b2bcde39305d6f4f21cad37"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query
{
  "locale": "fr-FR",
  "query": """
          ROW birth_date_string = "2023-01-15T00:00:00.000Z"
          | EVAL birth_date = date_parse(birth_date_string)
          | EVAL month_of_birth = DATE_FORMAT("MMMM",birth_date)
          | LIMIT 5
   """
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1730.console"></div>
<h4><a id="esql-rest-params"></a>Passing parameters to a query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>Values, for example for a condition, can be passed to a query "inline", by
integrating the value in the query string itself:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  query:
    '\n    FROM library\n    | EVAL year = DATE_EXTRACT("year", release_date)\n    | WHERE page_count &gt; 300 AND author == "Frank Herbert"\n    | STATS count = COUNT(*) by year\n    | WHERE count &gt; 0\n    | LIMIT 5\n  ',
});
console.log(response);</pre>
</div>
<a id="6dcd3916679f6aa64f79524c75991ebd"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query
{
  "query": """
    FROM library
    | EVAL year = DATE_EXTRACT("year", release_date)
    | WHERE page_count &gt; 300 AND author == "Frank Herbert"
    | STATS count = COUNT(*) by year
    | WHERE count &gt; 0
    | LIMIT 5
  """
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1731.console"></div>
<p>To avoid any attempts of hacking or code injection, extract the values in a
separate list of parameters. Use question mark placeholders (<code class="literal">?</code>) in the query
string for each of the parameters:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  query:
    '\n    FROM library\n    | EVAL year = DATE_EXTRACT("year", release_date)\n    | WHERE page_count &gt; ? AND author == ?\n    | STATS count = COUNT(*) by year\n    | WHERE count &gt; ?\n    | LIMIT 5\n  ',
  params: [300, "Frank Herbert", 0],
});
console.log(response);</pre>
</div>
<a id="927b20a221f975b75d1227b67d0eb7e2"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query
{
  "query": """
    FROM library
    | EVAL year = DATE_EXTRACT("year", release_date)
    | WHERE page_count &gt; ? AND author == ?
    | STATS count = COUNT(*) by year
    | WHERE count &gt; ?
    | LIMIT 5
  """,
  "params": [300, "Frank Herbert", 0]
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1732.console"></div>
<p>The parameters can be named parameters or positional parameters.</p>
<p>Named parameters use question mark placeholders (<code class="literal">?</code>) followed by a string.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  query:
    '\n    FROM library\n    | EVAL year = DATE_EXTRACT("year", release_date)\n    | WHERE page_count &gt; ?page_count AND author == ?author\n    | STATS count = COUNT(*) by year\n    | WHERE count &gt; ?count\n    | LIMIT 5\n  ',
  params: [
    {
      page_count: 300,
    },
    {
      author: "Frank Herbert",
    },
    {
      count: 0,
    },
  ],
});
console.log(response);</pre>
</div>
<a id="7fde3ff91c4a2e7080444af37d5cd287"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query
{
  "query": """
    FROM library
    | EVAL year = DATE_EXTRACT("year", release_date)
    | WHERE page_count &gt; ?page_count AND author == ?author
    | STATS count = COUNT(*) by year
    | WHERE count &gt; ?count
    | LIMIT 5
  """,
  "params": [{"page_count" : 300}, {"author" : "Frank Herbert"}, {"count" : 0}]
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1733.console"></div>
<p>Positional parameters use question mark placeholders (<code class="literal">?</code>) followed by an
integer.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.query({
  query:
    '\n    FROM library\n    | EVAL year = DATE_EXTRACT("year", release_date)\n    | WHERE page_count &gt; ?1 AND author == ?2\n    | STATS count = COUNT(*) by year\n    | WHERE count &gt; ?3\n    | LIMIT 5\n  ',
  params: [300, "Frank Herbert", 0],
});
console.log(response);</pre>
</div>
<a id="9de4edafd22a8b9cb557632b2c8779cd"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query
{
  "query": """
    FROM library
    | EVAL year = DATE_EXTRACT("year", release_date)
    | WHERE page_count &gt; ?1 AND author == ?2
    | STATS count = COUNT(*) by year
    | WHERE count &gt; ?3
    | LIMIT 5
  """,
  "params": [300, "Frank Herbert", 0]
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1734.console"></div>
<h4><a id="esql-rest-async-query"></a>Running an async ES|QL query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>The <a class="xref" href="esql-async-query-api.html" title="ES|QL async query API">ES|QL async query API</a> lets you asynchronously
execute a query request, monitor its progress, and retrieve results when
they become available.</p>
<p>Executing an ES|QL query is commonly quite fast, however queries across
large data sets or frozen data can take some time. To avoid long waits,
run an async ES|QL query.</p>
<p>Queries initiated by the async query API may return results or not. The
<code class="literal">wait_for_completion_timeout</code> property determines how long to wait for
the results. If the results are not available by this time, a
<a class="xref" href="esql-async-query-api.html#esql-async-query-api-response-body-query-id">query id</a> is returned which
can be later used to retrieve the results. For example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.asyncQuery({});
console.log(response);</pre>
</div>
<a id="3f1fe5f5f99b98d0891f38003e10b636"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_query/async
{
  "query": """
    FROM library
    | EVAL year = DATE_TRUNC(1 YEARS, release_date)
    | STATS MAX(page_count) BY year
    | SORT year
    | LIMIT 5
  """,
  "wait_for_completion_timeout": "2s"
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1735.console"></div>
<p>If the results are not available within the given timeout period, 2
seconds in this case, no results are returned but rather a response that
includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A query ID
</li>
<li class="listitem">
An <code class="literal">is_running</code> value of <em>true</em>, indicating the query is ongoing
</li>
</ul>
</div>
<p>The query continues to run in the background without blocking other
requests.</p>
<a id="629d8404571b200cd16ac40ba40b1167"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_running": true
}</pre>
</div>
<p>To check the progress of an async query, use the <a class="xref" href="esql-async-query-get-api.html" title="ES|QL async query get API">ES|QL async query get API</a> with the query ID. Specify how long you&#8217;d like
to wait for complete results in the <code class="literal">wait_for_completion_timeout</code> parameter.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.esql.async_query_get(
  id: 'FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=',
  wait_for_completion_timeout: '30s'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.esql.asyncQueryGet({
  id: "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  wait_for_completion_timeout: "30s",
});
console.log(response);</pre>
</div>
<a id="2afdf0d83724953aa2875b5fb37d60cc"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">GET /_query/async/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?wait_for_completion_timeout=30s</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1736.console"></div>
<p>If the response&#8217;s <code class="literal">is_running</code> value is <code class="literal">false</code>, the query has finished
and the results are returned.</p>
<a id="40e357182857594f7cd6adc266fda532"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "is_running": false,
  "columns": ...
}</pre>
</div>
<p>Use the <a class="xref" href="esql-async-query-delete-api.html" title="ES|QL async query delete API">ES|QL async query delete API</a> to
delete an async query before the <code class="literal">keep_alive</code> period ends. If the query
is still running, Elasticsearch cancels it.</p>
<a id="67b71a95b6fe6c83faae51ea038a1bf1"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">DELETE /_query/async/FmdMX2pIang3UWhLRU5QS0lqdlppYncaMUpYQ05oSkpTc3kwZ21EdC1tbFJXQToxOTI=</pre>
</div>
<div class="console_widget" data-snippet="snippets/1737.console"></div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="esql-using.html">« Using ES|QL</a>
</span>
<span class="next">
<a href="esql-kibana.html">Using ES|QL in Kibana »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
