<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>GeoIP processor | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="GeoIP processor | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="processors.html" title="Ingest processor reference"/>
<link rel="prev" href="ingest-geo-grid-processor.html" title="Geo-grid processor"/>
<link rel="next" href="grok-processor.html" title="Grok processor"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="ingest-geo-grid-processor.html">« Geo-grid processor</a>
</span>
<span class="next">
<a href="grok-processor.html">Grok processor »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ingest.html">Ingest pipelines</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="processors.html">Ingest processor reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>GeoIP processor</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/processors/geoip.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="geoip-processor"></a>GeoIP processor<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/processors/geoip.asciidoc">edit</a></h2>
</div></div></div>

<p>The <code class="literal">geoip</code> processor adds information about the geographical location of an
IPv4 or IPv6 address.</p>
<p><a id="geoip-automatic-updates"></a>By default, the processor uses the GeoLite2 City, GeoLite2 Country, and GeoLite2
ASN IP geolocation databases from <a href="http://dev.maxmind.com/geoip/geoip2/geolite2/" class="ulink" target="_top">MaxMind</a>, shared under the
CC BY-SA 4.0 license. It automatically downloads these databases if your nodes can connect to <code class="literal">storage.googleapis.com</code> domain and either:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ingest.geoip.downloader.eager.download</code> is set to true
</li>
<li class="listitem">
your cluster has at least one pipeline with a <code class="literal">geoip</code> processor
</li>
</ul>
</div>
<p>Elasticsearch automatically downloads updates for these databases from the Elastic GeoIP
endpoint:
<a href="https://geoip.elastic.co/v1/database?elastic_geoip_service_tos=agree" class="ulink" target="_top">https://geoip.elastic.co/v1/database</a>.
To get download statistics for these updates, use the <a class="xref" href="geoip-stats-api.html" title="GeoIP stats API">GeoIP
stats API</a>.</p>
<p>If your cluster can&#8217;t connect to the Elastic GeoIP endpoint or you want to
manage your own updates, see <a class="xref" href="geoip-processor.html#manage-geoip-database-updates" title="Manage your own IP geolocation database updates">Manage your own IP geolocation database updates</a>.</p>
<p>If Elasticsearch can&#8217;t connect to the endpoint for 30 days all updated databases will become
invalid. Elasticsearch will stop enriching documents with geoip data and will add <code class="literal">tags: ["_geoip_expired_database"]</code>
field instead.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="using-ingest-geoip"></a>Using the <code class="literal">geoip</code> Processor in a Pipeline<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/processors/geoip.asciidoc">edit</a></h3>
</div></div></div>
<div class="table">
<a id="ingest-geoip-options"></a>
<p class="title"><strong>Table 22. <code class="literal">geoip</code> options</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="geoip options">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Required</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">field</code></p></td>
<td align="left" valign="top"><p>yes</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The field to get the ip address from for the geographical lookup.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">target_field</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>geoip</p></td>
<td align="left" valign="top"><p>The field that will hold the geographical information looked up from the MaxMind database.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">database_file</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>GeoLite2-City.mmdb</p></td>
<td align="left" valign="top"><p>The database filename referring to one of the automatically downloaded GeoLite2 databases (GeoLite2-City.mmdb, GeoLite2-Country.mmdb, or GeoLite2-ASN.mmdb) or the name of a supported database file in the <code class="literal">ingest-geoip</code> config directory.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">properties</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>[<code class="literal">continent_name</code>, <code class="literal">country_iso_code</code>, <code class="literal">country_name</code>, <code class="literal">region_iso_code</code>, <code class="literal">region_name</code>, <code class="literal">city_name</code>, <code class="literal">location</code>] *</p></td>
<td align="left" valign="top"><p>Controls what properties are added to the <code class="literal">target_field</code> based on the geoip lookup.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ignore_missing</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
<td align="left" valign="top"><p>If <code class="literal">true</code> and <code class="literal">field</code> does not exist, the processor quietly exits without modifying the document</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">first_only</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p>If <code class="literal">true</code> only first found geoip data will be returned, even if <code class="literal">field</code> contains array</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">download_database_on_pipeline_creation</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p>If <code class="literal">true</code> (and if <code class="literal">ingest.geoip.downloader.eager.download</code> is <code class="literal">false</code>), the missing database is downloaded when the pipeline is created. Else, the download is triggered by when the pipeline is used as the <code class="literal">default_pipeline</code> or <code class="literal">final_pipeline</code> in an index.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>*Depends on what is available in <code class="literal">database_file</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If a GeoLite2 City or GeoIP2 City database is used, then the following fields may be added under the <code class="literal">target_field</code>: <code class="literal">ip</code>,
<code class="literal">country_iso_code</code>, <code class="literal">country_name</code>, <code class="literal">continent_code</code>, <code class="literal">continent_name</code>, <code class="literal">region_iso_code</code>, <code class="literal">region_name</code>, <code class="literal">city_name</code>, <code class="literal">timezone</code>,
and <code class="literal">location</code>. The fields actually added depend on what has been found and which properties were configured in <code class="literal">properties</code>.
</li>
<li class="listitem">
If a GeoLite2 Country or GeoIP2 Country database is used, then the following fields may be added under the <code class="literal">target_field</code>: <code class="literal">ip</code>,
<code class="literal">country_iso_code</code>, <code class="literal">country_name</code>, <code class="literal">continent_code</code>, and <code class="literal">continent_name</code>. The fields actually added depend on what has been found
and which properties were configured in <code class="literal">properties</code>.
</li>
<li class="listitem">
If the GeoLite2 ASN database is used, then the following fields may be added under the <code class="literal">target_field</code>: <code class="literal">ip</code>,
<code class="literal">asn</code>, <code class="literal">organization_name</code> and <code class="literal">network</code>. The fields actually added depend on what has been found and which properties were configured
in <code class="literal">properties</code>.
</li>
<li class="listitem">
If the GeoIP2 Anonymous IP database is used, then the following fields may be added under the <code class="literal">target_field</code>: <code class="literal">ip</code>,
<code class="literal">hosting_provider</code>, <code class="literal">tor_exit_node</code>, <code class="literal">anonymous_vpn</code>, <code class="literal">anonymous</code>, <code class="literal">public_proxy</code>, and <code class="literal">residential_proxy</code>. The fields actually added
depend on what has been found and which properties were configured in <code class="literal">properties</code>.
</li>
<li class="listitem">
If the GeoIP2 Connection Type database is used, then the following fields may be added under the <code class="literal">target_field</code>: <code class="literal">ip</code>, and
<code class="literal">connection_type</code>. The fields actually added depend on what has been found and which properties were configured in <code class="literal">properties</code>.
</li>
<li class="listitem">
If the GeoIP2 Domain database is used, then the following fields may be added under the <code class="literal">target_field</code>: <code class="literal">ip</code>, and <code class="literal">domain</code>.
The fields actually added depend on what has been found and which properties were configured in <code class="literal">properties</code>.
</li>
<li class="listitem">
If the GeoIP2 ISP database is used, then the following fields may be added under the <code class="literal">target_field</code>: <code class="literal">ip</code>, <code class="literal">asn</code>,
<code class="literal">organization_name</code>, <code class="literal">network</code>, <code class="literal">isp</code>, <code class="literal">isp_organization</code>, <code class="literal">mobile_country_code</code>, and <code class="literal">mobile_network_code</code>. The fields actually added
depend on what has been found and which properties were configured in <code class="literal">properties</code>.
</li>
<li class="listitem">
If the GeoIP2 Enterprise database is used, then the following fields may be added under the <code class="literal">target_field</code>: <code class="literal">ip</code>,
<code class="literal">country_iso_code</code>, <code class="literal">country_name</code>, <code class="literal">continent_code</code>, <code class="literal">continent_name</code>, <code class="literal">region_iso_code</code>, <code class="literal">region_name</code>, <code class="literal">city_name</code>, <code class="literal">timezone</code>,
<code class="literal">location</code>, <code class="literal">asn</code>, <code class="literal">organization_name</code>, <code class="literal">network</code>, <code class="literal">hosting_provider</code>, <code class="literal">tor_exit_node</code>, <code class="literal">anonymous_vpn</code>, <code class="literal">anonymous</code>, <code class="literal">public_proxy</code>,
<code class="literal">residential_proxy</code>, <code class="literal">domain</code>, <code class="literal">isp</code>, <code class="literal">isp_organization</code>, <code class="literal">mobile_country_code</code>, <code class="literal">mobile_network_code</code>, <code class="literal">user_type</code>, and
<code class="literal">connection_type</code>. The fields actually added  depend on what has been found and which properties were configured in <code class="literal">properties</code>.
</li>
</ul>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Do not use the GeoIP2 Anonymous IP, GeoIP2 Connection Type, GeoIP2 Domain, GeoIP2 ISP, and GeoIP2 Enterprise databases in production environments. This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Here is an example that uses the default city database and adds the geographical information to the <code class="literal">geoip</code> field based on the <code class="literal">ip</code> field:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ingest.put_pipeline(
  id: 'geoip',
  body: {
    description: 'Add geoip info',
    processors: [
      {
        geoip: {
          field: 'ip'
        }
      }
    ]
  }
)
puts response

response = client.index(
  index: 'my-index-000001',
  id: 'my_id',
  pipeline: 'geoip',
  body: {
    ip: '89.160.20.128'
  }
)
puts response

response = client.get(
  index: 'my-index-000001',
  id: 'my_id'
)
puts response</pre>
</div>
<a id="b577e7e7eb5ce9d16cb582356e2cc45c"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT _ingest/pipeline/geoip
{
  "description" : "Add geoip info",
  "processors" : [
    {
      "geoip" : {
        "field" : "ip"
      }
    }
  ]
}
PUT my-index-000001/_doc/my_id?pipeline=geoip
{
  "ip": "89.160.20.128"
}
GET my-index-000001/_doc/my_id</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/805.console"></div>
<p>Which returns:</p>
<a id="869c19f696832e5a9b111be7422362a4"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_index": "my-index-000001",
  "_id": "my_id",
  "_version": 1,
  "_seq_no": 55,
  "_primary_term": 1,
  "_source": {
    "ip": "89.160.20.128",
    "geoip": {
      "continent_name": "Europe",
      "country_name": "Sweden",
      "country_iso_code": "SE",
      "city_name" : "Linköping",
      "region_iso_code" : "SE-E",
      "region_name" : "Östergötland County",
      "location": { "lat": 58.4167, "lon": 15.6167 }
    }
  }
}</pre>
</div>
<p>Here is an example that uses the default country database and adds the
geographical information to the <code class="literal">geo</code> field based on the <code class="literal">ip</code> field. Note that
this database is downloaded automatically. So this:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ingest.put_pipeline(
  id: 'geoip',
  body: {
    description: 'Add geoip info',
    processors: [
      {
        geoip: {
          field: 'ip',
          target_field: 'geo',
          database_file: 'GeoLite2-Country.mmdb'
        }
      }
    ]
  }
)
puts response

response = client.index(
  index: 'my-index-000001',
  id: 'my_id',
  pipeline: 'geoip',
  body: {
    ip: '89.160.20.128'
  }
)
puts response

response = client.get(
  index: 'my-index-000001',
  id: 'my_id'
)
puts response</pre>
</div>
<a id="3fab530a2e43807929c0ef3ebf7d268c"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT _ingest/pipeline/geoip
{
  "description" : "Add geoip info",
  "processors" : [
    {
      "geoip" : {
        "field" : "ip",
        "target_field" : "geo",
        "database_file" : "GeoLite2-Country.mmdb"
      }
    }
  ]
}
PUT my-index-000001/_doc/my_id?pipeline=geoip
{
  "ip": "89.160.20.128"
}
GET my-index-000001/_doc/my_id</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/806.console"></div>
<p>returns this:</p>
<a id="de4d83e1c7456d90c8cfc1b84410cdcf"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_index": "my-index-000001",
  "_id": "my_id",
  "_version": 1,
  "_seq_no": 65,
  "_primary_term": 1,
  "_source": {
    "ip": "89.160.20.128",
    "geo": {
      "continent_name": "Europe",
      "country_name": "Sweden",
      "country_iso_code": "SE"
    }
  }
}</pre>
</div>
<p>Not all IP addresses find geo information from the database, When this
occurs, no <code class="literal">target_field</code> is inserted into the document.</p>
<p>Here is an example of what documents will be indexed as when information for "80.231.5.0"
cannot be found:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ingest.put_pipeline(
  id: 'geoip',
  body: {
    description: 'Add geoip info',
    processors: [
      {
        geoip: {
          field: 'ip'
        }
      }
    ]
  }
)
puts response

response = client.index(
  index: 'my-index-000001',
  id: 'my_id',
  pipeline: 'geoip',
  body: {
    ip: '80.231.5.0'
  }
)
puts response

response = client.get(
  index: 'my-index-000001',
  id: 'my_id'
)
puts response</pre>
</div>
<a id="d3a558ef226e9dccc1c7c61e1167547f"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT _ingest/pipeline/geoip
{
  "description" : "Add geoip info",
  "processors" : [
    {
      "geoip" : {
        "field" : "ip"
      }
    }
  ]
}

PUT my-index-000001/_doc/my_id?pipeline=geoip
{
  "ip": "80.231.5.0"
}

GET my-index-000001/_doc/my_id</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/807.console"></div>
<p>Which returns:</p>
<a id="56bbc1c045a4b0a748561ae3ba2afa10"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "_index" : "my-index-000001",
  "_id" : "my_id",
  "_version" : 1,
  "_seq_no" : 71,
  "_primary_term": 1,
  "found" : true,
  "_source" : {
    "ip" : "80.231.5.0"
  }
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ingest-geoip-mappings-note"></a>Recognizing Location as a Geopoint<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/processors/geoip.asciidoc">edit</a></h4>
</div></div></div>
<p>Although this processor enriches your document with a <code class="literal">location</code> field containing
the estimated latitude and longitude of the IP address, this field will not be
indexed as a <a href="/guide/en/elasticsearch/reference/master/geo-point.html" class="ulink" target="_top"><code class="literal">geo_point</code></a> type in Elasticsearch without explicitly defining it
as such in the mapping.</p>
<p>You can use the following mapping for the example index above:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'my_ip_locations',
  body: {
    mappings: {
      properties: {
        geoip: {
          properties: {
            location: {
              type: 'geo_point'
            }
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<a id="0737ebaea33631f001fb3f4226948492"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT my_ip_locations
{
  "mappings": {
    "properties": {
      "geoip": {
        "properties": {
          "location": { "type": "geo_point" }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/808.console"></div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="manage-geoip-database-updates"></a>Manage your own IP geolocation database updates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/processors/geoip.asciidoc">edit</a></h3>
</div></div></div>
<p>If you can&#8217;t <a class="xref" href="geoip-processor.html#geoip-automatic-updates">automatically update</a> your IP geolocation databases
from the Elastic endpoint, you have a few other options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="geoip-processor.html#use-proxy-geoip-endpoint">Use a proxy endpoint</a>
</li>
<li class="listitem">
<a class="xref" href="geoip-processor.html#use-custom-geoip-endpoint">Use a custom endpoint</a>
</li>
<li class="listitem">
<a class="xref" href="geoip-processor.html#manually-update-geoip-databases">Manually update your IP geolocation databases</a>
</li>
</ul>
</div>
<p><a id="use-proxy-geoip-endpoint"></a><span class="strong strong"><strong>Use a proxy endpoint</strong></span></p>
<p>If you can&#8217;t connect directly to the Elastic GeoIP endpoint, consider setting up
a secure proxy. You can then specify the proxy endpoint URL in the
<a class="xref" href="geoip-processor.html#ingest-geoip-downloader-endpoint"><code class="literal">ingest.geoip.downloader.endpoint</code></a> setting
of each node’s <code class="literal">elasticsearch.yml</code> file.</p>
<p>In a strict setup the following domains may need to be added to the allowed
domains list:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">geoip.elastic.co</code>
</li>
<li class="listitem">
<code class="literal">storage.googleapis.com</code>
</li>
</ul>
</div>
<p><a id="use-custom-geoip-endpoint"></a><span class="strong strong"><strong>Use a custom endpoint</strong></span></p>
<p>You can create a service that mimics the Elastic GeoIP endpoint. You can then
get automatic updates from this service.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download your <code class="literal">.mmdb</code> database files from the
<a href="http://dev.maxmind.com/geoip/geoip2/geolite2" class="ulink" target="_top">MaxMind site</a>.
</li>
<li class="listitem">
Copy your database files to a single directory.
</li>
<li class="listitem">
<p>From your Elasticsearch directory, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">./bin/elasticsearch-geoip -s my/source/dir [-t target/directory]</pre>
</div>
</li>
<li class="listitem">
<p>Serve the static database files from your directory. For example, you can use
Docker to serve the files from an nginx server:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -v my/source/dir:/usr/share/nginx/html:ro nginx</pre>
</div>
</li>
<li class="listitem">
<p>Specify the service&#8217;s endpoint URL in the
<a class="xref" href="geoip-processor.html#ingest-geoip-downloader-endpoint"><code class="literal">ingest.geoip.downloader.endpoint</code></a> setting
of each node’s <code class="literal">elasticsearch.yml</code> file.</p>
<p>By default, Elasticsearch checks the endpoint for updates every three days. To use
another polling interval, use the <a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">cluster update
settings API</a> to set
<a class="xref" href="geoip-processor.html#ingest-geoip-downloader-poll-interval"><code class="literal">ingest.geoip.downloader.poll.interval</code></a>.</p>
</li>
</ol>
</div>
<p><a id="manually-update-geoip-databases"></a><span class="strong strong"><strong>Manually update your IP geolocation databases</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Use the <a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">cluster update settings API</a> to set
<code class="literal">ingest.geoip.downloader.enabled</code> to <code class="literal">false</code>. This disables automatic updates
that may overwrite your database changes. This also deletes all downloaded
databases.
</li>
<li class="listitem">
<p>Download your <code class="literal">.mmdb</code> database files from the
<a href="http://dev.maxmind.com/geoip/geoip2/geolite2" class="ulink" target="_top">MaxMind site</a>.</p>
<p>You can also use custom city, country, and ASN <code class="literal">.mmdb</code> files. These files must
be uncompressed. The type (city, country, or ASN) will be pulled from the file
metadata, so the filename does not matter.</p>
</li>
<li class="listitem">
On Elasticsearch Service deployments upload database using
a <a href="/guide/en/cloud/current/ec-custom-bundles.html" class="ulink" target="_top">custom bundle</a>.
</li>
<li class="listitem">
On self-managed deployments copy the database files to <code class="literal">$ES_CONFIG/ingest-geoip</code>.
</li>
<li class="listitem">
In your <code class="literal">geoip</code> processors, configure the <code class="literal">database_file</code> parameter to use a
custom database file.
</li>
</ol>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ingest-geoip-settings"></a>Node Settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/processors/geoip.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">geoip</code> processor supports the following setting:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">ingest.geoip.cache_size</code>
</span>
</dt>
<dd>
The maximum number of results that should be cached. Defaults to <code class="literal">1000</code>.
</dd>
</dl>
</div>
<p>Note that these settings are node settings and apply to all <code class="literal">geoip</code> processors, i.e. there is one cache for all defined <code class="literal">geoip</code> processors.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="geoip-cluster-settings"></a>Cluster settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/processors/geoip.asciidoc">edit</a></h4>
</div></div></div>
<div class="variablelist">
<a id="ingest-geoip-downloader-enabled"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">ingest.geoip.downloader.enabled</code>
</span>
</dt>
<dd>
(<a class="xref" href="settings.html#dynamic-cluster-setting">Dynamic</a>, Boolean)
If <code class="literal">true</code>, Elasticsearch automatically downloads and manages updates for IP geolocation databases
from the <code class="literal">ingest.geoip.downloader.endpoint</code>. If <code class="literal">false</code>, Elasticsearch does not download
updates and deletes all downloaded databases. Defaults to <code class="literal">true</code>.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="ingest-geoip-downloader-eager-download"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">ingest.geoip.downloader.eager.download</code>
</span>
</dt>
<dd>
(<a class="xref" href="settings.html#dynamic-cluster-setting">Dynamic</a>, Boolean)
If <code class="literal">true</code>, Elasticsearch downloads IP geolocation databases immediately, regardless of whether a
pipeline exists with a geoip processor. If <code class="literal">false</code>, Elasticsearch only begins downloading
the databases if a pipeline with a geoip processor exists or is added. Defaults
to <code class="literal">false</code>.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="ingest-geoip-downloader-endpoint"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">ingest.geoip.downloader.endpoint</code>
</span>
</dt>
<dd>
(<a class="xref" href="settings.html#static-cluster-setting">Static</a>, string)
Endpoint URL used to download updates for IP geolocation databases. For example, <code class="literal">https://myDomain.com/overview.json</code>.
Defaults to <code class="literal">https://geoip.elastic.co/v1/database</code>. Elasticsearch stores downloaded database files in
each node&#8217;s <a class="xref" href="important-settings.html#es-tmpdir" title="Temporary directory settings">temporary directory</a> at <code class="literal">$ES_TMPDIR/geoip-databases/&lt;node_id&gt;</code>.
Note that Elasticsearch will make a GET request to <code class="literal">${ingest.geoip.downloader.endpoint}?elastic_geoip_service_tos=agree</code>,
expecting the list of metadata about databases typically found in <code class="literal">overview.json</code>.
</dd>
</dl>
</div>
<p>The GeoIP downloader uses the JDK&#8217;s builtin cacerts. If you&#8217;re using a custom endpoint, add the custom https endpoint cacert(s) to the JDK&#8217;s truststore.</p>
<div class="variablelist">
<a id="ingest-geoip-downloader-poll-interval"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">ingest.geoip.downloader.poll.interval</code>
</span>
</dt>
<dd>
(<a class="xref" href="settings.html#dynamic-cluster-setting">Dynamic</a>, <a class="xref" href="api-conventions.html#time-units" title="Time units">time value</a>)
How often Elasticsearch checks for IP geolocation database updates at the
<code class="literal">ingest.geoip.downloader.endpoint</code>. Must be greater than <code class="literal">1d</code> (one day). Defaults
to <code class="literal">3d</code> (three days).
</dd>
</dl>
</div>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ingest-geo-grid-processor.html">« Geo-grid processor</a>
</span>
<span class="next">
<a href="grok-processor.html">Grok processor »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
