<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tutorial: Automate rollover with ILM | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Tutorial: Automate rollover with ILM | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="data-management.html" title="Data management"/>
<link rel="prev" href="example-using-index-lifecycle-policy.html" title="Tutorial: Customize built-in ILM policies"/>
<link rel="next" href="index-mgmt.html" title="Index management in Kibana"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="example-using-index-lifecycle-policy.html">« Tutorial: Customize built-in ILM policies</a>
</span>
<span class="next">
<a href="index-mgmt.html">Index management in Kibana »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-management.html">Data management</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Tutorial: Automate rollover with ILM</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="getting-started-index-lifecycle-management"></a>Tutorial: Automate rollover with ILM<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h2>
</div></div></div>

<p>When you continuously index timestamped documents into Elasticsearch,
you typically use a <a class="xref" href="data-streams.html" title="Data streams">data stream</a> so you can periodically <a class="xref" href="index-rollover.html" title="Rollover">roll over</a> to a
new index.
This enables you to implement a <a class="xref" href="data-tiers.html" title="Data tiers">hot-warm-cold architecture</a> to meet your performance
requirements for your newest data, control costs over time, enforce retention policies,
and still get the most out of your data.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p><a class="xref" href="data-streams.html" title="Data streams">Data streams</a> are best suited for
<a class="xref" href="data-streams.html#data-streams-append-only" title="Append-only (mostly)">append-only</a> use cases. If you need to update or delete existing time
series data, you can perform update or delete operations directly on the data stream backing index.
If you frequently send multiple documents using the same <code class="literal">_id</code> expecting last-write-wins, you may
want to use an index alias with a write index instead. You can still use <a class="xref" href="index-lifecycle-management.html" title="ILM: Manage the index lifecycle">ILM</a> to manage and <a class="xref" href="index-rollover.html" title="Rollover">roll over</a>
the alias&#8217;s indices. Skip to <a class="xref" href="getting-started-index-lifecycle-management.html#manage-time-series-data-without-data-streams" title="Manage time series data without data streams">Manage time series data without data streams</a>.</p>
</div>
</div>
<h3><a id="manage-time-series-data-with-data-streams"></a>Manage time series data with data streams<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h3>
<p>To automate rollover and management of a data stream with ILM, you:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-create-policy" title="Create a lifecycle policy">Create a lifecycle policy</a> that defines the appropriate
<a class="xref" href="ilm-index-lifecycle.html" title="Index lifecycle">phases</a> and <a class="xref" href="ilm-actions.html" title="Index lifecycle actions">actions</a>.
</li>
<li class="listitem">
<a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-apply-policy" title="Create an index template to create the data stream and apply the lifecycle policy">Create an index template</a> to <a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-create-the-data-stream" title="Create the data stream">create the data stream</a> and
apply the ILM policy and the indices settings and mappings configurations for the backing
indices.
</li>
<li class="listitem">
<a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-check-progress" title="Check lifecycle progress">Verify indices are moving through the lifecycle phases</a>
as expected.
</li>
</ol>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you enable index lifecycle management for Beats or the Logstash Elasticsearch output plugin,
lifecycle policies are set up automatically.
You do not need to take any other actions.
You can modify the default policies through
<a class="xref" href="example-using-index-lifecycle-policy.html" title="Tutorial: Customize built-in ILM policies">Kibana Management</a>
or the ILM APIs.</p>
</div>
</div>
<h4><a id="ilm-gs-create-policy"></a>Create a lifecycle policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h4>
<p>A lifecycle policy specifies the phases in the index lifecycle
and the actions to perform in each phase. A lifecycle can have up to five phases:
<code class="literal">hot</code>, <code class="literal">warm</code>, <code class="literal">cold</code>, <code class="literal">frozen</code>, and <code class="literal">delete</code>.</p>
<p>For example, you might define a <code class="literal">timeseries_policy</code> that has two phases:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A <code class="literal">hot</code> phase that defines a rollover action to specify that an index rolls over when it
reaches either a <code class="literal">max_primary_shard_size</code> of 50 gigabytes or a <code class="literal">max_age</code> of 30 days.
</li>
<li class="listitem">
A <code class="literal">delete</code> phase that sets <code class="literal">min_age</code> to remove the index 90 days after rollover.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">min_age</code> value is relative to the rollover time, not the index creation time. <a class="xref" href="index-lifecycle-error-handling.html#min-age-calculation" title="How min_age is calculated">Learn more</a>.</p>
</div>
</div>
<p>You can create the policy through Kibana or with the
<a class="xref" href="ilm-put-lifecycle.html" title="Create or update lifecycle policy API">create or update policy</a> API.
To create the policy from Kibana, open the menu and go to <span class="strong strong"><strong>Stack Management &gt;
Index Lifecycle Policies</strong></span>. Click <span class="strong strong"><strong>Create policy</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/create-policy.png" alt="Create policy page">
</div>
</div>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'timeseries_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_primary_shard_size: '50GB',
              max_age: '30d'
            }
          }
        },
        delete: {
          min_age: '90d',
          actions: {
            delete: {}
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "timeseries_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_primary_shard_size: "50GB",
            max_age: "30d",
          },
        },
      },
      delete: {
        min_age: "90d",
        actions: {
          delete: {},
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="cb3c483816b6ea150ff6c559fa144d32"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/timeseries_policy
{
  "policy": {
    "phases": {
      "hot": {                                <a id="CO587-1"></a><i class="conum" data-value="1"></i>
        "actions": {
          "rollover": {
            "max_primary_shard_size": "50GB", <a id="CO587-2"></a><i class="conum" data-value="2"></i>
            "max_age": "30d"
          }
        }
      },
      "delete": {
        "min_age": "90d",                     <a id="CO587-3"></a><i class="conum" data-value="3"></i>
        "actions": {
          "delete": {}                        <a id="CO587-4"></a><i class="conum" data-value="4"></i>
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1816.console"></div>
<div class="calloutlist default has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO587-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">min_age</code> defaults to <code class="literal">0ms</code>, so new indices enter the <code class="literal">hot</code> phase immediately.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO587-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Trigger the <code class="literal">rollover</code> action when either of the conditions are met.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO587-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Move the index into the <code class="literal">delete</code> phase 90 days after rollover.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO587-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Trigger the <code class="literal">delete</code> action when the index enters the delete phase.</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<h4><a id="ilm-gs-apply-policy"></a>Create an index template to create the data stream and apply the lifecycle policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h4>
<p>To set up a data stream, first create an index template to specify the lifecycle policy. Because
the template is for a data stream, it must also include a <code class="literal">data_stream</code> definition.</p>
<p>For example, you might create a <code class="literal">timeseries_template</code> to use for a future data stream
named <code class="literal">timeseries</code>.</p>
<p>To enable the ILM to manage the data stream, the template configures one ILM setting:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">index.lifecycle.name</code> specifies the name of the lifecycle policy to apply to the data stream.
</li>
</ul>
</div>
<p>You can use the Kibana Create template wizard to add the template. From Kibana,
open the menu and go to <span class="strong strong"><strong>Stack Management &gt; Index Management</strong></span>. In the <span class="strong strong"><strong>Index
Templates</strong></span> tab, click <span class="strong strong"><strong>Create template</strong></span>.</p>
<div class="imageblock">
<div class="content">
<img src="images/data-streams/create-index-template.png" alt="Create template page">
</div>
</div>
<p>This wizard invokes the <a class="xref" href="indices-put-template.html" title="Create or update index template API">create or update index template
API</a> to create the index template with the options you specify.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_index_template(
  name: 'timeseries_template',
  body: {
    index_patterns: [
      'timeseries'
    ],
    data_stream: {},
    template: {
      settings: {
        number_of_shards: 1,
        number_of_replicas: 1,
        'index.lifecycle.name' =&gt; 'timeseries_policy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putIndexTemplate({
  name: "timeseries_template",
  index_patterns: ["timeseries"],
  data_stream: {},
  template: {
    settings: {
      number_of_shards: 1,
      number_of_replicas: 1,
      "index.lifecycle.name": "timeseries_policy",
    },
  },
});
console.log(response);</pre>
</div>
<a id="09bdf9a7e22733d668476724042a406c"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _index_template/timeseries_template
{
  "index_patterns": ["timeseries"],                   <a id="CO588-1"></a><i class="conum" data-value="1"></i>
  "data_stream": { },
  "template": {
    "settings": {
      "number_of_shards": 1,
      "number_of_replicas": 1,
      "index.lifecycle.name": "timeseries_policy"     <a id="CO588-2"></a><i class="conum" data-value="2"></i>
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1817.console"></div>
<div class="calloutlist default has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO588-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Apply the template when a document is indexed into the <code class="literal">timeseries</code> target.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO588-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the ILM policy used to manage the data stream.</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<h4><a id="ilm-gs-create-the-data-stream"></a>Create the data stream<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h4>
<p>To get things started, index a document into the name or wildcard pattern defined
in the <code class="literal">index_patterns</code> of the <a class="xref" href="index-templates.html" title="Index templates">index template</a>. As long
as an existing data stream, index, or index alias does not already use the name, the index
request automatically creates a corresponding data stream with a single backing index.
Elasticsearch automatically indexes the request&#8217;s documents into this backing index, which also
acts as the stream&#8217;s <a class="xref" href="data-streams.html#data-stream-write-index" title="Write index">write index</a>.</p>
<p>For example, the following request creates the <code class="literal">timeseries</code> data stream and the
first generation backing index called <code class="literal">.ds-timeseries-2099.03.08-000001</code>.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.index(
  index: 'timeseries',
  body: {
    message: 'logged the request',
    "@timestamp": '1591890611'
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.index({
  index: "timeseries",
  document: {
    message: "logged the request",
    "@timestamp": "1591890611",
  },
});
console.log(response);</pre>
</div>
<a id="a62833baf15f2c9ac094a9289e56a012"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">POST timeseries/_doc
{
  "message": "logged the request",
  "@timestamp": "1591890611"
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1818.console"></div>
<p>When a rollover condition in the lifecycle policy is met, the <code class="literal">rollover</code> action:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Creates the second generation backing index, named
<code class="literal">.ds-timeseries-2099.03.08-000002</code>. Because it is a backing index of the
<code class="literal">timeseries</code> data stream, the configuration from the <code class="literal">timeseries_template</code> index
template is applied to the new index.
</li>
<li class="listitem">
As it is the latest generation index of the <code class="literal">timeseries</code> data stream, the
newly created backing index <code class="literal">.ds-timeseries-2099.03.08-000002</code> becomes the data
stream&#8217;s write index.
</li>
</ul>
</div>
<p>This process repeats each time a rollover condition is met.
You can search across all of the data stream&#8217;s backing indices, managed by the <code class="literal">timeseries_policy</code>,
with the <code class="literal">timeseries</code> data stream name.
Write operations should be sent to the data stream name, which will route them to its current write index.
Read operations against the data stream will be handled by all its backing indices.</p>
<h4><a id="ilm-gs-check-progress"></a>Check lifecycle progress<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h4>
<p>To get status information for managed indices, you use the ILM explain API.
This lets you find out things like:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
What phase an index is in and when it entered that phase.
</li>
<li class="listitem">
The current action and what step is being performed.
</li>
<li class="listitem">
If any errors have occurred or progress is blocked.
</li>
</ul>
</div>
<p>For example, the following request gets information about the <code class="literal">timeseries</code> data stream&#8217;s
backing indices:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.explain_lifecycle(
  index: '.ds-timeseries-*'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.explainLifecycle({
  index: ".ds-timeseries-*",
});
console.log(response);</pre>
</div>
<a id="ea66a620c23337545e409c120c4ed5d9"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">GET .ds-timeseries-*/_ilm/explain</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1819.console"></div>
<p>The following response shows the data stream&#8217;s first generation backing index is waiting for the <code class="literal">hot</code>
phase&#8217;s <code class="literal">rollover</code> action.
It remains in this state and ILM continues to call <code class="literal">check-rollover-ready</code> until a rollover condition
is met.</p>
<a id="7b43be48f4df33f28a007ff569ed7ca2"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "indices": {
    ".ds-timeseries-2099.03.07-000001": {
      "index": ".ds-timeseries-2099.03.07-000001",
      "index_creation_date_millis": 1538475653281,
      "time_since_index_creation": "30s",        <a id="CO589-1"></a><i class="conum" data-value="1"></i>
      "managed": true,
      "policy": "timeseries_policy",             <a id="CO589-2"></a><i class="conum" data-value="2"></i>
      "lifecycle_date_millis": 1538475653281,
      "age": "30s",                              <a id="CO589-3"></a><i class="conum" data-value="3"></i>
      "phase": "hot",
      "phase_time_millis": 1538475653317,
      "action": "rollover",
      "action_time_millis": 1538475653317,
      "step": "check-rollover-ready",            <a id="CO589-4"></a><i class="conum" data-value="4"></i>
      "step_time_millis": 1538475653317,
      "phase_execution": {
        "policy": "timeseries_policy",
        "phase_definition": {                    <a id="CO589-5"></a><i class="conum" data-value="5"></i>
          "min_age": "0ms",
          "actions": {
            "rollover": {
              "max_primary_shard_size": "50gb",
              "max_age": "30d"
            }
          }
        },
        "version": 1,
        "modified_date_in_millis": 1539609701576
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO589-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The age of the index used for calculating when to rollover the index via the <code class="literal">max_age</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO589-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The policy used to manage the index</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO589-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The age of the indexed used to transition to the next phase (in this case it is the same with the age of the index).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO589-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The step ILM is performing on the index</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO589-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The definition of the current phase (the <code class="literal">hot</code> phase)</p>
</td>
</tr>
</table>
</div>
<h3><a id="manage-time-series-data-without-data-streams"></a>Manage time series data without data streams<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h3>
<p>Even though <a class="xref" href="data-streams.html" title="Data streams">data streams</a> are a convenient way to scale and manage time series
data, they are designed to be append-only. We recognise there might be use-cases where data needs to
be updated or deleted in place and the data streams don&#8217;t support delete and update requests
directly, so the index APIs would need to be used directly on the data stream&#8217;s backing indices. In
these cases we still recommend using a data stream.</p>
<p>If you frequently send multiple documents using the same <code class="literal">_id</code> expecting last-write-wins, you can
use an index alias instead of a data stream to manage indices containing the time series data and
periodically roll over to a new index.</p>
<p>To automate rollover and management of time series indices with ILM using an index
alias, you:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create a lifecycle policy that defines the appropriate phases and actions.
See <a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-create-policy" title="Create a lifecycle policy">Create a lifecycle policy</a> above.
</li>
<li class="listitem">
<a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-alias-apply-policy" title="Create an index template to apply the lifecycle policy">Create an index template</a> to apply the policy to each new index.
</li>
<li class="listitem">
<a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-alias-bootstrap" title="Bootstrap the initial time series index with a write index alias">Bootstrap an index</a> as the initial write index.
</li>
<li class="listitem">
<a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-alias-check-progress" title="Check lifecycle progress">Verify indices are moving through the lifecycle phases</a>
as expected.
</li>
</ol>
</div>
<h4><a id="ilm-gs-alias-apply-policy"></a>Create an index template to apply the lifecycle policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h4>
<p>To automatically apply a lifecycle policy to the new write index on rollover,
specify the policy in the index template used to create new indices.</p>
<p>For example, you might create a <code class="literal">timeseries_template</code> that is applied to new indices
whose names match the <code class="literal">timeseries-*</code> index pattern.</p>
<p>To enable automatic rollover, the template configures two ILM settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">index.lifecycle.name</code> specifies the name of the lifecycle policy to apply to new indices
that match the index pattern.
</li>
<li class="listitem">
<code class="literal">index.lifecycle.rollover_alias</code> specifies the index alias to be rolled over
when the rollover action is triggered for an index.
</li>
</ul>
</div>
<p>You can use the Kibana Create template wizard to add the template. To access the
wizard, open the menu and go to <span class="strong strong"><strong>Stack Management &gt; Index Management</strong></span>. In the
<span class="strong strong"><strong>Index Templates</strong></span> tab, click <span class="strong strong"><strong>Create template</strong></span>.</p>
<p class="screenshot"><span class="image"><img src="images/ilm/create-template-wizard.png" alt="Create template page"></span></p>
<p>The create template request for the example template looks like this:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putIndexTemplate({
  name: "timeseries_template",
  index_patterns: ["timeseries-*"],
  template: {
    settings: {
      number_of_shards: 1,
      number_of_replicas: 1,
      "index.lifecycle.name": "timeseries_policy",
      "index.lifecycle.rollover_alias": "timeseries",
    },
  },
});
console.log(response);</pre>
</div>
<a id="69daf5ec2a9bc07096e1833286c36076"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _index_template/timeseries_template
{
  "index_patterns": ["timeseries-*"],                 <a id="CO590-1"></a><i class="conum" data-value="1"></i>
  "template": {
    "settings": {
      "number_of_shards": 1,
      "number_of_replicas": 1,
      "index.lifecycle.name": "timeseries_policy",      <a id="CO590-2"></a><i class="conum" data-value="2"></i>
      "index.lifecycle.rollover_alias": "timeseries"    <a id="CO590-3"></a><i class="conum" data-value="3"></i>
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1820.console"></div>
<div class="calloutlist default has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO590-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Apply the template to a new index if its name starts with <code class="literal">timeseries-</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO590-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the lifecycle policy to apply to each new index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO590-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the alias used to reference these indices.
Required for policies that use the rollover action.</p>
</td>
</tr>
</table>
</div>
<h4><a id="ilm-gs-alias-bootstrap"></a>Bootstrap the initial time series index with a write index alias<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h4>
<p>To get things started, you need to bootstrap an initial index and
designate it as the write index for the rollover alias specified in your index template.
The name of this index must match the template&#8217;s index pattern and end with a number.
On rollover, this value is incremented to generate a name for the new index.</p>
<p>For example, the following request creates an index called <code class="literal">timeseries-000001</code>
and makes it the write index for the <code class="literal">timeseries</code> alias.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "timeseries-000001",
  aliases: {
    timeseries: {
      is_write_index: true,
    },
  },
});
console.log(response);</pre>
</div>
<a id="7148c8512079d378af70302e65502dd2"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT timeseries-000001
{
  "aliases": {
    "timeseries": {
      "is_write_index": true
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1821.console"></div>
<p>When the rollover conditions are met, the <code class="literal">rollover</code> action:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Creates a new index called <code class="literal">timeseries-000002</code>.
This matches the <code class="literal">timeseries-*</code> pattern, so the settings from <code class="literal">timeseries_template</code> are applied to the new index.
</li>
<li class="listitem">
Designates the new index as the write index and makes the bootstrap index read-only.
</li>
</ul>
</div>
<p>This process repeats each time rollover conditions are met.
You can search across all of the indices managed by the <code class="literal">timeseries_policy</code> with the <code class="literal">timeseries</code> alias.
Write operations should be sent towards the alias, which will route them to its current write index.</p>
<h4><a id="ilm-gs-alias-check-progress"></a>Check lifecycle progress<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/ilm-tutorial.asciidoc">edit</a></h4>
<p>Retrieving the status information for managed indices is very similar to the data stream case.
See the data stream <a class="xref" href="getting-started-index-lifecycle-management.html#ilm-gs-check-progress" title="Check lifecycle progress">check progress section</a> for more information.
The only difference is the indices namespace, so retrieving the progress will entail the following
api call:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.explain_lifecycle(
  index: 'timeseries-*'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.explainLifecycle({
  index: "timeseries-*",
});
console.log(response);</pre>
</div>
<a id="2ffa953b29ed0156c9e610daf66b8e48"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">GET timeseries-*/_ilm/explain</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1822.console"></div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="example-using-index-lifecycle-policy.html">« Tutorial: Customize built-in ILM policies</a>
</span>
<span class="next">
<a href="index-mgmt.html">Index management in Kibana »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
