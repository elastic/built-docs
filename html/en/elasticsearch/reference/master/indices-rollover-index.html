<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Rollover index API | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="indices.html" title="Index APIs"/>
<link rel="prev" href="indices-refresh.html" title="Refresh API"/>
<link rel="next" href="indices-shrink-index.html" title="Shrink index API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="indices.html">Index APIs</a></span>
»
<span class="breadcrumb-node">Rollover index API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="indices-refresh.html">« Refresh API</a>
</span>
<span class="next">
<a href="indices-shrink-index.html">Shrink index API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="indices-rollover-index"></a>Rollover index API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h2>
</div></div></div>

<p>Creates a new index for a rollover target when the target&#8217;s existing index meets
a condition you provide. A rollover target can be either an
<a class="xref" href="indices-aliases.html" title="Update index alias API">index alias</a> or a
<a class="xref" href="indices-create-data-stream.html" title="Create data stream API">data stream</a>. When targeting an alias, the alias
is updated to point to the new index. When targeting a data stream, the new
index becomes the data stream&#8217;s write index and its generation is incremented.</p>
<a id="3df8785e8ccc78945a1ae7d6c4db2591"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /alias1/_rollover/my-index-000002
{
  "conditions": {
    "max_age":   "7d",
    "max_docs":  1000,
    "max_size": "5gb"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1961.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="rollover-index-api-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /&lt;rollover-target&gt;/_rollover/&lt;target-index&gt;</code></p>
<p><code class="literal">POST /&lt;rollover-target&gt;/_rollover/</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="rollover-index-api-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">manage</code>
<a class="xref" href="security-privileges.html#privileges-list-indices" title="Indices privileges">index privilege</a> for the rollover target.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="rollover-index-api-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h3>
</div></div></div>
<p>The rollover index API rolls a rollover target to a new index when the existing
index meets a condition you provide. You can use this API to retire an index
that becomes too large or too old.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To roll over an index, a condition must be met <span class="strong strong"><strong>when you call the API</strong></span>.
Elasticsearch does not monitor the index after you receive an API response. To
automatically roll over indices when a condition is met, you can use Elasticsearch&#8217;s
<a class="xref" href="index-lifecycle-management.html" title="ILM: Manage the index lifecycle">index lifecycle management (ILM) policies</a>.</p>
</div>
</div>
<p>The rollover index API accepts a rollover target name
and a list of <code class="literal">conditions</code>.</p>
<p>If the specified rollover target is an alias pointing to a single index,
the rollover request:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Creates a new index
</li>
<li class="listitem">
Adds the alias to the new index
</li>
<li class="listitem">
Removes the alias from the original index
</li>
</ol>
</div>
<p>If the specified rollover target is an alias pointing to multiple indices,
one of these indices must have <code class="literal">is_write_index</code> set to <code class="literal">true</code>.
In this case, the rollover request:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Creates a new index
</li>
<li class="listitem">
Sets <code class="literal">is_write_index</code> to <code class="literal">true</code> for the new index
</li>
<li class="listitem">
Sets <code class="literal">is_write_index</code> to <code class="literal">false</code> for the original index
</li>
</ol>
</div>
<p>If the specified rollover target is a data stream, the rollover request:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Creates a new index
</li>
<li class="listitem">
Adds the new index as a backing index and the write index on the data stream
</li>
<li class="listitem">
Increments the <code class="literal">generation</code> attribute of the data stream
</li>
</ol>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="rollover-wait-active-shards"></a>Wait for active shards<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h4>
</div></div></div>
<p>Because the rollover operation creates a new index to rollover to, the
<a class="xref" href="indices-create-index.html#create-index-wait-for-active-shards" title="Wait for active shards"><code class="literal">wait_for_active_shards</code></a> setting on
index creation applies to the rollover action.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="rollover-index-api-path-params"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;rollover-target&gt;</code>
</span>
</dt>
<dd>
(Required*, string)
Name of the existing index alias or data stream on which to
perform the rollover.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;target-index&gt;</code>
</span>
</dt>
<dd>
<p>(Optional*, string)
Name of the target index to create and assign the index alias.</p>
<p>Index names must meet the following criteria:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Lowercase only
</li>
<li class="listitem">
Cannot include <code class="literal">\</code>, <code class="literal">/</code>, <code class="literal">*</code>, <code class="literal">?</code>, <code class="literal">"</code>, <code class="literal">&lt;</code>, <code class="literal">&gt;</code>, <code class="literal">|</code>, ` ` (space character), <code class="literal">,</code>, <code class="literal">#</code>
</li>
<li class="listitem">
Indices prior to 7.0 could contain a colon (<code class="literal">:</code>), but that&#8217;s been deprecated and won&#8217;t be supported in 7.0+
</li>
<li class="listitem">
Cannot start with <code class="literal">-</code>, <code class="literal">_</code>, <code class="literal">+</code>
</li>
<li class="listitem">
Cannot be <code class="literal">.</code> or <code class="literal">..</code>
</li>
<li class="listitem">
Cannot be longer than 255 bytes (note it is bytes, so multi-byte characters will count towards the 255 limit faster)
</li>
<li class="listitem">
Names starting with <code class="literal">.</code> are deprecated, except for <a class="xref" href="index-modules.html#index-hidden">hidden indices</a> and internal indices managed by plugins
</li>
</ul>
</div>
<p>*This parameter is not permitted if <code class="literal">rollover-target</code> is a data stream. In
that case, the new index name will be in the form <code class="literal">&lt;rollover-target&gt;-000001</code>
where the zero-padded number of length 6 is the generation of the data stream.</p>
<p>If <code class="literal">rollover-target</code> is an alias that is assigned to an index name that ends
with <code class="literal">-</code> and a number such as <code class="literal">logs-000001</code>. In this case, the name of the new
index follows the same pattern and increments the number. For example,
<code class="literal">logs-000001</code> increments to <code class="literal">logs-000002</code>. This number is zero-padded with a
length of 6, regardless of the prior index name.</p>
<p>If the existing index for the alias does not match this pattern, this parameter
is required.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="rollover-index-api-query-params"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">dry_run</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>,
the request checks whether the index matches provided conditions
but does not perform a rollover.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_active_shards</code>
</span>
</dt>
<dd>
<p>(Optional, string) The number of shard copies that must be active before
proceeding with the operation. Set to <code class="literal">all</code> or any positive integer up
to the total number of shards in the index (<code class="literal">number_of_replicas+1</code>).
Default: 1, the primary shard.</p>
<p>See <a class="xref" href="docs-index_.html#index-wait-for-active-shards" title="Active shards">Active shards</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">master_timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>)
Period to wait for a connection to the master node. If no response is received
before the timeout expires, the request fails and returns an error. Defaults to
<code class="literal">30s</code>.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>)
Period to wait for a response. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code class="literal">30s</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="rollover-index-api-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aliases</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="indices-aliases.html" title="Update index alias API">alias object</a>) Index aliases which include the
index. See <a class="xref" href="indices-aliases.html" title="Update index alias API">Update index alias</a>.
</dd>
<dt>
<span class="term">
<code class="literal">conditions</code>
</span>
</dt>
<dd>
<p>(Optional, object)
If supplied, the set of conditions the rollover target&#8217;s existing index must
meet to roll over. If omitted, the rollover will be performed unconditionally.</p>
<p>Parameters include:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">max_age</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>)
Maximum age of the index.
</dd>
<dt>
<span class="term">
<code class="literal">max_docs</code>
</span>
</dt>
<dd>
(Optional, integer)
Maximum number of documents in the index.
Documents added since the last refresh are not included in the document count.
The document count does <span class="strong strong"><strong>not</strong></span> include documents in replica shards.
</dd>
<dt>
<span class="term">
<code class="literal">max_size</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#byte-units" title="Byte size units">byte units</a>)
Maximum index size.
This is the total size of all primary shards in the index.
Replicas are not counted toward the maximum index size.
</dd>
</dl>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To see the current index size, use the <a class="xref" href="cat-indices.html" title="cat indices API">_cat indices</a> API.
The <code class="literal">pri.store.size</code> value shows the combined size of all primary shards.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">mappings</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="mapping.html" title="Mapping">mapping object</a>) Mapping for fields in the index. If
specified, this mapping can include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Field names
</li>
<li class="listitem">
<a class="xref" href="mapping-types.html" title="Field data types">Field data types</a>
</li>
<li class="listitem">
<a class="xref" href="mapping-params.html" title="Mapping parameters">Mapping parameters</a>
</li>
</ul>
</div>
<p>See <a class="xref" href="mapping.html" title="Mapping">Mapping</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">settings</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="index-modules.html#index-modules-settings" title="Index Settings">index setting object</a>) Configuration
options for the index. See <a class="xref" href="index-modules.html#index-modules-settings" title="Index Settings">Index Settings</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="rollover-index-api-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="rollover-index-basic-ex"></a>Basic example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h4>
</div></div></div>
<a id="593c11e8a9f88ec2629f2eb33cded9b7"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /logs-000001 <a id="CO610-1"></a><i class="conum" data-value="1"></i>
{
  "aliases": {
    "logs_write": {}
  }
}

# Add &gt; 1000 documents to logs-000001

POST /logs_write/_rollover <a id="CO610-2"></a><i class="conum" data-value="2"></i>
{
  "conditions": {
    "max_age":   "7d",
    "max_docs":  1000,
    "max_size":  "5gb"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1962.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO610-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates an index called <code class="literal">logs-0000001</code> with the alias <code class="literal">logs_write</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO610-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>If the index pointed to by <code class="literal">logs_write</code> was created 7 or more days ago, or
contains 1,000 or more documents, or has an index size at least around 5GB, then the <code class="literal">logs-000002</code> index is created
and the <code class="literal">logs_write</code> alias is updated to point to <code class="literal">logs-000002</code>.</p>
</td>
</tr>
</table>
</div>
<p>The API returns the following response:</p>
<a id="68a4f959b3d34ade7ae7c32c06ad9b72"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true,
  "shards_acknowledged": true,
  "old_index": "logs-000001",
  "new_index": "logs-000002",
  "rolled_over": true, <a id="CO611-1"></a><i class="conum" data-value="1"></i>
  "dry_run": false, <a id="CO611-2"></a><i class="conum" data-value="2"></i>
  "conditions": { <a id="CO611-3"></a><i class="conum" data-value="3"></i>
    "[max_age: 7d]": false,
    "[max_docs: 1000]": true,
    "[max_size: 5gb]": false,
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO611-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the index was rolled over.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO611-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the rollover was dry run.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO611-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The result of each condition.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="rollover-data-stream-ex"></a>Roll over a data stream<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h4>
</div></div></div>
<a id="af1000ebe7d479c20b3062b184f02870"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _index_template/template
{
  "index_patterns": ["my-data-stream*"],
  "data_stream": { }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1963.console"></div>
<a id="87cb62fe881c8d50bcb229e8e1ab2c08"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_data_stream/my-data-stream <a id="CO612-1"></a><i class="conum" data-value="1"></i>

# Add &gt; 1000 documents to my-data-stream

POST /my-data-stream/_rollover <a id="CO612-2"></a><i class="conum" data-value="2"></i>
{
  "conditions" : {
    "max_age": "7d",
    "max_docs": 1000,
    "max_size": "5gb"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1964.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO612-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates a data stream called <code class="literal">my-data-stream</code> with one initial backing index
named <code class="literal">my-data-stream-000001</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO612-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This request creates a new backing index, <code class="literal">my-data-stream-000002</code>, and adds
it as the write index for <code class="literal">my-data-stream</code> if the current
write index meets at least one of the following conditions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The index was created 7 or more days ago.
</li>
<li class="listitem">
The index has an index size of 5GB or greater.
</li>
<li class="listitem">
The index contains 1,000 or more documents.
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<p>The API returns the following response:</p>
<a id="9cf5e748464584f7124673f8c613e28e"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true,
  "shards_acknowledged": true,
  "old_index": ".ds-my-data-stream-2099.03.07-000001", <a id="CO613-1"></a><i class="conum" data-value="1"></i>
  "new_index": ".ds-my-data-stream-2099.03.08-000002", <a id="CO613-2"></a><i class="conum" data-value="2"></i>
  "rolled_over": true, <a id="CO613-3"></a><i class="conum" data-value="3"></i>
  "dry_run": false, <a id="CO613-4"></a><i class="conum" data-value="4"></i>
  "conditions": { <a id="CO613-5"></a><i class="conum" data-value="5"></i>
    "[max_age: 7d]": false,
    "[max_docs: 1000]": true,
    "[max_size: 5gb]": false,
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO613-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The previous write index for the data stream.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO613-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The new write index for the data stream.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO613-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the index was rolled over.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO613-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the rollover was dry run.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO613-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The result of each condition.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="rollover-index-settings-ex"></a>Specify settings for the target index<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h4>
</div></div></div>
<p>The settings, mappings, and aliases for the new index are taken from any
matching <a class="xref" href="index-templates.html" title="Index templates">index templates</a>. If the rollover target is an index
alias, you can specify <code class="literal">settings</code>, <code class="literal">mappings</code>, and <code class="literal">aliases</code> in the body of the request
just like the <a class="xref" href="indices-create-index.html" title="Create index API">create index</a> API. Values specified in the request
override any values set in matching index templates. For example, the following
<code class="literal">rollover</code> request overrides the <code class="literal">index.number_of_shards</code> setting:</p>
<a id="75f887596c4972bc679929ca996698f2"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /logs-000001
{
  "aliases": {
    "logs_write": {}
  }
}

POST /logs_write/_rollover
{
  "conditions" : {
    "max_age": "7d",
    "max_docs": 1000,
    "max_size": "5gb"
  },
  "settings": {
    "index.number_of_shards": 2
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1965.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="rollover-index-specify-index-ex"></a>Specify a target index name<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h4>
</div></div></div>
<p>If the rollover target is a data stream, you cannot specify a target index
name. The new index name will always be in the form <code class="literal">&lt;rollover-target&gt;-000001</code>
where the zero-padded number of length 6 is the generation of the data stream.</p>
<p>If the rollover target is an index alias and the name of the existing index ends
with <code class="literal">-</code> and a number&#8201;&#8212;&#8201;e.g. <code class="literal">logs-000001</code>&#8201;&#8212;&#8201;then the name of the new index will
follow the same pattern, incrementing the number (<code class="literal">logs-000002</code>). The number is
zero-padded with a length of 6, regardless of the old index name.</p>
<p>If the old name doesn&#8217;t match this pattern then you must specify the name for
the new index as follows:</p>
<a id="659247d91f61ceb17cbcc60801fd3456"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /my_alias/_rollover/my_new_index_name
{
  "conditions": {
    "max_age":   "7d",
    "max_docs":  1000,
    "max_size": "5gb"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1966.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_using_date_math_with_the_rollover_api"></a>Use date math with a rollover<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h4>
</div></div></div>
<p>If the rollover target is an index alias, it can be useful to use <a class="xref" href="date-math-index-names.html" title="Date math support in index names">date math</a>
to name the rollover index according to the date that the index rolled over, e.g.
<code class="literal">logstash-2016.02.03</code>.  The rollover API supports date math, but requires the
index name to end with a dash followed by a number, e.g. <code class="literal">logstash-2016.02.03-1</code>
which is incremented every time the index is rolled over. For instance:</p>
<a id="d0640fa9b3fd43137d60de7412c3689a"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console"># PUT /&lt;logs-{now/d}-1&gt; with URI encoding:
PUT /%3Clogs_%7Bnow%2Fd%7D-1%3E <a id="CO614-1"></a><i class="conum" data-value="1"></i>
{
  "aliases": {
    "logs_write": {}
  }
}

PUT logs_write/_doc/1
{
  "message": "a dummy log"
}

POST logs_write/_refresh

# Wait for a day to pass

POST /logs_write/_rollover <a id="CO614-2"></a><i class="conum" data-value="2"></i>
{
  "conditions": {
    "max_docs":   "1"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1967.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO614-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates an index named with today&#8217;s date (e.g.) <code class="literal">logs_2016.10.31-1</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO614-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Rolls over to a new index with today&#8217;s date, e.g. <code class="literal">logs_2016.10.31-000002</code> if run immediately, or <code class="literal">logs-2016.11.01-000002</code> if run after 24 hours</p>
</td>
</tr>
</table>
</div>
<p>These indices can then be referenced as described in the
<a class="xref" href="date-math-index-names.html" title="Date math support in index names">date math documentation</a>.  For example, to search
over indices created in the last three days, you could do the following:</p>
<a id="03584e88046614ec7727db506d866f48"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console"># GET /&lt;logs-{now/d}-*&gt;,&lt;logs-{now/d-1d}-*&gt;,&lt;logs-{now/d-2d}-*&gt;/_search
GET /%3Clogs-%7Bnow%2Fd%7D-*%3E%2C%3Clogs-%7Bnow%2Fd-1d%7D-*%3E%2C%3Clogs-%7Bnow%2Fd-2d%7D-*%3E/_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/1968.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="rollover-index-api-dry-run-ex"></a>Dry run<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h4>
</div></div></div>
<p>The rollover API supports <code class="literal">dry_run</code> mode, where request conditions can be
checked without performing the actual rollover.</p>
<a id="896eb7487a512fc43a2af7e16717f40d"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /logs_write/_rollover?dry_run
{
  "conditions" : {
    "max_age": "7d",
    "max_docs": 1000,
    "max_size": "5gb"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1969.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="indices-rollover-is-write-index"></a>Roll over a write index<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/indices/rollover-index.asciidoc">edit</a></h4>
</div></div></div>
<p>If the rollover target is an index alias for a write index that has <code class="literal">is_write_index</code> explicitly set to <code class="literal">true</code>, it is not
swapped during rollover actions. Since having an alias point to multiple indices is ambiguous in distinguishing
which is the correct write index to roll over, it is not valid to rollover an alias that points to multiple indices.
For this reason, the default behavior is to swap which index is being pointed to by the write-oriented alias. This
was <code class="literal">logs_write</code> in some of the above examples. Since setting <code class="literal">is_write_index</code> enables an alias to point to multiple indices
while also being explicit as to which is the write index that rollover should target, removing the alias from the rolled over
index is not necessary. This simplifies things by allowing for one alias to behave both as the write and read aliases for
indices that are being managed with Rollover.</p>
<p>Look at the behavior of the aliases in the following example where <code class="literal">is_write_index</code> is set on the rolled over index.</p>
<a id="9e9a3ad495e6305563a88dd4c74a5fda"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT my_logs_index-000001
{
  "aliases": {
    "logs": { "is_write_index": true } <a id="CO615-1"></a><i class="conum" data-value="1"></i>
  }
}

PUT logs/_doc/1
{
  "message": "a dummy log"
}

POST logs/_refresh

POST /logs/_rollover
{
  "conditions": {
    "max_docs":   "1"
  }
}

PUT logs/_doc/2 <a id="CO615-2"></a><i class="conum" data-value="2"></i>
{
  "message": "a newer log"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1970.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO615-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>configures <code class="literal">my_logs_index</code> as the write index for the <code class="literal">logs</code> alias</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO615-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>newly indexed documents against the <code class="literal">logs</code> alias will write to the new index</p>
</td>
</tr>
</table>
</div>
<a id="30525ea49f09da5979d6046e69fc1993"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_index" : "my_logs_index-000002",
  "_id" : "2",
  "_version" : 1,
  "result" : "created",
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 0,
  "_primary_term" : 1
}</pre>
</div>
<p>After the rollover, the alias metadata for the two indices will have the <code class="literal">is_write_index</code> setting
reflect each index&#8217;s role, with the newly created index as the write index.</p>
<a id="ef28fa43104f069fab5db566a796731f"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "my_logs_index-000002": {
    "aliases": {
      "logs": { "is_write_index": true }
    }
  },
  "my_logs_index-000001": {
    "aliases": {
      "logs": { "is_write_index" : false }
    }
  }
}</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="indices-refresh.html">« Refresh API</a>
</span>
<span class="next">
<a href="indices-shrink-index.html">Shrink index API »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"csharp":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
