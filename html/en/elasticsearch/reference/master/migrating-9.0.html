<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch diagnostic, diagnostics">
<title>Migrating to 9.0 | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Migrating to 9.0 | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="breaking-changes.html" title="Migration guide"/>
<link rel="prev" href="breaking-changes.html" title="Migration guide"/>
<link rel="next" href="release-highlights.html" title="What&#8217;s new in 9.0"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="breaking-changes.html">« Migration guide</a>
</span>
<span class="next">
<a href="release-highlights.html">What&#8217;s new in 9.0 »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="breaking-changes.html">Migration guide</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Migrating to 9.0</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="migrating-9.0"></a>Migrating to 9.0</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
</div></div></div>

<p>This section discusses the changes that you need to be aware of when migrating
your application to Elasticsearch 9.0.</p>
<p>See also <a class="xref" href="release-highlights.html" title="What&#8217;s new in 9.0"><em>What&#8217;s new in 9.0</em></a> and <a class="xref" href="es-release-notes.html" title="Release notes">Release notes</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Coming in 9.0.0.</p>
</div>
</div>
<div class="position-relative"><h3><a id="breaking-changes-9.0"></a>Breaking changes</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<p>The following changes in Elasticsearch 9.0 might affect your applications
and prevent them from operating normally.
Before upgrading to 9.0, review these changes and take the described steps
to mitigate the impact.</p>
<p>There are no notable breaking changes in Elasticsearch 9.0.
But there are some less critical breaking changes.</p>
<div class="position-relative"><h4><a id="breaking_90_analysis_changes"></a>Analysis changes</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<details id="snowball_stemmers_have_been_upgraded">
<summary class="title">Snowball stemmers have been upgraded</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Lucene 10 ships with an upgrade of its Snowball stemmers.  For details see <a href="https://github.com/apache/lucene/issues/13209" class="ulink" target="_top">https://github.com/apache/lucene/issues/13209</a>. Users using Snowball stemmers that are experiencing changes in search behaviour on  existing data are advised to reindex.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
The upgrade should generally provide improved stemming results. Small changes in token analysis can lead to mismatches with previously index data, so existing indices using Snowball stemmers as part of their analysis chain should be reindexed.</p>
</div>
</details>
<details id="german2_snowball_stemmer_an_alias_for_german_stemmer">
<summary class="title">The "german2" snowball stemmer is now an alias for the "german" stemmer</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Lucene 10 has merged the improved "german2" snowball language stemmer with the "german" stemmer. For Elasticsearch, "german2" is now a deprecated alias for "german". This may results in slightly different tokens being generated for terms with umlaut substitution (like "ue" for "ü" etc&#8230;&#8203;)</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Replace usages of "german2" with "german" in analysis configuration. Old indices that use the "german" stemmer should be reindexed if possible.</p>
</div>
</details>
<details id="persian_analyzer_has_stemmer_by_default">
<summary class="title">The <em>persian</em> analyzer has stemmer by default</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Lucene 10 has added a final stemming step to its PersianAnalyzer that Elasticsearch exposes as <em>persian</em> analyzer. Existing indices will keep the old non-stemming behaviour while new indices will see the updated behaviour with added stemming. Users that wish to maintain the non-stemming behaviour need to define their own analyzer as outlined in <a href="/guide/en/elasticsearch/reference/8.15/analysis-lang-analyzer.html#persian-analyzer" class="ulink" target="_top">https://www.elastic.co/guide/en/elasticsearch/reference/8.15/analysis-lang-analyzer.html#persian-analyzer</a>. Users that wish to use the new stemming behaviour for existing indices will have to reindex their data.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Indexing with the <em>persian</em> analyzer will produce slightly different tokens. Users should check if this impacts their search results. If they wish to maintain the legacy non-stemming behaviour they can define their own analyzer equivalent as explained in <a href="/guide/en/elasticsearch/reference/8.15/analysis-lang-analyzer.html#persian-analyzer" class="ulink" target="_top">https://www.elastic.co/guide/en/elasticsearch/reference/8.15/analysis-lang-analyzer.html#persian-analyzer</a>.</p>
</div>
</details>
<details id="korean_dictionary_for_nori_has_been_updated">
<summary class="title">The Korean dictionary for Nori has been updated</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Lucene 10 ships with an updated Korean dictionary (mecab-ko-dic-2.1.1).  For details see <a href="https://github.com/apache/lucene/issues/11452" class="ulink" target="_top">https://github.com/apache/lucene/issues/11452</a>. Users experiencing changes in search behaviour on existing data are advised to reindex.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
The change is small and should generally provide better analysis results. Existing indices for full-text use cases should be reindexed though.</p>
</div>
</details>
<div class="position-relative"><h4><a id="breaking_90_cluster_and_node_setting_changes"></a>Cluster and node setting changes</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<details id="minimum_shard_balancer_threshold_1_0">
<summary class="title">Minimum shard balancer threshold is now 1.0</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Earlier versions of Elasticsearch accepted any non-negative value for <code class="literal">cluster.routing.allocation.balance.threshold</code>, but values smaller than <code class="literal">1.0</code> do not make sense and have been ignored since version 8.6.1. From 9.0.0 these nonsensical values are now forbidden.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Do not set <code class="literal">cluster.routing.allocation.balance.threshold</code> to a value less than <code class="literal">1.0</code>.</p>
</div>
</details>
<details id="remove_cluster_routing_allocation_disk_watermark_enable_for_single_data_node_setting">
<summary class="title">Remove <code class="literal">cluster.routing.allocation.disk.watermark.enable_for_single_data_node</code> setting</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Prior to 7.8, whenever a cluster had only a single data node, the watermarks would not be respected. In order to change this in 7.8+ in a backwards compatible way, we introduced the  <code class="literal">cluster.routing.allocation.disk.watermark.enable_for_single_data_node</code> node setting. The setting was deprecated in 7.14 and was made to accept only true in 8.0</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
No known end user impact</p>
</div>
</details>
<details id="remove_deprecated_xpack_searchable_snapshot_allocate_on_rolling_restart_setting">
<summary class="title">Remove deprecated <code class="literal">xpack.searchable.snapshot.allocate_on_rolling_restart</code> setting</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The <code class="literal">xpack.searchable.snapshot.allocate_on_rolling_restart</code> setting was created as an escape-hatch just in case relying on the <code class="literal">cluster.routing.allocation.enable=primaries</code> setting for allocating searchable snapshots during rolling restarts had some unintended side-effects. It has been deprecated since 8.2.0.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Remove <code class="literal">xpack.searchable.snapshot.allocate_on_rolling_restart</code> from your settings if present.</p>
</div>
</details>
<details id="remove_unsupported_legacy_value_for_discovery_type">
<summary class="title">Remove unsupported legacy value for <code class="literal">discovery.type</code></summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Earlier versions of Elasticsearch had a <code class="literal">discovery.type</code> setting which permitted values that referred to legacy discovery types. From v9.0.0 onwards, the only supported values for this setting are <code class="literal">multi-node</code> (the default) and <code class="literal">single-node</code>.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Remove any value for <code class="literal">discovery.type</code> from your <code class="literal">elasticsearch.yml</code> configuration file.</p>
</div>
</details>
<div class="position-relative"><h4><a id="breaking_90_ingest_changes"></a>Ingest changes</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<details id="remove_ecs_option_on_user_agent_processor">
<summary class="title">Remove <code class="literal">ecs</code> option on <code class="literal">user_agent</code> processor</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The <code class="literal">user_agent</code> ingest processor no longer accepts the <code class="literal">ecs</code> option. (It was previously deprecated and ignored.)</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Users should stop using the <code class="literal">ecs</code> option when creating instances of the <code class="literal">user_agent</code> ingest processor. The option will be removed from existing processors stored in the cluster state on upgrade.</p>
</div>
</details>
<details id="remove_ignored_fallback_option_on_geoip_processor">
<summary class="title">Remove ignored fallback option on GeoIP processor</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The option fallback_to_default_databases on the geoip ingest processor has been removed. (It was deprecated and ignored since 8.0.0.)</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Customers should stop remove the noop fallback_to_default_databases option on any geoip ingest processors.</p>
</div>
</details>
<div class="position-relative"><h4><a id="breaking_90_mapping_changes"></a>Mapping changes</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<details id="remove_support_for_type_fields_copy_to_boost_in_metadata_field_definition">
<summary class="title">Remove support for type, fields, copy_to and boost in metadata field definition</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The type, fields, copy_to and boost parameters are no longer supported in metadata field definition</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Users providing type, fields, copy_to or boost as part of metadata field definition should remove them from their mappings.</p>
</div>
</details>
<div class="position-relative"><h4><a id="breaking_90_rest_api_changes"></a>REST API changes</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<details id="apply_more_strict_parsing_of_actions_in_bulk_api">
<summary class="title">Apply more strict parsing of actions in bulk API</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Previously, the following classes of malformed input were deprecated but not rejected in the action lines of the a bulk request: missing closing brace; additional keys after the action (which were ignored); additional data after the closing brace (which was ignored). They will now be considered errors and rejected.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Users must provide well-formed input when using the bulk API. (They can request REST API compatibility with v8 to get the previous behaviour back as an interim measure.)</p>
</div>
</details>
<details id="error_json_structure_has_changed_when_detailed_errors_are_disabled">
<summary class="title">Error JSON structure has changed when detailed errors are disabled</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
This change modifies the JSON format of error messages returned to REST clients
when detailed messages are turned off.
Previously, JSON returned when an exception occurred, and <code class="literal">http.detailed_errors.enabled: false</code> was set,
just consisted of a single <code class="literal">"error"</code> text field with some basic information.
Setting <code class="literal">http.detailed_errors.enabled: true</code> (the default) changed this field
to an object with more detailed information.
With this change, non-detailed errors now have the same structure as detailed errors. <code class="literal">"error"</code> will now always
be an object with, at a minimum, a <code class="literal">"type"</code> and <code class="literal">"reason"</code> field. Additional fields are included when detailed
errors are enabled.
To use the previous structure for non-detailed errors, use the v8 REST API.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
If you have set <code class="literal">http.detailed_errors.enabled: false</code> (the default is <code class="literal">true</code>)
the structure of JSON when any exceptions occur now matches the structure when
detailed errors are enabled.
To use the previous structure for non-detailed errors, use the v8 REST API.</p>
</div>
</details>
<details id="remove_cluster_state_from_cluster_reroute_response">
<summary class="title">Remove cluster state from <code class="literal">/_cluster/reroute</code> response</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The <code class="literal">POST /_cluster/reroute</code> API no longer returns the cluster state in its response. The <code class="literal">?metric</code> query parameter to this API now has no effect and its use will be forbidden in a future version.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Cease usage of the <code class="literal">?metric</code> query parameter when calling the <code class="literal">POST /_cluster/reroute</code> API.</p>
</div>
</details>
<details id="remove_deprecated_local_attribute_from_alias_apis">
<summary class="title">Remove deprecated local attribute from alias APIs</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The following APIs no longer accept the <code class="literal">?local</code> query parameter: <code class="literal">GET /_alias</code>, <code class="literal">GET /_aliases</code>, <code class="literal">GET /_alias/{name}</code>, <code class="literal">HEAD /_alias/{name}</code>, <code class="literal">GET /{index}/_alias</code>, <code class="literal">HEAD /{index}/_alias</code>, <code class="literal">GET /{index}/_alias/{name}</code>, <code class="literal">HEAD /{index}/_alias/{name}</code>, <code class="literal">GET /_cat/aliases</code>, and <code class="literal">GET /_cat/aliases/{alias}</code>. This parameter has been deprecated and ignored since version 8.12.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Cease usage of the <code class="literal">?local</code> query parameter when calling the listed APIs.</p>
</div>
</details>
<details id="remove_legacy_params_from_range_query">
<summary class="title">Remove legacy params from range query</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The deprecated range query parameters <code class="literal">to</code>, <code class="literal">from</code>, <code class="literal">include_lower</code>, and <code class="literal">include_upper</code> are no longer supported.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Users should use <code class="literal">lt</code>, <code class="literal">lte</code>, <code class="literal">gt</code>, and <code class="literal">gte</code> query parameters instead.</p>
</div>
</details>
<details id="remove_support_for_deprecated_force_source_highlighting_parameter">
<summary class="title">Remove support for deprecated <code class="literal">force_source</code> highlighting parameter</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The deprecated highlighting <code class="literal">force_source</code> parameter is no longer supported.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Users should remove usages of the <code class="literal">force_source</code> parameter from their search requests.</p>
</div>
</details>
<div class="position-relative"><h4><a id="breaking_90_transforms_changes"></a>Transforms changes</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<details id="updating_deprecated_transform_roles">
<summary class="title">Updating deprecated transform roles (<code class="literal">data_frame_transforms_admin</code> and <code class="literal">data_frame_transforms_user</code>)</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The <code class="literal">data_frame_transforms_admin</code> and <code class="literal">data_frame_transforms_user</code> transform roles have been deprecated.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Users must update any existing transforms that use deprecated transform roles (<code class="literal">data_frame_transforms_admin</code> or <code class="literal">data_frame_transforms_user</code>) to use the new equivalent transform roles (<code class="literal">transform_admin</code> or <code class="literal">transform_user</code>).
To update the transform roles:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Switch to a user with the <code class="literal">transform_admin</code> role (to replace <code class="literal">data_frame_transforms_admin</code>) or the <code class="literal">transform_user</code> role (to replace <code class="literal">data_frame_transforms_user</code>).
</li>
<li class="listitem">
Call the <a class="xref" href="update-transform.html" title="Update transform API">update transforms API</a> with that user.
</li>
</ol>
</div>
</div>
</details>
<div class="position-relative"><h3><a id="deprecated-9.0"></a>Deprecations</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<p>The following functionality has been deprecated in Elasticsearch 9.0
and will be removed in a future version.
While this won&#8217;t have an immediate impact on your applications,
we strongly encourage you to take the described steps to update your code
after upgrading to 9.0.</p>
<p>To find out if you are using any deprecated functionality,
enable <a class="xref" href="logging.html#deprecation-logging" title="Deprecation logging">deprecation logging</a>.</p>
<div class="position-relative"><h4><a id="deprecations_90_mapping"></a>Mapping deprecations</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<details id="deprecate_source_mode_in_mappings">
<summary class="title">Deprecate <code class="literal">_source.mode</code> in mappings</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Configuring <code class="literal">_source.mode</code> in mappings is deprecated and will be removed in future versions. Use <code class="literal">index.mapping.source.mode</code> index setting instead.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Use <code class="literal">index.mapping.source.mode</code> index setting instead</p>
</div>
</details>
<div class="position-relative"><h4><a id="deprecations_90_rest_api"></a>REST API deprecations</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<details id="document_type_deprecated_on_simulate_pipeline_api">
<summary class="title">Document <code class="literal">_type</code> deprecated on simulate pipeline API</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
Passing a document with a <code class="literal">_type</code> property is deprecated in the <code class="literal">/_ingest/pipeline/{id}/_simulate</code> and <code class="literal">/_ingest/pipeline/_simulate</code> APIs.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
Users should already have stopped using mapping types, which were deprecated in Elasticsearch 7. This deprecation warning will fire if they specify mapping types on documents pass to the simulate pipeline API.</p>
</div>
</details>
<details id="inference_api_deprecate_elser_service">
<summary class="title">[Inference API] Deprecate elser service</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br>
The <code class="literal">elser</code> service of the inference API will be removed in an upcoming release. Please use the elasticsearch service instead.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br>
In the current version there is no impact. In a future version, users of the <code class="literal">elser</code> service will no longer be able to use it, and will be required to use the <code class="literal">elasticsearch</code> service to access elser through the inference API.</p>
</div>
</details>
<div class="position-relative"><h3><a id="breaking_90_anomaly_detection_results"></a>Anomaly detection results migration</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/migration/migrate_9_0.asciidoc">edit</a></div>
<p>The anomaly detection result indices <code class="literal">.ml-anomalies-*</code> created in Elasticsearch 7.x must be either reindexed, marked read-only, or deleted before upgrading to 9.x.</p>
<p><span class="strong strong"><strong>Reindexing</strong></span>: While anomaly detection results are being reindexed, jobs continue to run and process new data.
However, you cannot completely delete an anomaly detection job that stores results in this index until the reindexing is complete.</p>
<p><span class="strong strong"><strong>Marking indices as read-only</strong></span>: This is useful for large indexes that contain the results of only one or a few anomaly detection jobs.
If you delete these jobs later, you will not be able to create a new job with the same name.</p>
<p><span class="strong strong"><strong>Deleting</strong></span>: Delete jobs that are no longer needed in the Machine Learning in Kibana.
The result index is deleted when all jobs that store results in it have been deleted.</p>
<details id="which_indices_require_attention">
<summary class="title">Which indices require attention?</summary>
<div class="content">
<p>To identify indices that require action, use the <a class="xref" href="migration-api-deprecation.html" title="Deprecation info APIs">Deprecation info API</a>:</p>
<a id="e715fb8c792bf09ac98f0ceca99beb84"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET /.ml-anomalies-*/_migration/deprecations</pre>
</div>
<div class="console_widget" data-snippet="snippets/3733.console"></div>
<p>The response contains the list of critical deprecation warnings in the <code class="literal">index_settings</code> section:</p>
<a id="f7dfd5eae273f31a915c36505be2a1d7"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">"index_settings": {
    ".ml-anomalies-shared": [
      {
        "level": "critical",
        "message": "Index created before 8.0",
        "url": "https://ela.st/es-deprecation-8-reindex",
        "details": "This index was created with version 7.8.23 and is not compatible with 9.0. Reindex or remove the index before upgrading.",
        "resolve_during_rolling_upgrade": false
      }
    ]
  }</pre>
</div>
</div>
</details>
<details id="reindex_anomaly_result_index">
<summary class="title">Reindexing anomaly result indices</summary>
<div class="content">
<p>For an index with less than 10GB that contains results from multiple jobs that are still required, we recommend reindexing into a new format using UI.
You can use the <a class="xref" href="cat-indices.html" title="cat indices API">cat indices</a> to obtain the size of an index:</p>
<a id="a46f566ca031375658c22f89b87dc6d2"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _cat/indices/.ml-anomalies-custom-example?v&amp;h=index,store.size</pre>
</div>
<div class="console_widget" data-snippet="snippets/3734.console"></div>
<p>The reindexing can be initiated in the Kibana Upgrade Assistant.</p>
<p>If an index size is greater than 10 GB it is recommended to use the Reindex API.
Reindexing consists of the following steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Set the original index to read-only.</p>
<a id="12adea5d76f73d94d80d42f53f67563f"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT .ml-anomalies-custom-example/_block/read_only</pre>
</div>
<div class="console_widget" data-snippet="snippets/3735.console"></div>
</li>
<li class="listitem">
<p>Create a new index from the legacy index.</p>
<a id="ec135f0cc0d3f526df68000b2a95c65b"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _create_from/.ml-anomalies-custom-example/.reindexed-v9-ml-anomalies-custom-example</pre>
</div>
<div class="console_widget" data-snippet="snippets/3736.console"></div>
</li>
<li class="listitem">
<p>Reindex documents.
To accelerate the reindexing process, it is recommended that the number of replicas be set to <code class="literal">0</code> before the reindexing and then set back to the original number once it is completed.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Get the number of replicas.</p>
<a id="59aa5216630f80c5dc298fc5bba4a819"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET /.reindexed-v9-ml-anomalies-custom-example/_settings</pre>
</div>
<div class="console_widget" data-snippet="snippets/3737.console"></div>
<p>Note the number of replicas in the response. For example:</p>
<a id="33056a50d7ba5c0dedc068476c7c8b1d"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  ".reindexed-v9-ml-anomalies-custom-example": {
    "settings": {
      "index": {
        "number_of_replicas": "1",
        "number_of_shards": "1"
      }
    }
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>Set the number of replicas to <code class="literal">0</code>.</p>
<a id="8621c05cc7cf3880bde751f6670a0c3a"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /.reindexed-v9-ml-anomalies-custom-example/_settings
{
  "index": {
    "number_of_replicas": 0
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3738.console"></div>
</li>
<li class="listitem">
<p>Start the reindexing process in asynchronous mode.</p>
<a id="6e498b9dc753b94abf2618c407fa5cd8"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _reindex?wait_for_completion=false
{
  "source": {
    "index": ".ml-anomalies-custom-example"
  },
  "dest": {
    "index": ".reindexed-v9-ml-anomalies-custom-example"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3739.console"></div>
<p>The response will contain a task_id. You can check when the task is completed using the following command:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.tasks.get(
    task_id="&lt;task_id&gt;",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.tasks.get({
  task_id: "&lt;task_id&gt;",
});
console.log(response);</pre>
</div>
<a id="8a1b6eae4893c5dd27b3d81fd8d70f5b"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET _tasks/&lt;task_id&gt;</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/3740.console"></div>
</li>
<li class="listitem">
<p>Set the number of replicas to the original number when the reindexing is finished.</p>
<a id="0f028f71f04c1d569fab402869565a84"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /.reindexed-v9-ml-anomalies-custom-example/_settings
{
  "index": {
    "number_of_replicas": "&lt;original_number_of_replicas&gt;"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3741.console"></div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Get the aliases the original index is pointing to.</p>
<a id="8c47c80139f40f25db44f5781ca2dfbe"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET .ml-anomalies-custom-example/_alias</pre>
</div>
<div class="console_widget" data-snippet="snippets/3742.console"></div>
<p>The response may contain multiple aliases if the results of multiple jobs are stored in the same index.</p>
<a id="e2cae200679cfc793941a38c8dbf610c"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  ".ml-anomalies-custom-example": {
    "aliases": {
      ".ml-anomalies-example1": {
        "filter": {
          "term": {
            "job_id": {
              "value": "example1"
            }
          }
        },
        "is_hidden": true
      },
      ".ml-anomalies-example2": {
        "filter": {
          "term": {
            "job_id": {
              "value": "example2"
            }
          }
        },
        "is_hidden": true
      }
    }
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>Now you can reassign the aliases to the new index and delete the original index in one step.
Note that when adding the new index to the aliases, you must use the same filter and is_hidden parameters as for the original index.</p>
<a id="dd16c9c981551c9da47ebb5ef5105fa0"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _aliases
{
  "actions": [
    {
      "add": {
        "index": ".reindexed-v9-ml-anomalies-custom-example",
        "alias": ".ml-anomalies-example1",
        "filter": {
          "term": {
            "job_id": {
              "value": "example1"
            }
          }
        },
        "is_hidden": true
      }
    },
    {
      "add": {
        "index": ".reindexed-v9-ml-anomalies-custom-example",
        "alias": ".ml-anomalies-example2",
        "filter": {
          "term": {
            "job_id": {
              "value": "example2"
            }
          }
        },
        "is_hidden": true
      }
    },
    {
      "remove": {
        "index": ".ml-anomalies-custom-example",
        "aliases": ".ml-anomalies-*"
      }
    },
    {
      "remove_index": {
        "index": ".ml-anomalies-custom-example"
      }
    },
    {
      "add": {
        "index": ".reindexed-v9-ml-anomalies-custom-example",
        "alias": ".ml-anomalies-custom-example",
        "is_hidden": true
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3743.console"></div>
</li>
</ol>
</div>
</div>
</details>
<details id="mark_anomaly_result_index_read_only">
<summary class="title">Marking anomaly result indices as read-only</summary>
<div class="content">
<p>Legacy indexes created in Elasticsearch 7.x can be made read-only and supported in Elasticsearch 9.x.
Making an index with a large amount of historical results read-only allows for a quick migration to the next major release, since you don&#8217;t have to wait for the data to be reindexed into the new format.
However, it has the limitation that even after deleting an anomaly detection job, the historical results associated with this job are not completely deleted.
Therefore, the system will prevent you from creating a new job with the same name.</p>
<p>To set the index as read-only, add the <code class="literal">write</code> block to the index:</p>
<a id="272e27bf1fcc4fe5dbd4092679dd0342"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT .ml-anomalies-custom-example/_block/write</pre>
</div>
<div class="console_widget" data-snippet="snippets/3744.console"></div>
<p>Indices created in Elasticsearch 7.x that have a <code class="literal">write</code> block will not raise a critical deprecation warning.</p>
</div>
</details>
<details id="delete_anomaly_result_index">
<summary class="title">Deleting anomaly result indices</summary>
<div class="content">
<p>If an index contains results of the jobs that are no longer required.
To list all jobs that stored results in an index, use the terms aggregation:</p>
<a id="3a204b57072a104d9b50f3a9e064a8f6"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET .ml-anomalies-custom-example/_search
{
  "size": 0,
  "aggs": {
    "job_ids": {
      "terms": {
        "field": "job_id",
        "size": 100
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/3745.console"></div>
<p>The jobs can be deleted in the UI.
After the last job is deleted, the index will be deleted as well.</p>
</div>
</details>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="breaking-changes.html">« Migration guide</a>
</span>
<span class="next">
<a href="release-highlights.html">What&#8217;s new in 9.0 »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
