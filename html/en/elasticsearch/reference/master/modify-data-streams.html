<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Modify a data stream | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Modify a data stream | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="data-streams.html" title="Data streams"/>
<link rel="prev" href="use-a-data-stream.html" title="Use a data stream"/>
<link rel="next" href="tsds.html" title="Time series data stream (TSDS)"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-streams.html">Data streams</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="use-a-data-stream.html">« Use a data stream</a>
</span>
<span class="next">
<a href="tsds.html">Time series data stream (TSDS) »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="modify-data-streams"></a>Modify a data stream<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/change-mappings-and-settings.asciidoc">edit</a></h2>
</div></div></div>
<h3><a id="data-streams-change-mappings-and-settings"></a>Change mappings and settings for a data stream<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/change-mappings-and-settings.asciidoc">edit</a></h3>
<p>Each data stream has a <a class="xref" href="set-up-a-data-stream.html#create-index-template" title="Create an index template">matching index
template</a>. Mappings and index settings from this template are applied to new
backing indices created for the stream. This includes the stream&#8217;s first
backing index, which is auto-generated when the stream is created.</p>
<p>Before creating a data stream, we recommend you carefully consider which
mappings and settings to include in this template.</p>
<p>If you later need to change the mappings or settings for a data stream, you have
a few options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="modify-data-streams.html#add-new-field-mapping-to-a-data-stream" title="Add a new field mapping to a data stream">Add a new field mapping to a data stream</a>
</li>
<li class="listitem">
<a class="xref" href="modify-data-streams.html#change-existing-field-mapping-in-a-data-stream" title="Change an existing field mapping in a data stream">Change an existing field mapping in a data stream</a>
</li>
<li class="listitem">
<a class="xref" href="modify-data-streams.html#change-dynamic-index-setting-for-a-data-stream" title="Change a dynamic index setting for a data stream">Change a dynamic index setting for a data stream</a>
</li>
<li class="listitem">
<a class="xref" href="modify-data-streams.html#change-static-index-setting-for-a-data-stream" title="Change a static index setting for a data stream">Change a static index setting for a data stream</a>
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your changes include modifications to existing field mappings or
<a class="xref" href="index-modules.html#index-modules-settings" title="Index Settings">static index settings</a>, a reindex is often required to
apply the changes to a data stream&#8217;s backing indices. If you are already
performing a reindex, you can use the same process to add new field
mappings and change <a class="xref" href="index-modules.html#index-modules-settings" title="Index Settings">dynamic index settings</a>. See
<a class="xref" href="modify-data-streams.html#data-streams-use-reindex-to-change-mappings-settings" title="Use reindex to change mappings or settings">Use reindex to change mappings or settings</a>.</p>
</div>
</div>
<h4><a id="add-new-field-mapping-to-a-data-stream"></a>Add a new field mapping to a data stream<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/change-mappings-and-settings.asciidoc">edit</a></h4>
<p>To add a mapping for a new field to a data stream, following these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update the index template used by the data stream. This ensures the new
field mapping is added to future backing indices created for the stream.</p>
<p>For example, <code class="literal">my-data-stream-template</code> is an existing index template used by
<code class="literal">my-data-stream</code>.</p>
<p>The following <a class="xref" href="index-templates.html" title="Index templates">create or update index template</a> request adds a mapping
for a new field, <code class="literal">message</code>, to the template.</p>
<a id="2e93eaaebf75fa4a2451e8a76ffa9f20"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_index_template/my-data-stream-template
{
  "index_patterns": [ "my-data-stream*" ],
  "data_stream": { },
  "priority": 500,
  "template": {
    "mappings": {
      "properties": {
        "message": {                              <a id="CO169-1"></a><i class="conum" data-value="1"></i>
          "type": "text"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/626.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO169-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds a mapping for the new <code class="literal">message</code> field.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Use the <a class="xref" href="indices-put-mapping.html" title="Update mapping API">update mapping API</a> to add the new field mapping
to the data stream. By default, this adds the mapping to the stream&#8217;s existing
backing indices, including the write index.</p>
<p>The following update mapping API request adds the new <code class="literal">message</code> field mapping to
<code class="literal">my-data-stream</code>.</p>
<a id="3e4227250d49e81df48773f8ba803ea7"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-data-stream/_mapping
{
  "properties": {
    "message": {
      "type": "text"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/627.console"></div>
<p>To add the mapping only to the stream&#8217;s write index, set the update mapping API&#8217;s
<code class="literal">write_index_only</code> query parameter to <code class="literal">true</code>.</p>
<p>The following update mapping request adds the new <code class="literal">message</code> field mapping only to
<code class="literal">my-data-stream</code>'s write index. The new field mapping is not added to
the stream&#8217;s other backing indices.</p>
<a id="360b3cef34bbddc5d9579ca95f0cb061"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-data-stream/_mapping?write_index_only=true
{
  "properties": {
    "message": {
      "type": "text"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/628.console"></div>
</li>
</ol>
</div>
<h4><a id="change-existing-field-mapping-in-a-data-stream"></a>Change an existing field mapping in a data stream<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/change-mappings-and-settings.asciidoc">edit</a></h4>
<p>The documentation for each <a class="xref" href="mapping-params.html" title="Mapping parameters">mapping parameter</a> indicates
whether you can update it for an existing field using the
<a class="xref" href="indices-put-mapping.html" title="Update mapping API">update mapping API</a>. To update these parameters for an
existing field, follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update the index template used by the data stream. This ensures the updated
field mapping is added to future backing indices created for the stream.</p>
<p>For example, <code class="literal">my-data-stream-template</code> is an existing index template used by
<code class="literal">my-data-stream</code>.</p>
<p>The following <a class="xref" href="index-templates.html" title="Index templates">create or update index template</a> request changes the
argument for the <code class="literal">host.ip</code> field&#8217;s <a class="xref" href="ignore-malformed.html" title="ignore_malformed"><code class="literal">ignore_malformed</code></a>
mapping parameter to <code class="literal">true</code>.</p>
<a id="4be20da16d2b58216e8b307218c7bf3a"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_index_template/my-data-stream-template
{
  "index_patterns": [ "my-data-stream*" ],
  "data_stream": { },
  "priority": 500,
  "template": {
    "mappings": {
      "properties": {
        "host": {
          "properties": {
            "ip": {
              "type": "ip",
              "ignore_malformed": true            <a id="CO170-1"></a><i class="conum" data-value="1"></i>
            }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/629.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO170-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Changes the <code class="literal">host.ip</code> field&#8217;s <code class="literal">ignore_malformed</code> value to <code class="literal">true</code>.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Use the <a class="xref" href="indices-put-mapping.html" title="Update mapping API">update mapping API</a> to apply the mapping changes
to the data stream. By default, this applies the changes to the stream&#8217;s
existing backing indices, including the write index.</p>
<p>The following <a class="xref" href="indices-put-mapping.html" title="Update mapping API">update mapping API</a> request targets
<code class="literal">my-data-stream</code>. The request changes the argument for the <code class="literal">host.ip</code>
field&#8217;s <code class="literal">ignore_malformed</code> mapping parameter to <code class="literal">true</code>.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_mapping(
  index: 'my-data-stream',
  body: {
    properties: {
      host: {
        properties: {
          ip: {
            type: 'ip',
            ignore_malformed: true
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<a id="911c56114e50ce7440eb83efc91d28b8"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">PUT /my-data-stream/_mapping
{
  "properties": {
    "host": {
      "properties": {
        "ip": {
          "type": "ip",
          "ignore_malformed": true
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/630.console"></div>
<p>To apply the mapping changes only to the stream&#8217;s write index, set the put
mapping API&#8217;s <code class="literal">write_index_only</code> query parameter to <code class="literal">true</code>.</p>
<p>The following update mapping request changes the <code class="literal">host.ip</code> field&#8217;s mapping only for
<code class="literal">my-data-stream</code>'s write index. The change is not applied to the
stream&#8217;s other backing indices.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_mapping(
  index: 'my-data-stream',
  write_index_only: true,
  body: {
    properties: {
      host: {
        properties: {
          ip: {
            type: 'ip',
            ignore_malformed: true
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<a id="fb1180992b2087dfb36576b44c4261e4"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">PUT /my-data-stream/_mapping?write_index_only=true
{
  "properties": {
    "host": {
      "properties": {
        "ip": {
          "type": "ip",
          "ignore_malformed": true
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/631.console"></div>
</li>
</ol>
</div>
<p>Except for supported mapping parameters, we don&#8217;t recommend you change the
mapping or field data type of existing fields, even in a data stream&#8217;s matching
index template or its backing indices. Changing the mapping of an existing
field could invalidate any data that’s already indexed.</p>
<p>If you need to change the mapping of an existing field, create a new
data stream and reindex your data into it. See
<a class="xref" href="modify-data-streams.html#data-streams-use-reindex-to-change-mappings-settings" title="Use reindex to change mappings or settings">Use reindex to change mappings or settings</a>.</p>
<h4><a id="change-dynamic-index-setting-for-a-data-stream"></a>Change a dynamic index setting for a data stream<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/change-mappings-and-settings.asciidoc">edit</a></h4>
<p>To change a <a class="xref" href="index-modules.html#index-modules-settings" title="Index Settings">dynamic index setting</a> for a data stream,
follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update the index template used by the data stream. This ensures the setting is
applied to future backing indices created for the stream.</p>
<p>For example, <code class="literal">my-data-stream-template</code> is an existing index template used by
<code class="literal">my-data-stream</code>.</p>
<p>The following <a class="xref" href="index-templates.html" title="Index templates">create or update index template</a> request changes the
template&#8217;s <code class="literal">index.refresh_interval</code> index setting to <code class="literal">30s</code> (30 seconds).</p>
<a id="46103fee3cd5f53dc75123def82d52ad"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_index_template/my-data-stream-template
{
  "index_patterns": [ "my-data-stream*" ],
  "data_stream": { },
  "priority": 500,
  "template": {
    "settings": {
      "index.refresh_interval": "30s"             <a id="CO171-1"></a><i class="conum" data-value="1"></i>
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/632.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO171-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Changes the <code class="literal">index.refresh_interval</code> setting to <code class="literal">30s</code> (30 seconds).</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Use the <a class="xref" href="indices-update-settings.html" title="Update index settings API">update index settings API</a> to update the
index setting for the data stream. By default, this applies the setting to
the stream&#8217;s existing backing indices, including the write index.</p>
<p>The following update index settings API request updates the
<code class="literal">index.refresh_interval</code> setting for <code class="literal">my-data-stream</code>.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_settings(
  index: 'my-data-stream',
  body: {
    index: {
      refresh_interval: '30s'
    }
  }
)
puts response</pre>
</div>
<a id="9fa55fc76ec4bd81f372e9389f1da851"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">PUT /my-data-stream/_settings
{
  "index": {
    "refresh_interval": "30s"
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/633.console"></div>
</li>
</ol>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>To change the <code class="literal">index.lifecycle.name</code> setting, first use the
<a class="xref" href="ilm-remove-policy.html" title="Remove policy from index API">remove policy API</a> to remove the existing ILM
policy. See <a class="xref" href="set-up-lifecycle-policy.html#switch-lifecycle-policies" title="Switch lifecycle policies">Switch lifecycle policies</a>.</p>
</div>
</div>
<h4><a id="change-static-index-setting-for-a-data-stream"></a>Change a static index setting for a data stream<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/change-mappings-and-settings.asciidoc">edit</a></h4>
<p><a class="xref" href="index-modules.html#index-modules-settings" title="Index Settings">Static index settings</a> can only be set when a backing
index is created. You cannot update static index settings using the
<a class="xref" href="indices-update-settings.html" title="Update index settings API">update index settings API</a>.</p>
<p>To apply a new static setting to future backing indices, update the index
template used by the data stream. The setting is automatically applied to any
backing index created after the update.</p>
<p>For example, <code class="literal">my-data-stream-template</code> is an existing index template used by
<code class="literal">my-data-stream</code>.</p>
<p>The following <a class="xref" href="index-templates.html" title="Index templates">create or update index template API</a> requests
adds new <code class="literal">sort.field</code> and <code class="literal">sort.order index</code> settings to the template.</p>
<a id="6843d859e2965d17cad4f033c81db83f"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_index_template/my-data-stream-template
{
  "index_patterns": [ "my-data-stream*" ],
  "data_stream": { },
  "priority": 500,
  "template": {
    "settings": {
      "sort.field": [ "@timestamp"],             <a id="CO172-1"></a><i class="conum" data-value="1"></i>
      "sort.order": [ "desc"]                    <a id="CO172-2"></a><i class="conum" data-value="2"></i>
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/634.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO172-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds the <code class="literal">sort.field</code> index setting.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO172-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds the <code class="literal">sort.order</code> index setting.</p>
</td>
</tr>
</table>
</div>
<p>If wanted, you can <a class="xref" href="use-a-data-stream.html#manually-roll-over-a-data-stream" title="Manually roll over a data stream">roll over the data
stream</a> to immediately apply the setting to the data stream’s write index. This
affects any new data added to the stream after the rollover. However, it does
not affect the data stream&#8217;s existing backing indices or existing data.</p>
<p>To apply static setting changes to existing backing indices, you must create a
new data stream and reindex your data into it. See
<a class="xref" href="modify-data-streams.html#data-streams-use-reindex-to-change-mappings-settings" title="Use reindex to change mappings or settings">Use reindex to change mappings or settings</a>.</p>
<h4><a id="data-streams-use-reindex-to-change-mappings-settings"></a>Use reindex to change mappings or settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/change-mappings-and-settings.asciidoc">edit</a></h4>
<p>You can use a reindex to change the mappings or settings of a data stream. This
is often required to change the data type of an existing field or update static
index settings for backing indices.</p>
<p>To reindex a data stream, first create or update an index template so that it
contains the wanted mapping or setting changes. You can then reindex the
existing data stream into a new stream matching the template. This applies the
mapping and setting changes in the template to each document and backing index
added to the new data stream. These changes also affect any future backing
index created by the new stream.</p>
<p>Follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Choose a name or index pattern for a new data stream. This new data
stream will contain data from your existing stream.</p>
<p>You can use the resolve index API to check if the name or pattern matches any
existing indices, aliases, or data streams. If so, you should consider using
another name or pattern.</p>
<p>The following resolve index API request checks for any existing indices,
aliases, or data streams that start with <code class="literal">new-data-stream</code>. If not, the
<code class="literal">new-data-stream*</code> index pattern can be used to create a new data stream.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.resolve_index(
  name: 'new-data-stream*'
)
puts response</pre>
</div>
<a id="5f031b7bd2b7d98d2d10df7420d269ff"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">GET /_resolve/index/new-data-stream*</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/635.console"></div>
<p>The API returns the following response, indicating no existing targets match
this pattern.</p>
<a id="4a056693dcd998a6b66a73f115d43239"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "indices": [ ],
  "aliases": [ ],
  "data_streams": [ ]
}</pre>
</div>
</li>
<li class="listitem">
<p>Create or update an index template. This template should contain the
mappings and settings you&#8217;d like to apply to the new data stream&#8217;s backing
indices.</p>
<p>This index template must meet the
<a class="xref" href="set-up-a-data-stream.html#create-index-template" title="Create an index template">requirements for a data stream template</a>. It
should also contain your previously chosen name or index pattern in the
<code class="literal">index_patterns</code> property.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are only adding or changing a few things, we recommend you create a
new template by copying an existing one and modifying it as needed.</p>
</div>
</div>
<p>For example, <code class="literal">my-data-stream-template</code> is an existing index template used by
<code class="literal">my-data-stream</code>.</p>
<p>The following <a class="xref" href="index-templates.html" title="Index templates">create or update index template API</a> request
creates a new index template, <code class="literal">new-data-stream-template</code>.
<code class="literal">new-data-stream-template</code> uses <code class="literal">my-data-stream-template</code> as its basis, with the
following changes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The index pattern in <code class="literal">index_patterns</code> matches any index or data stream
starting with <code class="literal">new-data-stream</code>.
</li>
<li class="listitem">
The <code class="literal">@timestamp</code> field mapping uses the <code class="literal">date_nanos</code> field data type rather
than the <code class="literal">date</code> data type.
</li>
<li class="listitem">
The template includes <code class="literal">sort.field</code> and <code class="literal">sort.order</code> index settings, which were
not in the original <code class="literal">my-data-stream-template</code> template.
</li>
</ul>
</div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_index_template(
  name: 'new-data-stream-template',
  body: {
    index_patterns: [
      'new-data-stream*'
    ],
    data_stream: {},
    priority: 500,
    template: {
      mappings: {
        properties: {
          "@timestamp": {
            type: 'date_nanos'
          }
        }
      },
      settings: {
        "sort.field": [
          '@timestamp'
        ],
        "sort.order": [
          'desc'
        ]
      }
    }
  }
)
puts response</pre>
</div>
<a id="ca08e511e5907d258081b10a1a9f0072"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">PUT /_index_template/new-data-stream-template
{
  "index_patterns": [ "new-data-stream*" ],
  "data_stream": { },
  "priority": 500,
  "template": {
    "mappings": {
      "properties": {
        "@timestamp": {
          "type": "date_nanos"                 <a id="CO173-1"></a><i class="conum" data-value="1"></i>
        }
      }
    },
    "settings": {
      "sort.field": [ "@timestamp"],          <a id="CO173-2"></a><i class="conum" data-value="2"></i>
      "sort.order": [ "desc"]                 <a id="CO173-3"></a><i class="conum" data-value="3"></i>
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/636.console"></div>
<div class="calloutlist default has-ruby lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO173-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Changes the <code class="literal">@timestamp</code> field mapping to the <code class="literal">date_nanos</code> field data type.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO173-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds the <code class="literal">sort.field</code> index setting.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO173-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds the <code class="literal">sort.order</code> index setting.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Use the <a class="xref" href="indices-create-data-stream.html" title="Create data stream API">create data stream API</a> to manually
create the new data stream. The name of the data stream must match the index
pattern defined in the new template&#8217;s <code class="literal">index_patterns</code> property.</p>
<p>We do not recommend <a class="xref" href="set-up-a-data-stream.html#create-data-stream" title="Create the data stream">indexing new data
to create this data stream</a>. Later, you will reindex older data from an
existing data stream into this new stream. This could result in one or more
backing indices that contains a mix of new and old data.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p><a id="data-stream-mix-new-old-data"></a><span class="strong strong"><strong>Mixing new and old data in a data stream</strong></span></p>
<p>While mixing new and old data is safe, it could interfere with data retention.
If you delete older indices, you could accidentally delete a backing index that
contains both new and old data. To prevent premature data loss, you would need
to retain such a backing index until you are ready to delete its newest data.</p>
</div>
</div>
<p>The following create data stream API request targets <code class="literal">new-data-stream</code>, which
matches the index pattern for <code class="literal">new-data-stream-template</code>.
Because no existing index or data stream uses this name, this request creates
the <code class="literal">new-data-stream</code> data stream.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create_data_stream(
  name: 'new-data-stream'
)
puts response</pre>
</div>
<a id="38af4a55c1ea0f908dc7b06d680d2789"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">PUT /_data_stream/new-data-stream</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/637.console"></div>
</li>
<li class="listitem">
If you do not want to mix new and old data in your new data stream, pause the
indexing of new documents. While mixing old and new data is safe, it could
interfere with data retention. See <a class="xref" href="modify-data-streams.html#data-stream-mix-new-old-data">Mixing new and
old data in a data stream</a>.
</li>
<li class="listitem">
<p>If you use ILM to <a class="xref" href="getting-started-index-lifecycle-management.html" title="Tutorial: Automate rollover with ILM">automate
rollover</a>, reduce the ILM poll interval. This ensures the current write
index doesn’t grow too large while waiting for the rollover check. By default,
ILM checks rollover conditions every 10 minutes.</p>
<p>The following <a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">cluster update settings API</a> request
lowers the <code class="literal">indices.lifecycle.poll_interval</code> setting to <code class="literal">1m</code> (one minute).</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.cluster.put_settings(
  body: {
    persistent: {
      "indices.lifecycle.poll_interval": '1m'
    }
  }
)
puts response</pre>
</div>
<a id="998651b98e152add530084a631a4ab5a"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">PUT /_cluster/settings
{
  "persistent": {
    "indices.lifecycle.poll_interval": "1m"
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/638.console"></div>
</li>
<li class="listitem">
<p>Reindex your data to the new data stream using an <code class="literal">op_type</code> of <code class="literal">create</code>.</p>
<p>If you want to partition the data in the order in which it was originally
indexed, you can run separate reindex requests. These reindex requests can use
individual backing indices as the source. You can use the
<a class="xref" href="indices-get-data-stream.html" title="Get data stream API">get data stream API</a> to retrieve a list of backing
indices.</p>
<p>For example, you plan to reindex data from <code class="literal">my-data-stream</code> into
<code class="literal">new-data-stream</code>. However, you want to submit a separate reindex request for
each backing index in <code class="literal">my-data-stream</code>, starting with the oldest backing index.
This preserves the order in which the data was originally indexed.</p>
<p>The following get data stream API request retrieves information about
<code class="literal">my-data-stream</code>, including a list of its backing indices.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.get_data_stream(
  name: 'my-data-stream'
)
puts response</pre>
</div>
<a id="3337c817ebd438254505a31e91c91724"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">GET /_data_stream/my-data-stream</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/639.console"></div>
<p>The response&#8217;s <code class="literal">indices</code> property contains an array of the stream&#8217;s current
backing indices. The first item in the array contains information about the
stream&#8217;s oldest backing index.</p>
<a id="1934d25ff03aa3f34b9ce4ab0fcc3f83"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "data_streams": [
    {
      "name": "my-data-stream",
      "timestamp_field": {
        "name": "@timestamp"
      },
      "indices": [
        {
          "index_name": ".ds-my-data-stream-2099.03.07-000001", <a id="CO174-1"></a><i class="conum" data-value="1"></i>
          "index_uuid": "Gpdiyq8sRuK9WuthvAdFbw"
        },
        {
          "index_name": ".ds-my-data-stream-2099.03.08-000002",
          "index_uuid": "_eEfRrFHS9OyhqWntkgHAQ"
        }
      ],
      "generation": 2,
      "status": "GREEN",
      "template": "my-data-stream-template",
      "hidden": false,
      "system": false,
      "allow_custom_routing": false,
      "replicated": false
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO174-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>First item in the <code class="literal">indices</code> array for <code class="literal">my-data-stream</code>. This item contains
information about the stream&#8217;s oldest backing index,
<code class="literal">.ds-my-data-stream-2099.03.07-000001</code>.</p>
</td>
</tr>
</table>
</div>
<p>The following <a class="xref" href="docs-reindex.html" title="Reindex API">reindex API</a> request copies documents from
<code class="literal">.ds-my-data-stream-2099.03.07-000001</code> to <code class="literal">new-data-stream</code>. The request&#8217;s
<code class="literal">op_type</code> is <code class="literal">create</code>.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.reindex(
  body: {
    source: {
      index: '.ds-my-data-stream-2099.03.07-000001'
    },
    dest: {
      index: 'new-data-stream',
      op_type: 'create'
    }
  }
)
puts response</pre>
</div>
<a id="85f6667f148d16d075493fddf07e2932"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">POST /_reindex
{
  "source": {
    "index": ".ds-my-data-stream-2099.03.07-000001"
  },
  "dest": {
    "index": "new-data-stream",
    "op_type": "create"
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/640.console"></div>
<p>You can also use a query to reindex only a subset of documents with each
request.</p>
<p>The following <a class="xref" href="docs-reindex.html" title="Reindex API">reindex API</a> request copies documents from
<code class="literal">my-data-stream</code> to <code class="literal">new-data-stream</code>. The request
uses a <a class="xref" href="query-dsl-range-query.html" title="Range query"><code class="literal">range</code> query</a> to only reindex documents with a
timestamp within the last week. Note the request&#8217;s <code class="literal">op_type</code> is <code class="literal">create</code>.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.reindex(
  body: {
    source: {
      index: 'my-data-stream',
      query: {
        range: {
          "@timestamp": {
            gte: 'now-7d/d',
            lte: 'now/d'
          }
        }
      }
    },
    dest: {
      index: 'new-data-stream',
      op_type: 'create'
    }
  }
)
puts response</pre>
</div>
<a id="d803ed00d8f45f81c33e415e1c1ecb8c"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">POST /_reindex
{
  "source": {
    "index": "my-data-stream",
    "query": {
      "range": {
        "@timestamp": {
          "gte": "now-7d/d",
          "lte": "now/d"
        }
      }
    }
  },
  "dest": {
    "index": "new-data-stream",
    "op_type": "create"
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/641.console"></div>
</li>
<li class="listitem">
<p>If you previously changed your ILM poll interval, change it back to its
original value when reindexing is complete. This prevents unnecessary load on
the master node.</p>
<p>The following cluster update settings API request resets the
<code class="literal">indices.lifecycle.poll_interval</code> setting to its default value.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.cluster.put_settings(
  body: {
    persistent: {
      "indices.lifecycle.poll_interval": nil
    }
  }
)
puts response</pre>
</div>
<a id="863253bf0ab7d227ff72a0a384f4de8c"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">PUT /_cluster/settings
{
  "persistent": {
    "indices.lifecycle.poll_interval": null
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/642.console"></div>
</li>
<li class="listitem">
Resume indexing using the new data stream. Searches on this stream will now
query your new data and the reindexed data.
</li>
<li class="listitem">
<p>Once you have verified that all reindexed data is available in the new
data stream, you can safely remove the old stream.</p>
<p>The following <a class="xref" href="indices-delete-data-stream.html" title="Delete data stream API">delete data stream API</a> request
deletes <code class="literal">my-data-stream</code>. This request also deletes the stream&#8217;s
backing indices and any data they contain.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.delete_data_stream(
  name: 'my-data-stream'
)
puts response</pre>
</div>
<a id="f823e4b87ed181b27f73ebc51351f0ee"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">DELETE /_data_stream/my-data-stream</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/643.console"></div>
</li>
</ol>
</div>
<h3><a id="data-streams-change-alias"></a>Update or add an alias to a data stream<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/change-mappings-and-settings.asciidoc">edit</a></h3>
<p>Use the <a class="xref" href="indices-aliases.html" title="Aliases API">aliases API</a> to update an existing data stream&#8217;s
aliases. Changing an existing data stream&#8217;s aliases in its index pattern has no
effect.</p>
<p>For example, the <code class="literal">logs</code> alias points to a single data stream. The following
request swaps the stream for the alias. During this swap, the <code class="literal">logs</code> alias has
no downtime and never points to both streams at the same time.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.update_aliases(
  body: {
    actions: [
      {
        remove: {
          index: 'logs-nginx.access-prod',
          alias: 'logs'
        }
      },
      {
        add: {
          index: 'logs-my_app-default',
          alias: 'logs'
        }
      }
    ]
  }
)
puts response</pre>
</div>
<a id="650a0fb27c66a790c4687267423af1da"></a>
<div class="pre_wrapper lang-console default has-ruby">
<pre class="programlisting prettyprint lang-console default has-ruby">POST _aliases
{
  "actions": [
    {
      "remove": {
        "index": "logs-nginx.access-prod",
        "alias": "logs"
      }
    },
    {
      "add": {
        "index": "logs-my_app-default",
        "alias": "logs"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/644.console"></div>
</div>
<div class="navfooter">
<span class="prev">
<a href="use-a-data-stream.html">« Use a data stream</a>
</span>
<span class="next">
<a href="tsds.html">Time series data stream (TSDS) »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
