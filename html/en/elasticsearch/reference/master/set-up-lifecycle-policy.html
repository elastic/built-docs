<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Configure a lifecycle policy | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Configure a lifecycle policy | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="data-management.html" title="Data management"/>
<link rel="prev" href="ilm-wait-for-snapshot.html" title="Wait for snapshot"/>
<link rel="next" href="migrate-index-allocation-filters.html" title="Migrate index allocation filters to node roles"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="ilm-wait-for-snapshot.html">« Wait for snapshot</a>
</span>
<span class="next">
<a href="migrate-index-allocation-filters.html">Migrate index allocation filters to node roles »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-management.html">Data management</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configure a lifecycle policy</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/set-up-lifecycle-policy.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="set-up-lifecycle-policy"></a>Configure a lifecycle policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/set-up-lifecycle-policy.asciidoc">edit</a></h2>
</div></div></div>
<p>For ILM to manage an index, a valid policy
must be specified in the <code class="literal">index.lifecycle.name</code> index setting.</p>
<p>To configure a lifecycle policy for <a class="xref" href="index-rollover.html" title="Rollover">rolling indices</a>,
you create the policy and add it to the <a class="xref" href="index-templates.html" title="Index templates">index template</a>.</p>
<p>To use a policy to manage an index that doesn&#8217;t roll over,
you can specify a lifecycle policy when you create the index,
or apply a policy directly to an existing index.</p>
<p>ILM policies are stored in the global cluster state and can be included in snapshots
by setting <code class="literal">include_global_state</code> to <code class="literal">true</code> when you <a class="xref" href="snapshots-take-snapshot.html" title="Create a snapshot">take the snapshot</a>.
When the snapshot is restored, all of the policies in the global state are restored and
any local policies with the same names are overwritten.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you enable index lifecycle management for Beats or the Logstash Elasticsearch output plugin,
the necessary policies and configuration changes are applied automatically.
You can modify the default policies, but you do not need to explicitly configure a policy or
bootstrap an initial index.</p>
</div>
</div>
<h3><a id="ilm-create-policy"></a>Create lifecycle policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/set-up-lifecycle-policy.asciidoc">edit</a></h3>
<p>To create a lifecycle policy from Kibana, open the menu and go to <span class="strong strong"><strong>Stack
Management &gt; Index Lifecycle Policies</strong></span>. Click <span class="strong strong"><strong>Create policy</strong></span>.</p>
<p class="screenshot"><span class="image"><img src="images/ilm/create-policy.png" alt="Create policy page"></span></p>
<p>You specify the lifecycle phases for the policy and the actions to perform in each phase.</p>
<p>The <a class="xref" href="ilm-put-lifecycle.html" title="Create or update lifecycle policy API">create or update policy</a> API is invoked to add the
policy to the Elasticsearch cluster.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'my_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_primary_shard_size: '25GB'
            }
          }
        },
        delete: {
          min_age: '30d',
          actions: {
            delete: {}
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "my_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_primary_shard_size: "25GB",
          },
        },
      },
      delete: {
        min_age: "30d",
        actions: {
          delete: {},
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="5b6bc085943e9189236d98b3c05ed62c"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_primary_shard_size": "25GB" <a id="CO587-1"></a><i class="conum" data-value="1"></i>
          }
        }
      },
      "delete": {
        "min_age": "30d",
        "actions": {
          "delete": {} <a id="CO587-2"></a><i class="conum" data-value="2"></i>
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1845.console"></div>
<div class="calloutlist default has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO587-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Roll over the index when it reaches 25GB in size</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO587-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Delete the index 30 days after rollover</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The rollover action implicitly always rolls over a data stream or alias if one or more shards contain
200000000 or more documents. Normally a shard will reach 25GB long before it reaches 200M documents,
but this isn&#8217;t the case for space efficient data sets. Search performance will very likely suffer
if a shard contains more than 200M documents. This is the reason of the builtin limit.</p>
</div>
</div>
<h3><a id="apply-policy-template"></a>Apply lifecycle policy with an index template<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/set-up-lifecycle-policy.asciidoc">edit</a></h3>
<p>To use a policy that triggers the rollover action,
you need to configure the policy in the index template used to create each new index.
You specify the name of the policy and the alias used to reference the rolling indices.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>An <code class="literal">index.lifecycle.rollover_alias</code> setting is only required if using index lifecycle management with an alias. It is unnecessary when using <a class="xref" href="data-streams.html" title="Data streams">Data Streams</a>.</p>
</div>
</div>
<p>You can use the Kibana Create template wizard to create a template. To access the
wizard, open the menu and go to <span class="strong strong"><strong>Stack Management &gt; Index Management</strong></span>. In the
<span class="strong strong"><strong>Index Templates</strong></span> tab, click <span class="strong strong"><strong>Create template</strong></span>.</p>
<p class="screenshot"><span class="image"><img src="images/ilm/create-template-wizard-my_template.png" alt="Create template page"></span></p>
<p>The wizard invokes the <a class="xref" href="indices-put-template.html" title="Create or update index template API">create or update index template
API</a> to add templates to a cluster.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_index_template(
  name: 'my_template',
  body: {
    index_patterns: [
      'test-*'
    ],
    template: {
      settings: {
        number_of_shards: 1,
        number_of_replicas: 1,
        'index.lifecycle.name' =&gt; 'my_policy',
        'index.lifecycle.rollover_alias' =&gt; 'test-alias'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putIndexTemplate({
  name: "my_template",
  index_patterns: ["test-*"],
  template: {
    settings: {
      number_of_shards: 1,
      number_of_replicas: 1,
      "index.lifecycle.name": "my_policy",
      "index.lifecycle.rollover_alias": "test-alias",
    },
  },
});
console.log(response);</pre>
</div>
<a id="85519a614ae18c998986d46bbad82b76"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _index_template/my_template
{
  "index_patterns": ["test-*"], <a id="CO588-1"></a><i class="conum" data-value="1"></i>
  "template": {
    "settings": {
      "number_of_shards": 1,
      "number_of_replicas": 1,
      "index.lifecycle.name": "my_policy", <a id="CO588-2"></a><i class="conum" data-value="2"></i>
      "index.lifecycle.rollover_alias": "test-alias" <a id="CO588-3"></a><i class="conum" data-value="3"></i>
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1846.console"></div>
<div class="calloutlist default has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO588-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use this template for all new indices whose names begin with <code class="literal">test-</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO588-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Apply <code class="literal">my_policy</code> to new indices created with this template</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO588-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Define an index alias for referencing indices managed by <code class="literal">my_policy</code></p>
</td>
</tr>
</table>
</div>
</div>
</details>
<h4><a id="create-initial-index"></a>Create an initial managed index<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/set-up-lifecycle-policy.asciidoc">edit</a></h4>
<p>When you set up policies for your own rolling indices, if you are not using the recommended
<a class="xref" href="data-streams.html" title="Data streams">data streams</a>, you need to manually create the first index managed by a policy and
designate it as the write index.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you enable index lifecycle management for Beats or the Logstash Elasticsearch output plugin,
the necessary policies and configuration changes are applied automatically.
You can modify the default policies, but you do not need to explicitly configure a policy or
bootstrap an initial index.</p>
</div>
</div>
<p>The name of the index must match the pattern defined in the index template and end with a number.
This number is incremented to generate the name of indices created by the rollover action.</p>
<p>For example, the following request creates the <code class="literal">test-00001</code> index.
Because it matches the index pattern specified in <code class="literal">my_template</code>,
Elasticsearch automatically applies the settings from that template.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'test-000001',
  body: {
    aliases: {
      "test-alias": {
        is_write_index: true
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "test-000001",
  aliases: {
    "test-alias": {
      is_write_index: true,
    },
  },
});
console.log(response);</pre>
</div>
<a id="25737fd456fd317cc4cc2db76b6cf28e"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT test-000001
{
  "aliases": {
    "test-alias":{
      "is_write_index": true <a id="CO589-1"></a><i class="conum" data-value="1"></i>
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1847.console"></div>
<div class="calloutlist default has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO589-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set this initial index to be the write index for this alias.</p>
</td>
</tr>
</table>
</div>
<p>Now you can start indexing data to the rollover alias specified in the lifecycle policy.
With the sample <code class="literal">my_policy</code> policy, the rollover action is triggered once the initial
index exceeds 25GB.
ILM then creates a new index that becomes the write index for the <code class="literal">test-alias</code>.</p>
<h3><a id="apply-policy-manually"></a>Apply lifecycle policy manually<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/set-up-lifecycle-policy.asciidoc">edit</a></h3>
<p>You can specify a policy when you create an index or
apply a policy to an existing index through Kibana Management or
the <a class="xref" href="indices-update-settings.html" title="Update index settings API">update settings API</a>.
When you apply a policy, ILM immediately starts managing the index.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Do not manually apply a policy that uses the rollover action.
Policies that use rollover must be applied by the <a class="xref" href="set-up-lifecycle-policy.html#apply-policy-template" title="Apply lifecycle policy with an index template">index template</a>.
Otherwise, the policy is not carried forward when the rollover action creates a new index.</p>
</div>
</div>
<p>The <code class="literal">index.lifecycle.name</code> setting specifies an index&#8217;s policy.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'test-index',
  body: {
    settings: {
      number_of_shards: 1,
      number_of_replicas: 1,
      'index.lifecycle.name' =&gt; 'my_policy'
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "test-index",
  settings: {
    number_of_shards: 1,
    number_of_replicas: 1,
    "index.lifecycle.name": "my_policy",
  },
});
console.log(response);</pre>
</div>
<a id="d690a6af462c70a783625a323e11c72c"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT test-index
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1,
    "index.lifecycle.name": "my_policy" <a id="CO590-1"></a><i class="conum" data-value="1"></i>
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1848.console"></div>
<div class="calloutlist default has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO590-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Sets the lifecycle policy for the index.</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<h4><a id="apply-policy-multiple"></a>Apply a policy to multiple indices<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/set-up-lifecycle-policy.asciidoc">edit</a></h4>
<p>You can apply the same policy to multiple indices by using wildcards in the index name
when you call the <a class="xref" href="indices-update-settings.html" title="Update index settings API">update settings</a> API.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Be careful that you don&#8217;t inadvertently match indices that you don&#8217;t want to modify.</p>
</div>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_settings(
  index: 'mylogs-pre-ilm*',
  body: {
    index: {
      lifecycle: {
        name: 'mylogs_policy_existing'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putSettings({
  index: "mylogs-pre-ilm*",
  settings: {
    index: {
      lifecycle: {
        name: "mylogs_policy_existing",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="ec195297eb804cba1cb19c9926773059"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT mylogs-pre-ilm*/_settings <a id="CO591-1"></a><i class="conum" data-value="1"></i>
{
  "index": {
    "lifecycle": {
      "name": "mylogs_policy_existing"
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1849.console"></div>
<div class="calloutlist default has-ruby has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO591-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Updates all indices with names that start with <code class="literal">mylogs-pre-ilm</code></p>
</td>
</tr>
</table>
</div>
<h4><a id="switch-lifecycle-policies"></a>Switch lifecycle policies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/set-up-lifecycle-policy.asciidoc">edit</a></h4>
<p>To switch an index&#8217;s lifecycle policy, follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Remove the existing policy using the <a class="xref" href="ilm-remove-policy.html" title="Remove policy from index API">remove policy API</a>.
Target a data stream or alias to remove the policies of all its indices.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.remove_policy(
  index: 'logs-my_app-default'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.removePolicy({
  index: "logs-my_app-default",
});
console.log(response);</pre>
</div>
<a id="ebef3dc8ed1766d433a5cffc40fde7ae"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">POST logs-my_app-default/_ilm/remove</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1850.console"></div>
</li>
<li class="listitem">
<p>The remove policy API removes all ILM metadata from the index and
doesn&#8217;t consider the index&#8217;s lifecycle status. This can leave indices in an
undesired state.</p>
<p>For example, the <a class="xref" href="ilm-forcemerge.html" title="Force merge"><code class="literal">forcemerge</code></a> action temporarily closes an
index before reopening it. Removing an index&#8217;s ILM policy during a
<code class="literal">forcemerge</code> can leave the index closed indefinitely.</p>
<p>After policy removal, use the <a class="xref" href="indices-get-index.html" title="Get index API">get index API</a> to check an
index&#8217;s state . Target a data stream or alias to get the state of all its
indices.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.get(
  index: 'logs-my_app-default'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.get({
  index: "logs-my_app-default",
});
console.log(response);</pre>
</div>
<a id="6a969ebe7490d93d35be895b14e5a42a"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">GET logs-my_app-default</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1851.console"></div>
<p>You can then change the index as needed. For example, you can re-open any
closed indices using the <a class="xref" href="indices-open-close.html" title="Open index API">open index API</a>.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.open(
  index: 'logs-my_app-default'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.open({
  index: "logs-my_app-default",
});
console.log(response);</pre>
</div>
<a id="7fe2179705304af5e87eb382dca6235a"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">POST logs-my_app-default/_open</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1852.console"></div>
</li>
<li class="listitem">
<p>Assign a new policy using the <a class="xref" href="indices-update-settings.html" title="Update index settings API">update settings API</a>.
Target a data stream or alias to assign a policy to all its indices.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Don&#8217;t assign a new policy without first removing the existing policy.
This can cause <a class="xref" href="ilm-index-lifecycle.html#ilm-phase-execution" title="Phase execution">phase execution</a> to silently fail.</p>
</div>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_settings(
  index: 'logs-my_app-default',
  body: {
    index: {
      lifecycle: {
        name: 'new-lifecycle-policy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putSettings({
  index: "logs-my_app-default",
  settings: {
    index: {
      lifecycle: {
        name: "new-lifecycle-policy",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="05f4a4b284f68f7fb13603d7cd854083"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT logs-my_app-default/_settings
{
  "index": {
    "lifecycle": {
      "name": "new-lifecycle-policy"
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1853.console"></div>
</li>
</ol>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ilm-wait-for-snapshot.html">« Wait for snapshot</a>
</span>
<span class="next">
<a href="migrate-index-allocation-filters.html">Migrate index allocation filters to node roles »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
