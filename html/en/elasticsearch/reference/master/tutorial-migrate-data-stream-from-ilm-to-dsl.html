<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tutorial: Migrate ILM managed data stream to data stream lifecycle | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Tutorial: Migrate ILM managed data stream to data stream lifecycle | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="data-stream-lifecycle.html" title="Data stream lifecycle"/>
<link rel="prev" href="tutorial-manage-existing-data-stream.html" title="Tutorial: Update existing data stream"/>
<link rel="next" href="ingest.html" title="Ingest pipelines"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-streams.html">Data streams</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-stream-lifecycle.html">Data stream lifecycle</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="tutorial-manage-existing-data-stream.html">« Tutorial: Update existing data stream</a>
</span>
<span class="next">
<a href="ingest.html">Ingest pipelines »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="tutorial-migrate-data-stream-from-ilm-to-dsl"></a>Tutorial: Migrate ILM managed data stream to data stream lifecycle<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/lifecycle/tutorial-migrate-data-stream-from-ilm-to-dsl.asciidoc">edit</a></h2>
</div></div></div>
<p>In this tutorial we&#8217;ll look at migrating an existing data stream from Index Lifecycle Management (ILM) to
data stream lifecycle. The existing ILM managed backing indices will continue
to be managed by ILM until they age out and get deleted by ILM; however,
the new backing indices will be managed by data stream lifecycle.
This way, a data stream is gradually migrated away from being managed by ILM to
being managed by data stream lifecycle. As we&#8217;ll see, ILM and data stream lifecycle
can co-manage a data stream; however, an index can only be managed by one system at
a time.</p>
<h4><a id="migrate-dsl-ilm-tldr"></a>TL;DR<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/lifecycle/tutorial-migrate-data-stream-from-ilm-to-dsl.asciidoc">edit</a></h4>
<p>To migrate a data stream from ILM to data stream lifecycle we&#8217;ll have to execute
two steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Update the index template that&#8217;s backing the data stream to set <a class="xref" href="data-stream-lifecycle-settings.html#index-lifecycle-prefer-ilm">prefer_ilm</a>
to <code class="literal">false</code>, and to configure data stream lifecycle.
</li>
<li class="listitem">
Configure the data stream lifecycle for the <em>existing</em> data stream using
the <a class="xref" href="data-streams-put-lifecycle.html" title="Set the lifecycle of a data stream">lifecycle API</a>.
</li>
</ol>
</div>
<p>For more details see the <a class="xref" href="tutorial-migrate-data-stream-from-ilm-to-dsl.html#migrate-from-ilm-to-dsl" title="Migrate data stream to data stream lifecycle">migrate to data stream lifecycle</a> section.</p>
<h4><a id="setup-test-data"></a>Setup ILM managed data stream<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/lifecycle/tutorial-migrate-data-stream-from-ilm-to-dsl.asciidoc">edit</a></h4>
<p>Let&#8217;s first create a data stream with two backing indices managed by ILM.
We first create an ILM policy:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'pre-dsl-ilm-policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_primary_shard_size: '50gb'
            }
          }
        },
        delete: {
          min_age: '7d',
          actions: {
            delete: {}
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<a id="1d9b695a17cffd910c496c9b03c75d6f"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT _ilm/policy/pre-dsl-ilm-policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_primary_shard_size": "50gb"
          }
        }
      },
      "delete": {
        "min_age": "7d",
        "actions": {
          "delete": {}
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/715.console"></div>
<p>And let&#8217;s create an index template that&#8217;ll back the data stream and configures ILM:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_index_template(
  name: 'dsl-data-stream-template',
  body: {
    index_patterns: [
      'dsl-data-stream*'
    ],
    data_stream: {},
    priority: 500,
    template: {
      settings: {
        'index.lifecycle.name' =&gt; 'pre-dsl-ilm-policy'
      }
    }
  }
)
puts response</pre>
</div>
<a id="d7a55a7c491e97079e429483085f1d58"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT _index_template/dsl-data-stream-template
{
  "index_patterns": ["dsl-data-stream*"],
  "data_stream": { },
  "priority": 500,
  "template": {
    "settings": {
      "index.lifecycle.name": "pre-dsl-ilm-policy"
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/716.console"></div>
<p>We&#8217;ll now index a document targetting <code class="literal">dsl-data-stream</code> to create the data stream
and we&#8217;ll also manually rollover the data stream to have another generation index created:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.index(
  index: 'dsl-data-stream',
  body: {
    "@timestamp": '2023-10-18T16:21:15.000Z',
    message: '192.0.2.42 - - [06/May/2099:16:21:15 +0000] "GET /images/bg.jpg HTTP/1.0" 200 24736'
  }
)
puts response</pre>
</div>
<a id="8fec06a98d0151c1d717a01491d0b8f0"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">POST dsl-data-stream/_doc?
{
  "@timestamp": "2023-10-18T16:21:15.000Z",
  "message": "192.0.2.42 - - [06/May/2099:16:21:15 +0000] \"GET /images/bg.jpg HTTP/1.0\" 200 24736"
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/717.console"></div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.rollover(
  alias: 'dsl-data-stream'
)
puts response</pre>
</div>
<a id="10f0c8fed98455c460c374b50ffbb204"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">POST dsl-data-stream/_rollover</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/718.console"></div>
<p>We&#8217;ll use the <a class="xref" href="indices-get-data-stream.html" title="Get data stream API">GET _data_stream</a> API to inspect the state of
the data stream:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.get_data_stream(
  name: 'dsl-data-stream'
)
puts response</pre>
</div>
<a id="a6ccac9f80c5e5efdaab992f3a32d919"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">GET _data_stream/dsl-data-stream</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/719.console"></div>
<p>Inspecting the response we&#8217;ll see that both backing indices are managed by ILM
and that the next generation index will also be managed by ILM:</p>
<a id="e14c92349f033a6a34f0b967e9d27dad"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "data_streams": [
    {
      "name": "dsl-data-stream",
      "timestamp_field": {
        "name": "@timestamp"
      },
      "indices": [
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000001",    <a id="CO196-1"></a><i class="conum" data-value="1"></i>
          "index_uuid": "xCEhwsp8Tey0-FLNFYVwSg",
          "prefer_ilm": true,                                       <a id="CO196-2"></a><i class="conum" data-value="2"></i>
          "ilm_policy": "pre-dsl-ilm-policy",                       <a id="CO196-3"></a><i class="conum" data-value="3"></i>
          "managed_by": "Index Lifecycle Management"                <a id="CO196-4"></a><i class="conum" data-value="4"></i>
        },
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000002",
          "index_uuid": "PA_JquKGSiKcAKBA8DJ5gw",
          "prefer_ilm": true,
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Index Lifecycle Management"
        }
      ],
      "generation": 2,
      "status": "GREEN",
      "template": "dsl-data-stream-template",
      "next_generation_managed_by": "Index Lifecycle Management",   <a id="CO196-5"></a><i class="conum" data-value="5"></i>
      "prefer_ilm": true,                                           <a id="CO196-6"></a><i class="conum" data-value="6"></i>
      "ilm_policy": "pre-dsl-ilm-policy",                           <a id="CO196-7"></a><i class="conum" data-value="7"></i>
      "hidden": false,
      "system": false,
      "allow_custom_routing": false,
      "replicated": false,
      "rollover_on_write": false
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the backing index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>For each backing index we display the value of the <a class="xref" href="data-stream-lifecycle-settings.html#index-lifecycle-prefer-ilm">prefer_ilm</a>
configuration which will indicate if ILM takes precedence over data stream lifecycle in case
both systems are configured for an index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The ILM policy configured for this index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The system that manages this index (possible values are "Index Lifecycle Management",
"Data stream lifecycle", or "Unmanaged")</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The system that will manage the next generation index (the new write index of this
data stream, once the data stream is rolled over). The possible values are
"Index Lifecycle Management", "Data stream lifecycle", or "Unmanaged".</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <a class="xref" href="data-stream-lifecycle-settings.html#index-lifecycle-prefer-ilm">prefer_ilm</a> value configured in the index template
that&#8217;s backing the data stream. This value will be configured for all the new backing indices.
If it&#8217;s not configured in the index template the backing indices will receive the <code class="literal">true</code>
default value (ILM takes precedence over data stream lifecycle by default as it&#8217;s
currently richer in features).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO196-7"><i class="conum" data-value="7"></i></a></p>
</td>
<td align="left" valign="top">
<p>The ILM policy configured in the index template that&#8217;s backing this data
stream (which will be configured on all the new backing indices, as long as it exists
in the index template).</p>
</td>
</tr>
</table>
</div>
<h4><a id="migrate-from-ilm-to-dsl"></a>Migrate data stream to data stream lifecycle<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/lifecycle/tutorial-migrate-data-stream-from-ilm-to-dsl.asciidoc">edit</a></h4>
<p>To migrate the <code class="literal">dsl-data-stream</code> to data stream lifecycle we&#8217;ll have to execute
two steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Update the index template that&#8217;s backing the data stream to set <a class="xref" href="data-stream-lifecycle-settings.html#index-lifecycle-prefer-ilm">prefer_ilm</a>
to <code class="literal">false</code>, and to configure data stream lifecycle.
</li>
<li class="listitem">
Configure the data stream lifecycle for the <em>existing</em> <code class="literal">dsl-data-stream</code> using
the <a class="xref" href="data-streams-put-lifecycle.html" title="Set the lifecycle of a data stream">lifecycle API</a>.
</li>
</ol>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The data stream lifecycle configuration that&#8217;s added to the index template,
being a data stream configuration, will only apply to <span class="strong strong"><strong>new</strong></span> data streams.
Our data stream exists already, so even though we added a data stream lifecycle
configuration in the index template it will not be applied to <code class="literal">dsl-data-stream</code>.</p>
</div>
</div>
<p><a id="update-index-template-for-dsl"></a>Let&#8217;s update the index template:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_index_template(
  name: 'dsl-data-stream-template',
  body: {
    index_patterns: [
      'dsl-data-stream*'
    ],
    data_stream: {},
    priority: 500,
    template: {
      settings: {
        'index.lifecycle.name' =&gt; 'pre-dsl-ilm-policy',
        'index.lifecycle.prefer_ilm' =&gt; false
      },
      lifecycle: {
        data_retention: '7d'
      }
    }
  }
)
puts response</pre>
</div>
<a id="e95e61988dc3073a007f7b7445dd233b"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT _index_template/dsl-data-stream-template
{
  "index_patterns": ["dsl-data-stream*"],
  "data_stream": { },
  "priority": 500,
  "template": {
    "settings": {
      "index.lifecycle.name": "pre-dsl-ilm-policy",
      "index.lifecycle.prefer_ilm": false             <a id="CO197-1"></a><i class="conum" data-value="1"></i>
    },
    "lifecycle": {
      "data_retention": "7d"                          <a id="CO197-2"></a><i class="conum" data-value="2"></i>
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/720.console"></div>
<div class="calloutlist default has-ruby lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO197-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">prefer_ilm</code> setting will now be configured on the <span class="strong strong"><strong>new</strong></span> backing indices
(created by rolling over the data stream) such that ILM does <em>not</em> take
precedence over data stream lifecycle.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO197-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>We&#8217;re configuring the data stream lifecycle so <em>new</em> data streams will be
managed by data stream lifecycle.</p>
</td>
</tr>
</table>
</div>
<p>We&#8217;ve now made sure that new data streams will be managed by data stream lifecycle.</p>
<p>Let&#8217;s update our existing <code class="literal">dsl-data-stream</code> and configure data stream lifecycle:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_data_lifecycle(
  name: 'dsl-data-stream',
  body: {
    data_retention: '7d'
  }
)
puts response</pre>
</div>
<a id="2dad2b0c8ba503228f4b11cecca0b348"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT _data_stream/dsl-data-stream/_lifecycle
{
    "data_retention": "7d"
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/721.console"></div>
<p>We can inspect the data stream to check that the next generation will indeed be
managed by data stream lifecycle:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.get_data_stream(
  name: 'dsl-data-stream'
)
puts response</pre>
</div>
<a id="a6ccac9f80c5e5efdaab992f3a32d919"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">GET _data_stream/dsl-data-stream</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/722.console"></div>
<a id="724a9bb9ed0091b38b266b5bba385bb3"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "data_streams": [
    {
      "name": "dsl-data-stream",
      "timestamp_field": {
        "name": "@timestamp"
      },
      "indices": [
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000001",
          "index_uuid": "xCEhwsp8Tey0-FLNFYVwSg",
          "prefer_ilm": true,
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Index Lifecycle Management"                <a id="CO198-1"></a><i class="conum" data-value="1"></i>
        },
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000002",
          "index_uuid": "PA_JquKGSiKcAKBA8DJ5gw",
          "prefer_ilm": true,
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Index Lifecycle Management"                <a id="CO198-2"></a><i class="conum" data-value="2"></i>
        }
      ],
      "generation": 2,
      "status": "GREEN",
      "template": "dsl-data-stream-template",
      "lifecycle": {
        "enabled": true,
        "data_retention": "7d"
      },
      "ilm_policy": "pre-dsl-ilm-policy",
      "next_generation_managed_by": "Data stream lifecycle",         <a id="CO198-3"></a><i class="conum" data-value="3"></i>
      "prefer_ilm": false,                                           <a id="CO198-4"></a><i class="conum" data-value="4"></i>
      "hidden": false,
      "system": false,
      "allow_custom_routing": false,
      "replicated": false,
      "rollover_on_write": false
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO198-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The existing backing index will continue to be managed by ILM</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO198-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The existing backing index will continue to be managed by ILM</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO198-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The next generation index will be managed by Data stream lifecycle</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO198-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">prefer_ilm</code> setting value we configured in the index template is reflected
and will be configured accordingly for new backing indices.</p>
</td>
</tr>
</table>
</div>
<p>We&#8217;ll now rollover the data stream to see the new generation index being managed by
data stream lifecycle:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.rollover(
  alias: 'dsl-data-stream'
)
puts response</pre>
</div>
<a id="10f0c8fed98455c460c374b50ffbb204"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">POST dsl-data-stream/_rollover</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/723.console"></div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.get_data_stream(
  name: 'dsl-data-stream'
)
puts response</pre>
</div>
<a id="a6ccac9f80c5e5efdaab992f3a32d919"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">GET _data_stream/dsl-data-stream</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/724.console"></div>
<a id="add28b6d21be4bd38bf1a4efb3c6e162"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "data_streams": [
    {
      "name": "dsl-data-stream",
      "timestamp_field": {
        "name": "@timestamp"
      },
      "indices": [
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000001",
          "index_uuid": "xCEhwsp8Tey0-FLNFYVwSg",
          "prefer_ilm": true,
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Index Lifecycle Management"                <a id="CO199-1"></a><i class="conum" data-value="1"></i>
        },
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000002",
          "index_uuid": "PA_JquKGSiKcAKBA8DJ5gw",
          "prefer_ilm": true,
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Index Lifecycle Management"                <a id="CO199-2"></a><i class="conum" data-value="2"></i>
        },
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000003",
          "index_uuid": "PA_JquKGSiKcAKBA8abcd1",
          "prefer_ilm": false,                                      <a id="CO199-3"></a><i class="conum" data-value="3"></i>
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Data stream lifecycle"                     <a id="CO199-4"></a><i class="conum" data-value="4"></i>
        }
      ],
      "generation": 3,
      "status": "GREEN",
      "template": "dsl-data-stream-template",
      "lifecycle": {
        "enabled": true,
        "data_retention": "7d"
      },
      "ilm_policy": "pre-dsl-ilm-policy",
      "next_generation_managed_by": "Data stream lifecycle",
      "prefer_ilm": false,
      "hidden": false,
      "system": false,
      "allow_custom_routing": false,
      "replicated": false,
      "rollover_on_write": false
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO199-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The backing indices that existed before rollover will continue to be managed by ILM</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO199-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The backing indices that existed before rollover will continue to be managed by ILM</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO199-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The new write index received the <code class="literal">false</code> value for the <code class="literal">prefer_ilm</code> setting, as we configured
in the index template</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO199-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The new write index is managed by <code class="literal">Data stream lifecycle</code></p>
</td>
</tr>
</table>
</div>
<h4><a id="migrate-from-dsl-to-ilm"></a>Migrate data stream back to ILM<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/data-streams/lifecycle/tutorial-migrate-data-stream-from-ilm-to-dsl.asciidoc">edit</a></h4>
<p>We can easily change this data stream to be managed by ILM because we didn&#8217;t remove
the ILM policy when we <a class="xref" href="tutorial-migrate-data-stream-from-ilm-to-dsl.html#update-index-template-for-dsl">updated
the index template</a>.</p>
<p>We can achieve this in two ways:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="data-streams-delete-lifecycle.html" title="Delete the lifecycle of a data stream">Delete the lifecycle</a> from the data streams
</li>
<li class="listitem">
Disable data stream lifecycle by configuring the <code class="literal">enabled</code> flag to <code class="literal">false</code>.
</li>
</ol>
</div>
<p>Let&#8217;s implement option 2 and disable the data stream lifecycle:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_data_lifecycle(
  name: 'dsl-data-stream',
  body: {
    data_retention: '7d',
    enabled: false
  }
)
puts response</pre>
</div>
<a id="96ea0e80323d6d2d99964625c004a44d"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">PUT _data_stream/dsl-data-stream/_lifecycle
{
    "data_retention": "7d",
    "enabled": false <a id="CO200-1"></a><i class="conum" data-value="1"></i>
}</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/725.console"></div>
<div class="calloutlist default has-ruby lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO200-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">enabled</code> flag can be ommitted and defaults to <code class="literal">true</code> however, here we
explicitly configure it to <code class="literal">false</code>
Let&#8217;s check the state of the data stream:</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.get_data_stream(
  name: 'dsl-data-stream'
)
puts response</pre>
</div>
<a id="a6ccac9f80c5e5efdaab992f3a32d919"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">GET _data_stream/dsl-data-stream</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/726.console"></div>
<a id="2ae487e3f60fe80f65dd9daff02059ee"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "data_streams": [
    {
      "name": "dsl-data-stream",
      "timestamp_field": {
        "name": "@timestamp"
      },
      "indices": [
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000001",
          "index_uuid": "xCEhwsp8Tey0-FLNFYVwSg",
          "prefer_ilm": true,
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Index Lifecycle Management"
        },
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000002",
          "index_uuid": "PA_JquKGSiKcAKBA8DJ5gw",
          "prefer_ilm": true,
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Index Lifecycle Management"
        },
        {
          "index_name": ".ds-dsl-data-stream-2023.10.19-000003",
          "index_uuid": "PA_JquKGSiKcAKBA8abcd1",
          "prefer_ilm": false,
          "ilm_policy": "pre-dsl-ilm-policy",
          "managed_by": "Index Lifecycle Management"                <a id="CO201-1"></a><i class="conum" data-value="1"></i>
        }
      ],
      "generation": 3,
      "status": "GREEN",
      "template": "dsl-data-stream-template",
      "lifecycle": {
        "enabled": false,                                          <a id="CO201-2"></a><i class="conum" data-value="2"></i>
        "data_retention": "7d"
      },
      "ilm_policy": "pre-dsl-ilm-policy",
      "next_generation_managed_by": "Index Lifecycle Management",  <a id="CO201-3"></a><i class="conum" data-value="3"></i>
      "prefer_ilm": false,
      "hidden": false,
      "system": false,
      "allow_custom_routing": false,
      "replicated": false,
      "rollover_on_write": false
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO201-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The write index is now managed by ILM</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO201-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">lifecycle</code> configured on the data stream is now disabled.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO201-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The next write index will be managed by ILM</p>
</td>
</tr>
</table>
</div>
<p>Had we removed the ILM policy from the index template when we <a class="xref" href="tutorial-migrate-data-stream-from-ilm-to-dsl.html#update-index-template-for-dsl">updated</a>
it, the write index of the data stream will now be <code class="literal">Unmanaged</code> because the index
wouldn&#8217;t have the ILM policy configured to fallback onto.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="tutorial-manage-existing-data-stream.html">« Tutorial: Update existing data stream</a>
</span>
<span class="next">
<a href="ingest.html">Ingest pipelines »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs.js"></script>
    <script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
