<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Configure encryption keys | Elastic Enterprise Search Documentation [7.17] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Enterprise Search Documentation [7.17]"/>
<link rel="up" href="configuration.html" title="Configuration"/>
<link rel="prev" href="configuration.html" title="Configuration"/>
<link rel="next" href="mailer-configuration.html" title="Configure a mail service"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/7.17"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="7.17"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elastic Enterprise Search Documentation [7.17]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="configuration.html">Configuration</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="configuration.html">« Configuration</a>
</span>
<span class="next">
<a href="mailer-configuration.html">Configure a mail service »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="encryption-keys"></a>Configure encryption keys<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.17/enterprise-search-docs/configuration/encryption-keys.asciidoc">edit</a></h2>
</div></div></div>
<p>Enterprise Search is designed to keep content source synchronization credentials, API tokens and other sensitive information secure at all times. Data protection at rest is implemented by using a set of encryption keys shared between all nodes of an Enterprise Search deployment. To ensure safe storage of your sensitive information, <span class="strong strong"><strong>encryption keys must be provided when starting and deploying the service</strong></span>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When running on Elastic Cloud or <a href="/guide/en/cloud-on-k8s/current/index.html" class="ulink" target="_top">Elastic Cloud on Kubernetes (ECK)</a>, the platform takes care of your encryption secrets and you are not required to set them yourselves.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encryption-keys-config"></a>Encryption keys configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.17/enterprise-search-docs/configuration/encryption-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>To configure encryption keys, locate the <code class="literal">config/enterprise-search.yml</code> configuration file in the Enterprise Search directory, and set a <code class="literal">secret_management.encryption_keys</code> value:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">secret_management.encryption_keys: [{encryption_key1}, {encryption_key2}, {...}]</pre>
</div>
<p><code class="literal">secret_management.encryption_keys</code> requires an array of values with at least one encryption key. Each key value needs to be a unique string and we recommend using a random value that is impossible to guess (256-bits or longer). See the <a class="xref" href="encryption-keys.html#encryption-keys-generation" title="Generating encryption keys">dedicated section</a> below on how you can generate a secure encryption key.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Since encryption keys are used to persist data in an Elasticsearch cluster shared by all nodes of an Enterprise Search deployment, you need to <span class="strong strong"><strong>ensure all nodes within an Enterprise search deployment share the same set of encryption keys</strong></span>. Failure to configure the same keys across all nodes will lead to data inconsistencies and potential data loss.</p>
</div>
</div>
<p>When restoring an Enterprise Search deployment from a backup, you need to make sure your configuration file contains the right set of encryption keys to allow you to gain access to the restored dataset (on Elastic Cloud it happens automatically).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encryption-keys-protection"></a>Protecting your encryption keys<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.17/enterprise-search-docs/configuration/encryption-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>The keys configured in the configuration file should be treated as sensitive information and protected from unauthorized access by third parties and from data loss. We recommend using permissions that do not allow reads by anybody but the owner (<code class="literal">0640</code> or <code class="literal">-rw-r----</code>), storing the configuration file on an encrypted disk volume and encrypting the file during filesystem backups.</p>
<p>In Docker and Kubernetes environments, we recommend using <a href="https://docs.docker.com/engine/swarm/secrets/" class="ulink" target="_top">Docker secrets</a> or <a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/" class="ulink" target="_top">Kubernetes encrypted secrets</a> to protect your encryption keys and provide them to the deployment via container environment variables.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Should an encryption key be misplaced or lost, the encrypted access tokens and source synchronization credentials will no longer be accessible, and content synchronization will be halted for all sources until they are re-authenticated.</p>
<p>We recommend you save your keys in a password manager or some other secure storage to ensure you would not lose access to encrypted data in Enterprise Search.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encryption-keys-rotation"></a>Using multiple keys and key rotation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.17/enterprise-search-docs/configuration/encryption-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>Following the well-established <a href="https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final" class="ulink" target="_top">security practices</a> and various compliance requirements around the world, we recommend periodically rotating your encryption keys.</p>
<p>To support graceful key rotation, Enterprise Search lets you set multiple encryption keys. When a new value is added to the <code class="literal">encryption_keys</code> array, Enterprise Search will attempt to decrypt secrets from the first entry, moving across the array until success. Secrets are re-encrypted with the last key in the array when rewritten, which effectively allows you to rotate encryption secrets without downtime.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encryption-keys-generation"></a>Generating encryption keys<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.17/enterprise-search-docs/configuration/encryption-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>There are several techniques for generating secure random 256-bit encryption keys.</p>
<p>On systems with <code class="literal">openssl</code> installed, run:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">openssl rand -hex 32</pre>
</div>
<p>Or on Linux environments without <code class="literal">openssl</code>, including empty docker containers for CentOS, Ubuntu, Debian, Alpine and even in a busybox environment, run this command:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">od  -vN 32 -An -tx1 /dev/urandom | tr -d " \n" ; echo</pre>
</div>
<p>If you do not specify a <code class="literal">secret_management.encryption_keys</code> value in the <code class="literal">config/enterprise-search.yml</code> file and run Enterprise Search, Enterprise Search will fail to start. But before failing, Enterprise Search will generate and display an example encryption key that you can copy and paste into the configuration file.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="configuration.html">« Configuration</a>
</span>
<span class="next">
<a href="mailer-configuration.html">Configure a mail service »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
