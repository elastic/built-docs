<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Connector API tutorial | Enterprise Search documentation [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Connector API tutorial | Enterprise Search documentation [8.14]">

<link rel="home" href="index.html" title="Enterprise Search documentation [8.14]"/>
<link rel="up" href="connectors-apis.html" title="Connector APIs"/>
<link rel="prev" href="connectors-apis.html" title="Connector APIs"/>
<link rel="next" href="connectors-sync-types.html" title="Content syncs"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Enterprise Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/8.14"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="connectors-apis.html">« Connector APIs</a>
</span>
<span class="next">
<a href="connectors-sync-types.html">Content syncs »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
<div id="related-products" class="dropdown">
<div class="related-products-title"></div>
<div class="dropdown-anchor" tabindex="0">Enterprise Search<span class="dropdown-icon"></span></div>
<div class="dropdown-content">
<ul>
<li class="dropdown-category">Enterprise Search guides</li>
<ul>
<li><a href="/guide/en/enterprise-search/current/index.html" target="_blank">Enterprise Search</a></li>
<li><a href="/guide/en/app-search/current/index.html" target="_blank">App Search</a></li>
<li><a href="/guide/en/workplace-search/current/index.html" target="_blank">Workplace Search</a></li>
</ul>
<li class="dropdown-category">Programming language clients</li>
<ul>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/enterprise-search-node/current/index.html" target="_blank">Node.js client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/php/current/index.html" target="_blank">PHP client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/python/current/index.html" target="_blank">Python client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/ruby/current/index.html" target="_blank">Ruby client</a></li>
</ul>
</ul>
</div>
</div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="connectors.html">Elastic connectors</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="connectors-apis.html">Connector APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Connector API tutorial</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="connectors-tutorial-api"></a>Connector API tutorial<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h2>
</div></div></div>

<p>Learn how to set up a self-managed connector client using the <a href="/guide/en/elasticsearch/reference/8.14/connector-apis.html" class="ulink" target="_top">Elasticsearch Connector APIs</a>.</p>
<p>For this example we&#8217;ll use the <a class="xref" href="connectors-postgresql.html" title="Elastic PostgreSQL connector reference">PostgreSQL connector</a> to sync data from a PostgreSQL database to Elasticsearch.
We&#8217;ll spin up a simple PostgreSQL instance in Docker with some example data, create a connector, and sync the data to Elasticsearch.
You can follow the same steps to set up a connector for another data source.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>This tutorial focuses on running a self-managed connector on your own infrastructure, and managing syncs using the Connector APIs.
See <a class="xref" href="connectors.html" title="Elastic connectors"><em>Connectors</em></a> for an overview of how connectors work.</p>
<p>If you&#8217;re just getting started with Elasticsearch, this tutorial might be a bit advanced.
Refer to <a href="/guide/en/elasticsearch/reference/8.14/getting-started.html" class="ulink" target="_top">quickstart</a> for a more beginner-friendly introduction to Elasticsearch.</p>
<p>If you&#8217;re just getting started with connectors, you might want to start in the UI first.
We have two tutorials that focus on managing connectors using the UI:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="mongodb-start.html" title="MongoDB native connector tutorial">Native connector tutorial</a>. Set up a native MongoDB connector, fully managed in Elastic Cloud.
</li>
<li class="listitem">
<a class="xref" href="postgresql-connector-client-tutorial.html" title="PostgreSQL connector client tutorial">Connector client tutorial</a>. Set up a self-managed PostgreSQL connector.
</li>
</ul>
</div>
</div>
</div>
<h4><a id="connectors-tutorial-api-prerequisites"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You should be familiar with how <a class="xref" href="connectors.html" title="Elastic connectors">connectors</a> work, to understand how the API calls relate to the overall connector setup.
</li>
<li class="listitem">
You need to have <a href="https://www.docker.com/products/docker-desktop/" class="ulink" target="_top">Docker Desktop</a> installed.
</li>
<li class="listitem">
You need to have Elasticsearch running, and an API key to access it.
Refer to the next section for details, if you don&#8217;t have an Elasticsearch deployment yet.
</li>
</ul>
</div>
<h4><a id="connectors-tutorial-api-setup-es"></a>Set up Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<p>If you already have an Elasticsearch deployment on Elastic Cloud (<em>Hosted deployment</em> or <em>Serverless project</em>), you&#8217;re good to go.
To spin up Elasticsearch in local dev mode in Docker for testing purposes, open the collapsible section below.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Run local Elasticsearch in Docker</strong></span></summary>
<div class="content">
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -p 9200:9200 -d --name elasticsearch \
  -e "discovery.type=single-node" \
  -e "xpack.security.enabled=false" \
  -e "xpack.security.http.ssl.enabled=false" \
  -e "xpack.license.self_generated.type=trial" \
  docker.elastic.co/elasticsearch/elasticsearch:8.14.3</pre>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This Elasticsearch setup is for development purposes only.
Never use this configuration in production.
Refer to <a href="/guide/en/elasticsearch/reference/8.14/setup.html" class="ulink" target="_top">Set up Elasticsearch</a> for production-grade installation instructions, including Docker.</p>
</div>
</div>
<p>We will use the default password <code class="literal">changeme</code> for the <code class="literal">elastic</code> user. For production environments, always ensure your cluster runs with security enabled.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">export ELASTIC_PASSWORD="changeme"</pre>
</div>
<p>Since we run our cluster locally with security disabled, we won&#8217;t use API keys to authenticate against the Elasticsearch. Instead, in each cURL request, we will use the <code class="literal">-u</code> flag for authentication.</p>
<p>Let&#8217;s test that we can access Elasticsearch:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -s -X GET -u elastic:$ELASTIC_PASSWORD http://localhost:9200</pre>
</div>
<p>Note: With Elasticsearch running locally, you will need to pass the username and password to authenticate against Elasticsearch in the configuration file for the connector service.</p>
</div>
</details>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Running API calls</strong></p>
</div></div></div>
<p>You can run API calls using the <a href="/guide/en/kibana/master/console-kibana.html" class="ulink" target="_top">Dev Tools Console</a> in Kibana, using <code class="literal">curl</code> in your terminal, or with our programming language clients.
Our example widget allows you to copy code examples in both Dev Tools Console syntax and curl syntax.
To use curl, you&#8217;ll need to add authentication headers to your request.</p>
<p>Here&#8217;s an example of how to do that. Note that if you want the connector ID to be auto-generated, use the <code class="literal">POST _connector</code> endpoint.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -s -X PUT http://localhost:9200/_connector/my-connector-id \
-H "Authorization: APIKey $APIKEY" \
-H "Content-Type: application/json" \
-d '{
  "name": "Music catalog",
  "index_name":  "music",
  "service_type": "postgresql"
}'</pre>
</div>
<p>Refer to <a class="xref" href="connectors-tutorial-api.html#connectors-tutorial-api-create-api-key" title="Create an API key">Create an API key</a> for instructions on creating an API key.</p>
</div>
<h4><a id="connectors-tutorial-api-setup-postgres"></a>Run PostgreSQL instance in Docker (optional)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<p>For this tutorial, we&#8217;ll set up a PostgreSQL instance in Docker with some example data.
Of course, you can <span class="strong strong"><strong>skip this step and use your own existing PostgreSQL instance</strong></span> if you have one.
Keep in mind that using a different instance might require adjustments to the connector configuration described in the next steps.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Expand</strong></span> to run simple PostgreSQL instance in Docker and import example data</summary>
<div class="content">
<p>Let&#8217;s launch a PostgreSQL container with a user and password, exposed at port <code class="literal">5432</code>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run --name postgres -e POSTGRES_USER=myuser -e POSTGRES_PASSWORD=mypassword -p 5432:5432 -d postgres</pre>
</div>
<p><span class="strong strong"><strong>Download and import example data</strong></span></p>
<p>Next we need to create a directory to store our example dataset for this tutorial.
In your terminal, run the following command:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">mkdir -p ~/data</pre>
</div>
<p>We will use the <a href="https://github.com/lerocha/chinook-database/blob/master/ChinookDatabase/DataSources/Chinook_PostgreSql.sql" class="ulink" target="_top">Chinook dataset</a> example data.</p>
<p>Run the following command to download the file to the <code class="literal">~/data</code> directory:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -L https://raw.githubusercontent.com/lerocha/chinook-database/master/ChinookDatabase/DataSources/Chinook_PostgreSql.sql -o ~/data/Chinook_PostgreSql.sql</pre>
</div>
<p>Now we need to import the example data into the PostgreSQL container and create the tables.</p>
<p>Run the following Docker commands to copy our sample data into the container and execute the <code class="literal">psql</code> script:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker cp ~/data/Chinook_PostgreSql.sql postgres:/
docker exec -it postgres psql -U myuser -f /Chinook_PostgreSql.sql</pre>
</div>
<p>Let&#8217;s verify that the tables are created correctly in the <code class="literal">chinook</code> database:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker exec -it postgres psql -U myuser -d chinook -c "\dt"</pre>
</div>
<p>The <code class="literal">album</code> table should contain <span class="strong strong"><strong>347</strong></span> entries and the <code class="literal">artist</code> table should contain <span class="strong strong"><strong>275</strong></span> entries.</p>
</div>
</details>
<p>This tutorial uses a very basic setup. To use advanced functionality such as filtering rules and incremental syncs, enable <code class="literal">track_commit_timestamp</code> on your PostgreSQL database. Refer to <a class="xref" href="postgresql-connector-client-tutorial.html" title="PostgreSQL connector client tutorial">Tutorial</a> for more details.</p>
<p>Now it&#8217;s time for the real fun! We&#8217;ll set up a connector to create a searchable mirror of our PostgreSQL data in Elasticsearch.</p>
<h4><a id="connectors-tutorial-api-create-connector"></a>Create a connector<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<p>We&#8217;ll use the <a href="/guide/en/elasticsearch/reference/master/create-connector-api.html" class="ulink" target="_top">Create connector API</a> to create a PostgreSQL connector instance.</p>
<p>Run the following API call, using the <a href="/guide/en/kibana/master/console-kibana.html" class="ulink" target="_top">Dev Tools Console</a> or <code class="literal">curl</code>:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _connector/my-connector-id
{
  "name": "Music catalog",
  "index_name":  "music",
  "service_type": "postgresql"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/5.console"></div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">service_type</code> refers to the third-party data source you&#8217;re connecting to.</p>
</div>
</div>
<p>Note that we specified the <code class="literal">my-connector-id</code> ID as a part of the <code class="literal">PUT</code> request.
We&#8217;ll need the connector ID to set up and run the connector service locally.</p>
<p>If you&#8217;d prefer to use an autogenerated ID, replace <code class="literal">PUT _connector/my-connector-id</code> with <code class="literal">POST _connector</code>.</p>
<h4><a id="connectors-tutorial-api-deploy-connector"></a>Run connector service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The connector service runs automatically in Elastic Cloud, if you&#8217;re using our managed native connectors.
Because we&#8217;re running a self-managed connector, we need to spin up this service locally.</p>
</div>
</div>
<p>Now we&#8217;ll run the connector service so we can start syncing data from our PostgreSQL instance to Elasticsearch.
We&#8217;ll use the steps outlined in <a class="xref" href="connectors-run-from-docker.html" title="Running from a Docker container">Running from a Docker container</a>.</p>
<p>When running the connectors service on your own infrastructure, you need to provide a configuration file with the following details:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Your Elasticsearch endpoint (<code class="literal">elasticsearch.host</code>)
</li>
<li class="listitem">
An Elasticsearch API key (<code class="literal">elasticsearch.api_key</code>)
</li>
<li class="listitem">
Your third-party data source type (<code class="literal">service_type</code>)
</li>
<li class="listitem">
Your connector ID (<code class="literal">connector_id</code>)
</li>
</ul>
</div>
<h5><a id="connectors-tutorial-api-create-api-key"></a>Create an API key<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h5>
<p>If you haven&#8217;t already created an API key to access Elasticsearch, you can use the <a href="/guide/en/elasticsearch/reference/8.14/security-api-create-api-key.html" class="ulink" target="_top">_security/api_key</a> endpoint.</p>
<p>Here, we assume your target Elasticsearch index name is <code class="literal">music</code>. If you use a different index name, adjust the request body accordingly.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_security/api_key
{
  "name": "music-connector",
  "role_descriptors": {
    "music-connector-role": {
      "cluster": [
        "monitor"
      ],
      "indices": [
        {
          "names": [
            "music",
            ".search-acl-filter-music",
            ".elastic-connectors*"
          ],
          "privileges": [
            "all"
          ],
          "allow_restricted_indices": false
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/6.console"></div>
<p>You&#8217;ll need to use the <code class="literal">encoded</code> value from the response as the <code class="literal">elasticsearch.api_key</code> in your configuration file.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also create an API key in the Kibana and Serverless UIs.</p>
</div>
</div>
<h5><a id="connectors-tutorial-api-prepare-configuration-file"></a>Prepare the configuration file<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h5>
<p>Let&#8217;s create a directory and a <code class="literal">config.yml</code> file to store the connector configuration:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">mkdir -p ~/connectors-config
touch ~/connectors-config/config.yml</pre>
</div>
<p>Now, let&#8217;s add our connector details to the config file.
Open <code class="literal">config.yml</code> and paste the following configuration, replacing placeholders with your own values:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">elasticsearch.host: &lt;ELASTICSEARCH_ENDPOINT&gt; # Your Elasticsearch endpoint
elasticsearch.api_key: &lt;ELASTICSEARCH_API_KEY&gt; # Your Elasticsearch API key

connectors:
  - connector_id: "my-connector-id"
    service_type: "postgresql"</pre>
</div>
<p>We provide an <a href="https://raw.githubusercontent.com/elastic/connectors/main/config.yml.example" class="ulink" target="_top">example configuration file</a> in the <code class="literal">elastic/connectors</code> repository for reference.</p>
<h5><a id="connectors-tutorial-api-run-connector-service"></a>Run the connector service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h5>
<p>Now that we have the configuration file set up, we can run the connector service locally.
This will point your connector instance at your Elasticsearch deployment.</p>
<p>Run the following Docker command to start the connector service:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run \
-v "$HOME/connectors-config:/config" \
--rm \
--tty -i \
--network host \
docker.elastic.co/enterprise-search/elastic-connectors:8.14.3.0 \
/app/bin/elastic-ingest \
-c /config/config.yml</pre>
</div>
<p>Verify your connector is connected by getting the connector status (should be <code class="literal">needs_configuration</code>) and <code class="literal">last_seen</code> field (note that time is reported in UTC).
The <code class="literal">last_seen</code> field indicates that the connector successfully connected to Elasticsearch.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _connector/my-connector-id</pre>
</div>
<div class="console_widget" data-snippet="snippets/7.console"></div>
<h4><a id="connectors-tutorial-api-update-connector-configuration"></a>Configure connector<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<p>Now our connector instance is up and running, but it doesn&#8217;t yet know <em>where</em> to sync data from.
The final piece of the puzzle is to configure our connector with details about our PostgreSQL instance.
When setting up a connector in the Elastic Cloud or Serverless UIs, you&#8217;re prompted to add these details in the user interface.</p>
<p>But because this tutorial is all about working with connectors <em>programmatically</em>, we&#8217;ll use the <a href="/guide/en/elasticsearch/reference/8.14/update-connector-configuration-api.html" class="ulink" target="_top">Update connector configuration API</a> to add our configuration details.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Before configuring the connector, ensure that the configuration schema is registered by the service.
For native connectors, this occurs shortly after creation via the API.
For self-managed connectors, the schema registers on service startup (once the <code class="literal">config.yml</code> is populated).</p>
<p>Configuration updates via the API are possible only <em>after schema registration</em>.
Verify this by checking the configuration property returned by the <code class="literal">GET _connector/my-connector-id</code> request.
It should be non-empty.</p>
</div>
</div>
<p>Run the following API call to configure the connector with our <a class="xref" href="connectors-postgresql.html#connectors-postgresql-client-configuration" title="Configuration">PostgreSQL configuration details</a>:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _connector/my-connector-id/_configuration
{
  "values": {
    "host": "127.0.0.1",
    "port": 5432,
    "username": "myuser",
    "password": "mypassword",
    "database": "chinook",
    "schema": "public",
    "tables": "album,artist"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/8.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Configuration details are specific to the connector type.
The keys and values will differ depending on which third-party data source you&#8217;re connecting to.
Refer to the individual <a class="xref" href="connectors-references.html" title="Connectors references">connector references</a> for these configuration details.</p>
</div>
</div>
<h4><a id="connectors-tutorial-api-sync"></a>Sync data<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>We&#8217;re using a self-managed connector in this tutorial.
To use these APIs with a managed native connector, there&#8217;s some extra setup for API keys.
Refer to <a class="xref" href="native-connectors.html#native-connectors-manage-API-keys" title="Manage API keys">Manage API keys</a> for details.</p>
</div>
</div>
<p>We&#8217;re now ready to sync our PostgreSQL data to Elasticsearch.
Run the following API call to start a full sync job:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _connector/_sync_job
{
    "id": "my-connector-id",
    "job_type": "full"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/9.console"></div>
<p>To store data in Elasticsearch, the connector needs to create an index.
When we created the connector, we specified the <code class="literal">music</code> index.
The connector will create and configure this Elasticsearch index before launching the sync job.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>In the approach we&#8217;ve used here, the connector will use <a href="/guide/en/elasticsearch/reference/8.14/mapping.html#mapping-dynamic" class="ulink" target="_top">dynamic mappings</a> to automatically infer the data types of your fields.
In a real-world scenario you would use the Elasticsearch <a href="/guide/en/elasticsearch/reference/8.14/indices-create-index.html" class="ulink" target="_top">Create index API</a> to first create the index with the desired field mappings and index settings.
Defining your own mappings upfront gives you more control over how your data is indexed.</p>
</div>
</div>
<h5><a id="connectors-tutorial-api-check-sync-status"></a>Check sync status<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h5>
<p>Use the <a href="/guide/en/elasticsearch/reference/8.14/get-connector-sync-job-api.html" class="ulink" target="_top">Get sync job API</a> to track the status and progress of the sync job.
By default, the most recent job statuses are returned first.
Run the following API call to check the status of the sync job:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _connector/_sync_job?connector_id=my-connector-id&amp;size=1</pre>
</div>
<div class="console_widget" data-snippet="snippets/10.console"></div>
<p>The job document will be updated as the sync progresses, you can check it as often as you&#8217;d like to poll for updates.</p>
<p>Once the job completes, the status should be <code class="literal">completed</code> and <code class="literal">indexed_document_count</code> should be <span class="strong strong"><strong>622</strong></span>.</p>
<p>Verify that data is present in the <code class="literal">music</code> index with the following API call:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET music/_count</pre>
</div>
<div class="console_widget" data-snippet="snippets/11.console"></div>
<p>Elasticsearch stores data in documents, which are JSON objects.
List the individual documents with the following API call:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET music/_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/12.console"></div>
<h4><a id="connectors-tutorial-api-troubleshooting"></a>Troubleshooting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<p>Use the following command to inspect the latest sync job&#8217;s status:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _connector/_sync_job?connector_id=my-connector-id&amp;size=1</pre>
</div>
<div class="console_widget" data-snippet="snippets/13.console"></div>
<p>If the connector encountered any errors during the sync, you&#8217;ll find these in the <code class="literal">error</code> field.</p>
<h4><a id="connectors-tutorial-api-cleanup"></a>Cleaning up<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<p>To delete the connector and its associated sync jobs run this command:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">DELETE _connector/my-connector-id&amp;delete_sync_jobs=true</pre>
</div>
<div class="console_widget" data-snippet="snippets/14.console"></div>
<p>This won&#8217;t delete the Elasticsearch index that was created by the connector to store the data.
Delete the <code class="literal">music</code> index by running the following command:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">DELETE music</pre>
</div>
<div class="console_widget" data-snippet="snippets/15.console"></div>
<p>To remove the PostgreSQL container, run the following commands:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker stop postgres
docker rm postgres</pre>
</div>
<p>To remove the connector service, run the following commands:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker stop &lt;container_id&gt;
docker rm &lt;container_id&gt;</pre>
</div>
<h4><a id="connectors-tutorial-api-next-steps"></a>Next steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-API-tutorial.asciidoc">edit</a></h4>
<p>Congratulations! You&#8217;ve successfully set up a self-managed connector using the Connector APIs.</p>
<p>Here are some next steps to explore:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Learn more about the <a href="/guide/en/elasticsearch/reference/8.14/connector-apis.html" class="ulink" target="_top">Connector APIs</a>.
</li>
<li class="listitem">
Learn how to deploy Elasticsearch, Kibana, and the connectors service using Docker Compose in our <a href="https://github.com/elastic/connectors/tree/main/scripts/stack#readme" class="ulink" target="_top">quickstart guide</a>.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="connectors-apis.html">« Connector APIs</a>
</span>
<span class="next">
<a href="connectors-sync-types.html">Content syncs »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
