<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Configure SSL/TLS | Enterprise Search documentation [8.8] | Elastic</title>
<meta class="elastic" name="content" content="Configure SSL/TLS | Enterprise Search documentation [8.8]">

<link rel="home" href="index.html" title="Enterprise Search documentation [8.8]"/>
<link rel="up" href="server.html" title="Elastic Enterprise Search server"/>
<link rel="prev" href="mailer-configuration.html" title="Configure a mail service"/>
<link rel="next" href="upgrading-and-migrating.html" title="Upgrading &amp; migrating"/>
<meta class="elastic" name="product_version" content="8.8"/>
<meta class="elastic" name="product_name" content="Enterprise Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/8.8"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="8.8"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Enterprise Search documentation [8.8]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="server.html">Elastic Enterprise Search server</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="mailer-configuration.html">« Configure a mail service</a>
</span>
<span class="next">
<a href="upgrading-and-migrating.html">Upgrading &amp; migrating »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configure-ssl-tls"></a>Configure SSL/TLS<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/configure-ssl-tls.asciidoc">edit</a></h2>
</div></div></div>

<p>By default, Enterprise Search does not enable TLS (Transport Layer Security) for
incoming HTTP connections.</p>
<p>To enable SSL/TLS, set the following <a class="xref" href="configuration.html#configuration-file" title="Configuration settings reference">configuration settings</a>:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">ent_search.ssl.enabled: true
ent_search.ssl.keystore.path: "/path/to/keystore.jks"
ent_search.ssl.keystore.password: "changeme"
ent_search.ssl.keystore.key_password: "changeme"
ent_search.external_url: https://localhost:3002</pre>
</div>
<p>See below for more details on specific settings.</p>
<h3><a id="configure-ssl-tls-create-java-keystore"></a>Create the Java KeyStore<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/configure-ssl-tls.asciidoc">edit</a></h3>
<p>In the above example, <code class="literal">keystore.jks</code> is a
<a href="https://en.wikipedia.org/wiki/Java_KeyStore" class="ulink" target="_top">Java KeyStore file</a>.</p>
<p>You can create a Java KeyStore file using the <code class="literal">keytool</code> utility, which is included with the JVM.
If you are using the Elastic provided Docker image, the <code class="literal">keytool</code> utility is available at <code class="literal">/usr/bin/keytool</code> within the container. See <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html" class="ulink" target="_blank" rel="noopener">keytool - Key and Certificate Management Tool</a> in the Java documentation for more details on the usage of this tool.</p>
<p>In a production scenario, you would merge your private key (<code class="literal">private.key</code>) and your SSL certificate (<code class="literal">certificate.crt</code>) into the <a href="https://en.wikipedia.org/wiki/PKCS_12" class="ulink" target="_top">PKCS12</a> format and then convert it to a Java keystore by using the following commands:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash"># Convert the existing certificate and the private key to a PKCS12 file
openssl pkcs12 -export \
  -in certificate.crt \
  -inkey private.key \
  -out keystore.p12 \
  -name ent-search

# Create the Java keystore from the PKCS12 file
keytool -importkeystore \
  -destkeystore keystore.jks \
  -srckeystore keystore.p12 \
  -srcstoretype PKCS12 \
  -storepass changeme
  -alias ent-search</pre>
</div>
<p>In a development environment (do not use this in production), you can use they they <code class="literal">keytool</code> command to  create a self-signed certificate and add it to a keystore for use with a server running on <code class="literal">localhost</code>:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">keytool -genkey -alias server-alias -keyalg RSA \
  -storepass changeme -keypass changeme -keystore keystore.jks \
  -dname 'CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown'</pre>
</div>
<p>Note that the values used in <code class="literal">-keypass changeme</code> and <code class="literal">-storepass changeme</code> correspond directly to the values that must be set for <code class="literal">ent_search.ssl.keystore.key_password</code> and <code class="literal">ent_search.ssl.keystore.password</code>, respectively.</p>
<h3><a id="configure-ssl-tls-in-kibana"></a>Configure Kibana to Trust Your SSL Certificate Authority<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/configure-ssl-tls.asciidoc">edit</a></h3>
<p>If you are using a custom SSL certificate for your Enterprise Search deployment, you will have to configure Kibana accordingly to make sure it trusts your custom SSL certificate by adding your custom Certificate Authority (CA) to Kibana configuration.</p>
<p>The Enterprise Search SSL configuration in Kibana is controlled by the following options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">enterpriseSearch.ssl.certificateAuthorities</code> – used to configure a list of custom Certificate Authority (CA) certificates to be used for validating certificates presented by Enterprise Search. You need to set this to the CA certificate (in a PEM format) you used to generate your custom Enterprise Search SSL certificate.
</li>
<li class="listitem">
<p><code class="literal">enterpriseSearch.ssl.verificationMode</code> – used to control the level of SSL certificate validation for connections from Kibana to Enterprise Search. Possible values are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">full</code> (default, both SSL certificate and host name are verified)
</li>
<li class="listitem">
<code class="literal">certificate</code> (only SSL certificate validation is performed, hostname is not checked)
</li>
<li class="listitem">
<code class="literal">none</code> (SSL validation is disabled entirely, useful for development only).
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Here is an example snippet from a <code class="literal">kibana.yml</code> file used on a deployment with Enterprise Search:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">enterpriseSearch.host: https://some-host.tld:3002
enterpriseSearch.ssl.verificationMode: certificate
enterpriseSearch.ssl.certificateAuthorities:
  - /path/to/your/ca.pem</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are using a self-signed SSL certificate (without a custom Certificate Authority), the only way to make Kibana work with it is by disabling SSL verification entirely (by setting <code class="literal">enterpriseSearch.ssl.verificationMode: none</code>).</p>
<p>Do not use this method in production!</p>
</div>
</div>
<h3><a id="configure-ssl-tls-custom-ca-server-requests"></a>Enterprise Search requests to Kibana using custom CAs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/configure-ssl-tls.asciidoc">edit</a></h3>
<p>Enterprise Search <span class="strong strong"><strong>does not support</strong></span> requests from the Enterprise Search Server to Kibana using a custom Certificate Authority.</p>
<h3><a id="configure-ssl-tls-hosting-on-the-default-https-port"></a>Hosting on the default HTTPS port<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/configure-ssl-tls.asciidoc">edit</a></h3>
<p>In addition to the above instructions, you may want to avoid having your users specify a port number when visiting Enterprise Search.
In order to allow your users to make use of HTTPS only, you can set:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">ent_search.listen_port: 443
ent_search.external_url: https://my_host.my_domain.com:443
ent_search.ssl.redirect_http_from_port: 80</pre>
</div>
<p>This will bind your server to port <code class="literal">443</code> (the default HTTPS traffic port), and will ensure that traffic routed to port <code class="literal">80</code> (the default HTTP port) will redirect to <code class="literal">443</code>.
This ensures that any visitor to <code class="literal">my_host.my_domain.com</code> will make use of TLS.</p>
<h3><a id="configure-ssl-tls-troubleshooting"></a>Troubleshooting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.8/enterprise-search-docs/configure-ssl-tls.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">java.lang.ClassCastException: org.bouncycastle.asn1.DERApplicationSpecific cannot be cast to org.bouncycastle.asn1.ASN1Sequence</code>
</li>
</ul>
</div>
<p>This error may occur if you&#8217;re using a legacy configuration that specifies keys and certificates separately, and it is a known JRuby bug: <a href="https://github.com/jruby/jruby-openssl/issues/104" class="ulink" target="_top">https://github.com/jruby/jruby-openssl/issues/104</a>.
It is recommended that you use a Java KeyStore file as explained above.
If this is not possible, endeavor to remove the "Bag Attributes" from your keyfile.
This can be done by generating your keyfile like:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">openssl pkcs12 -in keystore.p12  -nodes -nocerts -passin pass:changeme | openssl rsa -out my_store.key</pre>
</div>
<p>You can also manually remove the "Bag Attributes" portion of your keyfile with a text editor.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="mailer-configuration.html">« Configure a mail service</a>
</span>
<span class="next">
<a href="upgrading-and-migrating.html">Upgrading &amp; migrating »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
