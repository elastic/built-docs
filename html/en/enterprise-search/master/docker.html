<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Run Enterprise Search server using Docker images | Elastic Enterprise Search documentation [master] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Enterprise Search documentation [master]"/>
<link rel="up" href="server.html" title="Elastic Enterprise Search server"/>
<link rel="prev" href="server.html" title="Elastic Enterprise Search server"/>
<link rel="next" href="installation.html" title="Run Enterprise Search server using downloads (packages)"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/master"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Enterprise Search documentation [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="server.html">Elastic Enterprise Search server</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="server.html">« Elastic Enterprise Search server</a>
</span>
<span class="next">
<a href="installation.html">Run Enterprise Search server using downloads (packages) »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docker"></a>Run Enterprise Search server using Docker images<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/docker.asciidoc">edit</a></h2>
</div></div></div>

<p>To use <a class="xref" href="start.html" title="Getting started with Elastic Enterprise Search">Enterprise Search features</a>, you need an <a class="xref" href="deployment.html" title="Elastic deployment">Elastic deployment</a>.
To use all Enterprise Search features, your deployment must include <a class="xref" href="server.html" title="Elastic Enterprise Search server">Enterprise Search server</a>.</p>
<p>You can run an Elastic deployment, including Enterprise Search server, using Docker images provided by Elastic.</p>
<h3><a id="docker-image"></a>Elastic Docker images<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/docker.asciidoc">edit</a></h3>
<p>The <a href="https://www.docker.elastic.co" class="ulink" target="_blank" rel="noopener">Elastic Docker registry</a> provides Docker images for Enterprise Search. The images support both x86 and ARM platforms.</p>
<p>You can download images from the registry, or use <code class="literal">docker pull</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker pull docker.elastic.co/enterprise-search/enterprise-search:8.7.0</pre>
</div>
<h3><a id="docker-configuration"></a>Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/docker.asciidoc">edit</a></h3>
<p>When running in Docker, you will use environment variables to configure Enterprise Search, using fully-qualified setting names as environment variables. See <a class="xref" href="configuration.html" title="Configuration"><em>Configuration</em></a> for a list of configurable values.</p>
<p>You must configure the values that are required for a
<a class="xref" href="installation.html" title="Run Enterprise Search server using downloads (packages)">standard installation method</a>.
In most cases, these are <code class="literal">allow_es_settings_modification</code> and <code class="literal">secret_management.encryption_keys</code>.</p>
<h3><a id="docker-cli-example"></a>Run Enterprise Search using <code class="literal">docker run</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/docker.asciidoc">edit</a></h3>
<p>Use <code class="literal">docker run</code> to manage Elastic containers imperatively.</p>
<p>Enterprise Search depends on Elasticsearch and Kibana.
The following steps describe how to start all three services.</p>
<p>This configuration is appropriate for development and testing.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Allocate at least 4GB of memory to Docker Engine:</strong></span></p>
<p>If you are using Docker Desktop with default settings, you need to increase the memory allocated to Docker Engine.
Refer to the following documentation from Docker:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.docker.com/desktop/mac/" class="ulink" target="_blank" rel="noopener">Docker Desktop for Mac user manual</a>
</li>
<li class="listitem">
<a href="https://docs.docker.com/desktop/windows/" class="ulink" target="_blank" rel="noopener">Docker Desktop for Windows user manual</a><br>
&#160;
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create a Docker network:</strong></span></p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker network create elastic</pre>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create and start the Elasticsearch container interactively:</strong></span></p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run \
--name "elasticsearch" \
--network "elastic" \
--publish "9200:9200" \
--volume "es-config:/usr/share/elasticsearch/config:rw" \
--interactive \
--tty \
--rm \
"docker.elastic.co/elastic/elasticsearch:8.7.0"</pre>
</div>
<p>The <code class="literal">--volume</code> argument mounts a volume within the container.
Elasticsearch will write a certificate file to this volume on startup.
The Enterprise Search container will mount the same volume in order to read the certificate file.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To restart Elasticsearch later, you must first delete the volume so Elasticsearch can start with a fresh configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker volume rm es-config</pre>
</div>
</div>
</div>
<p>If the container fails to start with a message about <code class="literal">vm.max_map_count</code>, refer to the following Elasticsearch documentation for platform-specific solutions: <a href="/guide/en/elasticsearch/reference/master/docker.html#docker-prod-prerequisites" class="ulink" target="_blank" rel="noopener">Using the Docker images in production</a>.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Save password, enrollment token, and Elasticsearch address:</strong></span></p>
<p>Within the Elasticsearch terminal output, locate the password for user <code class="literal">elastic</code>, and the enrollment token for Kibana.</p>
<p>These are printed the first time Elasticsearch starts.
The relevant output looks like this:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">-&gt; Elasticsearch security features have been automatically configured!
-&gt; Authentication is enabled and cluster connections are encrypted.

-&gt;  Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):
  ksk4kIAt0tQBWZ9qYz0p

-&gt;  HTTP CA certificate SHA-256 fingerprint:
  39e8552724167da188f7d1c4196e6335d32d0cd62115b34dd271f0519232bb7d

-&gt;  Configure Kibana to use this cluster:
* Run Kibana and click the configuration link in the terminal when Kibana starts.
* Copy the following enrollment token and paste it into Kibana in your browser (valid for the next 30 minutes):
  eyJ2ZXIiOiI4LjAuMCIsImFkciI6WyIxNzIuMTguMC4yOjkyMDAiXSwiZmdyIjoiMzllODU1MjcyNDE2N2RhMTg4ZjdkMWM0MTk2ZTYzMzVkMzJkMGNkNjIxMTViMzRkZDI3MWYwNTE5MjMyYmI3ZCIsImtleSI6IkpVMGJ3SDRCTDJqOWx6TVlTLWpyOlVoeHBSa1JFUXVlbnV3UEVGTUlub1EifQ==</pre>
</div>
<p>Also within the Elasticsearch output, locate the address at which Elasticsearch is running within the container.
This may be easier to find by searching the logs for <code class="literal">publish_address</code>.
For example, run the following in a separate terminal:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker logs elasticsearch | grep 'publish_address'</pre>
</div>
<p>The relevant information looks like this:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">"message":"publish_address {172.18.0.2:9200}, bound_addresses {0.0.0.0:9200}"</pre>
</div>
<p>Save the password, enrollment token, and Elasticsearch publish address for use in the following steps.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create, start, and enroll Kibana:</strong></span></p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run \
--name "kibana" \
--network "elastic" \
--publish "5601:5601" \
--interactive \
--tty \
--rm \
--env "ENTERPRISESEARCH_HOST=http://enterprise-search:3002" \
"docker.elastic.co/kibana/kibana:8.7.0"</pre>
</div>
<p>Open the link printed to the terminal to navigate to Kibana (<a href="http://localhost:5601?code=" class="ulink" target="_top">http://localhost:5601?code=</a>). Follow the instructions within Kibana to complete the enrollment process. Use the enrollment token from step 4.</p>
<p>When you see the login screen, move to the next step.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create and start the Enterprise Search container:</strong></span></p>
<p>Use the following command template:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run \
--name "enterprise-search" \
--network "elastic" \
--publish "3002:3002" \
--volume "es-config:/usr/share/enterprise-search/es-config:ro" \
--interactive \
--tty \
--rm \
--env "secret_management.encryption_keys=[${ENCRYPTION_KEYS}]" \
--env "allow_es_settings_modification=true" \
--env "elasticsearch.host=https://${ELASTICSEARCH_ADDRESS}" \
--env "elasticsearch.username=elastic" \
--env "elasticsearch.password=${ELASTIC_PASSWORD}" \
--env "elasticsearch.ssl.enabled=true" \
--env "elasticsearch.ssl.certificate_authority=/usr/share/enterprise-search/es-config/certs/http_ca.crt" \
--env "kibana.external_url=http://kibana:5601" \
"docker.elastic.co/enterprise-search/enterprise-search:8.7.0"</pre>
</div>
<p>Replace <code class="literal">${ENCRYPTION_KEYS}</code> with at least one <a class="xref" href="encryption-keys.html" title="Configure encryption keys">encryption key</a> (256-bit key recommended).
For example: <code class="literal">secret_management.encryption_keys=[c34d38b3a14956121ff2170e5030b471551370178f43e5626eec58b04a30fae2]</code></p>
<p>Replace <code class="literal">${ELASTICSEARCH_ADDRESS}</code> with the Elasticsearch address from step 4.
For example: <code class="literal">elasticsearch.host=https://172.18.0.2:9200</code>.</p>
<p>Replace <code class="literal">${ELASTIC_PASSWORD}</code> with the password from step 4.
For example: <code class="literal">elasticsearch.password=ksk4kIAt0tQBWZ9qYz0p</code>.</p>
<p>Complete example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run \
--name "enterprise-search" \
--network "elastic" \
--publish "3002:3002" \
--volume "es-config:/usr/share/enterprise-search/es-config:ro" \
--interactive \
--tty \
--rm \
--env "secret_management.encryption_keys=[c34d38b3a14956121ff2170e5030b471551370178f43e5626eec58b04a30fae2]" \
--env "allow_es_settings_modification=true" \
--env "elasticsearch.host=https://172.18.0.2:9200" \
--env "elasticsearch.username=elastic" \
--env "elasticsearch.password=ksk4kIAt0tQBWZ9qYz0p" \
--env "elasticsearch.ssl.enabled=true" \
--env "elasticsearch.ssl.certificate_authority=/usr/share/enterprise-search/es-config/certs/http_ca.crt" \
--env "kibana.external_url=http://kibana:5601" \
"docker.elastic.co/enterprise-search/enterprise-search:8.7.0"</pre>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Log in:</strong></span></p>
<p>Open Enterprise Search in Kibana at <a href="http://localhost:5601/app/enterprise_search/overview" class="ulink" target="_top">http://localhost:5601/app/enterprise_search/overview</a>.
Log in as user <code class="literal">elastic</code>.
Use the password for this user from step 4.</p>
</li>
</ol>
</div>
<h3><a id="docker-compose-example"></a>Run Enterprise Search using <code class="literal">docker-compose</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/docker.asciidoc">edit</a></h3>
<p>Using Docker Compose is a much more convenient way of running the solution in a container.
This method is often used in local development environments to try out the product before a full production deployment.</p>
<p>This example runs Enterprise Search with Elasticsearch and Kibana in Docker Compose.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create the following configuration files in a new, empty directory:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a <code class="literal">.env</code> file to set environment variables which are used to run the <code class="literal">docker-compose.yml</code> configuration file. Include these environment variables:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">STACK_VERSION=8.7.0
ELASTIC_PASSWORD=changeme
KIBANA_PASSWORD=changeme
ES_PORT=9200
CLUSTER_NAME=es-cluster
LICENSE=basic
MEM_LIMIT=1073741824
KIBANA_PORT=5601
ENTERPRISE_SEARCH_PORT=3002
ENCRYPTION_KEYS=secret</pre>
</div>
<p>Ensure that you specify a strong password for the <code class="literal">elastic</code> and <code class="literal">kibana_system</code> users with the
<code class="literal">ELASTIC_PASSWORD</code> and <code class="literal">KIBANA_PASSWORD</code> variables.
These variables are referenced by the <code class="literal">docker-compose.yml</code> file.</p>
</li>
<li class="listitem">
<p>Create a <code class="literal">docker-compose.yml</code> file:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: "2.2"

services:
  setup:
    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}
    volumes:
      - certs:/usr/share/elasticsearch/config/certs
    user: "0"
    command: &gt;
      bash -c '
        if [ x${ELASTIC_PASSWORD} == x ]; then
          echo "Set the ELASTIC_PASSWORD environment variable in the .env file";
          exit 1;
        elif [ x${KIBANA_PASSWORD} == x ]; then
          echo "Set the KIBANA_PASSWORD environment variable in the .env file";
          exit 1;
        fi;
        if [ ! -f certs/ca.zip ]; then
          echo "Creating CA";
          bin/elasticsearch-certutil ca --silent --pem -out config/certs/ca.zip;
          unzip config/certs/ca.zip -d config/certs;
        fi;
        if [ ! -f certs/certs.zip ]; then
          echo "Creating certs";
          echo -ne \
          "instances:\n"\
          "  - name: es01\n"\
          "    dns:\n"\
          "      - es01\n"\
          "      - localhost\n"\
          "    ip:\n"\
          "      - 127.0.0.1\n"\
          &gt; config/certs/instances.yml;
          bin/elasticsearch-certutil cert --silent --pem -out config/certs/certs.zip --in config/certs/instances.yml --ca-cert config/certs/ca/ca.crt --ca-key config/certs/ca/ca.key;
          unzip config/certs/certs.zip -d config/certs;
        fi;
        echo "Setting file permissions"
        chown -R root:root config/certs;
        find . -type d -exec chmod 750 \{\} \;;
        find . -type f -exec chmod 640 \{\} \;;
        echo "Waiting for Elasticsearch availability";
        until curl -s --cacert config/certs/ca/ca.crt https://es01:9200 | grep -q "missing authentication credentials"; do sleep 30; done;
        echo "Setting kibana_system password";
        until curl -s -X POST --cacert config/certs/ca/ca.crt -u elastic:${ELASTIC_PASSWORD} -H "Content-Type: application/json" https://es01:9200/_security/user/kibana_system/_password -d "{\"password\":\"${KIBANA_PASSWORD}\"}" | grep -q "^{}"; do sleep 10; done;
        echo "All done!";
      '
    healthcheck:
      test: ["CMD-SHELL", "[ -f config/certs/es01/es01.crt ]"]
      interval: 1s
      timeout: 5s
      retries: 120

  es01:
    depends_on:
      setup:
        condition: service_healthy
    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}
    volumes:
      - certs:/usr/share/elasticsearch/config/certs
      - esdata01:/usr/share/elasticsearch/data
    ports:
      - ${ES_PORT}:9200
    environment:
      - node.name=es01
      - cluster.name=${CLUSTER_NAME}
      - cluster.initial_master_nodes=es01
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
      - bootstrap.memory_lock=true
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=certs/es01/es01.key
      - xpack.security.http.ssl.certificate=certs/es01/es01.crt
      - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.http.ssl.verification_mode=certificate
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.key=certs/es01/es01.key
      - xpack.security.transport.ssl.certificate=certs/es01/es01.crt
      - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.verification_mode=certificate
      - xpack.license.self_generated.type=${LICENSE}
    mem_limit: ${MEM_LIMIT}
    ulimits:
      memlock:
        soft: -1
        hard: -1
    healthcheck:
      test:
        [
            "CMD-SHELL",
            "curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

  kibana:
    depends_on:
      es01:
        condition: service_healthy
    image: docker.elastic.co/kibana/kibana:${STACK_VERSION}
    volumes:
      - certs:/usr/share/kibana/config/certs
      - kibanadata:/usr/share/kibana/data
    ports:
      - ${KIBANA_PORT}:5601
    environment:
      - SERVERNAME=kibana
      - ELASTICSEARCH_HOSTS=https://es01:9200
      - ELASTICSEARCH_USERNAME=kibana_system
      - ELASTICSEARCH_PASSWORD=${KIBANA_PASSWORD}
      - ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES=config/certs/ca/ca.crt
      - ENTERPRISESEARCH_HOST=http://enterprisesearch:${ENTERPRISE_SEARCH_PORT}
    mem_limit: ${MEM_LIMIT}
    healthcheck:
      test:
        [
            "CMD-SHELL",
            "curl -s -I http://localhost:5601 | grep -q 'HTTP/1.1 302 Found'",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

  enterprisesearch:
    depends_on:
      es01:
        condition: service_healthy
      kibana:
        condition: service_healthy
    image: docker.elastic.co/enterprise-search/enterprise-search:${STACK_VERSION}
    volumes:
      - certs:/usr/share/enterprise-search/config/certs
      - enterprisesearchdata:/usr/share/enterprise-search/config
    ports:
      - ${ENTERPRISE_SEARCH_PORT}:3002
    environment:
      - SERVERNAME=enterprisesearch
      - secret_management.encryption_keys=[${ENCRYPTION_KEYS}]
      - allow_es_settings_modification=true
      - elasticsearch.host=https://es01:9200
      - elasticsearch.username=elastic
      - elasticsearch.password=${ELASTIC_PASSWORD}
      - elasticsearch.ssl.enabled=true
      - elasticsearch.ssl.certificate_authority=/usr/share/enterprise-search/config/certs/ca/ca.crt
      - kibana.external_url=http://kibana:5601
    mem_limit: ${MEM_LIMIT}
    healthcheck:
      test:
        [
            "CMD-SHELL",
            "curl -s -I http://localhost:3002 | grep -q 'HTTP/1.1 302 Found'",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

volumes:
  certs:
    driver: local
  enterprisesearchdata:
    driver: local
  esdata01:
    driver: local
  kibanadata:
    driver: local</pre>
</div>
<p>This sample Docker Compose file brings up a single-node Elasticsearch cluster, then starts an Enterprise Search instance on it and configures a Kibana instance as the main way of interacting with the solution.</p>
<p>All components running in Docker compose are attached to a dedicated Docker network called <code class="literal">elastic</code> and are exposed via a set of local ports accessible only from the local machine. If you want to open up the service to other computers on your network, you will need to change port mappings for the services you want to share (e.g. change <code class="literal">127.0.0.1:5601:5601</code> to <code class="literal">5601:5601</code> for Kibana).</p>
<p>The <code class="literal">--volume</code> argument mounts a volume within the container.
Elasticsearch will write a certificate file to this volume on startup.
The Enterprise Search container will mount the same volume in order to read the certificate file.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The data in the Docker volumes is preserved and loaded when you restart the cluster
with <code class="literal">docker-compose up</code>.
To restart Elasticsearch later, you must first delete the volume so Elasticsearch can start with a fresh configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker volume rm es-config</pre>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Make sure Docker Engine is allotted at least 4GiB of memory. In Docker Desktop, configure resource usage using the Advanced tab in Preferences (macOS) or Settings (Windows).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Docker Compose is not pre-installed with Docker on Linux. See docs.docker.com for
installation instructions: <a href="https://docs.docker.com/compose/install" class="ulink" target="_top">Install Compose on Linux</a></p>
</div>
</div>
</li>
<li class="listitem">
<p>Run <code class="literal">docker-compose up</code> to bring up the cluster:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-compose up --remove-orphans</pre>
</div>
</li>
<li class="listitem">
<p>If the solution starts without errors, your deployment is ready to use:</p>
<p>Access Kibana at <a href="http://localhost:5601" class="ulink" target="_top">http://localhost:5601</a>. Log in with user <code class="literal">elastic</code>. The password is the value you provided for <code class="literal">ELASTIC_PASSWORD</code> in your <code class="literal">.env</code> file.</p>
<p>Access Elasticsearch at <a href="http://localhost:9200" class="ulink" target="_top">http://localhost:9200</a>.</p>
<p>Alternatively, if the solution does not start successfully, check the container logs for more information.</p>
<p>Try: <code class="literal">docker logs &lt;container_id&gt;</code>, where <code class="literal">container_id</code> is the ID of the unhealthy container (for example <code class="literal">f6de943335cf</code>).</p>
<p>If the container fails to start with a message about <code class="literal">vm.max_map_count</code>, refer to the following Elasticsearch documentation for platform-specific solutions: <a href="/guide/en/elasticsearch/reference/master/docker.html#docker-prod-prerequisites" class="ulink" target="_blank" rel="noopener">Using the Docker images in production</a>.</p>
</li>
</ol>
</div>
<p>To stop the cluster, run <code class="literal">docker-compose down</code> or press Ctrl+C in your terminal.</p>
<p>To <span class="strong strong"><strong>delete the data volumes</strong></span> when you bring down the cluster, specify the <code class="literal">-v</code> option: <code class="literal">docker-compose down -v</code>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="server.html">« Elastic Enterprise Search server</a>
</span>
<span class="next">
<a href="installation.html">Run Enterprise Search server using downloads (packages) »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
