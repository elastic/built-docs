<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Troubleshoot common problems | Fleet User Guide [7.11] | Elastic</title>
<link rel="home" href="index.html" title="Fleet User Guide [7.11]"/>
<link rel="up" href="index.html" title="Fleet User Guide [7.11]"/>
<link rel="prev" href="run-elastic-agent.html" title="Run Elastic Agent"/>
<link rel="next" href="fleet-faq.html" title="Frequently asked questions"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/7.11"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="7.11"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Fleet User Guide [7.11]</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="run-elastic-agent.html">« Run Elastic Agent</a>
</span>
<span class="next">
<a href="fleet-faq.html">Frequently asked questions »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h1 class="title"><a id="fleet-troubleshooting"></a>Troubleshoot common problems<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h1>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>We have collected the most common known problems here. If your problem isn&#8217;t
described here, please review open issues in the following GitHub repositories:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/kibana/issues" class="ulink" target="_top">Kibana</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/beats/issues" class="ulink" target="_top">Beats</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/package-registry/issues" class="ulink" target="_top">Elastic Package Registry</a>
</li>
</ul>
</div>
<p>Have a question? Read our <a class="xref" href="fleet-faq.html" title="Frequently asked questions">FAQ</a>, or contact us in the
<a href="https://discuss.elastic.co/" class="ulink" target="_top">discuss forum</a>. Your feedback is very valuable to us.</p>
<h3><a id="fleet-not-in-kibana"></a>Fleet is not listed in the Kibana side navigation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h3>
<p>The Fleet app is enabled by default. If you are unable to
see the app in Kibana, make sure it&#8217;s enabled.</p>
<p><span class="strong strong"><strong>To enable Fleet on Elastic Cloud:</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to your deployment in the user console.
</li>
<li class="listitem">
Under the deployment name in the side navigation, click <span class="strong strong"><strong>Edit</strong></span>.
</li>
<li class="listitem">
<p>In the Kibana section, expand <span class="strong strong"><strong>User setting overrides</strong></span> and enter the
following setting:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.fleet.enabled: true</pre>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save</strong></span>.
</li>
</ol>
</div>
<p>Kibana will restart automatically. When Kibana is available, refresh the browser
to see the Fleet app in the navigation menu.</p>
<p><span class="strong strong"><strong>To enable Fleet on a self-managed cluster:</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In the Elasticsearch configuration file, <code class="literal">config/elasticsearch.yml</code>, set the following
security settings to enable security and API keys:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.enabled: true
xpack.security.authc.api_key.enabled: true</pre>
</div>
</li>
<li class="listitem">
<p>In the Kibana configuration file, <code class="literal">config/kibana.yml</code>, enable Fleet
and specify user credentials:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.fleet.enabled: true
xpack.fleet.agents.tlsCheckDisabled: true <a id="CO14-1"></a><i class="conum" data-value="1"></i>
xpack.encryptedSavedObjects.encryptionKey: "something_at_least_32_characters"
xpack.security.enabled: true
elasticsearch.username: "my_username" <a id="CO14-2"></a><i class="conum" data-value="2"></i>
elasticsearch.password: "my_password"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This setting is not required if you configure TLS checking.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specify a user who is authorized to use Fleet.</p>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To set up passwords, you can use the documented Elasticsearch APIs or the
<code class="literal">elasticsearch-setup-passwords</code> command. For example:</p>
<p><code class="literal">./bin/elasticsearch-setup-passwords auto</code></p>
</div>
</div>
<p>After running the command, copy the Elastic user name to the Kibana config file.
Then restart Kibana.</p>
<h3><a id="ingest-management-setup-fails"></a>The <code class="literal">/api/ingest_management/setup</code> endpoint can&#8217;t reach the package registry<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h3>
<p>In order to install Integrations, the Fleet app needs to connect to
an external service called the Elastic Package Registry. For this to work, the Kibana
server must be able to connect to <code class="literal">https://epr.elastic.co</code> on port 443.</p>
<h3><a id="fleet-app-crashes"></a>Fleet in Kibana crashes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h3>
<p>To find more about the error, open your browser&#8217;s development console, navigate
to the <span class="strong strong"><strong>Network</strong></span> tab, and refresh the page. One of the requests to the
Fleet API will most likely have returned an error. If the error
message doesn&#8217;t give you enough information to fix the problem, please contact
us in the <a href="https://discuss.elastic.co/" class="ulink" target="_top">discuss forum</a>.</p>
<h3><a id="agent-enrollment-timeout"></a>Elastic Agent enrollment fails on the host with <code class="literal">Client.Timeout exceeded</code> message<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h3>
<p>Elastic Agent must be able to connect to the Kibana instance to enroll in Fleet.
If the agent is unable to connect, you will see the following failure:</p>
<div class="pre_wrapper lang-output">
<pre class="programlisting prettyprint lang-output">fail to enroll: fail to execute request to {kib}:Post http://kibana:5601/api/fleet/agents/enroll?: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</pre>
</div>
<p>This may occur if the host is unable to connect to Kibana. To troubleshoot the
problem:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Check for networking problems. Run the <code class="literal">ping</code> command from the host to confirm
that it can reach the Kibana instance.
</li>
<li class="listitem">
Verify that the URL and port you specified during enrollment are correct for
your environment.
</li>
<li class="listitem">
<p>Check the enrollment key that you specified during enrollment to confirm that
the key is valid. To do this:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, go to the <span class="strong strong"><strong>Agents</strong></span> tab and click <span class="strong strong"><strong>Enrollment Tokens</strong></span>.
</li>
<li class="listitem">
Click the eyeball icon to see the secret. The secret should match the string
that you used to enroll Elastic Agent on your host.
</li>
<li class="listitem">
If the secret doesn&#8217;t match, create a new enrollment token and use the new
token when you run the <code class="literal">elastic-agent enroll</code> command.
</li>
</ol>
</div>
</li>
</ol>
</div>
<h3><a id="es-apikey-failed"></a>Elasticsearch authentication service fails with <code class="literal">Authentication using apikey failed</code> message<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h3>
<p>Fleet requires an encryption key in order to save API keys and encrypt them in
Kibana. To provide an API key, set the <code class="literal">xpack.encryptedSavedObjects.encryptionKey</code>
property in the <code class="literal">kibana.yml</code> configuration file. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.encryptedSavedObjects.encryptionKey: "something_at_least_32_characters"</pre>
</div>
<h3><a id="process-not-root"></a>Elastic Agent fails with <code class="literal">Agent process is not root/admin or validation failed</code> message<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h3>
<p>Make sure the user running Elastic Agent has root privileges. If you&#8217;re running
Elastic Agent in the foreground (and not as a service) on Linux or macOS, run the
agent under the root user, for example, <code class="literal">sudo</code> or <code class="literal">su</code>. Some integrations
require root privileges to collect sensitive data.</p>
<p>If you&#8217;re using the Endpoint Security integration, also make sure you&#8217;re
running Elastic Agent under the SYSTEM account.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you install Elastic Agent as a service as described in
<a class="xref" href="elastic-agent-installation.html" title="Install Elastic Agent">Install Elastic Agent</a>, Elastic Agent runs under the SYSTEM account by
default.</p>
</div>
</div>
<p>To run Elastic Agent under the SYSTEM account, you can:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec" class="ulink" target="_top">PsExec</a>
and extract the contents to a folder, for example, <code class="literal">d:\tools</code>.
</li>
<li class="listitem">
Open a command prompt as an Administrator (right-click the Command Prompt
icon and select <span class="strong strong"><strong>Run As Administrator</strong></span>).
</li>
<li class="listitem">
<p>From the command prompt, run Elastic Agent under the SYSTEM account:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">d:\tools\psexec.exe -sid "C:\Program Files\Elastic-Agent\elastic-agent.exe" run</pre>
</div>
</li>
</ol>
</div>
<h3><a id="agent-hangs-while-unenrolling"></a>Elastic Agent hangs while unenrolling<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h3>
<p>When you unenroll an agent, Fleet waits for acknowledgement from the agent
before it completes the unenrollment process. If Fleet doesn&#8217;t receive
acknowledgement, the status hangs at <code class="literal">unenrolling.</code></p>
<p>If this happens, select <span class="strong strong"><strong>Force unenroll</strong></span> from the <span class="strong strong"><strong>Actions</strong></span> menu in the
Agents list.</p>
<p>This will invalidate all API keys related to the agent and change the status to
<code class="literal">inactive</code> so that the agent no longer appears in Fleet.</p>
<h3><a id="endpoint-unauthorized"></a>API key is unauthorized to send telemetry to <code class="literal">.logs-endpoint.diagnostic.collection-*</code> indices<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.11/docs/en/ingest-management/troubleshooting.asciidoc">edit</a></h3>
<p>Telemetry is turned on by default in the Elastic Stack. This helps us learn about the
features that our users are most interested in, so we can focus our efforts on
making them even better.</p>
<p>If you&#8217;ve recently upgraded from version 7.10 to 7.11, you might see the
following message when you view Endpoint Security logs:</p>
<pre class="screen">action [indices:admin/auto_create] is unauthorized for API key id [KbvCi3YB96EBa6C9k2Cm]
of user [fleet_enroll] on indices [.logs-endpoint.diagnostic.collection-default]</pre>
<p>This message indicates that Elastic Endpoint does not have the correct
permissions to send telemetry. This is a known problem in 7.11 that will be
fixed in an upcoming patch release. To remove this message from your logs, you
can turn off telemetry for the Endpoint Security integration until the next patch
release is available.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, go to <span class="strong strong"><strong>Fleet &gt; Integrations</strong></span> and click the
<span class="strong strong"><strong>Installed integrations</strong></span> tab.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Endpoint Security</strong></span>, and then click the <span class="strong strong"><strong>Policies</strong></span> tab to see all the
installed integrations.
</li>
<li class="listitem">
Click the integration to edit it.
</li>
<li class="listitem">
Under advanced settings, set <code class="literal">windows.advanced.diagnostic.enabled</code>
to <code class="literal">false</code>, then save the integration.
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="run-elastic-agent.html">« Run Elastic Agent</a>
</span>
<span class="next">
<a href="fleet-faq.html">Frequently asked questions »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
