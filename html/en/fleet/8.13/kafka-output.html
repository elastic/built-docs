<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Kafka output | Fleet and Elastic Agent Guide [8.13] | Elastic</title>
<meta class="elastic" name="content" content="Kafka output | Fleet and Elastic Agent Guide [8.13]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.13]"/>
<link rel="up" href="elastic-agent-output-configuration.html" title="Configure outputs for standalone Elastic Agents"/>
<link rel="prev" href="elasticsearch-output.html" title="Configure the Elasticsearch output"/>
<link rel="next" href="logstash-output.html" title="Logstash output"/>
<meta class="elastic" name="product_version" content="8.13"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.13"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.13"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.13]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="elastic-agent-configuration.html">Configure standalone Elastic Agents</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="elastic-agent-output-configuration.html">Configure outputs for standalone Elastic Agents</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="elasticsearch-output.html">« Configure the Elasticsearch output</a>
</span>
<span class="next">
<a href="logstash-output.html">Logstash output »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="kafka-output"></a>Kafka output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.13/docs/en/ingest-management/elastic-agent/configuration/outputs/output-kafka.asciidoc">edit</a></h3>
</div></div></div>

<p>The Kafka output sends events to Apache Kafka.</p>
<p><span class="strong strong"><strong>Compatibility:</strong></span> This output can connect to Kafka version 0.8.2.0 and later.
Older versions might work as well, but are not supported.</p>
<p>This example configures a Kafka output called <code class="literal">kafka-output</code> in the Elastic Agent
<code class="literal">elastic-agent.yml</code> file, with settings as described further in:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">outputs:
  kafka-output:
    type: kafka
    hosts:
      - 'kafka1:9092'
      - 'kafka2:9092'
      - 'kafka3:9092'
    client_id: Elastic
    version: 1.0.0
    compression: gzip
    compression_level: 4
    username: &lt;my-kafka-username&gt;
    password: &lt;my-kakfa-password&gt;
    sasl:
      mechanism: SCRAM-SHA-256
    partition:
      round_robin:
        group_events: 1
    topics:
      - topic: '%{[fields.log_topic]}'
    headers: []
    timeout: 30
    broker_timeout: 30
    required_acks: 1
    ssl:
      verification_mode: full</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_kafka_output_configuration_settings"></a>Kafka output configuration settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.13/docs/en/ingest-management/elastic-agent/configuration/outputs/output-kafka.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">kafka</code> output supports the following settings, grouped by category.
Many of these settings have sensible defaults that allow you to run Elastic Agent with
minimal configuration.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="kafka-output.html#output-kafka-commonly-used-settings">Kafka output configuration settings</a>
</li>
<li class="listitem">
<a class="xref" href="kafka-output.html#output-kafka-authentication-settings" title="Authentication settings">Authentication settings</a>
</li>
<li class="listitem">
<a class="xref" href="kafka-output.html#output-kafka-memory-queue-settings" title="Memory queue settings">Memory queue settings</a>
</li>
<li class="listitem">
<a class="xref" href="kafka-output.html#output-kafka-topics-settings" title="Topics settings">Topics settings</a>
</li>
<li class="listitem">
<a class="xref" href="kafka-output.html#output-kafka-partition-settings" title="Partition settings">Partition settings</a>
</li>
<li class="listitem">
<a class="xref" href="kafka-output.html#output-kafka-header-settings" title="Header settings">Header settings</a>
</li>
<li class="listitem">
<a class="xref" href="kafka-output.html#output-kafka-configuration-settings" title="Other configuration settings">Other configuration settings</a>
== Commonly used settings
</li>
</ul>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">
Setting
</th>
<th align="left" valign="top">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="output-kafka-enabled-setting"></a><code class="literal">enabled</code></p>
</td>
<td align="left" valign="top">
<p>(boolean) Enables or disables the output. If set to <code class="literal">false</code>, the output is
disabled.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-hosts-setting"></a><code class="literal">hosts</code></p>
</td>
<td align="left" valign="top">
<p>The addresses your Elastic Agents will use to connect to one or more Kafka brokers.</p>
<p>Following is an example <code class="literal">hosts</code> setting with three hosts defined:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">    hosts:
      - 'localhost:9092'
      - 'mykafkahost01:9092'
      - 'mykafkahost02:9092'</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-version-setting"></a><code class="literal">version</code></p>
</td>
<td align="left" valign="top">
<p>Kafka protocol version that Elastic Agent will request when connecting. Defaults to 1.0.0.</p>
<p>The protocol version controls the Kafka client features available to Elastic Agent; it does not prevent Elastic Agent from connecting to Kafka versions newer than the protocol version.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="output-kafka-authentication-settings"></a>Authentication settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.13/docs/en/ingest-management/elastic-agent/configuration/outputs/output-kafka.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">
Setting
</th>
<th align="left" valign="top">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-username-setting"></a><code class="literal">username</code></p>
</td>
<td align="left" valign="top">
<p>The username for connecting to Kafka. If username is configured, the password must be configured as well.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-password-setting"></a><code class="literal">password</code></p>
</td>
<td align="left" valign="top">
<p>The password for connecting to Kafka.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-sasl.mechanism-setting"></a><code class="literal">sasl.mechanism</code></p>
</td>
<td align="left" valign="top">
<p>The SASL mechanism to use when connecting to Kafka. It can be one of:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">PLAIN</code> for SASL/PLAIN.
</li>
<li class="listitem">
<code class="literal">SCRAM-SHA-256</code> for SCRAM-SHA-256.
</li>
<li class="listitem">
<code class="literal">SCRAM-SHA-512</code> for SCRAM-SHA-512.
If <code class="literal">sasl.mechanism</code> is not set, <code class="literal">PLAIN</code> is used if <code class="literal">username</code> and <code class="literal">password</code> are provided. Otherwise, SASL authentication is disabled.
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-ssl-setting"></a><code class="literal">ssl</code></p>
</td>
<td align="left" valign="top">
<p>When sending data to a secured cluster through the <code class="literal">kafka</code>
output, Elastic Agent can use SSL/TLS. For a list of available settings, refer to
<a class="xref" href="elastic-agent-ssl-configuration.html" title="Configure SSL/TLS for standalone Elastic Agents">SSL/TLS</a>, specifically the settings under
<a class="xref" href="elastic-agent-ssl-configuration.html#common-ssl-options" title="Common configuration options">Table 4, &#8220;Common configuration options&#8221;</a> and <a class="xref" href="elastic-agent-ssl-configuration.html#client-ssl-options" title="Client configuration options">Table 5, &#8220;Client configuration options&#8221;</a>.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="output-kafka-memory-queue-settings"></a>Memory queue settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.13/docs/en/ingest-management/elastic-agent/configuration/outputs/output-kafka.asciidoc">edit</a></h4>
</div></div></div>
<p>The memory queue keeps all events in memory.</p>
<p>The memory queue waits for the output to acknowledge or drop events. If the queue is full, no new
events can be inserted into the memory queue. Only after the signal from the output will the queue
free up space for more events to be accepted.</p>
<p>The memory queue is controlled by the parameters <code class="literal">flush.min_events</code> and <code class="literal">flush.timeout</code>.
<code class="literal">flush.min_events</code> gives a limit on the number of events that can be included in a single batch, and
<code class="literal">flush.timeout</code> specifies how long the queue should wait to completely fill an event request. If the
output supports a <code class="literal">bulk_max_size</code> parameter, the maximum batch size will be the smaller of
<code class="literal">bulk_max_size</code> and <code class="literal">flush.min_events</code>.</p>
<p><code class="literal">flush.min_events</code> is a legacy parameter, and new configurations should prefer to control batch size
with <code class="literal">bulk_max_size</code>. As of 8.13, there is never a performance advantage to limiting batch size with
<code class="literal">flush.min_events</code> instead of <code class="literal">bulk_max_size</code>.</p>
<p>In synchronous mode, an event request is always filled as soon as events are available, even if
there are not enough events to fill the requested batch. This is useful when latency must be
minimized. To use synchronous mode, set <code class="literal">flush.timeout</code> to 0.</p>
<p>For backwards compatibility, synchronous mode can also be activated by setting <code class="literal">flush.min_events</code> to 0
or 1. In this case, batch size will be capped at 1/2 the queue capacity.</p>
<p>In asynchronous mode, an event request will wait up to the specified timeout to try and fill the
requested batch completely. If the timeout expires, the queue returns a partial batch with all
available events. To use asynchronous mode, set <code class="literal">flush.timeout</code> to a positive duration, for example 5s.</p>
<p>This sample configuration forwards events to the output when there are enough events to fill the
output&#8217;s request (usually controlled by <code class="literal">bulk_max_size</code>, and limited to at most 512 events by
<code class="literal">flush.min_events</code>), or when events have been waiting for</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">  queue.mem.events: 4096
  queue.mem.flush.min_events: 512
  queue.mem.flush.timeout: 5s</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">
Setting
</th>
<th align="left" valign="top">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="output-kafka-queue.mem.events-setting"></a><code class="literal">queue.mem.events</code></p>
</td>
<td align="left" valign="top">
<p>The number of events the queue can store. This value should be evenly divisible by the smaller of <code class="literal">queue.mem.flush.min_events</code> or <code class="literal">bulk_max_size</code> to avoid sending partial batches to the output.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">3200 events</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="output-kafka-queue.mem.flush.min_events-setting"></a><code class="literal">queue.mem.flush.min_events</code></p>
</td>
<td align="left" valign="top">
<p><code class="literal">flush.min_events</code> is a legacy parameter, and new configurations should prefer to control batch size with <code class="literal">bulk_max_size</code>. As of 8.13, there is never a performance advantage to limiting batch size with <code class="literal">flush.min_events</code> instead of <code class="literal">bulk_max_size</code></p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">1600 events</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="output-kafka-queue.mem.flush.timeout-setting"></a><code class="literal">queue.mem.flush.timeout</code></p>
</td>
<td align="left" valign="top">
<p>(int) The maximum wait time for <code class="literal">queue.mem.flush.min_events</code> to be fulfilled. If set to 0s, events are available to the output immediately.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">10s</code></p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="output-kafka-topics-settings"></a>Topics settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.13/docs/en/ingest-management/elastic-agent/configuration/outputs/output-kafka.asciidoc">edit</a></h4>
</div></div></div>
<p>Use these options to dynamically set the Kafka topic for each Elastic Agent event.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">
Setting
</th>
<th align="left" valign="top">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-topic-setting"></a><code class="literal">topic</code></p>
</td>
<td align="left" valign="top">
<p>The default Kafka topic used for produced events.</p>
<p>You can set the topic dynamically by using a format string to access any event field. For example, this configuration uses a custom field, <code class="literal">fields.log_topic</code>, to set the topic for each event:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">topic: '%{[fields.log_topic]}'</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-topics-setting"></a><code class="literal">topics</code></p>
</td>
<td align="left" valign="top">
<p>One or more topic processors including a condition, the event value to check against, and the resulting Kafka topic.</p>
<p>Events that don&#8217;t match against any defined processor are set to the default topic.</p>
<p>Rule settings:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">topic</code>
</span>
</dt>
<dd>
The topic format string to use. If this string contains field references, such as <code class="literal">%{[fields.name]}</code>, the fields must exist, or the rule fails.
</dd>
<dt>
<span class="term">
<code class="literal">mappings</code>
</span>
</dt>
<dd>
A dictionary that takes the value returned by <code class="literal">topic</code> and maps it to a new name.
</dd>
<dt>
<span class="term">
<code class="literal">default</code>
</span>
</dt>
<dd>
The default string value to use if <code class="literal">mappings</code> does not find a match.
</dd>
<dt>
<span class="term">
<code class="literal">when</code>
</span>
</dt>
<dd>
A condition that must succeed in order to execute the current rule. Refer to <a class="xref" href="processor-syntax.html#processor-conditions" title="Conditions">conditions</a> in the Elastic Agent processor syntax for condition descriptions. Currently the equals, contains, and regexp conditions are available.
</dd>
</dl>
</div>
<p>As an example for setting up your processors, you might want to route log events based on severity. To do so, you can specify a default topic for all events not matched by other processors:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">outputs:
  kafka-output:
    type: kafka
    hosts:
      - 'kafka1:9092'
      - 'kafka2:9092'
      - 'kafka3:9092'
    topics:
      - topic: 'critical-%{[agent.version]}'
        when:
          contains:
            message: ' “CRITICAL”'
      - topic: 'error-%{[agent.version]}'
        when:
          contains:
            message: ' “ERR”'
      - topic: '%{[fields.log_topic]}'</pre>
</div>
<p>All non-critical and non-error events will then route to the default <code class="literal">%{[fields.log_topic]}</code> topic.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="output-kafka-partition-settings"></a>Partition settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.13/docs/en/ingest-management/elastic-agent/configuration/outputs/output-kafka.asciidoc">edit</a></h4>
</div></div></div>
<p>The number of partitions created is set automatically by the Kafka broker based on the list of topics. Records are then published to partitions either randomly, in round-robin order, or according to a calculated hash.</p>
<p>In the following example, after each event is published to a partition, the partitioner selects the next partition in round-robin fashion.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">    partition:
      round_robin:
        group_events: 1</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">
Setting
</th>
<th align="left" valign="top">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-random.group-events-setting"></a><code class="literal">random.group_events</code></p>
</td>
<td align="left" valign="top">
<p>Sets the number of events to be published to the same partition, before the partitioner selects a new partition by random. The default value is 1 meaning after each event a new partition is picked randomly.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-round_robin.group_events-setting"></a><code class="literal">round_robin.group_events</code></p>
</td>
<td align="left" valign="top">
<p>Sets the number of events to be published to the same partition, before the partitioner selects the next partition. The default value is 1 meaning after each event the next partition will be selected.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-hash.hash-setting"></a><code class="literal">hash.hash</code></p>
</td>
<td align="left" valign="top">
<p>List of fields used to compute the partitioning hash value from. If no field is configured, the events key value will be used.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-hash.random-setting"></a><code class="literal">hash.random</code></p>
</td>
<td align="left" valign="top">
<p>Randomly distribute events if no hash or key value can be computed.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="output-kafka-header-settings"></a>Header settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.13/docs/en/ingest-management/elastic-agent/configuration/outputs/output-kafka.asciidoc">edit</a></h4>
</div></div></div>
<p>A header is a key-value pair, and multiple headers can be included with the same key. Only string values are supported. These headers will be included in each produced Kafka message.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">
Setting
</th>
<th align="left" valign="top">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-key-setting"></a><code class="literal">key</code></p>
</td>
<td align="left" valign="top">
<p>The key to set in the Kafka header.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-value-setting"></a><code class="literal">value</code></p>
</td>
<td align="left" valign="top">
<p>The value to set in the Kafka header.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-client_id-setting"></a><code class="literal">client_id</code></p>
</td>
<td align="left" valign="top">
<p>The configurable ClientID used for logging, debugging, and auditing purposes. The default is <code class="literal">Elastic</code>. The Client ID is part of the protocol to identify where the messages are coming from.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="output-kafka-configuration-settings"></a>Other configuration settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.13/docs/en/ingest-management/elastic-agent/configuration/outputs/output-kafka.asciidoc">edit</a></h4>
</div></div></div>
<p>You can specify these various other options in the <code class="literal">kafka-output</code> section of the agent configuration file.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">
Setting
</th>
<th align="left" valign="top">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="output-kafka-backoff.init-setting"></a><code class="literal">backoff.init</code></p>
</td>
<td align="left" valign="top">
<p>(string) The number of seconds to wait before trying to reconnect to Kafka
after a network error. After waiting <code class="literal">backoff.init</code> seconds, Elastic Agent tries to
reconnect. If the attempt fails, the backoff timer is increased exponentially up
to <code class="literal">backoff.max</code>. After a successful connection, the backoff timer is reset.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">1s</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-backoff.max-setting"></a><code class="literal">backoff.max</code></p>
</td>
<td align="left" valign="top">
<p>(string) The maximum number of seconds to wait before attempting to connect to
Kafka after a network error.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">60s</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-broker_timeout-setting"></a><code class="literal">broker_timeout</code></p>
</td>
<td align="left" valign="top">
<p>The maximum length of time a Kafka broker waits for the required number of ACKs before timing out (see the <code class="literal">required_acks</code> setting further in).</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">30</code> (seconds)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-bulk_flush_frequency-setting"></a><code class="literal">bulk_flush_frequency</code></p>
</td>
<td align="left" valign="top">
<p>(int) Duration to wait before sending bulk Kafka request. <code class="literal">0`</code> is no delay.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">0</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-bulk_max_size-setting"></a><code class="literal">bulk_max_size</code></p>
</td>
<td align="left" valign="top">
<p>(int) The maximum number of events to bulk in a single Kafka
request.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">2048</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-channel_buffer_size-setting"></a><code class="literal">channel_buffer_size</code></p>
</td>
<td align="left" valign="top">
<p>(int) Per Kafka broker number of messages buffered in output pipeline.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">256</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-codec-setting"></a><code class="literal">codec</code></p>
</td>
<td align="left" valign="top">
<p>Output codec configuration. You can specify either the <code class="literal">json</code> or <code class="literal">format</code>
codec. By default the <code class="literal">json</code> codec is used.</p>
<p><span class="strong strong"><strong><code class="literal">json.pretty</code></strong></span>: If <code class="literal">pretty</code> is set to true, events will be nicely formatted. The default is false.</p>
<p><span class="strong strong"><strong><code class="literal">json.escape_html</code></strong></span>: If <code class="literal">escape_html</code> is set to true, html symbols will be escaped in strings. The default is false.</p>
<p>Example configuration that uses the <code class="literal">json</code> codec with pretty printing enabled to write events to the console:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.console:
  codec.json:
    pretty: true
    escape_html: false</pre>
</div>
<p><span class="strong strong"><strong><code class="literal">format.string</code></strong></span>: Configurable format string used to create a custom formatted message.</p>
<p>Example configurable that uses the <code class="literal">format</code> codec to print the events timestamp and message field to console:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.console:
  codec.format:
    string: '%{[@timestamp]} %{[message]}'</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-compression-setting"></a><code class="literal">compression</code></p>
</td>
<td align="left" valign="top">
<p>Select a compression codec to use. Supported codecs are <code class="literal">snappy</code>, <code class="literal">lz4</code> and <code class="literal">gzip</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-compression_level-setting"></a><code class="literal">compression_level</code></p>
</td>
<td align="left" valign="top">
<p>For the <code class="literal">gzip</code> codec you can choose a compression level. The level must be in the range of <code class="literal">1</code> (best speed) to <code class="literal">9</code> (best compression).</p>
<p>Increasing the compression level reduces the network usage but increases the CPU usage.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">4</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-keep_alive-setting"></a><code class="literal">keep_alive</code></p>
</td>
<td align="left" valign="top">
<p>(string) The keep-alive period for an active network connection. If <code class="literal">0s</code>, keep-alives are disabled.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">0s</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-max_message_bytes-setting"></a><code class="literal">max_message_bytes</code></p>
</td>
<td align="left" valign="top">
<p>(int) The maximum permitted size of JSON-encoded messages. Bigger messages will be dropped. This value should be equal to or less than the broker&#8217;s <code class="literal">message.max.bytes</code>.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">1000000</code> (bytes)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-metadata-setting"></a><code class="literal">metadata</code></p>
</td>
<td align="left" valign="top">
<p>Kafka metadata update settings. The metadata contains information about
brokers, topics, partition, and active leaders to use for publishing.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">refresh_frequency</code></strong></span>
</span>
</dt>
<dd>
Metadata refresh interval. Defaults to 10 minutes.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">full</code></strong></span>
</span>
</dt>
<dd>
Strategy to use when fetching metadata. When this option is <code class="literal">true</code>, the
client will maintain a full set of metadata for all the available topics. When set
to <code class="literal">false</code> it will only refresh the metadata for the configured topics. The default
is false.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">retry.max</code></strong></span>
</span>
</dt>
<dd>
Total number of metadata update retries. The default is 3.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">retry.backoff</code></strong></span>
</span>
</dt>
<dd>
Waiting time between retries. The default is 250ms.
</dd>
</dl>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-required_acks-setting"></a><code class="literal">required_acks</code></p>
</td>
<td align="left" valign="top">
<p>The ACK reliability level required from broker. 0=no response, 1=wait for local commit, -1=wait for all replicas to commit. The default is 1.</p>
<p>Note: If set to 0, no ACKs are returned by Kafka. Messages might be lost silently on error.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">1</code> (wait for local commit)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-timeout-setting"></a><code class="literal">timeout</code></p>
</td>
<td align="left" valign="top">
<p>The number of seconds to wait for responses from the Kafka brokers before timing out. The default is 30 (seconds).</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">1000000</code> (bytes)</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="elasticsearch-output.html">« Configure the Elasticsearch output</a>
</span>
<span class="next">
<a href="logstash-output.html">Logstash output »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
