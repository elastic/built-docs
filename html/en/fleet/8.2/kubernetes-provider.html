<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Kubernetes Provider | Fleet and Elastic Agent Guide [8.2] | Elastic</title>
<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.2]"/>
<link rel="up" href="providers.html" title="Providers"/>
<link rel="prev" href="docker-provider.html" title="Docker Provider"/>
<link rel="next" href="elastic-agent-output-configuration.html" title="Configure outputs for standalone Elastic Agents"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.2"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.2"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.2]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="elastic-agent-configuration.html">Elastic Agent standalone configuration</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="providers.html">Providers</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="docker-provider.html">« Docker Provider</a>
</span>
<span class="next">
<a href="elastic-agent-output-configuration.html">Configure outputs for standalone Elastic Agents »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="kubernetes-provider"></a>Kubernetes Provider<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/ingest-management/elastic-agent/configuration/providers/kubernetes-provider.asciidoc">edit</a></h3>
</div></div></div>
<p>Provides inventory information from Kubernetes.</p>
<h5><a id="_provider_configuration_2"></a>Provider configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/ingest-management/elastic-agent/configuration/providers/kubernetes-provider.asciidoc">edit</a></h5>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers.kubernetes:
  node: ${NODE_NAME}
  scope: node
  #kube_config: /Users/elastic-agent/.kube/config
  #sync_period: 600s
  #cleanup_timeout: 60s
  resources:
    pod:
      enabled: true</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
<p>
(Optional) Specify the node to scope Elastic Agent to in case it
cannot be accurately detected by the default discovery approach:
</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If Elastic Agent is deployed in Kubernetes cluster as Pod, use hostname of pod as the pod name to query pod metadata for node name.
</li>
<li class="listitem">
If step 1 fails or Elastic Agent is deployed outside of the Kubernetes cluster, use machine-id to match against Kubernetes nodes for node name.
</li>
<li class="listitem">
If node cannot be discovered with step 1 or 2 fall back to <code class="literal">NODE_NAME</code> environment variable as default value. In case it is not set return error.
</li>
</ol>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">cleanup_timeout</code>
</span>
</dt>
<dd>
(Optional) Specify the time of inactivity before stopping the
running configuration for a container. This is <code class="literal">60s</code> by default.
</dd>
<dt>
<span class="term">
<code class="literal">sync_period</code>
</span>
</dt>
<dd>
(Optional) Specify the timeout for listing historical resources.
</dd>
<dt>
<span class="term">
<code class="literal">kube_config</code>
</span>
</dt>
<dd>
<p>
(Optional) Use the given config file as configuration for Kubernetes
client. If <code class="literal">kube_config</code> is not set, the <code class="literal">KUBECONFIG</code> environment variable will be
checked and will fall back to InCluster if not present. InCluster mode means that if
Elastic Agent runs as a Pod it will try to initialize the client using the token and certificate
that are mounted in the Pod by default:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/var/run/secrets/kubernetes.io/serviceaccount/token</code>
</li>
<li class="listitem">
<code class="literal">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p>as well as using the environment variables <code class="literal">KUBERNETES_SERVICE_HOST</code> and <code class="literal">KUBERNETES_SERVICE_PORT</code>
to reach the API Server.
<code class="literal">kube_client_options</code>:: (Optional) Additional options can be configured for Kubernetes
client. Currently client QPS and burst are supported, if not set Kubernetes client&#8217;s
  <a href="https://pkg.go.dev/k8s.io/client-go/rest#pkg-constants" class="ulink" target="_top">default QPS and burst</a> will be used.
Example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">      kube_client_options:
        qps: 5
        burst: 10</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">scope</code>
</span>
</dt>
<dd>
(Optional) Specify the level for autodiscover. <code class="literal">scope</code> can
either take <code class="literal">node</code> or <code class="literal">cluster</code> as values. <code class="literal">node</code> scope allows discovery of resources in
the specified node. <code class="literal">cluster</code> scope allows cluster wide discovery. Only <code class="literal">pod</code> and <code class="literal">node</code> resources
can be discovered at node scope.
</dd>
<dt>
<span class="term">
<code class="literal">resources</code>
</span>
</dt>
<dd>
(Optional) Specify the resources that want to start the autodiscovery for. One
of <code class="literal">pod</code>, <code class="literal">node</code>, <code class="literal">service</code>. By default <code class="literal">node</code> and <code class="literal">pod</code> are being enabled. <code class="literal">service</code> resource
requires the <code class="literal">scope</code> to be set at <code class="literal">cluster</code>.
</dd>
<dt>
<span class="term">
<code class="literal">namespace</code>
</span>
</dt>
<dd>
(Optional) Select the namespace from which to collect the
metadata. If it is not set, the processor collects metadata from all namespaces.
It is unset by default.
</dd>
<dt>
<span class="term">
<code class="literal">include_annotations</code>
</span>
</dt>
<dd>
(Optional) If added to the provider config, then the list of annotations present in the config
are added to the event.
</dd>
<dt>
<span class="term">
<code class="literal">include_labels</code>
</span>
</dt>
<dd>
(Optional) If added to the provider config, then the list of labels present in the config
will be added to the event.
</dd>
<dt>
<span class="term">
<code class="literal">exclude_labels</code>
</span>
</dt>
<dd>
(Optional) If added to the provider config, then the list of labels present in the config
will be excluded from the event.
</dd>
<dt>
<span class="term">
<code class="literal">labels.dedot</code>
</span>
</dt>
<dd>
(Optional) If set to be <code class="literal">true</code> in the provider config, then <code class="literal">.</code> in labels will be replaced with <code class="literal">_</code>.
By default it is <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">annotations.dedot</code>
</span>
</dt>
<dd>
(Optional) If set to be <code class="literal">true</code> in the provider config, then <code class="literal">.</code> in annotations will be replaced
with <code class="literal">_</code>. By default it is <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">add_resource_metadata</code>
</span>
</dt>
<dd>
(Optional) Specify labels and annotations filters for the extra metadata coming from node and namespace.
 <code class="literal">add_resource_metadata</code> can be done for <code class="literal">node</code> or <code class="literal">namespace</code>. By default all labels are included
while annotations are not. These settings are useful when storing labels and annotations
that require special handling to avoid overloading the storage output. The enrichment of <code class="literal">node</code> or <code class="literal">namespace</code> metadata
can be individually disabled by setting <code class="literal">enabled: false</code>.
Example:
</dd>
</dl>
</div>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">      add_resource_metadata:
        namespace:
          include_labels: ["namespacelabel1"]
        node:
          include_labels: ["nodelabel2"]
          include_annotations: ["nodeannotation1"]</pre>
</div>
<h5><a id="_provider_for_pod_resources"></a>Provider for Pod resources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/ingest-management/elastic-agent/configuration/providers/kubernetes-provider.asciidoc">edit</a></h5>
<p>The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Namespace of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace.uuid</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>UUID of the Namespace of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace.labels.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Labels of the Namespace of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace.annotations.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Annotations of the Namespace of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.uuid</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>UUID of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.ip</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>IP of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.labels.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of labels of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.annotations.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of labels of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.runtime</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Runtime of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>ID of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.image</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Image of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.port</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Port of the container (if defined)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.port_name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Port&#8217;s name for the container (if defined)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.node.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.node.uid</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>UID of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.node.hostname</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Hostname of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.node.labels.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Labels of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.node.annotations.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Annotations of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.deployment.name.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Deployment name of the Pod (if exists)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.statefulset.name.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>StatefulSet name of the Pod (if exists)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.replicaset.name.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>ReplicaSet name of the Pod (if exists)</p></td>
</tr>
</tbody>
</table>
</div>
<p>These are the fields available within config templating. The <code class="literal">kubernetes.*</code> fields will be available on each emitted event.
Note that not all of these fields are available by default and special configuration options
are needed in order to include them.</p>
<p>Fox example, if the Kubernetes provider provides the following inventory:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
    {
       "id": "1",
       "mapping:": {"namespace": "kube-system", "pod": {"name": "kube-controllermanger"}},
       "processors": {"add_fields": {"kuberentes.namespace": "kube-system", "kubernetes.pod": {"name": "kube-controllermanger"}}
    {
        "id": "2",
        "mapping:": {"namespace": "kube-system", "pod": {"name": "kube-scheduler"}},
        "processors": {"add_fields": {"kubernetes.namespace": "kube-system", "kubernetes.pod": {"name": "kube-scheduler"}}
    }
]</pre>
</div>
<p>Elastic Agent automatically prefixes the result with <code class="literal">kubernetes</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
    {"kubernetes": {"id": "1", "namespace": {"name": "kube-system"}, "pod": {"name": "kube-controllermanger"}},
    {"kubernetes": {"id": "2", "namespace": {"name": "kube-system"}, "pod": {"name": "kube-scheduler"}},
]</pre>
</div>
<p>In addition, the Kubernetes metadata are being added to each event by default.</p>
<h5><a id="_autodiscover_target_pods"></a>Autodiscover target Pods<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/ingest-management/elastic-agent/configuration/providers/kubernetes-provider.asciidoc">edit</a></h5>
<p>To set the target host dynamically only for a targeted Pod based on its labels, use a variable in the
Elastic Agent policy to return path information from the provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- data_stream:
      dataset: kubernetes.scheduler
      type: metrics
  metricsets:
    - scheduler
  hosts:
    - '${kubernetes.pod.ip}:10251'
  period: 10s
  condition: ${kubernetes.labels.component} == 'kube-scheduler'</pre>
</div>
<p>The policy generated by this configuration looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- hosts:
  - 172.18.0.4:10251
  metricsets:
  - scheduler
  module: kubernetes
  period: 10s
  processors:
  - add_fields:
    fields:
      namespace: kube-system
      labels:
        component: kube-scheduler
        tier: control-plane
      pod:
        ip: 172.18.0.4
        name: kube-scheduler-kind-control-plane
        uid: 6da04645-04b4-4cb2-b203-2ad58abc6cdf
    target: kubernetes</pre>
</div>
<p>To set the log path of Pods dynamically in the configuration, use a variable in the
Elastic Agent policy to return path information from the provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">streams:
  - data_stream:
      dataset: generic
    symlinks: true
    paths:
      - /var/log/containers/*${kubernetes.container.id}.log</pre>
</div>
<p>The policy generated by this configuration looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- paths:
  - /var/log/containers/*c957652eca53594ce496c7b237d19f05be339ebfe281b99ce1c0a0401e48ce3a.log
  processors:
    - add_fields:
        fields:
          container:
            name: kube-scheduler
          labels:
            component: kube-scheduler
            tier: control-plane
          namespace:
            labels:
              kubernetes_io/metadata_name: kube-system
            name: kube-system
            uid: 436369c1-cc50-4fdd-8212-d0215bf66ffa
          node:
            hostname: kind-control-plane
            labels:
              beta_kubernetes_io/arch: amd64
              beta_kubernetes_io/os: linux
              kubernetes_io/arch: amd64
              kubernetes_io/hostname: kind-control-plane
              kubernetes_io/os: linux
              node-role_kubernetes_io/control-plane: ""
              node-role_kubernetes_io/master: ""
              node_kubernetes_io/exclude-from-external-load-balancers: ""
            name: kind-control-plane
            uid: d93dc62a-b103-4b81-b7cd-9eaf7957d6d2
          pod:
            ip: 172.18.0.2
            name: kube-scheduler-kind-control-plane
            uid: c052b569-c772-43e8-89cc-149ed6f5c69a
        target: kubernetes
    - add_fields:
        fields:
          id: 7b9754b983ec4e8b9bda39dfbe949a1b6b06c0316dc599031381707bb4ce23b6
          image:
            name: k8s.gcr.io/kube-scheduler:v1.21.1
          runtime: containerd
        target: container
    - add_fields:
        fields:
          cluster:
            name: kind-kind
            url: https://127.0.0.1:52500
        target: orchestrator</pre>
</div>
<h5><a id="_provider_for_node_resources"></a>Provider for Node resources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/ingest-management/elastic-agent/configuration/providers/kubernetes-provider.asciidoc">edit</a></h5>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers.kubernetes:
  node: ${NODE_NAME}
  scope: node
  #kube_config: /Users/elastic-agent/.kube/config
  #sync_period: 600s
  #cleanup_timeout: 60s
  resources:
    node:
      enabled: true</pre>
</div>
<p>This resource is enabled by default but in this example we define it explicitly
for clarity.</p>
<p>The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.labels.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of labels of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.annotations.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of labels of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.node.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.node.uid</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>UID of the Node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.node.hostname</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Hostname of the Node</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_provider_for_service_resources"></a>Provider for Service resources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/ingest-management/elastic-agent/configuration/providers/kubernetes-provider.asciidoc">edit</a></h5>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers.kubernetes:
  node: ${NODE_NAME}
  scope: cluster
  #kube_config: /Users/elastic-agent/.kube/config
  #sync_period: 600s
  #cleanup_timeout: 60s
  resources:
    service:
      enabled: true</pre>
</div>
<p>Note that this resource is only available with <code class="literal">scope: cluster</code> setting and <code class="literal">node</code>
cannot be used as scope.</p>
<p>The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Namespace of the Service</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace.uuid</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>UUID of the Namespace of the Service</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace.labels.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Labels of the Namespace of the Service</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace.annotations.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Annotations of the Namespace of the Service</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.labels.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of labels of the Service</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.annotations.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of labels of the Service</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.service.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the Service</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.service.uid</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>UID of the Service</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.selectors.*</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Kubernetes selectors</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="docker-provider.html">« Docker Provider</a>
</span>
<span class="next">
<a href="elastic-agent-output-configuration.html">Configure outputs for standalone Elastic Agents »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
