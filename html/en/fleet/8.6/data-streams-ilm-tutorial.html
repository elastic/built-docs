<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tutorial: Customize data retention policies | Fleet and Elastic Agent Guide [8.6] | Elastic</title>
<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.6]"/>
<link rel="up" href="data-streams.html" title="Data streams"/>
<link rel="prev" href="data-streams.html" title="Data streams"/>
<link rel="next" href="data-streams-pipeline-tutorial.html" title="Tutorial: Transform data with custom ingest pipelines"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.6"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.6"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.6]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="manage-agents-in-fleet.html">Centrally manage Elastic Agents in Fleet</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-streams.html">Data streams</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="data-streams.html">« Data streams</a>
</span>
<span class="next">
<a href="data-streams-pipeline-tutorial.html">Tutorial: Transform data with custom ingest pipelines »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="data-streams-ilm-tutorial"></a>Tutorial: Customize data retention policies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/ingest-management/data-streams.asciidoc">edit</a></h3>
</div></div></div>
<p>This tutorial explains how to apply a custom ILM policy to an integration&#8217;s data stream.</p>
<p><span class="strong strong"><strong>Scenario:</strong></span> You have Elastic Agents collecting system metrics with the System integration in two environments&#8212;&#8203;one with the namespace <code class="literal">development</code>, and one with <code class="literal">production</code>.</p>
<p><span class="strong strong"><strong>Goal:</strong></span> Customize the ILM policy for the <code class="literal">system.network</code> data stream in the <code class="literal">production</code> namespace.
Specifically, apply the built-in <code class="literal">90-days-default</code> ILM policy so that data is deleted after 90 days.</p>
<h4><a id="data-streams-ilm-one"></a>Step 1: View data streams<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/ingest-management/data-streams.asciidoc">edit</a></h4>
<p>The <span class="strong strong"><strong>Data Streams</strong></span> view in Kibana shows you the data streams,
index templates, and ILM policies associated with a given integration.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>Index Management</strong></span> &gt; <span class="strong strong"><strong>Data Streams</strong></span>.
</li>
<li class="listitem">
Search for <code class="literal">system</code> to see all data streams associated with the System integration.
</li>
<li class="listitem">
<p>Select the <code class="literal">metrics-system.network-{namespace}</code> data stream to view its associated index template and ILM policy.
As you can see, the data stream follows the <a class="xref" href="data-streams.html#data-streams-naming-scheme" title="Data stream naming scheme">Data stream naming scheme</a> and starts with its type, <code class="literal">metrics-</code>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/data-stream-info.png" alt="Data streams info">
</div>
</div>
</li>
</ol>
</div>
<h4><a id="data-streams-ilm-two"></a>Step 2: Create a component template<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/ingest-management/data-streams.asciidoc">edit</a></h4>
<p>For your changes to continue to be applied in future versions,
you must put all custom index settings into a component template.
The component template must follow the data stream naming scheme,
and end with <code class="literal">@custom</code>:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">&lt;type&gt;-&lt;dataset&gt;-&lt;namespace&gt;@custom</pre>
</div>
<p>For example, to create custom index settings for the <code class="literal">system.network</code> data stream with a namespace of <code class="literal">production</code>,
the component template name would be:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">metrics-system.network-production@custom</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>Index Management</strong></span> &gt; <span class="strong strong"><strong>Component Templates</strong></span>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create component template</strong></span>.
</li>
<li class="listitem">
Use the template above to set the name&#8212;&#8203;in this case, <code class="literal">metrics-system.network-production@custom</code>. Click <span class="strong strong"><strong>Next</strong></span>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Index settings</strong></span>, set the ILM policy name under the <code class="literal">lifecycle.name</code> key:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "lifecycle": {
    "name": "90-days-default"
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>Continue to <span class="strong strong"><strong>Review</strong></span> and ensure your request looks similar to the image below.
If it does, click <span class="strong strong"><strong>Create component template</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/create-component-template.png" alt="Create component template">
</div>
</div>
</li>
</ol>
</div>
<h4><a id="data-streams-ilm-three"></a>Step 3: Clone and modify the existing index template<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/ingest-management/data-streams.asciidoc">edit</a></h4>
<p>Now that you&#8217;ve created a component template,
you need to create an index template to apply the changes to the correct data stream.
The easiest way to do this is to duplicate and modify the integration&#8217;s existing index template.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>When duplicating the index template, do not change or remove any managed properties. This may result in problems when upgrading.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>Index Management</strong></span> &gt; <span class="strong strong"><strong>Index Templates</strong></span>.
</li>
<li class="listitem">
Find the index template you want to clone. The index template will have the <code class="literal">&lt;type&gt;</code> and <code class="literal">&lt;dataset&gt;</code> in its name,
but not the <code class="literal">&lt;namespace&gt;</code>. In this case, it&#8217;s <code class="literal">metrics-system.network</code>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Actions</strong></span> &gt; <span class="strong strong"><strong>Clone</strong></span>.
</li>
<li class="listitem">
Set the name of the new index template to <code class="literal">metrics-system.network-production</code>.
</li>
<li class="listitem">
Change the index pattern to include a namespace&#8212;&#8203;in this case, <code class="literal">metrics-system.network-production*</code>.
This ensures the previously created component template is only applied to the <code class="literal">production</code> namespace.
</li>
<li class="listitem">
Set the priority to <code class="literal">250</code>. This ensures that the new index template takes precedence over other index templates that match the index pattern.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Component templates</strong></span>, search for and add the component template created in the previous step.
To ensure your namespace-specific settings are applied over other custom settings,
the new template should be added below the existing <code class="literal">@custom</code> template.
</li>
<li class="listitem">
Create the index template.
</li>
</ol>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/create-index-template.png" alt="Create index template">
</div>
</div>
<h4><a id="data-streams-ilm-four"></a>Step 4: Roll over the data stream (optional)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/ingest-management/data-streams.asciidoc">edit</a></h4>
<p>To confirm that the data stream is now using the new index template and ILM policy,
you can either repeat <a class="xref" href="data-streams-ilm-tutorial.html#data-streams-ilm-one" title="Step 1: View data streams">step one</a>, or navigate to <span class="strong strong"><strong>Dev Tools</strong></span> and run the following:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">GET /_data_stream/metrics-system.network-production <a id="CO12-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO12-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the data stream we&#8217;ve been hacking on</p>
</td>
</tr>
</table>
</div>
<p>The result should include the following:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "data_streams" : [
    {
      ...
      "template" : "metrics-system.network-production", <a id="CO13-1"></a><i class="conum" data-value="1"></i>
      "ilm_policy" : "90-days-default", <a id="CO13-2"></a><i class="conum" data-value="2"></i>
      ...
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the custom index template created in step three</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the ILM policy applied to the new component template in step two</p>
</td>
</tr>
</table>
</div>
<p>New ILM policies only take effect when new indices are created,
so you either must wait for a rollover to occur (usually after 30 days or when the index size reaches 50 GB),
or force a rollover using the <a href="/guide/en/elasticsearch/reference/8.6/indices-rollover-index.html" class="ulink" target="_top">Elasticsearch rollover API</a>:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">POST /metrics-system.network-production/_rollover/</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="data-streams.html">« Data streams</a>
</span>
<span class="next">
<a href="data-streams-pipeline-tutorial.html">Tutorial: Transform data with custom ingest pipelines »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
