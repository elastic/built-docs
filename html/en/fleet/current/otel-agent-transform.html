<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Transform an installed Elastic Agent to run as an OTel Collector | Fleet and Elastic Agent Guide [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Transform an installed Elastic Agent to run as an OTel Collector | Fleet and Elastic Agent Guide [8.18]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.18]"/>
<link rel="up" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector"/>
<link rel="prev" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector"/>
<link rel="next" href="elastic-agent-unprivileged.html" title="Run Elastic Agent without administrative privileges"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.18"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.18"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="otel-agent.html">« Run Elastic Agent as an OTel Collector</a>
</span>
<span class="next">
<a href="elastic-agent-unprivileged.html">Run Elastic Agent without administrative privileges »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="elastic-agent-installation.html">Install Elastic Agents</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="otel-agent.html">Run Elastic Agent as an OTel Collector</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Transform an installed Elastic Agent to run as an OTel Collector</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/elastic-agent/otel-agent-transform.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    A newer version is available. Check out the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="otel-agent-transform"></a>Transform an installed Elastic Agent to run as an OTel Collector</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/elastic-agent/otel-agent-transform.asciidoc">edit</a></div>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>If you have a currently installed standalone Elastic Agent, it can be configured to run as an <a class="xref" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector">OTel Collector</a>. This allows you to run Elastic Agent both as a service and in an OTel Collector mode.</p>
<p>In order to configure an installed standalone Elastic Agent to run as an OTel Collector, it&#8217;s enough to include a valid <a class="xref" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector">OTel Collector</a> configuration in the <code class="literal">elastic-agent.yml</code> file, as shown in the following example.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_example_configure_elastic_agent_to_ingest_host_logs_and_metrics_into_elasticsearch_using_the_otel_collector"></a>Example: configure Elastic Agent to ingest host logs and metrics into Elasticsearch using the OTel Collector</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/elastic-agent/otel-agent-transform.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Prerequisites</strong></span></p>
<p>You&#8217;ll need the following:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
A suitable <a class="xref" href="grant-access-to-elasticsearch.html#create-api-key-standalone-agent" title="Create API keys for standalone agents">Elasticsearch API key</a> for authenticating on Elasticsearch
</li>
<li class="listitem">
An installed standalone Elastic Agent
</li>
<li class="listitem">
<p>A valid OTel Collector configuration. In this example we&#8217;ll use the OTel sample configuration included in the Elastic Agent repository: <code class="literal">otel_samples/platformlogs_hostmetrics.yml</code>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/elastic-agent/blob/main/internal/pkg/otel/samples/linux/platformlogs_hostmetrics.yml" class="ulink" target="_top">Linux version</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/elastic-agent/blob/main/internal/pkg/otel/samples/darwin/platformlogs_hostmetrics.yml" class="ulink" target="_top">MacOS version</a>
</li>
</ul>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Steps</strong></span></p>
<p>To change a running standalone Elastic Agent to run as an OTel Collector:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create a directory where the OTel Collector can save its state. In this example we use <code class="literal">&lt;{agent} install directory&gt;/data/otelcol</code>.
</li>
<li class="listitem">
Open the <code class="literal">&lt;{agent} install directory&gt;/otel_samples/platformlogs_hostmetrics.yml</code> file for editing.
</li>
<li class="listitem">
<p>Set environment details to be used by OTel Collector:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Option 1:</strong></span> Define environment variables for the Elastic Agent service:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ELASTIC_ENDPOINT</code>: The URL of the Elasticsearch instance where data will be sent
</li>
<li class="listitem">
<code class="literal">ELASTIC_API_KEY</code>: The API Key to use to authenticate with Elasticsearch
</li>
<li class="listitem">
<code class="literal">STORAGE_DIR</code>: The directory where the OTel Collector can persist its state
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Option 2:</strong></span> Replace the environment variable references in the sample configuration with the corresponding values:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">${env:ELASTIC_ENDPOINT}</code>:The URL of the Elasticsearch instance where data will be sent
</li>
<li class="listitem">
<code class="literal">${env:ELASTIC_API_KEY}</code>: The API Key to use to authenticate with Elasticsearch
</li>
<li class="listitem">
<code class="literal">${env:STORAGE_DIR}</code>: The directory where the OTel Collector can persist its state
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Save the opened OTel configuration as <code class="literal">elastic-agent.yml</code>, overwriting the default configuration of the installed agent.
</li>
<li class="listitem">
<p>Run the <code class="literal">elastic-agent status</code> command to verify that the new configuration has been correctly applied:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">elastic-agent status</pre>
</div>
<p>The OTel Collector running configuration should appear under <code class="literal">elastic-agent</code> key (note the <code class="literal">extensions</code> and <code class="literal">pipeline</code> keys):</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">┌─ fleet
│  └─ status: (STOPPED) Not enrolled into Fleet
└─ elastic-agent
   ├─ status: (HEALTHY) Running
   ├─ extensions
   │  ├─ status: StatusOK
   │  └─ extension:file_storage
   │     └─ status: StatusOK
   ├─ pipeline:logs/platformlogs
   │  ├─ status: StatusOK
   │  ├─ exporter:elasticsearch/otel
   │  │  └─ status: StatusOK
   │  ├─ processor:resourcedetection
   │  │  └─ status: StatusOK
   │  └─ receiver:filelog/platformlogs
   │     └─ status: StatusOK
   └─ pipeline:metrics/hostmetrics
      ├─ status: StatusOK
      ├─ exporter:elasticsearch/ecs
      │  └─ status: StatusOK
      ├─ processor:attributes/dataset
      │  └─ status: StatusOK
      ├─ processor:elasticinframetrics
      │  └─ status: StatusOK
      ├─ processor:resource/process
      │  └─ status: StatusOK
      ├─ processor:resourcedetection
      │  └─ status: StatusOK
      └─ receiver:hostmetrics/system
         └─ status: StatusOK</pre>
</div>
</li>
<li class="listitem">
Congratulations! Host logs and metrics are now being collected and ingested by the Elastic Agent service running an OTel Collector instance.
For further details about OpenTelemetry collector components supported by Elastic Agent, refer to the <a href="https://github.com/elastic/elastic-agent/tree/main/internal/pkg/otel#components" class="ulink" target="_top">Elastic Distribution for OpenTelemetry Collector README</a>.
</li>
</ol>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="otel-agent.html">« Run Elastic Agent as an OTel Collector</a>
</span>
<span class="next">
<a href="elastic-agent-unprivileged.html">Run Elastic Agent without administrative privileges »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
