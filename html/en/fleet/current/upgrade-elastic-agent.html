<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Upgrade Fleet-managed Elastic Agents | Fleet and Elastic Agent Guide [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Upgrade Fleet-managed Elastic Agents | Fleet and Elastic Agent Guide [8.19]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.19]"/>
<link rel="up" href="manage-agents.html" title="Elastic Agents"/>
<link rel="prev" href="set-inactivity-timeout.html" title="Set inactivity timeout"/>
<link rel="next" href="migrate-elastic-agent.html" title="Migrate Fleet-managed Elastic Agents from one cluster to another"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.19"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.19"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="set-inactivity-timeout.html">« Set inactivity timeout</a>
</span>
<span class="next">
<a href="migrate-elastic-agent.html">Migrate Fleet-managed Elastic Agents from one cluster to another »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="manage-agents-in-fleet.html">Centrally manage Elastic Agents in Fleet</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="manage-agents.html">Elastic Agents</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Upgrade Fleet-managed Elastic Agents</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/fleet/upgrade-elastic-agent">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="upgrade-elastic-agent"></a>Upgrade Fleet-managed Elastic Agents</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
</div></div></div>

<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Want to upgrade a standalone agent instead? See <a class="xref" href="upgrade-standalone.html" title="Upgrade standalone Elastic Agents">Upgrade standalone Elastic Agents</a>.</p>
</div>
</div>
<p>With Fleet upgrade capabilities, you can view and select agents that are out
of date, and trigger selected agents to download, install, and run the new
version. You can trigger upgrades to happen immediately, or specify a
maintenance window during which the upgrades will occur. If your Elastic Stack
subscription level supports it, you can schedule upgrades to occur at a specific
date and time.</p>
<p>In most failure cases the Elastic Agent may retry an upgrade after a short wait. The
wait durations between retries are: 1m, 5m, 10m, 15m, 30m, and 1h. During this
time, the Elastic Agent may show up as "retrying" in the Fleet UI. As well, if agent
upgrades have been detected to have stalled, you can restart the upgrade process
for a <a class="xref" href="upgrade-elastic-agent.html#restart-upgrade-single" title="Restart an upgrade for a single agent">single agent</a> or in bulk for
<a class="xref" href="upgrade-elastic-agent.html#restart-upgrade-multiple" title="Restart an upgrade for multiple agents">multiple agents</a>.</p>
<p>This approach simplifies the process of keeping your agents up to date. It also
saves you time because you don&#8217;t need third-party tools or processes to
manage upgrades.</p>
<p>By default, Elastic Agents require internet access to perform binary upgrades from
Fleet. However, you can host your own artifacts repository and configure
Elastic Agents to download binaries from it. For more information, refer to
<a class="xref" href="air-gapped.html" title="Air-gapped environments">Air-gapped environments</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The upgrade feature is not supported for upgrading DEB/RPM packages or Docker images.
Refer to <a class="xref" href="upgrade-elastic-agent.html#upgrade-system-packages" title="Upgrade RPM and DEB system packages">Upgrade RPM and DEB system packages</a> to upgrade a DEB or RPM package manually.</p>
</div>
</div>
<p>For a detailed view of the Elastic Agent upgrade process and the interactions between Fleet, Elastic Agent, and Elasticsearch, refer to the <a href="https://github.com/elastic/elastic-agent/blob/main/docs/upgrades.md" class="ulink" target="_top">Communications amongst components</a> diagram in the <code class="literal">elastic-agent</code> GitHub repository.</p>
<div class="position-relative"><h5><a id="upgrade-agent-restrictions"></a>Restrictions</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>Note the following restrictions with upgrading an Elastic Agent:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic Agent cannot be upgraded to a version higher than the highest currently installed version of Fleet Server. When you upgrade a set of Elastic Agents that are currently at the same version, you should first upgrade any agents that are acting as Fleet Server (any agents that have a Fleet Server policy associated with them).
</li>
<li class="listitem">
To be upgradeable, Elastic Agent must not be running inside a container.
</li>
<li class="listitem">
To be upgradeable in a Linux environment, Elastic Agent must be running as a service. The Linux Tar install instructions for Elastic Agent provided in Fleet include the commands to run it as a service. Elastic Agent RPM and DEB system packages cannot be upgraded through Fleet.
</li>
</ul>
</div>
<p>These restrictions apply whether you are upgrading Elastic Agents individually or in bulk. In the event that an upgrade isn&#8217;t eligible, Fleet generates a warning message when you attempt the upgrade.</p>
<div class="position-relative"><h5><a id="upgrade-agent"></a>Upgrading Elastic Agent</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>To upgrade your Elastic Agents, go to <span class="strong strong"><strong>Management</strong></span> → <span class="strong strong"><strong>Fleet</strong></span> → <span class="strong strong"><strong>Agents</strong></span> in Kibana. You
can perform the following upgrade-related actions:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">User action</th>
<th align="left" valign="top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><a class="xref" href="upgrade-elastic-agent.html#upgrade-an-agent" title="Upgrade a single Elastic Agent">Upgrade a single Elastic Agent</a></p></td>
<td align="left" valign="top"><p>Upgrade a single agent to a specific version.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="upgrade-elastic-agent.html#rolling-agent-upgrade" title="Do a rolling upgrade of multiple Elastic Agents">Do a rolling upgrade of multiple Elastic Agents</a></p></td>
<td align="left" valign="top"><p>Do a rolling upgrade of multiple agents over a specific time period.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="upgrade-elastic-agent.html#schedule-agent-upgrade" title="Schedule an upgrade">Schedule an upgrade</a></p></td>
<td align="left" valign="top"><p>Schedule an upgrade of one or more agents to begin at a specific time.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="upgrade-elastic-agent.html#view-upgrade-status" title="View upgrade status">View upgrade status</a></p></td>
<td align="left" valign="top"><p>View the detailed status of an agent upgrade, including upgrade metrics and agent logs.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="upgrade-elastic-agent.html#restart-upgrade-single" title="Restart an upgrade for a single agent">Restart an upgrade for a single agent</a></p></td>
<td align="left" valign="top"><p>Restart an upgrade process that has stalled for a single agent.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><a class="xref" href="upgrade-elastic-agent.html#restart-upgrade-multiple" title="Restart an upgrade for multiple agents">Restart an upgrade for multiple agents</a></p></td>
<td align="left" valign="top"><p>Do a bulk restart of the upgrade process for a set of agents.</p></td>
</tr>
</tbody>
</table>
</div>
<p>With the right <a href="/subscriptions" class="ulink" target="_top">subscription level</a>, you can also configure an automatic, gradual upgrade of a percentage of the Elastic Agents enrolled in an Elastic Agent policy. For more information, refer to <a class="xref" href="upgrade-elastic-agent.html#auto-upgrade-agents" title="Auto-upgrade agents enrolled in a policy">Auto-upgrade agents enrolled in a policy</a>.</p>
<div class="position-relative"><h5><a id="upgrade-an-agent"></a>Upgrade a single Elastic Agent</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On the <span class="strong strong"><strong>Agents</strong></span> tab, agents that can be upgraded are identified with an <span class="strong strong"><strong>Upgrade available</strong></span> indicator.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/upgrade-available-indicator.png" alt="Indicator on the UI showing that the agent can be upgraded">
</div>
</div>
<p>You can also click the <span class="strong strong"><strong>Upgrade available</strong></span> button to filter the list agents to only those that currently can be upgraded.</p>
</li>
<li class="listitem">
<p>From the <span class="strong strong"><strong>Actions</strong></span> menu next to the agent, choose <span class="strong strong"><strong>Upgrade agent</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/upgrade-single-agent.png" alt="Menu for upgrading a single Elastic Agent">
</div>
</div>
</li>
<li class="listitem">
<p>In the Upgrade agent window, select or specify an upgrade version and click
<span class="strong strong"><strong>Upgrade agent</strong></span>.</p>
<p>In certain cases the latest available Elastic Agent version may not be recognized by Kibana. For instance, this occurs when the Kibana version is lower than the Elastic Agent version. You can specify a custom version for Elastic Agent to upgrade to by entering the version into the <span class="strong strong"><strong>Upgrade version</strong></span> text field.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/upgrade-agent-custom.png" alt="Menu for upgrading a single Elastic Agent">
</div>
</div>
</li>
</ol>
</div>
<div class="position-relative"><h5><a id="rolling-agent-upgrade"></a>Do a rolling upgrade of multiple Elastic Agents</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>You can do rolling upgrades to avoid exhausting network resources when updating
a large number of Elastic Agents.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Agents</strong></span> tab, select multiple agents, and click <span class="strong strong"><strong>Actions</strong></span>.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Actions</strong></span> menu, choose to upgrade the agents.
</li>
<li class="listitem">
In the Upgrade agents window, select an upgrade version.
</li>
<li class="listitem">
<p>Select the amount of time available for the maintenance window. The upgrades
are spread out uniformly across this maintenance window to avoid exhausting
network resources.</p>
<p>To force selected agents to upgrade immediately when the upgrade is
triggered, select <span class="strong strong"><strong>Immediately</strong></span>. Avoid using this setting for batches of more
than 10 agents.</p>
</li>
<li class="listitem">
Upgrade the agents.
</li>
</ol>
</div>
<div class="position-relative"><h5><a id="schedule-agent-upgrade"></a>Schedule an upgrade</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Agents</strong></span> tab, select one or more agents, and click <span class="strong strong"><strong>Actions</strong></span>.
</li>
<li class="listitem">
<p>From the <span class="strong strong"><strong>Actions</strong></span> menu, choose to schedule an upgrade.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/schedule-upgrade.png" alt="Menu for scheduling Elastic Agent upgrades">
</div>
</div>
<p>If the schedule option is grayed out, it may not be available at your
subscription level. For more information, refer to <a href="/subscriptions" class="ulink" target="_top">Elastic Stack
subscriptions</a>.</p>
</li>
<li class="listitem">
In the Upgrade window, select an upgrade version.
</li>
<li class="listitem">
Select a maintenance window. For more information, refer to
<a class="xref" href="upgrade-elastic-agent.html#rolling-agent-upgrade" title="Do a rolling upgrade of multiple Elastic Agents">Do a rolling upgrade of multiple Elastic Agents</a>.
</li>
<li class="listitem">
Set the date and time when you want the upgrade to begin.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Schedule</strong></span>.
</li>
</ol>
</div>
<div class="position-relative"><h5><a id="view-upgrade-status"></a>View upgrade status</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>On the Agents tab, when you trigger an upgrade, agents that are upgrading have the status <code class="literal">Updating</code> until the upgrade is complete, and then the status changes back to <code class="literal">Healthy</code>.</p>
<p>Agents on version 8.12 and higher that are currently upgrading additionally show a detailed upgrade status indicator.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/upgrade-states.png" alt="Detailed state of an upgrading agent">
</div>
</div>
<p>The following table explains the upgrade states in the order that they can occur.</p>
<div class="table">
<p class="title"><strong>Table 6. Elastic Agent upgrade states</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Elastic Agent upgrade states">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">State</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Upgrade requested</p></td>
<td align="left" valign="top"><p>Elastic Agent has received the upgrade notice from Fleet.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Upgrade scheduled</p></td>
<td align="left" valign="top"><p>Elastic Agent has received the upgrade notice from Fleet and the upgrade will start at the indicated time.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Upgrade downloading</p></td>
<td align="left" valign="top"><p>Elastic Agent is downloading the archive containing the new version artifact.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Upgrade extracting</p></td>
<td align="left" valign="top"><p>Elastic Agent is extracting the new version artifact from the downloaded archive.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Upgrade replacing</p></td>
<td align="left" valign="top"><p>Elastic Agent is currently replacing the former, pre-upgrade agent artifact with the new one.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Upgrade restarting</p></td>
<td align="left" valign="top"><p>Elastic Agent has been replaced with a new version and is now restarting in order to apply the update.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Upgrade monitoring</p></td>
<td align="left" valign="top"><p>The newly upgraded Elastic Agent has started and is being monitored for errors.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Upgrade rolled back</p></td>
<td align="left" valign="top"><p>The upgrade was unsuccessful. Elastic Agent is being rolled back to the former, pre-upgrade version.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Upgrade failed</p></td>
<td align="left" valign="top"><p>An error has been detected in the newly upgraded Elastic Agent and the attempt to roll the upgrade back to the previous version has failed.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Under routine circumstances, an Elastic Agent upgrade happens quickly. You typically will not see the agent transition through each of the upgrade states. The detailed upgrade status can be a very useful tool especially if you need to diagnose the state of an agent that may have become stuck, or just appears to have become stuck, during the upgrade process.</p>
<p>Beside the upgrade status indicator, you can hover your cursor over the information icon to get more detail about the upgrade.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/upgrade-detailed-state01.png" alt="Granular upgrade details shown as hover text (agent has requested an upgrade)">
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/upgrade-detailed-state02.png" alt="Granular upgrade details shown as hover text (agent is restarting to apply the update)">
</div>
</div>
<p>Note that when you upgrade agents from versions below 8.12, the upgrade details are not provided.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/upgrade-non-detailed.png" alt="An earlier release agent showing only the updating state without additional details">
</div>
</div>
<p>When upgrading many agents, you can fine tune the maintenance window by
viewing stats and metrics about the upgrade:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Agents</strong></span> tab, click the host name to view agent details. If you
don&#8217;t see the host name, try refreshing the page.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>View more agent metrics</strong></span> to open the <span class="strong strong"><strong>[Elastic Agent] Agent metrics</strong></span> dashboard.
</li>
</ol>
</div>
<p>If an upgrade appears to have stalled, you can <a class="xref" href="upgrade-elastic-agent.html#restart-upgrade-single" title="Restart an upgrade for a single agent">restart it</a>.</p>
<p>If an upgrade fails, you can view the agent logs to find the reason:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, in the Host column, click the agent&#8217;s name.
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>Logs</strong></span> tab.
</li>
<li class="listitem">
<p>Search for failures.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/upgrade-failure.png" alt="Agent logs showing upgrade failure">
</div>
</div>
</li>
</ol>
</div>
<div class="position-relative"><h5><a id="restart-upgrade-single"></a>Restart an upgrade for a single agent</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>An Elastic Agent upgrade process may sometimes stall. This can happen for various
reasons, including, for example, network connectivity issues or a delayed shutdown.</p>
<p>When an Elastic Agent upgrade has been detected to be stuck, a warning indicator
appears on the UI. When this occurs, you can restart the upgrade from either the
<span class="strong strong"><strong>Agents</strong></span> tab on the main Fleet page or from the details page for any individual
agent.</p>
<p>Note that there is a required 10 minute cooldown period in between restart attempts.
After launching a restart action you need to wait for the cooldown to complete before
initiating another restart.</p>
<p>Restart from main Fleet page:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
From the <span class="strong strong"><strong>Actions</strong></span> menu next to an agent that is stuck in an <code class="literal">Updating</code>
state, choose <span class="strong strong"><strong>Restart upgrade</strong></span>.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Restart upgrade</strong></span> window, select an upgrade version and click
<span class="strong strong"><strong>Upgrade agent</strong></span>.
</li>
</ol>
</div>
<p>Restart from an agent details page:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, in the <span class="strong strong"><strong>Host</strong></span> column, click the agent&#8217;s name. On the
<span class="strong strong"><strong>Agent details</strong></span> tab, a warning notice appears if the agent is detected to have
stalled during an upgrade.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Restart upgrade</strong></span>.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Restart upgrade</strong></span> window, select an upgrade version and click
<span class="strong strong"><strong>Upgrade agent</strong></span>.
</li>
</ol>
</div>
<div class="position-relative"><h5><a id="restart-upgrade-multiple"></a>Restart an upgrade for multiple agents</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>When the upgrade process for multiple agents has been detected to have stalled,
you can restart the upgrade process in bulk. As with
<a class="xref" href="upgrade-elastic-agent.html#restart-upgrade-single" title="Restart an upgrade for a single agent">restarting an upgrade for a single agent</a>,
a 10 minute cooldown period is enforced between restarts.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Agents</strong></span> tab, select any set of the agents that are indicated to be stuck, and click <span class="strong strong"><strong>Actions</strong></span>.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Actions</strong></span> menu, select <span class="strong strong"><strong>Restart upgrade &lt;number&gt; agents</strong></span>.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Restart upgrade&#8230;&#8203;</strong></span> window, select an upgrade version.
</li>
<li class="listitem">
<p>Select the amount of time available for the maintenance window. The upgrades
are spread out uniformly across this maintenance window to avoid exhausting
network resources.</p>
<p>To force selected agents to upgrade immediately when the upgrade is
triggered, select <span class="strong strong"><strong>Immediately</strong></span>. Avoid using this setting for batches of more
than 10 agents.</p>
</li>
<li class="listitem">
Restart the upgrades.
</li>
</ol>
</div>
<div class="position-relative"><h5><a id="auto-upgrade-agents"></a>Auto-upgrade agents enrolled in a policy</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature is only available for certain subscription levels. For more information, refer to <a href="/subscriptions" class="ulink" target="_top">Elastic Stack subscriptions</a>.</p>
</div>
</div>
<p>To configure an automatic rollout of a new minor or patch version to a percentage of the agents enrolled in your Elastic Agent policy. follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, go to <span class="strong strong"><strong>Management</strong></span> → <span class="strong strong"><strong>Fleet</strong></span> → <span class="strong strong"><strong>Agent policies</strong></span>.
</li>
<li class="listitem">
Select the agent policy for which you want to configure an automatic agent upgrade.
</li>
<li class="listitem">
On the agent policy&#8217;s details page, find <span class="strong strong"><strong>Auto-upgrade agents</strong></span>, and select <span class="strong strong"><strong>Manage</strong></span> next to it.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Manage auto-upgrade agents</strong></span> window, click <span class="strong strong"><strong>Add target version</strong></span>.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Target agent version</strong></span> dropdown, select the minor or patch version to which you want to upgrade a percentage of your agents.
</li>
<li class="listitem">
<p>In the <span class="strong strong"><strong>% of agents to upgrade</strong></span> field, enter the percentage of active agents you want to upgrade to this target version.</p>
<p>Note that:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Unenrolling, unenrolled, inactive, and uninstalled agents are not included in the count. For example, if you set the target upgrade percentage to 50% for a policy with 10 active agents and 10 inactive agents, the target is met when 5 active agents are upgraded.
</li>
<li class="listitem">
Rounding is applied, and the actual percentage of the upgraded agents may vary slightly. For example, if you set the target upgrade percentage to 30% for a policy with 25 active agents, the target is met when 8 active agents are upgraded (32%).
</li>
</ul>
</div>
</li>
<li class="listitem">
You can then add a different target version, and specify the percentage of agents you want to be upgraded to that version. The total percentage of agents to be upgraded cannot exceed 100%.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save</strong></span>.
</li>
</ol>
</div>
<p>Once the configuration is saved, an asynchronous task runs every 30 minutes, gradually upgrading the agents in the policy to the specified target version.</p>
<p>In case of any failed upgrades, the upgrades are retried with exponential backoff mechanism until the upgrade is successful, or the maximum number of retries is reached. Note that the maximum number of retries is the number of <a class="xref" href="upgrade-elastic-agent.html#auto-upgrade-settings" title="Configure the auto-upgrade settings">configured retry delays</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only active agents enrolled in the policy are considered for the automatic upgrade.</p>
<p>If new agents are assigned to the policy, the number of Elastic Agents to be upgraded is adjusted according to the set percentages.</p>
</div>
</div>
<div class="position-relative"><h6><a id="auto-upgrade-settings"></a>Configure the auto-upgrade settings</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>On self-managed and cloud deployments of Elastic Stack, you can configure the default task interval and the retry delays of the automatic upgrade in the <a href="/guide/en/kibana/8.19/fleet-settings-kb.html" class="ulink" target="_top">Kibana Fleet settings</a>. For example:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">xpack.fleet.autoUpgrades.taskInterval: 15m <a id="CO16-1"></a><i class="conum" data-value="1"></i>
xpack.fleet.autoUpgrades.retryDelays: ['5m', '10m', '20m'] <a id="CO16-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time interval at which the auto-upgrade task should run. Defaults to <code class="literal">30m</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Array indicating how much time should pass before a failed auto-upgrade is retried. The array&#8217;s length indicates the maximum number of retries. Defaults to <code class="literal">['30m', '1h', '2h', '4h', '8h', '16h', '24h']</code>.</p>
</td>
</tr>
</table>
</div>
<p>For more information, refer to <a href="/guide/en/kibana/8.19/settings.html" class="ulink" target="_top">Configure Kibana</a>.</p>
<div class="position-relative"><h6><a id="auto-upgrade-view-status"></a>View the status of the automatic upgrade</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>You can view the status of the automatic upgrade in the following ways:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>On the agent policy&#8217;s details page, find <span class="strong strong"><strong>Auto-upgrade agents</strong></span>, and select <span class="strong strong"><strong>Manage</strong></span> to open the <span class="strong strong"><strong>Manage auto-upgrade agents</strong></span> window.</p>
<p>The status of the upgrade is displayed next to the specified target version and percentage, and includes the percentage of agents that have already been upgraded.</p>
<p>To view any failed upgrades, hover over the <span class="strong strong"><strong>Upgrade failed</strong></span> status, then click <span class="strong strong"><strong>Go to upgrade</strong></span>.</p>
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Fleet</strong></span> → <span class="strong strong"><strong>Agents</strong></span> page, click <span class="strong strong"><strong>Agent activity</strong></span> to open a flyout showing logs of the Elastic Agent activity and the progress of the automatic agent upgrade.
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="upgrade-system-packages"></a>Upgrade RPM and DEB system packages</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<p>If you have installed and enrolled Elastic Agent using either a DEB (for a Debian-based Linux distribution) or RPM (for a RedHat-based Linux distribution) install package, the upgrade cannot be managed by Fleet.
Instead, you can perform the upgrade using these steps.</p>
<p>For installation steps refer to <a class="xref" href="install-fleet-managed-elastic-agent.html" title="Install Fleet-managed Elastic Agents">Install Fleet-managed Elastic Agents</a>.</p>
<div class="position-relative"><h6><a id="_upgrade_a_deb_elastic_agent_installation"></a>Upgrade a DEB Elastic Agent installation:</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Download the Elastic Agent Debian install package for the release that you want to upgrade to:</p>
<div class="pre_wrapper lang-terminal">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-terminal">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.19.1-amd64.deb</pre>
</div>
</li>
<li class="listitem">
<p>Upgrade Elastic Agent to the target release:</p>
<div class="pre_wrapper lang-terminal">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-terminal">sudo dpkg -i elastic-agent-8.19.1-amd64.deb</pre>
</div>
</li>
<li class="listitem">
Confirm in Fleet that the agent has been upgraded to the target version.
Note that the <span class="strong strong"><strong>Upgrade agent</strong></span> option in the <span class="strong strong"><strong>Actions</strong></span> menu next to the agent will be disabled since [fleet]-managed upgrades are not supported for this package type.
</li>
</ol>
</div>
<div class="position-relative"><h6><a id="_upgrade_an_rpm_elastic_agent_installation"></a>Upgrade an RPM Elastic Agent installation:</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.19/docs/en/ingest-management/fleet/upgrade-elastic-agent.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Download the Elastic Agent RPM install package for the release that you want to upgrade to:</p>
<div class="pre_wrapper lang-terminal">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-terminal">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.19.1-x86_64.rpm</pre>
</div>
</li>
<li class="listitem">
<p>Upgrade Elastic Agent to the target release:</p>
<div class="pre_wrapper lang-terminal">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-terminal">sudo rpm -U elastic-agent-8.19.1-x86_64.rpm</pre>
</div>
</li>
<li class="listitem">
Confirm in Fleet that the agent has been upgraded to the target version.
Note that the <span class="strong strong"><strong>Upgrade agent</strong></span> option in the <span class="strong strong"><strong>Actions</strong></span> menu next to the agent will be disabled since [fleet]-managed upgrades are not supported for this package type.
</li>
</ol>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="set-inactivity-timeout.html">« Set inactivity timeout</a>
</span>
<span class="next">
<a href="migrate-elastic-agent.html">Migrate Fleet-managed Elastic Agents from one cluster to another »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
