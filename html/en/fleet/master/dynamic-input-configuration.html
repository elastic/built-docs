<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Variables and conditions in input configurations | Fleet User Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Fleet User Guide [master]"/>
<link rel="up" href="elastic-agent-installation-configuration.html" title="Manage your Elastic Agents"/>
<link rel="prev" href="elastic-agent-configuration.html" title="Policy settings"/>
<link rel="next" href="agent-redirects.html" title="Appendix A: Deleted pages"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/master"/>
<meta name="DC.subject" content="Fleet"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Fleet User Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="elastic-agent-installation-configuration.html">Manage your Elastic Agents</a></span>
»
<span class="breadcrumb-node">Variables and conditions in input configurations</span>
</div>
<div class="navheader">
<span class="prev">
<a href="elastic-agent-configuration.html">« Policy settings</a>
</span>
<span class="next">
<a href="agent-redirects.html">Appendix A: Deleted pages »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="dynamic-input-configuration"></a>Variables and conditions in input configurations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-dynamic-inputs.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>When running Elastic Agent in some environments, you might not know all the input
configuration details up front. To solve this problem, the input configuration
accepts variables and conditions that get evaluated at runtime using
information from the running environment. Similar to autodiscovery, these
capabilities allow you to apply configurations dynamically.</p>
<p>Let&#8217;s consider a unique agent policy that is deployed on two machines: a Linux
machine named "linux-app" and a Windows machine named "winapp". Notice that
the configuration has some variable references: <code class="literal">${host.name}</code> and
<code class="literal">${host.platform}</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
    - paths: /var/log/${host.name}/another.log
      condition: ${host.platform} == "linux"
    - path: c:/service/app.log
      condition: ${host.platform} == "windows"</pre>
</div>
<p>At runtime, Elastic Agent resolves variables and evaluates the conditions based
on values provided by the environment, generating two possible input
configurations.</p>
<p>On the Windows machine:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
    - path: c:/service/app.log</pre>
</div>
<p>On the Linux machine:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
    - paths: /var/log/linux-app/another.log</pre>
</div>
<p>Using variable substitution along with conditions allows you to create concise,
but flexible input configurations that adapt to their deployed environment.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="variable-substitution"></a>Variable substitution<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-variable-substitution.asciidoc">edit</a></h3>
</div></div></div>
<p>The syntax for variable substitution is <code class="literal">${var}</code>, where <code class="literal">var</code> is the name of a
variable defined by a provider. A <em>provider</em> defines key/value pairs that are
used for variable substitution and conditions.</p>
<p>Elastic Agent supports a variety of providers, such as <code class="literal">host</code> and <code class="literal">local</code>, that
supply variables to Elastic Agent. For example, earlier you saw <code class="literal">${host.name}</code> used to
resolve the path to the host&#8217;s log file based on the <code class="literal">{host.platform}</code> value. Both of these values
were provided by the <code class="literal">host</code> provider.</p>
<p>All providers are enabled by default when Elastic Agent starts. If a provider cannot
be configured, its variables are ignored.</p>
<p>See <a class="xref" href="dynamic-input-configuration.html#providers" title="Providers">Providers</a> for more detail.</p>
<p>The following agent policy uses a custom key named <code class="literal">foo</code> to resolve a value
defined by a local provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
    - paths: /var/log/${foo}/another.log

providers:
  local:
    vars:
      foo: bar</pre>
</div>
<p>The policy generated by this configuration looks like this:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
    - paths: /var/log/bar/another.log</pre>
</div>
<p>When an input uses a variable substitution that is not present in the current
key/value mappings being evaluated, the input is removed in the result.</p>
<p>For example, this agent policy uses an unknown key:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: logfile
    path: "/var/log/foo"
  - type: logfile
    path: "${ unknown.key }"</pre>
</div>
<p>The policy generated by this configuration looks like this:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: logfile
    path: "/var/log/foo"</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_alternative_variables_and_constants"></a>Alternative variables and constants<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-variable-substitution.asciidoc">edit</a></h4>
</div></div></div>
<p>Variable substitution can also define alternative variables or a constant.</p>
<p>To define a constant, use either <code class="literal">'</code> or <code class="literal">"</code>. When a constant is reached during
variable evaluation, any remaining variables are ignored, so a constant should
be the last entry in the substitution.</p>
<p>To define  alternatives, use <code class="literal">|</code> followed by the next variable or constant.
The power comes from allowing the input to define the preference order of the
substitution by chaining multiple variables together.</p>
<p>For example, the following agent policy chains together multiple variables to
set the log path based on information provided by the running container
environment. The constant <code class="literal">/var/log/other</code> is used to end of the path, which is
common to both providers:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: logfile
    path: "/var/log/foo"
  - type: logfile
    path: "${docker.paths.log|kubernetes.container.paths.log|'/var/log/other'}"</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="providers"></a>Providers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h3>
</div></div></div>
<p>Providers supply the key/values pairs that are used for variable substitution
and conditionals. Each provider&#8217;s keys are automatically prefixed with the name
of the provider in the context of the Elastic Agent.</p>
<p>For example, if a provider named <code class="literal">foo</code> provides
<code class="literal">{"key1": "value1", "key2": "value2"}</code>, the key/value pairs are placed in
<code class="literal">{"foo" : {"key1": "value1", "key2": "value2"}}</code>. To reference the keys, you
would use <code class="literal">{{foo.key1}}</code> and <code class="literal">{{foo.key2}}</code>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_provider_configuration"></a>Provider configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h4>
</div></div></div>
<p>The provider configuration is specified under the top-level <code class="literal">providers</code>
key in the <code class="literal">elastic-agent.yml</code> configuration. By default, all registered
providers are enabled. If a provider cannot connect, it produces no mappings.</p>
<p>The following example shows two providers, <code class="literal">local</code> and <code class="literal">local_dynamic</code>, that
supply custom keys:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers:
  local:
    vars:
      foo: bar
  local_dynamic:
    vars:
      - item: key1
      - item: key2</pre>
</div>
<p>To explicitly disable a provider, set <code class="literal">enabled: false</code>. Because all providers
are prefixed and have no name collisions, the name of the provider is the key in
the configuration.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers:
  docker:
    enabled: false</pre>
</div>
<p>Elastic Agent supports two broad types of providers: <a class="xref" href="dynamic-input-configuration.html#context-providers" title="Context providers">context</a> and
<a class="xref" href="dynamic-input-configuration.html#dynamic-providers" title="Dynamic Providers">dynamic</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="context-providers"></a>Context providers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h4>
</div></div></div>
<p>Context providers provide the current context of the running Elastic Agent, for
example, agent information (id, version), host information (hostname, IP
addresses), and environment information (environment variables).</p>
<p>They can only provide a single key/value mapping. Think of them as singletons;
an update of a key/value mapping will result in a re-evaluation of the entire
configuration. These providers are normally very static, but that&#8217;s not
required. It is possible for a value to change resulting in re-evaluation.</p>
<p>Context providers use ECS naming when possible to ensure that documentation and
understanding across projects is the same.</p>
<p>Elastic Agent supports the following context providers:</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="local-provider"></a>Local<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides custom keys to use as variables. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers:
  local:
    vars:
      foo: bar</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="agent-provider"></a>Agent provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides information about the Elastic Agent. The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Current agent ID</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Current agent version information object</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version.version</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Current agent version</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version.commit</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Version commit</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version.build_time</code></p></td>
<td align="left" valign="top"><p><code class="literal">date</code></p></td>
<td align="left" valign="top"><p>Version build time</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version.snapshot</code></p></td>
<td align="left" valign="top"><p><code class="literal">boolean</code></p></td>
<td align="left" valign="top"><p>Version is snapshot build</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="host-provider"></a>Host provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides information about the current host. The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">host.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Host name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">host.platform</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Host platform</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">host.architecture</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Host architecture</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">host.ip[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]string</code></p></td>
<td align="left" valign="top"><p>Host IP addresses</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">host.mac[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]string</code></p></td>
<td align="left" valign="top"><p>Host MAC addresses</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="env-provider"></a>Env Provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides access to the environment variables as key/values.</p>
<p>For example, if you set the variable foo:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">foo=bar elastic-agent run</pre>
</div>
<p>You can reference the environment variable as <code class="literal">${env.foo}</code>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="dynamic-providers"></a>Dynamic Providers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h4>
</div></div></div>
<p>Dynamic providers provide an array of multiple key/value mappings. Each
key/value mapping is combined with the previous context provider&#8217;s key/value
mapping to provide a new unique key/value mapping that is used to generate a
configuration.</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="local-dynamic-provider"></a>Local dynamic provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Allows you to define multiple key/values to generate multiple configurations.</p>
<p>For example, the following agent policy defines a local dynamic provider that
defines 3 values for <code class="literal">item</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
     - paths: "/var/${local_dynamic.my_var}/app.log"

providers:
  local_dynamic:
    items:
      - vars:
          my_var: key1
      - vars:
          my_var: key2
      - vars:
          my_var: key3</pre>
</div>
<p>The configuration generated by this policy looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
     - paths: "/var/key1/app.log"
 - type: logfile
   streams:
     - paths: "/var/key2/app.log"
 - type: logfile
   streams:
   - paths: "/var/key3/app.log"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="docker-provider"></a>Docker Provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides inventory information from Docker. The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>ID of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.cmd</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Arg path of container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.image</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Image of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.labels</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Labels of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.ports</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Ports of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.paths</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of paths for the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.paths.log</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Log path of the container</p></td>
</tr>
</tbody>
</table>
</div>
<p>Imagine that the Docker provider provides the following inventory:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
    {
       "id": "1",
       "mapping:": {"id": "1", "paths": {"log": "/var/log/containers/1.log"}},
       "processors": {"add_fields": {"container.name": "my-container"}}
    },
    {
        "id": "2",
        "mapping": {"id": "2", "paths": {"log": "/var/log/containers/2.log"}},
        "processors": {"add_fields": {"container.name": "other-container"}}
    }
]</pre>
</div>
<p>Elastic Agent automatically prefixes the result with <code class="literal">docker</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">---
[
    {"docker": {"id": "1", "paths": {"log": "/var/log/containers/1.log"}}},
    {"docker": {"id": "2", "paths": {"log": "/var/log/containers/2.log"}},
]
---</pre>
</div>
<p>To set the log path dynamically in the configuration, use a variable in the
Elastic Agent policy to return path information from the provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: logfile
    path: "${docker.paths.log}"</pre>
</div>
<p>The policy generated by this configuration looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: logfile
    path: "/var/log/containers/1.log"
    processors:
      - add_fields:
          container.name: my-container
  - type: logfile
    path: "/var/log/containers/2.log"
    processors:
      - add_fields:
          container.name: other-container</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="kubernetes-provider"></a>Kubernetes Provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides inventory information from Kubernetes. The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Namespace of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.uuid</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>UUID of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.ip</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>IP of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.labels</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of labels of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.runtime</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Runtime of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>ID of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.image</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Image of the container</p></td>
</tr>
</tbody>
</table>
</div>
<p>Imagine that the Kubernetes provider provides the following inventory:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
    {
       "id": "1",
       "mapping:": {"namespace": "kube-system", "pod": {"name": "kube-controllermanger"}},
       "processors": {"add_fields": {"container.name": "my-container"}}
    },
    {
        "id": "2",
        "mapping:": {"namespace": "kube-system", "pod": {"name": "kube-scheduler"}},
        "processors": {"add_fields": {"kuberentes.namespace": "kube-system", "kubernetes.pod": {"name": "kube-scheduler"}}
    }
]</pre>
</div>
<p>Elastic Agent automatically prefixes the result with <code class="literal">kuberentes</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">---
[
    {"kubernetes": {"id": "1", "namespace": "kube-system", "pod": {"name": "kube-controllermanger"}},
    {"kubernetes": {"id": "2", "namespace": "kube-system", "pod": {"name": "kube-scheduler"}},
]
---</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_provider_configuration_2"></a>Provider configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h6>
</div></div></div>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers.kubernetes:
  node: ${NODE_NAME}
  scope: node
  #kube_config: /Users/elastic-agent/.kube/config
  #sync_period: 600
  #cleanup_timeout: 60</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
(Optional) Specify the node to scope Elastic Agent to in case it
cannot be accurately detected, as when running Elastic Agent in host network
mode.
</dd>
<dt>
<span class="term">
<code class="literal">cleanup_timeout</code>
</span>
</dt>
<dd>
(Optional) Specify the time of inactivity before stopping the
running configuration for a container, 60s by default.
</dd>
<dt>
<span class="term">
<code class="literal">sync_period</code>
</span>
</dt>
<dd>
(Optional) Specify timeout for listing historical resources.
</dd>
<dt>
<span class="term">
<code class="literal">kube_config</code>
</span>
</dt>
<dd>
(Optional) Use given config file as configuration for Kubernetes
client. If kube_config is not set, KUBECONFIG environment variable will be
checked and if not present it will fall back to InCluster.
</dd>
<dt>
<span class="term">
<code class="literal">scope</code>
</span>
</dt>
<dd>
(Optional) Specify at what level autodiscover needs to be done at. <code class="literal">scope</code> can
either take <code class="literal">node</code> or <code class="literal">cluster</code> as values. <code class="literal">node</code> scope allows discovery of resources in
the specified node. <code class="literal">cluster</code> scope allows cluster wide discovery. Only <code class="literal">pod</code> and <code class="literal">node</code> resources
can be discovered at node scope.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_autodiscover_target_pods"></a>Autodiscover target Pods<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h6>
</div></div></div>
<p>To set the target host dynamically only for a targeted Pod based on its labels, use a variable in the
Elastic Agent policy to return path information from the provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- data_stream:
      dataset: kubernetes.scheduler
      type: metrics
  metricsets:
    - scheduler
  hosts:
    - '${kubernetes.pod.ip}:10251'
  period: 10s
  condition: ${kubernetes.pod.labels.component} == 'kube-scheduler'</pre>
</div>
<p>The policy generated by this configuration looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- hosts:
  - 172.18.0.4:10251
  metricsets:
  - scheduler
  module: kubernetes
  period: 10s
  processors:
  - add_fields:
    fields:
      namespace: kube-system
      pod:
        ip: 172.18.0.4
        labels:
          component: kube-scheduler
          tier: control-plane
        name: kube-scheduler-kind-control-plane
        uid: 6da04645-04b4-4cb2-b203-2ad58abc6cdf
    target: kubernetes</pre>
</div>
<p>To set the log path of Pods dynamically in the configuration, use a variable in the
Elastic Agent policy to return path information from the provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">streams:
  - data_stream:
      dataset: generic
    symlinks: true
    paths:
      - /var/log/containers/*${kubernetes.container.id}.log</pre>
</div>
<p>The policy generated by this configuration looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- paths:
  - /var/log/containers/*c957652eca53594ce496c7b237d19f05be339ebfe281b99ce1c0a0401e48ce3a.log
  processors:
  - add_fields:
    fields:
      container:
        id: c957652eca53594ce496c7b237d19f05be339ebfe281b99ce1c0a0401e48ce3a
        image: k8s.gcr.io/kube-apiserver:v1.18.2
        name: kube-apiserver
        runtime: containerd
      namespace: kube-system
      pod:
        ip: 172.18.0.4
        labels:
          component: kube-apiserver
          tier: control-plane
        name: kube-apiserver-kind-control-plane
        uid: f8743f90-50a4-4ef8-9fe9-78c245eb8bf3
    target: kubernetes
  symlinks: true</pre>
</div>
</div>

</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="conditions"></a>Conditions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-conditions.asciidoc">edit</a></h3>
</div></div></div>
<p>A condition is a boolean expression that you can specify in your agent policy
to control whether a configuration is applied to the running Elastic Agent. You can
set a condition on inputs, streams, or even processors.</p>
<p>In this example, the input is applied if the host platform is Linux:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: logfile
    streams:
      - paths:
         - /var/log/syslog
    condition: ${host.platform} == 'linux'</pre>
</div>
<p>In this example, the stream is applied if the host platform is not Windows:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: system/metrics
    streams:
      - metricset: load
        data_stream.dataset: system.cpu
        condition: ${host.platform} != 'windows'</pre>
</div>
<p>In this example, the processor is applied if the host platform is not Windows:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: system/metrics
    streams:
      - metricset: load
        data_stream.dataset: system.cpu
    processors:
      - add_fields:
          fields:
            platform: ${host.platform}
          to: host
        condition: ${host.platform} != 'windows'</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="condition-syntax"></a>Condition syntax<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-conditions.asciidoc">edit</a></h4>
</div></div></div>
<p>The conditions supported by Elastic Agent are based on <a href="/guide/en/elasticsearch/reference/master/eql-syntax.html" class="ulink" target="_top">EQL</a>'s
boolean syntax, but add support for variables from providers and functions to
manipulate the values.</p>
<p><span class="strong strong"><strong>Supported operators:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Full PEMDAS math support for <code class="literal">+ - * / %</code>.
</li>
<li class="listitem">
Relational operators <code class="literal">&lt; &lt;= &gt;= &gt; == !=</code>
</li>
<li class="listitem">
Logical operators <code class="literal">and</code> and <code class="literal">or</code>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Functions:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Array functions <a class="xref" href="dynamic-input-configuration.html#arrayContains-function" title="arrayContains"><code class="literal">arrayContains</code></a>
</li>
<li class="listitem">
Dict functions <a class="xref" href="dynamic-input-configuration.html#hasKey-function" title="hasKey"><code class="literal">hasKey</code></a> (not in EQL)
</li>
<li class="listitem">
Length functions <a class="xref" href="dynamic-input-configuration.html#length-function" title="length"><code class="literal">length</code></a>
</li>
<li class="listitem">
Math functions <a class="xref" href="dynamic-input-configuration.html#add-function" title="add"><code class="literal">add</code></a>, <a class="xref" href="dynamic-input-configuration.html#subtract-function" title="subtract"><code class="literal">subtract</code></a>,
<a class="xref" href="dynamic-input-configuration.html#multiply-function" title="multiply"><code class="literal">multiply</code></a>, <a class="xref" href="dynamic-input-configuration.html#divide-function" title="divide"><code class="literal">divide</code></a>, <a class="xref" href="dynamic-input-configuration.html#modulo-function" title="modulo"><code class="literal">modulo</code></a>
</li>
<li class="listitem">
String functions <a class="xref" href="dynamic-input-configuration.html#concat-function" title="concat"><code class="literal">concat</code></a>, <a class="xref" href="dynamic-input-configuration.html#endsWith-function" title="endsWith"><code class="literal">endsWith</code></a>,
<a class="xref" href="dynamic-input-configuration.html#indexOf-function" title="indexOf"><code class="literal">indexOf</code></a>, <a class="xref" href="dynamic-input-configuration.html#match-function" title="match"><code class="literal">match</code></a>, <a class="xref" href="dynamic-input-configuration.html#number-function" title="number"><code class="literal">number</code></a>,
<a class="xref" href="dynamic-input-configuration.html#startsWith-function" title="startsWith"><code class="literal">startsWith</code></a>, <a class="xref" href="dynamic-input-configuration.html#string-function" title="string"><code class="literal">string</code></a>,
<a class="xref" href="dynamic-input-configuration.html#stringContains-function" title="stringContains"><code class="literal">stringContains</code></a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Types:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Booleans <code class="literal">true</code> and <code class="literal">false</code>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="condition-examples"></a>Condition examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-conditions.asciidoc">edit</a></h4>
</div></div></div>
<p>Run only when a specific label is included.</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">arrayContains(${docker.labels}, 'monitor')</pre>
</div>
<p>Skip on Linux platform or macOS.</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">${host.platform} != "linux" and ${host.platform} != "darwin"</pre>
</div>
<p>Run only for specific labels.</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">arrayContains(${docker.labels}, 'monitor') or arrayContains(${docker.label}, 'production')</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="condition-function-reference"></a>Function reference<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h3>
</div></div></div>
<p>The condition syntax supports the following functions.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="add-function"></a><code class="literal">add</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">add(Number, Number) Number</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">add(1, 2) == 3
add(5, ${foo}) &gt;= 5</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="arrayContains-function"></a><code class="literal">arrayContains</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">arrayContains(Array, String) Boolean</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">arrayContains(${docker.labels}, 'monitor')</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="concat-function"></a><code class="literal">concat</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">concat(String, String) String</code></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Parameters are coerced into strings before the concatenation.</p>
</div>
</div>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">concat("foo", "bar") == "foobar"
concat(${var1}, ${var2}) != "foobar"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="divide-function"></a><code class="literal">divide</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">divide(Number, Number) Number</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">divide(25, 5) &gt; 0
divide(${var1}, ${var2}) &gt; 7</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="endsWith-function"></a><code class="literal">endsWith</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">endsWith(String, String) Boolean</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">endsWith("hello world", "hello") == true
endsWith(${var1}, "hello") != true</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="hasKey-function"></a><code class="literal">hasKey</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">hasKey(Dictionary, String) Boolean</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">hasKey(${host}, "platform")</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="indexOf-function"></a><code class="literal">indexOf</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">indexOf(String, String, Number?) Number</code></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Returns -1 if the string is not found.</p>
</div>
</div>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">indexOf("hello", "llo") == 2
indexOf(${var1}, "hello") &gt;= 0</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="length-function"></a><code class="literal">length</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">length(Array|Dictionary|string)</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">length("foobar") &gt; 2
length(${docker.labels}) &gt; 0
length(${host}) &gt; 2</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="match-function"></a><code class="literal">match</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">match(String, Regexp) boolean</code></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">Regexp</code> supports Go&#8217;s regular expression syntax. Conditions that use
regular expressions are more expensive to run. If speed is critical, consider
using <code class="literal">endWiths</code> or <code class="literal">startsWith</code>.</p>
</div>
</div>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">match("hello world", "^hello") == true
match(${var1}, "world$") == true</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="modulo-function"></a><code class="literal">modulo</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">modulo(number, number) Number</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">modulo(25, 5) &gt; 0
modulo(${var1}, ${var2}) == 0</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="multiply-function"></a><code class="literal">multiply</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">multiply(Number, Number) Number</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">multiply(5, 5) == 25
multiple(${var1}, ${var2}) &gt; x</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="number-function"></a><code class="literal">number</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">number(String) Integer</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">number("42") == 42
number(${var1}) == 42</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="startsWith-function"></a><code class="literal">startsWith</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">startsWith(String, String) Boolean</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">startsWith("hello world", "hello") == true
startsWith(${var1}, "hello") != true</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="string-function"></a><code class="literal">string</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">string(Number) String</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">string(42) == "42"
string(${var1}) == "42"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="stringContains-function"></a><code class="literal">stringContains</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">stringContains(String, String) Boolean</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">stringContains("hello world", "hello") == true
stringContains(${var1}, "hello") != true</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="subtract-function"></a><code class="literal">subtract</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-functions.asciidoc">edit</a></h4>
</div></div></div>
<p><code class="literal">subtract(Number, Number) Number</code></p>
<p>Usage:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">subtract(5, 1) == 4
subtract(${foo}, 2) != 2</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="debug-configs"></a>Debugging<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-debug-input-configs.asciidoc">edit</a></h3>
</div></div></div>
<p>To debug configurations that include variable substitution and conditions, use
the <code class="literal">inspect</code> command. This command shows the configuration that&#8217;s generated
after variables are replaced and conditions are applied.</p>
<p>First run the Elastic Agent. For this example, we&#8217;ll use the following agent policy:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">outputs:
  default:
    type: elasticsearch
    hosts: [127.0.0.1:9200]
    username: elastic
    password: changeme

providers:
  local_dynamic:
    items:
      - vars:
          key: value1
        processors:
          - add_fields:
              fields:
                custom: match1
              target: dynamic
      - vars:
          key: value2
        processors:
          - add_fields:
              fields:
                custom: match2
              target: dynamic
      - vars:
          key: value3
        processors:
          - add_fields:
              fields:
                custom: match3
              target: dynamic

inputs:
  - type: logfile
    enabled: true
    streams:
      - paths:
          - /var/log/{{local_dynamic.key}}</pre>
</div>
<p>Then run <code class="literal">elastic-agent inspect</code> to see the generated configuration. For
example:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">$ ./elastic-agent inspect output -o default
[default] filebeat:
filebeat:
  inputs:
  - index: logs-generic-default
    paths:
    - /var/log/value1
    processors:
    - add_fields:
        fields:
          custom: match1
        target: dynamic
    - add_fields:
        fields:
          dataset: generic
          namespace: default
          type: logs
        target: data_stream
    - add_fields:
        fields:
          dataset: generic
        target: event
    type: log
  - index: logs-generic-default
    paths:
    - /var/log/value2
    processors:
    - add_fields:
        fields:
          custom: match2
        target: dynamic
    - add_fields:
        fields:
          dataset: generic
          namespace: default
          type: logs
        target: data_stream
    - add_fields:
        fields:
          dataset: generic
        target: event
    type: log
  - index: logs-generic-default
    paths:
    - /var/log/value3
    processors:
    - add_fields:
        fields:
          custom: match3
        target: dynamic
    - add_fields:
        fields:
          dataset: generic
          namespace: default
          type: logs
        target: data_stream
    - add_fields:
        fields:
          dataset: generic
        target: event
    type: log
output:
  elasticsearch:
    hosts:
    - 127.0.0.1:9200
    password: changeme
    username: elastic

---
[default] FLEET_MONITORING:
output:
  elasticsearch:
    hosts:
    - 127.0.0.1:9200
    password: changeme
    type: elasticsearch
    username: elastic
programs:
- filebeat

---</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="capabilities"></a>Capabilities<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-capabilities.asciidoc">edit</a></h3>
</div></div></div>
<p>Capabilities are a set of rules that can define the behavior of Elastic Agent on specific machines.
When capabilities are specified, the input configuration is overridden, and any details that are not used are subject to the capabilities' definition.
When Elastic Agent starts, it locates the <code class="literal">capabilities.yml</code> file next to its configuration file. Please note, Elastic Agent will not reload the definition after it starts.</p>
<p>This example definition configuration enables the system/metrics input and denies every other input. Rules are applied in the order they are defined, with the first matching rule being applied. The * wildcard is also supported.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: 0.0.1
capabilities:
- rule: allow
  input: system/metrics
- rule: deny
  input: "*"</pre>
</div>
<p>Let&#8217;s use the following configuration and the capabilities defined above.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
	- type: logfile
	  streams:
	  	- paths: []{a.error,b.access}
	- type: system/logs
	  streams:
	  	- paths: []{a,b}
	- type: system/metrics
	  streams:
	  	- metricset: cpu
	  	- metricset: memory</pre>
</div>
<p>The resulting configuration is this.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
	- type: system/metrics
	  streams:
	  	- metricset: cpu
	  	- metricset: memory</pre>
</div>
<p>In this example, the stream is applied if the host platform is not Windows:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: system/metrics
    streams:
      - metricset: load
        data_stream.dataset: system.cpu
        condition: ${host.platform} != 'windows'</pre>
</div>
<p>In this example, the processor is applied if the host platform is not Windows:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: system/metrics
    streams:
      - metricset: load
        data_stream.dataset: system.cpu
    processors:
      - add_fields:
          fields:
            platform: ${host.platform}
          to: host
        condition: ${host.platform} != 'windows'</pre>
</div>
<div class="supported-capabilities">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_supported_capabilities"></a>Supported capabilities<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-capabilities.asciidoc">edit</a></h4>
</div></div></div>
<p>You can use capabilities to modify the congestion of outputs, inputs or upgrade the capability of Elastic Agent.</p>
<div class="capabilities-inputs">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_inputs"></a>Inputs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-capabilities.asciidoc">edit</a></h5>
</div></div></div>
<p>For inputs, you can the <code class="literal">input</code> key containing an expression.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: 0.0.1
capabilities:
- rule: allow
  input: system/*</pre>
</div>
</div>

<div class="capabilities-outputs">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_outputs"></a>Outputs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-capabilities.asciidoc">edit</a></h5>
</div></div></div>
<p>For outputs, you can use the <code class="literal">output</code> key containing an expression.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: 0.0.1
capabilities:
- rule: deny
  output: kafka</pre>
</div>
</div>

<div class="capabilities-upgrade">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_upgrade"></a>Upgrade<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-capabilities.asciidoc">edit</a></h5>
</div></div></div>
<p>For an upgrade, you can use the <code class="literal">output</code> key containing an expression that allows a specific upgrade to version <code class="literal">8.0.0</code>. <code class="literal">${version}</code> is the target version.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: 0.0.1
capabilities:
- rule: allow
  upgrade: "${version} == '8.0.0'"</pre>
</div>
<p>With a versioned EQL, conditions can be used, as well as a * wildcard. This allows upgrades just for bug fixes.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: 0.0.1
capabilities:
- rule: allow
  upgrade: "${version} == '8.0.*'"</pre>
</div>
<p><span class="strong strong"><strong>Upgrade capability definition</strong></span></p>
<p>This upgrade definition allows upgrades just for minor version changes.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: 0.0.1
capabilities:
- rule: allow
  upgrade: "${version} == '8.*.*'"</pre>
</div>
<p>Part of the upgrade action is also a <code class="literal">source_uri</code> address that specifies the repository from where artifacts should be
downloaded.</p>
<p>To restrict to HTTPS, you can use the following.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: 0.0.1
capabilities:
- rule: allow
  upgrade: "startsWith(${source_uri}, 'https')"</pre>
</div>
<p>Upgrade capability is blocking. This means that if an action does not meet the first upgrade definition, we’re not proceeding with the evaluation.</p>
</div>

</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="elastic-agent-configuration.html">« Policy settings</a>
</span>
<span class="next">
<a href="agent-redirects.html">Appendix A: Deleted pages »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
