<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Role-based access control | Kibana Guide [6.8] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [6.8]"/>
<link rel="up" href="development-security.html" title="Security"/>
<link rel="prev" href="development-security.html" title="Security"/>
<link rel="next" href="pr-review.html" title="Pull request review guidelines"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/6.8"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="6.8"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
<p>
  <strong>NOTE</strong>: You are looking at documentation for an older release. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [6.8]</a></span>
»
<span class="breadcrumb-link"><a href="development.html">Developer guide</a></span>
»
<span class="breadcrumb-link"><a href="development-security.html">Security</a></span>
»
<span class="breadcrumb-node">Role-based access control</span>
</div>
<div class="navheader">
<span class="prev">
<a href="development-security.html">« Security</a>
</span>
<span class="next">
<a href="pr-review.html">Pull request review guidelines »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="development-security-rbac"></a>Role-based access control<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/6.8/docs/developer/security/rbac.asciidoc">edit</a></h2>
</div></div></div>
<p>Role-based access control (RBAC) in Kibana relies upon the
<a href="/guide/en/elasticsearch/reference/6.8/security-privileges.html#application-privileges" class="ulink" target="_top">application privileges</a>
that Elasticsearch exposes. This allows Kibana to define the privileges that
Kibana wishes to grant to users, assign them to the relevant users using roles,
and then authorize the user to perform a specific action. This is handled within
a secured instance of the <code class="literal">SavedObjectsClient</code> and available transparently to
consumers when using <code class="literal">request.getSavedObjectsClient()</code> or
<code class="literal">savedObjects.getScopedSavedObjectsClient()</code>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="development-rbac-privileges"></a>Kibana Privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/6.8/docs/developer/security/rbac.asciidoc">edit</a></h3>
</div></div></div>
<p>When Kibana first starts up, it executes the following <code class="literal">POST</code> request against Elasticsearch. This synchronizes the definition of the privileges with various <code class="literal">actions</code> which are later used to authorize a user:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">POST /_xpack/security/privilege
Content-Type: application/json
Authorization: Basic kibana changeme

{
   "kibana-.kibana":{
       "all":{
           "application":"kibana-.kibana",
           "name":"all",
           "actions":[
               "version:7.0.0-alpha1-SNAPSHOT",
               "action:login",
               "action:*"
           ],
           "metadata":{}
       },
       "read":{
           "application":"kibana-.kibana",
           "name":"read",
           "actions":[
               "version:7.0.0-alpha1-SNAPSHOT",
               "action:login",
               "action:saved_objects/dashboard/get",
               "action:saved_objects/dashboard/bulk_get",
               "action:saved_objects/dashboard/find",
               ...
           ],"metadata":{}}
   }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The application is created by concatenating the prefix of <code class="literal">kibana-</code> with the value of <code class="literal">kibana.index</code> from the <code class="literal">kibana.yml</code>, so different Kibana tenants are isolated from one another.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="development-rbac-assigning-privileges"></a>Assigning Kibana Privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/6.8/docs/developer/security/rbac.asciidoc">edit</a></h3>
</div></div></div>
<p>Kibana privileges are assigned to specific roles using the <code class="literal">applications</code> element. For example, the following role assigns the <a class="xref" href="kibana-privileges.html#kibana-privileges-all">all</a> privilege at <code class="literal">*</code> <code class="literal">resources</code> (which will in the future be used to secure spaces) to the default Kibana <code class="literal">application</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"new_kibana_user": {
   "applications": [
     {
       "application": "kibana-.kibana",
       "privileges": [
         "all"
       ],
       "resources": [
         "*"
       ]
     }
   ]
 }</pre>
</div>
<p>Roles that grant <a class="xref" href="kibana-privileges.html" title="Kibana privileges">Kibana privileges</a> should be managed using the <a class="xref" href="role-management-api.html" title="Kibana Role Management API"><em>Kibana Role Management API</em></a> or the <span class="strong strong"><strong>Management</strong></span> / <span class="strong strong"><strong>Security</strong></span> / <span class="strong strong"><strong>Roles</strong></span> page, not directly using the Elasticsearch <a href="/guide/en/elasticsearch/reference/6.8/security-api.html#security-role-apis" class="ulink" target="_top">role management API</a>. This role can then be assigned to users using the Elasticsearch
<a href="/guide/en/elasticsearch/reference/6.8/security-api.html#security-user-apis" class="ulink" target="_top">user management APIs</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="development-rbac-authorization"></a>Authorization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/6.8/docs/developer/security/rbac.asciidoc">edit</a></h3>
</div></div></div>
<p>The Elasticsearch <a href="/guide/en/elasticsearch/reference/6.8/security-api-has-privileges.html" class="ulink" target="_top">has privileges API</a> determines whether the user is authorized to perform a specific action:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">POST /_xpack/security/user/_has_privileges
Content-Type: application/json
Authorization: Basic foo_read_only_user password

{
   "applications":[
       {
           "application":"kibana-.kibana",
           "resources":["*"],
           "privileges":[
             "action:saved_objects/dashboard/save",
           ]
       }
   ]
}</pre>
</div>
<p>Elasticsearch checks if the user is granted a specific action. If the user is assigned a role that grants a privilege, Elasticsearch uses the <a class="xref" href="development-security-rbac.html#development-rbac-privileges" title="Kibana Privileges">Kibana privileges</a> definition to associate this with the actions, which makes authorizing users more intuitive and flexible programatically.</p>
<p>Once we have authorized the user to perform a specific action, we can execute the request using <code class="literal">callWithInternalUser</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="development-rbac-legacy-fallback"></a>Legacy Fallback<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/6.8/docs/developer/security/rbac.asciidoc">edit</a></h3>
</div></div></div>
<p>Users have existing roles that rely on index privileges to the <code class="literal">.kibana</code> index. The legacy fallback uses the <code class="literal">callWithRequest</code> method when the user doesn&#8217;t have any application privileges. This relies on the user having index privileges on <code class="literal">.kibana</code>. The legacy fallback will be available until 7.0.</p>
<p>Within the secured instance of the <code class="literal">SavedObjectsClient</code> the <code class="literal">_has_privileges</code> check determines if the user has any index privileges on the <code class="literal">.kibana</code> index:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">POST /_xpack/security/user/_has_privileges
Content-Type: application/json
Authorization: Basic foo_legacy_user password

{
   "applications":[
       {
           "application":"kibana-.kibana",
           "resources":["*"],
           "privileges":[
             "action:saved_objects/dashboard/save"
           ]
       }
   ],
   "index": [
       {
           "names": ".kibana",
           "privileges": ["create", "delete", "read", "view_index_metadata"]
       }
   ]
}</pre>
</div>
<p>Here is an example response if the user does not have application privileges, but does have privileges on the <code class="literal">.kibana</code> index:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "username": "foo_legacy_user",
  "has_all_requested": false,
  "cluster": {},
  "index": {
    ".kibana": {
      "read": true,
      "view_index_metadata": true,
      "create": true,
      "delete": true
    }
  },
  "application": {
    "kibana-.kibana": {
      "*": {
        "action:saved_objects/dashboard/save": false
      }
    }
  }
}</pre>
</div>
<p>Kibana automatically detects that the request could be executed against <code class="literal">.kibana</code> using <code class="literal">callWithRequest</code> and does so.</p>
<p>When the user first logs into Kibana, if they have no application privileges and will have to rely on the legacy fallback, Kibana logs a deprecation warning similar to the following:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">${username} relies on index privileges on the {kib} index. This is deprecated and will be removed in {kib} 7.0</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="development-rbac-reserved-roles"></a>Reserved roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/6.8/docs/developer/security/rbac.asciidoc">edit</a></h3>
</div></div></div>
<p>Ideally, the <code class="literal">kibana_user</code> and <code class="literal">kibana_dashboard_only_user</code> roles should only use application privileges, and no longer have index privileges on the <code class="literal">.kibana</code> index. However, making this switch forces the user to incur downtime if Elasticsearch is upgraded to &gt;= 6.4, and Kibana is running &lt; 6.4. To mitigate this downtime, for the 6.x releases the <code class="literal">kibana_user</code> and <code class="literal">kibana_dashbord_only_user</code> roles have both application privileges and index privileges. When Kibana is running &gt;= 6.4 it uses the application privileges to authorize the user, but when Kibana is running &lt; 6.4 Kibana relies on the direct index privileges.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="development-security.html">« Security</a>
</span>
<span class="next">
<a href="pr-review.html">Pull request review guidelines »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
