<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Breaking changes in 7.7 | Kibana Guide [7.7] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [7.7]"/>
<link rel="up" href="breaking-changes.html" title="Breaking Changes"/>
<link rel="prev" href="breaking-changes.html" title="Breaking Changes"/>
<link rel="next" href="breaking-changes-7.6.html" title="Breaking changes in 7.6"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/7.7"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="7.7"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [7.7]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="breaking-changes.html">Breaking Changes</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="breaking-changes.html">« Breaking Changes</a>
</span>
<span class="next">
<a href="breaking-changes-7.6.html">Breaking changes in 7.6 »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="breaking-changes-7.7"></a>Breaking changes in 7.7<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h2>
</div></div></div>

<p>This page discusses the breaking changes that you need to be aware of when migrating
your application to Kibana 7.7.</p>
<h3><a id="_breaking_changes_for_users"></a>Breaking changes for users<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h3>
<p>There are no user-facing breaking changes in 7.7.</p>
<h3><a id="_breaking_changes_for_plugin_developers"></a>Breaking changes for plugin developers<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h3>
<h4><a id="_add_addinfo_toast_to_core_notifications_service"></a>Add addInfo toast to core notifications service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>This Info toast will be used for the async search notifications.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/60574" class="ulink" target="_top">#60574</a></strong></span></p>
<h4><a id="_goodbye_legacy_data_plugin"></a>Goodbye, legacy data plugin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>The legacy <code class="literal">data</code> plugin located in <code class="literal">src/legacy/core_plugins/data</code> has been removed. This change only affects legacy platform plugins which are either:
1. Importing the <code class="literal">public/setup</code> or <code class="literal">public/legacy</code> "shim" files from the legacy data plugin to access runtime contracts; or
2. importing static code from inside <code class="literal">src/legacy/core_plugins/data</code>; or
3. explicitly using <code class="literal">require: ['data']</code> in the plugin definition.</p>
<p>For scenario 1 above, you should migrate your plugin to access the services you need from the new platform <code class="literal">data</code> plugin. These are accessible in the legacy world by using <code class="literal">ui/new_platform</code>:</p>
<div class="pre_wrapper lang-diff">
<pre class="programlisting prettyprint lang-diff">- import { start as dataStart } from 'src/legacy/core_plugins/data/public/legacy';
+ import { npStart } from 'ui/new_platform';
+ const dataStart = npStart.plugins.data;</pre>
</div>
<p>For scenario 2, the equivalent static code you&#8217;ve been importing should now be available from <code class="literal">src/plugins/data</code>, in the <code class="literal">server</code> or <code class="literal">public</code> directories:</p>
<div class="pre_wrapper lang-diff">
<pre class="programlisting prettyprint lang-diff">- import { someStaticUtilOrType } from 'src/legacy/core_plugins/data/public';
+ import { someStaticUtilOrType } from 'src/plugins/data/public';</pre>
</div>
<p>For scenario 3, you should be able to safely drop the reference to the plugin, and add <code class="literal">data</code> to your list of dependencies in <code class="literal">kibana.json</code> whenever your plugin migrates to the new Kibana platform:</p>
<div class="pre_wrapper lang-diff">
<pre class="programlisting prettyprint lang-diff">// index.ts
const myPluginInitializer: LegacyPluginInitializer = ({ Plugin }: LegacyPluginApi) =&gt;
  new Plugin({
    id: 'my_plugin',
-    require: ['kibana', 'elasticsearch', 'visualizations', 'data'],
+    require: ['kibana', 'elasticsearch', 'visualizations'],
    ...,
  })
);</pre>
</div>
<p>For more information on where to locate new platform <code class="literal">data</code> services,
please refer to the table of
<a href="https://github.com/elastic/kibana/blob/master/src/core/MIGRATION.md#plugins-for-shared-application-services" class="ulink" target="_top">plugins for shared application services</a>
in <code class="literal">src/core/MIGRATION.md</code>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/60449" class="ulink" target="_top">#60449</a></strong></span></p>
<h4><a id="_delete_filterstatemanager_and_queryfilter"></a>Delete FilterStateManager and QueryFilter<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Delete unused legacy exports <code class="literal">FilterStateManager</code>, <code class="literal">QueryFilter</code>, and <code class="literal">SavedQuery</code>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/59872" class="ulink" target="_top">#59872</a></strong></span></p>
<h4><a id="_add_uisettings_validation_kibana_default_route_redirection"></a>Add UiSettings validation &amp; Kibana default route redirection<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>UiSettings definition allows to specify validation functions:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">import { schema } from '@kbn/config-schema';

uiSettings.register({
   myUiSetting: {
      name: ...
      value: 'value',
      schema: schema.string()
  }
})</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/59694" class="ulink" target="_top">#59694</a></strong></span></p>
<h4><a id="_allow_disabling_xsrf_protection_per_an_endpoint"></a>Allow disabling xsrf protection per an endpoint<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Route configuration allows to disable xsrf protection for destructive HTTP methods:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">routet.get({ path: ..., validate: ..., options: { xsrfRequired: false } })</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/58717" class="ulink" target="_top">#58717</a></strong></span></p>
<h4><a id="_add_core_metrics_service"></a>Add core metrics service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>A new <code class="literal">metrics</code> API is available from core, which allows retrieving various
metrics regarding the HTTP server, process, and OS load/usages.</p>
<div class="pre_wrapper lang-typescript">
<pre class="programlisting prettyprint lang-typescript">core.metrics.getOpsMetrics$().subscribe(metrics =&gt; {
  // do something with the metrics
})</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/58623" class="ulink" target="_top">#58623</a></strong></span></p>
<h4><a id="_add_an_optional_authentication_mode_for_http_resources"></a>Add an optional authentication mode for HTTP resources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>A route config accepts <code class="literal">authRequired: 'optional'</code>. A user can access a resource if has valid credentials or no credentials at all. Can be useful when we grant access to a resource but want to identify a user if possible.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">router.get( { path: '/',  options: { authRequired: 'optional' } }, handler);</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/58589" class="ulink" target="_top">#58589</a></strong></span></p>
<h4><a id="_migrate_doc_view_part_of_discover"></a>Migrate doc view part of discover<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>The extension point for registering custom doc views was migrateed and can be used directly within the new platform.</p>
<p>A working example of the new integration can be seen in <code class="literal">test/plugin_functional/plugins/doc_views_plugin/public/plugin.tsx</code>.</p>
<p>To register doc views, list <code class="literal">discover</code> as a required dependency of your plugin and use the <code class="literal">docViews.addDocView</code> method exposed in the setup contract:</p>
<div class="pre_wrapper lang-tsx">
<pre class="programlisting prettyprint lang-tsx">export class MyPlugin implements Plugin&lt;void, void&gt; {
  public setup(core: CoreSetup, { discover }: { discover: DiscoverSetup }) {
    discover.docViews.addDocView({
      component: props =&gt; {
        return /* ... */;
      },
      order: 2,
      title: 'My custom doc view',
    });
  }

  /* ... */
}</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/58094" class="ulink" target="_top">#58094</a></strong></span></p>
<h4><a id="_telemetry_server_backpressure_mechanism"></a>[Telemetry] Server backpressure mechanism<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Add a backpressure mechanism for sending telemetry on the server.
Usage data will always be sent from the browser even if we are also sending
it from the server. Server side Telemetry usage data sender will send an <code class="literal">OPTIONS</code>
request before `POST`ing the data to our cluster to ensure the endpoint is reachable.</p>
<p><span class="strong strong"><strong>Fallback mechanism</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Always send usage from browser regardless of the <code class="literal">telemetry.sendUsageFrom</code> kibana config.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Server usage backpressure</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Send usage from server in addition to browser if <code class="literal">telemetry.sendUsageFrom</code> is set to <code class="literal">server</code>.
</li>
<li class="listitem">
Initial server usage attempt is after 5 minutes from starting kibana. Attempt to send every 12 hours afterwards.
</li>
<li class="listitem">
Stop attempting to send usage from the server if the attempts fail three times (initial attempt 5 minutes from server start, and two consecutive 12 hours attempts).
</li>
<li class="listitem">
Restart attempt count after each kibana version upgrade (patch/minor/major).
</li>
<li class="listitem">
Restart attempt count if it succeeds in any of the 3 tries.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Sending usage mechanism from server:</strong></span></p>
<p>Send <code class="literal">OPTIONS</code> request before attempting to send telemetry from server. <code class="literal">OPTIONS</code> is less intrusive as it does not contain any payload and is used to check if the endpoint is reachable. We can also use it in the future to check for allowed headers to use etc.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If <code class="literal">OPTIONS</code> request succeed; send usage via <code class="literal">POST</code>.
</li>
<li class="listitem">
If <code class="literal">OPTIONS</code> request fails; dont send usage and follow the retry logic above.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/57556" class="ulink" target="_top">#57556</a></strong></span></p>
<h4><a id="_expressions_server_side"></a>Expressions server-side<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>It is now possible to register expression functions and types on the Kibana server and execute expressions on the server. The API is the same as in the browser-side plugin, e.g:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">plugins.expressions.registerFunction(/* ... */);
const result = await plugins.expressions.run('var_set name="foo" value="bar" | var name="foo"', null);</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/57537" class="ulink" target="_top">#57537</a></strong></span></p>
<h4><a id="_local_actions"></a>Local actions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p><code class="literal">actionIds</code> property has been removed from`Trigger` interface in <code class="literal">ui_actions</code> plugin. Use <code class="literal">attachAction()</code> method instead, for example:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">plugins.uiActions.attachAction(triggerId, actionId);</pre>
</div>
<p>Instead of previously:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">const trigger = {
  id: triggerId,
  actionIds: [actionId],
};</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/57451" class="ulink" target="_top">#57451</a></strong></span></p>
<h4><a id="_use_log4j_pattern_syntax"></a>Use log4j pattern syntax<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Logging output of the New platform plugins can use adjusted
via <a href="https://github.com/elastic/kibana/blob/master/src/core/server/logging/README.md" class="ulink" target="_top">new config</a>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/57433" class="ulink" target="_top">#57433</a></strong></span></p>
<h4><a id="_allow_savedobjects_types_registration_from_np"></a>Allow savedObjects types registration from NP<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>A new <code class="literal">registerType</code> API has been added to the core savedObjects <code class="literal">setup</code> API,
allowing to register savedObject types from new platform plugins</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">// src/plugins/my_plugin/server/saved_objects/types.ts
import { SavedObjectsType } from 'src/core/server';
import * as migrations from './migrations';

export const myType: SavedObjectsType = {
  name: 'MyType',
  hidden: false,
  namespaceAgnostic: true,
  mappings: {
    properties: {
      textField: {
        type: 'text',
      },
      boolField: {
        type: 'boolean',
      },
    },
  },
  migrations: {
    '2.0.0': migrations.migrateToV2,
    '2.1.0': migrations.migrateToV2_1
  },
};

// src/plugins/my_plugin/server/plugin.ts
import { SavedObjectsClient, CoreSetup } from 'src/core/server';
import { myType } from './saved_objects';

export class Plugin() {
  setup: (core: CoreSetup) =&gt; {
    core.savedObjects.registerType(myType);
  }
}</pre>
</div>
<p>Please check the migration guide for more complete examples and migration procedure.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/57430" class="ulink" target="_top">#57430</a></strong></span></p>
<h4><a id="_expose_vis_on_the_contract_as_it_requires_vistypes"></a>Expose Vis on the contract as it requires visTypes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>In most of the places <code class="literal">Vis</code> used as a type, but in couple places it is used as a class.
At the moment <code class="literal">Vis</code> as a class is not stateless, as it depends on <code class="literal">visTypes</code>. As it is not stateless, <code class="literal">Vis</code> class was removed from public exports and exposed on <code class="literal">visualisations</code> contract instead:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">new visualizationsStart.Vis(....);</pre>
</div>
<p><code class="literal">Vis</code> as interface still can be imported as:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">import { Vis } from '../../../../../core_plugins/visualizations/public';</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56968" class="ulink" target="_top">#56968</a></strong></span></p>
<h4><a id="_add_scopedhistory_to_appmountparams"></a>Add ScopedHistory to AppMountParams<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Kibana Platform applications should use the provided <code class="literal">history</code> instance to integrate routing rather than setting up their own using <code class="literal">appBasePath</code> (which is now deprecated).</p>
<p><span class="strong strong"><strong>Before</strong></span></p>
<div class="pre_wrapper lang-tsx">
<pre class="programlisting prettyprint lang-tsx">core.application.register({
  id: 'myApp',
  mount({ appBasePath, element }) {
    ReactDOM.render(
      &lt;BrowserRouter basename={appBasePath}&gt;
        &lt;App /&gt;
      &lt;/BrowserRouter&gt;,
      element
    );
    return () =&gt; ReactDOM.unmountComponentAtNode(element);
  }
});</pre>
</div>
<p><span class="strong strong"><strong>After</strong></span></p>
<div class="pre_wrapper lang-tsx">
<pre class="programlisting prettyprint lang-tsx">core.application.register({
  id: 'myApp',
  mount({ element, history }) {
    ReactDOM.render(
      &lt;BrowserRouter history={history}&gt;
        &lt;App /&gt;
      &lt;/BrowserRouter&gt;,
      element
    );
    return () =&gt; ReactDOM.unmountComponentAtNode(element);
  }
});</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56705" class="ulink" target="_top">#56705</a></strong></span></p>
<h4><a id="_move_new_vis_modal_to_visualizations_plugin"></a>Move new_vis_modal to visualizations plugin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p><span class="strong strong"><strong>Before</strong></span></p>
<p>NewVisModal component and showNewVisModal function were statically exported and received all the dependencies as props/parameters.</p>
<p><span class="strong strong"><strong>After</strong></span></p>
<p><code class="literal">showNewVisModal()</code> is part of the plugin contract and plugin dependencies are provided implicitly.</p>
<div class="pre_wrapper lang-tsx">
<pre class="programlisting prettyprint lang-tsx">npStart.plugins.visualizations.showNewVisModal();</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56654" class="ulink" target="_top">#56654</a></strong></span></p>
<h4><a id="_uicomponent"></a>UiComponent<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p><code class="literal">UiComponent</code> interface was added to <code class="literal">kibana_utils</code> plugin. <code class="literal">UiComponent</code> represents a user interface building block, like a React component, but <code class="literal">UiComponent</code> does not have to be implemented in React&mdash;it can be implemented in plain JS or React, or Angular, etc.</p>
<p>In many places in Kibana we want to be agnostic to frontend view library, i.e. instead of exposing React-specific APIs we want to expose APIs that are orthogonal to any rendering library. <code class="literal">UiComponent</code> interface represents such UI components. UI component receives a DOM element and <code class="literal">props</code> through <code class="literal">render()</code> method, the <code class="literal">render()</code> method can be called many times.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">export type UiComponent&lt;Props extends object = object&gt; = () =&gt; {
  render(el: HTMLElement, props: Props): void;
  unmount?(): void;
};</pre>
</div>
<p>Although Kibana aims to be library agnostic, Kibana itself is written in React,
therefore <code class="literal">UiComponent</code> is designed such that it maps directly to a
functional React component: <code class="literal">UiCompnent</code> interface corresponds
to <code class="literal">React.ComponentType</code> type and <code class="literal">UiCompnent</code> props map to React component props.</p>
<p>To help use <code class="literal">UiComponent</code> interface in the codebase <code class="literal">uiToReactComponent</code> and
<code class="literal">reactToUiComponent</code> helper functions were added to <code class="literal">kibana_react</code> plugin,
they transform a <code class="literal">UiComponent</code> into a React component and vice versa, respectively.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">const uiToReactComponent: (comp: UiComponent) =&gt; React.ComponentType;
const reactToUiComponent: (comp: React.ComponentType) =&gt; UiComponent;</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56555" class="ulink" target="_top">#56555</a></strong></span></p>
<h4><a id="_start_consuming_np_logging_config"></a>Start consuming np logging config<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Provides experimental support of new logging format for <span class="strong strong"><strong>new platform plugins</strong></span>.
More about <a href="https://github.com/elastic/kibana/blob/master/src/core/server/logging/README.md" class="ulink" target="_top">the logging format</a>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56480" class="ulink" target="_top">#56480</a></strong></span></p>
<h4><a id="_state_management_state_syncing_utils_docs"></a>[State Management] State syncing utils docs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Refer to <a href="https://github.com/elastic/kibana/tree/master/src/plugins/kibana_utils/docs/state_sync" class="ulink" target="_top">these docs</a>
on state syncing utils.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56479" class="ulink" target="_top">#56479</a></strong></span></p>
<h4><a id="_np_move_saved_object_modal_into_new_platform"></a>[NP] Move saved object modal into new platform<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p><code class="literal">SavedObjectSaveModal</code>, <code class="literal">showSaveModal</code> and <code class="literal">SaveResult</code> from <em>`ui/saved_objects`</em>,
and <code class="literal">SavedObjectFinderUi</code>, <code class="literal">SavedObjectMetaData</code> and <code class="literal">OnSaveProps</code>
from <em>`src/plugins/kibana_react/public`</em> were moved to a new plugin <span class="strong strong"><strong><code class="literal">src/plugins/saved_objects</code></strong></span>.</p>
<p>Also now <code class="literal">showSaveModal</code> requires the second argument  - <code class="literal">I18nContext</code>:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">import { showSaveModal } from 'src/plugins/saved_objects/public';
...

showSaveModal(saveModal, npStart.core.i18n.Context);</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56383" class="ulink" target="_top">#56383</a></strong></span></p>
<h4><a id="_state_management_state_syncing_helpers_for_query_service"></a>[State Management] State syncing helpers for query service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Query service of data plugin now has state$ observable which allows to
watch for query service data changes:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">interface QueryState {
  time?: TimeRange;
  refreshInterval?: RefreshInterval;
  filters?: Filter[];
}

interface QueryStateChange {
  time?: boolean; // time range has changed
  refreshInterval?: boolean; // refresh interval has changed
  filters?: boolean; // any filter has changed
  appFilters?: boolean; // specifies if app filters change
  globalFilters?: boolean; // specifies if global filters change
}

state$: Observable&lt;{ changes: QueryStateChange; state: QueryState }&gt;;</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56128" class="ulink" target="_top">#56128</a></strong></span></p>
<h4><a id="_migrate_saved_object_save_as_checkbox_directive_to_timelion"></a>Migrate saved_object_save_as_checkbox directive to Timelion<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Use our React component <code class="literal">SavedObjectSaveModal</code> with <code class="literal">showCopyOnSave={true}</code>
instead of the react directive. Note that <code class="literal">SavedObjectSaveModal</code>
soon will be part of a new plugin, so the path will change.</p>
<div class="pre_wrapper lang-TypeScript">
<pre class="programlisting prettyprint lang-TypeScript">import { SavedObjectSaveModal } from 'ui/saved_objects/components/saved_object_save_modal';
&lt;SavedObjectSaveModal
  onSave={onSave}
  onClose={() =&gt; {}}
  title={'A title'}
  showCopyOnSave={true}
  objectType={'The type of you saved object'}
 /&gt;</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56114" class="ulink" target="_top">#56114</a></strong></span></p>
<h4><a id="_uipublic_cleanup"></a><code class="literal">ui/public</code> cleanup<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p><span class="strong strong"><strong>Removed / moved modules</strong></span></p>
<p>In preparation for Kibana&#8217;s upcoming <a href="https://github.com/elastic/kibana/issues/9675" class="ulink" target="_top">new platform</a>,
we are in the process of <a href="https://github.com/elastic/kibana/issues/26505" class="ulink" target="_top">migrating away</a>
from the <code class="literal">ui/public</code> directory. Over time, the contents of this directory will
be either deprecated or housed inside a parent plugin. If your plugin imports
the listed items from the following <code class="literal">ui/public</code> modules, you will need to
either update your import statements as indicated below, so that you are
pulling these modules from their new locations, or copy the relevant code directly into your plugin.</p>
<p><span class="strong strong"><strong><code class="literal">ui/agg_types</code></strong></span> <a href="https://github.com/elastic/kibana/pull/59605" class="ulink" target="_top">#59605</a></p>
<p>The <code class="literal">ui/agg_types</code> module has been removed in favor of the service provided by
the <code class="literal">data</code> plugin in the new Kibana platform.</p>
<p>Additionally, <code class="literal">aggTypes</code> and <code class="literal">AggConfigs</code> have been removed in favor of a
<code class="literal">types</code> registry and a <code class="literal">createAggConfigs</code> function:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">// old
import { AggConfigs, aggTypes } from 'ui/agg_types';
const aggs = new AggConfigs(indexPattern, configStates, schemas);
aggTypes.metrics[0]; // countMetricAgg

// new
class MyPlugin {
  start(core, { data }) {
    data.search.aggs.createAggConfigs(indexPattern, configStates, schemas);
    data.search.aggs.types.get('count'); // countMetricAgg
  }
}

// new - static code
import { search } from 'src/plugins/data/public';
const { isValidInterval } = search.aggs;

// new - types
import { BUCKET_TYPES, METRIC_TYPES } from 'src/plugins/data/public';</pre>
</div>
<p>The above examples are not comprehensive, but represent some of the more
common uses of <code class="literal">agg_types</code>. For more details, please refer to the interfaces
in <a href="https://github.com/elastic/kibana/blob/master/src/plugins/data/public/types.ts#L50" class="ulink" target="_top">the source code</a>,
as well as the data plugin&#8217;s <a href="https://github.com/elastic/kibana/blob/master/src/plugins/data/public/index.ts#L282" class="ulink" target="_top"><code class="literal">public/index</code> file</a>.</p>
<p><span class="strong strong"><strong><code class="literal">ui/time_buckets</code></strong></span> <a href="https://github.com/elastic/kibana/pull/58805" class="ulink" target="_top">#58805</a></p>
<p>The <code class="literal">ui/time_buckets</code> module has been removed and is now internal to the <code class="literal">data</code> plugin&#8217;s
search &amp; aggregations infrastructure. We are working on an improved set of helper utilities
to eventually replace the need for the <code class="literal">TimeBuckets</code> class.</p>
<p>In the meantime, if you currently rely on <code class="literal">TimeBuckets</code>, please copy the relevant pieces into your plugin code.</p>
<p><span class="strong strong"><strong><code class="literal">ui/filter_manager</code></strong></span> <a href="https://github.com/elastic/kibana/pull/59872" class="ulink" target="_top">#59872</a></p>
<p>The <code class="literal">ui/filter_manager</code> module has been removed and now services and UI components
are available on the <code class="literal">data</code> plugin&#8217;s query infrastructure.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55926" class="ulink" target="_top">#55926</a></strong></span></p>
<h4><a id="_add_savedobjects_mappings_api_to_core"></a>Add savedObjects mappings API to core<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Added API to register savedObjects mapping from the new platform.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts"> // my-plugin/server/mappings.ts
import { SavedObjectsTypeMappingDefinitions } from 'src/core/server';

export const mappings: SavedObjectsTypeMappingDefinitions = {
   'my-type': {
     properties: {
       afield: {
         type: "text"
       }
     }
   }
 }</pre>
</div>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts"> // my-plugin/server/plugin.ts
 import { mappings } from './mappings';

 export class MyPlugin implements Plugin {
   setup({ savedObjects }) {
     savedObjects.registerMappings(mappings);
   }
 }</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55825" class="ulink" target="_top">#55825</a></strong></span></p>
<h4><a id="_remove_the_viseditortypesregistryprovider"></a>Remove the VisEditorTypesRegistryProvider<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>The <code class="literal">VisEditorTypesRegistryProvider</code> is removed. By default,
visualizations will use the default editor.</p>
<p>To specify a custom editor use editor parameter as a key and
a class with your own controller as a value in a vis type definition:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">{
    name: 'my_new_vis',
    title: 'My New Vis',
    icon: 'my_icon',
    description: 'Cool new chart',
    editor: MyEditorController
  }</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55370" class="ulink" target="_top">#55370</a></strong></span></p>
<h4><a id="_explicitly_test_custom_approutes"></a>Explicitly test custom appRoutes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Tests for custom `appRoute`s are now more clear and explicitly separate
from those that test other rendering service interactions.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55405" class="ulink" target="_top">#55405</a></strong></span></p>
<h4><a id="_np_platform_exposes_api_to_get_authenticated_user_data"></a>[NP] Platform exposes API to get authenticated user data<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>HttpService exposes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">auth.get()</code> &mdash; returns auth status and associated user data. User data are opaque to the http service. Possible auth status values:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">authenticated</code> &mdash; <code class="literal">auth</code> interceptor successfully authenticated a user.
</li>
<li class="listitem">
<code class="literal">unauthenticated</code> &mdash; <code class="literal">auth</code> interceptor failed user authentication.
</li>
<li class="listitem">
<code class="literal">unknown</code> &mdash; <code class="literal">auth</code> interceptor has not been registered.
</li>
</ul>
</div>
</li>
<li class="listitem">
<code class="literal">auth.isAuthenticated()</code> - returns true, if <code class="literal">auth</code> interceptor successfully authenticated a user.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55327" class="ulink" target="_top">#55327</a></strong></span></p>
<h4><a id="_implements_getstartservices_on_server_side"></a>Implements <code class="literal">getStartServices</code> on server-side<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Adds a new API to be able to access <code class="literal">start</code> dependencies when registering handlers in <code class="literal">setup</code> phase.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">class MyPlugin implements Plugin {
  setup(core: CoreSetup, plugins: PluginDeps) {
    plugins.usageCollection.registerCollector({
      type: 'MY_TYPE',
      fetch: async () =&gt; {
        const [coreStart] = await core.getStartServices();
        const internalRepo = coreStart.savedObjects.createInternalRepository();
        // ...
      },
    });
  }
  start() {}
}</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55156" class="ulink" target="_top">#55156</a></strong></span></p>
<h4><a id="_expressions_refactor"></a>Expressions refactor<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">context.types</code> &gt; <code class="literal">inputTypes</code>
</li>
<li class="listitem">
Objects should be registered instead of function wrappers around those objects.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/54342" class="ulink" target="_top">#54342</a></strong></span></p>
<h4><a id="_refactor_saved_object_management_registry_usage"></a>Refactor saved object management registry usage<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Registration of the following <code class="literal">SavedObjectLoader</code> in Angular was removed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">savedSearches</code>
</li>
<li class="listitem">
<code class="literal">savedVisualizations</code>
</li>
<li class="listitem">
<code class="literal">savedDashboard</code>
</li>
</ul>
</div>
<p>The plugins now provide the functions to create a  <code class="literal">SavedObjectLoader</code> service, here&#8217;s an example how the services are created now:</p>
<div class="pre_wrapper lang-typescript">
<pre class="programlisting prettyprint lang-typescript">import { createSavedSearchesService } from '../discover';
import { TypesService, createSavedVisLoader } from '../../../visualizations/public';
import { createSavedDashboardLoader } from '../dashboard';

const services = {
   savedObjectsClient: npStart.core.savedObjects.client,
   indexPatterns: npStart.plugins.data.indexPatterns,
   chrome: npStart.core.chrome,
   overlays: npStart.core.overlays,
 };

const servicesForVisualizations = {
    ...services,
    ...{ visualizationTypes: new TypesService().start() },
  }

const savedSearches = createSavedSearchesService(services);
const savedVisualizations = createSavedVisLoader(servicesForVisualizations);
const savedDashboards = createSavedDashboardLoader(services);</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/54155" class="ulink" target="_top">#54155</a></strong></span></p>
<h4><a id="_enforce_camelcase_format_for_a_plugin_id"></a>Enforce camelCase format for a plugin id<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>When creating a new platform plugin, you need to make sure that
pluginId declared in camelCase within <code class="literal">kibana.json</code> manifest file.
It might not match <code class="literal">pluginPath</code>, which is recommended to be in snake_case format.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">// ok
"pluginPath": ["foo"],
"id": "foo"
// ok
"pluginPath": "foo_bar",
"id": "fooBar"</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/53759" class="ulink" target="_top">#53759</a></strong></span></p>
<h4><a id="_bfetch_2"></a>bfetch (2)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Request batching and response streaming functionality of legacy Interpreter plugin has been moved out into a separate <code class="literal">bfetch</code> Kibana platform plugin. Now every plugin can create server endpoints and browser wrappers that can batch HTTP requests and stream responses back.</p>
<p>As an example, we will create a batch processing endpoint that receives a number then doubles it
and streams it back. We will also consider the number to be time in milliseconds
and before streaming the number back the server will wait for the specified number of
milliseconds.</p>
<p>To do that, first create server-side batch processing route using <code class="literal">addBatchProcessingRoute</code>.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">plugins.bfetch.addBatchProcessingRoute&lt;{ num: number }, { num: number }&gt;(
  '/my-plugin/double',
  () =&gt; ({
    onBatchItem: async ({ num }) =&gt; {
      // Validate inputs.
      if (num &lt; 0) throw new Error('Invalid number');
      // Wait number of specified milliseconds.
      await new Promise(r =&gt; setTimeout(r, num));
      // Double the number and send it back.
      return { num: 2 * num };
    },
  })
);</pre>
</div>
<p>Now on client-side create <code class="literal">double</code> function using <code class="literal">batchedFunction</code>.
The newly created <code class="literal">double</code> function can be called many times and it
will package individual calls into batches and send them to the server.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">const double = plugins.bfetch.batchedFunction&lt;{ num: number }, { num: number }&gt;({
  url: '/my-plugin/double',
});</pre>
</div>
<p>Note: the created <code class="literal">double</code> must accept a single object argument (<code class="literal">{ num: number }</code> in this case)
and it will return a promise that resolves into an object, too (also <code class="literal">{ num: number }</code> in this case).</p>
<p>Use the <code class="literal">double</code> function.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">double({ num: 1 }).then(console.log, console.error); // { num: 2 }
double({ num: 2 }).then(console.log, console.error); // { num: 4 }
double({ num: 3 }).then(console.log, console.error); // { num: 6 }</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/53711" class="ulink" target="_top">#53711</a></strong></span></p>
<h4><a id="_grouped_kibana_nav"></a>Grouped Kibana nav<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Plugins should now define a category if they have a navigation item:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If you want to fit into our default categories, you can use our <code class="literal">DEFAULT_APP_CATEGORIES</code> defined in <code class="literal">src/core/utils/default_app_categories.ts</code>.
</li>
<li class="listitem">
If you want to create their own category, you can also provide any object matching the <code class="literal">AppCategory</code> interface defined in <code class="literal">src/core/types/app_category.ts</code>.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/53545" class="ulink" target="_top">#53545</a></strong></span></p>
<h4><a id="_expose_elasticsearch_from_start_and_deprecate_from_setup"></a>Expose Elasticsearch from start and deprecate from setup<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Remove any API that could allow access/query to savedObjects from core setup
contract, and move them to the start contract instead. Deprecate
the <code class="literal">CoreSetup.elasticsearch</code> API and expose <code class="literal">CoreStart.elasticsearch</code> instead.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/59886" class="ulink" target="_top">#59886</a></strong></span></p>
<h4><a id="_embeddable_triggers"></a>Embeddable triggers<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Embeddables can now report <code class="literal">ui_actions</code> triggers that they execute through the
<code class="literal">.supportedTriggers()</code> method. For example:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">class MyEmbeddable extends Embeddable {
  supportedTriggers() {
    return ['VALUE_CLICK_TRIGGER'];
  }
}</pre>
</div>
<p>The returned list of triggers will be used in the drilldowns feature on Dashboard,
where users will be able to add drilldowns to embeddable triggers.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/58440" class="ulink" target="_top">#58440</a></strong></span></p>
<h4><a id="_force_savedobject_api_consumers_to_define_so_type_explicitly"></a>Force savedObject API consumers to define SO type explicitly<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>The new interface enforces API consumers to specify SO type explicitly.
Plugins can use <code class="literal">SavedObjectAttributes</code> to ensure their type are serializable,
but it shouldn&#8217;t be used as their domain-specific type.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/58022" class="ulink" target="_top">#58022</a></strong></span></p>
<h4><a id="_trigger_context"></a>Trigger context<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Improved types for trigger contexts, which are consumed by actions.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/57870" class="ulink" target="_top">#57870</a></strong></span></p>
<h4><a id="_expressions_debug_mode"></a>Expressions debug mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Add ability to execute expression in "debug" mode, which would collect execution
information about each function. This is used in the Expression Explorer
(developed by Canvas) and in Canvas when the expression editor is open.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/57841" class="ulink" target="_top">#57841</a></strong></span></p>
<h4><a id="_move_uiagg_types_in_to_shim_data_plugin"></a>Move ui/agg_types in to shim data plugin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Moves the contents of <code class="literal">ui/agg_types</code> into the legacy shim data plugin
</li>
<li class="listitem">
Re-exports contracts <code class="literal">ui/agg_types</code> for BWC
</li>
<li class="listitem">
<p>Creates dedicated interfaces for classes commonly being used as types: IAggConfig, IAggConfigs, IAggType, IFieldParamType, IMetricAggType</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Right now these are just re-exporting the class as a type;
eventually we should put more detailed typings in place.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56353" class="ulink" target="_top">#56353</a></strong></span></p>
<h4><a id="_stateful_search_bar_default_behaviors"></a>Stateful search bar default behaviors<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>The goal of the stateful version of SearchBar / TopNavMenu is to be an easy way
to consume the services offered by <code class="literal">plugins.data.query</code> where developers
should be able to provide minimal configuration and get a fully working SearchBar.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/56160" class="ulink" target="_top">#56160</a></strong></span></p>
<h4><a id="_guide_for_creating_alert_action_types_in_the_ui"></a>Guide for creating alert / action types in the UI<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Documentation to help developers integrate their alert / action type within
our Management UIs</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55963" class="ulink" target="_top">#55963</a></strong></span></p>
<h4><a id="_move_search_service_code_to_np"></a>Move search service code to NP<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Move all of the search service code to Kibana new platform. Also deletes <code class="literal">courier</code> folder
and moves <code class="literal">getFlattenedObject</code> to <code class="literal">src/core/utils</code>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55430" class="ulink" target="_top">#55430</a></strong></span></p>
<h4><a id="_expose_np_fieldformats_service_to_server_side"></a>Expose NP FieldFormats service to server side<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>The fieldFormats service is used on the server side as well.
At the moment, it resides in <code class="literal">src/legacy/ui/field_formats/mixin/field_formats_service.ts</code>
and only the FE plugin exposes it.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55419" class="ulink" target="_top">#55419</a></strong></span></p>
<h4><a id="_update_plugin_generator_to_generate_np_plugins"></a>Update plugin generator to generate NP plugins<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Add more options for Kibana new platform plugin generator.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Generate FE components
</li>
<li class="listitem">
Generate server side endpoint
</li>
<li class="listitem">
Generate SCSS
</li>
<li class="listitem">
Generate an optional .eslintrc.js file (for 3rd party plugins mostly)
</li>
<li class="listitem">
Init git repo (for 3rd party plugins)
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55281" class="ulink" target="_top">#55281</a></strong></span></p>
<h4><a id="_run_so_migration_after_plugins_setup_phase"></a>Run SO migration after plugins setup phase<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Moves <code class="literal">createScopedRepository</code> and <code class="literal">createInternalRepository</code> from <code class="literal">setup</code>
contract to <code class="literal">start</code> contract, and removes <code class="literal">getScopedClient</code> from the <code class="literal">setup</code> contract.
There is no longer a possibility to be performing any call to SO before core&#8217;s <code class="literal">start</code> is done.
</li>
<li class="listitem">
Creates the migrator, the repository accessors and runs the SO migration
at the start of <code class="literal">SavedObjectsService.start()</code>, meaning that any SO call performed
is assured to be done after the migration.
</li>
<li class="listitem">
Changes the <code class="literal">setClientFactory</code> API to <code class="literal">setClientFactoryProvider</code> to provide a
SO repository provider when registering the client factory.
</li>
<li class="listitem">
Adapts the existing plugin calls to the removed APIs from <code class="literal">setup</code> to be now
using <code class="literal">getStartServices</code> to access them on the core <code class="literal">start</code> contract.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/55012" class="ulink" target="_top">#55012</a></strong></span></p>
<h4><a id="_build_immutable_bundles_for_new_platform_plugins"></a>Build immutable bundles for new platform plugins<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Plugins that have been migrated to the "new platform" are built with a new system
into their own <code class="literal">target/public</code> directory. To build third-party plugin&#8217;s with
this new system either pass <code class="literal">--plugin-path</code> to <code class="literal">node scripts/build_new_platform_plugins</code>
or use the <code class="literal">@kbn/optimizer</code> package in the Kibana repo to build your plugin as
described in the readme for that package.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/53976" class="ulink" target="_top">#53976</a></strong></span></p>
<h4><a id="_search_service_asynchronous_es_search_strategy"></a>[Search service] Asynchronous ES search strategy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Adds an async Elasticsearch search strategy, which utilizes the async search strategy to
call the <code class="literal">_async_search</code> APIs in Elasticsearch, returning an observable over the responses.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/53538" class="ulink" target="_top">#53538</a></strong></span></p>
<h4><a id="_vis_default_editor_euificate_and_reactify_the_sidebar"></a>[Vis: Default editor] EUIficate and Reactify the sidebar<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>If you are using the <code class="literal">default</code> editor in your <code class="literal">VisType</code> visualization definition,
remove the <code class="literal">editor: 'default'</code> param from it. The default editor controller
will be used by default.</p>
<p>The default editor controller receives an <code class="literal">optionsTemplate</code> or <code class="literal">optionTabs</code> parameter.
These tabs should be React components:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">{
    name: 'my_new_vis',
    title: 'My New Vis',
    icon: 'my_icon',
    description: 'Cool new chart',
    editorConfig: {
       optionsTemplate: MyReactComponent // or if multiple tabs are required:
       optionTabs: [
           { title: 'tab 3', editor: MyReactComponent }
       ]
    }
  }</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/49864" class="ulink" target="_top">#49864</a></strong></span></p>
<h4><a id="_test_consolidate_top_level_yarn_scripts"></a>[test] Consolidate top-level yarn scripts<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/7.7/docs/migration/migrate_7_7.asciidoc">edit</a></h4>
<p>Over time Kibana has added a number of testing frameworks,
but our top-level scripts have remained the same to avoid workflow changes.
The current naming convention with the number of test options can leave room for ambiguity.</p>
<p>You&#8217;ll see two general changes:
* docs will refer to the yarn script, giving us an abstraction to migrate
frameworks out and avoid workflow interruptions (<code class="literal">grunt/gulp -&gt; node scripts/*</code>)
* test scripts now refer to the test runner, as opposed to the test
type (<code class="literal">yarn test:server -&gt; yarn test:mocha</code>)</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/44679" class="ulink" target="_top">#44679</a></strong></span></p>
</div>
<div class="navfooter">
<span class="prev">
<a href="breaking-changes.html">« Breaking Changes</a>
</span>
<span class="next">
<a href="breaking-changes-7.6.html">Breaking changes in 7.6 »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
