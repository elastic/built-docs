<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Index threshold | Kibana Guide [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [7.x]"/>
<link rel="up" href="alert-types.html" title="Alerts"/>
<link rel="prev" href="alert-types.html" title="Alerts"/>
<link rel="next" href="alert-type-es-query.html" title="ES query"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/7.x"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="7.x"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="alerting-getting-started.html">Alerting and Actions</a></span>
»
<span class="breadcrumb-link"><a href="alert-types.html">Alerts</a></span>
»
<span class="breadcrumb-node">Index threshold</span>
</div>
<div class="navheader">
<span class="prev">
<a href="alert-types.html">« Alerts</a>
</span>
<span class="next">
<a href="alert-type-es-query.html">ES query »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="alert-type-index-threshold"></a>Index threshold<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/user/alerting/stack-alerts/index-threshold.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>The index threshold alert type runs an Elasticsearch query. It aggregates field values from documents, compares them to threshold values, and schedules actions to run when the thresholds are met.</p>
<h4><a id="_create_the_alert"></a>Create the alert<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/user/alerting/stack-alerts/index-threshold.asciidoc">edit</a></h4>
<p>Fill in the <a class="xref" href="defining-alerts.html#defining-alerts-general-details" title="General alert details">alert details</a>, then select <span class="strong strong"><strong>Index Threshold</strong></span>.</p>
<h4><a id="_define_the_conditions"></a>Define the conditions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/user/alerting/stack-alerts/index-threshold.asciidoc">edit</a></h4>
<p>Define properties to detect the condition.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-conditions.png" alt="Five clauses define the condition to detect">
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Index
</span>
</dt>
<dd>
This clause requires an <span class="strong strong"><strong>index or index pattern</strong></span> and a <span class="strong strong"><strong>time field</strong></span> that will be used for the <span class="strong strong"><strong>time window</strong></span>.
</dd>
<dt>
<span class="term">
When
</span>
</dt>
<dd>
This clause specifies how the value to be compared to the threshold is calculated. The value is calculated by aggregating a numeric field a the <span class="strong strong"><strong>time window</strong></span>. The aggregation options are: <code class="literal">count</code>, <code class="literal">average</code>, <code class="literal">sum</code>, <code class="literal">min</code>, and <code class="literal">max</code>. When using <code class="literal">count</code> the document count is used, and an aggregation field is not necessary.
</dd>
<dt>
<span class="term">
Over/Grouped Over
</span>
</dt>
<dd>
This clause lets you configure whether the aggregation is applied over all documents, or should be split into groups using a grouping field. If grouping is used, an  <a class="xref" href="alerting-getting-started.html#alerting-concepts-alert-instances" title="Alert instances">alert instance</a> will be created for each group when it exceeds the threshold. To limit the number of instances on high cardinality fields, you must specify the number of groups to check against the threshold. Only the <span class="strong strong"><strong>top</strong></span> groups are checked.
</dd>
<dt>
<span class="term">
Threshold
</span>
</dt>
<dd>
This clause defines a threshold value and a comparison operator  (one of <code class="literal">is above</code>, <code class="literal">is above or equals</code>, <code class="literal">is below</code>, <code class="literal">is below or equals</code>, or <code class="literal">is between</code>). The result of the aggregation is compared to this threshold.
</dd>
<dt>
<span class="term">
Time window
</span>
</dt>
<dd>
This clause determines how far back to search for documents, using the <span class="strong strong"><strong>time field</strong></span> set in the <span class="strong strong"><strong>index</strong></span> clause. Generally this value should be to a value higher than the <span class="strong strong"><strong>check every</strong></span> value in the <a class="xref" href="defining-alerts.html#defining-alerts-general-details" title="General alert details">general alert details</a>, to avoid gaps in detection.
</dd>
</dl>
</div>
<p>If data is available and all clauses have been defined, a preview chart will render the threshold value and display a line chart showing the value for the last 30 intervals. This can provide an indication of recent values and their proximity to the threshold, and help you tune the clauses.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-preview.png" alt="Five clauses define the condition to detect">
</div>
</div>
<h4><a id="_add_action_variables"></a>Add action variables<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/user/alerting/stack-alerts/index-threshold.asciidoc">edit</a></h4>
<p><a class="xref" href="defining-alerts.html#defining-alerts-actions-details" title="Action type and action details">Add an action</a> to run when the alert condition is met. The following variables are specific to the index threshold alert. You can also specify <a class="xref" href="defining-alerts.html#defining-alerts-actions-variables" title="Action variables">variables common to all alerts</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">context.title</code>
</span>
</dt>
<dd>
A preconstructed title for the alert. Example: <code class="literal">alert kibana sites - high egress met threshold</code>.
</dd>
<dt>
<span class="term">
<code class="literal">context.message</code>
</span>
</dt>
<dd>
A preconstructed message for the alert. Example:<br>
<code class="literal">alert 'kibana sites - high egress' is active for group 'threshold met':</code><br>
<code class="literal">- Value: 42</code><br>
<code class="literal">- Conditions Met: count greater than 4 over 5m</code><br>
<code class="literal">- Timestamp: 2020-01-01T00:00:00.000Z</code>
</dd>
<dt>
<span class="term">
<code class="literal">context.group</code>
</span>
</dt>
<dd>
The name of the action group associated with the threshold condition. Example: <code class="literal">threshold met</code>.
</dd>
<dt>
<span class="term">
<code class="literal">context.date</code>
</span>
</dt>
<dd>
The date, in ISO format, that the alert met the threshold condition. Example: <code class="literal">2020-01-01T00:00:00.000Z</code>.
</dd>
<dt>
<span class="term">
<code class="literal">context.value</code>
</span>
</dt>
<dd>
The value for the alert that met the threshold condition.
</dd>
<dt>
<span class="term">
<code class="literal">context.conditions</code>
</span>
</dt>
<dd>
A description of the threshold condition. Example: <code class="literal">count greater than 4</code>
</dd>
</dl>
</div>
<h4><a id="_example_2"></a>Example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/user/alerting/stack-alerts/index-threshold.asciidoc">edit</a></h4>
<p>In this example, you will use the Kibana <a class="xref" href="add-sample-data.html" title="Add sample data">sample weblog dataset</a> to set up and tune the conditions on an index threshold alert. For this example, you want to detect when any of the top four sites serve more than 420,000 bytes over a 24 hour period.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the main menu, then click <span class="strong strong"><strong>Stack Management &gt; Alerts and Actions</strong></span>.
</li>
<li class="listitem">
<p>Create a new alert that is checked every four hours and executes actions when the alert status changes.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-select.png" alt="Choosing an index threshold alert type">
</div>
</div>
</li>
<li class="listitem">
Select the <span class="strong strong"><strong>Index threshold</strong></span> alert type.
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Index</strong></span>, and set <span class="strong strong"><strong>Indices to query</strong></span> to <span class="strong strong"><strong>kibana_sample_data_logs</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-example-index.png" alt="Choosing an index">
</div>
</div>
</li>
<li class="listitem">
<p>Set the <span class="strong strong"><strong>Time field</strong></span> to <span class="strong strong"><strong>@timestamp</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-example-timefield.png" alt="Choosing a time field">
</div>
</div>
</li>
<li class="listitem">
<p>To detect the number of bytes served during the time window, click <span class="strong strong"><strong>When</strong></span> and select <code class="literal">sum</code> as the aggregation, and bytes as the field to aggregate.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-example-aggregation.png" alt="Choosing the aggregation">
</div>
</div>
</li>
<li class="listitem">
<p>To detect the four sites that have the most traffic, click <span class="strong strong"><strong>Over</strong></span> and select <code class="literal">top</code>, enter <code class="literal">4</code>, and select <code class="literal">host.keyword</code> as the field.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-example-grouping.png" alt="Choosing the groups">
</div>
</div>
</li>
<li class="listitem">
<p>To alert when any of the top four sites exceeds 420,000 bytes over a 24 hour period, select <code class="literal">is above</code> and enter <code class="literal">420000</code>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-example-threshold.png" alt="Setting the threshold">
</div>
</div>
</li>
<li class="listitem">
<p>Finally, click <span class="strong strong"><strong>For the last</strong></span>, enter <code class="literal">24</code> and select <code class="literal">hours</code> to complete the alert configuration.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-example-window.png" alt="Setting the time window">
</div>
</div>
</li>
<li class="listitem">
<p>The preview chart will render showing the 24 hour sum of bytes at 4 hours intervals (the <span class="strong strong"><strong>check every</strong></span> interval) for the past 120 hours (the last 30 intervals).</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-example-preview.png" alt="Setting the time window">
</div>
</div>
</li>
<li class="listitem">
<p>Change the time window and observe the effect it has on the chart. Compare a 24 window to a 12 hour window. Notice the variability in the sum of bytes, due to different traffic levels during the day compared to at night. This variability would result in noisy alerts, so the 24 hour window is better. The preview chart can help you find the right values for your alert.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/alert-types-index-threshold-example-comparison.png" alt="Comparing two time windows">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="alert-types.html">« Alerts</a>
</span>
<span class="next">
<a href="alert-type-es-query.html">ES query »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
