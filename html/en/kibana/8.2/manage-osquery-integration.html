<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="Kibana provides you with several options to share *Discover* saved searches, dashboards, *Visualize Library* visualizations, and *Canvas* workpads with others, or on a website.">
<meta name="keywords" content="analyst, concept, task, reporting">
<title>Manage the integration | Kibana Guide [8.2] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [8.2]"/>
<link rel="up" href="osquery.html" title="Osquery"/>
<link rel="prev" href="osquery.html" title="Osquery"/>
<link rel="next" href="exported-fields-osquery.html" title="Exported fields reference"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/8.2"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="8.2"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [8.2]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="osquery.html">Osquery</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="osquery.html">« Osquery</a>
</span>
<span class="next">
<a href="exported-fields-osquery.html">Exported fields reference »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="manage-osquery-integration"></a>Manage the integration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/manage-integration.asciidoc">edit</a></h2>
</div></div></div>
<h3><a id="_system_requirements"></a>System requirements<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/manage-integration.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/fleet/8.2/fleet-overview.html" class="ulink" target="_top">Fleet</a> is enabled on your cluster, and
one or more <a href="/guide/en/fleet/8.2/elastic-agent-installation.html" class="ulink" target="_top">Elastic Agents</a> is enrolled.
</li>
<li class="listitem">
The <a href="https://docs.elastic.co/en/integrations/osquery_manager" class="ulink" target="_top"><span class="strong strong"><strong>Osquery Manager</strong></span></a> integration
has been added and configured
for an agent policy through Fleet.
This integration supports x64 architecture on Windows, MacOS, and Linux platforms,
and ARM64 architecture on Linux.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The original <a href="/guide/en/beats/filebeat/8.2/filebeat-module-osquery.html" class="ulink" target="_top">Filebeat Osquery module</a>
and the <a href="https://docs.elastic.co/en/integrations/osquery" class="ulink" target="_top">Osquery</a>
integration collect logs from self-managed Osquery deployments.
The <span class="strong strong"><strong>Osquery Manager</strong></span> integration manages Osquery deployments
and supports running and scheduling queries from Kibana.
</li>
<li class="listitem">
<span class="strong strong"><strong>Osquery Manager</strong></span> cannot be integrated with an Elastic Agent in standalone mode.
</li>
</ul>
</div>
</div>
</div>
<h3><a id="_customize_osquery_sub_feature_privileges"></a>Customize Osquery sub-feature privileges<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/manage-integration.asciidoc">edit</a></h3>
<p>Depending on your <a href="/subscriptions" class="ulink" target="_top">subscription level</a>,
you can further customize the sub-feature privileges
for <span class="strong strong"><strong>Osquery Manager</strong></span>. These include options to grant specific access for running live queries,
running saved queries, saving queries, and scheduling packs. For example,
you can create roles for users who can only run live or saved queries, but who cannot save or schedule queries.
This is useful for teams who need in-depth and detailed control.</p>
<h3><a id="_customize_osquery_configuration"></a>Customize Osquery configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/manage-integration.asciidoc">edit</a></h3>
<p><span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> By default, all Osquery Manager integrations share the same osquery configuration. However, you can customize how Osquery is configured by editing the Osquery Manager integration for each agent policy
you want to adjust. The custom configuration is then applied to all agents in the policy.
This powerful feature allows you to configure
<a href="https://osquery.readthedocs.io/en/stable/deployment/file-integrity-monitoring" class="ulink" target="_top">File Integrity Monitoring</a>, <a href="https://osquery.readthedocs.io/en/stable/deployment/process-auditing" class="ulink" target="_top">Process auditing</a>,
and <a href="https://osquery.readthedocs.io/en/stable/deployment/configuration/#configuration-specification" class="ulink" target="_top">others</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Take caution when editing this configuration. The changes you make are distributed to all agents in the policy.
</li>
<li class="listitem">
Take caution when editing <code class="literal">packs</code> using the Advanced <span class="strong strong"><strong>Osquery config</strong></span> field.
Any changes you make to <code class="literal">packs</code> from this field are not reflected in the UI on the Osquery <span class="strong strong"><strong>Packs</strong></span> page in Kibana, however, these changes are deployed to agents in the policy.
While this allows you to use advanced Osquery functionality like pack discovery queries, you do lose the ability to manage packs defined this way from the Osquery <span class="strong strong"><strong>Packs</strong></span> page.
</li>
</ul>
</div>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
From the Kibana main menu, click <span class="strong strong"><strong>Fleet</strong></span>, then the <span class="strong strong"><strong>Agent policies</strong></span> tab.
</li>
<li class="listitem">
Click the name of the agent policy where you want to adjust the Osquery configuration. The configuration changes you make only apply to the policy you select.
</li>
<li class="listitem">
Click the name of the <span class="strong strong"><strong>Osquery Manager</strong></span> integration, or add the integration first if the agent policy does not yet have it.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Edit Osquery Manager integration</strong></span> page, expand the <span class="strong strong"><strong>Advanced</strong></span> section.
</li>
<li class="listitem">
<p>Edit the <span class="strong strong"><strong>Osquery config</strong></span> JSON field to apply your preferred Osquery configuration. Note the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The field may already have content if you have scheduled packs for this agent policy. To keep these packs scheduled, do not remove the <code class="literal">packs</code> section.
</li>
<li class="listitem">
Refer to the <a href="https://osquery.readthedocs.io/en/stable/" class="ulink" target="_top">Osquery documentation</a> for configuration options.
</li>
<li class="listitem">
Some fields are protected and cannot be set. A warning is displayed with details about which fields should be removed.
</li>
<li class="listitem">
(Optional) To load a full configuration file, drag and drop an Osquery <code class="literal">.conf</code> file into the area at the bottom of the page.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Save integration</strong></span> to apply the custom configuration to all agents in the policy.</p>
<p>As an example, the following configuration disables two tables.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">{
   "options":{
      "disable_tables":"curl,process_envs"
   }
}</pre>
</div>
</li>
</ol>
</div>
<h3><a id="_upgrade_osquery_versions"></a>Upgrade Osquery versions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/manage-integration.asciidoc">edit</a></h3>
<p>The <a href="https://github.com/osquery/osquery/releases" class="ulink" target="_top">Osquery version</a> available on an Elastic Agent
is associated to the version of Osquery Beat on the Agent.
To get the latest version of Osquery Beat,
<a href="/guide/en/fleet/master/upgrade-elastic-agent.html" class="ulink" target="_top">upgrade your Elastic Agent</a>.</p>
<h3><a id="_debug_issues"></a>Debug issues<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/manage-integration.asciidoc">edit</a></h3>
<p>If you encounter issues with <span class="strong strong"><strong>Osquery Manager</strong></span>, find the relevant logs for Elastic Agent
and Osquerybeat in the agent directory. Refer to the <a href="/guide/en/fleet/8.2/installation-layout.html" class="ulink" target="_top">Fleet Installation layout</a> to find the log file location for your OS.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">../data/elastic-agent-*/logs/elastic-agent-json.log-*
../data/elastic-agent-*/logs/default/osquerybeat-json.log</pre>
</div>
<p>To get more details in the logs, change the agent logging level to debug:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the main menu, and then select <span class="strong strong"><strong>Fleet</strong></span>.
</li>
<li class="listitem">
Select the agent that you want to debug.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>Logs</strong></span> tab, change the <span class="strong strong"><strong>Agent logging level</strong></span> to <span class="strong strong"><strong>debug</strong></span>, and then click <span class="strong strong"><strong>Apply changes</strong></span>.</p>
<p><code class="literal">agent.logging.level</code> is updated in <code class="literal">fleet.yml</code>, and the logging level is changed to <code class="literal">debug</code>.</p>
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="osquery.html">« Osquery</a>
</span>
<span class="next">
<a href="exported-fields-osquery.html">Exported fields reference »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
