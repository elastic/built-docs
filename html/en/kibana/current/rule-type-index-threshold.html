<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Index threshold | Kibana Guide [8.8] | Elastic</title>
<meta class="elastic" name="content" content="Index threshold | Kibana Guide [8.8]">

<link rel="home" href="index.html" title="Kibana Guide [8.8]"/>
<link rel="up" href="rule-types.html" title="Rule types"/>
<link rel="prev" href="rule-types.html" title="Rule types"/>
<link rel="next" href="rule-type-es-query.html" title="Elasticsearch query"/>
<meta class="elastic" name="product_version" content="8.8"/>
<meta class="elastic" name="product_name" content="Kibana"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/8.8"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="8.8"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Kibana Guide [8.8]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="alerting-getting-started.html">Alerting</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rule-types.html">Rule types</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="rule-types.html">« Rule types</a>
</span>
<span class="next">
<a href="rule-type-es-query.html">Elasticsearch query »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="rule-type-index-threshold"></a>Index threshold<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/8.8/docs/user/alerting/rule-types/index-threshold.asciidoc">edit</a></h2>
</div></div></div>
<p>The index threshold rule type runs an Elasticsearch query. It aggregates field values from documents, compares them to threshold values, and schedules actions to run when the thresholds are met.</p>
<h4><a id="_rule_conditions"></a>Rule conditions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/8.8/docs/user/alerting/rule-types/index-threshold.asciidoc">edit</a></h4>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-conditions.png" alt="Defining index threshold rule conditions in Kibana">
</div>
</div>
<p>When you create an index threshold rule, you must define the conditions for the rule to detect. For example:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Select an index
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Index
</span>
</dt>
<dd>
Specify the indices to query and a time field that will be used for the time window.
</dd>
<dt>
<span class="term">
When
</span>
</dt>
<dd>
Specify how to calculate the value that is compared to the threshold. The value is calculated by aggregating a numeric field in a time window. The aggregation options are: <code class="literal">count</code>, <code class="literal">average</code>, <code class="literal">sum</code>, <code class="literal">min</code>, and <code class="literal">max</code>. When using <code class="literal">count</code> the document count is used and an aggregation field is not necessary.
</dd>
<dt>
<span class="term">
Over/Grouped Over
</span>
</dt>
<dd>
Specify whether the aggregation is applied over all documents or split into groups using a grouping field. If grouping is used, an <a class="xref" href="alerting-getting-started.html#alerting-concepts-alerts" title="Alerts">alert</a> will be created for each group when it exceeds the threshold. To limit the number of alerts on high cardinality fields, you must specify the number of groups to check against the threshold. Only the top groups are checked.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
Define the condition
</span>
</dt>
<dd>
This section defines a threshold value and a comparison operator (<code class="literal">is above</code>, <code class="literal">is above or equals</code>, <code class="literal">is below</code>, <code class="literal">is below or equals</code>, or <code class="literal">is between</code>). The result of the aggregation is compared to this threshold.
It also defines a time window, which determines how far back to search for documents, using the time field set in the index clause. Generally this value should be a value higher than the check interval to avoid gaps in detection.
</dd>
</dl>
</div>
<p>If data is available and all clauses have been defined, a preview chart will render the threshold value and display a line chart showing the value for the last 30 intervals. This can provide an indication of recent values and their proximity to the threshold, and help you tune the clauses.</p>
<h4><a id="action-variables-index-threshold"></a>Action variables<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/8.8/docs/user/alerting/rule-types/index-threshold.asciidoc">edit</a></h4>
<p>The following action variables are specific to the index threshold rule. You can also specify <a class="xref" href="rule-action-variables.html" title="Rule action variables">variables common to all rules</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">context.conditions</code>
</span>
</dt>
<dd>
A description of the threshold condition. Example: <code class="literal">count greater than 4</code>
</dd>
<dt>
<span class="term">
<code class="literal">context.date</code>
</span>
</dt>
<dd>
The date, in ISO format, that the rule met the threshold condition. Example: <code class="literal">2020-01-01T00:00:00.000Z</code>.
</dd>
<dt>
<span class="term">
<code class="literal">context.group</code>
</span>
</dt>
<dd>
The name of the action group associated with the threshold condition. Example: <code class="literal">threshold met</code>.
</dd>
<dt>
<span class="term">
<code class="literal">context.message</code>
</span>
</dt>
<dd>
A preconstructed message for the rule. Example:<br>
<code class="literal">rule 'kibana sites - high egress' is active for group 'threshold met':</code><br>
<code class="literal">- Value: 42</code><br>
<code class="literal">- Conditions Met: count greater than 4 over 5m</code><br>
<code class="literal">- Timestamp: 2020-01-01T00:00:00.000Z</code>
</dd>
<dt>
<span class="term">
<code class="literal">context.title</code>
</span>
</dt>
<dd>
A preconstructed title for the rule. Example: <code class="literal">rule kibana sites - high egress met threshold</code>.
</dd>
<dt>
<span class="term">
<code class="literal">context.value</code>
</span>
</dt>
<dd>
The value for the rule that met the threshold condition.
</dd>
</dl>
</div>
<h4><a id="_example"></a>Example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/8.8/docs/user/alerting/rule-types/index-threshold.asciidoc">edit</a></h4>
<p>In this example, you will use the Kibana <a class="xref" href="add-sample-data.html" title="Add sample data">sample weblog data set</a> to set up and tune the conditions on an index threshold rule. For this example, you want to detect when any of the top four sites serve more than 420,000 bytes over a 24 hour period.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the main menu, then click <span class="strong strong"><strong>Stack Management &gt; Rules</strong></span>.
</li>
<li class="listitem">
<p>Create a new rule.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Provide a rule name and select the <span class="strong strong"><strong>Index threshold</strong></span> rule type.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-select.png" alt="Choosing an index threshold rule type">
</div>
</div>
</li>
<li class="listitem">
<p>Select an index. Click <span class="strong strong"><strong>Index</strong></span>, and set <span class="strong strong"><strong>Indices to query</strong></span> to <code class="literal">kibana_sample_data_logs</code>. Set the <span class="strong strong"><strong>Time field</strong></span> to <code class="literal">@timestamp</code>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-example-index.png" alt="Choosing an index">
</div>
</div>
</li>
<li class="listitem">
<p>To detect the number of bytes served during the time window, click <span class="strong strong"><strong>When</strong></span> and select <code class="literal">sum</code> as the aggregation, and <code class="literal">bytes</code> as the field to aggregate.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-example-aggregation.png" alt="Choosing the aggregation">
</div>
</div>
</li>
<li class="listitem">
<p>To detect the four sites that have the most traffic, click <span class="strong strong"><strong>Over</strong></span> and select <code class="literal">top</code>, enter <code class="literal">4</code>, and select <code class="literal">host.keyword</code> as the field.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-example-grouping.png" alt="Choosing the groups">
</div>
</div>
</li>
<li class="listitem">
<p>Define the condition. To trigger the rule when any of the top four sites exceeds 420,000 bytes over a 24 hour period, select <code class="literal">is above</code> and enter <code class="literal">420000</code>. Then click <span class="strong strong"><strong>For the last</strong></span>, enter <code class="literal">24</code>, and select <code class="literal">hours</code>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-example-threshold.png" alt="Setting the threshold">
</div>
</div>
</li>
<li class="listitem">
<p>Schedule the rule to check every four hours.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-example-preview.png" alt="Setting the check interval">
</div>
</div>
<p>The preview chart will render showing the 24 hour sum of bytes at 4 hours intervals (the <em>check interval</em>) for the past 120 hours (the last 30 intervals).</p>
</li>
<li class="listitem">
Change the time window and observe the effect it has on the chart. Compare a 24 window to a 12 hour window. Notice the variability in the sum of bytes, due to different traffic levels during the day compared to at night. This variability would result in noisy rules, so the 24 hour window is better. The preview chart can help you find the right values for your rule.
</li>
<li class="listitem">
<p>Define the actions for your rule.</p>
<p>You can add one or more actions to your rule to generate notifications when its conditions are met and when they are no longer met. For each action, you must select a connector, set the action frequency, and compose the notification details.
For example, add an action that uses a server log connector to write an entry to the Kibana server log:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-example-action.png" alt="Add an action to the rule">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The index threshold rule does not support alert summaries; therefore they do not appear in the action frequency options.</p>
</div>
</div>
<p>The unique action variables that you can use in the notification are listed in <a class="xref" href="rule-type-index-threshold.html#action-variables-index-threshold" title="Action variables">Action variables</a>. For more information, refer to <a class="xref" href="create-and-manage-rules.html#defining-rules-actions-details" title="Actions">Actions</a> and <a class="xref" href="action-types.html" title="Connectors"><em>Connectors</em></a>.</p>
</li>
<li class="listitem">
Save the rule.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Find the rule and view its details in <span class="strong strong"><strong>Stack Management &gt; Rules</strong></span>. For example, you can see the status of the rule and its alerts:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="user/alerting/images/rule-types-index-threshold-example-alerts.png" alt="View the list of alerts for the rule">
</div>
</div>
</li>
<li class="listitem">
Delete or disable this example rule when it&#8217;s no longer useful. In the detailed rule view, select <span class="strong strong"><strong>Delete rule</strong></span> from the actions menu.
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="rule-types.html">« Rule types</a>
</span>
<span class="next">
<a href="rule-type-es-query.html">Elasticsearch query »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
