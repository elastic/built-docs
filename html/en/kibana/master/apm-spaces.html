<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="Kibana provides you with several options to share *Discover* saved searches, dashboards, *Visualize Library* visualizations, and *Canvas* workpads with others, or on a website.">
<meta name="keywords" content="analyst, concept, task, reporting">
<title>Control access to APM data | Kibana Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [master]"/>
<link rel="up" href="apm-how-to.html" title="How-to guides"/>
<link rel="prev" href="agent-configuration.html" title="APM Agent central configuration"/>
<link rel="next" href="apm-alerts.html" title="Alerts and rules"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/master"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [master]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="xpack-apm.html">APM</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="apm-how-to.html">How-to guides</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="agent-configuration.html">« APM Agent central configuration</a>
</span>
<span class="next">
<a href="apm-alerts.html">Alerts and rules »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="apm-spaces"></a>Control access to APM data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/apm/apm-spaces.asciidoc">edit</a></h2>
</div></div></div>
<p>Starting in version 8.2.0, the APM app is <a class="xref" href="xpack-spaces.html" title="Spaces">Kibana Space</a> aware.
This allows you to separate your data&#8212;&#8203;and access to that data&#8212;&#8203;by team, use case, service environment,
or any other filter that you choose.</p>
<p>To take advantage of this feature, your APM data needs to be written to different data steams.
One way to accomplish this is with different namespaces.
For example, you can send production data to an APM integration with a namespace of <code class="literal">production</code>,
while sending staging data to a different APM integration with a namespace of <code class="literal">staging</code>.</p>
<p>Multiple APM integration instances is not required though. The simplest way to take advantage of this feature
is by creating filtered aliases. See the guide below for more information.</p>
<h3><a id="apm-spaces-example"></a>Guide: Separate staging and production data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/apm/apm-spaces.asciidoc">edit</a></h3>
<p>This guide will explain how to separate your staging and production data.
This can be helpful to either remove noise when troubleshooting a production issue,
or to create more granular access control for certain data.</p>
<p>This guide assumes that you:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Are sending both staging and production APM data to an Elasticsearch cluster.
</li>
<li class="listitem">
Have configured the <code class="literal">environment</code> variable in your APM agent configurations.
This variable sets the <code class="literal">service.environment</code> field in APM documents.
You should have documents where <code class="literal">service.environment: production</code> and <code class="literal">service.environment: staging</code>.
If this field is empty, see <a class="xref" href="filters.html#environment-selector" title="Service environment filter">service environment filter</a> to learn how to set this value.
</li>
</ul>
</div>
<h4><a id="_step_1_create_filtered_aliases"></a>Step 1: Create filtered aliases<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/apm/apm-spaces.asciidoc">edit</a></h4>
<p>The APM app uses index patterns to query your APM data. An index pattern can match data streams, indices, and/or aliases.
The default values are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Index setting</th>
<th align="left" valign="top">Default index pattern</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Error</p></td>
<td align="left" valign="top"><p><code class="literal">logs-apm*</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Span/Transaction</p></td>
<td align="left" valign="top"><p><code class="literal">traces-apm*</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Metrics</p></td>
<td align="left" valign="top"><p><code class="literal">metrics-apm*</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The default index settings also query the <code class="literal">apm-*</code> data view.
This data view matches APM data shipped in earlier versions of APM (prior to v8.0).</p>
</div>
</div>
<p>Instead of querying the default APM data views, we can create filtered aliases for the APM app to query.
A filtered alias is a secondary name for a group of data streams that has a user-defined
filter to limit the documents that the alias can access.</p>
<p>To separate <code class="literal">staging</code> and <code class="literal">production</code> APM data, we&#8217;d need to create six filtered aliases&#8212;&#8203;three
aliases for each service environment:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Index setting</th>
<th align="left" valign="top"><code class="literal">production</code> env</th>
<th align="left" valign="top"><code class="literal">staging</code> evn</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Error</p></td>
<td align="left" valign="top"><p><code class="literal">production-logs-apm</code></p></td>
<td align="left" valign="top"><p><code class="literal">staging-logs-apm</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Span/Transaction</p></td>
<td align="left" valign="top"><p><code class="literal">production-traces-apm</code></p></td>
<td align="left" valign="top"><p><code class="literal">staging-traces-apm</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Metrics</p></td>
<td align="left" valign="top"><p><code class="literal">production-metrics-apm</code></p></td>
<td align="left" valign="top"><p><code class="literal">staging-metrics-apm</code></p></td>
</tr>
</tbody>
</table>
</div>
<p>The <code class="literal">production-&lt;event&gt;-apm</code> aliases will contain a filter that only provides access to documents
where the <code class="literal">service.environment</code> is <code class="literal">production</code>.
Similarly, the <code class="literal">staging-&lt;event&gt;-apm</code> aliases will contain a filter that only provides access to documents
where the <code class="literal">service.environment</code> is <code class="literal">staging</code>.</p>
<p>To create these six filtered aliases, use the Elasticsearch <a href="/guide/en/elasticsearch/reference/master/indices-aliases.html" class="ulink" target="_top">Aliases API</a>.
In Kibana, open <span class="strong strong"><strong>Dev Tools</strong></span> and run the following POST requests.</p>
<details open>
<summary class="title"><code class="literal">traces-apm*</code> production alias example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_aliases?pretty
{
  "actions": [
    {
      "add": {
        "index": "traces-apm*", <a id="CO37-1"></a><i class="conum" data-value="1"></i>
        "alias": "production-traces-apm", <a id="CO37-2"></a><i class="conum" data-value="2"></i>
        "filter": {
          "term": {
            "service.environment": {
              "value": "production" <a id="CO37-3"></a><i class="conum" data-value="3"></i>
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/10.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This example matches the APM traces data stream</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The alias must not match the default APM index (<code class="literal">traces-apm*,apm-*</code>)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Only match documents where <code class="literal">service.environment: production</code></p>
</td>
</tr>
</table>
</div>
</div>
</details>
<details>
<summary class="title"><code class="literal">logs-apm*</code> production alias example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_aliases?pretty
{
  "actions": [
    {
      "add": {
        "index": "logs-apm*", <a id="CO38-1"></a><i class="conum" data-value="1"></i>
        "alias": "production-logs-apm", <a id="CO38-2"></a><i class="conum" data-value="2"></i>
        "filter": {
          "term": {
            "service.environment": {
              "value": "production" <a id="CO38-3"></a><i class="conum" data-value="3"></i>
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/11.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This example matches the APM logs data stream</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The alias must not match the default APM index (<code class="literal">logs-apm*,apm-*</code>)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Only match documents where <code class="literal">service.environment: production</code></p>
</td>
</tr>
</table>
</div>
</div>
</details>
<details>
<summary class="title"><code class="literal">metrics-apm*</code> production alias example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_aliases?pretty
{
  "actions": [
    {
      "add": {
        "index": "metrics-apm*", <a id="CO39-1"></a><i class="conum" data-value="1"></i>
        "alias": "production-metrics-apm", <a id="CO39-2"></a><i class="conum" data-value="2"></i>
        "filter": {
          "term": {
            "service.environment": {
              "value": "production" <a id="CO39-3"></a><i class="conum" data-value="3"></i>
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/12.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This example matches the APM metrics data stream</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The alias must not match the default APM index (<code class="literal">metrics-apm*,apm-*</code>)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Only match documents where <code class="literal">service.environment: production</code></p>
</td>
</tr>
</table>
</div>
</div>
</details>
<details>
<summary class="title"><code class="literal">traces-apm*</code> staging alias example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_aliases?pretty
{
  "actions": [
    {
      "add": {
        "index": "traces-apm*", <a id="CO40-1"></a><i class="conum" data-value="1"></i>
        "alias": "staging-traces-apm", <a id="CO40-2"></a><i class="conum" data-value="2"></i>
        "filter": {
          "term": {
            "service.environment": {
              "value": "staging" <a id="CO40-3"></a><i class="conum" data-value="3"></i>
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/13.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This example matches the APM traces data stream</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The alias must not match the default APM index (<code class="literal">traces-apm*,apm-*</code>)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Only match documents where <code class="literal">service.environment: staging</code></p>
</td>
</tr>
</table>
</div>
</div>
</details>
<details>
<summary class="title"><code class="literal">logs-apm*</code> staging alias example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_aliases?pretty
{
  "actions": [
    {
      "add": {
        "index": "logs-apm*", <a id="CO41-1"></a><i class="conum" data-value="1"></i>
        "alias": "staging-logs-apm", <a id="CO41-2"></a><i class="conum" data-value="2"></i>
        "filter": {
          "term": {
            "service.environment": {
              "value": "staging" <a id="CO41-3"></a><i class="conum" data-value="3"></i>
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/14.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This example matches the APM logs data stream</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The alias must not match the default APM index (<code class="literal">logs-apm*,apm-*</code>)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Only match documents where <code class="literal">service.environment: staging</code></p>
</td>
</tr>
</table>
</div>
</div>
</details>
<details>
<summary class="title"><code class="literal">metrics-apm*</code> staging alias example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_aliases?pretty
{
  "actions": [
    {
      "add": {
        "index": "metrics-apm*", <a id="CO42-1"></a><i class="conum" data-value="1"></i>
        "alias": "staging-metrics-apm", <a id="CO42-2"></a><i class="conum" data-value="2"></i>
        "filter": {
          "term": {
            "service.environment": {
              "value": "staging" <a id="CO42-3"></a><i class="conum" data-value="3"></i>
            }
          }
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/15.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO42-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This example matches the APM metrics data stream</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO42-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The alias must not match the default APM index (<code class="literal">metrics-apm*,apm-*</code>)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO42-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Only match documents where <code class="literal">service.environment: staging</code></p>
</td>
</tr>
</table>
</div>
</div>
</details>
<h4><a id="_step_2_create_kibana_spaces"></a>Step 2: Create Kibana spaces<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/apm/apm-spaces.asciidoc">edit</a></h4>
<p>Next, you&#8217;ll need to create a Kibana space for each service environment.
To create these spaces, navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>Spaces</strong></span> &gt; <span class="strong strong"><strong>Create a space</strong></span>.
For this guide, we&#8217;ve created two Kibana spaces, one named <code class="literal">production</code> and one named <code class="literal">staging</code>.</p>
<p>See <a class="xref" href="xpack-spaces.html#spaces-managing" title="View, create, and delete spaces">View, create, and delete spaces</a> for more information on creating a space.</p>
<h4><a id="_step_3_update_apm_index_settings_in_each_space"></a>Step 3: Update APM index settings in each space<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/apm/apm-spaces.asciidoc">edit</a></h4>
<p>Now we can change the default data views that the APM app queries in each space.</p>
<p>Open the APM app and navigate to <span class="strong strong"><strong>Settings</strong></span> &gt; <span class="strong strong"><strong>Indices</strong></span>.
Use the table below to update your settings for each space.
The values in each column match the names of the filtered aliases we created in step one.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Index setting</th>
<th align="left" valign="top"><code class="literal">production</code> space</th>
<th align="left" valign="top"><code class="literal">staging</code> space</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Error indices</p></td>
<td align="left" valign="top"><p><code class="literal">production-logs-apm</code></p></td>
<td align="left" valign="top"><p><code class="literal">staging-logs-apm</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Span indices</p></td>
<td align="left" valign="top"><p><code class="literal">production-traces-apm</code></p></td>
<td align="left" valign="top"><p><code class="literal">staging-traces-apm</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Transaction indices</p></td>
<td align="left" valign="top"><p><code class="literal">production-traces-apm</code></p></td>
<td align="left" valign="top"><p><code class="literal">staging-traces-apm</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Metrics indices</p></td>
<td align="left" valign="top"><p><code class="literal">production-metrics-apm</code></p></td>
<td align="left" valign="top"><p><code class="literal">staging-metrics-apm</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="settings/images/apm-settings.png" alt="APM app settings in Kibana">
</div>
</div>
<h4><a id="_step_4_create_kibana_access_roles"></a>Step 4: Create Kibana access roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/apm/apm-spaces.asciidoc">edit</a></h4>
<p>In Kibana, navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>Roles</strong></span> and click <span class="strong strong"><strong>Create role</strong></span>.</p>
<p>You&#8217;ll need to create two roles: one for <code class="literal">staging</code> users (we&#8217;ll call this role <code class="literal">staging_apm_viewer</code>)
and one for <code class="literal">production</code> users (we&#8217;ll call this role <code class="literal">production_apm_viewer</code>).</p>
<p>Using the table below, assign each role the following privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Privileges</th>
<th align="left" valign="top"><code class="literal">production_apm_viewer</code></th>
<th align="left" valign="top"><code class="literal">staging_apm_viewer</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Index privileges</p></td>
<td align="left" valign="top"><p>index: <code class="literal">production-*-apm</code>, privilege: <code class="literal">read</code></p></td>
<td align="left" valign="top"><p>index: <code class="literal">staging-*-apm</code>, privilege: <code class="literal">read</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Kibana privileges</p></td>
<td align="left" valign="top"><p>space: <code class="literal">production</code>, feature privileges: <code class="literal">APM and User Experience: read</code></p></td>
<td align="left" valign="top"><p>space: <code class="literal">staging</code>, feature privileges: <code class="literal">APM and User Experience: read</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/apm-roles-config.png" alt="APM role config example">
</div>
</div>
<p>Alternatively, you can use the
Elasticsearch <a href="/guide/en/elasticsearch/reference/master/security-api-put-role.html" class="ulink" target="_top">Create or update roles API</a>:</p>
<details open>
<summary class="title">Create a <code class="literal">production_apm_viewer</code> role</summary>
<div class="content">
<p>This request creates a <code class="literal">production_apm_viewer</code> role:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/production_apm_viewer
{
  "cluster": [ ],
  "indices": [
    {
      "names": ["production-*-apm"], <a id="CO43-1"></a><i class="conum" data-value="1"></i>
      "privileges": ["read"]
    }
  ],
  "applications": [
    {
      "application" : "kibana-.kibana",
      "privileges" : [
        "feature_apm.read" <a id="CO43-2"></a><i class="conum" data-value="2"></i>
      ],
      "resources" : [
        "space:production" <a id="CO43-3"></a><i class="conum" data-value="3"></i>
      ]
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/16.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO43-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This data view matches all of the production aliases created in step one.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO43-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Assigns <code class="literal">read</code> privileges for the APM and User Experience apps.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO43-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Provides access to the space named <code class="literal">production</code>.</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<details>
<summary class="title">Create a <code class="literal">staging_apm_viewer</code> role</summary>
<div class="content">
<p>This request creates a <code class="literal">staging_apm_viewer</code> role:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/role/staging_apm_viewer
{
  "cluster": [ ],
  "indices": [
    {
      "names": ["staging-*-apm"], <a id="CO44-1"></a><i class="conum" data-value="1"></i>
      "privileges": ["read"]
    }
  ],
  "applications": [
    {
      "application" : "kibana-.kibana",
      "privileges" : [
        "feature_apm.read" <a id="CO44-2"></a><i class="conum" data-value="2"></i>
      ],
      "resources" : [
        "space:staging" <a id="CO44-3"></a><i class="conum" data-value="3"></i>
      ]
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/17.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO44-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This data view matches all of the staging aliases created in step one.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO44-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Assigns <code class="literal">read</code> privileges for the APM and User Experience apps.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO44-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Provides access to the space named <code class="literal">staging</code>.</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<h4><a id="_step_5_assign_users_to_roles"></a>Step 5: Assign users to roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/apm/apm-spaces.asciidoc">edit</a></h4>
<p>The last thing to do is assign users to the newly created roles above.
Users will only have access to the data within the spaces that they are granted.</p>
<p>For information on how to create users and assign them roles with the Kibana UI,
see <a class="xref" href="tutorial-secure-access-to-kibana.html" title="Securing access to Kibana"><em>Securing access to Kibana</em></a>.</p>
<p>Alternatively, you can use the
Elasticsearch <a href="/guide/en/elasticsearch/reference/master/security-api-put-user.html" class="ulink" target="_top">Create or update users API</a>.</p>
<p>This example creates a new user and assigns them the <code class="literal">production_apm_viewer</code> role created in the previous step.
This user will only have access to the production space and data with a <code class="literal">service.environment</code> of <code class="literal">production</code>.
Remember to change the <code class="literal">password</code>, <code class="literal">full_name</code>, and <code class="literal">email</code> fields.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/user/production-apm-user
{
  "password" : "l0ng-r4nd0m-p@ssw0rd",
  "roles" : [ "production_apm_viewer" ], <a id="CO45-1"></a><i class="conum" data-value="1"></i>
  "full_name" : "Jane Production Smith",
  "email" : "janesmith@example.com"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/18.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO45-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Assigns the previously created <code class="literal">production_apm_viewer</code> role.</p>
</td>
</tr>
</table>
</div>
<p>This example creates a new user and assigns them the <code class="literal">staging_apm_viewer</code> role created in the previous step.
This user will only have access to the staging space and data with a <code class="literal">service.environment</code> of <code class="literal">staging</code>.
Remember to change the <code class="literal">password</code>, <code class="literal">full_name</code>, and <code class="literal">email</code> fields.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/user/staging-apm-user
{
  "password" : "l0ng-r4nd0m-p@ssw0rd",
  "roles" : [ "staging_apm_viewer" ], <a id="CO46-1"></a><i class="conum" data-value="1"></i>
  "full_name" : "John Staging Doe",
  "email" : "johndoe@example.com"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/19.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO46-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Assigns the previously created <code class="literal">staging_apm_viewer</code> role.</p>
</td>
</tr>
</table>
</div>
<h4><a id="_step_6_marvel"></a>Step 6: Marvel<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/apm/apm-spaces.asciidoc">edit</a></h4>
<p>That&#8217;s it! Head back to the APM app and marvel at your space-specific data.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="agent-configuration.html">« APM Agent central configuration</a>
</span>
<span class="next">
<a href="apm-alerts.html">Alerts and rules »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
