<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Event Dependent Configuration | Logstash Reference [2.2] | Elastic</title>
<link rel="home" href="index.html" title="Logstash Reference [2.2]"/>
<link rel="up" href="configuration.html" title="Configuring Logstash"/>
<link rel="prev" href="configuration-file-structure.html" title="Structure of a Config File"/>
<link rel="next" href="config-examples.html" title="Logstash Configuration Examples"/>
<meta name="DC.type" content="Learn/Docs/Logstash/Reference/2.2"/>
<meta name="DC.subject" content="Logstash"/>
<meta name="DC.identifier" content="2.2"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Logstash Reference [2.2]</a></span>
»
<span class="breadcrumb-link"><a href="logstash-reference.html">Logstash Reference</a></span>
»
<span class="breadcrumb-link"><a href="configuration.html">Configuring Logstash</a></span>
»
<span class="breadcrumb-node">Event Dependent Configuration</span>
</div>
<div class="navheader">
<span class="prev">
<a href="configuration-file-structure.html">« Structure of a Config File</a>
</span>
<span class="next">
<a href="config-examples.html">Logstash Configuration Examples »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="event-dependent-configuration"></a>Event Dependent Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/master/docs/static/configuration.asciidoc">edit</a></h2>
</div></div></div>
<p>The logstash agent is a processing pipeline with 3 stages: inputs &#8594; filters &#8594;
outputs. Inputs generate events, filters modify them, outputs ship them
elsewhere.</p>
<p>All events have properties. For example, an apache access log would have things
like status code (200, 404), request path ("/", "index.html"), HTTP verb
(GET, POST), client IP address, etc. Logstash calls these properties "fields."</p>
<p>Some of the configuration options in Logstash require the existence of fields in
order to function.  Because inputs generate events, there are no fields to
evaluate within the input block&#8212;&#8203;they do not exist yet!</p>
<p>Because of their dependency on events and fields, the following configuration
options will only work within filter and output blocks.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Field references, sprintf format and conditionals, described below,
will not work in an input block.</p>
</div>
</div>
<h4><a id="logstash-config-field-references"></a>Field References<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/master/docs/static/configuration.asciidoc">edit</a></h4>
<p>It is often useful to be able to refer to a field by name. To do this,
you can use the Logstash field reference syntax.</p>
<p>The syntax to access a field is <code class="literal">[fieldname]</code>. If you are referring to a
<span class="strong strong"><strong>top-level field</strong></span>, you can omit the <code class="literal">[]</code> and simply use <code class="literal">fieldname</code>.
To refer to a <span class="strong strong"><strong>nested field</strong></span>, you specify
the full path to that field: <code class="literal">[top-level field][nested field]</code>.</p>
<p>For example, the following event has five top-level fields (agent, ip, request, response,
ua) and three nested fields (status, bytes, os).</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "agent": "Mozilla/5.0 (compatible; MSIE 9.0)",
  "ip": "192.168.24.44",
  "request": "/index.html"
  "response": {
    "status": 200,
    "bytes": 52353
  },
  "ua": {
    "os": "Windows 7"
  }
}</pre>
</div>
<p>To reference the <code class="literal">os</code> field, you specify <code class="literal">[ua][os]</code>. To reference a top-level
field such as <code class="literal">request</code>, you can simply specify the field name.</p>
<h4><a id="sprintf"></a>sprintf format<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/master/docs/static/configuration.asciidoc">edit</a></h4>
<p>The field reference format is also used in what Logstash calls <em>sprintf format</em>. This format
enables you to refer to field values from within other strings. For example, the
statsd output has an <em>increment</em> setting that enables you to keep a count of
apache logs by status code:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">output {
  statsd {
    increment =&gt; "apache.%{[response][status]}"
  }
}</pre>
</div>
<p>You can also format times using this sprintf format. Instead of specifying a field name, use the <code class="literal">+FORMAT</code> syntax where <code class="literal">FORMAT</code> is a <a href="http://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html" class="ulink" target="_top">time format</a>.</p>
<p>For example, if you want to use the file output to write to logs based on the
hour and the <em>type</em> field:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">output {
  file {
    path =&gt; "/var/log/%{type}.%{+yyyy.MM.dd.HH}"
  }
}</pre>
</div>
<h4><a id="conditionals"></a>Conditionals<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/master/docs/static/configuration.asciidoc">edit</a></h4>
<p>Sometimes you only want to filter or output an event under
certain conditions. For that, you can use a conditional.</p>
<p>Conditionals in Logstash look and act the same way they do in programming
languages. Conditionals support <code class="literal">if</code>, <code class="literal">else if</code> and <code class="literal">else</code> statements
and can be nested.</p>
<p>The conditional syntax is:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">if EXPRESSION {
  ...
} else if EXPRESSION {
  ...
} else {
  ...
}</pre>
</div>
<p>What&#8217;s an expression? Comparison tests, boolean logic, and so on!</p>
<p>You can use the following comparison operators:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
equality: <code class="literal">==</code>,  <code class="literal">!=</code>,  <code class="literal">&lt;</code>,  <code class="literal">&gt;</code>,  <code class="literal">&lt;=</code>, <code class="literal">&gt;=</code>
</li>
<li class="listitem">
regexp: <code class="literal">=~</code>, <code class="literal">!~</code>
</li>
<li class="listitem">
inclusion: <code class="literal">in</code>, <code class="literal">not in</code>
</li>
</ul>
</div>
<p>The supported boolean operators are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">and</code>, <code class="literal">or</code>, <code class="literal">nand</code>, <code class="literal">xor</code>
</li>
</ul>
</div>
<p>The supported unary operators are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">!</code>
</li>
</ul>
</div>
<p>Expressions can be long and complex. Expressions can contain other expressions,
you can negate expressions with <code class="literal">!</code>, and you can group them with parentheses <code class="literal">(...)</code>.</p>
<p>For example, the following conditional uses the mutate filter to remove the field <code class="literal">secret</code> if the field
<code class="literal">action</code> has a value of <code class="literal">login</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">filter {
  if [action] == "login" {
    mutate { remove =&gt; "secret" }
  }
}</pre>
</div>
<p>You can specify multiple expressions in a single condition:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">output {
  # Send production errors to pagerduty
  if [loglevel] == "ERROR" and [deployment] == "production" {
    pagerduty {
    ...
    }
  }
}</pre>
</div>
<p>The <code class="literal">in</code> conditional enables you to compare against the value of a field:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">filter {
  if [foo] in [foobar] {
    mutate { add_tag =&gt; "field in field" }
  }
  if [foo] in "foo" {
    mutate { add_tag =&gt; "field in string" }
  }
  if "hello" in [greeting] {
    mutate { add_tag =&gt; "string in field" }
  }
  if [foo] in ["hello", "world", "foo"] {
    mutate { add_tag =&gt; "field in list" }
  }
  if [missing] in [alsomissing] {
    mutate { add_tag =&gt; "shouldnotexist" }
  }
  if !("foo" in ["hello", "world"]) {
    mutate { add_tag =&gt; "shouldexist" }
  }
}</pre>
</div>
<p>You use the <code class="literal">not in</code> conditional the same way. For example,
you could use <code class="literal">not in</code> to only route events to elasticsearch
when <code class="literal">grok</code> is successful:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">output {
  if "_grokparsefailure" not in [tags] {
    elasticsearch { ... }
  }
}</pre>
</div>
<p>For more complex examples, see <a class="xref" href="config-examples.html#using-conditionals" title="Using Conditionals">Using Conditionals</a>.</p>
<h4><a id="metadata"></a>The @metadata field<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/master/docs/static/configuration.asciidoc">edit</a></h4>
<p>In Logstash 1.5 there is a new, special field, called <code class="literal">@metadata</code>.  The contents
of <code class="literal">@metadata</code> will not be part of any of your events at output time, which
makes it great to use for conditionals, or extending and building event fields
with field reference and sprintf formatting.</p>
<p>The following configuration file will yield events from STDIN.  Whatever is
typed will become the <code class="literal">message</code> field in the event.  The <code class="literal">mutate</code> events in the
filter block will add a few fields, some nested in the <code class="literal">@metadata</code> field.</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">input { stdin { } }

filter {
  mutate { add_field =&gt; { "show" =&gt; "This data will be in the output" } }
  mutate { add_field =&gt; { "[@metadata][test]" =&gt; "Hello" } }
  mutate { add_field =&gt; { "[@metadata][no_show]" =&gt; "This data will not be in the output" } }
}

output {
  if [@metadata][test] == "Hello" {
    stdout { codec =&gt; rubydebug }
  }
}</pre>
</div>
<p>Let&#8217;s see what comes out:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">$ bin/logstash -f ../test.conf
Logstash startup completed
asdf
{
       "message" =&gt; "asdf",
      "@version" =&gt; "1",
    "@timestamp" =&gt; "2015-03-18T23:09:29.595Z",
          "host" =&gt; "example.com",
          "show" =&gt; "This data will be in the output"
}</pre>
</div>
<p>The "asdf" typed in became the <code class="literal">message</code> field contents, and the conditional
successfully evaluated the contents of the <code class="literal">test</code> field nested within the
<code class="literal">@metadata</code> field.  But the output did not show a field called <code class="literal">@metadata</code>, or
its contents.</p>
<p>The <code class="literal">rubydebug</code> codec allows you to reveal the contents of the <code class="literal">@metadata</code> field
if you add a config flag, <code class="literal">metadata =&gt; true</code>:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">    stdout { codec =&gt; rubydebug { metadata =&gt; true } }</pre>
</div>
<p>Let&#8217;s see what the output looks like with this change:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">$ bin/logstash -f ../test.conf
Logstash startup completed
asdf
{
       "message" =&gt; "asdf",
      "@version" =&gt; "1",
    "@timestamp" =&gt; "2015-03-18T23:10:19.859Z",
          "host" =&gt; "example.com",
          "show" =&gt; "This data will be in the output",
     "@metadata" =&gt; {
           "test" =&gt; "Hello",
        "no_show" =&gt; "This data will not be in the output"
    }
}</pre>
</div>
<p>Now you can see the <code class="literal">@metadata</code> field and its sub-fields.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only the <code class="literal">rubydebug</code> codec allows you to show the contents of the
<code class="literal">@metadata</code> field.</p>
</div>
</div>
<p>Make use of the <code class="literal">@metadata</code> field any time you need a temporary field but do not
want it to be in the final output.</p>
<p>Perhaps one of the most common use cases for this new field is with the <code class="literal">date</code>
filter and having a temporary timestamp.</p>
<p>This configuration file has been simplified, but uses the timestamp format
common to Apache and Nginx web servers.  In the past, you&#8217;d have to delete
the timestamp field yourself, after using it to overwrite the <code class="literal">@timestamp</code>
field.  With the <code class="literal">@metadata</code> field, this is no longer necessary:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">input { stdin { } }

filter {
  grok { match =&gt; [ "message", "%{HTTPDATE:[@metadata][timestamp]}" ] }
  date { match =&gt; [ "[@metadata][timestamp]", "dd/MMM/yyyy:HH:mm:ss Z" ] }
}

output {
  stdout { codec =&gt; rubydebug }
}</pre>
</div>
<p>Notice that this configuration puts the extracted date into the
<code class="literal">[@metadata][timestamp]</code> field in the <code class="literal">grok</code> filter.  Let&#8217;s feed this
configuration a sample date string and see what comes out:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">$ bin/logstash -f ../test.conf
Logstash startup completed
02/Mar/2014:15:36:43 +0100
{
       "message" =&gt; "02/Mar/2014:15:36:43 +0100",
      "@version" =&gt; "1",
    "@timestamp" =&gt; "2014-03-02T14:36:43.000Z",
          "host" =&gt; "example.com"
}</pre>
</div>
<p>That&#8217;s it!  No extra fields in the output, and a cleaner config file because you
do not have to delete a "timestamp" field after conversion in the <code class="literal">date</code> filter.</p>
<p>Another use case is the CouchDB Changes input plugin (See
<a href="https://github.com/logstash-plugins/logstash-input-couchdb_changes" class="ulink" target="_top">https://github.com/logstash-plugins/logstash-input-couchdb_changes</a>).
This plugin automatically captures CouchDB document field metadata into the
<code class="literal">@metadata</code> field within the input plugin itself.  When the events pass through
to be indexed by Elasticsearch, the Elasticsearch output plugin allows you to
specify the <code class="literal">action</code> (delete, update, insert, etc.) and the <code class="literal">document_id</code>, like
this:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">output {
  elasticsearch {
    action =&gt; "%{[@metadata][action]}"
    document_id =&gt; "%{[@metadata][_id]}"
    hosts =&gt; ["example.com"]
    index =&gt; "index_name"
    protocol =&gt; "http"
  }
}</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="configuration-file-structure.html">« Structure of a Config File</a>
</span>
<span class="next">
<a href="config-examples.html">Logstash Configuration Examples »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
