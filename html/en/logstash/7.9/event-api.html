<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Event API | Logstash Reference [7.9] | Elastic</title>
<link rel="home" href="index.html" title="Logstash Reference [7.9]"/>
<link rel="up" href="working-with-plugins.html" title="Working with plugins"/>
<link rel="prev" href="private-rubygem.html" title="Private Gem Repositories"/>
<link rel="next" href="plugin-integrations.html" title="Integration plugins"/>
<meta name="DC.type" content="Learn/Docs/Logstash/Reference/7.9"/>
<meta name="DC.subject" content="Logstash"/>
<meta name="DC.identifier" content="7.9"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Logstash Reference [7.9]</a></span>
»
<span class="breadcrumb-link"><a href="working-with-plugins.html">Working with plugins</a></span>
»
<span class="breadcrumb-node">Event API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="private-rubygem.html">« Private Gem Repositories</a>
</span>
<span class="next">
<a href="plugin-integrations.html">Integration plugins »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="event-api"></a>Event API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/7.9/docs/static/plugin-manager.asciidoc">edit</a></h2>
</div></div></div>
<p>This section is targeted for plugin developers and users of Logstash&#8217;s Ruby filter. Below we document recent
changes (starting with version 5.0) in the way users have been accessing Logstash&#8217;s event based data in
custom plugins and in the Ruby filter. Note that <a class="xref" href="event-dependent-configuration.html" title="Accessing Event Data and Fields in the Configuration">Accessing Event Data and Fields in the Configuration</a>
data flow in Logstash&#8217;s config files&#8201;&#8212;&#8201;using <a class="xref" href="event-dependent-configuration.html#logstash-config-field-references" title="Field References">Field References</a>&#8201;&#8212;&#8201;is
not affected by this change, and will continue to use existing syntax.</p>
<h4><a id="_event_object"></a>Event Object<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/7.9/docs/static/plugin-manager.asciidoc">edit</a></h4>
<p>Event is the main object that encapsulates data flow internally in Logstash and provides an API for the plugin
developers to interact with the event&#8217;s content. Typically, this API is used in plugins and in a Ruby filter to
retrieve data and use it for transformations. Event object contains the original data sent to Logstash and any additional
fields created during Logstash&#8217;s filter stages.</p>
<p>In 5.0, we&#8217;ve re-implemented the Event class and its supporting classes in pure Java. Since Event is a critical component
in data processing,  a rewrite in Java improves performance and provides efficient serialization when storing data on disk. For the most part, this change aims at keeping backward compatibility and is transparent to the users. To this extent we&#8217;ve updated and published most of the plugins in Logstash&#8217;s ecosystem to adhere to the new API changes. However, if you are maintaining a custom plugin, or have a Ruby filter, this change will affect you. The aim of this guide is to describe the new API and provide examples to migrate to the new changes.</p>
<h4><a id="_event_api"></a>Event API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/7.9/docs/static/plugin-manager.asciidoc">edit</a></h4>
<p>Prior to version 5.0, developers could access and manipulate event data by directly using Ruby hash syntax. For
example, <code class="literal">event[field] = foo</code>. While this is powerful, our goal is to abstract the internal implementation details
and provide well-defined getter and setter APIs.</p>
<p><span class="strong strong"><strong>Get API</strong></span></p>
<p>The getter is a read-only access of field-based data in an Event.</p>
<p><span class="strong strong"><strong>Syntax:</strong></span> <code class="literal">event.get(field)</code></p>
<p><span class="strong strong"><strong>Returns:</strong></span> Value for this field or nil if the field does not exist. Returned values could be a string,
numeric or timestamp scalar value.</p>
<p><code class="literal">field</code> is a structured field sent to Logstash or created after the transformation process. <code class="literal">field</code> can also
be a nested <a class="xref" href="field-references-deepdive.html" title="Field References Deep Dive">field reference</a> such as <code class="literal">[field][bar]</code>.</p>
<p>Examples:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">event.get("foo" ) # =&gt; "baz"
event.get("[foo]") # =&gt; "zab"
event.get("[foo][bar]") # =&gt; 1
event.get("[foo][bar]") # =&gt; 1.0
event.get("[foo][bar]") # =&gt;  [1, 2, 3]
event.get("[foo][bar]") # =&gt; {"a" =&gt; 1, "b" =&gt; 2}
event.get("[foo][bar]") # =&gt;  {"a" =&gt; 1, "b" =&gt; 2, "c" =&gt; [1, 2]}</pre>
</div>
<p>Accessing @metadata</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">event.get("[@metadata][foo]") # =&gt; "baz"</pre>
</div>
<p><span class="strong strong"><strong>Set API</strong></span></p>
<p>This API can be used to mutate data in an Event.</p>
<p><span class="strong strong"><strong>Syntax:</strong></span> <code class="literal">event.set(field, value)</code></p>
<p><span class="strong strong"><strong>Returns:</strong></span>  The current Event  after the mutation, which can be used for chainable calls.</p>
<p>Examples:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">event.set("foo", "baz")
event.set("[foo]", "zab")
event.set("[foo][bar]", 1)
event.set("[foo][bar]", 1.0)
event.set("[foo][bar]", [1, 2, 3])
event.set("[foo][bar]", {"a" =&gt; 1, "b" =&gt; 2})
event.set("[foo][bar]", {"a" =&gt; 1, "b" =&gt; 2, "c" =&gt; [1, 2]})
event.set("[@metadata][foo]", "baz")</pre>
</div>
<p>Mutating a collection after setting it in the Event has an undefined behaviour and is not allowed.</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">h = {"a" =&gt; 1, "b" =&gt; 2, "c" =&gt; [1, 2]}
event.set("[foo][bar]", h)

h["c"] = [3, 4]
event.get("[foo][bar][c]") # =&gt; undefined

Suggested way of mutating collections:

h = {"a" =&gt; 1, "b" =&gt; 2, "c" =&gt; [1, 2]}
event.set("[foo][bar]", h)

h["c"] = [3, 4]
event.set("[foo][bar]", h)

# Alternatively,
event.set("[foo][bar][c]", [3, 4])</pre>
</div>
<h4><a id="_ruby_filter"></a>Ruby Filter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/7.9/docs/static/plugin-manager.asciidoc">edit</a></h4>
<p>The <a class="xref" href="plugins-filters-ruby.html" title="Ruby filter plugin">Ruby Filter</a> can be used to execute any ruby code and manipulate event data using the
API described above. For example, using the new API:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">filter {
  ruby {
    code =&gt; 'event.set("lowercase_field", event.get("message").downcase)'
  }
}</pre>
</div>
<p>This filter will lowercase the <code class="literal">message</code> field, and set it to a new field called <code class="literal">lowercase_field</code></p>
</div>
<div class="navfooter">
<span class="prev">
<a href="private-rubygem.html">« Private Gem Repositories</a>
</span>
<span class="next">
<a href="plugin-integrations.html">Integration plugins »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
