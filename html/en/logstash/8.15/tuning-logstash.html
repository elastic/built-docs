<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tuning and profiling logstash pipeline performance | Logstash Reference [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Tuning and profiling logstash pipeline performance | Logstash Reference [8.15]">

<link rel="home" href="index.html" title="Logstash Reference [8.15]"/>
<link rel="up" href="performance-tuning.html" title="Performance tuning"/>
<link rel="prev" href="performance-troubleshooting.html" title="Performance troubleshooting"/>
<link rel="next" href="monitoring-with-ea.html" title="Monitoring Logstash with Elastic Agent"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Logstash"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Logstash/Reference/8.15"/>
<meta name="DC.subject" content="Logstash"/>
<meta name="DC.identifier" content="8.15"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="performance-troubleshooting.html">« Performance troubleshooting</a>
</span>
<span class="next">
<a href="monitoring-with-ea.html">Monitoring Logstash with Elastic Agent »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Logstash Reference [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="performance-tuning.html">Performance tuning</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Tuning and profiling logstash pipeline performance</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/8.15/docs/static/performance-checklist.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="tuning-logstash"></a>Tuning and profiling logstash pipeline performance<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/8.15/docs/static/performance-checklist.asciidoc">edit</a></h2>
</div></div></div>
<p>The <a class="xref" href="node-stats-api.html#flow-stats" title="Flow stats">Flow Metrics</a> in Logstash&#8217;s Monitoring API can provide excellent insight into how events are flowing through your pipelines.
They can reveal whether your pipeline is constrained for resources, which parts of your pipeline are consuming the most resources, and provide useful feedback when tuning.</p>
<h4><a id="tuning-logstash-worker-utilization"></a>Worker utilization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/8.15/docs/static/performance-checklist.asciidoc">edit</a></h4>
<p>When a pipeline&#8217;s <code class="literal">worker_utilization</code> flow metric is consistently near 100, all of its workers are occupied processing the filters and outputs of the pipeline.
We can see <em>which</em> plugins in the pipeline are consuming the available worker capacity by looking at the plugin-level <code class="literal">worker_utilization</code> and <code class="literal">worker_millis_per_event</code> flow metrics.
Using this information, we can gain intuition about how to tune the pipeline&#8217;s settings to add resources, how to find and eliminate wasteful computation, or realize the need to scale up/out the capacity of downstream destinations.</p>
<p>In general, plugins fit into one of two categories:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>CPU-bound</strong></span>: plugins that perform computation on the contents of events <em>without</em> the use of the network or disk IO tend to benefit from incrementally increasing <code class="literal">pipeline.workers</code> as long as the process has available CPU; once CPU is exhausted additional concurrency can result in <em>lower</em> throughput as the pipeline workers contend for resources and the amount of time spent in context-switching increases.
</li>
<li class="listitem">
<span class="strong strong"><strong>IO-bound</strong></span>: plugins that use the network to either enrich events or transmit events tend to benefit from incrementally increasing <code class="literal">pipeline.workers</code> and/or tuning the <code class="literal">pipeline.batch.*</code> parameters described below.
This allows them to make better use of network resources, as long as those external services are not exerting back-pressure (even if Logstash is using nearly all of its available CPU).
</li>
</ul>
</div>
<p>The further a pipeline&#8217;s <code class="literal">worker_utilization</code> is from 100, the more time its workers are spending waiting for events to arrive in the queue.
Because the volume of data in most pipelines is often inconsistent, the goal should be to tune the pipeline such that it has the resources to avoid propagating back-pressure to its inputs during peak periods.</p>
<h4><a id="tuning-logstash-queue-backpressure"></a>Queue back-pressure<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/8.15/docs/static/performance-checklist.asciidoc">edit</a></h4>
<p>When a pipeline receives events faster than it can process them, the inputs eventually experience back-pressure that prevents them from receiving additional events.
Depending on the input plugin being used, back-pressure can either propagate upstream or lead to data loss.</p>
<p>A pipeline&#8217;s <code class="literal">queue_backpressure</code> flow metric reflects how much time the inputs are spending attempting to push events into the queue.
The metric isn&#8217;t precisely comparable across pipelines, but instead allows you to compare a single pipeline&#8217;s current behaviour to <em>itself</em> over time.
When this metric is growing, look <em>downstream</em> at the pipeline&#8217;s filters and outputs to see if they are using resources effectively, have sufficient resources allocated, or are experiencing back-pressure of their own.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>A persisted queue offers durability guarantees and can absorb back-pressure for longer than the default in-memory queue, but once it is full it too propagates back-pressure.
The <code class="literal">queue_persisted_growth_events</code> flow metric is useful measure of how much back-pressure is being actively absorbed by the persisted queue, and should trend toward zero (or less) over the pipeline&#8217;s lifetime.
Negative numbers indicate that the queue is <em>shrinking</em>, and that the workers are catching up on lag that had previously developed.</p>
</div>
</div>
<h4><a id="tuning-logstash-settings"></a>Tuning-related settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/8.15/docs/static/performance-checklist.asciidoc">edit</a></h4>
<p>The Logstash defaults are chosen to provide fast, safe performance for most users.
However if you notice performance issues, you may need to modify some of the defaults.
Logstash provides the following configurable options for tuning pipeline performance: <code class="literal">pipeline.workers</code>, <code class="literal">pipeline.batch.size</code>, and <code class="literal">pipeline.batch.delay</code>.</p>
<p>For more information about setting these options, see <a class="xref" href="logstash-settings-file.html" title="logstash.yml">logstash.yml</a>.</p>
<p>Make sure you&#8217;ve read the <a class="xref" href="performance-troubleshooting.html" title="Performance troubleshooting">Performance troubleshooting</a> before modifying these options.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">pipeline.workers</code> setting determines how many threads to run for filter and output processing.
If you find that events are backing up, or that the CPU is not saturated, consider increasing the value of this parameter to make better use of available processing power.
Good results can even be found increasing this number past the number of available processors as these threads may spend significant time in an I/O wait state when writing to external systems.
</li>
<li class="listitem">
The <code class="literal">pipeline.batch.size</code> setting defines the maximum number of events an individual worker thread collects from the queue before attempting to execute filters and outputs.
Larger batch sizes are generally more efficient, but increase memory overhead.
Output plugins can process each batch as a logical unit.
The Elasticsearch output, for example, attempts to send a single <a href="/guide/en/elasticsearch/reference/current/docs-bulk.html" class="ulink" target="_top">bulk request</a> for each batch received.
Tuning the <code class="literal">pipeline.batch.size</code> setting adjusts the size of bulk requests sent to Elasticsearch.
</li>
<li class="listitem">
The <code class="literal">pipeline.batch.delay</code> setting rarely needs to be tuned.
This setting adjusts the latency of the Logstash pipeline.
Pipeline batch delay is the maximum amount of time in milliseconds that a pipeline worker waits for each new event while its current batch is not yet full.
After this time elapses without any more events becoming available, the worker begins to execute filters and outputs.
The maximum time that the worker waits between receiving an event and processing that event in a filter is the product of the <code class="literal">pipeline.batch.delay</code> and <code class="literal">pipeline.batch.size</code> settings.
</li>
</ul>
</div>
<h4><a id="_notes_on_pipeline_configuration_and_performance"></a>Notes on pipeline configuration and performance<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/8.15/docs/static/performance-checklist.asciidoc">edit</a></h4>
<p>If you plan to modify the default pipeline settings, take into account the
following suggestions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The total number of inflight events is determined by the product of the  <code class="literal">pipeline.workers</code> and <code class="literal">pipeline.batch.size</code> settings.
This product is referred to as the <em>inflight count</em>.
Keep the value of the inflight count in mind as you adjust the <code class="literal">pipeline.workers</code> and <code class="literal">pipeline.batch.size</code> settings.
Pipelines that intermittently receive large events at irregular intervals require sufficient memory to handle these spikes.
Set the JVM heap space accordingly in the <code class="literal">jvm.options</code> config file (See <a class="xref" href="config-setting-files.html" title="Logstash Configuration Files">Logstash Configuration Files</a> for more info).
</li>
<li class="listitem">
Measure each change to make sure it increases, rather than decreases, performance.
</li>
<li class="listitem">
Ensure that you leave enough memory available to cope with a sudden increase in event size.
For example, an application that generates exceptions that are represented as large blobs of text.
</li>
<li class="listitem">
The number of workers may be set higher than the number of CPU cores since outputs often spend idle time in I/O wait conditions.
</li>
<li class="listitem">
Threads in Java have names and you can use the <code class="literal">jstack</code>, <code class="literal">top</code>, and the VisualVM graphical tools to figure out which resources a given thread uses.
</li>
<li class="listitem">
On Linux platforms, Logstash labels its threads with descriptive names.
For example, inputs show up as <code class="literal">[base]&lt;inputname</code>, and pipeline workers show up as <code class="literal">[base]&gt;workerN</code>, where N is an integer.
Where possible, other threads are also labeled to help you identify their purpose.
</li>
</ul>
</div>
<h4><a id="profiling-the-heap"></a>Profiling the heap<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/8.15/docs/static/performance-checklist.asciidoc">edit</a></h4>
<p>When tuning Logstash you may have to adjust the heap size.
You can use the <a href="https://visualvm.github.io/" class="ulink" target="_top">VisualVM</a> tool to profile the heap.
The <span class="strong strong"><strong>Monitor</strong></span> pane in particular is useful for checking whether your heap allocation is sufficient for the current workload.
The screenshots below show sample <span class="strong strong"><strong>Monitor</strong></span> panes.
The first pane examines a Logstash instance configured with too many inflight events.
The second pane examines a Logstash instance configured with an appropriate amount of inflight events.
Note that the specific batch sizes used here are most likely not applicable to your specific workload, as the memory demands of Logstash vary in large part based on the type of messages you are sending.</p>
<div class="imageblock">
<div class="content">
<img src="static/images/pipeline_overload.png" alt="pipeline overload">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="static/images/pipeline_correct_load.png" alt="pipeline correct load">
</div>
</div>
<p>In the first example we see that the CPU isn’t being used very efficiently.
In fact, the JVM is often times having to stop the VM for “full GCs”.
Full garbage collections are a common symptom of excessive memory pressure.
This is visible in the spiky pattern on the CPU chart.
In the more efficiently configured example, the GC graph pattern is more smooth, and the CPU is used in a more uniform manner.
You can also see that there is ample headroom between the allocated heap size, and the maximum allowed, giving the JVM GC a lot of room to work with.</p>
<p>Examining the in-depth GC statistics with a tool similar to the excellent <a href="https://visualvm.github.io/plugins.html" class="ulink" target="_top">VisualGC</a> plugin shows that the over-allocated VM spends very little time in the efficient Eden GC, compared to the time spent in the more resource-intensive Old Gen “Full” GCs.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>As long as the GC pattern is acceptable, heap sizes that occasionally increase to the maximum are acceptable.
      Such heap size spikes happen in response to a burst of large events passing through the pipeline.
      In general practice, maintain a gap between the used amount of heap memory and the maximum.
      This document is not a comprehensive guide to JVM GC tuning.
      Read the official <a href="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/index.html" class="ulink" target="_top">Oracle guide</a> for more information on the topic.
      We also recommend reading <a href="https://www.semicomplete.com/blog/geekery/debugging-java-performance/" class="ulink" target="_top">Debugging Java Performance</a>.</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="performance-troubleshooting.html">« Performance troubleshooting</a>
</span>
<span class="next">
<a href="monitoring-with-ea.html">Monitoring Logstash with Elastic Agent »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
