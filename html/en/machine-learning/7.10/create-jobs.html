<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Create anomaly detection jobs | Machine Learning in the Elastic Stack [7.10] | Elastic</title>
<meta class="elastic" name="content" content="Create anomaly detection jobs | Machine Learning in the Elastic Stack [7.10]">

<link rel="home" href="index.html" title="Machine Learning in the Elastic Stack [7.10]"/>
<link rel="up" href="ml-configuration.html" title="Configure anomaly detection"/>
<link rel="prev" href="ml-configuration.html" title="Configure anomaly detection"/>
<link rel="next" href="stopping-ml.html" title="Stop machine learning anomaly detection"/>
<meta class="elastic" name="product_version" content="7.10"/>
<meta class="elastic" name="product_name" content="Machine Learning"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Machine Learning/7.10"/>
<meta name="DC.subject" content="Machine Learning"/>
<meta name="DC.identifier" content="7.10"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Machine Learning in the Elastic Stack [7.10]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="xpack-ml.html">Anomaly detection</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-configuration.html">Configure anomaly detection</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-configuration.html">« Configure anomaly detection</a>
</span>
<span class="next">
<a href="stopping-ml.html">Stop machine learning anomaly detection »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="create-jobs"></a>Create anomaly detection jobs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.10/docs/en/stack/ml/anomaly-detection/create-jobs.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>Anomaly detection jobs contain the configuration information and metadata
necessary to perform an analytics task.</p>
<p>You can create anomaly detection jobs by using the
<a href="/guide/en/elasticsearch/reference/7.10/ml-put-job.html" class="ulink" target="_top">Create anomaly detection jobs API</a>. Kibana also provides the
following wizards to make it easier to create jobs:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-create-job.jpg" alt="Create New Job">
</div>
</div>
<p>A <em>single metric job</em> is a simple job that contains a single <em>detector</em>. A
detector defines the type of analysis that will occur and which fields to
analyze. In addition to limiting the number of detectors, the single metric job
creation wizard omits many of the more advanced configuration options.</p>
<p>A <em>multi-metric job</em> can contain more than one detector, which is more efficient
than running multiple jobs against the same data.</p>
<p>A <em>population job</em> detects activity that is unusual compared to the behavior of
the population. For more information, see <a class="xref" href="ml-configuring-populations.html" title="Performing population analysis">Performing population analysis</a>.</p>
<p>A <em>categorization job</em> groups log messages into categories and uses
<a class="xref" href="ml-count-functions.html" title="Count functions">count</a> or <a class="xref" href="ml-rare-functions.html" title="Rare functions">rare</a> functions to detect
anomalies within them. See <a class="xref" href="ml-configuring-categories.html" title="Detecting anomalous categories of data">Detecting anomalous categories of data</a>.</p>
<p>An <em>advanced job</em> can contain multiple detectors and enables you to configure all
job settings.</p>
<p>Kibana can also recognize certain types of data and provide specialized wizards
for that context. For example, if you added the sample web log data set, the
following wizard appears:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-sample.jpg" alt="A screenshot of the Kibana sample data web log job creation wizard">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Alternatively, after you load a sample data set on the Kibana home page, you
can click <span class="strong strong"><strong>View data</strong></span> &gt; <span class="strong strong"><strong>ML jobs</strong></span>. There are anomaly detection jobs for both the sample
eCommerce orders data set and the sample web logs data set.</p>
</div>
</div>
<p>If you use Elastic APM, Kibana also detects this data and provides wizards for
anomaly detection jobs. For example:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-apm.jpg" alt="A screenshot of the Kibana APM job creation wizard">
</div>
</div>
<p>If you use <a href="/guide/en/beats/filebeat/7.10/index.html" class="ulink" target="_top">Filebeat</a>
to ship access logs from your
<a href="http://nginx.org/" class="ulink" target="_top">Nginx</a> and <a href="https://httpd.apache.org/" class="ulink" target="_top">Apache</a> HTTP servers to
Elasticsearch and store it using fields and datatypes from the
<a href="/guide/en/ecs/1.6/ecs-reference.html" class="ulink" target="_top">Elastic Common Schema (ECS)</a>, the following wizards
appear:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-filebeat.jpg" alt="A screenshot of the Filebeat job creation wizards">
</div>
</div>
<p>If you use <a href="/guide/en/beats/auditbeat/7.10/index.html" class="ulink" target="_top">Auditbeat</a> to audit process
activity on your systems, the following wizards appear:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-auditbeat.jpg" alt="A screenshot of the Auditbeat job creation wizards">
</div>
</div>
<p>Likewise, if you use the <a href="/guide/en/beats/metricbeat/7.10/metricbeat-module-system.html" class="ulink" target="_top">Metricbeat system module</a> to monitor your servers, the following
wizards appear:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-metricbeat.jpg" alt="A screenshot of the Metricbeat job creation wizards">
</div>
</div>
<p>These wizards create anomaly detection jobs, dashboards, searches, and visualizations
that are customized to help you analyze your Auditbeat, Filebeat, and
Metricbeat data.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your data is located outside of Elasticsearch, you cannot use Kibana to create
your jobs and you cannot use datafeeds to retrieve your data in real time.
Anomaly detection is still possible, however, by using APIs to
create and manage jobs and post data to them. For more information, see
<a href="/guide/en/elasticsearch/reference/7.10/ml-apis.html" class="ulink" target="_top">Machine learning anomaly detection APIs</a>.</p>
</div>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="job-tips"></a>Machine learning job tips<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.10/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h3>
</div></div></div>

<p>When you create an anomaly detection job in Kibana, the job creation wizards can
provide advice based on the characteristics of your data. By heeding these
suggestions, you can create jobs that are more likely to produce insightful machine learning
results.</p>
<h5><a id="bucket-span"></a>Bucket span<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.10/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h5>
<p>The bucket span is the time interval that machine learning analytics use to summarize and
model data for your job. When you create an anomaly detection job in Kibana, you can
choose to estimate a bucket span value based on your data characteristics.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The bucket span must contain a valid time interval. See
<a href="/guide/en/elasticsearch/reference/7.10/common-options.html#time-units" class="ulink" target="_top">Time units</a>.</p>
</div>
</div>
<p>If you choose a value that is larger than one day or is significantly different
than the estimated value, you receive an informational message. For more
information about choosing an appropriate bucket span, see <a class="xref" href="ml-buckets.html" title="Buckets">Buckets</a>.</p>
<h5><a id="cardinality"></a>Cardinality<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.10/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h5>
<p>If there are logical groupings of related entities in your data, machine learning analytics
can make data models and generate results that take these groupings into
consideration. For example, you might choose to split your data by user ID and
detect when users are accessing resources differently than they usually do.</p>
<p>If the field that you use to split your data has many different values, the
job uses more memory resources. In particular, if the cardinality of the
<code class="literal">by_field_name</code>, <code class="literal">over_field_name</code>, or <code class="literal">partition_field_name</code> is greater than
1000, you are advised that there might be high memory usage.</p>
<p>Likewise if you are performing population analysis and the cardinality of the
<code class="literal">over_field_name</code> is below 10, you are advised that this might not be a suitable
field to use. For more information, see <a class="xref" href="ml-configuring-populations.html" title="Performing population analysis">Performing population analysis</a>.</p>
<h5><a id="detectors"></a>Detectors<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.10/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h5>
<p>Each anomaly detection job must have one or more <em>detectors</em>. A detector applies an
analytical function to specific fields in your data. If your job does not
contain a  detector or the detector does not contain a
<a class="xref" href="ml-functions.html" title="Function reference">valid function</a>, you receive an error.</p>
<p>If a job contains duplicate detectors, you also receive an error. Detectors are
duplicates if they have the same <code class="literal">function</code>, <code class="literal">field_name</code>, <code class="literal">by_field_name</code>,
<code class="literal">over_field_name</code> and <code class="literal">partition_field_name</code>.</p>
<h5><a id="influencers"></a>Influencers<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.10/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h5>
<p>See <a class="xref" href="ml-influencers.html" title="Influencers">Influencers</a>.</p>
<h5><a id="model-memory-limits"></a>Model memory limits<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.10/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h5>
<p>For each anomaly detection job, you can optionally specify a <code class="literal">model_memory_limit</code>, which
is the approximate maximum amount of memory resources that are required for
analytical processing. The default value is 1 GB. Once this limit is approached,
data pruning becomes more aggressive. Upon exceeding this limit, new entities
are not modeled.</p>
<p>You can also optionally specify the <code class="literal">xpack.ml.max_model_memory_limit</code> setting.
By default, it&#8217;s not set, which means there is no upper bound on the acceptable
<code class="literal">model_memory_limit</code> values in your jobs.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you set the <code class="literal">model_memory_limit</code> too high, it will be impossible to open
the job; jobs cannot be allocated to nodes that have insufficient memory to run
them.</p>
</div>
</div>
<p>If the estimated model memory limit for an anomaly detection job is greater than the
model memory limit for the job or the maximum model memory limit for the cluster,
the job creation wizards in Kibana generate a warning. If the estimated memory
requirement is only a little higher than the <code class="literal">model_memory_limit</code>, the job will
probably produce useful results. Otherwise, the actions you take to address
these warnings vary depending on the resources available in your cluster:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If you are using the default value for the <code class="literal">model_memory_limit</code> and the machine learning
nodes in the cluster have lots of memory, the best course of action might be to
simply increase the job&#8217;s <code class="literal">model_memory_limit</code>. Before doing this, however,
double-check that the chosen analysis makes sense. The default
<code class="literal">model_memory_limit</code> is relatively low to avoid accidentally creating a job that
uses a huge amount of memory.
</li>
<li class="listitem">
<p>If the machine learning nodes in the cluster do not have sufficient memory to accommodate
a job of the estimated size, the only options are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add bigger machine learning nodes to the cluster, or
</li>
<li class="listitem">
Accept that the job will hit its memory limit and will not necessarily find
all the anomalies it could otherwise find.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>If you are using Elastic Cloud Enterprise or the hosted Elasticsearch Service on Elastic Cloud,
<code class="literal">xpack.ml.max_model_memory_limit</code> is set to prevent you from creating jobs
that cannot be allocated to any machine learning nodes in the cluster. If you find that you
cannot increase <code class="literal">model_memory_limit</code> for your machine learning jobs, the solution is to
increase the size of the machine learning nodes in your cluster.</p>
<h5><a id="dedicated-indices"></a>Dedicated indices<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.10/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h5>
<p>For each anomaly detection job, you can optionally specify a dedicated index to store
the anomaly detection results. As anomaly detection jobs may produce a large amount
of results (for example, jobs with many time series, small bucket span, or with
long running period), it is recommended to use a dedicated results index by
choosing the <span class="strong strong"><strong>Use dedicated index</strong></span> option in Kibana or specifying the
<code class="literal">results_index_name</code> via the <a href="/guide/en/elasticsearch/reference/7.10/ml-put-job.html" class="ulink" target="_top">Create anomaly detection jobs API</a>.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ml-configuration.html">« Configure anomaly detection</a>
</span>
<span class="next">
<a href="stopping-ml.html">Stop machine learning anomaly detection »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
