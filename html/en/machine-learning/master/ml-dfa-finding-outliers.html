<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="An introduction to machine learning outlier detection, which enables you to find unusual data points in a data set compared to the normal data points.">
<meta name="keywords" content="ML, Elastic Stack, data frame analytics, outlier detection">
<title>Finding outliers | Machine Learning in the Elastic Stack [master] | Elastic</title>
<link rel="home" href="index.html" title="Machine Learning in the Elastic Stack [master]"/>
<link rel="up" href="ml-dfanalytics.html" title="Data frame analytics"/>
<link rel="prev" href="ml-dfa-overview.html" title="Data frame analytics overview"/>
<link rel="next" href="ml-dfa-concepts.html" title="Advanced concepts"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Machine Learning/master"/>
<meta name="DC.subject" content="Machine Learning"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2021 Elasticsearch B.V. Copying, publishing and/or distributing without written permission is strictly prohibited.-->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Machine Learning in the Elastic Stack [master]</a></span>
»
<span class="breadcrumb-link"><a href="ml-dfanalytics.html">Data frame analytics</a></span>
»
<span class="breadcrumb-node">Finding outliers</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-dfa-overview.html">« Data frame analytics overview</a>
</span>
<span class="next">
<a href="ml-dfa-concepts.html">Advanced concepts »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-dfa-finding-outliers"></a>Finding outliers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>This page contains a conceptual overview of outlier detection in the Elastic Stack and a
simple <a class="xref" href="ml-dfa-finding-outliers.html#ecommerce-outliers" title="Detecting unusual behavior in the eCommerce data set">example</a> of how to use it.</p>
<h3><a id="dfa-outlier-detection"></a>Outlier detection<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h3>
<p>Outlier detection is an analysis for identifying data points (outliers) whose
feature values are different from those of the normal data points in a
particular data set. Outliers may denote errors or unusual behavior.
Outlier detection, for example, can be used to detect malicious software on a
machine, unusual user behavior on a network, or any unusual entity in a given
population. As outlier detection algorithms operate on the assumption that the
outliers make up a small proportion of the overall data population.</p>
<p>The machine learning features provide unsupervised outlier detection, which means there is no
need to provide a training data set. Unsupervised outlier detection uses various
machine learning techniques to find which data points are unusual compared to
the majority of the data points.</p>
<p>You can create outlier detection data frame analytics jobs in Kibana or by using the
<a href="/guide/en/elasticsearch/reference/master/put-dfanalytics.html" class="ulink" target="_top">create data frame analytics jobs API</a>.</p>
<h4><a id="dfa-outlier-algorithms"></a>Outlier detection algorithms<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h4>
<p>In the Elastic Stack, we use an ensemble of four different distance and density based
outlier detection methods:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
distance of K<sup>th</sup> nearest neighbor
</li>
<li class="listitem">
distance of K-nearest neighbors
</li>
<li class="listitem">
local outlier factor (<code class="literal">lof</code>)
</li>
<li class="listitem">
local distance-based outlier factor (<code class="literal">ldof</code>).
</li>
</ul>
</div>
<p>By default, you don&#8217;t need to select the methods or
provide any parameters, but you can override the default behavior if you like.
The basic assumption of the <span class="strong strong"><strong>distance based methods</strong></span> is that normal data
points – in other words, points that are not outliers – have a lot of neighbors
nearby, because we expect that in a population the majority of the data points
have similar feature values, while the minority of the data points – the
outliers – have different feature values and will, therefore, be far away from
the normal points.</p>
<p>The distance of K<sup>th</sup> nearest neighbor method (<code class="literal">distance_kth_nn</code>) computes the
distance of the data point to its K<sup>th</sup> nearest neighbor where K is a small
number and usually independent of the total number of data points. The higher
this distance the more the data point is an outlier.</p>
<p>The distance of K-nearest neighbors method (<code class="literal">distance_knn</code>) calculates the
average distance of the data points to their nearest neighbors. Points with the
largest average distance will be the most outlying.</p>
<p>While the results of the distance based methods are easy to interpret, their
drawback is that they don&#8217;t take into account the density variations of a
data set. This is the point where <span class="strong strong"><strong>density based methods</strong></span> come into the
picture, they are used for mitigating this problem. These methods take into
account not only the distance of the points to their K nearest neighbors but
also the distance of these neighbors to their neighbors.</p>
<p>Based on this approach, a metric is computed called local outlier factor
(<code class="literal">lof</code>) for each data point. The higher the local outlier factor, the more
outlying is the data point.</p>
<p>The other density based method that outlier detection uses is the local
distance-based outlier factor (<code class="literal">ldof</code>). Ldof is a ratio of two measures: the
first computes the average distance of the data point to its K nearest
neighbors; the second computes the average of the pairwise distances of the
neighbors themselves. Again, the higher the value the more the data point is an
outlier.</p>
<p>As you can see, these four algorithms work differently, so they don&#8217;t always
agree on which points are outliers. By default, we use all these methods during
outlier detection, then normalize and combine their results and give every datapoint
in the index an outlier score. The outlier score ranges from 0 to 1, where the higher
number represents the chance that the data point is an outlier compared to the
other data points in the index.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Outlier detection is a batch analysis, it runs against your data
once. If new data comes into the index, you need to do the analysis again on the
altered data.</p>
</div>
</div>
<h4><a id="dfa-feature-influence"></a>Feature influence<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h4>
<p>Besides the outlier score, another value is calculated during outlier detection:
the feature influence score. As we mentioned, there are multiple features of a
data point that are analyzed during outlier detection. An influential feature is a
feature of a data point that is responsible for the point being an outlier. The
value of feature influence provides a relative ranking of features by their
contribution to a point being an outlier. Therefore, while outlier score tells us
whether a data point is an outlier, feature influence shows which features make
the point an outlier. By doing this, this value provides context to help
understand more about the reasons for the data point being unusual and can drive
visualizations.</p>
<h4><a id="ml-outlier-detection-evaluate"></a>Outlier detection evaluation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h4>
<p>Using the data frame analytics features to gain insights from a data set is an
iterative process. After you defined the problem you want to solve, and chose
the analytics type that can help you to do so, you need to produce a
high-quality data set and create the appropriate data frame analytics job. You might
need to experiment with different configurations, parameters, and ways to
transform data before you arrive at a result that satisfies your use case. A
valuable companion to this process is the
<a href="/guide/en/elasticsearch/reference/master/evaluate-dfanalytics.html" class="ulink" target="_top">evaluate data frame analytics API</a>, which enables you to evaluate
the data frame analytics performance. It helps you understand error distributions and
identifies the points where the data frame analytics model performs well or less
trustworthily.</p>
<p>To evaluate the analysis with this API, you need to annotate your index that
contains the results of the analysis with a field that marks each document with
the ground truth. The evaluate data frame analytics API evaluates the performance of the
data frame analytics against this manually provided ground truth.</p>
<p>The outlier detection evaluation type is suitable for analyses which calculate a
probability that each data point in a data set is a member of a class or not. It
offers the following metrics to evaluate the model performance:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
confusion matrix
</li>
<li class="listitem">
precision
</li>
<li class="listitem">
recall
</li>
<li class="listitem">
receiver operating characteristic (ROC) curve.
</li>
</ul>
</div>
<h5><a id="ml-dfanalytics-confusion-matrix"></a>Confusion matrix<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h5>
<p>A confusion matrix provides four measures of how well the data frame analytics worked
on your data set:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
True positives (TP): Class members that the analysis identified as class
members.
</li>
<li class="listitem">
True negatives (TN): Not class members that the analysis identified as not
class members.
</li>
<li class="listitem">
False positives (FP): Not class members that the analysis misidentified as
class members.
</li>
<li class="listitem">
False negatives (FN): Class members that the analysis misidentified as not
class members.
</li>
</ul>
</div>
<p>Although, the evaluate data frame analytics API can compute the confusion matrix out of the
analysis results, these results are not binary values (class member/not
class member), but a number between 0 and 1 (which called the outlier score in case
of outlier detection). This value captures how likely it is for a data
point to be a member of a certain class. It means that it is up to the user who
is evaluating the results to decide what is the threshold or cutoff point at
which the data point will be considered as a member of the given class. For
example, in the case of outlier detection the user can say that all the data points
with an outlier score higher than 0.5 will be considered as outliers.</p>
<p>To take this complexity into account, the evaluate data frame analytics API returns the confusion
matrix at different thresholds (by default, 0.25, 0.5, and 0.75).</p>
<h5><a id="ml-dfanalytics-precision-recall"></a>Precision and recall<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h5>
<p>A confusion matrix is a useful measure, but it could be hard to compare the
results across the different algorithms. Precision and recall values
summarize the algorithm performance as a single number that makes it easier to
compare the evaluation results.</p>
<p>Precision shows how many of the data points that the algorithm identified as
class members were actually class members. It is the number of true positives
divided by the sum of the true positives and false positives (TP/(TP+FP)).</p>
<p>Recall answers a slightly different question. This value shows how many of the
data points that are actual class members were identified correctly as class
members. It is the number of true positives divided by the sum of the true
positives and false negatives (TP/(TP+FN)).</p>
<p>As was the case for the confusion matrix, you also need to define different
threshold levels for computing precision and recall.</p>
<h5><a id="ml-dfanalytics-roc"></a>Receiver operating characteristic curve<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h5>
<p>The receiver operating characteristic (ROC) curve is a plot that represents the
performance of the binary classification process at different thresholds. It
compares the rate of true positives against the rate of false positives at the
different threshold levels to create the curve. From this plot, you can compute
the area under the curve (AUC) value, which is a number between 0 and 1. The
closer to 1, the better the algorithm performance.</p>
<p>The evaluate data frame analytics API can return the false positive rate (<code class="literal">fpr</code>) and the true
positive rate (<code class="literal">tpr</code>) at the different threshold levels, so you can visualize
the algorithm performance by using these values.</p>
<h3><a id="ecommerce-outliers"></a>Detecting unusual behavior in the eCommerce data set<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h3>
<p>The goal of <a class="xref" href="ml-dfa-finding-outliers.html#dfa-outlier-detection" title="Outlier detection">outlier detection</a> is to find the most unusual
documents in an index. Let&#8217;s try to detect unusual customer behavior in the
<a href="/guide/en/kibana/master/add-sample-data.html" class="ulink" target="_top">eCommerce sample data set</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Verify that your environment is set up properly to use machine learning features.
If the Elasticsearch security features are enabled, you need a user that has authority
to create and manage data frame analytics jobs. See <a class="xref" href="setup.html" title="Set up machine learning features"><em>Setup and security</em></a>.</p>
<p>Since we&#8217;ll be creating transforms, you also need
<code class="literal">manage_data_frame_transforms</code> cluster privileges.</p>
</li>
<li class="listitem">
<p>Create a transform that generates an entity-centric index with numeric or
boolean data to analyze.</p>
<p>In this example, we&#8217;ll use the eCommerce orders sample data and pivot the data
such that we get a new index that contains a sales summary for each customer.</p>
<p>In particular, create a transform that calculates the sum of the products
(<code class="literal">products.quantity</code>) and the sum of prices (<code class="literal">products.taxful_price</code>) in all of
the orders, grouped by customer (<code class="literal">customer_full_name.keyword</code>). Also include a
value count aggregation, so that we know how many orders (<code class="literal">order_id</code>) exist for
each customer.</p>
<p>You can preview the transform before you create it in <span class="strong strong"><strong>Stack Management</strong></span>
&gt; <span class="strong strong"><strong>Transforms</strong></span>:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ecommerce-transform-preview.png" alt="Creating a transform in Kibana">
</div>
</div>
<p>Alternatively, you can use the
<a href="/guide/en/elasticsearch/reference/master/preview-transform.html" class="ulink" target="_top">preview transform API</a> and the
<a href="/guide/en/elasticsearch/reference/master/put-transform.html" class="ulink" target="_top">create transform API</a>.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _data_frame/transforms/_preview
{
  "source": {
    "index": [
      "kibana_sample_data_ecommerce"
    ]
  },
  "pivot": {
    "group_by": {
      "customer_full_name.keyword": {
        "terms": {
          "field": "customer_full_name.keyword"
        }
      }
    },
    "aggregations": {
      "products.quantity.sum": {
        "sum": {
          "field": "products.quantity"
        }
      },
      "products.taxful_price.sum": {
        "sum": {
          "field": "products.taxful_price"
        }
      },
      "order_id.value_count": {
        "value_count": {
          "field": "order_id"
        }
      }
    }
  }
}

PUT _data_frame/transforms/ecommerce-customer-sales
{
  "source": {
    "index": [
      "kibana_sample_data_ecommerce"
    ]
  },
  "pivot": {
    "group_by": {
      "customer_full_name.keyword": {
        "terms": {
          "field": "customer_full_name.keyword"
        }
      }
    },
    "aggregations": {
      "products.quantity.sum": {
        "sum": {
          "field": "products.quantity"
        }
      },
      "products.taxful_price.sum": {
        "sum": {
          "field": "products.taxful_price"
        }
      },
      "order_id.value_count": {
        "value_count": {
          "field": "order_id"
        }
      }
    }
  },
  "description": "E-commerce sales by customer",
  "dest": {
    "index": "ecommerce-customer-sales"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/43.console"></div>
</div>
</details>
<p>For more details about creating transforms, see
<a href="/guide/en/elasticsearch/reference/master/ecommerce-transforms.html" class="ulink" target="_top">Transforming the eCommerce sample data</a>.</p>
</li>
<li class="listitem">
<p>Start the transform.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Even though resource utilization is automatically adjusted based on the
cluster load, a transform increases search and indexing load on your
cluster while it runs. If you&#8217;re experiencing an excessive load, however, you
can stop it.</p>
</div>
</div>
<p>You can start, stop, and manage transforms in Kibana. Alternatively, you can
use the <a href="/guide/en/elasticsearch/reference/master/start-data-frame-transform.html" class="ulink" target="_top">start transforms</a> API.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _data_frame/transforms/ecommerce-customer-sales/_start</pre>
</div>
<div class="console_widget" data-snippet="snippets/44.console"></div>
</div>
</details>
</li>
<li class="listitem">
<p>Create a data frame analytics job to detect outliers in the new entity-centric index.</p>
<p>In the wizard on the <span class="strong strong"><strong>Machine Learning</strong></span> &gt; <span class="strong strong"><strong>Data Frame Analytics</strong></span> page in Kibana,
select your new index pattern then use the default values for outlier detection. For
example:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ecommerce-outlier-job-1.png" alt="Create a data frame analytics job in Kibana">
</div>
</div>
<p>The wizard includes a scatterplot matrix, which enables you to explore the
relationships between the fields. You can use that information to help you
decide which fields to include or exclude from the analysis.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ecommerce-outlier-scatterplot.png" alt="A scatterplot matrix for three fields in Kibana">
</div>
</div>
<p>If you want these charts to represent data from a larger sample size or from a
randomized selection of documents, you can change the default behavior. However,
a larger sample size might slow down the performance of the matrix and a
randomized selection might put more load on the cluster due to the more
intensive query.</p>
<p>Alternatively, you can use the
<a href="/guide/en/elasticsearch/reference/master/put-dfanalytics.html" class="ulink" target="_top">create data frame analytics jobs API</a>.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/ecommerce
{
  "source": {
    "index": "ecommerce-customer-sales"
  },
  "dest": {
    "index": "ecommerce-outliers"
  },
  "analysis": {
    "outlier_detection": {
    }
  },
  "analyzed_fields" : {
    "includes" : ["products.quantity.sum","products.taxful_price.sum","order_id.value_count"]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/45.console"></div>
</div>
</details>
</li>
<li class="listitem">
<p>Start the data frame analytics job.</p>
<p>You can start, stop, and manage data frame analytics jobs on the <span class="strong strong"><strong>Machine Learning</strong></span> &gt;
<span class="strong strong"><strong>Data Frame Analytics</strong></span> page. Alternatively, you can use the
<a href="/guide/en/elasticsearch/reference/master/start-dfanalytics.html" class="ulink" target="_top">start data frame analytics jobs</a> and
<a href="/guide/en/elasticsearch/reference/master/stop-dfanalytics.html" class="ulink" target="_top">stop data frame analytics jobs</a> APIs.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/analytics/ecommerce/_start</pre>
</div>
<div class="console_widget" data-snippet="snippets/46.console"></div>
</div>
</details>
</li>
<li class="listitem">
<p>View the results of the outlier detection analysis.</p>
<p>The data frame analytics job creates an index that contains the original data and
outlier scores for each document. The outlier score indicates how different each entity
is from other entities.</p>
<p>In Kibana, you can view the results from the data frame analytics job and sort them
on the outlier score:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/outliers.png" alt="View outlier detection results in Kibana">
</div>
</div>
<p>The <code class="literal">ml.outlier</code> score is a value between 0 and 1. The larger the value, the
more likely they are to be an outlier. In Kibana, you can optionally enable
histogram charts to get a better understanding of the distribution of values for
each column in the result.</p>
<p>In addition to an overall outlier score, each document is annotated with feature
influence values for each field. These values add up to 1 and indicate which
fields are the most important in deciding whether an entity is an outlier or
inlier. For example, the dark shading on the <code class="literal">products.taxful_price.sum</code> field
for Wagdi Shaw indicates that the sum of the product prices was the most
influential feature in determining that Wagdi is an outlier.</p>
<p>If you want to see the exact feature influence values, you can retrieve them
from the index that is associated with your data frame analytics job.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET ecommerce-outliers/_search?q="Wagdi Shaw"</pre>
</div>
<div class="console_widget" data-snippet="snippets/47.console"></div>
<p>The search results include the following outlier detection scores:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">...
  "ml" : {
    "outlier_score" : 0.9706582427024841,
    "feature_influence" : [
      {
        "feature_name" : "order_id.value_count",
        "influence" : 0.015179949812591076
      },
      {
        "feature_name" : "products.quantity.sum",
        "influence" : 0.003752298653125763
      },
      {
        "feature_name" : "products.taxful_price.sum",
        "influence" : 0.9810677766799927
      }
    ]
  }
...</pre>
</div>
</div>
</details>
<p>Kibana also provides a scatterplot matrix in the results. Outliers with a score
that exceeds the threshold are highlighted in each chart:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/outliers-scatterplot.png" alt="View scatterplot in outlier detection results">
</div>
</div>
<p>In addition to the sample size and random scoring options, there is a
<span class="strong strong"><strong>Dynamic size</strong></span> option. If you enable this option, the size of each point is
affected by its outlier score; that is to say, the largest points have the
highest outlier scores. The goal of these charts and options is to help you
visualize and explore the outliers within your data.</p>
</li>
</ol>
</div>
<p>Now that you&#8217;ve found unusual behavior in the sample data set, consider how you
might apply these steps to other data sets. If you have data that is already
marked up with true outliers, you can determine how well the outlier detection
algorithms perform by using the evaluate data frame analytics API. See
<a class="xref" href="ml-dfa-finding-outliers.html#ml-outlier-detection-evaluate" title="Outlier detection evaluation">Outlier detection evaluation</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you do not want to keep the transform and the data frame analytics job, you
can delete them in Kibana or use the
<a href="/guide/en/elasticsearch/reference/master/delete-data-frame-transform.html" class="ulink" target="_top">delete transform API</a> and
<a href="/guide/en/elasticsearch/reference/master/delete-dfanalytics.html" class="ulink" target="_top">delete data frame analytics job API</a>. When you delete
transforms and data frame analytics jobs in Kibana, you have the option to also remove
the destination indices and index patterns.</p>
</div>
</div>
<h4><a id="outlier-detection-next"></a>What&#8217;s next<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-outlier-detection.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If you want to see another example of outlier detection in a Jupyter notebook,
<a href="https://github.com/elastic/examples/tree/master/Machine%20Learning/Outlier%20Detection/Introduction" class="ulink" target="_top">click here</a>.
</li>
<li class="listitem">
<a href="/blog/catching-malware-with-elastic-outlier-detection" class="ulink" target="_top">This blog post</a>
shows you how to catch malware using outlier detection.
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ml-dfa-overview.html">« Data frame analytics overview</a>
</span>
<span class="next">
<a href="ml-dfa-concepts.html">Advanced concepts »</a>
</span>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
