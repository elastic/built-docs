<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="keywords" content="ML, Elastic Stack, natural language processing, inference">
<title>ELSER – Elastic Learned Sparse EncodeR | Machine Learning in the Elastic Stack [master] | Elastic</title>
<meta class="elastic" name="content" content="ELSER – Elastic Learned Sparse EncodeR | Machine Learning in the Elastic Stack [master]">

<link rel="home" href="index.html" title="Machine Learning in the Elastic Stack [master]"/>
<link rel="up" href="ml-nlp-built-in-models.html" title="Built-in NLP models"/>
<link rel="prev" href="ml-nlp-built-in-models.html" title="Built-in NLP models"/>
<link rel="next" href="ml-nlp-e5.html" title="E5 – EmbEddings from bidirEctional Encoder rEpresentations"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Machine Learning"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Machine Learning/master"/>
<meta name="DC.subject" content="Machine Learning"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="ml-nlp-built-in-models.html">« Built-in NLP models</a>
</span>
<span class="next">
<a href="ml-nlp-e5.html">E5 – EmbEddings from bidirEctional Encoder rEpresentations »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Machine Learning in the Elastic Stack [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-nlp.html">Natural language processing</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-nlp-built-in-models.html">Built-in NLP models</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>ELSER – Elastic Learned Sparse EncodeR</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-nlp-elser"></a>ELSER – Elastic Learned Sparse EncodeR<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h2>
</div></div></div>

<p>Elastic Learned Sparse EncodeR - or ELSER - is a retrieval model trained by
Elastic that enables you to perform
<a href="/guide/en/elasticsearch/reference/master/semantic-search-elser.html" class="ulink" target="_top">semantic search</a> to retrieve more relevant
search results. This search type provides you search results based on contextual
meaning and user intent, rather than exact keyword matches.</p>
<p>ELSER is an out-of-domain model which means it does not require fine-tuning on
your own data, making it adaptable for various use cases out of the box.</p>
<p>This model is recommended for English language documents and queries. If you
want to perform semantic search on non-English language documents, use the
<a class="xref" href="ml-nlp-e5.html" title="E5 – EmbEddings from bidirEctional Encoder rEpresentations">E5</a> model.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>While ELSER V2 is generally available, ELSER V1 is in <span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span>
and will remain in technical preview.</p>
</div>
</div>
<h4><a id="elser-tokens"></a>Tokens - not synonyms<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h4>
<p>ELSER expands the indexed and searched passages into collections of terms that
are learned to co-occur frequently within a diverse set of training data. The
terms that the text is expanded into by the model <em>are not</em> synonyms for the
search terms; they are learned associations capturing relevance. These expanded
terms are weighted as some of them are more significant than others. Then the
Elasticsearch <a href="/guide/en/elasticsearch/reference/master/sparse-vector.html" class="ulink" target="_top">sparse vector</a>
(or <a href="/guide/en/elasticsearch/reference/master/rank-features.html" class="ulink" target="_top">rank features</a>) field type is used to store the
terms and weights at index time, and to search against later.</p>
<p>This approach provides a more understandable search experience compared to
vector embeddings. However, attempting to directly interpret the tokens and
weights can be misleading, as the expansion essentially results in a vector in a
very high-dimensional space. Consequently, certain tokens, especially those with
low weight, contain information that is intertwined with other low-weight tokens
in the representation. In this regard, they function similarly to a dense vector
representation, making it challenging to separate their individual
contributions. This complexity can potentially lead to misinterpretations if not
carefully considered during analysis.</p>
<h4><a id="elser-req"></a>Requirements<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h4>
<p>To use ELSER, you must have the <a href="/subscriptions" class="ulink" target="_top">appropriate subscription</a> level
for semantic search or the trial period activated.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The minimum dedicated ML node size for deploying and using the ELSER model
is 4 GB in Elasticsearch Service if
<a href="/guide/en/cloud/current/ec-autoscaling.html" class="ulink" target="_top">deployment autoscaling</a> is turned off. Turning on
autoscaling is recommended because it allows your deployment to dynamically
adjust resources based on demand. Better performance can be achieved by using
more allocations or more threads per allocation, which requires bigger ML nodes.
Autoscaling provides bigger nodes when required. If autoscaling is turned off,
you must provide suitably sized nodes yourself.</p>
</div>
</div>
<h4><a id="elser-v2"></a>ELSER v2<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h4>
<p>Compared to the initial version of the model, ELSER v2 offers improved retrieval
accuracy and more efficient indexing. This enhancement is attributed to the
extension of the training data set, which includes high-quality question and
answer pairs and the improved FLOPS regularizer which reduces the cost of
computing the similarity between a query and a document.</p>
<p>ELSER v2 has two versions: one cross-platform version which runs on any hardware
and one version which is optimized for Intel® silicon. The
<span class="strong strong"><strong>Model Management</strong></span> &gt; <span class="strong strong"><strong>Trained Models</strong></span> page shows you which version of ELSER
v2 is recommended to deploy based on your cluster&#8217;s hardware.</p>
<p>If you want to learn more about the ELSER V2 improvements, refer to
<a href="/search-labs/introducing-elser-v2-part-1" class="ulink" target="_top">this blog post</a>.</p>
<h5><a id="upgrade-elser-v2"></a>Upgrading to ELSER v2<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<p>ELSER v2 is not backward compatible. If you indexed your data with ELSER v1, you
need to reindex it with an ingest pipeline referencing ELSER v2 to be able to
use v2 for search. This <a href="/guide/en/elasticsearch/reference/master/semantic-search-elser.html" class="ulink" target="_top">tutorial</a> shows you how
to create an ingest pipeline with an inference processor that uses ELSER v2, and
how to reindex your data through the pipeline.</p>
<p>Additionally, the <code class="literal">elasticearch-labs</code> GitHub repository contains an interactive
<a href="https://github.com/elastic/elasticsearch-labs/blob/main/notebooks/model-upgrades/upgrading-index-to-use-elser.ipynb" class="ulink" target="_top">Python notebook</a>
that walks through upgrading an index to ELSER V2.</p>
<h4><a id="download-deploy-elser"></a>Download and deploy ELSER<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h4>
<p>You can download and deploy ELSER either from <span class="strong strong"><strong>Machine Learning</strong></span> &gt; <span class="strong strong"><strong>Trained Models</strong></span>,
from <span class="strong strong"><strong>Search</strong></span> &gt; <span class="strong strong"><strong>Indices</strong></span>, or by using the Dev Console.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can deploy the model multiple times by assigning a unique
deployment ID when starting the deployment. It enables you to have dedicated
deployments for different purposes, such as search and ingest. By doing so, you
ensure that the search speed remains unaffected by ingest workloads, and vice
versa. Having separate deployments for search and ingest mitigates performance
issues resulting from interactions between the two, which can be hard to
diagnose.</p>
</div>
</div>
<h5><a id="trained-model"></a>Using the Trained Models page<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, navigate to <span class="strong strong"><strong>Machine Learning</strong></span> &gt; <span class="strong strong"><strong>Trained Models</strong></span>. ELSER can be found
in the list of trained models. There are two versions available: one portable
version which runs on any hardware and one version which is optimized for Intel®
silicon. You can see which model is recommended to use based on your hardware
configuration.
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Add trained model</strong></span> button. Select the ELSER model version you
want to use in the opening modal window. The model that is recommended for you
based on your hardware configuration is highlighted. Click <span class="strong strong"><strong>Download</strong></span>. You can
check the download status on the <span class="strong strong"><strong>Notifications</strong></span> page.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ml-nlp-elser-v2-download.png" alt="Downloading ELSER">
</div>
</div>
<p>Alternatively, click the <span class="strong strong"><strong>Download model</strong></span> button under <span class="strong strong"><strong>Actions</strong></span> in the
trained model list.</p>
</li>
<li class="listitem">
After the download is finished, start the deployment by clicking the
<span class="strong strong"><strong>Start deployment</strong></span> button.
</li>
<li class="listitem">
<p>Provide a deployment ID, select the priority, and set the number of
allocations and threads per allocation values.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ml-nlp-deployment-id-elser-v2.png" alt="Deploying ELSER">
</div>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Start</strong></span>.
</li>
</ol>
</div>
<h5><a id="elasticsearch"></a>Using the search indices UI<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<p>Alternatively, you can download and deploy ELSER to an inference pipeline using
the search indices UI.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, navigate to <span class="strong strong"><strong>Search</strong></span> &gt; <span class="strong strong"><strong>Indices</strong></span>.
</li>
<li class="listitem">
Select the index from the list that has an inference pipeline in which you want
to use ELSER.
</li>
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Pipelines</strong></span> tab.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Machine Learning Inference Pipelines</strong></span>, click the <span class="strong strong"><strong>Deploy</strong></span> button to
begin downloading the ELSER model. This may take a few minutes depending on your
network.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ml-nlp-deploy-elser-v2-es.png" alt="Deploying ELSER in Elasticsearch">
</div>
</div>
</li>
<li class="listitem">
<p>Once the model is downloaded, click the <span class="strong strong"><strong>Start single-threaded</strong></span> button to
start the model with basic configuration or select the <span class="strong strong"><strong>Fine-tune performance</strong></span>
option to navigate to the <span class="strong strong"><strong>Trained Models</strong></span> page where you can configure the
model deployment.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ml-nlp-start-elser-v2-es.png" alt="Start ELSER in Elasticsearch">
</div>
</div>
</li>
</ol>
</div>
<p>When your ELSER model is deployed and started, it is ready to be used in a
pipeline.</p>
<h6><a id="elasticsearch-ingest-pipeline"></a>Adding ELSER to an ingest pipeline<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h6>
<p>To add ELSER to an ingest pipeline, you need to copy the default ingest
pipeline and then customize it according to your needs.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Click <span class="strong strong"><strong>Copy and customize</strong></span> under the <span class="strong strong"><strong>Unlock your custom pipelines</strong></span> block
at the top of the page. This enables the <span class="strong strong"><strong>Add inference pipeline</strong></span> button.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ml-nlp-pipeline-copy-customize.png" alt="Start ELSER in Elasticsearch">
</div>
</div>
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Machine Learning Inference Pipelines</strong></span>, click <span class="strong strong"><strong>Add inference pipeline</strong></span>.
</li>
<li class="listitem">
Give a name to the pipeline, select ELSER from the list of trained ML models,
and click <span class="strong strong"><strong>Continue</strong></span>.
</li>
<li class="listitem">
Select the source text field, define the target field, and click <span class="strong strong"><strong>Add</strong></span> then
<span class="strong strong"><strong>Continue</strong></span>.
</li>
<li class="listitem">
Review the index mappings updates. Click <span class="strong strong"><strong>Back</strong></span> if you want to change the
mappings. Click <span class="strong strong"><strong>Continue</strong></span> if you are satisfied with the updated index
mappings.
</li>
<li class="listitem">
You can optionally test your pipeline. Click <span class="strong strong"><strong>Continue</strong></span>.
</li>
<li class="listitem">
<span class="strong strong"><strong>Create pipeline</strong></span>.
</li>
</ol>
</div>
<p>Once your pipeline is created, you are ready to ingest documents and utilize
ELSER for text expansions in your search queries.</p>
<h5><a id="dev-console"></a>Using the Dev Console<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, navigate to the <span class="strong strong"><strong>Dev Console</strong></span>.
</li>
<li class="listitem">
<p>Create the ELSER model configuration by running the following API call:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _ml/trained_models/.elser_model_2
{
  "input": {
	"field_names": ["text_field"]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/63.console"></div>
<p>The API call automatically initiates the model download if the model is not
downloaded yet.</p>
</li>
<li class="listitem">
<p>Deploy the model by using the
<a href="/guide/en/elasticsearch/reference/master/start-trained-model-deployment.html" class="ulink" target="_top">start trained model deployment API</a>
with a delpoyment ID:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _ml/trained_models/.elser_model_2/deployment/_start?deployment_id=for_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/64.console"></div>
<p>You can deploy the model multiple times with different deployment IDs.</p>
</li>
</ol>
</div>
<p>After the deployment is complete, ELSER is ready to use either in an ingest
pipeline or in a <code class="literal">text_expansion</code> query to perform semantic search.</p>
<h4><a id="air-gapped-install"></a>Deploy ELSER in an air-gapped environment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h4>
<p>If you want to deploy ELSER in a restricted or closed network, you have two
options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
create your own HTTP/HTTPS endpoint with the model artifacts on it,
</li>
<li class="listitem">
put the model artifacts into a directory inside the config directory on all
<a href="/guide/en/elasticsearch/reference/master/modules-node.html#master-node" class="ulink" target="_top">master-eligible nodes</a>.
</li>
</ul>
</div>
<h5><a id="elser-model-artifacts"></a>Model artifact files<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<p>For the cross-platform verison, you need the following files in your system:</p>
<pre class="screen">https://ml-models.elastic.co/elser_model_2.metadata.json
https://ml-models.elastic.co/elser_model_2.pt
https://ml-models.elastic.co/elser_model_2.vocab.json</pre>
<p>For the optimized version, you need the following files in your system:</p>
<pre class="screen">https://ml-models.elastic.co/elser_model_2_linux-x86_64.metadata.json
https://ml-models.elastic.co/elser_model_2_linux-x86_64.pt
https://ml-models.elastic.co/elser_model_2_linux-x86_64.vocab.json</pre>
<h5><a id="_using_an_http_server"></a>Using an HTTP server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<p>INFO: If you use an existing HTTP server, note that the model downloader only
supports passwordless HTTP servers.</p>
<p>You can use any HTTP service to deploy ELSER. This example uses the official
Nginx Docker image to set a new HTTP download service up.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the <a class="xref" href="ml-nlp-elser.html#elser-model-artifacts" title="Model artifact files">model artifact files</a>.
</li>
<li class="listitem">
Put the files into a subdirectory of your choice.
</li>
<li class="listitem">
<p>Run the following commands:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">export ELASTIC_ML_MODELS="/path/to/models"
docker run --rm -d -p 8080:80 --name ml-models -v ${ELASTIC_ML_MODELS}:/usr/share/nginx/html nginx</pre>
</div>
<p>Don&#8217;t forget to change <code class="literal">/path/to/models</code> to the path of the subdirectory where
the model artifact files are located.</p>
<p>These commands start a local Docker image with an Nginx server with the
subdirectory containing the model files. As the Docker image has to be
downloaded and built, the first start might take a longer period of time.
Subsequent runs start quicker.</p>
</li>
<li class="listitem">
<p>Verify that Nginx runs properly by visiting the following URL in your
browser:</p>
<pre class="screen">http://{IP_ADDRESS_OR_HOSTNAME}:8080/elser_model_2.metadata.json</pre>
<p>If Nginx runs properly, you see the content of the metdata file of the model.</p>
</li>
<li class="listitem">
<p>Point your Elasticsearch deployment to the model artifacts on the HTTP server
by adding the following line to the <code class="literal">config/elasticsearch.yml</code> file:</p>
<pre class="screen">xpack.ml.model_repository: http://{IP_ADDRESS_OR_HOSTNAME}:8080</pre>
<p>If you use your own HTTP or HTTPS server, change the address accordingly. It is
important to specificy the protocol ("http://" or "https://"). Ensure that all
master-eligible nodes can reach the server you specify.</p>
</li>
<li class="listitem">
Repeat step 5 on all master-eligible nodes.
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/restart-cluster.html#restart-cluster-rolling" class="ulink" target="_top">Restart</a> the
master-eligible nodes one by one.
</li>
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Trained Models</strong></span> page in Kibana, ELSER can be found in the
list of trained models.
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Add trained model</strong></span> button, select the ELSER model version you
downloaded in step 1 and want to deploy, and click <span class="strong strong"><strong>Download</strong></span>. The selected
model will be downloaded from the HTTP/HTTPS server you configured.
</li>
<li class="listitem">
After the download is finished, start the deployment by clicking the
<span class="strong strong"><strong>Start deployment</strong></span> button.
</li>
<li class="listitem">
Provide a deployment ID, select the priority, and set the number of
allocations and threads per allocation values.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Start</strong></span>.
</li>
</ol>
</div>
<p>The HTTP server is only required for downloading the model. After the download
has finished, you can stop and delete the service. You can stop the Docker image
used in this example by running the following command:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">docker stop ml-models</pre>
</div>
<h5><a id="_using_file_based_access"></a>Using file-based access<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<p>For a file-based access, follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the <a class="xref" href="ml-nlp-elser.html#elser-model-artifacts" title="Model artifact files">model artifact files</a>.
</li>
<li class="listitem">
Put the files into a <code class="literal">models</code> subdirectory inside the <code class="literal">config</code> directory of
your Elasticsearch deployment.
</li>
<li class="listitem">
<p>Point your Elasticsearch deployment to the model directory by adding the
following line to the <code class="literal">config/elasticsearch.yml</code> file:</p>
<pre class="screen">xpack.ml.model_repository: file://${path.home}/config/models/`</pre>
</li>
<li class="listitem">
Repeat step 2 and step 3 on all master-eligible nodes.
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/restart-cluster.html#restart-cluster-rolling" class="ulink" target="_top">Restart</a> the
master-eligible nodes one by one.
</li>
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Trained Models</strong></span> page in Kibana, ELSER can be found in the
list of trained models.
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Add trained model</strong></span> button, select the ELSER model version you
downloaded in step 1 and want to deploy and click <span class="strong strong"><strong>Download</strong></span>. The selected
model will be downloaded from the model directory where you put in step 2.
</li>
<li class="listitem">
After the download is finished, start the deployment by clicking the
<span class="strong strong"><strong>Start deployment</strong></span> button.
</li>
<li class="listitem">
Provide a deployment ID, select the priority, and set the number of
allocations and threads per allocation values.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Start</strong></span>.
</li>
</ol>
</div>
<h4><a id="_testing_elser"></a>Testing ELSER<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h4>
<p>You can test the deployed model in Kibana. Navigate to <span class="strong strong"><strong>Model Management</strong></span> &gt;
<span class="strong strong"><strong>Trained Models</strong></span>, locate the deployed ELSER model in the list of trained
models, then select <span class="strong strong"><strong>Test model</strong></span> from the Actions menu.</p>
<p>You can use data from an existing index to test the model. Select the index,
then a field of the index you want to test ELSER on. Provide a search query and
click <span class="strong strong"><strong>Test</strong></span>. Evaluating model recall is simpler when using a query related to
the documents.</p>
<p>The results contain a list of ten random values for the selected field along
with a score showing how relevant each document is to the query. The higher the
score, the more relevant the document is. You can reload example documents by
clicking <span class="strong strong"><strong>Reload examples</strong></span>.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ml-nlp-elser-v2-test.png" alt="Testing ELSER">
</div>
</div>
<h4><a id="performance"></a>Performance considerations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
ELSER works best on small-to-medium sized fields that contain natural
language. For connector or web crawler use cases, this aligns best with fields
like <em>title</em>, <em>description</em>, <em>summary</em>, or <em>abstract</em>. As ELSER encodes the
first 512 tokens of a field, it may not provide as relevant of results for large
fields. For example, <code class="literal">body_content</code> on web crawler documents, or body fields
resulting from extracting text from office documents with connectors. For larger
fields like these, consider "chunking" the content into multiple values, where
each chunk can be under 512 tokens.
</li>
<li class="listitem">
Larger documents take longer at ingestion time, and inference time per
document also increases the more fields in a document that need to be processed.
</li>
<li class="listitem">
The more fields your pipeline has to perform inference on, the longer it takes
per document to ingest.
</li>
</ul>
</div>
<p>To learn more about ELSER performance, refer to the <a class="xref" href="ml-nlp-elser.html#elser-benchmarks" title="Benchmark information">Benchmark information</a>.</p>
<h4><a id="further-readings"></a>Further reading<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/semantic-search-elser.html" class="ulink" target="_top">Perform semantic search with ELSER</a>
</li>
<li class="listitem">
<a href="/blog/may-2023-launch-information-retrieval-elasticsearch-ai-model" class="ulink" target="_top">Improving information retrieval in the Elastic Stack: Introducing Elastic Learned Sparse Encoder, our new retrieval model</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="elser-benchmarks"></a>Benchmark information<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h3>
</div></div></div>
<p>The following sections provide information about how ELSER performs on different
hardwares and compares the model performance to Elasticsearch BM25 and other strong
baselines.</p>
<h5><a id="version-overview"></a>Version overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<p>ELSER V2 has a <span class="strong strong"><strong>optimized</strong></span> version that is designed to run only on Linux with
an x86-64 CPU architecture and a <span class="strong strong"><strong>cross-platform</strong></span> version that can be run on
any platform.</p>
<h6><a id="_elser_v2"></a>ELSER V2<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h6>
<p>Besides the performance improvements, the biggest change in ELSER V2 is the
introduction of the first platform specific ELSER model - that is, a model
optimized to run only on Linux with an x86-64 CPU architecture. The optimized
model is designed to work best on newer Intel CPUs, but it works on AMD CPUs as
well. It is recommended to use the new optimized Linux-x86-64 model for all new
users of ELSER as it is significantly faster than the cross-platform model which
can be run on any platform. ELSER V2 produces significantly higher quality
embeddings than ELSER V1. Regardless of which ELSER V2 model you use (optimized
or cross-platform), the particular embeddings produced are the same.</p>
<h5><a id="elser-qualitative-benchmarks"></a>Qualitative benchmarks<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<p>The metric that is used to evaluate ELSER&#8217;s ranking ability is the Normalized
Discounted Cumulative Gain (NDCG) which can handle multiple relevant documents
and fine-grained document ratings. The metric is applied to a fixed-sized list
of retrieved documents which, in this case, is the top 10 documents (NDCG@10).</p>
<p>The table below shows the performance of ELSER V2 compared to BM 25. ELSER V2
has 10 wins, 1 draw, 1 loss and an average improvement in NDCG@10 of 18%.</p>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml-nlp-bm25-elser-v2.png" alt="ELSER V2 benchmarks compared to BM25">
</div>
</div>
<p><em>NDCG@10 for BEIR data sets for BM25 and ELSER V2  - higher values are better)</em></p>
<h5><a id="elser-hw-benchmarks"></a>Hardware benchmarks<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h5>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>While the goal is to create a model that is as performant as
possible, retrieval accuracy always take precedence over speed, this is one of
the design principles of ELSER. Consult with the tables below to learn more
about the expected model performance. The values refer to operations performed
on two data sets and different hardware configurations. Your data set has an
impact on the model performance. Run tests on your own data to have a more
realistic view on the model performance for your use case.</p>
</div>
</div>
<h6><a id="_elser_v2_2"></a>ELSER V2<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elser.asciidoc">edit</a></h6>
<p>Overall the optimized V2 model ingested at a max rate of 26 docs/s, compared
with the ELSER V1 max rate of 14 docs/s from the ELSER V1 benchamrk, resulting
in a 90% increase in throughput.</p>
<p>The performance of virtual cores (that is, when the number of allocations is
greater than half of the vCPUs) has increased. Previously, the increase in
performance between 8 and 16 allocations was around 7%. It has increased to 17%
(ELSER V1 on 8.11) and 20% (for ELSER V2 optimized). These tests were performed
on a 16vCPU machine, with all documents containing exactly 256 tokens.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The length of the documents in your particular dataset will have a
significant impact on your throughput numbers.</p>
</div>
</div>
<p>Refer to
<a href="/search-labs/introducing-elser-v2-part-1" class="ulink" target="_top">this blog post</a>
to learn more about ELSER V2 improved performance.</p>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml-nlp-elser-bm-summary.png" alt="Summary of ELSER V1 and V2 benchmark reports">
</div>
</div>
<p><span class="strong strong"><strong>The optimized model</strong></span> results show a nearly linear growth up until 8
allocations, after which performance improvements become smaller. In this case,
the performance at 8 allocations was 22 docs/s, while the performance of 16
allocations was 26 docs/s, indicating a 20% performance increase due to virtual
cores.</p>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml-nlp-elser-v2-opt-bm-results.png" alt="ELSER V2 optimized benchmarks">
</div>
</div>
<p><span class="strong strong"><strong>The cross-platform</strong></span> model performance of 8 and 16 allocations are
respectively 14 docs/s and 16 docs/s, indicating a performance improvement due
to virtual cores of 12%.</p>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml-nlp-elser-v2-cp-bm-results.png" alt="ELSER V2 cross-platform benchmarks">
</div>
</div>
</div>

</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</div><div class="navfooter">
<span class="prev">
<a href="ml-nlp-built-in-models.html">« Built-in NLP models</a>
</span>
<span class="next">
<a href="ml-nlp-e5.html">E5 – EmbEddings from bidirEctional Encoder rEpresentations »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
