<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="keywords" content="ML, Elastic Stack, natural language processing, inference">
<title>Elastic Rerank | Machine Learning in the Elastic Stack [master] | Elastic</title>
<meta class="elastic" name="content" content="Elastic Rerank | Machine Learning in the Elastic Stack [master]">

<link rel="home" href="index.html" title="Machine Learning in the Elastic Stack [master]"/>
<link rel="up" href="ml-nlp-built-in-models.html" title="Built-in NLP models"/>
<link rel="prev" href="ml-nlp-elser.html" title="ELSER – Elastic Learned Sparse EncodeR"/>
<link rel="next" href="ml-nlp-e5.html" title="E5 – EmbEddings from bidirEctional Encoder rEpresentations"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Machine Learning"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Machine Learning/master"/>
<meta name="DC.subject" content="Machine Learning"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="ml-nlp-elser.html">« ELSER – Elastic Learned Sparse EncodeR</a>
</span>
<span class="next">
<a href="ml-nlp-e5.html">E5 – EmbEddings from bidirEctional Encoder rEpresentations »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Machine Learning in the Elastic Stack [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-nlp.html">Natural language processing</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-nlp-built-in-models.html">Built-in NLP models</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Elastic Rerank</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="ml-nlp-rerank"></a>Elastic Rerank</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
</div></div></div>
<p>Elastic Rerank is a state-of-the-art cross-encoder reranking model trained by Elastic that helps you improve search relevance with a few simple API calls.
Elastic Rerank is Elastic&#8217;s first semantic reranking model and is available out-of-the-box in supporting Elastic deployments using the Elasticsearch Inference API.</p>
<p>Use Elastic Rerank to improve existing search applications including:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Traditional BM25 scoring
</li>
<li class="listitem">
Hybrid semantic search
</li>
<li class="listitem">
Retrieval Augmented Generation (RAG)
</li>
</ul>
</div>
<p>The model can significantly improve search result quality by reordering results based on deeper semantic understanding of queries and documents.</p>
<p>When reranking BM25 results, it provides an average 40% improvement in ranking quality on a diverse benchmark of retrieval tasks— matching the performance of models 11x its size.</p>
<div class="position-relative"><h4><a id="ml-nlp-rerank-availability"></a>Availability and requirements</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<div class="position-relative"><h5><a id="ml-nlp-rerank-availability-serverless"></a>Elastic Cloud Serverless</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>Elastic Rerank is available in Elasticsearch Serverless projects as of November 25, 2024.</p>
<div class="position-relative"><h5><a id="ml-nlp-rerank-availability-elastic-stack"></a>Elastic Cloud Hosted and self-managed deployments</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>Elastic Rerank is available in Elastic Stack version 8.17+:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To use Elastic Rerank, you must have the appropriate subscription level or the trial period activated.
</li>
<li class="listitem">
<p>A 4GB ML node</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Deploying the Elastic Rerank model in combination with ELSER (or other hosted models) requires at minimum an 8GB ML node. The current maximum size for trial ML nodes is 4GB (defaults to 1GB).</p>
</div>
</div>
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="ml-nlp-rerank-deploy"></a>Download and deploy</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>To download and deploy Elastic Rerank, use the <a href="/guide/en/elasticsearch/reference/master/infer-service-elasticsearch.html" class="ulink" target="_top">create inference API</a> to create an Elasticsearch service <code class="literal">rerank</code> endpoint.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to this <a href="https://github.com/elastic/elasticsearch-labs/blob/main/notebooks/search/12-semantic-reranking-elastic-rerank.ipynb" class="ulink" target="_top">Python notebook</a> for an end-to-end example using Elastic Rerank.</p>
</div>
</div>
<div class="position-relative"><h5><a id="ml-nlp-rerank-deploy-steps"></a>Create an inference endpoint</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, navigate to the <span class="strong strong"><strong>Dev Console</strong></span>.
</li>
<li class="listitem">
<p>Create an inference endpoint with the Elastic Rerank service by running:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _inference/rerank/my-rerank-model
{
  "service": "elasticsearch",
  "service_settings": {
    "adaptive_allocations": {
      "enabled": true,
      "min_number_of_allocations": 1,
      "max_number_of_allocations": 10
    },
    "num_threads": 1,
    "model_id": ".rerank-v1"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/70.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The API request automatically downloads and deploys the model. This example uses <a class="xref" href="ml-nlp-auto-scale.html" title="Trained model autoscaling">autoscaling</a> through adaptive allocation.</p>
</div>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You might see a 502 bad gateway error in the response when using the Kibana Console.
This error usually just reflects a timeout, while the model downloads in the background.
You can check the download progress in the Machine Learning UI.
If using the Python client, you can set the <code class="literal">timeout</code> parameter to a higher value.</p>
</div>
</div>
<p>After creating the Elastic Rerank inference endpoint, it&#8217;s ready to use with a <a href="/guide/en/elasticsearch/reference/master/retriever.html#text-similarity-reranker-retriever-example-elastic-rerank" class="ulink" target="_top"><code class="literal">text_similarity_reranker</code></a> retriever.</p>
<div class="position-relative"><h4><a id="ml-nlp-rerank-deploy-verify"></a>Deploy in an air-gapped environment</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>If you want to deploy the Elastic Rerank model in a restricted or closed network, you have two options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Create your own HTTP/HTTPS endpoint with the model artifacts on it
</li>
<li class="listitem">
Put the model artifacts into a directory inside the config directory on all master-eligible nodes.
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="ml-nlp-rerank-model-artifacts"></a>Model artifact files</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>For the cross-platform version, you need the following files in your system:</p>
<pre class="screen">https://ml-models.elastic.co/rerank-v1.metadata.json
https://ml-models.elastic.co/rerank-v1.pt
https://ml-models.elastic.co/rerank-v1.vocab.json</pre>
<div class="position-relative"><h5><a id="_using_an_http_server_2"></a>Using an HTTP server</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>INFO: If you use an existing HTTP server, note that the model downloader only
supports passwordless HTTP servers.</p>
<p>You can use any HTTP service to deploy the model. This example uses the official
Nginx Docker image to set a new HTTP download service up.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the <a class="xref" href="ml-nlp-rerank.html#ml-nlp-rerank-model-artifacts" title="Model artifact files">model artifact files</a>.
</li>
<li class="listitem">
Put the files into a subdirectory of your choice.
</li>
<li class="listitem">
<p>Run the following commands:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">export ELASTIC_ML_MODELS="/path/to/models"
docker run --rm -d -p 8080:80 --name ml-models -v ${ELASTIC_ML_MODELS}:/usr/share/nginx/html nginx</pre>
</div>
<p>Don&#8217;t forget to change <code class="literal">/path/to/models</code> to the path of the subdirectory where
the model artifact files are located.</p>
<p>These commands start a local Docker image with an Nginx server with the
subdirectory containing the model files. As the Docker image has to be
downloaded and built, the first start might take a longer period of time.
Subsequent runs start quicker.</p>
</li>
<li class="listitem">
<p>Verify that Nginx runs properly by visiting the following URL in your
browser:</p>
<pre class="screen">http://{IP_ADDRESS_OR_HOSTNAME}:8080/rerank-v1.metadata.json</pre>
<p>If Nginx runs properly, you see the content of the metdata file of the model.</p>
</li>
<li class="listitem">
<p>Point your Elasticsearch deployment to the model artifacts on the HTTP server
by adding the following line to the <code class="literal">config/elasticsearch.yml</code> file:</p>
<pre class="screen">xpack.ml.model_repository: http://{IP_ADDRESS_OR_HOSTNAME}:8080</pre>
<p>If you use your own HTTP or HTTPS server, change the address accordingly. It is
important to specificy the protocol ("http://" or "https://"). Ensure that all
master-eligible nodes can reach the server you specify.</p>
</li>
<li class="listitem">
Repeat step 5 on all master-eligible nodes.
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/restart-cluster.html#restart-cluster-rolling" class="ulink" target="_top">Restart</a> the
master-eligible nodes one by one.
</li>
<li class="listitem">
Create an inference endpoint to deploy the model per <a class="xref" href="ml-nlp-rerank.html#ml-nlp-rerank-deploy-steps" title="Create an inference endpoint">these steps</a>.
</li>
</ol>
</div>
<p>The HTTP server is only required for downloading the model. After the download
has finished, you can stop and delete the service. You can stop the Docker image
used in this example by running the following command:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">docker stop ml-models</pre>
</div>
<div class="position-relative"><h5><a id="_using_file_based_access_2"></a>Using file-based access</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>For a file-based access, follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the <a class="xref" href="ml-nlp-rerank.html#ml-nlp-rerank-model-artifacts" title="Model artifact files">model artifact files</a>.
</li>
<li class="listitem">
Put the files into a <code class="literal">models</code> subdirectory inside the <code class="literal">config</code> directory of
your Elasticsearch deployment.
</li>
<li class="listitem">
<p>Point your Elasticsearch deployment to the model directory by adding the
following line to the <code class="literal">config/elasticsearch.yml</code> file:</p>
<pre class="screen">xpack.ml.model_repository: file://${path.home}/config/models/</pre>
</li>
<li class="listitem">
Repeat step 2 and step 3 on all master-eligible nodes.
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/restart-cluster.html#restart-cluster-rolling" class="ulink" target="_top">Restart</a> the
master-eligible nodes one by one.
</li>
<li class="listitem">
Create an inference endpoint to deploy the model per <a class="xref" href="ml-nlp-rerank.html#ml-nlp-rerank-deploy-steps" title="Create an inference endpoint">these steps</a>.
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="ml-nlp-rerank-limitations"></a>Limitations</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
English language only
</li>
<li class="listitem">
<p>Maximum context window of 512 tokens</p>
<p>When using the <a href="/guide/en/elasticsearch/reference/master/semantic-text.html" class="ulink" target="_top"><code class="literal">semantic_text</code> field type</a>, text is divided into chunks. By default, each chunk contains 250 words (approximately 400 tokens). Be cautious when increasing the chunk size - if the combined length of your query and chunk text exceeds 512 tokens, the model won&#8217;t have access to the full content.</p>
<p>When the combined inputs exceed the 512 token limit, a balanced truncation strategy is used. If both the query and input text are longer than 255 tokens each then both are truncated, otherwise the longest is truncated.</p>
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="ml-nlp-rerank-perf-considerations"></a>Performance considerations</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>It&#8217;s important to note that if you rerank to depth <code class="literal">n</code> then you will need to run <code class="literal">n</code> inferences per query. This will include the document text and will therefore be significantly more expensive than inference for query embeddings. Hardware can be scaled to run these inferences in parallel, but we would recommend shallow reranking for CPU inference: no more than top-30 results. You may find that the preview version is cost prohibitive for high query rates and low query latency requirements. We plan to address performance issues for GA.</p>
<div class="position-relative"><h4><a id="ml-nlp-rerank-model-specs"></a>Model specifications</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Purpose-built for English language content
</li>
<li class="listitem">
Relatively small: 184M parameters (86M backbone + 98M embedding layer)
</li>
<li class="listitem">
Matches performance of billion-parameter reranking models
</li>
<li class="listitem">
Built directly into Elasticsearch - no external services or dependencies needed
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="ml-nlp-rerank-arch-overview"></a>Model architecture</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>Elastic Rerank is built on the <a href="https://arxiv.org/abs/2111.09543" class="ulink" target="_top">DeBERTa v3</a> language model architecture.</p>
<p>The model employs several key architectural features that make it particularly effective for reranking:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Disentangled attention mechanism</strong></span> enables the model to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Process word content and position separately
</li>
<li class="listitem">
Learn more nuanced relationships between query and document text
</li>
<li class="listitem">
Better understand the semantic importance of word positions and relationships
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>ELECTRA-style pre-training</strong></span> uses:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A GAN-like approach to token prediction
</li>
<li class="listitem">
Simultaneous training of token generation and detection
</li>
<li class="listitem">
Enhanced parameter efficiency compared to traditional masked language modeling
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="ml-nlp-rerank-arch-training"></a>Training process</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>Here is an overview of the Elastic Rerank model training process:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Initial relevance extraction</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fine-tunes the pre-trained DeBERTa [CLS] token representation
</li>
<li class="listitem">
Uses a GeLU activation and dropout layer
</li>
<li class="listitem">
Preserves important pre-trained knowledge while adapting to the reranking task
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Trained by distillation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Uses an ensemble of bi-encoder and cross-encoder models as a teacher
</li>
<li class="listitem">
Bi-encoder provides nuanced negative example assessment
</li>
<li class="listitem">
Cross-encoder helps differentiate between positive and negative examples
</li>
<li class="listitem">
Combines strengths of both model types
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="ml-nlp-rerank-arch-data"></a>Training data</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>The training data consists of:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Open domain Question-Answering datasets
</li>
<li class="listitem">
Natural document pairs (like article headings and summaries)
</li>
<li class="listitem">
180,000 synthetic query-passage pairs with varying relevance
</li>
<li class="listitem">
Total of approximately 3 million queries
</li>
</ul>
</div>
<p>The data preparation process includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Basic cleaning and fuzzy deduplication
</li>
<li class="listitem">
Multi-stage prompting for diverse topics (on the synthetic portion of the training data only)
</li>
<li class="listitem">
<p>Varied query types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Keyword search
</li>
<li class="listitem">
Exact phrase matching
</li>
<li class="listitem">
Short and long natural language questions
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="ml-nlp-rerank-arch-sampling"></a>Negative sampling</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>The model uses an advanced sampling strategy to ensure high-quality rankings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Samples from top 128 documents per query using multiple retrieval methods
</li>
<li class="listitem">
Uses five negative samples per query - more than typical approaches
</li>
<li class="listitem">
Applies probability distribution shaped by document scores for sampling
</li>
<li class="listitem">
<p>Deep sampling benefits:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Improves model robustness across different retrieval depths
</li>
<li class="listitem">
Enhances score calibration
</li>
<li class="listitem">
Provides better handling of document diversity
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="ml-nlp-rerank-arch-optimization"></a>Training optimization</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>The training process incorporates several key optimizations:</p>
<p>Uses cross-entropy loss function to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Model relevance as probability distribution
</li>
<li class="listitem">
Learn relationships between all document scores
</li>
<li class="listitem">
Fit scores through maximum likelihood estimation
</li>
</ul>
</div>
<p>Implemented parameter averaging along optimization trajectory:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Eliminates need for traditional learning rate scheduling and provides improvement in the final model quality
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="ml-nlp-rerank-performance"></a>Performance</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p>Elastic Rerank shows significant improvements in search quality across a wide range of retrieval tasks.</p>
<div class="position-relative"><h5><a id="ml-nlp-rerank-performance-overview"></a>Overview</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Average 40% improvement in ranking quality when reranking BM25 results
</li>
<li class="listitem">
184M parameter model matches performance of 2B parameter alternatives
</li>
<li class="listitem">
Evaluated across 21 different datasets using the BEIR benchmark suite
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="ml-nlp-rerank-performance-benchmarks"></a>Key benchmark results</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Natural Questions: 90% improvement
</li>
<li class="listitem">
MS MARCO: 85% improvement
</li>
<li class="listitem">
Climate-FEVER: 80% improvement
</li>
<li class="listitem">
FiQA-2018: 76% improvement
</li>
</ul>
</div>
<p>For detailed benchmark information, including complete dataset results and methodology, refer to the <a href="/search-labs/introducing-elastic-rerank" class="ulink" target="_top">Introducing Elastic Rerank blog</a>.</p>
<div class="position-relative"><h4><a id="ml-nlp-rerank-resources"></a>Further resources</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/main/docs/en/stack/ml/nlp/ml-nlp-elastic-rerank.asciidoc">edit</a></div>
<p><span class="strong strong"><strong>Documentation</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/semantic-reranking.html#semantic-reranking-in-es" class="ulink" target="_top">Semantic re-ranking in Elasticsearch overview</a>
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/infer-service-elasticsearch.html#inference-example-elastic-reranker" class="ulink" target="_top">Inference API example</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Blogs</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/search-labs/blog/elastic-semantic-reranker-part-1" class="ulink" target="_top">Part 1</a>
</li>
<li class="listitem">
<a href="/search-labs/blog/elastic-semantic-reranker-part-2" class="ulink" target="_top">Part 2</a>
</li>
<li class="listitem">
<a href="/search-labs/blog/elastic-semantic-reranker-part-3" class="ulink" target="_top">Part 3</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Python notebooks</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/elasticsearch-labs/blob/main/notebooks/search/12-semantic-reranking-elastic-rerank.ipynb" class="ulink" target="_top">End-to-end example using Elastic Rerank in Python</a>
</li>
</ul>
</div>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</div><div class="navfooter">
<span class="prev">
<a href="ml-nlp-elser.html">« ELSER – Elastic Learned Sparse EncodeR</a>
</span>
<span class="next">
<a href="ml-nlp-e5.html">E5 – EmbEddings from bidirEctional Encoder rEpresentations »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
