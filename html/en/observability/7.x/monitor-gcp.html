<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Monitor Google Cloud Platform | Observability Guide [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Observability Guide [7.x]"/>
<link rel="up" href="observability-tutorials.html" title="Tutorials"/>
<link rel="prev" href="observability-tutorials.html" title="Tutorials"/>
<link rel="next" href="monitor-java-app.html" title="Monitor a Java application"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/7.x"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="7.x"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Observability Guide [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="observability-tutorials.html">Tutorials</a></span>
»
<span class="breadcrumb-node">Monitor Google Cloud Platform</span>
</div>
<div class="navheader">
<span class="prev">
<a href="observability-tutorials.html">« Tutorials</a>
</span>
<span class="next">
<a href="monitor-java-app.html">Monitor a Java application »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="monitor-gcp"></a>Monitor Google Cloud Platform<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h2>
</div></div></div>
<p>In this tutorial, you&#8217;ll learn how to monitor your Google Cloud Platform (GCP)
deployments using Elastic Observability: Logs and Metrics.</p>
<h3><a id="_what_youll_learn"></a>What you&#8217;ll learn<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h3>
<p>You&#8217;ll learn how to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Set up a GCP Service Account.
</li>
<li class="listitem">
Ingest metrics using the <a href="/guide/en/beats/metricbeat/7.x/metricbeat-module-gcp.html" class="ulink" target="_top">Metricbeat
Google Cloud Platform module</a> and view those metrics in Kibana.
</li>
<li class="listitem">
Export GCP audit logs through Pub/Sub topics.
</li>
<li class="listitem">
Ingest logs using the <a href="/guide/en/beats/filebeat/7.x/filebeat-module-gcp.html" class="ulink" target="_top">Filebeat
Google Cloud module</a> and view those logs in Kibana.
</li>
</ul>
</div>
<h3><a id="_before_you_begin"></a>Before you begin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h3>
<p>Create a deployment using our hosted Elasticsearch Service on <a href="/cloud/elasticsearch-service/signup?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">Elastic Cloud</a>.
The deployment includes an Elasticsearch cluster for storing and searching your data,
and Kibana for visualizing and managing your data.
For more information, see <a class="xref" href="add-observability-data.html#spin-up-stack" title="Spin up the Elastic Stack">Spin up the Elastic Stack</a>.</p>
<h3><a id="_step_1_setup_a_service_account"></a>Step 1: Setup a Service Account<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h3>
<p>Google Cloud Platform implements <a href="https://cloud.google.com/compute/docs/access/service-accounts" class="ulink" target="_top">service
accounts</a> as a way to access APIs securely. To monitor GCP with
Elastic, you will need a service account. The easiest way is to use a predefined
service account that GCP <a href="https://cloud.google.com/compute/docs/access/service-accounts?hl=en#default_service_account" class="ulink" target="_top">creates automatically</a>.
Alternatively, you can create a new service account.
This tutorial creates a new one.</p>
<p>First, to access the service account menu, click
<span class="strong strong"><strong>Menu</strong></span> &#8594; <span class="strong strong"><strong>IAM &amp; Admin</strong></span> &#8594; <span class="strong strong"><strong>Service Accounts</strong></span>.</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-service-account-menu.png" alt="Service account menu">
</div>
</div>
<p>Next, click <span class="strong strong"><strong>Create Service Account</strong></span>. Define the new service account
name (for example, "gcp-monitor") and the description (for example, "Service
account to monitor GCP services using the Elastic Stack").</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-service-account-name.png" alt="Service account name">
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure to select the correct roles.</p>
</div>
</div>
<p>To monitor GCP services, you need to add two main roles to the
service account:</p>
<p><span class="strong strong"><strong>Compute Viewer</strong></span>:</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-service-account-roles-compute-viewer.png" alt="Service account roles compute viewer">
</div>
</div>
<p><span class="strong strong"><strong>Monitoring Viewer</strong></span>:</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-service-account-roles-monitoring-viewer.png" alt="Service account roles monitoring viewer">
</div>
</div>
<p>The final result should be the following:</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-service-account-roles-final.png" alt="Service account roles result">
</div>
</div>
<p>Click <span class="strong strong"><strong>Continue</strong></span>, then skip granting users access to this service. Finally,
click <span class="strong strong"><strong>Done</strong></span>. The service account is now ready to be used.</p>
<p>Next, to use the service account, click <span class="strong strong"><strong>Create keys</strong></span> and create the
JSON key type.</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-service-account-create-key.png" alt="Service account create key">
</div>
</div>
<p>After clicking <span class="strong strong"><strong>Create key</strong></span>, the credential file is downloaded. Keep this file
in an accessible place to use later.</p>
<h3><a id="_step_2_install_and_configure_metricbeat"></a>Step 2: Install and configure Metricbeat<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h3>
<p>To monitor GCP using the Elastic Stack, you need two main components:
an Elastic deployment to store and analyze the data and an agent to collect
and ship the data.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This tutorial assumes the Elastic cluster is already running. Make sure you have your <span class="strong strong"><strong>cloud ID</strong></span> and your <span class="strong strong"><strong>credentials</strong></span> on hand.</p>
</div>
</div>
<p>Two agents can be used to monitor GCP: Metricbeat is used to
monitor metrics, and Filebeat to monitor logs. You can run the agents on any
machine. This tutorial uses a small GCP instance, e2-small (2 vCPUs,
2 GB memory), with an Ubuntu distribution.</p>
<h4><a id="_install_metricbeat"></a>Install Metricbeat<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h4>
<p>After starting and connecting to the GCP instance, download and install
Metricbeat.</p>
<div class="tabs" data-tab-group="os">
  <div role="tablist" aria-label="Install-m">
    <button role="tab"
            aria-selected="true"
            aria-controls="deb-tab-install-metricbeat"
            id="deb-install-metricbeat">
      DEB
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="rpm-tab-install-metricbeat"
            id="rpm-install-metricbeat"
            tabindex="-1">
      RPM
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="mac-tab-install-metricbeat"
            id="mac-install-metricbeat"
            tabindex="-1">
      MacOS
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="brew-tab-install-metricbeat"
            id="brew-install-metricbeat"
            tabindex="-1">
      Brew
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="linux-tab-install-metricbeat"
            id="linux-install-metricbeat"
            tabindex="-1">
      Linux
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="win-tab-install-metricbeat"
            id="win-install-metricbeat"
            tabindex="-1">
      Windows
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="deb-tab-install-metricbeat"
       aria-labelledby="deb-install-metricbeat">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.13.0-amd64.deb
sudo dpkg -i metricbeat-7.13.0-amd64.deb</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="rpm-tab-install-metricbeat"
       aria-labelledby="rpm-install-metricbeat"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.13.0-x86_64.rpm
sudo rpm -vi metricbeat-7.13.0-x86_64.rpm</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="mac-tab-install-metricbeat"
       aria-labelledby="mac-install-metricbeat"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.13.0-darwin-x86_64.tar.gz
tar xzvf metricbeat-7.13.0-darwin-x86_64.tar.gz</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="brew-tab-install-metricbeat"
       aria-labelledby="brew-install-metricbeat"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">brew tap elastic/tap
brew install elastic/tap/metricbeat-full</pre>
</div>
<p>This command installs the most recently released default distribution of
Metricbeat. To install the OSS distribution, specify
<code class="literal">elastic/tap/metricbeat-oss</code>.</p>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="linux-tab-install-metricbeat"
       aria-labelledby="linux-install-metricbeat"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.13.0-linux-x86_64.tar.gz
tar xzvf metricbeat-7.13.0-linux-x86_64.tar.gz</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="win-tab-install-metricbeat"
       aria-labelledby="win-install-metricbeat"
       hidden="">
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the Metricbeat Windows zip file from the
<a href="/downloads/beats/metricbeat" class="ulink" target="_top">downloads page</a>.
</li>
<li class="listitem">
Extract the contents of the zip file into <code class="literal">C:\Program Files</code>.
</li>
<li class="listitem">
Rename the <code class="literal">metricbeat-&lt;version&gt;-windows</code> directory to <code class="literal">Metricbeat</code>.
</li>
<li class="listitem">
Open a PowerShell prompt as an Administrator (right-click the PowerShell icon
and select <span class="strong strong"><strong>Run As Administrator</strong></span>).
</li>
<li class="listitem">
<p>From the PowerShell prompt, run the following commands to install
Metricbeat as a Windows service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">PS &gt; cd 'C:\Program Files\Metricbeat'
PS C:\Program Files\Metricbeat&gt; .\install-service-metricbeat.ps1</pre>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If script execution is disabled on your system, you need to set the
execution policy for the current session to allow the script to run. For
example:
<code class="literal">PowerShell.exe -ExecutionPolicy UnRestricted -File .\install-service-metricbeat.ps1</code>.</p>
</div>
</div>
  </div>
</div>
<h4><a id="_set_up_assets"></a>Set up assets<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h4>
<p>Metricbeat comes with predefined assets for parsing, indexing, and visualizing
your data. Run the following command to load these assets.
It may take a few minutes.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Substitute the Cloud ID from your deployment in the following command. To find
your Cloud ID, click on your <a href="https://cloud.elastic.co/deployments" class="ulink" target="_top">deployment</a>.</p>
</div>
</div>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./metricbeat setup -e -E 'cloud.id=YOUR_DEPLOYMENT_CLOUD_ID' -E 'cloud.auth=elastic:YOUR_SUPER_SECRET_PASS'</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Setting up Metricbeat is an admin-level task that requires extra privileges.
As a best practice, <a href="/guide/en/beats/metricbeat/7.x/privileges-to-setup-beats.html" class="ulink" target="_top">use an administrator role to set up</a>,
and a more restrictive role for event publishing (which you will do next).</p>
</div>
</div>
<h4><a id="_configure_metricbeat_output"></a>Configure Metricbeat output<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h4>
<p>Next, you are going to configure Metricbeat output to Elasticsearch Service.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Use the Metricbeat keystore to store
<a href="/guide/en/beats/metricbeat/7.x/keystore.html" class="ulink" target="_top">secure settings</a>.
Store the Cloud ID in the keystore.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./metricbeat keystore create
echo -n "&lt;Your Deployment Cloud ID&gt;" | ./metricbeat keystore add CLOUD_ID --stdin</pre>
</div>
</li>
<li class="listitem">
<p>To store metrics in Elasticsearch with minimal permissions, create an API key to send
data from Metricbeat to Elasticsearch Service. Log into Kibana (you can do so from the Cloud
Console without typing in any permissions) and select <span class="strong strong"><strong>Management</strong></span> &#8594; <span class="strong strong"><strong>Dev
Tools</strong></span>. Send the following request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/api_key
{
  "name": "metricbeat-monitor-gcp",
  "role_descriptors": {
    "metricbeat_writer": {
      "cluster": ["monitor", "read_ilm"],
      "index": [
        {
          "names": ["metricbeat-*"],
          "privileges": ["view_index_metadata", "create_doc"]
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1.console"></div>
</li>
<li class="listitem">
<p>The response contains an <code class="literal">api_key</code> and an <code class="literal">id</code> field, which can be stored in
the Metricbeat keystore in the following format: <code class="literal">id:api_key</code>.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">echo -n "IhrJJHMB4JmIUAPLuM35:1GbfxhkMT8COBB4JWY3pvQ" | ./metricbeat keystore add ES_API_KEY --stdin</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure you specify the <code class="literal">-n</code> parameter; otherwise, you will have
painful debugging sessions due to adding a newline at the end of
your API key.</p>
</div>
</div>
</li>
<li class="listitem">
<p>To see if both settings have been stored, run the following command:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">`./metricbeat keystore list`.</pre>
</div>
</li>
<li class="listitem">
<p>To configure Metricbeat to output to Elasticsearch Service, edit the <code class="literal">metricbeat.yml</code>
configuration file. Add the following lines to the end of the file.</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">cloud.id: ${CLOUD_ID}
output.elasticsearch:
  api_key: ${ES_API_KEY}</pre>
</div>
</li>
<li class="listitem">
<p>Finally, test if the configuration is working. If it is not working,
verify if you used the right credentials and add them again.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./metricbeat test output</pre>
</div>
</li>
</ol>
</div>
<p>Now that the output is working, you are going to set up the input (GCP).</p>
<h3><a id="_step_3_configure_metricbeat_google_cloud_platform_module"></a>Step 3: Configure Metricbeat Google Cloud Platform module<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h3>
<p>To collect metrics from Google Cloud Platform, use the
<a href="/guide/en/beats/metricbeat/7.x/metricbeat-module-gcp.html" class="ulink" target="_top">Google Cloud Platform</a>
module. This module periodically fetches monitoring metrics from Google Cloud
Platform using
<a href="https://cloud.google.com/monitoring/api/metrics_gcp" class="ulink" target="_top">Stackdriver Monitoring API</a>
for Google Cloud Platform services.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Extra GCP charges on Stackdriver Monitoring API requests may be generated by
this module. Please see
<a href="/guide/en/beats/metricbeat/7.x/metricbeat-module-gcp.html#gcp-api-requests" class="ulink" target="_top">rough estimation of the number of API calls</a>
for more details.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Enable the GCP module.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./metricbeat modules enable gcp</pre>
</div>
</li>
<li class="listitem">
<p>Edit the <code class="literal">modules.d/gcp.yml</code> file to configure which metrics to
collect.</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">- module: googlecloud
  metricsets:
    - compute <a id="CO29-1"></a><i class="conum" data-value="1"></i>
  zone: "" <a id="CO29-2"></a><i class="conum" data-value="2"></i>
  project_id: "your-project-id" <a id="CO29-3"></a><i class="conum" data-value="3"></i>
  period: 1m <a id="CO29-4"></a><i class="conum" data-value="4"></i>
  credentials_file_path: "/home/ubuntu/credentials.json" <a id="CO29-5"></a><i class="conum" data-value="5"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">compute</code> metricset is a predefined metricset that collects some
GCP compute metrics.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines which zones to monitor, an empty value collects data from <span class="strong strong"><strong>all</strong></span> zones</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Collects metrics within the <code class="literal">your-project-id</code> project-id.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Collects metrics every minute</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO29-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The GCP credential file that you generated earlier. (Don&#8217;t forget to create
the file if it does not exist and use the correct full path).</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>To check if Metricbeat can collect data, test the input by running the
following command:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./metricbeat test modules gcp</pre>
</div>
<p>Metricbeat will print GCP metrics to the terminal, if the setup is correct.</p>
</li>
<li class="listitem">
<p>When the input and output are ready, start Metricbeat to collect the data.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./metricbeat -e</pre>
</div>
</li>
<li class="listitem">
<p>Finally, log into Kibana and open the <span class="strong strong"><strong>[Metricbeat GCP] Compute Overview</strong></span>
dashboard.</p>
<p><span class="image"><img src="monitor-gcp-compute-overview-dashboard.png" alt="Metricbeat compute overview dashboard"></span></p>
</li>
</ol>
</div>
<h3><a id="_step_4_install_and_configure_filebeat"></a>Step 4: Install and configure Filebeat<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h3>
<p>Now that Metricbeat is up and running, configure Filebeat to
collect Google Cloud logs.</p>
<h4><a id="_install_filebeat"></a>Install Filebeat<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h4>
<p>On a new terminal window connected to the GCP instance, download and install
Filebeat.</p>
<div class="tabs" data-tab-group="os">
  <div role="tablist" aria-label="Install-f">
    <button role="tab"
            aria-selected="true"
            aria-controls="deb-tab-install-filebeat"
            id="deb-install-filebeat">
      DEB
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="rpm-tab-install-filebeat"
            id="rpm-install-filebeat"
            tabindex="-1">
      RPM
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="mac-tab-install-filebeat"
            id="mac-install-filebeat"
            tabindex="-1">
      MacOS
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="brew-tab-install-filebeat"
            id="brew-install-filebeat"
            tabindex="-1">
      Brew
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="linux-tab-install-filebeat"
            id="linux-install-filebeat"
            tabindex="-1">
      Linux
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="win-tab-install-filebeat"
            id="win-install-filebeat"
            tabindex="-1">
      Windows
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="deb-tab-install-filebeat"
       aria-labelledby="deb-install-filebeat">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.13.0-amd64.deb
sudo dpkg -i filebeat-7.13.0-amd64.deb</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="rpm-tab-install-filebeat"
       aria-labelledby="rpm-install-filebeat"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.13.0-x86_64.rpm
sudo rpm -vi filebeat-7.13.0-x86_64.rpm</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="mac-tab-install-filebeat"
       aria-labelledby="mac-install-filebeat"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.13.0-darwin-x86_64.tar.gz
tar xzvf filebeat-7.13.0-darwin-x86_64.tar.gz</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="brew-tab-install-filebeat"
       aria-labelledby="brew-install-filebeat"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">brew tap elastic/tap
brew install elastic/tap/filebeat-full</pre>
</div>
<p>This command installs the most recently released default distribution of
Filebeat. To install the OSS distribution, specify
<code class="literal">elastic/tap/filebeat-oss</code>.</p>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="linux-tab-install-filebeat"
       aria-labelledby="linux-install-filebeat"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.13.0-linux-x86_64.tar.gz
tar xzvf filebeat-7.13.0-linux-x86_64.tar.gz</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="win-tab-install-filebeat"
       aria-labelledby="win-install-filebeat"
       hidden="">
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the Filebeat Windows zip file from the
<a href="/downloads/beats/filebeat" class="ulink" target="_top">downloads page</a>.
</li>
<li class="listitem">
Extract the contents of the zip file into <code class="literal">C:\Program Files</code>.
</li>
<li class="listitem">
Rename the <code class="literal">filebeat-&lt;version&gt;-windows</code> directory to <code class="literal">Filebeat</code>.
</li>
<li class="listitem">
Open a PowerShell prompt as an Administrator (right-click the PowerShell icon
and select <span class="strong strong"><strong>Run As Administrator</strong></span>).
</li>
<li class="listitem">
<p>From the PowerShell prompt, run the following commands to install
Filebeat as a Windows service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">PS &gt; cd 'C:\Program Files\Filebeat'
PS C:\Program Files\Filebeat&gt; .\install-service-filebeat.ps1</pre>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If script execution is disabled on your system, you need to set the
execution policy for the current session to allow the script to run. For
example:
<code class="literal">PowerShell.exe -ExecutionPolicy UnRestricted -File .\install-service-filebeat.ps1</code>.</p>
</div>
</div>
  </div>
</div>
<h4><a id="_set_up_assets_2"></a>Set up assets<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h4>
<p>Similar to Metricbeat, Filebeat comes with predefined assets for parsing,
indexing, and visualizing your data.
Run the following command to load these assets. It may take a few minutes.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./filebeat setup -e -E 'cloud.id=YOUR_DEPLOYMENT_CLOUD_ID' -E 'cloud.auth=elastic:YOUR_SUPER_SECRET_PASS'</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Setting up Filebeat is an admin-level task that requires extra privileges.
As a best practice, <a href="/guide/en/beats/filebeat/7.x/privileges-to-setup-beats.html" class="ulink" target="_top">use an administrator role to set up</a>
and a more restrictive role for event publishing (which you will do next).</p>
</div>
</div>
<h4><a id="_configure_filebeat_output"></a>Configure Filebeat output<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h4>
<p>Next, you are going to configure Filebeat output to Elasticsearch Service.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Use the Filebeat keystore to store <a href="/guide/en/beats/filebeat/7.x/keystore.html" class="ulink" target="_top">secure
settings</a>. Store the Cloud ID in the keystore.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./filebeat keystore create
echo -n "&lt;Your Deployment Cloud ID&gt;" | ./filebeat keystore add CLOUD_ID --stdin</pre>
</div>
</li>
<li class="listitem">
<p>To store logs in Elasticsearch with minimal permissions, create an API key to send
data from Filebeat to Elasticsearch Service. Log into Kibana (you can do so from the Cloud
Console without typing in any permissions) and select <span class="strong strong"><strong>Management</strong></span> &#8594; <span class="strong strong"><strong>Dev
Tools</strong></span>. Send the following request:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/api_key
{
  "name": "filebeat-monitor-gcp",
  "role_descriptors": {
    "filebeat_writer": {
      "cluster": [
        "monitor",
        "read_ilm",
        "cluster:admin/ingest/pipeline/get", <a id="CO30-1"></a><i class="conum" data-value="1"></i>
        "cluster:admin/ingest/pipeline/put" <a id="CO30-2"></a><i class="conum" data-value="1"></i>
      ],
      "index": [
        {
          "names": ["filebeat-*"],
          "privileges": ["view_index_metadata", "create_doc"]
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO30-1"><i class="conum" data-value="1"></i></a><a href="#CO30-2"></a></p>
</td>
<td align="left" valign="top">
<p>Filebeat needs extra cluster permissions to publish logs, which differs
from the Metricbeat configuration used previously. You can find more
details <a href="/guide/en/beats/filebeat/7.x/feature-roles.html" class="ulink" target="_top">here</a>.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>The response contains an <code class="literal">api_key</code> and an <code class="literal">id</code> field, which can be stored in
the Filebeat keystore in the following format: <code class="literal">id:api_key</code>.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">echo -n "IhrJJHMB4JmIUAPLuM35:1GbfxhkMT8COBB4JWY3pvQ" | ./filebeat keystore add ES_API_KEY --stdin</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure you specify the <code class="literal">-n</code> parameter; otherwise, you will have
painful debugging sessions due to adding a newline at the end of
your API key.</p>
</div>
</div>
</li>
<li class="listitem">
<p>To see if both settings have been stored, run the following command:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./filebeat keystore list</pre>
</div>
</li>
<li class="listitem">
<p>To configure Filebeat to output to Elasticsearch Service, edit the <code class="literal">filebeat.yml</code>
configuration file. Add the following lines to the end of the file.</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">cloud.id: ${CLOUD_ID}
output.elasticsearch:
  api_key: ${ES_API_KEY}</pre>
</div>
</li>
<li class="listitem">
<p>Finally, test if the configuration is working. If it is not working,
verify that you used the right credentials and, if necessary, add them again.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./filebeat test output</pre>
</div>
</li>
</ol>
</div>
<p>Now that the output is working, you are going to set up the input (GCP).</p>
<h3><a id="_step_5_configure_filebeat_google_cloud_module"></a>Step 5: Configure Filebeat Google Cloud module<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.x/docs/en/observability/monitor-gcp.asciidoc">edit</a></h3>
<p>To collect logs from Google Cloud Platform, use the
<a href="/guide/en/beats/filebeat/7.x/filebeat-module-gcp.html" class="ulink" target="_top">Google Cloud Platform</a>
module. This module periodically fetches logs that have been exported from
Stackdriver to a Google Pub/Sub topic sink. There are three available filesets:
<code class="literal">audit</code>, <code class="literal">vpcflow</code>, <code class="literal">firewall</code>. This tutorial covers the <code class="literal">audit</code> fileset.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Go to the <span class="strong strong"><strong>Logs Router</strong></span> page to configure GCP to export logs to a Pub/Sub
topic. Use the search bar to find the page:</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-navigate-logs-router.png" alt="Navigate to Logs Router page">
</div>
</div>
<p>To set up the logs routing sink, click  <span class="strong strong"><strong>Create sink</strong></span>.
Set <span class="strong strong"><strong>sink name</strong></span> as <code class="literal">monitor-gcp-audit-sink</code>. Select the <span class="strong strong"><strong>Cloud Pub/Sub topic</strong></span> as the
<span class="strong strong"><strong>sink service</strong></span> and <span class="strong strong"><strong>Create new Cloud Pub/Sub topic</strong></span> named <code class="literal">monitor-gcp-audit</code>:</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-create-pubsub-topic.png" alt="Create Pub/Sub topic">
</div>
</div>
<p>Finally, under <span class="strong strong"><strong>Choose logs to include in sink</strong></span>, add
<code class="literal">logName:"cloudaudit.googleapis.com"</code> (it includes all audit logs).
Click <span class="strong strong"><strong>create sink</strong></span>.  It will look something like the following:</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-create-sink.png" alt="Create logs routing sink">
</div>
</div>
</li>
<li class="listitem">
<p>Now that GCP is configured to export audit logs, enable Filebeat Google Cloud module.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./filebeat modules enable gcp</pre>
</div>
</li>
<li class="listitem">
<p>Edit the <code class="literal">modules.d/gcp.yml</code> file with the following configurations.</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">- module: gcp
  vpcflow:
    enabled: false <a id="CO31-1"></a><i class="conum" data-value="1"></i>
  firewall:
    enabled: false <a id="CO31-2"></a><i class="conum" data-value="1"></i>
  audit:
    enabled: true <a id="CO31-3"></a><i class="conum" data-value="2"></i>
    var.project_id: "elastic-education" <a id="CO31-4"></a><i class="conum" data-value="3"></i>
    var.topic: "monitor-gcp-audit" <a id="CO31-5"></a><i class="conum" data-value="4"></i>
    var.subscription_name: "monitor-gcp-audit-sub" <a id="CO31-6"></a><i class="conum" data-value="5"></i>
    var.credentials_file: "/home/ubuntu/credentials.json" <a id="CO31-7"></a><i class="conum" data-value="6"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-1"><i class="conum" data-value="1"></i></a><a href="#CO31-2"></a></p>
</td>
<td align="left" valign="top">
<p>Disables both <code class="literal">vpcflow</code> and <code class="literal">firewall</code> filesets.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-3"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enables the <code class="literal">audit</code> fileset.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-4"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Collects data within the <code class="literal">elastic-education</code> project-id.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-5"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Collects logs from the <code class="literal">monitor-gcp-audit</code> topic.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-6"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Google Cloud Pub/Sub topic subscription name. If the subscription does not
exist it will be created.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO31-7"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>The GCP credential file that you generated earlier. (Don&#8217;t forget to create
the file if it does not exist and to use the correct full path).</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Start Filebeat to collect the logs.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./filebeat -e</pre>
</div>
</li>
<li class="listitem">
<p>Finally, log into Kibana and open the <span class="strong strong"><strong>[Filebeat GCP] Audit</strong></span>
dashboard.</p>
<div class="imageblock">
<div class="content">
<img src="monitor-gcp-audit-overview-dashboard.png" alt="Filebeat audit overview dashboard">
</div>
</div>
</li>
</ol>
</div>
<style>
.tabs {
  width: 100%;
}
[role="tablist"] {
  margin: 0 0 -0.1em;
  overflow: visible;
}
[role="tab"] {
  position: relative;
  padding: 0.3em 0.5em 0.4em;
  border: 1px solid hsl(219, 1%, 72%);
  border-radius: 0.2em 0.2em 0 0;
  overflow: visible;
  font-family: inherit;
  font-size: inherit;
  background: hsl(220, 20%, 94%);
}
[role="tab"]:hover::before,
[role="tab"]:focus::before,
[role="tab"][aria-selected="true"]::before {
  position: absolute;
  bottom: 100%;
  right: -1px;
  left: -1px;
  border-radius: 0.2em 0.2em 0 0;
  border-top: 3px solid hsl(219, 1%, 72%);
  content: '';
}
[role="tab"][aria-selected="true"] {
  border-radius: 0;
  background: hsl(220, 43%, 99%);
  outline: 0;
}
[role="tab"][aria-selected="true"]:not(:focus):not(:hover)::before {
  border-top: 5px solid hsl(218, 96%, 48%);
}
[role="tab"][aria-selected="true"]::after {
  position: absolute;
  z-index: 3;
  bottom: -1px;
  right: 0;
  left: 0;
  height: 0.3em;
  background: hsl(220, 43%, 99%);
  box-shadow: none;
  content: '';
}
[role="tab"]:hover,
[role="tab"]:focus,
[role="tab"]:active {
  outline: 0;
  border-radius: 0;
  color: inherit;
}
[role="tab"]:hover::before,
[role="tab"]:focus::before {
  border-color: hsl(218, 96%, 48%);
}
[role="tabpanel"] {
  position: relative;
  z-index: 2;
  padding: 1em;
  border: 1px solid hsl(219, 1%, 72%);
  border-radius: 0 0.2em 0.2em 0.2em;
  box-shadow: 0 0 0.2em hsl(219, 1%, 72%);
  background: hsl(220, 43%, 99%);
  margin-bottom: 1em;
}
[role="tabpanel"] p {
  margin: 0;
}
[role="tabpanel"] * + p {
  margin-top: 1em;
}
</style>

<script>
window.addEventListener("DOMContentLoaded", () => {
  const tabs = document.querySelectorAll('[role="tab"]');
  const tabList = document.querySelector('[role="tablist"]');
  // Add a click event handler to each tab
  tabs.forEach(tab => {
    tab.addEventListener("click", changeTabs);
  });
  // Enable arrow navigation between tabs in the tab list
  let tabFocus = 0;
  tabList.addEventListener("keydown", e => {
    // Move right
    if (e.keyCode === 39 || e.keyCode === 37) {
      tabs[tabFocus].setAttribute("tabindex", -1);
      if (e.keyCode === 39) {
        tabFocus++;
        // If we're at the end, go to the start
        if (tabFocus >= tabs.length) {
          tabFocus = 0;
        }
        // Move left
      } else if (e.keyCode === 37) {
        tabFocus--;
        // If we're at the start, move to the end
        if (tabFocus < 0) {
          tabFocus = tabs.length - 1;
        }
      }
      tabs[tabFocus].setAttribute("tabindex", 0);
      tabs[tabFocus].focus();
    }
  });
});

function setActiveTab(target) {
  const parent = target.parentNode;
  const grandparent = parent.parentNode;
  // console.log(grandparent);
  // Remove all current selected tabs
  parent
    .querySelectorAll('[aria-selected="true"]')
    .forEach(t => t.setAttribute("aria-selected", false));
  // Set this tab as selected
  target.setAttribute("aria-selected", true);
  // Hide all tab panels
  grandparent
    .querySelectorAll('[role="tabpanel"]')
    .forEach(p => p.setAttribute("hidden", true));
  // Show the selected panel
  grandparent.parentNode
    .querySelector(`#${target.getAttribute("aria-controls")}`)
    .removeAttribute("hidden");
}

function changeTabs(e) {
  // get the containing list of the tab that was just clicked
  const tabList = e.target.parentNode;

  // get all of the sibling tabs
  const buttons = Array.apply(null, tabList.querySelectorAll('button'));

  // loop over the siblings to discover which index thje clicked one was
  const { index } = buttons.reduce(({ found, index }, button) => {
    if (!found && buttons[index] === e.target) {
      return { found: true, index };
    } else if (!found) {
      return { found, index: index + 1 };
    } else {
      return { found, index };
    }
  }, { found: false, index: 0 });

  // get the tab container
  const container = tabList.parentNode;
  // read the data-tab-group value from the container, e.g. "os"
  const { tabGroup } = container.dataset;
  // get a list of all the tab groups that match this value on the page
  const groups = document.querySelectorAll('[data-tab-group=' + tabGroup + ']');

  // for each of the found tab groups, find the tab button at the previously discovered index and select it for each group
  groups.forEach((group) => {
    const target = group.querySelectorAll('button')[index];
    setActiveTab(target);
  });
}
</script>
</div>
<div class="navfooter">
<span class="prev">
<a href="observability-tutorials.html">« Tutorials</a>
</span>
<span class="next">
<a href="monitor-java-app.html">Monitor a Java application »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
