<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Monitor Amazon Web Services (AWS) with Elastic Serverless Forwarder | Elastic Observability [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Monitor Amazon Web Services (AWS) with Elastic Serverless Forwarder | Elastic Observability [8.15]">

<link rel="home" href="index.html" title="Elastic Observability [8.15]"/>
<link rel="up" href="monitor-amazon-web-services.html" title="Amazon Web Services (AWS) monitoring"/>
<link rel="prev" href="monitor-aws-firehose-troubleshooting.html" title="Troubleshooting"/>
<link rel="next" href="monitor-azure-web-services.html" title="Azure monitoring"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.15"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.15"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="monitor-aws-firehose-troubleshooting.html">« Troubleshooting</a>
</span>
<span class="next">
<a href="monitor-azure-web-services.html">Azure monitoring »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="monitor-amazon-web-services.html">Amazon Web Services (AWS) monitoring</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Monitor Amazon Web Services (AWS) with Elastic Serverless Forwarder</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="monitor-aws-esf"></a>Monitor Amazon Web Services (AWS) with Elastic Serverless Forwarder<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h2>
</div></div></div>

<p>The Elastic Serverless Forwarder (ESF) is an Amazon Web Services (AWS) Lambda function that ships logs from your AWS environment to Elastic. Elastic Serverless Forwarder is published in the AWS Serverless Application Repository (SAR). For more information on ESF, check the <a href="/guide/en/esf/master/aws-elastic-serverless-forwarder.html" class="ulink" target="_top">Elastic Serverless Forwarder Guide</a>.</p>
<h4><a id="aws-esf-what-you-learn"></a>What you&#8217;ll learn<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<p>In this tutorial, you&#8217;ll learn how to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Enable AWS VPC flow logs to be sent to your S3 bucket
</li>
<li class="listitem">
Create an SQS queue and notifications for VPC flow logs
</li>
<li class="listitem">
Install and configure the Elastic AWS integration from Kibana
</li>
<li class="listitem">
Visualize and analyze AWS logs in the Elastic Stack
</li>
</ul>
</div>
<h4><a id="aws-esf-prerequisites"></a>Before you begin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<p>Create a deployment using our hosted Elasticsearch Service on <a href="/cloud/elasticsearch-service/signup?page=docs&amp;placement=docs-body" class="ulink" target="_top">Elastic Cloud</a>.
The deployment includes an Elasticsearch cluster for storing and searching your data, and Kibana for visualizing and managing your data. Elastic Serverless Forwarder works with Elastic Stack 7.17 and later.
You also need an AWS account with permissions to pull the necessary data from AWS.</p>
<h4><a id="esf-step-one"></a>Step 1: Create an S3 Bucket to store VPC flow logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In the <a href="https://s3.console.aws.amazon.com/s3" class="ulink" target="_top">AWS S3 console</a>, choose <span class="strong strong"><strong>Create bucket</strong></span> from the left navigation pane.
</li>
<li class="listitem">
Specify the AWS region in which you want it deployed.
</li>
<li class="listitem">
Enter the bucket name.
</li>
</ol>
</div>
<p>For more details, refer to the Amazon documentation on how to <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/creating-bucket.html" class="ulink" target="_top">Create your first S3 bucket</a>.</p>
<h4><a id="esf-step-two"></a>Step 2: Enable AWS VPC flow logs to be sent to your S3 bucket<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In the <a href="https://console.aws.amazon.com/ec2/" class="ulink" target="_top">Amazon EC2 console</a>, choose <span class="strong strong"><strong>Network Interfaces</strong></span> from the left navigation pane.
</li>
<li class="listitem">
Select the network interface you want to use.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Actions</strong></span> drop-down menu, choose <span class="strong strong"><strong>Create flow log</strong></span>.
</li>
<li class="listitem">
For <span class="strong strong"><strong>Destination</strong></span>, select <span class="strong strong"><strong>Send to an S3 bucket</strong></span>.
</li>
<li class="listitem">
For <span class="strong strong"><strong>S3 bucket ARN</strong></span>, enter the name of the S3 bucket you created in the previous step.
</li>
</ol>
</div>
<p>For more details, refer to the Amazon documentation on how to <a href="https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs-s3.html" class="ulink" target="_top">Create a flow log that publishes to Amazon S3</a>.</p>
<h4><a id="esf-step-three"></a>Step 3: Create an SQS queue and notifications for VPC flow logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<p>The Amazon Simple Queue Service (SQS) event notification on Amazon S3 serves as a trigger for the Lambda function. When a new log file gets written to an Amazon S3 bucket and meets the criteria, a notification is generated that triggers the Lambda function.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In the <a href="https://console.aws.amazon.com/sqs/" class="ulink" target="_top">SQS console</a> create a standard SQS queue that uses the default settings.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure you set a visibility timeout of 910 seconds for any SQS queues you want to use as a trigger. This is 10 seconds greater than the Elastic Serverless Forwarder Lambda timeout. If this requirement is not met, CloudFormation will throw an error.</p>
</div>
</div>
</li>
<li class="listitem">
<p>In the <span class="strong strong"><strong>Advanced</strong></span> settings, modify the JSON access policy to define which S3 ObjectCreated events should be sent to the queue.
Here is an example of JSON file:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "Version": "2008-10-17",
  "Id": "__default_policy_ID",
  "Statement": [
    {
      "Sid": "__owner_statement",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::627286350134:root"
      },
      "Action": "SQS:*",
      "Resource": "arn:aws:sqs:eu-central-1:627286350134:vpc-flow-logs-docs-queue"
    },
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "s3.amazonaws.com"
      },
      "Action": "SQS:SendMessage",
      "Resource": "arn:aws:sqs:eu-central-1:627286350134:vpc-flow-logs-docs-queue"
    }
  ]
}</pre>
</div>
</li>
<li class="listitem">
Go to the properties of the S3 bucket containing the VPC flow logs and enable event notification.
</li>
</ol>
</div>
<p>For more details, refer to the AWS documentation on how to <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ways-to-add-notification-config-to-bucket.html" class="ulink" target="_top">Configure a bucket for notifications</a>.</p>
<h4><a id="esf-step-four"></a>Step 4: Install the Elastic AWS integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<p>Kibana offers prebuilt dashboards, ingest node configurations, and other assets that help you get the most value out of the logs you ingest.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Integrations</strong></span> in Kibana and search for AWS.
</li>
<li class="listitem">
Click the AWS integration, select <span class="strong strong"><strong>Settings</strong></span> and click <span class="strong strong"><strong>Install AWS assets</strong></span> to install all the AWS integration assets.
</li>
</ol>
</div>
<h4><a id="esf-step-five"></a>Step 5: Create a new S3 bucket to store the configuration file<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<p>Note that you can store more than one configuration file.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In the <a href="https://s3.console.aws.amazon.com/s3" class="ulink" target="_top">AWS S3 console</a>, click <span class="strong strong"><strong>Create</strong></span> bucket. Give the bucket a name and specify the region where you want it deployed.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure you create the S3 bucket in the same region as the bucket containing VPC flow logs.</p>
</div>
</div>
</li>
</ol>
</div>
<h4><a id="esf-step-six"></a>Step 6: Create a configuration file to specify the source and destination<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<p>Elastic Serverless Forwarder uses the configuration file to know the input source and the Elastic connection for the destination information.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Elastic Cloud, from the AWS Integrations page click <span class="strong strong"><strong>Connection details</strong></span> on the upper right corner and copy your Cloud ID.
</li>
<li class="listitem">
<p>Create an encoded API key for authentication.</p>
<p>You are going to reference both the Cloud ID and the newly created API key from the configuration file. Here is an example:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">inputs:
  - type: "s3-sqs"
    id: "&lt;your-sqs-queue-arn&gt;"
    outputs:
      - type: "elasticsearch"
        args:
          cloud_id: "&lt;your-cloud-id&gt;"
          api_key: "&lt;your-api-key&gt;&gt;"</pre>
</div>
</li>
<li class="listitem">
Upload the configuration file you have just created to the S3 bucket you created at step 5.
</li>
</ol>
</div>
<h4><a id="esf-step-seven"></a>Step 7: Ingest VPC flow logs into Elastic<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<p>Deploy the Elastic Serverless Forwarder from AWS SAR and provide appropriate configurations for the Lambda function to start ingesting VPC flow logs into Elastic.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
From the Lambda console select <span class="strong strong"><strong>Applications</strong></span> and click <span class="strong strong"><strong>Create Application</strong></span>.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Serverless application</strong></span> tab, select <span class="strong strong"><strong>elastic-serverless-forwarder</strong></span>.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>Review, configure and deploy</strong></span> page, fill in the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>ElasticServerlessForwarderS3Buckets</strong></span>: Specify the ARN of the S3 Bucket you created at step 1 where the VPC Flow Logs are sent.
</li>
<li class="listitem">
<span class="strong strong"><strong>ElasticServerlessForwarderS3ConfigFile</strong></span>: Specify the URL of the configuration file in the format "s3://bucket-name/config-file-name".
</li>
<li class="listitem">
<span class="strong strong"><strong>ElasticServerlessForwarderS3SQSEvents</strong></span>: Specify the S3 SQS Notifications queue used as the trigger of the Lambda function. The value is the ARN of the SQS Queue you created at step 3.
</li>
</ul>
</div>
</li>
</ol>
</div>
<p>The above values are used by the Lambda deployment to create minimal IAM policies and set up the environment variables for the Lambda function to execute properly.
The deployed Lambda will read the VPC flow log files as they get written to the S3 bucket and send it to Elastic.</p>
<h4><a id="esf-step-eight"></a>Step 8: Visualize AWS logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/cloud-monitoring/aws/monitor-aws-esf.asciidoc">edit</a></h4>
<p>Navigate to Kibana to see your logs parsed and visualized in the [Logs AWS] VPC Flow Log Overview dashboard.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="monitor-aws-firehose-troubleshooting.html">« Troubleshooting</a>
</span>
<span class="next">
<a href="monitor-azure-web-services.html">Azure monitoring »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
