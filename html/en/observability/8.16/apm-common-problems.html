<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Common problems | Elastic Observability [8.16] | Elastic</title>
<meta class="elastic" name="content" content="Common problems | Elastic Observability [8.16]">

<link rel="home" href="index.html" title="Elastic Observability [8.16]"/>
<link rel="up" href="apm-troubleshoot-apm.html" title="Troubleshooting APM"/>
<link rel="prev" href="apm-troubleshoot-apm.html" title="Troubleshooting APM"/>
<link rel="next" href="apm-server-es-down.html" title="What happens when APM Server or Elasticsearch is down?"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.16"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.16"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="apm-troubleshoot-apm.html">« Troubleshooting APM</a>
</span>
<span class="next">
<a href="apm-server-es-down.html">What happens when APM Server or Elasticsearch is down? »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="application-and-service-monitoring.html">Application and service monitoring</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-troubleshoot-apm.html">Troubleshooting APM</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Common problems</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="apm-common-problems"></a>Common problems</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
</div></div></div>
<p>This section describes common problems you might encounter when using APM Server and the APM UI in Kibana.</p>
<p><span class="strong strong"><strong>APM Server</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-no-data-indexed" title="No data is indexed">No data is indexed</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-common-ssl-problems" title="Common SSL-related problems">Common SSL-related problems</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-io-timeout" title="I/O Timeout">I/O Timeout</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-field-limit-exceeded" title="Field limit exceeded">Field limit exceeded</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-tail-based-sampling-memory-disk-io" title="Tail-based sampling causing high system memory usage and high disk IO">Tail-based sampling causing high system memory usage and high disk IO</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>APM UI</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="apm-common-problems.html#no-apm-data-found" title="Data doesn&#8217;t appear in the APM UI">Data doesn&#8217;t appear in the APM UI</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#troubleshooting-too-many-transactions" title="Too many unique transaction names">Too many unique transaction names</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#troubleshooting-unknown-route" title="Unknown route">Unknown route</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#troubleshooting-fields-unsearchable" title="Fields are not searchable">Fields are not searchable</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#service-map-rum-connections" title="Service Maps: no connection between client and server">Service Maps: no connection between client and server</a>
</li>
</ul>
</div>
<div class="position-relative"><h6><a id="apm-no-data-indexed"></a>No data is indexed</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>If no data shows up in Elasticsearch, first make sure that your APM components are properly connected.</p>
<div class="tabs" data-tab-group="ts">
  <div role="tablist" aria-label="No data indexed">
    <button role="tab"
            aria-selected="true"
            aria-controls="fm-tab-ts"
            id="fm-ts">
      Fleet-managed
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="binary-tab-ts"
            id="binary-ts"
            tabindex="-1">
      APM Server binary
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="fm-tab-ts"
       aria-labelledby="fm-ts">
<p><span class="strong strong"><strong>Is Elastic Agent healthy?</strong></span></p>
<p>In Kibana open <span class="strong strong"><strong>Fleet</strong></span> and find the host that is running the APM integration;
confirm that its status is <span class="strong strong"><strong>Healthy</strong></span>.
If it isn&#8217;t, check the Elastic Agent logs to diagnose potential causes.
See <a href="/guide/en/fleet/8.16/monitor-elastic-agent.html" class="ulink" target="_top">Monitor Elastic Agents</a> to learn more.</p>
<p><span class="strong strong"><strong>Is APM Server happy?</strong></span></p>
<p>In Kibana, open <span class="strong strong"><strong>Fleet</strong></span> and select the host that is running the APM integration.
Open the <span class="strong strong"><strong>Logs</strong></span> tab and select the <code class="literal">elastic_agent.apm_server</code> dataset.
Look for any APM Server errors that could help diagnose the problem.</p>
<p><span class="strong strong"><strong>Can the APM agent connect to APM Server</strong></span></p>
<p>To determine if the APM agent can connect to the APM Server, send requests to the instrumented service and look for lines
containing <code class="literal">[request]</code> in the APM Server logs.</p>
<p>If no requests are logged, confirm that:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
SSL isn&#8217;t <a class="xref" href="apm-common-problems.html#apm-ssl-client-fails" title="SSL client fails to connect">misconfigured</a>.
</li>
<li class="listitem">
The host is correct. For example, if you&#8217;re using Docker, ensure a bind to the right interface (for example, set
<code class="literal">apm-server.host = 0.0.0.0:8200</code> to match any IP) and set the <code class="literal">SERVER_URL</code> setting in the APM agent accordingly.
</li>
</ol>
</div>
<p>If you see requests coming through the APM Server but they are not accepted (a response code other than <code class="literal">202</code>),
see <a class="xref" href="apm-common-response-codes.html" title="APM Server response codes">APM Server response codes</a> to narrow down the possible causes.</p>
<p><span class="strong strong"><strong>Instrumentation gaps</strong></span></p>
<p>APM agents provide auto-instrumentation for many popular frameworks and libraries.
If the APM agent is not auto-instrumenting something that you were expecting, data won&#8217;t be sent to the Elastic Stack.
Reference the relevant <a href="/guide/en/apm/agent/index.html" class="ulink" target="_top">APM agent documentation</a> for details on what is automatically instrumented.</p>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="binary-tab-ts"
       aria-labelledby="binary-ts"
       hidden="">
<p>If no data shows up in Elasticsearch, first check that the APM components are properly connected.</p>
<p>To ensure that APM Server configuration is valid and it can connect to the configured output, Elasticsearch by default,
run the following commands:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server test config
apm-server test output</pre>
</div>
<p>To see if the agent can connect to the APM Server, send requests to the instrumented service and look for lines
containing <code class="literal">[request]</code> in the APM Server logs.</p>
<p>If no requests are logged, it might be that SSL is <a class="xref" href="apm-common-problems.html#apm-ssl-client-fails" title="SSL client fails to connect">misconfigured</a> or that the host is wrong.
Particularly, if you are using Docker, ensure to bind to the right interface (for example, set
<code class="literal">apm-server.host = 0.0.0.0:8200</code> to match any IP) and set the <code class="literal">SERVER_URL</code> setting in the agent accordingly.</p>
<p>If you see requests coming through the APM Server but they are not accepted (response code other than <code class="literal">202</code>), consider
the response code to narrow down the possible causes (see sections below).</p>
<p>Another reason for data not showing up is that the agent is not auto-instrumenting something you were expecting, check
the <a href="/guide/en/apm/agent/index.html" class="ulink" target="_top">agent documentation</a> for details on what is automatically instrumented.</p>
<p>APM Server currently relies on Elasticsearch to create indices that do not exist.
As a result, Elasticsearch must be configured to allow <a href="/guide/en/elasticsearch/reference/8.16/docs-index_.html#index-creation" class="ulink" target="_top">automatic index creation</a> for APM indices.</p>
  </div>
</div>
<div class="position-relative"><h6><a id="apm-common-ssl-problems"></a>Common SSL-related problems</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-ssl-client-fails" title="SSL client fails to connect">SSL client fails to connect</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-cannot-validate-certificate" title="x509: cannot validate certificate for &lt;IP address&gt; because it doesn&#8217;t contain any IP SANs">x509: cannot validate certificate</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-getsockopt-no-route-to-host" title="getsockopt: no route to host">getsockopt: no route to host</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-getsockopt-connection-refused" title="getsockopt: connection refused">getsockopt: connection refused</a>
</li>
<li class="listitem">
<a class="xref" href="apm-common-problems.html#apm-target-machine-refused-connection" title="No connection could be made because the target machine actively refused it">No connection could be made because the target machine actively refused it</a>
</li>
</ul>
</div>
<div class="position-relative"><h7><a id="apm-ssl-client-fails"></a>SSL client fails to connect</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>The target host might be unreachable or the certificate may not be valid.
To fix this problem:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Make sure that the APM Server process on the target host is running and you can connect to it.
Try to ping the target host to verify that you can reach it from the host running APM Server.
Then use either <code class="literal">nc</code> or <code class="literal">telnet</code> to make sure that the port is available. For example:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">ping &lt;hostname or IP&gt;
telnet &lt;hostname or IP&gt; 5044</pre>
</div>
</li>
<li class="listitem">
Verify that the certificate is valid and that the hostname and IP match.
</li>
<li class="listitem">
Use OpenSSL to test connectivity to the target server and diagnose problems.
See the <a href="https://www.openssl.org/docs/manmaster/man1/openssl-s_client.html" class="ulink" target="_top">OpenSSL documentation</a> for more info.
</li>
</ol>
</div>
<div class="position-relative"><h7><a id="apm-cannot-validate-certificate"></a>x509: cannot validate certificate for &lt;IP address&gt; because it doesn&#8217;t contain any IP SANs</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>This happens because your certificate is only valid for the hostname present in the Subject field.
To resolve this problem, try one of these solutions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Create a DNS entry for the hostname, mapping it to the server&#8217;s IP.
</li>
<li class="listitem">
Create an entry in <code class="literal">/etc/hosts</code> for the hostname. Or, on Windows, add an entry to
<code class="literal">C:\Windows\System32\drivers\etc\hosts</code>.
</li>
<li class="listitem">
Re-create the server certificate and add a Subject Alternative Name (SAN) for the IP address of the server. This makes the
server&#8217;s certificate valid for both the hostname and the IP address.
</li>
</ul>
</div>
<div class="position-relative"><h7><a id="apm-getsockopt-no-route-to-host"></a>getsockopt: no route to host</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>This is not an SSL problem. It&#8217;s a networking problem. Make sure the two hosts can communicate.</p>
<div class="position-relative"><h7><a id="apm-getsockopt-connection-refused"></a>getsockopt: connection refused</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>This is not an SSL problem. Make sure that Logstash is running and that there is no firewall blocking the traffic.</p>
<div class="position-relative"><h7><a id="apm-target-machine-refused-connection"></a>No connection could be made because the target machine actively refused it</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>A firewall is refusing the connection. Check if a firewall is blocking the traffic on the client, the network, or the
destination host.</p>
<div class="position-relative"><h6><a id="apm-io-timeout"></a>I/O Timeout</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>I/O Timeouts can occur when your timeout settings across the stack are not configured correctly,
especially when using a load balancer.</p>
<p>You may see an error like the one below in the APM agent logs, and/or a similar error on the APM Server side:</p>
<div class="pre_wrapper lang-logs">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-logs">[ElasticAPM] APM Server responded with an error:
"read tcp 123.34.22.313:8200-&gt;123.34.22.40:41602: i/o timeout"</pre>
</div>
<p>To fix this, ensure timeouts are incrementing from the APM agent,
through your load balancer, to the APM Server.</p>
<p>By default, the agent timeouts are set at 10 seconds, and the server timeout is set at 3600 seconds.
Your load balancer should be set somewhere between these numbers.</p>
<p>For example:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">APM agent --&gt; Load Balancer  --&gt; APM Server
   10s            15s               3600s</pre>
</div>
<p>The APM Server timeout can be configured by updating the
<a class="xref" href="apm-configuration-process.html#apm-read_timeout" title="Read timeout">maximum duration for reading an entire request</a>.</p>
<div class="position-relative"><h6><a id="apm-field-limit-exceeded"></a>Field limit exceeded</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>When adding too many distinct tag keys on a transaction or span,
you risk creating a <a href="/guide/en/elasticsearch/reference/8.16/mapping.html#mapping-limit-settings" class="ulink" target="_top">mapping explosion</a>.</p>
<p>For example, you should avoid that user-specified data,
like URL parameters, is used as a tag key.
Likewise, using the current timestamp or a user ID as a tag key is not a good idea.
However, tag <span class="strong strong"><strong>values</strong></span> with a high cardinality are not a problem.
Just try to keep the number of distinct tag keys at a minimum.</p>
<p>The symptom of a mapping explosion is that transactions and spans are not indexed anymore after a certain time. Usually, on the next day,
the spans and transactions will be indexed again because a new index is created each day.
But as soon as the field limit is reached, indexing stops again.</p>
<p>In the agent logs, you won&#8217;t see a sign of failures as the APM server asynchronously sends the data it received from the agents to Elasticsearch. However, the APM server and Elasticsearch log a warning like this:</p>
<div class="pre_wrapper lang-logs">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-logs">{\"type\":\"illegal_argument_exception\",\"reason\":\"Limit of total fields [1000] in [INDEX_NAME] has been exceeded\"}</pre>
</div>
<div class="position-relative"><h6><a id="apm-tail-based-sampling-memory-disk-io"></a>Tail-based sampling causing high system memory usage and high disk IO</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>Tail-based sampling requires minimal memory to run, and there should not be a noticeable increase in RSS memory usage.
However, since tail-based sampling writes data to disk,
it is possible to see a significant increase in OS page cache memory usage due to disk IO.
If you see a drop in throughput and excessive disk activity after enabling tail-based sampling,
please ensure that there is enough memory headroom in the system for OS page cache to perform disk IO efficiently.</p>
<div class="position-relative"><h6><a id="no-apm-data-found"></a>Data doesn&#8217;t appear in the APM UI</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>This section can help with any of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Data isn&#8217;t displaying in the APM UI
</li>
<li class="listitem">
Data isn&#8217;t displaying in the APM UI after an upgrade
</li>
<li class="listitem">
You see a message like "No Services Found",
</li>
<li class="listitem">
You see errors like "Fielddata is disabled on text fields by default&#8230;&#8203;"
</li>
</ul>
</div>
<p>These problems are likely to be caused by a missing index template or ingest pipeline.
By default, Fleet sets up these and other APM assets when the APM integration is installed.
Try reinstalling the APM integration by navigating to
<span class="strong strong"><strong>Integrations</strong></span> → <span class="strong strong"><strong>Elastic APM</strong></span> → <span class="strong strong"><strong>Manage in Fleet</strong></span> → <span class="strong strong"><strong>Settings</strong></span> → <span class="strong strong"><strong>Reinstall Elastic APM</strong></span>.</p>
<p>Because assets cannot be applied to indices retroactively,
after reinstalling the APM integration you must either wait for the index to rollover or force a rollover.
To force a rollover, use the <a href="/guide/en/elasticsearch/reference/8.16/indices-rollover-index.html" class="ulink" target="_top">rollover API</a> to target the relevant <a href="/guide/en/apm/guide/8.16/apm-data-streams.html" class="ulink" target="_top">APM data streams</a>.</p>
<div class="position-relative"><h7><a id="apm-data-indexed-no-apm"></a>Data is indexed but doesn&#8217;t appear in the APM UI</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>The APM UI relies on index mappings to query and display data.
If your APM data isn&#8217;t showing up in the APM UI, but is elsewhere in Kibana, like the Discover app,
you may have a missing index mapping.</p>
<p>You can determine if a field was mapped correctly with the <code class="literal">_mapping</code> API.
For example, run the following command in the Kibana <a href="/guide/en/kibana/8.16/console-kibana.html" class="ulink" target="_top">console</a>.
This will display the field data type of the <code class="literal">service.name</code> field.</p>
<div class="pre_wrapper lang-curl">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-curl">GET *apm*/_mapping/field/service.name</pre>
</div>
<p>If the <code class="literal">mapping.name.type</code> is <code class="literal">"text"</code>, your APM indices were not set up correctly.</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">".ds-metrics-apm.transaction.1m-default-2023.04.12-000038": {
   "mappings": {
      "service.name": {
         "full_name": "service.name",
         "mapping": {
            "name": {
               "type": "text" <a id="CO69-1"></a><i class="conum" data-value="1"></i>
            }
         }
      }
   }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO69-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">service.name</code> <code class="literal">mapping.name.type</code> would be <code class="literal">"keyword"</code> if this field had been set up correctly.</p>
</td>
</tr>
</table>
</div>
<p>To fix this problem, install the APM integration by following these steps:</p>
<details open>
<summary class="title"><span class="strong strong"><strong>If you have an internet connection</strong></span></summary>
<div class="content">
<p>An internet connection is required to install the APM integration via the Fleet UI in Kibana.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and select <span class="strong strong"><strong>Add integrations</strong></span> &gt; <span class="strong strong"><strong>Elastic APM</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>APM integration</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic APM</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic Agent later</strong></span>. You do not need to run an Elastic Agent to complete the setup.
</li>
</ol>
</div>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>If you don&#8217;t have an internet connection</strong></span></summary>
<div class="content">
<p>If your environment has network traffic restrictions, there are other ways to install the APM integration.
See <a href="/guide/en/fleet/8.16/air-gapped.html" class="ulink" target="_top">Air-gapped environments</a> for more information.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Option 1: Update <code class="literal">kibana.yml</code>
</span>
</dt>
<dd>
<p>Update <code class="literal">kibana.yml</code> to include the following, then restart Kibana.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.fleet.packages:
- name: apm
  version: latest</pre>
</div>
<p>See <a href="/guide/en/kibana/8.16/settings.html" class="ulink" target="_top">Configure Kibana</a> to learn more about how to edit the Kibana configuration file.</p>
</dd>
<dt>
<span class="term">
Option 2: Use the Fleet API
</span>
</dt>
<dd>
<p>Use the Fleet API to install the APM integration. To be successful, this needs to be run against the Kibana
API, not the Elasticsearch API.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">POST kbn:/api/fleet/epm/packages/apm/8.16.0
{ "force": true }</pre>
</div>
<p>See <a href="/guide/en/kibana/8.16/api.html" class="ulink" target="_top">Kibana API</a> to learn more about how to use the Kibana APIs.</p>
</dd>
</dl>
</div>
</div>
</details>
<p>This will reinstall the APM index templates and trigger a data stream index rollover.</p>
<p>You can verify the correct index templates were installed by running the following command in the Kibana console:</p>
<div class="pre_wrapper lang-curl">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-curl">GET /_index_template/traces-apm</pre>
</div>
<div class="position-relative"><h6><a id="troubleshooting-too-many-transactions"></a>Too many unique transaction names</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>Transaction names are defined in each APM agent; when an APM agent supports a framework,
it includes logic for naming the transactions that the framework creates.
In some cases though, like when using an APM agent&#8217;s API to create custom transactions,
it is up to the user to define a pattern for transaction naming.
When transactions are named incorrectly, each unique URL can be associated with a unique transaction group—causing
an explosion in the number of transaction groups per service, and leading to inaccuracies in the APM UI.</p>
<p>To fix a large number of unique transaction names,
you need to change how you are using the APM agent API to name your transactions.
To do this, ensure you are <span class="strong strong"><strong>not</strong></span> naming based on parameters that can change.
For example, user ids, product ids, order numbers, query parameters, etc.,
should be stripped away, and commonality should be found between your unique URLs.</p>
<p>Let&#8217;s look at an example from the RUM agent documentation. Here are a few URLs you might find on Elastic.co:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">// Blog Posts
https://www.elastic.co/blog/reflections-on-three-years-in-the-elastic-public-sector
https://www.elastic.co/blog/say-heya-to-the-elastic-search-awards
https://www.elastic.co/blog/and-the-winner-of-the-elasticon-2018-training-subscription-drawing-is

// Documentation
https://www.elastic.co/guide/en/elastic-stack/current/index.html
https://www.elastic.co/guide/en/apm/get-started/current/index.html
https://www.elastic.co/guide/en/infrastructure/guide/current/index.html</pre>
</div>
<p>These URLs, like most, include unique names.
If we named transactions based on each unique URL, we&#8217;d end up with the problem described above—a
very large number of different transaction names.
Instead, we should strip away the unique information and group our transactions based on common information.
In this case, that means naming all blog transactions, <code class="literal">/blog</code>, and all documentation transactions, <code class="literal">/guide</code>.</p>
<p>If you feel like you&#8217;d be losing valuable information by following this naming convention, don&#8217;t fret!
You can always add additional metadata to your transactions using <a href="/guide/en/apm/guide/8.16/data-model-metadata.html#data-model-labels" class="ulink" target="_top">labels</a> (indexed) or
<a href="/guide/en/apm/guide/8.16/data-model-metadata.html#data-model-custom" class="ulink" target="_top">custom context</a> (non-indexed).</p>
<p>After ensuring you&#8217;ve correctly named your transactions,
you might still see errors in the APM UI related to transaction group limit reached:</p>
<p><code class="literal">The number of transaction groups has been reached. Current APM server capacity for handling unique transaction groups has been reached. There are at least X transactions missing in this list. Please decrease the number of transaction groups in your service or increase the memory allocated to APM server.</code></p>
<p>You will see this warning if an agent is creating too many transaction groups. This could indicate incorrect instrumentation which will have to be fixed in your application. Alternatively you can increase the memory of the APM server.</p>
<p><code class="literal">Number of transaction groups exceed the allowed maximum(1,000) that are displayed. The maximum number of transaction groups displayed in Kibana has been reached. Try narrowing down results by using the query bar..</code></p>
<p>You will see this warning if your results have more than <code class="literal">1000</code> unique transaction groups. Alternatively you can use the query bar to reduce the number of unique transaction groups in your results.</p>
<p><span class="strong strong"><strong>More information</strong></span></p>
<p>While this can happen with any APM agent, it typically occurs with the RUM agent.
For more information on how to correctly set <code class="literal">transaction.name</code> in the RUM agent,
see <a href="/guide/en/apm/agent/rum-js/current/custom-transaction-name.html" class="ulink" target="_top">custom initial page load transaction names</a>.</p>
<p>The RUM agent can also set the <code class="literal">transaction.name</code> when observing for transaction events.
See <a href="/guide/en/apm/agent/rum-js/current/agent-api.html#observe" class="ulink" target="_top"><code class="literal">apm.observe()</code></a> for more information.</p>
<p>If your problem is occurring in a different APM agent, the tips above still apply.
See the relevant <a href="/guide/en/apm/agent" class="ulink" target="_top">Agent API documentation</a> to adjust how you&#8217;re naming your transactions.</p>
<div class="position-relative"><h6><a id="troubleshooting-unknown-route"></a>Unknown route</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>The <a class="xref" href="apm-transactions.html" title="Transactions">transaction overview</a> will only display helpful information
when the transactions in your services are named correctly.
If you&#8217;re seeing "GET unknown route" or "unknown route" in the APM UI,
it could be a sign that something isn&#8217;t working as it should.</p>
<p>Elastic APM agents come with built-in support for popular frameworks out-of-the-box.
This means, among other things, that the APM agent will try to automatically name HTTP requests.
As an example, the Node.js agent uses the route that handled the request, while the Java agent uses the Servlet name.</p>
<p>"Unknown route" indicates that the APM agent can&#8217;t determine what to name the request,
perhaps because the technology you&#8217;re using isn&#8217;t supported, the agent has been installed incorrectly,
or because something is happening to the request that the agent doesn&#8217;t understand.</p>
<p>To resolve this, you&#8217;ll need to head over to the relevant <a href="/guide/en/apm/agent" class="ulink" target="_top">APM agent documentation</a>.
Specifically, view the agent&#8217;s supported technologies page.
You can also use the agent&#8217;s public API to manually set a name for the transaction.</p>
<div class="position-relative"><h6><a id="troubleshooting-fields-unsearchable"></a>Fields are not searchable</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>In Elasticsearch, index templates are used to define settings and mappings that determine how fields should be analyzed.
The recommended index templates for APM are installed by Fleet when the Elastic APM integration is installed.
These templates, by default, enable and disable indexing on certain fields.</p>
<p>As an example, some APM agents store cookie values in <code class="literal">http.request.cookies</code>.
Since <code class="literal">http.request</code> has disabled dynamic indexing, and <code class="literal">http.request.cookies</code> is not declared in a custom mapping,
the values in <code class="literal">http.request.cookies</code> are not indexed and thus not searchable.</p>
<p><span class="strong strong"><strong>Ensure an APM data view exists</strong></span>
As a first step, you should ensure the correct data view exists.
In Kibana, go to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>Data views</strong></span>.
You should see the APM data view&#8212;&#8203;the default is
<code class="literal">traces-apm*,apm-*,logs-apm*,apm-*,metrics-apm*,apm-*</code>.
If you don&#8217;t, the data view doesn&#8217;t exist.
To fix this, navigate to the APM UI in Kibana and select <span class="strong strong"><strong>Add data</strong></span>.
In the APM tutorial, click <span class="strong strong"><strong>Load Kibana objects</strong></span> to create the APM data view.</p>
<p>If creating an APM data view doesn&#8217;t solve the problem,
see <a class="xref" href="apm-common-problems.html#no-apm-data-found" title="Data doesn&#8217;t appear in the APM UI">Data doesn&#8217;t appear in the APM UI</a> for further troubleshooting.</p>
<p><span class="strong strong"><strong>Ensure a field is searchable</strong></span>
There are two things you can do to if you&#8217;d like to ensure a field is searchable:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Index your additional data as <a href="/guide/en/apm/guide/8.16/data-model-metadata.html" class="ulink" target="_top">labels</a> instead.
These are dynamic by default, which means they will be indexed and become searchable and aggregatable.
</li>
<li class="listitem">
Create a custom mapping for the field.
</li>
</ol>
</div>
<div class="position-relative"><h6><a id="service-map-rum-connections"></a>Service Maps: no connection between client and server</h6><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/troubleshooting/common-problems.asciidoc">edit</a></div>
<p>If the service map is not showing an expected connection between the client and server,
it&#8217;s likely because you haven&#8217;t configured
<a href="/guide/en/apm/agent/rum-js/current/distributed-tracing-guide.html" class="ulink" target="_top"><code class="literal">distributedTracingOrigins</code></a>.</p>
<p>This setting is necessary, for example, for cross-origin requests.
If you have a basic web application that provides data via an API on <code class="literal">localhost:4000</code>,
and serves HTML from <code class="literal">localhost:4001</code>, you&#8217;d need to set <code class="literal">distributedTracingOrigins: ['https://localhost:4000']</code>
to ensure the origin is monitored as a part of distributed tracing.
In other words, <code class="literal">distributedTracingOrigins</code> is consulted prior to the APM agent adding the
distributed tracing <code class="literal">traceparent</code> header to each request.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="apm-troubleshoot-apm.html">« Troubleshooting APM</a>
</span>
<span class="next">
<a href="apm-server-es-down.html">What happens when APM Server or Elasticsearch is down? »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
