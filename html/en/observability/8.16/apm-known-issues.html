<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Known issues | Elastic Observability [8.16] | Elastic</title>
<meta class="elastic" name="content" content="Known issues | Elastic Observability [8.16]">

<link rel="home" href="index.html" title="Elastic Observability [8.16]"/>
<link rel="up" href="apm.html" title="Application performance monitoring (APM)"/>
<link rel="prev" href="apm-release-notes-8.0.html" title="APM version 8.0"/>
<link rel="next" href="monitor-uptime-synthetics.html" title="Synthetic monitoring"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.16"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.16"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="apm-release-notes-8.0.html">« APM version 8.0</a>
</span>
<span class="next">
<a href="monitor-uptime-synthetics.html">Synthetic monitoring »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="application-and-service-monitoring.html">Application and service monitoring</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Known issues</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="apm-known-issues"></a>Known issues</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
</div></div></div>
<p>APM has the following known issues:</p>
<div class="position-relative"><h5><a id="_upgrading_to_v8_15_0_may_cause_apm_indices_to_lose_their_lifecycle_policy"></a>Upgrading to v8.15.0 may cause APM indices to lose their lifecycle policy</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
<p><em>Elastic Stack versions: 8.15.0</em><br>
<em>Fixed in Elastic Stack version 8.15.1</em></p>
<p>The issue only occurs when <em>upgrading</em> the Elastic Stack to 8.15.0.
The issue does <em>not</em> occur when creating a <em>new</em> cluster using 8.15.0.
The issue also does not occur if a custom ILM policy is configured using a custom component template.</p>
<p>In 8.15.0, APM Server switched to use data stream lifecycle to manage data retention
for APM indices for new deployments as well as for upgraded deployments with default lifecycle
configurations. Unfortunately, since any data stream created before 8.15.0 does not have a data
stream lifecycle configuration, such existing data streams become unmanaged for default
lifecycle configurations.</p>
<p>Upgrading to 8.15.1 should fix any new indices created for the data stream. However,
indices created in version 8.15.0 would remain unmanaged if the default ILM policy is
used. One of the following approaches can be adopted to fix the unmanaged indices:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Manually delete the indices when they are no longer needed.
</li>
<li class="listitem">
<p>Explicitly configure APM data streams with the default data stream lifecycle config.
Using this approach would migrate all data streams to use data stream lifecycles,
which should be equivalent to the default ILM policies:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">PUT _data_stream/traces-apm-*/_lifecycle
{
  "data_retention": "10d"
}

PUT _data_stream/traces-apm.rum*/_lifecycle
{
  "data_retention": "90d"
}

PUT _data_stream/traces-apm.sampled*/_lifecycle
{
  "data_retention": "1h"
}

PUT _data_stream/metrics-apm.*.1m-*/_lifecycle
{
  "data_retention": "90d"
}

PUT _data_stream/metrics-apm.*.10m-*/_lifecycle
{
  "data_retention": "180d"
}

PUT _data_stream/metrics-apm.*.60m-*/_lifecycle
{
  "data_retention": "390d"
}

PUT _data_stream/metrics-apm.internal-*/_lifecycle
{
  "data_retention": "90d"
}

PUT _data_stream/metrics-apm.app.*/_lifecycle
{
  "data_retention": "90d"
}

PUT _data_stream/logs-apm.*/_lifecycle
{
  "data_retention": "10d"
}</pre>
</div>
</li>
</ol>
</div>
<p>This issue is fixed in 8.15.1 (<a href="https://github.com/elastic/elasticsearch/pull/112432" class="ulink" target="_top">elastic/elasticsearch#112432</a>).</p>
<div class="position-relative"><h5><a id="broken-apm-anomaly-rule"></a>Upgrading to v8.13.0 to v8.13.2 breaks APM anomaly rules</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
<p><em>Elastic Stack versions: 8.13.0, 8.13.1, 8.13.2</em><br>
<em>Fixed in Elastic Stack version 8.13.3</em></p>
<p>This issue occurs when upgrading the Elastic Stack to version 8.13.0, 8.13.1, or 8.13.2.
This issue may go unnoticed unless you actively monitor your Kibana logs.
The following log indicates the presence of this issue:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">"params invalid: [anomalyDetectorTypes]: expected value of type [array] but got [undefined]"</pre>
</div>
<p>This issue occurs because a non-optional parameter, <code class="literal">anomalyDetectorTypes</code> was added in 8.13.0 without
the presence of an automation migration script. This breaks pre-existing rules as they do not have this parameter
and will fail validation. This issue is fixed in v8.13.3.</p>
<p>There are three ways to fix this error:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Upgrade to version 8.13.3
</li>
<li class="listitem">
Fix broken anomaly rules in the APM UI (no upgrade required)
</li>
<li class="listitem">
Fix broken anomaly rules with Kibana APIs (no upgrade required)
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Fix broken anomaly rules in the APM UI</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
From any APM page in Kibana, select <span class="strong strong"><strong>Alerts and rules</strong></span> &#8594; <span class="strong strong"><strong>Manage rules</strong></span>.
</li>
<li class="listitem">
Filter your rules by setting <span class="strong strong"><strong>Type</strong></span> to <span class="strong strong"><strong>APM Anomaly</strong></span>.
</li>
<li class="listitem">
For each anomaly rule in the list, select the pencil icon to edit the rule.
</li>
<li class="listitem">
<p>Add one or more <span class="strong strong"><strong>DETECTOR TYPES</strong></span> to the rule.</p>
<p>The detector type determines when the anomaly rule triggers. For example, a latency anomaly rule will
trigger when the latency of the service being monitored is abnormal.
Supported detector types are <code class="literal">latency</code>, <code class="literal">throughput</code>, and <code class="literal">failed transaction rate</code>.</p>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save</strong></span>.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Fix broken anomaly rules with Kibana APIs</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Find broken rules</p>
<div class="exampleblock">
<div class="content">
<p>To identify rules in this exact state, you can use the <a href="/guide/en/kibana/master/find-rules-api.html" class="ulink" target="_top">find rules endpoint</a> and search for the APM anomaly rule type as well as this exact error message indicating that the rule is in the broken state. We will also use the <code class="literal">fields</code> parameter to specify only the fields required when making the update request later.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">search_fields=alertTypeId</code>
</li>
<li class="listitem">
<code class="literal">search=apm.anomaly</code>
</li>
<li class="listitem">
<code class="literal">filter=alert.attributes.executionStatus.error.message:"params invalid: [anomalyDetectorTypes]: expected value of type [array] but got [undefined]"</code>
</li>
<li class="listitem">
<code class="literal">fields=[id, name, actions, tags, schedule, notify_when, throttle, params]</code>
</li>
</ul>
</div>
<p>The encoded request might look something like this:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">curl -u "$KIBANA_USER":"$KIBANA_PASSWORD" "$KIBANA_URL/api/alerting/rules/_find?search_fields=alertTypeId&amp;search=apm.anomaly&amp;filter=alert.attributes.executionStatus.error.message%3A%22params%20invalid%3A%20%5BanomalyDetectorTypes%5D%3A%20expected%20value%20of%20type%20%5Barray%5D%20but%20got%20%5Bundefined%5D%22&amp;fields=id&amp;fields=name&amp;fields=actions&amp;fields=tags&amp;fields=schedule&amp;fields=notify_when&amp;fields=throttle&amp;fields=params"</pre>
</div>
<details>
<summary class="title">Example result:</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "page": 1,
  "total": 1,
  "per_page": 10,
  "data": [
    {
      "id": "d85e54de-f96a-49b5-99d4-63956f90a6eb",
      "name": "APM Anomaly Jason Test FAILING [2]",
      "tags": [
        "test",
        "jasonrhodes"
      ],
      "throttle": null,
      "schedule": {
        "interval": "1m"
      },
      "params": {
        "windowSize": 30,
        "windowUnit": "m",
        "anomalySeverityType": "warning",
        "environment": "ENVIRONMENT_ALL"
      },
      "notify_when": null,
      "actions": []
    }
  ]
}</pre>
</div>
</div>
</details>
</div>
</div>
</li>
<li class="listitem">
<p>Prepare the update JSON doc(s)</p>
<div class="exampleblock">
<div class="content">
<p>For each broken rule found, create a JSON rule document with what was returned from the API in the previous step. You will need to make two changes to each document:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Remove the <code class="literal">id</code> key but keep the value connected to this document (e.g. rename the file to <code class="literal">{id}.json</code>). <span class="strong strong"><strong>The <code class="literal">id</code> cannot be sent as part of the request body for the PUT request, but you will need it for the URL path.</strong></span>
</li>
<li class="listitem">
<p>Add the <code class="literal">"anomalyDetectorTypes"</code> to the <code class="literal">"params"</code> block, using the default value as seen below to mimic the pre-8.13 behavior:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "params": {
    // ... other existing params should stay here,
    // with the required one added to this object
    "anomalyDetectorTypes": [
      "txLatency",
      "txThroughput",
      "txFailureRate"
    ]
  }
}</pre>
</div>
</li>
</ol>
</div>
</div>
</div>
</li>
<li class="listitem">
<p>Update each rule using the <code class="literal">PUT /api/alerting/rule/{id}</code> API</p>
<div class="exampleblock">
<div class="content">
<p>For each rule, submit a PUT request to the <a href="/guide/en/kibana/master/update-rule-api.html" class="ulink" target="_top">update rule endpoint</a> using that rule&#8217;s ID and its stored update document from the previous step. For example, assuming the first broken rule&#8217;s ID is <code class="literal">046c0d4f</code>:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">curl -u "$KIBANA_USER":"$KIBANA_PASSWORD" -XPUT "$KIBANA_URL/api/alerting/rule/046c0d4f" -H 'Content-Type: application/json' -H 'kbn-xsrf: rule-update' -d @046c0d4f.json</pre>
</div>
<p>Once the PUT request executes successfully, the rule will no longer be broken.</p>
</div>
</div>
</li>
</ol>
</div>
<div class="position-relative"><h5><a id="apm-empty-metricset-values"></a>Upgrading APM Server to 8.11+ might break event intake from older APM Java agents</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
<p><em>APM Server versions: &gt;=8.11.0</em><br>
<em>Elastic APM Java agent versions: &lt; 1.43.0</em></p>
<p>If you are using APM Server (&gt; v8.11.0) and the Elastic APM Java agent (&lt; v1.43.0),
the agent may be sending empty histogram metricsets.</p>
<p>In previous APM Server versions some data validation was not properly applied,
leading the APM Server to accept empty histogram metricsets where it shouldn&#8217;t.
This bug was fixed in the APM Server in 8.11.0.</p>
<p>The APM Java agent (&lt; v1.43.0) was sending this kind of invalid data under certain circumstances.
If you upgrade the APM Server to v8.11.0+ <em>without</em> upgrading the APM Java agent version,
metricsets can be rejected by the APM Server and can result in additional error logs in the Java agent.</p>
<p>The fix is to upgrade the Elastic APM Java agent to a version &gt;= 1.43.0.
Find details in <a href="https://github.com/elastic/apm-data/pull/157" class="ulink" target="_top">elastic/apm-data#157</a>.</p>
<div class="position-relative"><h5><a id="_traces_apmcustom_ingest_pipeline_applied_to_certain_data_streams_unintentionally"></a>traces-apm@custom ingest pipeline applied to certain data streams unintentionally</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
<p><em>APM Server versions: 8.12.0</em><br></p>
<p>If you&#8217;re using the Elastic APM Server v8.12.0,
the <code class="literal">traces-apm@custom</code> ingest pipeline is now additionally applied to data streams <code class="literal">traces-apm.sampled-*</code>
and <code class="literal">traces-apm.rum-*</code>, and applied twice for <code class="literal">traces-apm-*</code>. This bug impacts users with a non-empty <code class="literal">traces-apm@custom</code> ingest pipeline.</p>
<p>If you rely on this unintended behavior in 8.12.0, please rename your pipeline to <code class="literal">traces-apm.integration@custom</code> to preserve this behavior in later versions.</p>
<p>A fix was released in 8.12.1: <a href="https://github.com/elastic/kibana/pull/175448" class="ulink" target="_top">elastic/kibana#175448</a>.</p>
<div class="position-relative"><h5><a id="_ingesting_new_jvm_metrics_in_8_9_and_8_10_breaks_upgrade_to_8_11_and_stops_ingestion"></a>Ingesting new JVM metrics in 8.9 and 8.10 breaks upgrade to 8.11 and stops ingestion</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
<p><em>APM Server versions: 8.11.0, 8.11.1</em><br>
<em>Elastic APM Java agent versions: 1.39.0+</em></p>
<p>If you&#8217;re using the Elastic APM Java agent v1.39.0+ to send new JVM metrics to APM Server v8.9.x and v8.10.x,
upgrading to 8.11.0 or 8.11.1 will silently fail and stop ingesting APM metrics.</p>
<p>After upgrading, you will see the following errors:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>APM Server error logs:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">failed to index document in 'metrics-apm.internal-default' (fail_processor_exception): Document produced by APM Server v8.11.1, which is newer than the installed APM integration (v8.10.3-preview-1695284222). The APM integration must be upgraded.</pre>
</div>
</li>
<li class="listitem">
<p>Fleet error on integration package upgrade:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Failed installing package [apm] due to error: [ResponseError: mapper_parsing_exception
	Root causes:
		mapper_parsing_exception: Field [jvm.memory.non_heap.pool.committed] attempted to shadow a time_series_metric]</pre>
</div>
</li>
</ul>
</div>
<p>A fix was released in 8.11.2: <a href="https://github.com/elastic/kibana/pull/171712" class="ulink" target="_top">elastic/kibana#171712</a>.</p>
<div class="position-relative"><h5><a id="_apm_integration_package_upgrade_through_fleet_causes_excessive_data_stream_rollovers"></a>APM integration package upgrade through Fleet causes excessive data stream rollovers</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
<p><em>APM Server versions: &lt;= 8.12.1 +</em></p>
<p>If you&#8217;re upgrading APM integration package to any versions &lt;= 8.12.1,
in some rare cases, the upgrade fails with a mapping conflict error. The upgrade process keeps rolling
over the data stream in an unsuccessful attempt to work around the error. As a result, many empty backing indices for
APM data streams are created.</p>
<p>During upgrade, you will see errors similar to the one below:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Fleet error on integration package upgrade:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Mappings update for metrics-apm.service_destination.10m-default failed due to ResponseError: illegal_argument_exception
	Root causes:
		illegal_argument_exception: Mapper for [metricset.interval] conflicts with existing mapper:
	Cannot update parameter [value] from [10m] to [null]</pre>
</div>
</li>
</ul>
</div>
<p>A fix was released in 8.12.2: <a href="https://github.com/elastic/apm-server/pull/12219" class="ulink" target="_top">elastic/apm-server#12219</a>.</p>
<div class="position-relative"><h5><a id="_performance_regression_apm_issues_too_many_small_bulk_requests_for_elasticsearch_output"></a>Performance regression: APM issues too many small bulk requests for Elasticsearch output</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.x/docs/en/observability/apm/known-issues.asciidoc">edit</a></div>
<p><em>APM Server versions: &gt;=8.13.0, &lt;= 8.14.2</em><br></p>
<p>If you&#8217;re on APM server version &gt;=8.13.0, &lt;= 8.14.2_, using Elasticsearch output,
do not specify any <code class="literal">output.elasticsearch.flush_bytes</code>,
and do not disable compression explicitly by setting <code class="literal">output.elasticsearch.compression_level</code> to <code class="literal">0</code>,
APM server will issue smaller bulk requests of 24KB size,
and more bulk requests will need to be made to maintain the original throughput.
This causes Elasticsearch to experience higher load,
and APM server may exhibit Elasticsearch backpressure symptoms.</p>
<p>This happens because a performance regression was introduced, such that the default value of bulk indexer flush bytes
was reduced from 1MB to 24KB.</p>
<p>Affected APM servers will emit the following log:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">flush_bytes config value is too small (0) and might be ignored by the indexer, increasing value to 24576</pre>
</div>
<p>To workaround the issue, modify the Elasticsearch output configuration in APM.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>For APM Server binary</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
In <code class="literal">apm-server.yml</code>, set <code class="literal">output.elasticsearch.flush_bytes: 1mib</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>For Fleet-managed APM (non-Elastic Cloud)</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
In Fleet, open the Settings tab.
</li>
<li class="listitem">
Under Outputs, identify the Elasticsearch output that receives from APM, select the edit icon.
</li>
<li class="listitem">
In the Edit output flyout, in "Advanced YAML configuration" field, add line <code class="literal">flush_bytes: 1mib</code>.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>For Elastic Cloud</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
It is not possible to edit the Fleet "Elastic Cloud internal output".
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>A fix will be released in 8.14.3: <a href="https://github.com/elastic/apm-server/pull/13576" class="ulink" target="_top">elastic/apm-server#13576</a>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="apm-release-notes-8.0.html">« APM version 8.0</a>
</span>
<span class="next">
<a href="monitor-uptime-synthetics.html">Synthetic monitoring »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
