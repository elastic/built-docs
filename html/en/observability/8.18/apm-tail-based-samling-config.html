<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Tail-based sampling | Elastic Observability [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Tail-based sampling | Elastic Observability [8.18]">

<link rel="home" href="index.html" title="Elastic Observability [8.18]"/>
<link rel="up" href="apm-configuring-howto-apm-server.html" title="Configure APM Server"/>
<link rel="prev" href="apm-agent-server-ssl.html" title="SSL/TLS input settings"/>
<link rel="next" href="apm-config-env.html" title="Use environment variables in the configuration"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.18"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.18"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="apm-agent-server-ssl.html">« SSL/TLS input settings</a>
</span>
<span class="next">
<a href="apm-config-env.html">Use environment variables in the configuration »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="application-and-service-monitoring.html">Application and service monitoring</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-configuring-howto-apm-server.html">Configure APM Server</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Tail-based sampling</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    A newer version is available. Check out the <a href="https://www.elastic.co/docs/solutions/observability/apps/tail-based-sampling">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="apm-tail-based-samling-config"></a>Tail-based sampling</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
</div></div></div>
<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-yes.svg" alt="supported deployment methods"></span></p>
<p>Most options on this page are supported by all APM Server deployment methods when writing to Elasticsearch.
If you are using a different <a class="xref" href="apm-configuring-output.html" title="Configure the output">output</a>, tail-based sampling is <em>not</em> supported.</p>
</div>
<p>Tail-based sampling configuration options.</p>
<div class="tabs" data-tab-group="config-apm">
  <div role="tablist" aria-label="Sampling">
    <button role="tab"
            aria-selected="true"
            aria-controls="binary-tab"
            id="binary">
      APM Server binary
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="fleet-managed-tab"
            id="fleet-managed"
            tabindex="-1">
      Fleet-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="binary-tab"
       aria-labelledby="binary">
<p><span class="strong strong"><strong>Example config file:</strong></span></p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apm-server:
  host: "localhost:8200"
  rum:
    enabled: true

output:
  elasticsearch:
    hosts: ElasticsearchAddress:9200

max_procs: 4</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="fleet-managed-tab"
       aria-labelledby="fleet-managed"
       hidden="">
<p>Configure and customize Fleet-managed APM settings directly in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, find <span class="strong strong"><strong>Fleet</strong></span> in the main menu or use the <a href="/guide/en/kibana/8.18/introduction.html#kibana-navigation-search" class="ulink" target="_top">global search field</a>.
</li>
<li class="listitem">
Under the <span class="strong strong"><strong>Agent policies</strong></span> tab, select the policy you would like to configure.
</li>
<li class="listitem">
Find the Elastic APM integration and select <span class="strong strong"><strong>Actions</strong></span> &gt; <span class="strong strong"><strong>Edit integration</strong></span>.
</li>
<li class="listitem">
Look for these options under <span class="strong strong"><strong>Tail-based sampling</strong></span>.
</li>
</ol>
</div>
  </div>
</div>
<div class="position-relative"><h6><a id="apm-configuration-tbs"></a>Top-level tail-based sampling settings</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>See <a class="xref" href="apm-sampling.html#apm-tail-based-sampling" title="Tail-based sampling">Tail-based sampling</a> to learn more.</p>
<div class="position-relative"><h7><a id="sampling-tail-enabled-ref"></a>Enable tail-based sampling</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>Set to <code class="literal">true</code> to enable tail based sampling.
Disabled by default. (bool)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">sampling.tail.enabled</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Enable tail-based sampling</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="position-relative"><h7><a id="sampling-tail-interval-ref"></a>Interval</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>Synchronization interval for multiple APM Servers.
Should be in the order of tens of seconds or low minutes.
Default: <code class="literal">1m</code> (1 minute). (duration)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">sampling.tail.interval</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Interval</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="position-relative"><h7><a id="sampling-tail-policies-ref"></a>Policies</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>Criteria used to match a root transaction to a sample rate.</p>
<p>Policies map trace events to a sample rate.
Each policy must specify a sample rate.
Trace events are matched to policies in the order specified.
All policy conditions must be true for a trace event to match.
Each policy list should conclude with a policy that only specifies a sample rate.
This final policy is used to catch remaining trace events that don&#8217;t match a stricter policy.
(<code class="literal">[]policy</code>)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">sampling.tail.policies</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Policies</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="position-relative"><h7><a id="sampling-tail-storage_limit-ref"></a>Storage limit</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>The amount of storage space allocated for trace events matching tail sampling policies. Caution: Setting this limit higher than the allowed space may cause APM Server to become unhealthy.</p>
<p>If the configured storage limit is insufficient, it logs "configured storage limit reached". The event will bypass sampling and will always be indexed when storage limit is reached.</p>
<p>Default: <code class="literal">3GB</code>. (text)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">sampling.tail.storage_limit</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Storage limit</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="position-relative"><h6><a id="apm-configuration-tbs-policy"></a>Policy-level tail-based sampling settings</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>See <a class="xref" href="apm-sampling.html#apm-tail-based-sampling" title="Tail-based sampling">Tail-based sampling</a> to learn more.</p>
<div class="position-relative"><h7><a id="sampling-tail-sample-rate-ref"></a><span class="strong strong"><strong><code class="literal">sample_rate</code></strong></span></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>The sample rate to apply to trace events matching this policy.
Required in each policy.</p>
<p>The sample rate must be greater than or equal to <code class="literal">0</code> and less than or equal to <code class="literal">1</code>.
For example, a <code class="literal">sample_rate</code> of <code class="literal">0.01</code> means that 1% of trace events matching the policy will be sampled.
A <code class="literal">sample_rate</code> of <code class="literal">1</code> means that 100% of trace events matching the policy will be sampled. (int)</p>
<div class="position-relative"><h7><a id="sampling-tail-trace-name-ref"></a><span class="strong strong"><strong><code class="literal">trace.name</code></strong></span></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>The trace name for events to match a policy.
A match occurs when the configured <code class="literal">trace.name</code> matches the <code class="literal">transaction.name</code> of the root transaction of a trace.
A root transaction is any transaction without a <code class="literal">parent.id</code>. (string)</p>
<div class="position-relative"><h7><a id="sampling-tail-trace-outcome-ref"></a><span class="strong strong"><strong><code class="literal">trace.outcome</code></strong></span></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>The trace outcome for events to match a policy.
A match occurs when the configured <code class="literal">trace.outcome</code> matches a trace&#8217;s <code class="literal">event.outcome</code> field.
Trace outcome can be <code class="literal">success</code>, <code class="literal">failure</code>, or <code class="literal">unknown</code>. (string)</p>
<div class="position-relative"><h7><a id="sampling-tail-service-name-ref"></a><span class="strong strong"><strong><code class="literal">service.name</code></strong></span></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>The service name for events to match a policy. (string)</p>
<div class="position-relative"><h7><a id="sampling-tail-service-environment-ref"></a><span class="strong strong"><strong><code class="literal">service.environment</code></strong></span></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>The service environment for events to match a policy. (string)</p>
<div class="position-relative"><h6><a id="sampling-tail-monitoring-ref"></a>Monitoring tail-based sampling</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>APM Server produces metrics to monitor the performance and estimate the workload being processed by tail-based sampling. In order to use these metrics, you need to [enable monitoring for the APM Server](/solutions/observability/apps/monitor-apm-server.md). The following metrics are produced by the tail-based sampler (note that the metrics might have a different prefix,  for example <code class="literal">beat.stats</code> for ECH deployments, based on how the APM Server is running):</p>
<div class="position-relative"><h7><a id="sampling-tail-monitoring-dynamic-service-group-ref"></a><code class="literal">apm-server.sampling.tail.dynamic_service_groups</code></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>This metric tracks the number of dynamic services that the tail-based sampler is tracking per policy. Dynamic services are created for tail-based sampling policies that are defined without a <code class="literal">service.name</code>.</p>
<p>This is a counter metric so, should be visualized with <code class="literal">counter_rate</code>.</p>
<div class="position-relative"><h7><a id="sampling-tail-monitoring-events-processed-ref"></a><code class="literal">apm-server.sampling.tail.events.processed</code></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>This metric tracks the total number of events (including both transaction and span) processed by the tail-based sampler.</p>
<p>This is a counter metric so, should be visualized with <code class="literal">counter_rate</code>.</p>
<div class="position-relative"><h7><a id="sampling-tail-monitoring-events-stored-ref"></a><code class="literal">apm-server.sampling.tail.events.stored</code></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>This metric tracks the total number of events stored by the tail-based sampler in the database. Events are stored when the full trace is not yet available to make the sampling decision. This value is directly proportional to the storage required by the tail-based sampler to function.</p>
<p>This is a counter metric so, should be visualized with <code class="literal">counter_rate</code>.</p>
<div class="position-relative"><h7><a id="sampling-tail-monitoring-events-dropped-ref"></a><code class="literal">apm-server.sampling.tail.events.dropped</code></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>This metric tracks the total number of events dropped by the tail-based sampler. Only the events that are actually dropped by the tail-based sampler are reported as dropped. Additionally, any events that were stored by the processor but never indexed will not be counted by this metric.</p>
<p>This is a counter metric so, should be visualized with <code class="literal">counter_rate</code>.</p>
<div class="position-relative"><h7><a id="sampling-tail-monitoring-storage-lsm-size-ref"></a><code class="literal">apm-server.sampling.tail.storage.lsm_size</code></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>This metric tracks the storage size of the log-structured merge trees used by the tail-based sampling database in bytes. This metric is one part of the total disk space used by the tail-based sampler. See <a class="xref" href="apm-tail-based-samling-config.html#sampling-tail-monitoring-storage-total-size-ref" title="Total storage size">Total storage size</a> for details on how to monitor total disk size used by the tail-based sampler.</p>
<div class="position-relative"><h7><a id="sampling-tail-monitoring-storage-value-log-size-ref"></a><code class="literal">apm-server.sampling.tail.storage.value_log_size</code></h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>This metric tracks the storage size for value log files used by the tail-based sampling database in bytes. This metric is one part of the total disk space used by the tail-based sampler. See <a class="xref" href="apm-tail-based-samling-config.html#sampling-tail-monitoring-storage-total-size-ref" title="Total storage size">Total storage size</a> for details on how to monitor total disk size used by the tail-based sampler.</p>
<div class="position-relative"><h7><a id="sampling-tail-monitoring-storage-total-size-ref"></a>Total storage size</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.18/docs/en/observability/apm/configure/sampling.asciidoc">edit</a></div>
<p>Total storage size is the sum of the <a class="xref" href="apm-tail-based-samling-config.html#sampling-tail-monitoring-storage-lsm-size-ref" title="apm-server.sampling.tail.storage.lsm_size"><code class="literal">apm-server.sampling.tail.storage.lsm_size</code></a> and <a class="xref" href="apm-tail-based-samling-config.html#sampling-tail-monitoring-storage-value-log-size-ref" title="apm-server.sampling.tail.storage.value_log_size"><code class="literal">apm-server.sampling.tail.storage.value_log_size</code></a>. It is the most crucial metric to track storage requirements for tail-based sampler, especially for big deployments with large distributed traces. Deployments using tail-based sampling extensively should set up alerts and monitoring on this metric.</p>
<p>This metric can also be used to get an estimate of the storage requirements for tail-based sampler before increasing load by extrapolating the metric based on the current usage. It is important to note that before doing any estimation the tail-based sampler should be allowed to run for at least a few TTL cycles and that the estimate will only be useful for similar load patterns.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="apm-agent-server-ssl.html">« SSL/TLS input settings</a>
</span>
<span class="next">
<a href="apm-config-env.html">Use environment variables in the configuration »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
