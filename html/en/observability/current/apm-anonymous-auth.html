<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Anonymous authentication | Elastic Observability [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Anonymous authentication | Elastic Observability [8.15]">

<link rel="home" href="index.html" title="Elastic Observability [8.15]"/>
<link rel="up" href="apm-secure-agent-communication.html" title="Secure communication with APM agents"/>
<link rel="prev" href="apm-secret-token.html" title="Secret token"/>
<link rel="next" href="apm-secure-comms-stack.html" title="Secure communication with the Elastic Stack"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.15"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.15"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="apm-secret-token.html">« Secret token</a>
</span>
<span class="next">
<a href="apm-secure-comms-stack.html">Secure communication with the Elastic Stack »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-securing-apm-server.html">Secure communication with the Elastic Stack</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-secure-agent-communication.html">Secure communication with APM agents</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Anonymous authentication</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/apm/anonymous-auth.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="apm-anonymous-auth"></a>Anonymous authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/apm/anonymous-auth.asciidoc">edit</a></h4>
</div></div></div>
<p>Elastic APM agents can send unauthenticated (anonymous) events to the APM Server.
An event is considered to be anonymous if no authentication token can be extracted from the incoming request.
The APM Server&#8217;s default response to these these requests depends on its configuration:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Configuration</th>
<th align="left" valign="top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>An <a class="xref" href="apm-api-key.html" title="API keys">API key</a> or <a class="xref" href="apm-secret-token.html" title="Secret token">secret token</a> is configured</p></td>
<td align="left" valign="top"><p>Anonymous requests are rejected and an authentication error is returned.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>No API key or secret token is configured</p></td>
<td align="left" valign="top"><p>Anonymous requests are accepted by the APM Server.</p></td>
</tr>
</tbody>
</table>
</div>
<p>In some cases, however, it makes sense to allow both authenticated and anonymous requests.
For example, it isn&#8217;t possible to authenticate requests from front-end services as
the secret token or API key can&#8217;t be protected. This is the case with the Real User Monitoring (RUM)
agent running in a browser, or the Android or iOS/Swift agent running in a user application.
However, you still likely want to authenticate requests from back-end services.
To solve this problem, you can enable anonymous authentication in the APM Server to allow the
ingestion of unauthenticated client-side APM data while still requiring authentication for server-side services.</p>
<h5><a id="apm-anonymous-auth-config"></a>Configuring anonymous auth for client-side services<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/apm/anonymous-auth.asciidoc">edit</a></h5>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can only enable and configure anonymous authentication if an <a class="xref" href="apm-api-key.html" title="API keys">API key</a> or
<a class="xref" href="apm-secret-token.html" title="Secret token">secret token</a> is configured. If neither are configured, these settings will be ignored.</p>
</div>
</div>
<div class="tabs" data-tab-group="ts">
  <div role="tablist" aria-label="tls">
    <button role="tab"
            aria-selected="true"
            aria-controls="fm-tab-ts"
            id="fm-ts">
      Fleet-managed
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="binary-tab-ts"
            id="binary-ts"
            tabindex="-1">
      APM Server binary
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="fm-tab-ts"
       aria-labelledby="fm-ts">
<p>When an <a class="xref" href="apm-api-key.html" title="API keys">API key</a> or <a class="xref" href="apm-secret-token.html" title="Secret token">secret token</a> is configured,
anonymous authentication must be enabled to collect RUM data.
Set <span class="strong strong"><strong>Anonymous Agent access</strong></span> to true to enable anonymous authentication.</p>
<p>When configuring anonymous authentication for client-side services,
there are a few configuration variables that can mitigate the impact of malicious requests to an
unauthenticated APM Server endpoint.</p>
<p>Use the <span class="strong strong"><strong>Allowed anonymous agents</strong></span> and <span class="strong strong"><strong>Allowed anonymous services</strong></span> configs to ensure that the
<code class="literal">agent.name</code> and <code class="literal">service.name</code> of each incoming request match a specified list.</p>
<p>Additionally, the APM Server can rate-limit unauthenticated requests based on the client IP address
(<code class="literal">client.ip</code>) of the request.
This allows you to specify the maximum number of requests allowed per unique IP address, per second.</p>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="binary-tab-ts"
       aria-labelledby="binary-ts"
       hidden="">
<p>When an <a class="xref" href="apm-api-key.html" title="API keys">API key</a> or <a class="xref" href="apm-secret-token.html" title="Secret token">secret token</a> is configured,
anonymous authentication must be enabled to collect RUM data.
To enable anonymous access, set either <a class="xref" href="apm-configuration-rum.html#apm-rum-enable" title="Enable RUM"><code class="literal">apm-server.rum.enabled</code></a> or
<a class="xref" href="apm-configuration-anonymous.html#apm-config-auth-anon-enabled" title="Anonymous Agent access"><code class="literal">apm-server.auth.anonymous.enabled</code></a> to <code class="literal">true</code>.</p>
<p>Because anyone can send anonymous events to the APM Server,
additional configuration variables are available to rate limit the number anonymous events the APM Server processes;
throughput is equal to the <code class="literal">rate_limit.ip_limit</code> times the <code class="literal">rate_limit.event_limit</code>.</p>
<p>See <a class="xref" href="apm-configuration-anonymous.html" title="Configure anonymous authentication">Anonymous authentication</a> for a complete list of options and a sample configuration file.</p>
  </div>
</div>
<h5><a id="apm-derive-client-ip"></a>Deriving an incoming request&#8217;s <code class="literal">client.ip</code> address<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/apm/anonymous-auth.asciidoc">edit</a></h5>
<p>The remote IP address of an incoming request might be different
from the end-user&#8217;s actual IP address, for example, because of a proxy. For this reason,
the APM Server attempts to derive the IP address of an incoming request from HTTP headers.
The supported headers are parsed in the following order:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<code class="literal">Forwarded</code>
</li>
<li class="listitem">
<code class="literal">X-Real-Ip</code>
</li>
<li class="listitem">
<code class="literal">X-Forwarded-For</code>
</li>
</ol>
</div>
<p>If none of these headers are present, the remote address for the incoming request is used.</p>
<h6><a id="apm-derive-client-ip-concerns"></a>Using a reverse proxy or load balancer<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.15/docs/en/observability/apm/anonymous-auth.asciidoc">edit</a></h6>
<p>HTTP headers are easily modified;
it&#8217;s possible for anyone to spoof the derived <code class="literal">client.ip</code> value by changing or setting,
for example, the value of the <code class="literal">X-Forwarded-For</code> header.
For this reason, if any of your clients are not trusted,
we recommend setting up a reverse proxy or load balancer in front of the APM Server.</p>
<p>Using a proxy allows you to clear any existing IP-forwarding HTTP headers,
and replace them with one set by the proxy.
This prevents malicious users from cycling spoofed IP addresses to bypass the
APM Server&#8217;s rate limiting feature.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="apm-secret-token.html">« Secret token</a>
</span>
<span class="next">
<a href="apm-secure-comms-stack.html">Secure communication with the Elastic Stack »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
