<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Application Added to Google Workspace Domain | Elastic Security Solution [7.12] | Elastic</title>
<meta class="elastic" name="content" content="Application Added to Google Workspace Domain | Elastic Security Solution [7.12]">

<link rel="home" href="index.html" title="Elastic Security Solution [7.12]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="apple-scripting-execution-with-administrator-privileges.html" title="Apple Scripting Execution with Administrator Privileges"/>
<link rel="next" href="dumping-account-hashes-via-built-in-commands.html" title="Dumping Account Hashes via Built-In Commands"/>
<meta class="elastic" name="product_version" content="7.12"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/7.12"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="7.12"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [7.12]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="apple-scripting-execution-with-administrator-privileges.html">« Apple Scripting Execution with Administrator Privileges</a>
</span>
<span class="next">
<a href="dumping-account-hashes-via-built-in-commands.html">Dumping Account Hashes via Built-In Commands »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="application-added-to-google-workspace-domain"></a>Application Added to Google Workspace Domain<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.12/docs/detections/prebuilt-rules/rule-details/application-added-to-google-workspace-domain.asciidoc">edit</a></h2>
</div></div></div>
<p>Detects when a Google marketplace application is added to the Google Workspace domain. An adversary may add a malicious application to an organization’s Google Workspace domain in order to maintain a presence in their target’s organization and steal data.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-google_workspace*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-130m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://support.google.com/a/answer/6328701?hl=en#" class="ulink" target="_top">https://support.google.com/a/answer/6328701?hl=en#</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Google Workspace
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Configuration Audit
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#application-added-to-google-workspace-domain-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_potential_false_positives_41"></a>Potential false positives<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.12/docs/detections/prebuilt-rules/rule-details/application-added-to-google-workspace-domain.asciidoc">edit</a></h3>
</div></div></div>
<p>Applications can be added to a Google Workspace domain by system administrators. Verify that the configuration change was expected. Exceptions can be added to this rule to filter expected behavior.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_investigation_guide_40"></a>Investigation guide<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.12/docs/detections/prebuilt-rules/rule-details/application-added-to-google-workspace-domain.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Important Information Regarding Google Workspace Event Lag Times
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="pre_wrapper lang-markdown">
<pre class="programlisting prettyprint lang-markdown">## Config

The Google Workspace Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.

### Important Information Regarding Google Workspace Event Lag Times

- As per Google's documentation, Google Workspace administrators may observe lag times ranging from minutes up to 3 days between the time of an event's occurrence and the event being visible in the Google Workspace admin/audit logs.
- This rule is configured to run every 10 minutes with a lookback time of 130 minutes.
- To reduce the risk of false negatives, consider reducing the interval that the Google Workspace (formerly G Suite) Filebeat module polls Google's reporting API for new events.
- By default, `var.interval` is set to 2 hours (2h). Consider changing this interval to a lower value, such as 10 minutes (10m).
- See the following references for further information.
  - https://support.google.com/a/answer/7061566
  - https://www.elastic.co/guide/en/beats/filebeat/7.12/filebeat-module-google_workspace.html</pre>
</div>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:(gsuite.admin or google_workspace.admin) and
event.provider:admin and event.category:iam and
event.action:ADD_APPLICATION</pre>
</div>
<p><a id="application-added-to-google-workspace-domain-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-create-okta-api-token"></a>=== Attempt to Create Okta API Token</p>
<p>An adversary may create an Okta API token to maintain access to an
organization&#8217;s network while they work to achieve their objectives. An attacker
may abuse an API token to execute techniques such as creating user accounts, or
disabling security rules or policies.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-create-okta-api-token-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>If the behavior of creating Okta API tokens is expected, consider adding
exceptions to this rule to filter false positives.</p>
<p>==== Investigation guide</p>
<p>The Okta Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:system.api_token.create</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Create Account
</li>
<li class="listitem">
ID: T1136
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1136/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1136/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-create-okta-api-token-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:system.api_token.create</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-deactivate-mfa-for-an-okta-user-account"></a>=== Attempt to Deactivate MFA for an Okta User Account</p>
<p>Detects attempts to deactivate multi-factor authentication (MFA) for an Okta user. An adversary may deactivate MFA for an Okta user account in order to weaken the authentication requirements for the account.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-deactivate-mfa-for-an-okta-user-account-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>If the behavior of deactivating MFA for Okta user accounts is expected, consider adding exceptions to this rule to filter false positives.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:user.mfa.factor.deactivate</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Manipulation
</li>
<li class="listitem">
ID: T1098
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-deactivate-mfa-for-an-okta-user-account-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Attempt to Deactivate MFA for Okta User Account
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:user.mfa.factor.deactivate</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-deactivate-an-okta-application"></a>=== Attempt to Deactivate an Okta Application</p>
<p>Detects attempts to deactivate an Okta application. An adversary may attempt to modify, deactivate, or delete an Okta application in order to weaken an organization&#8217;s security controls or disrupt their business operations.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Apps/Apps_Apps.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Apps/Apps_Apps.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-deactivate-an-okta-application-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if your organization&#8217;s Okta applications are regularly deactivated and the behavior is expected.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and
event.action:application.lifecycle.deactivate</pre>
</div>
<p><a id="attempt-to-deactivate-an-okta-application-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-deactivate-an-okta-network-zone"></a>=== Attempt to Deactivate an Okta Network Zone</p>
<p>Detects attempts to deactivate an Okta network zone. Okta network zones can be configured to limit or restrict access to a network based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Okta network zone in order to remove or weaken an organization&#8217;s security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Network Security
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-deactivate-an-okta-network-zone-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if your organization&#8217;s Okta network zones are regularly modified.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:zone.deactivate</pre>
</div>
<p><a id="attempt-to-deactivate-an-okta-network-zone-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-deactivate-an-okta-policy"></a>=== Attempt to Deactivate an Okta Policy</p>
<p>Detects attempts to deactivate an Okta policy. An adversary may attempt to deactivate an Okta policy in order to weaken an organization&#8217;s security controls. For example, an adversary may attempt to deactivate an Okta multi-factor authentication (MFA) policy in order to weaken the authentication requirements for user accounts.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-deactivate-an-okta-policy-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>If the behavior of deactivating Okta policies is expected, consider adding exceptions to this rule to filter false positives.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:policy.lifecycle.deactivate</pre>
</div>
<p><a id="attempt-to-deactivate-an-okta-policy-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Attempt to Deactivate Okta Policy
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:policy.lifecycle.deactivate</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-deactivate-an-okta-policy-rule"></a>=== Attempt to Deactivate an Okta Policy Rule</p>
<p>Detects attempts to deactivate a rule within an Okta policy. An adversary may attempt to deactivate a rule within an Okta policy in order to remove or weaken an organization&#8217;s security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-deactivate-an-okta-policy-rule-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if Okta MFA rules are regularly deactivated in your organization.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:policy.rule.deactivate</pre>
</div>
<p><a id="attempt-to-deactivate-an-okta-policy-rule-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Attempt to Deactivate Okta MFA Rule
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:policy.rule.deactivate</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-delete-an-okta-application"></a>=== Attempt to Delete an Okta Application</p>
<p>Detects attempts to delete an Okta application. An adversary may attempt to modify, deactivate, or delete an Okta application in order to weaken an organization&#8217;s security controls or disrupt their business operations.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-delete-an-okta-application-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if your organization&#8217;s Okta applications are regularly deleted and the behavior is expected.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and
event.action:application.lifecycle.delete</pre>
</div>
<p><a id="attempt-to-delete-an-okta-application-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-delete-an-okta-network-zone"></a>=== Attempt to Delete an Okta Network Zone</p>
<p>Detects attempts to delete an Okta network zone. Okta network zones can be configured to limit or restrict access to a network based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Okta network zone in order to remove or weaken an organization&#8217;s security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Network Security
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-delete-an-okta-network-zone-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if Oyour organization&#8217;s Okta network zones are regularly deleted.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:zone.delete</pre>
</div>
<p><a id="attempt-to-delete-an-okta-network-zone-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-delete-an-okta-policy"></a>=== Attempt to Delete an Okta Policy</p>
<p>Detects attempts to delete an Okta policy. An adversary may attempt to delete an Okta policy in order to weaken an organization&#8217;s security controls. For example, an adversary may attempt to delete an Okta multi-factor authentication (MFA) policy in order to weaken the authentication requirements for user accounts.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-delete-an-okta-policy-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if Okta policies are regularly deleted in your organization.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:policy.lifecycle.delete</pre>
</div>
<p><a id="attempt-to-delete-an-okta-policy-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Attempt to Delete Okta Policy
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:policy.lifecycle.delete</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-delete-an-okta-policy-rule"></a>=== Attempt to Delete an Okta Policy Rule</p>
<p>Detects attempts to delete a rule within an Okta policy. An adversary may attempt to delete an Okta policy rule in order to weaken an organization&#8217;s security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-delete-an-okta-policy-rule-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if Okta MFA rules are regularly modified in your organization.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:policy.rule.delete</pre>
</div>
<p><a id="attempt-to-delete-an-okta-policy-rule-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-disable-gatekeeper"></a>=== Attempt to Disable Gatekeeper</p>
<p>Detects attempts to disable Gatekeeper on macOS. Gatekeeper is a security feature that&#8217;s designed to ensure that only trusted software is run. Adversaries may attempt to disable Gatekeeper before executing malicious code.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://support.apple.com/en-us/HT202491" class="ulink" target="_top">https://support.apple.com/en-us/HT202491</a>
</li>
<li class="listitem">
<a href="https://www.carbonblack.com/blog/tau-threat-intelligence-notification-new-macos-malware-variant-of-shlayer-osx-discovered/" class="ulink" target="_top">https://www.carbonblack.com/blog/tau-threat-intelligence-notification-new-macos-malware-variant-of-shlayer-osx-discovered/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.args:(spctl and "--master-disable")</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Subvert Trust Controls
</li>
<li class="listitem">
ID: T1553
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1553/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1553/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-disable-iptables-or-firewall"></a>=== Attempt to Disable IPTables or Firewall</p>
<p>Identifies attempts to disable ip tables or a firewall service, a technique
adversaries can use to modify the network traffic hosts are allowed to send and
receive.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 7 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-disable-iptables-or-firewall-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.8.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:ufw and process.args:(allow or disable or reset) or
(((process.name:service and process.args:stop) or
(process.name:chkconfig and process.args:off) or
(process.name:systemctl and process.args:(disable or stop or kill)))
and process.args:(firewalld or ip6tables or iptables))</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-disable-iptables-or-firewall-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 7 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:(executed or process_started) and (process.name:service
and process.args:stop or process.name:chkconfig and process.args:off)
and process.args:(ip6tables or iptables) or process.name:systemctl and
process.args:(firewalld and (disable or stop or kill))</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-disable-syslog-service"></a>=== Attempt to Disable Syslog Service</p>
<p>Identifies attempts to disable the <code class="literal">syslog</code> service, a technique adversaries can
use to disrupt event logging and evade detection by security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 7 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-disable-syslog-service-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.8.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
((process.name:service and process.args:stop) or
(process.name:chkconfig and process.args:off) or
(process.name:systemctl and process.args:(disable or stop or kill)))
and process.args:(syslog or rsyslog or "syslog-ng")</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-disable-syslog-service-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 7 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:(executed or process_started) and ((process.name:service
and process.args:stop) or (process.name:chkconfig and
process.args:off) or (process.name:systemctl and process.args:(disable
or stop or kill))) and process.args:(syslog or rsyslog or "syslog-ng")</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-enable-the-root-account"></a>=== Attempt to Enable the Root Account</p>
<p>Identifies attempts to enable the root account using the dsenableroot command. This command may be abused by adversaries for persistence, as the root account is disabled by default.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://ss64.com/osx/dsenableroot.html" class="ulink" target="_top">https://ss64.com/osx/dsenableroot.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:dsenableroot and not process.args:"-d"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-install-root-certificate"></a>=== Attempt to Install Root Certificate</p>
<p>Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to their command and control servers. Root certificates are used in public key cryptography to identify a root certificate authority (CA). When a root certificate is installed, the system or application will trust certificates in the root&#8217;s chain of trust that have been signed by the root certificate.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://ss64.com/osx/security-cert.html" class="ulink" target="_top">https://ss64.com/osx/security-cert.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Certain applications may install root certificates for the purpose of inspecting SSL traffic.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:security and process.args:"add-trusted-cert"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Subvert Trust Controls
</li>
<li class="listitem">
ID: T1553
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1553/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1553/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-modify-an-okta-application"></a>=== Attempt to Modify an Okta Application</p>
<p>Detects attempts to modify an Okta application. An adversary may attempt to modify, deactivate, or delete an Okta application in order to weaken an organization&#8217;s security controls or disrupt their business operations.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Apps/Apps_Apps.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Apps/Apps_Apps.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-modify-an-okta-application-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if your organization&#8217;s Okta applications are regularly modified and the behavior is expected.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and
event.action:application.lifecycle.update</pre>
</div>
<p><a id="attempt-to-modify-an-okta-application-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-modify-an-okta-network-zone"></a>=== Attempt to Modify an Okta Network Zone</p>
<p>Detects attempts to modify an Okta network zone. Okta network zones can be configured to limit or restrict access to a network based on IP addresses or geolocations. An adversary may attempt to modify, delete, or deactivate an Okta network zone in order to remove or weaken an organization&#8217;s security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Security/network/network-zones.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Network Security
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-modify-an-okta-network-zone-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if Oyour organization&#8217;s Okta network zones are regularly modified.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:(zone.update or
network_zone.rule.disabled or zone.remove_blacklist)</pre>
</div>
<p><a id="attempt-to-modify-an-okta-network-zone-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Attempt to Modify Okta Network Zone
</li>
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:(zone.update or
zone.deactivate or zone.delete or network_zone.rule.disabled or
zone.remove_blacklist)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:(zone.update or zone.deactivate or zone.delete or
network_zone.rule.disabled or zone.remove_blacklist)</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-modify-an-okta-policy"></a>=== Attempt to Modify an Okta Policy</p>
<p>Detects attempts to modify an Okta policy. An adversary may attempt to modify an Okta policy in order to weaken an organization&#8217;s security controls. For example, an adversary may attempt to modify an Okta multi-factor authentication (MFA) policy in order to weaken the authentication requirements for user accounts.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-modify-an-okta-policy-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if Okta policies are regularly modified in your organization.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:policy.lifecycle.update</pre>
</div>
<p><a id="attempt-to-modify-an-okta-policy-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Attempt to Modify Okta Policy
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:policy.lifecycle.update</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-modify-an-okta-policy-rule"></a>=== Attempt to Modify an Okta Policy Rule</p>
<p>Detects attempts to modify a rule within an Okta policy. An adversary may attempt to modify an Okta policy rule in order to weaken an organization&#8217;s security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm" class="ulink" target="_top">https://help.okta.com/en/prod/Content/Topics/Security/Security_Policies.htm</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-modify-an-okta-policy-rule-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if Okta MFA rules are regularly modified in your organization.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:policy.rule.update</pre>
</div>
<p><a id="attempt-to-modify-an-okta-policy-rule-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Attempt to Modify Okta MFA Rule
</li>
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:(policy.rule.update or
policy.rule.delete)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:(policy.rule.update or policy.rule.delete)</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-mount-smb-share-via-command-line"></a>=== Attempt to Mount SMB Share via Command Line</p>
<p>Identifies the execution of macOS built-in commands to mount a Server Message Block (SMB) network share. Adversaries may use valid accounts to interact with a remote network share using SMB.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.freebsd.org/cgi/man.cgi?mount_smbfs" class="ulink" target="_top">https://www.freebsd.org/cgi/man.cgi?mount_smbfs</a>
</li>
<li class="listitem">
<a href="https://ss64.com/osx/mount.html" class="ulink" target="_top">https://ss64.com/osx/mount.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Lateral Movement
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and (
process.name : "mount_smbfs" or (process.name : "open" and
process.args : "smb://*") or (process.name : "mount" and
process.args : "smbfs") or (process.name : "osascript" and
process.command_line : "osascript*mount volume*smb://*") )</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Lateral Movement
</li>
<li class="listitem">
ID: TA0008
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0008/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0008/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Remote Services
</li>
<li class="listitem">
ID: T1021
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1021/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1021/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-remove-file-quarantine-attribute"></a>=== Attempt to Remove File Quarantine Attribute</p>
<p>Identifies a potential Gatekeeper bypass. In macOS, when applications or programs are downloaded from the internet, there is a quarantine flag set on the file. This attribute is read by Apple&#8217;s Gatekeeper defense program at execution time. An adversary may disable this attribute to evade defenses.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.trendmicro.com/en_us/research/20/k/new-macos-backdoor-connected-to-oceanlotus-surfaces.html" class="ulink" target="_top">https://www.trendmicro.com/en_us/research/20/k/new-macos-backdoor-connected-to-oceanlotus-surfaces.html</a>
</li>
<li class="listitem">
<a href="https://ss64.com/osx/xattr.html" class="ulink" target="_top">https://ss64.com/osx/xattr.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-remove-file-quarantine-attribute-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and
process.args : "xattr" and ( (process.args :
"com.apple.quarantine" and process.args : ("-d", "-w")) or
(process.args : "-c" and process.command_line : (
"/bin/bash -c xattr -c *", "/bin/zsh -c xattr -c *",
"/bin/sh -c xattr -c *" ) ) )</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-remove-file-quarantine-attribute-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and
process.name == "xattr" and process.args == "com.apple.quarantine" and
process.args == "-d"</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-reset-mfa-factors-for-an-okta-user-account"></a>=== Attempt to Reset MFA Factors for an Okta User Account</p>
<p>Detects attempts to reset an Okta user&#8217;s enrolled multi-factor authentication (MFA) factors. An adversary may attempt to reset the MFA factors for an Okta user&#8217;s account in order to register new MFA factors and abuse the account to blend in with normal activity in the victim&#8217;s environment.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-reset-mfa-factors-for-an-okta-user-account-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Consider adding exceptions to this rule to filter false positives if the MFA factors for Okta user accounts are regularly reset in your organization.</p>
<p>==== Investigation guide</p>
<p>The Okta Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:user.mfa.factor.reset_all</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Manipulation
</li>
<li class="listitem">
ID: T1098
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-reset-mfa-factors-for-an-okta-user-account-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Attempt to Reset MFA Factors for Okta User Account
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:user.mfa.factor.reset_all</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-revoke-okta-api-token"></a>=== Attempt to Revoke Okta API Token</p>
<p>Identifies attempts to revoke an Okta API token. An adversary may attempt to
revoke or delete an Okta API token to disrupt an organization&#8217;s business
operations.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempt-to-revoke-okta-api-token-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>If the behavior of revoking Okta API tokens is expected, consider adding
exceptions to this rule to filter false positives.</p>
<p>==== Investigation guide</p>
<p>The Okta Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:system.api_token.revoke</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impact
</li>
<li class="listitem">
ID: TA0040
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0040/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0040/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Access Removal
</li>
<li class="listitem">
ID: T1531
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1531/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1531/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempt-to-revoke-okta-api-token-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:system.api_token.revoke</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempt-to-unload-elastic-endpoint-security-kernel-extension"></a>=== Attempt to Unload Elastic Endpoint Security Kernel Extension</p>
<p>Identifies attempts to unload the Elastic Endpoint Security kernel extension via the kextunload command.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:kextunload and
process.args:("/System/Library/Extensions/EndpointSecurity.kext" or
"EndpointSecurity.kext")</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempted-bypass-of-okta-mfa"></a>=== Attempted Bypass of Okta MFA</p>
<p>An adversary may attempt to bypass the Okta multi-factor authentication (MFA)
policies configured for an organization in order to obtain unauthorized access
to an application. This rule detects when an Okta MFA bypass attempt occurs.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempted-bypass-of-okta-mfa-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Okta Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:user.mfa.attempt_bypass</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Two-Factor Authentication Interception
</li>
<li class="listitem">
ID: T1111
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1111/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1111/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempted-bypass-of-okta-mfa-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:okta and event.dataset:okta.system and
event.action:user.mfa.attempt_bypass</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempts-to-brute-force-a-microsoft-365-user-account"></a>=== Attempts to Brute Force a Microsoft 365 User Account</p>
<p>Identifies attempts to brute force a Microsoft 365 user account. An adversary may attempt a brute force attack to obtain unauthorized access to user accounts.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: threshold</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-o365*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-30m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Microsoft 365
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 2 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempts-to-brute-force-a-microsoft-365-user-account-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Automated processes that attempt to authenticate using expired credentials and unbounded retries may lead to false positives.</p>
<p>==== Investigation guide</p>
<p>The Microsoft 365 Fleet integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:o365.audit and event.provider:AzureActiveDirectory and
event.category:authentication and event.action:UserLoginFailed and
event.outcome:failure</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Brute Force
</li>
<li class="listitem">
ID: T1110
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1110/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1110/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempts-to-brute-force-a-microsoft-365-user-account-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 2 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="attempts-to-brute-force-an-okta-user-account"></a>=== Attempts to Brute Force an Okta User Account</p>
<p>Identifies when an Okta user account is locked out 3 times within a 3 hour window. An adversary may attempt a brute force or password spraying attack to obtain unauthorized access to user accounts. The default Okta authentication policy ensures that a user account is locked out after 10 failed authentication attempts.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: threshold</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-180m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Identity
</li>
<li class="listitem">
Okta
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#attempts-to-brute-force-an-okta-user-account-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Okta Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:okta.system and event.action:user.account.lock</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Brute Force
</li>
<li class="listitem">
ID: T1110
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1110/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1110/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="attempts-to-brute-force-an-okta-user-account-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="auditd-login-attempt-at-forbidden-time"></a>=== Auditd Login Attempt at Forbidden Time</p>
<p>Identifies that a login attempt occurred at a forbidden time.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/linux-pam/linux-pam/blob/aac5a8fdc4aa3f7e56335a6343774cc1b63b408d/modules/pam_time/pam_time.c#L666" class="ulink" target="_top">https://github.com/linux-pam/linux-pam/blob/aac5a8fdc4aa3f7e56335a6343774cc1b63b408d/modules/pam_time/pam_time.c#L666</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Initial Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:auditd and event.action:"attempted-log-in-during-unusual-
hour-to"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="auditd-login-from-forbidden-location"></a>=== Auditd Login from Forbidden Location</p>
<p>Identifies that a login attempt has happened from a forbidden location.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/linux-pam/linux-pam/blob/aac5a8fdc4aa3f7e56335a6343774cc1b63b408d/modules/pam_access/pam_access.c#L412" class="ulink" target="_top">https://github.com/linux-pam/linux-pam/blob/aac5a8fdc4aa3f7e56335a6343774cc1b63b408d/modules/pam_access/pam_access.c#L412</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Initial Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:auditd and event.action:"attempted-log-in-from-unusual-
place-to"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="auditd-max-failed-login-attempts"></a>=== Auditd Max Failed Login Attempts</p>
<p>Identifies that the maximum number of failed login attempts has been reached for a user.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/linux-pam/linux-pam/blob/0adbaeb273da1d45213134aa271e95987103281c/modules/pam_faillock/pam_faillock.c#L574" class="ulink" target="_top">https://github.com/linux-pam/linux-pam/blob/0adbaeb273da1d45213134aa271e95987103281c/modules/pam_faillock/pam_faillock.c#L574</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Initial Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:auditd and event.action:"failed-log-in-too-many-times-to"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="auditd-max-login-sessions"></a>=== Auditd Max Login Sessions</p>
<p>Identifies that the maximum number login sessions has been reached for a user.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/linux-pam/linux-pam/blob/70c32cc6fca51338f92afa58eb75b1107a5c2430/modules/pam_limits/pam_limits.c#L1007" class="ulink" target="_top">https://github.com/linux-pam/linux-pam/blob/70c32cc6fca51338f92afa58eb75b1107a5c2430/modules/pam_limits/pam_limits.c#L1007</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Initial Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.module:auditd and event.action:"opened-too-many-sessions-to"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="authorization-plugin-modification"></a>=== Authorization Plugin Modification</p>
<p>Authorization plugins are used to extend the authorization services API and implement mechanisms that are not natively supported by the OS, such as multi-factor authentication with third party software. Adversaries may abuse this feature to persist and/or collect clear text credentials as they traverse the registered plugins during user logon.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.apple.com/documentation/security/authorization_plug-ins" class="ulink" target="_top">https://developer.apple.com/documentation/security/authorization_plug-ins</a>
</li>
<li class="listitem">
<a href="https://www.xorrior.com/persistent-credential-theft/" class="ulink" target="_top">https://www.xorrior.com/persistent-credential-theft/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:file and not event.type:deletion and
file.path:(/Library/Security/SecurityAgentPlugins/* and not /Library/S
ecurity/SecurityAgentPlugins/TeamViewerAuthPlugin.bundle/Contents/*)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Boot or Logon Autostart Execution
</li>
<li class="listitem">
ID: T1547
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1547/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1547/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-active-directory-high-risk-sign-in"></a>=== Azure Active Directory High Risk Sign-in</p>
<p>Identifies high risk Azure Active Directory (AD) sign-ins by leveraging Microsoft&#8217;s Identity Protection machine learning and heuristics. Identity Protection categorizes risk into three tiers: low, medium, and high. While Microsoft does not provide specific details about how risk is calculated, each level brings higher confidence that the user or sign-in is compromised.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-risk" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-risk</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/overview-identity-protection" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/overview-identity-protection</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/howto-identity-protection-investigate-risk" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/identity-protection/howto-identity-protection-investigate-risk</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic, Willem D&#8217;Haese</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Azure Fleet Integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.signinlogs and
azure.signinlogs.properties.risk_level_during_signin:high and
event.outcome:(success or Success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-active-directory-powershell-sign-in"></a>=== Azure Active Directory PowerShell Sign-in</p>
<p>Identifies a sign-in using the Azure Active Directory PowerShell module. PowerShell for Azure Active Directory allows for managing settings from the command line, which is intended for users who are members of an admin role.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/" class="ulink" target="_top">https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/microsoft-365/enterprise/connect-to-microsoft-365-powershell?view=o365-worldwide" class="ulink" target="_top">https://docs.microsoft.com/en-us/microsoft-365/enterprise/connect-to-microsoft-365-powershell?view=o365-worldwide</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-active-directory-powershell-sign-in-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Sign-ins using PowerShell may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be signing into your environment. Sign-ins from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Fleet Integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.signinlogs and
azure.signinlogs.properties.app_display_name:"Azure Active Directory
PowerShell" and azure.signinlogs.properties.token_issuer_type:AzureAD
and event.outcome:(success or Success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-active-directory-powershell-sign-in-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-application-credential-modification"></a>=== Azure Application Credential Modification</p>
<p>Identifies when a new credential is added to an application in Azure. An application may use a certificate or secret string to prove its identity when requesting a token. Multiple certificates and secrets can be added for an application and an adversary may abuse this by creating an additional authentication method to evade defenses or persist in an environment.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/" class="ulink" target="_top">https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-application-credential-modification-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Application credential additions may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Application credential additions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Fleet Integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.auditlogs and
azure.auditlogs.operation_name:"Update application - Certificates and
secrets management" and event.outcome:(success or Success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Use Alternate Authentication Material
</li>
<li class="listitem">
ID: T1550
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1550/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1550/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-application-credential-modification-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-automation-account-created"></a>=== Azure Automation Account Created</p>
<p>Identifies when an Azure Automation account is created. Azure Automation accounts can be used to automate management tasks and orchestrate actions across systems. An adversary may create an Automation account in order to maintain persistence in their target&#8217;s environment.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor" class="ulink" target="_top">https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor</a>
</li>
<li class="listitem">
<a href="https://github.com/hausec/PowerZure" class="ulink" target="_top">https://github.com/hausec/PowerZure</a>
</li>
<li class="listitem">
<a href="https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a" class="ulink" target="_top">https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a</a>
</li>
<li class="listitem">
<a href="https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/" class="ulink" target="_top">https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-automation-account-created-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-automation-account-created-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WRITE and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-automation-runbook-created-or-modified"></a>=== Azure Automation Runbook Created or Modified</p>
<p>Identifies when an Azure Automation runbook is created or modified. An adversary may create or modify an Azure Automation runbook to execute malicious code and maintain persistence in their target&#8217;s environment.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor" class="ulink" target="_top">https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor</a>
</li>
<li class="listitem">
<a href="https://github.com/hausec/PowerZure" class="ulink" target="_top">https://github.com/hausec/PowerZure</a>
</li>
<li class="listitem">
<a href="https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a" class="ulink" target="_top">https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a</a>
</li>
<li class="listitem">
<a href="https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/" class="ulink" target="_top">https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Configuration Audit
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-automation-runbook-created-or-modified-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and
azure.activitylogs.operation_name: (
"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE" or
"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE" or
"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION" )
and event.outcome:(Success or success)</pre>
</div>
<p><a id="azure-automation-runbook-created-or-modified-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:(MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE or
MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE or
MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION) and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:(MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DRAFT/WRITE or
MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/WRITE or
MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/PUBLISH/ACTION) and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-automation-runbook-deleted"></a>=== Azure Automation Runbook Deleted</p>
<p>Identifies when an Azure Automation runbook is deleted. An adversary may delete an Azure Automation runbook in order to disrupt their target&#8217;s automated business operations or to remove a malicious runbook that was used for persistence.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor" class="ulink" target="_top">https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor</a>
</li>
<li class="listitem">
<a href="https://github.com/hausec/PowerZure" class="ulink" target="_top">https://github.com/hausec/PowerZure</a>
</li>
<li class="listitem">
<a href="https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a" class="ulink" target="_top">https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a</a>
</li>
<li class="listitem">
<a href="https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/" class="ulink" target="_top">https://azure.microsoft.com/en-in/blog/azure-automation-runbook-management/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Configuration Audit
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-automation-runbook-deleted-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE" and
event.outcome:(Success or success)</pre>
</div>
<p><a id="azure-automation-runbook-deleted-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/RUNBOOKS/DELETE and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-automation-webhook-created"></a>=== Azure Automation Webhook Created</p>
<p>Identifies when an Azure Automation webhook is created. Azure Automation runbooks can be configured to execute via a webhook. A webhook uses a custom URL passed to Azure Automation along with a data payload specific to the runbook. An adversary may create a webhook in order to trigger a runbook that contains malicious code.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor" class="ulink" target="_top">https://powerzure.readthedocs.io/en/latest/Functions/operational.html#create-backdoor</a>
</li>
<li class="listitem">
<a href="https://github.com/hausec/PowerZure" class="ulink" target="_top">https://github.com/hausec/PowerZure</a>
</li>
<li class="listitem">
<a href="https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a" class="ulink" target="_top">https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a</a>
</li>
<li class="listitem">
<a href="https://www.ciraltos.com/webhooks-and-azure-automation-runbooks/" class="ulink" target="_top">https://www.ciraltos.com/webhooks-and-azure-automation-runbooks/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Configuration Audit
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-automation-webhook-created-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and
azure.activitylogs.operation_name: (
"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION" or
"MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE" ) and
event.outcome:(Success or success)</pre>
</div>
<p><a id="azure-automation-webhook-created-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:(MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION or
MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE) and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:(MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/ACTION or
MICROSOFT.AUTOMATION/AUTOMATIONACCOUNTS/WEBHOOKS/WRITE) and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-blob-container-access-level-modification"></a>=== Azure Blob Container Access Level Modification</p>
<p>Identifies changes to container access levels in Azure. Anonymous public read access to containers and blobs in Azure is a way to share data broadly, but can present a security risk if access to sensitive data is not managed judiciously.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Asset Visibility
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-blob-container-access-level-modification-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Access level modifications may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Access level modifications from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Discovery
</li>
<li class="listitem">
ID: TA0007
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0007/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0007/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Cloud Service Discovery
</li>
<li class="listitem">
ID: T1526
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1526/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1526/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Exploit Public-Facing Application
</li>
<li class="listitem">
ID: T1190
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1190/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1190/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-blob-container-access-level-modification-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.STORAGE/STORAGEACCOUNTS/BLOBSERVICES/CONTAINERS/WRITE and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-command-execution-on-virtual-machine"></a>=== Azure Command Execution on Virtual Machine</p>
<p>Identifies command execution on a virtual machine (VM) in Azure. A Virtual Machine Contributor role lets you manage virtual machines, but not access them, nor access the virtual network or storage account they’re connected to. However, commands can be run via PowerShell on the VM, which execute as System. Other roles, such as certain Administrator roles may be able to execute commands on a VM as well.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://adsecurity.org/?p=4277" class="ulink" target="_top">https://adsecurity.org/?p=4277</a>
</li>
<li class="listitem">
<a href="https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a" class="ulink" target="_top">https://posts.specterops.io/attacking-azure-azure-ad-and-introducing-powerzure-ca70b330511a</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-contributor" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-contributor</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Log Auditing
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-command-execution-on-virtual-machine-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Command execution on a virtual machine may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Command execution from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Scripting Interpreter
</li>
<li class="listitem">
ID: T1059
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1059/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1059/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-command-execution-on-virtual-machine-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.COMPUTE/VIRTUALMACHINES/RUNCOMMAND/ACTION and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-conditional-access-policy-modified"></a>=== Azure Conditional Access Policy Modified</p>
<p>Identifies when an Azure Conditional Access policy is modified. Azure Conditional Access policies control access to resources via if-then statements. For example, if a user wants to access a resource, then they must complete an action such as using multi-factor authentication to access it. An adversary may modify a Conditional Access policy in order to weaken their target&#8217;s security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Configuration Audit
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-conditional-access-policy-modified-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:(azure.activitylogs or azure.auditlogs) and (
azure.activitylogs.operation_name:"Update policy" or
azure.auditlogs.operation_name:"Update policy" ) and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Manipulation
</li>
<li class="listitem">
ID: T1098
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-conditional-access-policy-modified-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:(azure.activitylogs or azure.auditlogs) and (
azure.activitylogs.operation_name:"Update policy" or
azure.auditlogs.operation_name:"Update policy" ) and
event.outcome:success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-diagnostic-settings-deletion"></a>=== Azure Diagnostic Settings Deletion</p>
<p>Identifies the deletion of diagnostic settings in Azure, which send platform logs and metrics to different destinations. An adversary may delete diagnostic settings in an attempt to evade defenses.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/diagnostic-settings" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/azure-monitor/platform/diagnostic-settings</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-diagnostic-settings-deletion-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Deletion of diagnostic settings may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Diagnostic settings deletion from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-diagnostic-settings-deletion-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/DELETE and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-event-hub-authorization-rule-created-or-updated"></a>=== Azure Event Hub Authorization Rule Created or Updated</p>
<p>Identifies when an Event Hub Authorization Rule is created or updated in Azure. An authorization rule is associated with specific rights, and carries a pair of cryptographic keys. When you create an Event Hubs namespace, a policy rule named RootManageSharedAccessKey is created for the namespace. This has manage permissions for the entire namespace and it&#8217;s recommended that you treat this rule like an administrative root account and don&#8217;t use it in your application.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/event-hubs/authorize-access-shared-access-signature" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/event-hubs/authorize-access-shared-access-signature</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Log Auditing
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-event-hub-authorization-rule-created-or-updated-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Authorization rule additions or modifications may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Authorization rule additions or modifications from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Collection
</li>
<li class="listitem">
ID: TA0009
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0009/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0009/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Data from Cloud Storage Object
</li>
<li class="listitem">
ID: T1530
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1530/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1530/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Exfiltration
</li>
<li class="listitem">
ID: TA0010
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0010/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0010/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Transfer Data to Cloud Account
</li>
<li class="listitem">
ID: T1537
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1537/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1537/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-event-hub-authorization-rule-created-or-updated-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.EVENTHUB/NAMESPACES/AUTHORIZATIONRULES/WRITE and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-event-hub-deletion"></a>=== Azure Event Hub Deletion</p>
<p>Identifies an Event Hub deletion in Azure. An Event Hub is an event processing service that ingests and processes large volumes of events and data. An adversary may delete an Event Hub in an attempt to evade detection.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about</a>
</li>
<li class="listitem">
<a href="https://azure.microsoft.com/en-in/services/event-hubs/" class="ulink" target="_top">https://azure.microsoft.com/en-in/services/event-hubs/</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-features" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-features</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Log Auditing
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-event-hub-deletion-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Event Hub deletions may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Event Hub deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-event-hub-deletion-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.EVENTHUB/NAMESPACES/EVENTHUBS/DELETE and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-external-guest-user-invitation"></a>=== Azure External Guest User Invitation</p>
<p>Identifies an invitation to an external user in Azure Active Directory (AD). Azure AD is extended to include collaboration, allowing you to invite people from outside your organization to be guest users in your cloud account. Unless there is a business need to provision guest access, it is best practice avoid creating guest users. Guest users could potentially be overlooked indefinitely leading to a potential vulnerability.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/governance/policy/samples/cis-azure-1-1-0" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/governance/policy/samples/cis-azure-1-1-0</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-external-guest-user-invitation-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Guest user invitations may be sent out by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Guest user invitations from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.auditlogs and
azure.auditlogs.operation_name:"Invite external user" and
azure.auditlogs.properties.target_resources.*.display_name:guest and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-external-guest-user-invitation-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.auditlogs and
azure.auditlogs.operation_name:"Invite external user" and
azure.auditlogs.properties.target_resources.*.display_name:guest and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-firewall-policy-deletion"></a>=== Azure Firewall Policy Deletion</p>
<p>Identifies the deletion of a firewall policy in Azure. An adversary may delete a firewall policy in an attempt to evade defenses and/or to eliminate barriers in carrying out their initiative.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Network Security
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-firewall-policy-deletion-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Firewall policy deletions may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Firewall policy deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-firewall-policy-deletion-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE and event.outcome:(Success
or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE and event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-global-administrator-role-addition-to-pim-user"></a>=== Azure Global Administrator Role Addition to PIM User</p>
<p>Identifies an Azure Active Directory (AD) Global Administrator role addition to a Privileged Identity Management (PIM) user account. PIM is a service that enables you to manage, control, and monitor access to important resources in an organization. Users who are assigned to the Global administrator role can read and modify any administrative setting in your Azure AD organization.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-assign-admin-roles" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-assign-admin-roles</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-global-administrator-role-addition-to-pim-user-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Global administrator additions may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Global administrator additions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.auditlogs and
azure.auditlogs.properties.category:RoleManagement and
azure.auditlogs.operation_name:("Add eligible member to role in PIM
completed (permanent)" or "Add member to role in PIM completed
(timebound)") and
azure.auditlogs.properties.target_resources.*.display_name:"Global
Administrator" and event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Manipulation
</li>
<li class="listitem">
ID: T1098
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-global-administrator-role-addition-to-pim-user-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.auditlogs and
azure.auditlogs.properties.category:RoleManagement and
azure.auditlogs.operation_name:("Add eligible member to role in PIM
completed (permanent)" or "Add member to role in PIM completed
(timebound)") and
azure.auditlogs.properties.target_resources.*.display_name:"Global
Administrator" and event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-key-vault-modified"></a>=== Azure Key Vault Modified</p>
<p>Identifies modifications to a Key Vault in Azure. The Key Vault is a service that safeguards encryption keys and secrets like certificates, connection strings, and passwords. Because this data is sensitive and business critical, access to key vaults should be secured to allow only authorized applications and users.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/key-vault/general/secure-your-key-vault" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/key-vault/general/secure-your-key-vault</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Data Protection
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-key-vault-modified-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Key vault modifications may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Key vault modifications from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and
azure.activitylogs.operation_name:"MICROSOFT.KEYVAULT/VAULTS/WRITE"
and event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Unsecured Credentials
</li>
<li class="listitem">
ID: T1552
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1552/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1552/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-key-vault-modified-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and
azure.activitylogs.operation_name:MICROSOFT.KEYVAULT/VAULTS/WRITE and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and
azure.activitylogs.operation_name:MICROSOFT.KEYVAULT/VAULTS/WRITE and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-network-watcher-deletion"></a>=== Azure Network Watcher Deletion</p>
<p>Identifies the deletion of a Network Watcher in Azure. Network Watchers are used to monitor, diagnose, view metrics, and enable or disable logs for resources in an Azure virtual network. An adversary may delete a Network Watcher in an attempt to evade defenses.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Network Security
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-network-watcher-deletion-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Network Watcher deletions may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Network Watcher deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE" and event.outcome:(Success
or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-network-watcher-deletion-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE and event.outcome:(Success
or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.NETWORK/NETWORKWATCHERS/DELETE and event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-privilege-identity-management-role-modified"></a>=== Azure Privilege Identity Management Role Modified</p>
<p>Azure Active Directory (AD) Privileged Identity Management (PIM) is a service that enables you to manage, control, and monitor access to important resources in an organization. PIM can be used to manage the built-in Azure resource roles such as Global Administrator and Application Administrator. An adversary may add a user to a PIM role in order to maintain persistence in their target&#8217;s environment or modify a PIM role to weaken their target&#8217;s security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-resource-roles-assign-roles" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-resource-roles-assign-roles</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-configure" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-configure</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-privilege-identity-management-role-modified-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.auditlogs and
azure.auditlogs.operation_name:"Update role setting in PIM" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-privilege-identity-management-role-modified-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.auditlogs and
azure.auditlogs.operation_name:"Update role setting in PIM" and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-resource-group-deletion"></a>=== Azure Resource Group Deletion</p>
<p>Identifies the deletion of a resource group in Azure, which includes all resources within the group. Deletion is permanent and irreversible. An adversary may delete a resource group in an attempt to evade defenses or intentionally destroy data.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-portal" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-portal</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Log Auditing
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-resource-group-deletion-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Deletion of a resource group may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Resource group deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impact
</li>
<li class="listitem">
ID: TA0040
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0040/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0040/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Data Destruction
</li>
<li class="listitem">
ID: T1485
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1485/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1485/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-resource-group-deletion-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/DELETE and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-service-principal-addition"></a>=== Azure Service Principal Addition</p>
<p>Identifies when a new service principal is added in Azure. An application, hosted service, or automated tool that accesses or modifies resources needs an identity created. This identity is known as a service principal. For security reasons, it&#8217;s always recommended to use service principals with automated tools rather than allowing them to log in with a user identity.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/" class="ulink" target="_top">https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-service-principal-addition-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>A service principal may be created by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Service principal additions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.</p>
<p>==== Investigation guide</p>
<p>The Azure Fleet Integration or Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.auditlogs and azure.auditlogs.operation_name:"Add
service principal" and event.outcome:(success or Success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Use Alternate Authentication Material
</li>
<li class="listitem">
ID: T1550
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1550/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1550/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-service-principal-addition-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="azure-storage-account-key-regenerated"></a>=== Azure Storage Account Key Regenerated</p>
<p>Identifies a rotation to storage account access keys in Azure. Regenerating access keys can affect any applications or Azure services that are dependent on the storage account key. Adversaries may regenerate a key as a means of acquiring credentials to access systems and resources.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-25m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage?tabs=azure-portal" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage?tabs=azure-portal</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Azure
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Identity and Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#azure-storage-account-key-regenerated-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>It&#8217;s recommended that you rotate your access keys periodically to help keep your storage account secure. Normal key rotation can be exempted from the rule. An abnormal time frame and/or a key rotation from unfamiliar users, hosts, or locations should be investigated.</p>
<p>==== Investigation guide</p>
<p>The Azure Filebeat module must be enabled to use this rule.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:"MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION" and
event.outcome:(Success or success)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Steal Application Access Token
</li>
<li class="listitem">
ID: T1528
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1528/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1528/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="azure-storage-account-key-regenerated-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION and
event.outcome:(Success or success)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:azure.activitylogs and azure.activitylogs.operation_name
:MICROSOFT.STORAGE/STORAGEACCOUNTS/REGENERATEKEY/ACTION and
event.outcome:Success</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="base16-or-base32-encoding-decoding-activity"></a>=== Base16 or Base32 Encoding/Decoding Activity</p>
<p>Identifies attempts to encode and decode data, a technique adversaries can
use to evade detection by host- or network-based security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 7 (<a class="xref" href="application-added-to-google-workspace-domain.html#base16-or-base32-encoding-decoding-activity-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.8.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Automated tools such as Jenkins may encode or decode files as part of their normal behavior. These events can be filtered by the process executable or username values.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:(base16 or base32 or base32plain or base32hex)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Deobfuscate/Decode Files or Information
</li>
<li class="listitem">
ID: T1140
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1140/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1140/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="base16-or-base32-encoding-decoding-activity-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 7 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:(executed or process_started) and process.name:(base16 or
base32 or base32plain or base32hex)</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="base64-encoding-decoding-activity"></a>=== Base64 Encoding/Decoding Activity</p>
<p>Identifies attempts to encode and decode data, a technique adversaries can
use to evade detection by host- or network-based security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 7 (<a class="xref" href="application-added-to-google-workspace-domain.html#base64-encoding-decoding-activity-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.8.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Automated tools such as Jenkins may encode or decode files as part of their normal behavior. These events can be filtered by the process executable or username values.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:(base64 or base64plain or base64url or base64mime or
base64pem)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Deobfuscate/Decode Files or Information
</li>
<li class="listitem">
ID: T1140
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1140/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1140/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="base64-encoding-decoding-activity-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 7 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:(executed or process_started) and process.name:(base64 or
base64plain or base64url or base64mime or base64pem)</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="bash-shell-profile-modification"></a>=== Bash Shell Profile Modification</p>
<p>Both ~/.bash_profile and ~/.bashrc are files containing shell commands that are run when Bash is invoked. These files are executed in a user&#8217;s context, either interactively or non-interactively, when a user logs in so that their environment is set correctly. Adversaries may abuse this to establish persistence by executing malicious content triggered by a user’s shell.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
auditbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.anomali.com/blog/pulling-linux-rabbit-rabbot-malware-out-of-a-hat" class="ulink" target="_top">https://www.anomali.com/blog/pulling-linux-rabbit-rabbot-malware-out-of-a-hat</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Changes to the Shell Profile tend to be noisy, a tuning per your environment will be required.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:file and event.type:change and process.name:(* and not
(sudo or vim or zsh or env or nano or bash or Terminal or xpcproxy or
login or cat or cp or launchctl or java)) and not
process.executable:(/Applications/* or /private/var/folders/* or
/usr/local/*) and file.path:(/private/etc/rc.local or /etc/rc.local or
/home/*/.profile or /home/*/.profile1 or /home/*/.bash_profile or
/home/*/.bash_profile1 or /home/*/.bashrc or /Users/*/.bash_profile or
/Users/*/.zshenv)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Event Triggered Execution
</li>
<li class="listitem">
ID: T1546
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1546/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1546/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="bypass-uac-via-event-viewer"></a>=== Bypass UAC via Event Viewer</p>
<p>Identifies User Account Control (UAC) bypass via <code class="literal">eventvwr.exe.</code> Attackers
bypass UAC to stealthily execute code with elevated permissions.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Privilege Escalation
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 7 (<a class="xref" href="application-added-to-google-workspace-domain.html#bypass-uac-via-event-viewer-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.7.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.parent.name:eventvwr.exe and not
process.executable:("C:\Windows\SysWOW64\mmc.exe" or
"C:\Windows\System32\mmc.exe")</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Abuse Elevation Control Mechanism
</li>
<li class="listitem">
ID: T1548
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1548/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1548/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="bypass-uac-via-event-viewer-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 7 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process.parent.name:eventvwr.exe and event.action:"Process Create
(rule: ProcessCreate)" and not
process.executable:("C:\Windows\SysWOW64\mmc.exe" or
"C:\Windows\System32\mmc.exe")</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="clearing-windows-event-logs"></a>=== Clearing Windows Event Logs</p>
<p>Identifies attempts to clear Windows event log stores. This is often done by
attackers in an attempt to evade detection or destroy forensic evidence on a
system.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 8 (<a class="xref" href="application-added-to-google-workspace-domain.html#clearing-windows-event-logs-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(process_started or start) and
(process.name:"wevtutil.exe" or
process.pe.original_file_name:"wevtutil.exe") and
process.args:("/e:false" or cl or "clear-log") or
process.name:"powershell.exe" and process.args:"Clear-EventLog"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Indicator Removal on Host
</li>
<li class="listitem">
ID: T1070
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1070/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1070/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="clearing-windows-event-logs-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 8 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 7 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:wevtutil.exe and process.args:cl or
process.name:powershell.exe and process.args:Clear-EventLog</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Process Create (rule: ProcessCreate)" and
process.name:wevtutil.exe and process.args:cl or
process.name:powershell.exe and process.args:Clear-EventLog</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Process Create (rule: ProcessCreate)" and
(process.name:"wevtutil.exe" and process.args:"cl") or
(process.name:"powershell.exe" and process.args:"Clear-EventLog")</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="cobalt-strike-command-and-control-beacon"></a>=== Cobalt Strike Command and Control Beacon</p>
<p>Cobalt Strike is a threat emulation platform commonly modified and used by adversaries to conduct network attack and exploitation campaigns. This rule detects a network activity algorithm leveraged by Cobalt Strike implant beacons for command and control.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
packetbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://blog.morphisec.com/fin7-attacks-restaurant-industry" class="ulink" target="_top">https://blog.morphisec.com/fin7-attacks-restaurant-industry</a>
</li>
<li class="listitem">
<a href="https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html" class="ulink" target="_top">https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Network
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Command and Control
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#cobalt-strike-command-and-control-beacon-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>This rule should be tailored to either exclude systems, as sources or destinations, in which this behavior is expected.</p>
<p>==== Investigation guide</p>
<p>This activity has been observed in FIN7 campaigns.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:(network OR network_traffic) AND type:(tls OR http) AND
network.transport:tcp AND
destination.domain:/[a-z]{3}.stage.[0-9]{8}\..*/</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Control
</li>
<li class="listitem">
ID: TA0011
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0011/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0011/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Application Layer Protocol
</li>
<li class="listitem">
ID: T1071
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1071/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1071/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="cobalt-strike-command-and-control-beacon-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="command-execution-via-solarwinds-process"></a>=== Command Execution via SolarWinds Process</p>
<p>A suspicious SolarWinds child process (Cmd.exe or Powershell.exe) was detected.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html" class="ulink" target="_top">https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html</a>
</li>
<li class="listitem">
<a href="https://github.com/fireeye/sunburst_countermeasures/blob/main/rules/SUNBURST/hxioc/SOLARWINDS%20SUSPICIOUS%20FILEWRITES%20(METHODOLOGY).ioc" class="ulink" target="_top">https://github.com/fireeye/sunburst_countermeasures/blob/main/rules/SUNBURST/hxioc/SOLARWINDS%20SUSPICIOUS%20FILEWRITES%20(METHODOLOGY).ioc</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Execution
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#command-execution-via-solarwinds-process-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Trusted SolarWinds child processes. Verify process details such as network connections and file writes.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and
process.name: ("cmd.exe", "powershell.exe") and process.parent.name: (
"ConfigurationWizard*.exe", "NetflowDatabaseMaintenance*.exe",
"NetFlowService*.exe", "SolarWinds.Administration*.exe",
"SolarWinds.Collector.Service*.exe", "SolarwindsDiagnostics*.exe"
)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Scripting Interpreter
</li>
<li class="listitem">
ID: T1059
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1059/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1059/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Supply Chain Compromise
</li>
<li class="listitem">
ID: T1195
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1195/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1195/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="command-execution-via-solarwinds-process-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="command-prompt-network-connection"></a>=== Command Prompt Network Connection</p>
<p>Identifies <code class="literal">cmd.exe</code> making a network connection. Adversaries can abuse
<code class="literal">cmd.exe</code> to download or execute malware from a remote URL.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Execution
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 6 (<a class="xref" href="application-added-to-google-workspace-domain.html#command-prompt-network-connection-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Administrators may use the command prompt for regular administrative tasks. It&#8217;s important to baseline your environment for network connections being made from the command prompt to determine any abnormal use of this tool.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">sequence by process.entity_id [process where process.name :
"cmd.exe" and event.type == "start"] [network where process.name :
"cmd.exe" and not cidrmatch(destination.ip, "10.0.0.0/8",
"172.16.0.0/12", "192.168.0.0/16")]</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Scripting Interpreter
</li>
<li class="listitem">
ID: T1059
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1059/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1059/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Control
</li>
<li class="listitem">
ID: TA0011
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0011/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0011/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Ingress Tool Transfer
</li>
<li class="listitem">
ID: T1105
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1105/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1105/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="command-prompt-network-connection-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 6 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:network and event.type:connection and
process.name:cmd.exe and not destination.ip:(10.0.0.0/8 or
172.16.0.0/12 or 192.168.0.0/16)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process.name:cmd.exe and event.action:"Network connection detected
(rule: NetworkConnect)" and not destination.ip:(10.0.0.0/8 or
172.16.0.0/12 or 192.168.0.0/16)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process.name:cmd.exe and event.action:"Network connection detected
(rule: NetworkConnect)" and not destination.ip:10.0.0.0/8 and not
destination.ip:172.16.0.0/12 and not destination.ip:192.168.0.0/16</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="command-shell-activity-started-via-rundll32"></a>=== Command Shell Activity Started via RunDLL32</p>
<p>Identifies command shell activity started via RunDLL32, which is commonly abused by attackers to host malicious code.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Execution
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#command-shell-activity-started-via-rundll32-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and
process.name : ("cmd.exe", "powershell.exe") and process.parent.name
: "rundll32.exe" and /* common FPs can be added here */ not
process.parent.args :
"C:\\Windows\\System32\\SHELL32.dll,RunAsNewUser_RunDLL"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Scripting Interpreter
</li>
<li class="listitem">
ID: T1059
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1059/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1059/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="command-shell-activity-started-via-rundll32-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="component-object-model-hijacking"></a>=== Component Object Model Hijacking</p>
<p>Identifies Component Object Model (COM) hijacking via registry modification. Adversaries may establish persistence by executing malicious content triggered by hijacked references to COM objects.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/" class="ulink" target="_top">https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#component-object-model-hijacking-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">registry where /* uncomment once length is stable
length(bytes_written_string) &gt; 0 and */ (registry.path :
"HK*}\\InprocServer32\\" and registry.data.strings: ("scrobj.dll",
"C:\\*\\scrobj.dll") and not registry.path :
"*\\{06290BD*-48AA-11D2-8432-006008C3FBFC}\\*") or /* in general
COM Registry changes on Users Hive is less noisy and worth alerting */
(registry.path : ("HKEY_USERS\\*Classes\\*\\InprocXServer32\\",
"HKEY_USERS\\*Classes\\*\\LocalServer32\\",
"HKEY_USERS\\*Classes\\*\\DelegateExecute\\",
"HKEY_USERS\\*Classes\\*\\TreatAs\\",
"HKEY_USERS\\*Classes\\CLSID\\*\\ScriptletURL\\") and /* not
necessary but good for filtering privileged installations */
user.domain != "NT AUTHORITY")</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Event Triggered Execution
</li>
<li class="listitem">
ID: T1546
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1546/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1546/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="component-object-model-hijacking-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="conhost-spawned-by-suspicious-parent-process"></a>=== Conhost Spawned By Suspicious Parent Process</p>
<p>Detects when the Console Window Host (conhost.exe) process is spawned by a suspicious parent process, which could be indicative of code injection.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.fireeye.com/blog/threat-research/2017/08/monitoring-windows-console-activity-part-one.html" class="ulink" target="_top">https://www.fireeye.com/blog/threat-research/2017/08/monitoring-windows-console-activity-part-one.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Execution
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#conhost-spawned-by-suspicious-parent-process-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:conhost.exe and process.parent.name:(svchost.exe or
lsass.exe or services.exe or smss.exe or winlogon.exe or explorer.exe
or dllhost.exe or rundll32.exe or regsvr32.exe or userinit.exe or
wininit.exe or spoolsv.exe or wermgr.exe or csrss.exe or ctfmon.exe)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Scripting Interpreter
</li>
<li class="listitem">
ID: T1059
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1059/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1059/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="conhost-spawned-by-suspicious-parent-process-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="connection-to-commonly-abused-free-ssl-certificate-providers"></a>=== Connection to Commonly Abused Free SSL Certificate Providers</p>
<p>Identifies unusual processes connecting to domains using known free SSL certificates. Adversaries may employ a known encryption algorithm to conceal command and control traffic.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Command and Control
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#connection-to-commonly-abused-free-ssl-certificate-providers-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">network where network.protocol == "dns" and /* Add new free SSL
certificate provider domains here */ dns.question.name :
("*letsencrypt.org", "*.sslforfree.com", "*.zerossl.com",
"*.freessl.org") and /* Native Windows process paths that are
unlikely to have network connections to domains secured using free SSL
certificates */ process.executable :
("C:\\Windows\\System32\\*.exe",
"C:\\Windows\\System\\*.exe",
"C:\\Windows\\SysWOW64\\*.exe",
"C:\\Windows\\Microsoft.NET\\Framework*\\*.exe",
"C:\\Windows\\explorer.exe",
"C:\\Windows\\notepad.exe") and /* Insert noisy false positives
here */ not process.name : ("svchost.exe", "MicrosoftEdge*.exe",
"msedge.exe")</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Control
</li>
<li class="listitem">
ID: TA0011
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0011/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0011/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Encrypted Channel
</li>
<li class="listitem">
ID: T1573
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1573/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1573/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="connection-to-commonly-abused-free-ssl-certificate-providers-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="connection-to-commonly-abused-web-services"></a>=== Connection to Commonly Abused Web Services</p>
<p>Adversaries may implement command and control communications that use common web services in order to hide their activity. This attack technique is typically targeted to an organization and uses web services common to the victim network which allows the adversary to blend into legitimate traffic. activity. These popular services are typically targeted since they have most likely been used before a compromise and allow adversaries to blend in the network.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Command and Control
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#connection-to-commonly-abused-web-services-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">network where network.protocol == "dns" and /* Add new WebSvc
domains here */ dns.question.name : (
"*.githubusercontent.*", "*.pastebin.*",
"*drive.google.*", "*docs.live.*",
"*api.dropboxapi.*", "*dropboxusercontent.*",
"*onedrive.*", "*4shared.*", "*.file.io",
"*filebin.net", "*slack-files.com", "*ghostbin.*",
"*ngrok.*", "*portmap.*", "*serveo.net",
"*localtunnel.me", "*pagekite.me", "*localxpose.io",
"*notabug.org" ) and /* Insert noisy false positives here */
not process.name : ( "MicrosoftEdgeCP.exe",
"MicrosoftEdge.exe", "iexplore.exe", "chrome.exe",
"msedge.exe", "opera.exe", "firefox.exe",
"Dropbox.exe", "slack.exe", "svchost.exe",
"thunderbird.exe", "outlook.exe", "OneDrive.exe" )</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Control
</li>
<li class="listitem">
ID: TA0011
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0011/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0011/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Web Service
</li>
<li class="listitem">
ID: T1102
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1102/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1102/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="connection-to-commonly-abused-web-services-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">network where network.protocol == "dns" and /* Add new
WebSvc domains here */ wildcard(dns.question.name,
"*.githubusercontent.*",
"*.pastebin.*",
"*drive.google.*",
"*docs.live.*",
"*api.dropboxapi.*",
"*dropboxusercontent.*",
"*onedrive.*", "*4shared.*",
"*.file.io", "*filebin.net",
"*slack-files.com",
"*ghostbin.*", "*ngrok.*",
"*portmap.*", "*serveo.net",
"*localtunnel.me",
"*pagekite.me",
"*localxpose.io",
"*notabug.org" ) and
/* Insert noisy false positives here */ not process.name
in ("MicrosoftEdgeCP.exe",
"MicrosoftEdge.exe",
"iexplore.exe", "chrome.exe",
"msedge.exe", "opera.exe",
"firefox.exe", "Dropbox.exe",
"slack.exe", "svchost.exe",
"thunderbird.exe", "outlook.exe",
"OneDrive.exe")</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="connection-to-external-network-via-telnet"></a>=== Connection to External Network via Telnet</p>
<p>Telnet provides a command line interface for communication with a remote device or server. This rule identifies Telnet network connections to publicly routable IP addresses.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Lateral Movement
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#connection-to-external-network-via-telnet-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.8.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Telnet can be used for both benign or malicious purposes. Telnet is included by default in some Linux distributions, so its presence is not inherently suspicious. The use of Telnet to manage devices remotely has declined in recent years in favor of more secure protocols such as SSH. Telnet usage by non-automated tools or frameworks may be suspicious.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">sequence by process.entity_id [process where process.name ==
"telnet" and event.type == "start"] [network where process.name ==
"telnet" and not cidrmatch(destination.ip, "127.0.0.0/8",
"10.0.0.0/8", "172.16.0.0/12",
"192.168.0.0/16", "FE80::/10", "::1/128")]</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Lateral Movement
</li>
<li class="listitem">
ID: TA0008
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0008/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0008/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Remote Services
</li>
<li class="listitem">
ID: T1021
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1021/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1021/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="connection-to-external-network-via-telnet-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:network and event.type:(connection or start) and
process.name:telnet and not destination.ip:(127.0.0.0/8 or 10.0.0.0/8
or 172.16.0.0/12 or 192.168.0.0/16 or "FE80::/10" or "::1/128")</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:("connected-to" or "network_flow") and
process.name:telnet and not destination.ip:(127.0.0.0/8 or 10.0.0.0/8
or 172.16.0.0/12 or 192.168.0.0/16 or "FE80::/10" or "::1/128")</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="connection-to-internal-network-via-telnet"></a>=== Connection to Internal Network via Telnet</p>
<p>Telnet provides a command line interface for communication with a remote device or server. This rule identifies Telnet network connections to non-publicly routable IP addresses.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Lateral Movement
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5 (<a class="xref" href="application-added-to-google-workspace-domain.html#connection-to-internal-network-via-telnet-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.8.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Telnet can be used for both benign or malicious purposes. Telnet is included by default in some Linux distributions, so its presence is not inherently suspicious. The use of Telnet to manage devices remotely has declined in recent years in favor of more secure protocols such as SSH. Telnet usage by non-automated tools or frameworks may be suspicious.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">sequence by process.entity_id [process where process.name ==
"telnet" and event.type == "start"] [network where process.name ==
"telnet" and cidrmatch(destination.ip, "10.0.0.0/8",
"172.16.0.0/12", "192.168.0.0/16", "FE80::/10") and not
cidrmatch(destination.ip, "127.0.0.0/8", "::1/128")]</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Lateral Movement
</li>
<li class="listitem">
ID: TA0008
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0008/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0008/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Remote Services
</li>
<li class="listitem">
ID: T1021
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1021/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1021/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="connection-to-internal-network-via-telnet-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:network and event.type:(connection or start) and
process.name:telnet and destination.ip:((10.0.0.0/8 or 172.16.0.0/12
or 192.168.0.0/16 or "FE80::/10") and not (127.0.0.0/8 or "::1/128"))</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:("connected-to" or "network_flow") and
process.name:telnet and destination.ip:((10.0.0.0/8 or 172.16.0.0/12
or 192.168.0.0/16 or "FE80::/10") and not (127.0.0.0/8 or "::1/128"))</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="creation-of-hidden-files-and-directories"></a>=== Creation of Hidden Files and Directories</p>
<p>Users can mark specific files as hidden simply by adding a <code class="literal">.</code> as the first
character in the file or folder name. Adversaries can use this to their
advantage to hide files and folders on the system for persistence and defense
evasion. This rule looks for hidden files or folders in common writable
directories.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 33</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Linux
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 6 (<a class="xref" href="application-added-to-google-workspace-domain.html#creation-of-hidden-files-and-directories-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.9.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Certain tools may create hidden temporary files or directories upon
installation or as part of their normal behavior. These events can be filtered
by the process arguments, username, or process name values.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process AND event.type:(start or process_started) AND
process.working_directory:("/tmp" or "/var/tmp" or "/dev/shm") AND
process.args:/\.[a-zA-Z0-9_\-][a-zA-Z0-9_\-\.]{1,254}/ AND NOT
process.name:(ls or find)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Hide Artifacts
</li>
<li class="listitem">
ID: T1564
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1564/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1564/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="creation-of-hidden-files-and-directories-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 6 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="creation-of-hidden-launch-agent-or-daemon"></a>=== Creation of Hidden Launch Agent or Daemon</p>
<p>Identifies the creation of a hidden launch agent or daemon. An adversary may establish persistence by installing a new launch agent or daemon which executes at login.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html" class="ulink" target="_top">https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Persistence
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">file where event.type != "deletion" and file.path : (
"/System/Library/LaunchAgents/.*.plist",
"/Library/LaunchAgents/.*.plist",
"/Users/*/Library/LaunchAgents/.*.plist",
"/System/Library/LaunchDaemons/.*.plist",
"/Library/LaunchDaemons/.*.plist" )</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Create or Modify System Process
</li>
<li class="listitem">
ID: T1543
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1543/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1543/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Hide Artifacts
</li>
<li class="listitem">
ID: T1564
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1564/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1564/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="creation-of-hidden-login-item-via-apple-script"></a>=== Creation of Hidden Login Item via Apple Script</p>
<p>Identifies the execution of osascript to create a hidden login item. This may indicate an attempt to persist a malicious program while concealing its presence.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
macOS
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Persistence
</li>
<li class="listitem">
Execution
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and
process.name : "osascript" and process.command_line :
"osascript*login item*hidden:true*"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Boot or Logon Autostart Execution
</li>
<li class="listitem">
ID: T1547
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1547/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1547/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Scripting Interpreter
</li>
<li class="listitem">
ID: T1059
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1059/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1059/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="creation-of-a-hidden-local-user-account"></a>=== Creation of a Hidden Local User Account</p>
<p>Identifies the creation of a hidden local user account by appending the dollar sign to the account name. This is sometimes done by attackers to increase access to a system and avoid appearing in the results of accounts listing using the net users command.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://blog.menasec.net/2019/02/threat-hunting-6-hiding-in-plain-sights_8.html" class="ulink" target="_top">https://blog.menasec.net/2019/02/threat-hunting-6-hiding-in-plain-sights_8.html</a>
</li>
<li class="listitem">
<a href="https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/tree/master/2020/2020.12.15.Lazarus_Campaign" class="ulink" target="_top">https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/tree/master/2020/2020.12.15.Lazarus_Campaign</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">registry where registry.path :
"HKLM\\SAM\\SAM\\Domains\\Account\\Users\\Names\\*$\\"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Create Account
</li>
<li class="listitem">
ID: T1136
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1136/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1136/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="creation-or-modification-of-domain-backup-dpapi-private-key"></a>=== Creation or Modification of Domain Backup DPAPI private key</p>
<p>Identifies the creation or modification of Domain Backup private keys. Adversaries may extract the Data Protection API (DPAPI) domain backup key from a Domain Controller (DC) to be able to decrypt any domain user master key file.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/" class="ulink" target="_top">https://www.dsinternals.com/en/retrieving-dpapi-backup-keys-from-active-directory/</a>
</li>
<li class="listitem">
<a href="https://www.harmj0y.net/blog/redteaming/operational-guidance-for-offensive-user-dpapi-abuse/" class="ulink" target="_top">https://www.harmj0y.net/blog/redteaming/operational-guidance-for-offensive-user-dpapi-abuse/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Credential Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#creation-or-modification-of-domain-backup-dpapi-private-key-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>Domain DPAPI Backup keys are stored on domain controllers and can be dumped remotely with tools such as Mimikatz. The resulting .pvk private key can be used to decrypt ANY domain user masterkeys, which then can be used to decrypt any secrets protected by those keys.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:file and not event.type:deletion and
file.name:(ntds_capi_*.pfx or ntds_capi_*.pvk)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Unsecured Credentials
</li>
<li class="listitem">
ID: T1552
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1552/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1552/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="creation-or-modification-of-domain-backup-dpapi-private-key-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="creation-or-modification-of-root-certificate"></a>=== Creation or Modification of Root Certificate</p>
<p>Identifies the creation or modification of a local trusted root certificate in Windows. The install of a malicious root certificate would allow an attacker the ability to masquerade malicious files as valid signed components from any entity (e.g. Microsoft). It could also allow an attacker to decrypt SSL traffic.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec" class="ulink" target="_top">https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec</a>
</li>
<li class="listitem">
<a href="https://www.ired.team/offensive-security/persistence/t1130-install-root-certificate" class="ulink" target="_top">https://www.ired.team/offensive-security/persistence/t1130-install-root-certificate</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Certain applications may install root certificates for the purpose of inspecting SSL traffic.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">registry where event.type in ("creation", "change") and
registry.path : ( "HKLM\\Software\\Microsoft\\SystemCertific
ates\\Root\\Certificates\\*\\Blob", "HKLM\\Software\\Microsoft\\
SystemCertificates\\AuthRoot\\Certificates\\*\\Blob", "HKLM\\Sof
tware\\Policies\\Microsoft\\SystemCertificates\\Root\\Certificates\\*\
\Blob", "HKLM\\Software\\Policies\\Microsoft\\SystemCertificates
\\AuthRoot\\Certificates\\*\\Blob" )</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Subvert Trust Controls
</li>
<li class="listitem">
ID: T1553
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1553/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1553/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="creation-or-modification-of-a-new-gpo-scheduled-task-or-service"></a>=== Creation or Modification of a new GPO Scheduled Task or Service</p>
<p>Detects the creation or modification of a new Group Policy based scheduled task or service. These methods are used for legitimate system administration, but can also be abused by an attacker with domain admin permissions to execute a malicious payload remotely on all or a subset of the domain joined machines.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#creation-or-modification-of-a-new-gpo-scheduled-task-or-service-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.10.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:file and not event.type:deletion and file.path:(C\:\\Wi
ndows\\SYSVOL\\domain\\Policies\\*\\MACHINE\\Preferences\\ScheduledTas
ks\\ScheduledTasks.xml or C\:\\Windows\\SYSVOL\\domain\\Policies\\*\\M
ACHINE\\Preferences\\Preferences\\Services\\Services.xml) and not
process.name:dfsrs.exe</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Scheduled Task/Job
</li>
<li class="listitem">
ID: T1053
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1053/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1053/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="creation-or-modification-of-a-new-gpo-scheduled-task-or-service-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="credential-acquisition-via-registry-hive-dumping"></a>=== Credential Acquisition via Registry Hive Dumping</p>
<p>Identifies attempts to export a registry hive which may contain credentials using the Windows reg.exe tool.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://medium.com/threatpunter/detecting-attempts-to-steal-passwords-from-the-registry-7512674487f8" class="ulink" target="_top">https://medium.com/threatpunter/detecting-attempts-to-steal-passwords-from-the-registry-7512674487f8</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Credential Access
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#credential-acquisition-via-registry-hive-dumping-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and
process.pe.original_file_name == "reg.exe" and process.args :
("save", "export") and process.args : ("hklm\\sam", "hklm\\security")</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: OS Credential Dumping
</li>
<li class="listitem">
ID: T1003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1003/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1003/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="credential-acquisition-via-registry-hive-dumping-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and
process.pe.original_file_name == "reg.exe" and process.args :
("save", "export") and process.args : ("hklm\\sam", "hklm\\security")
and not process.parent.executable : "C:\\Program
Files*\\Rapid7\\Insight
Agent\\components\\insight_agent\\*\\ir_agent.exe"</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">process where event.type in ("start", "process_started") and
process.pe.original_file_name == "reg.exe" and process.args :
("save", "export") and process.args : ("hklm\\sam", "hklm\\security")
and not process.parent.executable : "C:\\Program
Files*\\Rapid7\\Insight
Agent\\components\\insight_agent\\*\\ir_agent.exe"</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="credential-dumping-detected-elastic-endgame"></a>=== Credential Dumping - Detected - Elastic Endgame</p>
<p>Elastic Endgame detected Credential Dumping. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
endgame-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-15m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Elastic Endgame
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 6 (<a class="xref" href="application-added-to-google-workspace-domain.html#credential-dumping-detected-elastic-endgame-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and
endgame.metadata.type:detection and (event.action:cred_theft_event or
endgame.event_subtype_full:cred_theft_event)</pre>
</div>
<p><a id="credential-dumping-detected-elastic-endgame-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 6 (7.12.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Dumping - Detected - Endpoint Security
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Dumping - Detected - Elastic Endpoint Security
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Dumping - Detected - Elastic Endpoint
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and
event.action:cred_theft_event and endgame.metadata.type:detection</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="credential-dumping-prevented-elastic-endgame"></a>=== Credential Dumping - Prevented - Elastic Endgame</p>
<p>Elastic Endgame prevented Credential Dumping. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
endgame-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-15m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Elastic Endgame
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 6 (<a class="xref" href="application-added-to-google-workspace-domain.html#credential-dumping-prevented-elastic-endgame-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and
endgame.metadata.type:prevention and (event.action:cred_theft_event or
endgame.event_subtype_full:cred_theft_event)</pre>
</div>
<p><a id="credential-dumping-prevented-elastic-endgame-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 6 (7.12.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Dumping - Prevented - Endpoint Security
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Dumping - Prevented - Elastic Endpoint Security
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Dumping - Prevented - Elastic Endpoint
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and
event.action:cred_theft_event and endgame.metadata.type:prevention</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="credential-manipulation-detected-elastic-endgame"></a>=== Credential Manipulation - Detected - Elastic Endgame</p>
<p>Elastic Endgame detected Credential Manipulation. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
endgame-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-15m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Elastic Endgame
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 6 (<a class="xref" href="application-added-to-google-workspace-domain.html#credential-manipulation-detected-elastic-endgame-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and
endgame.metadata.type:detection and
(event.action:token_manipulation_event or
endgame.event_subtype_full:token_manipulation_event)</pre>
</div>
<p><a id="credential-manipulation-detected-elastic-endgame-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 6 (7.12.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Manipulation - Detected - Endpoint Security
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Manipulation - Detected - Elastic Endpoint Security
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Manipulation - Detected - Elastic Endpoint
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and
event.action:token_manipulation_event and
endgame.metadata.type:detection</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="credential-manipulation-prevented-elastic-endgame"></a>=== Credential Manipulation - Prevented - Elastic Endgame</p>
<p>Elastic Endgame prevented Credential Manipulation. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
endgame-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-15m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Elastic Endgame
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 6 (<a class="xref" href="application-added-to-google-workspace-domain.html#credential-manipulation-prevented-elastic-endgame-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and
endgame.metadata.type:prevention and
(event.action:token_manipulation_event or
endgame.event_subtype_full:token_manipulation_event)</pre>
</div>
<p><a id="credential-manipulation-prevented-elastic-endgame-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 6 (7.12.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Manipulation - Prevented - Endpoint Security
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Manipulation - Prevented - Elastic Endpoint Security
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rule name changed from: Credential Manipulation - Prevented - Elastic Endpoint
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and
event.action:token_manipulation_event and
endgame.metadata.type:prevention</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="dns-activity-to-the-internet"></a>=== DNS Activity to the Internet</p>
<p>Detects when an internal network client sends DNS traffic directly to the
Internet. This is atypical behavior for a managed network, and can be indicative
of malware, exfiltration, command and control, or, simply, misconfiguration.
This DNS activity also impacts your organization&#8217;s ability to provide enterprise
monitoring and logging of DNS, and opens your network to a variety of abuses and
malicious communications.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
packetbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.us-cert.gov/ncas/alerts/TA15-240A" class="ulink" target="_top">https://www.us-cert.gov/ncas/alerts/TA15-240A</a>
</li>
<li class="listitem">
<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-81-2.pdf" class="ulink" target="_top">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-81-2.pdf</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Network
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Command and Control
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 8 (<a class="xref" href="application-added-to-google-workspace-domain.html#dns-activity-to-the-internet-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Exclude DNS servers from this rule as this is expected behavior. Endpoints usually query local DNS servers defined in their DHCP scopes, but this may be overridden if a user configures their endpoint to use a remote DNS server. This is uncommon in managed enterprise networks because it could break intranet name resolution when split horizon DNS is utilized. Some consumer VPN services and browser plug-ins may send DNS traffic to remote Internet destinations. In that case, such devices or networks can be excluded from this rule when this is expected behavior.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:(network or network_traffic) and (event.type:connection
or type:dns) and (destination.port:53 or event.dataset:zeek.dns) and
source.ip:( 10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16 ) and not
destination.ip:( 10.0.0.0/8 or 127.0.0.0/8 or 169.254.0.0/16 or
172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.0/4 or 255.255.255.255 or
"::1" or "FE80::/10" or "FF00::/8")</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Control
</li>
<li class="listitem">
ID: TA0011
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0011/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0011/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="dns-activity-to-the-internet-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 8 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 7 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:(network or network_traffic) and (event.type:connection
or type:dns) and (destination.port:53 or event.dataset:zeek.dns) and
source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not
destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or 169.254.169.254/32 or
172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.251 or 224.0.0.252 or
255.255.255.255 or "::1" or "ff02::fb")</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">destination.port:53 and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or
192.168.0.0/16) and not destination.ip:(10.0.0.0/8 or 127.0.0.0/8 or
169.254.169.254/32 or 172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.251
or 224.0.0.252 or 255.255.255.255 or "::1" or "ff02::fb")</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">destination.port:53 and ( network.direction: outbound or (
source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not
destination.ip:( 169.254.169.254/32 or 127.0.0.53/32 or 10.0.0.0/8 or
172.16.0.0/12 or 192.168.0.0/16 or 224.0.0.251 or ff02\:\:fb or
255.255.255.255 ) ) )</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.6.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Removed auditbeat-*, packetbeat-*, and winlogbeat-* from the rule indices.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="dns-tunneling"></a>=== DNS Tunneling</p>
<p>Detects unusually large numbers of DNS queries for a single top-level DNS
domain, which is often used for DNS tunneling. DNS tunneling can be used for
command-and-control, persistence, or data exfiltration activity. For example,
<code class="literal">dnscat</code> tends to generate many DNS questions for a top-level domain as it uses
the DNS protocol to tunnel data.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: machine_learning</p>
<p><span class="strong strong"><strong>Machine learning job</strong></span>: packetbeat_dns_tunneling</p>
<p><span class="strong strong"><strong>Machine learning anomaly threshold</strong></span>: 50</p>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 15 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-45m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/security/current/prebuilt-ml-jobs.html" class="ulink" target="_top">https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Network
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
ML
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4 (<a class="xref" href="application-added-to-google-workspace-domain.html#dns-tunneling-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.7.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>DNS domains that use large numbers of child domains, such as software or content distribution networks, can trigger this alert and such parent domains can be excluded.</p>
<p><a id="dns-tunneling-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 4 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="default-cobalt-strike-team-server-certificate"></a>=== Default Cobalt Strike Team Server Certificate</p>
<p>This rule detects the use of the default Cobalt Strike Team Server TLS certificate. Cobalt Strike is software for Adversary Simulations and Red Team Operations which are security assessments that replicate the tactics and techniques of an advanced adversary in a network. If using Filebeat, this rule requires the Suricata or Zeek modules. Modifications to the Packetbeat configuration can be made to include MD5 and SHA256 hashing algorithms (the default is SHA1) - see the Reference section for additional information on module configuration.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
packetbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: critical</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 99</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://attack.mitre.org/software/S0154/" class="ulink" target="_top">https://attack.mitre.org/software/S0154/</a>
</li>
<li class="listitem">
<a href="https://www.cobaltstrike.com/help-setup-collaboration" class="ulink" target="_top">https://www.cobaltstrike.com/help-setup-collaboration</a>
</li>
<li class="listitem">
<a href="/guide/en/beats/packetbeat/current/configuration-tls.html" class="ulink" target="_top">https://www.elastic.co/guide/en/beats/packetbeat/current/configuration-tls.html</a>
</li>
<li class="listitem">
<a href="/guide/en/beats/filebeat/7.9/filebeat-module-suricata.html" class="ulink" target="_top">https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-module-suricata.html</a>
</li>
<li class="listitem">
<a href="/guide/en/beats/filebeat/7.9/filebeat-module-zeek.html" class="ulink" target="_top">https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-module-zeek.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Command and Control
</li>
<li class="listitem">
Post-Execution
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Elastic
</li>
<li class="listitem">
Network
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#default-cobalt-strike-team-server-certificate-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Investigation guide</p>
<p>While Cobalt Strike is intended to be used for penetration tests and IR training, it is frequently used by actual threat actors (TA) such as APT19, APT29, APT32, APT41, FIN6, DarkHydrus, CopyKittens, Cobalt Group, Leviathan, and many other unnamed criminal TAs. This rule uses high-confidence atomic indicators, alerts should be investigated rapidly.</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:(network or network_traffic) and
(tls.server.hash.md5:950098276A495286EB2A2556FBAB6D83 or
tls.server.hash.sha1:6ECE5ECE4192683D2D84E25B0BA7E04F9CB7EB7C or tls.s
erver.hash.sha256:87F2085C32B6A2CC709B365F55873E207A9CAA10BFFECF2FD16D
3CF9D94D390C)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Control
</li>
<li class="listitem">
ID: TA0011
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0011/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0011/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Application Layer Protocol
</li>
<li class="listitem">
ID: T1071
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1071/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1071/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="default-cobalt-strike-team-server-certificate-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="delete-volume-usn-journal-with-fsutil"></a>=== Delete Volume USN Journal with Fsutil</p>
<p>Identifies use of the <code class="literal">fsutil.exe</code> to delete the <code class="literal">USNJRNL</code> volume. This
technique is used by attackers to eliminate evidence of files created during
post-exploitation activities.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 8 (<a class="xref" href="application-added-to-google-workspace-domain.html#delete-volume-usn-journal-with-fsutil-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:fsutil.exe and process.args:(deletejournal and usn)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Indicator Removal on Host
</li>
<li class="listitem">
ID: T1070
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1070/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1070/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="delete-volume-usn-journal-with-fsutil-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 8 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 7 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Process Create (rule: ProcessCreate)" and
process.name:fsutil.exe and process.args:(deletejournal and usn)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Process Create (rule: ProcessCreate)" and
process.name:"fsutil.exe" and process.args:("usn" and "deletejournal")</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="deleting-backup-catalogs-with-wbadmin"></a>=== Deleting Backup Catalogs with Wbadmin</p>
<p>Identifies use of the <code class="literal">wbadmin.exe</code> to delete the backup catalog. Ransomware and
other malware may do this to prevent system recovery.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 8 (<a class="xref" href="application-added-to-google-workspace-domain.html#deleting-backup-catalogs-with-wbadmin-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:wbadmin.exe and process.args:(catalog and delete)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Indicator Removal on Host
</li>
<li class="listitem">
ID: T1070
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1070/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1070/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="deleting-backup-catalogs-with-wbadmin-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 8 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 7 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Process Create (rule: ProcessCreate)" and
process.name:wbadmin.exe and process.args:(catalog and delete)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Process Create (rule: ProcessCreate)" and
process.name:"wbadmin.exe" and process.args:("delete" and "catalog")</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="direct-outbound-smb-connection"></a>=== Direct Outbound SMB Connection</p>
<p>Identifies unexpected processes making network connections over port 445.
Windows File Sharing is typically implemented over Server Message Block (SMB),
which communicates between hosts using port 445. When legitimate, these network
connections are established by the kernel. Processes making 445/tcp connections
may be port scanners, exploits, or suspicious user-level processes moving
laterally.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Lateral Movement
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 6 (<a class="xref" href="application-added-to-google-workspace-domain.html#direct-outbound-smb-connection-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">sequence by process.entity_id [process where event.type == "start"
and process.pid != 4] [network where destination.port == 445 and
process.pid != 4 and not cidrmatch(destination.ip, "127.0.0.1",
"::1")]</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Lateral Movement
</li>
<li class="listitem">
ID: TA0008
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0008/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0008/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Exploitation of Remote Services
</li>
<li class="listitem">
ID: T1210
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1210/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1210/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="direct-outbound-smb-connection-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 6 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:network and event.type:connection and
destination.port:445 and not process.pid:4 and not
destination.ip:(127.0.0.1 or "::1")</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Network connection detected (rule: NetworkConnect)" and
destination.port:445 and not process.pid:4 and not
destination.ip:(127.0.0.1 or "::1")</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Network connection detected (rule: NetworkConnect)" and
destination.port:445 and not process.pid:4 and not
destination.ip:("127.0.0.1" or "::1")</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="disable-windows-firewall-rules-via-netsh"></a>=== Disable Windows Firewall Rules via Netsh</p>
<p>Identifies use of the <code class="literal">netsh.exe</code> to disable or weaken the local firewall.
Attackers will use this command line tool to disable the firewall during
troubleshooting or to enable network mobility.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 8 (<a class="xref" href="application-added-to-google-workspace-domain.html#disable-windows-firewall-rules-via-netsh-history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.6.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.category:process and event.type:(start or process_started) and
process.name:netsh.exe and process.args:(disable and firewall and set)
or process.args:(advfirewall and off and state)</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="disable-windows-firewall-rules-via-netsh-history"></a>==== Rule version history</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 8 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 7 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 6 (7.11.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 5 (7.10.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 4 (7.9.1 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 3 (7.9.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Process Create (rule: ProcessCreate)" and
process.name:netsh.exe and process.args:(disable and firewall and set)
or process.args:(advfirewall and off and state)</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.7.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Updated query, changed from:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.action:"Process Create (rule: ProcessCreate)" and
process.name:"netsh.exe" and process.args:("firewall" and "set" and
"disable") or process.args:("advfirewall" and "state" and "off")</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><a id="disabling-user-account-control-via-registry-modification"></a>=== Disabling User Account Control via Registry Modification</p>
<p>User Account Control (UAC) can help mitigate the impact of malware on Windows hosts. With UAC, apps and tasks always run in the security context of a non-administrator account, unless an administrator specifically authorizes administrator-level access to the system. This rule identifies registry value changes to bypass User Access Control (UAC) protection.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
logs-windows.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.greyhathacker.net/?p=796" class="ulink" target="_top">https://www.greyhathacker.net/?p=796</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings" class="ulink" target="_top">https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-overview" class="ulink" target="_top">https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-overview</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Privilege Escalation
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Rule query</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">registry where event.type == "change" and registry.path : (
"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\
\EnableLUA", "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion
\\Policies\\System\\ConsentPromptBehaviorAdmin", "HKLM\\SOFTWARE
\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\PromptOnSecure
Desktop" ) and registry.data.strings : "0"</pre>
</div>
<p>==== Threat mapping</p>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Abuse Elevation Control Mechanism
</li>
<li class="listitem">
ID: T1548
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1548/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1548/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Abuse Elevation Control Mechanism
</li>
<li class="listitem">
ID: T1548
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1548/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1548/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><a id="domain-added-to-google-workspace-trusted-domains"></a>=== Domain Added to Google Workspace Trusted Domains</p>
<p>Detects when a domain is added to the list of trusted Google Workspace domains. An adversary may add a trusted domain in order to collect and exfiltrate data from their target’s organization with less restrictive security controls.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-google_workspace*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10 minutes</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-130m (<a href="/guide/en/elasticsearch/reference/7.12/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://support.google.com/a/answer/6160020?hl=en" class="ulink" target="_top">https://support.google.com/a/answer/6160020?hl=en</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Cloud
</li>
<li class="listitem">
Google Workspace
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Configuration Audit
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3 (<a class="xref" href="application-added-to-google-workspace-domain.html#domain-added-to-google-workspace-trusted-domains-history" title="Rule version history">version history</a>)</p>
<p><span class="strong strong"><strong>Added (Elastic Stack release)</strong></span>: 7.11.0</p>
<p><span class="strong strong"><strong>Last modified (Elastic Stack release)</strong></span>: 7.12.0</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>: Elastic</p>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<p>==== Potential false positives</p>
<p>Trusted domains may be added by system administrators. Verify that the configuration change was expected. Exceptions can be added to this rule to filter expected behavior.</p>
<p>==== Investigation guide</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Important Information Regarding Google Workspace Event Lag Times
</li>
</ul>
</div>
</div>
</div>
<div class="pre_wrapper lang-markdown">
<pre class="programlisting prettyprint lang-markdown">## Config

The Google Workspace Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.

### Important Information Regarding Google Workspace Event Lag Times
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 325d4016f... [DOCS] Fix links to filebeat Google Workspace module (#1441)
- As per Google's documentation, Google Workspace administrators may observe lag times ranging from minutes up to 3 days between the time of an event's occurrence and the event being visible in the Google Workspace admin/audit logs.
- This rule is configured to run every 10 minutes with a lookback time of 130 minutes.
- To reduce the risk of false negatives, consider reducing the interval that the Google Workspace (formerly G Suite) Filebeat module polls Google's reporting API for new events.
- By default, `var.interval` is set to 2 hours (2h). Consider changing this interval to a lower value, such as 10 minutes (10m).
- See the following references for further information.
  - https://support.google.com/a/answer/7061566
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
  - https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-gsuite.html
=======
  - https://www.elastic.co/guide/en/beats/filebeat/7.12/filebeat-module-google_workspace.html</pre>
</div>
<p>&gt;&gt;&gt;&gt;&gt;&gt;&gt; 325d4016f&#8230;&#8203; [DOCS] Fix links to filebeat Google Workspace module (#1441)</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_rule_query_45"></a>Rule query<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.12/docs/detections/prebuilt-rules/rule-details/domain-added-to-google-workspace-trusted-domains.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">event.dataset:(gsuite.admin or google_workspace.admin) and
event.provider:admin and event.category:iam and
event.action:ADD_TRUSTED_DOMAINS</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="domain-added-to-google-workspace-trusted-domains-history"></a>Rule version history<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.12/docs/detections/prebuilt-rules/rule-details/domain-added-to-google-workspace-trusted-domains.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Version 3 (7.12.0 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Version 2 (7.11.2 release)
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Formatting only
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="apple-scripting-execution-with-administrator-privileges.html">« Apple Scripting Execution with Administrator Privileges</a>
</span>
<span class="next">
<a href="dumping-account-hashes-via-built-in-commands.html">Dumping Account Hashes via Built-In Commands »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
