<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Create a detection rule | Elastic Security Solution [7.14] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Security Solution [7.14]"/>
<link rel="up" href="detection-engine-overview.html" title="Detections and alerts"/>
<link rel="prev" href="detection-engine-overview.html" title="Detections and alerts"/>
<link rel="next" href="rules-ui-management.html" title="Manage detection rules"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/7.14"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="7.14"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [7.14]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="detection-engine-overview.html">« Detections and alerts</a>
</span>
<span class="next">
<a href="rules-ui-management.html">Manage detection rules »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="rules-ui-create"></a>Create a detection rule<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h2>
</div></div></div>
<p>Rules run periodically and search for source events, matches, sequences, or machine learning job anomaly results
that meet their criteria. When a rule&#8217;s criteria are met, a detection alert is
created.</p>
<p>You can create the following types of rules:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-custom-rule" title="Create a custom query rule"><span class="strong strong"><strong>Custom query</strong></span></a>: Query-based rule, which searches the defined indices and
creates an alert when one or more documents match the rule&#8217;s query.
</li>
<li class="listitem">
<p><a class="xref" href="rules-ui-create.html#create-ml-rule" title="Create a machine learning rule"><span class="strong strong"><strong>Machine learning</a></strong></span>: Machine learning rule, which creates an alert when a machine learning job
discovers an anomaly above the defined threshold (see <a class="xref" href="machine-learning.html" title="Anomaly Detection with Machine Learning">Anomaly Detection with Machine Learning</a>).</p>
<p>For machine learning rules, the associated machine learning job must be running. If the machine learning job is not
running, the rule will:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Run and create alerts if existing anomaly results with scores above the defined threshold
are discovered.
</li>
<li class="listitem">
Issue an error stating the machine learning job was not running when the rule executed.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><a class="xref" href="rules-ui-create.html#create-threshold-rule" title="Create a threshold rule"><span class="strong strong"><strong>Threshold</strong></span></a>: Searches the defined indices and creates a detections alert
when the number of times the specified field&#8217;s value is present and meets the threshold during
a single execution. When multiple values meet the threshold, an alert is
generated for each value.</p>
<p>For example, if the threshold <code class="literal">field</code> is <code class="literal">source.ip</code> and its <code class="literal">value</code> is <code class="literal">10</code>, an
alert is generated for every source IP address that appears in at least 10 of
the rule&#8217;s search results.</p>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-eql-rule" title="Create an event correlation rule"><span class="strong strong"><strong>Event correlation</strong></span></a>: Searches the defined indices and creates an alert when results match an
<a href="/guide/en/elasticsearch/reference/7.14/eql.html" class="ulink" target="_top">Event Query Language (EQL)</a> query.
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-indicator-rule" title="Create an indicator match rule"><span class="strong strong"><strong>Indicator match</strong></span></a>: Creates an alert when Elastic Security index field values match field values defined in the specified indicator index patterns. For example, you can create an indicator index for IP addresses and use this index to create an alert whenever an event&#8217;s <code class="literal">destination.ip</code> equals a value in the index. Indicator index field mappings should be <a href="/guide/en/ecs/1.8" class="ulink" target="_top">ECS-compliant</a>. For information on creating Elasticsearch indices and field types, see
<a href="/guide/en/elasticsearch/reference/7.14/getting-started-index.html" class="ulink" target="_top">Index some documents</a>,
<a href="/guide/en/elasticsearch/reference/7.14/indices-create-index.html" class="ulink" target="_top">Create index API</a>, and
<a href="/guide/en/elasticsearch/reference/7.14/mapping-types.html" class="ulink" target="_top">Field data types</a>. If you have indicators in a standard file format, such as CSV or JSON, you can also use the Machine Learning Data Visualizer to import your indicators into an indicator index. See <a href="/guide/en/machine-learning/7.10/ml-gs-visualizer.html" class="ulink" target="_top">https://www.elastic.co/guide/en/machine-learning/7.10/ml-gs-visualizer.html</a> and use the Import Data option to import your indicators.
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also use value lists as the indicator match index. See <a class="xref" href="rules-ui-create.html#indicator-value-lists" title="Use value lists with indicator match rules">Use value lists with indicator match rules</a> at the end of this topic for more information.</p>
</div>
</div>
<p>When modifying rules or managing detection alerts, you can add exceptions that prevent a rule from generating an alert even when its criteria are met. This is useful for reducing noise, such as preventing alerts from trusted processes and internal IP addresses. <a class="xref" href="detections-ui-exceptions.html" title="Rule exceptions and value lists"><em>Rule exceptions and value lists</em></a> describes how to add exceptions to a rule.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can add exceptions to custom query, machine learning, event correlation, and indicator match rule types.</p>
</div>
</div>
<p>If you are creating a custom query, threshold, or event correlation rule, you can preview the rule beforehand to see what kind of results you can expect. See <a class="xref" href="rules-ui-create.html#preview-rules" title="Preview your rule (optional)">Preview your rule</a> in this topic for more information.</p>
<p>For both prebuilt and custom rules, you can send notifications when alerts are created. Notifications can be sent via
Email, PagerDuty, Slack, and Webhook, and can be configured when you create or
edit a rule.</p>
<p>Creating a new rule requires the following steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-rule-ui" title="Select rule type and scope">Select rule type and scope</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#preview-rules" title="Preview your rule (optional)">Preview your rule (optional)</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">Configure basic rule settings</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-ui-advanced-params" title="Configure advanced rule settings (optional)">Configure advanced rule settings (optional)</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule">Set the rule&#8217;s schedule</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-notifications" title="Set up alert notifications (optional)">Set up alert notifications (optional)</a>
</li>
</ol>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>After you activate a rule, you can periodically check the rule is running as expected
in the <a class="xref" href="alerts-ui-monitor.html" title="Monitor and troubleshoot rule executions">Monitoring tab</a> on the All rules page. If you see
values in the <code class="literal">Gap</code> column, you can <a class="xref" href="alerts-ui-monitor.html#troubleshoot-signals" title="Troubleshoot missing alerts">Troubleshoot missing alerts</a>.</p>
<p>When a rule fails to run, the Elastic Security app tries to rerun it at its next
scheduled run time.</p>
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/all-rules.png" alt="Shows the Rules page">
</div>
</div>
<h3><a id="alerting-authorization-model"></a>Authorization<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>Rules, including all background detection and the actions they generate, are authorized using an <a href="/guide/en/kibana/7.14/api-keys.html" class="ulink" target="_top">API key</a> associated with the last user to edit the rule. Upon creating or modifying a rule, an API key is generated for that user, capturing a snapshot of their privileges. The API key is then used to run all background tasks associated with the rule including detection checks and executing actions.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a rule requires certain privileges to run, such as index privileges, keep in mind that if a user without those privileges updates the rule, the rule will no longer function.</p>
</div>
</div>
<h3><a id="create-rule-ui"></a>Select rule type and scope<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Go to <span class="strong strong"><strong>Detect</strong></span> &#8594; <span class="strong strong"><strong>Rules</strong></span> &#8594; <span class="strong strong"><strong>Create new rule</strong></span>. The <span class="strong strong"><strong>Create new rule</strong></span> page displays.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/create-new-rule.png" alt="create new rule">
</div>
</div>
</li>
<li class="listitem">
<p>Select the type of rule you want to create, then follow the steps outlined in that section:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-ml-rule" title="Create a machine learning rule">Machine learning</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-custom-rule" title="Create a custom query rule">Custom query</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-threshold-rule" title="Create a threshold rule">Threshold</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-eql-rule" title="Create an event correlation rule">Event correlation</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-indicator-rule" title="Create an indicator match rule">Indicator match</a>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h4><a id="create-ml-rule"></a>Create a machine learning rule<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>To create or edit machine learning rules, you must have the <a href="/subscriptions" class="ulink" target="_top">appropriate license</a> or use a
<a href="/cloud/elasticsearch-service/signup?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">cloud deployment</a>. Additionally, you must have the <a href="/guide/en/elasticsearch/reference/7.14/built-in-roles.html" class="ulink" target="_top"><code class="literal">machine_learning_admin</code></a> user
role, and the selected machine learning job must be running for the rule to function correctly.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create a rule based on a machine learning anomaly threshold, select <span class="strong strong"><strong>Machine Learning</strong></span>,
then select:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
The required machine learning job(s).
</li>
<li class="listitem">
The anomaly score threshold above which alerts are created.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Make sure that the machine learning jobs required for the rule are running. If a required machine learning job is not running, an alert is displayed.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Select <span class="strong strong"><strong>ML job settings</strong></span> in the upper-right corner of the page, then search for the required machine learning job.
</li>
<li class="listitem">
<p>Turn on the <span class="strong strong"><strong>Run job</strong></span> switch for the required machine learning job.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/rule-start-ml-job.png" alt="rule start ml job">
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Continue</strong></span>, then proceed with <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configuring basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-custom-rule"></a>Create a custom query rule<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create a rule based on a KQL or Lucene query, select <span class="strong strong"><strong>Custom query</strong></span>,
then:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Define which Elasticsearch indices the rule searches for alerts.
</li>
<li class="listitem">
<p>Use the filter and query fields to create the criteria used for detecting
alerts.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can use Kibana saved queries (save icon) and queries from saved Timelines (<code class="literal">Import query from saved Timeline</code>) as rule conditions.</p>
</div>
</div>
<p>For example, the following rule detects when the <code class="literal">vssadmin delete shadows</code>
Windows command is executed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Index patterns</strong></span>: <code class="literal">winlogbeat-*</code></p>
<div class="quoteblock">
<blockquote>
<p>Winlogbeat ships Windows event logs to Elastic Security.</p>
</blockquote>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Custom query</strong></span>: <code class="literal">event.action:"Process Create (rule: ProcessCreate)" and process.name:"vssadmin.exe" and process.args:("delete" and "shadows")</code></p>
<div class="quoteblock">
<blockquote>
<p>Searches the <code class="literal">winlogbeat-*</code> indices for <code class="literal">vssadmin.exe</code> executions with
the <code class="literal">delete</code> and <code class="literal">shadow</code> arguments, which are used to delete a volume&#8217;s shadow
copies.</p>
</blockquote>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/rule-query-example.png" alt="rule query example">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>This example is based on the
<a class="xref" href="volume-shadow-copy-deletion-via-vssadmin.html" title="Volume Shadow Copy Deletion via VssAdmin">Volume Shadow Copy Deletion via VssAdmin</a> prebuilt rule.</p>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Continue with <a class="xref" href="rules-ui-create.html#preview-rules" title="Preview your rule (optional)">previewing the rule</a> (optional) or click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-threshold-rule"></a>Create a threshold rule<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create a rule based on a source event field threshold, select <span class="strong strong"><strong>Threshold</strong></span>, then:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Define which Elasticsearch indices the rule analyzes for alerts.
</li>
<li class="listitem">
Use the filter and query fields to create the criteria used for detecting
alerts.
</li>
<li class="listitem">
Use the <code class="literal">Group by</code> and <code class="literal">Threshold</code> fields to determine which source event field is used as a threshold and the threshold&#8217;s value.
</li>
<li class="listitem">
<p>Use the <code class="literal">Count</code> field to limit alerts by cardinality of a certain field.</p>
<p>For example, if <code class="literal">Group by</code> is <code class="literal">source.ip</code>, <code class="literal">destination.ip</code> and its <code class="literal">Threshold</code> is <code class="literal">10</code>, an alert is generated for every pair of source and destination IP addresses that appear in at least 10 of the rule&#8217;s search results.</p>
<p>You can also leave the <code class="literal">Group by</code> field undefined. The rule then creates an alert when the number of search results is equal to or greater than the threshold value. If you set <code class="literal">Count</code> to limit the results by <code class="literal">process.name</code> &gt;= 2, an alert will only be generated for source/destination IP pairs that appear with at least 2 unique process names across all events.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Signals created by <span class="strong strong"><strong>threshold</strong></span> rules are synthetic signals that do not resemble the source documents. The signal itself only contains data about the fields that were aggregated over (the <code class="literal">Group by</code> fields). Additionally, the signal contains "lookup" data for retrieving a <span class="strong strong"><strong>Timeline</strong></span> of all of the source events that caused the threshold to be exceeded.
If you wish to create an <a class="xref" href="rules-ui-create.html#rule-notifications" title="Set up alert notifications (optional)"><span class="strong strong"><strong>Action</strong></span></a> based on a threshold rule, you can obtain values of the fields that were aggregated over by entering the following:</p>
<pre class="screen">{{#context.alerts}}
  {{#signal.threshold_result.terms}}
    {{value}}
  {{/signal.threshold_result.terms}}
{{/context.alerts}}</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Continue with <a class="xref" href="rules-ui-create.html#preview-rules" title="Preview your rule (optional)">previewing the rule</a> (optional) or click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-eql-rule"></a>Create an event correlation rule<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create an event correlation rule using EQL, select <span class="strong strong"><strong>Event Correlation</strong></span>, then:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Define which Elasticsearch indices the rule searches for alerts.
</li>
<li class="listitem">
<p>Add an <a href="/guide/en/elasticsearch/reference/7.14/eql-syntax.html" class="ulink" target="_top">EQL statement</a> used to detect alerts.</p>
<p>For example, the following rule detects when <code class="literal">msxsl.exe</code> makes an outbound
network connection:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Index patterns</strong></span>: <code class="literal">winlogbeat-*</code></p>
<div class="quoteblock">
<blockquote>
<p>Winlogbeat ships Windows events to Elastic Security.</p>
</blockquote>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>EQL query</strong></span>:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">sequence by process.entity_id
  [process
    where event.type in ("start", "process_started")
    and process.name == "msxsl.exe"]
  [network
    where event.type == "connection"
    and process.name == "msxsl.exe"
    and network.direction == "outgoing"]</pre>
</div>
<p>Searches the <code class="literal">winlogbeat-*</code> indices for sequences of a <code class="literal">msxsl.exe</code> process start
event followed by an outbound network connection event that was started by the
<code class="literal">msxsl.exe</code> process.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/eql-rule-query-example.png" alt="eql rule query example">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For sequence events, the Elastic Security app generates a single alert when all events listed in the sequence are detected. To see the matched sequence events in more detail, you can view the alert in the Timeline, and, if all events came from the same process, open the alert in Analyze Event view.</p>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Continue with <a class="xref" href="rules-ui-create.html#preview-rules" title="Preview your rule (optional)">previewing the rule</a> (optional) or click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-indicator-rule"></a>Create an indicator match rule<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elastic Security provides limited support for indicator match rules. See <a class="xref" href="detection-engine-overview.html#support-indicator-rules" title="Limited support for indicator match rules">Limited support for indicator match rules</a> for more information.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create an indicator match rule that searches for events whose specified field value matches the specified indicator field value in the indicator index patterns, select <span class="strong strong"><strong>Indicator Match</strong></span>, then fill in the following fields:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Index patterns</strong></span>: The Elastic Security event indices on which the rule runs.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Custom query</strong></span>: The query and filters used to retrieve the required results from
the Elastic Security event indices. For example, if you want to match documents that only contain a <code class="literal">destination.ip</code> address field, add <code class="literal">destination.ip : *</code>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you want the rule to check every field in the indices, use this
wildcard expression: <code class="literal">*:*</code>.</p>
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator index patterns</strong></span>: The indicator index patterns containing field values for which you want to generate alerts. This field is automatically populated with indices specified in the <code class="literal">securitySolution:defaultThreatIndex</code> advanced setting. For more information, see <a class="xref" href="advanced-settings.html#update-threat-intel-indices" title="Update default Elastic Security threat intelligence indices">Update default Elastic Security threat intelligence indices</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Data in indicator indices must be <a class="xref" href="es-overview.html#ecs-compliant-reqs" title="ECS compliance data requirements">ECS compatible</a>, and so it must contain a <code class="literal">@timestamp</code> field.</p>
</div>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator index query</strong></span>: The query and filters used to filter the fields from
the indicator index patterns.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator mapping</strong></span>: Compares the values of the specified event and indicator field
values. When the field values are identical, an alert is generated. To define
which field values are compared from the indices add the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Field</strong></span>: The field used for comparing values in the Elastic Security event
indices.
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator index field</strong></span>: The field used for comparing values in the indicator
indices.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>You can add <code class="literal">AND</code> and <code class="literal">OR</code> clauses to define when alerts are generated.</p>
<p>For example, to create a rule that generates alerts when <code class="literal">host.name</code> <span class="strong strong"><strong>and</strong></span>
<code class="literal">destination.ip</code> field values in the <code class="literal">logs-*</code> or <code class="literal">packetbeat-*</code> Elastic Security indices
are identical to the corresponding field values in the <code class="literal">mock-threat-list</code> indicator
index, enter the rule parameters seen in the following image:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/indicator-rule-example.png" alt="indicator rule example">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Before you create rules, create <a class="xref" href="timelines-ui.html" title="Investigate events in Timeline">Timeline templates</a> so
they can be selected here. When alerts generated by the rule are investigated
in the Timeline, Timeline query values are replaced with their corresponding alert
field values.</p>
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Continue with <a class="xref" href="rules-ui-create.html#preview-rules" title="Preview your rule (optional)">previewing the rule</a> (optional) or click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h3><a id="preview-rules"></a>Preview your rule (optional)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>You can preview a custom query, threshold, or event correlation rule to get feedback on how noisy the rule will be before submitting it. You can then fine-tune the query, if needed, to reduce the number of alerts that may come in.</p>
<p>To preview a rule:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Write the rule query.
</li>
<li class="listitem">
Select a timeframe of data to preview query results&#8201;&#8212;&#8201;<span class="strong strong"><strong>Last hour</strong></span>, <span class="strong strong"><strong>Last day</strong></span>, or <span class="strong strong"><strong>Last month</strong></span>&#8201;&#8212;&#8201;from the <span class="strong strong"><strong>Quick query preview</strong></span> drop-down.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Preview results</strong></span>. A histogram shows the number of alerts you can expect based on the defined rule parameters and historical events in your indices.
</li>
</ol>
</div>
<p>A "noise warning" is displayed if the preview generates more than one alert per hour.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/preview-rule.png" alt="preview rule">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The preview excludes the effects of rule exceptions and timestamp overrides.</p>
</div>
</div>
<h3><a id="rule-ui-basic-params"></a>Configure basic rule settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In the <span class="strong strong"><strong>About rule</strong></span> pane, fill in the following fields:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Name</strong></span>: The rule&#8217;s name.
</li>
<li class="listitem">
<span class="strong strong"><strong>Description</strong></span>: A description of what the rule does.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Default severity</strong></span>: Select the severity level of alerts created by the rule:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Low</strong></span>: Alerts that are of interest but generally are not considered to be
security incidents. Sometimes a combination of low severity alerts can
indicate suspicious activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Medium</strong></span>: Alerts that require investigation.
</li>
<li class="listitem">
<span class="strong strong"><strong>High</strong></span>: Alerts that require an immediate investigation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Critical</strong></span>: Alerts that indicate it is highly likely a security incident has
occurred.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Severity override</strong></span> (optional): Select to use source event values to
override the <span class="strong strong"><strong>Default severity</strong></span> in generated alerts. When selected, a UI
component is displayed where you can map the source event field values to
severity levels. The following example shows how to map severity levels to <code class="literal">host.name</code>
values:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/severity-mapping-ui.png" alt="severity mapping ui">
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Default risk score</strong></span>: A numerical value between 0 and 100 that correlates
with the <span class="strong strong"><strong>Severity</strong></span> level. General guidelines are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">0</code> - <code class="literal">21</code> represents low severity.
</li>
<li class="listitem">
<code class="literal">22</code> - <code class="literal">47</code> represents medium severity.
</li>
<li class="listitem">
<code class="literal">48</code> - <code class="literal">73</code> represents high severity.
</li>
<li class="listitem">
<code class="literal">74</code> - <code class="literal">100</code> represents critical severity.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Risk score override</strong></span> (optional): Select to use a source event value to
override the <span class="strong strong"><strong>Default risk score</strong></span> in generated alerts. When selected, a UI
component is displayed to select the source field used for the risk
score. For example, if you want to use the source event&#8217;s risk score in
alerts:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/risk-source-field-ui.png" alt="risk source field ui">
</div>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>Tags</strong></span> (optional): Words and phrases used to categorize, filter, and search
the rule.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Continue with <span class="strong strong"><strong>one</strong></span> of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-ui-advanced-params" title="Configure advanced rule settings (optional)">Configure advanced rule settings (optional)</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule">Set the rule&#8217;s schedule</a>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h3><a id="rule-ui-advanced-params"></a>Configure advanced rule settings (optional)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Click <span class="strong strong"><strong>Advanced settings</strong></span> and fill in the following fields where applicable:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Reference URLs</strong></span> (optional): References to information that is relevant to
the rule. For example, links to background information.
</li>
<li class="listitem">
<span class="strong strong"><strong>False positive examples</strong></span> (optional): List of common scenarios that may produce
false-positive alerts.
</li>
<li class="listitem">
<span class="strong strong"><strong>MITRE ATT&amp;CK<sup>TM</sup> threats</strong></span> (optional): Add relevant <a href="https://attack.mitre.org/" class="ulink" target="_top">MITRE</a> framework tactics, techniques, and subtechniques.
</li>
<li class="listitem">
<span class="strong strong"><strong>Investigation guide</strong></span> (optional): Information for analysts investigating
alerts created by the rule.
</li>
<li class="listitem">
<span class="strong strong"><strong>Author</strong></span> (optional): The rule&#8217;s authors.
</li>
<li class="listitem">
<span class="strong strong"><strong>License</strong></span> (optional): The rule&#8217;s license.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Elastic endpoint exceptions</strong></span> (optional): Adds all Elastic Endpoint Security
rule exceptions to this rule (see <a class="xref" href="detections-ui-exceptions.html" title="Rule exceptions and value lists"><em>Rule exceptions and value lists</em></a>).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you select this option, you can add
<a class="xref" href="detections-ui-exceptions.html#endpoint-rule-exceptions" title="Add Elastic Endpoint Security exceptions">Endpoint exceptions</a> on the Rule details page.
Additionally, all future exceptions added to the Elastic Endpoint Security rule
also affect this rule.</p>
</div>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>Building block</strong></span> (optional): Select to create a building-block rule. By
default, alerts generated from a building-block rule are not displayed in the
UI. See <a class="xref" href="building-block-rule.html" title="About building block rules"><em>About building block rules</em></a> for more information.
</li>
<li class="listitem">
<span class="strong strong"><strong>Rule name override</strong></span> (optional): Select a source event field to use as the
rule name in the UI (Alerts table). This is useful for exposing, at a glance,
more information about an alert. For example, if the rule generates alerts from
Suricata, selecting <code class="literal">event.action</code> lets you see what action (Suricata category)
caused the event directly in the Alerts table.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Timestamp override</strong></span> (optional): Select a source event timestamp field. When selected, the rule&#8217;s query uses the selected field, instead of the default <code class="literal">@timestamp</code> field, to search for alerts. This can help reduce missing alerts due to network or server outages. Specifically, if your ingest pipeline adds a timestamp when events are sent to Elasticsearch, this avoids missing alerts due to ingestion delays.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>These Filebeat modules have an <code class="literal">event.ingested</code> timestamp field that can
be used instead of the default <code class="literal">@timestamp</code> field:
<a href="/guide/en/beats/filebeat/7.14/filebeat-module-microsoft.html" class="ulink" target="_top">Microsoft</a> and
<a href="/guide/en/beats/filebeat/7.14/filebeat-module-google_workspace.html" class="ulink" target="_top">Google Workspace</a>.</p>
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Continue</strong></span>. The <span class="strong strong"><strong>Schedule rule</strong></span> pane is displayed.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/schedule-rule.png" alt="schedule rule">
</div>
</div>
</li>
<li class="listitem">
Continue with <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule">setting the rule&#8217;s schedule</a>.
</li>
</ol>
</div>
<h3><a id="rule-schedule"></a>Set the rule&#8217;s schedule<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Select how often the rule runs.
</li>
<li class="listitem">
<p>Optionally, add <code class="literal">Additional look-back time</code> to the rule. When defined, the
rule searches indices with the additional time.</p>
<p>For example, if you set a rule to run every 5 minutes with an additional
look-back time of 1 minute, the rule runs every 5 minutes but analyzes the
documents added to indices during the last 6 minutes.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is recommended to set the <code class="literal">Additional look-back time</code> to at
least 1 minute. This ensures there are no missing alerts when a rule does not
run exactly at its scheduled time.</p>
<p>The Elastic Security app prevents duplication. Any duplicate alerts that are discovered during the
<code class="literal">Additional look-back time</code> are <span class="strong strong"><strong>not</strong></span> created.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Continue</strong></span>. The <span class="strong strong"><strong>Rule actions</strong></span> pane is displayed.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/rule-actions.png" alt="rule actions">
</div>
</div>
</li>
<li class="listitem">
<p>Do <span class="strong strong"><strong>one</strong></span> of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Continue with <a class="xref" href="rules-ui-create.html#rule-notifications" title="Set up alert notifications (optional)">setting up alert notifications</a> (optional).
</li>
<li class="listitem">
Create the rule (with or without activation).
</li>
</ul>
</div>
</li>
</ol>
</div>
<h3><a id="rule-notifications"></a>Set up alert notifications (optional)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>Use Kibana Actions to set up notifications sent via other systems when alerts
are generated.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To use Kibana Actions for alert notifications, you need the
<a href="/subscriptions" class="ulink" target="_top">appropriate license</a> and your role needs <span class="strong strong"><strong>All</strong></span> privileges for the <span class="strong strong"><strong>Action and Connectors</strong></span> feature. For more information, see <a class="xref" href="case-permissions.html" title="Cases prerequisites">Cases prerequisites</a>.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Set when to send notifications:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>On each rule execution</strong></span>: Sends a notification every time new alerts are
generated.
</li>
<li class="listitem">
<span class="strong strong"><strong>Hourly</strong></span>: Sends a notification every hour.
</li>
<li class="listitem">
<span class="strong strong"><strong>Daily</strong></span>: Sends a notification every day.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Weekly</strong></span>: Sends a notification every week.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Notifications are sent only when new alerts are generated.</p>
</div>
</div>
<p>The available connector types are displayed.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/available-action-types.png" alt="available action types">
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Select the required connector type, which determines how notifications are sent. For example, if you select the Jira connector, notifications are sent to your Jira system.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Each action type requires a connector. Connectors store the
information required to send the notification from the external system. You can
configure connectors while creating the rule or on the Kibana Rules and Connectors
page (<span class="strong strong"><strong>Stack Management</strong></span> &#8594; <span class="strong strong"><strong>Rules and Connectors</strong></span>). For more
information, see <a href="/guide/en/kibana/7.14/action-types.html" class="ulink" target="_top">Action and connector types</a>.</p>
</div>
</div>
<p>The selected connector type fields are displayed (Jira example).</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/selected-action-type.png" alt="selected action type">
</div>
</div>
</li>
<li class="listitem">
Fill in the fields for the selected connector types. For all connector types, click
the icon above the <code class="literal">Message</code> field to add
<a class="xref" href="rules-ui-create.html#rule-action-variables" title="Alert notification placeholders">placeholders</a> for rule and alert details to the
notifications.
</li>
<li class="listitem">
<p>Create the rule with or without activation.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you activate a rule, it is queued, and its schedule is determined by
its initial run time. For example, if you activate a rule that runs every 5
minutes at 14:03 but it does not run until 14:04, it will run again at 14:09.</p>
</div>
</div>
</li>
</ol>
</div>
<h4><a id="rule-action-variables"></a>Alert notification placeholders<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<p>You can use <a href="http://mustache.github.io/" class="ulink" target="_top">mustache syntax</a> to add the following placeholders to <a class="xref" href="rules-ui-create.html#rule-notifications" title="Set up alert notifications (optional)">rule action</a> fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">{{alert.actionGroup}}</code>: Action group of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.actionGroupName}}</code>: Human readable name of the action group of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.actionSubgroup}}</code>: Action subgroup of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.id}}</code>: ID of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{context.alerts}}</code>: Array of detected alerts
</li>
<li class="listitem">
<code class="literal">{{{context.results_link}}}</code>: URL to the alerts in Kibana
</li>
<li class="listitem">
<code class="literal">{{context.rule.anomaly_threshold}}</code>: Anomaly threshold score above which
alerts are generated (machine learning rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.description}}</code>: Rule description
</li>
<li class="listitem">
<code class="literal">{{context.rule.false_positives}}</code>: Rule false positives
</li>
<li class="listitem">
<code class="literal">{{context.rule.filters}}</code>: Rule filters (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.id}}</code>: Unique rule ID returned after creating the rule
</li>
<li class="listitem">
<code class="literal">{{context.rule.index}}</code>: Indices rule runs on (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.language}}</code>: Rule query language (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.machine_learning_job_id}}</code>: ID of associated machine learning job (machine learning
rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.max_signals}}</code>: Maximum allowed number of alerts per rule
execution
</li>
<li class="listitem">
<code class="literal">{{context.rule.name}}</code>: Rule name
</li>
<li class="listitem">
<code class="literal">{{context.rule.output_index}}</code>: Index to which alerts are written
</li>
<li class="listitem">
<code class="literal">{{context.rule.query}}</code>: Rule query (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.references}}</code>: Rule references
</li>
<li class="listitem">
<code class="literal">{{context.rule.risk_score}}</code>: Default rule risk score
</li>
<li class="listitem">
<code class="literal">{{context.rule.rule_id}}</code>: Generated or user-defined rule ID that can be
used as an identifier across systems
</li>
<li class="listitem">
<code class="literal">{{context.rule.saved_id}}</code>: Saved search ID
</li>
<li class="listitem">
<code class="literal">{{context.rule.severity}}</code>: Default rule severity
</li>
<li class="listitem">
<code class="literal">{{context.rule.threat}}</code>: Rule threat framework
</li>
<li class="listitem">
<code class="literal">{{context.rule.threshold}}</code>: Rule threshold values (threshold rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.timeline_id}}</code>: Associated Timeline ID
</li>
<li class="listitem">
<code class="literal">{{context.rule.timeline_title}}</code>: Associated Timeline name
</li>
<li class="listitem">
<code class="literal">{{context.rule.type}}</code>: Rule type
</li>
<li class="listitem">
<code class="literal">{{context.rule.version}}</code>: Rule version
</li>
<li class="listitem">
<code class="literal">{{date}}`</code>: Date the rule scheduled the action
</li>
<li class="listitem">
<code class="literal">{{kibanaBaseUrl}}</code>: Configured <code class="literal">server.publicBaseUrl</code> value, or empty string if not configured
</li>
<li class="listitem">
<code class="literal">{{rule.id}}</code>: ID of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.name}}</code>: Name of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.spaceId}}</code>: Space ID of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.tags}}</code>: Tags of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.type}}</code>: Type of rule
</li>
<li class="listitem">
<code class="literal">{{state.signals_count}}</code>: Number of alerts detected
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">{{context.rule.severity}}</code> and <code class="literal">{{context.rule.risk_score}}</code>
placeholders contain the rule&#8217;s default values even when the <span class="strong strong"><strong>Severity override</strong></span>
and <span class="strong strong"><strong>Risk score override</strong></span> options are used.</p>
</div>
</div>
<h5><a id="placeholder-examples"></a>Alert placeholder examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h5>
<p>To understand which fields to parse, see the <a class="xref" href="rule-api-overview.html" title="Detections API"><em>Detections API</em></a> to view the JSON representation of rules.</p>
<p>Example using <code class="literal">{{context.rule.filters}}</code> to output a list of filters:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{{#context.rule.filters}}
{{^meta.disabled}}{{meta.key}} {{#meta.negate}}NOT {{/meta.negate}}{{meta.type}} {{^exists}}{{meta.value}}{{meta.params.query}}{{/exists}}{{/meta.disabled}}
{{/context.rule.filters}}</pre>
</div>
<p>Example using <code class="literal">{{context.alerts}}</code> as an array, which contains each alert generated since the last time the action was executed:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{{#context.alerts}}
Detection alert for user: {{user.name}}
{{/context.alerts}}</pre>
</div>
<p>Example using the mustache "current element" notation <code class="literal">{{.}}</code> to output all the rule references in the <code class="literal">signal.rule.references</code> array:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{{#signal.rule.references}} {{.}} {{/signal.rule.references}}</pre>
</div>
<h4><a id="indicator-value-lists"></a>Use value lists with indicator match rules<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/7.14/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<p>While there are numerous ways you can add data into indicator indices, you can use value lists as the indicator match index in an indicator match rule. Take the following scenario, for example:</p>
<p>You uploaded a value list of known ransomware domains, and you want to be notified if any of those domains matches a value contained in a domain field in your security event index pattern.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Upload a value list of indicators.
</li>
<li class="listitem">
<p>Create an indicator match rule and fill in the following fields:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Index patterns</strong></span>: The Elastic Security event indices on which the rule runs.
</li>
<li class="listitem">
<span class="strong strong"><strong>Custom query</strong></span>: The query and filters used to retrieve the required results from the Elastic Security event indices (e.g., <code class="literal">host.domain :*</code>).
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator index patterns</strong></span>: Value lists are stored in a hidden index called <code class="literal">.items-&lt;Kibana space&gt;</code>. Enter the name of the Kibana space in which this rule will run in this field.
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator index query</strong></span>: Enter the value <code class="literal">list_id :</code>, followed by the name of the value list you want to use as your indicator index (uploaded in Step 1 above).
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator mapping</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Field</strong></span>: Enter the field from the Elastic Security event indices to be used for comparing values.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator index field</strong></span>: Enter the type of value list you created (i.e., <code class="literal">keyword</code>, <code class="literal">text</code>, or <code class="literal">IP</code>).</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you don&#8217;t remember this information, go to <span class="strong strong"><strong>Detect</strong></span> &#8594; <span class="strong strong"><strong>Rules &gt; Upload value lists</strong></span>. Locate the appropriate value list and note the field in the corresponding <code class="literal">Type</code> column. (Examples include keyword, text, and IP.)</p>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/indicator_value_list.png" alt="indicator value list">
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="detection-engine-overview.html">« Detections and alerts</a>
</span>
<span class="next">
<a href="rules-ui-management.html">Manage detection rules »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
