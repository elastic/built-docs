<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Create rule | Elastic Security Solution [master] | Elastic</title>
<meta class="elastic" name="content" content="Create rule | Elastic Security Solution [master]">

<link rel="home" href="index.html" title="Elastic Security Solution [master]"/>
<link rel="up" href="rule-api-overview.html" title="Detections API"/>
<link rel="prev" href="rule-api-overview.html" title="Detections API"/>
<link rel="next" href="rules-api-get.html" title="Get rule"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/master"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="rule-api-overview.html">« Detections API</a>
</span>
<span class="next">
<a href="rules-api-get.html">Get rule »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="security-apis.html">Elastic Security APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rule-api-overview.html">Detections API</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Create rule</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="rules-api-create"></a>Create rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>When used with <a href="/guide/en/kibana/master/api-keys.html" class="ulink" target="_top">API key</a> authentication, the user&#8217;s key gets assigned to the affected rules. If the user&#8217;s key gets deleted or the user becomes inactive, the rules will stop running.</p>
<p>If the API key that is used for authorization has different privileges than the key that created or most recently updated the rule, the rule behavior might change.</p>
</div>
</div>
<p>Creates a new detection rule.</p>
<p>You can create the following types of rules:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Custom query</strong></span>: Searches the defined indices and creates an alert when
a document matches the rule&#8217;s KQL query.
</li>
<li class="listitem">
<span class="strong strong"><strong>Event correlation</strong></span>: Searches the defined indices and creates an alert when results match an
<a href="/guide/en/elasticsearch/reference/master/eql.html" class="ulink" target="_top">Event Query Language (EQL)</a> query.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Threshold</strong></span>: Searches the defined indices and creates an alert when the
number of times the specified field&#8217;s value meets the threshold during a single
execution. When there are multiple values that meet the threshold, an alert is
generated for each value.</p>
<p>For example, if the threshold <code class="literal">field</code> is <code class="literal">source.ip</code> and its <code class="literal">value</code> is <code class="literal">10</code>, an
alert is generated for every source IP address that appears in at least 10 of
the rule&#8217;s search results. If you&#8217;re interested, see
<a href="/guide/en/elasticsearch/reference/master/search-aggregations-bucket-terms-aggregation.html" class="ulink" target="_top">Terms Aggregation</a> for
more information.</p>
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator match</strong></span>: Creates an alert when fields match values defined in the
specified <a href="/guide/en/elasticsearch/reference/master/indices-create-index.html" class="ulink" target="_top">Elasticsearch index</a>. For example, you can
create an index for IP addresses and use this index to create an alert whenever
an event&#8217;s <code class="literal">destination.ip</code> equals a value in the index. The index&#8217;s field
mappings should be <a href="/guide/en/ecs/8.11" class="ulink" target="_top">ECS-compliant</a>.
</li>
<li class="listitem">
<span class="strong strong"><strong>New terms</strong></span>: Generates an alert for each new term detected in source documents within a specified time range.
</li>
<li class="listitem">
<span class="strong strong"><strong>ES|QL</strong></span>: Uses <a href="/guide/en/elasticsearch/reference/master/esql.html" class="ulink" target="_top">Elasticsearch Query Language (ES|QL)</a> to find events and aggregate search results.
</li>
<li class="listitem">
<span class="strong strong"><strong>Machine learning rules</strong></span>: Creates an alert when a machine learning job discovers an anomaly above
the defined threshold (see <a class="xref" href="machine-learning.html" title="Anomaly detection">Anomaly detection</a>).
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>To create machine learning rules, you must have the
<a href="/subscriptions" class="ulink" target="_top">appropriate license</a> or use a
<a href="/cloud/elasticsearch-service/signup?page=docs&amp;placement=docs-body" class="ulink" target="_top">cloud deployment</a>. Additionally, for the machine learning rule to function
correctly, the associated machine learning job must be running.</p>
</div>
</div>
<p>To retrieve machine learning job IDs, which are required to create machine learning jobs, call the
<a href="/guide/en/elasticsearch/reference/master/ml-get-job.html" class="ulink" target="_top">Elasticsearch Get jobs API</a>. Machine learning jobs that contain <code class="literal">siem</code> in
the <code class="literal">groups</code> field can be used to create rules:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">...
"job_id": "linux_anomalous_network_activity_ecs",
"job_type": "anomaly_detector",
"job_version": "7.7.0",
"groups": [
  "auditbeat",
  "process",
  "siem"
],
...</pre>
</div>
<p>Additionally, you can set up notifications for when rules create alerts. The
notifications use the Kibana <a href="/guide/en/kibana/master/alerting-getting-started.html" class="ulink" target="_top">Alerting and Actions framework</a>.
Each action type requires a connector. Connectors store the information
required to send notifications via external systems. The following connector types are
supported for rule notifications:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Slack
</li>
<li class="listitem">
Email
</li>
<li class="listitem">
PagerDuty
</li>
<li class="listitem">
Webhook
</li>
<li class="listitem">
Microsoft Teams
</li>
<li class="listitem">
IBM Resilient
</li>
<li class="listitem">
Jira
</li>
<li class="listitem">
ServiceNow ITSM
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For more information on PagerDuty fields, see
<a href="https://developer.pagerduty.com/docs/events-api-v2/trigger-events/" class="ulink" target="_top">Send a v2 Event</a>.</p>
</div>
</div>
<p>To retrieve connector IDs, which are required to configure rule notifications,
call the Kibana <a href="/guide/en/kibana/master/saved-objects-api-find.html" class="ulink" target="_top">Find objects API</a> with
<code class="literal">"type": "action"</code> in the request payload.</p>
<p>For detailed information on Kibana actions and alerting, and additional API
calls, see:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/kibana/tree/main/x-pack/plugins/alerting" class="ulink" target="_top">https://github.com/elastic/kibana/tree/main/x-pack/plugins/alerting</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/kibana/tree/main/x-pack/plugins/actions" class="ulink" target="_top">https://github.com/elastic/kibana/tree/main/x-pack/plugins/actions</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_request_url"></a>Request URL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST &lt;kibana host&gt;:&lt;port&gt;/api/detection_engine/rules</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_request_body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h3>
</div></div></div>
<p>A JSON object that defines the rule&#8217;s values:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="rules-api-create.html#ref-fields-all" title="Required fields for all rule types">Required fields for all rule types</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#req-fields-query-threshold" title="Required fields for query, indicator match, threshold, new terms, event correlation, and ES|QL rules">Required fields for query, indicator match, threshold, new terms, event correlation, and ES|QL rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#req-fields-threshold" title="Required field for threshold rules">Required field for threshold rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#req-fields-saved-query" title="Required field for saved query rules">Required field for saved query rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#req-fields-eql" title="Required field for event correlation rules">Required field for event correlation rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#req-fields-ml" title="Required fields for machine learning rules">Required fields for machine learning rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#req-fields-threat-match" title="Required fields for indicator match rules">Required fields for indicator match rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#req-fields-new-terms" title="Required fields for new terms rules">Required fields for new terms rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#req-fields-esql" title="Required field for ES|QL rules">Required field for ES|QL rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#opt-fields-all" title="Optional fields for all rule types">Optional fields for all rule types</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#opt-fields-threat-match" title="Optional fields for indicator match rules">Optional fields for indicator match rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#opt-fields-query-threshold" title="Optional fields for query, indicator match, threshold, and new terms rules">Optional fields for query, indicator match, threshold, and new terms rules</a>
</li>
<li class="listitem">
<a class="xref" href="rules-api-create.html#opt-fields-eql-query-threshold" title="Optional fields for event correlation, query, threshold, indicator match, new terms, and ES|QL rules">Optional fields for event correlation, query, threshold, indicator match, new terms, and ES|QL rules</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ref-fields-all"></a>Required fields for all rule types<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>description</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>The rule&#8217;s description.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>name</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>The rule&#8217;s name.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>risk_score</p></td>
<td align="left" valign="top"><p>Integer</p></td>
<td align="left" valign="top">
<p>A numerical representation of the alert&#8217;s severity from
0 to 100, where:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">0</code> - <code class="literal">21</code> represents low severity
</li>
<li class="listitem">
<code class="literal">22</code> - <code class="literal">47</code> represents medium severity
</li>
<li class="listitem">
<code class="literal">48</code> - <code class="literal">73</code> represents high severity
</li>
<li class="listitem">
<code class="literal">74</code> - <code class="literal">100</code> represents critical severity
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>severity</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top">
<p>Severity level of alerts produced by the rule, which must
be one of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">low</code>: Alerts that are of interest but generally not considered to be
security incidents
</li>
<li class="listitem">
<code class="literal">medium</code>: Alerts that require investigation
</li>
<li class="listitem">
<code class="literal">high</code>: Alerts that require immediate investigation
</li>
<li class="listitem">
<code class="literal">critical</code>: Alerts that indicate it is highly likely a security incident has
occurred
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>type</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top">
<p>Data type on which the rule is based:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">eql</code>: EQL query (see <a href="/guide/en/elasticsearch/reference/master/eql.html" class="ulink" target="_top">Event Query Language</a>).
</li>
<li class="listitem">
<code class="literal">esql</code>: ES|QL query (see <a href="/guide/en/elasticsearch/reference/master/esql.html" class="ulink" target="_top">Elasticsearch Query Language</a>).
</li>
<li class="listitem">
<code class="literal">query</code>: query with or without additional filters.
</li>
<li class="listitem">
<code class="literal">saved_query</code>: saved search, identified in the <code class="literal">saved_id</code> field.
</li>
<li class="listitem">
<code class="literal">machine_learning</code>: rule based on a machine learning job&#8217;s anomaly scores.
</li>
<li class="listitem">
<code class="literal">threat_match</code>: rule that matches event values with values in the specified
Elasticsearch index.
</li>
<li class="listitem">
<code class="literal">threshold</code>: rule based on the number of times a <code class="literal">query</code> matches the
specified field.
</li>
<li class="listitem">
<code class="literal">new_terms</code>: rule that alerts on values that have not been seen before
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="req-fields-query-threshold"></a>Required fields for query, indicator match, threshold, new terms, event correlation, and ES|QL rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>query</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top">
<p><a href="/guide/en/kibana/master/search.html" class="ulink" target="_top">Query</a> used by the rule to create
alerts.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For indicator match rules, only the query&#8217;s results are used to determine
whether an alert is generated.
</li>
<li class="listitem">
ES|QL rules have additional query requirements. Refer to <a class="xref" href="rules-ui-create.html#create-esql-rule" title="Create an ES|QL rule">Create ES|QL rules</a> for more information.
</li>
</ul>
</div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="req-fields-threshold"></a>Required field for threshold rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>threshold</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Defines the field and threshold value for when alerts
are generated, where:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">cardinality</code> (Array of length 1): The field on which the cardinality is applied.
</li>
<li class="listitem">
<code class="literal">cardinality.field</code> (string, required): The field on which to calculate and compare the
cardinality.
</li>
<li class="listitem">
<code class="literal">cardinality.value</code> (integer, required): The threshold value from which an alert is
generated based on unique number of values of <code class="literal">cardinality.field</code>.
</li>
<li class="listitem">
<code class="literal">field</code> (string or string[], required): The field on which the threshold is applied. If
you specify an empty array (<code class="literal">[]</code>), alerts are generated when the query returns
at least the number of results specified in the <code class="literal">value</code> field.
</li>
<li class="listitem">
<code class="literal">value</code> (integer, required): The threshold value from which an alert is
generated.
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="req-fields-saved-query"></a>Required field for saved query rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>saved_id</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Kibana saved search used by the rule to create alerts.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="req-fields-eql"></a>Required field for event correlation rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>language</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Must be <code class="literal">eql</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="req-fields-esql"></a>Required field for ES|QL rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>language</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Must be <code class="literal">esql</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="req-fields-ml"></a>Required fields for machine learning rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>anomaly_threshold</p></td>
<td align="left" valign="top"><p>Integer</p></td>
<td align="left" valign="top"><p>Anomaly score threshold above which the rule
creates an alert. Valid values are from <code class="literal">0</code> to <code class="literal">100</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>machine_learning_job_id</p></td>
<td align="left" valign="top"><p>String[]</p></td>
<td align="left" valign="top"><p>Machine learning job ID(s) the rule monitors for
anomaly scores.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="req-fields-threat-match"></a>Required fields for indicator match rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>threat_index</p></td>
<td align="left" valign="top"><p>String[]</p></td>
<td align="left" valign="top"><p>Elasticsearch indices used to check which field values generate
alerts.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>threat_query</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Query used to determine which fields in the Elasticsearch index
are used for generating alerts.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>threat_mapping</p></td>
<td align="left" valign="top"><p>Object[]</p></td>
<td align="left" valign="top">
<p>Array of <code class="literal">entries</code> objects that define mappings
between the source event fields and the values in the Elasticsearch threat index. Each
<code class="literal">entries</code> object must contain these fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field</code>: field from the event indices on which the rule runs
</li>
<li class="listitem">
<code class="literal">type</code>: must be <code class="literal">mapping</code>
</li>
<li class="listitem">
<code class="literal">value</code>: field from the Elasticsearch threat index
</li>
</ul>
</div>
<p>You can use Boolean <code class="literal">and</code> and <code class="literal">or</code> logic to define the conditions for when
matching fields and values generate alerts. Sibling <code class="literal">entries</code> objects
are evaluated using <code class="literal">or</code> logic, whereas multiple entries in a single <code class="literal">entries</code>
object use <code class="literal">and</code> logic. See <a class="xref" href="rules-api-create.html#threat-match-example">below</a> for an example that
uses both <code class="literal">and</code> and <code class="literal">or</code> logic.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="req-fields-new-terms"></a>Required fields for new terms rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>new_terms_fields</p></td>
<td align="left" valign="top"><p>String[]</p></td>
<td align="left" valign="top"><p>Fields to monitor for new values. Must contain 1–3 field names.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>history_window_start</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Start date to use when checking if a term has been seen before.
Supports relative dates – for example, <code class="literal">now-30d</code> will search the last 30 days of data when checking if a term
is new. We do not recommend using absolute dates, which can cause issues with rule performance
due to querying increasing amounts of data over time.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="opt-fields-all"></a>Optional fields for all rule types<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>actions</p></td>
<td align="left" valign="top"><p><a class="xref" href="rules-api-create.html#actions-object-schema" title="actions schema">actions[]</a></p></td>
<td align="left" valign="top"><p>Array defining the automated
actions (notifications) taken when alerts are generated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>author</p></td>
<td align="left" valign="top"><p>String[]</p></td>
<td align="left" valign="top"><p>The rule&#8217;s author.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>building_block_type</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Determines if the rule acts as a building block.
By default, building-block alerts are not displayed in the UI. These rules are
used as a foundation for other rules that do generate alerts. Its value must be
<code class="literal">default</code>. For more information, refer to <a class="xref" href="building-block-rule.html" title="About building block rules"><em>About building block rules</em></a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>enabled</p></td>
<td align="left" valign="top"><p>Boolean</p></td>
<td align="left" valign="top"><p>Determines whether the rule is enabled. Defaults to <code class="literal">true</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>false_positives</p></td>
<td align="left" valign="top"><p>String[]</p></td>
<td align="left" valign="top"><p>String array used to describe common reasons why
the rule may issue false-positive alerts. Defaults to an empty array.</p>
<p><a id="detection-rules-from"></a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>from</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Time from which data is analyzed each time the rule executes,
using a <a href="/guide/en/elasticsearch/reference/master/common-options.html#date-math" class="ulink" target="_top">date math range</a>. For example,
<code class="literal">now-4200s</code> means the rule analyzes data from 70 minutes before its start
time. Defaults to <code class="literal">now-6m</code> (analyzes data from 6 minutes before the start
time).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>interval</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Frequency of rule execution, using a
<a href="/guide/en/elasticsearch/reference/master/common-options.html#date-math" class="ulink" target="_top">date math range</a>. For example, <code class="literal">"1h"</code>
means the rule runs every hour. Defaults to <code class="literal">5m</code> (5 minutes).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>license</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>The rule&#8217;s license.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>max_signals</p></td>
<td align="left" valign="top"><p>Integer</p></td>
<td align="left" valign="top">
<p>Maximum number of alerts the rule can create during a
single run (the rule&#8217;s <span class="strong strong"><strong>Max alerts per run</strong></span> <a class="xref" href="rules-ui-create.html#rule-ui-advanced-params" title="Configure advanced rule settings (optional)">advanced setting</a> value). Defaults to <code class="literal">100</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This setting can be superseded by the <a href="/guide/en/kibana/master/alert-action-settings-kb.html#alert-settings" class="ulink" target="_top">Kibana configuration setting</a> <code class="literal">xpack.alerting.rules.run.alerts.max</code>, which determines the maximum alerts generated by <em>any</em> rule in the Kibana alerting framework. For example, if <code class="literal">xpack.alerting.rules.run.alerts.max</code> is set to <code class="literal">1000</code>, the rule can generate no more than 1000 alerts even if <code class="literal">max_signals</code> is set higher.</p>
</div>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>meta</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Placeholder for metadata about the rule.</p>
<p><span class="strong strong"><strong>NOTE</strong></span>: This field is overwritten when you save changes to the rule&#8217;s settings.</p>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>note</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Notes to help investigate alerts produced by the rule.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>references</p></td>
<td align="left" valign="top"><p>String[]</p></td>
<td align="left" valign="top"><p>Array containing notes about or references to
relevant information about the rule. Defaults to an empty array.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>required_fields</p></td>
<td align="left" valign="top"><p>Object[]</p></td>
<td align="left" valign="top">
<p>Elasticsearch fields and their types that need to be present for the rule to function. The object has these fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">name</code> (string, required): The field&#8217;s name.
</li>
<li class="listitem">
<code class="literal">type</code> (string, required): The field&#8217;s data type.
</li>
<li class="listitem">
<code class="literal">ecs</code> (Boolean, optional): Indicates whether the field is <a href="/guide/en/ecs/8.11" class="ulink" target="_top">ECS-compliant</a>. This property is only present in responses. Its value is computed based on field&#8217;s name and type.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>NOTE</strong></span>: The value of <code class="literal">required_fields</code> does not affect the rule&#8217;s behavior, and specifying it incorrectly won&#8217;t cause the rule to fail. Use <code class="literal">required_fields</code> as an informational property to document the fields that the rule expects to be present in the data.</p>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>rule_id</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Unique ID used to identify rules. For example, when a rule
is converted from a third-party security solution. Automatically created when
it is not provided.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>setup</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Populates the rule&#8217;s setup guide with instructions on rule
prerequisites such as required integrations, configuration steps, and anything
else needed for the rule to work correctly.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>tags</p></td>
<td align="left" valign="top"><p>String[]</p></td>
<td align="left" valign="top"><p>String array containing words and phrases to help categorize,
filter, and search rules. Defaults to an empty array.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>threat</p></td>
<td align="left" valign="top"><p><a class="xref" href="rules-api-create.html#threats-object-create" title="threat schema">threat[]</a></p></td>
<td align="left" valign="top"><p>Object containing attack
information about the type of threat the rule monitors, see
<a href="/guide/en/ecs/8.11/ecs-threat.html" class="ulink" target="_top">ECS threat fields</a>. Defaults to an empty array.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>throttle</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top">
<p>Determines how often actions are taken:</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The rule level <code class="literal">throttle</code> field is deprecated in Elastic Security 8.8 and will remain active for at least the next 12 months.</p>
<p>In Elastic Security 8.8 and later, you can use the (<a class="xref" href="bulk-actions-rules-api.html#optional-actions-fields-bulk-update" title="Optional action fields"><code class="literal">frequency</code></a>) field to define frequencies for individual actions. Actions without frequencies will acquire a converted version of the rule&#8217;s <code class="literal">throttle</code> field. In the response, the converted <code class="literal">throttle</code> setting appears in the individual actions' <code class="literal">frequency</code> field.</p>
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">no_actions</code>: Never
</li>
<li class="listitem">
<code class="literal">rule</code>: Every time new alerts are detected
</li>
<li class="listitem">
<code class="literal">1h</code>: Every hour
</li>
<li class="listitem">
<code class="literal">1d</code>: Every day
</li>
<li class="listitem">
<code class="literal">7d</code>: Every week
</li>
</ul>
</div>
<p>Required when <code class="literal">actions</code> are used to send notifications.</p>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>version</p></td>
<td align="left" valign="top"><p>Integer</p></td>
<td align="left" valign="top"><p>The rule&#8217;s version number. Defaults to <code class="literal">1</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>investigation_fields</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Specify highlighted fields for personalized alert investigation flows:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field_names</code>: String[] , required
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>related_integrations</p></td>
<td align="left" valign="top"><p>Object[]</p></td>
<td align="left" valign="top">
<p><a href="https://docs.elastic.co/en/integrations" class="ulink" target="_top">Elastic integrations</a> the rule depends on. The object has these fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">package</code> (String, required): The integration package&#8217;s name, as used by the <a href="https://github.com/elastic/package-registry" class="ulink" target="_top">Elastic Package Registry</a>.
</li>
<li class="listitem">
<code class="literal">integration</code> (String, optional): The integration&#8217;s name. This field is optional for packages with only one integration whose name matches the package name, but it&#8217;s required for packages with multiple integrations.
</li>
<li class="listitem">
<code class="literal">version</code>: (String, required): Integration (package containing the integration) version constraint in <a href="https://semver.org/" class="ulink" target="_top">semantic versioning</a> format. For version ranges, you must use tilde or caret syntax. For example, <code class="literal">~1.2.3</code> is from 1.2.3 to any patch version less than <code class="literal">1.3.0</code>, and <code class="literal">^1.2.3</code> is from <code class="literal">1.2.3`</code> to any minor and patch version less than <code class="literal">2.0.0</code>.
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="opt-fields-threat-match"></a>Optional fields for indicator match rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>threat_filters</p></td>
<td align="left" valign="top"><p>Object[]</p></td>
<td align="left" valign="top"><p><a href="/guide/en/elasticsearch/reference/master/query-filter-context.html" class="ulink" target="_top">Query and filter context</a> array used to filter
documents from the Elasticsearch index containing the threat values.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>threat_indicator_path</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Much like an ingest processor, users can use this field to define where their threat indicator can be found on their indicator documents. Defaults to <code class="literal">threatintel.indicator</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="opt-fields-query-threshold"></a>Optional fields for query, indicator match, threshold, and new terms rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>language</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Determines the query language, which must be
<code class="literal">kuery</code> or <code class="literal">lucene</code>. Defaults to <code class="literal">kuery</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="opt-fields-eql-query-threshold"></a>Optional fields for event correlation, query, threshold, indicator match, new terms, and ES|QL rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>filters</p></td>
<td align="left" valign="top"><p>Object[]</p></td>
<td align="left" valign="top">
<p>The <a href="/guide/en/elasticsearch/reference/master/query-filter-context.html" class="ulink" target="_top">query and filter
context</a> array used to define the conditions for when alerts are created from
events. Defaults to an empty array.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This field is not supported for ES|QL rules.</p>
</div>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>index</p></td>
<td align="left" valign="top"><p>String[]</p></td>
<td align="left" valign="top">
<p>Indices on which the rule functions. Defaults to the
Security Solution indices defined on the Kibana Advanced Settings page
(<span class="strong strong"><strong>Kibana</strong></span> → <span class="strong strong"><strong>Stack Management</strong></span> → <span class="strong strong"><strong>Advanced Settings</strong></span> →
<code class="literal">securitySolution:defaultIndex</code>).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This field is not supported for ES|QL rules.</p>
</div>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>risk_score_mapping</p></td>
<td align="left" valign="top"><p>Object[]</p></td>
<td align="left" valign="top">
<p>Overrides generated alerts' <code class="literal">risk_score</code> with
a value from the source event:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field</code> (string, required): Source event field used to override the default
<code class="literal">risk_score</code>. This field must be an integer.
</li>
<li class="listitem">
<code class="literal">operator</code> (string, required): Must be <code class="literal">equals</code>.
</li>
<li class="listitem">
<code class="literal">value</code>(string, required): Must be an empty string (<code class="literal">""</code>).
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>rule_name_override</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Sets which field in the source event is used to
populate the alert&#8217;s <code class="literal">signal.rule.name</code> value (in the UI, this value is
displayed on the <span class="strong strong"><strong>Rules</strong></span> page in the <span class="strong strong"><strong>Rule</strong></span> column). When unspecified, the
rule&#8217;s <code class="literal">name</code> value is used. The source field must be a string data type.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>severity_mapping</p></td>
<td align="left" valign="top"><p>Object[]</p></td>
<td align="left" valign="top">
<p>Overrides generated alerts' <code class="literal">severity</code> with
values from the source event:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">field</code> (string, required): Source event field used to override the default
<code class="literal">severity</code>.
</li>
<li class="listitem">
<code class="literal">operator</code> (string, required): Must be <code class="literal">equals</code>.
</li>
<li class="listitem">
<code class="literal">severity</code> (string, required): Mapped severity value, must be <code class="literal">low</code>,
<code class="literal">medium</code>, <code class="literal">high</code>, or <code class="literal">critical</code>.
</li>
<li class="listitem">
<code class="literal">value</code>(string, required): Field value used to determine the <code class="literal">severity</code>.
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>timestamp_override</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Sets the time field used to query indices.
When unspecified, rules query the <code class="literal">@timestamp</code> field. The source field
must be an Elasticsearch date data type.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>exceptions_list</p></td>
<td align="left" valign="top"><p>Object[]</p></td>
<td align="left" valign="top">
<p>Array of
<a class="xref" href="exceptions-api-overview.html" title="Exceptions API">exception containers</a>, which define
exceptions that prevent the rule from generating alerts even when its other
criteria are met. The object has these fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">id</code> (string, required): ID of the exception container.
</li>
<li class="listitem">
<code class="literal">list_id</code> (string, required): List ID of the exception container.
</li>
<li class="listitem">
<code class="literal">namespace_type</code> (string required): Determines whether the exceptions are
valid in only the rule&#8217;s Kibana space (<code class="literal">single</code>) or in all Kibana spaces
(<code class="literal">agnostic</code>).
</li>
<li class="listitem">
<code class="literal">type</code> (string, required): The exception type, which must be either
a detection rule exception (<code class="literal">detection</code>) or an endpoint exception (<code class="literal">endpoint</code>).
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="opt-fields-eql-create"></a>Optional fields for event correlation rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>event_category_field</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Contains the event classification, such as <code class="literal">process</code>, <code class="literal">file</code>, or <code class="literal">network</code>. This field is typically mapped as a field type in the <a href="/guide/en/elasticsearch/reference/master/keyword.html" class="ulink" target="_top">keyword family</a>. Defaults to the <code class="literal">event.category</code> ECS field.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>tiebreaker_field</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Sets a secondary field for sorting events (in ascending, lexicographic order) if they have the same timestamp.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>timestamp_field</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Contains the event timestamp used for sorting a sequence of events. This is different from <code class="literal">timestamp_override</code>, which is used for querying events within a range. Defaults to the <code class="literal">@timestamp</code> ECS field.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="opt-fields-alert-suppression-create"></a>Optional alert suppression fields for query, indicator match, threshold, event correlation (non-sequence queries only), new terms, ES|QL, and machine learning rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Alert suppression is in technical preview for threshold, indicator match, event correlation, new terms, machine learning, and ES|QL rules. The functionality may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_query_indicator_match_event_correlation_non_sequence_queries_only_new_terms_esql_and_machine_learning_rules"></a>Query, indicator match, event correlation (non-sequence queries only), new terms, ES|QL, and machine learning rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h5>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>alert_suppression</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Defines alert suppression configuration. Available fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">group_by</code> (string[], required): An array of 1-3 field names to use for suppressing alerts.
</li>
<li class="listitem">
<code class="literal">duration</code> (<a class="xref" href="rules-api-create.html#alert-suppression-duration-schema" title="alert_suppression.duration schema">duration object</a>, optional): The time period in which alerts will be suppressed, beginning when the rule first meets its criteria and creates the alert. If not specified, alerts will be suppressed on rule execution only.
</li>
<li class="listitem">
<p><code class="literal">missing_fields_strategy</code> (string, optional): Defines how to handle events with missing suppression fields. Possible values:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">doNotSuppress</code>: Create a separate alert for each matching event.
</li>
<li class="listitem">
<code class="literal">suppress</code>: Create one alert for each group of events with missing fields.
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_threshold_rule"></a>Threshold rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h5>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>alert_suppression</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Defines alert suppression configuration. Available fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">duration</code> (<a class="xref" href="rules-api-create.html#alert-suppression-duration-schema" title="alert_suppression.duration schema">duration object</a>, required): The time period in which alerts will be suppressed, beginning when the rule first meets its criteria and creates the alert.
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="actions-object-schema"></a><code class="literal">actions</code> schema<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<p>All fields are required:</p>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>action_type_id</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top">
<p>The connector type used for sending notifications, can
be:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">.slack</code>
</li>
<li class="listitem">
<code class="literal">.slack_api</code>
</li>
<li class="listitem">
<code class="literal">.email</code>
</li>
<li class="listitem">
<code class="literal">.index</code>
</li>
<li class="listitem">
<code class="literal">.pagerduty</code>
</li>
<li class="listitem">
<code class="literal">.swimlane</code>
</li>
<li class="listitem">
<code class="literal">.webhook</code>
</li>
<li class="listitem">
<code class="literal">.servicenow</code>
</li>
<li class="listitem">
<code class="literal">.servicenow-itom</code>
</li>
<li class="listitem">
<code class="literal">.servicenow-sir</code>
</li>
<li class="listitem">
<code class="literal">.jira</code>
</li>
<li class="listitem">
<code class="literal">.resilient</code>
</li>
<li class="listitem">
<code class="literal">.opsgenie</code>
</li>
<li class="listitem">
<code class="literal">.teams</code>
</li>
<li class="listitem">
<code class="literal">.torq</code>
</li>
<li class="listitem">
<code class="literal">.tines</code>
</li>
<li class="listitem">
<code class="literal">.d3security</code>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>group</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Optionally groups actions by use cases. Use <code class="literal">default</code> for alert
notifications.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>id</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>The connector ID.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>params</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Object containing the allowed connector fields, which varies according to the connector type:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>For Slack:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">message</code> (string, required): The notification message.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>For email:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">to</code>, <code class="literal">cc</code>, <code class="literal">bcc</code> (string): Email addresses to which the notifications are
sent. At least one field must have a value.
</li>
<li class="listitem">
<code class="literal">subject</code> (string, optional): Email subject line.
</li>
<li class="listitem">
<code class="literal">message</code> (string, required): Email body text.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>For Webhook:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">body</code> (string, required): JSON payload.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>For PagerDuty:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">severity</code> (string, required): Severity of on the alert notification, can
be: <code class="literal">Critical</code>, <code class="literal">Error</code>, <code class="literal">Warning</code> or <code class="literal">Info</code>.
</li>
<li class="listitem">
<code class="literal">eventAction</code> (string, required):  Event <a href="https://v2.developer.pagerduty.com/docs/events-api-v2#event-action" class="ulink" target="_top">action type</a>, which can be <code class="literal">trigger</code>,
<code class="literal">resolve</code>, or <code class="literal">acknowledge</code>.
</li>
<li class="listitem">
<code class="literal">dedupKey</code> (string, optional): Groups alert notifications with the same
PagerDuty alert.
</li>
<li class="listitem">
<code class="literal">timestamp</code> (DateTime, optional): <a href="https://v2.developer.pagerduty.com/v2/docs/types#datetime" class="ulink" target="_top">ISO-8601 format timestamp</a>.
</li>
<li class="listitem">
<code class="literal">component</code> (string, optional): Source machine component responsible for the
event, for example <code class="literal">security-solution</code>.
</li>
<li class="listitem">
<code class="literal">group</code> (string, optional): Enables logical grouping of service components.
</li>
<li class="listitem">
<code class="literal">source</code> (string, optional): The affected system. Defaults to the Kibana
saved object ID of the action.
</li>
<li class="listitem">
<code class="literal">summary</code> (string, options): Summary of the event. Defaults to
<code class="literal">No summary provided</code>. Maximum length is 1024 characters.
</li>
<li class="listitem">
<code class="literal">class</code> (string, optional): Value indicating the class/type of the event.
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="optional-actions-fields-rule-create"></a>Optional <code class="literal">action</code> fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h5>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>frequency</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top">
<p>Object containing an action’s frequency:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">summary</code> (Boolean, required): Defines whether to send notifications as a summary of alerts or for each generated alert.
</li>
<li class="listitem">
<p><code class="literal">notifyWhen</code> (String, required`): Defines how often alerts generate actions. Valid values are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">onActiveAlert</code>: Actions run when the alert is generated.
</li>
<li class="listitem">
<code class="literal">onThrottleInterval</code>: Actions run on the specified throttle interval and summarize new alerts generated during that interval.
</li>
</ul>
</div>
</li>
<li class="listitem">
<code class="literal">throttle</code> (String, optional): Defines how often an alert generates repeated actions. This custom action interval must be specified in seconds, minutes, hours, or days. For example, <code class="literal">10m</code> or <code class="literal">1h</code>. This property is used only if <code class="literal">notifyWhen</code> is <code class="literal">onThrottleInterval</code>.
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>alerts_filter</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Object containing an action’s conditional filters:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">timeframe</code> (Object, optional): Object containing the time frame for when this action can be run.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">days</code> (Array of integers, required): List of days of the week on which this action can be run. Days of the week are expressed as numbers between <code class="literal">1-7</code>, where <code class="literal">1</code> is Monday and <code class="literal">7</code> is Sunday. To select all days of the week, enter an empty array.
</li>
<li class="listitem">
<p><code class="literal">hours</code> (Object, required): The hours of the day during which this action can run. Hours of the day are expressed as two strings in the format <code class="literal">hh:mm</code> in <code class="literal">24</code> hour time. A start of <code class="literal">00:00</code> and an end of <code class="literal">24:00</code> means the action can run all day.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">start</code> (String, required)
</li>
<li class="listitem">
<code class="literal">end</code> (String, required)
</li>
</ul>
</div>
</li>
<li class="listitem">
<code class="literal">timezone</code> (String, required): An ISO timezone name, such as <code class="literal">Europe/Madrid</code> or <code class="literal">America/New_York</code>. Specific offsets such as UTC or UTC+1 will also work, but lack built-in DST.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><code class="literal">query</code> (Object, optional): Object containing a query filter which gets applied to an action and determines whether the action should run.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">kql</code> (String, required): A KQL string.
</li>
<li class="listitem">
<code class="literal">filters</code> (Array of objects, required): A filter object, as defined in the <code class="literal">kbn-es-query</code> package.
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="action-variables-rule-create"></a>Alert notification placeholders<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h5>
<p>You can use <a href="http://mustache.github.io/" class="ulink" target="_top">mustache syntax</a> to add variables to notification messages. The action frequency you choose determines the variables you can select from.</p>
<p>The following variables can be passed for all rules:</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a href="/guide/en/kibana/master/rule-action-variables.html#alert-summary-action-variables" class="ulink" target="_top">Action frequency: Summary of alerts</a> to learn about additional variables that can be passed if the rule&#8217;s action frequency is <span class="strong strong"><strong>Summary of alerts</strong></span>.</p>
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">{{context.alerts}}</code>: Array of detected alerts
</li>
<li class="listitem">
<code class="literal">{{{context.results_link}}}</code>: URL to the alerts in Kibana
</li>
<li class="listitem">
<code class="literal">{{context.rule.anomaly_threshold}}</code>: Anomaly threshold score above which
alerts are generated (machine learning rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.description}}</code>: Rule description
</li>
<li class="listitem">
<code class="literal">{{context.rule.false_positives}}</code>: Rule false positives
</li>
<li class="listitem">
<code class="literal">{{context.rule.filters}}</code>: Rule filters (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.id}}</code>: Unique rule ID returned after creating the rule
</li>
<li class="listitem">
<code class="literal">{{context.rule.index}}</code>: Indices rule runs on (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.language}}</code>: Rule query language (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.machine_learning_job_id}}</code>: ID of associated machine learning job (machine learning
rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.max_signals}}</code>: Maximum allowed number of alerts per rule
execution
</li>
<li class="listitem">
<code class="literal">{{context.rule.name}}</code>: Rule name
</li>
<li class="listitem">
<code class="literal">{{context.rule.query}}</code>: Rule query (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.references}}</code>: Rule references
</li>
<li class="listitem">
<p><code class="literal">{{context.rule.risk_score}}</code>: Default rule risk score</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This placeholder contains the rule&#8217;s default values even when the <span class="strong strong"><strong>Risk score override</strong></span> option is used.</p>
</div>
</div>
</li>
<li class="listitem">
<code class="literal">{{context.rule.rule_id}}</code>: Generated or user-defined rule ID that can be
used as an identifier across systems
</li>
<li class="listitem">
<code class="literal">{{context.rule.saved_id}}</code>: Saved search ID
</li>
<li class="listitem">
<p><code class="literal">{{context.rule.severity}}</code>: Default rule severity</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This placeholder contains the rule&#8217;s default values even when the <span class="strong strong"><strong>Severity override</strong></span> option is used.</p>
</div>
</div>
</li>
<li class="listitem">
<code class="literal">{{context.rule.threat}}</code>: Rule threat framework
</li>
<li class="listitem">
<code class="literal">{{context.rule.threshold}}</code>: Rule threshold values (threshold rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.timeline_id}}</code>: Associated Timeline ID
</li>
<li class="listitem">
<code class="literal">{{context.rule.timeline_title}}</code>: Associated Timeline name
</li>
<li class="listitem">
<code class="literal">{{context.rule.type}}</code>: Rule type
</li>
<li class="listitem">
<code class="literal">{{context.rule.version}}</code>: Rule version
</li>
<li class="listitem">
<code class="literal">{{date}}`</code>: Date the rule scheduled the action
</li>
<li class="listitem">
<code class="literal">{{kibanaBaseUrl}}</code>: Configured <code class="literal">server.publicBaseUrl</code> value, or empty string if not configured
</li>
<li class="listitem">
<code class="literal">{{rule.id}}</code>: ID of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.name}}</code>: Name of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.spaceId}}</code>: Space ID of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.tags}}</code>: Tags of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.type}}</code>: Type of rule
</li>
<li class="listitem">
<code class="literal">{{state.signals_count}}</code>: Number of alerts detected
</li>
</ul>
</div>
<p>The following variables can only be passed if the rule’s action frequency is for each alert:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">{{alert.actionGroup}}</code>: Action group of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.actionGroupName}}</code>: Human-readable name of the action group of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.actionSubgroup}}</code>: Action subgroup of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.id}}</code>: ID of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.flapping}}</code>: A flag on the alert that indicates whether the alert status is changing repeatedly
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="response-actions-object-schema"></a><code class="literal">response actions</code> schema<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<p>All fields are required:</p>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>action_type_id</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top">
<p>The response action you want to add to a rule.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">.osquery</code>
</li>
<li class="listitem">
<p><code class="literal">.endpoint</code></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To learn more about the requirements for using the isolate endpoint response action, refer to <a class="xref" href="host-isolation-ov.html" title="Isolate a host"><em>Isolate a host</em></a>.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Host isolation involves quarantining a host from the network to prevent further spread of threats and limit potential damage. Be aware that automatic host isolation can cause unintended consequences, such as disrupting legitimate user activities or blocking critical business processes.</p>
</div>
</div>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>params</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Object containing the allowed response action fields, which varies according to the response action.</p>
<p><span class="strong strong"><strong>Osquery</strong></span></p>
<p>For Osquery (<code class="literal">.osquery</code>), use a single query, a saved query, or a query pack:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">query</code> (string, optional): To run a single query, use the <code class="literal">query</code> field and enter a  SQL query. Example: <code class="literal">"query": "SELECT * FROM processes;"</code>
</li>
<li class="listitem">
<code class="literal">saved_query_id</code> (string, optional): To run a saved query, use the <code class="literal">saved_query_id</code> field and specify the saved query ID. Example: <code class="literal">"saved_query_id":  "processes_elastic"</code>
</li>
<li class="listitem">
<code class="literal">packId</code> (string, optional): To specify a query pack, use the <code class="literal">packId</code> field. Example: <code class="literal">"packId": "processes_elastic"</code>
</li>
<li class="listitem">
<code class="literal">ecs_mapping</code> (object, required): Map Osquery results columns or static values to Elastic Common Schema (ECS) fields. Example: <code class="literal">"ecs_mapping": {"process.pid": {"field": "pid"}}</code>
</li>
<li class="listitem">
<code class="literal">timeout</code> (number, optional): A timeout period, in seconds, after which the query will stop running. Overwriting the default timeout allows you to support queries that require more time to complete. The default and minimum supported value is <code class="literal">60</code>. The maximum supported value is <code class="literal">900</code>. Example: <code class="literal">"timeout": 120</code>.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a href="/guide/en/kibana/master/osquery-manager-live-queries-api-create.html" class="ulink" target="_top">Create live query API</a> for more information about running Osquery queries and packs.</p>
</div>
</div>
<p><span class="strong strong"><strong>Endpoint Security</strong></span></p>
<p>For Endpoint Security (<code class="literal">.endpoint</code>), specify an endpoint response action command and provide an optional comment:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">command</code> (string, optional): To run an endpoint response action, specify a value for the <code class="literal">command</code> field. Example: <code class="literal">"command": "isolate"</code></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The only action that&#8217;s available is the isolate host response action (<code class="literal">isolate</code>).</p>
</div>
</div>
</li>
<li class="listitem">
<code class="literal">comment</code> (string, optional):  Add a note that explains or describes the action. You can find your comment in the <a class="xref" href="response-actions-history.html" title="Response actions history">response actions history log</a>. Example: <code class="literal">"comment": "Check processes"</code>
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="threats-object-create"></a><code class="literal">threat</code> schema<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<p>All fields are required:</p>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>framework</p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Relevant attack framework.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>tactic</p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top">
<p>Object containing information on the attack type:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">id</code> - string, required
</li>
<li class="listitem">
<code class="literal">name</code> - string, required
</li>
<li class="listitem">
<code class="literal">reference</code> - string, required
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>technique</p></td>
<td align="left" valign="top"><p>Array</p></td>
<td align="left" valign="top">
<p>Array containing information on the attack techniques (optional):</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">id</code> - string, required
</li>
<li class="listitem">
<code class="literal">name</code> - string, required
</li>
<li class="listitem">
<code class="literal">reference</code> - string, required
</li>
<li class="listitem">
<code class="literal">subtechnique</code> - Array, optional
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p>subtechnique</p></td>
<td align="left" valign="top"><p>Array</p></td>
<td align="left" valign="top">
<p>Array containing more specific information on the attack technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">id</code> - string, required
</li>
<li class="listitem">
<code class="literal">name</code> - string, required
</li>
<li class="listitem">
<code class="literal">reference</code> - string, required
</li>
</ul>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only threats described using the MITRE ATT&amp;CK<sup>TM</sup> framework are displayed
in the UI (<span class="strong strong"><strong>Rules</strong></span> &#8594; <span class="strong strong"><strong>Detection rules (SIEM)</strong></span> &#8594; <span class="strong strong"><strong><em>Rule name</em></strong></span>).</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="alert-suppression-duration-schema"></a><code class="literal">alert_suppression.duration</code> schema<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<p>All fields are required:</p>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>unit</p></td>
<td align="left" valign="top"><p>string</p></td>
<td align="left" valign="top"><p>Time unit. Possible values are: <code class="literal">s</code>(seconds), <code class="literal">m</code>(minutes), or <code class="literal">h</code>(hours).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>value</p></td>
<td align="left" valign="top"><p>number</p></td>
<td align="left" valign="top"><p>Positive number.</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_example_requests"></a>Example requests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h4>
</div></div></div>
<p><span class="strong strong"><strong>Example 1</strong></span></p>
<p>Query rule that searches for processes started by MS Office:</p>
<div class="pre_wrapper lang-kibana">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-kibana">POST api/detection_engine/rules
{
  "rule_id": "process_started_by_ms_office_program",
  "risk_score": 50,
  "description": "Process started by MS Office program - possible payload",
  "interval": "1h", <a id="CO8-1"></a><i class="conum" data-value="1"></i>
  "name": "MS Office child process",
  "severity": "low",
  "tags": [
   "child process",
   "ms office"
   ],
  "type": "query",
  "from": "now-70m", <a id="CO8-2"></a><i class="conum" data-value="2"></i>
  "query": "process.parent.name:EXCEL.EXE or process.parent.name:MSPUB.EXE or process.parent.name:OUTLOOK.EXE or process.parent.name:POWERPNT.EXE or process.parent.name:VISIO.EXE or process.parent.name:WINWORD.EXE",
  "language": "kuery",
  "filters": [
     {
      "query": {
         "match": {
            "event.action": {
               "query": "Process Create (rule: ProcessCreate)",
               "type": "phrase"
            }
         }
      }
     }
  ],
  "required_fields": [
    { name: "process.parent.name", "type": "keyword" }
  ],
  "related_integrations": [
    { "package": "o365", "version": "^2.3.2"}
  ],
  "enabled": false
}</pre>
</div>
<div class="kibana_widget" data-snippet="snippets/10.kibana"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO8-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The rule runs every hour.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO8-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>When the rule runs it analyzes data from 70 minutes before its start time.</p>
</td>
</tr>
</table>
</div>
<p>If the rule starts to run at 15:00, it analyzes data from 13:50 until 15:00.
When it runs next, at 16:00, it will analyze data from 14:50 until 16:00.</p>
<p><span class="strong strong"><strong>Example 2</strong></span></p>
<p>Threshold rule that detects multiple failed login attempts to a Windows host
from the same external source IP address, and maps the <code class="literal">severity</code> value to
custom source event fields:</p>
<div class="pre_wrapper lang-kibana">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-kibana">POST api/detection_engine/rules
{
  "description": "Detects when there are 20 or more failed login attempts from the same IP address with a 2 minute time frame.",
  "enabled": true,
  "exceptions_list": [ <a id="CO9-1"></a><i class="conum" data-value="1"></i>
    {
      "id": "int-ips",
      "namespace_type": "single",
      "type": "detection"
    }
  ],
  "from": "now-180s",
  "index": [
    "winlogbeat-*"
  ],
  "interval": "2m",
  "name": "Windows server prml-19",
  "query": "host.name:prml-19 and event.category:authentication and event.outcome:failure",
  "required_fields": [
    { "name": "source.ip", "type": "ip" }
  ],
  "risk_score": 30,
  "rule_id": "liv-win-ser-logins",
  "severity": "low",
  "severity_mapping": [ <a id="CO9-2"></a><i class="conum" data-value="2"></i>
    {
      "field": "source.geo.city_name",
      "operator": "equals",
      "severity": "low",
      "value": "Manchester"
    },
    {
      "field": "source.geo.city_name",
      "operator": "equals",
      "severity": "medium",
      "value": "London"
    },
    {
      "field": "source.geo.city_name",
      "operator": "equals",
      "severity": "high",
      "value": "Birmingham"
    },
    {
      "field": "source.geo.city_name",
      "operator": "equals",
      "severity": "critical",
      "value": "Wallingford"
    }
  ],
  "tags": [
    "Brute force"
  ],
  "threshold": { <a id="CO9-3"></a><i class="conum" data-value="3"></i>
    "field": "source.ip",
    "value": 20
  },
  "type": "threshold"
}</pre>
</div>
<div class="kibana_widget" data-snippet="snippets/11.kibana"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Exception list container used to exclude internal IP addresses.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Alert severity levels are mapped according to the defined field values.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Alerts are generated when the same source IP address is discovered in at
least 20 results.</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Example 3</strong></span></p>
<p>Machine learning rule that creates alerts, and sends Slack notifications, when the
<code class="literal">linux_anomalous_network_activity_ecs</code> machine learning job discovers anomalies with a
threshold of 70 or above:</p>
<div class="pre_wrapper lang-kibana">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-kibana">POST api/detection_engine/rules
{
  "anomaly_threshold": 70,
  "rule_id": "ml_linux_network_high_threshold",
  "risk_score": 70,
  "machine_learning_job_id": "linux_anomalous_network_activity_ecs",
  "description": "Generates alerts when the job discovers anomalies over 70",
  "interval": "5m",
  "name": "Anomalous Linux network activity",
  "note": "Shut down the internet.",
  "setup": "This rule requires data coming in from Elastic Defend."
  "severity": "high",
  "tags": [
   "machine learning",
   "Linux"
   ],
  "type": "machine_learning",
  "from": "now-6m",
  "enabled": true,
  "actions": [
    {
      "action_type_id": ".slack",
      "group": "default",
      "id": "5ad22cd5-5e6e-4c6c-a81a-54b626a4cec5",
      "params": {
        "message": "Urgent: {{context.rule.description}}"
      }
    }
  ]
}</pre>
</div>
<div class="kibana_widget" data-snippet="snippets/12.kibana"></div>
<p><span class="strong strong"><strong>Example 4</strong></span></p>
<p>Event correlation rule that creates alerts when the Windows <code class="literal">rundll32.exe</code> process makes
unusual network connections:</p>
<div class="pre_wrapper lang-kibana">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-kibana">POST api/detection_engine/rules
{
  "rule_id": "eql-outbound-rundll32-connections",
  "risk_score": 21,
  "description": "Unusual rundll32.exe network connection",
  "name": "rundll32.exe network connection",
  "severity": "low",
  "tags": [
   "EQL",
   "Windows",
   "rundll32.exe"
   ],
  "type": "eql",
  "language": "eql",
  "query": "sequence by process.entity_id with maxspan=2h [process where event.type in (\"start\", \"process_started\") and (process.name == \"rundll32.exe\" or process.pe.original_file_name == \"rundll32.exe\") and ((process.args == \"rundll32.exe\" and process.args_count == 1) or (process.args != \"rundll32.exe\" and process.args_count == 0))] [network where event.type == \"connection\" and (process.name == \"rundll32.exe\" or process.pe.original_file_name == \"rundll32.exe\")]",
  "required_fields": [
    { "name": "event.type", "type": "keyword" },
    { "name": "process.args", "type": "keyword" },
    { "name": "process.args_count", "type": "long" },
    { "name": "process.entity_id", "type": "keyword" },
    { "name": "process.name", "type": "keyword" },
    { "name": "process.pe.original_file_name", "type": "keyword" }
  ]
}</pre>
</div>
<div class="kibana_widget" data-snippet="snippets/13.kibana"></div>
<p><a id="threat-match-example"></a><span class="strong strong"><strong>Example 5</strong></span></p>
<p>Indicator match rule that creates an alert when one of the following is true:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The event&#8217;s destination IP address <span class="strong strong"><strong>and</strong></span> port number matches destination IP
<span class="strong strong"><strong>and</strong></span> port values in the <code class="literal">threat_index</code> index.
</li>
<li class="listitem">
The event&#8217;s source IP address matches a host IP address value in the
<code class="literal">threat_index</code> index.
</li>
</ul>
</div>
<div class="pre_wrapper lang-kibana">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-kibana">POST api/detection_engine/rules
{
    "type": "threat_match",
    "actions": [],
    "index": [
        "packetbeat-*"
    ],
    "query": "destination.ip:* or host.ip:*",
    "threat_index": [
        "ip-threat-list" <a id="CO10-1"></a><i class="conum" data-value="1"></i>
    ],
    "threat_query": "*:*", <a id="CO10-2"></a><i class="conum" data-value="2"></i>
    "threat_mapping": [
        {
            "entries": [ <a id="CO10-3"></a><i class="conum" data-value="3"></i>
                {
                    "field": "destination.ip",
                    "type": "mapping",
                    "value": "destination.ip"
                },
                {
                    "field": "destination.port",
                    "type": "mapping",
                    "value": "destination.port"
                }
            ]
        },
        {
            "entries": [ <a id="CO10-4"></a><i class="conum" data-value="4"></i>
                {
                    "field": "source.ip",
                    "type": "mapping",
                    "value": "host.ip"
                }
            ]
        }
    ],
    "required_fields": [
      { "name": "destination.ip", "type": "ip" },
      { "name": "destination.port", "type": "long" },
      { "name": "host.ip", "type": "ip" }
    ],
    "risk_score": 50,
    "severity": "medium",
    "name": "Bad IP threat match",
    "description": "Checks for bad IP addresses listed in the ip-threat-list index"
}</pre>
</div>
<div class="kibana_widget" data-snippet="snippets/14.kibana"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The Elasticsearch index used for matching threat values.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Query defining which threat index fields are used for matching values. In
this example, all values from the <code class="literal">ip-threat-list</code> index are used.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Multiple objects in a single <code class="literal">entries</code> element are evaluated using <code class="literal">and</code>
logic. In this example, both the event&#8217;s <code class="literal">destination.ip</code> and
<code class="literal">destination.port</code> values must match the corresponding field values in the
<code class="literal">ip-threat-list</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Sibling <code class="literal">entries</code> are evaluated using <code class="literal">or</code> logic. An alert is generated when
at least one <code class="literal">entries</code> object evaluates to <code class="literal">true</code>.</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Example 6</strong></span></p>
<p>New terms rule that creates alerts a new IP address is detected for a user:</p>
<div class="pre_wrapper lang-kibana">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-kibana">POST api/detection_engine/rules
{
  "risk_score": 21,
  "description": "Detects a user associated with a new IP address",
  "name": "New User IP Detected",
  "severity": "medium",
  "type": "new_terms",
  "language": "kuery",
  "query": "*",
  "new_terms_fields": ["user.id", "source.ip"],
  "history_window_start": "now-30d",
  "index": ["auditbeat*"],
  "required_fields": [
    { "name": "user.id", "type": "keyword" },
    { "name": "source.ip", "type": "ip" }
  ]
}</pre>
</div>
<div class="kibana_widget" data-snippet="snippets/15.kibana"></div>
<p><span class="strong strong"><strong>Example 7</strong></span></p>
<p>ES|QL rule that creates alerts from events that match an Excel parent process:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">POST api/detection_engine/rules
{
  "type": "esql",
  "language": "esql",
  "query": "from auditbeat-8.10.2 METADATA _id, _version, _index | where process.parent.name == \"EXCEL.EXE\"",
  "name": "Find Excel events",
  "description": "Find Excel events",
  "tags": [],
  "interval": "5m",
  "from": "now-360s",
  "to": "now",
  "enabled": false,
  "risk_score": 21,
  "severity": "low",
  "required_fields": [
    { "name": "process.parent.name", "type": "keyword" }
  ]
}</pre>
</div>
<p><span class="strong strong"><strong>Example 8</strong></span></p>
<p>Query rule that searches for processes started by MS Office and suppresses alerts by the <code class="literal">process.parent.name</code> field within a 5-hour time period:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST api/detection_engine/rules
{
  "rule_id": "process_started_by_ms_office_program",
  "risk_score": 50,
  "description": "Process started by MS Office program - possible payload",
  "interval": "1h",
  "name": "MS Office child process",
  "severity": "low",
  "tags": [
   "child process",
   "ms office"
   ],
  "type": "query",
  "from": "now-70m",
  "query": "process.parent.name:EXCEL.EXE or process.parent.name:MSPUB.EXE or process.parent.name:OUTLOOK.EXE or process.parent.name:POWERPNT.EXE or process.parent.name:VISIO.EXE or process.parent.name:WINWORD.EXE",
  "language": "kuery",
  "filters": [
     {
      "query": {
         "match": {
            "event.action": {
               "query": "Process Create (rule: ProcessCreate)",
               "type": "phrase"
            }
         }
      }
     }
  ],
  "enabled": false,
  "alert_suppression": {
    "duration": { "unit": "h", "value": 5 },
    "group_by": [
        "process.parent.name"
    ],
    "missing_fields_strategy": "suppress"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/16.console"></div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_response_code"></a>Response code<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">200</code>
</span>
</dt>
<dd>
Indicates a successful call.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_response_payload"></a>Response payload<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/api/rules/rules-api-create.asciidoc">edit</a></h3>
</div></div></div>
<p>A JSON object that includes a unique ID, the time the rule was created, and its
version number. If the request payload did not include a <code class="literal">rule_id</code> field, a
unique rule ID is also generated.</p>
<p>Example response for a query rule:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "created_at": "2020-04-07T14:51:09.755Z",
  "updated_at": "2020-04-07T14:51:09.970Z",
  "created_by": "elastic",
  "description": "Process started by MS Office program - possible payload",
  "enabled": false,
  "false_positives": [],
  "from": "now-70m",
  "id": "6541b99a-dee9-4f6d-a86d-dbd1869d73b1",
  "immutable": false,
  "interval": "1h",
  "rule_id": "process_started_by_ms_office_program",
  "max_signals": 100,
  "risk_score": 50,
  "name": "MS Office child process",
  "references": [],
  "severity": "low",
  "updated_by": "elastic",
  "tags": [
    "child process",
    "ms office"
  ],
  "to": "now",
  "type": "query",
  "threat": [],
  "version": 1,
  "actions": [],
  "filters": [
    {
      "query": {
        "match": {
          "event.action": {
            "query": "Process Create (rule: ProcessCreate)",
            "type": "phrase"
          }
        }
      }
    }
  ],
  "query": "process.parent.name:EXCEL.EXE or process.parent.name:MSPUB.EXE or process.parent.name:OUTLOOK.EXE or process.parent.name:POWERPNT.EXE or process.parent.name:VISIO.EXE or process.parent.name:WINWORD.EXE",
  "language": "kuery",
  "related_integrations": [
    { "package": "o365", "version": "^2.3.2" },
    { "package": "azure", "version": "^1.11.4", "integration": "graphactivitylogs" }
  ],
  "required_fields": [
    { "name": "process.parent.name", "type": "keyword", "ecs": true }
  ],
  "setup": ""
}</pre>
</div>
<p>Example response for a machine learning job rule:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "created_at": "2020-04-07T14:45:15.679Z",
  "updated_at": "2020-04-07T14:45:15.892Z",
  "created_by": "elastic",
  "description": "Generates alerts when the job discovers anomalies over 70",
  "enabled": true,
  "false_positives": [],
  "from": "now-6m",
  "id": "83876f66-3a57-4a99-bf37-416494c80f3b",
  "immutable": false,
  "interval": "5m",
  "rule_id": "ml_linux_network_high_threshold",
  "max_signals": 100,
  "risk_score": 70,
  "name": "Anomalous Linux network activity",
  "references": [],
  "severity": "high",
  "updated_by": "elastic",
  "tags": [
    "machine learning",
    "Linux"
  ],
  "to": "now",
  "type": "machine_learning",
  "threat": [],
  "version": 1,
  "actions": [
    {
      "action_type_id": ".slack",
      "group": "default",
      "id": "5ad22cd5-5e6e-4c6c-a81a-54b626a4cec5",
      "params": {
        "message": "Urgent: {{context.rule.description}}"
      },
      "frequency": {
        "summary": true,
        "notifyWhen": "onActiveAlert",
        "throttle": null
      }
    }
  ],
  "note": "Shut down the internet.",
  "status": "going to run",
  "status_date": "2020-04-07T14:45:21.685Z",
  "anomaly_threshold": 70,
  "machine_learning_job_id": "linux_anomalous_network_activity_ecs",
  "related_integrations": [],
  "required_fields": [],
  "setup": ""
}</pre>
</div>
<p>Example response for a threshold rule:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "author": [],
  "created_at": "2020-07-22T10:27:23.486Z",
  "updated_at": "2020-07-22T10:27:23.673Z",
  "created_by": "elastic",
  "description": "Detects when there are 20 or more failed login attempts from the same IP address with a 2 minute time frame.",
  "enabled": true,
  "false_positives": [],
  "from": "now-180s",
  "id": "15dbde26-b627-4d74-bb1f-a5e0ed9e4993",
  "immutable": false,
  "interval": "2m",
  "rule_id": "liv-win-ser-logins",
  "max_signals": 100,
  "risk_score": 30,
  "risk_score_mapping": [],
  "name": "Windows server prml-19",
  "references": [],
  "severity": "low",
  "severity_mapping": [
    {
      "field": "source.geo.city_name",
      "operator": "equals",
      "severity": "low",
      "value": "Manchester"
    },
    {
      "field": "source.geo.city_name",
      "operator": "equals",
      "severity": "medium",
      "value": "London"
    },
    {
      "field": "source.geo.city_name",
      "operator": "equals",
      "severity": "high",
      "value": "Birmingham"
    },
    {
      "field": "source.geo.city_name",
      "operator": "equals",
      "severity": "critical",
      "value": "Wallingford"
    }
  ],
  "updated_by": "elastic",
  "tags": [
    "Brute force"
  ],
  "to": "now",
  "type": "threshold",
  "threat": [],
  "version": 1,
  "exceptions_list": [
    {
      "id": "int-ips",
      "namespace_type": "single",
      "type": "detection"
    }
  ],
  "actions": [],
  "index": [
    "winlogbeat-*"
  ],
  "query": "host.name:prml-19 and event.category:authentication and event.outcome:failure",
  "language": "kuery",
  "threshold": {
    "field": "source.ip",
    "value": 20
  },
  "related_integrations": [
    { "package": "o365", "version": "^2.3.2" }
  ],
  "required_fields": [
    { "name": "source.ip", "type": "ip", "ecs": true }
  ],
  "setup": ""
}</pre>
</div>
<p>Example response for an EQL rule:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "author": [],
  "created_at": "2020-10-05T09:06:16.392Z",
  "updated_at": "2020-10-05T09:06:16.403Z",
  "created_by": "elastic",
  "description": "Unusual rundll32.exe network connection",
  "enabled": true,
  "false_positives": [],
  "from": "now-6m",
  "id": "93808cae-b05b-4dc9-8479-73574b50f8b1",
  "immutable": false,
  "interval": "5m",
  "rule_id": "eql-outbound-rundll32-connections",
  "max_signals": 100,
  "risk_score": 21,
  "risk_score_mapping": [],
  "name": "rundll32.exe network connection",
  "references": [],
  "severity": "low",
  "severity_mapping": [],
  "updated_by": "elastic",
  "tags": [
    "EQL",
    "Windows",
    "rundll32.exe"
  ],
  "to": "now",
  "type": "eql",
  "threat": [],
  "version": 1,
  "exceptions_list": [],
  "throttle": "no_actions",
  "query": "sequence by process.entity_id with maxspan=2h [process where event.type in (\"start\", \"process_started\") and (process.name == \"rundll32.exe\" or process.pe.original_file_name == \"rundll32.exe\") and ((process.args == \"rundll32.exe\" and process.args_count == 1) or (process.args != \"rundll32.exe\" and process.args_count == 0))] [network where event.type == \"connection\" and (process.name == \"rundll32.exe\" or process.pe.original_file_name == \"rundll32.exe\")]",
  "language": "eql",
  "related_integrations": [
    { "package": "o365", "version": "^2.3.2" }
  ],
  "required_fields": [
    { "name": "event.type", "type": "keyword", "ecs": true },
    { "name": "process.args", "type": "keyword", "ecs": true },
    { "name": "process.args_count", "type": "long", "ecs": true },
    { "name": "process.entity_id", "type": "keyword", "ecs": true },
    { "name": "process.name", "type": "keyword", "ecs": true },
    { "name": "process.pe.original_file_name", "type": "keyword", "ecs": true }
  ],
  "setup": ""
}</pre>
</div>
<p>Example response for an indicator match rule:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "author": [],
  "created_at": "2020-10-06T07:07:58.227Z",
  "updated_at": "2020-10-06T07:07:58.237Z",
  "created_by": "elastic",
  "description": "Checks for bad IP addresses listed in the ip-threat-list index",
  "enabled": true,
  "false_positives": [],
  "from": "now-6m",
  "id": "d5daa13f-81fb-4b13-be2f-31011e1d9ae1",
  "immutable": false,
  "interval": "5m",
  "rule_id": "608501e4-c768-4f64-9326-cec55b5d439b",
  "max_signals": 100,
  "risk_score": 50,
  "risk_score_mapping": [],
  "name": "Bad IP threat match",
  "references": [],
  "severity": "medium",
  "severity_mapping": [],
  "updated_by": "elastic",
  "tags": [],
  "to": "now",
  "type": "threat_match",
  "threat": [],
  "version": 1,
  "exceptions_list": [],
  "index": [
    "packetbeat-*"
  ],
  "query": "destination.ip:* or host.ip:*",
  "language": "kuery",
  "threat_query": "*:*",
  "threat_index": [
    "ip-threat-list"
  ],
  "threat_mapping": [
    {
      "entries": [
        {
          "field": "destination.ip",
          "type": "mapping",
          "value": "destination.ip"
        },
        {
          "field": "destination.port",
          "type": "mapping",
          "value": "destination.port"
        }
      ]
    },
    {
      "entries": [
        {
          "field": "source.ip",
          "type": "mapping",
          "value": "host.ip"
        }
      ]
    }
  ],
  "related_integrations": [
    { "package": "o365", "version": "^2.3.2" }
  ],
  "required_fields": [
    { "name": "destination.ip", "type": "ip", "ecs": true },
    { "name": "destination.port", "type": "long", "ecs": true },
    { "name": "host.ip", "type": "ip", "ecs": true }
  ],
  "setup": ""
}</pre>
</div>
<p>Example response for a new terms rule:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "author": [],
  "created_at": "2020-10-06T07:07:58.227Z",
  "updated_at": "2020-10-06T07:07:58.237Z",
  "created_by": "elastic",
  "description": "Detects a user associated with a new IP address",
  "enabled": true,
  "false_positives": [],
  "from": "now-6m",
  "id": "eb7225c0-566b-11ee-8b4f-bbf3afdeb9f4",
  "immutable": false,
  "interval": "5m",
  "rule_id": "c6f5d0bc-7be9-47d4-b2f3-073d22641e30",
  "max_signals": 100,
  "risk_score": 21,
  "risk_score_mapping": [],
  "name": "New User IP Detected",
  "references": [],
  "severity": "medium",
  "severity_mapping": [],
  "updated_by": "elastic",
  "tags": [],
  "to": "now",
  "type": "new_terms",
  "threat": [],
  "version": 1,
  "exceptions_list": [],
  "index": [
    "auditbeat*"
  ],
  "query": "*",
  "language": "kuery",
  "new_terms_fields": ["user.id", "source.ip"],
  "history_window_start": "now-30d",
  "related_integrations": [
    { "package": "o365", "version": "^2.3.2" }
  ],
  "required_fields": [
    { "name": "user.id", "type": "keyword", "ecs": true },
    { "name": "source.ip", "type": "ip", "ecs": true }
  ],
  "setup": ""
}</pre>
</div>
<p>Example response for an ES|QL rule:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "name": "Find Excel events",
  "description": "Find Excel events",
  "risk_score": 21,
  "severity": "low",
  "output_index": "",
  "tags": [],
  "interval": "5m",
  "enabled": false,
  "author": [],
  "false_positives": [],
  "from": "now-360s",
  "max_signals": 100,
  "risk_score_mapping": [],
  "severity_mapping": [],
  "threat": [],
  "to": "now",
  "references": [],
  "version": 1,
  "exceptions_list": [],
  "actions": [],
  "id": "d0f20490-6da4-11ee-b85e-09e9b661f2e2",
  "updated_at": "2023-10-18T10:55:14.269Z",
  "updated_by": "elastic",
  "created_at": "2023-10-18T10:55:14.269Z",
  "created_by": "elastic",
  "revision": 0,
  "rule_id": "e4b53a89-debd-4a0d-a3e3-20606952e589",
  "immutable": false,
  "related_integrations": [
    { "package": "o365", "version": "^2.3.2" }
  ],
  "required_fields": [
    { "name": "process.parent.name", "type": "keyword", "ecs": true }
  ],
  "setup": "",
  "type": "esql",
  "language": "esql",
  "query": "from auditbeat-8.10.2 METADATA _id | where process.parent.name == \"EXCEL.EXE\""
}</pre>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="rule-api-overview.html">« Detections API</a>
</span>
<span class="next">
<a href="rules-api-get.html">Get rule »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
