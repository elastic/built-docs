<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="">
<title>Get started with CSPM for Azure | Serverless | Elastic</title>
<meta class="elastic" name="content" content="Get started with CSPM for Azure | Serverless">

<link rel="home" href="index.html" title="Serverless"/>
<link rel="up" href="security-cspm.html" title="Cloud security posture management"/>
<link rel="prev" href="security-cspm-get-started-gcp.html" title="Get started with CSPM for GCP"/>
<link rel="next" href="cspm-required-permissions.html" title="CSPM privilege requirements"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Serverless"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Serverless/Guide"/>
<meta name="DC.subject" content="Serverless"/>
<meta name="DC.identifier" content="main"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="security-cspm-get-started-gcp.html">« Get started with CSPM for GCP</a>
</span>
<span class="next">
<a href="cspm-required-permissions.html">CSPM privilege requirements »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="what-is-security-serverless.html">Elastic Security Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="security-cloud-native-security-overview.html">Cloud Security</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="security-cspm.html">Cloud security posture management</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Get started with CSPM for Azure</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/solutions/security/cloud/get-started-with-cspm-for-azure">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="security-cspm-get-started-azure"></a>Get started with CSPM for Azure</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
</div></div></div>
<div class="position-relative"><h6><a id="cspm-overview-azure"></a>Overview</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<p>This page explains how to get started monitoring the security posture of your cloud assets using the Cloud Security Posture Management (CSPM) feature.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p class="admon_title">Requirements</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Minimum privileges vary depending on whether you need to read, write, or manage CSPM data and integrations. Refer to <a class="xref" href="cspm-required-permissions.html" title="CSPM privilege requirements">CSPM privilege requirements</a>.
</li>
<li class="listitem">
CSPM only works in the <code class="literal">Default</code> Kibana space. Installing the CSPM integration on a different Kibana space will not work.
</li>
<li class="listitem">
CSPM is supported only on AWS, GCP, and Azure commercial cloud platforms, and AWS GovCloud. Other government cloud platforms are not supported (<a href="https://github.com/elastic/kibana/issues/new/choose" class="ulink" target="_top">request support</a>).
</li>
<li class="listitem">
The user who gives the CSPM integration permissions in Azure must be an Azure subscription <code class="literal">admin</code>.
</li>
</ul>
</div>
</div>
</div>
<div class="position-relative"><h6><a id="cspm-setup-azure"></a>Set up CSPM for Azure</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<p>You can set up CSPM for Azure by by enrolling an Azure organization (management group) containing multiple subscriptions, or by enrolling a single subscription. Either way, first add the CSPM integration, then enable cloud account access. Two deployment technologies are available: agentless, and agent-based. <a class="xref" href="security-cspm-get-started-azure.html#cspm-azure-agentless" title="Agentless deployment">Agentless deployment</a> allows you to collect cloud posture data without having to manage the deployment of an agent in your cloud. <a class="xref" href="security-cspm-get-started-azure.html#cspm-azure-agent-based" title="Agent-based deployment">Agent-based deployment</a> requires you to deploy and manage an agent in the cloud account you want to monitor.</p>
<div class="position-relative"><h6><a id="cspm-azure-agentless"></a>Agentless deployment</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<p><span class="Admonishment Admonishment--beta">
[<span class="Admonishment-title u-mono">beta</span>]
<span class="Admonishment-detail">
This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.
</span>
</span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Find <span class="strong strong"><strong>Integrations</strong></span> in the navigation menu or use the global search field.
</li>
<li class="listitem">
Search for <code class="literal">CSPM</code>, then click on the result.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM)</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Azure</strong></span>, then either <span class="strong strong"><strong>Azure Organization</strong></span> to onboard your whole organization, or <span class="strong strong"><strong>Single Subscription</strong></span> to onboard an individual subscription.
</li>
<li class="listitem">
Give your integration a name that matches the purpose or team of the Azure subscription/organization you want to monitor, for example, <code class="literal">dev-azure-account</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Advanced options</strong></span>, then select <span class="strong strong"><strong>Agentless (BETA)</strong></span>.
</li>
<li class="listitem">
Next, you&#8217;ll need to authenticate to Azure by providing a <span class="strong strong"><strong>Client ID</strong></span>, <span class="strong strong"><strong>Tenant ID</strong></span>, and <span class="strong strong"><strong>Client Secret</strong></span>. To learn how to generate them, refer to <a class="xref" href="security-cspm-get-started-azure.html#cspm-azure-client-secret" title="Option 2: Service principal with client secret">Service principal with client secret</a>.
</li>
<li class="listitem">
Once you&#8217;ve provided the necessary credentials, click <span class="strong strong"><strong>Save and continue</strong></span> to finish deployment. Your data should start to appear within a few minutes.
</li>
</ol>
</div>
<div class="position-relative"><h6><a id="cspm-azure-agent-based"></a>Agent-based deployment</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<div class="position-relative"><h7><a id="cspm-add-and-name-integration-azure"></a>Add your CSPM integration</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Find <span class="strong strong"><strong>Integrations</strong></span> in the navigation menu or use the global search field.
</li>
<li class="listitem">
Search for <code class="literal">CSPM</code>, then click on the result.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM)</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Configure integration</strong></span>, select <span class="strong strong"><strong>Azure</strong></span>, then select either <span class="strong strong"><strong>Azure Organization</strong></span> or <span class="strong strong"><strong>Single Subscription</strong></span>, depending on which resources you want to monitor.
</li>
<li class="listitem">
Give your integration a name that matches the purpose or team of the Azure resources you want to monitor, for example, <code class="literal">azure-CSPM-dev-1</code>.
</li>
</ol>
</div>
<div class="position-relative"><h7><a id="cspm-set-up-cloud-access-section-azure"></a>Set up cloud account access</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<p>To set up CSPM for an Azure organization or subscription, you will need admin privileges for that organization or subscription.</p>
<p>For most users, the simplest option is to use an Azure Resource Manager (ARM) template to automatically provision the necessary resources and permissions in Azure. If you prefer a more hands-on approach or require a specific configuration not supported by the ARM template, you can use one of the manual setup options described below.</p>
<div class="position-relative"><h7><a id="cspm-set-up-ARM"></a>ARM template setup (recommended)</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Under <span class="strong strong"><strong>Setup Access</strong></span>, select <span class="strong strong"><strong>ARM Template</strong></span>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Where to add this integration</strong></span>:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Select <span class="strong strong"><strong>New Hosts</strong></span>.
</li>
<li class="listitem">
Name the Elastic Agent policy. Use a name that matches the resources you want to monitor, for example, <code class="literal">azure-dev-policy</code>. Click <span class="strong strong"><strong>Save and continue</strong></span>. The <span class="strong strong"><strong>ARM Template deployment</strong></span> window appears.
</li>
<li class="listitem">
In a new tab, log in to the Azure portal, then return to Kibana and click <span class="strong strong"><strong>Launch ARM Template</strong></span>. This will open the ARM template in Azure.
</li>
<li class="listitem">
If you are deploying to an Azure organization, select the management group you want to monitor from the drop-down menu. Next, enter the subscription ID of the subscription where you want to deploy the VM that will scan your resources.
</li>
<li class="listitem">
Copy the <code class="literal">Fleet URL</code> and <code class="literal">Enrollment Token</code> that appear in Kibana to the corresponding fields in the ARM Template, then click <span class="strong strong"><strong>Review + create</strong></span>.
</li>
<li class="listitem">
(Optional) Change the <code class="literal">Resource Group Name</code> parameter. Otherwise, the name of the resource group defaults to a timestamp prefixed with <code class="literal">cloudbeat-</code>.
</li>
</ol>
</div>
</li>
<li class="listitem">
Return to Kibana and wait for the confirmation of data received from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.
</li>
</ol>
</div>
<div class="position-relative"><h7><a id="cspm-set-up-manual-azure"></a>Manual setup</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<p>For manual setup, multiple authentication methods are available:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Managed identity (recommended)
</li>
<li class="listitem">
Service principal with client secret
</li>
<li class="listitem">
Service principal with client certificate
</li>
</ol>
</div>
<div class="position-relative"><h7><a id="cspm-azure-managed-identity-setup"></a>Option 1: Managed identity (recommended)</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<p>This method involves creating an Azure VM (or using an existing one), giving it read access to the resources you want to monitor with CSPM, and installing Elastic Agent on it.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the Azure portal to create a new Azure VM.
</li>
<li class="listitem">
Follow the setup process, and make sure you enable <span class="strong strong"><strong>System assigned managed identity</strong></span> under the <span class="strong strong"><strong>Management</strong></span> tab.
</li>
<li class="listitem">
Go to your Azure subscription list and select the subscription or management group you want to monitor with CSPM.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Access control (IAM)</strong></span>, and select <span class="strong strong"><strong>Add Role Assignment</strong></span>.
</li>
<li class="listitem">
Select the <code class="literal">Reader</code> role, assign access to <span class="strong strong"><strong>Managed Identity</strong></span>, then select your VM.
</li>
</ol>
</div>
<p>After assigning the role:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Return to the <span class="strong strong"><strong>Add CSPM</strong></span> page in Kibana.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Configure integration</strong></span>, select <span class="strong strong"><strong>Azure</strong></span>. Under <span class="strong strong"><strong>Setup access</strong></span>, select <span class="strong strong"><strong>Manual</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Where to add this integration</strong></span>, select <span class="strong strong"><strong>New hosts</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then follow the instructions to install Elastic Agent on your Azure VM.
</li>
</ol>
</div>
<p>Wait for the confirmation that Kibana received data from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.</p>
<div class="position-relative"><h7><a id="cspm-azure-client-secret"></a>Option 2: Service principal with client secret</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<p>Before using this method, you must have set up a <a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-create-service-principal-portal#get-tenant-and-app-id-values-for-signing-in" class="ulink" target="_top">Microsoft Entra application and service principal that can access resources</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM) integration</strong></span> page, scroll to the <span class="strong strong"><strong>Setup access</strong></span> section, then select <span class="strong strong"><strong>Manual</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Preferred manual method</strong></span>, select <span class="strong strong"><strong>Service principal with Client Secret</strong></span>.
</li>
<li class="listitem">
Go to the <span class="strong strong"><strong>Registered apps</strong></span> section of <a href="https://ms.portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps" class="ulink" target="_top">Microsoft Entra ID</a>.
</li>
<li class="listitem">
Click on <span class="strong strong"><strong>New Registration</strong></span>, name your app and click <span class="strong strong"><strong>Register</strong></span>.
</li>
<li class="listitem">
Copy your new app&#8217;s <code class="literal">Directory (tenant) ID</code> and <code class="literal">Application (client) ID</code>. Paste them into the corresponding fields in Kibana.
</li>
<li class="listitem">
Return to the Azure portal. Select <span class="strong strong"><strong>Certificates &amp; secrets</strong></span>, then go to the <span class="strong strong"><strong>Client secrets</strong></span> tab. Click <span class="strong strong"><strong>New client secret</strong></span>.
</li>
<li class="listitem">
Copy the new secret. Paste it into the corresponding field in Kibana.
</li>
<li class="listitem">
Return to Azure. Go to your Azure subscription list and select the subscription or management group you want to monitor with CSPM.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Access control (IAM)</strong></span> and select <span class="strong strong"><strong>Add Role Assignment</strong></span>.
</li>
<li class="listitem">
Select the <code class="literal">Reader</code> function role, assign access to <span class="strong strong"><strong>User, group, or service principal</strong></span>, and select your new app.
</li>
<li class="listitem">
Return to the <span class="strong strong"><strong>Add CSPM</strong></span> page in Kibana.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Where to add this integration</strong></span>, select <span class="strong strong"><strong>New hosts</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then follow the instructions to install Elastic Agent on your selected host.
</li>
</ol>
</div>
<p>Wait for the confirmation that Kibana received data from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.</p>
<div class="position-relative"><h7><a id="cspm-azure-client-certificate"></a>Option 3: Service principal with client certificate</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/do-not-delete_legacy-docs/docs/serverless/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></div>
<p>Before using this method, you must have set up a <a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-create-service-principal-portal#get-tenant-and-app-id-values-for-signing-in" class="ulink" target="_top">Microsoft Entra application and service principal that can access resources</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM) integration</strong></span> page, under <span class="strong strong"><strong>Setup access</strong></span>, select <span class="strong strong"><strong>Manual</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Preferred manual method</strong></span>, select <span class="strong strong"><strong>Service principal with client certificate</strong></span>.
</li>
<li class="listitem">
Go to the <span class="strong strong"><strong>Registered apps</strong></span> section of <a href="https://ms.portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps" class="ulink" target="_top">Microsoft Entra ID</a>.
</li>
<li class="listitem">
Click on <span class="strong strong"><strong>New Registration</strong></span>, name your app and click <span class="strong strong"><strong>Register</strong></span>.
</li>
<li class="listitem">
Copy your new app&#8217;s <code class="literal">Directory (tenant) ID</code> and <code class="literal">Application (client) ID</code>. Paste them into the corresponding fields in Kibana.
</li>
<li class="listitem">
Return to Azure. Go to your Azure subscription list and select the subscription or management group you want to monitor with CSPM.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Access control (IAM)</strong></span> and select <span class="strong strong"><strong>Add Role Assignment</strong></span>.
</li>
<li class="listitem">
Select the <code class="literal">Reader</code> function role, assign access to <span class="strong strong"><strong>User, group, or service principal</strong></span>, and select your new app.
</li>
</ol>
</div>
<p>Next, create a certificate. If you intend to use a password-protected certificate, you must use a pkcs12 certificate. Otherwise, you must use a pem certificate.</p>
<p>Create a pkcs12 certificate, for example:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell"># Create PEM file
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes

# Create pkcs12 bundle using legacy flag (CLI will ask for export password)
openssl pkcs12 -legacy -export -out bundle.p12 -inkey key.pem -in cert.pem</pre>
</div>
<p>Create a PEM certificate, for example:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell"># Generate certificate signing request (csr) and key
openssl req -new -newkey rsa:4096 -nodes -keyout cert.key -out cert.csr

# Generate PEM and self-sign with key
openssl x509 -req -sha256 -days 365 -in cert.csr -signkey cert.key -out signed.pem

# Create bundle
cat cert.key &gt; bundle.pem
cat signed.pem &gt;&gt; bundle.pem</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Return to Azure.
</li>
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Certificates &amp; secrets</strong></span> menu. Select the <span class="strong strong"><strong>Certificates</strong></span> tab.
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Upload certificate</strong></span>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If you&#8217;re using a PEM certificate that was created using the example commands above, upload <code class="literal">signed.pem</code>.
</li>
<li class="listitem">
If you&#8217;re using a pkcs12 certificate that was created using the example commands above, upload <code class="literal">cert.pem</code>.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Upload the certificate bundle to the VM where you will deploy Elastic Agent.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If you&#8217;re using a PEM certificate that was created using the example commands above, upload <code class="literal">bundle.pem</code>.
</li>
<li class="listitem">
If you&#8217;re using a pkcs12 certificate that was created using the example commands above, upload <code class="literal">bundle.p12</code>.
</li>
</ol>
</div>
</li>
<li class="listitem">
Return to the <span class="strong strong"><strong>Add CSPM</strong></span> page in Kibana.
</li>
<li class="listitem">
For <span class="strong strong"><strong>Client Certificate Path</strong></span>, enter the full path to the certificate that you uploaded to the host where you will install Elastic Agent.
</li>
<li class="listitem">
If you used a pkcs12 certificate, enter its password under <span class="strong strong"><strong>Client Certificate Password</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Where to add this integration</strong></span>, select <span class="strong strong"><strong>New hosts</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then follow the instructions to install Elastic Agent on your selected host.
</li>
</ol>
</div>
<p>Wait for the confirmation that Kibana received data from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="security-cspm-get-started-gcp.html">« Get started with CSPM for GCP</a>
</span>
<span class="next">
<a href="cspm-required-permissions.html">CSPM privilege requirements »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
