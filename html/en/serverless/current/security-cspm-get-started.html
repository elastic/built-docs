<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="">
<title>Get started with CSPM for AWS | Serverless | Elastic</title>
<meta class="elastic" name="content" content="Get started with CSPM for AWS | Serverless">

<link rel="home" href="index.html" title="Serverless"/>
<link rel="up" href="security-cspm.html" title="Cloud security posture management"/>
<link rel="prev" href="security-cspm.html" title="Cloud security posture management"/>
<link rel="next" href="security-cspm-get-started-gcp.html" title="Get started with CSPM for GCP"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Serverless"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Serverless/Guide"/>
<meta name="DC.subject" content="Serverless"/>
<meta name="DC.identifier" content="main"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt280217a63b82a734/6202d3378b1f312528798412/elastic-logo.svg" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="172" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles-v1.css" />
  </head>

  <!--© 2015-2025 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!-- Google Tag Manager for GA4 -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KNJMG2M');</script>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager for GA4-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  
<div class="navheader">
<span class="prev">
<a href="security-cspm.html">« Cloud security posture management</a>
</span>
<span class="next">
<a href="security-cspm-get-started-gcp.html">Get started with CSPM for GCP »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="what-is-security-serverless.html">Elastic Security Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="security-cloud-native-security-overview.html">Cloud Security</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="security-cspm.html">Cloud security posture management</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Get started with CSPM for AWS</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="security-cspm-get-started"></a>Get started with CSPM for AWS</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
</div></div></div>
<div class="position-relative"><h6><a id="cspm-overview"></a>Overview</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p>This page explains how to get started monitoring the security posture of your cloud assets using the Cloud Security Posture Management (CSPM) feature.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p class="admon_title">Requirements</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Minimum privileges vary depending on whether you need to read, write, or manage CSPM data and integrations. Refer to <a class="xref" href="cspm-required-permissions.html" title="CSPM privilege requirements">CSPM privilege requirements</a>.
</li>
<li class="listitem">
CSPM only works in the <code class="literal">Default</code> Kibana space. Installing the CSPM integration on a different Kibana space will not work.
</li>
<li class="listitem">
CSPM is supported only on AWS, GCP, and Azure commercial cloud platforms, and AWS GovCloud. Other government cloud platforms are not supported (<a href="https://github.com/elastic/kibana/issues/new/choose" class="ulink" target="_top">request support</a>).
</li>
<li class="listitem">
The user who gives the CSPM integration AWS permissions must be an AWS account <code class="literal">admin</code>.
</li>
</ul>
</div>
</div>
</div>
<div class="position-relative"><h6><a id="cspm-setup"></a>Set up CSPM for AWS</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p>You can set up CSPM for AWS either by enrolling a single cloud account, or by enrolling an organization containing multiple accounts. Either way, first you will add the CSPM integration, then enable cloud account access. Two deployment technologies are available: agentless, and agent-based. <a class="xref" href="security-cspm-get-started.html#cspm-aws-agentless" title="Agentless deployment">Agentless deployment</a> allows you to collect cloud posture data without having to manage the deployment of an Elastic Agent in your cloud. <a class="xref" href="security-cspm-get-started.html#cspm-aws-agent-based" title="Agent-based deployment">Agent-based deployment</a> requires you to deploy and manage an Elastic Agent in the cloud account you want to monitor.</p>
<div class="position-relative"><h6><a id="cspm-aws-agentless"></a>Agentless deployment</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p><span class="Admonishment Admonishment--beta">
[<span class="Admonishment-title u-mono">beta</span>]
<span class="Admonishment-detail">
This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.
</span>
</span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Find <span class="strong strong"><strong>Integrations</strong></span> in the navigation menu or use the global search field.
</li>
<li class="listitem">
Search for <code class="literal">CSPM</code>, then click on the result.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM)</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>AWS</strong></span>, then either <span class="strong strong"><strong>AWS Organization</strong></span> to onboard multiple accounts, or <span class="strong strong"><strong>Single Account</strong></span> to onboard an individual account.
</li>
<li class="listitem">
Give your integration a name that matches the purpose or team of the AWS account/organization you want to monitor, for example, <code class="literal">dev-aws-account</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Advanced options</strong></span>, then select <span class="strong strong"><strong>Agentless (BETA)</strong></span>.
</li>
<li class="listitem">
<p>Next, you&#8217;ll need to authenticate to AWS. Two methods are available:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Option 1: Direct access keys/CloudFormation (Recommended). Under <span class="strong strong"><strong>Preferred method</strong></span> select <span class="strong strong"><strong>Direct access keys</strong></span>. Expand the <span class="strong strong"><strong>Steps to Generate AWS Account Credentials</strong></span> section, then follow the displayed instructions to automatically create the necessary credentials using CloudFormation.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you don&#8217;t want to monitor every account in your organization, specify which to monitor using the <code class="literal">OrganizationalUnitIDs</code> field that appears after you click <span class="strong strong"><strong>Launch CloudFormation</strong></span>.</p>
</div>
</div>
</li>
<li class="listitem">
Option 2: Temporary keys. To authenticate using temporary keys, refer to the instructions for <a class="xref" href="security-cspm-get-started.html#cspm-use-temp-credentials" title="Option 3 - Temporary security credentials">Temporary keys</a>.
</li>
</ol>
</div>
</li>
<li class="listitem">
Once you&#8217;ve selected an authentication method and provided all necessary credentials, click <span class="strong strong"><strong>Save and continue</strong></span> to finish deployment. Your data should start to appear within a few minutes.
</li>
</ol>
</div>
<div class="position-relative"><h6><a id="cspm-aws-agent-based"></a>Agent-based deployment</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<div class="position-relative"><h7><a id="cspm-add-and-name-integration"></a>Add the CSPM integration</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Find <span class="strong strong"><strong>Integrations</strong></span> in the navigation menu or use the global search field.
</li>
<li class="listitem">
Search for <code class="literal">CSPM</code>, then click on the result.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM)</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>AWS</strong></span>, then either <span class="strong strong"><strong>AWS Organization</strong></span> to onboard multiple accounts, or <span class="strong strong"><strong>Single Account</strong></span> to onboard an individual account.
</li>
<li class="listitem">
Give your integration a name that matches the purpose or team of the AWS account/organization you want to monitor, for example, <code class="literal">dev-aws-account</code>.
</li>
</ol>
</div>
<div class="position-relative"><h7><a id="cspm-set-up-cloud-access-section"></a>Set up cloud account access</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p>The CSPM integration requires access to AWS&#8217;s built-in <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_job-functions.html#jf_security-auditor" class="ulink" target="_top"><code class="literal">SecurityAudit</code> IAM policy</a> in order to discover and evaluate resources in your cloud account. There are several ways to provide access.</p>
<p>For most use cases, the simplest option is to use AWS CloudFormation to automatically provision the necessary resources and permissions in your AWS account. This method, as well as several manual options, are described below.</p>
<div class="position-relative"><h7><a id="cspm-set-up-cloudformation"></a>CloudFormation (recommended)</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In the <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM) integration</strong></span> menu, under <span class="strong strong"><strong>Setup Access</strong></span>, select <span class="strong strong"><strong>CloudFormation</strong></span>.
</li>
<li class="listitem">
In a new browser tab or window, log in as an admin to the AWS account or organization you want to onboard.
</li>
<li class="listitem">
Return to your Kibana tab. Click <span class="strong strong"><strong>Save and continue</strong></span> at the bottom of the page.
</li>
<li class="listitem">
Review the information, then click <span class="strong strong"><strong>Launch CloudFormation</strong></span>.
</li>
<li class="listitem">
A CloudFormation template appears in a new browser tab.
</li>
<li class="listitem">
For organization-level deployments only, you must enter the ID of the organizational units where you want to deploy into the CloudFormation template&#8217;s <code class="literal">OrganizationalUnitIds</code> field. You can find organizational unit IDs in the AWS console under <span class="strong strong"><strong>AWS Organizations &#8594; AWS Accounts</strong></span> (under each organization&#8217;s name). You can also use this field to specify which accounts in your organization to monitor, and which to skip.
</li>
<li class="listitem">
(Optional) Switch to the AWS region where you want to deploy using the controls in the upper right corner.
</li>
<li class="listitem">
<p>Tick the checkbox under <span class="strong strong"><strong>Capabilities</strong></span> to authorize the creation of necessary resources.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/cspm-get-started/-cloud-native-security-cspm-cloudformation-template.png" alt="The Add permissions screen in AWS">
</div>
</div>
</li>
<li class="listitem">
At the bottom of the template, select <span class="strong strong"><strong>Create stack</strong></span>.
</li>
</ol>
</div>
<p>When you return to Kibana, click <span class="strong strong"><strong>View assets</strong></span> to review the data being collected by your new integration.</p>
<div class="position-relative"><h7><a id="cspm-setup-organization-manual"></a>Manual authentication for organization-level onboarding</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you&#8217;re onboarding a single account instead of an organization, skip this section.</p>
</div>
</div>
<p>When using manual authentication to onboard at the organization level, you need to configure the necessary permissions using the AWS console for the organization where you want to deploy:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>In the organization&#8217;s management account (root account), create an IAM role called <code class="literal">cloudbeat-root</code> (the name is important). The role needs several policies:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>The following inline policy:</p>
<details>
<summary class="title">Click to expand policy</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Action": [
                "organizations:List*",
                "organizations:Describe*"
            ],
            "Resource": "*",
            "Effect": "Allow"
        },
        {
            "Action": [
                "sts:AssumeRole"
            ],
            "Resource": "*",
            "Effect": "Allow"
        }
    ]
}</pre>
</div>
</div>
</details>
</li>
<li class="listitem">
<p>The following trust policy:</p>
<details>
<summary class="title">Click to expand policy</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::&lt;Management Account ID&gt;:root"
            },
            "Action": "sts:AssumeRole"
        },
        {
            "Effect": "Allow",
            "Principal": {
                "Service": "ec2.amazonaws.com"
            },
            "Action": "sts:AssumeRole"
        }
    ]
}</pre>
</div>
</div>
</details>
</li>
<li class="listitem">
The AWS-managed <code class="literal">SecurityAudit</code> policy.
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must replace <code class="literal">&lt;Management account ID&gt;</code> in the trust policy with your AWS account ID.</p>
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Next, for each account you want to scan in the organization, create an IAM role named <code class="literal">cloudbeat-securityaudit</code> with the following policies:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The AWS-managed <code class="literal">SecurityAudit</code> policy.
</li>
<li class="listitem">
<p>The following trust policy:</p>
<details>
<summary class="title">Click to expand policy</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::&lt;Management Account ID&gt;:role/cloudbeat-root"
            },
            "Action": "sts:AssumeRole"
        }
    ]
}</pre>
</div>
</div>
</details>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must replace <code class="literal">&lt;Management account ID&gt;</code> in the trust policy with your AWS account ID.</p>
</div>
</div>
<p>After creating the necessary roles, authenticate using one of the manual authentication methods.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When deploying to an organization using any of the authentication methods below, you need to make sure that the credentials you provide grant permission to assume <code class="literal">cloudbeat-root</code> privileges.</p>
</div>
</div>
<div class="position-relative"><h7><a id="cspm-set-up-manual"></a>Manual authentication methods</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="security-cspm-get-started.html#cspm-use-instance-role" title="Option 1 - Default instance role">Default instance role (recommended)</a>
</li>
<li class="listitem">
<a class="xref" href="security-cspm-get-started.html#cspm-use-keys-directly" title="Option 2 - Direct access keys">Direct access keys</a>
</li>
<li class="listitem">
<a class="xref" href="security-cspm-get-started.html#cspm-use-temp-credentials" title="Option 3 - Temporary security credentials">Temporary security credentials</a>
</li>
<li class="listitem">
<a class="xref" href="security-cspm-get-started.html#cspm-use-a-shared-credentials-file" title="Option 4 - Shared credentials file">Shared credentials file</a>
</li>
<li class="listitem">
<a class="xref" href="security-cspm-get-started.html#cspm-use-iam-arn" title="Option 5 - IAM role Amazon Resource Name (ARN)">IAM role Amazon Resource Name (ARN)</a>
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Whichever method you use to authenticate, make sure AWS’s built-in <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_job-functions.html#jf_security-auditor" class="ulink" target="_top"><code class="literal">SecurityAudit</code> IAM policy</a> is attached.</p>
</div>
</div>
<div class="position-relative"><h8><a id="cspm-use-instance-role"></a>Option 1 - Default instance role</h8><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are deploying to an AWS organization instead of an AWS account, you should already have <a class="xref" href="security-cspm-get-started.html#cspm-setup-organization-manual" title="Manual authentication for organization-level onboarding">created a new role</a>, <code class="literal">cloudbeat-root</code>. Skip to step 2 "Attach your new IAM role to an EC2 instance", and attach this role. You can use either an existing or new EC2 instance.</p>
</div>
</div>
<p>Follow AWS&#8217;s <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" class="ulink" target="_top">IAM roles for Amazon EC2</a> documentation to create an IAM role using the IAM console, which automatically generates an instance profile.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create an IAM role:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In AWS, go to your IAM dashboard. Click <span class="strong strong"><strong>Roles</strong></span>, then <span class="strong strong"><strong>Create role</strong></span>.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Select trusted entity</strong></span> page, under <span class="strong strong"><strong>Trusted entity type</strong></span>, select <span class="strong strong"><strong>AWS service</strong></span>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Use case</strong></span>, select <span class="strong strong"><strong>EC2</strong></span>. Click <span class="strong strong"><strong>Next</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/cspm-get-started/-cloud-native-security-cspm-aws-auth-1.png" alt="The Select trusted entity screen in AWS">
</div>
</div>
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>Add permissions</strong></span> page, search for and select <code class="literal">SecurityAudit</code>. Click <span class="strong strong"><strong>Next</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/cspm-get-started/-cloud-native-security-cspm-aws-auth-2.png" alt="The Add permissions screen in AWS">
</div>
</div>
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Name, review, and create</strong></span> page, name your role, then click <span class="strong strong"><strong>Create role</strong></span>.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Attach your new IAM role to an EC2 instance:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In AWS, select an EC2 instance.
</li>
<li class="listitem">
<p>Select <span class="strong strong"><strong>Actions → Security → Modify IAM role</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/cspm-get-started/-cloud-native-security-cspm-aws-auth-3.png" alt="The EC2 page in AWS" width="showing the Modify IAM role option">
</div>
</div>
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Modify IAM role</strong></span> page, search for and select your new IAM role.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Update IAM role</strong></span>.
</li>
<li class="listitem">
Return to Kibana and <a class="xref" href="security-cspm-get-started.html#cspm-finish-manual" title="Finish manual setup">finish manual setup</a>.
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure to deploy the CSPM integration to this EC2 instance. When completing setup in Kibana, in the <span class="strong strong"><strong>Setup Access</strong></span> section, select <span class="strong strong"><strong>Assume role</strong></span>. Leave <span class="strong strong"><strong>Role ARN</strong></span> empty for agentless deployments. For agent-based deployments, leave it empty unless you want to specify a role the Elastic Agent should assume instead of the default role for your EC2 instance. Click <span class="strong strong"><strong>Save and continue</strong></span>.</p>
</div>
</div>
<div class="position-relative"><h8><a id="cspm-use-keys-directly"></a>Option 2 - Direct access keys</h8><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p>Access keys are long-term credentials for an IAM user or AWS account root user. To use access keys as credentials, you must provide the <code class="literal">Access key ID</code> and the <code class="literal">Secret Access Key</code>. After you provide credentials, <a class="xref" href="security-cspm-get-started.html#cspm-finish-manual" title="Finish manual setup">finish manual setup</a>.</p>
<p>For more details, refer to <a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html" class="ulink" target="_top">Access Keys and Secret Access Keys</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must select <span class="strong strong"><strong>Programmatic access</strong></span> when creating the IAM user.</p>
</div>
</div>
<div class="position-relative"><h8><a id="cspm-use-temp-credentials"></a>Option 3 - Temporary security credentials</h8><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p>You can configure temporary security credentials in AWS to last for a specified duration. They consist of an access key ID, a secret access key, and a session token, which is typically found using <code class="literal">GetSessionToken</code>.</p>
<p>Because temporary security credentials are short term, once they expire, you will need to generate new ones and manually update the integration&#8217;s configuration to continue collecting cloud posture data. Update the credentials before they expire to avoid data loss.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>IAM users with multi-factor authentication (MFA) enabled need to submit an MFA code when calling <code class="literal">GetSessionToken</code>. For more details, refer to AWS&#8217;s <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" class="ulink" target="_top">Temporary Security Credentials</a> documentation.</p>
</div>
</div>
<p>You can use the AWS CLI to generate temporary credentials. For example, you could use the following command if you have MFA enabled:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">sts get-session-token --serial-number arn:aws:iam::1234:mfa/your-email@example.com --duration-seconds 129600 --token-code 123456</pre>
</div>
<div class="console_widget" data-snippet="snippets/32.console"></div>
<p>The output from this command includes the following fields, which you should provide when configuring the KSPM integration:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">Access key ID</code>: The first part of the access key.
</li>
<li class="listitem">
<code class="literal">Secret Access Key</code>: The second part of the access key.
</li>
<li class="listitem">
<code class="literal">Session Token</code>: The required token when using temporary security credentials.
</li>
</ul>
</div>
<p>After you provide credentials, <a class="xref" href="security-cspm-get-started.html#cspm-finish-manual" title="Finish manual setup">finish manual setup</a>.</p>
<div class="position-relative"><h8><a id="cspm-use-a-shared-credentials-file"></a>Option 4 - Shared credentials file</h8><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p>If you use different AWS credentials for different tools or applications, you can use profiles to define multiple access keys in the same configuration file. For more details, refer to AWS' <a href="https://docs.aws.amazon.com/sdkref/latest/guide/file-format.html" class="ulink" target="_top">Shared Credentials Files</a> documentation.</p>
<p>Instead of providing the <code class="literal">Access key ID</code> and <code class="literal">Secret Access Key</code> to the integration, provide the information required to locate the access keys within the shared credentials file:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">Credential Profile Name</code>: The profile name in the shared credentials file.
</li>
<li class="listitem">
<code class="literal">Shared Credential File</code>: The directory of the shared credentials file.
</li>
</ul>
</div>
<p>If you don&#8217;t provide values for all configuration fields, the integration will use these defaults:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If <code class="literal">Access key ID</code>, <code class="literal">Secret Access Key</code>, and <code class="literal">ARN Role</code> are not provided, then the integration will check for <code class="literal">Credential Profile Name</code>.
</li>
<li class="listitem">
If there is no <code class="literal">Credential Profile Name</code>, the default profile will be used.
</li>
<li class="listitem">
<p>If <code class="literal">Shared Credential File</code> is empty, the default directory will be used.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For Linux or Unix, the shared credentials file is located at <code class="literal">~/.aws/credentials</code>.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>After providing credentials, <a class="xref" href="security-cspm-get-started.html#cspm-finish-manual" title="Finish manual setup">finish manual setup</a>.</p>
<div class="position-relative"><h8><a id="cspm-use-iam-arn"></a>Option 5 - IAM role Amazon Resource Name (ARN)</h8><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p>An IAM role Amazon Resource Name (ARN) is an IAM identity that you can create in your AWS account. You define the role&#8217;s permissions. Roles do not have standard long-term credentials such as passwords or access keys. Instead, when you assume a role, it provides temporary security credentials for your session.</p>
<p>To use an IAM role ARN, select <span class="strong strong"><strong>Assume role</strong></span> under <span class="strong strong"><strong>Preferred manual method</strong></span>, enter the ARN, and continue to Finish manual setup.</p>
<div class="position-relative"><h7><a id="cspm-finish-manual"></a>Finish manual setup</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/cloud-native-security/cspm-get-started.asciidoc">edit</a></div>
<p>Once you’ve provided AWS credentials, under <span class="strong strong"><strong>Where to add this integration</strong></span>:</p>
<p>If you want to monitor an AWS account or organization where you have not yet deployed Elastic Agent:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Select <span class="strong strong"><strong>New Hosts</strong></span>.
</li>
<li class="listitem">
Name the Elastic Agent policy. Use a name that matches the purpose or team of the cloud account or accounts you want to monitor. For example, <code class="literal">dev-aws-account</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then <span class="strong strong"><strong>Add Elastic Agent to your hosts</strong></span>. The <span class="strong strong"><strong>Add agent</strong></span> wizard appears and provides Elastic Agent binaries, which you can download and deploy to your AWS account.
</li>
</ul>
</div>
<p>If you want to monitor an AWS account or organization where you have already deployed Elastic Agent:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Select <span class="strong strong"><strong>Existing hosts</strong></span>.
</li>
<li class="listitem">
Select an agent policy that applies the AWS account you want to monitor.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="security-cspm.html">« Cloud security posture management</a>
</span>
<span class="next">
<a href="security-cspm-get-started-gcp.html">Get started with CSPM for GCP »</a>
</span>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?page=docs&placement=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?page=docs&placement=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?page=docs&placement=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>

                        <!-- Feedback widget -->
                        <div id="feedbackWidgetContainer"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


        <div id='elastic-footer'></div>
        <script src='https://www.elastic.co/elastic-footer.js'></script>
        <!-- Footer Section end-->

      </section>
    </div>

    <!-- Feedback modal -->
    <div id="feedbackModalContainer"></div>

    <script src="/guide/static/jquery.js"></script>
    <script type="text/javascript" src="/guide/static/docs-v1.js"></script>
    <script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
