<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>REST API | Elasticsearch Watcher [1.0] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Watcher [1.0]"/>
<link rel="up" href="reference.html" title="Reference"/>
<link rel="prev" href="api-java.html" title="Java API"/>
<link rel="next" href="troubleshooting.html" title="Troubleshooting"/>
<meta name="DC.type" content="Learn/Docs/Legacy/Watcher/Reference/1.0"/>
<meta name="DC.subject" content="Watcher"/>
<meta name="DC.identifier" content="1.0"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
From version 5.0 onward, Watcher is part of X-Pack. For more information, see 
<a href=https://www.elastic.co/guide/en/elastic-stack-overview/current/xpack-alerting.html>Alerting on cluster and index events</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Watcher [1.0]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="reference.html">Reference</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="api-java.html">« Java API</a>
</span>
<span class="next">
<a href="troubleshooting.html">Troubleshooting »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="api-rest"></a>REST API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-put-watch"></a>PUT Watch API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/put-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The PUT watch API either registers a new watch in watcher or update an existing one. Once registered, a new document
will be added to the <code class="literal">.watches</code> index, representing the watch, and the watch&#8217;s trigger will immediately be registered
with the relevant trigger engine (typically the scheduler, for the <code class="literal">schedule</code> trigger).</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Putting a watch must be done via this API only. Do not put a watch directly to the <code class="literal">.watches</code> index
            using Elasticsearch&#8217;s Index API. When integrating with Shield, a best practice is to make sure
            no <code class="literal">write</code> privileges are granted to anyone over the <code class="literal">.watches</code> API.</p>
</div>
</div>
<p>The following example adds a watch with the <code class="literal">my-watch</code> id that has the following qualities:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The watch schedule triggers every minute.
</li>
<li class="listitem">
The watch search input finds any 404 HTTP responses that occurred in the past five minutes.
</li>
<li class="listitem">
The watch condition checks the search results for 404s.
</li>
<li class="listitem">
The watch action sends an email if there are any 404s.
</li>
</ul>
</div>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/watch/my-watch
{
  "trigger" : {
    "schedule" : { "cron" : "0 0/1 * * * ?" }
  },
  "input" : {
    "search" : {
      "request" : {
        "indices" : [
          "logstash*"
        ],
        "body" : {
          "query" : {
            "filtered": {
              "query": {
                "match": { "response": 404 }
              },
              "filter": {
                "range": {
                  "@timestamp" : {
                    "from": "{{ctx.trigger.scheduled_time}}||-5m",
                    "to": "{{ctx.trigger.triggered_time}}"
                 }
                }
              }
            }
          }
        }
      }
    }
  },
  "condition" : {
    "script" : "ctx.payload.hits.total &gt; 1"
  },
  "actions" : {
    "email_admin" : {
        "email" : {
          "to" : "admin@domain.host.com",
          "subject" : "404 recently encountered"
        }
      }
    }
}'</pre>
</div>
<div class="sense_widget" data-snippet="snippets/20.sense"></div>
<p>A watch has the following fields:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">trigger</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="trigger.html" title="Trigger">trigger</a> that defines when the watch should run</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">input</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="input.html" title="Input">input</a> that defines the input that loads the data for the watch</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">condition</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="condition.html" title="Condition">condition</a> that defines if the actions should be run</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">actions</code></p></td>
<td align="left" valign="top"><p>The list of <a class="xref" href="actions.html" title="Actions">actions</a> that will be run if the condition matches</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">meta</code></p></td>
<td align="left" valign="top"><p>Metadata json that will be copied into the history entries.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">throttle_period</code></p></td>
<td align="left" valign="top"><p>The minimum time between actions being run, the default for this is 5 seconds. This default can be changed in the config file with the setting <code class="literal">watcher.throttle.period.default_period</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_timeouts"></a>Timeouts<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/put-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>When updating a watch while it is executing, the put action will block and wait for the watch execution
to finish. Depending on the nature of the watch, in some situations this can take a while. For this reason,
the put watch action is associated with a timeout that is set to 10 seconds by default. You can control this
timeout by passing in the <code class="literal">master_timeout</code> parameter.</p>
<p>The following snippet shows how to change the default timeout of the put action to 30 seconds:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/watch/my-watch?master_timeout=30s</pre>
</div>
<div class="sense_widget" data-snippet="snippets/21.sense"></div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-get-watch"></a>Get Watch API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/get-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>This API retrieves a watch by its id.</p>
<p>The following example gets a watch with <code class="literal">my-watch</code> id:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">GET _watcher/watch/my-watch</pre>
</div>
<div class="sense_widget" data-snippet="snippets/22.sense"></div>
<p>This is an example of the output:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "found": true,
  "_id": "my_watch",
  "_status": { <a id="CO36-1"></a><i class="conum" data-value="1"></i>
    "last_checked": "2015-05-26T18:21:08.630Z",
    "last_met_condition": "2015-05-26T18:21:08.630Z",
    "actions": {
      "email_admin": {
        "ack_status": {
          "timestamp": "2015-05-26T18:21:09.982Z",
          "state": "acked"
        },
        "last_execution": {
          "timestamp": "2015-05-26T18:21:04.106Z",
          "successful": true
        },
        "last_successful_execution": {
          "timestamp": "2015-05-26T18:21:04.106Z",
          "successful": true
        },
        "last_throttle": {
          "timestamp": "2015-05-26T18:21:08.630Z",
          "reason": "throttling interval is set to [5 seconds] but time elapsed since last execution is [4 seconds and 530 milliseconds]"
        }
      }
    }
  },
  "watch": {
    "input": {
      "search": {
        "request": {
          "search_type": "query_then_fetch",
          "indices": [
            "logstash*"
          ],
          "types": [],
          "body": {
            "query": {
              "filtered": {
                "filter": {
                  "range": {
                    "@timestamp": {
                      "from": "{{ctx.trigger.scheduled_time}}||-5m",
                      "to": "{{ctx.trigger.triggered_time}}"
                    }
                  }
                },
                "query": {
                  "match": {
                    "response": 404
                  }
                }
              }
            }
          }
        }
      }
    },
    "condition": {
      "script": {
        "type": "inline",
        "lang": "groovy",
        "params": {},
        "script": "ctx.payload.hits.total &gt; 1"
      }
    },
    "trigger": {
      "schedule": {
        "cron": "0 0/1 * * * ?"
      }
    },
    "actions": {
      "email_admin": {
        "email": {
          "subject": {
            "type": "inline",
            "lang": "mustache",
            "params": {},
            "script": "404 recently encountered"
          },
          "attach_data": false,
          "to": [
            "someone@domain.host.com"
          ]
        }
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The retrieved watch will return with its current status</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-delete-watch"></a>Delete Watch API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/delete-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The DELETE watch API removes a specific watch (identified by its <code class="literal">id</code>) from watcher. Once removed, the document
representing the watch in the <code class="literal">.watches</code> index will be gone and it will never be executed again.</p>
<p>Please note that deleting a watch <span class="strong strong"><strong>does not</strong></span> delete any watch execution records related to this watch from
the <a class="xref" href="watch-history.html" title="Monitoring Watch Execution">Watch History</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Deleting a watch must be done via this API only. Do not delete the watch directly from the <code class="literal">.watches</code> index
            using Elasticsearch&#8217;s DELETE Document API. When integrating with Shield, a best practice is to make sure
            no <code class="literal">write</code> privileges are granted to anyone over the <code class="literal">.watches</code> API.</p>
</div>
</div>
<p>The following example deletes a watch with the <code class="literal">my-watch</code> id:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">DELETE _watcher/watch/my-watch</pre>
</div>
<div class="sense_widget" data-snippet="snippets/23.sense"></div>
<p>This is a sample output</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "found": true,
   "_id": "my_watch",
   "_version": 10
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_timeouts_2"></a>Timeouts<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/delete-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>When deleting a watch while it is executing, the delete action will block and wait for the watch execution
to finish. Depending on the nature of the watch, in some situations this can take a while. For this reason,
the delete watch action is associated with a timeout that is set to 10 seconds by default. You can control this
timeout by passing in the <code class="literal">master_timeout</code> parameter.</p>
<p>The following snippet shows how to change the default timeout of the delete action to 30 seconds:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">DELETE _watcher/watch/my-watch?master_timeout=30s</pre>
</div>
<div class="sense_widget" data-snippet="snippets/24.sense"></div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-execute-watch"></a>Execute Watch API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/execute-watch.asciidoc">edit</a></h3>
</div></div></div>
<p>The execute watch API forces the execution of a stored watch. It can be used to force
execution of the watch outside of its triggering logic, or to test the watch for
debugging purposes.</p>
<p>The following example executes the <code class="literal">my-watch</code> watch:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">POST _watcher/watch/my-watch/_execute</pre>
</div>
<div class="sense_widget" data-snippet="snippets/25.sense"></div>
<p>For testing and debugging purposes, you also have fine-grained control on how the
watch is executed&#8212;&#8203;execute the watch without executing all of its actions or by simply
simulating them. You can also force execution by ignoring the watch&#8217;s condition and
control whether a watch record would be written to the watch history after execution.</p>
<p>This API supports the following fields:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Required</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>trigger_data</p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>This structure is parsed as the data of
                                            the trigger event that will be used during
                                            the watch execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>ignore_condition</p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>When set to <code class="literal">true</code>, the watch execution
                                            uses the <a class="xref" href="condition.html#condition-always" title="Always Condition">Always</a>
                                            Condition.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>alternative_input</p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>When present, the watch uses this object as a payload
                                            instead of executing its own input.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>action_modes</p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>Determines how to handle the watch actions as part
                                            of the watch execution. See
                                            <a class="xref" href="api-rest.html#api-rest-execute-watch-action-mode" title="Action Execution Modes">Action Execution Modes</a>
                                            for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>record_execution</p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>When set to <code class="literal">true</code>, the watch record representing
                                            the watch execution result is persisted to
                                            the <code class="literal">.watch_history</code> index for the current time.
                                            In addition, the status of the watch is
                                            updated, possbily throttling subsequent executions.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>watch</p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>When present, this <a class="xref" href="watch-definition.html" title="Watch Definition">watch</a> is
                                            used instead of the one specified in the request. This
                                            watch is not persisted to the index and record_execution
                                            cannot be set.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The following example shows a comprehensive example of executing the <code class="literal">my-watch</code> watch:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">POST _watcher/watch/my-watch/_execute
{
  "trigger_data" : { <a id="CO37-1"></a><i class="conum" data-value="1"></i>
     "triggered_time" : "now",
     "scheduled_time" : "now"
  },
  "alternative_input" : { <a id="CO37-2"></a><i class="conum" data-value="2"></i>
    "foo" : "bar"
  },
  "ignore_condition" : true, <a id="CO37-3"></a><i class="conum" data-value="3"></i>
  "action_modes" : {
    "my-action" : "force_simulate" <a id="CO37-4"></a><i class="conum" data-value="4"></i>
  },
  "record_execution" : true <a id="CO37-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="sense_widget" data-snippet="snippets/26.sense"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The triggered and schedule times are provided.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The input as defined by the watch is ignored and instead the
provided input will be used as the execution payload.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The condition as defined by the watch will be ignored and will
be assumed to evaluate to <code class="literal">true</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Forces the simulation of <code class="literal">my-action</code>. Forcing the simulation
means that throttling is ignored and the watch is simulated by
Watcher instead of being executed normally.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The execution of the watch will create a watch record in the
watch history, and the throttling state of the watch will
potentially be updated accordingly.</p>
</td>
</tr>
</table>
</div>
<p>This is an example of the output:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "_id": "my-watch_0-2015-06-02T23:17:55.124Z", <a id="CO38-1"></a><i class="conum" data-value="1"></i>
   "watch_record": { <a id="CO38-2"></a><i class="conum" data-value="2"></i>
      "watch_id": "my-watch",
      "trigger_event": {
         "type": "manual",
         "triggered_time": "2015-06-02T23:17:55.124Z",
         "manual": {
            "schedule": {
               "scheduled_time": "2015-06-02T23:17:55.124Z"
            }
         }
      },
      "state": "executed",
      "input": {
         "search": {
            "request": {
               "search_type": "query_then_fetch",
               "indices": [
                  "logstash*"
               ],
               "types": [],
               "body": {
                  "query": {
                     "filtered": {
                        "query": {
                           "match": {
                              "response": 404
                           }
                        },
                        "filter": {
                           "range": {
                              "@timestamp": {
                                 "from": "{{ctx.trigger.scheduled_time}}||-5m",
                                 "to": "{{ctx.trigger.triggered_time}}"
                              }
                           }
                        }
                     }
                  }
               }
            }
         }
      },
      "condition": {
         "script": "ctx.payload.hits.total &gt; 1"
      },
      "result": { <a id="CO38-3"></a><i class="conum" data-value="3"></i>
         "execution_time": "2015-06-02T23:17:55.124Z",
         "execution_duration": 12608,
         "input": {
            "type": "simple",
            "payload": {
               "foo": "bar"
            }
         },
         "condition": {
            "type": "always",
            "met": true
         },
         "actions": [
            {
               "id": "email_admin",
               "type" : "email"
               "status" : "success"
               "email": {
                  "account": "gmail",
                  "email": {
                     "id": "my-watch_0-2015-05-30T01:14:05.319Z",
                     "from": "watcher@example.com",
                     "sent_date": "2015-05-30T01:14:05.319Z",
                     "to": [
                        "admin@domain.host.com"
                     ],
                     "subject": "404 recently encountered"
                  }
               }
            }
         ]
      }
   }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch record as it would be stored in the <code class="literal">.watch_history</code> index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The watch record document as it would be stored in the <code class="literal">.watch_history</code> index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The watch execution results.</p>
</td>
</tr>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="api-rest-execute-watch-action-mode"></a>Action Execution Modes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/execute-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>Action modes define how actions will be handled during the watch execution. There are five
possible modes an action can be associated with:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>simulate</p></td>
<td align="left" valign="top"><p>The action execution will be simulated. Each action type define its own
                      simulation mode. For example, The <a class="xref" href="actions.html#actions-email" title="Email Action">email</a> action
                      will create the email that would have been sent but will not actually
                      send it. In this mode, the action may be throttled if the current state
                      of the watch indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>force_simulate</p></td>
<td align="left" valign="top"><p>Similar to the the <code class="literal">simulate</code> mode, except the action will not be
                      throttled even if the current state of the watch indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>execute</p></td>
<td align="left" valign="top"><p>Executes the action as it would have been executed if the watch would have
                      been triggered by its own trigger. The execution may be throttled if the
                      current state of the watch indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>force_execute</p></td>
<td align="left" valign="top"><p>Similar to the <code class="literal">execute</code> mode, except the action ill not be throttled
                      even if the current state of the watch indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>skip</p></td>
<td align="left" valign="top"><p>The action will be skipped and won&#8217;t be executed or simulated.
                      Effectively forcing the action to be throttled.</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can set a different execution mode for every action by simply associating the mode name
with the action id:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">POST _watcher/watch/my-watch/_execute
{
  "action_modes" : {
    "action1" : "force_simulate",
    "action2" : "skip"
  }
}</pre>
</div>
<div class="sense_widget" data-snippet="snippets/27.sense"></div>
<p>You can also associate a single execution mode with all the watch&#8217;s actions using <code class="literal">_all</code>
as the action id:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">POST _watcher/watch/my-watch/_execute
{
  "action_modes" : {
    "_all" : "force_execute"
  }
}</pre>
</div>
<div class="sense_widget" data-snippet="snippets/28.sense"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="api-rest-execute-inline-watch"></a>Inline Watch Execution<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/execute-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>You can use the Execute API to execute watches that are not yet registered in Watcher by
specifying the watch definition inline. This serves as great tool for testing and debugging
your watches prior to adding them to Watcher.</p>
<p>The following example demonstrates how you can test a watch defintion:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">POST _watcher/watch/_execute
{
  "watch" : {
    "trigger" : { "schedule" : { "interval" : "10s" } },
    "input" : {
      "search" : {
        "request" : {
          "indices" : [ "logs" ],
          "body" : {
            "query" : {
              "match" : { "message": "error" }
            }
          }
        }
      }
    },
    "condition" : {
      "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }}
    },
    "actions" : {
      "log_error" : {
        "logging" : {
          "text" : "Found {{ctx.payload.hits.total}} errors in the logs"
        }
      }
    }
  }
}</pre>
</div>
<p>All other settings for this API still apply take effect when inlining a watch.
In the following snippet, while the watch is defined with a <code class="literal">compare</code> condition,
during execution this condition will be ignored:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">POST _watcher/watch/_execute
{
  "ignore_condition" : true,
  "watch" : {
    "trigger" : { "schedule" : { "interval" : "10s" } },
    "input" : {
      "search" : {
        "request" : {
          "indices" : [ "logs" ],
          "body" : {
            "query" : {
              "match" : { "message": "error" }
            }
          }
        }
      }
    },
    "condition" : {
      "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }}
    },
    "actions" : {
      "log_error" : {
        "logging" : {
          "text" : "Found {{ctx.payload.hits.total}} errors in the logs"
        }
      }
    }
  }
}</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-ack-watch"></a>Ack Watch API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/ack-watch.asciidoc">edit</a></h3>
</div></div></div>
<p><a class="xref" href="actions.html#actions-ack-throttle" title="Acknowledgement and Throttling">Acknowledging</a> a watch enables you to manually throttle
execution of the watch&#8217;s actions. An action&#8217;s <em>acknowledgement state</em> is stored in the
<code class="literal">_status.actions.&lt;id&gt;.ack.state</code> structure.</p>
<p>The current status of a watch and the state of its actions is returned with the watch
definition when you call the <a class="xref" href="api-rest.html#api-rest-get-watch" title="Get Watch API">Get Watch API</a>:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">GET _watcher/watch/&lt;watch_id&gt;</pre>
</div>
<div class="sense_widget" data-snippet="snippets/29.sense"></div>
<p>The action state of a newly-created watch is <code class="literal">awaits_successful_execution</code>.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"_status": {
   ...
   "actions": {
    "action_id": {
     "ack": {
      "timestamp": "2015-05-26T18:04:27.723Z",
      "state": "awaits_successful_execution"
     },
     ...
    }
   }
}</pre>
</div>
<p>When the watch runs and the condition matches, the value of the <code class="literal">ack.state</code> changes
to <code class="literal">ackable</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"_status": {
   ...
   "actions": {
    "action_id": {
     "ack": {
      "timestamp": "2015-05-26T18:19:08.758Z",
      "state": "ackable"
     },
     ...
    }
   }
}</pre>
</div>
<p>Acknowledging the watch action (using the ACK API) sets the value of the <code class="literal">ack.state</code>
to <code class="literal">acked</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"_status": {
   ...
   "actions": {
    "action_id": {
     "ack": {
      "timestamp": "2015-05-26T18:21:09.982Z",
      "state": "acked"
     },
     ...
    }
   }
}</pre>
</div>
<p>Acknowledging an action throttles further executions of that action until its
<code class="literal">ack.state</code> is reset to <code class="literal">awaits_successful_execution</code>. This happens when the watch&#8217;s condition
is checked and is not met (the condition evaluates to <code class="literal">false</code>).</p>
<p>The following snippet shows how to ack a watch action identified by its id. In this example, the
watch id is <code class="literal">my-watch</code> and the id of the action being acknowledged is <code class="literal">my-action</code>:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/watch/my-watch/my-action/_ack</pre>
</div>
<div class="sense_widget" data-snippet="snippets/30.sense"></div>
<p>As a response to this request, the full watch status is returned:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "_status": {
      "last_checked": "2015-05-26T18:21:08.630Z",
      "last_met_condition": "2015-05-26T18:21:08.630Z",
      "actions": {
         "my-action": {
            "ack_status": {
               "timestamp": "2015-05-26T18:21:09.982Z",
               "state": "acked"
            },
            "last_execution": {
               "timestamp": "2015-05-26T18:21:04.106Z",
               "successful": true
            },
            "last_successful_execution": {
               "timestamp": "2015-05-26T18:21:04.106Z",
               "successful": true
            },
            "last_throttle": {
               "timestamp": "2015-05-26T18:21:08.630Z",
               "reason": "throttling interval is set to [5 seconds] but time elapsed since last execution is [4 seconds and 530 milliseconds]"
            }
         }
      }
   }
}</pre>
</div>
<p>You can acknowledge multiple actions by assigning the <code class="literal">actions</code> parameter a
comma-separated list of action ids:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/watch/my-watch/action1,action2/_ack</pre>
</div>
<div class="sense_widget" data-snippet="snippets/31.sense"></div>
<p>To acknowledge all of a watch&#8217;s actions, simply omit the <code class="literal">actions</code> parameter:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/watch/my-watch/_ack</pre>
</div>
<div class="sense_widget" data-snippet="snippets/32.sense"></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_timeouts_3"></a>Timeouts<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/ack-watch.asciidoc">edit</a></h4>
</div></div></div>
<p>If you acknowledge a watch while it is executing, the ack action blocks and waits for the watch
execution to finish. For some watches, this can take a significant amount of time. By default,
the ack watch action has a timeout of 10 seconds. You can change the timeout setting by
specifying the <code class="literal">master_timeout</code> parameter.</p>
<p>The following snippet shows how to change the default timeout of the ack action to 30 seconds:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/watch/my-watch/_ack?master_timeout=30s</pre>
</div>
<div class="sense_widget" data-snippet="snippets/33.sense"></div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-info"></a>Info API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/info.asciidoc">edit</a></h3>
</div></div></div>
<p>The watcher info API gives basic version information on the watcher plugin that is installed.</p>
<p>The following example queries the <code class="literal">info</code> API.</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">GET _watcher</pre>
</div>
<div class="sense_widget" data-snippet="snippets/34.sense"></div>
<p>A successful call returns a JSON structure similar to the following example:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "version": {
      "name" : "1.0.0-Beta2"
      "number": "1.0.0.Beta2", <a id="CO39-1"></a><i class="conum" data-value="1"></i>
      "build_hash": "41f64213d2d370bf66f0e9b839a30a19", <a id="CO39-2"></a><i class="conum" data-value="2"></i>
      "build_timestamp": "2015-04-07T13:34:42Z", <a id="CO39-3"></a><i class="conum" data-value="3"></i>
      "build_snapshot": true <a id="CO39-4"></a><i class="conum" data-value="4"></i>
   }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The build number of the plugin</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The build hash of the plugin</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the plugin was built</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether or not this plugin was a development snapshot build</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-stats"></a>Stats API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/stats.asciidoc">edit</a></h3>
</div></div></div>
<p>The watcher <code class="literal">stats</code> API returns information on the aspects of watcher on your cluster.</p>
<p>The watcher <code class="literal">stats</code> API supports the following request options</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Required</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>metric</p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>What metric should be returned.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The supported metric values:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Metric</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>executing_watches</p></td>
<td align="left" valign="top"><p>Include the current executing watches in the response.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>queued_watches</p></td>
<td align="left" valign="top"><p>Include the watches queued for execution in the response.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>_all</p></td>
<td align="left" valign="top"><p>Include all metrics in the response.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The watcher <code class="literal">stats</code> API always returns basic metrics regardless of the <code class="literal">metric</code> option.</p>
<p>The following example queries the <code class="literal">stats</code> API including the basic metrics:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">GET _watcher/stats</pre>
</div>
<div class="sense_widget" data-snippet="snippets/35.sense"></div>
<p>A successful call returns a JSON structure similar to the following example:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "watcher_state": "started",  <a id="CO40-1"></a><i class="conum" data-value="1"></i>
   "watch_count": 1, <a id="CO40-2"></a><i class="conum" data-value="2"></i>
   "execution_thread_pool": {
      "size": 1000, <a id="CO40-3"></a><i class="conum" data-value="3"></i>
      "max_size": 1 <a id="CO40-4"></a><i class="conum" data-value="4"></i>
   }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The current state of watcher. May be either <code class="literal">started</code>, <code class="literal">starting</code> or <code class="literal">stopped</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of watches currently registered in watcher.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of watches that were triggered and currently queued for execution.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The largest size of the execution thread pool indicating the largest number of concurrent executing watches.</p>
</td>
</tr>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_current_executing_watches_metric"></a>Current executing watches metric<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/stats.asciidoc">edit</a></h4>
</div></div></div>
<p>The current executing watches metric gives insight into the watches that are currently being executed by Watcher.
Per watch that is executing information is shared, like the <code class="literal">watch_id</code>, when execution started and at what phase the
execution is.</p>
<p>To include this metric, the <code class="literal">metric</code> option should be set to <code class="literal">executing_watches</code> or <code class="literal">_all</code>.</p>
<p>The following example specifies the <code class="literal">metric</code> option as a query string argument and will include the basic metrics and
metrics about the current watches being executed:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">GET _watcher/stats?metric=executing_watches</pre>
</div>
<div class="sense_widget" data-snippet="snippets/36.sense"></div>
<p>The following example specifies the <code class="literal">metric</code> option as part of the url path:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">GET _watcher/stats/current_watches</pre>
</div>
<div class="sense_widget" data-snippet="snippets/37.sense"></div>
<p>An example of a successful json response that captures a watch in execution:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "watcher_state": "started",
   "watch_count": 2,
   "execution_thread_pool": {
      "queue_size": 1000,
      "max_size": 20
   },
   "current_watches": [ <a id="CO41-1"></a><i class="conum" data-value="1"></i>
      {
         "watch_id": "slow_condition", <a id="CO41-2"></a><i class="conum" data-value="2"></i>
         "watch_record_id": "slow_condition_3-2015-05-13T07:42:32.179Z", <a id="CO41-3"></a><i class="conum" data-value="3"></i>
         "triggered_time": "2015-05-12T11:53:51.800Z", <a id="CO41-4"></a><i class="conum" data-value="4"></i>
         "execution_time": "2015-05-13T07:42:32.179Z", <a id="CO41-5"></a><i class="conum" data-value="5"></i>
         "execution_phase": "condition" <a id="CO41-6"></a><i class="conum" data-value="6"></i>
      }
   ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of all the Watches that are currently being executed by Watcher. In case of an empty array no executing watches
had been captured. The captured watches are sorted by execution time in descending order. So the longest running watch
is always on top.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch being executed.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch record.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the watch was triggered by the trigger engine.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the watch was executed. This is just before the input is being executed.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO41-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>The current execution phase the watch is in. Can be <code class="literal">input</code>, <code class="literal">condition</code> or <code class="literal">action</code>.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_queued_watches_metric"></a>Queued watches metric<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/stats.asciidoc">edit</a></h4>
</div></div></div>
<p>When a watch triggers it is being prepared for execution and when there is capacity the watch get executed.
If many watches trigger concurrently and there is no capacity to execute then watches are queued up. These watches
are then queued for execution. The queued watches metric gives insight what watches are queued for execution.</p>
<p>To include this metric, the <code class="literal">metric</code> option should include <code class="literal">queued_watches</code> or <code class="literal">_all</code>.</p>
<p>The following example specifies the <code class="literal">queued_watches</code> metric option and will include the basic metrics and
the watches queued for execution:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">GET _watcher/stats/queued_watches</pre>
</div>
<div class="sense_widget" data-snippet="snippets/38.sense"></div>
<p>An example of a successful json response that captures a watch in execution:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "watcher_state": "started",
   "watch_count": 10,
   "execution_thread_pool": {
      "queue_size": 1000,
      "max_size": 20
   },
   "queued_watches": [ <a id="CO42-1"></a><i class="conum" data-value="1"></i>
         {
            "watch_id": "slow_condition4", <a id="CO42-2"></a><i class="conum" data-value="2"></i>
            "watch_record_id": "slow_condition4_223-2015-05-21T11:59:59.811Z", <a id="CO42-3"></a><i class="conum" data-value="3"></i>
            "triggered_time": "2015-05-21T11:59:59.811Z", <a id="CO42-4"></a><i class="conum" data-value="4"></i>
            "execution_time": "2015-05-21T11:59:59.811Z" <a id="CO42-5"></a><i class="conum" data-value="5"></i>
         },
      ...
   ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO42-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of all the Watches that are queued for execution. In case of an empty array no watches are queued for execution.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO42-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch queued for execution.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO42-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch record.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO42-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the watch was triggered by the trigger engine.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO42-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The time the watch was went into a queued state.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-stop"></a>Stop API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/stop.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">stop</code> watcher API stops the watcher service if the service is running, as in the following example:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/_stop</pre>
</div>
<div class="sense_widget" data-snippet="snippets/39.sense"></div>
<p>Watcher returns the following response if the request is successful:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "acknowledged": true
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-start"></a>Start API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/start.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">start</code> watcher API starts the watcher service if the service is not already running, as in the following example:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/_start</pre>
</div>
<div class="sense_widget" data-snippet="snippets/40.sense"></div>
<p>Watcher returns the following response if the request is successful:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "acknowledged": true
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="api-rest-restart"></a>Restart API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/watcher-1.0/docs/public/watcher/reference/rest/restart.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">restart</code> watcher API stops, then starts the watcher service, as in the following example:</p>
<div class="pre_wrapper lang-sense">
<pre class="programlisting prettyprint lang-sense">PUT _watcher/_restart</pre>
</div>
<div class="sense_widget" data-snippet="snippets/41.sense"></div>
<p>Watcher returns the following response if the request is successful:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
   "acknowledged": true
}</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="api-java.html">« Java API</a>
</span>
<span class="next">
<a href="troubleshooting.html">Troubleshooting »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
