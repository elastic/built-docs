<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>User Management and Security | Workplace Search Guide [7.13] | Elastic</title>
<link rel="home" href="index.html" title="Workplace Search Guide [7.13]"/>
<link rel="up" href="workplace-search-administration.html" title="Administration and management"/>
<link rel="prev" href="workplace-search-administration.html" title="Administration and management"/>
<link rel="next" href="workplace-search-groups-management.html" title="Creating and Managing Groups"/>
<meta name="DC.type" content="Learn/Docs/Workplace Search/Guide/7.13"/>
<meta name="DC.subject" content="Workplace Search"/>
<meta name="DC.identifier" content="7.13"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2022 Elasticsearch B.V. -->
  <!-- All Elastic documentation is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. -->
  <!-- http://creativecommons.org/licenses/by-nc-nd/4.0/ -->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container-fluid">
              <div class="row pb-3">
                <div class="col-12 order-2 col-md-4 order-md-1 col-lg-3 h-almost-full-md sticky-top-md" id="left_col">
                  <!-- The TOC is appended here -->
                </div>

                <div class="col-12 order-1 col-md-8 order-md-2 col-lg-7 order-lg-2 guide-section" id="middle_col">
                  <!-- start body -->
                  <div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Workplace Search Guide [7.13]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="workplace-search-administration.html">Administration and management</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="workplace-search-administration.html">« Administration and management</a>
</span>
<span class="next">
<a href="workplace-search-groups-management.html">Creating and Managing Groups »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="workplace-search-security"></a>User Management and Security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.13/workplace-search-docs/guides/administration/user-management.asciidoc">edit</a></h2>
</div></div></div>

<p>"<em>How do I setup and manage self managed Workplace Search security, users, and access roles?</em>"</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Enterprise Search on Elastic Cloud</strong></p>
</div></div></div>
<p>This document describes <em>self-managed</em> Enterprise Search deployments.
Enterprise Search deployments on <em>Elastic Cloud</em> support access by:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The Elastic Cloud user who created the deployment, via Elastic Cloud SSO
</li>
<li class="listitem">
Any additional <em>Elasticsearch native realm</em> users managed through Elasticsearch and Kibana
</li>
</ul>
</div>
<p>If you need to configure your own SAML provider on Elastic Cloud, see <a href="/guide/en/cloud/current/ec-securing-clusters-SAML.html" class="ulink" target="_blank" rel="noopener">Secure your cluster with SAML</a> in the Elastic Cloud documentation.</p>
<p>Elastic Cloud does not support <em>standard authentication</em>, as described below.</p>
</div>
<p>Workplace Search offers three robust user management modes that are directly backed by the Elastic Stack Security features:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong><a class="xref" href="workplace-search-security.html#standard" title="Standard Mode">Standard Mode</a></strong></span>: With the <span class="strong strong"><strong>Standard mode</strong></span>, users are managed by Workplace Search. Using this mode maintains user management within the Workplace Search experience. Users are invited and managed by an administrator via the Workplace Search administrative dashboard.
</li>
<li class="listitem">
<span class="strong strong"><strong><a class="xref" href="workplace-search-security.html#elasticsearch-native-realm" title="Elasticsearch Native Realm">Elasticsearch Native Realm</a></strong></span>: With the <span class="strong strong"><strong>Elasticsearch Native Realm</strong></span>, users are managed at the Elasticsearch layer. If your cluster is already configured to manage users (and their respective role mappings), this may be a straightforward way to roll out user management for your organization. Whether you&#8217;re using Kibana or automating user creation via Elasticsearch APIs, you can configure Workplace Search to inherit user attributes and rely on <span class="strong strong"><strong>Role Mapping</strong></span> to tie existing roles to Workplace Search users and associated permissions.
</li>
<li class="listitem">
<span class="strong strong"><strong><a class="xref" href="workplace-search-security.html#elasticsearch-saml" title="Elasticsearch SAML">Elasticsearch SAML</a></strong></span>: With <span class="strong strong"><strong>Elasticsearch SAML</strong></span>, you may delegate user management to third-party authentication providers and identity management platforms like Auth0 or Okta. In other words, Workplace Search inherits SAML settings and configuration from Elasticsearch itself. <span class="strong strong"><strong>Role Mapping</strong></span> provides an interface to associate SAML-governed roles with Workplace Search users and permissions.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot change the security mode of an existing deployment.
To use a different security mode, you must create a new deployment.</p>
</div>
</div>
<h2><a id="standard"></a>Standard Mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.13/workplace-search-docs/guides/administration/user-management.asciidoc">edit</a></h2>
<p><span class="strong strong"><strong>Standard mode</strong></span> requires configuration for both Elasticsearch and Workplace Search. It is the default user management and security mode.</p>
<hr>
<p><a id="generate-elasticsearch-passwords"></a><span class="strong strong"><strong>Elasticsearch Configuration</strong></span></p>
<p>Within the target Elasticsearch directory, open up the <code class="literal">config/elasticsearch.yml</code> file and enable security features:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.enabled: true
xpack.security.authc.api_key.enabled: true</pre>
</div>
<p>Next, we must set up a password so that Workplace Search can securely connect to Elasticsearch. Elasticsearch provides a password setup utility. Two options are available:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<code class="literal">auto</code> - Elasticsearch generates passwords automatically and prints them to the console.
</li>
<li class="listitem">
<code class="literal">interactive</code> - Use to manually set your own secure passwords.
</li>
</ol>
</div>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">$ bin/elasticsearch-setup-passwords auto</pre>
</div>
<div class="pre_wrapper lang-plain">
<pre class="programlisting prettyprint lang-plain">Changed password for user apm_system
PASSWORD apm_system = xxxxxxxxxxxxxx

Changed password for user kibana
PASSWORD kibana = xxxxxxxxxxxxxx

Changed password for user logstash_system
PASSWORD logstash_system = xxxxxxxxxxxxxx

Changed password for user beats_system
PASSWORD beats_system = xxxxxxxxxxxxxx

Changed password for user remote_monitoring_user
PASSWORD remote_monitoring_user = xxxxxxxxxxxxxx

Changed password for user elastic &lt;&lt;&lt;
PASSWORD elastic = [ELASTIC_PW]</pre>
</div>
<p>Retrieve and store the <span class="strong strong"><strong><code class="literal">elastic</code></strong></span> user credential using care and best practices, and keep them handy for the following Workplace Search configuration steps.</p>
<p><span class="strong strong"><strong>Workplace Search Configuration</strong></span></p>
<p>From the Workplace Search directory, locate the <code class="literal">config/enterprise-search.yml</code> configuration file and add your Elasticsearch credentials:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">ent_search.auth.default.source: standard
elasticsearch.username: elastic
elasticsearch.password: [ELASTIC_PW]</pre>
</div>
<p>Our configuration is complete, with the exception of our default Workplace Search users' password. These are the credentials used to log in to the Workplace Search administrative dashboard:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Default User</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong><code class="literal">elastic</code></strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Default Password</strong></span></p></td>
<td align="left" valign="top"><p>Printed in the console window on the first successful boot sequence of Workplace Search</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you fail to retrieve the password on the initial boot sequence, you must start the installation over with a fresh cluster.</p>
</div>
</div>
<p>You may alternatively choose to set the default user&#8217;s password via an environment variable on the first boot sequence:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">$ ENT_SEARCH_DEFAULT_PASSWORD=some_secure_password bin/enterprise-search</pre>
</div>
<p>You can now use the instructions for <a class="xref" href="workplace-search-smtp-mailer.html" title="Inviting users: SMTP setup">User invitations: SMTP setup</a> and <a class="xref" href="workplace-search-groups-management.html" title="Creating and Managing Groups">Group management</a> to finish settings up Workplace Search for your team.</p>
<h2><a id="elasticsearch-native-realm"></a>Elasticsearch Native Realm<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.13/workplace-search-docs/guides/administration/user-management.asciidoc">edit</a></h2>
<p>Elasticsearch offers user management via its <span class="strong strong"><strong>Native Realm</strong></span>. Conveniently, Workplace Search can use the Elasticsearch user information as a source of truth for identity and access management.</p>
<p><span class="strong strong"><strong>Elasticsearch Configuration</strong></span></p>
<p>From the Elasticsearch directory, locate <code class="literal">config/elasticsearch.yml</code> and povide the following configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.enabled: true
xpack.security.authc.api_key.enabled: true
xpack:
  security:
    authc:
      realms:
        native:
          native1:
            order: 0</pre>
</div>
<p>The Native Realm is now configured. As such, users are stored and managed via Elasticsearch directly.</p>
<p>We&#8217;ve also set <code class="literal">xpack.security.enabled</code> and <code class="literal">xpack.security.authc.api_key.enabled</code> to <code class="literal">true</code>. Additional steps are required to connect to Elasticsearch: follow the <a class="xref" href="workplace-search-security.html#generate-elasticsearch-passwords">standard instructions</a> to use Elasticsearch to create a password.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to the <a href="/guide/en/elasticsearch/reference/7.13/configuring-native-realm.html" class="ulink" target="_top">Elasticsearch Native Realm guide</a> for more information.</p>
</div>
</div>
<p><span class="strong strong"><strong>Workplace Search Configuration</strong></span></p>
<p>From the Workplace Search directory, locate the <code class="literal">config/enterprise-search.yml</code> configuration file and update the <code class="literal">ent_search.auth</code> configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.username: elastic
elasticsearch.password: [ELASTIC_PW]
ent_search.auth.native1.source: elasticsearch-native</pre>
</div>
<p>Restart Workplace Search. Once back up, Workplace Search will now be synchronized with the Native Realm. That&#8217;s the half-way point. Next, we must introduce role mapping.</p>
<h3><a id="role-mapping"></a>Native Realm Role Mapping<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.13/workplace-search-docs/guides/administration/user-management.asciidoc">edit</a></h3>
<p>Workplace Search relies on <span class="strong strong"><strong>Role Mapping</strong></span> to synchronize user information provided by Elasticsearch. In other words: you can use Elasticsearch to create a user and manage your users.</p>
<p>For example, if we create a user named <code class="literal">example_mcuser</code> and provide a password:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">curl -u elastic:[YOUR_KEY] -X POST "localhost:9200/_security/user/example_mcuser" \
-H 'Content-Type: application/json' \
-d '{
  "password" : "example-password"
}'</pre>
</div>
<p>We can then login with <code class="literal">example_mcuser</code> and the <code class="literal">example-password</code>.</p>
<p>Any user you create in this way will have admin privileges until you setup a custom role mapping to define a user&#8217;s access level. The first step is to create a new role within Elasticsearch.</p>
<p>For example, we can create a new blank role called <code class="literal">example_role</code>:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">curl -u elastic:[YOUR_KEY] -X POST "localhost:9200/_xpack/security/role/example_role" \
-H 'Content-Type: application/json' \
-d'{
  "cluster": [],
  "indices": [],
  "applications": [],
  "run_as": [],
  "metadata": {},
  "transient_metadata": {
    "enabled": true
  }
}'</pre>
</div>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "role":{
    "created":true
  }
}</pre>
</div>
<p>This new role now requires a <span class="strong strong"><strong>Role Mapping</strong></span> to assign permissions within Workplace Search.</p>
<p>Locate <span class="strong strong"><strong>Roles</strong></span> in the main navigation.</p>
<p>Select <span class="strong strong"><strong>Add Mapping</strong></span>:</p>
<div id="user-management-1" class="imageblock screenshot">
<div class="content">
<img src="images/role-mapping.png" alt="">
</div>
<div class="title">Figure 1. User Management</div>
</div>
<p>We must define an <span class="strong strong"><strong>Attribute Value</strong></span> for a given <span class="strong strong"><strong>External Attribute</strong></span>.</p>
<p>External in this case means in <span class="strong strong"><strong>Elasticsearch</strong></span>.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">External Attribute</th>
<th align="left" valign="top">Attribute Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>email</strong></span></p></td>
<td align="left" valign="top"><p>Workplace Search requires an email within the Native Realm. Wildcard characters are accepted, i.e. <code class="literal">*@example.com</code> to add everyone within an organization</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>metadata</strong></span></p></td>
<td align="left" valign="top"><p>Workplace Search uses metadata to create generic, flexible role mappings.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>username</strong></span></p></td>
<td align="left" valign="top"><p>Workplace Search matches roles on username. Accepts wildcard characters, like: <code class="literal">*_user</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>role</strong></span></p></td>
<td align="left" valign="top"><p>The Elasticsearch users must contain at least one role. The value list contains a pre-populated list of Elasticsearch roles that are part of the cluster by default.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Our new <code class="literal">example_role</code> now appears as an Attribute Value under <code class="literal">role</code>:</p>
<div id="user-management-2" class="imageblock screenshot">
<div class="content">
<img src="images/role-mapping-es-role.png" alt="">
</div>
<div class="title">Figure 2. User Management</div>
</div>
<p>Once you have selected an <span class="strong strong"><strong>External Attribute</strong></span> and <span class="strong strong"><strong>Attribute Value</strong></span> pair, you must then configure the Workplace Search role. You can provide an access level, <span class="strong strong"><strong>Admin</strong></span> or <span class="strong strong"><strong>User</strong></span>, and Group assignment:</p>
<div id="user-management-3" class="imageblock screenshot">
<div class="content">
<img src="images/role-mapping-group-assignment.png" alt="">
</div>
<div class="title">Figure 3. User Management</div>
</div>
<p>It helps to create your admin group first so that you can login safely while configuring Workplace Search.</p>
<p>Click <span class="strong strong"><strong>Save Role Mapping</strong></span>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using Kibana? Once you have your first role created, you can use Kibana to create users. <a href="/guide/en/elasticsearch/reference/7.13/get-started-users.html" class="ulink" target="_top">Learn more →</a></p>
</div>
</div>
<p>Now that we have created a role mapping, all new users need to match at least one mapping to successfully log in to Workplace Search. In our example, any user with <code class="literal">example_role</code> will be able to access Workplace Search as a <span class="strong strong"><strong>User</strong></span> with <span class="strong strong"><strong>All Groups</strong></span> access.   The following will create such a user:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">curl -u elastic:[YOUR_KEY] -X POST "localhost:9200/_security/user/example_mcuser" \
-H 'Content-Type: application/json' \
-d '{
  "password" : "example-password",
  "roles" : [ "example-role" ]
}'</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><span class="strong strong"><strong>Heads up!</strong></span> If a user matches <span class="strong strong"><strong>two mappings</strong></span>, Workplace Search will select the one which is <span class="strong strong"><strong>more permissive</strong></span>. In other words, if role A provides read access and role B provides write access, a user will inherit the permissions of role B if they have both roles applied.</p>
</div>
</div>
<div class="sidebar">
<a id="security-default-mappings"></a>
<div class="titlepage"><div><div>
<p class="title"><strong>Default Workplace Search mappings for Elastic Stack roles</strong></p>
</div></div></div>
<p>In some cases, Workplace Search maps Elastic Stack roles to Workplace Search roles automatically.</p>
<p>A <em>default</em> mapping applies before you save your own user-defined mappings.
After you save your first mapping in Workplace Search, the product removes all default mappings (except immutable mappings).</p>
<p>An <em>immutable</em> mapping is a special type of default mapping that is <em>never</em> removed.</p>
<p>Workplace Search applies the following default mappings:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Elastic&#160;Stack&#160;role</th>
<th align="left" valign="top">Workplace&#160;Search&#160;role</th>
<th align="left" valign="top">Mapping&#160;type</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">superuser</code></p></td>
<td align="left" valign="top"><p><code class="literal">admin</code></p></td>
<td align="left" valign="top"><p>Immutable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">editor</code></p></td>
<td align="left" valign="top"><p><code class="literal">admin</code></p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">viewer</code></p></td>
<td align="left" valign="top"><p><code class="literal">user</code></p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Any&#160;(1)</p></td>
<td align="left" valign="top"><p><code class="literal">admin</code></p></td>
<td align="left" valign="top"><p>Default</p></td>
</tr>
</tbody>
</table>
</div>
<p>(1) Refers to any other <a href="/guide/en/elasticsearch/reference/7.13/built-in-roles.html" class="ulink" target="_blank" rel="noopener">built-in Elastic Stack role</a> or <a href="/guide/en/elasticsearch/reference/7.13/defining-roles.html" class="ulink" target="_blank" rel="noopener">user-defined Elastic Stack role</a> not shown above.</p>
</div>
<h2><a id="elasticsearch-saml"></a>Elasticsearch SAML<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/7.13/workplace-search-docs/guides/administration/user-management.asciidoc">edit</a></h2>
<p>SAML support for Workplace Search is provided via Elasticsearch. For the sake of this guide, we&#8217;ll use <span class="strong strong"><strong>Auth0</strong></span> to demonstrate how to configure SAML for your orgnization.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>SAML support is agnostic and applies to other platforms such as Okta, for example.</p>
</div>
</div>
<p><span class="strong strong"><strong>Configuring SAML with Auth0</strong></span></p>
<hr>
<p><span class="strong strong"><strong>Step 1.</strong></span> Log in to Auth0 and create a new application:</p>
<div id="saml-1" class="imageblock screenshot">
<div class="content">
<img src="images/auth0-1-create-application.png" alt="Creating a role mapping between Enterprise Search and Elasticsearch.">
</div>
<div class="title">Figure 4. SAML User Management</div>
</div>
<hr>
<p><span class="strong strong"><strong>Step 2.</strong></span> You&#8217;ll want to give it a name - like My SAML App, then select <span class="strong strong"><strong>Regular Web Applications</strong></span>:</p>
<div id="saml-2" class="imageblock screenshot">
<div class="content">
<img src="images/auth0-2-create-application-prompt.png" alt="Creating a role mapping between Enterprise Search and Elasticsearch.">
</div>
<div class="title">Figure 5. SAML User Management</div>
</div>
<hr>
<p><span class="strong strong"><strong>Step 3.</strong></span> Next, access the newly created application and locate <span class="strong strong"><strong>Settings</strong></span>:</p>
<div id="saml-3" class="imageblock screenshot">
<div class="content">
<img src="images/auth0-3-application-settings.png" alt="Creating a role mapping between Enterprise Search and Elasticsearch.">
</div>
<div class="title">Figure 6. SAML User Management</div>
</div>
<hr>
<p><span class="strong strong"><strong>Step 4.</strong></span> Find <span class="strong strong"><strong>Allowed Callback URL</strong></span>. Enter one that is relative to your <code class="literal">ent_search.external_url</code>, such as <code class="literal">http://localhost:3002/users/saml_login</code>, and save:</p>
<div id="saml-4" class="imageblock screenshot">
<div class="content">
<img src="images/add-callback-url.png" alt="Adding a callback URL">
</div>
<div class="title">Figure 7. SAML User Management</div>
</div>
<hr>
<p><span class="strong strong"><strong>Step 5.</strong></span> Locate <span class="strong strong"><strong>Advanced Settings</strong></span> and securely copy the contents of <span class="strong strong"><strong>SAML Metadata URL</strong></span>. This Metadata URL contains XML which we must provide to our cluster. We&#8217;ll do so in the <em>Elasticsearch Configuration</em> step.
:</p>
<div id="saml-5" class="imageblock screenshot">
<div class="content">
<img src="images/auth0-4-show-advanced.png" alt="Adding a callback URL">
</div>
<div class="title">Figure 8. SAML User Management</div>
</div>
<div id="saml-6" class="imageblock screenshot">
<div class="content">
<img src="images/auth0-6-protocol-url.png" alt="A bunch of menu options, of which SAML Metadata URL is one.">
</div>
<div class="title">Figure 9. SAML User Management</div>
</div>
<hr>
<p><span class="strong strong"><strong>Step 6.</strong></span> Back in your application menu, head to the <span class="strong strong"><strong>Addons</strong></span> section. From there, locate and activate SAML 2.0:</p>
<div id="saml-7" class="imageblock screenshot">
<div class="content">
<img src="images/auth0-7-saml-addon.png" alt="Turning on SAML 2.0 in Auth0">
</div>
<div class="title">Figure 10. SAML User Management</div>
</div>
<hr>
<p><span class="strong strong"><strong>Step 7.</strong></span> Finally, create a user by selecting <span class="strong strong"><strong>Users</strong></span> from the main menu and then clicking the <span class="strong strong"><strong>+ Create User</strong></span> button. Fill out the email, a password, and leave connection to its default.</p>
<div id="saml-8" class="imageblock screenshot">
<div class="content">
<img src="images/auth0-saml-create-user.png" alt="reating a user in Auth0">
</div>
<div class="title">Figure 11. SAML User Management</div>
</div>
<p><span class="strong strong"><strong>Elasticsearch Configuration</strong></span></p>
<hr>
<p><span class="strong strong"><strong>Step 1.</strong></span> Within the Elasticsearch directory, locate the <code class="literal">config/elasticsearch.yml</code> file and append:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.enabled: true
xpack.security.authc.api_key.enabled: true
xpack.security.authc.token.enabled: true
xpack.security.transport.ssl.enabled: true

xpack.security.authc.realms.saml.saml_test: # saml_test is our "auth.name" -- we can name anything we'd like: auth0, enterprise_search, etc.
 order: 1
 idp.metadata.path: saml/idp-metadata.xml # We need to create this directory and place the file here.
 idp.entity_id: "urn:dev-abc-1234.auth0.com" # Taken from the SAML Metadata URL
 sp.entity_id: "http://localhost:3002/" # Match these with your external_url.
 sp.acs: "http://localhost:3002/users/saml_login"
 sp.logout: "http://localhost:3002/logout"
 attributes.principal: "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"
 attributes.mail: "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"</pre>
</div>
<hr>
<p><span class="strong strong"><strong>Step 2.</strong></span> Within the <code class="literal">config</code> directory, create a <code class="literal">saml</code> directory and a <code class="literal">idp-metadata.xml</code> file within it.</p>
<hr>
<p><span class="strong strong"><strong>Step 3.</strong></span> Paste the contents of the <span class="strong strong"><strong>SAML Metadata URL</strong></span> file into the <code class="literal">idp-metadata.xml</code> file. The URL has a prefix similar to the example: <code class="literal">dev-abc-1234.auth0.com</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Be sure you have added that string as the <code class="literal">idp.entity_id</code>, prefixed with <code class="literal">urn:</code> as shown above.</p>
</div>
</div>
<hr>
<p><span class="strong strong"><strong>Step 4.</strong></span> Restart Elasticsearch. Changes will take effect upon reboot.</p>
<hr>
<p><span class="strong strong"><strong>Step 5.</strong></span> Follow the <a class="xref" href="workplace-search-security.html#generate-elasticsearch-passwords">Standard Mode instructions</a> to create a password for the <span class="strong strong"><strong><code class="literal">elastic</code></strong></span> user for Elasticsearch. We&#8217;ll use these credentials and resume the SAML configuration within Workplace Search next.</p>
<p><span class="strong strong"><strong>Workplace Search Configuration</strong></span></p>
<p>From the Workplace Search directory, locate the <code class="literal">config/enterprise-search.yml</code> configuration file and update the <code class="literal">ent_search.auth</code> configuration as well as the <code class="literal">elastic</code> password:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.username: elastic
elasticsearch.password: [ELASTIC_PW]

ent_search.auth.saml_test.source: elasticsearch-saml</pre>
</div>
<p>Visit Workplace Search and log in with your SAML provider using the user previously created with Auth0.</p>
<p>Workplace Search is now aware of users managed within Auth0.
However, for those users to access Workplace Search, you must map Workplace Search roles to those users based on their attributes stored in Auth0 (e.g. email, username, role).</p>
<p>Map Workplace Search roles from <em>within Workplace Search</em>.
Although Elasticsearch and Kibana have interfaces for assigning and mapping roles, those settings don&#8217;t apply to Workplace Search.</p>
<p>Use Workplace Search&#8217;s <span class="strong strong"><strong>Role Mapping</strong></span> feature to define all Workplace Search roles.
Refer to the steps in <a class="xref" href="workplace-search-security.html#role-mapping" title="Native Realm Role Mapping">Native Realm Role Mapping</a>, but remember that in this instance you are mapping roles onto users managed in your SAML provider based on their attributes stored within that provider.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="workplace-search-administration.html">« Administration and management</a>
</span>
<span class="next">
<a href="workplace-search-groups-management.html">Creating and Managing Groups »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>

                <div class="col-12 order-3 col-lg-2 order-lg-3 h-almost-full-lg sticky-top-lg" id="right_col">
                  <div id="sticky_content">
                    <!-- The OTP is appended here -->
                    <div class="row">
                      <div class="col-0 col-md-4 col-lg-0" id="bottom_left_col"></div>
                      <div class="col-12 col-md-8 col-lg-12">
                        <div id="rtpcontainer">
                          <div class="mktg-promo" id="most-popular">
                            <p class="aside-heading">Most Popular</p>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Get Started with Elasticsearch</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">Intro to Kibana</p>
                              </a>
                            </div>
                            <div class="pb-2">
                              <p class="media-type">Video</p>
                              <a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">
                                <p class="mb-0">ELK for Logs & Metrics</p>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
