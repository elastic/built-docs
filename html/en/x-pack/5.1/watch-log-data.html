<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Watch Log Data for Errors | X-Pack for the Elastic Stack [5.1] | Elastic</title>
<link rel="home" href="index.html" title="X-Pack for the Elastic Stack [5.1]"/>
<link rel="up" href="watcher-getting-started.html" title="Getting Started with Watcher"/>
<link rel="prev" href="watcher-getting-started.html" title="Getting Started with Watcher"/>
<link rel="next" href="watch-cluster-status.html" title="Watch Your Cluster Health"/>
<meta name="DC.type" content="Learn/Docs/Legacy/XPack/Reference/5.1"/>
<meta name="DC.subject" content="X-Pack"/>
<meta name="DC.identifier" content="5.1"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
<p>
  <strong>WARNING</strong>: Version 5.1 of the Elastic Stack has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
<a href="https://www.elastic.co/guide/index.html">current release documentation</a>.
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">X-Pack for the Elastic Stack [5.1]</a></span>
»
<span class="breadcrumb-link"><a href="xpack-alerting.html">Alerting on Cluster and Index Events</a></span>
»
<span class="breadcrumb-link"><a href="watcher-getting-started.html">Getting Started with Watcher</a></span>
»
<span class="breadcrumb-node">Watch Log Data for Errors</span>
</div>
<div class="navheader">
<span class="prev">
<a href="watcher-getting-started.html">« Getting Started with Watcher</a>
</span>
<span class="next">
<a href="watch-cluster-status.html">Watch Your Cluster Health »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="watch-log-data"></a>Watch Log Data for Errors<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.1/docs/en/watcher/getting-started.asciidoc">edit</a></h2>
</div></div></div>
<p>You can easily configure a watch that periodically checks your log data for
error conditions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="watch-log-data.html#log-add-input" title="Schedule the Watch and Add an Input">Schedule the watch and define an input</a> to search your log
data for error events.
</li>
<li class="listitem">
<a class="xref" href="watch-log-data.html#log-add-condition" title="Add a Condition">Add a condition</a> that checks to see if any errors were
found.
</li>
<li class="listitem">
<a class="xref" href="watch-log-data.html#log-take-action" title="Take Action">Take action</a> if there are any errors.
</li>
</ul>
</div>
<h4><a id="log-add-input"></a>Schedule the Watch and Add an Input<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.1/docs/en/watcher/getting-started.asciidoc">edit</a></h4>
<p>A watch <a class="xref" href="trigger-schedule.html" title="Schedule Trigger">schedule</a> controls how often a watch is triggered.
The watch <a class="xref" href="input.html" title="Inputs">input</a> gets the data that you want to evaluate.</p>
<p>To periodically search your log data and load the results into the watch, you
use an <a class="xref" href="trigger-schedule.html#schedule-interval" title="Interval Schedule">interval</a> schedule and a <a class="xref" href="input-search.html" title="Search Input">search</a>
input. For example, the following Watch searches the <code class="literal">logs</code> index for errors
every 10 seconds:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">PUT _xpack/watcher/watch/errors_in_logs
{
  "trigger" : {
    "schedule" : { "interval" : "10s" } <a id="CO32-1"></a><i class="conum" data-value="1"></i>
  },
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "logs" ],
        "body" : {
          "query" : {
            "match" : { "message": "error" }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO32-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Schedules are typically configured to run less frequently. This example sets
the interval to 10 seconds so you can easily see the watches being triggered.
Since this watch runs so frequently, don&#8217;t forget to <a class="xref" href="watch-log-data.html#log-delete" title="Delete the Watch">delete the watch</a>
when you&#8217;re done experimenting.</p>
</td>
</tr>
</table>
</div>
<p>If you check the watch history you&#8217;ll see that the watch is being triggered every
10 seconds. However, the search isn&#8217;t returning any results so nothing is loaded
into the watch payload.</p>
<p>For example, the following snippet gets the last ten watch executions (a.k.a watch
records) from the watch history:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">GET .watcher-history*/_search?pretty
{
  "sort" : [
    { "result.execution_time" : "desc" }
  ]
}</pre>
</div>
<h4><a id="log-add-condition"></a>Add a Condition<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.1/docs/en/watcher/getting-started.asciidoc">edit</a></h4>
<p>A <a class="xref" href="condition.html" title="Conditions">condition</a> evaluates the data you&#8217;ve loaded into the watch and
determines if any action is required. Since you&#8217;ve defined an input that loads
log errors into the watch, you can define a condition that checks to see if any
errors were found.</p>
<p>For example, you could add a condition that checks to see if the search input
returned any hits.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">PUT _xpack/watcher/watch/errors_in_logs
{
  "trigger" : { "schedule" : { "interval" : "10s" }},
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "logs" ],
        "body" : {
          "query" : {
            "match" : { "message": "error" }
          }
        }
      }
    }
  },
  "condition" : {
    "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }} <a id="CO33-1"></a><i class="conum" data-value="1"></i>
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <a class="xref" href="condition-compare.html" title="Compare Condition">compare</a> condition lets you easily compare against
values in the execution context without enabling dynamic scripting.</p>
</td>
</tr>
</table>
</div>
<p>The condition result is recorded as part of the <code class="literal">watch_record</code> each time the watch
executes. Since there are currently no log events in the <code class="literal">logs</code> index, the watch
condition will not be met. If you search the history for watch executions where
the condition was met during the last 5 seconds, there are no hits:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">GET .watcher-history*/_search?pretty
{
  "query" : {
    "bool" : {
      "must" : [
        { "match" : { "result.condition.met" : true }},
        { "range" : { "result.execution_time" : { "from" : "now-10s" }}}
      ]
    }
  }
}</pre>
</div>
<p>For the condition in the example to evaluate to <code class="literal">true</code>, you need to add an event
to the <code class="literal">logs</code> index that contains an error. For example, the following snippet
adds a 404 error to the <code class="literal">logs</code> index:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">POST logs/event
{
    "timestamp" : "2015-05-17T18:12:07.613Z",
    "request" : "GET index.html",
    "status_code" : 404,
    "message" : "Error: File not found"
}</pre>
</div>
<p>Once you add this event, the next time the watch executes its condition will
evaluate to <code class="literal">true</code>. You can verify this by searching the watch history:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">XGET .watcher-history*/_search?pretty
{
  "query" : {
    "bool" : {
      "must" : [
        { "match" : { "result.condition.met" : true }},
        { "range" : { "result.execution_time" : { "from" : "now-10s" }}}
      ]
    }
  }
}</pre>
</div>
<h4><a id="log-take-action"></a>Take Action<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.1/docs/en/watcher/getting-started.asciidoc">edit</a></h4>
<p>Recording <code class="literal">watch_records</code> in the watch history is nice, but the real power of
Watcher is being able to do something when the watch condition is met. The
watch&#8217;s <a class="xref" href="actions.html" title="Actions">actions</a>  define what to do when the watch condition evaluates
to <code class="literal">true</code>--you can send emails, call third-party webhooks, write documents to an
Elasticsearch or log messages to the standards Elasticsearch log files.</p>
<p>For example, you could add an action to write a message to the Elasticsearch log
when an error is detected.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">PUT _xpack/watcher/watch/log_error_watch
{
  "trigger" : { "schedule" : { "interval" : "10s" }},
  "input" : {
    "search" : {
      "request" : {
        "indices" : [ "logs" ],
        "body" : {
          "query" : {
            "match" : { "message": "error" }
          }
        }
      }
    }
  },
  "condition" : {
    "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }}
  },
  "actions" : {
    "log_error" : {
      "logging" : {
        "text" : "Found {{ctx.payload.hits.total}} errors in the logs"
      }
    }
  }
}</pre>
</div>
<h4><a id="log-delete"></a>Delete the Watch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.1/docs/en/watcher/getting-started.asciidoc">edit</a></h4>
<p>Since the <code class="literal">log_error_watch</code> is configured to run every 10 seconds, make sure you
delete it when you&#8217;re done experimenting. Otherwise, the noise from this sample
watch will make it hard to see what else is going on in your watch history and
log file.</p>
<p>To remove the watch, use the <a class="xref" href="watcher-api-delete-watch.html" title="Delete Watch API">DELETE watch</a> API:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">DELETE _xpack/watcher/watch/log_error_watch</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="watcher-getting-started.html">« Getting Started with Watcher</a>
</span>
<span class="next">
<a href="watch-cluster-status.html">Watch Your Cluster Health »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
