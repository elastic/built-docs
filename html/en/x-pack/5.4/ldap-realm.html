<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>LDAP User Authentication | X-Pack for the Elastic Stack [5.4] | Elastic</title>
<link rel="home" href="index.html" title="X-Pack for the Elastic Stack [5.4]"/>
<link rel="up" href="setting-up-authentication.html" title="Setting Up User Authentication"/>
<link rel="prev" href="native-realm.html" title="Native User Authentication"/>
<link rel="next" href="active-directory-realm.html" title="Active Directory User Authentication"/>
<meta name="DC.type" content="Learn/Docs/Legacy/XPack/Reference/5.4"/>
<meta name="DC.subject" content="X-Pack"/>
<meta name="DC.identifier" content="5.4"/>
<meta name="robots" content="noindex,nofollow"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
<p>
  <strong>WARNING</strong>: Version 5.4 of the Elastic Stack has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
<a href="https://www.elastic.co/guide/index.html">current release documentation</a>.
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">X-Pack for the Elastic Stack [5.4]</a></span>
»
<span class="breadcrumb-link"><a href="xpack-security.html">Securing Elasticsearch and Kibana</a></span>
»
<span class="breadcrumb-link"><a href="setting-up-authentication.html">Setting Up User Authentication</a></span>
»
<span class="breadcrumb-node">LDAP User Authentication</span>
</div>
<div class="navheader">
<span class="prev">
<a href="native-realm.html">« Native User Authentication</a>
</span>
<span class="next">
<a href="active-directory-realm.html">Active Directory User Authentication »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ldap-realm"></a>LDAP User Authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h2>
</div></div></div>
<p>You can configure X-Pack security to communicate with a Lightweight Directory Access
Protocol (LDAP) server to authenticate users. To integrate with LDAP, you
configure an <code class="literal">ldap</code> realm and map LDAP groups to user roles in the
<a class="xref" href="mapping-roles.html" title="Mapping Users and Groups to Roles">role mapping file</a>.</p>
<p>To protect passwords, communications between Elasticsearch and the LDAP server
should be encrypted using SSL/TLS. Clients and nodes that connect via SSL/TLS to
the LDAP server need to have the LDAP server&#8217;s certificate or the server&#8217;s root
CA certificate installed in their <em>keystore</em> or <em>truststore</em>. For more information
about installing certificates, see <a class="xref" href="ldap-realm.html#ldap-ssl" title="Setting up SSL Between Elasticsearch and LDAP">Setting up SSL Between Elasticsearch and LDAP</a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_configuring_an_ldap_realm"></a>Configuring an LDAP Realm<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h3>
</div></div></div>
<p>LDAP stores users and groups hierarchically, similar to the way folders are
grouped in a file system. An LDAP directory&#8217;s hierarchy is built from containers
such as the <em>organizational unit</em> (<code class="literal">ou</code>), <em>organization</em> (<code class="literal">o</code>), and
<em>domain controller</em> (<code class="literal">dc</code>).</p>
<p>The path to an entry is a <em>Distinguished Name</em> (DN) that uniquely identifies a
user or group. User and group names typically have attributes such as a
<em>common name</em> (<code class="literal">cn</code>) or <em>unique ID</em> (<code class="literal">uid</code>). A DN is specified as a string,
for example  <code class="literal">"cn=admin,dc=example,dc=com"</code> (white spaces are ignored).</p>
<p>The <code class="literal">ldap</code> realm supports two modes of operation, a user search mode
and a mode with specific templates for user DNs. See
<a class="xref" href="ldap-realm.html#ldap-settings" title="LDAP Realm Settings">LDAP Realm Settings</a> for all of the options you can set for an
<code class="literal">ldap</code> realm.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ldap-user-search"></a>User Search Mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h4>
</div></div></div>
<p>LDAP user search is the most common mode of operation. In this mode, a specific
user with permission to search the LDAP directory is used to search for the
authenticating user DN based on its username and an LDAP attribute. Once found,
the user will be authenticated by attempting to bind to the LDAP server using the
found DN and the provided password.</p>
<p>To configure an <code class="literal">ldap</code> Realm with User Search:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add a realm configuration of type <code class="literal">ldap</code> to <code class="literal">elasticsearch.yml</code> under the
<code class="literal">xpack.security.authc.realms</code> namespace. At a minimum, you must set the realm <code class="literal">type</code>
to <code class="literal">ldap</code>, specify the <code class="literal">url</code> of the LDAP server, and set <code class="literal">user_search.base_dn</code>
to the container DN where the users are searched for. If you are configuring
multiple realms, you should also explicitly set the <code class="literal">order</code> attribute to control
the order in which the realms are consulted during authentication. See
<a class="xref" href="ldap-realm.html#ldap-settings" title="LDAP Realm Settings">LDAP Realm Settings</a> for all of the options you can set for an
<code class="literal">ldap</code> realm.</p>
<p>For example, the following snippet shows an LDAP realm configured with a user search:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap1:
          type: ldap
          order: 0
          url: "ldaps://ldap.example.com:636"
          bind_dn: "cn=ldapuser, ou=users, o=services, dc=example, dc=com"
          bind_password: changeme
          user_search:
            base_dn: "dc=example,dc=com"
            attribute: cn
          group_search:
            base_dn: "dc=example,dc=com"
          files:
            role_mapping: "CONFIG_DIR/x-pack/role_mapping.yml"
          unmapped_groups_as_roles: false</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you configure realms in <code class="literal">elasticsearch.yml</code>, only the
realms you specify are used for authentication. If you also want to use the
<code class="literal">native</code> or <code class="literal">file</code> realms, you must include them in the realm chain.</p>
</div>
</div>
</li>
<li class="listitem">
Restart Elasticsearch
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_user_dn_templates_mode"></a>User DN Templates Mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h4>
</div></div></div>
<p>If your LDAP environment uses a few specific standard naming conditions for
users, you can use User DN templates to configure the realm. The advantage of
this method is that a search does not have to be performed to find the user DN.
However, multiple bind operations might be needed to find the correct user DN.</p>
<p>To configure an <code class="literal">ldap</code> Realm with User Search:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add a realm configuration of type <code class="literal">ldap</code> to <code class="literal">elasticsearch.yml</code> in the
<code class="literal">xpack.security.authc.realms</code> namespace. At a minimum, you must set the realm <code class="literal">type</code> to
<code class="literal">ldap</code>, specify the <code class="literal">url</code> of the LDAP server, and specify at least one template
with the <code class="literal">user_dn_templates</code> option. If you are configuring multiple realms, you
should also explicitly set the <code class="literal">order</code> attribute to control the order in which
the realms are consulted during authentication. See <a class="xref" href="ldap-realm.html#ldap-settings" title="LDAP Realm Settings">LDAP Realm Settings</a>
for all of the options you can set for an <code class="literal">ldap</code> realm.</p>
<p>For example, the following snippet shows an LDAP realm configured with User DN templates:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap1:
          type: ldap
          order: 0
          url: "ldaps://ldap.example.com:636"
          user_dn_templates:
            - "cn={0}, ou=users, o=marketing, dc=example, dc=com"
            - "cn={0}, ou=users, o=engineering, dc=example, dc=com"
          group_search:
            base_dn: "dc=example,dc=com"
          files:
            role_mapping: "/mnt/elasticsearch/group_to_role_mapping.yml"
          unmapped_groups_as_roles: false</pre>
</div>
</li>
<li class="listitem">
Restart Elasticsearch
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ldap-load-balancing"></a>Load Balancing and Failover<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">load_balance.type</code> setting can be used at the realm level to configure how
X-Pack security should interact with multiple LDAP servers. X-Pack security supports both
failover and load balancing modes of operation.</p>
<div class="table">
<p class="title"><strong>Table 5. Load Balancing and Failover Types</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Load Balancing and Failover Types">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Type</p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Description</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">failover</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>The URLs specified are used in the order that they are specified.
                          The first server that can be connected to will be used for all
                          subsequent connections. If a connection to that server fails then
                          the next server that a connection can be established to will be
                          used for subsequent connections.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">dns_failover</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>In this mode of operation, only a single URL may be specified.
                          This URL must contain a DNS name. The system will be queried for
                          all IP addresses that correspond to this DNS name. Connections to
                          the LDAP server will always be tried in the order in which they
                          were retrieved. This differs from <code class="literal">failover</code> in that there is no
                          reordering of the list and if a server has failed at the beginning
                          of the list, it will still be tried for each subsequent connection.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">round_robin</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Connections will continuously iterate through the list of provided
                          URLs. If a server is unavailable, iterating through the list of
                          URLs will continue until a successful connection is made.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">dns_round_robin</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>In this mode of operation, only a single URL may be specified. This
                          URL must contain a DNS name. The system will be queried for all IP
                          addresses that correspond to this DNS name. Connections will
                          continuously iterate through the list of addresses. If a server is
                          unavailable, iterating through the list of URLs will continue until
                          a successful connection is made.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ldap-settings"></a>LDAP Realm Settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h4>
</div></div></div>
<div class="table">
<p class="title"><strong>Table 6. Common LDAP Realm Settings</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Common LDAP Realm Settings">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Setting</p></td>
<td align="center" valign="top"><p>Required</p></td>
<td align="left" valign="top"><p>Description</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">type</code></p></td>
<td align="center" valign="top"><p>yes</p></td>
<td align="left" valign="top"><p>Indicates the realm type. Must be set to <code class="literal">ldap</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">order</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Indicates the priority of this realm within the realm
                                              chain. Realms with a lower order are consulted first.
                                              Although not required, we recommend explicitly
                                              setting this value when you configure multiple realms.
                                              Defaults to <code class="literal">Integer.MAX_VALUE</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">enabled</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Indicates whether this realm is enabled or disabled.
                                              Enables you to disable a realm without removing its
                                              configuration. Defaults to <code class="literal">true</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">url</code></p></td>
<td align="center" valign="top"><p>yes</p></td>
<td align="left" valign="top"><p>Specifies one or more LDAP URLs of the form of
                                              <code class="literal">ldap[s]://&lt;server&gt;:&lt;port&gt;</code>. Multiple URLs can be
                                              defined using a comma separated value or array syntax:
                                              <code class="literal">[ "ldaps://server1:636", "ldaps://server2:636" ]</code>.
                                              <code class="literal">ldaps</code> and <code class="literal">ldap</code> URL protocols cannot be mixed in
                                              the same realm.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">load_balance.type</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The behavior to use when there are multiple LDAP URLs
                                              defined. For supported values see
                                              <a class="xref" href="ldap-realm.html#ldap-load-balancing" title="Load Balancing and Failover">LDAP load balancing and failover types</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">load_balance.cache_ttl</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>When using <code class="literal">dns_failover</code> or <code class="literal">dns_round_robin</code> as the
                                              load balancing type, this setting controls the amount of time
                                              to cache DNS lookups. Defaults to <code class="literal">1h</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_group_attribute</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the attribute to examine on the user for group
                                              membership. The default is <code class="literal">memberOf</code>. This setting will
                                              be ignored if any <code class="literal">group_search</code> settings are specified.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">group_search.base_dn</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies a container DN to search for groups in which
                                              the user has membership. When this element is absent,
                                              Security searches for the attribute specified by
                                              <code class="literal">user_group_attribute</code> set on the user to determine
                                              group membership.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">group_search.scope</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies whether the group search should be
                                              <code class="literal">sub_tree</code>, <code class="literal">one_level</code> or <code class="literal">base</code>.  <code class="literal">one_level</code> only
                                              searches objects directly contained within the
                                              <code class="literal">base_dn</code>. The default <code class="literal">sub_tree</code> searches all objects
                                              contained under <code class="literal">base_dn</code>. <code class="literal">base</code> specifies that the
                                              <code class="literal">base_dn</code> is a group object, and that it is the only
                                              group considered.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">group_search.filter</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies a filter to use to lookup a group. If not
                                              set, the realm searches for <code class="literal">group</code>,
                                              <code class="literal">groupOfNames</code>, <code class="literal">groupOfUniqueNames</code>, or <code class="literal">posixGroup</code> with the
                                              attributes <code class="literal">member</code>, <code class="literal">memberOf</code>, or <code class="literal">memberUid</code>. Any instance of
                                              <code class="literal">{0}</code> in the filter is replaced by the user
                                              attribute defined in <code class="literal">group_search.user_attribute</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">group_search.user_attribute</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the user attribute that is fetched and
                                              provided as a parameter to the filter.  If not set,
                                              the user DN is passed to the filter.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">unmapped_groups_as_roles</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies whether the names of any unmapped LDAP groups
                                              should be used as role names and assigned to the user.
                                              Defaults to <code class="literal">false</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">timeout.tcp_connect</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the TCP connect timeout period for establishing an
                                              LDAP connection. An <code class="literal">s</code> at the end indicates seconds, or <code class="literal">ms</code>
                                              indicates milliseconds. Defaults to <code class="literal">5s</code> (5 seconds).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">timeout.tcp_read</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the TCP read timeout period after establishing an LDAP connection.
                                              An <code class="literal">s</code> at the end indicates seconds, or <code class="literal">ms</code> indicates milliseconds.
                                              Defaults to <code class="literal">5s</code> (5 seconds).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">timeout.ldap_search</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the LDAP Server enforced timeout period for an LDAP search.
                                              An <code class="literal">s</code> at the end indicates seconds, or <code class="literal">ms</code> indicates milliseconds.
                                              Defaults to <code class="literal">5s</code> (5 seconds).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">files.role_mapping</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the path and file name for the
                                              <a class="xref" href="mapping-roles.html#ldap-role-mapping">YAML role mapping configuration file</a>.
                                              Defaults to <code class="literal">ES_HOME/config/x-pack/role_mapping.yml</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">follow_referrals</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies whether X-Pack security should follow referrals
                                              returned by the LDAP server. Referrals are URLs returned by
                                              the server that are to be used to continue the LDAP operation
                                              (e.g. search). Defaults to <code class="literal">true</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.key</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the path to the PEM encoded private key to use if the LDAP
                                              server requires client authentication. <code class="literal">ssl.key</code> and <code class="literal">ssl.keystore.path</code>
                                              may not be used at the same time.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.key_passphrase</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the passphrase to decrypt the PEM encoded private key if it is encrypted.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.certificate</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the path to the PEM encoded certificate (or certificate chain) that goes with the
                                              key if the LDAP server requires client authentication.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.certificate_authorities</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the paths to the PEM encoded certificate authority certificates that
                                              should be trusted. <code class="literal">ssl.certificate_authorities</code> and <code class="literal">ssl.truststore.path</code> may not be used
                                              at the same time.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.keystore.path</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The path to the Java Keystore file that contains a private key and certificate. <code class="literal">ssl.key</code> and
                                              <code class="literal">ssl.keystore.path</code> may not be used at the same time.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.keystore.password</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The password to the keystore.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.keystore.key_password</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The password for the key in the keystore. Defaults to the keystore password.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.truststore.path</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The path to the Java Keystore file that contains the certificates to trust.
                                              <code class="literal">ssl.certificate_authorities</code> and <code class="literal">ssl.truststore.path</code> may not be used at the same time.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.truststore.password</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The password to the truststore.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.verification_mode</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the type of verification to be performed when
                                              connecting to a LDAP server using <code class="literal">ldaps</code>. When
                                              set to <code class="literal">full</code>, the hostname or IP address used in the <code class="literal">url</code>
                                              must match one of the names in the certificate or the
                                              connection will not be allowed. Due to their potential security impact,
                                              <code class="literal">ssl</code> settings are not exposed via the
                                              <a href="http://www.elastic.co/guide/en/elasticsearch/reference/5.4/cluster-nodes-info.html#cluster-nodes-info" class="ulink" target="_top">nodes info API</a>.
                                              Values are <code class="literal">none</code>, <code class="literal">certificate</code>, and <code class="literal">full</code>. Defaults to <code class="literal">full</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.supported_protocols</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the supported protocols for SSL/TLS.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl.cipher_suites</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the cipher suites that should be supported when communicating
                                              with the LDAP server.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">cache.ttl</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the time-to-live for cached user entries. A
                                              user&#8217;s credentials are cached for this period of time.
                                              Specify the time period using the standard Elasticsearch
                                              <a href="http://www.elastic.co/guide/en/elasticsearch/reference/5.4/common-options.html#time-units" class="ulink" target="_top">time units</a>.
                                              Defaults to <code class="literal">20m</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">cache.max_users</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the maximum number of user entries that can be
                                              stored in the cache at one time. Defaults to 100,000.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">cache.hash_algo</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the hashing algorithm that is used for the
                                              cached user credentials. See
                                              <a class="xref" href="controlling-user-cache.html#cache-hash-algo" title="Cache hash algorithms">Cache hash algorithms</a> for the possible
                                              values. (Expert Setting).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 7. User Search Mode Settings</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="User Search Mode Settings">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Setting</p></td>
<td align="left" valign="top"><p>Required</p></td>
<td align="left" valign="top"><p>Description</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">bind_dn</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The DN of the user that is used to bind to the LDAP
                                                        and perform searches. If not specified, an anonymous
                                                        bind is attempted. Due to its potential security
                                                        impact, <code class="literal">bind_dn</code> is not exposed via the
                                                        <a href="http://www.elastic.co/guide/en/elasticsearch/reference/5.4/cluster-nodes-info.html#cluster-nodes-info" class="ulink" target="_top">nodes info API</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">bind_password</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The password for the user that is used to bind to the
                                                        LDAP. Due to its potential security impact,
                                                        <code class="literal">bind_password</code> is not exposed via the
                                                        <a href="http://www.elastic.co/guide/en/elasticsearch/reference/5.4/cluster-nodes-info.html#cluster-nodes-info" class="ulink" target="_top">nodes info API</a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.base_dn</code></p></td>
<td align="left" valign="top"><p>yes</p></td>
<td align="left" valign="top"><p>Specifies a container DN to search for users.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.scope</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The scope of the user search. Valid values are <code class="literal">sub_tree</code>,
                                                        <code class="literal">one_level</code> or <code class="literal">base</code>. <code class="literal">one_level</code> only searches objects
                                                        directly contained within the <code class="literal">base_dn</code>. <code class="literal">sub_tree</code> searches
                                                        all objects contained under <code class="literal">base_dn</code>. <code class="literal">base</code> specifies
                                                        that the <code class="literal">base_dn</code> is the user object, and that it is the
                                                        only user considered. Defaults to <code class="literal">sub_tree</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.attribute</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the attribute to match with the username presented
                                                        to. Defaults to <code class="literal">uid</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.pool.enabled</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Enables or disables connection pooling for user search. When
                                                        disabled a new connection is created for every search. The
                                                        default is <code class="literal">true</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.pool.size</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Specifies the maximum number of connections to the LDAP
                                                        server to allow in the connection pool. Defaults to <code class="literal">20</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.pool.initial_size</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The initial number of connections to create to the LDAP
                                                        server on startup. Defaults to <code class="literal">0</code>. Values greater than <code class="literal">0</code>
                                                        could cause startup failures if the LDAP server is down.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.pool.health_check.enabled</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Enables or disables a health check on LDAP connections in
                                                        the connection pool. Connections are checked in the
                                                        background at the specified interval. Defaults to <code class="literal">true</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.pool.health_check.dn</code></p></td>
<td align="left" valign="top"><p>no/yes</p></td>
<td align="left" valign="top"><p>Specifies the distinguished name to retrieve as part of
                                                        the health check. Defaults to the value of <code class="literal">bind_dn</code>.
                                                        This setting is required when <code class="literal">bind_dn</code> is not configured.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_search.pool.health_check.interval</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>How often to perform background checks of connections in
                                                        the pool. Defaults to <code class="literal">60s</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 8. User Templates Mode Settings</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="User Templates Mode Settings">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Setting</p></td>
<td align="center" valign="top"><p>Required</p></td>
<td align="left" valign="top"><p>Description</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user_dn_templates</code></p></td>
<td align="center" valign="top"><p>yes</p></td>
<td align="left" valign="top"><p>Specifies the DN template that replaces the
                                      user name with the string <code class="literal">{0}</code>. This element
                                      is multivalued, allowing for multiple user
                                      contexts.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If any settings starting with <code class="literal">user_search</code> are specified, the
        <code class="literal">user_dn_templates</code> the settings are ignored.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="mapping-roles-ldap"></a>Mapping LDAP Groups to Roles<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h3>
</div></div></div>
<p>An integral part of a realm authentication process is to resolve the roles
associated with the authenticated user. Roles define the privileges a user has
in the cluster.</p>
<p>Since with the <code class="literal">ldap</code> realm the users are managed externally in the LDAP server,
the expectation is that their roles are managed there as well. If fact, LDAP
supports the notion of groups, which often represent user roles for different
systems in the organization.</p>
<p>The <code class="literal">ldap</code> realm enables you to map LDAP groups to roles in the role mapping
file stored on each node. When a user authenticates with LDAP, the privileges
for that user are the union of all privileges defined by the roles assigned to
the set of groups that the user belongs to.</p>
<p>You specify groups using their distinguished names. For example, the following
mapping configuration maps the LDAP <code class="literal">admins</code> group to both the <code class="literal">monitoring</code> and
<code class="literal">user</code> roles, and maps the <code class="literal">users</code> group to the <code class="literal">user</code> role.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">monitoring: <a id="CO5-1"></a><i class="conum" data-value="1"></i>
  - "cn=admins,dc=example,dc=com" <a id="CO5-2"></a><i class="conum" data-value="2"></i>
user:
  - "cn=users,dc=example,dc=com" <a id="CO5-3"></a><i class="conum" data-value="3"></i>
  - "cn=admins,dc=example,dc=com"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO5-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the mapped role.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO5-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The LDAP distinguished name (DN) of the <code class="literal">admins</code> group.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO5-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The LDAP distinguished name (DN) of the <code class="literal">users</code> group.</p>
</td>
</tr>
</table>
</div>
<p>For more information, see <a class="xref" href="mapping-roles.html" title="Mapping Users and Groups to Roles">Mapping Users and Groups to Roles</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ldap-user-metadata"></a>User Metadata in LDAP Realms<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h3>
</div></div></div>
<p>When a user is authenticated via an LDAP realm, the following properties are
populated in user&#8217;s <em>metadata</em>. This metadata is returned in the
<a class="xref" href="security-api-authenticate.html" title="Authenticate API">authenticate API</a>, and can be used with
<a class="xref" href="field-and-document-access-control.html#templating-role-query" title="Templating a Role Query">templated queries</a> in roles.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Field</p></td>
<td align="left" valign="top"><p>Description</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ldap_dn</code></p></td>
<td align="left" valign="top"><p>The distinguished name of the user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ldap_groups</code></p></td>
<td align="left" valign="top"><p>The distinguished name of each of the groups that were
                        resolved for the user (regardless of whether those
                        groups were mapped to a role).</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ldap-ssl"></a>Setting up SSL Between Elasticsearch and LDAP<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack-elasticsearch/edit/5.4/docs/en/security/authentication/ldap-realm.asciidoc">edit</a></h3>
</div></div></div>
<p>To protect the user credentials that are sent for authentication, it&#8217;s highly
recommended to encrypt communications between Elasticsearch and your LDAP server.
Connecting via SSL/TLS ensures that the identity of the LDAP server is
authenticated before X-Pack security transmits the user credentials and the contents
of the connection are encrypted.</p>
<p>To encrypt communications between Elasticsearch and your LDAP server:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Configure the realm&#8217;s SSL settings on each node to trust certificates signed by the CA that signed your
LDAP server certificates. The following example demonstrates how to trust a CA certificate,
<code class="literal">cacert.pem</code>, located within the X-Pack configuration directory:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">xpack:
  security:
    authc:
      realms:
        ldap1:
          type: ldap
          order: 0
          url: "ldaps://ldap.example.com:636"
          ssl:
            certificate_authorities: [ "CONFIG_DIR/x-pack/cacert.pem" ]</pre>
</div>
<p>The CA cert must be a PEM encoded certificate.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also specify the individual server certificates rather than the CA
certificate, but this is only recommended if you have a single LDAP server
or the certificates are self-signed.</p>
</div>
</div>
</li>
<li class="listitem">
Set the <code class="literal">url</code> attribute in the realm configuration to specify the LDAPS
protocol and the secure port number. For example, <code class="literal">url: ldaps://ldap.example.com:636</code>.
</li>
<li class="listitem">
Restart Elasticsearch.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>By default, when you configure X-Pack security to connect to an LDAP server
      using SSL/TLS, X-Pack security attempts to verify the hostname or IP address
      specified with the <code class="literal">url</code> attribute in the realm configuration with the
      values in the certificate. If the values in the certificate and realm
      configuration do not match, X-Pack security does not allow a connection to the
      LDAP server. This is done to protect against man-in-the-middle attacks. If
      necessary, you can disable this behavior by setting the
      <code class="literal">ssl.verification_mode</code> property to <code class="literal">none</code>.</p>
</div>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="native-realm.html">« Native User Authentication</a>
</span>
<span class="next">
<a href="active-directory-realm.html">Active Directory User Authentication »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
