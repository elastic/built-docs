<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Agent version 1.x | APM Java Agent Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="APM Java Agent Reference [master]"/>
<link rel="up" href="release-notes.html" title="Release notes"/>
<link rel="prev" href="_unreleased.html" title="Unreleased"/>
<link rel="next" href="release-notes-0.8.x.html" title="Java Agent version 0.8.x"/>
<meta name="DC.type" content="Learn/Docs/APM Java Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">APM Java Agent Reference [master]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="release-notes.html">Release notes</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="_unreleased.html">« Unreleased</a>
</span>
<span class="next">
<a href="release-notes-0.8.x.html">Java Agent version 0.8.x »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="release-notes-1.x"></a>Java Agent version 1.x<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.35.0"></a>1.35.0 - 2022/12/06<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_2"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add support for log correlation for <code class="literal">java.util.logging</code> (JUL) - <a href="https://github.com/elastic/apm-agent-java/pull/2724" class="ulink" target="_top">#2724</a>
</li>
<li class="listitem">
Add support for spring-kafka batch listeners - <a href="https://github.com/elastic/apm-agent-java/pull/2815" class="ulink" target="_top">#2815</a>
</li>
<li class="listitem">
Improved instrumentation for legacy Apache HttpClient (when not using an <code class="literal">HttpUriRequest</code>, such as <code class="literal">BasicHttpRequest</code>)
</li>
<li class="listitem">
Prevented exclusion of agent-packages via <code class="literal">classes_excluded_from_instrumentation</code> to avoid unintended side effects
</li>
<li class="listitem">
Add Tomcat support for log reformatting - <a href="https://github.com/elastic/apm-agent-java/pull/2839" class="ulink" target="_top">#2839</a>
</li>
<li class="listitem">
Capture Elastic cluster name on Elastic Cloud - <a href="https://github.com/elastic/apm-agent-java/pull/2796" class="ulink" target="_top">#2796</a>
</li>
<li class="listitem">
Attacher CLI: added a <code class="literal">--no-fork</code> config to opt out from executing a forked process as different user.If <code class="literal">--no-fork</code> is used alongside discovery rules that contain only <code class="literal">--include-pid</code> rules, the attacher will not execute JVM discovery - <a href="https://github.com/elastic/apm-agent-java/pull/2863" class="ulink" target="_top">#2863</a>
</li>
<li class="listitem">
Add the option to instrument very old bytecode through the <a class="xref" href="config-core.html#config-instrument-ancient-bytecode" title="instrument_ancient_bytecode ()"><code class="literal">instrument_ancient_bytecode</code></a> config option - <a href="https://github.com/elastic/apm-agent-java/pull/2866" class="ulink" target="_top">#2866</a>
</li>
<li class="listitem">
Capture MongoDB statements - <a href="https://github.com/elastic/apm-agent-java/pull/2806" class="ulink" target="_top">#2806</a>
</li>
<li class="listitem">
Added agent health and background overhead metrics (experimental) - <a href="https://github.com/elastic/apm-agent-java/pull/2864" class="ulink" target="_top">#2864</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2888" class="ulink" target="_top">#2888</a>
</li>
<li class="listitem">
Added support for Finagle Http Client - <a href="https://github.com/elastic/apm-agent-java/pull/2795" class="ulink" target="_top">#2795</a>
</li>
<li class="listitem">
Add support for Apache HTTP client 3.x - <a href="https://github.com/elastic/apm-agent-java/pull/2853" class="ulink" target="_top">#2853</a>
</li>
<li class="listitem">
Made <code class="literal">api_key</code> and <code class="literal">secret_token</code> configuration options dynamic - <a href="https://github.com/elastic/apm-agent-java/pull/2889" class="ulink" target="_top">#2889</a>
</li>
<li class="listitem">
Misaligned micrometer interval vs Elastic agent metrics reporting interval now handled - <a href="https://github.com/elastic/apm-agent-java/pull/2801" class="ulink" target="_top">#2801</a>
</li>
<li class="listitem">
Histograms now reported from micrometer metrics - <a href="https://github.com/elastic/apm-agent-java/pull/2895" class="ulink" target="_top">#2895</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_2"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Remove <code class="literal">context.db</code> fields from S3 instrumentation - <a href="https://github.com/elastic/apm-agent-java/pull/2821" class="ulink" target="_top">#2821</a>
</li>
<li class="listitem">
Allowed OpenTelemetry <code class="literal">Span.updateName</code> to update names provided by elastic - <a href="https://github.com/elastic/apm-agent-java/pull/2838" class="ulink" target="_top">#2838</a>
</li>
<li class="listitem">
Prevent random <code class="literal">NullPointerException</code> when span compression is not possible - <a href="https://github.com/elastic/apm-agent-java/pull/2859" class="ulink" target="_top">#2859</a>
</li>
<li class="listitem">
Fix security manager issues on OpenJDK 17, with errors like: <code class="literal">java.lang.UnsupportedOperationException: Could not access Unsafe class</code> -
<a href="https://github.com/elastic/apm-agent-java/pull/2874" class="ulink" target="_top">#2874</a>
</li>
<li class="listitem">
Fix security manager compatibility with Tomcat - <a href="https://github.com/elastic/apm-agent-java/pull/2871" class="ulink" target="_top">#2871</a> and <a href="https://github.com/elastic/apm-agent-java/pull/2883" class="ulink" target="_top">#2883</a>
</li>
<li class="listitem">
Fix NPE with Spring MVC - <a href="https://github.com/elastic/apm-agent-java/pull/2896" class="ulink" target="_top">#2896</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.34.1"></a>1.34.1 - 2022/09/29<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_3"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Redact <code class="literal">*principal*</code> headers by default - <a href="https://github.com/elastic/apm-agent-java/pull/2798" class="ulink" target="_top">#2798</a>
</li>
</ul>
</div>
<h5><a id="_refactorings"></a>Refactorings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Activation stack was extracted from <code class="literal">ElasticApmTracer</code> into a separate class, where it also enforces a stack depth to eliminate
activation leaks - <a href="https://github.com/elastic/apm-agent-java/pull/2783" class="ulink" target="_top">#2783</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_3"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix imports (leading to <code class="literal">NoClassDefFoundError</code>) in the AWS SDK instrumentation - <a href="https://github.com/elastic/apm-agent-java/pull/2800" class="ulink" target="_top">#2800</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.34.0"></a>1.34.0 - 2022/09/14<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_refactorings_2"></a>Refactorings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Changed the main agent class loader to work in a child-first delegation model, thus making it more isolated by preferring self packaged
version of classes that are available also in the parent (bootstrap) class loader - <a href="https://github.com/elastic/apm-agent-java/pull/2728" class="ulink" target="_top">#2728</a>
</li>
</ul>
</div>
<h5><a id="_features_4"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Capture Oracle SID in connection string - <a href="https://github.com/elastic/apm-agent-java/pull/2709" class="ulink" target="_top">#2709</a>
</li>
<li class="listitem">
Implemented span links in the OTel bridge - <a href="https://github.com/elastic/apm-agent-java/pull/2685" class="ulink" target="_top">#2685</a>
</li>
<li class="listitem">
Added support for MongoDB 4.x Sync Driver - <a href="https://github.com/elastic/apm-agent-java/pull/2241{#2241}" class="ulink" target="_top">https://github.com/elastic/apm-agent-java/pull/2241{#2241}</a>
</li>
<li class="listitem">
Capture keyspace in <code class="literal">db.instance</code> for Cassandra database - <a href="https://github.com/elastic/apm-agent-java/pull/2684" class="ulink" target="_top">#2684</a>
</li>
<li class="listitem">
Added support for AWS SQS - <a href="https://github.com/elastic/apm-agent-java/pull/2637" class="ulink" target="_top">#2637</a>
</li>
<li class="listitem">
Add <a class="xref" href="config-core.html#config-trace-continuation-strategy" title="trace_continuation_strategy ()"><code class="literal">trace_continuation_strategy</code></a> configuration option - <a href="https://github.com/elastic/apm-agent-java/pull/2760" class="ulink" target="_top">#2760</a>
</li>
<li class="listitem">
Capture user from Azure SSO with Servlet-based app containers - <a href="https://github.com/elastic/apm-agent-java/pull/2767" class="ulink" target="_top">#2767</a>
</li>
<li class="listitem">
Promote WebFlux &amp; Reactor to GA and enable it by default - <a href="https://github.com/elastic/apm-agent-java/pull/2782" class="ulink" target="_top">#2782</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_4"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix unexpected side effects of <code class="literal">toString</code> calls within reactor instrumentation - <a href="https://github.com/elastic/apm-agent-java/pull/2708" class="ulink" target="_top">#2708</a>
</li>
<li class="listitem">
Fix Vert.x instrumentation for 4.3.2 - <a href="https://github.com/elastic/apm-agent-java/pull/2700" class="ulink" target="_top">#2700</a>
</li>
<li class="listitem">
Fix <code class="literal">NullPointerException</code> in <code class="literal">AmazonHttpClientInstrumentation</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2740" class="ulink" target="_top">#2740</a>
</li>
<li class="listitem">
Fix stack frame exclusion patterns - <a href="https://github.com/elastic/apm-agent-java/pull/2758" class="ulink" target="_top">#2758</a>
</li>
<li class="listitem">
Fix <code class="literal">NullPointerException</code> with compressed spans - <a href="https://github.com/elastic/apm-agent-java/pull/2755" class="ulink" target="_top">#2755</a>
</li>
<li class="listitem">
Fix empty Servlet path with proper fallback - <a href="https://github.com/elastic/apm-agent-java/pull/2748" class="ulink" target="_top">#2748</a>
</li>
<li class="listitem">
Fix <code class="literal">ClosedByInterruptException</code> during indy bootstrap method resolution - <a href="https://github.com/elastic/apm-agent-java/pull/2752" class="ulink" target="_top">#2752</a>
</li>
<li class="listitem">
Enhance exclusion of other APM agents - <a href="https://github.com/elastic/apm-agent-java/pull/2766" class="ulink" target="_top">#2766</a>
</li>
<li class="listitem">
Avoid warning when log correlation option is provided in remote config - <a href="https://github.com/elastic/apm-agent-java/pull/2765" class="ulink" target="_top">#2765</a>
</li>
<li class="listitem">
Update <code class="literal">async-profiler</code> to 1.8.8 to avoid missing symbol log spam - <a href="https://github.com/elastic/apm-agent-java/pull/2775" class="ulink" target="_top">#2775</a>
</li>
<li class="listitem">
Fix container ID discovery for containers managed through AWS Fargate - <a href="https://github.com/elastic/apm-agent-java/pull/2772" class="ulink" target="_top">#2772</a>
</li>
<li class="listitem">
Make <code class="literal">traceparent</code> header computation thread-safe - <a href="https://github.com/elastic/apm-agent-java/pull/2747" class="ulink" target="_top">#2747</a>
</li>
<li class="listitem">
Fix OTel bridge with multiple OTel APIs or external plugins - <a href="https://github.com/elastic/apm-agent-java/pull/2735" class="ulink" target="_top">#2735</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.33.0"></a>1.33.0 - 2022/07/08<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<p>As of version 1.33.0, Java 7 support is deprecated and will be removed in a future release (not expected to be removed before January 2024) - <a href="https://github.com/elastic/apm-agent-java/pull/2677" class="ulink" target="_top">#2677</a></p>
<h5><a id="_features_5"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add support for Spring WebClient - <a href="https://github.com/elastic/apm-agent-java/pull/2229" class="ulink" target="_top">#2229</a>
</li>
<li class="listitem">
Added undocumented and unsupported configuration <code class="literal">metric_set_limit</code> to increase the metric set limit - <a href="https://github.com/elastic/apm-agent-java/pull/2148" class="ulink" target="_top">#2148</a>
</li>
<li class="listitem">
<p>Added <a class="xref" href="config-core.html#config-transaction-name-groups" title="transaction_name_groups ()"><code class="literal">transaction_name_groups</code></a> configuration option  - <a href="https://github.com/elastic/apm-agent-java/pull/2676" class="ulink" target="_top">#2676</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Deprecated <a class="xref" href="config-http.html#config-url-groups" title="url_groups (deprecated)"><code class="literal">url_groups</code></a> in favor of <a class="xref" href="config-core.html#config-transaction-name-groups" title="transaction_name_groups ()"><code class="literal">transaction_name_groups</code></a>.
</li>
</ul>
</div>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_5"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix for JAX-WS (SOAP) transaction names. The agent now properly names transaction for web service methods that are not annotated with <code class="literal">@WebMethod</code>. - <a href="https://github.com/elastic/apm-agent-java/pull/2667" class="ulink" target="_top">#2667</a>
</li>
<li class="listitem">
Fix public API backward compatibility that was broken in 1.32.0. With this version you can use any version of the public API once again - <a href="https://github.com/elastic/apm-agent-java/pull/2682" class="ulink" target="_top">#2682</a>
</li>
<li class="listitem">
Fix flaky transaction name with Webflux+Servlet - <a href="https://github.com/elastic/apm-agent-java/pull/2695" class="ulink" target="_top">#2695</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.32.0"></a>1.32.0 - 2022/06/13<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_potentially_breaking_changes"></a>Potentially breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If using the public API of version &lt; 1.32.0 and using the <code class="literal">@CaptureSpan</code> or <code class="literal">@Traced</code> annotations, upgrading the agent to 1.32.0
without upgrading the API version may cause <code class="literal">VerifyError</code>. This was fixed in version 1.33.0, which can once again be used with any
version of the public API.
</li>
<li class="listitem">
For relational databases, the agent now captures the database name and makes it part of service dependencies and service map.
For example, with a <code class="literal">MySQL</code> database, previously a single <code class="literal">mysql</code> item was shown in the map and in service dependencies,
the agent will now include the database name in the dependency, thus <code class="literal">mysql/my-db1</code>, <code class="literal">mysql/my-db2</code> will now be captured.
</li>
</ul>
</div>
<h5><a id="_features_6"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Promote mature agent features as Generaly Available (GA) - <a href="https://github.com/elastic/apm-agent-java/pull/2632" class="ulink" target="_top">#2632</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="opentelemetry-bridge.html" title="OpenTelemetry bridge">OpenTelemetry bridge</a> is now enabled by default
</li>
<li class="listitem">
<a class="xref" href="config-circuit-breaker.html" title="Circuit-Breaker configuration options">Circuit breaker</a> marked as GA (still disabled by default)
</li>
<li class="listitem">
<a class="xref" href="setup-attach-api.html" title="Programmatic API setup to self-attach">API Attach</a> and <a class="xref" href="setup-attach-cli.html" title="Automatic setup with apm-agent-attach-cli.jar">CLI Attach</a> marked as GA
</li>
<li class="listitem">
<a class="xref" href="config-http.html#config-use-path-as-transaction-name" title="use_path_as_transaction_name ()"><code class="literal">use_path_as_transaction_name</code></a> configuration option marked as GA
</li>
<li class="listitem">
Dubbo instrumentation is now enabled by default
</li>
<li class="listitem">
<code class="literal">com.sun.net.httpserver.HttpServer</code> instrumentation marked as GA
</li>
</ul>
</div>
</li>
<li class="listitem">
Struts action invocations via an action chain result start a new span - <a href="https://github.com/elastic/apm-agent-java/pull/2513" class="ulink" target="_top">#2513</a>
</li>
<li class="listitem">
Added official support for Elasticsearch Java API client - <a href="https://github.com/elastic/apm-agent-java/pull/2211" class="ulink" target="_top">#2211</a>
</li>
<li class="listitem">
Added the ability to make spans non-discardable through the public API and the OpenTelemetry bridge - <a href="https://github.com/elastic/apm-agent-java/pull/2632" class="ulink" target="_top">#2632</a>
</li>
<li class="listitem">
Added support for the new service target fields - <a href="https://github.com/elastic/apm-agent-java/pull/2578" class="ulink" target="_top">#2578</a>
</li>
<li class="listitem">
Capture the database name from JDBC connection string - <a href="https://github.com/elastic/apm-agent-java/pull/2642" class="ulink" target="_top">#2642</a>
</li>
<li class="listitem">
Added an additional span around Javalin template renderers - <a href="https://github.com/elastic/apm-agent-java/pull/2381" class="ulink" target="_top">#2381</a>
</li>
<li class="listitem">
Added support for downloading the latest agent version through the attach CLI by setting <code class="literal">--download-agent-version latest</code>. In
addition, when using the <code class="literal">apm-agent-attach-cli-slim.jar</code>, which does not contain a bundled agent, the latest version will be downloaded
from maven at runtime unless configured otherwise through  <code class="literal">--download-agent-version</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2659" class="ulink" target="_top">#2659</a>
</li>
<li class="listitem">
Added span-links to messaging systems instrumentation (supported by APM Server 8.3+ only) - <a href="https://github.com/elastic/apm-agent-java/pull/2610" class="ulink" target="_top">#2610</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_6"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix missing attributes in bridged OTel transactions - <a href="https://github.com/elastic/apm-agent-java/pull/2657" class="ulink" target="_top">#2657</a>
</li>
<li class="listitem">
Fix <code class="literal">transaction.result</code> with bridged OTel transactions - <a href="https://github.com/elastic/apm-agent-java/pull/2660" class="ulink" target="_top">#2660</a>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.31.0"></a>1.31.0 - 2022/05/17<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_potentially_breaking_changes_2"></a>Potentially breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Starting this version, when using <a class="xref" href="config-logging.html#config-log-ecs-reformatting" title="log_ecs_reformatting ( experimental)"><code class="literal">log_ecs_reformatting</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.22.0</span>]
<span class="Admonishment-detail">
Added in 1.22.0.
</span>
</span> experimental)</a>, the agent will automatically set the <code class="literal">service.version</code> field.
If you are using ECS-logging and set the <code class="literal">service.version</code> through a custom field, the behaviour is not strictly defined. Remove the
custom <code class="literal">service.name</code> field setting and either allow the agent to automatically discover and set it, or use the
<a class="xref" href="config-core.html#config-service-version" title="service_version"><code class="literal">service_version</code></a> config option to set it manually.
</li>
</ul>
</div>
<h5><a id="_refactorings_3"></a>Refactorings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Vert.x 3.x instrumentation was refactored to remove constructor instrumentation as well as wrapping of response handler. In addition, in
HTTP 2 request handling, transactions are ended when the request end event occurs and are kept alive until response end, when they are allowed
to recycle. This allows for spans representing asynchronous handling of requests for which the corresponding transaction has ended -
<a href="https://github.com/elastic/apm-agent-java/pull/2564" class="ulink" target="_top">#2564</a>
</li>
<li class="listitem">
Jedis clients instrumentation was changed
</li>
</ul>
</div>
<h5><a id="_features_7"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Set the service version when using the ECS reformatting of the application logs: <a href="https://github.com/elastic/apm-agent-java/pull/2603" class="ulink" target="_top">#2603</a>
</li>
<li class="listitem">
Add ECS-reformatting support for <code class="literal">java.util.logging</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2591" class="ulink" target="_top">#2591</a>
</li>
<li class="listitem">
Added support for setting the service version on Log4j2&#8217;s EcsLayout - <a href="https://github.com/elastic/apm-agent-java/pull/2604" class="ulink" target="_top">#2604</a>
</li>
<li class="listitem">
Added support for AWS S3 and DynamoDB - <a href="https://github.com/elastic/apm-agent-java/pull/2606" class="ulink" target="_top">#2606</a>
</li>
<li class="listitem">
Added support for Jedis 4.x clients - <a href="https://github.com/elastic/apm-agent-java/pull/2626" class="ulink" target="_top">#2626</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_7"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixed multiple dropped stats types in a transaction producing invalid JSON: <a href="https://github.com/elastic/apm-agent-java/pull/2589" class="ulink" target="_top">#2589</a>
</li>
<li class="listitem">
Fixed NoClassDefFoundError when using OTel bridge and span.*current() : <a href="https://github.com/elastic/apm-agent-java/pull/2596" class="ulink" target="_top">#2596</a>
</li>
<li class="listitem">
Fallback to standard output when Security Manager prevents writing to log file - <a href="https://github.com/elastic/apm-agent-java/pull/2581" class="ulink" target="_top">#2581</a>
</li>
<li class="listitem">
Fix missing transactions when using Vert.x 3.x with HTTP 1 - <a href="https://github.com/elastic/apm-agent-java/pull/2564" class="ulink" target="_top">#2564</a>
</li>
<li class="listitem">
Fix Vert.x <code class="literal">GET null</code> transactions to be named <code class="literal">GET unknown route</code>, according to spec - <a href="https://github.com/elastic/apm-agent-java/pull/2564" class="ulink" target="_top">#2564</a>
</li>
<li class="listitem">
Fix OpenTelemetry bridge span end with explicit timestamp - <a href="https://github.com/elastic/apm-agent-java/pull/2615" class="ulink" target="_top">#2615</a>
</li>
<li class="listitem">
Fix improper naming for <code class="literal">scheduled</code> transactions created by <code class="literal">java.util.TimerTask</code> instrumentation - <a href="https://github.com/elastic/apm-agent-java/pull/2620" class="ulink" target="_top">#2620</a>
</li>
<li class="listitem">
Properly handle <code class="literal">java.lang.IllegalStateException</code> related to premature invocation of <code class="literal">ServletConfig#getServletContext()</code> in
<code class="literal">Servlet#init()</code> instrumentations - <a href="https://github.com/elastic/apm-agent-java/pull/2627" class="ulink" target="_top">#2627</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.30.1"></a>1.30.1 - 2022/04/12<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_bug_fixes_8"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixed AWS Lambda instrumentation for AWS handler classes with input object types that are not AWS Events classes  - <a href="https://github.com/elastic/apm-agent-java/pull/2551" class="ulink" target="_top">#2551</a>
</li>
<li class="listitem">
Fixed service name discovery based on MANIFEST.MF file through <code class="literal">ServletContainerInitializer#onStartup</code> on Jakarta Servlet containers -
<a href="https://github.com/elastic/apm-agent-java/pull/2546" class="ulink" target="_top">#2546</a>
</li>
<li class="listitem">
Fix shaded classloader package definition - <a href="https://github.com/elastic/apm-agent-java/pull/2566" class="ulink" target="_top">#2566</a>
</li>
<li class="listitem">
Fix logging initialization with Security Manager - <a href="https://github.com/elastic/apm-agent-java/pull/2568" class="ulink" target="_top">#2568</a>
</li>
<li class="listitem">
normalize empty <code class="literal">transaction.type</code> and <code class="literal">span.type</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2525" class="ulink" target="_top">#2525</a>
</li>
<li class="listitem">
Allowing square brackets within the <a class="xref" href="config-jmx.html#config-capture-jmx-metrics" title="capture_jmx_metrics ()"><code class="literal">capture_jmx_metrics</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.11.0</span>]
<span class="Admonishment-detail">
Added in 1.11.0.
</span>
</span>)</a> config value - <a href="https://github.com/elastic/apm-agent-java/pull/2547" class="ulink" target="_top">#2547</a>
</li>
<li class="listitem">
Fixed duplicated ending of <code class="literal">HttpUrlConnection</code> spans - <a href="https://github.com/elastic/apm-agent-java/pull/2530" class="ulink" target="_top">#2530</a>
</li>
<li class="listitem">
Compressed span fixes - <a href="https://github.com/elastic/apm-agent-java/pull/2576" class="ulink" target="_top">#2576</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2552" class="ulink" target="_top">#2552</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2558" class="ulink" target="_top">#2558</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.30.0"></a>1.30.0 - 2022/03/22<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_potentially_breaking_changes_3"></a>Potentially breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Create the JDBC spans as exit spans- <a href="https://github.com/elastic/apm-agent-java/pull/2484" class="ulink" target="_top">#2484</a>
</li>
<li class="listitem">
WebSocket requests are now captured with transaction type request instead of custom - <a href="https://github.com/elastic/apm-agent-java/pull/2501" class="ulink" target="_top">#2501</a>
</li>
</ul>
</div>
<h5><a id="_refactorings_4"></a>Refactorings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Logging frameworks instrumentations - <a href="https://github.com/elastic/apm-agent-java/pull/2428" class="ulink" target="_top">#2428</a>. This refactoring includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Log correlation now works based on bytecode instrumentation rather than <code class="literal">ActivationListener</code> that directly updates the MDC
</li>
<li class="listitem">
Merging the different instrumentations (log-correlation, error-capturing and ECS-reformatting) into a single plugin
</li>
<li class="listitem">
Module structure and package naming changes
</li>
</ul>
</div>
</li>
</ul>
</div>
<h5><a id="_features_8"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added support for setting service name and version for a transaction via the public api - <a href="https://github.com/elastic/apm-agent-java/pull/2451" class="ulink" target="_top">#2451</a>
</li>
<li class="listitem">
Added support for en-/disabling each public annotation on each own - <a href="https://github.com/elastic/apm-agent-java/pull/2472" class="ulink" target="_top">#2472</a>
</li>
<li class="listitem">
Added support for compressing spans - <a href="https://github.com/elastic/apm-agent-java/pull/2477" class="ulink" target="_top">#2477</a>
</li>
<li class="listitem">
Added microsecond durations with <code class="literal">us</code> as unit - <a href="https://github.com/elastic/apm-agent-java/pull/2496" class="ulink" target="_top">#2496</a>
</li>
<li class="listitem">
Added support for dropping fast exit spans - <a href="https://github.com/elastic/apm-agent-java/pull/2491" class="ulink" target="_top">#2491</a>
</li>
<li class="listitem">
Added support for collecting statistics about dropped exit spans - <a href="https://github.com/elastic/apm-agent-java/pull/2505" class="ulink" target="_top">#2505</a>
</li>
<li class="listitem">
Making AWS Lambda instrumentation GA - includes some changes in Lambda transaction metadata fields and a dedicated flush HTTP request
to the AWS Lambda extension - <a href="https://github.com/elastic/apm-agent-java/pull/2424" class="ulink" target="_top">#2424</a>
</li>
<li class="listitem">
Changed logging correlation to be on by default. This change includes the removal of the now redundant <code class="literal">enable_log_correlation</code> config
option. If there&#8217;s a need to disable the log correlation mechanism, this can be done now through the <code class="literal">disable_instrumentations</code> config -
<a href="https://github.com/elastic/apm-agent-java/pull/2428" class="ulink" target="_top">#2428</a>
</li>
<li class="listitem">
Added automatic error event capturing for log4j1 and JBoss LogManager - <a href="https://github.com/elastic/apm-agent-java/pull/2428" class="ulink" target="_top">#2428</a>
</li>
<li class="listitem">
Issue a warning when security manager is mis-configured - <a href="https://github.com/elastic/apm-agent-java/pull/2510" class="ulink" target="_top">#2510</a>
</li>
<li class="listitem">
Add experimental OpenTelemetry API bridge - <a href="https://github.com/elastic/apm-agent-java/pull/1631" class="ulink" target="_top">#1631</a>
</li>
</ul>
</div>
<h5><a id="_performance_improvements"></a>Performance improvements<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Proxy classes are excluded from instrumentation in more cases - <a href="https://github.com/elastic/apm-agent-java/pull/2474" class="ulink" target="_top">#2474</a>
</li>
<li class="listitem">
Only time type/method matching if the debug logging is enabled as the results are only used when debug logging is enabled - <a href="https://github.com/elastic/apm-agent-java/pull/2471" class="ulink" target="_top">#2471</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_9"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix cross-plugin dependencies triggering NoClassDefFound - <a href="https://github.com/elastic/apm-agent-java/pull/2509" class="ulink" target="_top">#2509</a>
</li>
<li class="listitem">
Fix status code setting in AWS Lambda transactions triggered by API Gateway V1 - <a href="https://github.com/elastic/apm-agent-java/pull/2346" class="ulink" target="_top">#2346</a>
</li>
<li class="listitem">
Fix classloading OSGi bundles with partial dependency on Servlet API + avoid SecurityException with Apache Sling - <a href="https://github.com/elastic/apm-agent-java/pull/2418" class="ulink" target="_top">2418</a>
</li>
<li class="listitem">
Respect <code class="literal">transaction_ignore_urls</code> and <code class="literal">transaction_ignore_user_agents</code> when creating transactions in the spring webflux instrumentation - <a href="https://github.com/elastic/apm-agent-java/pull/2515" class="ulink" target="_top">#2515</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.29.0"></a>1.29.0 - 2022/02/09<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes_2"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Changes in service name auto-discovery of jar files (see Features section)
</li>
</ul>
</div>
<h5><a id="_features_9"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Exceptions that are logged using the fatal log level are now captured (log4j2 only) - <a href="https://github.com/elastic/apm-agent-java/pull/2377" class="ulink" target="_top">#2377</a>
</li>
<li class="listitem">
Replaced <code class="literal">authorization</code> in the default value of <code class="literal">sanitize_field_names</code> with <code class="literal">*auth*</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2326" class="ulink" target="_top">#2326</a>
</li>
<li class="listitem">
Unsampled transactions are dropped and not sent to the APM-Server if the APM-Server version is 8.0+ - <a href="https://github.com/elastic/apm-agent-java/pull/2329" class="ulink" target="_top">#2329</a>
</li>
<li class="listitem">
Adding agent logging capabilities to our SDK, making it available for external plugins - <a href="https://github.com/elastic/apm-agent-java/pull/2390" class="ulink" target="_top">#2390</a>
</li>
<li class="listitem">
<p>Service name auto-discovery improvements</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For applications deployed to application servers (<code class="literal">war</code> files) and standalone jars that are started with <code class="literal">java -jar</code>,
the agent now discovers the <code class="literal">META-INF/MANIFEST.MF</code> file.
</li>
<li class="listitem">
If the manifest contains the <code class="literal">Implementation-Title</code> attribute, it is used as the default service name - <a href="https://github.com/elastic/apm-agent-java/pull/1921" class="ulink" target="_top">#1921</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2434" class="ulink" target="_top">#2434</a><br>
<span class="strong strong"><strong>Note</strong></span>: this may change your service names if you relied on the auto-discovery that uses the name of the jar file.
If that jar file also contains an <code class="literal">Implementation-Title</code> attribute in the <code class="literal">MANIFEST.MF</code> file, the latter will take precedence.
</li>
<li class="listitem">
When the manifest contains the <code class="literal">Implementation-Version</code> attribute, it is used as the default service version - <a href="https://github.com/elastic/apm-agent-java/pull/1726" class="ulink" target="_top">#1726</a>, <a href="https://github.com/elastic/apm-agent-java/pull/1922" class="ulink" target="_top">#1922</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2434" class="ulink" target="_top">#2434</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
Added support for instrumenting Struts 2 static resource requests - <a href="https://github.com/elastic/apm-agent-java/pull/1949" class="ulink" target="_top">#1949</a>
</li>
<li class="listitem">
Added support for Java/Jakarta WebSocket ServerEndpoint - <a href="https://github.com/elastic/apm-agent-java/pull/2281" class="ulink" target="_top">#2281</a>
</li>
<li class="listitem">
Added support for setting the service name on Log4j2&#8217;s EcsLayout - <a href="https://github.com/elastic/apm-agent-java/pull/2296" class="ulink" target="_top">#2296</a>
</li>
<li class="listitem">
Print the used instrumentation groups when the application stops - <a href="https://github.com/elastic/apm-agent-java/pull/2448" class="ulink" target="_top">#2448</a>
</li>
<li class="listitem">
Add <code class="literal">elastic.apm.start_async</code> property that makes the agent start on a non-premain/main thread - <a href="https://github.com/elastic/apm-agent-java/pull/2454" class="ulink" target="_top">#2454</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_10"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix runtime attach with some docker images - <a href="https://github.com/elastic/apm-agent-java/pull/2385" class="ulink" target="_top">#2385</a>
</li>
<li class="listitem">
Restore dynamic capability to <code class="literal">log_level</code> config for plugin loggers - <a href="https://github.com/elastic/apm-agent-java/pull/2384" class="ulink" target="_top">#2384</a>
</li>
<li class="listitem">
Fix slf4j-related <code class="literal">LinkageError</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2390" class="ulink" target="_top">#2390</a> and <a href="https://github.com/elastic/apm-agent-java/pull/2376" class="ulink" target="_top">#2376</a>
</li>
<li class="listitem">
Fix possible deadlock occurring when Byte Buddy reads System properties by warming up bytecode instrumentation code
paths. The BCI warmup is on by default and may be disabled through the internal <code class="literal">warmup_byte_buddy</code> config option - <a href="https://github.com/elastic/apm-agent-java/pull/2368" class="ulink" target="_top">#2368</a>
</li>
<li class="listitem">
<p>Fixed few dubbo plugin issues - <a href="https://github.com/elastic/apm-agent-java/pull/2149" class="ulink" target="_top">#2149</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Dubbo transaction will should be created at the provider side
</li>
<li class="listitem">
APM headers conversion issue within dubbo transaction
</li>
</ul>
</div>
</li>
<li class="listitem">
Fix External plugins automatic setting of span outcome - <a href="https://github.com/elastic/apm-agent-java/pull/2376" class="ulink" target="_top">#2376</a>
</li>
<li class="listitem">
Avoid early initialization of JMX on Weblogic - <a href="https://github.com/elastic/apm-agent-java/pull/2420" class="ulink" target="_top">#2420</a>
</li>
<li class="listitem">
Automatically disable class sharing on AWS lambda layer - <a href="https://github.com/elastic/apm-agent-java/pull/2438" class="ulink" target="_top">#2438</a>
</li>
<li class="listitem">
Avoid standalone spring applications to have two different service names, one based on the jar name, the other based on <code class="literal">spring.application.name</code>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.28.4"></a>1.28.4 - 2021/12/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_bug_fixes_11"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix <code class="literal">@Traced</code> annotation to return proper outcome instead of <code class="literal">failed</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2370" class="ulink" target="_top">#2370</a>
</li>
</ul>
</div>
<h5><a id="_dependency_updates"></a>Dependency updates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update Log4j to 2.12.4 and log4j2-ecs-layout to 1.3.2 - <a href="https://github.com/elastic/apm-agent-java/pull/2378" class="ulink" target="_top">#2378</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.28.3"></a>1.28.3 - 2021/12/22<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_dependency_updates_2"></a>Dependency updates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update Log4j to 2.12.3
</li>
<li class="listitem">
Update ecs-logging-java to 1.3.0
</li>
</ul>
</div>
<h5><a id="_potentially_breaking_changes_4"></a>Potentially breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the agent cannot discover a service name, it now uses <code class="literal">unknown-java-service</code> instead of <code class="literal">my-service</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2325" class="ulink" target="_top">#2325</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_12"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Gracefully handle JDBC drivers which don&#8217;t support <code class="literal">Connection#getCatalog</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2340" class="ulink" target="_top">#2340</a>
</li>
<li class="listitem">
Fix using JVM keystore options for communication with APM Server - <a href="https://github.com/elastic/apm-agent-java/pull/2362" class="ulink" target="_top">#2362</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.28.2"></a>1.28.2 - 2021/12/16<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_dependency_updates_3"></a>Dependency updates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update Log4j to 2.12.2
</li>
</ul>
</div>
<h5><a id="_bug_fixes_13"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix module loading errors on J9 JVM - <a href="https://github.com/elastic/apm-agent-java/pull/2341" class="ulink" target="_top">#2341</a>
</li>
<li class="listitem">
Fixing log4j configuration error - <a href="https://github.com/elastic/apm-agent-java/pull/2343" class="ulink" target="_top">#2343</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.28.1"></a>1.28.1 - 2021/12/10<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_security"></a>Security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix for "Log4Shell" RCE 0-day exploit in log4j <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" class="ulink" target="_top">CVE-2021-44228</a> - <a href="https://github.com/elastic/apm-agent-java/pull/2332" class="ulink" target="_top">#2332</a>
</li>
</ul>
</div>
<h5><a id="_features_10"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added support to selectively enable instrumentations - <a href="https://github.com/elastic/apm-agent-java/pull/2292" class="ulink" target="_top">#2292</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_14"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Preferring controller names for Spring MVC transactions, <code class="literal">use_path_as_transaction_name</code> only as a fallback - <a href="https://github.com/elastic/apm-agent-java/pull/2320" class="ulink" target="_top">#2320</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.28.0"></a>1.28.0 - 2021/12/07<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_11"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Adding experimental support for <a class="xref" href="aws-lambda.html" title="Monitoring AWS Lambda Java Functions">AWS Lambda</a> - <a href="https://github.com/elastic/apm-agent-java/pull/1951" class="ulink" target="_top">#1951</a>
</li>
<li class="listitem">
Now supporting tomcat 10 - <a href="https://github.com/elastic/apm-agent-java/pull/2229" class="ulink" target="_top">#2229</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_15"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix error with parsing APM Server version for 7.16+ - <a href="https://github.com/elastic/apm-agent-java/pull/2313" class="ulink" target="_top">#2313</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.27.1"></a>1.27.1 - 2021/11/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_security_2"></a>Security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Resolves Local Privilege Escalation issue <a href="https://discuss.elastic.co/t/apm-java-agent-security-update/291355" class="ulink" target="_top">ESA-2021-30</a> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-37942" class="ulink" target="_top">CVE-2021-37942</a>
</li>
</ul>
</div>
<h5><a id="_features_12"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add support to Jakarta EE for JSF - <a href="https://github.com/elastic/apm-agent-java/pull/2254" class="ulink" target="_top">#2254</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_16"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixing missing Micrometer metrics in Spring boot due to premature initialization - <a href="https://github.com/elastic/apm-agent-java/pull/2255" class="ulink" target="_top">#2255</a>
</li>
<li class="listitem">
Fixing hostname trimming of FQDN too aggressive - <a href="https://github.com/elastic/apm-agent-java/pull/2286" class="ulink" target="_top">#2286</a>
</li>
<li class="listitem">
Fixing agent <code class="literal">unknown</code> version - <a href="https://github.com/elastic/apm-agent-java/pull/2289" class="ulink" target="_top">#2289</a>
</li>
<li class="listitem">
Improve runtime attach configuration reliability - <a href="https://github.com/elastic/apm-agent-java/pull/2283" class="ulink" target="_top">#2283</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.27.0"></a>1.27.0 - 2021/11/15<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_security_3"></a>Security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Resolves Local Privilege Escalation issue <a href="https://discuss.elastic.co/t/apm-java-agent-security-update/289627" class="ulink" target="_top">ESA-2021-29</a> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-37941" class="ulink" target="_top">CVE-2021-37941</a>
</li>
</ul>
</div>
<h5><a id="_potentially_breaking_changes_5"></a>Potentially breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">transaction_ignore_urls</code> now relies on full request URL path - <a href="https://github.com/elastic/apm-agent-java/pull/2146" class="ulink" target="_top">#2146</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
On a typical application server like Tomcat, deploying an <code class="literal">app.war</code> application to the non-ROOT context makes it accessible with <code class="literal">http://localhost:8080/app/</code>
</li>
<li class="listitem">
Ignoring the whole webapp through <code class="literal">/app/*</code> was not possible until now.
</li>
<li class="listitem">
Existing configuration may need to be updated to include the deployment context, thus for example <code class="literal">/static/*.js</code> used to
exclude known static files in all applications might be changed to <code class="literal">/app/static/*.js</code> or <code class="literal">*/static/*.js</code>.
</li>
<li class="listitem">
It only impacts prefix patterns due to the additional context path in pattern.
</li>
<li class="listitem">
It does not impact deployment within the <code class="literal">ROOT</code> context like Spring-boot which do not have such context path prefix.
</li>
</ul>
</div>
</li>
<li class="listitem">
The metrics <code class="literal">transaction.duration.sum.us</code>, <code class="literal">transaction.duration.count</code> and <code class="literal">transaciton.breakdown.count</code> are no longer recorded - <a href="https://github.com/elastic/apm-agent-java/pull/2194" class="ulink" target="_top">#2194</a>
</li>
<li class="listitem">
Automatic hostname discovery mechanism had changed, so the resulted <code class="literal">host.name</code> and <code class="literal">host.hostname</code> in events reported
by the agent may be different. This was done in order to improve the integration with host metrics in the APM UI.
</li>
</ul>
</div>
<h5><a id="_features_13"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Improved capturing of logged exceptions when using Log4j2 - <a href="https://github.com/elastic/apm-agent-java/pull/2139" class="ulink" target="_top">#2139</a>
</li>
<li class="listitem">
Update to async-profiler 1.8.7 and set configured <code class="literal">safemode</code> at load time though a new system property - <a href="https://github.com/elastic/apm-agent-java/pull/2165" class="ulink" target="_top">#2165</a>
</li>
<li class="listitem">
Added support to capture <code class="literal">context.message.routing-key</code> in rabbitmq, spring amqp instrumentations - <a href="https://github.com/elastic/apm-agent-java/pull/1767" class="ulink" target="_top">#1767</a>
</li>
<li class="listitem">
Breakdown metrics are now tracked per service (when using APM Server 8.0) - <a href="https://github.com/elastic/apm-agent-java/pull/2208" class="ulink" target="_top">#2208</a>
</li>
<li class="listitem">
Add support for Spring AMQP batch API - <a href="https://github.com/elastic/apm-agent-java/pull/1716" class="ulink" target="_top">#1716</a>
</li>
<li class="listitem">
Add the (current) transaction name to the error (when using APM Server 8.0) - <a href="https://github.com/elastic/apm-agent-java/pull/2235" class="ulink" target="_top">#2235</a>
</li>
<li class="listitem">
The JVM/JMX metrics are reported for each service name individually (when using APM Server 8.0) - <a href="https://github.com/elastic/apm-agent-java/pull/2233" class="ulink" target="_top">#2233</a>
</li>
<li class="listitem">
Added <a class="xref" href="config-stacktrace.html#config-span-stack-trace-min-duration" title="span_stack_trace_min_duration (performance)"><code class="literal">span_stack_trace_min_duration</code></a> option.
This replaces the now deprecated <code class="literal">span_frames_min_duration</code> option.
The difference is that the new option has more intuitive semantics for negative values (never collect stack trace) and zero (always collect stack trace). - <a href="https://github.com/elastic/apm-agent-java/pull/2220" class="ulink" target="_top">#2220</a>
</li>
<li class="listitem">
Add support to Jakarta EE for JAX-WS - <a href="https://github.com/elastic/apm-agent-java/pull/2247" class="ulink" target="_top">#2247</a>
</li>
<li class="listitem">
Add support to Jakarta EE for JAX-RS - <a href="https://github.com/elastic/apm-agent-java/pull/2248" class="ulink" target="_top">#2248</a>
</li>
<li class="listitem">
Add support for Jakarta EE EJB annotations <code class="literal">@Schedule</code>, <code class="literal">@Schedules</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2250" class="ulink" target="_top">#2250</a>
</li>
<li class="listitem">
Add support to Jakarta EE for Servlets - <a href="https://github.com/elastic/apm-agent-java/pull/1912" class="ulink" target="_top">#1912</a>
</li>
<li class="listitem">
Added support to Quartz 1.x - <a href="https://github.com/elastic/apm-agent-java/pull/2219" class="ulink" target="_top">#2219</a>
</li>
</ul>
</div>
<h5><a id="_performance_improvements_2"></a>Performance improvements<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Disable compression when sending data to a local APM Server
</li>
<li class="listitem">
Reducing startup contention related to instrumentation through <code class="literal">ensureInstrumented</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2150" class="ulink" target="_top">#2150</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_17"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix k8s metadata discovery for containerd-cri envs - <a href="https://github.com/elastic/apm-agent-java/pull/2126" class="ulink" target="_top">#2126</a>
</li>
<li class="listitem">
Fixing/reducing startup delays related to <code class="literal">ensureInstrumented</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2150" class="ulink" target="_top">#2150</a>
</li>
<li class="listitem">
Fix runtime attach when bytebuddy is in application classpath - <a href="https://github.com/elastic/apm-agent-java/pull/2116" class="ulink" target="_top">#2116</a>
</li>
<li class="listitem">
Fix failed integration between agent traces and host metrics coming from Beats/Elastic-Agent due to incorrect hostname
discovery - <a href="https://github.com/elastic/apm-agent-java/pull/2205" class="ulink" target="_top">#2205</a>
</li>
<li class="listitem">
Fix infinitely kept-alive transactions in Hikari connection pool - <a href="https://github.com/elastic/apm-agent-java/pull/2210" class="ulink" target="_top">#2210</a>
</li>
<li class="listitem">
Fix few Webflux exceptions and missing reactor module - <a href="https://github.com/elastic/apm-agent-java/pull/2207" class="ulink" target="_top">#2207</a>
</li>
</ul>
</div>
<h5><a id="_refactorings_5"></a>Refactorings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Loading the agent from an isolated class loader - <a href="https://github.com/elastic/apm-agent-java/pull/2109" class="ulink" target="_top">#2109</a>
</li>
<li class="listitem">
<p>Refactorings in the <code class="literal">apm-agent-plugin-sdk</code> that may imply breaking changes for beta users of the external plugin mechanism</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">WeakMapSupplier.createMap()</code> is now <code class="literal">WeakConcurrent.buildMap()</code> and contains more builders - <a href="https://github.com/elastic/apm-agent-java/pull/2136" class="ulink" target="_top">#2136</a>
</li>
<li class="listitem">
<code class="literal">GlobalThreadLocal</code> has been removed in favor of <code class="literal">DetachedThreadLocal</code>. To make it global, use <code class="literal">GlobalVariables</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2136" class="ulink" target="_top">#2136</a>
</li>
<li class="listitem">
<code class="literal">DynamicTransformer.Accessor.get().ensureInstrumented</code> is now <code class="literal">DynamicTransformer.ensureInstrumented</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2164" class="ulink" target="_top">#2164</a>
</li>
<li class="listitem">
The <code class="literal">@AssignTo.*</code> annotations have been removed.
Use the <code class="literal">@Advice.AssignReturned.*</code> annotations that come with the latest version of Byte Buddy.
If your plugin uses the old annotations, it will be skipped.
<a href="https://github.com/elastic/apm-agent-java/pull/2171" class="ulink" target="_top">#2171</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
Switching last instrumentations (<code class="literal">trace_methods</code>, sparkjava, JDK <code class="literal">HttpServer</code> and Struts 2) to
<code class="literal">TracerAwareInstrumentation</code> - <a href="https://github.com/elastic/apm-agent-java/pull/2170" class="ulink" target="_top">#2170</a>
</li>
<li class="listitem">
Replace concurrency plugin maps to <code class="literal">SpanConcurrentHashMap</code> ones - <a href="https://github.com/elastic/apm-agent-java/pull/2173" class="ulink" target="_top">#2173</a>
</li>
<li class="listitem">
Align User-Agent HTTP header with other APM agents - <a href="https://github.com/elastic/apm-agent-java/pull/2177" class="ulink" target="_top">#2177</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.26.2"></a>1.26.2 - 2021/12/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_dependency_updates_4"></a>Dependency updates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update Log4j to 2.12.4 and log4j2-ecs-layout to 1.3.2 - <a href="https://github.com/elastic/apm-agent-java/pull/2378" class="ulink" target="_top">#2378</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.26.1"></a>1.26.1 - 2021/12/22<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_dependency_updates_5"></a>Dependency updates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update Log4j to 2.12.3
</li>
<li class="listitem">
Update ecs-logging-java to 1.3.0
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.26.0"></a>1.26.0 - 2021/09/14<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_potentially_breaking_changes_6"></a>Potentially breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If you rely on Database span subtype and use Microsoft SQL Server, the span subtype has been changed from <code class="literal">sqlserver</code>
to <code class="literal">mssql</code> to align with other agents.
</li>
</ul>
</div>
<h5><a id="_breaking_changes_3"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Stop collecting the field <code class="literal">http.request.socket.encrypted</code> in http requests - <a href="https://github.com/elastic/apm-agent-java/pull/2136" class="ulink" target="_top">#2136</a>
</li>
</ul>
</div>
<h5><a id="_features_14"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Improved naming for Spring controllers - <a href="https://github.com/elastic/apm-agent-java/pull/1906" class="ulink" target="_top">#1906</a>
</li>
<li class="listitem">
<p>ECS log reformatting improvements - <a href="https://github.com/elastic/apm-agent-java/pull/1910" class="ulink" target="_top">#1910</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Automatically sets <code class="literal">service.node.name</code> in all log events if set through agent configuration
</li>
<li class="listitem">
Add <code class="literal">log_ecs_reformatting_additional_fields</code> option to support arbitrary fields in logs
</li>
<li class="listitem">
Automatically serialize markers as tags where relevant (log4j2 and logback)
</li>
</ul>
</div>
</li>
<li class="listitem">
gRPC spans (client and server) can detect errors or cancellation through custom listeners - <a href="https://github.com/elastic/apm-agent-java/pull/2067" class="ulink" target="_top">#2067</a>
</li>
<li class="listitem">
Add <code class="literal">-download-agent-version</code> to the agent <a class="xref" href="setup-attach-cli.html#setup-attach-cli-usage-options" title="Options">attach CLI tool options</a>, allowing the
user to configure an arbitrary agent version that will be downloaded from maven and attached - <a href="https://github.com/elastic/apm-agent-java/pull/1959" class="ulink" target="_top">#1959</a>
</li>
<li class="listitem">
Add extra check to detect improper agent setup - <a href="https://github.com/elastic/apm-agent-java/pull/2076" class="ulink" target="_top">#2076</a>
</li>
<li class="listitem">
In redis tests - embedded RedisServer is replaced by testcontainers - <a href="https://github.com/elastic/apm-agent-java/pull/2221" class="ulink" target="_top">#2221</a>
</li>
</ul>
</div>
<h5><a id="_performance_improvements_3"></a>Performance improvements<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Reduce GC time overhead caused by WeakReferences - <a href="https://github.com/elastic/apm-agent-java/pull/2086" class="ulink" target="_top">#2086</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2081" class="ulink" target="_top">#2081</a>
</li>
<li class="listitem">
<p>Reduced memory overhead by a smarter type pool caching strategy - <a href="https://github.com/elastic/apm-agent-java/pull/2102" class="ulink" target="_top">#2102</a>.<br>
The type pool cache improves the startup times by speeding up type matching
(determining whether a class that&#8217;s about to be loaded should be instrumented).
Generally, the more types that are cached, the faster the startup.<br>
The old strategy did not impose a limit to the cache but cleared it after it hasn&#8217;t been accessed in a while.
However, load test have discovered that the cache may never be cleared and leave a permanent overhead of 23mb.
The actual size of the cache highly depends on the application and loosely correlates with the number of loaded classes.<br>
The new caching strategy targets to allocate 1% of the committed heap, at least 0.5mb and max 10mb.
If a particular entry hasn&#8217;t been accessed within 20s, it will be removed from the cache.<br>
The results based on load testing are very positive:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Equivalent startup times (within the margins of error of the previous strategy)
</li>
<li class="listitem">
Equivalent allocation rate (within the margins of error of the previous strategy)
</li>
<li class="listitem">
Reduced avg heap utilization from 10%/15mb (previous strategy) to within margins of error without the agent
</li>
<li class="listitem">
Reduced GC time due to the additional headroom that the application can utilize.
</li>
<li class="listitem">
Based on heap dump analysis, after warmup, the cache size is now around 59kb (down from 23mb with the previous strategy).
</li>
</ul>
</div>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_18"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix failure to parse some forms of the <code class="literal">Implementation-Version</code> property from jar manifest files - <a href="https://github.com/elastic/apm-agent-java/pull/1931" class="ulink" target="_top">#1931</a>
</li>
<li class="listitem">
Ensure single value for context-propagation header - <a href="https://github.com/elastic/apm-agent-java/pull/1937" class="ulink" target="_top">#1937</a>
</li>
<li class="listitem">
Fix gRPC non-terminated (therefore non-reported) client spans - <a href="https://github.com/elastic/apm-agent-java/pull/2067" class="ulink" target="_top">#2067</a>
</li>
<li class="listitem">
Fix Webflux response status code - <a href="https://github.com/elastic/apm-agent-java/pull/1948" class="ulink" target="_top">#1948</a>
</li>
<li class="listitem">
Ensure path filtering is applied when Servlet path is not available - <a href="https://github.com/elastic/apm-agent-java/pull/2099" class="ulink" target="_top">#2099</a>
</li>
<li class="listitem">
Align span subtype for MS SqlServer - <a href="https://github.com/elastic/apm-agent-java/pull/2112" class="ulink" target="_top">#2112</a>
</li>
<li class="listitem">
Fix potential destination host name corruption in OkHttp client spans - <a href="https://github.com/elastic/apm-agent-java/pull/2118" class="ulink" target="_top">#2118</a>
</li>
</ul>
</div>
<h5><a id="_refactorings_6"></a>Refactorings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Migrate several plugins to indy dispatcher <a href="https://github.com/elastic/apm-agent-java/pull/2087" class="ulink" target="_top">#2087</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2088" class="ulink" target="_top">#2088</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2090" class="ulink" target="_top">#2090</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2094" class="ulink" target="_top">#2094</a>, <a href="https://github.com/elastic/apm-agent-java/pull/2095" class="ulink" target="_top">#2095</a>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.25.0"></a>1.25.0 - 2021/07/22<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_potentially_breaking_changes_7"></a>Potentially breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If you rely on instrumentations that are in the <code class="literal">experimental</code> group, you must now set <code class="literal">enable_experimental_instrumentations=true</code> otherwise
the experimental instrumentations will be disabled by default. Up to version <code class="literal">1.24.0</code> using an empty value for <code class="literal">disable_instrumentations</code> was
the recommended way to override the default <code class="literal">disable_instrumentations=experimental</code>.
</li>
</ul>
</div>
<h5><a id="_features_15"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Support for inheritance of public API annotations - <a href="https://github.com/elastic/apm-agent-java/pull/1805" class="ulink" target="_top">#1805</a>
</li>
<li class="listitem">
JDBC instrumentation sets <code class="literal">context.db.instance</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1820" class="ulink" target="_top">#1820</a>
</li>
<li class="listitem">
Add support for Vert.x web client- <a href="https://github.com/elastic/apm-agent-java/pull/1824" class="ulink" target="_top">#1824</a>
</li>
<li class="listitem">
Avoid recycling of spans and transactions that are using through the public API, so to avoid
reference-counting-related errors - <a href="https://github.com/elastic/apm-agent-java/pull/1859" class="ulink" target="_top">#1859</a>
</li>
<li class="listitem">
<p>Add <a class="xref" href="config-core.html#config-enable-experimental-instrumentations" title="enable_experimental_instrumentations ()"><code class="literal">enable_experimental_instrumentations</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.25.0</span>]
<span class="Admonishment-detail">
Added in 1.25.0.
</span>
</span>)</a> configuration option to enable experimental features - <a href="https://github.com/elastic/apm-agent-java/pull/1863" class="ulink" target="_top">#1863</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Previously, when adding an instrumentation group to <code class="literal">disable_instrumentations</code>, we had to make sure to not forget the
default <code class="literal">experimental</code> value, for example when disabling <code class="literal">jdbc</code> instrumentation we had to set <code class="literal">disable_instrumentations=experimental,jdbc</code> otherwise
setting <code class="literal">disable_instrumentations=jdbc</code> would disable jdbc and also enable experimental features, which would not be the desired effect.
</li>
<li class="listitem">
Previously, by default <code class="literal">disable_instrumentations</code> contained <code class="literal">experimental</code>
</li>
<li class="listitem">
Now by default <code class="literal">disable_instrumentations</code> is empty and <code class="literal">enable_experimental_instrumentations=false</code>
</li>
<li class="listitem">
Set <code class="literal">enable_experimental_instrumentations=true</code> to enable experimental instrumentations
</li>
</ul>
</div>
</li>
<li class="listitem">
Eliminating concerns related to log4j2 vulnerability - <a href="https://nvd.nist.gov/vuln/detail/CVE-2020-9488#vulnCurrentDescriptionTitle" class="ulink" target="_top">https://nvd.nist.gov/vuln/detail/CVE-2020-9488#vulnCurrentDescriptionTitle</a>.
We cannot upgrade to version above 2.12.1 because this is the last version of log4j that is compatible with Java 7.
Instead, we exclude the SMTP appender (which is the vulnerable one) from our artifacts. Note that older versions of
our agent are not vulnerable as well, as the SMTP appender was never used, this is only to further reduce our users' concerns.
</li>
<li class="listitem">
Adding public APIs for setting <code class="literal">destination.service.resource</code>, <code class="literal">destination.address</code> and <code class="literal">destination.port</code> fields
for exit spans - <a href="https://github.com/elastic/apm-agent-java/pull/1788" class="ulink" target="_top">#1788</a>
</li>
<li class="listitem">
Only use emulated runtime attachment as fallback, remove the <code class="literal">--without-emulated-attach</code> option - <a href="https://github.com/elastic/apm-agent-java/pull/1865" class="ulink" target="_top">#1865</a>
</li>
<li class="listitem">
Instrument <code class="literal">javax.servlet.Filter</code> the same way as <code class="literal">javax.servlet.FilterChain</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1858" class="ulink" target="_top">#1858</a>
</li>
<li class="listitem">
Propagate trace context headers in HTTP calls occurring from within traced exit points, for example - when using
Elasticsearch&#8217;s REST client - <a href="https://github.com/elastic/apm-agent-java/pull/1883" class="ulink" target="_top">#1883</a>
</li>
<li class="listitem">
Added support for naming sparkjava (not Apache Spark) transactions <a href="https://github.com/elastic/apm-agent-java/pull/1894" class="ulink" target="_top">#1894</a>
</li>
<li class="listitem">
Added the ability to manually create exit spans, which will result with the auto creation of service nodes in the
service map and downstream service in the dependencies table - <a href="https://github.com/elastic/apm-agent-java/pull/1898" class="ulink" target="_top">#1898</a>
</li>
<li class="listitem">
Basic support for <code class="literal">com.sun.net.httpserver.HttpServer</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1854" class="ulink" target="_top">#1854</a>
</li>
<li class="listitem">
Update to async-profiler 1.8.6 <a href="https://github.com/elastic/apm-agent-java/pull/1907" class="ulink" target="_top">#1907</a>
</li>
<li class="listitem">
Added support for setting the framework using the public api (#1908) - <a href="https://github.com/elastic/apm-agent-java/pull/1909" class="ulink" target="_top">#1909</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_19"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix NPE with <code class="literal">null</code> binary header values + properly serialize them - <a href="https://github.com/elastic/apm-agent-java/pull/1842" class="ulink" target="_top">#1842</a>
</li>
<li class="listitem">
Fix <code class="literal">ListenerExecutionFailedException</code> when using Spring AMQP&#8217;s ReplyTo container - <a href="https://github.com/elastic/apm-agent-java/pull/1872" class="ulink" target="_top">#1872</a>
</li>
<li class="listitem">
Enabling log ECS reformatting when using Logback configured with <code class="literal">LayoutWrappingEncoder</code> and a pattern layout - <a href="https://github.com/elastic/apm-agent-java/pull/1879" class="ulink" target="_top">#1879</a>
</li>
<li class="listitem">
Fix NPE with Webflux + context propagation headers - <a href="https://github.com/elastic/apm-agent-java/pull/1871" class="ulink" target="_top">#1871</a>
</li>
<li class="listitem">
Fix <code class="literal">ClassCastException</code> with <code class="literal">ConnnectionMetaData</code> and multiple classloaders - <a href="https://github.com/elastic/apm-agent-java/pull/1864" class="ulink" target="_top">#1864</a>
</li>
<li class="listitem">
Fix NPE in <code class="literal">co.elastic.apm.agent.servlet.helper.ServletTransactionCreationHelper.getClassloader</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1861" class="ulink" target="_top">#1861</a>
</li>
<li class="listitem">
Fix for Jboss JMX unexpected notifications - <a href="https://github.com/elastic/apm-agent-java/pull/1895" class="ulink" target="_top">#1895</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.24.0"></a>1.24.0 - 2021/05/31<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_16"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Basic support for Apache Struts 2 <a href="https://github.com/elastic/apm-agent-java/pull/1763" class="ulink" target="_top">#1763</a>
</li>
<li class="listitem">
Extending the <a class="xref" href="config-logging.html#config-log-ecs-reformatting" title="log_ecs_reformatting ( experimental)"><code class="literal">log_ecs_reformatting</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.22.0</span>]
<span class="Admonishment-detail">
Added in 1.22.0.
</span>
</span> experimental)</a> config option to enable the overriding of logs with ECS-reformatted
events. With the new <code class="literal">OVERRIDE</code> option, non-file logs can be ECS-reformatted automatically as well - <a href="https://github.com/elastic/apm-agent-java/pull/1793" class="ulink" target="_top">#1793</a>
</li>
<li class="listitem">
Instrumentation for Vert.x Web <a href="https://github.com/elastic/apm-agent-java/pull/1697" class="ulink" target="_top">#1697</a>
</li>
<li class="listitem">
Changed log level of vm arguments to debug
</li>
<li class="listitem">
Giving precedence for the W3C <code class="literal">tracecontext</code> header over the <code class="literal">elastic-apm-traceparent</code> header - <a href="https://github.com/elastic/apm-agent-java/pull/1821" class="ulink" target="_top">#1821</a>
</li>
<li class="listitem">
Add instrumentation for Webflux - <a href="https://github.com/elastic/apm-agent-java/pull/1305" class="ulink" target="_top">#1305</a>
</li>
<li class="listitem">
Add instrumentation for Javalin <a href="https://github.com/elastic/apm-agent-java/pull/1822" class="ulink" target="_top">#1822</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_20"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix another error related to instrumentation plugins loading on Windows - <a href="https://github.com/elastic/apm-agent-java/pull/1785" class="ulink" target="_top">#1785</a>
</li>
<li class="listitem">
Load Spring AMQP plugin- <a href="https://github.com/elastic/apm-agent-java/pull/1784" class="ulink" target="_top">#1784</a>
</li>
<li class="listitem">
Avoid <code class="literal">IllegalStateException</code> when multiple <code class="literal">tracestate</code> headers are used - <a href="https://github.com/elastic/apm-agent-java/pull/1808" class="ulink" target="_top">#1808</a>
</li>
<li class="listitem">
Ensure CLI attach avoids <code class="literal">sudo</code> only when required and avoid blocking - <a href="https://github.com/elastic/apm-agent-java/pull/1819" class="ulink" target="_top">#1819</a>
</li>
<li class="listitem">
Avoid sending metric-sets without samples, so to adhere to the intake API - <a href="https://github.com/elastic/apm-agent-java/pull/1826" class="ulink" target="_top">#1826</a>
</li>
<li class="listitem">
Fixing our type-pool cache, so that it can&#8217;t cause OOM (softly-referenced), and it gets cleared when not used for
a while - <a href="https://github.com/elastic/apm-agent-java/pull/1828" class="ulink" target="_top">#1828</a>
</li>
</ul>
</div>
<h5><a id="_refactors"></a>Refactors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Remove single-package limitation for embedded plugins - <a href="https://github.com/elastic/apm-agent-java/pull/1780" class="ulink" target="_top">#1780</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.23.0"></a>1.23.0 - 2021/04/22<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes_4"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
There are breaking changes in the <a class="xref" href="setup-attach-cli.html" title="Automatic setup with apm-agent-attach-cli.jar">attacher cli</a>.
See the Features section for more information.
</li>
</ul>
</div>
<h5><a id="_features_17"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Overhaul of the <a class="xref" href="setup-attach-cli.html" title="Automatic setup with apm-agent-attach-cli.jar">attacher cli</a> application that allows to attach the agent to running JVMs - <a href="https://github.com/elastic/apm-agent-java/pull/1667" class="ulink" target="_top">#1667</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The artifact of the standalone cli application is now called <code class="literal">apm-agent-attach-cli</code>. The attacher API is still called <code class="literal">apm-agent-attach</code>.
</li>
<li class="listitem">
There is also a slim version of the cli application that does not bundle the Java agent.
It requires the <code class="literal">--agent-jar</code> option to be set.
</li>
<li class="listitem">
Improved logging<br>
The application uses <a href="/guide/en/ecs-logging/java/1.x/intro.html" class="ulink" target="_top">Java ECS logging</a> to emit JSON logs.
The log level can be configured with the <code class="literal">--log-level</code> option.
By default, the program is logging to the console but using the <code class="literal">--log-file</code> option, it can also log to a file.
</li>
<li class="listitem">
Attach to JVMs running under a different user (unix only)<br>
The JVM requires the attacher to be running under the same user as the target VM (the attachee).
The <code class="literal">apm-agent-attach-standalone.jar</code> can now be run with a user that has permissions to switch to the user that runs the target VM.
On Windows, the attacher can still only attach to JVMs that are running with under the same user.
</li>
<li class="listitem">
<p>New include/exclude discovery rules<br></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">--include-all</code>: Attach to all discovered JVMs. If no matchers are provided, it will not attach to any JVMs.
</li>
<li class="listitem">
<code class="literal">--include-user</code>/<code class="literal">--exclude-user</code>: Attach to all JVMs of a given operating system user.
</li>
<li class="listitem">
<code class="literal">--include-main</code>/<code class="literal">--exclude-main</code>: Attach to all JVMs that whose main class/jar name, or system properties match the provided regex.
</li>
<li class="listitem">
<code class="literal">--include-vmargs</code>/<code class="literal">--exclude-vmargs</code>: Attach to all JVMs that whose main class/jar name, or system properties match the provided regex.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Removal of options<br></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The deprecated <code class="literal">--arg</code> option has been removed.
</li>
<li class="listitem">
The <code class="literal">-i</code>/<code class="literal">--include</code>, <code class="literal">-e</code>/<code class="literal">exclude</code> options have been removed in favor of the <code class="literal">--&lt;include|exclude&gt;-&lt;main|vmargs&gt;</code> options.
</li>
<li class="listitem">
The <code class="literal">-p</code>/<code class="literal">--pid</code> options have been removed in favor of the <code class="literal">--include-pid</code> option.
</li>
</ul>
</div>
</li>
<li class="listitem">
Changed behavior of  the <code class="literal">-l</code>/<code class="literal">--list</code> option<br>
The option now only lists JVMs that match the include/exclude discovery rules.
Thus, it can be used to do a dry-run of the matchers without actually performing an attachment.
It even works in combination with <code class="literal">--continuous</code> now.
By default, the VM arguments are not printed, but only when the <code class="literal">-a</code>/<code class="literal">--list-vmargs</code> option is set.
</li>
<li class="listitem">
Remove dependency on <code class="literal">jps</code><br>
Even when matching on the main class name or on system properties,
</li>
<li class="listitem">
Checks the Java version before attaching to avoid attachment on unsupported JVMs.
</li>
</ul>
</div>
</li>
<li class="listitem">
Cassandra instrumentation - <a href="https://github.com/elastic/apm-agent-java/pull/1712" class="ulink" target="_top">#1712</a>
</li>
<li class="listitem">
Log correlation supports JBoss Logging - <a href="https://github.com/elastic/apm-agent-java/pull/1737" class="ulink" target="_top">#1737</a>
</li>
<li class="listitem">
Update Byte-buddy to <code class="literal">1.11.0</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1769" class="ulink" target="_top">#1769</a>
</li>
<li class="listitem">
Support for user.domain <a href="https://github.com/elastic/apm-agent-java/pull/1756" class="ulink" target="_top">#1756</a>
</li>
<li class="listitem">
JAX-RS supports javax.ws.rs.PATCH
</li>
<li class="listitem">
Enabling build and unit tests on Windows - <a href="https://github.com/elastic/apm-agent-java/pull/1671" class="ulink" target="_top">#1671</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_21"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixed log correlation for log4j2 - <a href="https://github.com/elastic/apm-agent-java/pull/1720" class="ulink" target="_top">#1720</a>
</li>
<li class="listitem">
Fix apm-log4j1-plugin and apm-log4j2-plugin dependency on slf4j - <a href="https://github.com/elastic/apm-agent-java/pull/1723" class="ulink" target="_top">#1723</a>
</li>
<li class="listitem">
Avoid systematic <code class="literal">MessageNotWriteableException</code> error logging, now only visible in <code class="literal">debug</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1715" class="ulink" target="_top">#1715</a> and <a href="https://github.com/elastic/apm-agent-java/pull/1730" class="ulink" target="_top">#1730</a>
</li>
<li class="listitem">
Fix rounded number format for non-english locales - <a href="https://github.com/elastic/apm-agent-java/pull/1728" class="ulink" target="_top">#1728</a>
</li>
<li class="listitem">
Fix <code class="literal">NullPointerException</code> on legacy Apache client instrumentation when host is <code class="literal">null</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1746" class="ulink" target="_top">#1746</a>
</li>
<li class="listitem">
Apply consistent proxy class exclusion heuristic - <a href="https://github.com/elastic/apm-agent-java/pull/1738" class="ulink" target="_top">#1738</a>
</li>
<li class="listitem">
Fix micrometer serialization error - <a href="https://github.com/elastic/apm-agent-java/pull/1741" class="ulink" target="_top">#1741</a>
</li>
<li class="listitem">
Optimize &amp; avoid <code class="literal">ensureInstrumented</code> deadlock by skipping stack-frame computation for Java7+ bytecode - <a href="https://github.com/elastic/apm-agent-java/pull/1758" class="ulink" target="_top">#1758</a>
</li>
<li class="listitem">
Fix instrumentation plugins loading on Windows - <a href="https://github.com/elastic/apm-agent-java/pull/1671" class="ulink" target="_top">#1671</a>
</li>
</ul>
</div>
<h5><a id="_refactors_2"></a>Refactors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Migrate some plugins to indy dispatcher <a href="https://github.com/elastic/apm-agent-java/pull/1369" class="ulink" target="_top">#1369</a> <a href="https://github.com/elastic/apm-agent-java/pull/1410" class="ulink" target="_top">#1410</a> <a href="https://github.com/elastic/apm-agent-java/pull/1374" class="ulink" target="_top">#1374</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.22.0"></a>1.22.0 - 2021/03/24<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes_5"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Dots in metric names of Micrometer metrics get replaced with underscores to avoid mapping conflicts.
De-dotting be disabled via <a class="xref" href="config-metrics.html#config-dedot-custom-metrics" title="dedot_custom_metrics ()"><code class="literal">dedot_custom_metrics</code></a>. - <a href="https://github.com/elastic/apm-agent-java/pull/1700" class="ulink" target="_top">#1700</a>
</li>
</ul>
</div>
<h5><a id="_features_18"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Introducing a new mechanism to ease the development of community instrumentation plugins. See <a class="xref" href="config-core.html#config-plugins-dir" title="plugins_dir (experimental)"><code class="literal">plugins_dir</code> (experimental)</a> for
more details. This configuration was already added in 1.18.0, but more extensive and continuous integration testing
allows us to expose it now. It is still marked as "experimental" though, meaning that future changes in the mechanism
may break early contributed plugins. However, we highly encourage our community to try it out and we will do our best
to assist with such efforts.
</li>
<li class="listitem">
Deprecating <code class="literal">ignore_user_agents</code> in favour of <code class="literal">transaction_ignore_user_agents</code>, maintaining the same functionality -
<a href="https://github.com/elastic/apm-agent-java/pull/1644" class="ulink" target="_top">#1644</a>
</li>
<li class="listitem">
Update existing Hibernate Search 6 instrumentation to the final relase
</li>
<li class="listitem">
The <a class="xref" href="config-http.html#config-use-path-as-transaction-name" title="use_path_as_transaction_name ()"><code class="literal">use_path_as_transaction_name</code></a> option is now dynamic
</li>
<li class="listitem">
Flushing internal and micrometer metrics before the agent shuts down - <a href="https://github.com/elastic/apm-agent-java/pull/1658" class="ulink" target="_top">#1658</a>
</li>
<li class="listitem">
Support for OkHttp 4.4+ -  <a href="https://github.com/elastic/apm-agent-java/pull/1672" class="ulink" target="_top">#1672</a>
</li>
<li class="listitem">
Adding capability to automatically create ECS-JSON-formatted version of the original application log files, through
the <a class="xref" href="config-logging.html#config-log-ecs-reformatting" title="log_ecs_reformatting ( experimental)"><code class="literal">log_ecs_reformatting</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.22.0</span>]
<span class="Admonishment-detail">
Added in 1.22.0.
</span>
</span> experimental)</a> config option. This allows effortless ingestion of logs to Elasticsearch without
any further configuration. Supports log4j1, log4j2 and Logback. <a href="https://github.com/elastic/apm-agent-java/pull/1261" class="ulink" target="_top">#1261</a>
</li>
<li class="listitem">
Add support to Spring AMQP - <a href="https://github.com/elastic/apm-agent-java/pull/1657" class="ulink" target="_top">#1657</a>
</li>
<li class="listitem">
Adds the ability to automatically configure usage of the OpenTracing bridge in systems using ServiceLoader - <a href="https://github.com/elastic/apm-agent-java/pull/1708" class="ulink" target="_top">#1708</a>
</li>
<li class="listitem">
Update to async-profiler 1.8.5 - includes a fix to a Java 7 crash and enhanced safe mode to better deal with
corrupted stack frames.
</li>
<li class="listitem">
Add a warning on startup when <code class="literal">-Xverify:none</code> or <code class="literal">-noverify</code> flags are set as this can lead to crashes that are very
difficult to debug - <a href="https://github.com/elastic/apm-agent-java/pull/1593" class="ulink" target="_top">#1593</a>. In an upcoming version, the agent will not start when these flags are set,
unless the system property <code class="literal">elastic.apm.disable_bootstrap_checks</code> is set to true.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_22"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix sample rate rounded to zero when lower than precision - <a href="https://github.com/elastic/apm-agent-java/pull/1655" class="ulink" target="_top">#1655</a>
</li>
<li class="listitem">
fixed a couple of bugs with the external plugin mechanism (not documented until now) - <a href="https://github.com/elastic/apm-agent-java/pull/1660" class="ulink" target="_top">#1660</a>
</li>
<li class="listitem">
Fix runtime attach conflict with multiple users - <a href="https://github.com/elastic/apm-agent-java/pull/1704" class="ulink" target="_top">#1704</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.21.0"></a>1.21.0 - 2021/02/09<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes_6"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Following PR <a href="https://github.com/elastic/apm-agent-java/pull/1650" class="ulink" target="_top">#1650</a>, there are two slight changes with the <a class="xref" href="config-reporter.html#config-server-url" title="server_url"><code class="literal">server_url</code></a> and <a class="xref" href="config-reporter.html#config-server-urls" title="server_urls"><code class="literal">server_urls</code></a>
configuration options:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
So far, setting <code class="literal">server_urls</code> with an empty string would allow the agent to work normally, apart from any action
that requires communication with the APM Server, including the attempt to fetch a central configuration.
Starting in this agent version, setting <code class="literal">server_urls</code> to empty string doesn&#8217;t have any special meaning, it is
the default expected configuration, where <code class="literal">server_url</code> will be used instead. In order to achieve the same
behaviour, use the new <a class="xref" href="config-reporter.html#config-disable-send" title="disable_send"><code class="literal">disable_send</code></a> configuration.
</li>
<li class="listitem">
Up to this version, <code class="literal">server_url</code> was used as an alias to <code class="literal">server_urls</code>, meaning that one could potentially set
the <code class="literal">server_url</code> config with a comma-separated list of multiple APM Server addresses, and that would have been a
valid configuration. Starting in this agent version, <code class="literal">server_url</code> is a separate configuration, and it only accepts
Strings that represent a single valid URL. Specifically, empty strings and commas are invalid.
</li>
</ol>
</div>
</li>
</ul>
</div>
<h5><a id="_features_19"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add cloud provider metadata to reported events, see
<a href="https://github.com/elastic/apm/blob/master/specs/agents/metadata.md#cloud-provider-metadata" class="ulink" target="_top">spec</a> for details.
By default, the agent will try to automatically detect the cloud provider on startup, but this can be
configured through the <a class="xref" href="config-core.html#config-cloud-provider" title="cloud_provider ()"><code class="literal">cloud_provider</code></a> config option - <a href="https://github.com/elastic/apm-agent-java/pull/1599" class="ulink" target="_top">#1599</a>
</li>
<li class="listitem">
Add span &amp; transaction <code class="literal">outcome</code> field to improve error rate calculations - <a href="https://github.com/elastic/apm-agent-java/pull/1613" class="ulink" target="_top">#1613</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_23"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixing crashes observed in Java 7 at sporadic timing by applying a few seconds delay on bootstrap - <a href="https://github.com/elastic/apm-agent-java/pull/1594" class="ulink" target="_top">#1594</a>
</li>
<li class="listitem">
Fallback to using "TLS" <code class="literal">SSLContext</code> when "SSL" is not available - <a href="https://github.com/elastic/apm-agent-java/pull/1633" class="ulink" target="_top">#1633</a>
</li>
<li class="listitem">
Fixing agent startup failure with <code class="literal">NullPointerException</code> thrown by Byte-buddy&#8217;s <code class="literal">MultipleParentClassLoader</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1647" class="ulink" target="_top">#1647</a>
</li>
<li class="listitem">
Fix cached type resolution triggering <code class="literal">ClassCastException</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1649" class="ulink" target="_top">#1649</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.20.0"></a>1.20.0 - 2021/01/07<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes_7"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The following public API types were <code class="literal">public</code> so far and became package-private: <code class="literal">NoopScope</code>, <code class="literal">ScopeImpl</code> and <code class="literal">AbstractSpanImpl</code>.
If your code is using them, you will need to change that when upgrading to this version.
Related PR: <a href="https://github.com/elastic/apm-agent-java/pull/1532" class="ulink" target="_top">#1532</a>
</li>
</ul>
</div>
<h5><a id="_features_20"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add support for RabbitMQ clients - <a href="https://github.com/elastic/apm-agent-java/pull/1328" class="ulink" target="_top">#1328</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_24"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix small memory allocation regression introduced with tracestate header <a href="https://github.com/elastic/apm-agent-java/pull/1508" class="ulink" target="_top">#1508</a>
</li>
<li class="listitem">
Fix <code class="literal">NullPointerException</code> from <code class="literal">WeakConcurrentMap.put</code> through the Elasticsearch client instrumentation - <a href="https://github.com/elastic/apm-agent-java/pull/1531" class="ulink" target="_top">#1531</a>
</li>
<li class="listitem">
Sending <code class="literal">transaction_id</code> and <code class="literal">parent_id</code> only for events that contain a valid <code class="literal">trace_id</code> as well - <a href="https://github.com/elastic/apm-agent-java/pull/1537" class="ulink" target="_top">#1537</a>
</li>
<li class="listitem">
Fix <code class="literal">ClassNotFoundError</code> with old versions of Spring resttemplate <a href="https://github.com/elastic/apm-agent-java/pull/1524" class="ulink" target="_top">#1524</a>
</li>
<li class="listitem">
Fix Micrometer-driven metrics validation errors by the APM Server when sending with illegal values - <a href="https://github.com/elastic/apm-agent-java/pull/1559" class="ulink" target="_top">#1559</a>
</li>
<li class="listitem">
Serialize all stack trace frames when setting <code class="literal">stack_trace_limit=-1</code> instead of none - <a href="https://github.com/elastic/apm-agent-java/pull/1571" class="ulink" target="_top">#1571</a>
</li>
<li class="listitem">
Fix <code class="literal">UnsupportedOperationException</code> when calling <code class="literal">ServletContext.getClassLoader()</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1576" class="ulink" target="_top">#1576</a>
</li>
<li class="listitem">
Fix improper request body capturing - <a href="https://github.com/elastic/apm-agent-java/pull/1579" class="ulink" target="_top">#1579</a>
</li>
<li class="listitem">
Avoid <code class="literal">NullPointerException</code> due to null return values instrumentation advices - <a href="https://github.com/elastic/apm-agent-java/pull/1601" class="ulink" target="_top">#1601</a>
</li>
<li class="listitem">
Update async-profiler to 1.8.3 <a href="https://github.com/elastic/apm-agent-java/pull/1602" class="ulink" target="_top">1602</a>
</li>
<li class="listitem">
Use null-safe data structures to avoid <code class="literal">NullPointerException</code> <a href="https://github.com/elastic/apm-agent-java/pull/1597" class="ulink" target="_top">1597</a>
</li>
<li class="listitem">
Fix memory leak in sampling profiler mechanism - <a href="https://github.com/elastic/apm-agent-java/pull/1592" class="ulink" target="_top">#1592</a>
</li>
</ul>
</div>
<h5><a id="_refactors_3"></a>Refactors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Migrate some plugins to indy dispatcher <a href="https://github.com/elastic/apm-agent-java/pull/1405" class="ulink" target="_top">#1405</a> <a href="https://github.com/elastic/apm-agent-java/pull/1394" class="ulink" target="_top">#1394</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.19.0"></a>1.19.0 - 2020/11/10<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_21"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The agent version now includes a git hash if it&#8217;s a snapshot version.
This makes it easier to differ distinct snapshot builds of the same version.
Example: <code class="literal">1.18.1-SNAPSHOT.4655910</code>
</li>
<li class="listitem">
Add support for sampling weight with propagation in <code class="literal">tracestate</code> W3C header <a href="https://github.com/elastic/apm-agent-java/pull/1384" class="ulink" target="_top">#1384</a>
</li>
<li class="listitem">
Adding two more valid options to the <code class="literal">log_level</code> config: <code class="literal">WARNING</code> (equivalent to <code class="literal">WARN</code>) and <code class="literal">CRITICAL</code>
(will be treated as <code class="literal">ERROR</code>) - <a href="https://github.com/elastic/apm-agent-java/pull/1431" class="ulink" target="_top">1431</a>
</li>
<li class="listitem">
Add the ability to disable Servlet-related spans for <code class="literal">INCLUDE</code>, <code class="literal">FORWARD</code> and <code class="literal">ERROR</code> dispatches (without affecting
basic Servlet capturing) by adding <code class="literal">servlet-api-dispatch</code> to <a class="xref" href="config-core.html#config-disable-instrumentations" title="disable_instrumentations ()"><code class="literal">disable_instrumentations</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.0.0</span>]
<span class="Admonishment-detail">
Added in 1.0.0. Changing this value at runtime is possible since version 1.15.0
</span>
</span>)</a> - <a href="https://github.com/elastic/apm-agent-java/pull/1448" class="ulink" target="_top">1448</a>
</li>
<li class="listitem">
Add Sampling Profiler support for AArch64 architectures - <a href="https://github.com/elastic/apm-agent-java/pull/1443" class="ulink" target="_top">1443</a>
</li>
<li class="listitem">
Support proper transaction naming when using Spring&#8217;s <code class="literal">ServletWrappingController</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1461" class="ulink" target="_top">#1461</a>
</li>
<li class="listitem">
Update async-profiler to 1.8.2 <a href="https://github.com/elastic/apm-agent-java/pull/1471" class="ulink" target="_top">1471</a>
</li>
<li class="listitem">
Update existing Hibernate Search 6 instrumentation to work with the latest CR1 release
</li>
<li class="listitem">
Deprecating the <code class="literal">addLabel</code> public API in favor of <code class="literal">setLabel</code> (still supporting <code class="literal">addLabel</code>) - <a href="https://github.com/elastic/apm-agent-java/pull/1449" class="ulink" target="_top">#1449</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_25"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix <code class="literal">HttpUrlConnection</code> instrumentation issue (affecting distributed tracing as well) when using HTTPS without using
<code class="literal">java.net.HttpURLConnection#disconnect</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1447" class="ulink" target="_top">1447</a>
</li>
<li class="listitem">
Fixes class loading issue that can occur when deploying multiple applications to the same application server - <a href="https://github.com/elastic/apm-agent-java/pull/1458" class="ulink" target="_top">#1458</a>
</li>
<li class="listitem">
Fix ability to disable agent on startup wasn&#8217;t working for runtime attach <a href="https://github.com/elastic/apm-agent-java/pull/1444" class="ulink" target="_top">1444</a>
</li>
<li class="listitem">
Avoid <code class="literal">UnsupportedOperationException</code> on some spring application startup <a href="https://github.com/elastic/apm-agent-java/pull/1464" class="ulink" target="_top">1464</a>
</li>
<li class="listitem">
Fix ignored runtime attach <code class="literal">config_file</code> <a href="https://github.com/elastic/apm-agent-java/pull/1469" class="ulink" target="_top">1469</a>
</li>
<li class="listitem">
Fix <code class="literal">IllegalAccessError: Module 'java.base' no access to: package 'java.lang'...</code> in J9 VMs of Java version &gt;= 9 -
<a href="https://github.com/elastic/apm-agent-java/pull/1468" class="ulink" target="_top">#1468</a>
</li>
<li class="listitem">
Fix JVM version parsing on HP-UX <a href="https://github.com/elastic/apm-agent-java/pull/1477" class="ulink" target="_top">#1477</a>
</li>
<li class="listitem">
Fix Spring-JMS transactions lifecycle management when using multiple concurrent consumers - <a href="https://github.com/elastic/apm-agent-java/pull/1496" class="ulink" target="_top">#1496</a>
</li>
</ul>
</div>
<h5><a id="_refactors_4"></a>Refactors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Migrate some plugins to indy dispatcher <a href="https://github.com/elastic/apm-agent-java/pull/1404" class="ulink" target="_top">1404</a> <a href="https://github.com/elastic/apm-agent-java/pull/1411" class="ulink" target="_top">1411</a>
</li>
<li class="listitem">
Replace System Rules with System Lambda <a href="https://github.com/elastic/apm-agent-java/pull/1434" class="ulink" target="_top">#1434</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.18.1"></a>1.18.1 - 2020/10/06<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_refactors_5"></a>Refactors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Migrate some plugins to indy dispatcher <a href="https://github.com/elastic/apm-agent-java/pull/1362" class="ulink" target="_top">1362</a> <a href="https://github.com/elastic/apm-agent-java/pull/1366" class="ulink" target="_top">1366</a> <a href="https://github.com/elastic/apm-agent-java/pull/1363" class="ulink" target="_top">1363</a> <a href="https://github.com/elastic/apm-agent-java/pull/1383" class="ulink" target="_top">1383</a> <a href="https://github.com/elastic/apm-agent-java/pull/1368" class="ulink" target="_top">1368</a> <a href="https://github.com/elastic/apm-agent-java/pull/1364" class="ulink" target="_top">1364</a> <a href="https://github.com/elastic/apm-agent-java/pull/1365" class="ulink" target="_top">1365</a> <a href="https://github.com/elastic/apm-agent-java/pull/1367" class="ulink" target="_top">1367</a> <a href="https://github.com/elastic/apm-agent-java/pull/1371" class="ulink" target="_top">1371</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_26"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix instrumentation error for HttpClient - <a href="https://github.com/elastic/apm-agent-java/pull/1402" class="ulink" target="_top">#1402</a>
</li>
<li class="listitem">
Eliminate <code class="literal">unsupported class version error</code> messages related to loading the Java 11 HttpClient plugin in pre-Java-11 JVMs <a href="https://github.com/elastic/apm-agent-java/pull/1397" class="ulink" target="_top">1397</a>
</li>
<li class="listitem">
Fix rejected metric events by APM Server with response code 400 due to data validation error - sanitizing Micrometer
metricset tag keys - <a href="https://github.com/elastic/apm-agent-java/pull/1413" class="ulink" target="_top">1413</a>
</li>
<li class="listitem">
Fix invalid micrometer metrics with non-numeric values <a href="https://github.com/elastic/apm-agent-java/pull/1419" class="ulink" target="_top">1419</a>
</li>
<li class="listitem">
Fix <code class="literal">NoClassDefFoundError</code> with JDBC instrumentation plugin <a href="https://github.com/elastic/apm-agent-java/pull/1409" class="ulink" target="_top">1409</a>
</li>
<li class="listitem">
Apply <code class="literal">disable_metrics</code> config to Micrometer metrics - <a href="https://github.com/elastic/apm-agent-java/pull/1421" class="ulink" target="_top">1421</a>
</li>
<li class="listitem">
Remove cgroup <code class="literal">inactive_file.bytes</code> metric according to spec <a href="https://github.com/elastic/apm-agent-java/pull/1422" class="ulink" target="_top">1422</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.18.0"></a>1.18.0 - 2020/09/08<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_22"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Deprecating <code class="literal">ignore_urls</code> config in favour of <a class="xref" href="config-http.html#config-transaction-ignore-urls" title="transaction_ignore_urls"><code class="literal">transaction_ignore_urls</code></a> to align
with other agents, while still allowing the old config name for backward compatibility - <a href="https://github.com/elastic/apm-agent-java/pull/1315" class="ulink" target="_top">#1315</a>
</li>
<li class="listitem">
Enabling instrumentation of classes compiled with Java 1.4. This is reverting the restriction of instrumenting only
bytecode of Java 1.5 or higher (<a href="https://github.com/elastic/apm-agent-java/pull/320" class="ulink" target="_top">#320</a>), which was added due to potential <code class="literal">VerifyError</code>. Such errors should be
avoided now by the usage of <code class="literal">TypeConstantAdjustment</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1317" class="ulink" target="_top">#1317</a>
</li>
<li class="listitem">
Enabling agent to work without attempting any communication with APM server, by allowing setting <code class="literal">server_urls</code> with
an empty string - <a href="https://github.com/elastic/apm-agent-java/pull/1295" class="ulink" target="_top">#1295</a>
</li>
<li class="listitem">
Add <a class="xref" href="metrics.html#metrics-micrometer" title="Micrometer metrics">micrometer support</a> - <a href="https://github.com/elastic/apm-agent-java/pull/1303" class="ulink" target="_top">#1303</a>
</li>
<li class="listitem">
Add <code class="literal">profiling_inferred_spans_lib_directory</code> option to override the default temp directory used for exporting the async-profiler library.
This is useful for server-hardened environments where <code class="literal">/tmp</code> is often configured with <code class="literal">noexec</code>, leading to <code class="literal">java.lang.UnsatisfiedLinkError</code> errors - <a href="https://github.com/elastic/apm-agent-java/pull/1350" class="ulink" target="_top">#1350</a>
</li>
<li class="listitem">
Create spans for Servlet dispatches to FORWARD, INCLUDE and ERROR - <a href="https://github.com/elastic/apm-agent-java/pull/1212" class="ulink" target="_top">#1212</a>
</li>
<li class="listitem">
Support JDK 11 HTTPClient - <a href="https://github.com/elastic/apm-agent-java/pull/1307" class="ulink" target="_top">#1307</a>
</li>
<li class="listitem">
Lazily create profiler temporary files <a href="https://github.com/elastic/apm-agent-java/pull/1360" class="ulink" target="_top">#1360</a>
</li>
<li class="listitem">
Convert the followings to Indy Plugins (see details in <a class="xref" href="release-notes-1.x.html#release-notes-1.18.0.rc1" title="1.18.0.RC1 - 2020/07/22">1.18.0-rc1 relase notes</a>): gRPC,
AsyncHttpClient, Apache HttpClient
</li>
<li class="listitem">
The agent now collects cgroup memory metrics (see details in <a class="xref" href="metrics.html#metrics-cgroup" title="cgroup metrics (added in 1.18.0)">Metrics page</a>)
</li>
<li class="listitem">
Update async-profiler to 1.8.1 <a href="https://github.com/elastic/apm-agent-java/pull/1382" class="ulink" target="_top">#1382</a>
</li>
<li class="listitem">
Runtime attach install option is promoted to <em>beta</em> status (was experimental).
</li>
</ul>
</div>
<h5><a id="_bug_fixes_27"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixes a <code class="literal">NoClassDefFoundError</code> in the JMS instrumentation of <code class="literal">MessageListener</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1287" class="ulink" target="_top">#1287</a>
</li>
<li class="listitem">
Fix <code class="literal">/ by zero</code> error message when setting <code class="literal">server_urls</code> with an empty string - <a href="https://github.com/elastic/apm-agent-java/pull/1295" class="ulink" target="_top">#1295</a>
</li>
<li class="listitem">
Fix <code class="literal">ClassNotFoundException</code> or <code class="literal">ClassCastException</code> in some cases where special log4j configurations are used - <a href="https://github.com/elastic/apm-agent-java/pull/1322" class="ulink" target="_top">#1322</a>
</li>
<li class="listitem">
Fix <code class="literal">NumberFormatException</code> when using early access Java version - <a href="https://github.com/elastic/apm-agent-java/pull/1325" class="ulink" target="_top">#1325</a>
</li>
<li class="listitem">
Fix <code class="literal">service_name</code> config being ignored when set to the same auto-discovered default value - <a href="https://github.com/elastic/apm-agent-java/pull/1324" class="ulink" target="_top">#1324</a>
</li>
<li class="listitem">
Fix service name error when updating a web app on a Servlet container - <a href="https://github.com/elastic/apm-agent-java/pull/1326" class="ulink" target="_top">#1326</a>
</li>
<li class="listitem">
Fix remote attach <em>jps</em> executable not found when <em>java</em> binary is symlinked ot a JRE - <a href="https://github.com/elastic/apm-agent-java/pull/1352" class="ulink" target="_top">#1352</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.18.0.rc1"></a>1.18.0.RC1 - 2020/07/22<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<p>This release candidate adds some highly anticipated features:
It’s now possible to attach the agent at runtime in more cases than before.
Most notably, it enables runtime attachment on JBoss, WildFly, Glassfish/Payara,
and other OSGi runtimes such as Atlassian Jira and Confluence.</p>
<p>To make this and other significant features, such as <a href="https://github.com/elastic/apm-agent-java/issues/937" class="ulink" target="_top">external plugins</a>, possible,
we have implemented major changes to the architecture of the agent.
The agent now relies on the <code class="literal">invokedynamic</code> bytecode instruction to make plugin development easier, safer, and more efficient.
As early versions of Java 7 and Java 8 have unreliable support for invokedynamic,
we now require a minimum update level of 60 for Java 7 (7u60+) in addition to the existing minimum update level of 40 for Java 8 (8u40+).</p>
<p>We’re looking for users who would like to try this out to give feedback.
If we see that the <code class="literal">invokedynamic</code>-based approach (<a href="https://github.com/elastic/apm-agent-java/pull/1230" class="ulink" target="_top">indy plugins</a>) works well, we can continue and migrate the rest of the plugins.
After the migration has completed, we can move forward with external plugins and remove the experimental label from runtime attachment.</p>
<p>If all works like in our testing, you would not see <code class="literal">NoClassDefFoundError</code> s anymore when, for example, trying to attach the agent at runtime to an OSGi container or a JBoss server.
Also, non-standard OSGi containers, such as Atlassian Jira and other technologies with restrictive class loading policies, such as MuleSoft ESB, will benefit from this change.</p>
<p>In the worst case, there might be JVM crashes due to <code class="literal">invokedynamic</code>-related JVM bugs.
However, we already disable the agent when attached to JVM versions that are known to be problematic.
Another potentially problematic area is that we now dynamically raise the bytecode version of instrumented classes to be at least bytecode version 51 (Java 7).
This is needed in order to be able to use the <code class="literal">invokedynamic</code> instruction.
This requires re-computation of stack map frames which makes instrumentation a bit slower.
We don&#8217;t anticipate notable slowdowns unless you extensively (over-)use <a class="xref" href="config-core.html#config-trace-methods" title="trace_methods ()"><code class="literal">trace_methods</code></a>.</p>
<h5><a id="_breaking_changes_8"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Early Java 7 versions, prior to update 60, are not supported anymore.
When trying to attach to a non-supported version, the agent will disable itself and not apply any instrumentations.
</li>
</ul>
</div>
<h5><a id="_features_23"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Experimental support for runtime attachment now also for OSGi containers, JBoss, and WildFly
</li>
<li class="listitem">
New mitigation of OSGi bootdelegation errors (<code class="literal">NoClassDefFoundError</code>).
You can remove any <code class="literal">org.osgi.framework.bootdelegation</code> related configuration.
This release also removes the configuration option <code class="literal">boot_delegation_packages</code>.
</li>
<li class="listitem">
Overhaul of the <code class="literal">ExecutorService</code> instrumentation that avoids <code class="literal">ClassCastException</code> issues - <a href="https://github.com/elastic/apm-agent-java/pull/1206" class="ulink" target="_top">#1206</a>
</li>
<li class="listitem">
Support for <code class="literal">ForkJoinPool</code> and <code class="literal">ScheduledExecutorService</code> (see <a class="xref" href="supported-technologies-details.html#supported-async-frameworks" title="Asynchronous frameworks">Asynchronous frameworks</a>)
</li>
<li class="listitem">
Support for <code class="literal">ExecutorService#invokeAny</code> and <code class="literal">ExecutorService#invokeAll</code>
</li>
<li class="listitem">
Added support for <code class="literal">java.util.TimerTask</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1235" class="ulink" target="_top">#1235</a>
</li>
<li class="listitem">
Add capturing of request body in Elasticsearch queries: <code class="literal">_msearch</code>, <code class="literal">_count</code>, <code class="literal">_msearch/template</code>, <code class="literal">_search/template</code>, <code class="literal">_rollup_search</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1222" class="ulink" target="_top">#1222</a>
</li>
<li class="listitem">
Add <a class="xref" href="config-core.html#config-enabled" title="enabled ()"><code class="literal">enabled</code></a> flag
</li>
<li class="listitem">
Add experimental support for Scala Futures
</li>
<li class="listitem">
The agent now collects heap memory pools metrics - <a href="https://github.com/elastic/apm-agent-java/pull/1228" class="ulink" target="_top">#1228</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_28"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixes error capturing for log4j2 loggers. Version 1.17.0 introduced a regression.
</li>
<li class="listitem">
Fixes <code class="literal">NullPointerException</code> related to JAX-RS and Quartz instrumentation - <a href="https://github.com/elastic/apm-agent-java/pull/1249" class="ulink" target="_top">#1249</a>
</li>
<li class="listitem">
Expanding k8s pod ID discovery to some formerly non-supported environments
</li>
<li class="listitem">
When <code class="literal">recording</code> is set to <code class="literal">false</code>, the agent will not send captured errors anymore.
</li>
<li class="listitem">
Fixes NPE in Dubbo instrumentation that occurs when the application is acting both as a provider and as a consumer - <a href="https://github.com/elastic/apm-agent-java/pull/1260" class="ulink" target="_top">#1260</a>
</li>
<li class="listitem">
Adding a delay by default what attaching the agent to Tomcat using the premain route to work around the JUL
deadlock issue - <a href="https://github.com/elastic/apm-agent-java/pull/1262" class="ulink" target="_top">#1262</a>
</li>
<li class="listitem">
Fixes missing <code class="literal">jboss.as:*</code> MBeans on JBoss - <a href="https://github.com/elastic/apm-agent-java/pull/1257" class="ulink" target="_top">#1257</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.17.0"></a>1.17.0 - 2020/06/17<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_24"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Log files are now rotated after they reach <a class="xref" href="config-logging.html#config-log-file-size" title="log_file_size ()"><code class="literal">log_file_size</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.17.0</span>]
<span class="Admonishment-detail">
Added in 1.17.0.
</span>
</span>)</a>.
There will always be one history file <code class="literal">${log_file}.1</code>.
</li>
<li class="listitem">
Add <a class="xref" href="config-logging.html#config-log-format-sout" title="log_format_sout ()"><code class="literal">log_format_sout</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.17.0</span>]
<span class="Admonishment-detail">
Added in 1.17.0.
</span>
</span>)</a> and <a class="xref" href="config-logging.html#config-log-format-file" title="log_format_file ()"><code class="literal">log_format_file</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.17.0</span>]
<span class="Admonishment-detail">
Added in 1.17.0.
</span>
</span>)</a> with the options <code class="literal">PLAIN_TEXT</code> and <code class="literal">JSON</code>.
The latter uses <a href="https://github.com/elastic/ecs-logging-java" class="ulink" target="_top">ecs-logging-java</a> to format the logs.
</li>
<li class="listitem">
Exposing <a class="xref" href="config-core.html#config-classes-excluded-from-instrumentation" title="classes_excluded_from_instrumentation"><code class="literal">classes_excluded_from_instrumentation</code></a> config - <a href="https://github.com/elastic/apm-agent-java/pull/1187" class="ulink" target="_top">#1187</a>
</li>
<li class="listitem">
Add support for naming transactions based on Grails controllers. Supports Grails 3+ - <a href="https://github.com/elastic/apm-agent-java/pull/1171" class="ulink" target="_top">#1171</a>
</li>
<li class="listitem">
Add support for the Apache/Alibaba Dubbo RPC framework
</li>
<li class="listitem">
Async Profiler version upgraded to 1.7.1, with a new debugging flag for the stack frame recovery mechanism - <a href="https://github.com/elastic/apm-agent-java/pull/1173" class="ulink" target="_top">#1173</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_29"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixes <code class="literal">IndexOutOfBoundsException</code> that can occur when profiler-inferred spans are enabled.
This also makes the profiler more resilient by just removing the call tree related to the exception (which might be in an invalid state)
as opposed to stopping the profiler when an exception occurs.
</li>
<li class="listitem">
Fix <code class="literal">NumberFormatException</code> when parsing Ingres/Actian JDBC connection strings - <a href="https://github.com/elastic/apm-agent-java/pull/1198" class="ulink" target="_top">#1198</a>
</li>
<li class="listitem">
Prevent agent from overriding JVM configured truststore when not using HTTPS for communication with APM server - <a href="https://github.com/elastic/apm-agent-java/pull/1203" class="ulink" target="_top">#1203</a>
</li>
<li class="listitem">
Fix <code class="literal">java.lang.IllegalStateException</code> with <code class="literal">jps</code> JVM when using continuous runtime attach - <a href="https://github.com/elastic/apm-agent-java/pull/1205" class="ulink" target="_top">1205</a>
</li>
<li class="listitem">
Fix agent trying to load log4j2 plugins from application - <a href="https://github.com/elastic/apm-agent-java/pull/1214" class="ulink" target="_top">1214</a>
</li>
<li class="listitem">
Fix memory leak in gRPC instrumentation plugin - <a href="https://github.com/elastic/apm-agent-java/pull/1196" class="ulink" target="_top">1196</a>
</li>
<li class="listitem">
Fix HTTPS connection failures when agent is configured to use HTTPS to communicate with APM server <a href="https://github.com/elastic/apm-agent-java/pull/1209" class="ulink" target="_top">1209</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.16.0"></a>1.16.0 - 2020/05/13<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_25"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The log correlation feature now adds <code class="literal">error.id</code> to the MDC. See <a class="xref" href="supported-technologies-details.html#supported-logging-frameworks" title="Logging frameworks">Logging frameworks</a> for details. - <a href="https://github.com/elastic/apm-agent-java/pull/1050" class="ulink" target="_top">#1050</a>
</li>
<li class="listitem">
Deprecating the <code class="literal">incubating</code> tag in favour of the <code class="literal">experimental</code> tag. This is not a breaking change, so former
<a class="xref" href="config-core.html#config-disable-instrumentations" title="disable_instrumentations ()"><code class="literal">disable_instrumentation</code></a> configuration containing the <code class="literal">incubating</code> tag will still be respected - <a href="https://github.com/elastic/apm-agent-java/pull/1123" class="ulink" target="_top">#1123</a>
</li>
<li class="listitem">
Add a <code class="literal">--without-emulated-attach</code> option for runtime attachment to allow disabling this feature as a workaround.
</li>
<li class="listitem">
Add workaround for JDK bug JDK-8236039 with TLS 1.3 <a href="https://github.com/elastic/apm-agent-java/pull/1149" class="ulink" target="_top">#1149</a>
</li>
<li class="listitem">
Add log level <code class="literal">OFF</code> to silence agent logging
</li>
<li class="listitem">
Adds <a class="xref" href="config-core.html#config-span-min-duration" title="span_min_duration ()"><code class="literal">span_min_duration</code></a> option to exclude fast executing spans.
When set together with one of the more specific thresholds - <code class="literal">trace_methods_duration_threshold</code> or <code class="literal">profiling_inferred_spans_min_duration</code>,
the higher threshold will determine which spans will be discarded.
</li>
<li class="listitem">
Automatically instrument quartz jobs from the quartz-jobs artifact <a href="https://github.com/elastic/apm-agent-java/pull/1170" class="ulink" target="_top">#1170</a>
</li>
<li class="listitem">
Perform re-parenting of regular spans to be a child of profiler-inferred spans. Requires APM Server and Kibana 7.8.0. <a href="https://github.com/elastic/apm-agent-java/pull/1117" class="ulink" target="_top">#1117</a>
</li>
<li class="listitem">
Upgrade Async Profiler version to 1.7.0
</li>
</ul>
</div>
<h5><a id="_bug_fixes_30"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
When Servlet-related Exceptions are handled through exception handlers that return a 200 status code, agent shouldn&#8217;t override with 500 - <a href="https://github.com/elastic/apm-agent-java/pull/1103" class="ulink" target="_top">#1103</a>
</li>
<li class="listitem">
Exclude Quartz 1 from instrumentation to avoid
<code class="literal">IncompatibleClassChangeError: Found class org.quartz.JobExecutionContext, but interface was expected</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1108" class="ulink" target="_top">#1108</a>
</li>
<li class="listitem">
Fix breakdown metrics span sub-types <a href="https://github.com/elastic/apm-agent-java/pull/1113" class="ulink" target="_top">#1113</a>
</li>
<li class="listitem">
Fix flaky gRPC server instrumentation <a href="https://github.com/elastic/apm-agent-java/pull/1122" class="ulink" target="_top">#1122</a>
</li>
<li class="listitem">
Fix side effect of calling <code class="literal">Statement.getUpdateCount</code> more than once <a href="https://github.com/elastic/apm-agent-java/pull/1139" class="ulink" target="_top">#1139</a>
</li>
<li class="listitem">
Stop capturing JDBC affected rows count using <code class="literal">Statement.getUpdateCount</code> to prevent unreliable side-effects <a href="https://github.com/elastic/apm-agent-java/pull/1147" class="ulink" target="_top">#1147</a>
</li>
<li class="listitem">
Fix OpenTracing error tag handling (set transaction error result when tag value is <code class="literal">true</code>) <a href="https://github.com/elastic/apm-agent-java/pull/1159" class="ulink" target="_top">#1159</a>
</li>
<li class="listitem">
Due to a bug in the build we didn&#8217;t include the gRPC plugin in the build so far
</li>
<li class="listitem">
<code class="literal">java.lang.ClassNotFoundException: Unable to load class 'jdk.internal...'</code> is thrown when tracing specific versions of Atlassian systems <a href="https://github.com/elastic/apm-agent-java/pull/1168" class="ulink" target="_top">#1168</a>
</li>
<li class="listitem">
Make sure spans are kept active during <code class="literal">AsyncHandler</code> methods in the <code class="literal">AsyncHttpClient</code>
</li>
<li class="listitem">
CPU and memory metrics are sometimes not reported properly when using IBM J9 <a href="https://github.com/elastic/apm-agent-java/pull/1148" class="ulink" target="_top">#1148</a>
</li>
<li class="listitem">
<code class="literal">NullPointerException</code> thrown by the agent on WebLogic <a href="https://github.com/elastic/apm-agent-java/pull/1142" class="ulink" target="_top">#1142</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.15.0"></a>1.15.0 - 2020/03/27<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes_9"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Ordering of configuration sources has slightly changed, please review <a class="xref" href="configuration.html" title="Configuration"><em>Configuration</em></a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">elasticapm.properties</code> file now has higher priority over java system properties and environment variables,<br>
This change allows to change dynamic options values at runtime by editing file, previously values set in java properties
or environment variables could not be overridden, even if they were dynamic.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Renamed some configuration options related to the experimental profiler-inferred spans feature (<a href="https://github.com/elastic/apm-agent-java/pull/1084" class="ulink" target="_top">#1084</a>):</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">profiling_spans_enabled</code> &#8594; <code class="literal">profiling_inferred_spans_enabled</code>
</li>
<li class="listitem">
<code class="literal">profiling_sampling_interval</code> &#8594; <code class="literal">profiling_inferred_spans_sampling_interval</code>
</li>
<li class="listitem">
<code class="literal">profiling_spans_min_duration</code> &#8594; <code class="literal">profiling_inferred_spans_min_duration</code>
</li>
<li class="listitem">
<code class="literal">profiling_included_classes</code> &#8594; <code class="literal">profiling_inferred_spans_included_classes</code>
</li>
<li class="listitem">
<code class="literal">profiling_excluded_classes</code> &#8594; <code class="literal">profiling_inferred_spans_excluded_classes</code>
</li>
<li class="listitem">
Removed <code class="literal">profiling_interval</code> and <code class="literal">profiling_duration</code> (both are fixed to 5s now)
</li>
</ul>
</div>
</li>
</ul>
</div>
<h5><a id="_features_26"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Gracefully abort agent init when running on a known Java 8 buggy JVM <a href="https://github.com/elastic/apm-agent-java/pull/1075" class="ulink" target="_top">#1075</a>.
</li>
<li class="listitem">
Add support for <a class="xref" href="supported-technologies-details.html#supported-databases" title="Data Stores">Redis Redisson client</a>
</li>
<li class="listitem">
Makes <a class="xref" href="config-core.html#config-instrument" title="instrument ()"><code class="literal">instrument</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.0.0</span>]
<span class="Admonishment-detail">
Added in 1.0.0. Changing this value at runtime is possible since version 1.15.0
</span>
</span>)</a>, <a class="xref" href="config-core.html#config-trace-methods" title="trace_methods ()"><code class="literal">trace_methods</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.0.0</span>]
<span class="Admonishment-detail">
Added in 1.0.0. Changing this value at runtime is possible since version 1.15.0
</span>
</span>)</a>, and <a class="xref" href="config-core.html#config-disable-instrumentations" title="disable_instrumentations ()"><code class="literal">disable_instrumentations</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.0.0</span>]
<span class="Admonishment-detail">
Added in 1.0.0. Changing this value at runtime is possible since version 1.15.0
</span>
</span>)</a> dynamic.
Note that changing these values at runtime can slow down the application temporarily.
</li>
<li class="listitem">
Do not instrument Servlet API before 3.0 <a href="https://github.com/elastic/apm-agent-java/pull/1077" class="ulink" target="_top">#1077</a>
</li>
<li class="listitem">
Add support for API keys for apm backend authentication <a href="https://github.com/elastic/apm-agent-java/pull/1083" class="ulink" target="_top">#1083</a>
</li>
<li class="listitem">
Add support for <a class="xref" href="supported-technologies-details.html#supported-rpc-frameworks" title="RPC frameworks">gRPC</a> client &amp; server instrumentation <a href="https://github.com/elastic/apm-agent-java/pull/1019" class="ulink" target="_top">#1019</a>
</li>
<li class="listitem">
Deprecating <code class="literal">active</code> configuration option in favor of <code class="literal">recording</code>.
Setting <code class="literal">active</code> still works as it&#8217;s now an alias for <code class="literal">recording</code>.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_31"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
When JAX-RS-annotated method delegates to another JAX-RS-annotated method, transaction name should include method A - <a href="https://github.com/elastic/apm-agent-java/pull/1062" class="ulink" target="_top">#1062</a>
</li>
<li class="listitem">
Fixed bug that prevented an APM Error from being created when calling <code class="literal">org.slf4j.Logger#error</code> - <a href="https://github.com/elastic/apm-agent-java/pull/1049" class="ulink" target="_top">#1049</a>
</li>
<li class="listitem">
Wrong address in JDBC spans for Oracle, MySQL and MariaDB when multiple hosts are configured - <a href="https://github.com/elastic/apm-agent-java/pull/1082" class="ulink" target="_top">#1082</a>
</li>
<li class="listitem">
Document and re-order configuration priorities <a href="https://github.com/elastic/apm-agent-java/pull/1087" class="ulink" target="_top">#1087</a>
</li>
<li class="listitem">
Improve heuristic for <code class="literal">service_name</code> when not set through config <a href="https://github.com/elastic/apm-agent-java/pull/1097" class="ulink" target="_top">#1097</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.14.0"></a>1.14.0 - 2020/03/04<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_27"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Support for the official <a href="https://www.w3.org/TR/trace-context" class="ulink" target="_top">W3C</a> <code class="literal">traceparent</code> and <code class="literal">tracestate</code> headers.<br>
  The agent now accepts both the <code class="literal">elastic-apm-traceparent</code> and the official <code class="literal">traceparent</code> header.
By default, it sends both headers on outgoing requests, unless <a class="xref" href="config-core.html#config-use-elastic-traceparent-header" title="use_elastic_traceparent_header ()"><code class="literal">use_elastic_traceparent_header</code></a> is set to false.
</li>
<li class="listitem">
Creating spans for slow methods with the help of the sampling profiler <a href="https://github.com/jvm-profiling-tools/async-profiler" class="ulink" target="_top">async-profiler</a>.
This is a low-overhead way of seeing which methods make your transactions slow and a replacement for the <code class="literal">trace_methods</code> configuration option.
See <a class="xref" href="supported-technologies-details.html#supported-java-methods" title="Java method monitoring">Java method monitoring</a> for more details
</li>
<li class="listitem">
Adding a Circuit Breaker to pause the agent when stress is detected on the system and resume when the stress is relieved.
See <a class="xref" href="tuning-and-overhead.html#circuit-breaker" title="Circuit Breaker">Circuit Breaker</a> and <a href="https://github.com/elastic/apm-agent-java/pull/1040" class="ulink" target="_top">#1040</a> for more info.
</li>
<li class="listitem">
<code class="literal">Span#captureException</code> and <code class="literal">Transaction#captureException</code> in public API return reported error id - <a href="https://github.com/elastic/apm-agent-java/pull/1015" class="ulink" target="_top">#1015</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_32"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
java.lang.IllegalStateException: Cannot resolve type description for &lt;com.another.commercial.apm.agent.Class&gt; - <a href="https://github.com/elastic/apm-agent-java/pull/1037" class="ulink" target="_top">#1037</a>
</li>
<li class="listitem">
properly handle <code class="literal">java.sql.SQLException</code> for unsupported JDBC features <a href="https://github.com/elastic/apm-agent-java/pull/" class="ulink" target="_top">#1035</a> <a href="https://github.com/elastic/apm-agent-java/issues/1025" class="ulink" target="_top">#1025</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.13.0"></a>1.13.0 - 2020/02/11<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_28"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add support for <a class="xref" href="supported-technologies-details.html#supported-databases" title="Data Stores">Redis Lettuce client</a>
</li>
<li class="listitem">
Add <code class="literal">context.message.age.ms</code> field for JMS message receiving spans and transactions - <a href="https://github.com/elastic/apm-agent-java/pull/970" class="ulink" target="_top">#970</a>
</li>
<li class="listitem">
Instrument log4j2 Logger#error(String, Throwable) (<a href="https://github.com/elastic/apm-agent-java/pull/919" class="ulink" target="_top">#919</a>) Automatically captures exceptions when calling <code class="literal">logger.error("message", exception)</code>
</li>
<li class="listitem">
Add instrumentation for external process execution through <code class="literal">java.lang.Process</code> and Apache <code class="literal">commons-exec</code> - <a href="https://github.com/elastic/apm-agent-java/pull/903" class="ulink" target="_top">#903</a>
</li>
<li class="listitem">
Add <code class="literal">destination</code> fields to exit span contexts - <a href="https://github.com/elastic/apm-agent-java/pull/976" class="ulink" target="_top">#976</a>
</li>
<li class="listitem">
Removed <code class="literal">context.message.topic.name</code> field - <a href="https://github.com/elastic/apm-agent-java/pull/993" class="ulink" target="_top">#993</a>
</li>
<li class="listitem">
Add support for Kafka clients - <a href="https://github.com/elastic/apm-agent-java/pull/981" class="ulink" target="_top">#981</a>
</li>
<li class="listitem">
Add support for binary <code class="literal">traceparent</code> header format (see the <a href="https://github.com/elastic/apm/blob/master/docs/agent-development.md#Binary-Fields" class="ulink" target="_top">spec</a>
for more details) - <a href="https://github.com/elastic/apm-agent-java/pull/1009" class="ulink" target="_top">#1009</a>
</li>
<li class="listitem">
Add support for log correlation for log4j and log4j2, even when not used in combination with slf4j.
See <a class="xref" href="supported-technologies-details.html#supported-logging-frameworks" title="Logging frameworks">Logging frameworks</a> for details.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_33"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix parsing value of <code class="literal">trace_methods</code> configuration property <a href="https://github.com/elastic/apm-agent-java/pull/930" class="ulink" target="_top">#930</a>
</li>
<li class="listitem">
Workaround for <code class="literal">java.util.logging</code> deadlock <a href="https://github.com/elastic/apm-agent-java/pull/965" class="ulink" target="_top">#965</a>
</li>
<li class="listitem">
JMS should propagate traceparent header when transactions are not sampled <a href="https://github.com/elastic/apm-agent-java/pull/999" class="ulink" target="_top">#999</a>
</li>
<li class="listitem">
Spans are not closed if JDBC implementation does not support <code class="literal">getUpdateCount</code> <a href="https://github.com/elastic/apm-agent-java/pull/1008" class="ulink" target="_top">#1008</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.12.0"></a>1.12.0 - 2019/11/21<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_29"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>JMS Enhancements <a href="https://github.com/elastic/apm-agent-java/pull/911" class="ulink" target="_top">#911</a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add special handling for temporary queues/topics
</li>
<li class="listitem">
<p>Capture message bodies of text Messages</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rely on the existing <code class="literal">ELASTIC_APM_CAPTURE_BODY</code> agent config option (off by default).
</li>
<li class="listitem">
Send as <code class="literal">context.message.body</code>
</li>
<li class="listitem">
Limit size to 10000 characters. If longer than this size, trim to 9999 and append with ellipsis
</li>
</ul>
</div>
</li>
<li class="listitem">
Introduce the <code class="literal">ignore_message_queues</code> configuration to disable instrumentation (message tagging) for specific
queues/topics as suggested in <a href="https://github.com/elastic/apm-agent-java/pull/710" class="ulink" target="_top">#710</a>
</li>
<li class="listitem">
<p>Capture predefined message headers and all properties</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Rely on the existing <code class="literal">ELASTIC_APM_CAPTURE_HEADERS</code> agent config option.
</li>
<li class="listitem">
Send as <code class="literal">context.message.headers</code>
</li>
<li class="listitem">
Sanitize sensitive headers/properties based on the <code class="literal">sanitize_field_names</code> config option
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Added support for the MongoDB sync driver. See <a class="xref" href="supported-technologies-details.html#supported-databases" title="Data Stores">supported data stores</a>.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_34"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
JDBC regression- <code class="literal">PreparedStatement#executeUpdate()</code> and <code class="literal">PreparedStatement#executeLargeUpdate()</code> are not traced <a href="https://github.com/elastic/apm-agent-java/pull/918" class="ulink" target="_top">#918</a>
</li>
<li class="listitem">
When systemd cgroup driver is used, the discovered Kubernetes pod UID contains "_" instead of "-" <a href="https://github.com/elastic/apm-agent-java/pull/920" class="ulink" target="_top">#920</a>
</li>
<li class="listitem">
DB2 jcc4 driver is not traced properly <a href="https://github.com/elastic/apm-agent-java/pull/926" class="ulink" target="_top">#926</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.11.0"></a>1.11.0 - 2019/10/31<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_30"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add the ability to configure a unique name for a JVM within a service through the
<a class="xref" href="config-core.html#config-service-node-name" title="service_node_name ()"><code class="literal">service_node_name</code></a>
config option]
</li>
<li class="listitem">
Add ability to ignore some exceptions to be reported as errors &lt;&lt;config-ignore-exceptions[ignore_exceptions]
</li>
<li class="listitem">
Applying new logic for JMS <code class="literal">javax.jms.MessageConsumer#receive</code> so that, instead of the transaction created for the
polling method itself (ie from <code class="literal">receive</code> start to end), the agent will create a transaction attempting to capture
the code executed during actual message handling.
This logic is suitable for environments where polling APIs are invoked within dedicated polling threads.
This polling transaction creation strategy can be reversed through a configuration option (<code class="literal">message_polling_transaction_strategy</code>)
that is not exposed in the properties file by default.
</li>
<li class="listitem">
Send IP obtained through <code class="literal">javax.servlet.ServletRequest#getRemoteAddr()</code> in <code class="literal">context.request.socket.remote_address</code>
instead of parsing from headers <a href="https://github.com/elastic/apm-agent-java/pull/889" class="ulink" target="_top">#889</a>
</li>
<li class="listitem">
Added <code class="literal">ElasticApmAttacher.attach(String propertiesLocation)</code> to specify a custom properties location
</li>
<li class="listitem">
Logs message when <code class="literal">transaction_max_spans</code> has been exceeded <a href="https://github.com/elastic/apm-agent-java/pull/849" class="ulink" target="_top">#849</a>
</li>
<li class="listitem">
Report the number of affected rows by a SQL statement (UPDATE,DELETE,INSERT) in <em>affected_rows</em> span attribute <a href="https://github.com/elastic/apm-agent-java/pull/707" class="ulink" target="_top">#707</a>
</li>
<li class="listitem">
Add <a class="xref" href="public-api.html" title="Public API"><code class="literal">@Traced</code></a> annotation which either creates a span or a transaction, depending on the context
</li>
<li class="listitem">
Report JMS destination as a span/transaction context field <a href="https://github.com/elastic/apm-agent-java/pull/906" class="ulink" target="_top">#906</a>
</li>
<li class="listitem">
Added <a class="xref" href="config-jmx.html#config-capture-jmx-metrics" title="capture_jmx_metrics ()"><code class="literal">capture_jmx_metrics</code></a> configuration option
</li>
</ul>
</div>
<h5><a id="_bug_fixes_35"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
JMS creates polling transactions even when the API invocations return without a message
</li>
<li class="listitem">
Support registering MBeans which are added after agent startup
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.10.0"></a>1.10.0 - 2019/09/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_31"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add ability to manually specify reported <a class="xref" href="config-core.html#config-hostname" title="hostname ()">hostname</a>
</li>
<li class="listitem">
Add support for <a class="xref" href="supported-technologies-details.html#supported-databases" title="Data Stores">Redis Jedis client</a>.
</li>
<li class="listitem">
Add support for identifying target JVM to attach apm agent to using JVM property. See also the documentation of the <a class="xref" href="setup-attach-cli.html#setup-attach-cli-usage-options" title="Options"><code class="literal">--include</code> and <code class="literal">--exclude</code> flags</a>
</li>
<li class="listitem">
Added <a class="xref" href="config-jmx.html#config-capture-jmx-metrics" title="capture_jmx_metrics ()"><code class="literal">capture_jmx_metrics</code></a> configuration option
</li>
<li class="listitem">
Improve servlet error capture <a href="https://github.com/elastic/apm-agent-java/pull/812" class="ulink" target="_top">#812</a>
Among others, now also takes Spring MVC `@ExceptionHandler`s into account
</li>
<li class="listitem">
Instrument Logger#error(String, Throwable) <a href="https://github.com/elastic/apm-agent-java/pull/821" class="ulink" target="_top">#821</a>
Automatically captures exceptions when calling <code class="literal">logger.error("message", exception)</code>
</li>
<li class="listitem">
Easier log correlation with <a href="https://github.com/elastic/java-ecs-logging" class="ulink" target="_top">https://github.com/elastic/java-ecs-logging</a>. See <a class="xref" href="log-correlation.html" title="Log correlation">docs</a>.
</li>
<li class="listitem">
Avoid creating a temp agent file for each attachment <a href="https://github.com/elastic/apm-agent-java/pull/859" class="ulink" target="_top">#859</a>
</li>
<li class="listitem">
Instrument <code class="literal">View#render</code> instead of <code class="literal">DispatcherServlet#render</code> <a href="https://github.com/elastic/apm-agent-java/pull/829" class="ulink" target="_top">#829</a>
This makes the transaction breakdown graph more useful. Instead of <code class="literal">dispatcher-servlet</code>, the graph now shows a type which is based on the view name, for example, <code class="literal">FreeMarker</code> or <code class="literal">Thymeleaf</code>.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_36"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Error in log when setting <a class="xref" href="config-reporter.html#config-server-urls" title="server_urls">server_urls</a>
to an empty string - <code class="literal">co.elastic.apm.agent.configuration.ApmServerConfigurationSource - Expected previousException not to be null</code>
</li>
<li class="listitem">
Avoid terminating the TCP connection to APM Server when polling for configuration updates <a href="https://github.com/elastic/apm-agent-java/pull/823" class="ulink" target="_top">#823</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.9.0"></a>1.9.0 - 2019/08/22<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_32"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Upgrading supported OpenTracing version from 0.31 to 0.33
</li>
<li class="listitem">
<p>Added annotation and meta-annotation matching support for <code class="literal">trace_methods</code>, for example:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">public @java.inject.* org.example.*</code> (for annotation)
</li>
<li class="listitem">
<code class="literal">public @@javax.enterprise.context.NormalScope org.example.*</code> (for meta-annotation)
</li>
</ul>
</div>
</li>
<li class="listitem">
The runtime attachment now also works when the <code class="literal">tools.jar</code> or the <code class="literal">jdk.attach</code> module is not available.
This means you don&#8217;t need a full JDK installation - the JRE is sufficient.
This makes the runtime attachment work in more environments such as minimal Docker containers.
Note that the runtime attachment currently does not work for OSGi containers like those used in many application servers such as JBoss and WildFly.
See the <a class="xref" href="setup-attach-cli.html" title="Automatic setup with apm-agent-attach-cli.jar">documentation</a> for more information.
</li>
<li class="listitem">
Support for Hibernate Search
</li>
</ul>
</div>
<h5><a id="_bug_fixes_37"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A warning in logs saying APM server is not available when using 1.8 with APM server 6.x.
Due to that, agent 1.8.0 will silently ignore non-string labels, even if used with APM server of versions 6.7.x or 6.8.x that support such.
If APM server version is &lt;6.7 or 7.0+, this should have no effect. Otherwise, upgrade the Java agent to 1.9.0+.
</li>
<li class="listitem">
<code class="literal">ApacheHttpAsyncClientInstrumentation</code> matching increases startup time considerably
</li>
<li class="listitem">
Log correlation feature is active when <code class="literal">active==false</code>
</li>
<li class="listitem">
Tomcat&#8217;s memory leak prevention mechanism is causing a&#8230;&#8203; memory leak. JDBC statement map is leaking in Tomcat if the application that first used it is undeployed/redeployed.
See <a href="https://discuss.elastic.co/t/elastic-apm-agent-jdbchelper-seems-to-use-a-lot-of-memory/195295" class="ulink" target="_top">this related discussion</a>.
</li>
</ul>
</div>
<h4><a id="_breaking_changes_10"></a>Breaking Changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">apm-agent-attach.jar</code> is not executable anymore.
Use <code class="literal">apm-agent-attach-standalone.jar</code> instead.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.8.0"></a>1.8.0 - 2019/07/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_33"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added support for tracking <a href="/guide/en/kibana/7.3/transactions.html" class="ulink" target="_top">time spent by span type</a>.
Can be disabled by setting <a href="/guide/en/apm/agent/java/current/config-core.html#config-breakdown-metrics" class="ulink" target="_top"><code class="literal">breakdown_metrics</code></a> to <code class="literal">false</code>.
</li>
<li class="listitem">
Added support for <a href="/guide/en/kibana/7.3/agent-configuration.html" class="ulink" target="_top">central configuration</a>.
Can be disabled by setting <a class="xref" href="config-core.html#config-central-config" title="central_config ()"><code class="literal">central_config</code></a> to <code class="literal">false</code>.
</li>
<li class="listitem">
Added support for Spring&#8217;s JMS flavor - instrumenting <code class="literal">org.springframework.jms.listener.SessionAwareMessageListener</code>
</li>
<li class="listitem">
Added support to legacy ApacheHttpClient APIs (which adds support to Axis2 configured to use ApacheHttpClient)
</li>
<li class="listitem">
Added support for setting <a class="xref" href="config-reporter.html#config-server-urls" title="server_urls"><code class="literal">server_urls</code></a> dynamically via properties file <a href="https://github.com/elastic/apm-agent-java/pull/723" class="ulink" target="_top">#723</a>
</li>
<li class="listitem">
Added <a class="xref" href="config-core.html#config-config-file" title="config_file ()"><code class="literal">config_file</code></a> option
</li>
<li class="listitem">
Added option to use <code class="literal">@javax.ws.rs.Path</code> value as transaction name <a class="xref" href="config-jax-rs.html#config-use-jaxrs-path-as-transaction-name" title="use_jaxrs_path_as_transaction_name ()"><code class="literal">use_jaxrs_path_as_transaction_name</code></a>
</li>
<li class="listitem">
Instrument quartz jobs <a class="xref" href="supported-technologies-details.html#supported-scheduling-frameworks" title="Scheduling frameworks">docs</a>
</li>
<li class="listitem">
SQL parsing improvements <a href="https://github.com/elastic/apm-agent-java/pull/696" class="ulink" target="_top">#696</a>
</li>
<li class="listitem">
Introduce priorities for transaction name <a href="https://github.com/elastic/apm-agent-java/pull/748" class="ulink" target="_top">#748</a>.
Now uses the path as transaction name if <a class="xref" href="config-http.html#config-use-path-as-transaction-name" title="use_path_as_transaction_name ()"><code class="literal">use_path_as_transaction_name</code></a> is set to <code class="literal">true</code>
rather than <code class="literal">ServletClass#doGet</code>.
But if a name can be determined from a high level framework,
like Spring MVC, that takes precedence.
User-supplied names from the API always take precedence over any others.
</li>
<li class="listitem">
Use JSP path name as transaction name as opposed to the generated servlet class name <a href="https://github.com/elastic/apm-agent-java/pull/751" class="ulink" target="_top">#751</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_38"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Some JMS Consumers and Producers are filtered due to class name filtering in instrumentation matching
</li>
<li class="listitem">
Jetty: When no display name is set and context path is "/" transaction service names will now correctly fall back to configured values
</li>
<li class="listitem">
JDBC&#8217;s <code class="literal">executeBatch</code> is not traced
</li>
<li class="listitem">
Drops non-String labels when connected to APM Server &lt; 6.7 to avoid validation errors <a href="https://github.com/elastic/apm-agent-java/pull/687" class="ulink" target="_top">#687</a>
</li>
<li class="listitem">
Parsing container ID in cloud foundry garden <a href="https://github.com/elastic/apm-agent-java/pull/695" class="ulink" target="_top">#695</a>
</li>
<li class="listitem">
Automatic instrumentation should not override manual results <a href="https://github.com/elastic/apm-agent-java/pull/752" class="ulink" target="_top">#752</a>
</li>
</ul>
</div>
<h5><a id="_breaking_changes_11"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The log correlation feature does not add <code class="literal">span.id</code> to the MDC anymore but only <code class="literal">trace.id</code> and <code class="literal">transaction.id</code> <a href="https://github.com/elastic/apm-agent-java/pull/742" class="ulink" target="_top">#742</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.7.0"></a>1.7.0 - 2019/06/13<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_34"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added the <code class="literal">trace_methods_duration_threshold</code> config option. When using the <code class="literal">trace_methods</code> config option with wild cards,
this enables considerable reduction of overhead by limiting the number of spans captured and reported
(see more details in config documentation).
NOTE: Using wildcards is still not the recommended approach for the <code class="literal">trace_methods</code> feature.
</li>
<li class="listitem">
Add <code class="literal">Transaction#addCustomContext(String key, String|Number|boolean value)</code> to public API
</li>
<li class="listitem">
Added support for AsyncHttpClient 2.x
</li>
<li class="listitem">
Added <a class="xref" href="config-core.html#config-global-labels" title="global_labels ()"><code class="literal">global_labels</code></a> configuration option.
This requires APM Server 7.2+.
</li>
<li class="listitem">
Added basic support for JMS- distributed tracing for basic scenarios of <code class="literal">send</code>, <code class="literal">receive</code>, <code class="literal">receiveNoWait</code> and <code class="literal">onMessage</code>.
Both Queues and Topics are supported.
Async <code class="literal">send</code> APIs are not supported in this version.
NOTE: This feature is currently marked as "experimental" and is disabled by default. In order to enable,
it is required to set the
<a class="xref" href="config-core.html#config-disable-instrumentations" title="disable_instrumentations ()"><code class="literal">disable_instrumentations</code></a>
configuration property to an empty string.
</li>
<li class="listitem">
Improved OSGi support: added a configuration option for <code class="literal">bootdelegation</code> packages <a href="https://github.com/elastic/apm-agent-java/pull/641" class="ulink" target="_top">#641</a>
</li>
<li class="listitem">
Better span names for SQL spans. For example, <code class="literal">SELECT FROM user</code> instead of just <code class="literal">SELECT</code> <a href="https://github.com/elastic/apm-agent-java/pull/633" class="ulink" target="_top">#633</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_39"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
ClassCastException related to async instrumentation of Pilotfish Executor causing thread hang (applied workaround)
</li>
<li class="listitem">
NullPointerException when computing Servlet transaction name with null HTTP method name
</li>
<li class="listitem">
FileNotFoundException when trying to find implementation version of jar with encoded URL
</li>
<li class="listitem">
NullPointerException when closing Apache AsyncHttpClient request producer
</li>
<li class="listitem">
Fixes loading of <code class="literal">elasticapm.properties</code> for Spring Boot applications
</li>
<li class="listitem">
Fix startup error on WebLogic 12.2.1.2.0 <a href="https://github.com/elastic/apm-agent-java/pull/649" class="ulink" target="_top">#649</a>
</li>
<li class="listitem">
Disable metrics reporting and APM Server health check when active=false <a href="https://github.com/elastic/apm-agent-java/pull/653" class="ulink" target="_top">#653</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.6.1"></a>1.6.1 - 2019/04/26<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_bug_fixes_40"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixes transaction name for non-sampled transactions <a href="https://github.com/elastic/apm-agent-java/issues/581" class="ulink" target="_top">#581</a>
</li>
<li class="listitem">
Makes log_file option work again <a href="https://github.com/elastic/apm-agent-java/issues/594" class="ulink" target="_top">#594</a>
</li>
<li class="listitem">
<p>Async context propagation fixes</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixing some async mechanisms lifecycle issues <a href="https://github.com/elastic/apm-agent-java/issues/605" class="ulink" target="_top">#605</a>
</li>
<li class="listitem">
Fixes exceptions when using WildFly managed executor services <a href="https://github.com/elastic/apm-agent-java/issues/589" class="ulink" target="_top">#589</a>
</li>
<li class="listitem">
Exclude glassfish Executor which does not permit wrapped runnables <a href="https://github.com/elastic/apm-agent-java/issues/596" class="ulink" target="_top">#596</a>
</li>
<li class="listitem">
Exclude DumbExecutor <a href="https://github.com/elastic/apm-agent-java/issues/598" class="ulink" target="_top">#598</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
Fixes Manifest version reading error to support <code class="literal">jar:file</code> protocol <a href="https://github.com/elastic/apm-agent-java/issues/601" class="ulink" target="_top">#601</a>
</li>
<li class="listitem">
Fixes transaction name for non-sampled transactions <a href="https://github.com/elastic/apm-agent-java/issues/597" class="ulink" target="_top">#597</a>
</li>
<li class="listitem">
Fixes potential classloader deadlock by preloading <code class="literal">FileSystems.getDefault()</code> <a href="https://github.com/elastic/apm-agent-java/issues/603" class="ulink" target="_top">#603</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.6.0"></a>1.6.0 - 2019/04/16<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_related_announcements"></a>Related Announcements<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Java APM Agent became part of the Cloud Foundry Java Buildpack as of <a href="https://github.com/cloudfoundry/java-buildpack/releases/tag/v4.19" class="ulink" target="_top">Release v4.19</a>
</li>
</ul>
</div>
<h5><a id="_features_35"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Support Apache HttpAsyncClient - span creation and cross-service trace context propagation
</li>
<li class="listitem">
Added the <code class="literal">jvm.thread.count</code> metric, indicating the number of live threads in the JVM (daemon and non-daemon)
</li>
<li class="listitem">
Added support for WebLogic
</li>
<li class="listitem">
Added support for Spring <code class="literal">@Scheduled</code> and EJB <code class="literal">@Schedule</code> annotations - <a href="https://github.com/elastic/apm-agent-java/pull/569" class="ulink" target="_top">#569</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_41"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Avoid that the agent blocks server shutdown in case the APM Server is not available - <a href="https://github.com/elastic/apm-agent-java/pull/554" class="ulink" target="_top">#554</a>
</li>
<li class="listitem">
Public API annotations improper retention prevents it from being used with Groovy - <a href="https://github.com/elastic/apm-agent-java/pull/567" class="ulink" target="_top">#567</a>
</li>
<li class="listitem">
Eliminate side effects of class loading related to Instrumentation matching mechanism
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.5.0"></a>1.5.0 - 2019/03/26<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_potentially_breaking_changes_8"></a>Potentially breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If you didn&#8217;t explicitly set the <a class="xref" href="config-core.html#config-service-name" title="service_name"><code class="literal">service_name</code></a>
previously and you are dealing with a servlet-based application (including Spring Boot),
your <code class="literal">service_name</code> will change.
See the documentation for &lt;&lt;config-service-name[<code class="literal">service_name</code>]
and the corresponding section in <em>Features</em> for more information.
Note: this requires APM Server 7.0+. If using previous versions, nothing will change.
</li>
</ul>
</div>
<h5><a id="_features_36"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added property <code class="literal">"allow_path_on_hierarchy"</code> to JAX-RS plugin, to lookup inherited usage of <code class="literal">@path</code>
</li>
<li class="listitem">
Support for number and boolean labels in the public API <a href="https://github.com/elastic/apm-agent-java/pull/497" class="ulink" target="_top">497</a>.
This change also renames <code class="literal">tag</code> to <code class="literal">label</code> on the API level to be compliant with the <a href="https://github.com/elastic/ecs#-base-fields" class="ulink" target="_top">Elastic Common Schema (ECS)</a>.
The <code class="literal">addTag(String, String)</code> method is still supported but deprecated in favor of <code class="literal">addLabel(String, String)</code>.
As of version 7.x of the stack, labels will be stored under <code class="literal">labels</code> in Elasticsearch.
Previously, they were stored under <code class="literal">context.tags</code>.
</li>
<li class="listitem">
Support async queries made by Elasticsearch REST client
</li>
<li class="listitem">
Added <code class="literal">setStartTimestamp(long epochMicros)</code> and <code class="literal">end(long epochMicros)</code> API methods to <code class="literal">Span</code> and <code class="literal">Transaction</code>,
allowing to set custom start and end timestamps.
</li>
<li class="listitem">
Auto-detection of the <code class="literal">service_name</code> based on the <code class="literal">&lt;display-name&gt;</code> element of the <code class="literal">web.xml</code> with a fallback to the servlet context path.
If you are using a spring-based application, the agent will use the setting for <code class="literal">spring.application.name</code> for its <code class="literal">service_name</code>.
See the documentation for <a class="xref" href="config-core.html#config-service-name" title="service_name"><code class="literal">service_name</code></a>
for more information.
Note: this requires APM Server 7.0+. If using previous versions, nothing will change.
</li>
<li class="listitem">
Previously, enabling <a class="xref" href="config-core.html#config-capture-body" title="capture_body (performance)"><code class="literal">capture_body</code></a> could only capture form parameters.
Now it supports all UTF-8 encoded plain-text content types.
The option <a class="xref" href="config-http.html#config-capture-body-content-types" title="capture_body_content_types ( performance)"><code class="literal">capture_body_content_types</code></a>
controls which `Content-Type`s should be captured.
</li>
<li class="listitem">
Support async calls made by OkHttp client (<code class="literal">Call#enqueue</code>)
</li>
<li class="listitem">
<p>Added support for providing config options on agent attach.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
CLI example: <code class="literal">--config server_urls=http://localhost:8200,http://localhost:8201</code>
</li>
<li class="listitem">
API example: <code class="literal">ElasticApmAttacher.attach(Map.of("server_urls", "http://localhost:8200,http://localhost:8201"));</code>
</li>
</ul>
</div>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_42"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Logging integration through MDC is not working properly - <a href="https://github.com/elastic/apm-agent-java/issues/499" class="ulink" target="_top">#499</a>
</li>
<li class="listitem">
ClassCastException with adoptopenjdk/openjdk11-openj9 - <a href="https://github.com/elastic/apm-agent-java/issues/505" class="ulink" target="_top">#505</a>
</li>
<li class="listitem">
Span count limitation is not working properly - reported <a href="https://discuss.elastic.co/t/kibana-apm-not-showing-spans-which-are-visible-in-discover-too-many-spans/171690" class="ulink" target="_top">in our forum</a>
</li>
<li class="listitem">
Java agent causes Exceptions in Alfresco cluster environment due to failure in the instrumentation of Hazelcast `Executor`s - reported <a href="https://discuss.elastic.co/t/cant-run-apm-java-agent-in-alfresco-cluster-environment/172962" class="ulink" target="_top">in our forum</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.4.0"></a>1.4.0 - 2019/02/14<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_37"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added support for sync calls of OkHttp client
</li>
<li class="listitem">
Added support for context propagation for `java.util.concurrent.ExecutorService`s
</li>
<li class="listitem">
The <code class="literal">trace_methods</code> configuration now allows to omit the method matcher.
Example: <code class="literal">com.example.*</code> traces all classes and methods within the <code class="literal">com.example</code> package and sub-packages.
</li>
<li class="listitem">
Added support for JSF. Tested on WildFly, WebSphere Liberty and Payara with embedded JSF implementation and on Tomcat and Jetty with
MyFaces 2.2 and 2.3
</li>
<li class="listitem">
Introduces a new configuration option <code class="literal">disable_metrics</code> which disables the collection of metrics via a wildcard expression.
</li>
<li class="listitem">
Support for HttpUrlConnection
</li>
<li class="listitem">
Adds <code class="literal">subtype</code> and <code class="literal">action</code> to spans. This replaces former typing mechanism where type, subtype and action were all set through
the type in an hierarchical dotted-syntax. In order to support existing API usages, dotted types are parsed into subtype and action,
however <code class="literal">Span.createSpan</code> and <code class="literal">Span.setType</code> are deprecated starting this version. Instead, type-less spans can be created using the new
<code class="literal">Span.startSpan</code> API and typed spans can be created using the new <code class="literal">Span.startSpan(String type, String subtype, String action)</code> API
</li>
<li class="listitem">
Support for JBoss EAP 6.4, 7.0, 7.1 and 7.2
</li>
<li class="listitem">
Improved startup times
</li>
<li class="listitem">
Support for SOAP (JAX-WS).
SOAP client create spans and propagate context.
Transactions are created for <code class="literal">@WebService</code> classes and <code class="literal">@WebMethod</code> methods.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_43"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixes a failure in BitBucket when agent deployed <a href="https://github.com/elastic/apm-agent-java/issues/349" class="ulink" target="_top">#349</a>
</li>
<li class="listitem">
Fixes increased CPU consumption <a href="https://github.com/elastic/apm-agent-java/issues/453" class="ulink" target="_top">#453</a> and <a href="https://github.com/elastic/apm-agent-java/issues/443" class="ulink" target="_top">#443</a>
</li>
<li class="listitem">
Fixed some OpenTracing bridge functionalities that were not working when auto-instrumentation is disabled
</li>
<li class="listitem">
Fixed an error occurring when ending an OpenTracing span before deactivating
</li>
<li class="listitem">
Sending proper <code class="literal">null</code> for metrics that have a NaN value
</li>
<li class="listitem">
Fixes JVM crash with Java 7 <a href="https://github.com/elastic/apm-agent-java/issues/458" class="ulink" target="_top">#458</a>
</li>
<li class="listitem">
Fixes an application deployment failure when using EclipseLink and <code class="literal">trace_methods</code> configuration <a href="https://github.com/elastic/apm-agent-java/issues/474" class="ulink" target="_top">#474</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.3.0"></a>1.3.0 - 2019/01/10<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_38"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The agent now collects system and JVM metrics <a href="https://github.com/elastic/apm-agent-java/pull/360" class="ulink" target="_top">#360</a>
</li>
<li class="listitem">
Add API methods <code class="literal">ElasticApm#startTransactionWithRemoteParent</code> and <code class="literal">Span#injectTraceHeaders</code> to allow for manual context propagation <a href="https://github.com/elastic/apm-agent-java/pull/396" class="ulink" target="_top">#396</a>.
</li>
<li class="listitem">
Added <code class="literal">trace_methods</code> configuration option which lets you define which methods in your project or 3rd party libraries should be traced.
To create spans for all <code class="literal">public</code> methods of classes whose name ends in <code class="literal">Service</code> which are in a sub-package of <code class="literal">org.example.services</code> use this matcher:
<code class="literal">public org.example.services.*.*Service#*</code> <a href="https://github.com/elastic/apm-agent-java/pull/398" class="ulink" target="_top">#398</a>
</li>
<li class="listitem">
Added span for <code class="literal">DispatcherServlet#render</code> <a href="https://github.com/elastic/apm-agent-java/pull/409" class="ulink" target="_top">#409</a>.
</li>
<li class="listitem">
Flush reporter on shutdown to make sure all recorded Spans are sent to the server before the program exits <a href="https://github.com/elastic/apm-agent-java/pull/397" class="ulink" target="_top">#397</a>
</li>
<li class="listitem">
Adds Kubernetes <a href="https://github.com/elastic/apm-agent-java/issues/383" class="ulink" target="_top">#383</a> and Docker metadata to, enabling correlation with the Kibana Infra UI.
</li>
<li class="listitem">
Improved error handling of the Servlet Async API <a href="https://github.com/elastic/apm-agent-java/issues/399" class="ulink" target="_top">#399</a>
</li>
<li class="listitem">
Support async API’s used with AsyncContext.start <a href="https://github.com/elastic/apm-agent-java/issues/388" class="ulink" target="_top">#388</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_44"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixing a potential memory leak when there is no connection with APM server
</li>
<li class="listitem">
Fixes NoSuchMethodError CharBuffer.flip() which occurs when using the Elasticsearch RestClient and Java 7 or 8 <a href="https://github.com/elastic/apm-agent-java/pull/401" class="ulink" target="_top">#401</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.2.0"></a>1.2.0 - 2018/12/19<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_39"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added <code class="literal">capture_headers</code> configuration option.
Set to <code class="literal">false</code> to disable capturing request and response headers.
This will reduce the allocation rate of the agent and can save you network bandwidth and disk space.
</li>
<li class="listitem">
Makes the API methods <code class="literal">addTag</code>, <code class="literal">setName</code>, <code class="literal">setType</code>, <code class="literal">setUser</code> and <code class="literal">setResult</code> fluent, so that calls can be chained.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_45"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Catch all errors thrown within agent injected code
</li>
<li class="listitem">
Enable public APIs and OpenTracing bridge to work properly in OSGi systems, fixes <a href="https://github.com/elastic/apm-agent-java/issues/362" class="ulink" target="_top">this WildFly issue</a>
</li>
<li class="listitem">
Remove module-info.java to enable agent working on early Tomcat 8.5 versions
</li>
<li class="listitem">
Fix <a href="https://github.com/elastic/apm-agent-java/issues/371" class="ulink" target="_top">async Servlet API issue</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.1.0"></a>1.1.0 - 2018/11/28<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_40"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Some memory allocation improvements
</li>
<li class="listitem">
Enabling bootdelegation for agent classes in Atlassian OSGI systems
</li>
</ul>
</div>
<h5><a id="_bug_fixes_46"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update dsl-json which fixes a memory leak.
See <a href="https://github.com/ngs-doo/dsl-json/pull/102" class="ulink" target="_top">ngs-doo/dsl-json#102</a> for details.
</li>
<li class="listitem">
Avoid `VerifyError`s by non instrumenting classes compiled for Java 4 or earlier
</li>
<li class="listitem">
Enable APM Server URL configuration with path (fixes #339)
</li>
<li class="listitem">
Reverse <code class="literal">system.hostname</code> and <code class="literal">system.platform</code> order sent to APM server
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.0.1"></a>1.0.1 - 2018/11/15<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_bug_fixes_47"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixes NoSuchMethodError CharBuffer.flip() which occurs when using the Elasticsearch RestClient and Java 7 or 8 <a href="https://github.com/elastic/apm-agent-java/pull/313" class="ulink" target="_top">#313</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.0.0"></a>1.0.0 - 2018/11/14<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes_12"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Remove intake v1 support. This version requires APM Server 6.5.0+ which supports the intake api v2.
Until the time the APM Server 6.5.0 is officially released,
you can test with docker by pulling the APM Server image via
<code class="literal">docker pull docker.elastic.co/apm/apm-server:6.5.0-SNAPSHOT</code>.
</li>
</ul>
</div>
<h5><a id="_features_41"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Adds <code class="literal">@CaptureTransaction</code> and <code class="literal">@CaptureSpan</code> annotations which let you declaratively add custom transactions and spans.
Note that it is required to configure the <code class="literal">application_packages</code> for this to work.
See the <a class="xref" href="public-api.html#api-annotation" title="Annotation API">documentation</a> for more information.
</li>
<li class="listitem">
The public API now supports to activate a span on the current thread.
This makes the span available via <code class="literal">ElasticApm#currentSpan()</code>
Refer to the <a class="xref" href="public-api.html#api-span-activate" title="Scope activate()">documentation</a> for more details.
</li>
<li class="listitem">
Capturing of Elasticsearch RestClient 5.0.2+ calls.
Currently, the <code class="literal">*Async</code> methods are not supported, only their synchronous counterparts.
</li>
<li class="listitem">
Added API methods to enable correlating the spans created from the JavaScrip Real User Monitoring agent with the Java agent transaction.
More information can be found in the <a class="xref" href="public-api.html#api-ensure-parent-id" title="String ensureParentId()">documentation</a>.
</li>
<li class="listitem">
Added <code class="literal">Transaction.isSampled()</code> and <code class="literal">Span.isSampled()</code> methods to the public API
</li>
<li class="listitem">
Added <code class="literal">Transaction#setResult</code> to the public API <a href="https://github.com/elastic/apm-agent-java/pull/293" class="ulink" target="_top">#293</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_48"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix for situations where status code is reported as <code class="literal">200</code>, even though it actually was <code class="literal">500</code> <a href="https://github.com/elastic/apm-agent-java/pull/225" class="ulink" target="_top">#225</a>
</li>
<li class="listitem">
Capturing the username now properly works when using Spring security <a href="https://github.com/elastic/apm-agent-java/pull/183" class="ulink" target="_top">#183</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.0.0.rc1"></a>1.0.0.RC1 - 2018/11/06<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes_13"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Remove intake v1 support. This version requires APM Server 6.5.0+ which supports the intake api v2.
Until the time the APM Server 6.5.0 is officially released,
you can test with docker by pulling the APM Server image via
<code class="literal">docker pull docker.elastic.co/apm/apm-server:6.5.0-SNAPSHOT</code>.
</li>
<li class="listitem">
Wildcard patterns are case insensitive by default. Prepend <code class="literal">(?-i)</code> to make the matching case sensitive.
</li>
</ul>
</div>
<h5><a id="_features_42"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Support for Distributed Tracing
</li>
<li class="listitem">
Adds <code class="literal">@CaptureTransaction</code> and <code class="literal">@CaptureSpan</code> annotations which let you declaratively add custom transactions and spans.
Note that it is required to configure the <code class="literal">application_packages</code> for this to work.
See the <a class="xref" href="public-api.html#api-annotation" title="Annotation API">documentation</a> for more information.
</li>
<li class="listitem">
The public API now supports to activate a span on the current thread.
This makes the span available via <code class="literal">ElasticApm#currentSpan()</code>
Refer to the <a class="xref" href="public-api.html#api-span-activate" title="Scope activate()">documentation</a> for more details.
</li>
<li class="listitem">
Capturing of Elasticsearch RestClient 5.0.2+ calls.
Currently, the <code class="literal">*Async</code> methods are not supported, only their synchronous counterparts.
</li>
<li class="listitem">
Added API methods to enable correlating the spans created from the JavaScrip Real User Monitoring agent with the Java agent transaction.
More information can be found in the <a class="xref" href="public-api.html#api-ensure-parent-id" title="String ensureParentId()">documentation</a>.
</li>
<li class="listitem">
Microsecond accurate timestamps <a href="https://github.com/elastic/apm-agent-java/pull/261" class="ulink" target="_top">#261</a>
</li>
<li class="listitem">
Support for JAX-RS annotations.
Transactions are named based on your resources (<code class="literal">ResourceClass#resourceMethod</code>).
</li>
</ul>
</div>
<h5><a id="_bug_fixes_49"></a>Bug Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fix for situations where status code is reported as <code class="literal">200</code>, even though it actually was <code class="literal">500</code> <a href="https://github.com/elastic/apm-agent-java/pull/225" class="ulink" target="_top">#225</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="_unreleased.html">« Unreleased</a>
</span>
<span class="next">
<a href="release-notes-0.8.x.html">Java Agent version 0.8.x »</a>
</span>
</div>
</div>
</body>
</html>
