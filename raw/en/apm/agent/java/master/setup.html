<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Set up the Agent | APM Java Agent Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="APM Java Agent Reference [master]"/>
<link rel="up" href="index.html" title="APM Java Agent Reference [master]"/>
<link rel="prev" href="intro.html" title="Introduction"/>
<link rel="next" href="setup-javaagent.html" title="Manual setup with -javaagent flag"/>
<meta name="DC.type" content="Learn/Docs/APM Java Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
    <div class="related-products-title">APM:</div>
    <div class="dropdown-anchor" tabindex="0">Java Agent Reference<span class="dropdown-icon"></span></div>
    <div class="dropdown-content">
      <ul>
        <li class="dropdown-category">APM</li>
        <ul>
          <li><a href="/guide/en/apm/guide/current/index.html">User Guide</a></li>
        </ul>
        <li class="dropdown-category">APM agents</li>
        <ul>
          <li><a href="/guide/en/apm/agent/android/current/index.html">Android Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/go/current/index.html">Go Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/swift/current/index.html">iOS Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/java/current/index.html">Java Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/dotnet/current/index.html">.NET Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/nodejs/current/index.html">Node.js Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/php/current/index.html">PHP Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/python/current/index.html">Python Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/ruby/current/index.html">Ruby Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/rum-js/current/index.html">Real User Monitoring JavaScript Agent Reference</a></li>
        </ul>
        <li class="dropdown-category">APM extensions</li>
        <ul>
          <li><a href="/guide/en/apm/lambda/current/index.html">Monitoring AWS Lambda Functions</a></li>
          <li><a href="/guide/en/apm/attacher/current/index.html">Attacher</a></li>
        </ul>
      </ul>
    </div>
  </div>
</span>
</div>
<div class="navheader">
<span class="prev">
<a href="intro.html">« Introduction</a>
</span>
<span class="next">
<a href="setup-javaagent.html">Manual setup with <code class="literal">-javaagent</code> flag »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="setup"></a>Set up the Agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/setup.asciidoc">edit</a></h1>
</div></div></div>
<p>There are three different ways to set up the Elastic APM Java Agent:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="setup-javaagent.html" title="Manual setup with -javaagent flag">Manual setup with <code class="literal">-javaagent</code> flag</a><br>
  Manually set up and configure the agent with the <code class="literal">-javaagent</code> JVM option. No application code change required, requires
application restart.
</li>
<li class="listitem">
<a class="xref" href="setup-attach-cli.html" title="Automatic setup with apm-agent-attach-cli.jar">Automatic setup with <code class="literal">apm-agent-attach-cli.jar</code></a><br>
Automatically set up the agent without needing to alter the configuration of your JVM or application server. No application code
nor JVM options changes required, allows attaching to a running JVM.
</li>
<li class="listitem">
<a class="xref" href="setup-attach-api.html" title="Programmatic API setup to self-attach">Programmatic API setup to self-attach</a><br>
Set up the agent with a one-line code change and an extra <code class="literal">apm-agent-attach</code> dependency. No modification of JVM options,
the agent artifact is embedded within the packaged application binary.
</li>
</ol>
</div>
<h3><a id="get-started-configuration"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/setup.asciidoc">edit</a></h3>
<p>Once you&#8217;ve set up the Agent, see the <a class="xref" href="configuration.html" title="Configuration">configuration guide</a> on how to configure Elastic APM.</p>
<h3><a id="ssl-setup"></a>SSL/TLS communication with APM Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/setup.asciidoc">edit</a></h3>
<p>If <a href="/guide/en/apm/guide/8.6/agent-tls.html" class="ulink" target="_top">SSL/TLS communication</a> is enabled on the APM Server, make sure to check out the <a class="xref" href="ssl-configuration.html" title="SSL/TLS communication with APM Server">SSL setup guide</a>.</p>
<h3><a id="aws-lambda-setup"></a>Monitoring AWS Lambda Functions (Experimental)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/setup.asciidoc">edit</a></h3>
<p>Learn how to set up AWS Lambda functions tracing in our <a class="xref" href="aws-lambda.html" title="Monitoring AWS Lambda Java Functions">Lambda setup guide</a>.</p>
<h3><a id="security-manager"></a>Using with Security Manager enabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/setup.asciidoc">edit</a></h3>
<p>The agent should work as expected on JVMs with an enabled <code class="literal">SecurityManager</code>, provided that it is granted with <code class="literal">java.security.AllPermission</code>.
Make sure that the following snippet is added to an effective* policy (replace with the real path** to the agent jar):</p>
<pre class="screen">grant codeBase "file:&lt;/path/to/elastic-apm-agent.jar&gt;" {
    permission java.security.AllPermission;
};</pre>
<p>If you see a <code class="literal">java.lang.SecurityException</code> exception (for example a - <code class="literal">java.security.AccessControlException</code>) after verifying the above
<code class="literal">grant</code> snippet is effectively applied, open an issue in our <a href="https://github.com/elastic/apm-agent-java" class="ulink" target="_top">GitHub repo</a> with a description
and the full stack trace.</p>
<p>* it is possible to have multiple policy files taking effect at the same time on a single JVM. The policy entry above can be added
to an existing policy or can be appended through the <code class="literal">java.security.policy</code> system property. See
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html" class="ulink" target="_top">documentation</a> for more details.</p>
<p>** you can make use of the <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html#PropertyExp" class="ulink" target="_top">property
expansion</a> capability for specifying the agent jar path.</p>
<h3><a id="supported-technologies"></a>Supported technologies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/setup.asciidoc">edit</a></h3>
<p>Please check <a class="xref" href="supported-technologies-details.html" title="Supported technologies">supported technologies</a>
for details on if the Elastic APM agent supports auto-instrumentation of the technologies your application is using.</p>
<h3><a id="bootstrap-checks"></a>Bootstrap checks<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/setup.asciidoc">edit</a></h3>
<p>In some cases, the agent needs to take a decision to abort very early, before almost any initialization process takes place,
for example- when it is attached to a non-supported JVM version. This decision is based on what we call "bootstrap checks".
If any of the bootstrap checks fails, the agent will log an error to the standard error stream and abort.
It is possible to disable bootstrap checks by setting the <code class="literal">elastic.apm.disable_bootstrap_checks</code> System property, or the
<code class="literal">ELASTIC_APM_DISABLE_BOOTSTRAP_CHECKS</code> environment variable, to <code class="literal">true</code>.</p>
<h4><a id="jvm-filtering"></a>JVM Filtering<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/setup.asciidoc">edit</a></h4>
<p>In some cases, users may cast a too-wide net to instrument their Java processes, for example when setting the <code class="literal">JAVA_TOOL_OPTIONS</code>
environment variable globally on a host/container on which many JVMs run.
In such cases, users may want to exclude JVMs from being instrumented, or to specifically allow when necessary.
For this purpose, we have the following bootstrap configuration options available:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">System property name</th>
<th align="left" valign="top">Env variable name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.bootstrap_allowlist</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_BOOTSTRAP_ALLOWLIST</code></p></td>
<td align="left" valign="top"><p>If set, the agent will be enabled <span class="strong strong"><strong>only</strong></span> on JVMs of which command matches one of the patterns in the provided list</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.bootstrap_exclude_list</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_BOOTSTRAP_EXCLUDE_LIST</code></p></td>
<td align="left" valign="top"><p>If set, the agent will be disabled on JVMs that contain a System property with one of the provided names in the list</p></td>
</tr>
</tbody>
</table>
</div>
<p>The allowlist option expects a comma-separated list of wild-card patterns. Such patterns may contain wildcards (<code class="literal">*</code>), which match zero
or more characters. Examples: <code class="literal">foo\*bar\*baz\*, \*foo\*</code>. Matching is case-insensitive by default. Prepending an element with
<code class="literal">(?-i)}</code> makes the matching case-sensitive. The patterns are matched against the JVM command as it is stored in the <code class="literal">sun.java.command</code>
system property.</p>
<p>Some examples:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Allow JVM attachment only on Tomcat and a proprietary Java app:<br>
<code class="literal">-Delastic.apm.bootstrap_allowlist=*org.apache.catalina.startup.Bootstrap*,my.cool.app.*</code>
</li>
<li class="listitem">
Disable when some custom System properties are set:<br>
<code class="literal">-Delastic.apm.bootstrap_exclude_list=custom.property.1,custom.property.2</code>
</li>
</ol>
</div>





</div>
<div class="navfooter">
<span class="prev">
<a href="intro.html">« Introduction</a>
</span>
<span class="next">
<a href="setup-javaagent.html">Manual setup with <code class="literal">-javaagent</code> flag »</a>
</span>
</div>
</div>
</body>
</html>
