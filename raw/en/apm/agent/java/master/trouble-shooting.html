<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Troubleshooting | APM Java Agent Reference [master] | Elastic</title>
<meta class="elastic" name="content" content="Troubleshooting | APM Java Agent Reference [master]">

<link rel="home" href="index.html" title="APM Java Agent Reference [master]"/>
<link rel="up" href="index.html" title="APM Java Agent Reference [master]"/>
<link rel="prev" href="tuning-and-overhead.html" title="Overhead and Performance tuning"/>
<link rel="next" href="faq.html" title="Frequently Asked Questions"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Java Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="tuning-and-overhead.html">« Overhead and Performance tuning</a>
</span>
<span class="next">
<a href="faq.html">Frequently Asked Questions »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">Java Agent Reference<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Troubleshooting</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="trouble-shooting"></a>Troubleshooting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h2>
</div></div></div>
<p>Something isn&#8217;t quite working as expected?
Here are some guidelines how to find out what&#8217;s going wrong.</p>
<p>As a first step, please check if your stack is compatible with the currently <a class="xref" href="setup.html#supported-technologies" title="Supported technologies">supported technologies</a>.</p>
<p>Don&#8217;t worry if you can&#8217;t figure out what the problem is.
Open a topic in the <a href="https://discuss.elastic.co/c/apm" class="ulink" target="_top">APM discuss forum</a>
and we will help you out.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you do so, <span class="strong strong"><strong>please attach your debug logs</strong></span> so that we can analyze the problem.
Upload the <span class="strong strong"><strong>complete</strong></span> logs to a service like <a href="https://gist.github.com" class="ulink" target="_top">https://gist.github.com</a>.
The logs should include everything from the application startup up until the first request has been executed.
In addition to agent and application logs, look for <code class="literal">[elastic-apm-agent]</code> entries in all of your service&#8217;s std out and std error logs, where we sometimes print useful information when logging is unavailable.</p>
</div>
</div>
<h3><a id="trouble-shooting-use-latest-agent"></a>Updating to latest agent version<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<p>Agent is updated frequently and releases are not strongly tied to other components in the stack.</p>
<p>Therefore, trying to update to the most recently released agent version is often the recommended first troubleshooting step.
If possible, trying the <a href="https://github.com/elastic/apm-agent-java/blob/main/README.md#snapshots" class="ulink" target="_top">latest-snapshot</a> is even preferable as it would include fixes that are not yet released.</p>
<p>See <a class="xref" href="upgrading.html" title="Upgrading">upgrading documentation</a> for more details.</p>
<h3><a id="trouble-shooting-additional-agent"></a>Running alongside other agents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<p>Like many other Java agents, our agent instruments classes by injecting bytecode into them on runtime. Our bytecode
instrumentation guarantees to produce only valid bytecode and to never change the class&#8217;s "schema". If you are using
other Java agents in addition to ours that have the same guarantees, they should not interfere with each other.
However, some Java agents do not conform to these guarantees, in which case there may be issues with using them in
parallel to ours. If you encounter errors, one of the first things to do is to remove any additional agent in order to
check whether this is indeed a case of agent mismatch. We may still find a way to make them work together, but this
information would be crucial for our ability to assist, so make sure to include it when reporting such issues.</p>
<h3><a id="trouble-shooting-logging"></a>Logging<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<p>There are several <a class="xref" href="config-logging.html" title="Logging configuration options">logging related configuration options</a>.
The most important one is <a class="xref" href="config-logging.html#config-log-level" title="log_level"><code class="literal">log_level</code></a>.</p>
<p>Set the log level to <code class="literal">DEBUG</code> or even <code class="literal">TRACE</code> to get more information about the behavior of the agent.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">DEBUG</code> shows:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Agent configuration as read by the agent
</li>
<li class="listitem">
Transaction and spans creation, activation and deactivation events
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><code class="literal">TRACE</code> is even more verbose than <code class="literal">DEBUG</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A stack trace is printed every time a transaction or span is activated or deactivated
</li>
<li class="listitem">
All data sent to apm-server is included in JSON format
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Please always post the whole content of your log files when asking for help. Use the <a class="xref" href="trouble-shooting.html#trouble-shooting-logging-procedure" title="Capturing logs procedure">procedure</a>
to ensure consistent logs when reporting potential issues.</p>
<p>When the agent starts up,
you should see logs similar to these:</p>
<pre class="screen">[main] INFO co.elastic.apm.agent.configuration.StartupInfo - Starting Elastic APM (unknown version) on Java 10 (Oracle Corporation) Mac OS X 10.13.6
[apm-server-healthcheck] INFO co.elastic.apm.agent.report.ApmServerHealthChecker - Elastic APM server is available: {"build_date":"2018-11-05T07:58:08Z","build_sha":"dffb98a72a262ca22adad0152f0245ea743ea904","version":"7.0.0-alpha1"}
[main] DEBUG co.elastic.apm.agent.configuration.StartupInfo - service_name: 'elastic-apm-test' (source: Java System Properties)
[main] DEBUG co.elastic.apm.agent.configuration.StartupInfo - log_level: 'DEBUG' (source: Java System Properties)</pre>
<p>Make sure to execute some requests to your application before posting your log files.
Each request should at least add some lines similar to these in the logs:</p>
<pre class="screen">[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.ElasticApmTracer - startTransaction '' 00-2a82cbe3df7a0208f7be6da65be260d1-05e72d045206587a-01 {
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.ElasticApmTracer - Activating '' 00-2a82cbe3df7a0208f7be6da65be260d1-05e72d045206587a-01 on thread 66
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.transaction.SpanImpl - startSpan '' 00-2a82cbe3df7a0208f7be6da65be260d1-b2ffa0401105e3d8-01 {
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.ElasticApmTracer - Activating 'APIRestController#products' 00-2a82cbe3df7a0208f7be6da65be260d1-b2ffa0401105e3d8-01 on thread 66
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.transaction.SpanImpl - startSpan '' 00-2a82cbe3df7a0208f7be6da65be260d1-49b9d805eca42ec6-01 {
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.ElasticApmTracer - Activating '' 00-2a82cbe3df7a0208f7be6da65be260d1-49b9d805eca42ec6-01 on thread 66
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.ElasticApmTracer - Deactivating 'SELECT' 00-2a82cbe3df7a0208f7be6da65be260d1-49b9d805eca42ec6-01 on thread 66
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.transaction.SpanImpl - endSpan 'SELECT' 00-2a82cbe3df7a0208f7be6da65be260d1-49b9d805eca42ec6-01
[apm-reporter] DEBUG co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Receiving SPAN event (sequence 23)
[apm-reporter] DEBUG co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Starting new request to http://127.0.0.1:8200/intake/v2/events
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.ElasticApmTracer - Deactivating 'APIRestController#products' 00-2a82cbe3df7a0208f7be6da65be260d1-b2ffa0401105e3d8-01 on thread 66
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.transaction.SpanImpl - endSpan 'APIRestController#products' 00-2a82cbe3df7a0208f7be6da65be260d1-b2ffa0401105e3d8-01
[apm-reporter] DEBUG co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Scheduling request timeout in 10s
[apm-reporter] DEBUG co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Receiving SPAN event (sequence 24)
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.ElasticApmTracer - Deactivating 'APIRestController#products' 00-2a82cbe3df7a0208f7be6da65be260d1-05e72d045206587a-01 on thread 66
[http-nio-8080-exec-10] DEBUG co.elastic.apm.agent.impl.ElasticApmTracer - endTransaction 'APIRestController#products' 00-2a82cbe3df7a0208f7be6da65be260d1-05e72d045206587a-01
[apm-reporter] DEBUG co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Receiving TRANSACTION event (sequence 25)</pre>
<p>If you don&#8217;t see anything in your logs,
the technology stack you are using is probably not <a class="xref" href="supported-technologies-details.html" title="Supported technologies">supported</a>.</p>
<p>After that, you should see logs indicating that the agent has successfully sent data to the APM server:</p>
<pre class="screen">[apm-request-timeout-timer] DEBUG co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Request flush because the request timeout occurred
[apm-reporter] DEBUG co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Receiving FLUSH event (sequence 26)
[apm-reporter] DEBUG co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Flushing 10912 uncompressed 2667 compressed bytes</pre>
<p>If the APM server responds with a 400,
it could indicate JSON validation errors.
The log would then contain the actual documents which failed to validate:</p>
<pre class="screen">[apm-reporter] INFO co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Backing off for 0 seconds (±10%)
[apm-reporter] WARN co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - Server returned HTTP response code: 400 for URL: http://127.0.0.1:8200/intake/v2/events
[apm-reporter] WARN co.elastic.apm.agent.report.IntakeV2ReportingEventHandler - {"accepted":13,"errors":[{"message":"Problem validating JSON document against schema: I[#] S[#] doesn't validate with \"span#\"\n  I[#] S[#/allOf/2] allOf failed\n    I[#] S[#/allOf/2/required] missing properties: \"transaction_id\"","document":"{\"span\":{\"name\":\"OpenTracing product span\",\"timestamp\":29352159207,\"id\":\"aeaa7e0ac95acad6\",\"trace_id\":\"d88b5cbfc4536f9a700cd114a53bfeae\",\"parent_id\":\"082fd71ce7e4089a\",\"duration\":17.992,\"context\":{\"tags\":{\"productId\":\"1\"}},\"type\":\"unknown\"}}"}]}</pre>
<h4><a id="trouble-shooting-logging-procedure"></a>Capturing logs procedure<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p>Ideally this should be done outside of production.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
It requires restarting the application
</li>
<li class="listitem">
With log level set to <code class="literal">DEBUG</code> logs can be verbose, with <code class="literal">TRACE</code> they are even more verbose.
</li>
<li class="listitem">
Having only a few transactions in the log makes investigations easier, production traffic creates noise.
</li>
<li class="listitem">
If not possible, we can still use it for a few minutes in production, when using an external configuration file (<a class="xref" href="configuration.html" title="Configuration">doc</a>) the <code class="literal">log_level</code> can be changed at runtime.
</li>
</ul>
</div>
<p>Most investigations require using <code class="literal">DEBUG</code> log level, thus use <code class="literal">DEBUG</code> unless asked for <code class="literal">TRACE</code>.</p>
<p>Here, we will refer to the agent log file as <code class="literal">/tmp/agent.log</code>, but any other location could be used.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
configure the agent with <code class="literal">log_level=debug</code> or <code class="literal">log_level=trace</code> (<a class="xref" href="config-logging.html#config-log-level" title="log_level">doc</a>) and <code class="literal">log_file=/tmp/agent.log</code> (<a class="xref" href="config-logging.html" title="Logging configuration options">doc</a>)
</li>
<li class="listitem">
truncate the <code class="literal">/tmp/agent.log</code> file and restart the application
</li>
<li class="listitem">
execute a few transactions which aren&#8217;t properly captured by the agent
</li>
<li class="listitem">
copy the <code class="literal">/tmp/agent.log</code> file and send it back for investigation
</li>
</ol>
</div>
<h3><a id="trouble-shooting-matching-heuristics"></a>Agent matching heuristics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<p>The agent relies on heuristics to define which classes needs to be instrumented or not efficiently to prevent instrumentation
overhead.</p>
<p>Those heuristics are based on the packages and class names and are influenced by <code class="literal">application_packages</code> and
<code class="literal">jms_listener_packages</code> configurations. However, if instrumentation is not applied as expected or if you want to investigate creating configurations
without proper knowledge of the application internals, it could be relevant to disable those heuristics for investigation:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
disable name heuristics by setting <code class="literal">enable_type_matching_name_pre_filtering=false</code> and enable the <a class="xref" href="trouble-shooting.html#trouble-shooting-logging-procedure" title="Capturing logs procedure">agent logs</a>.
</li>
<li class="listitem">
restart the application, which will be slower than usual due to the extra overhead
</li>
<li class="listitem">
analyze the agent logs to identify which classes/methods are instrumented by filtering lines with <code class="literal">Method match</code> string.
</li>
<li class="listitem">
properly configure <code class="literal">application_packages</code> or <code class="literal">jms_listener_packages</code> with values that apply
</li>
</ol>
</div>
<h3><a id="trouble-shooting-debugging"></a>Debugging<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<p>Sometimes reading the logs is just not enough to debug a problem.
As the agent is OpenSource and released on Maven Central,
debugging the agent code is really easy.</p>
<p>In order for your IDE to download the sources,
first declare a dependency to the agent.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The agent is added via the <code class="literal">-javaagent</code> flag.
So you have to make sure that you declare the dependency in a way that the agent is not on the classpath twice.
For example,
when you are developing a web application,
make sure that the agent is not packaged in your war in <code class="literal">WEB-INF/lib</code>.
In the debug window of your IDE,
make sure that <code class="literal">apm-agent</code> does not appear in the <code class="literal">-classpath</code>.</p>
</div>
</div>
<p><strong>pom.xml.</strong></p>
<div class="pre_wrapper lang-xml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-xml">&lt;dependency&gt;
    &lt;groupId&gt;co.elastic.apm&lt;/groupId&gt;
    &lt;artifactId&gt;apm-agent&lt;/artifactId&gt;
    &lt;version&gt;${elastic-apm.version}&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Even when setting the <code class="literal">scope</code> to <code class="literal">provided</code>,
IntelliJ sometimes adds the agent on the classpath anyway.
One workaround is to set the <code class="literal">scope</code> to <code class="literal">test</code>.</p>
</div>
</div>
<p><strong>build.gradle.</strong></p>
<div class="pre_wrapper lang-groovy">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-groovy">compileOnly "co.elastic.apm:apm-agent:$elasticApmVersion"</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In versions prior to 1.26.0, you need to declare a dependency on the <code class="literal">elastic-apm-agent</code> module instead of <code class="literal">apm-agent</code></p>
</div>
</div>
<h3><a id="trouble-shooting-common-issues"></a>Common problems<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<h4><a id="trouble-shooting-no-data"></a>There is no data in the Kibana APM app<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p>The most common source of this problem are connection issues between the agent and the APM server.</p>
<p>If the APM server does not receive data from the agent,
check if the agent is able to establish a connection to the server.
In the agent logs,
look out for logs containing <code class="literal">Elastic APM server is available</code>
and <code class="literal">Elastic APM server is not available</code>.</p>
<p>If you see the message <code class="literal">Elastic APM server is not available</code>,
the agent has problems connecting to the APM server.
Check the setting of <a class="xref" href="config-reporter.html#config-server-url" title="server_url"><code class="literal">server_url</code></a> and make sure the agent is able to connect to the server.
Try to execute <code class="literal">curl -v &lt;apm-server-url&gt;</code> from the machine the agent is running on.
The server should respond with a 200 status code.</p>
<p>If the APM server does not respond successfully,
have a look at the APM server logs to verify that the server is actually running.
Also make sure to configure your firewalls so that the host the agent runs on can open HTTP connections to the APM server.</p>
<h4><a id="trouble-shooting-unknown-route"></a>Kibana APM app shows "unknown route"<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p>By default, transactions are named with the Servlet name that handled the request.
Thus, if request does not reach a servlet, the Agent defaults to naming the transaction "unknown route"</p>
<p>There are two reasons why this might happen:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Requests reach a servlet, but the Agent is not properly able to detect them.
</li>
<li class="listitem">
<p>Requests do not reach a servlet. It might&#8217;ve been handled by filter, static resources, etc.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Requests reach a servlet
</span>
</dt>
<dd>
<p>
The Agent has a <em>pre-filter</em> heuristic to only consider classes whose names end with <em>Servlet</em>.
This heuristic can be disabled by setting the internal configuration <code class="literal">enable_type_matching_name_pre_filtering=false</code>.
</p>
<p>Please note that this has an impact on all plugins.
A small increase of overhead during application startup time is expected.</p>
</dd>
<dt>
<span class="term">
Requests do not reach a servlet
</span>
</dt>
<dd>
<p>
It&#8217;s possible to change the default transaction naming to use the URL path instead.
See <a class="xref" href="config-http.html#config-use-path-as-transaction-name" title="use_path_as_transaction_name ()"><code class="literal">use_path_as_transaction_name</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.0.0</span>]
<span class="Admonishment-detail">
Added in 1.0.0. Changing this value at runtime is possible since version 1.22.0
</span>
</span>)</a> for more information.
</p>
<p>Unfortunately, this may create a lot of duplicate transactions if they have similar paths.
For example, in <code class="literal">/usr/{id}</code>, where <code class="literal">{id}</code> is the user ID,
you can end up with as many transactions as there are users.
You can mitigate this by using <a class="xref" href="config-http.html#config-url-groups" title="url_groups (deprecated)"><code class="literal">url_groups</code> (deprecated)</a>,
which will allow the use of wildcards in transaction URLs.</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<p>If the proposed fixes do not solve the problem, or if a custom name is required, transaction names can be set manually throughout the request handling flow using our API:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="public-api.html#api-current-transaction" title="Transaction currentTransaction()"><code class="literal">Transaction currentTransaction()</code></a> gets the current transaction.
</li>
<li class="listitem">
<a class="xref" href="public-api.html#api-set-name" title="Transaction setName(String name)"><code class="literal">Transaction setName(String name)</code></a> sets the transaction name.
</li>
</ul>
</div>
<h4><a id="trouble-shooting-old-jdbc-drivers"></a>Libraries compiled against old Java versions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p>If you are seeing warning like these in your application,
it means that you are using a library which has been compiled for a very old version of Java:</p>
<pre class="screen">org.apache.commons.dbcp.DelegatingStatement uses an unsupported class file version (pre Java 5) and can't be instrumented.
Consider updating to a newer version of that library.</pre>
<p>That mostly concerns JDBC drivers.
Updating them to a more recent version should resolve the problem.</p>
<h4><a id="trouble-shooting-incorrect-manual-jar-file"></a>Failed to find Premain-Class manifest attribute<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p>If you are using a manual setup with a <code class="literal">-javaagent</code> flag against an application server and are seeing the
<code class="literal">Failed to find Premain-Class manifest attribute</code> error and a failure to start, then you might be pointing
at the incorrect jar file.</p>
<p>The correct jar file to be pointing at should be in the form of <code class="literal">elastic-apm-agent-&lt;version&gt;.jar</code> and
further information about how to download this file can be found <a class="xref" href="setup-javaagent.html" title="Manual setup with -javaagent flag">in the manual setup instructions.</a></p>
<h4><a id="trouble-shooting-communication"></a>Communication with APM Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p><code class="literal">unable to find valid certification path to requested target</code> - server authentication fails. Check out
<a class="xref" href="ssl-configuration.html#ssl-server-authentication" title="APM Server certificate authentication">APM Server certificate authentication</a>.</p>
<p><code class="literal">java.net.SocketException: Broken pipe</code> - one option is that client authentication fails. Check out
<a class="xref" href="ssl-configuration.html#ssl-client-authentication" title="Agent certificate authentication">Agent certificate authentication</a>.</p>
<p>For other SSL/TLS related problems, - check out
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#Troubleshooting" class="ulink" target="_top">the JSSE
troubleshooting section</a>.
You can add <code class="literal">-Djavax.net.debug=all</code> to the JVM cmd line to get more details about your problem.</p>
<h3><a id="trouble-shooting-uncommon-issues"></a>Uncommon problems<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<h4><a id="trouble-shooting-jvm-crashes"></a>JVM Crashes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p>More often than not, JVM crashes indicate a JVM bug being surfaced by the installation of the Java agent within the
specific configuration of the traced application and it&#8217;s dependencies. Therefore, the first thing to try is upgrade
the JVM to the latest minor version.</p>
<p>Known issues:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Early Java 8 versions before update 40 are <span class="strong strong"><strong>not supported</strong></span> because they have
several bugs that might result in JVM crashes when a java agent is active,
thus agent <span class="strong strong"><strong>will not start</strong></span> on those versions.
</li>
<li class="listitem">
Similarly, Java 7 versions before update 60 are not supported as they are buggy in regard to <code class="literal">invokedynamic</code>.
</li>
<li class="listitem">
<p>Later Java 7 versions (&gt; update 60) and early Java 8 versions (&lt; update 40) are known to crash with agent versions
1.18.0-1.20.0 at some random point after (sometimes long after) startup due to
<a href="https://bugs.openjdk.java.net/browse/JDK-8041920" class="ulink" target="_top">a bug</a> causing the creation of faulty native code by the C2
compiler. Symptoms of such crashes are non-deterministic. In order to prevent such crashes, we added a built-in delay
for agent initialization in agent version 1.21.0, that will be automatically applied on these Java versions.
If crashes still occur with agent version &gt; 1.20.0, try one of the followings:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Add <code class="literal">-XX:CompileCommand=exclude,java.lang.invoke.LambdaForm*::*</code> to the command line to avoid the problematic JIT
compilation
</li>
<li class="listitem">
Increase the delay from the default (3000ms) by setting the <code class="literal">elastic.apm.delay_agent_premain_ms</code> System property
to indicate the number of milliseconds to delay, through the command line, for example:
<code class="literal">-Delastic.apm.delay_agent_premain_ms=10000</code>.
</li>
</ol>
</div>
</li>
<li class="listitem">
When <a class="xref" href="config-profiling.html#config-profiling-inferred-spans-enabled" title="profiling_inferred_spans_enabled ( experimental)"><code class="literal">profiling_inferred_spans_enabled</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.15.0</span>]
<span class="Admonishment-detail">
Added in 1.15.0.
</span>
</span> experimental)</a> is set to <code class="literal">true</code>, it uses a native library that collects low-level
information from the JVM. All known issues so far had been fixed. Try to disable it if you think the crash may be related.
We continuously upgrade to the latest async profiler version, so upgrading your agent to the latest version may already
contain a fix.
</li>
</ul>
</div>
<p>Whenever you encounter a JVM crash, please report through <a href="https://discuss.elastic.co/c/observability/apm/58" class="ulink" target="_top">our forum</a>
or by opening an issue on our <a href="https://github.com/elastic/apm-agent-java" class="ulink" target="_top">GitHub repository</a>. Look for the crash log
(e.g. an <code class="literal">hs_err_pid&lt;PID&gt;.log</code>) and provide it when reporting, as well as all factors describing you setup and scenario.</p>
<h4><a id="trouble-shooting-jvm-hangs"></a>JVM Hangs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p>If your JVM gets hang when attaching the Java agent, please create a thread dump (e.g. through <code class="literal">jstack</code>) and report
through <a href="https://discuss.elastic.co/c/observability/apm/58" class="ulink" target="_top">our forum</a> or by opening an issue on our
<a href="https://github.com/elastic/apm-agent-java" class="ulink" target="_top">GitHub repository</a>.</p>
<h4><a id="trouble-shooting-jlink"></a>Custom Java runtimes using <code class="literal">jlink</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h4>
<p>If you use <code class="literal">jlink</code> to create a custom runtime, make sure the following modules are added: <code class="literal">--add-modules java.base,java.logging,java,jdk.zipfs,java.management,jdk.management</code></p>
<h3><a id="disable-agent"></a>Disable the Agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<p>In the unlikely event the agent causes disruptions to a production application,
you can disable the agent while you troubleshoot.</p>
<p>Using <a class="xref" href="configuration.html#configuration-dynamic" title="Dynamic configuration">dynamic configuration</a>,
you can disable the recording of events by setting <a class="xref" href="config-core.html#config-recording" title="recording ()"><code class="literal">recording</code></a> to <code class="literal">false</code>.</p>
<p>If that doesn&#8217;t work, you can completely disable the agent by setting
<a class="xref" href="config-core.html#config-enabled" title="enabled ()"><code class="literal">enabled</code></a> to <code class="literal">false</code>.
You&#8217;ll need to restart your application for this change to take effect.</p>
<h3><a id="trouble-shooting-unsupported-framework-versions"></a>Unsupported framework versions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/main/docs/troubleshooting.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
JSF - myfaces some 2.2.x versions are not supported on JDK 15 - see
<a href="https://github.com/raphw/byte-buddy/issues/979" class="ulink" target="_top">related bug</a>.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="tuning-and-overhead.html">« Overhead and Performance tuning</a>
</span>
<span class="next">
<a href="faq.html">Frequently Asked Questions »</a>
</span>
</div>
</body>
</html>
