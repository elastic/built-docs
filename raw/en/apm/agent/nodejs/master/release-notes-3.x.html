<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Node.js Agent version 3.x | APM Node.js Agent Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="APM Node.js Agent Reference [master]"/>
<link rel="up" href="release-notes.html" title="Release notes"/>
<link rel="prev" href="release-notes.html" title="Release notes"/>
<link rel="next" href="release-notes-2.x.html" title="Node.js Agent version 2.x"/>
<meta name="DC.type" content="Learn/Docs/APM Node.js Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Node.js Agent Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="release-notes.html">Release notes</a></span>
»
<span class="breadcrumb-node">Node.js Agent version 3.x</span>
</div>
<div class="navheader">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-2.x.html">Node.js Agent version 2.x »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="release-notes-3.x"></a>Node.js Agent version 3.x<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.9.0"></a>3.9.0 - 2020/11/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: support fastify 3 <a href="https://github.com/elastic/apm-agent-nodejs/pull/1891" class="ulink" target="_top">#1891</a><br>
Adds .default and .fastify module.exports to instrumented fastify function
for 3.x line, and prefers req.routerMethod and req.routerPath for
transaction name
</li>
<li class="listitem">
feat: Set "destination" context on spans for "mongodb". <a href="https://github.com/elastic/apm-agent-nodejs/pull/1893" class="ulink" target="_top">#1893</a><br>
This allows Kibana APM Service Maps to show a "mongodb" node for services using
the <a href="https://www.npmjs.com/package/mongodb" class="ulink" target="_top">mongodb</a> package (which includes
mongoose and mongojs).
</li>
<li class="listitem">
feat: transactionIgnoreUrl wildcard matching <a href="https://github.com/elastic/apm-agent-nodejs/pull/1870" class="ulink" target="_top">#1870</a><br>
Allows users to ignore URLs using simple wildcard matching patterns that behave
the same across language agents. See <a href="https://github.com/elastic/apm/issues/144" class="ulink" target="_top">https://github.com/elastic/apm/issues/144</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix: treat set-cookie in response headers as sensitive data <a href="https://github.com/elastic/apm-agent-nodejs/pull/1886" class="ulink" target="_top">#1886</a>
</li>
<li class="listitem">
fix: Synchronous spans would never have <code class="literal">span.sync == true</code>. <a href="https://github.com/elastic/apm-agent-nodejs/pull/1879" class="ulink" target="_top">#1879</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.8.0"></a>3.8.0 - 2020/11/09<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_2"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: expand k8s pod ID discovery regex <a href="https://github.com/elastic/apm-agent-nodejs/pull/1863" class="ulink" target="_top">#1863</a>
</li>
<li class="listitem">
feat: implements tracestate <a href="https://github.com/elastic/apm-agent-nodejs/pull/1828" class="ulink" target="_top">#1828</a><br>
Expands support for the W3C Trace Context specification by adding a tracestate
header implementation, and uses this new header to track the Elastic
transaction sample rate across a trace&#8217;s service boundaries.
</li>
<li class="listitem">
feat: add span and transaction outcome <a href="https://github.com/elastic/apm-agent-nodejs/pull/1824" class="ulink" target="_top">#1824</a><br>
This adds an "outcome" field to HTTP(S)
<a href="https://github.com/elastic/apm/blob/master/specs/agents/tracing-transactions.md#transaction-outcome" class="ulink" target="_top">transactions</a>
and <a href="https://github.com/elastic/apm/blob/master/specs/agents/tracing-spans.md#span-outcome" class="ulink" target="_top">spans</a>.
</li>
</ul>
</div>
<h5><a id="_bug_fixes_2"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix(pg): prevent unhandled promise rejection <a href="https://github.com/elastic/apm-agent-nodejs/pull/1846" class="ulink" target="_top">#1846</a>
</li>
<li class="listitem">
fix: redis@2.x instrumentation was broken <a href="https://github.com/elastic/apm-agent-nodejs/pull/1852" class="ulink" target="_top">#1852</a>
</li>
<li class="listitem">
A number of fixes to the test suite.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.7.0"></a>3.7.0 - 2020/8/10<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat(knex): add support for 0.21.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1801" class="ulink" target="_top">#1801</a>
</li>
<li class="listitem">
feat(redis): add support for v3.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1641" class="ulink" target="_top">#1641</a>
</li>
<li class="listitem">
feat(graphql): add support for 15.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1795" class="ulink" target="_top">#1795</a>
</li>
<li class="listitem">
feat(koa-router): add support for 9.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1772" class="ulink" target="_top">#1772</a>
</li>
<li class="listitem">
fix(elasticsearch): ensure requests can be aborted <a href="https://github.com/elastic/apm-agent-nodejs/pull/1566" class="ulink" target="_top">#1566</a>
</li>
<li class="listitem">
fix: end span if outgoing http request ends prematurely <a href="https://github.com/elastic/apm-agent-nodejs/pull/1583" class="ulink" target="_top">#1583</a>
</li>
<li class="listitem">
fix: don&#8217;t throw on invalid URL <a href="https://github.com/elastic/apm-agent-nodejs/pull/1771" class="ulink" target="_top">#1771</a>
</li>
<li class="listitem">
fix: patch apollo-server-core &gt; 2.14 correctly <a href="https://github.com/elastic/apm-agent-nodejs/pull/1796" class="ulink" target="_top">#1796</a>
</li>
<li class="listitem">
fix: add currentTraceIds to typings <a href="https://github.com/elastic/apm-agent-nodejs/pull/1733" class="ulink" target="_top">#1733</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.6.1"></a>3.6.1 - 2020/5/20<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix(package): bump elastic-apm-http-client to ^9.4.0 <a href="https://github.com/elastic/apm-agent-nodejs/pull/1756" class="ulink" target="_top">#1756</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.6.0"></a>3.6.0 - 2020/5/18<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: add destination metadata for db spans <a href="https://github.com/elastic/apm-agent-nodejs/pull/1687" class="ulink" target="_top">#1687</a>
</li>
<li class="listitem">
feat: add support for Node.js 14 <a href="https://github.com/elastic/apm-agent-nodejs/pull/1742" class="ulink" target="_top">#1742</a>
</li>
<li class="listitem">
feat(pg): add support for pg v8.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1743" class="ulink" target="_top">#1743</a>
</li>
<li class="listitem">
feat: add metrics for external memory <a href="https://github.com/elastic/apm-agent-nodejs/pull/1724" class="ulink" target="_top">#1724</a>
</li>
<li class="listitem">
feat: enrich spans with destination info <a href="https://github.com/elastic/apm-agent-nodejs/pull/1685" class="ulink" target="_top">#1685</a>
</li>
<li class="listitem">
fix(instrumentation): add .js to module path <a href="https://github.com/elastic/apm-agent-nodejs/pull/1711" class="ulink" target="_top">#1711</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.5.0"></a>3.5.0 - 2020/3/9<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat(error): get stack trace from Error-like objects <a href="https://github.com/elastic/apm-agent-nodejs/pull/1613" class="ulink" target="_top">#1613</a>
</li>
<li class="listitem">
fix: add logUncaughtExceptions conf option to TypeScript typings <a href="https://github.com/elastic/apm-agent-nodejs/pull/1668" class="ulink" target="_top">#1668</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.4.0"></a>3.4.0 - 2020/2/21<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: support W3C TraceContext traceparent header <a href="https://github.com/elastic/apm-agent-nodejs/pull/1587" class="ulink" target="_top">#1587</a>
</li>
<li class="listitem">
feat: add custom metrics API (experimental) <a href="https://github.com/elastic/apm-agent-nodejs/pull/1571" class="ulink" target="_top">#1571</a>
</li>
<li class="listitem">
feat(koa-router): add support for v8.x <a href="https://github.com/elastic/apm-agent-nodejs/pull/1642" class="ulink" target="_top">#1642</a>
</li>
<li class="listitem">
fix(cassandra): improve support for cassandra-driver v4.4.0+ <a href="https://github.com/elastic/apm-agent-nodejs/pull/1636" class="ulink" target="_top">#1636</a>
</li>
<li class="listitem">
fix: support promisifying setTimeout and friends <a href="https://github.com/elastic/apm-agent-nodejs/pull/1636" class="ulink" target="_top">#1636</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.3.0"></a>3.3.0 - 2019/12/13<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat(config): add serverCaCertFile config <a href="https://github.com/elastic/apm-agent-nodejs/pull/1560" class="ulink" target="_top">#1560</a>
</li>
<li class="listitem">
feat(config): add central config support for transactionMaxSpans and captureBody <a href="https://github.com/elastic/apm-agent-nodejs/pull/1555" class="ulink" target="_top">#1555</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.2.0"></a>3.2.0 - 2019/11/19<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix(metrics): only register collectors if enabled <a href="https://github.com/elastic/apm-agent-nodejs/pull/1520" class="ulink" target="_top">#1520</a>
</li>
<li class="listitem">
fix(ioredis): prevent unhandled promise rejection <a href="https://github.com/elastic/apm-agent-nodejs/pull/1523" class="ulink" target="_top">#1523</a>
</li>
<li class="listitem">
chore: add Node 13 to supported engines <a href="https://github.com/elastic/apm-agent-nodejs/pull/1524" class="ulink" target="_top">#1524</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.1.0"></a>3.1.0 - 2019/10/16<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_features_3"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat(mongodb): instrumentation <a href="https://github.com/elastic/apm-agent-nodejs/pull/1423" class="ulink" target="_top">#1423</a>
</li>
<li class="listitem">
fix(package): update elastic-apm-http-client to version 9.0.0 <a href="https://github.com/elastic/apm-agent-nodejs/pull/1419" class="ulink" target="_top">#1419</a>
</li>
<li class="listitem">
perf: cache <em>ids</em> value of transactions and spans <a href="https://github.com/elastic/apm-agent-nodejs/pull/1434" class="ulink" target="_top">#1434</a>
</li>
</ul>
</div>
<h5><a id="_bug_fixes_3"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
fix: always end transaction when socket is closed prematurely <a href="https://github.com/elastic/apm-agent-nodejs/pull/1439" class="ulink" target="_top">#1439</a>
</li>
<li class="listitem">
fix: change logUncaughtExceptions default to false <a href="https://github.com/elastic/apm-agent-nodejs/pull/1432" class="ulink" target="_top">#1432</a>
</li>
<li class="listitem">
fix: write stack trace of uncaught exceptions to STDERR <a href="https://github.com/elastic/apm-agent-nodejs/pull/1429" class="ulink" target="_top">#1429</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-3.0.0"></a>3.0.0 - 2019/9/30<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-nodejs/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
feat: allow manual instrumentation with <code class="literal">instrument: false</code> <a href="https://github.com/elastic/apm-agent-nodejs/pull/1114" class="ulink" target="_top">#1114</a>
</li>
<li class="listitem">
feat: allow setting span/transaction <code class="literal">type</code>, <code class="literal">subtype</code>, and <code class="literal">action</code> separately (the behavior of the old <code class="literal">type</code> has changed) <a href="https://github.com/elastic/apm-agent-nodejs/pull/1292" class="ulink" target="_top">#1292</a>
</li>
<li class="listitem">
feat: use <code class="literal">external</code> as span type instead of <code class="literal">ext</code> <a href="https://github.com/elastic/apm-agent-nodejs/pull/1291" class="ulink" target="_top">#1291</a>
</li>
<li class="listitem">
refactor(graphql): use custom transaction type <code class="literal">graphql</code> for graphql requests instead of <code class="literal">request</code> <a href="https://github.com/elastic/apm-agent-nodejs/pull/1245" class="ulink" target="_top">#1245</a>
</li>
<li class="listitem">
feat(http): add <code class="literal">instrumentIncomingHTTPRequests</code> config (<code class="literal">disableInstrumentations</code> now behaves differently) <a href="https://github.com/elastic/apm-agent-nodejs/pull/1298" class="ulink" target="_top">#1298</a>
</li>
<li class="listitem">
chore: remove deprecated APIs <a href="https://github.com/elastic/apm-agent-nodejs/pull/1413" class="ulink" target="_top">#1413</a>
</li>
<li class="listitem">
chore: drop support for older Node.js versions <a href="https://github.com/elastic/apm-agent-nodejs/pull/1383" class="ulink" target="_top">#1383</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-2.x.html">Node.js Agent version 2.x »</a>
</span>
</div>
</div>
</body>
</html>
