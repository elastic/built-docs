<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Collection of diagnostic information | APM PHP Agent Reference [1.x] | Elastic</title>
<meta class="elastic" name="content" content="Collection of diagnostic information | APM PHP Agent Reference [1.x]">

<link rel="home" href="index.html" title="APM PHP Agent Reference [1.x]"/>
<link rel="up" href="troubleshooting.html" title="Troubleshooting"/>
<link rel="prev" href="_agent_is_not_instrumenting_code.html" title="Agent is not instrumenting code"/>
<link rel="next" href="release-notes.html" title="Release notes"/>
<meta class="elastic" name="product_version" content="1.x"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM PHP Agent/Reference/1.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="1.x"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="_agent_is_not_instrumenting_code.html">« Agent is not instrumenting code</a>
</span>
<span class="next">
<a href="release-notes.html">Release notes »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">PHP Agent Reference<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="troubleshooting.html">Troubleshooting</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Collection of diagnostic information</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-php/edit/1.x/docs/troubleshooting.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="_collection_of_diagnostic_information"></a>Collection of diagnostic information</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-php/edit/1.x/docs/troubleshooting.asciidoc">edit</a></div>
</div></div></div>
<p>For a more detailed analysis of issues, it is necessary to collect diagnostic information. The agent allows for the automatic collection of such information - all data will be saved to the file specified in the configuration.</p>
<p>There are two possible ways to enable this feature:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>By php.ini - To enable this feature, you need to modify the php.ini file (or 99-elastic.ini) and provide the path to the file where the data will be saved, f.ex:</p>
<div class="pre_wrapper lang-ini">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ini">elastic_apm.debug_diagnostic_file=/tmp/php_diags_%p_%t.txt</pre>
</div>
</li>
<li class="listitem">
<p>By environment variable. You can also enable information collection using the environment variable <code class="literal">ELASTIC_APM_DEBUG_DIAGNOSTIC_FILE</code>. It must be exported or directly specified when running php process.
Example of calling php-cli script:</p>
<div class="pre_wrapper lang-ini">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ini">ELASTIC_APM_DEBUG_DIAGNOSTIC_FILE=/tmp/php_diags_%p_%t.txt php test.php</pre>
</div>
</li>
</ol>
</div>
<p>Remember, the provided file path must be writable by the PHP process.</p>
<p>If there are multiple PHP processes in your system, we allow you to specify directives in the diagnostic file name. This way, the files will remain unique and won&#8217;t be overwritten.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">%p</code> - In this place, the agent will substitute the process identifier.
</li>
<li class="listitem">
<code class="literal">%t</code> - In this place, the agent will substitute the UNIX timestamp.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>After setting the path, remember to <span class="strong strong"><strong>fully restart the process</strong></span> for which you are collecting diagnostic information. This may vary depending on the context, such as PHP, PHP-FPM, Apache, or PHP-CGI. Diagnostic information will be recorded after the first HTTP request is made or at the beginning of script execution for PHP-CLI.<br>
<br>
Please also be aware that the information contained in the output file may include sensitive data, such as passwords, security tokens or environment variables from your system. Make sure to review the data and mask sensitive information before sharing the file publicly.<br>
<br>
After collecting diagnostic information, remember to disable this feature and restore the previous configuration in php.ini or the environment variable.</p>
</div>
</div>
<p>What information will be collected:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Process identifier and parent process identifier
</li>
<li class="listitem">
User identifier of the worker process
</li>
<li class="listitem">
List of loaded PHP extensions
</li>
<li class="listitem">
Result from the phpinfo() function
</li>
<li class="listitem">
Process memory information and memory maps (<code class="literal">/proc/{id}/maps</code> and <code class="literal">/proc/{id}/smaps_rollup</code>)
</li>
<li class="listitem">
Process status information (<code class="literal">/proc/{id}/status</code>)
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="_agent_is_not_instrumenting_code.html">« Agent is not instrumenting code</a>
</span>
<span class="next">
<a href="release-notes.html">Release notes »</a>
</span>
</div>
</body>
</html>
