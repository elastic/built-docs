<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Django Support | APM Python Agent Reference [4.x] | Elastic</title>
<meta class="elastic" name="content" content="Django Support | APM Python Agent Reference [4.x]">

<link rel="home" href="index.html" title="APM Python Agent Reference [4.x]"/>
<link rel="up" href="index.html" title="APM Python Agent Reference [4.x]"/>
<link rel="prev" href="supported-technologies.html" title="Supported Technologies"/>
<link rel="next" href="flask-support.html" title="Flask support"/>
<meta class="elastic" name="product_version" content="4.x"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Python Agent/Reference/4.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="4.x"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="supported-technologies.html">« Supported Technologies</a>
</span>
<span class="next">
<a href="flask-support.html">Flask support »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">Python Agent Reference<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Django Support</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/apm/agents/python/django-support">latest documentation</a>.
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="django-support"></a>Django Support</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
</div></div></div>
<p>Getting Elastic APM set up for your Django project is easy, and there are various ways you can tweak it to fit to your needs.</p>
<div class="position-relative"><h3><a id="django-installation"></a>Installation</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>Install the Elastic APM agent using pip:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ pip install elastic-apm</pre>
</div>
<p>or add it to your project&#8217;s <code class="literal">requirements.txt</code> file.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For apm-server 6.2+, make sure you use version 2.0 or higher of <code class="literal">elastic-apm</code>.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you use Django with uwsgi, make sure to
<a href="http://uwsgi-docs.readthedocs.org/en/latest/Options.html#enable-threads" class="ulink" target="_top">enable
threads</a>.</p>
</div>
</div>
<div class="position-relative"><h3><a id="django-setup"></a>Setup</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>Set up the Elastic APM agent in Django with these two steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Add <code class="literal">elasticapm.contrib.django</code> to <code class="literal">INSTALLED_APPS</code> in your settings:
</li>
</ol>
</div>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">INSTALLED_APPS = (
   # ...
   'elasticapm.contrib.django',
)</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Choose a service name, and set the secret token if needed.
</li>
</ol>
</div>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">ELASTIC_APM = {
   'SERVICE_NAME': '&lt;SERVICE-NAME&gt;',
   'SECRET_TOKEN': '&lt;SECRET-TOKEN&gt;',
}</pre>
</div>
<p>or as environment variables:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">ELASTIC_APM_SERVICE_NAME=&lt;SERVICE-NAME&gt;
ELASTIC_APM_SECRET_TOKEN=&lt;SECRET-TOKEN&gt;</pre>
</div>
<p>You now have basic error logging set up, and everything resulting in a 500 HTTP status code will be reported to the APM Server.</p>
<p>You can find a list of all available settings in the <a class="xref" href="configuration.html" title="Configuration">Configuration</a> page.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The agent only captures and sends data if you have <code class="literal">DEBUG = False</code> in your settings.
To force the agent to capture data in Django debug mode, set the <a class="xref" href="configuration.html#config-debug" title="debug">debug</a> configuration option, e.g.:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">ELASTIC_APM = {
   'SERVICE_NAME': '&lt;SERVICE-NAME&gt;',
   'DEBUG': True,
}</pre>
</div>
</div>
</div>
<div class="position-relative"><h3><a id="django-performance-metrics"></a>Performance Metrics</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>To send performance metrics to Elastic APM, simply add our tracing middleware to your <code class="literal">MIDDLEWARE</code> settings:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">MIDDLEWARE = (
    'elasticapm.contrib.django.middleware.TracingMiddleware',
    # ...
)</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For Django 1.8, you can add the same middleware to <code class="literal">MIDDLEWARE_CLASSES</code>.</p>
</div>
</div>
<p>Make sure that it is the first middleware in the list.</p>
<div class="position-relative"><h4><a id="django-instrumenting-custom-python-code"></a>Instrumenting custom Python code</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>To gain further insights into the performance of your code, please see
<a class="xref" href="instrumenting-custom-code.html" title="Instrumenting custom code">instrumenting custom code</a>.</p>
<div class="position-relative"><h4><a id="django-ignoring-specific-views"></a>Ignoring specific views</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>You can use the <code class="literal">TRANSACTIONS_IGNORE_PATTERNS</code> configuration option to ignore specific views.
The list given should be a list of regular expressions which are matched against the transaction name as seen in the Elastic APM user interface:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">ELASTIC_APM['TRANSACTIONS_IGNORE_PATTERNS'] = ['^OPTIONS ', 'views.api.v2']</pre>
</div>
<p>This example ignores any requests using the <code class="literal">OPTIONS</code> method and any requests containing <code class="literal">views.api.v2</code>.</p>
<div class="position-relative"><h4><a id="django-transaction-name-route"></a>Using the route as transaction name</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>By default, we use the function or class name of the view as the transaction name.
Starting with Django 2.2, Django makes the route (e.g. <code class="literal">users/&lt;int:user_id&gt;/</code>) available on the <code class="literal">request.resolver_match</code> object.
If you want to use the route instead of the view name as the transaction name, you can set the <a class="xref" href="configuration.html#config-django-transaction-name-from-route" title="django_transaction_name_from_route"><code class="literal">django_transaction_name_from_route</code></a> config option to <code class="literal">true</code>.</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">ELASTIC_APM['DJANGO_TRANSACTION_NAME_FROM_ROUTE'] = True</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>in versions previous to Django 2.2, changing this setting will have no effect.</p>
</div>
</div>
<div class="position-relative"><h4><a id="django-integrating-with-the-rum-agent"></a>Integrating with the RUM agent</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>To correlate performance measurement in the browser with measurements in your Django app,
you can help the RUM (Real User Monitoring) agent by configuring it with the Trace ID and Span ID of the backend request.
We provide a handy template context processor which adds all the necessary bits into the context of your templates.</p>
<p>To enable this feature, first add the <code class="literal">rum_tracing</code> context processor to your <code class="literal">TEMPLATES</code> setting.
You most likely already have a list of <code class="literal">context_processors</code>, in which case you can simply append ours to the list.</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'OPTIONS': {
            'context_processors': [
                # ...
                'elasticapm.contrib.django.context_processors.rum_tracing',
            ],
        },
    },
]</pre>
</div>
<p>Then, update the call to initialize the RUM agent (which probably happens in your base template) like this:</p>
<div class="pre_wrapper lang-javascript">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-javascript">elasticApm.init({
    serviceName: "my-frontend-service",
    pageLoadTraceId: "{{ apm.trace_id }}",
    pageLoadSpanId: "{{ apm.span_id }}",
    pageLoadSampled: {{ apm.is_sampled_js }}
})</pre>
</div>
<p>See the <a href="/guide/en/apm/agent/rum-js/current" class="ulink" target="_top">JavaScript RUM agent documentation</a> for more information.</p>
<div class="position-relative"><h3><a id="django-enabling-and-disabling-the-agent"></a>Enabling and disabling the agent</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>The easiest way to disable the agent is to set Django’s <code class="literal">DEBUG</code> option to <code class="literal">True</code> in your development configuration.
No errors or metrics will be logged to Elastic APM.</p>
<p>However, if during debugging you would like to force logging of errors to Elastic APM, then you can set <code class="literal">DEBUG</code> to <code class="literal">True</code> inside of the Elastic APM
configuration dictionary, like this:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">ELASTIC_APM = {
   # ...
   'DEBUG': True,
}</pre>
</div>
<div class="position-relative"><h3><a id="django-logging"></a>Logging</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>For fine-grained control over logging use Python&#8217;s built-in logging module.
If you are new to how the logging module works together with Django, read more
<a href="https://docs.djangoproject.com/en/1.7/topics/logging/" class="ulink" target="_top">in the Django documentation</a>.</p>
<p>An example of how your <code class="literal">LOGGING</code> setting could look:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">LOGGING = {
    'version': 1,
    'disable_existing_loggers': True,
    'formatters': {
        'verbose': {
            'format': '%(levelname)s %(asctime)s %(module)s %(process)d %(thread)d %(message)s'
        },
    },
    'handlers': {
        'elasticapm': {
            'level': 'WARNING',
            'class': 'elasticapm.contrib.django.handlers.LoggingHandler',
        },
        'console': {
            'level': 'DEBUG',
            'class': 'logging.StreamHandler',
            'formatter': 'verbose'
        }
    },
    'loggers': {
        'django.db.backends': {
            'level': 'ERROR',
            'handlers': ['console'],
            'propagate': False,
        },
        'mysite': {
            'level': 'WARNING',
            'handlers': ['elasticapm'],
            'propagate': False,
        },
        # Log errors from the Elastic APM module to the console (recommended)
        'elasticapm.errors': {
            'level': 'ERROR',
            'handlers': ['console'],
            'propagate': False,
        },
    },
}</pre>
</div>
<p>With this configuration, logging can be done like this in any module in the <code class="literal">myapp</code> django app:</p>
<p>You can now use the logger in any module in the <code class="literal">myapp</code> Django app, for instance <code class="literal">myapp/views.py</code>:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">import logging
logger = logging.getLogger('mysite')

try:
    instance = MyModel.objects.get(pk=42)
except MyModel.DoesNotExist:
    logger.error(
        'Could not find instance, doing something else',
        exc_info=True
    )</pre>
</div>
<p>Note that <code class="literal">exc_info=True</code> adds the exception information to the data that gets sent to Elastic APM.
Without it, only the message is sent.</p>
<div class="position-relative"><h4><a id="django-extra-data"></a>Extra data</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>If you want to send more data  than what you get with the agent by default, logging can be done like so:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">import logging
logger = logging.getLogger('mysite')

try:
    instance = MyModel.objects.get(pk=42)
except MyModel.DoesNotExist:
    logger.error(
        'There was some crazy error',
        exc_info=True,
        extra={
            'datetime': str(datetime.now()),
        }
    )</pre>
</div>
<div class="position-relative"><h3><a id="django-celery-integration"></a>Celery Integration</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>For a general guide on how to set up Django with Celery, head over to
Celery&#8217;s <a href="http://celery.readthedocs.org/en/latest/django/first-steps-with-django.html#django-first-steps" class="ulink" target="_top">Django
documentation</a>.</p>
<p>Elastic APM will automatically log errors from your celery tasks, and record performance data.</p>
<div class="position-relative"><h3><a id="django-logging-http-404-not-found-errors"></a>Logging "HTTP 404 Not Found" Errors</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>By default, Elastic APM does not log HTTP 404 errors. If you wish to log
these errors, add
<code class="literal">'elasticapm.contrib.django.middleware.Catch404Middleware'</code> to
<code class="literal">MIDDLEWARE</code> in your settings:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">MIDDLEWARE = (
    # ...
    'elasticapm.contrib.django.middleware.Catch404Middleware',
    # ...
)</pre>
</div>
<p>Note that this middleware respects Django&#8217;s
<a href="https://docs.djangoproject.com/en/1.11/ref/settings/#ignorable-404-urls" class="ulink" target="_top"><code class="literal">IGNORABLE_404_URLS</code></a>
setting.</p>
<div class="position-relative"><h3><a id="django-disable-agent-during-tests"></a>Disable the agent during tests</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>To prevent the agent from sending any data to the APM Server during tests, set the <code class="literal">ELASTIC_APM_DISABLE_SEND</code> environment variable to <code class="literal">true</code>, e.g.:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">ELASTIC_APM_DISABLE_SEND=true python manage.py test</pre>
</div>
<div class="position-relative"><h3><a id="django-troubleshooting"></a>Troubleshooting</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>Elastic APM comes with a Django command that helps troubleshooting your setup. To check your configuration, run</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">python manage.py elasticapm check</pre>
</div>
<p>To send a test exception using the current settings, run</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">python manage.py elasticapm test</pre>
</div>
<p>If the command succeeds in sending a test exception, it will print a success message:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">python manage.py elasticapm test

Trying to send a test error using these settings:

SERVICE_NAME:      &lt;SERVICE_NAME&gt;
SECRET_TOKEN:      &lt;SECRET_TOKEN&gt;
SERVER:            http://localhost:8200

Success! We tracked the error successfully! You should be able to see it in a few seconds.</pre>
</div>
<div class="position-relative"><h3><a id="supported-django-and-python-versions"></a>Supported Django and Python versions</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-agent-python/edit/4.x/docs/django.asciidoc">edit</a></div>
<p>A list of supported <a class="xref" href="supported-technologies.html#supported-django" title="Django">Django</a> and <a class="xref" href="supported-technologies.html#supported-python" title="Python">Python</a> versions can be found on our <a class="xref" href="supported-technologies.html" title="Supported Technologies">Supported Technologies</a> page.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="supported-technologies.html">« Supported Technologies</a>
</span>
<span class="next">
<a href="flask-support.html">Flask support »</a>
</span>
</div>
</body>
</html>
