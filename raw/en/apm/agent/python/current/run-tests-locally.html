<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Run Tests Locally | APM Python Agent Reference [5.x] | Elastic</title>
<link rel="home" href="index.html" title="APM Python Agent Reference [5.x]"/>
<link rel="up" href="advanced-topics.html" title="Advanced Topics"/>
<link rel="prev" href="how-the-agent-works.html" title="How the Agent works"/>
<link rel="next" href="api.html" title="API reference"/>
<meta name="DC.type" content="Learn/Docs/APM Python Agent/Reference/5.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="5.x"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Python Agent Reference [5.x]</a></span>
»
<span class="breadcrumb-link"><a href="advanced-topics.html">Advanced Topics</a></span>
»
<span class="breadcrumb-node">Run Tests Locally</span>
</div>
<div class="navheader">
<span class="prev">
<a href="how-the-agent-works.html">« How the Agent works</a>
</span>
<span class="next">
<a href="api.html">API reference »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="run-tests-locally"></a>Run Tests Locally<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/5.x/docs/run-tests-locally.asciidoc">edit</a></h2>
</div></div></div>
<p>To run tests locally you can make use of the docker images also used when running the whole test suite with Jenkins.
Running the full test suite first does some linting and then runs the actual tests with different versions of Python and different web frameworks.
For a full overview of the test matrix and supported versions have a look at
<a href="https://github.com/elastic/apm-agent-python/blob/master/Jenkinsfile" class="ulink" target="_top">Jenkins Configuration</a>.</p>
<h4><a id="pre-commit"></a>Pre Commit<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/5.x/docs/run-tests-locally.asciidoc">edit</a></h4>
<p>We run our git hooks on every commit to automatically point out issues in code. Those issues are also detected within the Jenkins pipeline.
Please follow the installation steps stated in <a href="https://pre-commit.com/#install" class="ulink" target="_top">https://pre-commit.com/#install</a>.</p>
<h4><a id="coder-linter"></a>Code Linter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/5.x/docs/run-tests-locally.asciidoc">edit</a></h4>
<p>We run two code linters <code class="literal">isort</code> and <code class="literal">flake8</code>. You can trigger each single one locally by running:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">$ ./tests/scripts/docker/isort.sh &lt;pip-cache-dir&gt;</pre>
</div>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">$ ./tests/scripts/docker/flake8.sh &lt;pip-cache-dir&gt;</pre>
</div>
<h4><a id="coder-formatter"></a>Code Formatter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/5.x/docs/run-tests-locally.asciidoc">edit</a></h4>
<p>We test that the code is formatted using <code class="literal">black</code>. You can trigger this check by running:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">$ ./tests/scripts/docker/black.sh &lt;pip-cache-dir&gt;</pre>
</div>
<h4><a id="test-documentation"></a>Test Documentation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/5.x/docs/run-tests-locally.asciidoc">edit</a></h4>
<p>We test that the documentation can be generated without errors. You can trigger this check by running:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">$ ./tests/scripts/docker/docs.sh</pre>
</div>
<h4><a id="running-tests"></a>Running Tests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/5.x/docs/run-tests-locally.asciidoc">edit</a></h4>
<p>We run the test suite on different combinations of Python versions and web frameworks. For triggering the test suite for a specific combination locally you can run:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">$ ./tests/scripts/docker/run_tests.sh python-version framework-version &lt;pip-cache-dir&gt;</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">python-version</code> must be of format <code class="literal">python-version</code>, e.g. <code class="literal">python-3.6</code> or <code class="literal">pypy-2</code>.
The <code class="literal">framework</code> must be of format <code class="literal">framework-version</code>, e.g. <code class="literal">django-1.10</code> or <code class="literal">flask-0.12</code>.</p>
</div>
</div>
<p>You can also run the unit tests outside of docker, by installing the relevant
<a href="https://github.com/elastic/apm-agent-python/tree/master/tests/requirements" class="ulink" target="_top">requirements file</a>
and then running <code class="literal">py.test</code> from the project root.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_integration_testing"></a>Integration testing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-python/edit/5.x/docs/run-tests-locally.asciidoc">edit</a></h3>
</div></div></div>
<p>Check out <a href="https://github.com/elastic/apm-integration-testing" class="ulink" target="_top">https://github.com/elastic/apm-integration-testing</a> for resources for
setting up full end-to-end testing environments. For example, to spin up
an environment with the <a href="https://github.com/basepi/opbeans-python" class="ulink" target="_top">opbeans Django app</a>,
with version 7.3 of the elastic stack and the apm-python-agent from your local
checkout, you might do something like this:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">$ ./scripts/compose.py start 7.3 --with-agent-python-django --with-opbeans-python --opbeans-python-agent-local-repo=~/elastic/apm-agent-python</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="how-the-agent-works.html">« How the Agent works</a>
</span>
<span class="next">
<a href="api.html">API reference »</a>
</span>
</div>
</div>
</body>
</html>
