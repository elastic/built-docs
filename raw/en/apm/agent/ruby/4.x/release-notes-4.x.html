<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ruby Agent version 4.x | APM Ruby Agent Reference [4.x] | Elastic</title>
<link rel="home" href="index.html" title="APM Ruby Agent Reference [4.x]"/>
<link rel="up" href="release-notes.html" title="Release notes"/>
<link rel="prev" href="release-notes.html" title="Release notes"/>
<link rel="next" href="release-notes-3.x.html" title="Ruby Agent version 3.x"/>
<meta name="DC.type" content="Learn/Docs/APM Ruby Agent/Reference/4.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="4.x"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
    <div class="related-products-title">APM:</div>
    <div class="dropdown-anchor" tabindex="0">Ruby Agent Reference<span class="dropdown-icon"></span></div>
    <div class="dropdown-content">
      <ul>
        <li class="dropdown-category">APM</li>
        <ul>
          <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
        </ul>
        <li class="dropdown-category">APM agents</li>
        <ul>
          <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
        </ul>
        <li class="dropdown-category">APM extensions</li>
        <ul>
          <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
          <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
        </ul>
      </ul>
    </div>
  </div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="release-notes.html">Release notes</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-3.x.html">Ruby Agent version 3.x »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="release-notes-4.x"></a>Ruby Agent version 4.x<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.2.0"></a>4.2.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_added"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add support for AWS Storage Table/CosmosDB <a href="https://github.com/elastic/apm-agent-ruby/pull/999" class="ulink" target="_top">#999</a>
</li>
</ul>
</div>
<h5><a id="_fixed"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Align HTTP span types/subtypes with spec <a href="https://github.com/elastic/apm-agent-ruby/pull/1014" class="ulink" target="_top">#1014</a>
</li>
<li class="listitem">
Passing a full URL as a path to <code class="literal">Net::HTTP</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/1029" class="ulink" target="_top">#1029</a>
</li>
<li class="listitem">
Fix growing number of open file descriptors <a href="https://github.com/elastic/apm-agent-ruby/pull/1033" class="ulink" target="_top">#1033</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.1.0"></a>4.1.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_added_2"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Azure App Services instance metadata <a href="https://github.com/elastic/apm-agent-ruby/pull/1007" class="ulink" target="_top">#1007</a>
</li>
</ul>
</div>
<h5><a id="_changed"></a>Changed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">hostname</code> is now reported split by <code class="literal">configured_hostname</code> and <code class="literal">detected_hostname</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/1009" class="ulink" target="_top">#1009</a>
</li>
</ul>
</div>
<h5><a id="_fixed_2"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">service_node_name</code> is now correctly reported as <code class="literal">service.node.configured_name</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/1009" class="ulink" target="_top">#1009</a>
</li>
<li class="listitem">
Fix JSON parsing when using yajl-ruby <a href="https://github.com/elastic/apm-agent-ruby/pull/1012" class="ulink" target="_top">#1012</a>
</li>
<li class="listitem">
Fix SpanHelpers when methods take blocks <a href="https://github.com/elastic/apm-agent-ruby/pull/1013" class="ulink" target="_top">#1013</a>
</li>
<li class="listitem">
Fix missing <code class="literal">environment</code> param when fetching from Central Config <a href="https://github.com/elastic/apm-agent-ruby/pull/1014" class="ulink" target="_top">#1014</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-4.0.0"></a>4.0.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_upgrading"></a>Upgrading<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<p>Be aware that this release changes the agent&#8217;s general approach to instrumenting third
party libraries.
It now uses <code class="literal">Module#prepend</code> over alias method chaining.</p>
<p>This doesn&#8217;t necessarily impact your application but it could if you are using other gems
that use the old approach to patch the same method.
Mixing the two approaches can lead to infinite recursion.</p>
<h5><a id="_removed"></a>Removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Removed support for Ruby 2.3 and JRuby 9.1 <a href="https://github.com/elastic/apm-agent-ruby/pull/901" class="ulink" target="_top">#901</a>
</li>
<li class="listitem">
Config option <code class="literal">active</code>, see <code class="literal">enabled</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">custom_key_filters</code>, see <code class="literal">sanitize_field_names</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">default_tags</code>, see <code class="literal">global_labels</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">default_labels</code>, see <code class="literal">global_labels</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">ignore_url_patterns</code>, see <code class="literal">transaction_ignore_urls</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
Config option <code class="literal">use_legacy_sql_parser</code>, legacy parser no longer included <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
</ul>
</div>
<h5><a id="_changed_2"></a>Changed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Integrations (Spies) use Module#prepend over class_eval <a href="https://github.com/elastic/apm-agent-ruby/pull/890" class="ulink" target="_top">#890</a>
</li>
<li class="listitem">
The secrets filter no longer filters based on values, see <code class="literal">sanitize_field_names</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
<li class="listitem">
The secrets filter is aligned with other agents, see <code class="literal">sanitize_field_names</code> <a href="https://github.com/elastic/apm-agent-ruby/pull/900" class="ulink" target="_top">#900</a>
</li>
</ul>
</div>
<h5><a id="_added_3"></a>Added<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Added <code class="literal">set_service</code> API <a href="https://github.com/elastic/apm-agent-ruby/pull/1006" class="ulink" target="_top">#1006</a>
</li>
</ul>
</div>
<h5><a id="_fixed_3"></a>Fixed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/4.x/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
AWS S3 spy accepts symbol bucket names <a href="https://github.com/elastic/apm-agent-ruby/pull/998" class="ulink" target="_top">#998</a>
</li>
<li class="listitem">
AWS S3 spy passing on blocks <a href="https://github.com/elastic/apm-agent-ruby/pull/998" class="ulink" target="_top">#998</a>
</li>
<li class="listitem">
SQL scanner now recognizes CQL style comments <a href="https://github.com/elastic/apm-agent-ruby/pull/1004" class="ulink" target="_top">#1004</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-3.x.html">Ruby Agent version 3.x »</a>
</span>
</div>
</div>
</body>
</html>
