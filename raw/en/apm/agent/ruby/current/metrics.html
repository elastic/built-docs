<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Metrics | APM Ruby Agent Reference [4.x] | Elastic</title>
<meta class="elastic" name="content" content="Metrics | APM Ruby Agent Reference [4.x]">

<link rel="home" href="index.html" title="APM Ruby Agent Reference [4.x]"/>
<link rel="up" href="index.html" title="APM Ruby Agent Reference [4.x]"/>
<link rel="prev" href="api.html" title="API reference"/>
<link rel="next" href="opentracing.html" title="OpenTracing API"/>
<meta class="elastic" name="product_version" content="4.x"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Ruby Agent/Reference/4.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="4.x"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="api.html">« API reference</a>
</span>
<span class="next">
<a href="opentracing.html">OpenTracing API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">Ruby Agent Reference<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Metrics</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/apm/agents/ruby/metrics">latest documentation</a>.
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="metrics"></a>Metrics</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
</div></div></div>
<p>The Ruby agent tracks various system and application metrics.
These metrics will be sent regularly to the APM Server and from there to Elasticsearch.
You can adjust the interval by setting <a class="xref" href="configuration.html#config-metrics-interval" title="metrics_interval"><code class="literal">metrics_interval</code></a>.</p>
<p>The metrics will be stored in the <code class="literal">apm-*</code> index and have the <code class="literal">processor.event</code> property set to <code class="literal">metric</code>.</p>
<div class="position-relative"><h3><a id="metrics-system"></a>System metrics</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<p><span class="strong strong"><strong>Note:</strong></span> Metrics from the Ruby agent are Linux only for now.</p>
<div class="position-relative"><h4><a id="metric-system.cpu.total.norm.pct"></a><code class="literal">system.cpu.total.norm.pct</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Float
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Percent
</li>
</ul>
</div>
<p>The percentage of CPU time in states other than Idle and IOWait,
normalised by the number of cores.</p>
<div class="position-relative"><h4><a id="metric-system.memory.total"></a><code class="literal">system.memory.total</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The total memory of the system in bytes.</p>
<div class="position-relative"><h4><a id="metric-system.memory.actual.free"></a><code class="literal">system.memory.actual.free</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>Free memory of the system in bytes.</p>
<div class="position-relative"><h4><a id="metric-system.process.cpu.total.norm.pct"></a><code class="literal">system.process.cpu.total.norm.pct</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Float
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Percent
</li>
</ul>
</div>
<p>The percentage of CPU time spent by the process since the last event.
This value is normalized by the number of CPU cores and it ranges from 0 to 100%.</p>
<div class="position-relative"><h4><a id="metric-system.process.memory.size"></a><code class="literal">system.process.memory.size</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The total virtual memory the process has.</p>
<div class="position-relative"><h4><a id="metric-system.process.memory.rss.bytes"></a><code class="literal">system.process.memory.rss.bytes</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The Resident Set Size,
the amount of memory the process occupies in main memory (RAM).</p>
<div class="position-relative"><h3><a id="metrics-ruby"></a>Ruby Metrics</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="position-relative"><h4><a id="metric-ruby.gc.counts"></a><code class="literal">ruby.gc.count</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Integer
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Count
</li>
</ul>
</div>
<p>The number of Garbage Collection runs since the process started.</p>
<div class="position-relative"><h4><a id="metric-ruby.threads"></a><code class="literal">ruby.threads</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Integer
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Count
</li>
</ul>
</div>
<p>The number of threads belonging to the current process.</p>
<div class="position-relative"><h4><a id="metric-ruby.heap.slots.live"></a><code class="literal">ruby.heap.slots.live</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Integer
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Slots
</li>
</ul>
</div>
<p>Current amount of heap slots that are live.</p>
<p><span class="strong strong"><strong>NB:</strong></span> Not currently supported on JRuby.</p>
<div class="position-relative"><h4><a id="metric-ruby.heap.slots.free"></a><code class="literal">ruby.heap.slots.free</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Integer
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Slots
</li>
</ul>
</div>
<p>Current amount of heap slots that are free.</p>
<p><span class="strong strong"><strong>NB:</strong></span> Not currently supported on JRuby.</p>
<div class="position-relative"><h4><a id="metrics-ruby.heap.allocations.total"></a><code class="literal">ruby.heap.allocations.total</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Integer
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Objects
</li>
</ul>
</div>
<p>Current amount of allocated objects on the heap.</p>
<p><span class="strong strong"><strong>NB:</strong></span> Not currently supported on JRuby.</p>
<div class="position-relative"><h4><a id="metrics-ruby.gc.time"></a><code class="literal">ruby.gc.time</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Float
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Seconds
</li>
</ul>
</div>
<p>The total time spent in garbage collection.</p>
<p><span class="strong strong"><strong>NB:</strong></span> You need to enable Ruby&#8217;s GC Profiler for this to get reported.
You can do this at any time when your application boots by calling <code class="literal">GC::Profiler.enable</code>.</p>
<div class="position-relative"><h3><a id="metrics-jvm-metrics"></a>JVM Metrics</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<p>The following metrics are available when using JRuby. They use the ruby java API to gather metrics via MXBean.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.heap.used"></a><code class="literal">jvm.memory.heap.used</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The amount of used heap memory in bytes.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.heap.committed"></a><code class="literal">jvm.memory.heap.committed</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The amount of heap memory in bytes that is committed for the Java virtual machine to use. This amount of memory is
guaranteed for the Java virtual machine to use.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.heap.max"></a><code class="literal">jvm.memory.heap.max</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The amount of heap memory in bytes that is committed for the Java virtual machine to use. This amount of memory is
guaranteed for the Java virtual machine to use.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.non_heap.used"></a><code class="literal">jvm.memory.non_heap.used</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The amount of used non-heap memory in bytes.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.non_heap.committed"></a><code class="literal">jvm.memory.non_heap.committed</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The amount of non-heap memory in bytes that is committed for the Java virtual machine to use. This amount of memory is
guaranteed for the Java virtual machine to use.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.non_heap.max"></a><code class="literal">jvm.memory.non_heap.max</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The maximum amount of non-heap memory in bytes that can be used for memory management. If the maximum memory size is
undefined, the value is -1.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.heap.pool.used"></a><code class="literal">jvm.memory.heap.pool.used</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The amount of used memory in bytes of the memory pool.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.heap.pool.committed"></a><code class="literal">jvm.memory.heap.pool.committed</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The amount of memory in bytes that is committed for the memory pool. This amount of memory is guaranteed for this
specific pool.</p>
<div class="position-relative"><h4><a id="metric-jvm.memory.heap.pool.max"></a><code class="literal">jvm.memory.heap.pool.max</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ruby/edit/do-not-delete_legacy-docs/docs/metrics.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Long
</li>
<li class="listitem">
<span class="strong strong"><strong>Format:</strong></span> Bytes
</li>
</ul>
</div>
<p>The maximum amount of memory in bytes that can be used for the memory pool.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="api.html">« API reference</a>
</span>
<span class="next">
<a href="opentracing.html">OpenTracing API »</a>
</span>
</div>
</body>
</html>
