<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Set up the Agent | APM iOS Agent Reference [0.x] | Elastic</title>
<meta class="elastic" name="content" content="Set up the Agent | APM iOS Agent Reference [0.x]">

<link rel="home" href="index.html" title="APM iOS Agent Reference [0.x]"/>
<link rel="up" href="index.html" title="APM iOS Agent Reference [0.x]"/>
<link rel="prev" href="supported-technologies.html" title="Supported technologies"/>
<link rel="next" href="configuration.html" title="Configuration"/>
<meta class="elastic" name="product_version" content="0.x"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM iOS Agent/Reference/0.x"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="0.x"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
This project is still in development; do not use it in a production environment.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
    <div class="related-products-title">APM:</div>
    <div class="dropdown-anchor" tabindex="0">iOS Agent Reference<span class="dropdown-icon"></span></div>
    <div class="dropdown-content">
      <ul>
        <li class="dropdown-category">APM</li>
        <ul>
          <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
        </ul>
        <li class="dropdown-category">APM agents</li>
        <ul>
          <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
        </ul>
        <li class="dropdown-category">APM extensions</li>
        <ul>
          <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
          <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
        </ul>
      </ul>
    </div>
  </div>
</span>
</div>
<div class="navheader">
<span class="prev">
<a href="supported-technologies.html">« Supported technologies</a>
</span>
<span class="next">
<a href="configuration.html">Configuration »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="setup"></a>Set up the Agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h1>
</div></div></div>
<h3><a id="requirements"></a>Requirements<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h3>
<p>This project requires Swift <code class="literal">5.7</code>, and is intended for use in Swift-base mobile apps.</p>
<p>Other platform requires:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">platform</th>
<th align="left" valign="top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">iOS</code></p></td>
<td align="left" valign="top"><p><code class="literal">11</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">macOS</code></p></td>
<td align="left" valign="top"><p><code class="literal">10.13</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">tvOS</code></p></td>
<td align="left" valign="top"><p><code class="literal">v11</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">watchOS</code></p></td>
<td align="left" valign="top"><p><code class="literal">3</code></p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="add-agent-dependency"></a>Add the Agent dependency<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h3>
<p>Add the Elastic APM iOS Agent to your Xcode project or your <code class="literal">Package.swift</code>.</p>
<p>Here are instructions for adding a <a href="https://developer.apple.com/documentation/swift_packages/adding_package_dependencies_to_your_app" class="ulink" target="_top">package dependency</a> to a standard Xcode poject.</p>
<p>Details of adding dependencies to your Package.swift can be found on <a href="https://developer.apple.com/documentation/xcode/creating_a_standalone_swift_package_with_xcode#3578941" class="ulink" target="_top"><em>Add a Dependency on Another Swift Package</em></a>.
Below is a helpful code-snippet:</p>
<p><code class="literal">package.swift</code>:</p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">Package(
    dependencies:[
         .package(name: "apm-agent-ios", url: "https://github.com/elastic/apm-agent-ios.git", from: "0.4.1"),
    ],
  targets:[
    .target(
        name: "MyApp",
        dependencies: [
            .product(name: "iOSAgent", package: "apm-agent-ios")
        ]
    ),
])</pre>
</div>
<h3><a id="initialize"></a>Initialize the agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h3>
<p>Once the Agent has been added as a dependency, it must be initialized.</p>
<p>If you&#8217;re using <code class="literal">SwiftUI</code> to build your app add the following to your <code class="literal">App.swift</code>:</p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">import SwiftUI
import iOSAgent

@main
struct MyApp: App {
    init() {
        var config = AgentConfigBuilder()
                       .withServerUrl(URL(string:"http://127.0.0.1:8200")) <a id="CO1-1"></a><i class="conum" data-value="1"></i>
                       .withSecretToken("&lt;SecretToken&gt;") <a id="CO1-2"></a><i class="conum" data-value="2"></i>

        Agent.start(with: config)
    }
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>APM Server URL</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set secret token for APM server connection</p>
</td>
</tr>
</table>
</div>
<p>If you&#8217;re not using <code class="literal">SwiftUI</code> you can alternatively add the same thing to your AppDelegate file:</p>
<p><code class="literal">AppDelegate.swift</code></p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">import UIKit
import iOSAgent
@main
class AppDelegate: UIResponder, UIApplicationDelegate {
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
var config = AgentConfigBuilder()
                       .withServerUrl(URL(string:"http://127.0.0.1:8200")) <a id="CO2-1"></a><i class="conum" data-value="1"></i>
                       .withSecretToken("&lt;SecretToken&gt;") <a id="CO2-2"></a><i class="conum" data-value="2"></i>

        Agent.start(with: config)
        return true
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO2-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>APM Server URL</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO2-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set secret token for APM server connection</p>
</td>
</tr>
</table>
</div>
<h3><a id="instrumentation-config"></a>Instrumentation Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h3>
<p>An optional parameter for configuring instrumentation is also available on <code class="literal">Agent.start</code>:</p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">    ...

    let instrumentationConfig = InstrumentationConfigBuilder()
                                         .withCrashReporting(true)
                                         .build()

    Agent.start(with: config, instrumentationConfig)</pre>
</div>
<h4><a id="config-opts"></a>Configuration Options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h4>
<h5><a id="with-crash-reporting"></a><code class="literal">withCrashReporting(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> true
</li>
</ul>
</div>
<p>Toggle for crash reporting. Enabled by default. Since only one crash reporter can be set in iOS, this allows for 3rd party crash reporter preference without conflict.</p>
<h5><a id="with-app-metrics"></a><code class="literal">withAppMetricInstrumentation(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> true
</li>
</ul>
</div>
<p>Toggles AppMetric instrumentation.</p>
<h5><a id="with-url-session-instrumentation"></a><code class="literal">withURLSessionInstrumentation(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> true
</li>
</ul>
</div>
<p>Toggles network instrumentation.</p>
<h5><a id="with-view-controller-instrumentation"></a><code class="literal">withViewControllerInstrumentation(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> true
</li>
</ul>
</div>
<p>Toggles view controller instrumentation.</p>
<h5><a id="with-System-Metrics"></a><code class="literal">withSystemMetrics(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> true
</li>
</ul>
</div>
<p>Toggles metric generation for memory and cpu usage.</p>
<h3><a id="view-instrumentation"></a>View instrumentation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h3>
<p>The agent provides SwiftUI.View and UIViewController instrumentation, where the load time of a View is measured using spans.
All Views simultaneously loaded will be grouped under the same starting span.
The spans' names will be dictated by the following rules, from least to highest precedence:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<code class="literal">&lt;view's class name&gt; - view appearing</code>
</li>
<li class="listitem">
<code class="literal">&lt;navigation title&gt; - view appearing</code>
</li>
<li class="listitem">
The <code class="literal">name</code> passed to View extension method  <code class="literal">reportName(_ name: String) -&gt; View</code>
</li>
</ol>
</div>
<p>The View&#8217;s class name will be a swift name-mangled string, and is the least desirable naming method. If it&#8217;s possible, set a navigation title on your views:</p>
<p><code class="literal">AllProductsList.swift</code></p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">struct AllProductsList: View {
    @EnvironmentObject var modelData : ModelData

    var body: some View {
        VStack {
            List(modelData.products, id: \.id) { product in
                AdminProductRow(product: product)

            }
        }.onAppear  {
            modelData.loadProducts()
        }.navigationTitle("All Products")
    }
}</pre>
</div>
<p>You&#8217;ll see "All Products - view appearing" in Kibana.</p>
<p>If it isn&#8217;t possible to set a navigation title, use <code class="literal">reportName(_ name: String) -&gt; View</code> to set the name that will show in Kibana:</p>
<p><code class="literal">AllProductsList.swift</code></p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">struct AllProductsList: View {
    @EnvironmentObject var modelData : ModelData

    var body: some View {
        VStack {
            List(modelData.products, id: \.id) { product in
                AdminProductRow(product: product)

            }
        }.onAppear  {
            modelData.loadProducts()
        }.reportName("All Products - view appearing")
    }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The entire string <code class="literal">All Products - view appearing</code> must be inserted to match the default formatting used for the other two naming options.</p>
</div>
</div>
<h3><a id="metrickit-instrumentation"></a>MetricKit Instrumentation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h3>
<p>Available for iOS 13 and greater, the agent provides instrumentation of key MetricKit data points:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Application Launch times
</li>
<li class="listitem">
Application responsiveness
</li>
<li class="listitem">
Application exit counts
</li>
</ul>
</div>
<p>Technical details on the metric generated can be found in the <a href="https://github.com/elastic/apm/blob/main/specs/agents/mobile/metrics.md#application-metrics" class="ulink" target="_top">Mobile spec</a></p>
<h4><a id="app-launch-time"></a><code class="literal">application.launch.time</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h4>
<p>This histogram metric provides launch duration broken down by <code class="literal">first draw</code>, <code class="literal">first draw (optimized)</code>, and <code class="literal">resumed</code>. More details about the MetricKit data point can be found in the <a href="https://developer.apple.com/documentation/metrickit/mxapplaunchmetric" class="ulink" target="_top">Apple documentation</a>.</p>
<h4><a id="hangtime"></a><code class="literal">application.responsiveness.hangtime</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h4>
<p>A histogram of the different durations of time in which the app is too busy to handle user interaction responsively.
More details about the MetricKit data point can be found in the <a href="https://developer.apple.com/documentation/metrickit/mxappresponsivenessmetric" class="ulink" target="_top">Apple documentation</a>.</p>
<h4><a id="exits"></a><code class="literal">application.exits</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/0.x/docs/setup.asciidoc">edit</a></h4>
<p>A count of application exits categorized by various attributes: <code class="literal">foreground</code> or <code class="literal">background</code>, and <code class="literal">normal</code> or abnormal, where abnormal exits are further subdivided.
More details can be found in the <a href="https://developer.apple.com/documentation/metrickit/mxappexitmetric" class="ulink" target="_top">Apple documentation</a>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="supported-technologies.html">« Supported technologies</a>
</span>
<span class="next">
<a href="configuration.html">Configuration »</a>
</span>
</div>
</div>
</body>
</html>
