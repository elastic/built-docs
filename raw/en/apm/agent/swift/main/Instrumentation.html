<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Instrumentation | APM iOS Agent Reference [main] | Elastic</title>
<meta class="elastic" name="content" content="Instrumentation | APM iOS Agent Reference [main]">

<link rel="home" href="index.html" title="APM iOS Agent Reference [main]"/>
<link rel="up" href="index.html" title="APM iOS Agent Reference [main]"/>
<link rel="prev" href="configuration.html" title="Configuration"/>
<link rel="next" href="troubleshooting.html" title="Troubleshooting"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM iOS Agent/Reference/main"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="main"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="configuration.html">« Configuration</a>
</span>
<span class="next">
<a href="troubleshooting.html">Troubleshooting »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">iOS Agent Reference<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Instrumentation</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="Instrumentation"></a>Instrumentation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h2>
</div></div></div>
<p>This document enumerates the various instrumentation provided with the apm-agent-ios sdk. These instrumentations can be
configured as described in <a class="xref" href="configuration.html#instrumentationConfiguration" title="Instrumentation configuration">instrumentation configuration</a>.</p>
<h3><a id="crash-reporting"></a>Crash reporting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h3>
<p>The agent will automatically capture and upload crashes to the apm server. These crashes will be stored in the format as described in the <a href="https://github.com/elastic/apm/blob/main/specs/agents/mobile/events.md#crashes" class="ulink" target="_top">mobile agent event spec</a>.</p>
<h3><a id="urlsession-instrumentation"></a>URLSession instrumentation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h3>
<p>URLSession instrumentation is provided by the Open Telemetry Swift sdk, and will automatically generate traces for all network requests generated with URLSessions. More details can be found in the <a href="https://github.com/open-telemetry/opentelemetry-swift/tree/main/Sources/Instrumentation/URLSession" class="ulink" target="_top">URL Session instrumentation Open Telemetry documentation</a></p>
<h3><a id="view-instrumentation"></a>View instrumentation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h3>
<p>The agent provides SwiftUI.View and UIViewController instrumentation, where the load time of a View is measured using spans.
All Views simultaneously loaded will be grouped under the same starting span.
The spans' names will be dictated by the following rules, from least to highest precedence:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<code class="literal">&lt;view's class name&gt; - view appearing</code>
</li>
<li class="listitem">
<code class="literal">&lt;navigation title&gt; - view appearing</code>
</li>
<li class="listitem">
The <code class="literal">name</code> passed to View extension method  <code class="literal">reportName(_ name: String) -&gt; View</code>
</li>
</ol>
</div>
<p>The View&#8217;s class name will be a swift name-mangled string, and is the least desirable naming method. If it&#8217;s possible, set a navigation title on your views:</p>
<p><code class="literal">AllProductsList.swift</code></p>
<div class="pre_wrapper lang-swift">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-swift">struct AllProductsList: View {
    @EnvironmentObject var modelData : ModelData

    var body: some View {
        VStack {
            List(modelData.products, id: \.id) { product in
                AdminProductRow(product: product)

            }
        }.onAppear  {
            modelData.loadProducts()
        }.navigationTitle("All Products")
    }
}</pre>
</div>
<p>You&#8217;ll see "All Products - view appearing" in Kibana.</p>
<p>If it isn&#8217;t possible to set a navigation title, use <code class="literal">reportName(_ name: String) -&gt; View</code> to set the name that will show in Kibana:</p>
<p><code class="literal">AllProductsList.swift</code></p>
<div class="pre_wrapper lang-swift">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-swift">struct AllProductsList: View {
    @EnvironmentObject var modelData : ModelData

    var body: some View {
        VStack {
            List(modelData.products, id: \.id) { product in
                AdminProductRow(product: product)

            }
        }.onAppear  {
            modelData.loadProducts()
        }.reportName("All Products - view appearing")
    }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The entire string <code class="literal">All Products - view appearing</code> must be inserted to match the default formatting used for the other two naming options.</p>
</div>
</div>
<h3><a id="system-metrics"></a>System metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h3>
<p>System-metric instrumentation records cpu and memory usage minutely as metrics.
Cpu metrics are recorded as <code class="literal">system.cpu.usage</code> and memory usage is recorded as <code class="literal">system.memory.usage</code>.</p>
<h3><a id="metrickit-instrumentation"></a>MetricKit instrumentation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h3>
<p>Available for iOS 13 and greater, the agent provides instrumentation of key MetricKit data points:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Application Launch times
</li>
<li class="listitem">
Application responsiveness
</li>
<li class="listitem">
Application exit counts
</li>
</ul>
</div>
<p>Technical details on the metric generated can be found in the <a href="https://github.com/elastic/apm/blob/main/specs/agents/mobile/metrics.md#application-metrics" class="ulink" target="_top">Mobile spec</a></p>
<h4><a id="app-launch-time"></a><code class="literal">application.launch.time</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h4>
<p>This histogram metric provides launch duration broken down by <code class="literal">first draw</code>, <code class="literal">first draw (optimized)</code>, and <code class="literal">resumed</code>. More details about the MetricKit data point can be found in the <a href="https://developer.apple.com/documentation/metrickit/mxapplaunchmetric" class="ulink" target="_top">Apple documentation</a>.</p>
<h4><a id="hangtime"></a><code class="literal">application.responsiveness.hangtime</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h4>
<p>A histogram of the different durations of time in which the app is too busy to handle user interaction responsively.
More details about the MetricKit data point can be found in the <a href="https://developer.apple.com/documentation/metrickit/mxappresponsivenessmetric" class="ulink" target="_top">Apple documentation</a>.</p>
<h4><a id="exits"></a><code class="literal">application.exits</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h4>
<p>A count of application exits categorized by various attributes: <code class="literal">foreground</code> or <code class="literal">background</code>, and <code class="literal">normal</code> or abnormal, where abnormal exits are further subdivided.
More details can be found in the <a href="https://developer.apple.com/documentation/metrickit/mxappexitmetric" class="ulink" target="_top">Apple documentation</a>.</p>
<h3><a id="app-lifecycle-events"></a>Application lifecycle events<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/instrumentation.asciidoc">edit</a></h3>
<p>In v0.5.0 the application lifecycle events are automatically instrumented.
The technical details can be found in the <a href="https://github.com/elastic/apm/blob/main/specs/agents/mobile/events.md#application-lifecycle-events" class="ulink" target="_top">Mobile spec</a>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="configuration.html">« Configuration</a>
</span>
<span class="next">
<a href="troubleshooting.html">Troubleshooting »</a>
</span>
</div>
</body>
</html>
