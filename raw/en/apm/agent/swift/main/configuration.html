<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configuration | APM iOS Agent Reference [main] | Elastic</title>
<meta class="elastic" name="content" content="Configuration | APM iOS Agent Reference [main]">

<link rel="home" href="index.html" title="APM iOS Agent Reference [main]"/>
<link rel="up" href="index.html" title="APM iOS Agent Reference [main]"/>
<link rel="prev" href="setup.html" title="Set up the Agent"/>
<link rel="next" href="Instrumentation.html" title="Instrumentation"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM iOS Agent/Reference/main"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="main"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="setup.html">« Set up the Agent</a>
</span>
<span class="next">
<a href="Instrumentation.html">Instrumentation »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">iOS Agent Reference<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configuration</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuration"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h2>
</div></div></div>
<p>Configure the agent with <code class="literal">AgentConfigBuilder</code> passing the <code class="literal">AgentConfiguration</code> to the <code class="literal">start</code> function.</p>
<div class="pre_wrapper lang-swift">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-swift">let config = AgentConfigBuilder()
                .withServerUrl(URL(string: "http://localhost:8200"))
                .withSecretToken("&lt;Token&gt;")
                .build()

ElasticApmAgent.start(with:config)</pre>
</div>
<h3><a id="configuration-options"></a>Configuration options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h3>
<p>The <code class="literal">AgentConfigBuilder</code> can be configured with the following functions:</p>
<h4><a id="withServerUrl"></a><code class="literal">withServerUrl</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> URL
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">http://127.0.0.1:8200</code>
</li>
</ul>
</div>
<h4><a id="secretToken"></a><code class="literal">withSecretToken</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> String
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> nil
</li>
<li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">OTEL_EXPORTER_OTLP_HEADERS</code>
</li>
</ul>
</div>
<p>Sets the secret token for connecting to an authenticated APM Server. If using the env-var, the whole header map must be defined per <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/exporter.md" class="ulink" target="_top">OpenTelemetry Protocol Exporter Config</a> (e.g.: <code class="literal">OTEL_EXPORTER_OTLP_HEADERS="Authorization=bearer &lt;secret token&gt;"</code>)</p>
<p>This setting is mutually exclusive with <code class="literal">withApiKey</code></p>
<h4><a id="withApiKey"></a><code class="literal">withApiKey</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> String
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> nil
</li>
<li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">OTEL_EXPORTER_OTLP_HEADERS</code>
</li>
</ul>
</div>
<p>Sets the API Token for connecting to an authenticated APM Server. If using the env-var, the whole header map must be defined per <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/exporter.md" class="ulink" target="_top">OpenTelemetry Protocol Exporter Config</a> (e.g.: <code class="literal">OTEL_EXPORTER_OTLP_HEADERS="Authorization=ApiKey &lt;key&gt;"</code>)</p>
<p>This setting is mutually exclusive with <code class="literal">withSecretToken</code></p>
<h5><a id="disableAgent"></a><code class="literal">disableAgent() -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h5>
<p>Disables the Elastic agent. This is useful for disabling the agent during development without having to remove the Elastic agent completely. A log will report <code class="literal">"Elastic APM Agent has been disabled."</code></p>
<h4><a id="addSpanFilter"></a><code class="literal">addSpanFilter</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> @escaping (ReadableSpan) &#8594; Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> nil
</li>
</ul>
</div>
<p>Adds an anonymous function that will be executed on each span in the span processor to decide if that span should be sent to the back end.</p>
<h4><a id="addMetricFilter"></a><code class="literal">addMetricFilter</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> @escaping (Metric) &#8594; Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> nil
</li>
</ul>
</div>
<p>Adds an anonymous function that will be executed on each metric in the span processor to decide if that metric should be sent to the back end.</p>
<h4><a id="addLogFilter"></a><code class="literal">addLogFilter</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> @escaping (ReadableLogRecord) &#8594; Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> nil
</li>
</ul>
</div>
<p>Adds an anonymous function that will be executed on each log in the span processor to decide if that log should be sent to the back end.</p>
<h2><a id="instrumentationConfiguration"></a>Instrumentation configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h2>
<p>The <code class="literal">ElasticApmAgent.start</code> provides an additional optional parameter for configuring instrumentation.
In the below example, an instrumentation configuration is passed to <code class="literal">Agent.start</code> with default values.
This is equivalent to calling <code class="literal">ElasticApmAgent.start</code> with no instrumentation configuration passed.</p>
<div class="pre_wrapper lang-swift">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-swift">let config = ...

let instrumentationConfig = InstrumentationConfigBuilder().build()

ElasticApmAgent.start(with:config, instrumentationConfig)</pre>
</div>
<h3><a id="instrumentationConfigOptions"></a>Instrumentation config options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h3>
<p><code class="literal">InstrumentationConfigBuilder</code> can be configured with the following functions.</p>
<h4><a id="withCrashReporting"></a><code class="literal">withCrashReporting(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li>
</ul>
</div>
<p>This option can be used to enable/disable the crash reporting functionality of the agent.</p>
<h4><a id="withURLSessionInstrumentation"></a><code class="literal">withURLSessionInstrumentation(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li>
</ul>
</div>
<p>This option can be used to enable/disable the network tracing instrumentation.</p>
<h4><a id="withViewControllerInstrumentation"></a><code class="literal">withViewControllerInstrumentation(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li>
</ul>
</div>
<p>This option can be used to enable/disable the view controller tracing instrumentation.</p>
<h4><a id="withAppMetricInstrumentation"></a><code class="literal">withAppMetricInstrumentation(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li>
</ul>
</div>
<p>This option can be used to enable/disable <a href="https://developer.apple.com/documentation/metrickit" class="ulink" target="_top">MetricKit</a> instrumentation.</p>
<h4><a id="withSystemMetrics"></a><code class="literal">withSystemMetrics(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li>
</ul>
</div>
<p>This option can be used to enable/disable systems metrics instrumentation (CPU &amp; memory usage).</p>
<h4><a id="withLifecycleEvents"></a><code class="literal">withLifecycleEvents(_ enable: Bool) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Bool
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li>
</ul>
</div>
<p>This option can be used to enable/disable lifecycle events.</p>
<h4><a id="withPersistentStorageConfiguration"></a><code class="literal">withPersistentStorageConfiguration(_ config: PersistencePerformancePreset) -&gt; Self</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> <code class="literal">PersistencePerformancePreset</code>
</li>
<li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">.lowRuntimeImpact</code>
</li>
</ul>
</div>
<p>This option can be used to configure the behavior of the <a href="https://github.com/open-telemetry/opentelemetry-swift/tree/main/Sources/Exporters/Persistence" class="ulink" target="_top">persistent stores</a> for traces, metrics, and logs.</p>
<h2><a id="resourceAttributeInjection"></a>Resource attribute injection<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h2>
<p>In v0.5.0, the agent provides a means to set <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/resource/sdk.md#specifying-resource-information-via-an-environment-variable" class="ulink" target="_top">resource attributes</a> using the <code class="literal">OTEL_RESOURCE_ATTRIBUTES</code> env-var. This env-var also works through the application plist. Any resource attribute  can be overridden using this method, so care should be taken, as some attributes are critical to the functioning of the kibana UI.</p>
<h3><a id="deplyoment-environment"></a><code class="literal">deployment.environment</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h3>
<p>Deployment environment is set to <code class="literal">default</code>. This can be overridden using the <code class="literal">OTEL_RESOURCE_ATTRIBUTES</code> set in your deployment&#8217;s plist. Use the field key as <code class="literal">OTEL_RESOURCE_ATTRIBUTES</code> and the value as <code class="literal">deployment.environment=staging</code></p>
<h3><a id="dynamic-configuration"></a>Dynamic configuration <span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h3>
<p>Dynamic configurations are available through the kibana UI and are read by the agent remotely to apply configuration on all active agents deployed in the field. More info on dynamic configurations can be found in  <a href="/guide/en/kibana/8.15/agent-configuration.html" class="ulink" target="_top">agent configurations</a>.</p>
<h4><a id="recording"></a>Recording<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>A boolean specifying if the agent should be recording or not. When recording, the agent instruments incoming HTTP requests, tracks errors and collects and sends metrics. When not recording, the agent works as a noop, not collecting data and not communicating with the APM sever, except for polling the central configuration endpoint. As this is a reversible switch, agent threads are not being killed when inactivated, but they will be mostly idle in this state, so the overhead should be negligible.</p>
<p>You can set this setting to dynamically disable Elastic APM at runtime</p>
<p><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p>Boolean</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="session-sample-rate"></a>Session sample rate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-ios/edit/main/docs/configuration.asciidoc">edit</a></h4>
<p>A double specifying the likelihood all data generated during a session should be recorded on a specific device. Value may range between 0 and 1. 1 meaning 100% likely, and 0 meaning 0% likely. Everytime a new session starts, this value will be checked against a random number between 0 and 1, and will sample all data recorded in that session of the random number is below the session sample rate set.</p>
<p>This session focused sampling technique is to preserve related data points, as opposed to sampling signal by signal, where valuable context can be lost.</p>
<p>You can set this value dynamically at runtime.</p>
<p><span class="image"><img src="./images/dynamic-config.svg" alt="dynamic config"></span></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">1.0</code></p></td>
<td align="left" valign="top"><p>Double</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="setup.html">« Set up the Agent</a>
</span>
<span class="next">
<a href="Instrumentation.html">Instrumentation »</a>
</span>
</div>
</body>
</html>
