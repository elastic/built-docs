<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Grant access using API keys | APM User Guide [8.2] | Elastic</title>
<meta class="elastic" name="content" content="Grant access using API keys | APM User Guide [8.2]">

<link rel="home" href="index.html" title="APM User Guide [8.2]"/>
<link rel="up" href="securing-apm-server.html" title="Secure APM Server"/>
<link rel="prev" href="more-security-roles.html" title="Additional APM users and roles"/>
<link rel="next" href="secure-communication-agents.html" title="Secure communication with APM agents"/>
<meta class="elastic" name="product_version" content="8.2"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.2"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.2"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="more-security-roles.html">« Additional APM users and roles</a>
</span>
<span class="next">
<a href="secure-communication-agents.html">Secure communication with APM agents »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="overview.html">Legacy APM Server Reference</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="securing-apm-server.html">Secure APM Server</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Grant access using API keys</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/api-keys.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="beats-api-keys"></a>Grant access using API keys</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/api-keys.asciidoc">edit</a></div>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This documentation refers to configuring the standalone (legacy) APM Server. This method of running APM Server will be deprecated and removed in a future release. Please consider <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">upgrading to Fleet and the APM integration</a>.
If you&#8217;ve already upgraded, see <a class="xref" href="api-key.html" title="API keys">API keys</a>.</p>
</div>
</div>
<p>Instead of using usernames and passwords, you can use API keys to grant
access to Elasticsearch resources. You can set API keys to expire at a certain time,
and you can explicitly invalidate them. Any user with the <code class="literal">manage_api_key</code>
or <code class="literal">manage_own_api_key</code> cluster privilege can create API keys.</p>
<p>APM Server instances typically send both collected data and monitoring
information to Elasticsearch. If you are sending both to the same cluster, you can use the same
API key. For different clusters, you need to use an API key per cluster.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For security reasons, we recommend using a unique API key per APM Server instance.
You can create as many API keys per user as necessary.</p>
</div>
</div>
<div class="position-relative"><h4><a id="beats-api-key-publish"></a>Create an API key for writing events</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/api-keys.asciidoc">edit</a></div>
<p>In Kibana, navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>API keys</strong></span> and click <span class="strong strong"><strong>Create API key</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/server-api-key-create.png" alt="API key creation">
</div>
</div>
<p>Enter a name for your API key and select <span class="strong strong"><strong>Restrict privileges</strong></span>.
In the role descriptors box, assign the appropriate privileges to the new API key. For example:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "apm_writer": {
        "index": [
            {
                "names": ["apm-*"],
                "privileges": ["create_index", "create_doc"]
            },
            {
                "names": ["apm-*sourcemap"],
                "privileges": ["read"]
            },
      ]
    }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This example only provides privileges for <span class="strong strong"><strong>writing data</strong></span>.
See <a class="xref" href="feature-roles.html" title="Grant users access to secured resources">Grant users access to secured resources</a> for additional privileges and information.</p>
</div>
</div>
<p>To set an expiration date for the API key, select <span class="strong strong"><strong>Expire after time</strong></span>
and input the lifetime of the API key in days.</p>
<p>Click <span class="strong strong"><strong>Create API key</strong></span>. In the dropdown, switch to <span class="strong strong"><strong>Beats</strong></span> and copy the API key.</p>
<p>You can now use this API key in your <code class="literal">apm-server.yml</code> configuration file:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">output.elasticsearch:
  api_key: TiNAGG4BaaMdaH1tRfuU:KnR6yE41RrSowb0kQ0HWoA <a id="CO65-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO65-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Format is <code class="literal">id:api_key</code> (as shown in the Beats dropdown)</p>
</td>
</tr>
</table>
</div>
<div class="position-relative"><h4><a id="beats-api-key-monitor"></a>Create an API key for monitoring</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/api-keys.asciidoc">edit</a></div>
<p>In Kibana, navigate to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>API keys</strong></span> and click <span class="strong strong"><strong>Create API key</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/server-api-key-create.png" alt="API key creation">
</div>
</div>
<p>Enter a name for your API key and select <span class="strong strong"><strong>Restrict privileges</strong></span>.
In the role descriptors box, assign the appropriate privileges to the new API key.
For example:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "apm_monitoring": {
        "index": [
            {
                "names": [".monitoring-beats-*"],
                "privileges": ["create_index", "create_doc"]
            }
      ]
    }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This example only provides privileges for <span class="strong strong"><strong>publishing monitoring data</strong></span>.
See <a class="xref" href="feature-roles.html" title="Grant users access to secured resources">Grant users access to secured resources</a> for additional privileges and information.</p>
</div>
</div>
<p>To set an expiration date for the API key, select <span class="strong strong"><strong>Expire after time</strong></span>
and input the lifetime of the API key in days.</p>
<p>Click <span class="strong strong"><strong>Create API key</strong></span>. In the dropdown, switch to <span class="strong strong"><strong>Beats</strong></span> and copy the API key.</p>
<p>You can now use this API key in your <code class="literal">apm-server.yml</code> configuration file like this:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">monitoring.elasticsearch:
  api_key: TiNAGG4BaaMdaH1tRfuU:KnR6yE41RrSowb0kQ0HWoA <a id="CO66-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO66-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Format is <code class="literal">id:api_key</code> (as shown in the Beats dropdown)</p>
</td>
</tr>
</table>
</div>
<div class="position-relative"><h4><a id="beats-api-key-es"></a>Create an API key with Elasticsearch APIs</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/api-keys.asciidoc">edit</a></div>
<p>You can also use Elasticsearch&#8217;s <a href="/guide/en/elasticsearch/reference/8.2/security-api-create-api-key.html" class="ulink" target="_top">Create API key API</a> to create a new API key.
For example:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_security/api_key
{
  "name": "apm_host001", <a id="CO67-1"></a><i class="conum" data-value="1"></i>
  "role_descriptors": {
    "apm_writer": { <a id="CO67-2"></a><i class="conum" data-value="2"></i>
      "index": [
        {
          "names": ["apm-*"],
          "privileges": ["create_index", "create_doc"]
        },
        {
          "names": ["apm-*sourcemap"],
          "privileges": ["read"]
        },
      ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/17.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO67-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Name of the API key</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO67-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Granted privileges, see <a class="xref" href="feature-roles.html" title="Grant users access to secured resources">Grant users access to secured resources</a></p>
</td>
</tr>
</table>
</div>
<p>See the <a href="/guide/en/elasticsearch/reference/8.2/security-api-create-api-key.html" class="ulink" target="_top">Create API key</a> reference for more information.</p>
<div class="position-relative"><h4><a id="learn-more-api-keys"></a>Learn more about API keys</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/api-keys.asciidoc">edit</a></div>
<p>See the Elasticsearch API key documentation for more information:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.2/security-api-create-api-key.html" class="ulink" target="_top">Create API key</a>
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.2/security-api-get-api-key.html" class="ulink" target="_top">Get API key information</a>
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.2/security-api-invalidate-api-key.html" class="ulink" target="_top">Invalidate API key</a>
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="more-security-roles.html">« Additional APM users and roles</a>
</span>
<span class="next">
<a href="secure-communication-agents.html">Secure communication with APM agents »</a>
</span>
</div>
</body>
</html>
