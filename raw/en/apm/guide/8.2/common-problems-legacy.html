<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Common problems | APM User Guide [8.2] | Elastic</title>
<meta class="elastic" name="content" content="Common problems | APM User Guide [8.2]">

<link rel="home" href="index.html" title="APM User Guide [8.2]"/>
<link rel="up" href="troubleshooting.html" title="Troubleshoot"/>
<link rel="prev" href="troubleshooting.html" title="Troubleshoot"/>
<link rel="next" href="enable-apm-server-debugging.html" title="Debug"/>
<meta class="elastic" name="product_version" content="8.2"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.2"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.2"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="troubleshooting.html">« Troubleshoot</a>
</span>
<span class="next">
<a href="enable-apm-server-debugging.html">Debug »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="overview.html">Legacy APM Server Reference</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="troubleshooting.html">Troubleshoot</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Common problems</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="common-problems-legacy"></a>Common problems<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h2>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This documentation refers to the standalone (legacy) method of running APM Server. This method of running APM Server will be deprecated and removed in a future release. Please consider <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">upgrading to the Elastic APM integration</a>.</p>
</div>
</div>
<p>This section describes common problems you might encounter with APM Server.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#no-data-indexed-legacy" title="No data is indexed">No data is indexed</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#data-indexed-no-apm-legacy" title="Data is indexed but doesn&#8217;t appear in the APM UI">Data is indexed but doesn&#8217;t appear in the APM UI</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#bad-request-legacy" title="HTTP 400: Data decoding error / Data validation error">HTTP 400: Data decoding error / Data validation error</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#event-too-large-legacy" title="HTTP 400: Event too large">HTTP 400: Event too large</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#unauthorized-legacy" title="HTTP 401: Invalid token">HTTP 401: Invalid token</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#forbidden-legacy" title="HTTP 403: Forbidden request">HTTP 403: Forbidden request</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#request-timed-out-legacy" title="HTTP 503: Request timed out waiting to be processed">HTTP 503: Request timed out waiting to be processed</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#ssl-client-fails-legacy" title="SSL client fails to connect">SSL client fails to connect</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#field-limit-exceeded-legacy" title="Field limit exceeded">Field limit exceeded</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#io-timeout-legacy" title="I/O Timeout">I/O Timeout</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#server-es-down-legacy" title="What happens when APM Server or Elasticsearch is down?">What happens when APM Server or Elasticsearch is down?</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#central-config-troubleshooting-legacy" title="/api/apm/settings/agent-configuration/search errors"><code class="literal">/api/apm/settings/agent-configuration/search</code> errors</a>
</li>
</ul>
</div>
<h4><a id="no-data-indexed-legacy"></a>No data is indexed<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>If no data shows up in Elasticsearch, first check that the APM components are properly connected.</p>
<p>To ensure that APM Server configuration is valid and it can connect to the configured output, Elasticsearch by default,
run the following commands:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server test config
apm-server test output</pre>
</div>
<p>To see if the agent can connect to the APM Server, send requests to the instrumented service and look for lines
containing <code class="literal">[request]</code> in the APM Server logs.</p>
<p>If no requests are logged, it might be that SSL is <a class="xref" href="common-problems-legacy.html#ssl-client-fails-legacy" title="SSL client fails to connect">misconfigured</a> or that the host is wrong.
Particularly, if you are using Docker, ensure to bind to the right interface (for example, set
<code class="literal">apm-server.host = 0.0.0.0:8200</code> to match any IP) and set the <code class="literal">SERVER_URL</code> setting in the agent accordingly.</p>
<p>If you see requests coming through the APM Server but they are not accepted (response code other than <code class="literal">202</code>), consider
the response code to narrow down the possible causes (see sections below).</p>
<p>Another reason for data not showing up is that the agent is not auto-instrumenting something you were expecting, check
the <a href="/guide/en/apm/agent/index.html" class="ulink" target="_top">agent documentation</a> for details on what is automatically instrumented.</p>
<p>APM Server currently relies on Elasticsearch to create indices that do not exist.
As a result, Elasticsearch must be configured to allow <a href="/guide/en/elasticsearch/reference/8.2/docs-index_.html#index-creation" class="ulink" target="_top">automatic index creation</a> for APM indices.</p>
<h4><a id="data-indexed-no-apm-legacy"></a>Data is indexed but doesn&#8217;t appear in the APM UI<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>The APM app relies on index mappings to query and display data.
If your APM data isn&#8217;t showing up in the APM app, but is elsewhere in Kibana, like the Discover app,
you may have a missing index mapping.</p>
<p>You can determine if a field was mapped correctly with the <code class="literal">_mapping</code> API.
For example, run the following command in the Kibana <a href="/guide/en/kibana/8.2/console-kibana.html" class="ulink" target="_top">console</a>.
This will display the field data type of the <code class="literal">service.name</code> field.</p>
<div class="pre_wrapper lang-curl">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-curl">GET apm-*/_mapping/field/service.name</pre>
</div>
<p>If the <code class="literal">mapping.name.type</code> is <code class="literal">"text"</code>, your APM indices were not set up correctly.</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">"mappings" : {
   "service.name" : {
      "full_name" : "service.name",
      "mapping" : {
         "name" : {
            "type" : "text", <a id="CO80-1"></a><i class="conum" data-value="1"></i>
            "fields" : {
               "keyword" : {
                  "type" : "keyword",
                  "ignore_above" : 256
               }
            }
         }
      }
   }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO80-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">service.name</code> <code class="literal">mapping.name.type</code> would be <code class="literal">"keyword"</code> if this field had been set up correctly.</p>
</td>
</tr>
</table>
</div>
<p>To fix this problem, you must delete and recreate your APM indices as index templates cannot be applied retroactively.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Stop your APM Server(s) so they are not writing any new documents.
</li>
<li class="listitem">
<p>Delete your existing <code class="literal">apm-*</code> indices.
In the Kibana console, run:</p>
<div class="pre_wrapper lang-curl">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-curl">DELETE apm-*</pre>
</div>
<p>Alternatively, you can use the <a href="/guide/en/elasticsearch/reference/8.2/index-mgmt.html" class="ulink" target="_top">Index Management</a> page in Kibana.
Select all <code class="literal">apm-*</code> index templates and navigate to <span class="strong strong"><strong>Manage Indices</strong></span> &gt; <span class="strong strong"><strong>Delete Indices</strong></span>.</p>
</li>
<li class="listitem">
<p>Starting in version 8.0.0, Fleet uses the APM integration to set up and manage APM index templates.
Install the APM integration by following these steps:</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>An internet connection is required to install the APM integration.
If your environment has network traffic restrictions, there are ways to work around this requirement.
See <a href="/guide/en/fleet/8.2/air-gapped.html" class="ulink" target="_top">Air-gapped environments</a> for more information.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and select <span class="strong strong"><strong>Add integrations</strong></span> &gt; <span class="strong strong"><strong>Elastic APM</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>APM integration</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic APM</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic Agent later</strong></span>. You do not need to run an Elastic Agent to complete the setup.
</li>
</ol>
</div>
</li>
<li class="listitem">
Start APM Server.
</li>
<li class="listitem">
<p>Verify the correct index templates were installed. In the Kibana console, run:</p>
<div class="pre_wrapper lang-curl">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-curl">GET _template/apm-*</pre>
</div>
<p>Alternatively, you can use the <a href="/guide/en/elasticsearch/reference/8.2/index-mgmt.html" class="ulink" target="_top"><span class="strong strong"><strong>Index Management</strong></span></a> page in Kibana.
On the <span class="strong strong"><strong>Index Templates</strong></span> tab, search for <code class="literal">apm</code> under <span class="strong strong"><strong>Legacy Index Templates</strong></span>.</p>
</li>
</ol>
</div>
<h4><a id="bad-request-legacy"></a>HTTP 400: Data decoding error / Data validation error<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>The most likely cause for this error is using incompatible versions of APM agent and APM Server.
See the <a href="/guide/en/apm/guide/8.2/agent-server-compatibility.html" class="ulink" target="_top">agent/server compatibility matrix</a> for more information.</p>
<h4><a id="event-too-large-legacy"></a>HTTP 400: Event too large<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>APM agents communicate with the APM server by sending events in an HTTP request. Each event is sent as its own line in the HTTP request body. If events are too large, you should consider increasing the <a class="xref" href="configuration-process.html#max_event_size" title="max_event_size"><code class="literal">max_event_size</code></a>
setting in the APM Server, and adjusting relevant settings in the agent.</p>
<h4><a id="unauthorized-legacy"></a>HTTP 401: Invalid token<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>The <a class="xref" href="secret-token-legacy.html" title="Secret token">secret token</a> in the request header doesn&#8217;t match the configured in the APM Server.</p>
<h4><a id="forbidden-legacy"></a>HTTP 403: Forbidden request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>Either you are sending requests to a <a class="xref" href="configuration-rum.html" title="Configure Real User Monitoring (RUM)">RUM</a> endpoint without RUM enabled, or a request
is coming from an origin not specified in <code class="literal">apm-server.rum.allow_origins</code>. See the <a class="xref" href="configuration-rum.html" title="Configure Real User Monitoring (RUM)">RUM configuration</a>.</p>
<h4><a id="request-timed-out-legacy"></a>HTTP 503: Request timed out waiting to be processed<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>This happens when APM Server exceeds the maximum number of requests that it can process concurrently.</p>
<p>To alleviate this problem, you can try to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="reduce-storage.html#reduce-sample-rate" title="Reduce the sample rate">Reduce the sample rate</a>
</li>
<li class="listitem">
<a class="xref" href="reduce-storage.html#reduce-stacktrace" title="Reduce collected stack trace information">Reduce collected stack trace information</a>
</li>
<li class="listitem">
<a class="xref" href="tune-apm-server.html#reduce-payload-size" title="Reduce the payload size">Reduce the payload size</a>
</li>
<li class="listitem">
<a class="xref" href="tune-apm-server.html#add-apm-server-instances" title="Add APM Server instances">Add APM Server instances</a>
</li>
</ul>
</div>
<h4><a id="ssl-client-fails-legacy"></a>SSL client fails to connect<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>The target host running might be unreachable or the certificate may not be valid. To resolve your issue:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Make sure that the APM Server process on the target host is running and you can connect to it.
First, try to ping the target host to verify that you can reach it from the host running APM Server.
Then use either <code class="literal">nc</code> or <code class="literal">telnet</code> to make sure that the port is available. For example:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">ping &lt;hostname or IP&gt;
telnet &lt;hostname or IP&gt; 5044</pre>
</div>
</li>
<li class="listitem">
Verify that the certificate is valid and that the hostname and IP match.
</li>
<li class="listitem">
Use OpenSSL to test connectivity to the target server and diagnose problems.
See the <a href="https://www.openssl.org/docs/manmaster/apps/s_client.html" class="ulink" target="_top">OpenSSL documentation</a> for more info.
</li>
</ul>
</div>
<h5><a id="_common_ssl_related_errors_and_resolutions"></a>Common SSL-Related Errors and Resolutions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h5>
<p>Here are some common errors and ways to fix them:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#cannot-validate-certificate-legacy" title="x509: cannot validate certificate for &lt;IP address&gt; because it doesn&#8217;t contain any IP SANs">x509: cannot validate certificate</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#getsockopt-no-route-to-host-legacy" title="getsockopt: no route to host">getsockopt: no route to host</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#getsockopt-connection-refused-legacy" title="getsockopt: connection refused">getsockopt: connection refused</a>
</li>
<li class="listitem">
<a class="xref" href="common-problems-legacy.html#target-machine-refused-connection-legacy" title="No connection could be made because the target machine actively refused it">No connection could be made because the target machine actively refused it</a>
</li>
</ul>
</div>
<h6><a id="cannot-validate-certificate-legacy"></a>x509: cannot validate certificate for &lt;IP address&gt; because it doesn&#8217;t contain any IP SANs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h6>
<p>This happens because your certificate is only valid for the hostname present in the Subject field.</p>
<p>To resolve this problem, try one of these solutions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Create a DNS entry for the hostname, mapping it to the server&#8217;s IP.
</li>
<li class="listitem">
Create an entry in <code class="literal">/etc/hosts</code> for the hostname. Or, on Windows, add an entry to
<code class="literal">C:\Windows\System32\drivers\etc\hosts</code>.
</li>
<li class="listitem">
Re-create the server certificate and add a Subject Alternative Name (SAN) for the IP address of the server. This makes the
server&#8217;s certificate valid for both the hostname and the IP address.
</li>
</ul>
</div>
<h6><a id="getsockopt-no-route-to-host-legacy"></a>getsockopt: no route to host<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h6>
<p>This is not an SSL problem. It&#8217;s a networking problem. Make sure the two hosts can communicate.</p>
<h6><a id="getsockopt-connection-refused-legacy"></a>getsockopt: connection refused<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h6>
<p>This is not an SSL problem. Make sure that Logstash is running and that there is no firewall blocking the traffic.</p>
<h6><a id="target-machine-refused-connection-legacy"></a>No connection could be made because the target machine actively refused it<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h6>
<p>A firewall is refusing the connection. Check if a firewall is blocking the traffic on the client, the network, or the
destination host.</p>
<h4><a id="field-limit-exceeded-legacy"></a>Field limit exceeded<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>When adding too many distinct tag keys on a transaction or span,
you risk creating a <a href="/guide/en/elasticsearch/reference/8.2/mapping.html#mapping-limit-settings" class="ulink" target="_top">mapping explosion</a>.</p>
<p>For example,
you should avoid that user-specified data,
like URL parameters,
is used as a tag key.
Likewise,
using the current timestamp or a user ID as a tag key is not a good idea.
However,
tag <span class="strong strong"><strong>values</strong></span> with a high cardinality are not a problem.
Just try to keep the number of distinct tag keys at a minimum.</p>
<p>The symptom of a mapping explosion is that transactions and spans are not indexed anymore after a certain time.
Usually,
on the next day,
the spans and transactions will be indexed again because a new index is created each day.
But as soon as the field limit is reached,
indexing stops again.</p>
<p>In the agent logs,
you won&#8217;t see a sign of failures as the APM server asynchronously sends the data it received from the agents to Elasticsearch.
However,
the APM server and Elasticsearch log a warning like this:</p>
<div class="pre_wrapper lang-logs">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-logs">{\"type\":\"illegal_argument_exception\",\"reason\":\"Limit of total fields [1000] in index [apm-7.0.0-transaction-2017.05.30] has been exceeded\"}</pre>
</div>
<h4><a id="io-timeout-legacy"></a>I/O Timeout<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>I/O Timeouts can occur when your timeout settings across the stack are not configured correctly,
especially when using a load balancer.</p>
<p>You may see an error like the one below in the agent logs, and/or a similar error on the APM Server side:</p>
<div class="pre_wrapper lang-logs">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-logs">[ElasticAPM] APM Server responded with an error:
"read tcp 123.34.22.313:8200-&gt;123.34.22.40:41602: i/o timeout"</pre>
</div>
<p>To fix this, ensure timeouts are incrementing from the <a href="/guide/en/apm/agent" class="ulink" target="_top">APM agent</a>,
through your load balancer, to the <a class="xref" href="configuration-process.html#read_timeout" title="read_timeout">APM Server</a>.</p>
<p>By default, the agent timeouts are set at 10 seconds, and the server timeout is set at 30 seconds.
Your load balancer should be set somewhere between these numbers.</p>
<p>For example:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">APM agent --&gt; Load Balancer  --&gt; APM Server
   10s            15s               30s</pre>
</div>
<h4><a id="server-es-down-legacy"></a>What happens when APM Server or Elasticsearch is down?<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p><span class="strong strong"><strong>If Elasticsearch is down</strong></span></p>
<p>APM Server does not have an internal queue to buffer requests,
but instead leverages an HTTP request timeout to act as back-pressure.
If Elasticsearch goes down, the APM Server will eventually deny incoming requests.
Both the APM Server and APM agent(s) will issue logs accordingly.</p>
<p><span class="strong strong"><strong>If APM Server is down</strong></span></p>
<p>Some agents have internal queues or buffers that will temporarily store data if the APM Server goes down.
As a general rule of thumb, queues fill up quickly. Assume data will be lost if APM Server goes down.
Adjusting these queues/buffers can increase the agent&#8217;s overhead, so use caution when updating default values.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Go agent</strong></span> - Circular buffer with configurable size:
<a href="/guide/en/apm/agent/go/current/configuration.html#config-api-buffer-size" class="ulink" target="_top"><code class="literal">ELASTIC_APM_BUFFER_SIZE</code></a>.
</li>
<li class="listitem">
<span class="strong strong"><strong>Java agent</strong></span> - Internal buffer with configurable size:
<a href="/guide/en/apm/agent/java/current/config-reporter.html#config-max-queue-size" class="ulink" target="_top"><code class="literal">max_queue_size</code></a>.
</li>
<li class="listitem">
<span class="strong strong"><strong>Node.js agent</strong></span> - No internal queue. Data is lost.
</li>
<li class="listitem">
<span class="strong strong"><strong>PHP agent</strong></span> - No internal queue. Data is lost.
</li>
<li class="listitem">
<span class="strong strong"><strong>Python agent</strong></span> - Internal <a href="/guide/en/apm/agent/python/current/tuning-and-overhead.html#tuning-queue" class="ulink" target="_top">Transaction queue</a>
with configurable size and time between flushes.
</li>
<li class="listitem">
<span class="strong strong"><strong>Ruby agent</strong></span> - Internal queue with configurable size:
<a href="/guide/en/apm/agent/ruby/current/configuration.html#config-api-buffer-size" class="ulink" target="_top"><code class="literal">api_buffer_size</code></a>.
</li>
<li class="listitem">
<span class="strong strong"><strong>RUM agent</strong></span> - No internal queue. Data is lost.
</li>
<li class="listitem">
<span class="strong strong"><strong>.NET agent</strong></span> - No internal queue. Data is lost.
</li>
</ul>
</div>
<h4><a id="central-config-troubleshooting-legacy"></a><code class="literal">/api/apm/settings/agent-configuration/search</code> errors<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.2/docs/en/apm-server/legacy/common-problems.asciidoc">edit</a></h4>
<p>If you&#8217;re instrumenting and starting a lot of services at the same time
or using a very large number of service or environment names,
you may see the following APM Server logs related to APM agent central configuration:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">.../api/apm/settings/agent-configuration/search: context canceled</code>
</li>
<li class="listitem">
<code class="literal">.../api/apm/settings/agent-configuration/search: net/http: TLS handshake timeout</code>
</li>
</ul>
</div>
<p>There are two possible causes:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Kibana is overwhelmed by the number of requests coming from APM Server.
</li>
<li class="listitem">
Elasticsearch can&#8217;t reply quickly enough to Kibana.
</li>
</ol>
</div>
<p>For cause #1, try one or more of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Increase the <a class="xref" href="elasticsearch-output.html" title="Configure the Elasticsearch output"><code class="literal">apm-server.kibana.timeout</code></a> setting.
</li>
<li class="listitem">
Increase the <a class="xref" href="setup-kibana-endpoint.html" title="Configure the Kibana endpoint"><code class="literal">agent.config.cache.expiration</code></a>.
</li>
<li class="listitem">
Increase Kibana&#8217;s resources so that it is able to manage more requests.
</li>
<li class="listitem">
If you&#8217;re not using APM central configuration, disable it with <a class="xref" href="setup-kibana-endpoint.html" title="Configure the Kibana endpoint"><code class="literal">apm-server.kibana.enabled</code></a>.
Central configuration can also be disabled at the APM agent level.
</li>
</ul>
</div>
<p>For cause #2, investigate why Elasticsearch is not responding in a timely manner.
Kibana&#8217;s queries to Elasticsearch are simple, so it may just be that Elasticsearch is unhealthy.
If that&#8217;s not the problem, you may need to use <a href="/guide/en/elasticsearch/reference/8.2/index-modules-slowlog.html" class="ulink" target="_top">Search Slow Log</a> to investigate your Elasticsearch logs.</p>
<p>To avoid this problem entirely,
we recommend <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">upgrading to the Elastic APM integration</a>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="troubleshooting.html">« Troubleshoot</a>
</span>
<span class="next">
<a href="enable-apm-server-debugging.html">Debug »</a>
</span>
</div>
</body>
</html>
