<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>APM agent authorization | APM User Guide [8.9] | Elastic</title>
<meta class="elastic" name="content" content="APM agent authorization | APM User Guide [8.9]">

<link rel="home" href="index.html" title="APM User Guide [8.9]"/>
<link rel="up" href="configuring-howto-apm-server.html" title="Configure"/>
<link rel="prev" href="configuration-anonymous.html" title="Configure anonymous authentication"/>
<link rel="next" href="configure-agent-config.html" title="Configure APM agent configuration"/>
<meta class="elastic" name="product_version" content="8.9"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.9"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.9"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="configuration-anonymous.html">« Configure anonymous authentication</a>
</span>
<span class="next">
<a href="configure-agent-config.html">Configure APM agent configuration »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-apm-server.html">Configure</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>APM agent authorization</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="apm-agent-auth"></a>APM agent authorization</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
</div></div></div>
<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-yes.svg" alt="supported deployment methods"></span></p>
<p>Most options in this section are supported by all APM Server deployment methods.</p>
</div>
<p>Agent authorization APM Server configuration options.</p>
<div class="tabs" data-tab-group="config-apm">
  <div role="tablist" aria-label="Auth">
    <button role="tab"
            aria-selected="true"
            aria-controls="binary-tab"
            id="binary">
      APM Server binary
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="fleet-managed-tab"
            id="fleet-managed"
            tabindex="-1">
      Fleet-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="binary-tab"
       aria-labelledby="binary">
<p><span class="strong strong"><strong>Example config file:</strong></span></p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apm-server:
  host: "localhost:8200"
  rum:
    enabled: true

output:
  elasticsearch:
    hosts: ElasticsearchAddress:9200

max_procs: 4</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="fleet-managed-tab"
       aria-labelledby="fleet-managed"
       hidden="">
<p>Configure and customize Fleet-managed APM settings directly in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and navigate to <span class="strong strong"><strong>Fleet</strong></span>.
</li>
<li class="listitem">
Under the <span class="strong strong"><strong>Agent policies</strong></span> tab, select the policy you would like to configure.
</li>
<li class="listitem">
Find the Elastic APM integration and select <span class="strong strong"><strong>Actions</strong></span> &gt; <span class="strong strong"><strong>Edit integration</strong></span>.
</li>
<li class="listitem">
Look for these settings under <span class="strong strong"><strong>Agent authorization</strong></span>.
</li>
</ol>
</div>
  </div>
</div>
<div class="position-relative"><h3><a id="api-key-auth-settings"></a>API key authentication options</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>These settings apply to API key communication between the APM Server and APM Agents.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>These settings are different from the API key settings used for Elasticsearch output and monitoring.</p>
</div>
</div>
<div class="position-relative"><h4><a id="_api_key_for_agent_authentication"></a>API key for agent authentication</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>Enable API key authorization by setting <code class="literal">enabled</code> to <code class="literal">true</code>.
By default, <code class="literal">enabled</code> is set to <code class="literal">false</code>, and API key support is disabled. (bool)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">auth.api_key.enabled</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">API key for agent authentication</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Not using Elastic APM agents?
When enabled, third-party APM agents must include a valid API key in the following format:
<code class="literal">Authorization: ApiKey &lt;token&gt;</code>. The key must be the base64 encoded representation of the API key&#8217;s <code class="literal">id:name</code>.</p>
</div>
</div>
<div class="position-relative"><h4><a id="_api_key_limit"></a>API key limit</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>Each unique API key triggers one request to Elasticsearch.
This setting restricts the number of unique API keys are allowed per minute.
The minimum value for this setting should be the number of API keys configured in your monitored services.
The default <code class="literal">limit</code> is <code class="literal">100</code>. (int)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">auth.api_key.limit</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Number of keys</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="position-relative"><h4><a id="_secret_token"></a>Secret token</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>Authorization token for sending APM data.
The same token must also be set in each APM agent.
This token is not used for RUM endpoints. (text)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">auth.api_key.token</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Secret token</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="position-relative"><h3><a id="_auth_api_key_elasticsearch_configuration_options"></a><code class="literal">auth.api_key.elasticsearch.*</code> configuration options</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>The below options are only supported by the APM Server binary.</p>
<p>All of the <code class="literal">auth.api_key.elasticsearch.*</code> configurations are optional.
If none are set, configuration settings from the <code class="literal">apm-server.output</code> section will be reused.</p>
</div>
<div class="position-relative"><h4><a id="_elasticsearch_hosts"></a><code class="literal">elasticsearch.hosts</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>API keys are fetched from Elasticsearch.
This configuration needs to point to a secured Elasticsearch cluster that is able to serve API key requests.</p>
<div class="position-relative"><h4><a id="_elasticsearch_protocol"></a><code class="literal">elasticsearch.protocol</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>The name of the protocol Elasticsearch is reachable on.
The options are: <code class="literal">http</code> or <code class="literal">https</code>. The default is <code class="literal">http</code>.
If nothing is configured, configuration settings from the <code class="literal">output</code> section will be reused.</p>
<div class="position-relative"><h4><a id="_elasticsearch_path"></a><code class="literal">elasticsearch.path</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>An optional HTTP path prefix that is prepended to the HTTP API calls.
If nothing is configured, configuration settings from the <code class="literal">output</code> section will be reused.</p>
<div class="position-relative"><h4><a id="_elasticsearch_proxy_url"></a><code class="literal">elasticsearch.proxy_url</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>The URL of the proxy to use when connecting to the Elasticsearch servers.
The value may be either a complete URL or a "host[:port]", in which case the "http"scheme is assumed.
If nothing is configured, configuration settings from the <code class="literal">output</code> section will be reused.</p>
<div class="position-relative"><h4><a id="_elasticsearch_timeout"></a><code class="literal">elasticsearch.timeout</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>The HTTP request timeout in seconds for the Elasticsearch request.
If nothing is configured, configuration settings from the <code class="literal">output</code> section will be reused.</p>
<div class="position-relative"><h3><a id="_auth_api_key_elasticsearch_ssl_configuration_options"></a><code class="literal">auth.api_key.elasticsearch.ssl.*</code> configuration options</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>SSL is off by default. Set <code class="literal">elasticsearch.protocol</code> to <code class="literal">https</code> if you want to enable <code class="literal">https</code>.</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_enabled"></a><code class="literal">elasticsearch.ssl.enabled</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>Enable custom SSL settings.
Set to false to ignore custom SSL settings for secure communication.</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_verification_mode"></a><code class="literal">elasticsearch.ssl.verification_mode</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>Configure SSL verification mode.
If <code class="literal">none</code> is configured, all server hosts and certificates will be accepted.
In this mode, SSL based connections are susceptible to man-in-the-middle attacks.
<span class="strong strong"><strong>Use only for testing</strong></span>. Default is <code class="literal">full</code>.</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_supported_protocols"></a><code class="literal">elasticsearch.ssl.supported_protocols</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>List of supported/valid TLS versions.
By default, all TLS versions from 1.0 to 1.2 are enabled.</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_certificate_authorities"></a><code class="literal">elasticsearch.ssl.certificate_authorities</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>List of root certificates for HTTPS server verifications.</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_certificate"></a><code class="literal">elasticsearch.ssl.certificate</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>The path to the certificate for SSL client authentication.</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_key"></a><code class="literal">elasticsearch.ssl.key</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>The client certificate key used for client authentication.
This option is required if certificate is specified.</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_key_passphrase"></a><code class="literal">elasticsearch.ssl.key_passphrase</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>An optional passphrase used to decrypt an encrypted key stored in the configured key file.</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_cipher_suites"></a><code class="literal">elasticsearch.ssl.cipher_suites</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>The list of cipher suites to use. The first entry has the highest priority.
If this option is omitted, the Go crypto library’s default suites are used (recommended).</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_curve_types"></a><code class="literal">elasticsearch.ssl.curve_types</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>The list of curve types for ECDHE (Elliptic Curve Diffie-Hellman ephemeral key exchange).</p>
<div class="position-relative"><h4><a id="_elasticsearch_ssl_renegotiation"></a><code class="literal">elasticsearch.ssl.renegotiation</code></h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/configure/auth.asciidoc">edit</a></div>
<p>Configure what types of renegotiation are supported.
Valid options are <code class="literal">never</code>, <code class="literal">once</code>, and <code class="literal">freely</code>. Default is <code class="literal">never</code>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">never</code> - Disables renegotiation.
</li>
<li class="listitem">
<code class="literal">once</code> - Allows a remote server to request renegotiation once per connection.
</li>
<li class="listitem">
<code class="literal">freely</code> - Allows a remote server to repeatedly request renegotiation.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="configuration-anonymous.html">« Configure anonymous authentication</a>
</span>
<span class="next">
<a href="configure-agent-config.html">Configure APM agent configuration »</a>
</span>
</div>
</body>
</html>
