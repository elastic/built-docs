<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configure anonymous authentication | APM User Guide [8.9] | Elastic</title>
<meta class="elastic" name="content" content="Configure anonymous authentication | APM User Guide [8.9]">

<link rel="home" href="index.html" title="APM User Guide [8.9]"/>
<link rel="up" href="configuring-howto-apm-server.html" title="Configure"/>
<link rel="prev" href="configuration-process.html" title="General configuration options"/>
<link rel="next" href="apm-agent-auth.html" title="APM agent authorization"/>
<meta class="elastic" name="product_version" content="8.9"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.9"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.9"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-apm-server.html">Configure</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="configuration-process.html">« General configuration options</a>
</span>
<span class="next">
<a href="apm-agent-auth.html">APM agent authorization »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuration-anonymous"></a>Configure anonymous authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h2>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-yes.svg" alt="supported deployment methods"></span></p>
<p>Most options on this page are supported by all APM Server deployment methods.</p>
</div>
<p>Elastic APM agents can send unauthenticated (anonymous) events to the APM Server.
An event is considered to be anonymous if no authentication token can be extracted from the incoming request.
This is useful for agents that run on clients, like the Real User Monitoring (RUM)
agent running in a browser, or the iOS/Swift agent running in a user application.</p>
<p>Enable anonymous authentication in the APM Server to allow the
ingestion of unauthenticated client-side APM data while still requiring authentication for server-side services.</p>
<div class="tabs" data-tab-group="config-apm">
  <div role="tablist" aria-label="Auth">
    <button role="tab"
            aria-selected="true"
            aria-controls="binary-tab"
            id="binary">
      APM Server binary
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="fleet-managed-tab"
            id="fleet-managed"
            tabindex="-1">
      Fleet-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="binary-tab"
       aria-labelledby="binary">
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server.auth.anonymous.enabled: true
apm-server.auth.anonymous.allow_agent: [rum-js]
apm-server.auth.anonymous.allow_service: [my_service_name]
apm-server.auth.anonymous.rate_limit.event_limit: 300
apm-server.auth.anonymous.rate_limit.ip_limit: 1000</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="fleet-managed-tab"
       aria-labelledby="fleet-managed"
       hidden="">
<p>Configure and customize Fleet-managed APM settings directly in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and navigate to <span class="strong strong"><strong>Fleet</strong></span>.
</li>
<li class="listitem">
Under the <span class="strong strong"><strong>Agent policies</strong></span> tab, select the policy you would like to configure.
</li>
<li class="listitem">
Find the Elastic APM integration and select <span class="strong strong"><strong>Actions</strong></span> &gt; <span class="strong strong"><strong>Edit integration</strong></span>.
</li>
<li class="listitem">
Look for these settings under <span class="strong strong"><strong>Agent authorization</strong></span>.
</li>
</ol>
</div>
  </div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>All anonymous access configuration is ignored if
<a class="xref" href="secure-agent-communication.html" title="Secure communication with APM agents">authenticated communication</a> is disabled.</p>
</div>
</div>
<h3><a id="config-auth-anon-rum"></a>Real User Monitoring (RUM)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h3>
<p>If an <a class="xref" href="api-key.html" title="API keys">API key</a> or <a class="xref" href="secret-token.html" title="Secret token">secret token</a> is configured,
then anonymous authentication must be enabled to collect RUM data.
For this reason, anonymous auth will be enabled automatically if <a class="xref" href="configuration-rum.html#rum-enable" title="Enable RUM">Enable RUM</a>
is set to <code class="literal">true</code>, and <a class="xref" href="configuration-anonymous.html#config-auth-anon-enabled" title="Anonymous Agent access">Anonymous Agent access</a> is not explicitly defined.</p>
<p>See <a class="xref" href="configuration-rum.html" title="Configure Real User Monitoring (RUM)">Real User Monitoring (RUM)</a> for additional RUM configuration options.</p>
<h4><a id="config-auth-anon-mitigating"></a>Mitigating malicious requests<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h4>
<p>There are a few configuration variables that can mitigate the impact of malicious requests to an
unauthenticated APM Server endpoint.</p>
<p>Use the <a class="xref" href="configuration-anonymous.html#config-auth-anon-allow-agent" title="Allowed anonymous agents">Allowed anonymous agents</a> and <a class="xref" href="configuration-anonymous.html#config-auth-anon-allow-service" title="Allowed services">Allowed services</a> configs to ensure that the
<code class="literal">agent.name</code> and <code class="literal">service.name</code> of each incoming request match a specified list.</p>
<p>Additionally, the APM Server can rate-limit unauthenticated requests based on the client IP address
(<code class="literal">client.ip</code>) of the request with <a class="xref" href="configuration-anonymous.html#config-auth-anon-event-limit" title="Event limit">Event limit</a>.
This allows you to specify the maximum number of requests allowed per unique IP address, per second.</p>
<h4><a id="config-auth-anon-client-ip"></a>Deriving an incoming request&#8217;s <code class="literal">client.ip</code> address<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h4>
<p>The remote IP address of an incoming request might be different
from the end-user&#8217;s actual IP address, for example, because of a proxy. For this reason,
the APM Server attempts to derive the IP address of an incoming request from HTTP headers.
The supported headers are parsed in the following order:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<code class="literal">Forwarded</code>
</li>
<li class="listitem">
<code class="literal">X-Real-Ip</code>
</li>
<li class="listitem">
<code class="literal">X-Forwarded-For</code>
</li>
</ol>
</div>
<p>If none of these headers are present, the remote address for the incoming request is used.</p>
<h4><a id="config-auth-anon-client-ip-concerns"></a>Using a reverse proxy or load balancer<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h4>
<p>HTTP headers are easily modified;
it&#8217;s possible for anyone to spoof the derived <code class="literal">client.ip</code> value by changing or setting,
for example, the value of the <code class="literal">X-Forwarded-For</code> header.
For this reason, if any of your clients are not trusted,
we recommend setting up a reverse proxy or load balancer in front of the APM Server.</p>
<p>Using a proxy allows you to clear any existing IP-forwarding HTTP headers,
and replace them with one set by the proxy.
This prevents malicious users from cycling spoofed IP addresses to bypass the
APM Server&#8217;s rate limiting feature.</p>
<h3><a id="config-auth-anon"></a>Configuration reference<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h3>
<h4><a id="config-auth-anon-enabled"></a>Anonymous Agent access<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h4>
<p>Enable or disable anonymous authentication.
Default: <code class="literal">false</code> (disabled). (bool)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.auth.anonymous.enabled</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Anonymous Agent access</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-auth-anon-allow-agent"></a>Allowed anonymous agents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h4>
<p>A list of permitted APM agent names for anonymous authentication.
Names in this list must match the agent&#8217;s <code class="literal">agent.name</code>.
Default: <code class="literal">[rum-js, js-base]</code> (only RUM agent events are accepted). (array)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.auth.anonymous.allow_agent</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Allowed Anonymous agents</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-auth-anon-allow-service"></a>Allowed services<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h4>
<p>A list of permitted service names for anonymous authentication.
Names in this list must match the agent&#8217;s <code class="literal">service.name</code>.
This can be used to limit the number of service-specific indices or data streams created.
Default: Not set (any service name is accepted). (array)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.auth.anonymous.allow_service</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Allowed Anonymous services</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-auth-anon-ip-limit"></a>IP limit<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h4>
<p>The number of unique IP addresses to track in an LRU cache.
IP addresses in the cache will be rate limited according to the <a class="xref" href="configuration-anonymous.html#config-auth-anon-event-limit" title="Event limit">Event limit</a> setting.
Consider increasing this default if your application has many concurrent clients.
Default: <code class="literal">1000</code>. (int)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.auth.anonymous.rate_limit.ip_limit</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Anonymous Rate limit (IP limit)</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-auth-anon-event-limit"></a>Event limit<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/8.9/docs/configure/anonymous-auth.asciidoc">edit</a></h4>
<p>The maximum number of events allowed per second, per agent IP address.
Default: <code class="literal">300</code>. (int)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.auth.anonymous.rate_limit.event_limit</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Anonymous Event rate limit (event limit)</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="configuration-process.html">« General configuration options</a>
</span>
<span class="next">
<a href="apm-agent-auth.html">APM agent authorization »</a>
</span>
</div>
</div>
</body>
</html>
