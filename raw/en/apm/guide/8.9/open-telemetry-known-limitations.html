<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Limitations | APM User Guide [8.9] | Elastic</title>
<meta class="elastic" name="content" content="Limitations | APM User Guide [8.9]">

<link rel="home" href="index.html" title="APM User Guide [8.9]"/>
<link rel="up" href="open-telemetry.html" title="OpenTelemetry integration"/>
<link rel="prev" href="open-telemetry-collect-metrics.html" title="Collect metrics"/>
<link rel="next" href="open-telemetry-resource-attributes.html" title="Resource attributes"/>
<meta class="elastic" name="product_version" content="8.9"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.9"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.9"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="open-telemetry-collect-metrics.html">« Collect metrics</a>
</span>
<span class="next">
<a href="open-telemetry-resource-attributes.html">Resource attributes »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="open-telemetry.html">OpenTelemetry integration</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Limitations</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/otel-limitations.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="open-telemetry-known-limitations"></a>Limitations</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/otel-limitations.asciidoc">edit</a></div>
</div></div></div>
<div class="position-relative"><h4><a id="open-telemetry-traces-limitations"></a>OpenTelemetry traces</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/otel-limitations.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Traces of applications using <code class="literal">messaging</code> semantics might be wrongly displayed as <code class="literal">transactions</code> in the APM UI, while they should be considered <code class="literal">spans</code> (see issue <a href="https://github.com/elastic/apm-server/issues/7001" class="ulink" target="_top">#7001</a>).
</li>
<li class="listitem">
Inability to see Stack traces in spans.
</li>
<li class="listitem">
Inability in APM views to view the "Time Spent by Span Type"  (see issue <a href="https://github.com/elastic/apm-server/issues/5747" class="ulink" target="_top">#5747</a>).
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="open-telemetry-metrics-limitations"></a>OpenTelemetry metrics</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/otel-limitations.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Inability to see host metrics in Elastic Metrics Infrastructure view when using the OpenTelemetry Collector host metrics receiver (see issue <a href="https://github.com/elastic/apm-server/issues/5310" class="ulink" target="_top">#5310</a>).
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="open-telemetry-logs-intake"></a>OpenTelemetry logs</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/otel-limitations.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> The OpenTelemetry logs intake via APM Server is in technical preview.
</li>
<li class="listitem">
The application logs data stream (<code class="literal">app_logs</code>) has dynamic mapping disabled. This means the automatic detection and mapping of new fields is disabled (see issue <a href="https://github.com/elastic/apm-server/issues/9093" class="ulink" target="_top">#9093</a>).
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="open-telemetry-otlp-limitations"></a>OpenTelemetry Line Protocol (OTLP)</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/otel-limitations.asciidoc">edit</a></div>
<p>APM Server supports both the <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlpgrpc" class="ulink" target="_top">(OTLP/gRPC)</a> and <a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlphttp" class="ulink" target="_top">(OTLP/HTTP)</a> protocol with ProtoBuf payload.
APM Server does not yet support JSON Encoding for OTLP/HTTP.</p>
<div class="position-relative"><h4><a id="open-telemetry-collector-exporter"></a>OpenTelemetry Collector exporter for Elastic</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/otel-limitations.asciidoc">edit</a></div>
<p>The <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/elasticexporter#legacy-opentelemetry-collector-exporter-for-elastic" class="ulink" target="_top">OpenTelemetry Collector exporter for Elastic</a>
was deprecated in 7.13 and replaced by the native support of the OpenTelemetry Line Protocol in
Elastic Observability (OTLP). To learn more, see
<a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/elasticexporter#migration" class="ulink" target="_top">migration</a>.</p>
<div class="position-relative"><h4><a id="open-telemetry-tbs"></a>OpenTelemetry&#8217;s tail-based sampling</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.9/docs/en/apm-server/otel-limitations.asciidoc">edit</a></div>
<p>Tail-based sampling allows to make sampling decisions after all spans of a trace have been completed.
This allows for more powerful and informed sampling rules.</p>
<p>When using OpenTelemetry with Elastic APM, there are two different implementations available for tail-based sampling:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Tail-based sampling using the <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/tailsamplingprocessor" class="ulink" target="_top">tailsamplingprocessor</a> in the OpenTelemetry Collector
</li>
<li class="listitem">
Native <a class="xref" href="sampling.html#tail-based-sampling" title="Tail-based sampling">tail-based sampling in the Elastic APM backend</a>
</li>
</ul>
</div>
<p>Using the <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/tailsamplingprocessor" class="ulink" target="_top">tailsamplingprocessor</a> in the OpenTelemetry Collector comes with an important limitation. Elastic&#8217;s APM backend calculates span and transaction metrics based on the incoming span events.
These metrics are accurate for 100% sampling scenarios. In scenarios with probabilistic sampling, Elastic&#8217;s APM backend is being informed about the sampling rate of spans and can extrapolate throughput metrics based on the incoming, partial data. However, with tail-based sampling there&#8217;s no clear probability for sampling decisions as the rules can be more complex and the OpenTelemetry Collector does not provide sampling probability information to the Elastic backend that could be used for extrapolation of data. Therefore, there&#8217;s no way for Elastic APM to properly extrapolate throughput and count metrics that are derived from span events that have been tail-based sampled in the OpenTelemetry Collector. In these scenarios, derived throughput and count metrics are likely to be inaccurate.</p>
<p>Therefore, we recommend using Elastic&#8217;s native tail-based smapling when integrating with OpenTelemetry.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="open-telemetry-collect-metrics.html">« Collect metrics</a>
</span>
<span class="next">
<a href="open-telemetry-resource-attributes.html">Resource attributes »</a>
</span>
</div>
</body>
</html>
