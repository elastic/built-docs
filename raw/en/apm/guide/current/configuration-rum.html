<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configure Real User Monitoring (RUM) | APM User Guide [8.8] | Elastic</title>
<meta class="elastic" name="content" content="Configure Real User Monitoring (RUM) | APM User Guide [8.8]">

<link rel="home" href="index.html" title="APM User Guide [8.8]"/>
<link rel="up" href="configuring-howto-apm-server.html" title="Configure"/>
<link rel="prev" href="configuration-path.html" title="Configure project paths"/>
<link rel="next" href="configuration-ssl-landing.html" title="SSL/TLS settings"/>
<meta class="elastic" name="product_version" content="8.8"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.8"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.8"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-apm-server.html">Configure</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="configuration-path.html">« Configure project paths</a>
</span>
<span class="next">
<a href="configuration-ssl-landing.html">SSL/TLS settings »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuration-rum"></a>Configure Real User Monitoring (RUM)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h2>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-yes.svg" alt="supported deployment methods"></span></p>
<p>Most options in this section are supported by all APM Server deployment methods.</p>
</div>
<p>The <a href="/guide/en/apm/agent/rum-js/5.x/index.html" class="ulink" target="_top">Real User Monitoring (RUM) agent</a> captures user interactions with clients such as web browsers.
These interactions are sent as events to the APM Server.
Because the RUM agent runs on the client side, the connection between agent and server is unauthenticated.
As a security precaution, RUM is therefore disabled by default.</p>
<div class="tabs" data-tab-group="config-apm">
  <div role="tablist" aria-label="RUM">
    <button role="tab"
            aria-selected="true"
            aria-controls="binary-tab"
            id="binary">
      APM Server binary
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="fleet-managed-tab"
            id="fleet-managed"
            tabindex="-1">
      Fleet-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="binary-tab"
       aria-labelledby="binary">
<p>To enable RUM support, set <code class="literal">apm-server.rum.enabled</code> to <code class="literal">true</code> in your APM Server configuration file.</p>
<p>Example config:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server.rum.enabled: true
apm-server.auth.anonymous.rate_limit.event_limit: 300
apm-server.auth.anonymous.rate_limit.ip_limit: 1000
apm-server.auth.anonymous.allow_service: [your_service_name]
apm-server.rum.allow_origins: ['*']
apm-server.rum.allow_headers: ["header1", "header2"]
apm-server.rum.library_pattern: "node_modules|bower_components|~"
apm-server.rum.exclude_from_grouping: "^/webpack"
apm-server.rum.source_mapping.enabled: true
apm-server.rum.source_mapping.cache.expiration: 5m
apm-server.rum.source_mapping.elasticsearch.api_key: TiNAGG4BaaMdaH1tRfuU:KnR6yE41RrSowb0kQ0HWoA</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="fleet-managed-tab"
       aria-labelledby="fleet-managed"
       hidden="">
<p>To enable RUM, set <a class="xref" href="configuration-rum.html#rum-enable" title="Enable RUM">Enable RUM</a> to <code class="literal">true</code>.</p>
<p>Configure and customize Fleet-managed APM settings directly in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and navigate to <span class="strong strong"><strong>Fleet</strong></span>.
</li>
<li class="listitem">
Under the <span class="strong strong"><strong>Agent policies</strong></span> tab, select the policy you would like to configure.
</li>
<li class="listitem">
Find the Elastic APM integration and select <span class="strong strong"><strong>Actions</strong></span> &gt; <span class="strong strong"><strong>Edit integration</strong></span>.
</li>
<li class="listitem">
Look for these options under <span class="strong strong"><strong>Real User Monitoring</strong></span>.
</li>
</ol>
</div>
  </div>
</div>
<p>In addition, if APM Server is deployed in an origin different than the page’s origin,
you will need to configure <a href="/guide/en/apm/agent/rum-js/5.x/configuring-cors.html" class="ulink" target="_top">Cross-Origin Resource Sharing (CORS)</a> in the Agent.</p>
<h3><a id="enable-rum-support"></a>Configuration reference<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h3>
<h4><a id="rum-enable"></a>Enable RUM<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>To enable RUM support, set to <code class="literal">true</code>.
By default this is disabled. (bool)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.rum.enabled</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Enable RUM</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If an <a class="xref" href="api-key.html" title="API keys">API key</a> or <a class="xref" href="secret-token.html" title="Secret token">secret token</a> is configured,
enabling RUM support will automatically enable <a class="xref" href="configuration-anonymous.html" title="Configure anonymous authentication">Anonymous authentication</a>.
Anonymous authentication is required as the RUM agent runs in the browser.</p>
</div>
</div>
<h4><a id="rum-allow-origins"></a>Allowed Origins<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>A list of permitted origins for RUM support.
User-agents send an Origin header that will be validated against this list.
This is done automatically by modern browsers as part of the <a href="https://www.w3.org/TR/cors/" class="ulink" target="_top">CORS specification</a>.
An origin is made of a protocol scheme, host and port, without the URL path.</p>
<p>Default: <code class="literal">['*']</code> (allows everything). (text)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.rum.allow_origins</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Allowed Origins</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="rum-allow-headers"></a>Access-Control-Allow-Headers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>HTTP requests made from the RUM agent to the APM Server are limited in the HTTP headers they are allowed to have.
If any other headers are added, the request will be rejected by the browser due to Cross-Origin Resource Sharing (CORS) restrictions.
Use this setting to allow additional headers.
The default list of allowed headers includes "Content-Type", "Content-Encoding", and "Accept";
custom values configured here are appended to the default list and used as the value for the <code class="literal">Access-Control-Allow-Headers</code> header.</p>
<p>Default: <code class="literal">[]</code>. (text)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.rum.allow_headers</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Access-Control-Allow-Headers</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="rum-response-headers"></a>Custom HTTP response headers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>Custom HTTP headers to add to RUM responses.
This can be useful for security policy compliance.</p>
<p>Values set for the same key will be concatenated.</p>
<p>Default: none. (text)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.rum.response_headers</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Custom HTTP response headers</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="rum-library-pattern"></a>Library Frame Pattern<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>RegExp to be matched against a stack trace frame&#8217;s <code class="literal">file_name</code> and <code class="literal">abs_path</code> attributes.
If the RegExp matches, the stack trace frame is considered to be a library frame.
When source mapping is applied, the <code class="literal">error.culprit</code> is set to reflect the <em>function</em> and the <em>filename</em>
of the first non library frame.
This aims to provide an entry point for identifying issues.</p>
<p>Default: <code class="literal">"node_modules|bower_components|~"</code>. (text)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.rum.library_pattern</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Library Frame Pattern</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="_exclude_from_grouping"></a>Exclude from grouping<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>RegExp to be matched against a stack trace frame&#8217;s <code class="literal">file_name</code>.
If the RegExp matches, the stack trace frame is excluded from being used for calculating error groups.</p>
<p>Default: <code class="literal">"^/webpack"</code> (excludes stack trace frames that have a filename starting with <code class="literal">/webpack</code>). (text)</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><code class="literal">apm-server.rum.exclude_from_grouping</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Exclude from grouping</code></p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="rum-source-map"></a>Source map configuration options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h3>
<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>Source maps are supported by all APM Server deployment methods, however,
the options in this section are only supported by the APM Server binary.</p>
</div>
<h4><a id="config-sourcemapping-enabled"></a><code class="literal">source_mapping.enabled</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>Used to enable/disable <a class="xref" href="source-map-how-to.html" title="Create and upload source maps (RUM)">source mapping</a> for RUM events.
When enabled, the APM Server needs additional privileges to read source maps.
See <a class="xref" href="privileges-to-publish-events.html" title="Grant privileges and roles needed for writing events">Create a <em>writer</em> user</a> for more details.</p>
<p>Default: <code class="literal">true</code></p>
<h4><a id="config-sourcemapping-elasticsearch"></a><code class="literal">source_mapping.elasticsearch</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>Configure the Elasticsearch source map retrieval location, taking the same options as <a class="xref" href="elasticsearch-output.html" title="Configure the Elasticsearch output">output.elasticsearch</a>.
This must be set when using an output other than Elasticsearch, and that output is writing to Elasticsearch.
Otherwise leave this section empty.</p>
<h4><a id="rum-sourcemap-cache"></a><code class="literal">source_mapping.cache.expiration</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>If a source map has been uploaded to the APM Server,
<a class="xref" href="source-map-how-to.html" title="Create and upload source maps (RUM)">source mapping</a> is automatically applied to documents sent to the RUM endpoint.
Source maps are fetched from Elasticsearch and then kept in an in-memory cache for the configured time.
Values configured without a time unit are treated as seconds.</p>
<p>Default: <code class="literal">5m</code> (5 minutes)</p>
<h4><a id="_source_mapping_index_pattern"></a><code class="literal">source_mapping.index_pattern</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<p>Previous versions of APM Server stored source maps in <code class="literal">apm-%{[observer.version]}-sourcemap</code> indices.
Search source maps stored in an older version with this setting.</p>
<p>Default: <code class="literal">"apm-*-sourcemap*"</code></p>
<h3><a id="rum-deprecated"></a>Deprecated configuration options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h3>
<h4><a id="event_rate.limit"></a><code class="literal">event_rate.limit</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.15.0.</h3>
<p>Replaced by <a class="xref" href="configuration-anonymous.html#config-auth-anon-event-limit" title="Event limit">Event limit</a>.</p>
</div>
</div>
<p>The maximum number of events allowed per second, per agent IP address.</p>
<p>Default: <code class="literal">300</code></p>
<h4><a id="_event_rate_lru_size"></a><code class="literal">event_rate.lru_size</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.15.0.</h3>
<p>Replaced by <a class="xref" href="configuration-anonymous.html#config-auth-anon-ip-limit" title="IP limit">IP limit</a>.</p>
</div>
</div>
<p>The number of unique IP addresses to track in an LRU cache.
IP addresses in the cache will be rate limited according to the <a class="xref" href="configuration-anonymous.html#config-auth-anon-event-limit" title="Event limit">Event limit</a> setting.
Consider increasing this default if your site has many concurrent clients.</p>
<p>Default: <code class="literal">1000</code></p>
<h4><a id="rum-allow-service-names"></a><code class="literal">allow_service_names</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h4>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.15.0.</h3>
<p>Replaced by <a class="xref" href="configuration-anonymous.html#config-auth-anon-allow-service" title="Allowed services">Allowed services</a>.</p>
</div>
</div>
<p>A list of permitted service names for RUM support.
Names in this list must match the agent&#8217;s <code class="literal">service.name</code>.
This can be set to restrict RUM events to those with one of a set of known service names,
in order to limit the number of service-specific indices or data streams created.</p>
<p>Default: Not set (any service name is accepted)</p>
<h3><a id="_ingest_pipelines"></a>Ingest pipelines<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.8/docs/configure/rum.asciidoc">edit</a></h3>
<p>The default APM Server pipeline includes processors that enrich RUM data prior to indexing in Elasticsearch.
See <a class="xref" href="ingest-pipelines.html" title="Parse data using ingest pipelines">Parse data using ingest pipelines</a> for details on how to locate, edit, or disable this preprocessing.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="configuration-path.html">« Configure project paths</a>
</span>
<span class="next">
<a href="configuration-ssl-landing.html">SSL/TLS settings »</a>
</span>
</div>
</div>
</body>
</html>
