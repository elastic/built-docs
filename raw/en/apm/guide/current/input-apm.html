<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>APM input settings | APM User Guide [8.6] | Elastic</title>
<link rel="home" href="index.html" title="APM User Guide [8.6]"/>
<link rel="up" href="index.html" title="APM User Guide [8.6]"/>
<link rel="prev" href="apm-tune-elasticsearch.html" title="Tune Elasticsearch for data ingestion"/>
<link rel="next" href="secure-agent-communication.html" title="Secure communication with APM agents"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/8.6"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="8.6"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
    <div class="related-products-title">APM:</div>
    <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
    <div class="dropdown-content">
      <ul>
        <li class="dropdown-category">APM</li>
        <ul>
          <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
        </ul>
        <li class="dropdown-category">APM agents</li>
        <ul>
          <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
          <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
        </ul>
        <li class="dropdown-category">APM extensions</li>
        <ul>
          <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
          <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
        </ul>
      </ul>
    </div>
  </div>
</span>
</div>
<div class="navheader">
<span class="prev">
<a href="apm-tune-elasticsearch.html">« Tune Elasticsearch for data ingestion</a>
</span>
<span class="next">
<a href="secure-agent-communication.html">Secure communication with APM agents »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="input-apm"></a>APM input settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.6/docs/input-apm.asciidoc">edit</a></h1>
</div></div></div>

<p>Configure and customize APM integration settings directly in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and navigate to <span class="strong strong"><strong>Fleet</strong></span>.
</li>
<li class="listitem">
Under the <span class="strong strong"><strong>Agent policies</strong></span> tab, select the policy you would like to configure.
</li>
<li class="listitem">
Find the Elastic APM integration and select <span class="strong strong"><strong>Actions</strong></span> &gt; <span class="strong strong"><strong>Edit integration</strong></span>.
</li>
</ol>
</div>
<h3><a id="apm-input-general-settings"></a>General settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.6/docs/input-apm.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-host-setting"></a>Host</p>
</td>
<td align="left" valign="top">
<p>(text) Defines the host and port the server is listening on.</p>
<p>Use <code class="literal">"unix:/path/to.sock"</code> to listen on a Unix domain socket.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">localhost:8200</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-url-setting"></a>URL</p>
</td>
<td align="left" valign="top">
<p>The publicly reachable server URL. For deployments on Elastic Cloud or ECK, the default is unchangeable.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-max_header_bytes-setting"></a>Maximum size of a request&#8217;s header</p>
</td>
<td align="left" valign="top">
<p>(int) Maximum permitted size of a request&#8217;s header accepted by the server to be processed (in Bytes).</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">1048576</code> Bytes</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-idle_timeout-setting"></a>Idle time before underlying connection is closed</p>
</td>
<td align="left" valign="top">
<p>(text) Maximum amount of time to wait for the next incoming request before underlying connection is closed.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">45s</code> (45 seconds)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-read_timeout-setting"></a>Maximum duration for reading an entire request</p>
</td>
<td align="left" valign="top">
<p>(text) Maximum permitted duration for reading an entire request.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">3600s</code> (3600 seconds)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-shutdown_timeout-setting"></a>Maximum duration before releasing resources when shutting down</p>
</td>
<td align="left" valign="top">
<p>(text) Maximum duration in seconds before releasing resources when shutting down the server.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">30s</code> (30 seconds)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-max_event_bytes-setting"></a>Maximum size per event</p>
</td>
<td align="left" valign="top">
<p>(int) Maximum permitted size of an event accepted by the server to be processed (in Bytes).</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">307200</code> Bytes</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-max_connections-setting"></a>Simultaneously accepted connections</p>
</td>
<td align="left" valign="top">
<p>(int) Maximum number of TCP connections to accept simultaneously. <code class="literal">0</code> means unlimited.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">0</code> (unlimited)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-response_headers-setting"></a>Custom HTTP response headers</p>
</td>
<td align="left" valign="top">
<p>(text) Custom HTTP headers to add to HTTP responses. Useful for security policy compliance.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-capture_personal_data-setting"></a>Capture personal data</p>
</td>
<td align="left" valign="top">
<p>(bool) Capture personal data such as IP or User Agent.
If true, APM Server captures the IP of the instrumented service and its User Agent if any.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-default_service_environment-setting"></a>Default Service Environment</p>
</td>
<td align="left" valign="top">
<p>(text) The default service environment for events without a defined service environment.</p>
<p><span class="strong strong"><strong>Default:</strong></span> none</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-golang_xpvar-setting"></a>Enable APM Server Golang expvar support</p>
</td>
<td align="left" valign="top">
<p>(bool) When set to <code class="literal">true</code>, the server exposes <a href="https://golang.org/pkg/expvar/" class="ulink" target="_top">Golang expvar</a> under <code class="literal">/debug/vars</code>.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">false</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<h3><a id="apm-input-rum-settings"></a>Real User Monitoring (RUM) settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.6/docs/input-apm.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-enable_rum-setting"></a>Enable RUM</p>
</td>
<td align="left" valign="top">
<p>(bool) Enables and disables Real User Monitoring (RUM).</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">false</code> (disabled)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-rum_allow_origins-setting"></a>Allowed Origins</p>
</td>
<td align="left" valign="top">
<p>(text) A list of permitted origins for RUM support.
User-agents send an Origin header that will be validated against this list.
This is done automatically by modern browsers as part of the <a href="https://www.w3.org/TR/cors/" class="ulink" target="_top">CORS specification</a>.
An origin is made of a protocol scheme, host and port, without the URL path.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">["*"]</code> (allows everything)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-rum_allow_headers-setting"></a>Access-Control-Allow-Headers</p>
</td>
<td align="left" valign="top">
<p>(text) By default, HTTP requests made from the RUM agent to the APM integration are limited in the HTTP headers they are allowed to have.
If any other headers are added, the request will be rejected by the browser due to Cross-Origin Resource Sharing (CORS) restrictions.
If you need to add extra headers to these requests, use this configuration to allow additional headers.</p>
<p>The default list of values includes <code class="literal">"Content-Type"</code>, <code class="literal">"Content-Encoding"</code>, and <code class="literal">"Accept"</code>.
Configured values are appended to the default list and used as the value for the
<code class="literal">Access-Control-Allow-Headers</code> header.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-rum_response_headers-setting"></a>Custom HTTP response headers</p>
</td>
<td align="left" valign="top">
<p>(text) Custom HTTP headers to add to RUM responses. For example, for security policy compliance. Headers set here are in addition to those set in the "Custom HTTP response headers", but only apply to RUM responses.</p>
<p><span class="strong strong"><strong>Default:</strong></span> none</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-rum_library_frame_pattern-setting"></a>Library Frame Pattern</p>
</td>
<td align="left" valign="top">
<p>(text) RegExp to be matched against a stack trace frame&#8217;s <code class="literal">file_name</code> and <code class="literal">abs_path</code> attributes.
If the RegExp matches, the stack trace frame is considered to be a library frame.
When source mapping is applied, the <code class="literal">error.culprit</code> is set to reflect the <em>function</em> and the <em>filename</em>
of the first non-library frame.
This aims to provide an entry point for identifying issues.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">"node_modules|bower_components|~"</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-rum_exclude_from_grouping-setting"></a>Exclude from grouping</p>
</td>
<td align="left" valign="top">
<p>(text) RegExp to be matched against a stack trace frame&#8217;s <code class="literal">file_name</code>.
If the RegExp matches, the stack trace frame is excluded from being used for calculating error groups.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">"^/webpack"</code> (excludes stack trace frames that have a filename starting with <code class="literal">/webpack</code>)</p>
</td>
</tr>
</tbody>
</table>
</div>
<h3><a id="apm-input-tls-settings"></a>TLS settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.6/docs/input-apm.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tls_enabled-setting"></a>Enable TLS</p>
</td>
<td align="left" valign="top">
<p>(bool) Enable TLS.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">false</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tls_certificate-setting"></a>File path to server certificate</p>
</td>
<td align="left" valign="top">
<p>(text) The path to the file containing the certificate for server authentication. Required when TLS is enabled.</p>
<p><span class="strong strong"><strong>Default:</strong></span> none</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tls_key-setting"></a>File path to server certificate key</p>
</td>
<td align="left" valign="top">
<p>(text) The path to the file containing the Server certificate key. Required when TLS is enabled.</p>
<p><span class="strong strong"><strong>Default:</strong></span> none</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tls_supported_protocols-setting"></a>Supported protocol versions</p>
</td>
<td align="left" valign="top">
<p>(array) A list of allowed TLS protocol versions.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">["TLSv1.1", "TLSv1.2", "TLSv1.3"]</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tls_cipher_suites-setting"></a>Cipher suites for TLS connections</p>
</td>
<td align="left" valign="top">
<p>(text) The list of cipher suites to use. The first entry has the highest priority.
If this option is omitted, the Go crypto library’s <a href="https://golang.org/pkg/crypto/tls/" class="ulink" target="_top">default suites</a> are used (recommended).
Note that TLS 1.3 cipher suites are not individually configurable in Go, so they are not included in this list.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tls_curve_types-setting"></a>Curve types for ECDHE based cipher suites</p>
</td>
<td align="left" valign="top">
<p>(text) The list of curve types for ECDHE (Elliptic Curve Diffie-Hellman ephemeral key exchange).</p>
<p><span class="strong strong"><strong>Default:</strong></span> none</p>
</td>
</tr>
</tbody>
</table>
</div>
<h3><a id="apm-input-agent-auth-settings"></a>Agent authorization settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.6/docs/input-apm.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-api_key_enabled-setting"></a>API key for agent authentication</p>
</td>
<td align="left" valign="top">
<p>(bool) Enable or disable API key authorization between APM Server and APM agents.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">false</code> (disabled)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-api_key_limit-setting"></a>Number of keys</p>
</td>
<td align="left" valign="top">
<p>(int) Each unique API key triggers one request to Elasticsearch.
This setting restricts the number of unique API keys are allowed per minute.
The minimum value for this setting should be the number of API keys configured in your monitored services.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">100</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-secret_token-setting"></a>Secret token</p>
</td>
<td align="left" valign="top">
<p>(text) Authorization token for sending APM data.
The same token must also be set in each APM agent.
This token is not used for RUM endpoints.</p>
<p><span class="strong strong"><strong>Default:</strong></span> No secret token set</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-anonymous_enabled-setting"></a>Anonymous Agent access</p>
</td>
<td align="left" valign="top">
<p>(bool) Enable or disable anonymous authentication. RUM agents do not support authentication, so disabling anonymous access will effectively disable RUM agents.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code> (enabled)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-anonymous_allow_agent-setting"></a>Allowed Anonymous agents</p>
</td>
<td align="left" valign="top">
<p>(array) A list of permitted APM agent names for anonymous authentication.
Names in this list must match the agent&#8217;s <code class="literal">agent.name</code>.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">[rum-js, js-base, iOS/swift]</code> (only RUM and iOS/Swift agent events are accepted)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-anonymous_allow_service-setting"></a>Allowed Anonymous services</p>
</td>
<td align="left" valign="top">
<p>(array) A list of permitted service names for anonymous authentication.
Names in this list must match the agent&#8217;s <code class="literal">service.name</code>.
This can be used to limit the number of service-specific indices or data streams created.</p>
<p><span class="strong strong"><strong>Default:</strong></span> Not set (any service name is accepted)</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-anonymous_rate_limit_ip_limit-setting"></a>Anonymous Rate limit (IP limit)</p>
</td>
<td align="left" valign="top">
<p>(int) The number of unique IP addresses to track in a least recently used (LRU) cache.
IP addresses in the cache will be rate limited according to the <code class="literal">anonymous_rate_limit_event_limit</code> setting.
Consider increasing this default if your application has many concurrent clients.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">10000</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-anonymous_rate_limit_event_limit-setting"></a>Anonymous Event rate limit (event limit)</p>
</td>
<td align="left" valign="top">
<p>(int) The maximum amount of events allowed to be sent to the APM Server anonymous auth endpoint per IP per second.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">10</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<h3><a id="apm-input-tail-sampling-settings"></a>Tail-based sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/8.6/docs/input-apm.asciidoc">edit</a></h3>
<p><span class="strong strong"><strong>Top-level tail-based sampling settings:</strong></span></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tail_sampling_enabled"></a>Enable Tail-based sampling</p>
</td>
<td align="left" valign="top">
<p>(bool) Enable and disable tail-based sampling.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">false</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tail_sampling_interval"></a>Interval</p>
</td>
<td align="left" valign="top">
<p>(duration) Synchronization interval for multiple APM Servers.
Should be in the order of tens of seconds or low minutes.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">1m</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-tail_sampling_policies"></a>Policies</p>
</td>
<td align="left" valign="top">
<p>(<code class="literal">[]policy</code>) Criteria used to match a root transaction to a sample rate.
Order is important; the first policy on the list that an event matches is the winner.
Each policy list must conclude with a default policy that only specifies a sample rate.
The default policy is used to catch remaining trace events that don’t match a stricter policy.</p>
<p>Required when tail-based sampling is enabled.</p>
</td>
</tr>
</tbody>
</table>
</div>
<p><span class="strong strong"><strong>Policy settings:</strong></span></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-sample_rate"></a>Sample rate</p>
<p><code class="literal">sample_rate</code></p>
</td>
<td align="left" valign="top">
<p>(int) The sample rate to apply to trace events matching this policy.
Required in each policy.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-trace_name"></a>Trace name</p>
<p><code class="literal">trace.name</code></p>
</td>
<td align="left" valign="top">
<p>(string) The trace name for events to match a policy.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-trace_outcome"></a>Trace outcome</p>
<p><code class="literal">trace.outcome</code></p>
</td>
<td align="left" valign="top">
<p>(string) The trace outcome for events to match a policy.
Trace outcome can be <code class="literal">success</code>, <code class="literal">failure</code>, or <code class="literal">unknown</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-service_name"></a>Service name</p>
<p><code class="literal">service.name</code></p>
</td>
<td align="left" valign="top">
<p>(string) The service name for events to match a policy.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="input-apm-service_env"></a>Service Environment</p>
<p><code class="literal">service.environment</code></p>
</td>
<td align="left" valign="top">
<p>(string) The service environment for events to match a policy.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="apm-tune-elasticsearch.html">« Tune Elasticsearch for data ingestion</a>
</span>
<span class="next">
<a href="secure-agent-communication.html">Secure communication with APM agents »</a>
</span>
</div>
</div>
</body>
</html>
