<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tune data ingestion | APM User Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Tune data ingestion | APM User Guide [master]">

<link rel="home" href="index.html" title="APM User Guide [master]"/>
<link rel="up" href="setting-up-and-running.html" title="APM Server advanced setup"/>
<link rel="prev" href="command-line-options.html" title="APM Server command reference"/>
<link rel="next" href="high-availability.html" title="High Availability"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Guide/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">User Guide<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/apm/guide/current/apm-overview.html">User Guide</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">Monitoring AWS Lambda Functions</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="setting-up-and-running.html">APM Server advanced setup</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="command-line-options.html">« APM Server command reference</a>
</span>
<span class="next">
<a href="high-availability.html">High Availability »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="tune-data-ingestion"></a>Tune data ingestion<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/data-ingestion.asciidoc">edit</a></h2>
</div></div></div>
<p>This section explains how to adapt data ingestion according to your needs.</p>
<h3><a id="tune-apm-server"></a>Tune APM Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/data-ingestion.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="tune-data-ingestion.html#add-apm-server-instances" title="Add APM Server or Elastic Agent instances">Add APM Server or Elastic Agent instances</a>
</li>
<li class="listitem">
<a class="xref" href="tune-data-ingestion.html#reduce-payload-size" title="Reduce the payload size">Reduce the payload size</a>
</li>
<li class="listitem">
<a class="xref" href="tune-data-ingestion.html#adjust-event-rate" title="Adjust anonymous auth rate limit">Adjust anonymous auth rate limit</a>
</li>
</ul>
</div>
<h4><a id="add-apm-server-instances"></a>Add APM Server or Elastic Agent instances<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/data-ingestion.asciidoc">edit</a></h4>
<p>If the APM Server cannot process data quickly enough,
you will see request timeouts.
One way to solve this problem is to increase processing power.</p>
<p>Increase processing power by either migrating to a more powerful machine
or adding more APM Server/Elastic Agent instances.
Having several instances will also increase <a class="xref" href="high-availability.html" title="High Availability">availability</a>.</p>
<h4><a id="reduce-payload-size"></a>Reduce the payload size<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/data-ingestion.asciidoc">edit</a></h4>
<p>Large payloads may result in request timeouts.
You can reduce the payload size by decreasing the flush interval in the agents.
This will cause agents to send smaller and more frequent requests.</p>
<p>Optionally you can also <a class="xref" href="reduce-apm-storage.html#reduce-sample-rate" title="Reduce the sample rate">reduce the sample rate</a> or <a class="xref" href="reduce-apm-storage.html#reduce-stacktrace" title="Reduce collected stack trace information">reduce the amount of stack traces</a>.</p>
<p>Read more in the <a href="/guide/en/apm/agent/index.html" class="ulink" target="_top">agents documentation</a>.</p>
<h4><a id="adjust-event-rate"></a>Adjust anonymous auth rate limit<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/data-ingestion.asciidoc">edit</a></h4>
<p>Agents make use of long running requests and flush as many events over a single request as possible.
Thus, the rate limiter for anonymous authentication is bound to the number of <em>events</em> sent per second, per IP.</p>
<p>If the event rate limit is hit while events on an established request are sent, the request is not immediately terminated. The intake of events is only throttled to anonymous event rate limit, which means that events are queued and processed slower. Only when the allowed buffer queue is also full, does the request get terminated with a <code class="literal">429 - rate limit exceeded</code> HTTP response. If an agent tries to establish a new request, but the rate limit is already hit, a <code class="literal">429</code> will be sent immediately.</p>
<p>Increasing the default value for the following configuration variable will help avoid <code class="literal">rate limit exceeded</code> errors:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>APM Server binary</p></td>
<td align="left" valign="top"><p><a class="xref" href="configuration-anonymous.html#config-auth-anon-event-limit" title="rate_limit.event_limit"><code class="literal">rate_limit.event_limit</code></a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet-managed</p></td>
<td align="left" valign="top"><p><code class="literal">Anonymous Event rate limit (event limit)</code></p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="apm-tune-elasticsearch"></a>Tune Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/main/docs/legacy/data-ingestion.asciidoc">edit</a></h3>
<p>The Elasticsearch Reference provides insight on tuning Elasticsearch.</p>
<p><a href="/guide/en/elasticsearch/reference/master/tune-for-indexing-speed.html" class="ulink" target="_top">Tune for indexing speed</a> provides information on:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Refresh interval
</li>
<li class="listitem">
Disabling swapping
</li>
<li class="listitem">
Optimizing file system cache
</li>
<li class="listitem">
Considerations regarding faster hardware
</li>
<li class="listitem">
Setting the indexing buffer size
</li>
</ul>
</div>
<p><a href="/guide/en/elasticsearch/reference/master/tune-for-disk-usage.html" class="ulink" target="_top">Tune for disk usage</a> provides information on:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Disabling unneeded features
</li>
<li class="listitem">
Shard size
</li>
<li class="listitem">
Shrink index
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="command-line-options.html">« APM Server command reference</a>
</span>
<span class="next">
<a href="high-availability.html">High Availability »</a>
</span>
</div>
</div>
</body>
</html>
