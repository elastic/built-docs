<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>APM Server and systemd | APM Server Reference [7.11] | Elastic</title>
<link rel="home" href="index.html" title="APM Server Reference [7.11]"/>
<link rel="up" href="setting-up-and-running.html" title="Set up APM Server"/>
<link rel="prev" href="high-availability.html" title="High Availability"/>
<link rel="next" href="howto-guides.html" title="How-to guides"/>
<meta name="DC.type" content="Learn/Docs/APM Server/Reference/7.11"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="7.11"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Server Reference [7.11]</a></span>
»
<span class="breadcrumb-link"><a href="setting-up-and-running.html">Set up APM Server</a></span>
»
<span class="breadcrumb-node">APM Server and systemd</span>
</div>
<div class="navheader">
<span class="prev">
<a href="high-availability.html">« High Availability</a>
</span>
<span class="next">
<a href="howto-guides.html">How-to guides »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="running-with-systemd"></a>APM Server and systemd<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.11/docs/copied-from-beats/docs/shared-systemd.asciidoc">edit</a></h2>
</div></div></div>
<p>The DEB and RPM packages include a service unit for Linux systems with
systemd. On these systems, you can manage APM Server by using the usual
systemd commands.</p>
<p>We recommend that the apm-server process is run as a non-root user.
Therefore, that is the default setup for APM Server&#8217;s DEB package and RPM installation.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_start_and_stop_apm_server"></a>Start and stop APM Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.11/docs/copied-from-beats/docs/shared-systemd.asciidoc">edit</a></h3>
</div></div></div>
<p>Use <code class="literal">systemctl</code> to start or stop APM Server:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl start apm-server</pre>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl stop apm-server</pre>
</div>
<p>By default, the APM Server service starts automatically when the system
boots. To enable or disable auto start use:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl enable apm-server</pre>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl disable apm-server</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_apm_server_status_and_logs"></a>APM Server status and logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.11/docs/copied-from-beats/docs/shared-systemd.asciidoc">edit</a></h3>
</div></div></div>
<p>To get the service status, use <code class="literal">systemctl</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">systemctl status apm-server</pre>
</div>
<p>Logs are stored by default in journald. To view the Logs, use <code class="literal">journalctl</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">journalctl -u apm-server.service</pre>
</div>
<h3><a id="_customize_systemd_unit_for_apm_server"></a>Customize systemd unit for APM Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.11/docs/copied-from-beats/docs/shared-systemd.asciidoc">edit</a></h3>
<p>The systemd service unit file includes environment variables that you can
override to change the default options.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Variable</th>
<th align="left" valign="top">Description</th>
<th align="left" valign="top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>BEAT_LOG_OPTS</strong></span></p></td>
<td align="left" valign="top"><p>Log options</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>BEAT_CONFIG_OPTS</strong></span></p></td>
<td align="left" valign="top"><p>Flags for configuration file path</p></td>
<td align="left" valign="top"><p><code class="literal"><code class="literal">-c /etc/apm-server/apm-server.yml</code></code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>BEAT_PATH_OPTS</strong></span></p></td>
<td align="left" valign="top"><p>Other paths</p></td>
<td align="left" valign="top"><p><code class="literal"><code class="literal">-path.home /usr/share/apm-server -path.config /etc/apm-server -path.data /var/lib/apm-server -path.logs /var/log/apm-server</code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can use <code class="literal">BEAT_LOG_OPTS</code> to set debug selectors for logging. However,
to configure logging behavior, set the logging options described in
<a class="xref" href="configuration-logging.html" title="Configure logging">Configure logging</a>.</p>
</div>
</div>
<p>To override these variables, create a drop-in unit file in the
<code class="literal">/etc/systemd/system/apm-server.service.d</code> directory.</p>
<p>For example a file with the following content placed in
<code class="literal">/etc/systemd/system/apm-server.service.d/debug.conf</code>
would override <code class="literal">BEAT_LOG_OPTS</code> to enable debug for Elasticsearch output.</p>
<div class="pre_wrapper lang-systemd">
<pre class="programlisting prettyprint lang-systemd">[Service]
Environment="BEAT_LOG_OPTS=-d elasticsearch"</pre>
</div>
<p>To apply your changes, reload the systemd configuration and restart
the service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">systemctl daemon-reload
systemctl restart apm-server</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is recommended that you use a configuration management tool to
include drop-in unit files. If you need to add a drop-in manually, use
<code class="literal">systemctl edit apm-server.service</code>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="config-file-ownership"></a>Configuration file ownership<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.11/docs/config-ownership.asciidoc">edit</a></h3>
</div></div></div>
<p>On systems with POSIX file permissions,
the APM Server configuration file is subject to ownership and file permission checks.
These checks prevent unauthorized users from providing or modifying configurations that are run by APM Server.</p>
<p>When installed via an RPM or DEB package,
the configuration file at <code class="literal">/etc/apm-server/apm-server.yml</code> will be owned by <code class="literal">apm-server</code>,
and have file permissions of <code class="literal">0600</code> (<code class="literal">-rw-------</code>).</p>
<p>APM Server will only start if the configuration file is owned by the user running the process,
or by running as root with configuration ownership set to <code class="literal">root:root</code></p>
<p>You may encounter the following errors if your configuration file fails these checks:</p>
<div class="pre_wrapper lang-systemd">
<pre class="programlisting prettyprint lang-systemd">Exiting: error loading config file: config file ("/etc/apm-server/apm-server.yml")
must be owned by the user identifier (uid=1000) or root</pre>
</div>
<p>To correct this problem you can change the ownership of the configuration file with:
<code class="literal">chown apm-server:apm-server /etc/apm-server/apm-server.yml</code>.</p>
<p>You can also make root the config owner, although this is not recommended:
<code class="literal">sudo chown root:root /etc/apm-server/apm-server.yml</code>.</p>
<div class="pre_wrapper lang-systemd">
<pre class="programlisting prettyprint lang-systemd">Exiting: error loading config file: config file ("/etc/apm-server/apm-server.yml")
can only be writable by the owner but the permissions are "-rw-rw-r--"
(to fix the permissions use: 'chmod go-w /etc/apm-server/apm-server.yml')</pre>
</div>
<p>To correct this problem, use <code class="literal">chmod go-w /etc/apm-server/apm-server.yml</code> to
remove write privileges from anyone other than the owner.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_disabling_strict_permission_checks"></a>Disabling strict permission checks<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.11/docs/config-ownership.asciidoc">edit</a></h4>
</div></div></div>
<p>You can disable strict permission checks from the command line by using
<code class="literal">--strict.perms=false</code>, but we strongly encourage you to leave the checks enabled.</p>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="high-availability.html">« High Availability</a>
</span>
<span class="next">
<a href="howto-guides.html">How-to guides »</a>
</span>
</div>
</div>
</body>
</html>
