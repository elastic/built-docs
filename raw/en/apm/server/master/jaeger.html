<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Jaeger integration | APM Server Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="APM Server Reference [master]"/>
<link rel="up" href="configuring-howto-apm-server.html" title="Configuring APM Server"/>
<link rel="prev" href="configuration-rum.html" title="Set up Real User Monitoring (RUM) support"/>
<link rel="next" href="using-environ-vars.html" title="Use environment variables in the configuration"/>
<meta name="DC.type" content="Learn/Docs/APM Server/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Server Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="configuring-howto-apm-server.html">Configuring APM Server</a></span>
»
<span class="breadcrumb-node">Jaeger integration</span>
</div>
<div class="navheader">
<span class="prev">
<a href="configuration-rum.html">« Set up Real User Monitoring (RUM) support</a>
</span>
<span class="next">
<a href="using-environ-vars.html">Use environment variables in the configuration »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="jaeger"></a>Jaeger integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature is experimental and may be changed in a future release. It is not yet available on Elastic Cloud. For feature status on Elastic Cloud, see <a href="https://github.com/elastic/apm/issues/212" class="ulink" target="_top">#212</a>.</p>
</div>
</div>
<p>Elastic APM integrates with <a href="https://www.jaegertracing.io/" class="ulink" target="_top">Jaeger</a>, an open-source, distributed tracing system.
This integration allows users with an existing Jaeger setup to switch from the default Jaeger backend,
to ingesting data with Elastic&#8217;s APM Server, storing data in Elasticsearch, and visualizing traces in the APM app.
Best of all, this can be done without any instrumentation changes in your application code.</p>
<h3><a id="jaeger-supported"></a>Supported architecture<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h3>
<p>Jaeger architecture supports different data formats and transport protocols
that define how data can be sent to a collector. Elastic APM, as a Jaeger Collector, supports:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Communication with <span class="strong strong"><strong>Jaeger Agents</strong></span> via gRPC</p>
<p>The gRPC endpoint supports TLS. If the Jaeger gRPC collector service is enabled,
and <code class="literal">apm-server.ssl</code> is configured, SSL settings will automatically be applied to APM Server&#8217;s Jaeger gRPC endpoint.</p>
</li>
<li class="listitem">
<p>Communication with <span class="strong strong"><strong>Jaeger Clients</strong></span> via thrift over HTTP</p>
<p>The Client HTTP endpoint does not support TLS.</p>
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>See the <a href="https://www.jaegertracing.io/docs/1.14/architecture" class="ulink" target="_top">Jaeger docs</a>
for more information on Jaeger architecture.</p>
</div>
</div>
<h3><a id="jaeger-get-started"></a>Get started<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h3>
<p>Connecting your preexisting Jaeger setup to Elastic APM is easy!
First, configure APM Server to receive Jaeger data,
then configure your Jaeger Agents or Jaeger Clients to start sending spans to APM Server.</p>
<h4><a id="jaeger-configure-apm-server"></a>Configure APM Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Enable the correct jaeger endpoint in the <code class="literal">apm-server.yml</code> configuration file.</p>
<p>In a typical Jaeger deployment, Clients send spans to Agents, who forward them to Collectors.
If this matches your architecture, enable the gRPC endpoint by setting
<code class="literal">apm-server.jaeger.grpc.enabled</code> to <code class="literal">true</code>.</p>
<p>Alternatively, if you&#8217;ve configured your Clients to send spans directly to Collectors (bypassing Jaeger Agents),
enable the HTTP endpoint by setting <code class="literal">apm-server.jaeger.http.enabled</code> to <code class="literal">true</code>.</p>
</li>
<li class="listitem">
<p>Configure the host and port that APM Server listens on.</p>
<p>Based on the endpoint enabled in the previous step, configure the relevant host and port:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">apm-server.jaeger.grpc.host</code> defaults to <code class="literal">localhost:14250</code>.
</li>
<li class="listitem">
<code class="literal">apm-server.jaeger.http.host</code> defaults to <code class="literal">localhost:14268</code>.
</li>
</ul>
</div>
</li>
</ol>
</div>
<h4><a id="jaeger-configure-sampling"></a>Configure Sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h4>
<p>The gRPC endpoint supports probabilistic sampling, which can be used to reduce the amount of data that your agents collect and send.
Probabilistic sampling makes a random sampling decision based on the configured sampling value.
For example, a value of <code class="literal">.2</code> means that 20% of traces will be sampled.</p>
<p>APM Server automatically enables the sampling endpoint when <code class="literal">grpc.enabled</code> is set to <code class="literal">true</code>.
There are two different ways to configure the sampling rate of your Jaeger Agents:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="jaeger.html#jaeger-configure-sampling-central" title="Central sampling">Centrally</a>, with APM Agent configuration (default).
</li>
<li class="listitem">
<a class="xref" href="jaeger.html#jaeger-configure-sampling-local" title="Local sampling">Locally</a>, in each Jaeger client.
</li>
</ul>
</div>
<h5><a id="jaeger-configure-sampling-central"></a>Central sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h5>
<p>Central sampling, with APM Agent configuration,
requires the <a class="xref" href="setup-kibana-endpoint.html" title="Configure the Kibana endpoint">Kibana endpoint</a> to be enabled.
This allows Jaeger clients to poll APM Server for the sampling rate.
To enable the kibana endpoint, set <a class="xref" href="setup-kibana-endpoint.html#kibana-enabled" title="apm-server.kibana.enabled"><code class="literal">apm-server.kibana.enabled</code></a> to <code class="literal">true</code>, and point <a class="xref" href="setup-kibana-endpoint.html#kibana-host" title="apm-server.kibana.host"><code class="literal">apm-server.kibana.host</code></a> at the Kibana host that APM Server will communicate with.</p>
<p>The default sampling ratio, as well as per-service sampling rates,
can then be configured via the <a href="/guide/en/kibana/master/agent-configuration.html" class="ulink" target="_top">Agent configuration</a> page in the APM app.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a sampling rate smaller than <code class="literal">1.0</code> (100%) is configured,
transactions per minute will be incorrectly calculated in the APM app.
This is because Elastic APM data model is fundamentally different from the Jaeger data model.
In the Elastic ecosystem, sampling only impacts spans; transactions are always sampled at 100%.
The Jaeger data structure, however, does not have the concept of transactions.
Because of this, sampling decisions will apply to both transactions and spans.</p>
</div>
</div>
<h5><a id="jaeger-configure-sampling-local"></a>Local sampling<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h5>
<p>If you don&#8217;t have access to the APM app,
you&#8217;ll need to change the Jaeger Client&#8217;s <code class="literal">sampler.type</code> and <code class="literal">sampler.param</code>,
enabling you to set the sampling configuration locally in each Client.
See the official <a href="https://www.jaegertracing.io/docs/1.17/sampling/" class="ulink" target="_top">Jaeger sampling documentation</a>
for more information.</p>
<h4><a id="jaeger-configure-grpc"></a>Configure Jaeger Agent communication with APM Server (gRPC)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h4>
<p>As of this writing, the Jaeger Agent binary offers the <code class="literal">--reporter.grpc.host-port</code> CLI flag,
which can be used to set a static list of collectors for the Jaeger Agent to connect to.
The <code class="literal">host:port</code> set here should correspond with the value set in <code class="literal">apm-server.jaeger.grpc.host</code>.</p>
<p>Jaeger Agent also offers the <code class="literal">--agent.tags</code> CLI flag, which can be used to pass Process tags
to the Collector. If APM Server has <code class="literal">apm-server.jaeger.grpc.auth_tag</code> set, it will look for a
Process tag of that name in incoming events, and use it for authorizing the Jaeger Agent against
the configured secret token or API Keys. The auth tag will not be removed from the events after
being verified.</p>
<p>See the <a href="https://www.jaegertracing.io/docs/1.16/cli/" class="ulink" target="_top">Jaeger CLI flags documentation</a> for more information.</p>
<h4><a id="jaeger-configure-http"></a>Configure Jaeger Client communication with APM Server (HTTP)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h4>
<p>If you&#8217;re using an officially supported Jaeger Client library and want to connect directly to APM Server,
you need to update the <code class="literal">JAEGER_ENDPOINT</code> configuration property.
This is the HTTP endpoint the Client will send spans to.
The <code class="literal">host:port</code> set here should correspond to the value set in <code class="literal">apm-server.jaeger.http.host</code>.</p>
<p>See the relevant supported Jaeger library for more information.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/jaegertracing/jaeger-client-go" class="ulink" target="_top">Go</a>
</li>
<li class="listitem">
<a href="https://github.com/jaegertracing/jaeger-client-java" class="ulink" target="_top">Java</a>
</li>
<li class="listitem">
<a href="https://github.com/jaegertracing/jaeger-client-node" class="ulink" target="_top">Node.js</a>
</li>
<li class="listitem">
<a href="https://github.com/jaegertracing/jaeger-client-python" class="ulink" target="_top">Python</a>
</li>
<li class="listitem">
<a href="https://github.com/jaegertracing/jaeger-client-cpp" class="ulink" target="_top">C++</a>
</li>
<li class="listitem">
<a href="https://github.com/jaegertracing/jaeger-client-csharp" class="ulink" target="_top">C#</a>
</li>
</ul>
</div>
<h4><a id="jaeger-configure-start"></a>Start sending span data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h4>
<p>Data sent from Jaeger Agents or Clients to APM Server should now be visible in the APM app!</p>
<h3><a id="jaeger-caveats"></a>Caveats<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h3>
<p>There are some limitations and differences between Elastic APM and Jaeger that you should be aware of.</p>
<p><span class="strong strong"><strong>Jaeger integration limitations:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Because Jaeger has its own trace context header, and does not currently support W3C trace context headers,
it is not possible to mix and match the use of Elastic&#8217;s APM Agents and Jaeger&#8217;s Clients.
</li>
<li class="listitem">
Elastic APM only supports probabilistic sampling. Because of differences in the Jaeger and Elastic data structures,
sampling at a value below <code class="literal">1.0</code> (100%), will cause inaccuracies in the APM app. See <a class="xref" href="jaeger.html#jaeger-configure-sampling" title="Configure Sampling">Configure Sampling</a> for more information.
</li>
<li class="listitem">
We currently only support exception logging. Span logs are not supported.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Differences between APM Agents and Jaeger Clients:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Jaeger Clients only sends trace data.
APM Agents support a larger number of features, like
multiple types of metrics, and application breakdown charts.
When using Jaeger, features like this will not be available in the APM app.
</li>
<li class="listitem">
<p>Elastic APM&#8217;s <a href="/guide/en/apm/get-started/master/apm-data-model.html" class="ulink" target="_top">data model</a> is different than Jaegers.
For Jaeger trace data to work with Elastic&#8217;s data model, we rely on spans being tagged with the appropriate
<a href="https://github.com/opentracing/specification/blob/master/semantic_conventions.md" class="ulink" target="_top"><code class="literal">span.kind</code></a>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Server Jaeger spans are mapped to Elastic APM <a href="/guide/en/apm/get-started/master/transactions.html" class="ulink" target="_top">transactions</a>.
</li>
<li class="listitem">
Client Jaeger spans are mapped to Elastic APM <a href="/guide/en/apm/get-started/master/transaction-spans.html" class="ulink" target="_top">spans</a>&#8201;&#8212;&#8201;unless the span is the root, in which case it is mapped to an Elastic APM <a href="/guide/en/apm/get-started/master/transactions.html" class="ulink" target="_top">transaction</a>.
</li>
</ul>
</div>
</li>
</ul>
</div>
<h3><a id="jaeger-configuration"></a>Configuration options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h3>
<p>You can specify the following options in the <code class="literal">apm-server.jaeger.*</code> section of the
<code class="literal">apm-server.yml</code> configuration file.</p>
<h5><a id="_grpc_enabled"></a><code class="literal">grpc.enabled</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h5>
<p>Set to true to enable the Jaeger gRPC collector service. Defaults to <code class="literal">false</code>.</p>
<h5><a id="_grpc_host"></a><code class="literal">grpc.host</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h5>
<p>Define the gRPC host and port the server is listening on.
Defaults to the standard Jaeger gRPC collector port <code class="literal">14250</code>.</p>
<h5><a id="_grpc_auth_tag"></a><code class="literal">grpc.auth_tag</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h5>
<p>Set to the name of the tag that should be used for authorizing Jaeger agents.
By default, authorization does not apply to Jaeger agents.</p>
<h5><a id="_http_enabled"></a><code class="literal">http.enabled</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h5>
<p>Set to true to enable the Jaeger HTTP collector endpoint. Defaults to <code class="literal">false</code>.</p>
<h5><a id="_http_host"></a><code class="literal">http.host</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/master/docs/jaeger-support.asciidoc">edit</a></h5>
<p>Define the HTTP host and port the server is listening on.
Defaults to the standard Jaeger HTTP collector port <code class="literal">14268</code>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="configuration-rum.html">« Set up Real User Monitoring (RUM) support</a>
</span>
<span class="next">
<a href="using-environ-vars.html">Use environment variables in the configuration »</a>
</span>
</div>
</div>
</body>
</html>
