<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configure dynamic field mappings and analyzers in an Elasticsearch index engine | App Search documentation [8.13] | Elastic</title>
<meta class="elastic" name="content" content="Configure dynamic field mappings and analyzers in an Elasticsearch index engine | App Search documentation [8.13]">

<link rel="home" href="index.html" title="App Search documentation [8.13]"/>
<link rel="up" href="guides.html" title="Guides"/>
<link rel="prev" href="elasticsearch-engines-create.html" title="Create Elasticsearch index engines"/>
<link rel="next" href="elasticsearch-engines-text-subfields-support-conventions.html" title="Elasticsearch engines text field conventions"/>
<meta class="elastic" name="product_version" content="8.13"/>
<meta class="elastic" name="product_name" content="App Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/App Search/Guide/8.13"/>
<meta name="DC.subject" content="App Search"/>
<meta name="DC.identifier" content="8.13"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
<div id="related-products" class="dropdown">
<div class="related-products-title"></div>
<div class="dropdown-anchor" tabindex="0">App Search<span class="dropdown-icon"></span></div>
<div class="dropdown-content">
<ul>
<li class="dropdown-category">Enterprise Search guides</li>
<ul>
<li><a href="/guide/en/enterprise-search/current/index.html" target="_blank">Enterprise Search</a></li>
<li><a href="/guide/en/app-search/current/index.html" target="_blank">App Search</a></li>
<li><a href="/guide/en/workplace-search/current/index.html" target="_blank">Workplace Search</a></li>
</ul>
<li class="dropdown-category">Programming language clients</li>
<ul>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/enterprise-search-node/current/index.html" target="_blank">Node.js client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/php/current/index.html" target="_blank">PHP client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/python/current/index.html" target="_blank">Python client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/ruby/current/index.html" target="_blank">Ruby client</a></li>
</ul>
</ul>
</div>
</div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="guides.html">Guides</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="elasticsearch-engines-create.html">« Create Elasticsearch index engines</a>
</span>
<span class="next">
<a href="elasticsearch-engines-text-subfields-support-conventions.html">Elasticsearch engines text field conventions »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="elasticsearch-engines-mappings-and-analyzers"></a>Configure dynamic field mappings and analyzers in an Elasticsearch index engine<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/app-search-docs/guides/elasticsearch-engines.asciidoc">edit</a></h2>
</div></div></div>
<p>In order to ensure that your Elasticsearch index engine supports all search types, it is recommended to configure dynamic field mappings and analyzers before any data is indexed.
The below snippets will set up the index with the mappings and analyzers that Engines have by default.</p>
<p>First close the index:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">POST my-index/_close</pre>
</div>
<p>Then create the analyzers:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">PUT my-index/_settings
{
  "analysis": {
    "filter": {
      "front_ngram": {
        "type": "edge_ngram",
        "min_gram": "1",
        "max_gram": "12"
      },
      "bigram_joiner": {
        "max_shingle_size": "2",
        "token_separator": "",
        "output_unigrams": "false",
        "type": "shingle"
      },
      "bigram_max_size": {
        "type": "length",
        "max": "16",
        "min": "0"
      },
      "en-stem-filter": {
        "name": "light_english",
        "type": "stemmer"
      },
      "bigram_joiner_unigrams": {
        "max_shingle_size": "2",
        "token_separator": "",
        "output_unigrams": "true",
        "type": "shingle"
      },
      "delimiter": {
        "split_on_numerics": "true",
        "generate_word_parts": "true",
        "preserve_original": "false",
        "catenate_words": "true",
        "generate_number_parts": "true",
        "catenate_all": "true",
        "split_on_case_change": "true",
        "type": "word_delimiter_graph",
        "catenate_numbers": "true",
        "stem_english_possessive": "true"
      },
      "en-stop-words-filter": {
        "type": "stop",
        "stopwords": "_english_"
      }
    },
    "analyzer": {
      "i_prefix": {
        "filter": [
          "cjk_width",
          "lowercase",
          "asciifolding",
          "front_ngram"
        ],
        "tokenizer": "standard"
      },
      "iq_text_delimiter": {
        "filter": [
          "delimiter",
          "cjk_width",
          "lowercase",
          "asciifolding",
          "en-stop-words-filter",
          "en-stem-filter"
        ],
        "tokenizer": "whitespace"
      },
      "q_prefix": {
        "filter": [
          "cjk_width",
          "lowercase",
          "asciifolding"
        ],
        "tokenizer": "standard"
      },
      "iq_text_base": {
        "filter": [
          "cjk_width",
          "lowercase",
          "asciifolding",
          "en-stop-words-filter"
        ],
        "tokenizer": "standard"
      },
      "iq_text_stem": {
        "filter": [
          "cjk_width",
          "lowercase",
          "asciifolding",
          "en-stop-words-filter",
          "en-stem-filter"
        ],
        "tokenizer": "standard"
      },
      "i_text_bigram": {
        "filter": [
          "cjk_width",
          "lowercase",
          "asciifolding",
          "en-stem-filter",
          "bigram_joiner",
          "bigram_max_size"
        ],
        "tokenizer": "standard"
      },
      "q_text_bigram": {
        "filter": [
          "cjk_width",
          "lowercase",
          "asciifolding",
          "en-stem-filter",
          "bigram_joiner_unigrams",
          "bigram_max_size"
        ],
        "tokenizer": "standard"
      }
    }
  }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This sample configuration uses English stemmer and stop word filters.
In order to support text analysis in a different language, replace <code class="literal">en-stem-filter</code> and <code class="literal">en-stop-words-filter</code> with the appropriate <a href="/guide/en/elasticsearch/reference/8.13/analysis-stemmer-tokenfilter.html" class="ulink" target="_top">stemmer</a> and <a href="/guide/en/elasticsearch/reference/8.13/analysis-stop-tokenfilter.html" class="ulink" target="_top">token filter</a>.</p>
</div>
</div>
<p>Create dynamic mappings:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">PUT my-index/_mappings
{
  "dynamic_templates": [
    {
      "permissions": {
        "match": "_*_permissions",
        "mapping": {
          "type": "keyword"
        }
      }
    },
    {
      "thumbnails": {
        "match": "_thumbnail_*",
        "mapping": {
          "type": "binary"
        }
      }
    },
    {
      "data": {
        "match_mapping_type": "*",
        "mapping": {
          "analyzer": "iq_text_base",
          "fields": {
            "date": {
              "format": "strict_date_time||strict_date",
              "ignore_malformed": true,
              "type": "date"
            },
            "prefix": {
              "search_analyzer": "q_prefix",
              "analyzer": "i_prefix",
              "type": "text",
              "index_options": "docs"
            },
            "delimiter": {
              "analyzer": "iq_text_delimiter",
              "type": "text",
              "index_options": "freqs"
            },
            "joined": {
              "search_analyzer": "q_text_bigram",
              "analyzer": "i_text_bigram",
              "type": "text",
              "index_options": "freqs"
            },
            "location": {
              "ignore_malformed": true,
              "type": "geo_point",
              "ignore_z_value": false
            },
            "float": {
              "ignore_malformed": true,
              "type": "double"
            },
            "enum": {
              "ignore_above": 2048,
              "type": "keyword"
            },
            "stem": {
              "analyzer": "iq_text_stem",
              "type": "text"
            }
          },
          "index_options": "freqs",
          "type": "text"
        }
      }
    }
  ]
}</pre>
</div>
<p>Finally reopen the index:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">POST my-index/_open</pre>
</div>
<p>As an alternative to the above steps you can also configure an index template that automatically sets the required analyzers and mappings for searchable fields. This needs to be done <em>before</em> the index is created.</p>
<details>
<summary class="title">Create index template</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">PUT _index_template/my-index-template
{
  "index_patterns": ["my-index*"],
  "template": {
    "settings": {
      "analysis": {
        "filter": {
          "front_ngram": {
            "type": "edge_ngram",
            "min_gram": "1",
            "max_gram": "12"
          },
          "bigram_joiner": {
            "max_shingle_size": "2",
            "token_separator": "",
            "output_unigrams": "false",
            "type": "shingle"
          },
          "bigram_max_size": {
            "type": "length",
            "max": "16",
            "min": "0"
          },
          "en-stem-filter": {
            "name": "light_english",
            "type": "stemmer"
          },
          "bigram_joiner_unigrams": {
            "max_shingle_size": "2",
            "token_separator": "",
            "output_unigrams": "true",
            "type": "shingle"
          },
          "delimiter": {
            "split_on_numerics": "true",
            "generate_word_parts": "true",
            "preserve_original": "false",
            "catenate_words": "true",
            "generate_number_parts": "true",
            "catenate_all": "true",
            "split_on_case_change": "true",
            "type": "word_delimiter_graph",
            "catenate_numbers": "true",
            "stem_english_possessive": "true"
          },
          "en-stop-words-filter": {
            "type": "stop",
            "stopwords": "_english_"
          }
        },
        "analyzer": {
          "i_prefix": {
            "filter": [
              "cjk_width",
              "lowercase",
              "asciifolding",
              "front_ngram"
            ],
            "tokenizer": "standard"
          },
          "iq_text_delimiter": {
            "filter": [
              "delimiter",
              "cjk_width",
              "lowercase",
              "asciifolding",
              "en-stop-words-filter",
              "en-stem-filter"
            ],
            "tokenizer": "whitespace"
          },
          "q_prefix": {
            "filter": [
              "cjk_width",
              "lowercase",
              "asciifolding"
            ],
            "tokenizer": "standard"
          },
          "iq_text_base": {
            "filter": [
              "cjk_width",
              "lowercase",
              "asciifolding",
              "en-stop-words-filter"
            ],
            "tokenizer": "standard"
          },
          "iq_text_stem": {
            "filter": [
              "cjk_width",
              "lowercase",
              "asciifolding",
              "en-stop-words-filter",
              "en-stem-filter"
            ],
            "tokenizer": "standard"
          },
          "i_text_bigram": {
            "filter": [
              "cjk_width",
              "lowercase",
              "asciifolding",
              "en-stem-filter",
              "bigram_joiner",
              "bigram_max_size"
            ],
            "tokenizer": "standard"
          },
          "q_text_bigram": {
            "filter": [
              "cjk_width",
              "lowercase",
              "asciifolding",
              "en-stem-filter",
              "bigram_joiner_unigrams",
              "bigram_max_size"
            ],
            "tokenizer": "standard"
          }
        }
      }
    },
    "mappings": {
      "dynamic_templates": [
        {
          "permissions": {
            "match": "_*_permissions",
            "mapping": {
              "type": "keyword"
            }
          }
        },
        {
          "thumbnails": {
            "match": "_thumbnail_*",
            "mapping": {
              "type": "binary"
            }
          }
        },
        {
          "data": {
            "match_mapping_type": "*",
            "mapping": {
              "analyzer": "iq_text_base",
              "fields": {
                "date": {
                  "format": "strict_date_time||strict_date",
                  "ignore_malformed": true,
                  "type": "date"
                },
                "prefix": {
                  "search_analyzer": "q_prefix",
                  "analyzer": "i_prefix",
                  "type": "text",
                  "index_options": "docs"
                },
                "delimiter": {
                  "analyzer": "iq_text_delimiter",
                  "type": "text",
                  "index_options": "freqs"
                },
                "joined": {
                  "search_analyzer": "q_text_bigram",
                  "analyzer": "i_text_bigram",
                  "type": "text",
                  "index_options": "freqs"
                },
                "location": {
                  "ignore_malformed": true,
                  "type": "geo_point",
                  "ignore_z_value": false
                },
                "float": {
                  "ignore_malformed": true,
                  "type": "double"
                },
                "enum": {
                  "ignore_above": 2048,
                  "type": "keyword"
                },
                "stem": {
                  "analyzer": "iq_text_stem",
                  "type": "text"
                }
              },
              "index_options": "freqs",
              "type": "text"
            }
          }
        }
      ]
    }
  },
  "_meta": {
    "description": "Template for Elasticsearch index engine"
  }
}</pre>
</div>
</div>
</details>
<p>Then create your index with a name that matches the template&#8217;s pattern.</p>
<p>For more information about index templates please refer to the <a href="/guide/en/elasticsearch/reference/8.13/index-templates.html" class="ulink" target="_top">documentation</a>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="elasticsearch-engines-create.html">« Create Elasticsearch index engines</a>
</span>
<span class="next">
<a href="elasticsearch-engines-text-subfields-support-conventions.html">Elasticsearch engines text field conventions »</a>
</span>
</div>
</div>
</body>
</html>
