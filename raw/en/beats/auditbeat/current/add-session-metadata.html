<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Add session metadata | Auditbeat Reference [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Add session metadata | Auditbeat Reference [8.18]">

<link rel="home" href="index.html" title="Auditbeat Reference [8.18]"/>
<link rel="up" href="filtering-and-enhancing-data.html" title="Filter and enhance data with processors"/>
<link rel="prev" href="add-process-metadata.html" title="Add process metadata"/>
<link rel="next" href="add-tags.html" title="Add tags"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Auditbeat"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Auditbeat/Reference/8.18"/>
<meta name="DC.subject" content="Auditbeat"/>
<meta name="DC.identifier" content="8.18"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="add-process-metadata.html">« Add process metadata</a>
</span>
<span class="next">
<a href="add-tags.html">Add tags »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Auditbeat Reference [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-auditbeat.html">Configure Auditbeat</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="filtering-and-enhancing-data.html">Filter and enhance data with processors</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Add session metadata</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.18/x-pack/auditbeat/processors/sessionmd/docs/add_session_metadata.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    A newer version is available. Check out the <a href="https://www.elastic.co/docs/reference/beats/auditbeat/add-session-metadata">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="add-session-metadata"></a>Add session metadata</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.18/x-pack/auditbeat/processors/sessionmd/docs/add_session_metadata.asciidoc">edit</a></div>
</div></div></div>

<p>The <code class="literal">add_session_metadata</code> processor enriches process events with additional
information that users can see using the <a href="/guide/en/security/8.18/session-view.html" class="ulink" target="_top">Session View</a> tool in the
Elastic Security platform.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The current release of <code class="literal">add_session_metadata</code> processor for Auditbeat is limited to virtual machines (VMs) and bare metal environments.</p>
</div>
</div>
<p>Here&#8217;s an example using the <code class="literal">add_session_metadata</code> processor to enhance process events generated by
the <code class="literal">auditd</code> module of Auditbeat.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">auditbeat.modules:
- module: auditd
  processors:
    - add_session_metadata:
       backend: "auto"</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="add-session-metadata-explained"></a>How the <code class="literal">add_session_metadata</code> processor works</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.18/x-pack/auditbeat/processors/sessionmd/docs/add_session_metadata.asciidoc">edit</a></div>
</div></div></div>
<p>Using the available Linux kernel technology, the processor collects comprehensive information on all running system processes, compiling this data into a process database.
When processing an event (such as those generated by the Auditbeat <code class="literal">auditd</code> module), the processor queries this database to retrieve information about related processes, including the parent process, session leader, process group leader, and entry leader.
It then enriches the original event with this metadata, providing a more complete picture of process relationships and system activities.</p>
<p>This enhanced data enables the powerful <a href="/guide/en/security/8.18/session-view.html" class="ulink" target="_top">Session View</a> tool in the
Elastic Security platform, offering users deeper insights for analysis and investigation.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="add-session-metadata-backends"></a>Backends</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.18/x-pack/auditbeat/processors/sessionmd/docs/add_session_metadata.asciidoc">edit</a></div>
</div></div></div>
<p>The <code class="literal">add_session_metadata</code> processor operates using various backend options.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">auto</code> is the recommended setting.
It attempts to use <code class="literal">kernel_tracing</code> first, falling back to <code class="literal">procfs</code> if necessary, ensuring compatibility even on systems without <code class="literal">kernel_tracing</code> support.
</li>
<li class="listitem">
<code class="literal">kernel_tracing</code> gathers information about processes using either eBPF or kprobes.
It will use eBPF if available, but if not, it will fall back to kprobes. eBPF requires a system with kernel support for eBPF enabled, support for eBPF ring buffer, and auditbeat running as superuser.
Kprobe support requires Linux kernel 3.10.0 or above, and auditbeat running as a superuser.
</li>
<li class="listitem">
<code class="literal">procfs</code> collects process information with the proc filesystem.
This is compatible with older systems that may not support ebpf.
  To gather complete process info, auditbeat requires permissions to read all process data in procfs; for example, run as a superuser or have the <code class="literal">SYS_PTRACE</code> capability.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="add-session-metadata-containers"></a>Containers</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.18/x-pack/auditbeat/processors/sessionmd/docs/add_session_metadata.asciidoc">edit</a></div>
</div></div></div>
<p>If you are running Auditbeat in a container, the container must run in the host&#8217;s PID namespace.
With the <code class="literal">auto</code> or <code class="literal">kernel_tracing</code> backend, these host directories must also be mounted to the same path within the container: <code class="literal">/sys/kernel/debug</code>, <code class="literal">/sys/fs/bpf</code>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="add-session-metadata-enable"></a>Enable and configure Session View in Auditbeat</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.18/x-pack/auditbeat/processors/sessionmd/docs/add_session_metadata.asciidoc">edit</a></div>
</div></div></div>
<p>To configure and enable <a href="/guide/en/security/8.18/session-view.html" class="ulink" target="_top">Session View</a> functionality, you&#8217;ll:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add the <code class="literal">add_sessions_metadata</code> processor to your <code class="literal">auditbeat.yml</code> file.
</li>
<li class="listitem">
Configure audit rules in your <code class="literal">auditbeat.yml</code> file.
</li>
<li class="listitem">
Restart Auditbeat.
</li>
</ul>
</div>
<p>We&#8217;ll walk you through these steps in more detail.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Edit your <code class="literal">auditbeat.yml</code> file and add this info to the modules configuration section:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">auditbeat.modules:
- module: auditd
  processors:
    - add_session_metadata:
        backend: "auto"</pre>
</div>
</li>
<li class="listitem">
<p>Add audit rules in the modules configuration section of <code class="literal">auditbeat.yml</code> or the
<code class="literal">audit.rules.d</code> config file, depending on your configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">auditbeat.modules:
- module: auditd
  audit_rules: |
    ## executions
    -a always,exit -F arch=b64 -S execve,execveat -k exec
    -a always,exit -F arch=b64 -S exit_group
    ## set_sid
    -a always,exit -F arch=b64 -S setsid</pre>
</div>
</li>
<li class="listitem">
Save your configuration changes.
</li>
<li class="listitem">
<p>Restart Auditbeat:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo systemctl restart auditbeat</pre>
</div>
</li>
</ol>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_configuring_the_process_database"></a>Configuring the Process Database</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.18/x-pack/auditbeat/processors/sessionmd/docs/add_session_metadata.asciidoc">edit</a></div>
</div></div></div>
<p>When using the <code class="literal">procfs</code> backend, <code class="literal">add_session_metadata</code> will use an in-memory database to store and match events as they arrive to the processor.
This processor has a number of additional config values:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">auditbeat.modules:
- module: auditd
  processors:
    - add_session_metadata:
        backend: "procfs"
        reap_processes: false
        db_reaper_period: 30s</pre>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">reap_processes</code> tells the database to remove orphan <code class="literal">execve</code> and <code class="literal">execveat</code> process events for which no matching <code class="literal">exit_group</code> event is found.
This may result in incomplete data, but will reduce memory usage under high load. The default is <code class="literal">false</code>.
</li>
<li class="listitem">
<code class="literal">db_reaper_period</code> specifies the time interval of the reaper process that will regularly remove exited and orphaned processes from the database.
Setting this value lower my result in incomplete data, but will reduce memory pressure. Setting this to a higher value may help on systems with high load, but will increase memory usage.
The default is <code class="literal">30s.</code>
</li>
</ul>
</div>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="add-process-metadata.html">« Add process metadata</a>
</span>
<span class="next">
<a href="add-tags.html">Add tags »</a>
</span>
</div>
</body>
</html>
