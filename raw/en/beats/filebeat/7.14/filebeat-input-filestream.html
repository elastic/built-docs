<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>filestream input | Filebeat Reference [7.14] | Elastic</title>
<link rel="home" href="index.html" title="Filebeat Reference [7.14]"/>
<link rel="up" href="configuration-filebeat-options.html" title="Configure inputs"/>
<link rel="prev" href="filebeat-input-docker.html" title="Docker input"/>
<link rel="next" href="_log_rotation.html" title="Log rotation"/>
<meta name="DC.type" content="Learn/Docs/Filebeat/Reference/7.14"/>
<meta name="DC.subject" content="Filebeat"/>
<meta name="DC.identifier" content="7.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Filebeat Reference [7.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-filebeat.html">Configure Filebeat</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuration-filebeat-options.html">Configure inputs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="filebeat-input-docker.html">« Docker input</a>
</span>
<span class="next">
<a href="_log_rotation.html">Log rotation »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="filebeat-input-filestream"></a>filestream input<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream.asciidoc">edit</a></h2>
</div></div></div>

<p>Use the <code class="literal">filestream</code> input to read lines from active log files. It is the
new, improved alternative to the <code class="literal">log</code> input. It comes with various improvements
to the existing input:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Checking of <code class="literal">close_*</code> options happens out of band. Thus, if an output is blocked,
Filebeat can close the reader and avoid keeping too many files open.
</li>
<li class="listitem">
Detailed metrics are available for all files that match the <code class="literal">paths</code> configuration
regardless of the <code class="literal">harvester_limit</code>. This way, you can keep track of all files,
even ones that are not actively read.
</li>
<li class="listitem">
The order of <code class="literal">parsers</code> is configurable. So it is possible to parse JSON lines and then
aggregate the contents into a multiline event.
</li>
<li class="listitem">
Some position updates and metadata changes no longer depend on the publishing pipeline.
If the pipeline is blocked some changes are still applied to the registry.
</li>
<li class="listitem">
Only the most recent updates are serialized to the registry. In contrast, the <code class="literal">log</code> input
has to serialize the complete registry on each ACK from the outputs. This makes the registry updates
much quicker with this input.
</li>
<li class="listitem">
The input ensures that only offsets updates are written to the registry append only log.
The <code class="literal">log</code> writes the complete file state.
</li>
<li class="listitem">
Stale entries can be removed from the registry, even if there is no active input.
</li>
</ol>
</div>
<p>To configure this input, specify a list of glob-based <a class="xref" href="filebeat-input-filestream.html#filestream-input-paths" title="paths"><code class="literal">paths</code></a>
that must be crawled to locate and fetch the log lines.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: filestream
  paths:
    - /var/log/messages
    - /var/log/*.log</pre>
</div>
<p>You can apply additional
<a class="xref" href="filebeat-input-filestream.html#filebeat-input-filestream-options" title="Prospector options">configuration settings</a> (such as <code class="literal">fields</code>,
<code class="literal">include_lines</code>, <code class="literal">exclude_lines</code> and so on) to the lines harvested
from these files. The options that you specify are applied to all the files
harvested by this input.</p>
<p>To apply different configuration settings to different files, you need to define
multiple input sections:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: filestream <a id="CO15-1"></a><i class="conum" data-value="1"></i>
  paths:
    - /var/log/system.log
    - /var/log/wifi.log
- type: filestream <a id="CO15-2"></a><i class="conum" data-value="2"></i>
  paths:
    - "/var/log/apache2/*"
  fields:
    apache: true</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO15-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Harvests lines from two files:  <code class="literal">system.log</code> and
<code class="literal">wifi.log</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO15-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Harvests lines from every file in the <code class="literal">apache2</code> directory, and uses the
<code class="literal">fields</code> configuration option to add a field called <code class="literal">apache</code> to the output.</p>
</td>
</tr>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="filestream-file-identity"></a>Reading files on network shares and cloud providers<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream.asciidoc">edit</a></h3>
</div></div></div>
<p>However, one of the limitations of these data sources can be mitigated
if you configure Filebeat adequately.</p>
<p>By default, Filebeat identifies files based on their inodes and
device IDs. However, on network shares and cloud providers these
values might change during the lifetime of the file. If this happens
Filebeat thinks that file is new and resends the whole content
of the file. To solve this problem you can configure <code class="literal">file_identity</code> option. Possible
values besides the default <code class="literal">inode_deviceid</code> are <code class="literal">path</code> and <code class="literal">inode_marker</code>.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Changing <code class="literal">file_identity</code> methods between runs may result in
duplicated events in the output.</p>
</div>
</div>
<p>Selecting <code class="literal">path</code> instructs Filebeat to identify files based on their
paths. This is a quick way to avoid rereading files if inode and device ids
might change. However, keep in mind if the files are rotated (renamed), they
will be reread and resubmitted.</p>
<p>The option <code class="literal">inode_marker</code> can be used if the inodes stay the same even if
the device id is changed. You should choose this method if your files are
rotated instead of <code class="literal">path</code> if possible. You have to configure a marker file
readable by Filebeat and set the path in the option <code class="literal">path</code> of <code class="literal">inode_marker</code>.</p>
<p>The content of this file must be unique to the device. You can put the
UUID of the device or mountpoint where the input is stored. The following
example oneliner generates a hidden marker file for the selected mountpoint <code class="literal">/logs</code>:
Please note that you should not use this option on Windows as file identifiers might be
more volatile.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ lsblk -o MOUNTPOINT,UUID | grep /logs | awk '{print $2}' &gt;&gt; /logs/.filebeat-marker</pre>
</div>
<p>To set the generated file as a marker for <code class="literal">file_identity</code> you should configure
the input the following way:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: filestream
  paths:
    - /logs/*.log
  file_identity.inode_marker.path: /logs/.filebeat-marker</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="filestream-rotating-logs"></a>Reading from rotating logs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream.asciidoc">edit</a></h3>
</div></div></div>
<p>When dealing with file rotation, avoid harvesting symlinks. Instead
use the <a class="xref" href="filebeat-input-filestream.html#filestream-input-paths" title="paths"><code class="literal">paths</code></a> setting to point to the original file, and specify
a pattern that matches the file you want to harvest and all of its rotated
files. Also make sure your log rotation strategy prevents lost or duplicate
messages. For more information, see <a class="xref" href="file-log-rotation.html" title="Log rotation results in lost or duplicate events">Log rotation results in lost or duplicate events</a>.</p>
<p>Furthermore, to avoid duplicate of rotated log messages, do not use the
<code class="literal">path</code> method for <code class="literal">file_identity</code>. Or exclude the rotated files with <code class="literal">exclude_files</code>
option.</p>
<h3><a id="filebeat-input-filestream-options"></a>Prospector options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h3>
<p>The prospector is running a file system watcher which looks for files specified
in the <code class="literal">paths</code> option. At the moment only simple file system scanning is
supported.</p>
<h5><a id="filestream-input-paths"></a><code class="literal">paths</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>A list of glob-based paths that will be crawled and fetched. All patterns
supported by <a href="https://golang.org/pkg/path/filepath/#Glob" class="ulink" target="_top">Go Glob</a> are also
supported here. For example, to fetch all files from a predefined level of
subdirectories, the following pattern can be used: <code class="literal">/var/log/*/*.log</code>. This
fetches all <code class="literal">.log</code> files from the subfolders of <code class="literal">/var/log</code>. It does not
fetch log files from the <code class="literal">/var/log</code> folder itself.
It is possible to recursively fetch all files in all subdirectories of a directory
using the optional <a class="xref" href="filebeat-input-filestream.html#filestream-recursive-glob" title="prospector.scanner.recursive_glob"><code class="literal">recursive_glob</code></a> settings.</p>
<p>Filebeat starts a harvester for each file that it finds under the specified
paths. You can specify one path per line. Each line begins with a dash (-).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_scanner_options"></a>Scanner options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h3>
</div></div></div>
<p>The scanner watches the configured paths. It scans the file system periodically
and returns the file system events to the Prospector.</p>
<h5><a id="filestream-recursive-glob"></a><code class="literal">prospector.scanner.recursive_glob</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>Enable expanding <code class="literal">**</code> into recursive glob patterns. With this feature enabled,
the rightmost <code class="literal">**</code> in each path is expanded into a fixed number of glob
patterns. For example: <code class="literal">/foo/**</code> expands to <code class="literal">/foo</code>, <code class="literal">/foo/*</code>, <code class="literal">/foo/*/*</code>, and so
on. If enabled it expands a single <code class="literal">**</code> into a 8-level deep <code class="literal">*</code> pattern.</p>
<p>This feature is enabled by default. Set <code class="literal">prospector.scanner.recursive_glob</code> to false to
disable it.</p>
<h5><a id="filebeat-input-filestream-exclude-files"></a><code class="literal">prospector.scanner.exclude_files</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>A list of regular expressions to match the files that you want Filebeat to
ignore. By default no files are excluded.</p>
<p>The following example configures Filebeat to ignore all the files that have
a <code class="literal">gz</code> extension:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: filestream
  ...
  prospector.scanner.exclude_files: ['\.gz$']</pre>
</div>
<p>See <a class="xref" href="regexp-support.html" title="Regular expression support"><em>Regular expression support</em></a> for a list of supported regexp patterns.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prospector_scanner_include_files"></a><code class="literal">prospector.scanner.include_files</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h4>
</div></div></div>
<p>A list of regular expressions to match the files that you want Filebeat to
include. If a list of regexes is provided, only the files that are allowed by
the patterns are harvested.</p>
<p>By default no files are excluded. This option is the counterpart of
<code class="literal">prospector.scanner.exclude_files</code>.</p>
<p>The following example configures Filebeat to exclude files that
are not under <code class="literal">/var/log</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: filestream
  ...
  prospector.scanner.include_files: ['^/var/log/.*']</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Patterns should start with <code class="literal">^</code> in case of absolute paths.</p>
</div>
</div>
<p>See <a class="xref" href="regexp-support.html" title="Regular expression support"><em>Regular expression support</em></a> for a list of supported regexp patterns.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prospector_scanner_symlinks"></a><code class="literal">prospector.scanner.symlinks</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">symlinks</code> option allows Filebeat to harvest symlinks in addition to
regular files. When harvesting symlinks, Filebeat opens and reads the
original file even though it reports the path of the symlink.</p>
<p>When you configure a symlink for harvesting, make sure the original path is
excluded. If a single input is configured to harvest both the symlink and
the original file, Filebeat will detect the problem and only process the
first file it finds. However, if two different inputs are configured (one
to read the symlink and the other the original path), both paths will be
harvested, causing Filebeat to send duplicate data and the inputs to
overwrite each other&#8217;s state.</p>
<p>The <code class="literal">symlinks</code> option can be useful if symlinks to the log files have additional
metadata in the file name, and you want to process the metadata in Logstash.
This is, for example, the case for Kubernetes log files.</p>
<p>Because this option may lead to data loss, it is disabled by default.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prospector_scanner_resend_on_touch"></a><code class="literal">prospector.scanner.resend_on_touch</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h4>
</div></div></div>
<p>If this option is enabled a file is resent if its size has not changed
but its modification time has changed to a later time than before.
It is disabled by default to avoid accidentally resending files.</p>
<h5><a id="filebeat-input-filestream-scan-frequency"></a><code class="literal">prospector.scanner.check_interval</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>How often Filebeat checks for new files in the paths that are specified
for harvesting. For example, if you specify a glob like <code class="literal">/var/log/*</code>, the
directory is scanned for files using the frequency specified by
<code class="literal">check_interval</code>. Specify 1s to scan the directory as frequently as possible
without causing Filebeat to scan too frequently. We do not recommend to set
this value <code class="literal">&lt;1s</code>.</p>
<p>If you require log lines to be sent in near real time do not use a very low
<code class="literal">check_interval</code> but adjust <code class="literal">close.on_state_change.inactive</code> so the file handler
stays open and constantly polls your files.</p>
<p>The default setting is 10s.</p>
<h5><a id="filebeat-input-filestream-ignore-older"></a><code class="literal">ignore_older</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>If this option is enabled, Filebeat ignores any files that were modified
before the specified timespan. Configuring <code class="literal">ignore_older</code> can be especially
useful if you keep log files for a long time. For example, if you want to start
Filebeat, but only want to send the newest files and files from last week,
you can configure this option.</p>
<p>You can use time strings like 2h (2 hours) and 5m (5 minutes). The default is 0,
which disables the setting. Commenting out the config has the same effect as
setting it to 0.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must set <code class="literal">ignore_older</code> to be greater than <code class="literal">close.on_state_change.inactive</code>.</p>
</div>
</div>
<p>The files affected by this setting fall into two categories:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Files that were never harvested
</li>
<li class="listitem">
Files that were harvested but weren&#8217;t updated for longer than <code class="literal">ignore_older</code>
</li>
</ul>
</div>
<p>For files which were never seen before, the offset state is set to the end of
the file. If a state already exists, the offset is not changed. If a file is
updated again later, reading continues at the set offset position.</p>
<p>The <code class="literal">ignore_older</code> setting relies on the modification time of the file to
determine if a file is ignored. If the modification time of the file is not
updated when lines are written to a file (which can happen on Windows), the
<code class="literal">ignore_older</code> setting may cause Filebeat to ignore files even though
content was added at a later time.</p>
<p>To remove the state of previously harvested files from the registry file, use
the <code class="literal">clean_inactive</code> configuration option.</p>
<p>Before a file can be ignored by Filebeat, the file must be closed. To
ensure a file is no longer being harvested when it is ignored, you must set
<code class="literal">ignore_older</code> to a longer duration than <code class="literal">close.on_state_change.inactive</code>.</p>
<p>If a file that&#8217;s currently being harvested falls under <code class="literal">ignore_older</code>, the
harvester will first finish reading the file and close it after
<code class="literal">close.on_state_change.inactive</code> is reached. Then, after that, the file will be ignored.</p>
<h5><a id="filebeat-input-filestream-ignore-inactive"></a><code class="literal">ignore_inactive</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>If this option is enabled, Filebeat ignores every file that has not been
updated since the selected time. Possible options are <code class="literal">since_first_start</code> and
<code class="literal">since_last_start</code>. The first option ignores every file that has not been updated since
the first start of Filebeat. It is useful when the Beat might be restarted
due to configuration changes or a failure. The second option tells
the Beat to read from files that have been updated since its start.</p>
<p>The files affected by this setting fall into two categories:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Files that were never harvested
</li>
<li class="listitem">
Files that were harvested but weren&#8217;t updated since <code class="literal">ignore_inactive</code>.
</li>
</ul>
</div>
<p>For files that were never seen before, the offset state is set to the end of
the file. If a state already exist, the offset is not changed. In case a file is
updated again later, reading continues at the set offset position.</p>
<p>The setting relies on the modification time of the file to
determine if a file is ignored. If the modification time of the file is not
updated when lines are written to a file (which can happen on Windows), the
setting may cause Filebeat to ignore files even though content was added
at a later time.</p>
<p>To remove the state of previously harvested files from the registry file, use
the <code class="literal">clean_inactive</code> configuration option.</p>
<h5><a id="filebeat-input-filestream-close-options"></a><code class="literal">close.*</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>The <code class="literal">close.*</code> configuration options are used to close the harvester after a
certain criteria or time. Closing the harvester means closing the file handler.
If a file is updated after the harvester is closed, the file will be picked up
again after <code class="literal">prospector.scanner.check_interval</code> has elapsed. However, if the file
is moved or deleted while the harvester is closed, Filebeat will not be able
to pick up the file again, and any data that the harvester hasn&#8217;t read will be lost.</p>
<p>The <code class="literal">close.on_state_change.*</code> settings are applied asynchronously
to read from a file, meaning that if Filebeat is in a blocked state
due to blocked output, full queue or other issue, a file that would be
closed regardless.</p>
<h5><a id="filebeat-input-filestream-close-inactive"></a><code class="literal">close.on_state_change.inactive</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>When this option is enabled, Filebeat closes the file handle if a file has
not been harvested for the specified duration. The counter for the defined
period starts when the last log line was read by the harvester. It is not based
on the modification time of the file. If the closed file changes again, a new
harvester is started and the latest changes will be picked up after
<code class="literal">prospector.scanner.check_interval</code> has elapsed.</p>
<p>We recommended that you set <code class="literal">close.on_state_change.inactive</code> to a value that is
larger than the least frequent updates to your log files. For example, if your
log files get updated every few seconds, you can safely set
<code class="literal">close.on_state_change.inactive</code> to <code class="literal">1m</code>. If there are log files with very
different update rates, you can use multiple configurations with different values.</p>
<p>Setting <code class="literal">close.on_state_change.inactive</code> to a lower value means that file handles
are closed sooner. However this has the side effect that new log lines are not
sent in near real time if the harvester is closed.</p>
<p>The timestamp for closing a file does not depend on the modification time of the
file. Instead, Filebeat uses an internal timestamp that reflects when the
file was last harvested. For example, if <code class="literal">close.on_state_change.inactive</code> is set
to 5 minutes, the countdown for the 5 minutes starts after the harvester reads the
last line of the file.</p>
<p>You can use time strings like 2h (2 hours) and 5m (5 minutes). The default is
5m.</p>
<h5><a id="filebeat-input-filestream-close-renamed"></a><code class="literal">close.on_state_change.renamed</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only use this option if you understand that data loss is a potential
side effect.</p>
</div>
</div>
<p>When this option is enabled, Filebeat closes the file handler when a file
is renamed. This happens, for example, when rotating files. By default, the
harvester stays open and keeps reading the file because the file handler does
not depend on the file name. If the <code class="literal">close.on_state_change.renamed</code> option is
enabled and the file is renamed or moved in such a way that it&#8217;s no longer
matched by the file patterns specified for the , the file will not be picked
up again. Filebeat will not finish reading the file.</p>
<p>Do not use this option when <code class="literal">path</code> based <code class="literal">file_identity</code> is configured. It does
not make sense to enable the option, as Filebeat cannot detect renames using
path names as unique identifiers.</p>
<p>WINDOWS: If your Windows log rotation system shows errors because it can&#8217;t
rotate the files, you should enable this option.</p>
<h5><a id="filebeat-input-filestream-close-removed"></a><code class="literal">close.on_state_change.removed</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>When this option is enabled, Filebeat closes the harvester when a file is
removed. Normally a file should only be removed after it&#8217;s inactive for the
duration specified by <code class="literal">close.on_state_change.inactive</code>. However, if a file is
removed early and you don&#8217;t enable <code class="literal">close.on_state_change.removed</code>, Filebeat
keeps the file open to make sure the harvester has completed. If this setting
results in files that are not completely read because they are removed from
disk too early, disable this option.</p>
<p>This option is enabled by default. If you disable this option, you must also
disable <code class="literal">clean.on_state_change.removed</code>.</p>
<p>WINDOWS: If your Windows log rotation system shows errors because it can&#8217;t
rotate files, make sure this option is enabled.</p>
<h5><a id="filebeat-input-filestream-close-eof"></a><code class="literal">close.reader.eof</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only use this option if you understand that data loss is a potential
side effect.</p>
</div>
</div>
<p>When this option is enabled, Filebeat closes a file as soon as the end of a
file is reached. This is useful when your files are only written once and not
updated from time to time. For example, this happens when you are writing every
single log event to a new file. This option is disabled by default.</p>
<h5><a id="filebeat-input-filestream-close-timeout"></a><code class="literal">close.reader.after_interval</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only use this option if you understand that data loss is a potential
side effect. Another side effect is that multiline events might not be
completely sent before the timeout expires.</p>
</div>
</div>
<p>When this option is enabled, Filebeat gives every harvester a predefined
lifetime. Regardless of where the reader is in the file, reading will stop after
the <code class="literal">close.reader.after_interval</code> period has elapsed. This option can be useful for older log
files when you want to spend only a predefined amount of time on the files.
While <code class="literal">close.reader.after_interval</code> will close the file after the predefined timeout, if the
file is still being updated, Filebeat will start a new harvester again per
the defined <code class="literal">scan_frequency</code>. And the close.reader.after_interval for this harvester will
start again with the countdown for the timeout.</p>
<p>This option is particularly useful in case the output is blocked, which makes
Filebeat keep open file handlers even for files that were deleted from the
disk. Setting <code class="literal">close.reader.after_interval</code> to <code class="literal">5m</code> ensures that the files are periodically
closed so they can be freed up by the operating system.</p>
<p>If you set <code class="literal">close.reader.after_interval</code> to equal <code class="literal">ignore_older</code>, the file will not be picked
up if it&#8217;s modified while the harvester is closed. This combination of settings
normally leads to data loss, and the complete file is not sent.</p>
<p>When you use <code class="literal">close.reader.after_interval</code> for logs that contain multiline events, the
harvester might stop in the middle of a multiline event, which means that only
parts of the event will be sent. If the harvester is started again and the file
still exists, only the second part of the event will be sent.</p>
<p>This option is set to 0 by default which means it is disabled.</p>
<h5><a id="filebeat-input-filestream-clean-options"></a><code class="literal">clean_*</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>The <code class="literal">clean_*</code> options are used to clean up the state entries in the registry
file. These settings help to reduce the size of the registry file and can
prevent a potential <a class="xref" href="inode-reuse-issue.html" title="Inode reuse causes Filebeat to skip lines">inode reuse issue</a>.</p>
<h5><a id="filebeat-input-filestream-clean-inactive"></a><code class="literal">clean_inactive</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only use this option if you understand that data loss is a potential
side effect.</p>
</div>
</div>
<p>When this option is enabled, Filebeat removes the state of a file after the
specified period of inactivity has elapsed. The  state can only be removed if
the file is already ignored by Filebeat (the file is older than
<code class="literal">ignore_older</code>). The <code class="literal">clean_inactive</code> setting must be greater than <code class="literal">ignore_older +
scan_frequency</code> to make sure that no states are removed while a file is still
being harvested. Otherwise, the setting could result in Filebeat resending
the full content constantly because  <code class="literal">clean_inactive</code> removes state for files
that are still detected by Filebeat. If a file is updated or appears
again, the file is read from the beginning.</p>
<p>The <code class="literal">clean_inactive</code> configuration option is useful to reduce the size of the
registry file, especially if a large amount of new files are generated every
day.</p>
<p>This config option is also useful to prevent Filebeat problems resulting
from inode reuse on Linux. For more information, see <a class="xref" href="inode-reuse-issue.html" title="Inode reuse causes Filebeat to skip lines">Inode reuse causes Filebeat to skip lines</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Every time a file is renamed, the file state is updated and the counter
for <code class="literal">clean_inactive</code> starts at 0 again.</p>
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>During testing, you might notice that the registry contains state entries
that should be removed based on the <code class="literal">clean_inactive</code> setting. This happens
because Filebeat doesn&#8217;t remove the entries until it opens the registry
again to read a different file. If you are testing the <code class="literal">clean_inactive</code> setting,
make sure Filebeat is configured to read from more than one file, or the
file state will never be removed from the registry.</p>
</div>
</div>
<h5><a id="filebeat-input-filestream-clean-removed"></a><code class="literal">clean_removed</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>When this option is enabled, Filebeat cleans files from the registry if
they cannot be found on disk anymore under the last known name. This means also
files which were renamed after the harvester was finished will be removed. This
option is enabled by default.</p>
<p>If a shared drive disappears for a short period and appears again, all files
will be read again from the beginning because the states were removed from the
registry file. In such cases, we recommend that you disable the <code class="literal">clean_removed</code>
option.</p>
<p>You must disable this option if you also disable <code class="literal">close_removed</code>.</p>
<h5><a id="_backoff_3"></a><code class="literal">backoff.*</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>The backoff options specify how aggressively Filebeat crawls open files for
updates. You can use the default values in most cases.</p>
<p>The <code class="literal">backoff</code> option defines how long Filebeat waits before checking a file
again after EOF is reached. The default is 1s, which means the file is checked
every second if new lines were added. This enables near real-time crawling.
Every time a new line appears in the file, the <code class="literal">backoff</code> value is reset to the
initial value. The default is 1s.</p>
<h5><a id="_backoff_init"></a><code class="literal">backoff.init</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>The maximum time for Filebeat to wait before checking a file again after
EOF is reached. After having backed off multiple times from checking the file,
the wait time will never exceed <code class="literal">max_backoff</code> regardless of what is specified
for  <code class="literal">backoff_factor</code>. Because it takes a maximum of 10s to read a new line,
specifying 10s for <code class="literal">max_backoff</code> means that, at the worst, a new line could be
added to the log file if Filebeat has backed off multiple times. The
default is 10s.</p>
<p>Requirement: Set <code class="literal">max_backoff</code> to be greater than or equal to <code class="literal">backoff</code> and
less than or equal to <code class="literal">scan_frequency</code> (<code class="literal">backoff &lt;= max_backoff &lt;= scan_frequency</code>).
If <code class="literal">max_backoff</code> needs to be higher, it is recommended to close the file handler
instead and let Filebeat pick up the file again.</p>
<h5><a id="_backoff_max"></a><code class="literal">backoff.max</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>The maximum time for Filebeat to wait before checking a file again after
EOF is reached. After having backed off multiple times from checking the file,
the wait time will never exceed <code class="literal">max_backoff</code> regardless of what is specified
for  <code class="literal">backoff_factor</code>. Because it takes a maximum of 10s to read a new line,
specifying 10s for <code class="literal">max_backoff</code> means that, at the worst, a new line could be
added to the log file if Filebeat has backed off multiple times. The
default is 10s.</p>
<p>Requirement: Set <code class="literal">max_backoff</code> to be greater than or equal to <code class="literal">backoff</code> and
less than or equal to <code class="literal">scan_frequency</code> (<code class="literal">backoff &lt;= max_backoff &lt;= scan_frequency</code>).
If <code class="literal">max_backoff</code> needs to be higher, it is recommended to close the file handler
instead and let Filebeat pick up the file again.</p>
<h5><a id="_file_identity_3"></a><code class="literal">file_identity</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.14/filebeat/docs/inputs/input-filestream-file-options.asciidoc">edit</a></h5>
<p>Different <code class="literal">file_identity</code> methods can be configured to suit the
environment where you are collecting log messages.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Changing <code class="literal">file_identity</code> methods between runs may result in
duplicated events in the output.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">native</code></strong></span>
</span>
</dt>
<dd>
The default behaviour of Filebeat is to differentiate
between files using their inodes and device ids.
</dd>
</dl>
</div>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">file_identity.native: ~</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">path</code></strong></span>
</span>
</dt>
<dd>
To identify files based on their paths use this strategy.
</dd>
</dl>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Only use this strategy if your log files are rotated to a folder
outside of the scope of your input or not at all. Otherwise you end up
with duplicated events.</p>
</div>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This strategy does not support renaming files.
If an input file is renamed, Filebeat will read it again if the new path
matches the settings of the input.</p>
</div>
</div>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">file_identity.path: ~</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">inode_marker</code></strong></span>
</span>
</dt>
<dd>
If the device id changes from time to time, you must use
this method to distinguish files. This option is not supported on Windows.
</dd>
</dl>
</div>
<p>Set the location of the marker file the following way:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">file_identity.inode_marker.path: /logs/.filebeat-marker</pre>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="filebeat-input-docker.html">« Docker input</a>
</span>
<span class="next">
<a href="_log_rotation.html">Log rotation »</a>
</span>
</div>
</div>
</body>
</html>
