<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Google Cloud Storage Input | Filebeat Reference [8.17] | Elastic</title>
<meta class="elastic" name="content" content="Google Cloud Storage Input | Filebeat Reference [8.17]">

<link rel="home" href="index.html" title="Filebeat Reference [8.17]"/>
<link rel="up" href="configuration-filebeat-options.html" title="Configure inputs"/>
<link rel="prev" href="filebeat-input-gcp-pubsub.html" title="GCP Pub/Sub input"/>
<link rel="next" href="filebeat-input-http_endpoint.html" title="HTTP Endpoint input"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Filebeat"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Filebeat/Reference/8.17"/>
<meta name="DC.subject" content="Filebeat"/>
<meta name="DC.identifier" content="8.17"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="filebeat-input-gcp-pubsub.html">« GCP Pub/Sub input</a>
</span>
<span class="next">
<a href="filebeat-input-http_endpoint.html">HTTP Endpoint input »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Filebeat Reference [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-filebeat.html">Configure Filebeat</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuration-filebeat-options.html">Configure inputs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Google Cloud Storage Input</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="filebeat-input-gcs"></a>Google Cloud Storage Input</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
</div></div></div>

<p>Use the <code class="literal">google cloud storage input</code> to read content from files stored in buckets which reside on your Google Cloud.
The input can be configured to work with and without polling, though if polling is disabled it will only perform a single collection of data, list the file contents and end the process.</p>
<p><span class="strong strong"><strong>To mitigate errors and ensure a stable processing environment, this input employs the following features :</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
When processing google cloud buckets, if suddenly there is any outage, the process will be able to resume post the last file it processed
and was successfully able to save the state for.
</li>
<li class="listitem">
If any errors occur for certain files, they will be logged appropriately, but the rest of the
files will continue to be processed normally.
</li>
<li class="listitem">
If any major error occurs which stops the main thread, the logs will be appropriately generated,
describing said error.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Config Option Removal Notice</strong></span> : The <code class="literal">bucket_timeout</code> config option has been removed from the google cloud storage input. The intention behind this removal is to simplify the configuration and to make it more user friendly. The <code class="literal">bucket_timeout</code> option was confusing and had the potential to let users malconfigure the input, which could lead to unexpected behavior. The input now uses a more robust and efficient way to handle the bucket timeout internally.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<a id="supported-types-gcs"></a>
<p>Currently only <code class="literal">JSON</code> and <code class="literal">NDJSON</code> are supported object/file formats. Objects/files may be also be gzip compressed.
"JSON credential keys" and "credential files" are supported authentication types.
If an array is present as the root object for an object/file, it is automatically split into individual objects and processed.
If a download for a file/object fails or gets interrupted, the download is retried for 2 times. This is currently not user configurable.</p>
</div>
</div>
<p><a id="basic-config-gcs"></a><span class="strong strong"><strong>A sample configuration with detailed explanation for each field is given below :-</strong></span></p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: gcs
  id: my-gcs-id
  enabled: true
  project_id: my_project_id
  auth.credentials_file.path: {{file_path}}/{{creds_file_name}}.json
  parse_json: true
  buckets:
  - name: gcs-test-new
    max_workers: 3
    poll: true
    poll_interval: 15s
  - name: gcs-test-old
    max_workers: 3
    poll: true
    poll_interval: 10s</pre>
</div>
<p><span class="strong strong"><strong>Explanation :</strong></span>
This <code class="literal">configuration</code> given above describes a basic gcs config having two buckets named <code class="literal">gcs-test-new</code> and <code class="literal">gcs-test-old</code>.
Each of these buckets have their own attributes such as <code class="literal">name</code>, <code class="literal">max_workers</code>, <code class="literal">poll</code> and <code class="literal">poll_interval</code>. These attributes have detailed explanations
given <a class="xref" href="filebeat-input-gcs.html#supported-attributes-gcs">below</a>. For now lets try to understand how this config works.</p>
<p>For google cloud storage input to identify the files it needs to read and process, it will require the bucket names to be specified. We can have as
many buckets as we deem fit. We are also able to configure the attributes <code class="literal">max_workers</code>, <code class="literal">poll</code> and <code class="literal">poll_interval</code> at the root level, which will
then be applied to all buckets which do not specify any of these attributes explicitly.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the attributes <code class="literal">max_workers</code>, <code class="literal">poll</code> and <code class="literal">poll_interval</code> are specified at the root level, these can still be overridden at the bucket level with
different values, thus offering extensive flexibility and customization. Examples <a class="xref" href="filebeat-input-gcs.html#bucket-overrides">below</a> show this behavior.</p>
</div>
</div>
<p>On receiving this config the google cloud storage input will connect to the service and retrieve a <code class="literal">Storage Client</code> using the given <code class="literal">bucket_name</code> and
<code class="literal">auth.credentials_file</code>, then it will spawn two main go-routines, one for each bucket. After this each of these routines (threads) will initialize a scheduler
which will in turn use the <code class="literal">max_workers</code> value to initialize an in-memory worker pool (thread pool) with <code class="literal">3</code> <code class="literal">workers</code> available. Basically that equates to two instances of a worker pool, one per bucket, each having 3 workers. These <code class="literal">workers</code> will be responsible for performing <code class="literal">jobs</code> that process a file (in this case read and output the contents of a file).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The scheduler is responsible for scheduling jobs, and uses the <code class="literal">maximum available workers</code> in the pool, at each iteration, to decide the number of files to retrieve and
process. This keeps work distribution efficient. The scheduler uses <code class="literal">poll_interval</code> attribute value to decide how long to wait after each iteration. Each iteration consists of processing a certain number of files, decided by the <code class="literal">maximum available workers</code> value.</p>
</div>
</div>
<p><span class="strong strong"><strong>A Sample Response :-</strong></span></p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "@timestamp": "2022-09-01T13:54:24.588Z",
  "@metadata": {
    "beat": "filebeat",
    "type": "_doc",
    "version": "8.5.0",
    "_id": "gcs-test-new-data_3.json-worker-1"
  },
  "log": {
    "offset": 200,
    "file": {
      "path": "gs://gcs-test-new/data_3.json"
    }
  },
  "input": {
    "type": "gcs"
  },
  "message": "{\n    \"id\": 1,\n    \"title\": \"iPhone 9\",\n    \"description\": \"An apple mobile which is nothing like apple\",\n    \"price\": 549,\n    \"discountPercentage\": 12.96,\n    \"rating\": 4.69,\n    \"stock\": 94,\n    \"brand\": \"Apple\",\n    \"category\": \"smartphones\",\n    \"thumbnail\": \"https://dummyjson.com/image/i/products/1/thumbnail.jpg\",\n    \"images\": [\n        \"https://dummyjson.com/image/i/products/1/1.jpg\",\n        \"https://dummyjson.com/image/i/products/1/2.jpg\",\n        \"https://dummyjson.com/image/i/products/1/3.jpg\",\n        \"https://dummyjson.com/image/i/products/1/4.jpg\",\n        \"https://dummyjson.com/image/i/products/1/thumbnail.jpg\"\n    ]\n}\n",
  "cloud": {
    "provider": "goole cloud"
  },
  "gcs": {
    "storage": {
      "bucket": {
        "name": "gcs-test-new"
      },
      "object": {
        "name": "data_3.json",
        "content_type": "application/json",
        "json_data": [
          {
            "id": 1,
            "discountPercentage": 12.96,
            "rating": 4.69,
            "brand": "Apple",
            "price": 549,
            "category": "smartphones",
            "thumbnail": "https://dummyjson.com/image/i/products/1/thumbnail.jpg",
            "description": "An apple mobile which is nothing like apple",
            "title": "iPhone 9",
            "stock": 94,
            "images": [
              "https://dummyjson.com/image/i/products/1/1.jpg",
              "https://dummyjson.com/image/i/products/1/2.jpg",
              "https://dummyjson.com/image/i/products/1/3.jpg",
              "https://dummyjson.com/image/i/products/1/4.jpg",
              "https://dummyjson.com/image/i/products/1/thumbnail.jpg"
            ]
          }
        ]
      }
    }
  },
  "event": {
    "kind": "publish_data"
  }
}</pre>
</div>
<p>As we can see from the response above, the <code class="literal">message</code> field contains the original stringified data while the <code class="literal">gcs.storage.object.data</code> contains the objectified data.</p>
<p><span class="strong strong"><strong>Some of the key attributes are as follows :-</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>message</strong></span> : Original stringified object data.
</li>
<li class="listitem">
<span class="strong strong"><strong>log.file.path</strong></span> : Path of the object in google cloud.
</li>
<li class="listitem">
<span class="strong strong"><strong>gcs.storage.bucket.name</strong></span> : Name of the bucket from which the file has been read.
</li>
<li class="listitem">
<span class="strong strong"><strong>gcs.storage.object.name</strong></span> : Name of the file/object which has been read.
</li>
<li class="listitem">
<span class="strong strong"><strong>gcs.storage.object.content_type</strong></span> : Content type of the file/object. You can find the supported content types <a class="xref" href="filebeat-input-gcs.html#supported-types-gcs">here</a> .
</li>
<li class="listitem">
<span class="strong strong"><strong>gcs.storage.object.json_data</strong></span> :  Objectified json file data, representing the contents of the file.
</li>
</ol>
</div>
<p>Now let&#8217;s explore the configuration attributes a bit more elaborately.</p>
<p><a id="supported-attributes-gcs"></a><span class="strong strong"><strong>Supported Attributes :-</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-project-id" title="project_id">project_id</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-auth-credentials-json" title="auth.credentials_json.account_key">auth.credentials_json.account_key</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-auth-credentials-file" title="auth.credentials_file.path">auth.credentials_file.path</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-buckets" title="buckets">buckets</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-bucket-name" title="name">name</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-max_workers-gcs" title="max_workers">max_workers</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-poll-gcs" title="poll">poll</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-poll_interval-gcs" title="poll_interval">poll_interval</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-parse_json" title="parse_json">parse_json</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-file_selectors-gcs" title="file_selectors">file_selectors</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-expand_event_list_from_field-gcs" title="expand_event_list_from_field">expand_event_list_from_field</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-timestamp_epoch-gcs" title="timestamp_epoch">timestamp_epoch</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-retry-gcs" title="retry">retry</a>
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="attrib-project-id"></a><code class="literal">project_id</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute is required for various internal operations with respect to authentication, creating storage clients and logging which are used internally
for various processing purposes.</p>
<div class="position-relative"><h4><a id="attrib-auth-credentials-json"></a><code class="literal">auth.credentials_json.account_key</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute contains the <span class="strong strong"><strong>json service account credentials string</strong></span>, which can be generated from the google cloud console, ref: <a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys" class="ulink" target="_top">https://cloud.google.com/iam/docs/creating-managing-service-account-keys</a>,
under the respective storage account. A single storage account can contain multiple buckets, and they will all use this common service account access key.</p>
<div class="position-relative"><h4><a id="attrib-auth-credentials-file"></a><code class="literal">auth.credentials_file.path</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute contains the <span class="strong strong"><strong>service account credentials file</strong></span>, which can be generated from the google cloud console, ref: <a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys" class="ulink" target="_top">https://cloud.google.com/iam/docs/creating-managing-service-account-keys</a>,
under the respective storage account. A single storage account can contain multiple buckets, and they will all use this common service account credentials file.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>We require only either of <code class="literal">auth.credentials_json.account_key</code> or <code class="literal">auth.credentials_file.path</code> to be specified for authentication purposes. If both attributes are
specified, then the one that occurs first in the configuration will be used.</p>
</div>
</div>
<div class="position-relative"><h4><a id="attrib-buckets"></a><code class="literal">buckets</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute contains the details about a specific bucket like <code class="literal">name</code>, <code class="literal">max_workers</code>, <code class="literal">poll</code> and <code class="literal">poll_interval</code>. The attribute <code class="literal">name</code> is specific to a bucket as it describes the bucket name, while the fields <code class="literal">max_workers</code>, <code class="literal">poll</code> and <code class="literal">poll_interval</code> can exist both at the bucket level and the root level. This attribute is internally represented as an array, so we can add as many buckets as we require.</p>
<div class="position-relative"><h4><a id="attrib-bucket-name"></a><code class="literal">name</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This is a specific subfield of a bucket. It specifies the bucket name.</p>
<div class="position-relative"><h4><a id="attrib-max_workers-gcs"></a><code class="literal">max_workers</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute defines the maximum number of workers (goroutines / lightweight threads) are allocated in the worker pool (thread pool) for processing jobs which read the contents of files. This attribute can be specified both at the root level of the configuration and at the bucket level. Bucket level values override the root level values if both are specified. Larger number of workers do not necessarily improve of throughput, and this should be carefully tuned based on the number of files, the size of the files being processed and resources available. Increasing <code class="literal">max_workers</code> to very high values may cause resource utilization problems and can lead to a bottleneck in processing. Usually a maximum cap of <code class="literal">2000</code> workers is recommended. A very low <code class="literal">max_worker</code> count will drastically increase the number of network calls required to fetch the objects, which can cause a bottleneck in processing.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The value of <code class="literal">max_workers</code> is tied to the <code class="literal">batch_size</code> currently to ensure even distribution of workloads across all goroutines. This ensures that the input is able to process the files in an efficient manner. This <code class="literal">batch_size</code> determines how many objects will be fetched in one single call. The <code class="literal">max_workers</code> value should be set based on the number of files to be read, the resources available and the network speed. For example,<code class="literal">max_workers=3</code> would mean that every pagination request a total number of <code class="literal">3</code> gcs objects are fetched and distributed among <code class="literal">3 goroutines</code>, <code class="literal">max_workers=100</code> would mean <code class="literal">100</code> gcs objects are fetched in every pagination request and distributed among <code class="literal">100 goroutines</code>.</p>
</div>
</div>
<div class="position-relative"><h4><a id="attrib-poll-gcs"></a><code class="literal">poll</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute informs the scheduler whether to keep polling for new files or not. Default value of this is set to <code class="literal">true</code>. This attribute can be specified both at the
root level of the configuration as well at the bucket level. The bucket level values will always take priority and override the root level values if both are specified.</p>
<div class="position-relative"><h4><a id="attrib-poll_interval-gcs"></a><code class="literal">poll_interval</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute defines the maximum amount of time after which the internal scheduler will make the polling call for the next set of objects/files. It can be
defined in the following formats : <code class="literal">{{x}}s</code>, <code class="literal">{{x}}m</code>, <code class="literal">{{x}}h</code>, here <code class="literal">s = seconds</code>, <code class="literal">m = minutes</code> and <code class="literal">h = hours</code>. The value <code class="literal">{{x}}</code> can be anything we wish.
Example : <code class="literal">10s</code> would mean we would like the polling to occur every 10 seconds. If no value is specified for this, by default its initialized to <code class="literal">5 minutes</code>.
This attribute can be specified both at the root level of the configuration as well at the bucket level. The bucket level values will always take priority
and override the root level values if both are specified. Having a lower <code class="literal">poll_interval</code> can make the input faster at the cost of more resource utilization.</p>
<div class="position-relative"><h4><a id="attrib-parse_json"></a><code class="literal">parse_json</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute informs the publisher  whether to parse &amp; objectify json data or not. By default this is set to <code class="literal">false</code>, since it can get expensive dealing with
highly nested json data. If this is set to <code class="literal">false</code> the <span class="strong strong"><strong>gcs.storage.object.json_data</strong></span> field in the response will have an empty array. This attribute is only
applicable for json objects and has no effect on other types of objects. This attribute can be specified both at the root level of the configuration as well at the bucket level.
The bucket level values will always take priority and override the root level values if both are specified.</p>
<div class="position-relative"><h4><a id="input-gcs-encoding"></a><code class="literal">encoding</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>The file encoding to use for reading data that contains international
characters. This only applies to non-JSON logs. See <a class="xref" href="filebeat-input-log.html#_encoding_3" title="encoding"><code class="literal">encoding</code></a>.</p>
<div class="position-relative"><h4><a id="input-gcs-decoding"></a><code class="literal">decoding</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>The file decoding option is used to specify a codec that will be used to
decode the file contents. This can apply to any file stream data.
An example config is shown below:</p>
<p>Currently supported codecs are given below:-</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="filebeat-input-gcs.html#attrib-decoding-csv-gcs" title="the CSV codec">CSV</a>: This codec decodes RFC 4180 CSV data streams.
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="attrib-decoding-csv-gcs"></a><code class="literal">the CSV codec</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>The <code class="literal">CSV</code> codec is used to decode RFC 4180 CSV data streams.
Enabling the codec without other options will use the default codec options.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">  decoding.codec.csv.enabled: true</pre>
</div>
<p>The CSV codec supports five sub attributes to control aspects of CSV decoding.
The <code class="literal">comma</code> attribute specifies the field separator character used by the CSV
format. If it is not specified, the comma character <em><code class="literal">,</code></em> is used. The <code class="literal">comment</code>
attribute specifies the character that should be interpreted as a comment mark.
If it is specified, lines starting with the character will be ignored. Both
<code class="literal">comma</code> and <code class="literal">comment</code> must be single characters. The <code class="literal">lazy_quotes</code> attribute
controls how quoting in fields is handled. If <code class="literal">lazy_quotes</code> is true, a quote may
appear in an unquoted field and a non-doubled quote may appear in a quoted field.
The <code class="literal">trim_leading_space</code> attribute specifies that leading white space should be
ignored, even if the <code class="literal">comma</code> character is white space. For complete details
of the preceding configuration attribute behaviors, see the CSV decoder
<a href="https://pkg.go.dev/encoding/csv#Reader" class="ulink" target="_top">documentation</a> The <code class="literal">fields_names</code>
attribute can be used to specify the column names for the data. If it is
absent, the field names are obtained from the first non-comment line of
data. The number of fields must match the number of field names.</p>
<p>An example config is shown below:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">  decoding.codec.csv.enabled: true
  decoding.codec.csv.comma: "\t"
  decoding.codec.csv.comment: "#"</pre>
</div>
<div class="position-relative"><h4><a id="attrib-file_selectors-gcs"></a><code class="literal">file_selectors</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>If the GCS buckets have objects that correspond to files that Filebeat shouldn&#8217;t process, <code class="literal">file_selectors</code> can be used to limit the files that are downloaded. This is a list of selectors which are based on a regular expression pattern. The regular expression should match the object name or should be a part of the object name (ideally a prefix). The regular expression syntax used is [RE2](<a href="https://github.com/google/re2/wiki/Syntax" class="ulink" target="_top">https://github.com/google/re2/wiki/Syntax</a>). Files that don&#8217;t match any configured expression won&#8217;t be processed.This attribute can be specified both at the root level of the configuration as well at the container level. The container level values will always take priority and override the root level values if both are specified.</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">filebeat.inputs:
- type: gcs
  project_id: my_project_id
  auth.credentials_file.path: {{file_path}}/{{creds_file_name}}.json
  buckets:
  - name: obs-bucket
    max_workers: 3
    poll: true
    poll_interval: 15s
    file_selectors:
    - regex: '/Monitoring/'
    - regex: 'docs/'
    - regex: '/Security-Logs/'</pre>
</div>
<p>The <code class="literal">file_selectors</code> operation is performed within the agent locally, hence using this option will cause the agent to download all the files and then filter them. This can cause a bottleneck in processing if the number of files is very high. It is recommended to use this attribute only when the number of files is limited or ample resources are available.</p>
<div class="position-relative"><h4><a id="attrib-expand_event_list_from_field-gcs"></a><code class="literal">expand_event_list_from_field</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>If the file-set using this input expects to receive multiple messages bundled under a specific field or an array of objects then the config option for <code class="literal">expand_event_list_from_field</code> can be specified. This setting will be able to split the messages under the group value into separate events. For example, if you have logs that are in JSON format and events are found under the JSON object "Records". To split the events into separate events, the config option <code class="literal">expand_event_list_from_field</code> can be set to "Records". This attribute can be specified both at the root level of the configuration as well at the container level. The container level values will always take priority and override the root level values if both are specified.</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "Records": [
        {
            "eventVersion": "1.07",
            "eventTime": "2019-11-14T00:51:00Z",
            "region": "us-east-1",
            "eventID": "EXAMPLE8-9621-4d00-b913-beca2EXAMPLE",
        },
        {
            "eventVersion": "1.07",
            "eventTime": "2019-11-14T00:52:00Z",
            "region": "us-east-1",
            "eventID": "EXAMPLEc-28be-486c-8928-49ce6EXAMPLE",
        }
    ]
}</pre>
</div>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">filebeat.inputs:
- type: gcs
  project_id: my_project_id
  auth.credentials_file.path: {{file_path}}/{{creds_file_name}}.json
  buckets:
  - name: obs-bucket
    max_workers: 3
    poll: true
    poll_interval: 15s
    expand_event_list_from_field: Records</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">parse_json</code> setting is incompatible with <code class="literal">expand_event_list_from_field</code>. If enabled it will be ignored. This attribute is only applicable for JSON file formats. You do not need to specify this attribute if the file has an array of objects at the root level. Root level array of objects are automatically split into separate events. If failures occur or the input crashes due to some unexpected error, the processing will resume from the last successfully processed file or object.</p>
</div>
</div>
<div class="position-relative"><h4><a id="attrib-timestamp_epoch-gcs"></a><code class="literal">timestamp_epoch</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute can be used to filter out files and objects that have a timestamp older than the specified value. The value of this attribute should be in unix <code class="literal">epoch</code> (seconds) format. The timestamp value is compared with the <code class="literal">object.Updated</code> field obtained from the object metadata. This attribute can be specified both at the root level of the configuration as well at the container level. The container level values will always take priority and override the root level values if both are specified.</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">filebeat.inputs:
- type: gcs
  project_id: my_project_id
  auth.credentials_file.path: {{file_path}}/{{creds_file_name}}.json
  buckets:
  - name: obs-bucket
    max_workers: 3
    poll: true
    poll_interval: 15s
    timestamp_epoch: 1630444800</pre>
</div>
<p>The GCS APIs don&#8217;t provide a direct way to filter files based on the timestamp, so the input will download all the files and then filter them based on the timestamp. This can cause a bottleneck in processing if the number of files are very high. It is recommended to use this attribute only when the number of files are limited or ample resources are available. This option scales vertically and not horizontally.</p>
<div class="position-relative"><h4><a id="attrib-retry-gcs"></a><code class="literal">retry</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This attribute can be used to configure a list of sub attributes that directly control how the input should behave when a download for a file/object fails or gets interrupted.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">max_attempts</code>: This attribute defines the maximum number of retry attempts(including the initial api call) that should be attempted for a retryable error. The default value for this is <code class="literal">3</code>.
</li>
<li class="listitem">
<code class="literal">initial_backoff_duration</code>: This attribute defines the initial backoff time. The default value for this is <code class="literal">1s</code>.
</li>
<li class="listitem">
<code class="literal">max_backoff_duration</code>: This attribute defines the maximum backoff time. The default value for this is <code class="literal">30s</code>.
</li>
<li class="listitem">
<code class="literal">backoff_multiplier</code>: This attribute defines the backoff multiplication factor. The default value for this is <code class="literal">2</code>.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">initial_backoff_duration</code> and <code class="literal">max_backoff_duration</code> attributes must have time units. Valid time units are <code class="literal">ns</code>, <code class="literal">us</code> (or <code class="literal">µs</code>), <code class="literal">ms</code>, <code class="literal">s</code>, <code class="literal">m</code>, <code class="literal">h</code>.</p>
</div>
</div>
<p>By configuring these attributes, the user is given the flexibility to control how the input should behave when a download fails or gets interrupted. This attribute can only be
specified at the root level of the configuration and not at the bucket level. It applies uniformly to all the buckets.</p>
<p>An example configuration is given below :-</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">filebeat.inputs:
- type: gcs
  project_id: my_project_id
  auth.credentials_file.path: {{file_path}}/{{creds_file_name}}.json
  retry:
    max_attempts: 3
    initial_backoff_duration: 2s
    max_backoff_duration: 60s
    backoff_multiplier: 2
  buckets:
  - name: obs-bucket
    max_workers: 3
    poll: true
    poll_interval: 11m</pre>
</div>
<p><a id="bucket-overrides"></a><span class="strong strong"><strong>The sample configs below will explain the bucket level overriding of attributes a bit further :-</strong></span></p>
<p><span class="strong strong"><strong>CASE - 1 :</strong></span></p>
<p>Here <code class="literal">bucket_1</code> is using root level attributes while <code class="literal">bucket_2</code> overrides the values :</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">filebeat.inputs:
- type: gcs
  id: my-gcs-id
  enabled: true
  project_id: my_project_id
  auth.credentials_file.path: {{file_path}}/{{creds_file_name}}.json
  max_workers: 10
  poll: true
  poll_interval: 15s
  buckets:
  - name: bucket_1
  - name: bucket_2
    max_workers: 3
    poll: true
    poll_interval: 10s</pre>
</div>
<p><span class="strong strong"><strong>Explanation :</strong></span>
In this configuration <code class="literal">bucket_1</code> has no sub attributes in <code class="literal">max_workers</code>, <code class="literal">poll</code> and <code class="literal">poll_interval</code> defined. It inherits the values for these fileds from the root
level, which is <code class="literal">max_workers = 10</code>, <code class="literal">poll = true</code> and <code class="literal">poll_interval = 15 seconds</code>. However <code class="literal">bucket_2</code> has these fields defined and it will use those values instead
of using the root values.</p>
<p><span class="strong strong"><strong>CASE - 2 :</strong></span></p>
<p>Here both <code class="literal">bucket_1</code> and <code class="literal">bucket_2</code> overrides the root values :</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">filebeat.inputs:
  - type: gcs
    id: my-gcs-id
    enabled: true
    project_id: my_project_id
    auth.credentials_file.path: {{file_path}}/{{creds_file_name}}.json
    max_workers: 10
    poll: true
    poll_interval: 15s
    buckets:
    - name: bucket_1
      max_workers: 5
      poll: true
      poll_interval: 10s
    - name: bucket_2
      max_workers: 5
      poll: true
      poll_interval: 10s</pre>
</div>
<p><span class="strong strong"><strong>Explanation :</strong></span>
In this configuration even though we have specified <code class="literal">max_workers = 10</code>, <code class="literal">poll = true</code> and <code class="literal">poll_interval = 15s</code> at the root level, both the buckets
will override these values with their own respective values which are defined as part of their sub attibutes.</p>
<div class="position-relative"><h3><a id="_metrics_10"></a>Metrics</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
<p>This input exposes metrics under the <a class="xref" href="http-endpoint.html" title="Configure an HTTP endpoint for metrics">HTTP monitoring endpoint</a>.
These metrics are exposed under the <code class="literal">/inputs</code> path. They can be used to
observe the activity of the input.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Metric</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">url</code></p></td>
<td align="left" valign="top"><p>URL of the input resource.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">errors_total</code></p></td>
<td align="left" valign="top"><p>Total number of errors encountered by the input.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">decode_errors_total</code></p></td>
<td align="left" valign="top"><p>Total number of decode errors encountered by the input.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_objects_requested_total</code></p></td>
<td align="left" valign="top"><p>Total number of GCS objects downloaded.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_objects_published_total</code></p></td>
<td align="left" valign="top"><p>Total number of GCS objects processed that were published.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_objects_listed_total</code></p></td>
<td align="left" valign="top"><p>Total number of GCS objects returned by list operations.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_bytes_processed_total</code></p></td>
<td align="left" valign="top"><p>Total number of GCS bytes processed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_events_created_total</code></p></td>
<td align="left" valign="top"><p>Total number of events created from processing GCS data.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_failed_jobs_total</code></p></td>
<td align="left" valign="top"><p>Total number of failed jobs.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_expired_failed_jobs_total</code></p></td>
<td align="left" valign="top"><p>Total number of expired failed jobs that could not be recovered.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_objects_tracked_gauge</code></p></td>
<td align="left" valign="top"><p>Number of objects currently tracked in the state registry (gauge).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_objects_inflight_gauge</code></p></td>
<td align="left" valign="top"><p>Number of GCS objects inflight (gauge).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_jobs_scheduled_after_validation</code></p></td>
<td align="left" valign="top"><p>Histogram of the number of jobs scheduled after validation.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_object_processing_time</code></p></td>
<td align="left" valign="top"><p>Histogram of the elapsed GCS object processing times in nanoseconds (start of download to completion of parsing).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_object_size_in_bytes</code></p></td>
<td align="left" valign="top"><p>Histogram of processed GCS object size in bytes.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gcs_events_per_object</code></p></td>
<td align="left" valign="top"><p>Histogram of event count per GCS object.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">source_lag_time</code></p></td>
<td align="left" valign="top"><p>Histogram of the time between the source (Updated) timestamp and the time the object was read, in nanoseconds.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_common_input_options"></a>Common input options</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/x-pack/filebeat/docs/inputs/input-gcs.asciidoc">edit</a></div>
</div></div></div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="filebeat-input-gcs-common-options"></a>Common options</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
</div></div></div>
<p>The following configuration options are supported by all inputs.</p>
<div class="position-relative"><h5><a id="_enabled_11"></a><code class="literal">enabled</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>Use the <code class="literal">enabled</code> option to enable and disable inputs. By default, enabled is
set to true.</p>
<div class="position-relative"><h5><a id="_tags_11"></a><code class="literal">tags</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>A list of tags that Filebeat includes in the <code class="literal">tags</code> field of each published
event. Tags make it easy to select specific events in Kibana or apply
conditional filtering in Logstash. These tags will be appended to the list of
tags specified in the general configuration.</p>
<p>Example:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: gcs
  . . .
  tags: ["json"]</pre>
</div>
<div class="position-relative"><h5><a id="filebeat-input-gcs-fields"></a><code class="literal">fields</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>Optional fields that you can specify to add additional information to the
output. For example, you might add fields that you can use for filtering log
data. Fields can be scalar values, arrays, dictionaries, or any nested
combination of these. By default, the fields that you specify here will be
grouped under a <code class="literal">fields</code> sub-dictionary in the output document. To store the
custom fields as top-level fields, set the <code class="literal">fields_under_root</code> option to true.
If a duplicate field is declared in the general configuration, then its value
will be overwritten by the value declared here.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: gcs
  . . .
  fields:
    app_id: query_engine_12</pre>
</div>
<div class="position-relative"><h5><a id="fields-under-root-gcs"></a><code class="literal">fields_under_root</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>If this option is set to true, the custom
<a class="xref" href="filebeat-input-gcs.html#filebeat-input-gcs-fields" title="fields">fields</a> are stored as top-level fields in
the output document instead of being grouped under a <code class="literal">fields</code> sub-dictionary. If
the custom field names conflict with other field names added by Filebeat,
then the custom fields overwrite the other fields.</p>
<div class="position-relative"><h5><a id="_processors_11"></a><code class="literal">processors</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>A list of processors to apply to the input data.</p>
<p>See <a class="xref" href="filtering-and-enhancing-data.html" title="Filter and enhance data with processors"><em>Processors</em></a> for information about specifying
processors in your config.</p>
<div class="position-relative"><h5><a id="_pipeline_11"></a><code class="literal">pipeline</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>The ingest pipeline ID to set for the events generated by this input.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The pipeline ID can also be configured in the Elasticsearch output, but
this option usually results in simpler configuration files. If the pipeline is
configured both in the input and output, the option from the
input is used.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">pipeline</code> is always lowercased. If <code class="literal">pipeline: Foo-Bar</code>, then
the pipeline name in Elasticsearch needs to be defined as <code class="literal">foo-bar</code>.</p>
</div>
</div>
<div class="position-relative"><h5><a id="_keep_null_11"></a><code class="literal">keep_null</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>If this option is set to true, fields with <code class="literal">null</code> values will be published in
the output document. By default, <code class="literal">keep_null</code> is set to <code class="literal">false</code>.</p>
<div class="position-relative"><h5><a id="_index_11"></a><code class="literal">index</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>If present, this formatted string overrides the index for events from this input
(for elasticsearch outputs), or sets the <code class="literal">raw_index</code> field of the event&#8217;s
metadata (for other outputs). This string can only refer to the agent name and
version and the event timestamp; for access to dynamic fields, use
<code class="literal">output.elasticsearch.index</code> or a processor.</p>
<p>Example value: <code class="literal">"%{[agent.name]}-myindex-%{+yyyy.MM.dd}"</code> might
expand to <code class="literal">"filebeat-myindex-2019.11.01"</code>.</p>
<div class="position-relative"><h5><a id="_publisher_pipeline_disable_host_11"></a><code class="literal">publisher_pipeline.disable_host</code></h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.17/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></div>
<p>By default, all events contain <code class="literal">host.name</code>. This option can be set to <code class="literal">true</code> to
disable the addition of this field to all events. The default value is <code class="literal">false</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Any feedback is welcome which will help us further optimize this input. Please feel free to open a github issue for any bugs or feature requests.</p>
</div>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="filebeat-input-gcp-pubsub.html">« GCP Pub/Sub input</a>
</span>
<span class="next">
<a href="filebeat-input-http_endpoint.html">HTTP Endpoint input »</a>
</span>
</div>
</body>
</html>
