<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Entity Analytics Input | Filebeat Reference [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Entity Analytics Input | Filebeat Reference [8.15]">

<link rel="home" href="index.html" title="Filebeat Reference [8.15]"/>
<link rel="up" href="configuration-filebeat-options.html" title="Configure inputs"/>
<link rel="prev" href="filebeat-input-container.html" title="Container input"/>
<link rel="next" href="filebeat-input-etw.html" title="ETW input"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Filebeat"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Filebeat/Reference/8.15"/>
<meta name="DC.subject" content="Filebeat"/>
<meta name="DC.identifier" content="8.15"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="filebeat-input-container.html">« Container input</a>
</span>
<span class="next">
<a href="filebeat-input-etw.html">ETW input »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Filebeat Reference [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-howto-filebeat.html">Configure Filebeat</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuration-filebeat-options.html">Configure inputs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Entity Analytics Input</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="filebeat-input-entity-analytics"></a>Entity Analytics Input<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h2>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>The Entity Analytics input collects identity assets, such as users, from
external identity providers.</p>
<p>The following identity providers are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="filebeat-input-entity-analytics.html#provider-activedirectory" title="Active Directory (activedirectory)">Active Directory (<code class="literal">activedirectory</code>)</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-entity-analytics.html#provider-azure-ad" title="Azure Active Directory (azure-ad)">Azure Active Directory (<code class="literal">azure-ad</code>)</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-entity-analytics.html#provider-jamf" title="Jamf Computer Management (jamf)">Jamf Computer Management (<code class="literal">jamf</code>)</a>
</li>
<li class="listitem">
<a class="xref" href="filebeat-input-entity-analytics.html#provider-okta" title="Okta User Identities (okta)">Okta User Identities (<code class="literal">okta</code>)</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_configuration_options_7"></a>Configuration options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">entity-analytics</code> input supports the following configuration options plus
the <a class="xref" href="filebeat-input-entity-analytics.html#filebeat-input-entity-analytics-common-options" title="Common options">Common options</a> described later.</p>
<h4><a id="_provider_2"></a><code class="literal">provider</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>The identity provider. Must be one of: <code class="literal">activedirectory</code>, <code class="literal">azure-ad</code> or <code class="literal">okta</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="filebeat-input-entity-analytics-common-options"></a>Common options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h3>
</div></div></div>
<p>The following configuration options are supported by all inputs.</p>
<h5><a id="_enabled_7"></a><code class="literal">enabled</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>Use the <code class="literal">enabled</code> option to enable and disable inputs. By default, enabled is
set to true.</p>
<h5><a id="_tags_7"></a><code class="literal">tags</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>A list of tags that Filebeat includes in the <code class="literal">tags</code> field of each published
event. Tags make it easy to select specific events in Kibana or apply
conditional filtering in Logstash. These tags will be appended to the list of
tags specified in the general configuration.</p>
<p>Example:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: entity-analytics
  . . .
  tags: ["json"]</pre>
</div>
<h5><a id="filebeat-input-entity-analytics-fields"></a><code class="literal">fields</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>Optional fields that you can specify to add additional information to the
output. For example, you might add fields that you can use for filtering log
data. Fields can be scalar values, arrays, dictionaries, or any nested
combination of these. By default, the fields that you specify here will be
grouped under a <code class="literal">fields</code> sub-dictionary in the output document. To store the
custom fields as top-level fields, set the <code class="literal">fields_under_root</code> option to true.
If a duplicate field is declared in the general configuration, then its value
will be overwritten by the value declared here.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: entity-analytics
  . . .
  fields:
    app_id: query_engine_12</pre>
</div>
<h5><a id="fields-under-root-entity-analytics"></a><code class="literal">fields_under_root</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>If this option is set to true, the custom
<a class="xref" href="filebeat-input-entity-analytics.html#filebeat-input-entity-analytics-fields" title="fields">fields</a> are stored as top-level fields in
the output document instead of being grouped under a <code class="literal">fields</code> sub-dictionary. If
the custom field names conflict with other field names added by Filebeat,
then the custom fields overwrite the other fields.</p>
<h5><a id="_processors_7"></a><code class="literal">processors</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>A list of processors to apply to the input data.</p>
<p>See <a class="xref" href="filtering-and-enhancing-data.html" title="Filter and enhance data with processors"><em>Processors</em></a> for information about specifying
processors in your config.</p>
<h5><a id="_pipeline_7"></a><code class="literal">pipeline</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>The ingest pipeline ID to set for the events generated by this input.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The pipeline ID can also be configured in the Elasticsearch output, but
this option usually results in simpler configuration files. If the pipeline is
configured both in the input and output, the option from the
input is used.</p>
</div>
</div>
<h5><a id="_keep_null_7"></a><code class="literal">keep_null</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>If this option is set to true, fields with <code class="literal">null</code> values will be published in
the output document. By default, <code class="literal">keep_null</code> is set to <code class="literal">false</code>.</p>
<h5><a id="_index_7"></a><code class="literal">index</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>If present, this formatted string overrides the index for events from this input
(for elasticsearch outputs), or sets the <code class="literal">raw_index</code> field of the event&#8217;s
metadata (for other outputs). This string can only refer to the agent name and
version and the event timestamp; for access to dynamic fields, use
<code class="literal">output.elasticsearch.index</code> or a processor.</p>
<p>Example value: <code class="literal">"%{[agent.name]}-myindex-%{+yyyy.MM.dd}"</code> might
expand to <code class="literal">"filebeat-myindex-2019.11.01"</code>.</p>
<h5><a id="_publisher_pipeline_disable_host_7"></a><code class="literal">publisher_pipeline.disable_host</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/filebeat/docs/inputs/input-common-options.asciidoc">edit</a></h5>
<p>By default, all events contain <code class="literal">host.name</code>. This option can be set to <code class="literal">true</code> to
disable the addition of this field to all events. The default value is <code class="literal">false</code>.</p>
<h3><a id="_providers"></a>Providers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h3>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="provider-activedirectory"></a>Active Directory (<code class="literal">activedirectory</code>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">activedirectory</code> provider allows the input to retrieve users, with group
memberships, from Active Directory.</p>
<h4><a id="_setup"></a>Setup<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>A user with appropriate permissions must be set up in the Active Directory
Server Manager in order for the provider to function properly.</p>
<h4><a id="_how_it_works"></a>How It Works<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<h5><a id="_overview"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Active Directory provider periodically queries the Active Directory server,
retrieving updates for users and groups, updates its internal cache of user and
group metadata and group membership information, and ships updated user metadata
to Elasticsearch.</p>
<p>Fetching and shipping updates occurs in one of two processes: <span class="strong strong"><strong>full
synchronizations</strong></span> and <span class="strong strong"><strong>incremental updates</strong></span>. Full synchronizations will send the
entire list of users and group membership in state, along with write markers to indicate
the start and end of the synchronization event. Incremental updates will only
send data for changed users during that event. Changes on a user can come in many
forms, whether it be a change to the user metadata, a user was added or modified,
or group membership was changed.</p>
<h5><a id="_sending_user_and_device_metadata_to_elasticsearch"></a>Sending User and Device Metadata to Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>During a full synchronization, all users and groups stored in state will be sent
to the output, while incremental updates will only send users and group that have been
updated. Full synchronizations will be bounded on either side by write marker
documents, which will look something like this:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2022-11-04T09:57:19.786056-05:00",
    "event": {
        "action": "started",
        "start": "2022-11-04T09:57:19.786056-05:00"
    },
    "labels": {
        "identity_source": "activedirectory-1"
    }
}</pre>
</div>
<p>User documents will show the current state of the user.</p>
<p>Example user document:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2024-02-05T06:37:40.876026-05:00",
    "event": {
        "action": "user-discovered",
    },
    "activedirectory": {
        "id": "CN=Guest,CN=Users,DC=testserver,DC=local",
        "user": {
            "accountExpires": "2185-07-21T23:34:33.709551516Z",
            "badPasswordTime": "0",
            "badPwdCount": "0",
            "cn": "Guest",
            "codePage": "0",
            "countryCode": "0",
            "dSCorePropagationData": [
                "2024-01-22T06:37:40Z",
                "1601-01-01T00:00:01Z"
            ],
            "description": "Built-in account for guest access to the computer/domain",
            "distinguishedName": "CN=Guest,CN=Users,DC=testserver,DC=local",
            "instanceType": "4",
            "isCriticalSystemObject": true,
            "lastLogoff": "0",
            "lastLogon": "2185-07-21T23:34:33.709551616Z",
            "logonCount": "0",
            "memberOf": "CN=Guests,CN=Builtin,DC=testserver,DC=local",
            "name": "Guest",
            "objectCategory": "CN=Person,CN=Schema,CN=Configuration,DC=testserver,DC=local",
            "objectClass": [
                "top",
                "person",
                "organizationalPerson",
                "user"
            ],
            "objectGUID": "hSt/40XJQU6cf+J2XoYMHw==",
            "objectSid": "AQUAAAAAAAUVAAAA0JU2Fq1k30YZ7UPx9QEAAA==",
            "primaryGroupID": "514",
            "pwdLastSet": "2185-07-21T23:34:33.709551616Z",
            "sAMAccountName": "Guest",
            "sAMAccountType": "805306368",
            "uSNChanged": "8197",
            "uSNCreated": "8197",
            "userAccountControl": "66082",
            "whenChanged": "2024-01-22T06:36:59Z",
            "whenCreated": "2024-01-22T06:36:59Z"
        },
        "whenChanged": "2024-01-22T06:36:59Z"
    },
    "user": {
        "id": "CN=Guest,CN=Users,DC=testserver,DC=local"
    },
    "labels": {
        "identity_source": "activedirectory-1"
    }
}</pre>
</div>
<h4><a id="_configuration"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: entity-analytics
  enabled: true
  id: activedirectory-1
  provider: activedirectory
  sync_interval: "12h"
  update_interval: "30m"
  ad_url: "ldaps://host.domain.tld"
  ad_base_dn: "CN=Users,DC=SERVER,DC=DOMAIN"
  ad_user: "USERNAME"
  ad_password: "PASSWORD"</pre>
</div>
<p>The <code class="literal">azure-ad</code> provider supports the following configuration:</p>
<h5><a id="_ad_url"></a><code class="literal">ad_url</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Active Directory server URL. Field is required.</p>
<h5><a id="_ad_base_dn"></a><code class="literal">ad_base_dn</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Active Directory Base Distinguished Name. Field is required.</p>
<h5><a id="_ad_user"></a><code class="literal">ad_user</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The client user name. Used for authentication. The user must have Active Directory read access. Field is required.</p>
<h5><a id="_ad_password"></a><code class="literal">ad_password</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The client&#8217;s password, used for authentication. Field is required.</p>
<h5><a id="_sync_interval"></a><code class="literal">sync_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The interval in which full synchronizations should occur. The interval must be
longer than the update interval (<code class="literal">update_interval</code>) Expressed as a duration
string (e.g., 1m, 3h, 24h). Defaults to <code class="literal">24h</code> (24 hours).</p>
<h5><a id="_update_interval"></a><code class="literal">update_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The interval in which incremental updates should occur. The interval must be
shorter than the full synchronization interval (<code class="literal">sync_interval</code>). Expressed as a
duration string (e.g., 1m, 3h, 24h). Defaults to <code class="literal">15m</code> (15 minutes).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="provider-azure-ad"></a>Azure Active Directory (<code class="literal">azure-ad</code>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">azure-ad</code> provider allows the input to retrieve users, with group
memberships, from Azure Active Directory (AD).</p>
<h4><a id="_setup_2"></a>Setup<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>The necessary API permissions need to be granted in Azure in order for the
provider to function properly:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Permission</th>
<th align="left" valign="top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>GroupMember.Read.All</p></td>
<td align="left" valign="top"><p>Application</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>User.Read.All</p></td>
<td align="left" valign="top"><p>Application</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Device.Read.All</p></td>
<td align="left" valign="top"><p>Application</p></td>
</tr>
</tbody>
</table>
</div>
<p>For a full guide on how to set up the necessary App Registration, permission
granting, and secret configuration, follow this <a href="https://learn.microsoft.com/en-us/graph/auth-v2-service" class="ulink" target="_top">guide</a>.</p>
<h4><a id="_how_it_works_2"></a>How It Works<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<h5><a id="_overview_2"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Azure AD provider periodically contacts Azure Active Directory, retrieving
updates for users, devices and groups, updates its internal cache of user and
device metadata and group membership information, and ships updated user metadata
to Elasticsearch.</p>
<p>Fetching and shipping updates occurs in one of two processes: <span class="strong strong"><strong>full
synchronizations</strong></span> and <span class="strong strong"><strong>incremental updates</strong></span>. Full synchronizations will send the
entire list of users and devices in state, along with write markers to indicate
the start and end of the synchronization event. Incremental updates will only
send data for changed users and devices during that event. Changes on a user or
device can come in many forms, whether it be a change to the user or device
metadata, a user/device was added or deleted, or group membership was changed
(either direct or transitive).</p>
<h5><a id="_api_interactions"></a>API Interactions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The provider periodically retrieves changes to user, device and group metadata
from the Microsoft Graph API for Azure Active Directory. This is done through
calls to three API endpoints:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://learn.microsoft.com/en-us/graph/api/user-delta?view=graph-rest-1.0&amp;tabs=http" class="ulink" target="_top">/users/delta</a>
</li>
<li class="listitem">
<a href="https://learn.microsoft.com/en-us/graph/api/device-delta?view=graph-rest-1.0&amp;tabs=http" class="ulink" target="_top">/devices/delta</a>
</li>
<li class="listitem">
<a href="https://learn.microsoft.com/en-us/graph/api/group-delta?view=graph-rest-1.0&amp;tabs=http" class="ulink" target="_top">/groups/delta</a>
</li>
</ul>
</div>
<p>The <code class="literal">/delta</code> endpoint will provide changes that have occurred since the last
call, with state being tracked through a delta token. If the /delta endpoint is
called without a delta token, it will provide a full listing of users, devices
or groups, similar to the non-delta endpoint. Since many results may be returned,
there is a paging mechanism that is used. In the response body, there are two
fields that may appear, <code class="literal">@odata.nextLink</code> and <code class="literal">@odata.deltaLink</code>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If a <code class="literal">@odata.nextLink</code> is returned, then there are more results to fetch, and
the value of this field will contain the URL which should be immediately fetched.
</li>
<li class="listitem">
If a <code class="literal">@odata.deltaLink</code> is returned, then there are currently no more results,
and the value of this field (a URL) should be saved for the next time updates
need to be fetched (the delta token).
</li>
</ul>
</div>
<p>The group metadata will be used to enrich users and devices with group membership
information. Direct memberships, along with transitive memberships, will be provided
for users and devices.</p>
<h5><a id="_sending_user_and_device_metadata_to_elasticsearch_2"></a>Sending User and Device Metadata to Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>During a full synchronization, all users and devices stored in state will be sent
to the output, while incremental updates will only send users which have been
updated. Full synchronizations will be bounded on either side by write marker
documents, which will look something like this:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2022-11-04T09:57:19.786056-05:00",
    "event": {
        "action": "started",
        "start": "2022-11-04T09:57:19.786056-05:00"
    },
    "labels": {
        "identity_source": "azure-1"
    }
}</pre>
</div>
<p>User documents will show the current state of the user.</p>
<p>Example user document:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2022-11-04T09:57:19.786056-05:00",
    "event": {
        "action": "user-discovered",
    },
    "azure_ad": {
        "userPrincipalName": "example.user@example.com",
        "mail": "example.user@example.com",
        "displayName": "Example User",
        "givenName": "Example",
        "surname": "User",
        "jobTitle": "Software Engineer",
        "mobilePhone": "123-555-1000",
        "businessPhones": ["123-555-0122"]
    },
    "user": {
        "id": "5ebc6a0f-05b7-4f42-9c8a-682bbc75d0fc",
        "group": [
            {
                "id": "331676df-b8fd-4492-82ed-02b927f8dd80",
                "name": "group1"
            },
            {
                "id": "d140978f-d641-4f01-802f-4ecc1acf8935",
                "name": "group2"
            }
        ]
    },
    "labels": {
        "identity_source": "azure-1"
    }
}</pre>
</div>
<p>Device documents will show the current state of the device.</p>
<p>Example device document:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2022-11-04T09:57:19.786056-05:00",
    "event": {
        "action": "device-discovered",
    },
    "azure_ad": {
        "accountEnabled": true,
        "deviceId": "2fbbb8f9-ff67-4a21-b867-a344d18a4198",
        "displayName": "DESKTOP-LETW452G",
        "operatingSystem": "Windows",
        "operatingSystemVersion": "10.0.19043.1337",
        "physicalIds": {
            "extensionAttributes": {
                "extensionAttribute1": "BYOD-Device"
            }
        },
        "alternativeSecurityIds": [
            {
                "type": 2,
                "identityProvider": null,
                "key": "DGFSGHSGGTH345A...35DSFH0A"
            },
        ]
    },
    "device": {
        "id": "adbbe40a-0627-4328-89f1-88cac84dbc7f",
        "group": [
            {
                "id": "331676df-b8fd-4492-82ed-02b927f8dd80",
                "name": "group1"
            }
        ]
        "registered_owners": [
            {
                "id": "5ebc6a0f-05b7-4f42-9c8a-682bbc75d0fc",
                "userPrincipalName": "example.user@example.com",
                "mail": "example.user@example.com",
                "displayName": "Example User",
                "givenName": "Example",
                "surname": "User",
                "jobTitle": "Software Engineer",
                "mobilePhone": "123-555-1000",
                "businessPhones": ["123-555-0122"]
            },
        ],
        "registered_users": [
            {
                "id": "5ebc6a0f-05b7-4f42-9c8a-682bbc75d0fc",
                "userPrincipalName": "example.user@example.com",
                "mail": "example.user@example.com",
                "displayName": "Example User",
                "givenName": "Example",
                "surname": "User",
                "jobTitle": "Software Engineer",
                "mobilePhone": "123-555-1000",
                "businessPhones": ["123-555-0122"]
            },
        ],
    },
    "labels": {
        "identity_source": "azure-1"
    }
}</pre>
</div>
<h4><a id="_configuration_2"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: entity-analytics
  enabled: true
  id: azure-1
  provider: azure-ad
  dataset: "all"
  sync_interval: "12h"
  update_interval: "30m"
  client_id: "CLIENT_ID"
  tenant_id: "TENANT_ID"
  secret: "SECRET"</pre>
</div>
<p>The <code class="literal">azure-ad</code> provider supports the following configuration:</p>
<h5><a id="_tenant_id"></a><code class="literal">tenant_id</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Tenant ID. Field is required.</p>
<h5><a id="_client_id_2"></a><code class="literal">client_id</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The client/application ID. Used for authentication. Field is required.</p>
<h5><a id="_secret"></a><code class="literal">secret</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The secret value, used for authentication. Field is required.</p>
<h5><a id="_dataset"></a><code class="literal">dataset</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The datasets to collect from the API. This can be one of "all", "users" or "devices",
or may be left empty for the default behavior which is to collect all entities.
When the <code class="literal">dataset</code> is set to "devices", some user entity data is collected in order
to populate the registered users and registered owner fields for each device.</p>
<h5><a id="_sync_interval_2"></a><code class="literal">sync_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The interval in which full synchronizations should occur. The interval must be
longer than the update interval (<code class="literal">update_interval</code>) Expressed as a duration
string (e.g., 1m, 3h, 24h). Defaults to <code class="literal">24h</code> (24 hours).</p>
<h5><a id="_update_interval_2"></a><code class="literal">update_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The interval in which incremental updates should occur. The interval must be
shorter than the full synchronization interval (<code class="literal">sync_interval</code>). Expressed as a
duration string (e.g., 1m, 3h, 24h). Defaults to <code class="literal">15m</code> (15 minutes).</p>
<h5><a id="_login_endpoint"></a><code class="literal">login_endpoint</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>Override the default authentication login endpoint. Only change if directed to do
so. Altering this value will also require a change to <code class="literal">login_scopes</code>.</p>
<h5><a id="_login_scopes"></a><code class="literal">login_scopes</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>Override the default authentication scopes. Only change if directed to do so.</p>
<h5><a id="_select_users"></a><code class="literal">select.users</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>Override the default <a href="https://learn.microsoft.com/en-us/graph/api/user-get?view=graph-rest-1.0&amp;tabs=http#optional-query-parameters" class="ulink" target="_top">user query selections</a>.
This is a list of optional query parameters. The default is <code class="literal">["accountEnabled", "userPrincipalName",
"mail", "displayName", "givenName", "surname", "jobTitle", "officeLocation", "mobilePhone",
"businessPhones"]</code>.</p>
<h5><a id="_select_groups"></a><code class="literal">select.groups</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>Override the default <a href="https://learn.microsoft.com/en-us/graph/api/group-get?view=graph-rest-1.0&amp;tabs=http#optional-query-parameters" class="ulink" target="_top">group query selections</a>.
This is a list of optional query parameters. The default is <code class="literal">["displayName", "members"]</code>.</p>
<h5><a id="_select_devices"></a><code class="literal">select.devices</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>Override the default <a href="https://learn.microsoft.com/en-us/graph/api/device-get?view=graph-rest-1.0&amp;tabs=http#optional-query-parameters" class="ulink" target="_top">device query selections</a>.
This is a list of optional query parameters. The default is <code class="literal">["accountEnabled", "deviceId",
"displayName", "operatingSystem", "operatingSystemVersion", "physicalIds", "extensionAttributes",
"alternativeSecurityIds"]</code>.</p>
<h4><a id="_tracer_enabled"></a><code class="literal">tracer.enabled</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>It is possible to log HTTP requests and responses to the EntraID API to a local file-system for debugging configurations.
This option is enabled by setting <code class="literal">tracer.enabled</code> to true and setting the <code class="literal">tracer.filename</code> value.
Additional options are available to tune log rotation behavior. To delete existing logs, set <code class="literal">tracer.enabled</code>
to false without unsetting the filename option.</p>
<p>Enabling this option compromises security and should only be used for debugging.</p>
<h4><a id="_tracer_filename"></a><code class="literal">tracer.filename</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>To differentiate the trace files generated from different input instances, a placeholder <code class="literal">*</code> can be added to the
filename and will be replaced with the input instance id. For Example, <code class="literal">http-request-trace-*.ndjson</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="provider-jamf"></a>Jamf Computer Management (<code class="literal">jamf</code>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">jamf</code> provider allows the input to retrieve computer records from the
Jamf API.</p>
<h4><a id="_how_it_works_3"></a>How It Works<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<h5><a id="_overview_3"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Jamf provider periodically contacts the Jamf API, retrieving updates for
computers, updates its internal cache of managed computer metadata, and ships
updated metadata to Elasticsearch.</p>
<p>Fetching and shipping updates occurs in one of two processes: <span class="strong strong"><strong>full
synchronizations</strong></span> and <span class="strong strong"><strong>incremental updates</strong></span>. Full synchronizations will send
the entire list of computers in state, along with write markers to
indicate the start and end of the synchronization event. Incremental updates
will only send data for changed computers records during that event. Changes
on a user or device can come in many forms, whether it be a change to the
user&#8217;s metadata, or a user was added or deleted.</p>
<h5><a id="_api_interactions_2"></a>API Interactions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The provider periodically retrieves changes to user/device metadata from the
Jamf computers-preview API. This is done through calls to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.jamf.com/jamf-pro/reference/get_preview-computers" class="ulink" target="_top">/api/preview/computers</a>
</li>
</ul>
</div>
<p>Updates are tracked by the provider by retaining a record of the time of the last
noted update in the returned user list. During provider updates the Jamf provider
makes use of the Jamf API&#8217;s query filtering to only request records updated at or
since the provider&#8217;s recorded last update.</p>
<h5><a id="_sending_computer_metadata_to_elasticsearch"></a>Sending Computer Metadata to Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>During a full synchronization, all users/devices stored in state will be sent
to the output, while incremental updates will only send users and devices
that have been updated. Full synchronizations will be bounded on either side
by write marker documents, which will look something like this:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2022-11-04T09:57:19.786056-05:00",
    "event": {
        "action": "started",
        "start": "2022-11-04T09:57:19.786056-05:00"
    },
    "labels": {
        "identity_source": "jamf-1"
    }
}</pre>
</div>
<p>Documents will show the current state of the computer record.</p>
<p>Example document:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "device": {
        "id": "5982CE36-4526-580B-B4B9-ECC6782535BC"
    },
    "event": {
        "action": "device-discovered"
    },
    "jamf": {
        "location": {
            "username": "john.doe",
            "position": "Unknown Developer"
        },
        "site": null,
        "name": "acme-C07DM3AZQ6NV",
        "udid": "5982CE36-4526-580B-B4B9-ECC6782535BC",
        "serialNumber": "C07DM3AZQ6NV",
        "operatingSystemVersion": "14.0",
        "operatingSystemBuild": "23A344",
        "operatingSystemSupplementalBuildVersion": null,
        "operatingSystemRapidSecurityResponse": null,
        "macAddress": "64:0B:D7:AA:E4:B2",
        "assetTag": null,
        "modelIdentifier": "Macmini9,1",
        "mdmAccessRights": 0,
        "lastContactDate": "2024-04-18T14:26:51.514Z",
        "lastReportDate": "2024-06-19T15:54:37.692Z",
        "lastEnrolledDate": "2023-02-22T10:46:17.199Z",
        "ipAddress": null,
        "managementId": "1a59c510-b3a9-41cb-8afa-3d4187ac60d0",
        "isManaged": true
    },
    "labels": {
        "identity_source": "jamf-1"
    }
}</pre>
</div>
<h4><a id="_configuration_3"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: entity-analytics
  enabled: true
  id: jamf-1
  provider: jamf
  dataset: "all"
  sync_interval: "12h"
  update_interval: "30m"
  jamf_tenant: "JAMF_TENANT"
  jamf_username: "JAMF_USERNAME"
  jamf_password: "JAMF_PASSWORD"</pre>
</div>
<p>The <code class="literal">jamf</code> provider supports the following configuration:</p>
<h5><a id="_jamf_tenant"></a><code class="literal">jamf_tenant</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Jamf tenant host. Field is required.</p>
<h5><a id="_jamf_username"></a><code class="literal">jamf_username</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Jamf username, used for authentication. Field is required.</p>
<h5><a id="_jamf_password"></a><code class="literal">jamf_password</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Jamf user password, used for authentication. Field is required.</p>
<h5><a id="_page_size"></a><code class="literal">page_size</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The number of computer records to collect with each API request. Defaults to <a href="https://developer.jamf.com/jamf-pro/reference/get_preview-computers" class="ulink" target="_top">API default</a>.</p>
<h5><a id="_sync_interval_3"></a><code class="literal">sync_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The interval in which full synchronizations should occur. The interval must be
longer than the update interval (<code class="literal">update_interval</code>) Expressed as a duration
string (e.g., 1m, 3h, 24h). Defaults to <code class="literal">24h</code> (24 hours).</p>
<h5><a id="_update_interval_3"></a><code class="literal">update_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The interval in which incremental updates should occur. The interval must be
shorter than the full synchronization interval (<code class="literal">sync_interval</code>). Expressed as a
duration string (e.g., 1m, 3h, 24h). Defaults to <code class="literal">15m</code> (15 minutes).</p>
<p>+==== <code class="literal">tracer.enabled</code></p>
<p>It is possible to log HTTP requests and responses to the Jamf API to a local file-system for debugging configurations.
This option is enabled by setting <code class="literal">tracer.enabled</code> to true and setting the <code class="literal">tracer.filename</code> value.
Additional options are available to tune log rotation behavior. To delete existing logs, set <code class="literal">tracer.enabled</code>
to false without unsetting the filename option.</p>
<p>Enabling this option compromises security and should only be used for debugging.</p>
<h4><a id="_tracer_filename_2"></a><code class="literal">tracer.filename</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>To differentiate the trace files generated from different input instances, a placeholder <code class="literal">*</code> can be added to the
filename and will be replaced with the input instance id. For Example, <code class="literal">http-request-trace-*.ndjson</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="provider-okta"></a>Okta User Identities (<code class="literal">okta</code>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">okta</code> provider allows the input to retrieve users and devices from the
Okta user API.</p>
<h4><a id="_setup_3"></a>Setup<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>The necessary API permissions need to be granted in Okta in order for the
provider to function properly. In the administration dashboard for your
Okta account, navigate to Security&gt;API and in the Tokens tab click the
"Create token" button to create a new token. Copy the token value and retain
this to configure the provider. Note that the token will not be presented
again, so it must be copied now. This value will use given to the provider
via the <code class="literal">okta_token</code> configuration field.</p>
<p>Devices API access needs to be activated by Okta support.</p>
<h4><a id="_how_it_works_4"></a>How It Works<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<h5><a id="_overview_4"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Okta provider periodically contacts the Okta API, retrieving updates for
users and devices, updates its internal cache of user metadata, and ships
updated user/device metadata to Elasticsearch.</p>
<p>Fetching and shipping updates occurs in one of two processes: <span class="strong strong"><strong>full
synchronizations</strong></span> and <span class="strong strong"><strong>incremental updates</strong></span>. Full synchronizations will send
the entire list of users and devices in state, along with write markers to
indicate the start and end of the synchronization event. Incremental updates
will only send data for changed users and devices during that event. Changes
on a user or device can come in many forms, whether it be a change to the
user&#8217;s metadata, or a user was added or deleted.</p>
<h5><a id="_api_interactions_3"></a>API Interactions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The provider periodically retrieves changes to user/device metadata from the
Okta User and Device APIs. This is done through calls to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/users/#list-users" class="ulink" target="_top">/api/v1/users</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/api/openapi/okta-management/management/tag/Device/#tag/Device/operation/listDevices" class="ulink" target="_top">/api/v1/devices</a>
</li>
</ul>
</div>
<p>Updates are tracked by the provider by retaining a record of the time of the last
noted update in the returned user list. During provider updates the Okta provider
makes use of the Okta API&#8217;s query filtering to only request records updated at or
since the provider&#8217;s recorded last update.</p>
<h5><a id="_sending_user_metadata_to_elasticsearch"></a>Sending User Metadata to Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>During a full synchronization, all users/devices stored in state will be sent
to the output, while incremental updates will only send users and devices
that have been updated. Full synchronizations will be bounded on either side
by write marker documents, which will look something like this:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2022-11-04T09:57:19.786056-05:00",
    "event": {
        "action": "started",
        "start": "2022-11-04T09:57:19.786056-05:00"
    },
    "labels": {
        "identity_source": "okta-1"
    }
}</pre>
</div>
<p>User documents will show the current state of the user.</p>
<p>Example user document:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2023-07-04T09:57:19.786056-05:00",
    "event": {
        "action": "user-discovered",
    },
    "okta": {
        "id": "userid",
        "status": "RECOVERY",
        "created": "2023-06-02T09:33:00.189752+09:30",
        "activated": "0001-01-01T00:00:00Z",
        "statusChanged": "2023-06-02T09:33:00.189752+09:30",
        "lastLogin": "2023-06-02T09:33:00.189752+09:30",
        "lastUpdated": "2023-06-02T09:33:00.189753+09:30",
        "passwordChanged": "2023-06-02T09:33:00.189753+09:30",
        "type": {
            "id": "typeid"
        },
        "profile": {
            "login": "name.surname@example.com",
            "email": "name.surname@example.com",
            "firstName": "name",
            "lastName": "surname"
        },
        "credentials": {
            "password": {},
            "provider": {
                "type": "OKTA",
                "name": "OKTA"
            }
        },
        "_links": {
            "self": {
                "href": "https://localhost/api/v1/users/userid"
            }
        }
    },
    "user": {
        "id": "userid",
    },
    "labels": {
        "identity_source": "okta-1"
    }
}</pre>
</div>
<p>Device documents will show the current state of the device, including any
associated users.</p>
<p>Example device document:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
    "@timestamp": "2023-07-04T09:57:19.786056-05:00",
    "event": {
        "action": "device-discovered",
    },
    "okta": {
        "created": "2019-10-02T18:03:07Z",
        "id": "deviceid",
        "lastUpdated": "2019-10-02T18:03:07Z",
        "profile": {
            "diskEncryptionType": "ALL_INTERNAL_VOLUMES",
            "displayName": "Example Device name 1",
            "platform": "WINDOWS",
            "registered": true,
            "secureHardwarePresent": false,
            "serialNumber": "XXDDRFCFRGF3M8MD6D",
            "sid": "S-1-11-111"
        },
        "resourceAlternateID": "",
        "resourceDisplayName": {
            "sensitive": false,
            "value": "Example Device name 1"
        },
        "resourceID": "deviceid",
        "resourceType": "UDDevice",
        "status": "ACTIVE",
        "_links": {
            "activate": {
                "hints": {
                    "allow": [
                        "POST"
                    ]
                },
                "href": "https://localhost/api/v1/devices/deviceid/lifecycle/activate"
            },
            "self": {
                "hints": {
                    "allow": [
                        "GET",
                        "PATCH",
                        "PUT"
                    ]
                },
                "href": "https://localhost/api/v1/devices/deviceid"
            },
            "users": {
                "hints": {
                    "allow": [
                        "GET"
                    ]
                },
                "href": "https://localhost/api/v1/devices/deviceid/users"
            }
        },
        "users": [
            {
                "id": "userid",
                "status": "RECOVERY",
                "created": "2023-05-14T13:37:20Z",
                "activated": "0001-01-01T00:00:00Z",
                "statusChanged": "2023-05-15T01:50:30Z",
                "lastLogin": "2023-05-15T01:59:20Z",
                "lastUpdated": "2023-05-15T01:50:32Z",
                "passwordChanged": "2023-05-15T01:50:32Z",
                "type": {
                    "id": "typeid"
                },
                "profile": {
                    "login": "name.surname@example.com",
                    "email": "name.surname@example.com",
                    "firstName": "name",
                    "lastName": "surname"
                },
                "credentials": {
                    "password": {},
                    "provider": {
                        "type": "OKTA",
                        "name": "OKTA"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://localhost/api/v1/users/userid"
                    }
                }
            }
        ]
    },
    "device": {
        "id": "deviceid",
    },
    "labels": {
        "identity_source": "okta-1"
    }
}</pre>
</div>
<h4><a id="_configuration_4"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">filebeat.inputs:
- type: entity-analytics
  enabled: true
  id: okta-1
  provider: okta
  dataset: "all"
  sync_interval: "12h"
  update_interval: "30m"
  okta_domain: "OKTA_DOMAIN"
  okta_token: "OKTA_TOKEN"</pre>
</div>
<p>The <code class="literal">okta</code> provider supports the following configuration:</p>
<h5><a id="_okta_domain"></a><code class="literal">okta_domain</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Okta domain. Field is required.</p>
<h5><a id="_okta_token"></a><code class="literal">okta_token</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The Okta secret token, used for authentication. Field is required.</p>
<h5><a id="_collect_device_details"></a><code class="literal">collect_device_details</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>Whether the input should collect device and device-associated user details
from the Okta API. Device details must be activated on the Okta account for
this option.</p>
<h5><a id="_dataset_2"></a><code class="literal">dataset</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The datasets to collect from the API. This can be one of "all", "users" or "devices",
or may be left empty for the default behavior which is to collect all entities.
When the <code class="literal">dataset</code> is set to "devices", some user entity data is collected in order
to populate the registered users and registered owner fields for each device.</p>
<h5><a id="_sync_interval_4"></a><code class="literal">sync_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The interval in which full synchronizations should occur. The interval must be
longer than the update interval (<code class="literal">update_interval</code>) Expressed as a duration
string (e.g., 1m, 3h, 24h). Defaults to <code class="literal">24h</code> (24 hours).</p>
<h5><a id="_update_interval_4"></a><code class="literal">update_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h5>
<p>The interval in which incremental updates should occur. The interval must be
shorter than the full synchronization interval (<code class="literal">sync_interval</code>). Expressed as a
duration string (e.g., 1m, 3h, 24h). Defaults to <code class="literal">15m</code> (15 minutes).</p>
<h4><a id="_tracer_enabled_2"></a><code class="literal">tracer.enabled</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>It is possible to log HTTP requests and responses to the Okta API to a local file-system for debugging configurations.
This option is enabled by setting <code class="literal">tracer.enabled</code> to true and setting the <code class="literal">tracer.filename</code> value.
Additional options are available to tune log rotation behavior. To delete existing logs, set <code class="literal">tracer.enabled</code>
to false without unsetting the filename option.</p>
<p>Enabling this option compromises security and should only be used for debugging.</p>
<h4><a id="_tracer_filename_3"></a><code class="literal">tracer.filename</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>To differentiate the trace files generated from different input instances, a placeholder <code class="literal">*</code> can be added to the
filename and will be replaced with the input instance id. For Example, <code class="literal">http-request-trace-*.ndjson</code>.</p>
<h4><a id="_metrics_6"></a>Metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/8.15/x-pack/filebeat/docs/inputs/input-entity-analytics.asciidoc">edit</a></h4>
<p>This input exposes metrics under the <a class="xref" href="http-endpoint.html" title="Configure an HTTP endpoint for metrics">HTTP monitoring endpoint</a>.
These metrics are exposed under the <code class="literal">/inputs</code> path. They can be used to
observe the activity of the input.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Metric</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">sync_total</code></p></td>
<td align="left" valign="top"><p>The total number of full synchronizations.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sync_error</code></p></td>
<td align="left" valign="top"><p>The number of full synchronizations that failed due to an error.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sync_processing_time</code></p></td>
<td align="left" valign="top"><p>Histogram of the elapsed full synchronizations times in nanoseconds (time of API contact to items sent to output).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">update_total</code></p></td>
<td align="left" valign="top"><p>The total number of incremental updates.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">update_error</code></p></td>
<td align="left" valign="top"><p>The number of incremental updates that failed due to an error.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">update_processing_time</code></p></td>
<td align="left" valign="top"><p>Histogram of the elapsed incremental updates times in nanoseconds (time of API contact to items sent to output).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This input is experimental and is under active developement. Configuration
options and behaviors may change without warning. Use with caution and do not use
in production environments.</p>
</div>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="filebeat-input-container.html">« Container input</a>
</span>
<span class="next">
<a href="filebeat-input-etw.html">ETW input »</a>
</span>
</div>
</body>
</html>
