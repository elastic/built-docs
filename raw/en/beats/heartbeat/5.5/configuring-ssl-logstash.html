<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Securing Communication With Logstash by Using SSL
        | Heartbeat Reference [5.5]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Heartbeat Reference [5.5]" /><link rel="up" href="securing-heartbeat.html" title="Securing Heartbeat" /><link rel="prev" href="securing-communication-elasticsearch.html" title="Securing Communication With Elasticsearch" /><link rel="next" href="troubleshooting.html" title="Troubleshooting" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Heartbeat/Reference/5.5" /><meta xmlns="" name="DC.subject" content="Heartbeat" /><meta xmlns="" name="DC.identifier" content="5.5" /></head><body><div xmlns="" class="page_header">This functionality is in beta and is subject to change. The design and
code is considered to be less mature than official GA features. Elastic will
take a best effort approach to fix any issues, but beta features are not
subject to the support SLA of official GA features.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Heartbeat Reference
      [5.5]
    </a></span> » <span class="breadcrumb-link"><a href="securing-heartbeat.html">Securing Heartbeat</a></span> » <span class="breadcrumb-node">Securing Communication With Logstash by Using SSL</span></div><div xmlns="" class="navheader"><span class="prev"><a href="securing-communication-elasticsearch.html">
              « 
              Securing Communication With Elasticsearch</a>
           
        </span><span class="next">
           
          <a href="troubleshooting.html">Troubleshooting
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-ssl-logstash"></a>Securing Communication With Logstash by Using SSL<a xmlns="" href="https://github.com/elastic/beats/edit/5.5/heartbeat/docs/securing-heartbeat.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>You can use SSL mutual authentication to secure connections between Heartbeat and Logstash. This ensures that
Heartbeat sends encrypted data to trusted Logstash servers only, and that the Logstash server receives data from
trusted Heartbeat clients only.</p><p>To use SSL mutual authentication:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Create a certificate authority (CA) and use it to sign the certificates that you plan to use for
Heartbeat and Logstash. Creating a correct SSL/TLS infrastructure is outside the scope of this
document. There are many online resources available that describe how to create certificates.
</p><div xmlns="" class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">If you are using X-Pack, you can use the
<a class="ulink" href="https://www.elastic.co/guide/en/x-pack/5.2/ssl-tls.html#generating-signed-certificates" target="_top">certgen tool</a> to generate certificates.</p></div></div></li><li class="listitem"><p class="simpara">
Configure Heartbeat to use SSL. In the <code class="literal">heartbeat.yml</code> config file, specify the following settings under
<code class="literal">ssl</code>:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">certificate_authorities</code>: Configures Heartbeat to trust any certificates signed by the specified CA. If
<code class="literal">certificate_authorities</code> is empty or not set, the trusted certificate authorities of the host system are used.
</li><li class="listitem"><p class="simpara">
<code class="literal">certificate</code> and <code class="literal">key</code>: Specifies the certificate and key that Heartbeat uses to authenticate with
Logstash.
</p><p class="simpara">For example:</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">output.logstash:
  hosts: ["logs.mycompany.com:5044"]
  ssl.certificate_authorities: ["/etc/ca.crt"]
  ssl.certificate: "/etc/client.crt"
  ssl.key: "/etc/client.key"</pre></div><p class="simpara">For more information about these configuration options, see <a class="xref" href="configuration-output-ssl.html" title="SSL">SSL</a>.</p></li></ul></div></li><li class="listitem"><p class="simpara">
Configure Logstash to use SSL. In the Logstash config file, specify the following settings for the <a class="ulink" href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-beats.html" target="_top">Beats input plugin for Logstash</a>:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">ssl</code>: When set to true, enables Logstash to use SSL/TLS.
</li><li class="listitem">
<code class="literal">ssl_certificate_authorities</code>: Configures Logstash to trust any certificates signed by the specified CA.
</li><li class="listitem">
<code class="literal">ssl_certificate</code> and <code class="literal">ssl_key</code>: Specify the certificate and key that Logstash uses to authenticate with the client.
</li><li class="listitem"><p class="simpara">
<code class="literal">ssl_verify_mode</code>: Specifies whether the Logstash server verifies the client certificate against the CA. You
need to specify either <code class="literal">peer</code> or <code class="literal">force_peer</code> to make the server ask for the certificate and validate it. If you
specify <code class="literal">force_peer</code>, and Heartbeat doesn’t provide a certificate, the Logstash connection will be closed.
</p><p class="simpara">For example:</p><div xmlns="" class="pre_wrapper lang-json"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-json">input {
  beats {
    port =&gt; 5044
    ssl =&gt; true
    ssl_certificate_authorities =&gt; ["/etc/ca.crt"]
    ssl_certificate =&gt; "/etc/server.crt"
    ssl_key =&gt; "/etc/server.key"
    ssl_verify_mode =&gt; "force_peer"
  }
}</pre></div><p class="simpara">For more information about these options, see the
<a class="ulink" href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-beats.html" target="_top">documentation for the Beats input plugin</a>.</p></li></ul></div></li></ol></div><h3><a id="testing-ssl-logstash"></a>Validating the Logstash Server’s Certificate<a xmlns="" href="https://github.com/elastic/beats/edit/5.5/libbeat/docs/shared-ssl-logstash-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Before running Heartbeat, you should validate the Logstash server’s certificate. You can use <code class="literal">curl</code> to validate the certificate even though the protocol used to communicate with Logstash is not based on HTTP. For example:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">curl -v --cacert ca.crt https://logs.mycompany.com:5044</pre></div><p>If the test is successful, you’ll receive an empty response error:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">* Rebuilt URL to: https://logs.mycompany.com:5044/
*   Trying 192.168.99.100...
* Connected to logs.mycompany.com (192.168.99.100) port 5044 (#0)
* TLS 1.2 connection using TLS_DHE_RSA_WITH_AES_256_CBC_SHA
* Server certificate: logs.mycompany.com
* Server certificate: mycompany.com
&gt; GET / HTTP/1.1
&gt; Host: logs.mycompany.com:5044
&gt; User-Agent: curl/7.43.0
&gt; Accept: */*
&gt;
* Empty reply from server
* Connection #0 to host logs.mycompany.com left intact
curl: (52) Empty reply from server</pre></div><p>The following example uses the IP address rather than the hostname to validate the certificate:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">curl -v --cacert ca.crt https://192.168.99.100:5044</pre></div><p>Validation for this test fails because the certificate is not valid for the specified IP address. It’s only valid for the <code class="literal">logs.mycompany.com</code>, the hostname that appears in the Subject field of the certificate.</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">* Rebuilt URL to: https://192.168.99.100:5044/
*   Trying 192.168.99.100...
* Connected to 192.168.99.100 (192.168.99.100) port 5044 (#0)
* WARNING: using IP address, SNI is being disabled by the OS.
* SSL: certificate verification failed (result: 5)
* Closing connection 0
curl: (51) SSL: certificate verification failed (result: 5)</pre></div><p>See the <a class="link" href="faq.html#ssl-client-fails" title="SSL client fails to connect to Logstash?">troubleshooting docs</a> for info about resolving this issue.</p><h3><a id="_testing_the_beats_to_logstash_connection"></a>Testing the Beats to Logstash Connection<a xmlns="" href="https://github.com/elastic/beats/edit/5.5/libbeat/docs/shared-ssl-logstash-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>If you have Heartbeat running as a service, first stop the service. Then test your setup by running Heartbeat in
the foreground so you can quickly see any errors that occur:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">heartbeat -c heartbeat.yml -e -v</pre></div><p>Any errors will be printed to the console. See the <a class="link" href="faq.html#ssl-client-fails" title="SSL client fails to connect to Logstash?">troubleshooting docs</a> for info about
resolving common errors.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="securing-communication-elasticsearch.html">
              « 
              Securing Communication With Elasticsearch</a>
           
        </span><span class="next">
           
          <a href="troubleshooting.html">Troubleshooting
               »
            </a></span></div></body></html>