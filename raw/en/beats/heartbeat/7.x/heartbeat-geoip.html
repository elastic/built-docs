<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Enrich events with geoIP information
        | Heartbeat Reference [7.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Heartbeat Reference [7.x]" /><link rel="up" href="configuring-howto-heartbeat.html" title="Configuring Heartbeat" /><link rel="prev" href="configuring-ingest-node.html" title="Parse data by using ingest node" /><link rel="next" href="configuration-path.html" title="Configure project paths" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Heartbeat/Reference/7.x" /><meta xmlns="" name="DC.subject" content="Heartbeat" /><meta xmlns="" name="DC.identifier" content="7.x" /></head><body><div xmlns="" class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Heartbeat Reference
      [7.x]
    </a></span> » <span class="breadcrumb-link"><a href="configuring-howto-heartbeat.html">Configuring Heartbeat</a></span> » <span class="breadcrumb-node">Enrich events with geoIP information</span></div><div xmlns="" class="navheader"><span class="prev"><a href="configuring-ingest-node.html">
              « 
              Parse data by using ingest node</a>
           
        </span><span class="next">
           
          <a href="configuration-path.html">Configure project paths
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="heartbeat-geoip"></a>Enrich events with geoIP information<a xmlns="" href="https://github.com/elastic/beats/edit/7.x/libbeat/docs/shared-geoip.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>You can use Heartbeat along with the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/geoip-processor.html" target="_top">GeoIP
Processor</a> in Elasticsearch to export geographic location information based on IP
addresses. Then you can use this information to visualize the location of IP
addresses on a map in Kibana.</p><p>The <code class="literal">geoip</code> processor adds information about the geographical location of
IP addresses, based on data from the Maxmind GeoLite2 City Database. Because the
processor uses a geoIP database that’s installed on Elasticsearch, you don’t need
to install a geoIP database on the machines running Heartbeat.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">If your use case involves using Logstash, you can use the
<a class="ulink" href="http://www.elastic.co/guide/en/logstash/7.x/plugins-filters-geoip.html" target="_top">GeoIP filter</a> available in Logstash
instead of using the <code class="literal">geoip</code> processor. However, using the <code class="literal">geoip</code> processor is
the simplest approach when you don’t require the additional processing power of
Logstash.</p></div></div><h3><a id="heartbeat-configuring-geoip"></a>Configure the <code class="literal">geoip</code> processor<a xmlns="" href="https://github.com/elastic/beats/edit/7.x/libbeat/docs/shared-geoip.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To configure Heartbeat and the <code class="literal">geoip</code> processor:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Define an ingest node pipeline that uses one or more <code class="literal">geoip</code> processors to
add location information to the event. For example, you can use the Console in
Kibana to create the following pipeline:
</p><div xmlns="" class="pre_wrapper lang-json"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-json">PUT _ingest/pipeline/geoip-info
{
  "description": "Add geoip info",
  "processors": [
    {
      "geoip": {
        "field": "client.ip",
        "target_field": "client.geo",
        "ignore_missing": true
      }
    },
    {
      "geoip": {
        "field": "source.ip",
        "target_field": "source.geo",
        "ignore_missing": true
      }
    },
    {
      "geoip": {
        "field": "destination.ip",
        "target_field": "destination.geo",
        "ignore_missing": true
      }
    },
    {
      "geoip": {
        "field": "server.ip",
        "target_field": "server.geo",
        "ignore_missing": true
      }
    },
    {
      "geoip": {
        "field": "host.ip",
        "target_field": "host.geo",
        "ignore_missing": true
      }
    }
  ]
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p class="simpara">In this example, the pipeline ID is <code class="literal">geoip-info</code>. <code class="literal">field</code> specifies the field
that contains the IP address to use for the geographical lookup, and
<code class="literal">target_field</code> is the field that will hold the geographical information.
<code class="literal">"ignore_missing": true</code> configures the pipeline to continue processing when
it encounters an event that doesn’t have the specified field.</p><p class="simpara">See
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/geoip-processor.html" target="_top">GeoIP Processor</a> for more options.</p><p class="simpara">To learn more about adding host information to an event, see
<a class="xref" href="add-host-metadata.html" title="Add Host metadata">Add Host metadata</a>.</p></li><li class="listitem"><p class="simpara">
In the Heartbeat config file, configure the Elasticsearch output to use the
pipeline. Specify the pipeline ID in the <code class="literal">pipeline</code> option under
<code class="literal">output.elasticsearch</code>. For example:
</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["localhost:9200"]
  pipeline: geoip-info</pre></div></li><li class="listitem"><p class="simpara">
Run Heartbeat. Remember to use <code class="literal">sudo</code> if the config file is owned by
root.
</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">./heartbeat -e</pre></div><p class="simpara">If the lookups succeed, the events are enriched with <code class="literal">geo_point</code> fields, such as
<code class="literal">client.geo.location</code> and <code class="literal">host.geo.location</code>, that you can use to populate
visualizations in Kibana.</p></li></ol></div><p>If you add a field that’s not already defined as a <code class="literal">geo_point</code> in the
index template, add a mapping so the field gets indexed correctly.</p><h3><a id="heartbeat-visualizing-location"></a>Visualize locations<a xmlns="" href="https://github.com/elastic/beats/edit/7.x/libbeat/docs/shared-geoip.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To visualize the location of IP addresses, you can
create a new <a class="ulink" href="https://www.elastic.co/guide/en/kibana/7.x/tilemap.html" target="_top">coordinate map</a> in Kibana and select the
location field, for example <code class="literal">client.geo.location</code> or <code class="literal">host.geo.location</code>, as
the Geohash.</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="./images/coordinate-map.png" alt="Coordinate map in Kibana" /></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="configuring-ingest-node.html">
              « 
              Parse data by using ingest node</a>
           
        </span><span class="next">
           
          <a href="configuration-path.html">Configure project paths
               »
            </a></span></div></body></html>