<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>aws module | Metricbeat Reference [7.1] | Elastic</title>
<link rel="home" href="index.html" title="Metricbeat Reference [7.1]"/>
<link rel="up" href="metricbeat-modules.html" title="Modules"/>
<link rel="prev" href="metricbeat-metricset-apache-status.html" title="Apache status metricset"/>
<link rel="next" href="metricbeat-metricset-aws-ec2.html" title="aws ec2 metricset"/>
<meta name="DC.type" content="Learn/Docs/Metricbeat/Reference/7.1"/>
<meta name="DC.subject" content="Metricbeat"/>
<meta name="DC.identifier" content="7.1"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Metricbeat Reference [7.1]</a></span>
»
<span class="breadcrumb-link"><a href="metricbeat-modules.html">Modules</a></span>
»
<span class="breadcrumb-node">aws module</span>
</div>
<div class="navheader">
<span class="prev">
<a href="metricbeat-metricset-apache-status.html">« Apache status metricset</a>
</span>
<span class="next">
<a href="metricbeat-metricset-aws-ec2.html">aws ec2 metricset »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="metricbeat-module-aws"></a>aws module<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.1/metricbeat/docs/modules/aws.asciidoc">edit</a></h2>
</div></div></div>
<p>This module periodically fetches monitoring metrics from AWS Cloudwatch using
<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricData.html" class="ulink" target="_top">GetMetricData API</a> for AWS services.
Note: extra AWS charges on GetMetricData API requests will be generated by this module.</p>
<p>The default metricset is <code class="literal">ec2</code>.</p>
<h3><a id="_module_specific_configuration_notes"></a>Module-specific configuration notes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.1/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>This module environment variable <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code>, <code class="literal">AWS_SESSION_TOKEN</code> and <code class="literal">AWS_REGION</code>
references in the config file to set values that need to be configurable during deployment.</p>
<p>There are two different kinds of AWS credentials can be used here: <code class="literal">access keys</code> and <code class="literal">temporary security credentials</code>.
<code class="literal">AWS_ACCESS_KEY_ID</code> and <code class="literal">AWS_SECRET_ACCESS_KEY</code> are the two parts of <code class="literal">access keys</code>. They are long-term credentials for
an IAM user or the AWS account root user. Please see
<a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" class="ulink" target="_top">AWS Access Keys
 and Secret Access Keys</a> for more details. <code class="literal">temporary security credentials</code> has a limited lifetime and consists of an access key ID,
a secret access key, and a security token which typically returned from <code class="literal">GetSessionToken</code>. MFA-enabled IAM users would
need to submit an MFA code while calling <code class="literal">GetSessionToken</code>. <code class="literal">aws_default_region</code> is to set the region for SDK to use. Please
see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" class="ulink" target="_top">Temporary Security Credentials</a> for more details.
<code class="literal">sts get-session-token</code> AWS CLI can be used to generate temporary credentials. For example. with MFA-enabled:</p>
<pre class="screen">aws&gt; sts get-session-token --serial-number arn:aws:iam::1234:mfa/your-email@example.com --token-code 456789 --duration-seconds 129600</pre>
<p>Because temporary security credentials are short term, after they expire, the user needs to generate new ones and modify
the aws.yml config file with the new credentials. Unless <a href="/guide/en/beats/metricbeat/current/_live_reloading.html" class="ulink" target="_top">live reloading</a>
feature is enabled for Metricbeat, the user needs to manually restart Metricbeat after updating the config file in order
to continue collecting Cloudwatch metrics. This will cause data loss if the config file is not updated with new
credentials before the old ones expire. For Metricbeat, we recommend users to use access keys in config file to enable
aws module making AWS api calls without have to generate new temporary credentials and update the config frequently.</p>
<p>IAM policy is an entity that defines permissions to an object within your AWS environment. Specific permissions needs
to be added into the IAM user&#8217;s policy to authorize Metricbeat to collect AWS monitoring metrics. Please see documentation
under each metricset for required permissions.</p>
<p>By default, Amazon EC2 sends metric data to CloudWatch every 5 minutes. With this basic monitoring, <code class="literal">period</code> in aws module
configuration should be larger or equal than <code class="literal">300s</code>. If <code class="literal">period</code> is set to be less than <code class="literal">300s</code>, the same cloudwatch metrics
will be collected more than once which will cause extra fees without getting more granular metrics. For example, in <code class="literal">US East (N. Virginia)</code> region, it costs
$0.01/1000 metrics requested using GetMetricData. Please see <a href="https://aws.amazon.com/cloudwatch/pricing/" class="ulink" target="_top">AWS Cloudwatch Pricing</a>
for more details. To avoid unnecessary charges, <code class="literal">period</code> is preferred to be set to <code class="literal">300s</code> or multiples of <code class="literal">300s</code>, such as
<code class="literal">600s</code> and <code class="literal">900s</code>.</p>
<p>For more granular monitoring data you can enable detailed monitoring on the instance to get metrics every 1 minute. Please see
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-cloudwatch-new.html" class="ulink" target="_top">Enabling Detailed Monitoring</a> for instructions
on how to enable detailed monitoring. With detailed monitoring enabled, <code class="literal">period</code> in aws module configuration can be any number
larger than <code class="literal">60s</code>. Since AWS sends metric data to CloudWatch in 1-minute periods, setting metricbeat module <code class="literal">period</code> less
than <code class="literal">60s</code> will cause extra API requests which means extra charges on AWS. To avoid unnecessary charges, <code class="literal">period</code> is
preferred to be set to <code class="literal">60s</code> or multiples of <code class="literal">60s</code>, such as <code class="literal">120s</code> and <code class="literal">180s</code>.</p>
<p>Here is an example of aws metricbeat module configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets: ["ec2"]
  access_key_id: '${AWS_ACCESS_KEY_ID}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY}'
  session_token: '${AWS_SESSION_TOKEN}'
  default_region: '${AWS_REGION:us-west-1}'</pre>
</div>
<h2><a id="_metricsets_4"></a>Metricsets<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.1/metricbeat/docs/modules/aws.asciidoc">edit</a></h2>
<p>The following Metricsets are already included:</p>
<h3><a id="_ec2"></a><code class="literal">ec2</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.1/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>By default, Amazon EC2 sends metric data to CloudWatch every 5 minutes. With this basic monitoring, <code class="literal">period</code> in aws module
configuration should be larger or equal than <code class="literal">300s</code>. If <code class="literal">period</code> is set to be less than <code class="literal">300s</code>, the same cloudwatch metrics
will be collected more than once which will cause extra fees without getting more granular metrics. For example, in <code class="literal">US East (N. Virginia)</code> region, it costs
$0.01/1000 metrics requested using GetMetricData. Please see <a href="https://aws.amazon.com/cloudwatch/pricing/" class="ulink" target="_top">AWS Cloudwatch Pricing</a>
for more details. To avoid unnecessary charges, <code class="literal">period</code> is preferred to be set to <code class="literal">300s</code> or multiples of <code class="literal">300s</code>, such as
<code class="literal">600s</code> and <code class="literal">900s</code>. For more granular monitoring data you can enable detailed monitoring on the instance to get metrics every 1 minute. Please see
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-cloudwatch-new.html" class="ulink" target="_top">Enabling Detailed Monitoring</a> for instructions
on how to enable detailed monitoring. With detailed monitoring enabled, <code class="literal">period</code> in aws module configuration can be any number
larger than <code class="literal">60s</code>. Since AWS sends metric data to CloudWatch in 1-minute periods, setting metricbeat module <code class="literal">period</code> less
than <code class="literal">60s</code> will cause extra API requests which means extra charges on AWS. To avoid unnecessary charges, <code class="literal">period</code> is
preferred to be set to <code class="literal">60s</code> or multiples of <code class="literal">60s</code>, such as <code class="literal">120s</code> and <code class="literal">180s</code>.</p>
<p>The AWS module comes with a predefined dashboard. For example:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-ec2-overview.png" alt="metricbeat aws ec2 overview">
</div>
</div>
<h3><a id="_example_configuration_3"></a>Example configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.1/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The aws module supports the standard configuration options that are described
in <a class="xref" href="configuration-metricbeat.html" title="Specify which modules to run"><em>Specify which modules to run</em></a>. Here is an example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - "ec2"
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'</pre>
</div>
<h3><a id="_metricsets_5"></a>Metricsets<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.1/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The following metricsets are available:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-ec2.html" title="aws ec2 metricset">ec2</a>
</li>
</ul>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="metricbeat-metricset-apache-status.html">« Apache status metricset</a>
</span>
<span class="next">
<a href="metricbeat-metricset-aws-ec2.html">aws ec2 metricset »</a>
</span>
</div>
</div>
</body>
</html>
