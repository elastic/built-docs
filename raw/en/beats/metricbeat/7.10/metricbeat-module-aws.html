<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS module | Metricbeat Reference [7.10] | Elastic</title>
<link rel="home" href="index.html" title="Metricbeat Reference [7.10]"/>
<link rel="up" href="metricbeat-modules.html" title="Modules"/>
<link rel="prev" href="metricbeat-metricset-appsearch-stats.html" title="App Search stats metricset"/>
<link rel="next" href="metricbeat-metricset-aws-billing.html" title="AWS billing metricset"/>
<meta name="DC.type" content="Learn/Docs/Metricbeat/Reference/7.10"/>
<meta name="DC.subject" content="Metricbeat"/>
<meta name="DC.identifier" content="7.10"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Metricbeat Reference [7.10]</a></span>
»
<span class="breadcrumb-link"><a href="metricbeat-modules.html">Modules</a></span>
»
<span class="breadcrumb-node">AWS module</span>
</div>
<div class="navheader">
<span class="prev">
<a href="metricbeat-metricset-appsearch-stats.html">« App Search stats metricset</a>
</span>
<span class="next">
<a href="metricbeat-metricset-aws-billing.html">AWS billing metricset »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="metricbeat-module-aws"></a>AWS module<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>This module periodically fetches monitoring metrics from AWS CloudWatch using
<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricData.html" class="ulink" target="_top">GetMetricData API</a> for AWS services.</p>
<p>All metrics are enabled by default.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Extra AWS charges on CloudWatch API requests will be generated by this
module. Please see <a class="xref" href="metricbeat-module-aws.html#aws-api-requests" title="AWS API requests count per metricset">AWS API requests</a> for more details.</p>
</div>
</div>
<h2><a id="_module_specific_configuration_notes"></a>Module-specific configuration notes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h2>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>AWS Credentials</strong></span>
</li>
</ul>
</div>
<p>The <code class="literal">aws</code> module requires AWS credentials configuration in order to make AWS API calls.
Users can either use <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code> and/or
<code class="literal">AWS_SESSION_TOKEN</code>, or use shared AWS credentials file.
Please see <a class="xref" href="metricbeat-module-aws.html#aws-credentials-config" title="AWS Credentials Configuration">AWS credentials options</a> for more details.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>regions</strong></span>
</li>
</ul>
</div>
<p>This module also accepts optional configuration <code class="literal">regions</code> to specify which
AWS regions to query metrics from. If the <code class="literal">regions</code> parameter is not set in the
config file, then by default, the <code class="literal">aws</code> module will query metrics from all available
AWS regions.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>latency</strong></span>
</li>
</ul>
</div>
<p>Some AWS services send monitoring metrics to CloudWatch with a latency to
process larger than Metricbeat collection period. This case, please specify a
<code class="literal">latency</code> parameter so collection start time and end time will be shifted by the
given latency amount.</p>
<p>The aws module comes with a predefined dashboard. For example:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-overview.png" alt="metricbeat aws overview">
</div>
</div>
<h2><a id="_metricsets_6"></a>Metricsets<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h2>
<p>Currently, we have <code class="literal">billing</code>, <code class="literal">cloudwatch</code>, <code class="literal">dynamodb</code>, <code class="literal">ebs</code>, <code class="literal">ec2</code>, <code class="literal">elb</code>,
<code class="literal">lambda</code>, <code class="literal">natgateway</code>, <code class="literal">rds</code>, <code class="literal">s3_daily_storage</code>, <code class="literal">s3_request</code>, <code class="literal">sns</code>, <code class="literal">sqs</code>,
<code class="literal">transitgateway</code>, <code class="literal">usage</code> and <code class="literal">vpn</code> metricset in <code class="literal">aws</code> module.</p>
<p>Collecting <code class="literal">tags</code> for <code class="literal">ec2</code>, <code class="literal">rds</code>, <code class="literal">cloudwatch</code>, and metricset created based on
<code class="literal">cloudwatch</code> using light module is supported.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>tags.</strong></span>: Tag key value pairs from aws resources. A tag is a label that user assigns to an AWS resource.
</li>
</ul>
</div>
<h3><a id="_billing"></a><code class="literal">billing</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Billing metric data includes the estimated charges for every service in the AWS
account and the estimated overall total charge for the AWS account. The estimated
charges are calculated and sent several times daily to CloudWatch. Therefore,
<code class="literal">period</code> in aws module configuration is set to <code class="literal">12h</code>.</p>
<p>The billing metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-billing-overview.png" alt="metricbeat aws billing overview">
</div>
</div>
<h3><a id="_cloudwatch"></a><code class="literal">cloudwatch</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>This metricset allows users to query metrics from AWS CloudWatch with any given
namespaces or specific instance with a given period.
Please see <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/aws-services-cloudwatch-metrics.html" class="ulink" target="_top">AWS Services That Publish CloudWatch Metrics</a>
for a list of AWS services that publish metrics to CloudWatch.</p>
<h3><a id="_dynamodb"></a><code class="literal">dynamodb</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>DynamoDB sends metrics to CloudWatch periodically for better monitoring how web
application or service is performing.</p>
<p>The dynamodb metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-dynamodb-overview.png" alt="metricbeat aws dynamodb overview">
</div>
</div>
<h3><a id="_ebs"></a><code class="literal">ebs</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>For basic monitoring in AWS EBS volumes, data is available automatically in
5-minute periods at no charge. This includes data for the root device volumes
for EBS-backed instances. User can also enable detailed monitoring for
provisioned IOPS SSD (io1) volumes to automatically send one-minute metrics to
CloudWatch. Default period in aws module configuration is set to <code class="literal">5m</code> for ebs
metricset.</p>
<p>The ebs metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-ebs-overview.png" alt="metricbeat aws ebs overview">
</div>
</div>
<h3><a id="_ec2"></a><code class="literal">ec2</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>By default, Amazon EC2 sends metric data to CloudWatch every 5 minutes. With this basic monitoring, <code class="literal">period</code> in aws module
configuration should be larger or equal than <code class="literal">300s</code>. If <code class="literal">period</code> is set to be less than <code class="literal">300s</code>, the same cloudwatch metrics
will be collected more than once which will cause extra fees without getting more granular metrics. For example, in <code class="literal">US East (N. Virginia)</code> region, it costs
$0.01/1000 metrics requested using GetMetricData. Please see <a href="https://aws.amazon.com/cloudwatch/pricing/" class="ulink" target="_top">AWS CloudWatch Pricing</a>
for more details. To avoid unnecessary charges, <code class="literal">period</code> is preferred to be set to <code class="literal">300s</code> or multiples of <code class="literal">300s</code>, such as
<code class="literal">600s</code> and <code class="literal">900s</code>. For more granular monitoring data you can enable detailed monitoring on the instance to get metrics every 1 minute. Please see
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-cloudwatch-new.html" class="ulink" target="_top">Enabling Detailed Monitoring</a> for instructions
on how to enable detailed monitoring. With detailed monitoring enabled, <code class="literal">period</code> in aws module configuration can be any number
larger than <code class="literal">60s</code>. Since AWS sends metric data to CloudWatch in 1-minute periods, setting metricbeat module <code class="literal">period</code> less
than <code class="literal">60s</code> will cause extra API requests which means extra charges on AWS. To avoid unnecessary charges, <code class="literal">period</code> is
preferred to be set to <code class="literal">60s</code> or multiples of <code class="literal">60s</code>, such as <code class="literal">120s</code> and <code class="literal">180s</code>.</p>
<p>The ec2 metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-ec2-overview.png" alt="metricbeat aws ec2 overview">
</div>
</div>
<h3><a id="_elb"></a><code class="literal">elb</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>elb metricset collects CloudWatch metrics from classic load balancer, application
load balancer and network load balancer.</p>
<p>All three kinds of elastic load balancing reports metrics to Cloudwatch only when requests are flowing
through the load balancer. If there are requests flowing through the load balancer,
Elastic Load Balancing measures and sends its metrics in 60-second intervals.
If there are no requests flowing through the load balancer or no data for a metric,
the metric is not reported.
Therefore, <code class="literal">period</code> in aws module configuration is set to <code class="literal">1m</code>.</p>
<p>The elb metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-elb-overview.png" alt="metricbeat aws elb overview">
</div>
</div>
<h3><a id="_lambda"></a><code class="literal">lambda</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>When an invocation completes, Lambda sends a set of metrics to CloudWatch for that invocation.
Default period in aws module configuration is set to <code class="literal">5m</code> for lambda metricset.
The lambda metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-lambda-overview.png" alt="metricbeat aws lambda overview">
</div>
</div>
<h3><a id="_natgateway"></a><code class="literal">natgateway</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>CloudWatch collects information from NAT gateways and creates readable, near real-time metrics.
This metricset enables users to collect these metrics from CloudWatch to monitor and troubleshoot
their NAT gateway. NAT gateway metric data is provided at 1-minute intervals and therefore,
<code class="literal">period</code> for <code class="literal">natgateway</code> metricset is recommended to be <code class="literal">1m</code> or multiples of <code class="literal">1m</code>.</p>
<h3><a id="_rds"></a><code class="literal">rds</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p><code class="literal">period</code> for <code class="literal">rds</code> metricset is recommended to be <code class="literal">60s</code> or multiples of <code class="literal">60s</code> because Amazon RDS sends metrics and
dimensions to Amazon CloudWatch every minute.</p>
<p>The rds metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-rds-overview.png" alt="metricbeat aws rds overview">
</div>
</div>
<h3><a id="_s3_daily_storage"></a><code class="literal">s3_daily_storage</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Daily storage metrics for S3 buckets are reported once per day with no additional cost. Since they are daily metrics,
<code class="literal">period</code> for <code class="literal">s3_daily_storage</code> metricset is recommended to be <code class="literal">86400s</code> or multiples of <code class="literal">86400s</code>.</p>
<h3><a id="_s3_request"></a><code class="literal">s3_request</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Request metrics are available
at 1-minute intervals with additional charges. The s3_request metricset will give more
granular data to track S3 bucket usage. The <code class="literal">period</code> for <code class="literal">s3_request</code> metricset can be set to <code class="literal">60s</code> or multiples of <code class="literal">60s</code>.
But because of the extra charges for querying these metrics, the <code class="literal">period</code> is recommended to set to <code class="literal">86400s</code>. The user can
always adjust this to the granularity they want. Request metrics are not enabled by default for S3 buckets. Please see
<a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/configure-metrics.html" class="ulink" target="_top">How to
Configure Request Metrics for S3</a> for instructions on how to enable request metrics for
each S3 bucket.</p>
<p>The s3_daily_storage and s3_request metricset comes with a predefined combined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-s3-overview.png" alt="metricbeat aws s3 overview">
</div>
</div>
<h3><a id="_sqs"></a><code class="literal">sqs</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>CloudWatch metrics for Amazon SQS queues are automatically collected and pushed to CloudWatch every 5 minutes,
the <code class="literal">period</code> for <code class="literal">sqs</code> metricset is recommended to be <code class="literal">300s</code> or multiples of <code class="literal">300s</code>.</p>
<p>The sqs metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-sqs-overview.png" alt="metricbeat aws sqs overview">
</div>
</div>
<h3><a id="_transitgateway"></a><code class="literal">transitgateway</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Amazon VPC reports metrics to CloudWatch only when requests are flowing through
the transit gateway. If there are requests flowing through the transit gateway,
Amazon VPC measures and sends its metrics in 60-second intervals. <code class="literal">period</code> for
<code class="literal">transitgateway</code> metricset is recommended to be <code class="literal">1m</code> or multiples of <code class="literal">1m</code>.</p>
<h3><a id="_usage_2"></a><code class="literal">usage</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>CloudWatch collects metrics that track the usage of some AWS resources. These
metrics correspond to AWS service quotas. Tracking these metrics can help
proactively manage quotas. Service quota usage metrics are in the AWS/Usage
namespace and are collected every minute. Therefore, <code class="literal">period</code> in aws module
configuration for usage metricset is set to <code class="literal">1m</code>.</p>
<p>The usage metricset comes with a predefined dashboard:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-usage-overview.png" alt="metricbeat aws usage overview">
</div>
</div>
<h3><a id="_vpn"></a><code class="literal">vpn</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>CloudWatch collects and processes raw data from the VPN service into readable, near
real-time metrics for users to better understand the performance of their web
applications and services.</p>
<h2><a id="aws-api-requests"></a>AWS API requests count per metricset<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h2>
<p>This session is to document what are the AWS API called made by each metricset
in <code class="literal">aws</code> module. This will be useful for users to estimate costs for using <code class="literal">aws</code>
module.</p>
<p>Note: some AWS APIs need pagination like ListMetrics and GetMetricData. Count
value is depends on the number of results.</p>
<p>ListMetrics max page size: 500, based on <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_ListMetrics.html" class="ulink" target="_top">AWS API ListMetrics</a></p>
<p>GetMetricData max page size: 100, based on <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricData.html" class="ulink" target="_top">AWS API GetMetricData</a></p>
<h3><a id="_cloudwatch_2"></a><code class="literal">cloudwatch</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>AWS API Name</p></td>
<td align="left" valign="top"><p>AWS API Count</p></td>
<td align="left" valign="top"><p>Frequency</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>IAM ListAccountAliases</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>STS GetCallerIdentity</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>EC2 DescribeRegions</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch ListMetrics</p></td>
<td align="left" valign="top"><p>Total number of results / ListMetrics max page size</p></td>
<td align="left" valign="top"><p>Per region per namespace per collection period</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch GetMetricData</p></td>
<td align="left" valign="top"><p>Total number of results / GetMetricData max page size</p></td>
<td align="left" valign="top"><p>Per region per namespace per collection period</p></td>
</tr>
</tbody>
</table>
</div>
<p><code class="literal">billing</code>, <code class="literal">ebs</code>, <code class="literal">elb</code>, <code class="literal">sns</code>, <code class="literal">usage</code> and <code class="literal">lambda</code> are the same as <code class="literal">cloudwatch</code> metricset.</p>
<h3><a id="_ec2_2"></a><code class="literal">ec2</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>AWS API Name</p></td>
<td align="left" valign="top"><p>AWS API Count</p></td>
<td align="left" valign="top"><p>Frequency</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>IAM ListAccountAliases</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>STS GetCallerIdentity</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>EC2 DescribeRegions</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>EC2 DescribeInstances</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch ListMetrics</p></td>
<td align="left" valign="top"><p>Total number of results / ListMetrics max page size</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch GetMetricData</p></td>
<td align="left" valign="top"><p>Total number of results / GetMetricData max page size</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="_rds_2"></a><code class="literal">rds</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>AWS API Name</p></td>
<td align="left" valign="top"><p>AWS API Count</p></td>
<td align="left" valign="top"><p>Frequency</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>IAM ListAccountAliases</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>STS GetCallerIdentity</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>EC2 DescribeRegions</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>RDS DescribeDBInstances</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch ListMetrics</p></td>
<td align="left" valign="top"><p>Total number of results / ListMetrics max page size</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch GetMetricData</p></td>
<td align="left" valign="top"><p>Total number of results / GetMetricData max page size</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="_sqs_2"></a><code class="literal">sqs</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>AWS API Name</p></td>
<td align="left" valign="top"><p>AWS API Count</p></td>
<td align="left" valign="top"><p>Frequency</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>IAM ListAccountAliases</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>STS GetCallerIdentity</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>EC2 DescribeRegions</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch ListMetrics</p></td>
<td align="left" valign="top"><p>Total number of results / ListMetrics max page size</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch GetMetricData</p></td>
<td align="left" valign="top"><p>Total number of results / GetMetricData max page size</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="_s3_daily_storage_and_s3_request"></a><code class="literal">s3_daily_storage</code> and <code class="literal">s3_request</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>AWS API Name</p></td>
<td align="left" valign="top"><p>AWS API Count</p></td>
<td align="left" valign="top"><p>Frequency</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>IAM ListAccountAliases</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>STS GetCallerIdentity</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>EC2 DescribeRegions</p></td>
<td align="left" valign="top"><p>1</p></td>
<td align="left" valign="top"><p>Once on startup</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch ListMetrics</p></td>
<td align="left" valign="top"><p>Total number of results / ListMetrics max page size</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>CloudWatch GetMetricData</p></td>
<td align="left" valign="top"><p>Total number of results / GetMetricData max page size</p></td>
<td align="left" valign="top"><p>Per region per collection period</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="aws-credentials-config"></a>AWS Credentials Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h3>
<p>To configure AWS credentials, either put the credentials into the Metricbeat configuration, or use a shared credentials file, as shown in the following examples.</p>
<h4><a id="_configuration_parameters"></a>Configuration parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>access_key_id</strong></span>: first part of access key.
</li>
<li class="listitem">
<span class="strong strong"><strong>secret_access_key</strong></span>: second part of access key.
</li>
<li class="listitem">
<span class="strong strong"><strong>session_token</strong></span>: required when using temporary security credentials.
</li>
<li class="listitem">
<span class="strong strong"><strong>credential_profile_name</strong></span>: profile name in shared credentials file.
</li>
<li class="listitem">
<span class="strong strong"><strong>shared_credential_file</strong></span>: directory of the shared credentials file.
</li>
<li class="listitem">
<span class="strong strong"><strong>endpoint</strong></span>: URL of the entry point for an AWS web service.
</li>
<li class="listitem">
<span class="strong strong"><strong>role_arn</strong></span>: AWS IAM Role to assume.
</li>
<li class="listitem">
<span class="strong strong"><strong>aws_partition</strong></span>: AWS region parttion name, value is one of <code class="literal">aws, aws-cn, aws-us-gov</code>, default is <code class="literal">aws</code>.
</li>
</ul>
</div>
<h4><a id="_supported_formats"></a>Supported Formats<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use <code class="literal">access_key_id</code>, <code class="literal">secret_access_key</code> and/or <code class="literal">session_token</code>
</li>
</ul>
</div>
<p>Users can either put the credentials into metricbeat module configuration or use
environment variable <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code> and/or
<code class="literal">AWS_SESSION_TOKEN</code> instead.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use <code class="literal">role_arn</code>
</li>
</ul>
</div>
<p>If <code class="literal">access_key_id</code> and <code class="literal">secret_access_key</code> are not given, then metricbeat will
check for <code class="literal">role_arn</code>. <code class="literal">role_arn</code> is used to specify which AWS IAM role to assume
for generating temporary credentials.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use <code class="literal">credential_profile_name</code> and/or <code class="literal">shared_credential_file</code>
</li>
</ul>
</div>
<p>If <code class="literal">access_key_id</code>, <code class="literal">secret_access_key</code> and <code class="literal">role_arn</code> are all not given, then
metricbeat will check for <code class="literal">credential_profile_name</code>. If you use different credentials for
different tools or applications, you can use profiles to configure multiple
access keys in the same configuration file. If there is no <code class="literal">credential_profile_name</code>
given, the default profile will be used.</p>
<p><code class="literal">shared_credential_file</code> is optional to specify the directory of your shared
credentials file. If it&#8217;s empty, the default directory will be used.
In Windows, shared credentials file is at <code class="literal">C:\Users\&lt;yourUserName&gt;\.aws\credentials</code>.
For Linux, macOS or Unix, the file is located at <code class="literal">~/.aws/credentials</code>. When running as a service,
the home path depends on the user that manages the service, so the <code class="literal">shared_credential_file</code> parameter can be used to avoid ambiguity. Please see
<a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/create-shared-credentials-file.html" class="ulink" target="_top">Create Shared Credentials File</a>
for more details.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Use AWS credentials in Metricbeat configuration</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  access_key_id: '&lt;access_key_id&gt;'
  secret_access_key: '&lt;secret_access_key&gt;'
  session_token: '&lt;session_token&gt;'</pre>
</div>
<p>or</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'</pre>
</div>
</li>
<li class="listitem">
<p>Use IAM role ARN</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  role_arn: arn:aws:iam::123456789012:role/test-mb</pre>
</div>
</li>
<li class="listitem">
<p>Use shared AWS credentials file</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  credential_profile_name: test-mb</pre>
</div>
</li>
</ul>
</div>
<h4><a id="_aws_credentials_types"></a>AWS Credentials Types<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h4>
<p>There are two different types of AWS credentials can be used:
access keys and temporary security credentials.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Access keys
</li>
</ul>
</div>
<p><code class="literal">AWS_ACCESS_KEY_ID</code> and <code class="literal">AWS_SECRET_ACCESS_KEY</code> are the two parts of access keys.
They are long-term credentials for an IAM user or the AWS account root user.
Please see
<a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" class="ulink" target="_top">AWS Access Keys
 and Secret Access Keys</a>
for more details.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
IAM role ARN
</li>
</ul>
</div>
<p>An IAM role is an IAM identity that you can create in your account that has
specific permissions that determine what the identity can and cannot do in AWS.
A role does not have standard long-term credentials such as a password or access keys associated with it.
Instead, when you assume a role, it provides you with temporary security credentials for your role session.
IAM role Amazon Resource Name (ARN) can be used to specify which AWS IAM role to assume to generate temporary credentials.
Please see <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html" class="ulink" target="_top">AssumeRole API documentation</a> for more details.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Temporary security credentials
</li>
</ul>
</div>
<p>Temporary security credentials has a limited lifetime and consists of an
access key ID, a secret access key, and a security token which typically returned
from <code class="literal">GetSessionToken</code>. MFA-enabled IAM users would need to submit an MFA code
while calling <code class="literal">GetSessionToken</code>. <code class="literal">default_region</code> identifies the AWS Region
whose servers you want to send your first API request to by default. This is
typically the Region closest to you, but it can be any Region. Please see
<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" class="ulink" target="_top">Temporary Security Credentials</a>
for more details.
<code class="literal">sts get-session-token</code> AWS CLI can be used to generate temporary credentials. For example. with MFA-enabled:</p>
<pre class="screen">aws&gt; sts get-session-token --serial-number arn:aws:iam::1234:mfa/your-email@example.com --token-code 456789 --duration-seconds 129600</pre>
<p>Because temporary security credentials are short term, after they expire, the user needs to generate new ones and modify
the aws.yml config file with the new credentials. Unless <a href="/guide/en/beats/metricbeat/current/_live_reloading.html" class="ulink" target="_top">live reloading</a>
feature is enabled for Metricbeat, the user needs to manually restart Metricbeat after updating the config file in order
to continue collecting Cloudwatch metrics. This will cause data loss if the config file is not updated with new
credentials before the old ones expire. For Metricbeat, we recommend users to use access keys in config file to enable
aws module making AWS api calls without have to generate new temporary credentials and update the config frequently.</p>
<p>IAM policy is an entity that defines permissions to an object within your AWS environment. Specific permissions needs
to be added into the IAM user&#8217;s policy to authorize Metricbeat to collect AWS monitoring metrics. Please see documentation
under each metricset for required permissions.</p>
<h3><a id="_example_configuration_5"></a>Example configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The AWS module supports the standard configuration options that are described
in <a class="xref" href="configuration-metricbeat.html" title="Configure modules"><em>Modules</em></a>. Here is an example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  credential_profile_name: test-mb
  metricsets:
    - ec2
  tags_filter:
    - key: "Organization"
      value: "Engineering"
- module: aws
  period: 300s
  credential_profile_name: test-mb
  metricsets:
    - sqs
  regions:
    - us-west-1
- module: aws
  period: 86400s
  metricsets:
    - s3_request
    - s3_daily_storage
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
- module: aws
  period: 300s
  credential_profile_name: test-mb
  metricsets:
    - cloudwatch
  metrics:
    - namespace: AWS/EC2
      name: ["CPUUtilization"]
      dimensions:
        - name: InstanceId
          value: i-0686946e22cf9494a
    - namespace: AWS/EBS
    - namespace: AWS/ELB
      resource_type: elasticloadbalancing
      tags:
        - key: "Organization"
          value: "Engineering"
- module: aws
  period: 60s
  credential_profile_name: test-mb
  tags_filter:
    - key: "dept"
      value: "eng"
  metricsets:
    - elb
    - natgateway
    - rds
    - transitgateway
    - usage
    - vpn</pre>
</div>
<h3><a id="_metricsets_7"></a>Metricsets<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/7.10/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The following metricsets are available:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-billing.html" title="AWS billing metricset">billing</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-cloudwatch.html" title="AWS cloudwatch metricset">cloudwatch</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-dynamodb.html" title="AWS dynamodb metricset">dynamodb</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-ebs.html" title="AWS ebs metricset">ebs</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-ec2.html" title="AWS ec2 metricset">ec2</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-elb.html" title="AWS elb metricset">elb</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-lambda.html" title="AWS lambda metricset">lambda</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-natgateway.html" title="AWS natgateway metricset">natgateway</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-rds.html" title="AWS rds metricset">rds</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-s3_daily_storage.html" title="AWS s3_daily_storage metricset">s3_daily_storage</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-s3_request.html" title="AWS s3_request metricset">s3_request</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-sns.html" title="AWS sns metricset">sns</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-sqs.html" title="AWS sqs metricset">sqs</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-transitgateway.html" title="AWS transitgateway metricset">transitgateway</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-usage.html" title="AWS usage metricset">usage</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-vpn.html" title="AWS vpn metricset">vpn</a>
</li>
</ul>
</div>
















</div>
<div class="navfooter">
<span class="prev">
<a href="metricbeat-metricset-appsearch-stats.html">« App Search stats metricset</a>
</span>
<span class="next">
<a href="metricbeat-metricset-aws-billing.html">AWS billing metricset »</a>
</span>
</div>
</div>
</body>
</html>
