<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>aws module | Metricbeat Reference [7.4] | Elastic</title>
<link rel="home" href="index.html" title="Metricbeat Reference [7.4]"/>
<link rel="up" href="metricbeat-modules.html" title="Modules"/>
<link rel="prev" href="metricbeat-metricset-apache-status.html" title="Apache status metricset"/>
<link rel="next" href="metricbeat-metricset-aws-cloudwatch.html" title="aws cloudwatch metricset"/>
<meta name="DC.type" content="Learn/Docs/Metricbeat/Reference/7.4"/>
<meta name="DC.subject" content="Metricbeat"/>
<meta name="DC.identifier" content="7.4"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Metricbeat Reference [7.4]</a></span>
»
<span class="breadcrumb-link"><a href="metricbeat-modules.html">Modules</a></span>
»
<span class="breadcrumb-node">aws module</span>
</div>
<div class="navheader">
<span class="prev">
<a href="metricbeat-metricset-apache-status.html">« Apache status metricset</a>
</span>
<span class="next">
<a href="metricbeat-metricset-aws-cloudwatch.html">aws cloudwatch metricset »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="metricbeat-module-aws"></a>aws module<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>This module periodically fetches monitoring metrics from AWS Cloudwatch using
<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricData.html" class="ulink" target="_top">GetMetricData API</a> for AWS services.
Note: extra AWS charges on GetMetricData API requests will be generated by this module.</p>
<p>The default metricsets are <code class="literal">ec2</code>, <code class="literal">sqs</code>, <code class="literal">s3_request</code>, <code class="literal">s3_daily_storage</code>, <code class="literal">cloudwatch</code> and <code class="literal">rds</code>.</p>
<h3><a id="_module_specific_configuration_notes"></a>Module-specific configuration notes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The <code class="literal">aws</code> module requires AWS credentials configuration in order to make AWS API calls.
Users can either use <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code> and/or
<code class="literal">AWS_SESSION_TOKEN</code>, or use shared AWS credentials file.
Please see <a class="xref" href="metricbeat-module-aws.html#aws-credentials-config" title="AWS Credentials Configuration">AWS credentials options</a> for more details.</p>
<p>This module also accepts optional configuration <code class="literal">regions</code> to specify which
AWS regions to query metrics from. If the <code class="literal">regions</code> parameter is not set in the
config file, then by default, the <code class="literal">aws</code> module will query metrics from all available
AWS regions.</p>
<p>The aws module comes with a predefined dashboard. For example:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-overview.png" alt="metricbeat aws overview">
</div>
</div>
<h2><a id="_metricsets_4"></a>Metricsets<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h2>
<p>Currently, we have <code class="literal">ec2</code>, <code class="literal">sqs</code>, <code class="literal">s3_request</code>, <code class="literal">s3_daily_storage</code> and <code class="literal">cloudwatch</code> metricset in <code class="literal">aws</code> module. Collecting <code class="literal">tags</code>
for <code class="literal">ec2</code> and <code class="literal">cloudwatch</code> metricset is supported.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>tags.</strong></span>: Tag key value pairs from aws resources. A tag is a label that user assigns to an AWS resource.
</li>
</ul>
</div>
<h3><a id="_ec2"></a><code class="literal">ec2</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>By default, Amazon EC2 sends metric data to CloudWatch every 5 minutes. With this basic monitoring, <code class="literal">period</code> in aws module
configuration should be larger or equal than <code class="literal">300s</code>. If <code class="literal">period</code> is set to be less than <code class="literal">300s</code>, the same cloudwatch metrics
will be collected more than once which will cause extra fees without getting more granular metrics. For example, in <code class="literal">US East (N. Virginia)</code> region, it costs
$0.01/1000 metrics requested using GetMetricData. Please see <a href="https://aws.amazon.com/cloudwatch/pricing/" class="ulink" target="_top">AWS Cloudwatch Pricing</a>
for more details. To avoid unnecessary charges, <code class="literal">period</code> is preferred to be set to <code class="literal">300s</code> or multiples of <code class="literal">300s</code>, such as
<code class="literal">600s</code> and <code class="literal">900s</code>. For more granular monitoring data you can enable detailed monitoring on the instance to get metrics every 1 minute. Please see
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-cloudwatch-new.html" class="ulink" target="_top">Enabling Detailed Monitoring</a> for instructions
on how to enable detailed monitoring. With detailed monitoring enabled, <code class="literal">period</code> in aws module configuration can be any number
larger than <code class="literal">60s</code>. Since AWS sends metric data to CloudWatch in 1-minute periods, setting metricbeat module <code class="literal">period</code> less
than <code class="literal">60s</code> will cause extra API requests which means extra charges on AWS. To avoid unnecessary charges, <code class="literal">period</code> is
preferred to be set to <code class="literal">60s</code> or multiples of <code class="literal">60s</code>, such as <code class="literal">120s</code> and <code class="literal">180s</code>.</p>
<p>The ec2 metricset comes with a predefined dashboard. For example:</p>
<div class="imageblock">
<div class="content">
<img src="./images/metricbeat-aws-ec2-overview.png" alt="metricbeat aws ec2 overview">
</div>
</div>
<h3><a id="_sqs"></a><code class="literal">sqs</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Cloudwatch metrics for Amazon SQS queues are automatically collected and pushed to CloudWatch every 5 minutes,
the <code class="literal">period</code> for <code class="literal">sqs</code> metricset is recommended to be <code class="literal">300s</code> or multiples of <code class="literal">300s</code>.</p>
<h3><a id="_s3_daily_storage"></a><code class="literal">s3_daily_storage</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Daily storage metrics for S3 buckets are reported once per day with no additional cost. Since they are daily metrics,
<code class="literal">period</code> for <code class="literal">s3_daily_storage</code> metricset is recommended to be <code class="literal">86400s</code> or multiples of <code class="literal">86400s</code>.</p>
<h3><a id="_s3_request"></a><code class="literal">s3_request</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>Request metrics are available
at 1-minute intervals with additional charges. The s3_request metricset will give more
granular data to track S3 bucket usage. The <code class="literal">period</code> for <code class="literal">s3_request</code> metricset can be set to <code class="literal">60s</code> or multiples of <code class="literal">60s</code>.
But because of the extra charges for querying these metrics, the <code class="literal">period</code> is recommended to set to <code class="literal">86400s</code>. The user can
always adjust this to the granularity they want. Request metrics are not enabled by default for S3 buckets. Please see
<a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/configure-metrics.html" class="ulink" target="_top">How to
Configure Request Metrics for S3</a> for instructions on how to enable request metrics for
each S3 bucket.</p>
<h3><a id="_cloudwatch"></a><code class="literal">cloudwatch</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>This metricset gives users the freedom to query metrics from AWS Cloudwatch with
any given namespaces or specific instance with a given period.
Please see <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/aws-services-cloudwatch-metrics.html" class="ulink" target="_top">AWS Services That Publish CloudWatch Metrics</a>
for a list of AWS services that publish metrics to CloudWatch.</p>
<h3><a id="_rds"></a><code class="literal">rds</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p><code class="literal">period</code> for <code class="literal">rds</code> metricset is recommended to be <code class="literal">60s</code> or multiples of <code class="literal">60s</code> because Amazon RDS sends metrics and
dimensions to Amazon CloudWatch every minute.</p>
<h3><a id="aws-credentials-config"></a>AWS Credentials Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h3>
<p>To configure AWS credentials, either put the credentials into the Metricbeat configuration, or use a shared credentials file, as shown in the following examples.</p>
<h4><a id="_supported_formats"></a>Supported Formats<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code> and/or <code class="literal">AWS_SESSION_TOKEN</code>
</li>
</ul>
</div>
<p>Users can either put the credentials into metricbeat module configuration or use
environment variable <code class="literal">AWS_ACCESS_KEY_ID</code>, <code class="literal">AWS_SECRET_ACCESS_KEY</code> and/or
<code class="literal">AWS_SESSION_TOKEN</code> instead.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Use AWS credentials in Metricbeat configuration</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  access_key_id: '&lt;access_key_id&gt;'
  secret_access_key: '&lt;secret_access_key&gt;'
  session_token: '&lt;session_token&gt;'</pre>
</div>
<p>or</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'</pre>
</div>
</li>
<li class="listitem">
<p>Use shared AWS credentials file</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  credential_profile_name: test-mb</pre>
</div>
</li>
</ul>
</div>
<p><code class="literal">credential_profile_name</code> is optional. If there is no <code class="literal">credential_profile_name</code>
given, the default profile will be used.
In Windows, shared credentials file is at <code class="literal">C:\Users\&lt;yourUserName&gt;\.aws\credentials</code>.
For Linux, macOS or Unix, the file is located at <code class="literal">~/.aws/credentials</code>. Please see
<a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/create-shared-credentials-file.html" class="ulink" target="_top">Create Shared Credentials File</a>
for more details.</p>
<h4><a id="_aws_credentials_types"></a>AWS Credentials Types<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/x-pack/libbeat/docs/aws-credentials-config.asciidoc">edit</a></h4>
<p>There are two different types of AWS credentials can be used:
access keys and temporary security credentials.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Access keys
</li>
</ul>
</div>
<p><code class="literal">AWS_ACCESS_KEY_ID</code> and <code class="literal">AWS_SECRET_ACCESS_KEY</code> are the two parts of access keys.
They are long-term credentials for an IAM user or the AWS account root user.
Please see
<a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" class="ulink" target="_top">AWS Access Keys
 and Secret Access Keys</a>
for more details.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Temporary security credentials
</li>
</ul>
</div>
<p>temporary security credentials has a limited lifetime and consists of an
access key ID, a secret access key, and a security token which typically returned
from <code class="literal">GetSessionToken</code>. MFA-enabled IAM users would need to submit an MFA code
while calling <code class="literal">GetSessionToken</code>. <code class="literal">default_region</code> identifies the AWS Region
whose servers you want to send your first API request to by default. This is
typically the Region closest to you, but it can be any Region. Please see
<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" class="ulink" target="_top">Temporary Security Credentials</a>
for more details.
<code class="literal">sts get-session-token</code> AWS CLI can be used to generate temporary credentials. For example. with MFA-enabled:</p>
<pre class="screen">aws&gt; sts get-session-token --serial-number arn:aws:iam::1234:mfa/your-email@example.com --token-code 456789 --duration-seconds 129600</pre>
<p>Because temporary security credentials are short term, after they expire, the user needs to generate new ones and modify
the aws.yml config file with the new credentials. Unless <a href="/guide/en/beats/metricbeat/current/_live_reloading.html" class="ulink" target="_top">live reloading</a>
feature is enabled for Metricbeat, the user needs to manually restart Metricbeat after updating the config file in order
to continue collecting Cloudwatch metrics. This will cause data loss if the config file is not updated with new
credentials before the old ones expire. For Metricbeat, we recommend users to use access keys in config file to enable
aws module making AWS api calls without have to generate new temporary credentials and update the config frequently.</p>
<p>IAM policy is an entity that defines permissions to an object within your AWS environment. Specific permissions needs
to be added into the IAM user&#8217;s policy to authorize Metricbeat to collect AWS monitoring metrics. Please see documentation
under each metricset for required permissions.</p>
<h3><a id="_example_configuration_3"></a>Example configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The aws module supports the standard configuration options that are described
in <a class="xref" href="configuration-metricbeat.html" title="Specify which modules to run"><em>Specify which modules to run</em></a>. Here is an example configuration:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: aws
  period: 300s
  metricsets:
    - ec2
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'
- module: aws
  period: 300s
  metricsets:
    - sqs
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'
  regions:
    - us-west-1
- module: aws
  period: 86400s
  metricsets:
    - s3_request
    - s3_daily_storage
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'
- module: aws
  period: 300s
  metricsets:
    - cloudwatch
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'
  cloudwatch_metrics:
    - namespace: AWS/EC2
      metricname: CPUUtilization
      dimensions:
        - name: InstanceId
          value: i-0686946e22cf9494a
    - namespace: AWS/EBS
    - namespace: AWS/ELB
      tags.resource_type_filter: elasticloadbalancing
- module: aws
  period: 60s
  metricsets:
    - rds
  access_key_id: '${AWS_ACCESS_KEY_ID:""}'
  secret_access_key: '${AWS_SECRET_ACCESS_KEY:""}'
  session_token: '${AWS_SESSION_TOKEN:""}'
  default_region: '${AWS_REGION:us-west-1}'</pre>
</div>
<h3><a id="_metricsets_5"></a>Metricsets<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/beats/edit/7.4/metricbeat/docs/modules/aws.asciidoc">edit</a></h3>
<p>The following metricsets are available:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-cloudwatch.html" title="aws cloudwatch metricset">cloudwatch</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-ebs.html" title="aws ebs metricset">ebs</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-ec2.html" title="aws ec2 metricset">ec2</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-elb.html" title="aws elb metricset">elb</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-rds.html" title="aws rds metricset">rds</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-s3_daily_storage.html" title="aws s3_daily_storage metricset">s3_daily_storage</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-s3_request.html" title="aws s3_request metricset">s3_request</a>
</li>
<li class="listitem">
<a class="xref" href="metricbeat-metricset-aws-sqs.html" title="aws sqs metricset">sqs</a>
</li>
</ul>
</div>








</div>
<div class="navfooter">
<span class="prev">
<a href="metricbeat-metricset-apache-status.html">« Apache status metricset</a>
</span>
<span class="next">
<a href="metricbeat-metricset-aws-cloudwatch.html">aws cloudwatch metricset »</a>
</span>
</div>
</div>
</body>
</html>
