<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Export GeoIP Information
        | Packetbeat Reference [6.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Packetbeat Reference [6.1]" /><link rel="up" href="configuring-howto-packetbeat.html" title="Configuring Packetbeat" /><link rel="prev" href="configuring-ingest-node.html" title="Parse logs by using ingest node" /><link rel="next" href="configuration-path.html" title="Set up project paths" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Packetbeat/Reference/6.1" /><meta xmlns="" name="DC.subject" content="Packetbeat" /><meta xmlns="" name="DC.identifier" content="6.1" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Packetbeat Reference
      [6.1]
    </a></span> » <span class="breadcrumb-link"><a href="configuring-howto-packetbeat.html">Configuring Packetbeat</a></span> » <span class="breadcrumb-node">Export GeoIP Information</span></div><div xmlns="" class="navheader"><span class="prev"><a href="configuring-ingest-node.html">
              « 
              Parse logs by using ingest node</a>
           
        </span><span class="next">
           
          <a href="configuration-path.html">Set up project paths
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="packetbeat-geoip"></a>Export GeoIP Information<a xmlns="" href="https://github.com/elastic/beats/edit/6.1/packetbeat/docs/packetbeat-geoip.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>You can use Packetbeat along with the
to export geographic location information about source IPs for incoming HTTP
requests. Then you can use this info to visualize the location of your
clients on a map in Kibana.</p><p>Prior to version 5.0, Packetbeat provided a <code class="literal">geoip</code> configuration option for
exporting geoIP information about the source IPs.  Starting with 5.0, the
<code class="literal">geoip</code> configuration option in Beats is deprecated in favor of using the
ingest geoIP processor plugin. This plugin adds information about the
geographical location of IP addresses, based on data from the Maxmind GeoLite2
City Database. Because the plugin uses a geoIP database that’s installed on
Elasticsearch, you no longer need to install a geoIP database on the
machines running Beats.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">If your use case involves using Logstash, you can use the
<a class="ulink" href="https://www.elastic.co/guide/en/logstash/6.1/plugins-filters-geoip.html" target="_top">GeoIP filter</a> available in Logstash
instead of using the ingest plugin. However, using the ingest plugin is the
simplest approach when you don’t require the additional processing power of
Logstash.</p></div></div><h3><a id="packetbeat-configuring-geoip"></a>Configuring the ingest geoIP processor plugin<a xmlns="" href="https://github.com/elastic/beats/edit/6.1/packetbeat/docs/packetbeat-geoip.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To configure Packetbeat and the ingest geoIP processor plugin:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
After installing the plugin, remember to restart the node.
</li><li class="listitem"><p class="simpara">
Define an ingest node pipeline that uses a <code class="literal">geoip</code> processor to add location
info to the event. For example, you can use the Console in Kibana to create the
following pipeline:
</p><div xmlns="" class="pre_wrapper lang-json"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-json">PUT _ingest/pipeline/geoip-info
{
  "description": "Add geoip info",
  "processors": [
    {
      "geoip": {
        "field": "client_ip",
        "target_field": "client_geoip",
        "properties": ["location"],
        "ignore_failure": true
      }
    }
  ]
}</pre></div><p class="simpara">This pipeline adds a <code class="literal">client_geoip.location</code> field of type <code class="literal">geo_point</code> to the
event. The ID of the pipeline is <code class="literal">geoip-info</code>. <code class="literal">client_ip</code> is the output field
in Packetbeat that contains the IP address of the client. You set
<code class="literal">ignore_failure</code> to <code class="literal">true</code> so that the pipeline will continue processing events
when it encounters an event that doesn’t have a <code class="literal">client_ip</code> field.</p><p class="simpara">See
for more options.</p></li><li class="listitem"><p class="simpara">
In the Packetbeat config file, configure the Elasticsearch output to use the
pipeline. Specify the pipeline ID in the <code class="literal">pipeline</code> option under
<code class="literal">output.elasticsearch</code>. For example:
</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["localhost:9200"]
  pipeline: geoip-info</pre></div></li><li class="listitem"><p class="simpara">
Run Packetbeat, passing in the configuration file that you updated earlier.
</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">./packetbeat -e -c packetbeat.yml</pre></div><p class="simpara">The event that’s sent to Elasticsearch should now include a
<code class="literal">client_geoip.location</code> field.</p></li></ol></div><h3><a id="packetbeat-visualizing-location"></a>Visualizing the location of your Packetbeat clients<a xmlns="" href="https://github.com/elastic/beats/edit/6.1/packetbeat/docs/packetbeat-geoip.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To visualize the location of your Packetbeat clients, you can either
<a class="link" href="load-kibana-dashboards.html" title="Step 4: Set up the Kibana dashboards">set up the example Kibana dashboards</a> (if
you haven’t already), or create a new <a class="ulink" href="https://www.elastic.co/guide/en/kibana/6.1/tilemap.html" target="_top">Tile map</a> in
Kibana and use the <code class="literal">client_geoip.location</code> field as the Geohash.</p><p><span class="inlinemediaobject"><img src="./images/kibana-update-map.png" alt="Update Packetbeat client location map in Kibana" /></span></p><div xmlns="" class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">If the map in the dashboard reports "no results found", and you don’t see
<code class="literal">client_geoip.location</code> in the list of available Geohash fields, try refreshing
the field list in Kibana. On the Management tab, select the <code class="literal">packetbeat-*</code>
index pattern, and refresh the field list to pick up any fields that were added
by the ingest geoIP processor.</p></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="configuring-ingest-node.html">
              « 
              Parse logs by using ingest node</a>
           
        </span><span class="next">
           
          <a href="configuration-path.html">Set up project paths
               »
            </a></span></div></body></html>