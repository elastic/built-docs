<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Deploy a small installation | Elastic Cloud Enterprise Reference [2.8] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.8]"/>
<link rel="up" href="ece-install-cloud.html" title="Install ECE"/>
<link rel="prev" href="ece-install-cloud.html" title="Install ECE"/>
<link rel="next" href="ece-install-medium-onprem.html" title="Deploy a medium installation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.8"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="2.8"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [2.8]</a></span>
»
<span class="breadcrumb-link"><a href="ece-installing.html">Installing Elastic Cloud Enterprise</a></span>
»
<span class="breadcrumb-link"><a href="ece-install-public.html">Install ECE on a public cloud</a></span>
»
<span class="breadcrumb-link"><a href="ece-install-cloud.html">Install ECE</a></span>
»
<span class="breadcrumb-node">Deploy a small installation</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ece-install-cloud.html">« Install ECE</a>
</span>
<span class="next">
<a href="ece-install-medium-onprem.html">Deploy a medium installation »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ece-install-small-cloud"></a>Deploy a small installation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h3>
</div></div></div>
<p>The type of installation is recommended for development, test, and small-scale use cases.
You need:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
3 hosts with 128 GB RAM
</li>
<li class="listitem">
3 availability zones
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ece-pb-3.png" alt="A small baseline installation with three hosts across three availability zones">
</div>
</div>
<p>Perform the numbered steps on more than one host, as indicated in the illustration.</p>
<h5><a id="ece_before_you_start"></a>Before you start<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This type of installation is <span class="strong strong"><strong>not recommended for high-traffic workloads</strong></span>.
</li>
<li class="listitem">
You must not use <span class="strong strong"><strong>spinning disks</strong></span> with small ECE installations, as these are not supported when you run allocators and ECE management services on the same server.
</li>
<li class="listitem">
Note that the small-size ECE installation keeps the directors and coordinators roles (ECE management services) on the same hosts as your allocators and proxies.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Check the recommended JVM Heap sizes</strong></span></p>
<div class="exampleblock">
<div class="content">
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Service</th>
<th align="left" valign="top">JVM Heap Size (Xms and Xmx)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">runner</code></p></td>
<td align="left" valign="top"><p>1 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">allocator</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">zookeeper</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">director</code></p></td>
<td align="left" valign="top"><p>1 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">constructor</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">admin-console</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>For production environments, you must define the memory settings for each role, except for the <code class="literal">proxy</code> role, as starting from ECE 2.4 the JVM proxy was replaced with a Golang-based proxy. If you don&#8217;t set any memory setting, the default values are used, which are inadequate for production environments and can lead to performance or stability issues.</p>
</div>
</div>
<h5><a id="ece_installation_steps"></a>Installation steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Install Elastic Cloud Enterprise on the first host to start a new installation with your first availability zone. This first host holds all runner roles to help bootstrap the rest of the installation.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
   --availability-zone MY_ZONE-1 \
   --memory-settings
   '{"runner":{"xms":"1G","xmx":"1G"},
   "allocator":{"xms":"4G","xmx":"4G"},
   "zookeeper":{"xms":"4G","xmx":"4G"},
   "director":{"xms":"1G","xmx":"1G"},
   "constructor":{"xms":"4G","xmx":"4G"},
   "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
<p>After the installation completes, copy down the coordinator host IP address, user credentials, and roles token information. Keep this information safe.</p>
</li>
<li class="listitem">
<p>Generate a new roles token that persists for one hour on the first host, so that other hosts can join your installation with the right role permissions in the next step (referred to as <code class="literal">MY_TOKEN</code>). The new token needs to enable all runner roles, which none of the tokens automatically generated by the installation on the first host provide.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -k -H 'Content-Type: application/json' -u admin:PASSWORD https://localhost:12443/api/v1/platform/configuration/security/enrollment-tokens -d '{ "persistent": false, "roles": ["director", "coordinator", "proxy", "allocator"] }'</pre>
</div>
</li>
<li class="listitem">
<p>Install Elastic Cloud Enterprise on a second and third host, placing them into a second and a third availability zone, and assign them the same roles and memory settings as the first host. Make sure you include the coordinator host IP information from Step 1 and the new roles token from Step 2.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "director,coordinator,proxy,allocator" \
  --availability-zone MY_ZONE-2 \
  --memory-settings
  '{"runner":{"xms":"1G","xmx":"1G"},
  "allocator":{"xms":"4G","xmx":"4G"},
  "zookeeper":{"xms":"4G","xmx":"4G"},
  "director":{"xms":"1G","xmx":"1G"},
  "constructor":{"xms":"4G","xmx":"4G"},
  "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "director,coordinator,proxy,allocator" \
  --availability-zone MY_ZONE-3 \
  --memory-settings
   '{"runner":{"xms":"1G","xmx":"1G"},
   "allocator":{"xms":"4G","xmx":"4G"},
   "zookeeper":{"xms":"4G","xmx":"4G"},
   "director":{"xms":"1G","xmx":"1G"},
   "constructor":{"xms":"4G","xmx":"4G"},
   "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
</li>
<li class="listitem">
<a class="xref" href="ece-change-deployment.html" title="Change your deployment configuration">Change the deployment configuration for the <code class="literal">admin-console-elasticsearch</code>, <code class="literal">logging-and-metrics</code>, and <code class="literal">security</code> clusters</a> to use three availability zones and resize the nodes to use at least 4 GB of RAM. This change makes sure that the clusters used by the administration console are highly available and provisioned sufficiently.
</li>
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a> to provision your deployment.
</li>
</ol>
</div>
<p>If necessary, you can scale and deploy a <a class="xref" href="ece-install-small-cloud.html#ece-install-medium-cloud">medium installation</a>.</p>
<p><a id="ece-install-medium-cloud"></a>==== Deploy a medium installation</p>
<p>This type of installation is recommended for many production setups.
You need:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
3 hosts with at least 32 GB RAM each for directors and coordinators (ECE management services), and proxies
</li>
<li class="listitem">
3 hosts with 256 GB RAM each for allocators
</li>
<li class="listitem">
3 availability zones
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ece-pb-6.png" alt="A large installation with nine to twelve hosts across three availability zones">
</div>
</div>
<p>Perform the numbered steps on more than one host, as indicated in the illustration.</p>
<h5><a id="ece_before_you_start_2"></a>Before you start<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Monitor the load on proxies and make sure the volume of user requests routed by the proxies does not affect the resources available to the ECE management services.
</li>
<li class="listitem">
Note that the medium-sized Elastic Cloud Enterprise installation separates the allocator from the director and coordinator roles (ECE management services) and the proxy roles.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Check the recommended JVM Heap sizes</strong></span></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Service</th>
<th align="left" valign="top">JVM Heap Size (Xms and Xmx)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">runner</code></p></td>
<td align="left" valign="top"><p>1 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">allocator</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">zookeeper</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">director</code></p></td>
<td align="left" valign="top"><p>1 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">constructor</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">admin-console</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>For production environments, you must define the memory settings for each role, except for the <code class="literal">proxy</code> role, as starting from ECE 2.4 the JVM proxy was replaced with a Golang-based proxy. If you don&#8217;t set any memory setting, the default values are used, which are inadequate for production environments and can lead to performance or stability issues.</p>
</div>
</div>
<h5><a id="ece_installation_steps_2"></a>Installation steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Install Elastic Cloud Enterprise on the first host to start a new installation with your first availability zone. This first host holds all runner roles to help bootstrap the rest of the installation, but you will remove some of its roles in a later step.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --availability-zone MY_ZONE-1 \
  --memory-settings
  '{"runner":{"xms":"1G","xmx":"1G"},
  "zookeeper":{"xms":"4G","xmx":"4G"},
  "director":{"xms":"1G","xmx":"1G"},
  "constructor":{"xms":"4G","xmx":"4G"},
  "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
<p>After the installation completes, copy down the coordinator host IP address, user credentials, and roles token information. Keep this information safe.</p>
</li>
<li class="listitem">
<p>Generate a new roles token that persists for one hour on the first host, so that other hosts can join your installation with the right role permissions in the next step (referred to as <code class="literal">MY_TOKEN</code>). The new token needs to enable the director, coordinator and proxy runner roles.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -k -H 'Content-Type: application/json' -u admin:PASSWORD https://localhost:12443/api/v1/platform/configuration/security/enrollment-tokens -d '{ "persistent": false, "roles": ["director", "coordinator", "proxy"] }'</pre>
</div>
</li>
<li class="listitem">
<p>Install Elastic Cloud Enterprise on a second and third host, placing them into a second and a third availability zone, and assign them the <code class="literal">director</code>, <code class="literal">coordinator</code>, and <code class="literal">proxy</code> roles. Do not assign the <code class="literal">allocator</code> role, as these runners should not handle any user requests. Make sure you include the coordinator host IP information from Step 1 and the new roles token from Step 2.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "director,coordinator,proxy" \
  --availability-zone MY_ZONE-2 \
  --memory-settings
   '{"runner":{"xms":"1G","xmx":"1G"},
   "zookeeper":{"xms":"4G","xmx":"4G"},
   "director":{"xms":"1G","xmx":"1G"},
   "constructor":{"xms":"4G","xmx":"4G"},
   "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "director,coordinator,proxy" \
  --availability-zone MY_ZONE-3 \
  --memory-settings
   '{"runner":{"xms":"1G","xmx":"1G"},
   "zookeeper":{"xms":"4G","xmx":"4G"},
   "director":{"xms":"1G","xmx":"1G"},
   "constructor":{"xms":"4G","xmx":"4G"},
   "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
</li>
<li class="listitem">
<p>To handle the Elasticsearch and Kibana workload, install Elastic Cloud Enterprise on a fourth, fifth, and sixth host, distributing them evenly across the existing three availability zones and assign them the <code class="literal">allocator</code> role. Make sure you include the coordinator host IP information and allocator roles token from Step 1.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'ALLOCATOR_TOKEN' \
  --roles "allocator" --availability-zone MY_ZONE-1 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"allocator":{"xms":"4G","xmx":"4G"}}'

bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'ALLOCATOR_TOKEN' \
  --roles "allocator" \
  --availability-zone MY_ZONE-2 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"allocator":{"xms":"4G","xmx":"4G"}}'

bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'ALLOCATOR_TOKEN' \
  --roles "allocator" \
  --availability-zone MY_ZONE-3 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"allocator":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
</li>
</ol>
</div>
<p><a id="ece-install-large-cloud"></a>==== Deploy a large installation</p>
<p>This type of installation is recommended for deployments with significant overall search and indexing throughput.
You need:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
3 hosts with at least 32 GB RAM each for directors and coordinators (ECE management services)
</li>
<li class="listitem">
3 or more hosts with 256 GB RAM each for allocators
</li>
<li class="listitem">
3 hosts with 16 GB RAM each for proxies
</li>
<li class="listitem">
3 availability zones
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ece-pb-9.png" alt="A large installation with nine to twelve hosts across three availability zones">
</div>
</div>
<p>Perform the numbered steps on more than one host, as indicated in the illustration.</p>
<h5><a id="ece_before_you_start_3"></a>Before you start<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>Note that the large-sized Elastic Cloud Enterprise installation separates the allocator and proxy roles from the director and coordinator roles (ECE management services).</p>
<p><span class="strong strong"><strong>Check the recommended JVM Heap sizes</strong></span></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Service</th>
<th align="left" valign="top">JVM Heap Size (Xms and Xmx)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">runner</code></p></td>
<td align="left" valign="top"><p>1 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">allocator</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">zookeeper</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">director</code></p></td>
<td align="left" valign="top"><p>1 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">constructor</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">admin-console</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>For production environments, you must define the memory settings for each role, except for the <code class="literal">proxy</code> role, as starting from ECE 2.4 the JVM proxy was replaced with a Golang-based proxy. If you don&#8217;t set any memory setting, the default values are used, which are inadequate for production environments and can lead to performance or stability issues.</p>
</div>
</div>
<h5><a id="ece_installation_steps_3"></a>Installation steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Install Elastic Cloud Enterprise on the first host to start a new installation with your first availability zone. This first host holds all runner roles to help bootstrap the rest of the installation, but you will remove some of its roles in a later step.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --availability-zone MY_ZONE-1 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"zookeeper":{"xms":"4G","xmx":"4G"},"director":{"xms":"1G","xmx":"1G"},"constructor":{"xms":"4G","xmx":"4G"},"admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
<p>After the installation completes, copy down the coordinator host IP address, user credentials, and roles token information. Keep this information safe.</p>
</li>
<li class="listitem">
<p>Generate a new roles token that persists for one hour on the first host, so that other hosts can join your installation with the right role permissions in subsequent steps (referred to as <code class="literal">MY_TOKEN</code>). The new token needs to enable the director, coordinator, and proxy runner roles.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -k -H 'Content-Type: application/json' -u admin:PASSWORD https://localhost:12443/api/v1/platform/configuration/security/enrollment-tokens -d '{ "persistent": false, "roles": ["director", "coordinator", "proxy"] }'</pre>
</div>
</li>
<li class="listitem">
<p>Install Elastic Cloud Enterprise on a second and third host, placing them into a second and a third availability zone, and assign them the <code class="literal">director</code> and <code class="literal">coordinator</code> roles. Do not assign the <code class="literal">allocator</code> or the <code class="literal">proxy</code> role, as these runners should not handle or route any user requests. Make sure you include the coordinator host IP information from Step 1 and the new roles token from Step 2.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
 --coordinator-host HOST_IP \
 --roles-token 'MY_TOKEN' \
 --roles "director,coordinator" \
 --availability-zone MY_ZONE-2 \
 --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"zookeeper":{"xms":"4G","xmx":"4G"},"director":{"xms":"1G","xmx":"1G"},"constructor":{"xms":"4G","xmx":"4G"},"admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "director,coordinator" \
  --availability-zone MY_ZONE-3 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"zookeeper":{"xms":"4G","xmx":"4G"},"director":{"xms":"1G","xmx":"1G"},"constructor":{"xms":"4G","xmx":"4G"},"admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
</li>
<li class="listitem">
<p>To handle the Elasticsearch and Kibana workload, install Elastic Cloud Enterprise on three or more hosts, distributing them evenly across the existing three availability zones, or on however many hosts you think you need initially, and assign them the <code class="literal">allocator</code> role. Make sure you include the coordinator host IP information and allocator roles token from Step 1.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'ALLOCATOR_TOKEN' \
  --roles "allocator" \
  --availability-zone MY_ZONE-1 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"allocator":{"xms":"4G","xmx":"4G"}}'

bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'ALLOCATOR_TOKEN' \
  --roles "allocator" \
  --availability-zone MY_ZONE-2 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"allocator":{"xms":"4G","xmx":"4G"}}'

bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'ALLOCATOR_TOKEN' \
  --roles "allocator" \
  --availability-zone MY_ZONE-3 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"},"allocator":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
</li>
<li class="listitem">
<p>To handle the routing of user requests to Elasticsearch, install Elastic Cloud Enterprise on a three additional hosts, distributing them evenly across the existing three availability zones, and assign them the <code class="literal">proxy</code> role. Do not assign any other roles, as these runners should only route user requests. Make sure you include the coordinator host IP information from Step 1 and the new roles token from Step 2.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "proxy" \
  --availability-zone MY_ZONE-1 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"}}'

bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "proxy" \
  --availability-zone MY_ZONE-2 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"}}'

bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "proxy" \
  --availability-zone MY_ZONE-3 \
  --memory-settings '{"runner":{"xms":"1G","xmx":"1G"}}'</pre>
</div>
</li>
<li class="listitem">
Modify the first host you installed Elastic Cloud Enterprise on to prevent it from handling or routing user requests:
</li>
</ol>
</div>
<p><a id="ece-install-your-infra"></a>== Install ECE on your own premises</p>
<p>Before you start, make sure that your existing infrastructure meets the <a class="xref" href="ece-prereqs.html" title="Preparing your installation">requirements</a>. When you have prepared your hosts, you can decide to deploy ECE with one of the following operating systems:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-hosts-ubuntu-onprem">Ubuntu 16.04 LTS (Xenial Xerus)</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-hosts-rhel-centos-onprem">Red Hat Enterprise Linux (RHEL) 7 and CentOS 7</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-hosts-sles12-onprem">SUSE Linux Enterprise Server (SLES) 12</a>
</li>
</ul>
</div>
<p>and choose your preferred installation type:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-install-onprem">Install ECE online</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-offline.html" title="Install ECE offline">Install ECE offline</a>
</li>
</ul>
</div>
<p><a id="ece-configure-os-onprem"></a>=== Configure your operating system</p>
<p>Before installing Elastic Cloud Enterprise, you have to prepare your hosts with one of the following Linux distributions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-hosts-ubuntu-onprem">Ubuntu 16.04 LTS (Xenial Xerus) and 18.04 LTS (Bionic Beaver)</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-hosts-rhel-centos-onprem">Red Hat Enterprise Linux (RHEL) and CentOS</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-hosts-sles12-onprem">SUSE Linux Enterprise Server (SLES) 12</a>
</li>
</ul>
</div>
<p><a id="ece-configure-hosts-ubuntu-onprem"></a>==== Ubuntu 16.04 LTS (Xenial Xerus) and 18.04 LTS (Bionic Beaver)</p>
<p>The following instructions show you how to prepare your hosts on Ubuntu 16.04 LTS (Xenial Xerus) and 18.04 LTS (Bionic Beaver).</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-supported-kernel-onprem" title="Install a supported Linux kernel">Install a supported Linux kernel</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-install-docker-ubuntu-onprem" title="Install Docker">Install Docker 18.09.9</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-xfs-setup-ubuntu-onprem" title="Set up XFS quotas">Set up XFS quotas</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-update-config-ubuntu-onprem" title="Update the configurations settings">Update the configurations settings</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-docker-daemon-ubuntu-onprem" title="Configure the Docker daemon options">Configure the Docker daemon options</a>
</li>
</ul>
</div>
<h5><a id="ece-supported-kernel-onprem"></a>Install a supported Linux kernel<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>Elastic Cloud Enterprise requires 3.10 or higher. The steps shown here install kernel 4.4.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Refresh the package index files from their sources:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo apt-get update</pre>
</div>
</li>
<li class="listitem">
<p>Install the <code class="literal">xfsprogs</code> package available on your system. You can omit the <code class="literal">xfsprogs</code> package if you don&#8217;t plan to use XFS.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo apt-get install -y xfsprogs</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-install-docker-ubuntu-onprem"></a>Install Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>Install Docker LTS version 18.09.9 for Ubuntu 16.04 or 19.03.13 for Ubuntu 18.04</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the Docker repository:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo \
     apt-key add -</pre>
</div>
</li>
<li class="listitem">
<p>Verify that you have the key with the <code class="literal">9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88</code> fingerprint.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo apt-key fingerprint 0EBFCD88
...
pub   4096R/0EBFCD88 2017-02-22
      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   4096R/F273FCD8 2017-02-22
...</pre>
</div>
</li>
<li class="listitem">
<p>Add the stable docker repository:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
sudo apt-get update</pre>
</div>
</li>
<li class="listitem">
<p>Install the correct version of the <code class="literal">docker-ce</code> package, for Ubuntu 16.04 LTS (Xenial Xerus):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo apt-get install docker-ce=5:18.09.9* docker-ce-cli=5:18.09.9*</pre>
</div>
<p>For Ubuntu 18.04 LTS (Bionic Beaver):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo apt-get install docker-ce=5:19.03.13* docker-ce-cli=5:19.03.13*</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-xfs-setup-ubuntu-onprem"></a>Set up XFS quotas<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>XFS is required to support disk space quotas for Elasticsearch data directories. Some Linux distributions such as RHEL and CentOS already provide XFS as the default file system. On Ubuntu, we recommend that you set up an XFS file system first.</p>
<p>Disk space quotas set a limit on the amount of disk space an Elasticsearch cluster node can use. Currently, quotas are calculated by
a static ratio of 1:32, which means that for every 1 GB of RAM a cluster is given, a cluster node is allowed to consume 32 GB of disk space.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using LVM, <code class="literal">mdadm</code>, or a combination of the two for block device management is possible, but the
configuration is not covered here, and it is not supported by Elastic Cloud Enterprise.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must use XFS on all allocators.</p>
</div>
</div>
<p><span class="strong strong"><strong>Example:</strong></span> Set up XFS on a single, pre-partitioned block device named <code class="literal">/dev/xvdg1</code>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Format the partition:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo mkfs.xfs /dev/xvdg1</pre>
</div>
</li>
<li class="listitem">
<p>Create the <code class="literal">/mnt/data/</code> directory as a mount point:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>Add an entry to the <code class="literal">/etc/fstab</code> file for the new XFS volume. The
default filesystem path used by Elastic Cloud Enterprise is <code class="literal">/mnt/data</code>.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">/dev/xvdg1	/mnt/data	xfs	defaults,nofail,x-systemd.automount,prjquota,pquota  0 2</pre>
</div>
</li>
<li class="listitem">
<p>Regenerate the mount files:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl daemon-reload
sudo systemctl restart local-fs.target</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-update-config-ubuntu-onprem"></a>Update the configurations settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Stop the Docker service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl stop docker</pre>
</div>
</li>
<li class="listitem">
<p>Enable cgroup accounting for memory and swap space.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In the <code class="literal">/etc/default/grub</code> file, ensure that the <code class="literal">GRUB_CMDLINE_LINUX=</code> variable includes these values:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cgroup_enable=memory swapaccount=1 cgroup.memory=nokmem</pre>
</div>
</li>
<li class="listitem">
<p>Update your Grub configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo update-grub</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Configure kernel parameters</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cat &lt;&lt;EOF | sudo tee -a /etc/sysctl.conf
# Required by Elasticsearch 5.0 and later
vm.max_map_count = 262144
# enable forwarding so the Docker networking works as expected
net.ipv4.ip_forward = 1
# Make sure the host doesn't swap too early
vm.swappiness=1
EOF</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Apply the settings:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo sysctl -p</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Adjust the system limits.</p>
<p>Add the following configuration values to the <code class="literal">/etc/security/limits.conf</code> file. These values are derived from our experience with the Elastic Cloud hosted offering and should be used for Elastic Cloud Enterprise as well.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are using a user name other than <code class="literal">elastic</code>, adjust the configuration values accordingly.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">*                soft    nofile         1024000
*                hard    nofile         1024000
*                soft    memlock        unlimited
*                hard    memlock        unlimited
elastic          soft    nofile         1024000
elastic          hard    nofile         1024000
elastic          soft    memlock        unlimited
elastic          hard    memlock        unlimited
root             soft    nofile         1024000
root             hard    nofile         1024000
root             soft    memlock        unlimited</pre>
</div>
</li>
<li class="listitem">
<p>If you did not create the mount point earlier (if you did not set up XFS), create the <code class="literal">/mnt/data/</code> directory as a mount point:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>If you <a class="xref" href="ece-install-small-cloud.html#ece-xfs-setup-ubuntu-onprem" title="Set up XFS quotas">set up a new device with XFS</a> earlier:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Mount the block device (change the device name if you use a different device than <code class="literal">/dev/xvdg1</code>):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo mount /dev/xvdg1</pre>
</div>
</li>
<li class="listitem">
<p>Set the permissions on the newly mounted device:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo chown $USER:$USER /mnt/data</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Create the <code class="literal">/mnt/data/docker</code> directory for the Docker service storage:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data/docker</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-configure-docker-daemon-ubuntu-onprem"></a>Configure the Docker daemon options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Docker creates a bridge IP address that can conflict with IP addresses on your internal network. To avoid an IP address conflict, change the <code class="literal">--bip=172.17.42.1/16</code> parameter in our examples to something that you know will work. If there is no conflict, you can omit the <code class="literal">--bip</code> parameter. The <code class="literal">--bip</code> parameter is internal to the host and can be set to the same IP for each host in the cluster. More information on Docker daemon options can be found in the  <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" class="ulink" target="_top">dockerd command line reference</a>.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update <code class="literal">/etc/systemd/system/docker.service.d/docker.conf</code>. If the file path and file do not exist, create them first.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">[Unit]
Description=Docker Service
After=multi-user.target

[Service]
Environment="DOCKER_OPTS=-H unix:///run/docker.sock --data-root /mnt/data/docker --storage-driver=overlay2 --bip=172.17.42.1/16 --raw-logs --icc=false"
ExecStart=
ExecStart=/usr/bin/dockerd $DOCKER_OPTS</pre>
</div>
</li>
<li class="listitem">
<p>Apply the updated Docker daemon configuration:</p>
<p>Reload the Docker daemon configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl daemon-reload</pre>
</div>
<p>Restart the Docker service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl restart docker</pre>
</div>
<p>Enable Docker to start on boot:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl enable docker</pre>
</div>
</li>
<li class="listitem">
<p>Enable your user to communicate with the Docker subsystem by adding it to the <code class="literal">docker</code> group:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo usermod -aG docker $USER</pre>
</div>
</li>
<li class="listitem">
<p>Recommended: Tune your network settings.</p>
<p>Create a <code class="literal">70-cloudenterprise.conf</code> file in the <code class="literal">/etc/sysctl.d/</code> file path that includes these network settings:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cat &lt;&lt; SETTINGS | sudo tee /etc/sysctl.d/70-cloudenterprise.conf
net.ipv4.tcp_max_syn_backlog=65536
net.core.somaxconn=32768
net.core.netdev_max_backlog=32768
SETTINGS</pre>
</div>
</li>
<li class="listitem">
<p>Pin the Docker version to ensure that the package does not get upgraded:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">echo "docker-ce hold" | sudo dpkg --set-selections</pre>
</div>
</li>
<li class="listitem">
<p>Reboot your system to ensure that all configuration changes take effect:</p>
<div class="pre_wrapper lang-literal">
<pre class="programlisting prettyprint lang-literal">sudo reboot</pre>
</div>
</li>
<li class="listitem">
<p>After rebooting, verify that your Docker settings persist as expected:</p>
<div class="pre_wrapper lang-literal">
<pre class="programlisting prettyprint lang-literal">sudo docker info | grep Root</pre>
</div>
<p>If the command returns <code class="literal">Docker Root Dir: /mnt/data/docker</code>, then your changes were applied successfully and persist as expected.</p>
<p>If the command returns <code class="literal">Docker Root Dir: /var/lib/docker</code>, then you need to troubleshoot the previous configuration steps until the Docker settings are applied successfully before continuing with the installation process. For more information, see <a href="https://docs.docker.com/engine/admin/systemd/#/custom-docker-daemon-options" class="ulink" target="_top">Custom Docker daemon options</a> in the Docker documentation.</p>
</li>
<li class="listitem">
Repeat these steps on other hosts that you want to use with Elastic Cloud Enterprise or follow the steps in the next section to start installing Elastic Cloud Enterprise.
</li>
</ol>
</div>
<p><a id="ece-configure-hosts-rhel-centos-onprem"></a>==== Red Hat Enterprise Linux (RHEL) and CentOS</p>
<p>The following instructions show you how to prepare your hosts on Red Hat Enterprise Linux (RHEL) and on CentOS.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-supported-kernel-rhel-onprem" title="Install a supported Linux kernel">Install a supported Linux kernel</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-install-docker-rhel-centos-onprem" title="Install Docker">Install Docker 18.09.9</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-xfs-setup-rhel-onprem" title="Set up XFS quotas">Set up XFS quotas</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-update-configuration-settings-rhel-onprem" title="Update the configurations settings">Update the configurations settings</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-docker-daemon-rhel-centos-onprem" title="Configure the Docker daemon options">Configure the Docker daemon options</a>
</li>
</ul>
</div>
<h5><a id="ece-supported-kernel-rhel-onprem"></a>Install a supported Linux kernel<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>Elastic Cloud Enterprise requires 3.10 or higher.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Use the following command to check your kernel version:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">uname -r</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Kernel-LT has a regression on 4.4.156. In case your OS uses this version, please install another version.</p>
</div>
</div>
</li>
</ol>
</div>
<p>Before you proceed, update the OS, and reboot the system.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update the system:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo yum update
sudo reboot</pre>
</div>
</li>
<li class="listitem">
<p>Enable the <code class="literal">overlay2</code> kernel module:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">echo "overlay2" | sudo tee -a /etc/modules-load.d/overlay.conf</pre>
</div>
</li>
<li class="listitem">
<p>Refresh the dynamically generated grub2 configuration and configure grub to boot the newly installed kernel 3.10 or higher:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo grub2-set-default 0
sudo grub2-mkconfig -o /etc/grub2.cfg</pre>
</div>
</li>
<li class="listitem">
<p>Add the required options to the kernel boot arguments:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo /sbin/grubby --update-kernel=ALL --args='cgroup_enable=memory cgroup.memory=nokmem swapaccount=1'</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-install-docker-rhel-centos-onprem"></a>Install Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>Which version of Docker you install depends on whether you use Red Hat Enterprise Linux (RHEL) or CentOS.</p>
<h6><a id="ece_rhel_7_2"></a>RHEL 7<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h6>
<p>If you are using RHEL 7, use Docker 1.13 included with your RHEL distribution. Follow the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/html-single/getting_started_with_containers/index#getting_docker_in_rhel_7" class="ulink" target="_top">installation instructions provided by Red Hat</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the Docker daemon does not start correctly after the installation completes, continue with the configuration steps below.</p>
</div>
</div>
<h6><a id="ece_centos_7_2"></a>CentOS 7<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h6>
<p>If you are using CentOS 7, install Docker version 18.09.9:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the Docker repository:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-'EOF'
[dockerrepo]
name=Docker Repository
baseurl=https://download.docker.com/linux/centos/7/x86_64/stable
enabled=1
gpgcheck=1
gpgkey=https://download.docker.com/linux/centos/gpg
EOF

sudo yum makecache fast</pre>
</div>
</li>
<li class="listitem">
<p>Install the latest version of docker-ce 18:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo yum install docker-ce-18.09.9*</pre>
</div>
</li>
</ol>
</div>
<h6><a id="ece_rhel_8_or_centos_8_2"></a>RHEL 8 or CentOS 8<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h6>
<p>If you are using RHEL 8 or CentOS 8, install the latest version of docker-ce 19:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the Docker repository:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo yum config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo

sudo yum makecache --timer</pre>
</div>
</li>
<li class="listitem">
<p>Install containerd.io:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo yum -y install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm</pre>
</div>
</li>
<li class="listitem">
<p>Install the latest version of docker-ce 19:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo yum install docker-ce-19.03.13*</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-xfs-setup-rhel-onprem"></a>Set up XFS quotas<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>XFS quotas are required to support disk space quotas for Elasticsearch data directories. Some Linux distributions such as RHEL and CentOS already provide XFS as the default file system; however, quotas might be disabled.</p>
<p>Disk space quotas set a limit on the amount of disk space a cluster node can use. Currently, quotas are calculated by
a static ratio of 1:32, which means that for every 1 GB of RAM a cluster is given, a cluster node is allowed to consume 32 GB of disk space.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can use use LVM, <code class="literal">mdadm</code>, or a combination of the two for block device management, but this configuration is not documented nor is it supported in Elastic Cloud Enterprise.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must use XFS on all allocators.</p>
</div>
</div>
<p>To set up XFS with quotas on a single, pre-partitioned block device named <code class="literal">/dev/xvdg1</code>:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Format the partition:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo mkfs.xfs /dev/xvdg1</pre>
</div>
</li>
<li class="listitem">
<p>Create the <code class="literal">/mnt/data/</code> directory as a mount point:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>Modify the entry for the XFS volume in the <code class="literal">/etc/fstab</code> file to add <code class="literal">pquota,prjquota</code>. The
default filesystem path used by Elastic Cloud Enterprise is <code class="literal">/mnt/data</code>.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">/dev/xvdg1	/mnt/data	xfs	defaults,nofail,x-systemd.automount,prjquota,pquota  0 2</pre>
</div>
</li>
<li class="listitem">
<p>Regenerate the mount files:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl daemon-reload
sudo systemctl restart local-fs.target</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-update-configuration-settings-rhel-onprem"></a>Update the configurations settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Stop the Docker service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl stop docker</pre>
</div>
</li>
<li class="listitem">
<p>Configure kernel parameters:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cat &lt;&lt;EOF | sudo tee -a /etc/sysctl.conf
# Required by Elasticsearch 5.0 and later
vm.max_map_count = 262144
# enable the setting in order for Docker remove the containers cleanly
fs.may_detach_mounts = 1
# enable forwarding so the Docker networking works as expected
net.ipv4.ip_forward = 1
# Make sure the host doesn't swap too early
vm.swappiness=1
EOF</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Apply the settings:</p>
<p>RHEL/Centos 7:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo sysctl -p
sudo systemctl restart network</pre>
</div>
<p>RHEL/Centos 8:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo sysctl -p
sudo systemctl restart NetworkManager</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Adjust the system limits.</p>
<p>Add the following configuration values to the <code class="literal">/etc/security/limits.conf</code> file. If you are using a user name other than <code class="literal">elastic</code>, adjust the configuration values accordingly.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">*                soft    nofile         1024000
*                hard    nofile         1024000
*                soft    memlock        unlimited
*                hard    memlock        unlimited
elastic          soft    nofile         1024000
elastic          hard    nofile         1024000
elastic          soft    memlock        unlimited
elastic          hard    memlock        unlimited
root             soft    nofile         1024000
root             hard    nofile         1024000
root             soft    memlock        unlimited</pre>
</div>
<p>The default limit for number of processes is too low.
Remove it and rely on the kernel limit instead (for RHEL/Centos 7 only).</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo rm /etc/security/limits.d/20-nproc.conf</pre>
</div>
</li>
<li class="listitem">
<p>If you did not create the mount point earlier (if you did not set up XFS), create the <code class="literal">/mnt/data/</code> directory as a mount point:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>If you <a class="xref" href="ece-install-small-cloud.html#ece-xfs-setup-rhel-onprem" title="Set up XFS quotas">set up a new device with XFS</a> earlier:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Mount the block device (change the device name if you use a different device than <code class="literal">/dev/xvdg1</code>):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo mount /dev/xvdg1</pre>
</div>
</li>
<li class="listitem">
<p>Set the permissions on the newly mounted device:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo chown $USER:$USER /mnt/data</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Create the <code class="literal">/mnt/data/docker</code> directory for the Docker service storage:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data/docker</pre>
</div>
</li>
<li class="listitem">
<p>Disable the <code class="literal">firewalld</code> service. The service is not compatible with Docker and interferes with the installation of ECE. You must disable <code class="literal">firewalld</code> before installing or reinstalling ECE.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl disable firewalld</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-configure-docker-daemon-rhel-centos-onprem"></a>Configure the Docker daemon options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>Docker creates a bridge IP address that can conflict with IP addresses on your internal network. To avoid an IP address conflict, change the <code class="literal">--bip=172.17.42.1/16</code> parameter in our examples to something that you know will work. If there is no conflict, you can omit the <code class="literal">--bip</code> parameter. The <code class="literal">--bip</code> parameter is internal to the host and can be set to the same IP for each host in the cluster. More information on Docker daemon options can be found in the  <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" class="ulink" target="_top">dockerd command line reference</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update the <code class="literal">/etc/systemd/system/docker.service.d/docker.conf</code> file. If the file path and file do not exist, create them.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">[Unit]
Description=Docker Service
After=multi-user.target

[Service]
ExecStart=
ExecStart=/usr/bin/dockerd --data-root /mnt/data/docker --storage-driver=overlay2 --bip=172.17.42.1/16 --raw-logs --icc=false</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>With Docker version 1.13.x, Docker will not start with the <code class="literal">--data-root</code> option.  If this is the case, try using the <code class="literal">--graph</code> option instead.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Apply the updated Docker daemon configuration:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Reload the Docker daemon configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl daemon-reload</pre>
</div>
</li>
<li class="listitem">
<p>Restart the Docker service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl restart docker</pre>
</div>
</li>
<li class="listitem">
<p>Enable Docker to start on boot:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl enable docker</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Enable your user to communicate with the Docker subsystem by adding it to the <code class="literal">docker</code> group:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo usermod -aG docker $USER</pre>
</div>
</li>
<li class="listitem">
<p>Pin the Docker version to ensure that the <code class="literal">docker-ce</code> package does not get upgraded:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">echo "exclude=docker-ce" | sudo tee -a /etc/yum.conf</pre>
</div>
</li>
<li class="listitem">
<p>Enable your user to communicate with the Docker subsystem by adding it to the <code class="literal">docker</code> group:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo groupadd -f docker
sudo usermod -aG root,docker $USER
sudo chown root:docker /var/run/docker.sock</pre>
</div>
</li>
<li class="listitem">
<p>Recommended: Tune your network settings.</p>
<p>Create a <code class="literal">70-cloudenterprise.conf</code> file in the <code class="literal">/etc/sysctl.d/</code> file path that includes these network settings:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cat &lt;&lt; SETTINGS | sudo tee /etc/sysctl.d/70-cloudenterprise.conf
net.ipv4.tcp_max_syn_backlog=65536
net.core.somaxconn=32768
net.core.netdev_max_backlog=32768
SETTINGS</pre>
</div>
</li>
<li class="listitem">
<p>Reboot your system to ensure that all configuration changes take effect:</p>
<div class="pre_wrapper lang-literal">
<pre class="programlisting prettyprint lang-literal">sudo reboot</pre>
</div>
</li>
<li class="listitem">
<p>After rebooting, verify that your Docker settings persist as expected:</p>
<div class="pre_wrapper lang-literal">
<pre class="programlisting prettyprint lang-literal">sudo docker info | grep Root</pre>
</div>
<p>If the command returns <code class="literal">Docker Root Dir: /mnt/data/docker</code>, then your changes were applied successfully and persist as expected.</p>
<p>If the command returns <code class="literal">Docker Root Dir: /var/lib/docker</code>, then you need to troubleshoot the previous configuration steps until the Docker settings are applied successfully before continuing with the installation process. For more information, see <a href="https://docs.docker.com/engine/admin/systemd/#/custom-docker-daemon-options" class="ulink" target="_top">Custom Docker daemon options</a> in the Docker documentation.</p>
</li>
<li class="listitem">
Repeat these steps on other hosts that you want to use with Elastic Cloud Enterprise or follow the steps in the next section to start installing Elastic Cloud Enterprise.
</li>
</ol>
</div>
<p><a id="ece-configure-hosts-sles12-onprem"></a>==== SUSE Linux Enterprise Server (SLES) 12</p>
<p>The following instructions show you how to prepare your hosts on SLES 12.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-install-docker-sles12-onprem" title="Install Docker version 18.09.9">Install Docker 18.09.9</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-xfs-setup-sles12-onprem" title="Set up XFS on SLES">Set up XFS on SLES</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-update-config-sles-onprem" title="Update the configurations settings">Update the configurations settings</a>
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-configure-docker-daemon-sles12-onprem" title="Configure the Docker daemon options">Configure the Docker daemon options</a>
</li>
</ul>
</div>
<p>If you want to install Elastic Cloud Enterprise on your own hosts, the steps for preparing your hosts can take a bit of time. There are two ways you can approach this:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Think like a minimalist</strong></span>: <a class="xref" href="ece-install-small-cloud.html#ece-install-docker-sles12-onprem" title="Install Docker version 18.09.9">Install the correct version of Docker</a> on hosts that meet the <a class="xref" href="ece-prereqs.html" title="Preparing your installation">prerequisites</a> for Elastic Cloud Enterprise, then skip ahead and <a class="xref" href="ece-installing.html" title="Installing Elastic Cloud Enterprise">install Elastic Cloud Enterprise</a>. Be aware that some checks during the installation can fail with this approach, which will mean doing further host preparation work before retrying the installation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Cover your bases</strong></span>: If you want to make absolutely sure that your installation of Elastic Cloud Enterprise can succeed on hosts that meet the <a class="xref" href="ece-prereqs.html" title="Preparing your installation">prerequisites</a>, or if any of the checks during the installation failed previously, run through the full preparation steps in this section and then and <a class="xref" href="ece-installing.html" title="Installing Elastic Cloud Enterprise">install Elastic Cloud Enterprise</a>. You&#8217;ll do a bit more work now, but life will be simpler later on.
</li>
</ul>
</div>
<p>Regardless of which approach you take, the steps in this section need to be performed on every host that you want to use with Elastic Cloud Enterprise.</p>
<h5><a id="ece-install-docker-sles12-onprem"></a>Install Docker version 18.09.9<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the SLES Virtualization:containers repository:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo zypper ar -t rpm-md https://download.opensuse.org/repositories/Virtualization:containers/SLE_12_SP3/Virtualization:containers.repo
sudo zypper refresh</pre>
</div>
</li>
<li class="listitem">
<p>Install the correct version of the <code class="literal">docker</code> package:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo zypper install -y docker-18.09.7_ce-98.43.1</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-xfs-setup-sles12-onprem"></a>Set up XFS on SLES<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<p>Elastic Cloud Enterprise can run without XFS, but XFS is required to support disk space quotas for Elasticsearch data directories. Some Linux distributions such as RHEL and CentOS already provide XFS as the default file system. On SLES 12, we recommend that you set up an XFS file system first.</p>
<p>Disk space quotas set a limit on the amount of disk space an Elasticsearch cluster node can use. Currently, quotas are calculated by
a static ratio of 1:32, which means that for every 1 GB of RAM a cluster is given, a cluster node is allowed to consume 32 GB of disk space.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using LVM, <code class="literal">mdadm</code>, or a combination of the two for block device management is possible, but the
configuration is not covered here, nor is it provided as part of supporting Elastic Cloud Enterprise.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you use XFS, you must use XFS on all allocators.</p>
</div>
</div>
<p><span class="strong strong"><strong>Example:</strong></span> Set up XFS on a single, pre-partitioned block device named <code class="literal">/dev/xvdg1</code>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Format the partition:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo mkfs.xfs /dev/xvdg1</pre>
</div>
</li>
<li class="listitem">
<p>Create the <code class="literal">/mnt/data/</code> directory as a mount point:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>Add an entry to the <code class="literal">/etc/fstab</code> file for the new XFS volume. The
default filesystem path used by Elastic Cloud Enterprise is <code class="literal">/mnt/data</code>.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">/dev/xvdg1	/mnt/data	xfs	defaults,pquota,prjquota,x-systemd.automount  0 0</pre>
</div>
</li>
<li class="listitem">
<p>Regenerate the mount files:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo mount -a</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-update-config-sles-onprem"></a>Update the configurations settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Stop the Docker service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl stop docker</pre>
</div>
</li>
<li class="listitem">
<p>Enable cgroup accounting for memory and swap space.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In the <code class="literal">/etc/default/grub</code> file, ensure that the <code class="literal">GRUB_CMDLINE_LINUX=</code> variable includes these values:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cgroup_enable=memory swapaccount=1 cgroup.memory=nokmem</pre>
</div>
</li>
<li class="listitem">
<p>Update your Grub configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo update-bootloader</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Configure kernel parameters</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cat &lt;&lt;EOF | sudo tee -a /etc/sysctl.conf
# Required by Elasticsearch 5.0 and later
vm.max_map_count = 262144
# enable forwarding so the Docker networking works as expected
net.ipv4.ip_forward = 1
# Make sure the host doesn't swap too early
vm.swappiness=1
EOF</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Apply the settings:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo sysctl -p
sudo service network restart</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Adjust the system limits.</p>
<p>Add the following configuration values to the <code class="literal">/etc/security/limits.conf</code> file. These values are derived from our experience with the Elastic Cloud hosted offering and should be used for Elastic Cloud Enterprise as well.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are using a user name other than <code class="literal">elastic</code>, adjust the configuration values accordingly.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">*                soft    nofile         1024000
*                hard    nofile         1024000
*                soft    memlock        unlimited
*                hard    memlock        unlimited
elastic          soft    nofile         1024000
elastic          hard    nofile         1024000
elastic          soft    memlock        unlimited
elastic          hard    memlock        unlimited
root             soft    nofile         1024000
root             hard    nofile         1024000
root             soft    memlock        unlimited</pre>
</div>
</li>
<li class="listitem">
<p>If you did not create the mount point earlier (if you did not set up XFS), create the <code class="literal">/mnt/data/</code> directory as a mount point:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>If you <a class="xref" href="ece-install-small-cloud.html#ece-xfs-setup-sles12-onprem" title="Set up XFS on SLES">set up a new device with XFS</a> earlier:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Mount the block device (change the device name if you use a different device than <code class="literal">/dev/xvdg1</code>):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo mount /dev/xvdg1</pre>
</div>
</li>
<li class="listitem">
<p>Set the permissions on the newly mounted device:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo chown $USER:$USER /mnt/data</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Create the <code class="literal">/mnt/data/docker</code> directory for the Docker service storage:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data/docker</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-configure-docker-daemon-sles12-onprem"></a>Configure the Docker daemon options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update <code class="literal">/etc/sysconfig/docker</code>. If the file path and file do not exist, create them first.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Docker version 18.09.9</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">## Path           : System/Management
## Description    : Extra cli switches for docker daemon
## Type           : string
## Default        : ""
## ServiceRestart : docker
#
DOCKER_OPTS="-H unix:///run/docker.sock -g /mnt/data/docker --storage-driver=overlay --bip=172.17.42.1/16 --raw-logs --icc=false"</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Apply the updated Docker daemon configuration:</p>
<p>Reload the Docker daemon configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl daemon-reload</pre>
</div>
<p>Restart the Docker service:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl restart docker</pre>
</div>
<p>Enable Docker to start on boot:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo systemctl enable docker</pre>
</div>
</li>
<li class="listitem">
<p>Enable your user to communicate with the Docker subsystem by adding it to the <code class="literal">docker</code> group:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo usermod -aG docker $USER</pre>
</div>
</li>
<li class="listitem">
<p>Recommended: Tune your network settings.</p>
<p>Create a <code class="literal">70-cloudenterprise.conf</code> file in the <code class="literal">/etc/sysctl.d/</code> file path that includes these network settings:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cat &lt;&lt; SETTINGS | sudo tee /etc/sysctl.d/70-cloudenterprise.conf
net.ipv4.tcp_max_syn_backlog=65536
net.core.somaxconn=32768
net.core.netdev_max_backlog=32768
net.ipv4.tcp_keepalive_time=1800
net.netfilter.nf_conntrack_tcp_timeout_established=7200
net.netfilter.nf_conntrack_max=262140
SETTINGS</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Ensure settings in /etc/sysctl.d/*.conf are applied on boot</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">SCRIPT_LOCATION="/var/lib/cloud/scripts/per-boot/00-load-sysctl-settings"
sudo sh -c "cat &lt;&lt; EOF &gt; ${SCRIPT_LOCATION}
#!/bin/bash

set -x

lsmod | grep ip_conntrack || modprobe ip_conntrack

sysctl --system
EOF
"
sudo chmod +x ${SCRIPT_LOCATION}</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Reboot your system to ensure that all configuration changes take effect:</p>
<div class="pre_wrapper lang-literal">
<pre class="programlisting prettyprint lang-literal">sudo reboot</pre>
</div>
</li>
<li class="listitem">
<p>After rebooting, verify that your Docker settings persist as expected:</p>
<div class="pre_wrapper lang-literal">
<pre class="programlisting prettyprint lang-literal">sudo docker info | grep Root</pre>
</div>
<p>If the command returns <code class="literal">Docker Root Dir: /mnt/data/docker</code>, then your changes were applied successfully and persist as expected.</p>
<p>If the command returns <code class="literal">Docker Root Dir: /var/lib/docker</code>, then you need to troubleshoot the previous configuration steps until the Docker settings are applied successfully before continuing with the installation process. For more information, see <a href="https://docs.docker.com/engine/admin/systemd/#/custom-docker-daemon-options" class="ulink" target="_top">Custom Docker daemon options</a> in the Docker documentation.</p>
</li>
<li class="listitem">
Repeat these steps on other hosts that you want to use with Elastic Cloud Enterprise or follow the steps in the next section to start installing Elastic Cloud Enterprise.
</li>
</ol>
</div>
<p><a id="ece-install-onprem"></a>=== Install ECE</p>
<p>Choose the Elastic Cloud Enterprise deployment scenario that best fits your business needs:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html" title="Deploy a small installation">Deploy a small installation</a>: For development, test, and small-scale use cases.
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-install-medium-cloud">Deploy a medium installation</a>: For many production setups.
</li>
<li class="listitem">
<a class="xref" href="ece-install-small-cloud.html#ece-install-large-cloud">Deploy a large installation</a>: For deployments with significant overall search and indexing throughput.
</li>
</ul>
</div>
<p><a id="ece-install-small-onprem"></a>==== Deploy a small installation</p>
<p>The type of installation is recommended for development, test, and small-scale use cases.
You need:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
3 hosts with 128 GB RAM
</li>
<li class="listitem">
3 availability zones
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ece-pb-3.png" alt="A small baseline installation with three hosts across three availability zones">
</div>
</div>
<p>Perform the numbered steps on more than one host, as indicated in the illustration.</p>
<h5><a id="ece_before_you_start_4"></a>Before you start<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This type of installation is <span class="strong strong"><strong>not recommended for high-traffic workloads</strong></span>.
</li>
<li class="listitem">
You must not use <span class="strong strong"><strong>spinning disks</strong></span> with small ECE installations, as these are not supported when you run allocators and ECE management services on the same server.
</li>
<li class="listitem">
Note that the small-size ECE installation keeps the directors and coordinators roles (ECE management services) on the same hosts as your allocators and proxies.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Check the recommended JVM Heap sizes</strong></span></p>
</div>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Service</th>
<th align="left" valign="top">JVM Heap Size (Xms and Xmx)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">runner</code></p></td>
<td align="left" valign="top"><p>1 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">allocator</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">zookeeper</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">director</code></p></td>
<td align="left" valign="top"><p>1 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">constructor</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">admin-console</code></p></td>
<td align="left" valign="top"><p>4 GB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>For production environments, you must define the memory settings for each role, except for the <code class="literal">proxy</code> role, as starting from ECE 2.4 the JVM proxy was replaced with a Golang-based proxy. If you don&#8217;t set any memory setting, the default values are used, which are inadequate for production environments and can lead to performance or stability issues.</p>
</div>
</div>
<h5><a id="ece_installation_steps_4"></a>Installation steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-49/docs/cloud-enterprise/ce-install-small.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Install Elastic Cloud Enterprise on the first host to start a new installation with your first availability zone. This first host holds all runner roles to help bootstrap the rest of the installation.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
   --availability-zone MY_ZONE-1 \
   --memory-settings
   '{"runner":{"xms":"1G","xmx":"1G"},
   "allocator":{"xms":"4G","xmx":"4G"},
   "zookeeper":{"xms":"4G","xmx":"4G"},
   "director":{"xms":"1G","xmx":"1G"},
   "constructor":{"xms":"4G","xmx":"4G"},
   "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
<p>After the installation completes, copy down the coordinator host IP address, user credentials, and roles token information. Keep this information safe.</p>
</li>
<li class="listitem">
<p>Generate a new roles token that persists for one hour on the first host, so that other hosts can join your installation with the right role permissions in the next step (referred to as <code class="literal">MY_TOKEN</code>). The new token needs to enable all runner roles, which none of the tokens automatically generated by the installation on the first host provide.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -k -H 'Content-Type: application/json' -u admin:PASSWORD https://localhost:12443/api/v1/platform/configuration/security/enrollment-tokens -d '{ "persistent": false, "roles": ["director", "coordinator", "proxy", "allocator"] }'</pre>
</div>
</li>
<li class="listitem">
<p>Install Elastic Cloud Enterprise on a second and third host, placing them into a second and a third availability zone, and assign them the same roles and memory settings as the first host. Make sure you include the coordinator host IP information from Step 1 and the new roles token from Step 2.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "director,coordinator,proxy,allocator" \
  --availability-zone MY_ZONE-2 \
  --memory-settings
  '{"runner":{"xms":"1G","xmx":"1G"},
  "allocator":{"xms":"4G","xmx":"4G"},
  "zookeeper":{"xms":"4G","xmx":"4G"},
  "director":{"xms":"1G","xmx":"1G"},
  "constructor":{"xms":"4G","xmx":"4G"},
  "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bash &lt;(curl -fsSL https://download.elastic.co/cloud/elastic-cloud-enterprise.sh) install \
  --coordinator-host HOST_IP \
  --roles-token 'MY_TOKEN' \
  --roles "director,coordinator,proxy,allocator" \
  --availability-zone MY_ZONE-3 \
  --memory-settings
   '{"runner":{"xms":"1G","xmx":"1G"},
   "allocator":{"xms":"4G","xmx":"4G"},
   "zookeeper":{"xms":"4G","xmx":"4G"},
   "director":{"xms":"1G","xmx":"1G"},
   "constructor":{"xms":"4G","xmx":"4G"},
   "admin-console":{"xms":"4G","xmx":"4G"}}'</pre>
</div>
</li>
<li class="listitem">
<a class="xref" href="ece-change-deployment.html" title="Change your deployment configuration">Change the deployment configuration for the <code class="literal">admin-console-elasticsearch</code>, <code class="literal">logging-and-metrics</code>, and <code class="literal">security</code> clusters</a> to use three availability zones and resize the nodes to use at least 4 GB of RAM. This change makes sure that the clusters used by the administration console are highly available and provisioned sufficiently.
</li>
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a> to provision your deployment.
</li>
</ol>
</div>
<p>If necessary, you can scale and deploy a <a class="xref" href="ece-install-small-cloud.html#ece-install-medium-cloud">medium installation</a>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ece-install-cloud.html">« Install ECE</a>
</span>
<span class="next">
<a href="ece-install-medium-onprem.html">Deploy a medium installation »</a>
</span>
</div>
</div>
</body>
</html>
