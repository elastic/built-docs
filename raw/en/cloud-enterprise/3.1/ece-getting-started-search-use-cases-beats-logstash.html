<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ingest data from Beats to Elastic Cloud Enterprise with Logstash as a proxy | Elastic Cloud Enterprise Reference [3.1] | Elastic</title>
<meta class="elastic" name="content" content="Ingest data from Beats to Elastic Cloud Enterprise with Logstash as a proxy | Elastic Cloud Enterprise Reference [3.1]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.1]"/>
<link rel="up" href="ece-cloud-ingest-data.html" title="Indexing data into Elasticsearch"/>
<link rel="prev" href="ece-getting-started-python.html" title="Ingest data with Python on Elastic Cloud Enterprise"/>
<link rel="next" href="ece-getting-started-search-use-cases-db-logstash.html" title="Ingest data from a relational database into Elastic Cloud Enterprise"/>
<meta class="elastic" name="product_version" content="3.1"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.1"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.1"/>
</head>
<body><div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.1]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-stack-getting-started.html">Getting started with deployments</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-cloud-ingest-data.html">Indexing data into Elasticsearch</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ece-getting-started-python.html">« Ingest data with Python on Elastic Cloud Enterprise</a>
</span>
<span class="next">
<a href="ece-getting-started-search-use-cases-db-logstash.html">Ingest data from a relational database into Elastic Cloud Enterprise »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-getting-started-search-use-cases-beats-logstash"></a>Ingest data from Beats to Elastic Cloud Enterprise with Logstash as a proxy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h2>
</div></div></div>
<p>This guide explains how to ingest data from Filebeat and Metricbeat to Logstash as an intermediary, and then send that data to Elastic Cloud Enterprise. Using Logstash as a proxy limits your Elastic stack traffic through a single, external-facing firewall exception or rule. Consider the following features of this type of setup:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>You can send multiple instances of Beats data through your local network’s demilitarized zone (DMZ) to Logstash. Logstash then acts as a proxy through your firewall to send the Beats data to Elastic Cloud Enterprise, as shown in the following diagram:</p>
<p><span class="image"><img src="images/ec-logstash-beats-dataflow.png" alt="A diagram showing data from multiple Beats into Logstash" width="output to Elasticsearch" height="and viewable from Kibana"></span></p>
</li>
<li class="listitem">
This proxying reduces the firewall exceptions or rules necessary for Beats to communicate with Elastic Cloud Enterprise. It’s common to have many Beats dispersed across a network, each installed close to the data that it monitors, and each Beat individually communicating with an Elastic Cloud Enterprise deployment. Multiple Beats support multiple servers. Rather than configure each Beat to send its data directly to Elastic Cloud Enterprise, you can use Logstash to proxy this traffic through one firewall exception or rule.
</li>
<li class="listitem">
This setup is not suitable in simple scenarios when there is only one or a couple of Beats in use. Logstash makes the most sense for proxying when there are many Beats.
</li>
</ul>
</div>
<p>The configuration in this example makes use of the System module, available for both Filebeat and Metricbeat. Filebeat’s System sends server system log details (that is, login success/failures, sudo <em>superuser do</em> command usage, and other key usage details). Metricbeat’s System module sends memory, CPU, disk, and other server usage metrics.</p>
<p>In the following sections you are going to learn how to:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-deployment" title="Create a deployment">Create a deployment</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-connect-securely" title="Connect securely">Connect securely</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-logstash" title="Set up Logstash">Set up Logstash</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-metricbeat" title="Set up Metricbeat">Set up Metricbeat</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-metricbeat-send" title="Configure Metricbeat to send data to Logstash">Configure Metricbeat to send data to Logstash</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-filebeat" title="Set up FileBeat">Set up FileBeat</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-listen" title="Configure Logstash to listen for Beats">Configure Logstash to listen for Beats</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-stdout" title="Output Logstash data to stdout">Output Logstash data to stdout</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-elasticsearch" title="Output Logstash data to Elasticsearch">Output Logstash data to Elasticsearch</a>
</li>
<li class="listitem">
<a class="xref" href="ece-getting-started-search-use-cases-beats-logstash.html#ece-beats-logstash-view-kibana" title="View data in Kibana">View data in Kibana</a>
</li>
</ol>
</div>
<p><em>Time required: 1 hour</em></p>
<h4><a id="ece-beats-logstash-deployment"></a>Create a deployment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log into the Elastic Cloud Enterprise admin console.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create deployment</strong></span>.
</li>
<li class="listitem">
Give your deployment a name. You can leave all other settings at their default values.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create deployment</strong></span> and save your Elastic deployment credentials. You will need these credentials later on.
</li>
<li class="listitem">
<p>You also need the Cloud ID later on, as it simplifies sending data to Elastic Cloud Enterprise. Select the deployment name from the Elastic Cloud Enterprise portal or the <span class="strong strong"><strong>Deployments</strong></span> page and copy down the information under <span class="strong strong"><strong>Cloud ID</strong></span>:</p>
<p><span class="image"><img src="images/ec-cloud-id-scenarios.png" alt="A picture highlighting the Cloud ID information available for the deployment"></span></p>
</li>
</ol>
</div>
<h4><a id="ece-beats-logstash-connect-securely"></a>Connect securely<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<p>When connecting to Elastic Cloud Enterprise you can use a Cloud ID to specify the connection details. You must pass the Cloud ID that you can find in the cloud console.</p>
<p>To connect to, stream data to, and issue queries with Elastic Cloud Enterprise, you need to think about authentication. Two authentication mechanisms are supported, <em>API key</em> and <em>basic authentication</em>. Here, to get you started quickly, we’ll show you how to use basic authentication, but you can also generate API keys as shown later on. API keys are safer and preferred for production environments.</p>
<h4><a id="ece-beats-logstash-logstash"></a>Set up Logstash<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<p><a href="/downloads/logstash" class="ulink" target="_top">Download</a> and unpack Logstash on the local machine that hosts Beats or another machine granted access to the Beats machines.</p>
<h4><a id="ece-beats-logstash-metricbeat"></a>Set up Metricbeat<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<p>Now that Logstash is downloaded and your Elastic Cloud Enterprise deployment is set up, you can configure Metricbeat to send operational data to Logstash.</p>
<p>Install Metricbeat as close as possible to the service that you want to monitor. For example, if you have four servers with MySQL running, we recommend that you run Metricbeat on each server. This allows Metricbeat to access your service from <em>localhost</em>. This setup does not cause any additional network traffic and enables Metricbeat to collect metrics even in the event of network problems. Metrics from multiple Metricbeat instances are combined on the Logstash server.</p>
<p>If you have multiple servers with metrics data, repeat the following steps to configure Metricbeat on each server.</p>
<p><span class="strong strong"><strong>Download Metricbeat</strong></span></p>
<p><a href="/downloads/beats/metricbeat" class="ulink" target="_top">Download Metricbeat</a> and unpack it on the local server from which you want to collect data.</p>
<p><span class="strong strong"><strong>About Metricbeat modules</strong></span></p>
<p>Metricbeat has <a href="/guide/en/beats/metricbeat/8.7/metricbeat-modules.html" class="ulink" target="_top">many modules</a> available that collect common metrics. You can <a href="/guide/en/beats/metricbeat/8.7/configuration-metricbeat.html" class="ulink" target="_top">configure additional modules</a> as needed. For this example we’re using Metricbeat’s default configuration, which has the <a href="/guide/en/beats/metricbeat/8.7/metricbeat-module-system.html" class="ulink" target="_top">System module</a> enabled. The System module allows you to monitor servers with the default set of metrics: <em>cpu</em>, <em>load</em>, <em>memory</em>, <em>network</em>, <em>process</em>, <em>process_summary</em>, <em>socket_summary</em>, <em>filesystem</em>, <em>fsstat</em>, and <em>uptime</em>.</p>
<p><span class="strong strong"><strong>Load the Metricbeat Kibana dashboards</strong></span></p>
<p>Metricbeat comes packaged with example dashboards, visualizations, and searches for visualizing Metricbeat data in Kibana. Before you can use the dashboards, you need to create the data view (formerly <em>index pattern</em>) <em>metricbeat-*</em>, and load the dashboards into Kibana. This needs to be done from a local Beats machine that has access to the Elastic Cloud Enterprise deployment.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Beginning with Elastic Stack version 8.0, Kibana <em>index patterns</em> have been renamed to <em>data views</em>. To learn more, check the Kibana <a href="/guide/en/kibana/8.0/whats-new.html#index-pattern-rename" class="ulink" target="_top">What&#8217;s new in 8.0</a> page.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open a command line instance and then go to <em>&lt;localpath&gt;/metricbeat-&lt;version&gt;/</em>
</li>
<li class="listitem">
Run the following command:
</li>
</ol>
</div>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">sudo ./metricbeat setup \
  -E cloud.id=&lt;cloudID&gt; \ <a id="CO9-1"></a><i class="conum" data-value="1"></i>
  -E cloud.auth=&lt;username&gt;:&lt;password&gt; <a id="CO9-2"></a><i class="conum" data-value="2"></i>
  -E setup.kibana.ssl.certificate_authorities=['/path/to/the/elastic-ece-ca-cert.pem'] \ <a id="CO9-3"></a><i class="conum" data-value="3"></i>
  -E setup.kibana.ssl.verification_mode='certificate' \ <a id="CO9-4"></a><i class="conum" data-value="3"></i>
  -E output.elasticsearch.ssl.certificate_authorities=['/path/to/the/elastic-ece-ca-cert.pem'] \ <a id="CO9-5"></a><i class="conum" data-value="3"></i>
  -E output.elasticsearch.ssl.verification_mode='certificate' <a id="CO9-6"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specify the Cloud ID of your Elastic Cloud Enterprise deployment. You can include or omit the <code class="literal">&lt;Deploymentname&gt;:</code> prefix at the beginning of the Cloud ID. Both versions work fine.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specify the username and password provided to you when creating the deployment. Make sure to keep the colon between <em>&lt;username&gt;</em> and <em>&lt;password&gt;</em>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-3"><i class="conum" data-value="3"></i></a><a href="#CO9-4"></a><a href="#CO9-5"></a><a href="#CO9-6"></a></p>
</td>
<td align="left" valign="top">
<p>The four lines related to <code class="literal">ssl</code> are only used when you have a self signed certificate for your Elastic Cloud Enterprise proxy.  If needed, specify the full path to the PEM formatted root cetificate (Root CA) used for the Elastic Cloud Enterprise proxy.  You can retrieve the certificate chain from your ECE system by following the instructions in <a class="xref" href="ece-manage-certificates.html#ece-existing-security-certificates" title="Get existing ECE security certificates">Get existing ECE security certificates</a>.  Save the final certificate in the chain to a file. In this command example, the file is named <code class="literal">elastic-ece-ca-cert.pem</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Depending on variables including the installation location, environment and local permissions, you might need to <a href="/guide/en/beats/libbeat/8.7/config-file-permissions.html" class="ulink" target="_top">change the ownership</a> of the metricbeat.yml.</p>
<p>You might encounter similar permissions hurdles as you work through multiple sections of this document. These permission requirements are there for a good reason, a security safeguard to prevent unauthorized access and modification of key Elastic files.</p>
<p>If this isn’t a production environment and you want a fast-pass with less permissions hassles, then you can disable strict permission checks from the command line by using <code class="literal">--strict.perms=false</code> when executing Beats (for example, <code class="literal">./metricbeat --strict.perms=false</code>).</p>
<p>Depending on your system, you may also find that some commands need to be run as root, by prefixing <code class="literal">sudo</code> to the command.</p>
</div>
</div>
</td>
</tr>
</table>
</div>
<p>Your results should be similar to the following:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">Index setup finished.
Loading dashboards (Kibana must be running and reachable)
Loaded dashboards</pre>
</div>
<h4><a id="ece-beats-logstash-metricbeat-send"></a>Configure Metricbeat to send data to Logstash<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<div id="ece-beats-logstash-configure-metricbeat-for-logstash" class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In <em>&lt;localpath&gt;/metricbeat-&lt;version&gt;/</em> (where <em>&lt;localpath&gt;</em> is the directory where Metricbeat is installed), open the <em>metricbeat.yml</em> configuration file for editing.
</li>
<li class="listitem">
Scroll down to the <em>Elasticsearch Output</em> section. Place a comment pound sign (<em>#</em>) in front of <em>output.elasticsearch</em> and Elasticsearch <em>hosts</em>.
</li>
<li class="listitem">
Scroll down to the <em>Logstash Output</em> section. Remove the comment pound sign (<em>#</em>) from in front of <em>output.logstash</em> and <em>hosts</em>, as follows:
</li>
</ol>
</div>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt"># ---------------- Logstash Output -----------------
output.logstash:
  # The Logstash hosts
  hosts: ["localhost:5044"] <a id="CO10-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Replace <code class="literal">localhost</code> and the port number with the hostname and
port number where Logstash is listening.</p>
</td>
</tr>
</table>
</div>
<h4><a id="ece-beats-logstash-filebeat"></a>Set up FileBeat<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<p>The next step is to configure Filebeat to send operational data to Logstash. As with Metricbeat, install Filebeat as close as possible to the service that you want to monitor.</p>
<p><span class="strong strong"><strong>Download Filebeat</strong></span></p>
<p><a href="/downloads/beats/filebeat" class="ulink" target="_top">Download Filebeat</a> and unpack it on the local server from which you want to collect data.</p>
<p><span class="strong strong"><strong>Enable the Filebeat system module</strong></span></p>
<p>Filebeat has <a href="/guide/en/beats/filebeat/8.7/filebeat-modules.html" class="ulink" target="_top">many modules</a> available that collect common log types. You can <a href="/guide/en/beats/filebeat/8.7/configuration-filebeat-modules.html" class="ulink" target="_top">configure additional modules</a> as needed. For this example we’re using Filebeat’s <a href="/guide/en/beats/filebeat/8.7/filebeat-module-system.html" class="ulink" target="_top">System module</a>. This module reads in the various system log files (with information including login successes or failures, sudo command usage, and other key usage details) based on the detected operating system. For this example, a Linux-based OS is used and Filebeat ingests logs from the <em>/var/log/</em> folder. It’s important to verify that Filebeat is given permission to access your logs folder through standard file and folder permissions.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <em>&lt;localpath&gt;/filebeat-&lt;version&gt;/modules.d/</em> where <em>&lt;localpath&gt;</em> is the directory where Filebeat is installed.
</li>
</ol>
</div>
<p>Run the <code class="literal">filebeat modules</code> command as shown</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./filebeat modules enable system</pre>
</div>
<p>The system module is now enabled in Filebeat and it will be used the next time Filebeat starts.</p>
<p><span class="strong strong"><strong>Load the Filebeat Kibana dashboards</strong></span></p>
<p>Filebeat comes packaged with example Kibana dashboards, visualizations, and searches for visualizing Filebeat data in Kibana. Before you can use the dashboards, you need to create the data view <em>filebeat-*</em>, and load the dashboards into Kibana. This needs to be done from a Beats machine that has access to the Internet.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open a command line instance and then go to <em>&lt;localpath&gt;/filebeat-&lt;version&gt;/</em>
</li>
<li class="listitem">
Run the following command:
</li>
</ol>
</div>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">sudo ./filebeat setup \
  -E cloud.id=&lt;cloudID&gt; \ <a id="CO11-1"></a><i class="conum" data-value="1"></i>
  -E cloud.auth=&lt;username&gt;:&lt;password&gt; <a id="CO11-2"></a><i class="conum" data-value="2"></i>
  -E setup.kibana.ssl.certificate_authorities=['/path/to/the/elastic-ece-ca-cert.pem'] \ <a id="CO11-3"></a><i class="conum" data-value="3"></i>
  -E setup.kibana.ssl.verification_mode='certificate' \ <a id="CO11-4"></a><i class="conum" data-value="3"></i>
  -E output.elasticsearch.ssl.certificate_authorities=['/path/to/the/elastic-ece-ca-cert.pem'] \ <a id="CO11-5"></a><i class="conum" data-value="3"></i>
  -E output.elasticsearch.ssl.verification_mode='certificate' <a id="CO11-6"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specify the Cloud ID of your Elastic Cloud Enterprise deployment. You can include or omit the <code class="literal">&lt;Deploymentname&gt;:</code> prefix at the beginning of the Cloud ID. Both versions work fine.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specify the username and password provided to you when creating the deployment. Make sure to keep the colon between <em>&lt;username&gt;</em> and <em>&lt;password&gt;</em>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-3"><i class="conum" data-value="3"></i></a><a href="#CO11-4"></a><a href="#CO11-5"></a><a href="#CO11-6"></a></p>
</td>
<td align="left" valign="top">
<p>The four lines related to <code class="literal">ssl</code> are only needed if you are using self-signed certificates.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Depending on variables including the installation location, environment, and local permissions, you might need to <a href="/guide/en/beats/libbeat/8.7/config-file-permissions.html" class="ulink" target="_top">change the ownership</a> of the filebeat.yml.</p>
</div>
</div>
</td>
</tr>
</table>
</div>
<p>Your results should be similar to the following:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">Index setup finished.
Loading dashboards (Kibana must be running and reachable)
Loaded dashboards
Setting up ML using setup --machine-learning is going to be removed in 8.0.0. Please use the ML app instead.
See more: https://www.elastic.co/guide/en/machine-learning/current/index.html
Loaded machine learning job configurations
Loaded Ingest pipelines</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Exit the CLI.
</li>
</ol>
</div>
<p>The data views for <em>filebeat-*</em> and <em>metricbeat-*</em> are now available in Elasticsearch. To verify:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-access-kibana.html" title="Access Kibana">Login to Kibana</a>.
</li>
<li class="listitem">
Open the Kibana main menu and select <span class="strong strong"><strong>Stack Management</strong></span>, then <span class="strong strong"><strong>Data views</strong></span>.
</li>
<li class="listitem">
In the search bar, search for <em>data views</em>.
</li>
<li class="listitem">
In the search results, choose <em>Kibana / Data Views Management</em>.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Finish configuring Filebeat</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In <em>&lt;localpath&gt;/filebeat-&lt;version&gt;/</em> (where <em>&lt;localpath&gt;</em> is the directory where Filebeat is installed), open the <em>filebeat.yml</em> configuration file for editing.
</li>
<li class="listitem">
Scroll down to the <em>Outputs</em> section. Place a comment pound sign (<em>#</em>) in front of <em>output.elasticsearch</em> and Elasticsearch <em>hosts</em>.
</li>
<li class="listitem">
Scroll down to the <em>Logstash Output</em> section. Remove the comment pound sign (<em>#</em>) from in front of <em>output.logstash</em> and <em>hosts</em> as follows:
</li>
</ol>
</div>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt"># ---------------- Logstash Output -----------------
output.logstash:
  # The Logstash hosts
  hosts: ["localhost:5044"] <a id="CO12-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO12-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Replace <code class="literal">localhost</code> and the port number with the hostname and
port number where Logstash is listening.</p>
</td>
</tr>
</table>
</div>
<h4><a id="ece-beats-logstash-listen"></a>Configure Logstash to listen for Beats<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<p>Now the Filebeat and Metricbeat are set up, let&#8217;s configure a Logstash pipeline to input data from Beats and send results to the standard output. This enables you to verify the data output before sending it for indexing in Elasticsearch.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In <em>&lt;localpath&gt;/logstash-&lt;version&gt;/</em>, create a new text file named <em>beats.conf</em>.
</li>
<li class="listitem">
<p>Copy and paste the following code into the new text file. This code creates a Logstash pipeline
that listens for connections from Beats on port 5044 and writes to standard out (typically to your
terminal) with formatting provided by the Logstash rubydebug output plugin.</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">input {
  beats{port =&gt; 5044} <a id="CO13-1"></a><i class="conum" data-value="1"></i>
}
output {
  stdout{codec =&gt; rubydebug} <a id="CO13-2"></a><i class="conum" data-value="2"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Logstash listens for Beats input on the default port of 5044. Only one line is needed to do this. Logstash can handle input from many Beats of the same and also of varying types (Metricbeat, Filebeat, and others).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This sends output to the standard output, which displays through your command line interface. This plugin enables you to verify the data before you send it to Elasticsearch, in a later step.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
Save the new <em>beats.conf</em> file in your Logstash folder. To learn more about the file format and options, check <a href="/guide/en/logstash/8.7/config-examples.html" class="ulink" target="_top">Logstash Configuration Examples</a>.
</li>
</ol>
</div>
<h4><a id="ece-beats-logstash-stdout"></a>Output Logstash data to stdout<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<p>Now, let&#8217;s try out the Logstash pipeline with the Metricbeats and Filebeats configurations from the prior steps. Each Beat sends data into a Logstash pipeline, and the results display on the standard output where you can verify that everything looks correct.</p>
<p><span class="strong strong"><strong>Test Metricbeat to stdout</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Open a command line interface instance. Go to <em>&lt;localpath&gt;/logstash-&lt;version&gt;/</em>, where &lt;localpath&gt; is the directory where Logstash is installed, and start Logstash by running the following command:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">bin/logstash -f beats.conf</pre>
</div>
</li>
<li class="listitem">
<p>Open a second command line interface instance. Go to <em>&lt;localpath&gt;/metricbeat-&lt;version&gt;/</em>, where &lt;localpath&gt; is the directory where Metricbeat is installed, and start Metricbeat by running the following command:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./metricbeat -c metricbeat.yml</pre>
</div>
</li>
<li class="listitem">
<p>Switch back to your first command line interface instance with Logstash. Now, Metricbeat events are input into Logstash and the output data is directed to the standard output. Your results should be similar to the following:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">"tags" =&gt; [
          [0] "beats_input_raw_event"
],
"agent" =&gt; {
          "type" =&gt; "metricbeat",
          "name" =&gt; "john-VirtualBox",
       "version" =&gt; "7.12.0",
  "ephemeral_id" =&gt; "1e69064c-d49f-4ec0-8414-9ab79b6f27a4",
            "id" =&gt; "1b6c39e8-025f-4310-bcf1-818930a411d4",
      "hostname" =&gt; "john-VirtualBox"
},
"service" =&gt; {
          "type" =&gt; "system"
},
"event" =&gt; {
      "duration" =&gt; 39833,
        "module" =&gt; "system",
       "dataset" =&gt; "system.cpu"
},
    "@timestamp" =&gt; 2021-04-21T17:06:05.231Z,
     "metricset" =&gt; {
          "name" =&gt; "cpu",
        "period" =&gt; 10000
},
"@version" =&gt; "1","host" =&gt; {
            "id" =&gt; "939972095cf1459c8b22cc608eff85da",
            "ip" =&gt; [
              [0] "10.0.2.15",
              [1] "fe80::3700:763c:4ba3:e48c"
],
"name" =&gt; "john-VirtualBox","mac" =&gt; [
              [0] "08:00:27:a3:c7:a9"
],
"os" =&gt; {
          "type" =&gt; "linux",</pre>
</div>
</li>
<li class="listitem">
Switch back to the Metricbeat command line instance. Enter <em>CTRL + C</em> to shut down Metricbeat, and then exit the CLI.
</li>
<li class="listitem">
Switch back to the Logstash command line instance. Enter <em>CTRL + C</em> to shut down Logstash, and then exit the CLI.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Test Filebeat to stdout</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Open a command line interface instance. Go to <em>&lt;localpath&gt;/logstash-&lt;version&gt;/</em>, where &lt;localpath&gt; is the directory where Logstash is installed, and start Logstash by running the following command:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">bin/logstash -f beats.conf</pre>
</div>
</li>
<li class="listitem">
<p>Open a second command line interface instance. Go to <em>&lt;localpath&gt;/filebeat-&lt;version&gt;/</em>, where &lt;localpath&gt; is the directory where Filebeat is installed, and start Filebeat by running the following command:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./filebeat -c filebeat.yml</pre>
</div>
</li>
<li class="listitem">
<p>Switch back to your first command line interface instance with Logstash. Now, Filebeat events are input into Logstash and the output data is directed to the standard output. Your results should be similar to the following:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">{
       "service" =&gt; {
        "type" =&gt; "system"
    },
         "event" =&gt; {
        "timezone" =&gt; "-04:00",
         "dataset" =&gt; "system.syslog",
          "module" =&gt; "system"
    },
       "fileset" =&gt; {
        "name" =&gt; "syslog"
    },
         "agent" =&gt; {
                  "id" =&gt; "113dc127-21fa-4ebb-ab86-8a151d6a23a6",
                "type" =&gt; "filebeat",
             "version" =&gt; "7.12.0",
            "hostname" =&gt; "john-VirtualBox",
        "ephemeral_id" =&gt; "1058ad74-8494-4a5e-9f48-ad7c5b9da915",
                "name" =&gt; "john-VirtualBox"
    },
    "@timestamp" =&gt; 2021-04-28T15:33:41.727Z,
         "input" =&gt; {
        "type" =&gt; "log"
    },
           "ecs" =&gt; {
        "version" =&gt; "1.8.0"
    },
      "@version" =&gt; "1",
           "log" =&gt; {
        "offset" =&gt; 73281,
          "file" =&gt; {
            "path" =&gt; "/var/log/syslog"
        }
    },</pre>
</div>
</li>
<li class="listitem">
Review the Logstash output results to make sure your data looks correct. Enter <em>CTRL + C</em> to shut down Logstash.
</li>
<li class="listitem">
Switch back to the Filebeats CLI. Enter <em>CTRL + C</em> to shut down Filebeat.
</li>
</ol>
</div>
<h4><a id="ece-beats-logstash-elasticsearch"></a>Output Logstash data to Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<p>In this section, you configure Logstash to send the Metricbeat and Filebeat data to Elasticsearch. You modify the <em>beats.conf</em> created earlier, and specify the output credentials needed for our Elastic Cloud Enterprise deployment. Then, you start Logstash to send the Beats data into Elasticsearch.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your <em>&lt;localpath&gt;/logstash-&lt;version&gt;/</em> folder, open <em>beats.conf</em> for editing.
</li>
<li class="listitem">
<p>Replace the <em>output {}</em> section of the JSON with the following code:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">output {
  elasticsearch {
    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}"
    ilm_enabled =&gt; true
    cloud_id =&gt; "&lt;DeploymentName&gt;:&lt;ID&gt;" <a id="CO14-1"></a><i class="conum" data-value="1"></i>
    cloud_auth =&gt; "elastic:&lt;Password&gt;" <a id="CO14-2"></a><i class="conum" data-value="2"></i>
    ssl =&gt; true
    cacert =&gt; '/path/to/the/elastic-ece-ca-cert.pem' <a id="CO14-3"></a><i class="conum" data-value="3"></i>
    # api_key =&gt; "&lt;myAPIid:myAPIkey&gt;"
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use the Cloud ID of your Elastic Cloud Enterprise deployment. You can include or omit the <code class="literal">&lt;DeploymentName&gt;:</code> prefix at the beginning of the Cloud ID. Both versions work fine.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>the default usename is <code class="literal">elastic</code>.  It is not recommended to use the <code class="literal">elastic</code> account for ingesting data as this is a superuser.  We recommend using a user with reduced permissions, or an API Key with permissions specific to the indices or data streams that will be written to.  Check the <a href="/guide/en/beats/filebeat/8.7/feature-roles.html" class="ulink" target="_top">Grant access to secured resources</a> for information on the writer role and API Keys. Use the password provided when you created the deployment if using the <code class="literal">elastic</code> user, or the password used when creating a new ingest user with the roles specified in the <a href="/guide/en/beats/filebeat/8.7/feature-roles.html" class="ulink" target="_top">Grant access to secured resources</a> documentation.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The cacert line is only needed if you are using a self-signed certificate.</p>
</td>
</tr>
</table>
</div>
<p>Following are some additional details about the configuration file settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><em>index</em>: We specify the name of the Elasticsearch index with which to associate the Beats output.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<em>%{[@metadata][beat]}</em> sets the first part of the index name to the value of the Beat metadata field.
</li>
<li class="listitem">
<p><em>%{[@metadata][version]}</em> sets the second part of the index name to the Beat version.</p>
<p>If you use Metricbeat version 7.12.0, the index created in Elasticsearch is named <em>metricbeat-7.12.0</em>. Similarly, using the 7.12.0 version of Filebeat, the Elasticsearch index is named <em>filebeat-7.12.0</em>.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<em>cloud_id</em>: This is the ID that uniquely identifies your Elastic Cloud Enterprise deployment.
</li>
<li class="listitem">
<em>ssl</em>: This should be set to <code class="literal">true</code> so that Secure Socket Layer (SSL) certificates are used for secure communication between Logstash and your Elastic Cloud Enterprise deployment.
</li>
<li class="listitem">
<em>ilm_enabled</em>: Enables and disables Elastic Cloud Enterprise <a href="/guide/en/elasticsearch/reference/8.7/index-lifecycle-management.html" class="ulink" target="_top">index lifecycle management</a>.
</li>
<li class="listitem">
<em>api_key</em>: If you choose to use an API key to authenticate (as discussed in the next step), you can provide it here.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Optional</strong></span>: For additional security, you can generate an Elasticsearch API key through the Elastic Cloud Enterprise console and configure Logstash to use the new key to connect securely to the Elastic Cloud Enterprise.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li>
<li class="listitem">
<p>On the deployments page, select your deployment.</p>
<p>Narrow the list by name, ID, or choose from several other filters. To further define the list, use a combination of filters.</p>
</li>
<li class="listitem">
From your deployment menu, select <span class="strong strong"><strong>Elasticsearch</strong></span>, then <span class="strong strong"><strong>API Console</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Post</strong></span> from the drop-down list and enter <code class="literal">/_security/api_key</code> in the field.
</li>
<li class="listitem">
<p>Enter the following JSON request:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
 "name": "logstash-apikey",
 "role_descriptors": {
   "logstash_read_write": {
     "cluster": ["manage_index_templates", "monitor"],
     "index": [
       {
         "names": ["logstash-*","metricbeat-*","filebeat-*"],
         "privileges": ["create_index", "write", "read", "manage"]
       }
     ]
   }
 }
}</pre>
</div>
<p>This creates an API key with the cluster <code class="literal">monitor</code> privilege which gives read-only access for determining the cluster state, and <code class="literal">manage_index_templates</code> which allows all operations on index templates. Some additional privileges also allow <code class="literal">create_index</code>, <code class="literal">write</code>, and <code class="literal">manage</code> operations for the specified index. The index <code class="literal">manage</code> privilege is added to enable index refreshes.</p>
</li>
<li class="listitem">
<p>Select <span class="strong strong"><strong>Submit</strong></span>. The output should be similar to the following:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "api_key": "aB1cdeF-GJI23jble4NOH4",
  "id": "2GBe63fBcxgJAetmgZeh",
  "name": "logstash_api_key"
}</pre>
</div>
</li>
<li class="listitem">
<p>Enter your new <code class="literal">api_key</code> value into the Logstash <code class="literal">beats.conf</code> file, in the format <code class="literal">&lt;id&gt;:&lt;api_key&gt;</code>. If your results were as shown in this example, you would enter <code class="literal">2GBe63fBcxgJAetmgZeh:aB1cdeF-GJI23jble4NOH4</code>. Remember to remove the pound (<code class="literal">#</code>) sign to uncomment the line, and comment out the <code class="literal">username</code> and <code class="literal">password</code> lines:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">output {
  elasticsearch {
    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}"
    cloud_id =&gt; "&lt;myDeployment&gt;"
    ssl =&gt; true
    ilm_enabled =&gt; true
    api_key =&gt; "2GBe63fBcxgJAetmgZeh:aB1cdeF-GJI23jble4NOH4"
    # user =&gt; "&lt;Username&gt;"
    # password =&gt; "&lt;Password&gt;"
  }
}</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Open a command line interface instance, go to your Logstash installation path, and start Logstash:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">bin/logstash -f beats.conf</pre>
</div>
</li>
<li class="listitem">
<p>Open a second command line interface instance, go to your Metricbeat installation path, and start Metricbeat:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./metricbeat -c metricbeat.yml</pre>
</div>
</li>
<li class="listitem">
<p>Open a third command line interface instance, go to your Filebeat installation path, and start Filebeat:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./filebeat -c filebeat.yml</pre>
</div>
</li>
<li class="listitem">
Logstash now outputs the Filebeat and Metricbeat data to your Elastic Cloud Enterprise instance.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In this guide, you manually launch each of the Elastic stack applications through the command line interface. In production, you may prefer to configure Logstash, Metricbeat, and Filebeat to run as System Services. Check the following pages for the steps to configure each application to run as a service:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/logstash/8.7/running-logstash.html" class="ulink" target="_top">Running Logstash as a service on Debian or RPM</a>
</li>
<li class="listitem">
<a href="/guide/en/beats/metricbeat/8.7/running-with-systemd.html" class="ulink" target="_top">Metricbeat and systemd</a>
</li>
<li class="listitem">
<a href="/guide/en/beats/filebeat/8.7/filebeat-starting.html" class="ulink" target="_top">Start filebeat</a>
</li>
</ul>
</div>
</div>
</div>
<h4><a id="ece-beats-logstash-view-kibana"></a>View data in Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-70/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h4>
<p>In this section, you log into Elastic Cloud Enterprise, open Kibana, and view the Kibana dashboards populated with our Metricbeat and Filebeat data.</p>
<p><span class="strong strong"><strong>View the Metricbeat dashboard</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-access-kibana.html" title="Access Kibana">Login to Kibana</a>.
</li>
<li class="listitem">
Open the Kibana main menu and select <span class="strong strong"><strong>Analytics</strong></span>, then <span class="strong strong"><strong>Dashboard</strong></span>.
</li>
<li class="listitem">
In the search box, search for <em>metricbeat system</em>. The search results show several dashboards available for you to explore.
</li>
<li class="listitem">
In the search results, choose <em>[Metricbeat System] Overview ECS</em>. A Metricbeat dashboard opens:
</li>
</ol>
</div>
<p><span class="image"><img src="ec-logstash-beats-metricbeat-dashboard.png" alt="A screencapture of the Kibana dashboard named Metricbeat System Overview ECS"></span></p>
<p><span class="strong strong"><strong>View the Filebeat dashboard</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the Kibana main menu and select <span class="strong strong"><strong>Analytics</strong></span>, then <span class="strong strong"><strong>Dashboard</strong></span>.
</li>
<li class="listitem">
In the search box, search for <em>filebeat system</em>.
</li>
<li class="listitem">
In the search results, choose <em>[Filebeat System] Syslog dashboard ECS</em>. A Filebeat dashboard displaying your Filebeat data:
</li>
</ol>
</div>
<p><span class="image"><img src="ec-logstash-beats-filebeat-dashboard.png" alt="A screencapture of the Kibana dashboard named Filebeat System ECS"></span></p>
<p>Now, you should have a good understanding of how to configure Logstash to ingest data from multiple Beats. You have the basics needed to begin experimenting with your own combination of Beats and modules.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ece-getting-started-python.html">« Ingest data with Python on Elastic Cloud Enterprise</a>
</span>
<span class="next">
<a href="ece-getting-started-search-use-cases-db-logstash.html">Ingest data from a relational database into Elastic Cloud Enterprise »</a>
</span>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>
