<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create deployment templates | Elastic Cloud Enterprise Reference [3.3] | Elastic</title>
<meta class="elastic" name="content" content="Create deployment templates | Elastic Cloud Enterprise Reference [3.3]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.3]"/>
<link rel="up" href="ece-configuring-ece-templates.html" title="Configure deployment templates"/>
<link rel="prev" href="ece-configuring-ece-instance-configurations-create.html" title="Create instance configurations"/>
<link rel="next" href="ece-configuring-ece-configure-system-templates.html" title="Configure system deployment templates"/>
<meta class="elastic" name="product_version" content="3.3"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.3"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.3"/>
</head>
<body><div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.3]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-configuring-ece.html">Configuring your installation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-configuring-ece-templates.html">Configure deployment templates</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ece-configuring-ece-instance-configurations-create.html">« Create instance configurations</a>
</span>
<span class="next">
<a href="ece-configuring-ece-configure-system-templates.html">Configure system deployment templates »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-configuring-ece-create-templates"></a>Create deployment templates<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-75/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h2>
</div></div></div>
<p>Elastic Cloud Enterprise comes with some deployment templates already built in, but you can create new deployment templates to address particular use cases that you might have.</p>
<p>For example: You might decide to create a new deployment template, if you have a specific search use case that requires Elasticsearch data nodes in a specific configuration that also includes machine learning for anomaly detection. If you need to create these deployments fairly frequently, you can create a deployment template once and deploy it as many times as you like. Or, create a single template for both your test and production deployments to ensure they are exactly the same.</p>
<h4><a id="ece_before_you_begin_3"></a>Before you begin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-75/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h4>
<p>Before you start creating your own deployment templates, you should have:
<a class="xref" href="ece-configuring-ece-tag-allocators.html" title="Tag your allocators">tagged your allocators</a> to tell ECE what kind of hardware you have available for Elastic Stack deployments. If the default instance configurations don&#8217;t provide what you need, you might also need to <a class="xref" href="ece-configuring-ece-instance-configurations-create.html" title="Create instance configurations">create your own instance configurations</a> first.</p>
<h4><a id="ece-configuring-ece-create-templates-ui"></a>Create deployment templates in the UI<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-75/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Platform</strong></span> menu, select <span class="strong strong"><strong>Templates</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create template</strong></span>.
</li>
<li class="listitem">
Give your template a name and include a description that reflects its intended use.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Create template</strong></span>. The <span class="strong strong"><strong>Configure instances</strong></span> page opens.
</li>
<li class="listitem">
<p>Choose whether or not <a class="xref" href="ece-autoscaling.html" title="Deployment autoscaling">autoscaling</a> is enabled by default for deployments created using the template. Autoscaling adjusts resources available to the deployment automatically as loads change over time.</p>
<div class="imageblock">
<div class="content">
<img src="images/ece-create-template-autoscaling.png" alt="screencapture of the &quot;Enable autoscaling by default&quot; switch">
</div>
</div>
</li>
<li class="listitem">
<p>Configure the initial settings for all of the data tiers and components that will be available in the template. A default is provided for every setting and you can adjust these as needed. For each data tier and component, you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Select which <a class="xref" href="ece-configuring-ece-instance-configurations-create.html" title="Create instance configurations">instance configuration</a> to assign to the template. This allows you to optimize the performance of your deployments by matching a machine type to a use case. A hot data and content tier, for example, is best suited to be allocated with an instance configuration having fast SSD storage, while warm and cold data tiers should be allocated with an instance configuration with larger storage but likely less performant, lower cost hardware.</p>
<div class="imageblock">
<div class="content">
<img src="images/ece-create-template-instance-configuration.png" alt="screencapture of the &quot;Initial size per zone&quot; dropdown box">
</div>
</div>
</li>
<li class="listitem">
<p>Adjust the default, initial amount of memory and storage. Increasing memory and storage also improves performance by increasing the CPU resources that get assigned relative to the size of the instance, meaning that a 32 GB instance gets twice as much CPU resource as a 16 GB one. These resources are just template defaults that can be adjusted further before you create actual deployments.</p>
<div class="imageblock">
<div class="content">
<img src="images/ece-create-template-initial-size.png" alt="screencapture of the &quot;Initial size per zone&quot; dropdown box">
</div>
</div>
</li>
<li class="listitem">
<p>Configure autoscaling settings for the deployment.</p>
<div class="imageblock">
<div class="content">
<img src="images/ece-create-template-max-autoscaling.png" alt="screencapture of the &quot;Maximum autoscaling size per zone&quot; dropdown box">
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For data nodes, autoscaling up is supported based on the amount of available storage. You can set the default initial size of the node and the default maximum size that the node can be autoscaled up to.
</li>
<li class="listitem">
For machine learning nodes, autoscaling is supported based on the expected memory requirements for machine learning jobs. You can set the default minimum size that the node can be scaled down to and the default maximum size that the node can be scaled up to. If autoscaling is not enabled for the deployment, the "minimum" value will instead be the default initial size of the machine learning node.
</li>
</ul>
</div>
<p>The default values provided by the deployment template can be adjusted at any time. Check our <a class="xref" href="ece-autoscaling-example.html" title="Autoscaling example">Autoscaling example</a> for details about these settings. Nodes and components that currently support autoscaling are indicated by a <code class="literal">supports autoscaling</code> badge on the <span class="strong strong"><strong>Configure instances</strong></span> page.</p>
</li>
<li class="listitem">
<p>Add <a class="xref" href="ece-ha.html" title="High availability">fault tolerance</a> (high availability) by using more than one availability zone.</p>
<div class="imageblock">
<div class="content">
<img src="images/ece-create-template-availability-zones.png" alt="screencapture of the &quot;Availability zones&quot; radio buttons">
</div>
</div>
</li>
<li class="listitem">
<p>Add user settings to configure how Elasticsearch and other components run. Check <a class="xref" href="editing-user-settings.html" title="Editing your user settings">Editing your user settings</a> for details about what settings are available.</p>
<div class="imageblock">
<div class="content">
<img src="images/ece-create-template-user-settings.png" alt="screencapture of the &quot;User settings&quot; expandable section">
</div>
</div>
</li>
</ul>
</div>
<p>If a data tier or component is not required for your particular use case, you can simply set its initial size per zone to <code class="literal">0</code>. You can enable a tier or component anytime you need it just by scaling up the size. If autoscaling is enabled, data tiers and machine learning nodes are sized up automatically when they&#8217;re needed. For example, when you configure your first machine learning job, ML nodes are enabled by the autoscaling process. Similarly, if you choose to create a cold data phase as part of your deployment&#8217;s index lifecycle management (ILM) policy, a cold data node is enabled automatically without your needing to configure it.</p>
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Manage indices</strong></span>.
</li>
<li class="listitem">
On this page you can <a class="xref" href="ece-configure-templates-index-management.html" title="Configure index management for templates">configure index management</a> by assigning attributes to each of the data nodes in the deployment template. In Kibana, you can configure an index lifecycle management (ILM) policy, based on the node attributes, to control how data moves across the nodes in your deployment.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Stack features</strong></span>.
</li>
<li class="listitem">
You can select a <a class="xref" href="ece-manage-repositories.html" title="Manage snapshot repositories">snapshot repository</a> to be used by default for deployment backups.
</li>
<li class="listitem">
You can choose to <a class="xref" href="ece-enable-logging-and-monitoring.html" title="Enable logging and monitoring">enable logging and monitoring</a> by default, so that deployment logs and metrics are send to a dedicated monitoring deployment, and so that additional log types, retention options, and Kibana visualizations are available on all deployments created using this template.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Extensions</strong></span>.
</li>
<li class="listitem">
Select any Elasticsearch extensions that you would like to be available automatically to all deployments created using the template.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Save and create template</strong></span>.
</li>
</ol>
</div>
<h4><a id="ece_create_deployment_templates_through_the_restful_api"></a>Create deployment templates through the RESTful API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-75/docs/cloud-enterprise/ce-configuring-ece-deployment-templates.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Obtain the existing deployment templates to get some examples of what the required JSON looks like. You can take the JSON for one of the existing templates and modify it to create a new template, similar to what gets shown in the next step.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -k -X GET -H "Authorization: ApiKey $ECE_API_KEY" https://COORDINATOR_HOST:12443/api/v1/deployments/templates?region=ece-region</pre>
</div>
</li>
<li class="listitem">
<p>Post the JSON for your new deployment template.</p>
<p>The following example creates a deployment template that defaults to a highly available Elasticsearch cluster with 4 GB per hot node, a 16 GB machine learning node, 3 dedicated master nodes of 1 GB each, a 1 GB Kibana instance, and a 1 GB dedicated coordinating node that is tasked with handling and coordinating all incoming requests for the cluster. Elasticsearch and Kibana use the default instance configurations, but the machine learning node is based on the custom instance configuration in our previous example.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -k -X POST -H "Authorization: ApiKey $ECE_API_KEY" https://$COORDINATOR_HOST:12443/api/v1/deployments/templates?region=ece-region -H 'content-type: application/json' -d '{
    "name" : "Default",
    "description" : "Default deployment template for clusters",
    "deployment_template": {
      "resources": {
        "elasticsearch": [
          {
            "ref_id": "es-ref-id",
            "region": "ece-region",
            "plan": {
              "cluster_topology": [
                {
                  "node_type": {
                    "master": true,
                    "data": true,
                    "ingest": true
                  },
                  "zone_count": 1,
                  "instance_configuration_id": "data.default",
                  "size": {
                    "value": 4096,
                    "resource": "memory"
                  },
                  "node_roles": [
                    "master",
                    "ingest",
                    "data_hot",
                    "data_content",
                    "remote_cluster_client",
                    "transform"
                  ],
                  "id": "hot_content",
                  "elasticsearch": {
                    "node_attributes": {
                      "data": "hot"
                    }
                  },
                  "topology_element_control": {
                    "min": {
                      "value": 1024,
                      "resource": "memory"
                    }
                  },
                  "autoscaling_max": {
                    "value": 2097152,
                    "resource": "memory"
                  }
                },
                {
                  "node_type": {
                    "data": true,
                    "ingest": false,
                    "master": false
                  },
                  "instance_configuration_id": "data.highstorage",
                  "zone_count": 1,
                  "size": {
                    "resource": "memory",
                    "value": 0
                  },
                  "node_roles": [
                    "data_warm",
                    "remote_cluster_client"
                  ],
                  "id": "warm",
                  "elasticsearch": {
                    "node_attributes": {
                      "data": "warm"
                    }
                  },
                  "topology_element_control": {
                    "min": {
                      "value": 0,
                      "resource": "memory"
                    }
                  },
                  "autoscaling_max": {
                    "value": 2097152,
                    "resource": "memory"
                  }
                },
                {
                  "node_type": {
                    "data": true,
                    "ingest": false,
                    "master": false
                  },
                  "instance_configuration_id": "data.highstorage",
                  "zone_count": 1,
                  "size": {
                    "resource": "memory",
                    "value": 0
                  },
                  "node_roles": [
                    "data_cold",
                    "remote_cluster_client"
                  ],
                  "id": "cold",
                  "elasticsearch": {
                    "node_attributes": {
                      "data": "cold"
                    }
                  },
                  "topology_element_control": {
                    "min": {
                      "value": 0,
                      "resource": "memory"
                    }
                  },
                  "autoscaling_max": {
                    "value": 2097152,
                    "resource": "memory"
                  }
                },
                {
                  "node_type": {
                    "data": true,
                    "ingest": false,
                    "master": false
                  },
                  "instance_configuration_id": "data.frozen",
                  "zone_count": 1,
                  "size": {
                    "resource": "memory",
                    "value": 0
                  },
                  "node_roles": [
                    "data_frozen"
                  ],
                  "id": "frozen",
                  "elasticsearch": {
                    "node_attributes": {
                      "data": "frozen"
                    }
                  },
                  "topology_element_control": {
                    "min": {
                      "value": 0,
                      "resource": "memory"
                    }
                  },
                  "autoscaling_max": {
                    "value": 2097152,
                    "resource": "memory"
                  }
                },
                {
                  "node_type": {
                    "master": false,
                    "data": false,
                    "ingest": true
                  },
                  "zone_count": 1,
                  "instance_configuration_id": "coordinating",
                  "size": {
                    "value": 1024,
                    "resource": "memory"
                  },
                  "node_roles": [
                    "ingest",
                    "remote_cluster_client"
                  ],
                  "id": "coordinating",
                  "topology_element_control": {
                    "min": {
                      "value": 0,
                      "resource": "memory"
                    }
                  }
                },
                {
                  "node_type": {
                    "master": true,
                    "data": false,
                    "ingest": false
                  },
                  "zone_count": 3,
                  "instance_configuration_id": "master",
                  "size": {
                    "value": 1024,
                    "resource": "memory"
                  },
                  "node_roles": [
                    "master",
                    "remote_cluster_client"
                  ],
                  "id": "master",
                  "topology_element_control": {
                    "min": {
                      "value": 0,
                      "resource": "memory"
                    }
                  }
                },
                {
                  "node_type": {
                    "master": false,
                    "data": false,
                    "ingest": false,
                    "ml": true
                  },
                  "zone_count": 1,
                  "instance_configuration_id": "ml",
                  "size": {
                    "value": 0,
                    "resource": "memory"
                  },
                  "node_roles": [
                    "ml",
                    "remote_cluster_client"
                  ],
                  "id": "ml",
                  "topology_element_control": {
                    "min": {
                      "value": 16384,
                      "resource": "memory"
                    }
                  },
                  "autoscaling_min": {
                    "resource": "memory",
                    "value": 16384
                  },
                  "autoscaling_max": {
                    "value": 2097152,
                    "resource": "memory"
                  }
                }
              ],
              "elasticsearch": {},
              "autoscaling_enabled": false
            },
            "settings": {
              "dedicated_masters_threshold": 3
            }
          }
        ],
        "kibana": [
          {
            "ref_id": "kibana-ref-id",
            "elasticsearch_cluster_ref_id": "es-ref-id",
            "region": "ece-region",
            "plan": {
              "zone_count": 1,
              "cluster_topology": [
                {
                  "instance_configuration_id": "kibana",
                  "size": {
                    "value": 1024,
                    "resource": "memory"
                  }
                }
              ],
              "kibana": {}
            }
          }
        ],
        "apm": [
          {
            "ref_id": "apm-ref-id",
            "elasticsearch_cluster_ref_id": "es-ref-id",
            "region": "ece-region",
            "plan": {
              "cluster_topology": [
                {
                  "instance_configuration_id": "apm",
                  "size": {
                    "value": 0,
                    "resource": "memory"
                  },
                  "zone_count": 1
                }
              ],
              "apm": {}
            }
          }
        ],
        "enterprise_search": [
          {
            "ref_id": "enterprise_search-ref-id",
            "elasticsearch_cluster_ref_id": "es-ref-id",
            "region": "ece-region",
            "plan": {
              "cluster_topology": [
                {
                  "node_type": {
                    "appserver": true,
                    "connector": true,
                    "worker": true
                  },
                  "instance_configuration_id": "enterprise.search",
                  "size": {
                    "value": 0,
                    "resource": "memory"
                  },
                  "zone_count": 2
                }
              ],
              "enterprise_search": {}
            }
          }
        ]
      }
    }
}'</pre>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When specifying <code class="literal">node_roles</code> in the Elasticsearch plan of the deployment template, the template must contain all resource types and all Elasticsearch tiers.
The deployment template must contain exactly one entry for each resource type. It must have one Elasticsearch, one Kibana, one APM, and one Enterprise Search. On top of that, it must also include all supported Elasticsearch tiers in the Elasticsearch plan. The supported tiers are identified by the IDs <code class="literal">hot_content</code>, <code class="literal">warm</code>, <code class="literal">cold</code>, <code class="literal">frozen</code>, <code class="literal">master</code>, <code class="literal">coordinating</code> and <code class="literal">ml</code>.</p>
</div>
</div>
<p>After you have saved your new template, you can start <a class="xref" href="ece-create-deployment.html" title="Create a deployment">creating new deployments</a> with it.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To support deployment templates that are versioned due to a constraint on architecture that is only supported by newer versions of ECE, for example ARM instances, you must add additional configuration:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">template_category_id</code> for both template versions must be identical.
</li>
<li class="listitem">
The <code class="literal">min_version</code> attribute must be set.
</li>
</ul>
</div>
<p>These attributes are set at the same level as <code class="literal">name</code> and <code class="literal">description</code>. The UI selects the template with the highest matching <code class="literal">min_version</code> that is returned by the API.</p>
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ece-configuring-ece-instance-configurations-create.html">« Create instance configurations</a>
</span>
<span class="next">
<a href="ece-configuring-ece-configure-system-templates.html">Configure system deployment templates »</a>
</span>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>
