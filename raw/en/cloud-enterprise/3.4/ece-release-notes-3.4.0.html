<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Elastic Cloud Enterprise 3.4.0 | Elastic Cloud Enterprise Reference [3.4] | Elastic</title>
<meta class="elastic" name="content" content="Elastic Cloud Enterprise 3.4.0 | Elastic Cloud Enterprise Reference [3.4]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.4]"/>
<link rel="up" href="ece-release-notes.html" title="Release notes"/>
<link rel="prev" href="ece-release-notes-3.4.1.html" title="Elastic Cloud Enterprise 3.4.1"/>
<link rel="next" href="ece-release-notes-3.3.0.html" title="Elastic Cloud Enterprise 3.3.0"/>
<meta class="elastic" name="product_version" content="3.4"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.4"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.4"/>
</head>
<body><div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.4]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-release-notes.html">Release notes</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ece-release-notes-3.4.1.html">« Elastic Cloud Enterprise 3.4.1</a>
</span>
<span class="next">
<a href="ece-release-notes-3.3.0.html">Elastic Cloud Enterprise 3.3.0 »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-release-notes-3.4.0"></a>Elastic Cloud Enterprise 3.4.0<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-78/docs/cloud-enterprise/releases/3.4.0/index.asciidoc">edit</a></h2>
</div></div></div>
<h3><a id="ece_known_issues"></a>Known issues<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-78/docs/cloud-enterprise/releases/3.4.0/index.asciidoc">edit</a></h3>
<p>We have identified an issue with the proxy and route-server component that can lead to slow requests, timeouts, and reduced throughput.
For now, we recommend skipping this version until we have a bug fix released.
If you have already upgraded and are experiencing this issue, please <a class="xref" href="ece-getting-help.html" title="Ask for help">reach out to Elastic Support</a> for a workaround. </p>
<h3><a id="ece_release_highlights"></a>Release highlights<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-78/docs/cloud-enterprise/releases/3.4.0/index.asciidoc">edit</a></h3>
<p><span class="strong strong"><strong>Making it easier to search and replicate data across multiple deployments</strong></span>. A new user interface enables setting up remote connections to other clusters. These clusters can be of mixed deployment type, both on premises and Elastic Cloud, giving full flexibility on where to store and use your data.</p>
<p><span class="strong strong"><strong>Deprecating the Elastic Amazon Machine Images (AMIs)</strong></span>. You can no longer install Elastic Cloud Enterprise with Elastic Amazon Machine Images (AMIs). We recommend that you install ECE with <a class="xref" href="ece-configure-ansible.html" title="Alternative: Install ECE with Ansible">Ansible</a>.</p>
<p>The following changes are included in this release.</p>
<h3><a id="ece_features"></a>Features<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-78/docs/cloud-enterprise/releases/3.4.0/feature.asciidoc">edit</a></h3>
<p><span class="strong strong"><strong>Show CA certificate metadata and download button for deployment.</strong></span> Added a new feature to download a deployment&#8217;s CA certificate. This enables users to connect their self-managed and ECE deployments to Elasticsearch Service.</p>
<p><span class="strong strong"><strong>Adminconsole: enable self-monitoring on deployment creation.</strong></span> Extension to the <a href="/guide/en/cloud/current/Deployment_-_CRUD.html#create-deployment" class="ulink" target="_top">create-deployment</a> API call: the <a href="/guide/en/cloud/current/definitions.html#DeploymentObservabilitySettings" class="ulink" target="_top">observability destination</a> for logging and metrics can now be set to <code class="literal">self</code>. This enables self-monitoring on deployment creation.</p>
<p><span class="strong strong"><strong>Add <code class="literal">name</code> to account trust.</strong></span> Added a <code class="literal">name</code> property to Account Trust Relationship.</p>
<p><span class="strong strong"><strong>Add <code class="literal">also_trusted_by</code> to certificate metadata in direct trusts.</strong></span> Certificate metadata in DirectTrustRelationships now lists other deployments that also trust the certificate.</p>
<h3><a id="ece_enhancements_2"></a>Enhancements<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-78/docs/cloud-enterprise/releases/3.4.0/enhancement.asciidoc">edit</a></h3>
<p><span class="strong strong"><strong>Allow <code class="literal">csp.disableUnsafeEval</code> configuration in kibana.yml.</strong></span> Starting in Kibana 8.3, it&#8217;s possible to set the experimental <code class="literal">csp.disableUnsafeEval</code> configuration option. Set this to <code class="literal">true</code> to remove the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src#unsafe_eval_expressions" class="ulink" target="_top"><code class="literal">unsafe-eval</code></a> source expression from the <code class="literal">script-src</code> Content Security Policy (CSP) directive. The default value is <code class="literal">false</code>, which is identical to the original Kibana behavior.</p>
<p>By enabling <code class="literal">csp.disableUnsafeEval</code>, Kibana will use a custom version of the Handlebars template library which doesn&#8217;t support <a href="https://handlebarsjs.com/guide/partials.html#inline-partials" class="ulink" target="_top">inline partials</a>. Handlebars is used in various locations in the Kibana frontend where custom templates can be supplied by the user when for instance setting up a visualization. If you experience any issues rendering Handlebars templates after turning on <code class="literal">csp.disableUnsafeEval</code>, or if you rely on inline partials, please revert this setting to <code class="literal">false</code> and <a href="https://github.com/elastic/kibana/issues/new/choose" class="ulink" target="_top">open an issue</a> in the Kibana GitHub repository.</p>
<p><span class="strong strong"><strong>Virtualize the code block to improve performance.</strong></span> API Console output is now virtualized (only visible parts will be loaded at a given time to improve performance).</p>
<p><span class="strong strong"><strong>Enable vacates with closed indices for Elasticsearch versions prior to 7.2.</strong></span> Added the option to vacate nodes that are part of clusters containing closed indices, for Elasticsearch versions prior to 7.2.0.</p>
<p><span class="strong strong"><strong>Added version mismatch UI.</strong></span> If an upgrade fails, users will now be directed to complete that upgrade before doing anything else with the deployment, as other actions would likely have failed.</p>
<p><span class="strong strong"><strong>Set the default HTTPS port to 443 for production environments.</strong></span> Set the default port for Elasticsearch endpoints displayed in the ESS Cloud UI/API to 443 (the default HTTPS port). Port 9243 will continue to route as expected.</p>
<p><span class="strong strong"><strong>Log request bodies to the Adminconsole API log.</strong></span> Log requests payloads as part of the requests entries in the Adminconsole log. These are redacted using the API model privacy tags. Additionally, all proxied requests (<code class="literal">deployments/&lt;id&gt;/type/resource/&lt;proxied_route&gt;</code>) are considered secrets due to being prone to leak secrets and sensitive pieces of information.</p>
<p><span class="strong strong"><strong>Renamed <code class="literal">upstream</code> to <code class="literal">backend</code>.</strong></span> Renamed <code class="literal">upstream_proto</code> in the proxy logs to <code class="literal">backend_proto</code> to maintain consistency with other proxy log fields relating to the connection between the proxy and the stack components. Renamed <code class="literal">upstream_dialer</code> to <code class="literal">backend_dialer</code> for same reason.</p>
<p><span class="strong strong"><strong>Changed the verbiage for frozen nodes and the cache storage.</strong></span> Changed the wording on frozen instances when displaying how much of the blob storage is full, based on the disk storage.</p>
<p><span class="strong strong"><strong>Added description, size and last modified to the table for extensions.</strong></span> Added 3 new fields to the table showing your extensions. The table now lists the description field, the size of the extension, and the last time it was modified.</p>
<p><span class="strong strong"><strong>New <code class="literal">migrations.discardCorruptObjects</code> Kibana setting.</strong></span> When upgrading the Elastic Stack, Kibana runs a migration process to ensure system indices are up-to-date with the newer version. Sometimes, migrations might fail due to data inconsistencies. For instance, if corrupt objects exist or transform errors occur during a migration, this will cause the migration to fail.</p>
<p>This version adds support for the new <code class="literal">migrations.discardCorruptObjects</code> flag. This flag tells Kibana to discard corrupt saved objects that can be found during a migration, as well as transform errors, logging a warning message and carrying on with the migration process.</p>
<p>Note that this flag must be set to the target version, that is, the version to which the Elastic Stack is being upgraded. For instance, if you are upgrading to 8.4.0, you must set <code class="literal">migrations.discardCorruptObjects: "8.4.0"</code> in order for the flag to be taken into account. This is a safeguard that prevents Kibana to systematically ignore / discard unknown objects in future migrations, in case users forget to disable the flag after a migration.</p>
<p><span class="strong strong"><strong>New <code class="literal">migrations.discardUnknownObjects</code> Kibana setting.</strong></span> When upgrading the Elastic Stack, Kibana runs a migration process to ensure system indices are up-to-date with the newer version. Sometimes, migrations might fail due to data inconsistencies. For instance, if saved objects exist which have unknown types, this will cause the migration to fail.</p>
<p>This version adds support for the new <code class="literal">migrations.discardUnknownObjects</code> flag. This flag tells Kibana to discard unknown saved objects that can be found during a migration, logging a warning message and carrying on with the migration process.</p>
<p>Note that this flag must be set to the target version, that is, the version to which the Elastic Stack is being upgraded. For instance, if you are upgrading to 8.4.0, you must set <code class="literal">migrations.discardUnknownObjects: "8.4.0"</code> in order for the flag to be taken into account. This is a safeguard that prevents Kibana to systematically ignore / discard unknown objects in future migrations, in case users forget to disable the flag after a migration.</p>
<p><span class="strong strong"><strong>Allow proxy to establish TLSv1.3 connections with willing clients.</strong></span> Enable TLS v1.3 on the proxies. Note, establishing TLS v1.2 connections is still possible and not going away for now; this is an extra option for clients that support TLS v1.3.</p>
<p><span class="strong strong"><strong>Added a Deployment Id section to the new header.</strong></span> Added a more prominent and copyable location for the Deployment Id in the header of a deployment.</p>
<p><span class="strong strong"><strong>Allow <code class="literal">http.connection_pool_ttl</code> for OIDC realms.</strong></span> Allow user override of the new <a href="/guide/en/elasticsearch/reference/master/security-settings.html#ref-oidc-settings" class="ulink" target="_top"><code class="literal">http.connection_pool_ttl</code></a> setting for OIDC realms.</p>
<p><span class="strong strong"><strong>Move settings to plan level.</strong></span> The <code class="literal">enabled_built_in_plugins</code>, <code class="literal">user_plugins</code>, and <code class="literal">user_bundles</code> configuration entries will be moved from the <code class="literal">cluster_topology</code> level to the <code class="literal">plan</code> level when a plan change occurs through the UI.</p>
<p><span class="strong strong"><strong>Override clear upgrade version.</strong></span> Users can now clear administrator set user setting overrides without having to file a support ticket during the version upgrade process.</p>
<p><span class="strong strong"><strong>Bump Beats version to 7.17.5.</strong></span> Upgraded Filebeat and Metricbeat, used to ingest logs and metrics in ECE, to 7.17.5.</p>
<p><span class="strong strong"><strong>Allow users to clear override settings on the Edit page.</strong></span> Users are now able to clear administrator set user setting overrides without needing to file a support ticket. Go to the <span class="strong strong"><strong>Edit</strong></span> page of your deployment and if an override is set, select the <span class="strong strong"><strong>Clear overrides</strong></span> button.</p>
<p><span class="strong strong"><strong>Expose <code class="literal">deployment.autoscaling_enabled</code> fields in the API models.</strong></span> Introduce <code class="literal">autoscaling_enabled</code> at the deployment level. This will be consistent with the <code class="literal">autoscaling_enabled</code> field on the Elasticsearch resource. In the future, this value will also be used to enable autoscaling on other resources within a deployment.</p>
<p><span class="strong strong"><strong>Log Initial Data Step added to all flows.</strong></span> This change adds a new step named <span class="strong strong"><strong>Log Initial Data</strong></span> to the UI, which displays <code class="literal">cluster_id</code>, <code class="literal">plan_id</code> and <code class="literal">constructor</code> for all flows. An earlier change displayed this info, but this step was only applicable to the modification/edit flow. With this change, <code class="literal">cluster_id</code>, <code class="literal">plan_id</code> and <code class="literal">constructor</code> will be displayed for all flows.</p>
<h3><a id="ece_bug_fixes"></a>Bug fixes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-78/docs/cloud-enterprise/releases/3.4.0/bug.asciidoc">edit</a></h3>
<p><span class="strong strong"><strong>Instance capacity overrides are enforced for Elasticsearch heap when reset.</strong></span> Fixes the problem when instance overrides are reset through a next plan change, but the Elasticsearch heap settings remain unchanged.</p>
<p><span class="strong strong"><strong>Allocators API: Obey parameters in allocator listing requests when no filter are passed.</strong></span> Allocator listings now obey size, order and paging parameters, even when search criteria are not passed. This protects against huge responses when sizing limits are ignored.</p>
<p><span class="strong strong"><strong>Add check for <code class="literal">haproxy</code> configs in Docker health check.</strong></span> Add verification of <code class="literal">haproxy</code> config files to Docker <code class="literal">/healthcheck</code>. This should alert us if an invalid config is written to the disk, but an existing <code class="literal">haproxy</code> continues to run.</p>
<p><span class="strong strong"><strong>TermQuery.value is not an object type.</strong></span> Updates the swagger type of <code class="literal">TermQuery.value</code> to <code class="literal">String</code>. This should accept a combination of <code class="literal">string | number | boolean</code>. However, a framework limitation precludes supporting combination types in our swagger definition.</p>
<p><span class="strong strong"><strong>Don&#8217;t send payload on console API if strings are empty.</strong></span> Fixes a bug where <code class="literal">content-type</code> was being sent when no body existed.</p>
<p><span class="strong strong"><strong>Revert "Cluster ids are always in a should clause, regionId is a must".</strong></span> Fixes an issue where trusting more than one specific deployment would lead to those deployments being listed as <code class="literal">(deleted)</code> in the deployment trust UI.</p>
<p><span class="strong strong"><strong>Enterprise Search template rendering.</strong></span> The Enterprise Search section of templates in ECE should now render correctly in the UI.</p>
<p><span class="strong strong"><strong>Upgrade issues when deleting Elastic Stack versions.</strong></span> Fixes a bug where ECE users delete an Elastic Stack version, and any deployment on that version cannot be upgraded through the UI.</p>
<p><span class="strong strong"><strong>Re-enable monitoring cleaner service.</strong></span> Fixes monitoring indices not being cleaned up regularly.</p>
<p>When using the <a href="/guide/en/cloud-enterprise/current/ece-enable-logging-and-monitoring.html" class="ulink" target="_top">logging and monitoring feature</a>, monitoring data is supposed to be removed after a retention period (default: 3 days). A bug led to the data being stored indefinitely. The monitoring indices are now cleaned up correctly after the configured retention period.</p>
<p><span class="strong strong"><strong>Don&#8217;t rebuild the topology element when configuring <code class="literal">autoscaling_min</code>.</strong></span> Fixes an issue preventing users from updating the maximum size of ML tiers.</p>
<p><span class="strong strong"><strong>Added fields to APM allow list.</strong></span> Adds the following settings to the APM allow list:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">xpack.apm.maxServiceSelection</code> (v7.13 - v7.16)
</li>
<li class="listitem">
<code class="literal">xpack.apm.maxSuggestions</code> (v7.16)
</li>
</ul>
</div>
<h3><a id="ece_breaking_changes"></a>Breaking changes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-78/docs/cloud-enterprise/releases/3.4.0/breaking.asciidoc">edit</a></h3>
<p><span class="strong strong"><strong>LDAP/AD bind credentials validation.</strong></span> With Elasticsearch LDAP and Active Directory security realms, users will no longer be able to set the bind DN field without setting a secure bind password. To make sure ECE can successfully upgrade its security cluster, ECE now validates that all existing LDAP and Active Directory Authentication Providers do not have a Bind DN field without a matching password, and will block the upgrade if they do. The ECE LDAP and Active Directory configuration APIs will now return a <span class="strong strong"><strong>400 Bad Request Error</strong></span> if users try to set the <code class="literal">bind_dn</code> field without a <code class="literal">bind_password</code>.</p>
<h3><a id="ece_deprecations"></a>Deprecations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-78/docs/cloud-enterprise/releases/3.4.0/deprecation.asciidoc">edit</a></h3>
<p><span class="strong strong"><strong>Remove legacy cipher suite from aws eu-west-1.</strong></span> Updated aws eu-west-1 region cipher suites to intermediate ciphers + Windows 11 client compatible cipher suites.</p>
<p><span class="strong strong"><strong>Remove Adminconsole from <code class="literal">haproxy</code> backend.</strong></span> Removed inbound port 12344 that used to allow internal components of ECE to connect to Admin API, aligned with <a href="/guide/en/cloud-enterprise/current/ece-networking-prereq.html#ece-networking-prereq" class="ulink" target="_top">Networking prerequisites</a>.</p>
<p><span class="strong strong"><strong>Set maximum version for <code class="literal">xpack.apm.maxServiceEnvironments</code>.</strong></span> <code class="literal">xpack.apm.maxServiceEnvironments</code> has been deprecated in <code class="literal">8.0.0</code>.
The setting has been replaced by <code class="literal">maxSuggestions</code> which can be configured in Kibana&#8217;s Advanced Settings.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ece-release-notes-3.4.1.html">« Elastic Cloud Enterprise 3.4.1</a>
</span>
<span class="next">
<a href="ece-release-notes-3.3.0.html">Elastic Cloud Enterprise 3.3.0 »</a>
</span>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>
