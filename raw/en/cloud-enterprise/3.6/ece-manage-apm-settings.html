<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Add APM user settings | Elastic Cloud Enterprise Reference [3.6] | Elastic</title>
<meta class="elastic" name="content" content="Add APM user settings | Elastic Cloud Enterprise Reference [3.6]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.6]"/>
<link rel="up" href="editing-user-settings.html" title="Editing your user settings"/>
<link rel="prev" href="ece-manage-kibana-settings.html" title="Add Kibana user settings"/>
<link rel="next" href="ece-manage-appsearch-settings.html" title="Add App Search user settings"/>
<meta class="elastic" name="product_version" content="3.6"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.6"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.6"/>
</head>
<body>
<div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="ece-manage-kibana-settings.html">« Add Kibana user settings</a>
</span>
<span class="next">
<a href="ece-manage-appsearch-settings.html">Add App Search user settings »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.6]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-administering-deployments.html">Administering deployments</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="editing-user-settings.html">Editing your user settings</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Add APM user settings</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-92/docs/cloud-enterprise/ce-add-apm-settings.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-manage-apm-settings"></a>Add APM user settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-92/docs/cloud-enterprise/ce-add-apm-settings.asciidoc">edit</a></h2>
</div></div></div>
<p>Starting in Elastic Stack version 8.0, how you change APM settings and the settings that are available to you
depend on how you spin up Elastic APM. There are two modes:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Fleet-managed APM integration
</span>
</dt>
<dd>
<p>
New deployments created in Elastic Stack version 8.0 and later will be managed by Fleet.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This mode requires SSL/TLS configuration. Check <a class="xref" href="ece-manage-apm-settings.html#ece-edit-apm-fleet-tls" title="TLS configuration for Fleet-managed mode">TLS configuration for Fleet-managed mode</a> for details.
</li>
<li class="listitem">
Check <a href="/guide/en/apm/guide/8.15/input-apm.html" class="ulink" target="_top">APM integration input settings</a> for all other Elastic APM configuration options in this mode.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Standalone APM Server (legacy)
</span>
</dt>
<dd>
<p>
Deployments created prior to Elastic Stack version 8.0 are in legacy mode.
Upgrading to or past Elastic Stack 8.0 does not remove you from legacy mode.
</p>
<p>Check <a class="xref" href="ece-manage-apm-settings.html#ece-edit-apm-standalone-settings-ece" title="Edit standalone APM settings (legacy)">Edit standalone APM settings (legacy)</a>for information on how to configure Elastic APM in this mode.</p>
</dd>
</dl>
</div>
<p>To learn more about the differences between these modes, or to switch from Standalone APM Server (legacy) mode to Fleet-managed,
check <a href="/guide/en/apm/guide/8.15/upgrade-to-apm-integration.html" class="ulink" target="_top">Switch to the Elastic APM integration</a>.</p>
<h4><a id="ece-edit-apm-fleet-tls"></a>TLS configuration for Fleet-managed mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-92/docs/cloud-enterprise/ce-add-apm-settings.asciidoc">edit</a></h4>
<p>Users running Elastic Stack versions 7.16 or 7.17 need to manually configure TLS.
This step is not necessary for Elastic Stack versions ≥ 8.0.</p>
<p>Pick one of the following options:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Upload and configure a publicly signed Elasticsearch TLS certificates. Check <a href="/guide/en/fleet/8.15/secure-connections.html" class="ulink" target="_top">Encrypt traffic in clusters with a self-managed Fleet Server</a> for details.
</li>
<li class="listitem">
Change the Elasticsearch hosts where Elastic Agents send data from the default public URL, to the internal URL.
In Kibana, navigate to <span class="strong strong"><strong>Fleet</strong></span> and select the <span class="strong strong"><strong>Elastic Cloud agent policy</strong></span>. Click <span class="strong strong"><strong>Fleet settings</strong></span> and update the Elasticsearch hosts URL.
For example, if the current URL is <code class="literal">https://123abc.us-central1.gcp.foundit.no:9244</code>, change it to <code class="literal">http://123abc.containerhost:9244</code>.
</li>
</ol>
</div>
<h4><a id="ece-edit-apm-standalone-settings-ece"></a>Edit standalone APM settings (legacy)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-92/docs/cloud-enterprise/ce-add-apm-settings.asciidoc">edit</a></h4>
<p>Elastic Cloud Enterprise supports most of the legacy APM settings. Through a YAML editor in the console, you can append your APM Server properties to the <code class="literal">apm-server.yml</code> file. Your changes to the configuration file are read on startup.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Be aware that some settings could break your cluster if set incorrectly and that the syntax might change between major versions. Before upgrading, be sure to review the full list of the <a href="/guide/en/apm/guide/8.15/configuring-howto-apm-server.html" class="ulink" target="_top">latest APM settings and syntax</a>.</p>
</div>
</div>
<p>To change APM settings:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>Deployments</strong></span> page, select your deployment.</p>
<p>Narrow the list by name, ID, or choose from several other filters. To further define the list, use a combination of filters.</p>
</li>
<li class="listitem">
From your deployment menu, go to the <span class="strong strong"><strong>Edit</strong></span> page.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>APM</strong></span> section, select <span class="strong strong"><strong>Edit user settings</strong></span>. (For existing deployments with user settings, you may have to expand the <span class="strong strong"><strong>Edit apm-server.yml</strong></span> caret instead.)
</li>
<li class="listitem">
Update the user settings.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Save changes</strong></span>.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a setting is not supported by Elastic Cloud Enterprise, you get an error message when you try to save. We suggest changing one setting with each save, so you know which one is not supported.</p>
</div>
</div>
<h4><a id="ece_example_enable_rum_and_increase_the_rate_limit_legacy"></a>Example: Enable RUM and increase the rate limit (legacy)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-92/docs/cloud-enterprise/ce-add-apm-settings.asciidoc">edit</a></h4>
<p>When capturing the user interaction with clients with real user monitoring (RUM), particularly for situations with concurrent clients, you can increase the number of times each IP address can send a request to the RUM endpoint. Version 6.5 includes an additional settings for the LRU cache.</p>
<p>For APM Server version 6.5 and later with RUM agent version 2.x or 3.x:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server:
  rum:
    enabled: true
    event rate:
      limit: 3000
      lru_size: 5000</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>With the version 6.5 release, we recommend verifying that your agents continue to be <a href="/guide/en/apm/guide/8.15/agent-server-compatibility.html" class="ulink" target="_top">compatible with your APM Server</a>.</p>
</div>
</div>
<p>For APM Server version 6.4 or 6.3 with RUM agent version 0.x or 1.x:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server:
  rum:
    enabled: true
    rate_limit: 100</pre>
</div>
<h4><a id="ece_example_disable_rum_legacy"></a>Example: Disable RUM (legacy)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-92/docs/cloud-enterprise/ce-add-apm-settings.asciidoc">edit</a></h4>
<p>If you know that you won&#8217;t be tracking RUM data, you can disable the endpoint proactively.</p>
<p>For APM Server version 6.4 and later:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server:
  rum:
    enabled: false</pre>
</div>
<h4><a id="ece_example_adjust_the_event_limits_configuration_legacy"></a>Example: Adjust the event limits configuration (legacy)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-92/docs/cloud-enterprise/ce-add-apm-settings.asciidoc">edit</a></h4>
<p>If the size of the HTTP request frequently exceeds the maximum, you might need to change the limit on the APM Server and adjust the relevant settings in the agent.</p>
<p>For APM Server version 6.5 and later:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server:
  max_event_size: 407200</pre>
</div>
<h4><a id="ece_logging_settings_legacy"></a>Logging settings (legacy)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-92/docs/cloud-enterprise/ce-add-apm-settings.asciidoc">edit</a></h4>
<p>Examples of APM logging settings:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">logging.level</code>
</span>
</dt>
<dd>
Specifies the minimum log level. One of <em>debug</em>, <em>info</em>, <em>warning</em>, or <em>error</em>. Defaults to <em>info</em>.
</dd>
<dt>
<span class="term">
<code class="literal">logging.selectors</code>
</span>
</dt>
<dd>
The list of debugging-only selector tags used by different APM Server components. Use <em>*</em> to enable debug output for all components. For example, add <em>publish</em> to display all the debug messages related to event publishing.
</dd>
<dt>
<span class="term">
<code class="literal">logging.metrics.enabled</code>
</span>
</dt>
<dd>
If enabled, APM Server periodically logs its internal metrics that have changed in the last period. Defaults to <em>true</em>.
</dd>
<dt>
<span class="term">
<code class="literal">logging.metrics.period</code>
</span>
</dt>
<dd>
The period after which to log the internal metrics. Defaults to <em>30s</em>.
</dd>
</dl>
</div>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</div><div class="navfooter">
<span class="prev">
<a href="ece-manage-kibana-settings.html">« Add Kibana user settings</a>
</span>
<span class="next">
<a href="ece-manage-appsearch-settings.html">Add App Search user settings »</a>
</span>
</div>
</body>
</html>
