<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Change allocator disconnect timeout | Elastic Cloud Enterprise Reference [3.7] | Elastic</title>
<meta class="elastic" name="content" content="Change allocator disconnect timeout | Elastic Cloud Enterprise Reference [3.7]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.7]"/>
<link rel="up" href="ece-configuring-ece.html" title="Configuring your installation"/>
<link rel="prev" href="ece-configuring-allocator-affinity.html" title="Configure allocator affinity"/>
<link rel="next" href="ece-securing-ece.html" title="Securing your installation"/>
<meta class="elastic" name="product_version" content="3.7"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.7"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.7"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.7]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-configuring-ece.html">Configuring your installation</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ece-configuring-allocator-affinity.html">« Configure allocator affinity</a>
</span>
<span class="next">
<a href="ece-securing-ece.html">Securing your installation »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-change-allocator-disconnect-timeout"></a>Change allocator disconnect timeout<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-change-allocator-disconnect-timeout.asciidoc">edit</a></h2>
</div></div></div>
<p>One of the responsibilities of the allocator is to monitor the health of the clusters running on it. It periodically healthcheck the instances and report their health to other components. The platform uses this information to route traffic to healthy instances and to avoid unhealthy ones. The healthstatus is stored in zookeeper.</p>
<p>By default, the platform will wait 10 minutes before considering a particular instance unhealthy.</p>
<p>While the 10 minutes timeout is long, this is based on the assumption that a short-lived zookeeper disconnect it more likely than a disconnected allocator, and that the allocator will reconnect shortly. In the meantime the workloads running on the allocator are healthy and can be accessed. This assumption may not hold for your use case, e.g., your allocators are frequently restarted.</p>
<p>The timeout can be changed by running the following script. Use the <code class="literal">TIMEOUT_MINUTES</code> to set a different timeout. At least 2 minutes is recommended, to avoid false positives in case of allocator container restarts.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The new timeout will apply only to new instances that are added to the allocator. The existing instances will continue running on the old timeout until they are disconnected for longer that the old timeout, or migrated.</p>
</div>
</div>
<p>To change the timeout value:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On a host that holds the director role:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run \
-v ~/.found-shell:/elastic_cloud_apps/shell/.found-shell \
--env SHELL_ZK_AUTH=$(docker exec -it frc-directors-director bash -c 'echo -n $FOUND_ZK_READWRITE') $(docker inspect -f '{{ range .HostConfig.ExtraHosts }} --add-host {{.}} {{ end }}' frc-directors-director)  \
--env FOUND_SCRIPT=setAllocatorTTL.sc \
--env TIMEOUT_MINUTES=2 \
--rm -it \
$(docker inspect -f '{{ .Config.Image }}' frc-directors-director) \
/elastic_cloud_apps/shell/run-shell.sh</pre>
</div>
</li>
<li class="listitem">
<p>On all the allocator hosts:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker rm -f frc-allocators-allocator</pre>
</div>
</li>
</ol>
</div>
<p>To reset back to the default.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On a host that holds the director role:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run \
-v ~/.found-shell:/elastic_cloud_apps/shell/.found-shell \
--env SHELL_ZK_AUTH=$(docker exec -it frc-directors-director bash -c 'echo -n $FOUND_ZK_READWRITE') $(docker inspect -f '{{ range .HostConfig.ExtraHosts }} --add-host {{.}} {{ end }}' frc-directors-director)  \
--env FOUND_SCRIPT=resetAllocatorTTL.sc \
--rm -it \
$(docker inspect -f '{{ .Config.Image }}' frc-directors-director) \
/elastic_cloud_apps/shell/run-shell.sh</pre>
</div>
</li>
<li class="listitem">
<p>On all the allocator hosts:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker rm -f frc-allocators-allocator</pre>
</div>
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ece-configuring-allocator-affinity.html">« Configure allocator affinity</a>
</span>
<span class="next">
<a href="ece-securing-ece.html">Securing your installation »</a>
</span>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>
