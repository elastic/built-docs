<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Enable maintenance mode | Elastic Cloud Enterprise Reference [3.7] | Elastic</title>
<meta class="elastic" name="content" content="Enable maintenance mode | Elastic Cloud Enterprise Reference [3.7]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.7]"/>
<link rel="up" href="ece-administering-ece.html" title="Administering your installation"/>
<link rel="prev" href="ece-change-roles.html" title="Assign roles to hosts"/>
<link rel="next" href="ece-move-nodes.html" title="Move nodes or instances from allocators"/>
<meta class="elastic" name="product_version" content="3.7"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.7"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.7"/>
</head>
<body>
<div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="ece-change-roles.html">« Assign roles to hosts</a>
</span>
<span class="next">
<a href="ece-move-nodes.html">Move nodes or instances from allocators »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.7]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-administering-ece.html">Administering your installation</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Enable maintenance mode</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-administering-ece.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="ece-maintenance-mode"></a>Enable maintenance mode</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-administering-ece.asciidoc">edit</a></div>
</div></div></div>
<p>Maintenance mode lets you perform actions on an allocator safely that might otherwise carry some risk. For example, if you want to remove the allocator role from a host, enabling maintenance mode prevents new Elasticsearch clusters and Kibana instances from being provisioned on the allocator whilst you are moving the existing nodes to another allocator or whilst you are removing the role.</p>
<p>To put an allocator into maintenance mode:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Platform</strong></span> menu, select <span class="strong strong"><strong>Allocators</strong></span>.
</li>
<li class="listitem">
<p>Choose the allocator you want to work with and select <span class="strong strong"><strong>Enable Maintenance Mode</strong></span>. Confirm the action.</p>
<p>Narrow the list by name, ID, or choose from several other filters. To further define the list, use a combination of filters.</p>
</li>
</ol>
</div>
<p>After the allocator enters maintenance mode, no new Elasticsearch nodes or Kibana instances will be started on the allocator. Existing nodes will continue to work as expected. You can now safely perform actions like <a class="xref" href="ece-move-nodes.html" title="Move nodes or instances from allocators">moving nodes off the allocator</a>.</p>
<p>If you want to make the allocator fully active again, select <span class="strong strong"><strong>Disable Maintenance Mode</strong></span>. Confirm the action.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you need the existing instances to stop routing requests you can <a class="xref" href="ece-maintenance-mode-deployments.html" title="Maintenance mode">stop routing requests</a> to disable incoming requests to particular instances. You can also massively disable all allocator instances routing with the <a href="https://download.elastic.co/cloud/allocator-toggle-routing-requests.sh" class="ulink" target="_top">allocator-toggle-routing-requests.sh</a> script. The script runs with the following parameters in the form environment variables:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">API_URL</code> Url of the administration API.
</li>
<li class="listitem">
<code class="literal">AUTH_HEADER</code> Curl format string representing the authentication header.
</li>
<li class="listitem">
<code class="literal">ALLOCATOR_ID</code> Action target allocator id.
</li>
<li class="listitem">
<code class="literal">ENABLE_TRAFFIC</code> Wether traffic to the selected allocator instances should be enabled (<code class="literal">true</code>) or disabled (<code class="literal">false</code>).
</li>
</ul>
</div>
<p>This is an example of script execution to disable routing on all instances running on a given allocator:
In this example the script disables routing on all instances running on a given allocator:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">AUTH_HEADER="Authorization: ApiKey $(cat ~/api.key)" API_URL="https://adminconsole:12443" ALLOCATOR_ID="192.168.44.10" ENABLE_TRAFFIC=false ./allocator-toggle-routing-requests.sh</pre>
</div>
<p>The same script can be used to enable traffic again:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">AUTH_HEADER="Authorization: ApiKey $(cat ~/api.key)" API_URL="https://adminconsole:12443" ALLOCATOR_ID="192.168.44.10" ENABLE_TRAFFIC=true ./allocator-toggle-routing-requests.sh</pre>
</div>
</div>
</div>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</div><div class="navfooter">
<span class="prev">
<a href="ece-change-roles.html">« Assign roles to hosts</a>
</span>
<span class="next">
<a href="ece-move-nodes.html">Move nodes or instances from allocators »</a>
</span>
</div>
</body>
</html>
