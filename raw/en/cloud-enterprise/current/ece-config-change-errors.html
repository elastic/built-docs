<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>How do I resolve node bootlooping? | Elastic Cloud Enterprise Reference [3.8] | Elastic</title>
<meta class="elastic" name="content" content="How do I resolve node bootlooping? | Elastic Cloud Enterprise Reference [3.8]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.8]"/>
<link rel="up" href="ece-monitoring-deployments.html" title="Keep your clusters healthy"/>
<link rel="prev" href="ece-deployment-no-op.html" title="How do I resolve deployment health warnings?"/>
<link rel="next" href="ece-activity-page.html" title="Keep track of deployment activity"/>
<meta class="elastic" name="product_version" content="3.8"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.8"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.8"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="ece-deployment-no-op.html">« How do I resolve deployment health warnings?</a>
</span>
<span class="next">
<a href="ece-activity-page.html">Keep track of deployment activity »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.8]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-administering-deployments.html">Administering deployments</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-monitoring-deployments.html">Keep your clusters healthy</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>How do I resolve node bootlooping?</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/troubleshoot/deployments/cloud-enterprise/node-bootlooping">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="ece-config-change-errors"></a>How do I resolve node bootlooping?</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
</div></div></div>
<p>When you attempt to apply a configuration change to a deployment, the attempt may fail with an error indicating that the change could not be applied, and deployment resources may be unable to restart. In some cases, bootlooping may result, where the deployment resources cycle through a continual reboot process.</p>
<div class="imageblock">
<div class="content">
<img src="images/ec-ce-configuration-change-failure.png" alt="A screen capture of the deployment page showing an error: Latest change to Elasticsearch configuration failed.">
</div>
</div>
<p>To confirm if your Elasticsearch cluster is bootlooping, you can check the most recent plan under your <a class="xref" href="ece-activity-page.html" title="Keep track of deployment activity">Deployment Activity page</a> for the error:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">Plan change failed: Some instances were unable to start properly.</pre>
</div>
<p>If this occurs, correlating Elasticsearch logs should report:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">fatal exception while booting Elasticsearch</pre>
</div>
<p>Following are some frequent causes of a failed configuration change:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ece-config-change-errors.html#ece-config-change-errors-secure-settings" title="Secure settings">Secure settings</a>
</li>
<li class="listitem">
<a class="xref" href="ece-config-change-errors.html#ece-config-change-errors-expired-bundle-extension" title="Expired custom plugins or bundles">Expired custom plugins or bundles</a>
</li>
<li class="listitem">
<a class="xref" href="ece-config-change-errors.html#ece-config-change-errors-oom-errors" title="OOM errors">OOM errors</a>
</li>
<li class="listitem">
<a class="xref" href="ece-config-change-errors.html#ece-config-change-errors-existing-index" title="Existing index">Existing index</a>
</li>
<li class="listitem">
<a class="xref" href="ece-config-change-errors.html#ece-config-change-errors-insufficient-storage" title="Insufficient Storage">Insufficient Storage</a>
</li>
</ol>
</div>
<p>If you&#8217;re unable to remediate the failing plan&#8217;s root cause, you can attempt to reset the deployment to the latest successful Elasticsearch configuration by performing a <a class="xref" href="ece-deployment-no-op.html" title="How do I resolve deployment health warnings?">no-op plan</a>. For an example, see this <a href="https://www.youtube.com/watch?v=8MnXZ9egBbQ" class="ulink" target="_top">video walkthrough</a>.</p>
<div class="position-relative"><h3><a id="ece-config-change-errors-secure-settings"></a>Secure settings</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>The most frequent cause of a failed deployment configuration change is due to invalid or mislocated <a class="xref" href="ece-configuring-keystore.html" title="Secure your settings">secure settings</a>. This can frequently be discovered by searching Elasticsearch logs for one of the following error messages:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">IllegalStateException: security initialization failed
java.lang.IllegalArgumentException: unknown secure setting</pre>
</div>
<p>The keystore allows you to safely store sensitive settings, such as passwords, as a key/value pair. You can then access a secret value from a settings file by referencing its key. Importantly, not all settings can be stored in the keystore, and the keystore does not validate the settings that you add. Adding unsupported settings can cause Elasticsearch or other components to fail to restart. To check whether a setting is supported in the keystore, look for a "Secure" qualifier in the <a href="/guide/en/elasticsearch/reference/8.18/secure-settings.html" class="ulink" target="_top">lists of reloadable settings</a>.</p>
<p>The following sections detail some secure settings problems that can result in a configuration change error that can prevent a deployment from restarting. You might diagnose these plan failures via the logs or via their <a href="/guide/en/elasticsearch/reference/8.18/stopping-elasticsearch.html#fatal-errors" class="ulink" target="_top">related exit codes</a> <code class="literal">1</code>, <code class="literal">3</code>, and <code class="literal">78</code>.</p>
<div class="position-relative"><h4><a id="ece-config-change-errors-old-values"></a>Invalid or outdated values</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>The keystore does not validate any settings that you add, so invalid or outdated values are a common source of errors when you apply a configuration change to a deployment.</p>
<p>To check the current set of stored settings:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the deployment <span class="strong strong"><strong>Security</strong></span> page.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Elasticsearch keystore</strong></span> section, check the <span class="strong strong"><strong>Security keys</strong></span> list. The list is shown only if you currently have settings configured in the keystore.
</li>
</ol>
</div>
<p>One frequent cause of errors is when settings in the keystore are no longer valid, such as when SAML settings are added for a test environment, but the settings are either not carried over or no longer valid in a production environment.</p>
<div class="position-relative"><h4><a id="ece-config-change-errors-snapshot-repos"></a>Snapshot repositories</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>Sometimes, settings added to the keystore to connect to a snapshot repository may not be valid. When this happens, you may get an error such as <code class="literal">SettingsException[Neither a secret key nor a shared access token was set.]</code></p>
<p>For example, when adding an <a href="/guide/en/elasticsearch/reference/8.18/repository-azure.html#repository-azure-usage" class="ulink" target="_top">Azure repository storage setting</a> such as <code class="literal">azure.client.default.account</code> to the keystore, the associated setting <code class="literal">azure.client.default.key</code> must also be added for the configuration to be valid.</p>
<div class="position-relative"><h4><a id="ece-config-change-errors-third-party-auth"></a>Third-party authentication</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>When you configure third-party authentication, it&#8217;s important that all required configuration elements that are stored in the keystore are included in the Elasticsearch user settings file. For example, when you <a href="/guide/en/elasticsearch/reference/8.18/saml-guide-stack.html#saml-create-realm" class="ulink" target="_top">create a SAML realm</a>, omitting a field such as <code class="literal">idp.entity_id</code> when that setting is present in the keystore results in a failed configuration change.</p>
<div class="position-relative"><h4><a id="ece-config-change-errors-wrong-location"></a>Wrong location</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>In some cases, settings may accidentally be added to the keystore that should have been added to the <a class="xref" href="ece-add-user-settings.html" title="Add Elasticsearch user settings">Elasticsearch user settings file</a>. It&#8217;s always a good idea to check the <a href="/guide/en/elasticsearch/reference/8.18/secure-settings.html" class="ulink" target="_top">lists of reloadable settings</a> to determine if a setting can be stored in the keystore. Settings that can safely be added to the keystore are flagged as <code class="literal">Secure</code>.</p>
<div class="position-relative"><h3><a id="ece-config-change-errors-expired-bundle-extension"></a>Expired custom plugins or bundles</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>During the process of applying a configuration change, Elastic Cloud Enterprise checks to determine if any <a class="xref" href="ece-add-custom-bundle-plugin.html" title="Add custom bundles and plugins to your deployment">uploaded custom plugins or bundles</a> are expired.</p>
<p>Problematic plugins produce oscillating Elasticsearch start-up logs like the following:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">Booting at Sun Sep 4 03:06:43 UTC 2022
Installing user plugins.
Installing elasticsearch-analysis-izumo-master-7.10.2-20210618-28f8a97...
/app/elasticsearch.sh: line 169: [: too many arguments
Booting at Sun Sep 4 03:06:58 UTC 2022
Installing user plugins.
Installing elasticsearch-analysis-izumo-master-7.10.2-20210618-28f8a97...
/app/elasticsearch.sh: line 169: [: too many arguments</pre>
</div>
<p>Problematic bundles produce similar oscillations but their install log would appear like</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">2024-11-17 15:18:02   https://found-user-plugins.s3.amazonaws.com/XXXXX/XXXXX.zip?response-content-disposition=attachment%3Bfilename%XXXXX%2F4007535947.zip&amp;x-elastic-extension-version=1574194077471&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Date=20241016T133214Z&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Expires=86400&amp;XAmz-Credential=XXXXX%2F20201016%2Fus-east-1%2Fs3%2Faws4_request&amp;X-AmzSignature=XXXXX</pre>
</div>
<p>Noting in example that the bundle&#8217;s expiration <code class="literal">X-Amz-Date=20241016T133214Z</code> is before than the log timestamp <code class="literal">2024-11-17 15:18:02</code> so this bundle is considered expired.</p>
<p>To view any added plugins or bundles:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the <span class="strong strong"><strong>Features</strong></span> page and open the <span class="strong strong"><strong>Extensions</strong></span> tab.
</li>
<li class="listitem">
Select any extension and then choose <span class="strong strong"><strong>Update extension</strong></span> to renew it. No other changes are needed, and any associated configuration change failures should now be able to succeed.
</li>
</ol>
</div>
<div class="position-relative"><h3><a id="ece-config-change-errors-oom-errors"></a>OOM errors</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>Configuration change errors can occur when there is insufficient RAM configured for a data tier. In this case, the cluster typically also shows OOM (out of memory) errors. To resolve these, you need to increase the amount of heap memory, which is half of the amount of memory allocated to a cluster. You might also detect OOM in plan changes via their <a href="/guide/en/elasticsearch/reference/8.18/stopping-elasticsearch.html#fatal-errors" class="ulink" target="_top">related exit codes</a> <code class="literal">127</code>, <code class="literal">137</code>, and <code class="literal">158</code>.</p>
<p>As well, you can read our detailed blog <a href="/blog/managing-and-troubleshooting-elasticsearch-memory" class="ulink" target="_top">Managing and troubleshooting Elasticsearch memory</a>.</p>
<div class="position-relative"><h3><a id="ece-config-change-errors-existing-index"></a>Existing index</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>In rare cases, when you attempt to upgrade the version of a deployment and the upgrade fails on the first attempt, subsequent attempts to upgrade may fail due to already existing resources. The problem may be due to the system preventing itself from overwriting existing indices, resulting in an error such as this: <code class="literal">Another Kibana instance appears to be migrating the index. Waiting for that migration to complete. If no other Kibana instance is attempting migrations, you can get past this message by deleting index .kibana_2 and restarting Kibana</code>.</p>
<p>To resolve this:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Check that you don&#8217;t need the content.
</li>
<li class="listitem">
<p>Run an Elasticsearch <a href="/guide/en/elasticsearch/reference/8.18/indices-delete-index.html" class="ulink" target="_top">Delete index request</a> to remove the existing index.</p>
<p>In this example, the <code class="literal">.kibana_2</code> index is the rollover of saved objects (such as Kibana visualizations or dashboards) from the original <code class="literal">.kibana_1</code> index. Since <code class="literal">.kibana_2</code> was created as part of the failed upgrade process, this index does not yet contain any pertinent data and it can safely be deleted.</p>
</li>
<li class="listitem">
Retry the deployment configuration change.
</li>
</ol>
</div>
<div class="position-relative"><h3><a id="ece-config-change-errors-insufficient-storage"></a>Insufficient Storage</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-119/docs/shared/ec-ce-monitoring-scenarios.asciidoc">edit</a></div>
<p>Configuration change errors can occur when there is insufficient disk space for a data tier. To resolve this, you need to increase the size of that tier to ensure it provides enough storage to accommodate the data in your cluster tier considering the <a href="/guide/en/elasticsearch/reference/8.18/modules-cluster.html#disk-based-shard-allocation" class="ulink" target="_top">high watermark</a>. For troubleshooting walkthrough, see <a href="/guide/en/elasticsearch/reference/8.18/fix-watermark-errors.html" class="ulink" target="_top">Fix watermark errors</a>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ece-deployment-no-op.html">« How do I resolve deployment health warnings?</a>
</span>
<span class="next">
<a href="ece-activity-page.html">Keep track of deployment activity »</a>
</span>
</div>
</body>
</html>
