<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ubuntu 20.04 LTS (Focal Fossa) and Ubuntu 22.04 LTS (Jammy Jellyfish) | Elastic Cloud Enterprise Reference [3.7] | Elastic</title>
<meta class="elastic" name="content" content="Ubuntu 20.04 LTS (Focal Fossa) and Ubuntu 22.04 LTS (Jammy Jellyfish) | Elastic Cloud Enterprise Reference [3.7]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.7]"/>
<link rel="up" href="ece-configure-os-onprem.html" title="Configure your operating system"/>
<link rel="prev" href="ece-configure-os-onprem.html" title="Configure your operating system"/>
<link rel="next" href="ece-configure-hosts-rhel-centos-onprem.html" title="Red Hat Enterprise Linux (RHEL) and Rocky Linux"/>
<meta class="elastic" name="product_version" content="3.7"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.7"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.7"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="ece-configure-os-onprem.html">« Configure your operating system</a>
</span>
<span class="next">
<a href="ece-configure-hosts-rhel-centos-onprem.html">Red Hat Enterprise Linux (RHEL) and Rocky Linux »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.7]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-installing.html">Installing Elastic Cloud Enterprise</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-install-your-infra.html">Install ECE on your own premises</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-configure-os-onprem.html">Configure your operating system</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Ubuntu 20.04 LTS (Focal Fossa) and Ubuntu 22.04 LTS (Jammy Jellyfish)</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-configuring-ubuntu.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ece-configure-hosts-ubuntu-onprem"></a>Ubuntu 20.04 LTS (Focal Fossa) and Ubuntu 22.04 LTS (Jammy Jellyfish)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-configuring-ubuntu.asciidoc">edit</a></h3>
</div></div></div>
<p>The following instructions show you how to prepare your hosts on 20.04 LTS (Focal Fossa) and Ubuntu 22.04 LTS (Jammy Jellyfish).</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ece-configure-hosts-ubuntu-onprem.html#ece-install-docker-ubuntu-onprem" title="Install Docker">Install Docker 24.0</a>
</li>
<li class="listitem">
<a class="xref" href="ece-configure-hosts-ubuntu-onprem.html#ece-xfs-setup-ubuntu-onprem" title="Set up XFS quotas">Set up XFS quotas</a>
</li>
<li class="listitem">
<a class="xref" href="ece-configure-hosts-ubuntu-onprem.html#ece-update-config-ubuntu-onprem" title="Update the configurations settings">Update the configurations settings</a>
</li>
<li class="listitem">
<a class="xref" href="ece-configure-hosts-ubuntu-onprem.html#ece-configure-docker-daemon-ubuntu-onprem" title="Configure the Docker daemon options">Configure the Docker daemon options</a>
</li>
</ul>
</div>
<h5><a id="ece-install-docker-ubuntu-onprem"></a>Install Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-configuring-ubuntu.asciidoc">edit</a></h5>
<p>Install Docker LTS version 24.0 for Ubuntu 20.04 or 22.04.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Docker 25 and higher are not compatible with ECE 3.7.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Install the Docker repository dependencies:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo apt-get install ca-certificates curl gnupg lsb-release</pre>
</div>
</li>
<li class="listitem">
<p>Add Docker’s official GPG key:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo mkdir -m 0755 -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</pre>
</div>
</li>
<li class="listitem">
<p>Add the stable Docker repository:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</pre>
</div>
</li>
<li class="listitem">
<p>Install the correct version of the <code class="literal">docker-ce</code> package, for Ubuntu 20.04 LTS (Focal Fossa) or Ubuntu 22.04 LTS (Jammy Jellyfish):</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo apt install -y docker-ce=5:24.0.* docker-ce-cli=5:24.0.* containerd.io</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-xfs-setup-ubuntu-onprem"></a>Set up XFS quotas<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-configuring-ubuntu.asciidoc">edit</a></h5>
<p>XFS is required to support disk space quotas for Elasticsearch data directories. Some Linux distributions such as RHEL and Rocky Linux already provide XFS as the default file system. On Ubuntu, you need to set up an XFS file system and have quotas enabled.</p>
<p>Disk space quotas set a limit on the amount of disk space an Elasticsearch cluster node can use. Currently, quotas are calculated by
a static ratio of 1:32, which means that for every 1 GB of RAM a cluster is given, a cluster node is allowed to consume 32 GB of disk space.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using LVM, <code class="literal">mdadm</code>, or a combination of the two for block device management is possible, but the
configuration is not covered here, and it is not supported by Elastic Cloud Enterprise.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must use XFS and have quotas enabled on all allocators, otherwise disk usage won&#8217;t display correctly.</p>
</div>
</div>
<p><span class="strong strong"><strong>Example:</strong></span> Set up XFS on a single, pre-partitioned block device named <code class="literal">/dev/xvdg1</code>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Format the partition:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo mkfs.xfs /dev/xvdg1</pre>
</div>
</li>
<li class="listitem">
<p>Create the <code class="literal">/mnt/data/</code> directory as a mount point:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>Add an entry to the <code class="literal">/etc/fstab</code> file for the new XFS volume. The
default filesystem path used by Elastic Cloud Enterprise is <code class="literal">/mnt/data</code>.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">/dev/xvdg1	/mnt/data	xfs	defaults,nofail,x-systemd.automount,prjquota,pquota  0 2</pre>
</div>
</li>
<li class="listitem">
<p>Regenerate the mount files:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo systemctl daemon-reload
sudo systemctl restart local-fs.target</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-update-config-ubuntu-onprem"></a>Update the configurations settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-configuring-ubuntu.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Stop the Docker service:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo systemctl stop docker</pre>
</div>
</li>
<li class="listitem">
<p>Enable cgroup accounting for memory and swap space.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In the <code class="literal">/etc/default/grub</code> file, ensure that the <code class="literal">GRUB_CMDLINE_LINUX=</code> variable includes these values:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">cgroup_enable=memory swapaccount=1 cgroup.memory=nokmem</pre>
</div>
</li>
<li class="listitem">
<p>Update your Grub configuration:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo update-grub</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Configure kernel parameters</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">cat &lt;&lt;EOF | sudo tee -a /etc/sysctl.conf
# Required by Elasticsearch
vm.max_map_count=262144
# enable forwarding so the Docker networking works as expected
net.ipv4.ip_forward=1
# Decrease the maximum number of TCP retransmissions to 5 as recommended for Elasticsearch TCP retransmission timeout.
# See https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config-tcpretries.html
net.ipv4.tcp_retries2=5
# Make sure the host doesn't swap too early
vm.swappiness=1
EOF</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">net.ipv4.tcp_retries2</code> setting applies to all TCP connections and affects the reliability of communication with systems other than Elasticsearch clusters too. If your clusters communicate with external systems over a low quality network then you may need to select a higher value for <code class="literal">net.ipv4.tcp_retries2</code>.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Apply the settings:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo sysctl -p</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Adjust the system limits.</p>
<p>Add the following configuration values to the <code class="literal">/etc/security/limits.conf</code> file. These values are derived from our experience with the Elastic Cloud hosted offering and should be used for Elastic Cloud Enterprise as well.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are using a user name other than <code class="literal">elastic</code>, adjust the configuration values accordingly.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">*                soft    nofile         1024000
*                hard    nofile         1024000
*                soft    memlock        unlimited
*                hard    memlock        unlimited
elastic          soft    nofile         1024000
elastic          hard    nofile         1024000
elastic          soft    memlock        unlimited
elastic          hard    memlock        unlimited
elastic          soft    nproc          unlimited
elastic          hard    nproc          unlimited
root             soft    nofile         1024000
root             hard    nofile         1024000
root             soft    memlock        unlimited</pre>
</div>
</li>
<li class="listitem">
<p>NOTE: This step is optional if the Docker registry doesn&#8217;t require authentication.</p>
<p>Authenticate the <code class="literal">elastic</code> user to pull images from the Docker registry you use, by creating the file <code class="literal">/home/elastic/.docker/config.json</code>. This file needs to be owned by the <code class="literal">elastic</code> user. If you are using a user name other than <code class="literal">elastic</code>, adjust the path accordingly.</p>
<p><span class="strong strong"><strong>Example</strong></span>: In case you use <code class="literal">docker.elastic.co</code>, the file content looks like as follows:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">{
 "auths": {
   "docker.elastic.co": {
     "auth": "&lt;auth-token&gt;"
   }
 }
}</pre>
</div>
</li>
<li class="listitem">
<p>If you did not create the mount point earlier (if you did not set up XFS), create the <code class="literal">/mnt/data/</code> directory as a mount point:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>If you <a class="xref" href="ece-configure-hosts-ubuntu-onprem.html#ece-xfs-setup-ubuntu-onprem" title="Set up XFS quotas">set up a new device with XFS</a> earlier:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Mount the block device (change the device name if you use a different device than <code class="literal">/dev/xvdg1</code>):</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo mount /dev/xvdg1 /mnt/data</pre>
</div>
</li>
<li class="listitem">
<p>Set the permissions on the newly mounted device:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo chown $USER:$USER /mnt/data</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Create the <code class="literal">/mnt/data/docker</code> directory for the Docker service storage:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo install -o $USER -g $USER -d -m 700 /mnt/data/docker</pre>
</div>
</li>
</ol>
</div>
<h5><a id="ece-configure-docker-daemon-ubuntu-onprem"></a>Configure the Docker daemon options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-105/docs/cloud-enterprise/ce-configuring-ubuntu.asciidoc">edit</a></h5>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Docker creates a bridge IP address that can conflict with IP addresses on your internal network. To avoid an IP address conflict, change the <code class="literal">--bip=172.17.42.1/16</code> parameter in our examples to something that you know will work. If there is no conflict, you can omit the <code class="literal">--bip</code> parameter. The <code class="literal">--bip</code> parameter is internal to the host and can be set to the same IP for each host in the cluster. More information on Docker daemon options can be found in the  <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" class="ulink" target="_top">dockerd command line reference</a>.</p>
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can specify <code class="literal">--log-opt max-size</code> and <code class="literal">--log-opt max-file</code> to define the Docker daemon containers log rotation.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Update <code class="literal">/etc/systemd/system/docker.service.d/docker.conf</code>. If the file path and file do not exist, create them first.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">[Unit]
Description=Docker Service
After=multi-user.target

[Service]
Environment="DOCKER_OPTS=-H unix:///run/docker.sock --data-root /mnt/data/docker --storage-driver=overlay2 --bip=172.17.42.1/16 --raw-logs --log-opt max-size=500m --log-opt max-file=10 --icc=false"
ExecStart=
ExecStart=/usr/bin/dockerd $DOCKER_OPTS</pre>
</div>
</li>
<li class="listitem">
<p>Apply the updated Docker daemon configuration:</p>
<p>Reload the Docker daemon configuration:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo systemctl daemon-reload</pre>
</div>
<p>Restart the Docker service:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo systemctl restart docker</pre>
</div>
<p>Enable Docker to start on boot:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo systemctl enable docker</pre>
</div>
</li>
<li class="listitem">
<p>Enable your user to communicate with the Docker subsystem by adding it to the <code class="literal">docker</code> group:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sudo usermod -aG docker $USER</pre>
</div>
</li>
<li class="listitem">
<p>Recommended: Tune your network settings.</p>
<p>Create a <code class="literal">70-cloudenterprise.conf</code> file in the <code class="literal">/etc/sysctl.d/</code> file path that includes these network settings:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">cat &lt;&lt; SETTINGS | sudo tee /etc/sysctl.d/70-cloudenterprise.conf
net.ipv4.tcp_max_syn_backlog=65536
net.core.somaxconn=32768
net.core.netdev_max_backlog=32768
SETTINGS</pre>
</div>
</li>
<li class="listitem">
<p>Pin the Docker version to ensure that the package does not get upgraded:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">echo "docker-ce hold" | sudo dpkg --set-selections
echo "docker-ce-cli hold" | sudo dpkg --set-selections
echo "containerd.io hold" | sudo dpkg --set-selections</pre>
</div>
</li>
<li class="listitem">
<p>Reboot your system to ensure that all configuration changes take effect:</p>
<div class="pre_wrapper lang-literal">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-literal">sudo reboot</pre>
</div>
</li>
<li class="listitem">
<p>After rebooting, verify that your Docker settings persist as expected:</p>
<div class="pre_wrapper lang-literal">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-literal">sudo docker info | grep Root</pre>
</div>
<p>If the command returns <code class="literal">Docker Root Dir: /mnt/data/docker</code>, then your changes were applied successfully and persist as expected.</p>
<p>If the command returns <code class="literal">Docker Root Dir: /var/lib/docker</code>, then you need to troubleshoot the previous configuration steps until the Docker settings are applied successfully before continuing with the installation process. For more information, check <a href="https://docs.docker.com/engine/admin/systemd/#/custom-docker-daemon-options" class="ulink" target="_top">Custom Docker daemon options</a> in the Docker documentation.</p>
</li>
<li class="listitem">
Repeat these steps on other hosts that you want to use with Elastic Cloud Enterprise or follow the steps in the next section to start installing Elastic Cloud Enterprise.
</li>
</ol>
</div>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</div><div class="navfooter">
<span class="prev">
<a href="ece-configure-os-onprem.html">« Configure your operating system</a>
</span>
<span class="next">
<a href="ece-configure-hosts-rhel-centos-onprem.html">Red Hat Enterprise Linux (RHEL) and Rocky Linux »</a>
</span>
</div>
</body>
</html>
