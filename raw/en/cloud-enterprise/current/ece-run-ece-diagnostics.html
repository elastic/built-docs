<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Run ECE diagnostics tool | Elastic Cloud Enterprise Reference [3.5] | Elastic</title>
<meta class="elastic" name="content" content="Run ECE diagnostics tool | Elastic Cloud Enterprise Reference [3.5]">

<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [3.5]"/>
<link rel="up" href="ece-troubleshooting.html" title="Troubleshooting"/>
<link rel="prev" href="ece-zookeeper-sync.html" title="Verify ZooKeeper Sync Status"/>
<link rel="next" href="ece-getting-help.html" title="Ask for help"/>
<meta class="elastic" name="product_version" content="3.5"/>
<meta class="elastic" name="product_name" content="ECE"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/3.5"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="3.5"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [3.5]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ece-troubleshooting.html">Troubleshooting</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ece-zookeeper-sync.html">« Verify ZooKeeper Sync Status</a>
</span>
<span class="next">
<a href="ece-getting-help.html">Ask for help »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-run-ece-diagnostics"></a>Run ECE diagnostics tool<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-81/docs/cloud-enterprise/ce-troubleshooting.asciidoc">edit</a></h2>
</div></div></div>
<p>ECE diagnostics is a command line tool that you can run on hosts where the ECE instance is installed. It collects logs and metrics, and stores everything into an archive file that can be provided to Elastic support for troubleshooting and investigation purposes.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This archive file is privacy-redacted as much as possible, but may still contain host identifying metadata (such as IP/domain info). We therefore recommend against uploading this output to public forums. Any uploads to the <a href="https://support.elastic.co" class="ulink" target="_top">Elastic Support Portal</a> are treated according to the <a href="/legal/privacy-statement" class="ulink" target="_top">Elastic Privacy Statement</a>.</p>
</div>
</div>
<h3><a id="ece_prepare"></a>Prepare<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-81/docs/cloud-enterprise/ce-troubleshooting.asciidoc">edit</a></h3>
<p>The ECE diagnostics tool comes bundled in ECE images for version 3.3 and onwards. For <span class="strong strong"><strong>versions 3.3 and onward</strong></span>, you can export the diagnostic bundle within the ECE host&#8217;s image.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker cp frc-runners-runner:/elastic_cloud_apps/ece-diagnostics/ece-diagnostics .</pre>
</div>
<p>For <span class="strong strong"><strong>versions before 3.3</strong></span>, please first manually install this diagnostic tool from the latest ECE version&#8217;s image:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Confirm the latest ECE version</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -s https://download.elastic.co/cloud/elastic-cloud-enterprise.sh | head | grep 'CLOUD_ENTERPRISE_VERSION'</pre>
</div>
</li>
<li class="listitem">
<p>Download the bundled diagnostic from the latest ECE version&#8217;s image and copy out the bundled diagnostic. To run this command, replace <code class="literal">$CLOUD_ENTERPRISE_VERSION</code> with the latest version. To manually specify the ECE platform, which is default auto-detected, append either <code class="literal">--platform linux/amd64</code> or <code class="literal">--platform linux/arm64</code>.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run --rm -v $( pwd ):/export docker.elastic.co/cloud-enterprise/elastic-cloud-enterprise:$CLOUD_ENTERPRISE_VERSION /bin/sh -c "cp /elastic_cloud_apps/ece-diagnostics/ece-diagnostics /export"</pre>
</div>
</li>
<li class="listitem">
<p>Once the bundled diagnostic is exported, you can delete this latest version&#8217;s image, again replacing <code class="literal">$CLOUD_ENTERPRISE_VERSION</code> with the latest version.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker rmi docker.elastic.co/cloud-enterprise/elastic-cloud-enterprise:$CLOUD_ENTERPRISE_VERSION</pre>
</div>
</li>
</ol>
</div>
<h3><a id="ece_how_to_use"></a>How to use<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-81/docs/cloud-enterprise/ce-troubleshooting.asciidoc">edit</a></h3>
<p>To run the default diagnostic</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">./ece-diagnostics run</pre>
</div>
<p>This tool supports various command line flags. You can also run it with <code class="literal">-h</code> or <code class="literal">--help</code> to print all available subcommands and options:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">./ece-diagnostics --help</pre>
</div>
<p>For example, Elastic Support frequently requests pulling the ECE diagnostic along with certain deployment diagnostics. You can pull these together via:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">./ece-diagnostics run --deployments MY_DEPLOYMENT_ID_1,MY_DEPLOYMENT_ID_2</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>ECE deployment diagnostics are not the same as <a href="https://github.com/elastic/support-diagnostics#usage-examples" class="ulink" target="_top">stack diagnostics</a> which Elastic support may also request.</p>
</div>
</div>
<h3><a id="ece_example_output"></a>Example output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-81/docs/cloud-enterprise/ce-troubleshooting.asciidoc">edit</a></h3>
<p>When you run the ECE diagnostics tool on the host you want to troubleshoot, you might get an output similar to this one:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">[...]
✓ collected information on certificates (took: 104ms)
✓ collected information on client-forwarder connectivity (took: 369ms)
✓ collected API information for ECE and Elasticsearch (took: 9.117s)
✓ collected ZooKeeper stats (took: 9.146s)
✓ collected ECE metricbeat data (took: 12.534s)
✓ collected system information (took: 12.992s)
✓ collected host logs for ECE (took: 29.222s)
✓ collected Docker info and logs (took: 29.246s)
Finished creating file: /tmp/ecediag-192.168.44.10-20220506-084902.tar.gz (total: 48.937s)</pre>
</div>
<p>At that point, you&#8217;re ready to upload the <code class="literal">.tar.gz</code> file to Elastic Support.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ece-zookeeper-sync.html">« Verify ZooKeeper Sync Status</a>
</span>
<span class="next">
<a href="ece-getting-help.html">Ask for help »</a>
</span>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>
