<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Secure your clusters with JWT | Elasticsearch Add-On for Heroku Documentation | Elastic</title>
<meta class="elastic" name="content" content="Secure your clusters with JWT | Elasticsearch Add-On for Heroku Documentation">

<link rel="home" href="index.html" title="Elasticsearch Add-On for Heroku Documentation"/>
<link rel="up" href="ech-security.html" title="Securing your deployment"/>
<link rel="prev" href="ech-secure-clusters-kerberos.html" title="Secure your clusters with Kerberos"/>
<link rel="next" href="ech-traffic-filtering-deployment-configuration.html" title="Traffic Filtering"/>
<meta class="elastic" name="product_version" content="latest"/>
<meta class="elastic" name="product_name" content="Elasticsearch Add-On for Heroku"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud-Heroku/Reference"/>
<meta name="DC.subject" content="Elasticsearch Add-On for Heroku"/>
<meta name="DC.identifier" content="latest"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="ech-secure-clusters-kerberos.html">« Secure your clusters with Kerberos</a>
</span>
<span class="next">
<a href="ech-traffic-filtering-deployment-configuration.html">Traffic Filtering »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Add-On for Heroku Documentation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ech-security.html">Securing your deployment</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Secure your clusters with JWT</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/shared/ec-ce-securing-clusters-jwt.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ech-securing-clusters-JWT"></a>Secure your clusters with JWT<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/shared/ec-ce-securing-clusters-jwt.asciidoc">edit</a></h2>
</div></div></div>
<p>These steps show how you can secure your Elasticsearch clusters, and Enterprise Search instances in a deployment by using a JSON Web Token (JWT) realm for authentication.</p>
<h3><a id="echbefore_you_begin_11"></a>Before you begin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/shared/ec-ce-securing-clusters-jwt.asciidoc">edit</a></h3>
<p>Elasticsearch Add-On for Heroku supports JWT of ID Token format with Elastic Stack version 8.2 and later.
Support for JWT of certain access token format is available since 8.7.</p>
<h3><a id="echconfigure_your_8_2_or_above_cluster_to_use_jwt_of_id_token_format"></a>Configure your 8.2 or above cluster to use JWT of ID Token format<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/shared/ec-ce-securing-clusters-jwt.asciidoc">edit</a></h3>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        jwt: <a id="CO16-1"></a><i class="conum" data-value="1"></i>
          jwt-realm-name: <a id="CO16-2"></a><i class="conum" data-value="2"></i>
            order: 2 <a id="CO16-3"></a><i class="conum" data-value="3"></i>
            client_authentication.type: "shared_secret" <a id="CO16-4"></a><i class="conum" data-value="4"></i>
            allowed_signature_algorithms: "HS256,HS384,HS512,RS256,RS384,RS512,ES256,ES384,ES512,PS256,PS384,PS512" <a id="CO16-5"></a><i class="conum" data-value="5"></i>
            allowed_issuer: "issuer1" <a id="CO16-6"></a><i class="conum" data-value="6"></i>
            allowed_audiences: "elasticsearch1,elasticsearch2" <a id="CO16-7"></a><i class="conum" data-value="7"></i>
            claims.principal: "sub" <a id="CO16-8"></a><i class="conum" data-value="8"></i>
            claims.groups: "groups" <a id="CO16-9"></a><i class="conum" data-value="9"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies the authentication realm service.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the JWT realm name.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The order of the JWT realm in your authentication chain. Allowed values are between <code class="literal">2</code> and <code class="literal">100</code>, inclusive.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the client authenticate type.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the JWT <code class="literal">alg</code> header values allowed by the realm.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the JWT <code class="literal">iss</code> claim value allowed by the realm.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-7"><i class="conum" data-value="7"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the JWT <code class="literal">aud</code> claim values allowed by the realm.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-8"><i class="conum" data-value="8"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the JWT claim name used for the principal (username). No default.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-9"><i class="conum" data-value="9"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the JWT claim name used for the groups. No default.</p>
</td>
</tr>
</table>
</div>
<p>By default, users authenticating through JWT have no roles assigned to them. If you want all users in the group <code class="literal">elasticadmins</code> in your identity provider to be assigned the <code class="literal">superuser</code> role in your Elasticsearch cluster, issue the following request to Elasticsearch:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">POST /_security/role_mapping/CLOUD_JWT_ELASTICADMIN_TO_SUPERUSER <a id="CO17-1"></a><i class="conum" data-value="1"></i>
{
   "enabled": true,
    "roles": [ "superuser" ], <a id="CO17-2"></a><i class="conum" data-value="2"></i>
    "rules": { "all" : [ <a id="CO17-3"></a><i class="conum" data-value="3"></i>
        { "field": { "realm.name": "jwt-realm-name" } }, <a id="CO17-4"></a><i class="conum" data-value="4"></i>
        { "field": { "groups": "elasticadmins" } }
    ]},
    "metadata": { "version": 1 }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO17-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The mapping name.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO17-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The Elastic Stack role to map to.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO17-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>A rule specifying the JWT role to map from.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO17-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">realm.name</code> can be any string containing only alphanumeric characters, underscores, and hyphens.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In order to use the field <code class="literal">groups</code> in the mapping rule, you need to have mapped the JWT Attribute that conveys the group membership to <code class="literal">claims.groups</code> in the previous step.</p>
</div>
</div>
<h3><a id="echconfigure_your_8_7_or_above_cluster_to_use_jwt_of_access_token_format"></a>Configure your 8.7 or above cluster to use JWT of access token format<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/shared/ec-ce-securing-clusters-jwt.asciidoc">edit</a></h3>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        jwt:
          jwt-realm-name:
            order: 2
            token_type: "access_token" <a id="CO18-1"></a><i class="conum" data-value="1"></i>
            client_authentication.type: "shared_secret"
            allowed_signature_algorithms: [ "RS256", "HS256" ]
            allowed_subjects: [ "123456-compute@developer.example.com" ] <a id="CO18-2"></a><i class="conum" data-value="2"></i>
            allowed_issuer: "issuer1"
            allowed_audiences: [ "elasticsearch1", "elasticsearch2" ]
            required_claims: <a id="CO18-3"></a><i class="conum" data-value="3"></i>
              token_use: "access"
            fallback_claims.sub: "client_id" <a id="CO18-4"></a><i class="conum" data-value="4"></i>
            fallback_claims.aud: "scope" <a id="CO18-5"></a><i class="conum" data-value="5"></i>
            claims.principal: "sub" <a id="CO18-6"></a><i class="conum" data-value="6"></i>
            claims.groups: "groups"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies token type accepted by this JWT realm</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies subjects allowed by the realm. This setting is mandatory for <code class="literal">access_token</code> JWT realms.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Additional claims required for successful authentication. The claim name can be any valid variable names and the claim values must be either string or array of strings.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the JWT claim to extract the subject information if the <code class="literal">sub</code> claim does not exist. This setting is only available for <code class="literal">access_token</code> JWT realms.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the JWT claim to extract the audiences information if the <code class="literal">aud</code> claim does not exist. This setting is only available for <code class="literal">access_token</code> JWT realms.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Since the fallback claim for <code class="literal">sub</code> is defined as <code class="literal">client_id</code>, the principal will also be extracted from <code class="literal">client_id</code> if the <code class="literal">sub</code> claim does not exist</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a href="/guide/en/elasticsearch/reference/8.15/jwt-auth-realm.html" class="ulink" target="_top">JWT authentication documentation</a> for more details and examples.</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ech-secure-clusters-kerberos.html">« Secure your clusters with Kerberos</a>
</span>
<span class="next">
<a href="ech-traffic-filtering-deployment-configuration.html">Traffic Filtering »</a>
</span>
</div>
</body>
</html>
