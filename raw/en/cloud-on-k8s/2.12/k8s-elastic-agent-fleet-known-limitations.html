<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Known limitations | Elastic Cloud on Kubernetes [2.12] | Elastic</title>
<meta class="elastic" name="content" content="Known limitations | Elastic Cloud on Kubernetes [2.12]">

<link rel="home" href="index.html" title="Elastic Cloud on Kubernetes [2.12]"/>
<link rel="up" href="k8s-elastic-agent-fleet.html" title="Run Fleet-managed Elastic Agent on ECK"/>
<link rel="prev" href="k8s-elastic-agent-fleet-configuration-examples.html" title="Configuration Examples"/>
<link rel="next" href="k8s-maps.html" title="Run Elastic Maps Server on ECK"/>
<meta class="elastic" name="product_version" content="2.12"/>
<meta class="elastic" name="product_name" content="ECK"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Kubernetes/Reference/2.12"/>
<meta name="DC.subject" content="ECK"/>
<meta name="DC.identifier" content="2.12"/>
</head>
<body><div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud on Kubernetes [2.12]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-orchestrating-elastic-stack-applications.html">Orchestrating Elastic Stack applications</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-elastic-agent-fleet.html">Run Fleet-managed Elastic Agent on ECK</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="k8s-elastic-agent-fleet-configuration-examples.html">« Configuration Examples</a>
</span>
<span class="next">
<a href="k8s-maps.html">Run Elastic Maps Server on ECK »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="k8s-elastic-agent-fleet-known-limitations"></a>Known limitations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.12/docs/orchestrating-elastic-stack-applications/agent-fleet.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s_running_as_root_eck_2_10_0_and_agent_7_14_0"></a>Running as root (ECK &lt; 2.10.0 and Agent &lt; 7.14.0)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.12/docs/orchestrating-elastic-stack-applications/agent-fleet.asciidoc">edit</a></h3>
</div></div></div>
<p>Until version 7.14.0 and ECK version 2.10.0, Elastic Agent and Fleet Server were required to run as root.</p>
<p>As of Elastic Stack version 7.14.0 and ECK version 2.10.0 it is also possible to run Elastic Agent and Fleet as a non-root user. See <a class="xref" href="k8s-elastic-agent-configuration-examples.html#k8s_storing_local_state_in_host_path_volume" title="Storing local state in host path volume">Storing local state in host path volume</a> for instructions.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s_elastic_agent_running_in_the_same_namespace_as_the_elastic_stack"></a>Elastic Agent running in the same namespace as the Elastic stack.<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.12/docs/orchestrating-elastic-stack-applications/agent-fleet.asciidoc">edit</a></h3>
</div></div></div>
<p>Until ECK version 2.11.0, Elastic Agent and Fleet Server were required to run within the same Namespace as Elasticsearch.</p>
<p>As of ECK version 2.11.0, Elastic Agent, Fleet Server and Elasticsearch can all be deployed in different Namespaces.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s_running_endpoint_security_integration"></a>Running Endpoint Security integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.12/docs/orchestrating-elastic-stack-applications/agent-fleet.asciidoc">edit</a></h3>
</div></div></div>
<p>Running Endpoint Security <a href="/guide/en/security/current/install-endpoint.html" class="ulink" target="_top">integration</a> is not yet supported in containerized environments, like Kubernetes. This is not an ECK limitation, but the limitation of the integration itself. Note that you can use ECK to deploy Elasticsearch, Kibana and Fleet Server, and add Endpoint Security integration to your policies if Elastic Agents running those policies are deployed in non-containerized environments.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s_fleet_server_initialization_fails_on_minikube_when_cni_is_disabled"></a>Fleet Server initialization fails on minikube when CNI is disabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.12/docs/orchestrating-elastic-stack-applications/agent-fleet.asciidoc">edit</a></h3>
</div></div></div>
<p>When deployed with ECK, the Fleet Server Pod makes an HTTP call to itself during Fleet initialization using its Service. Since a <a href="https://github.com/kubernetes/minikube/issues/1568" class="ulink" target="_top">Pod cannot reach itself through its Service on minikube</a> when CNI is disabled, the call hangs until the connection times out and the Pod enters a crash loop.</p>
<p>Solution: enable CNI when starting minikube: <code class="literal">minikube start --cni=true</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s_storing_local_state_in_host_path_volume_2"></a>Storing local state in host path volume<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.12/docs/orchestrating-elastic-stack-applications/agent-fleet.asciidoc">edit</a></h3>
</div></div></div>
<p>Elastic Agent managed by ECK stores local state in a host path volume by default. This ensures that integrations run by the agent can continue their work without duplicating work that has already been done after the Pod has been recreated for example because of a Pod configuration change. Multiple replicas of an agent, for example Fleet Servers, can not be deployed on the same underlying Kubernetes node as they would try to use the same host path. There are 2 options for managing this feature:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If local state storage in <code class="literal">hostPath</code> volumes is not desired this can be turned off by configuring an <code class="literal">emptyDir</code> volume instead.
</li>
<li class="listitem">
If local state storage is still desired but running the Agent container as root is not allowed, then you can run a <code class="literal">DaemonSet</code> that adjusts the permissions for the Agent local state on each Node prior to running Elastic Agent. Note that this <code class="literal">DaemonSet</code> must be <code class="literal">runAsUser: 0</code> and possibly <code class="literal">privileged: true</code>. Also note the Kibana changes required to trust the Elasticsearch CA when running in fleet mode.
</li>
</ol>
</div>
<p>Full configuration examples exist in  <a class="xref" href="k8s-elastic-agent-fleet-configuration.html#k8s-elastic-agent-running-as-a-non-root-user" title="Running as a non-root user">Running as a non-root user</a>.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="k8s-elastic-agent-fleet-configuration-examples.html">« Configuration Examples</a>
</span>
<span class="next">
<a href="k8s-maps.html">Run Elastic Maps Server on ECK »</a>
</span>
</div>
</div>
</body>
</html>
