<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configuration examples | Elastic Cloud on Kubernetes [2.14] | Elastic</title>
<meta class="elastic" name="content" content="Configuration examples | Elastic Cloud on Kubernetes [2.14]">

<link rel="home" href="index.html" title="Elastic Cloud on Kubernetes [2.14]"/>
<link rel="up" href="k8s-elastic-agent.html" title="Run standalone Elastic Agent on ECK"/>
<link rel="prev" href="k8s-elastic-agent-configuration.html" title="Configuration"/>
<link rel="next" href="k8s-elastic-agent-fleet.html" title="Run Fleet-managed Elastic Agent on ECK"/>
<meta class="elastic" name="product_version" content="2.14"/>
<meta class="elastic" name="product_name" content="ECK"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Kubernetes/Reference/2.14"/>
<meta name="DC.subject" content="ECK"/>
<meta name="DC.identifier" content="2.14"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="k8s-elastic-agent-configuration.html">« Configuration</a>
</span>
<span class="next">
<a href="k8s-elastic-agent-fleet.html">Run Fleet-managed Elastic Agent on ECK »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud on Kubernetes [2.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-orchestrating-elastic-stack-applications.html">Orchestrating Elastic Stack applications</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-elastic-agent.html">Run standalone Elastic Agent on ECK</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configuration examples</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/agent-standalone.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="k8s-elastic-agent-configuration-examples"></a>Configuration examples</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/agent-standalone.asciidoc">edit</a></div>
</div></div></div>
<p>This section contains manifests that illustrate common use cases, and can be your starting point in exploring Elastic Agent deployed with ECK. These manifests are self-contained and work out-of-the-box on any non-secured Kubernetes cluster. They all contain a three-node Elasticsearch cluster and a single Kibana instance. Add the corresponding integration package to Kibana to install the dashboards, visualizations and other assets for each of these examples as described in <a href="/guide/en/fleet/current/elastic-agent-installation.html" class="ulink" target="_top">the Elastic Agent documentation</a>.</p>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>The examples in this section are for illustration purposes only and should not be considered to be production-ready. Some of these examples use the <code class="literal">node.store.allow_mmap: false</code> setting which has performance implications and should be tuned for production workloads, as described in <a class="xref" href="k8s-virtual-memory.html" title="Virtual memory">Virtual memory</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="k8s_system_integration"></a>System integration</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/agent-standalone.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">kubectl apply -f https://raw.githubusercontent.com/elastic/cloud-on-k8s/2.14/config/recipes/elastic-agent/system-integration.yaml</pre>
</div>
<p>Deploys Elastic Agent as a DaemonSet in standalone mode with system integration enabled. Collects syslog logs, auth logs and system metrics (for CPU, I/O, filesystem, memory, network, process and others).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="k8s_kubernetes_integration"></a>Kubernetes integration</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/agent-standalone.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">kubectl apply -f https://raw.githubusercontent.com/elastic/cloud-on-k8s/2.14/config/recipes/elastic-agent/kubernetes-integration.yaml</pre>
</div>
<p>Deploys Elastic Agent as a DaemonSet in standalone mode with Kubernetes integration enabled. Collects API server, Container, Event, Node, Pod, Volume and system metrics.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="k8s_multiple_elasticsearch_clusters_output"></a>Multiple Elasticsearch clusters output</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/agent-standalone.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">kubectl apply -f https://raw.githubusercontent.com/elastic/cloud-on-k8s/2.14/config/recipes/elastic-agent/multi-output.yaml</pre>
</div>
<p>Deploys two Elasticsearch clusters and two Kibana instances together with single Elastic Agent DaemonSet in standalone mode with System integration enabled. System metrics are sent to the <code class="literal">elasticsearch</code> cluster. Elastic Agent monitoring data is sent to <code class="literal">elasticsearch-mon</code> cluster.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="k8s_storing_local_state_in_host_path_volume"></a>Storing local state in host path volume</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/agent-fleet.asciidoc">edit</a></div>
</div></div></div>
<p>Elastic Agent managed by ECK stores local state in a host path volume by default. This ensures that integrations run by the agent can continue their work without duplicating work that has already been done after the Pod has been recreated for example because of a Pod configuration change. Multiple replicas of an agent, for example Fleet Servers, can not be deployed on the same underlying Kubernetes node as they would try to use the same host path. There are 2 options for managing this feature:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If local state storage in <code class="literal">hostPath</code> volumes is not desired this can be turned off by configuring an <code class="literal">emptyDir</code> volume instead.
</li>
<li class="listitem">
If local state storage is still desired but running the Agent container as root is not allowed, then you can run a <code class="literal">DaemonSet</code> that adjusts the permissions for the Agent local state on each Node prior to running Elastic Agent. Note that this <code class="literal">DaemonSet</code> must be <code class="literal">runAsUser: 0</code> and possibly <code class="literal">privileged: true</code>. Also note the Kibana changes required to trust the Elasticsearch CA when running in fleet mode.
</li>
</ol>
</div>
<p>Full configuration examples exist in  <a class="xref" href="k8s-elastic-agent-fleet-configuration.html#k8s-elastic-agent-running-as-a-non-root-user" title="Running as a non-root user">Running as a non-root user</a>.</p>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="k8s-elastic-agent-configuration.html">« Configuration</a>
</span>
<span class="next">
<a href="k8s-elastic-agent-fleet.html">Run Fleet-managed Elastic Agent on ECK »</a>
</span>
</div>
</body>
</html>
