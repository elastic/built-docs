<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configuration | Elastic Cloud on Kubernetes [2.14] | Elastic</title>
<meta class="elastic" name="content" content="Configuration | Elastic Cloud on Kubernetes [2.14]">

<link rel="home" href="index.html" title="Elastic Cloud on Kubernetes [2.14]"/>
<link rel="up" href="k8s-enterprise-search.html" title="Run Enterprise Search on ECK"/>
<link rel="prev" href="k8s-enterprise-search-quickstart.html" title="Quickstart"/>
<link rel="next" href="k8s-enterprise-search-troubleshoot.html" title="Troubleshooting"/>
<meta class="elastic" name="product_version" content="2.14"/>
<meta class="elastic" name="product_name" content="ECK"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Kubernetes/Reference/2.14"/>
<meta name="DC.subject" content="ECK"/>
<meta name="DC.identifier" content="2.14"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="k8s-enterprise-search-quickstart.html">« Quickstart</a>
</span>
<span class="next">
<a href="k8s-enterprise-search-troubleshoot.html">Troubleshooting »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud on Kubernetes [2.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-orchestrating-elastic-stack-applications.html">Orchestrating Elastic Stack applications</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-enterprise-search.html">Run Enterprise Search on ECK</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configuration</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="k8s-enterprise-search-configuration"></a>Configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-enterprise-search-upgrade-specification"></a>Upgrade the Enterprise Search specification<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h3>
</div></div></div>
<p>You can upgrade the Enterprise Search version or change settings by editing the YAML specification. ECK will apply the changes by performing a rolling restart of Enterprise Search pods.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-enterprise-search-custom-configuration"></a>Customize Enterprise Search configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h3>
</div></div></div>
<p>ECK sets up a default Enterprise Search <a href="/guide/en/enterprise-search/current/configuration.html#configuration" class="ulink" target="_top">configuration</a>. To customize it, use the <code class="literal">config</code> element in the specification.</p>
<p>At a minimum, you must set both <code class="literal">ent_search.external_url</code> and <code class="literal">kibana.host</code> to the desired URLs.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apiVersion: enterprisesearch.k8s.elastic.co/v1
kind: EnterpriseSearch
metadata:
  name: enterprise-search-quickstart
spec:
  version: 8.14.3
  count: 1
  elasticsearchRef:
    name: quickstart
  config:
    # define the exposed URL at which users will reach Enterprise Search
    ent_search.external_url: https://my-custom-domain:3002
    # define the exposed URL at which users will reach Kibana
    kibana.host: https://kibana.my-custom-domain:5601
    # configure app search document size limit
    app_search.engine.document_size.limit: 100kb</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-enterprise-search-secret-configuration"></a>Reference Kubernetes Secrets for sensitive settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h3>
</div></div></div>
<p>Sensitive settings are best stored in Kubernetes Secrets, referenced in the Enterprise Search specification.</p>
<p>This example sets up a Secret with SMTP credentials:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apiVersion: enterprisesearch.k8s.elastic.co/v1
kind: EnterpriseSearch
metadata:
  name: enterprise-search-quickstart
spec:
  version: 8.14.3
  count: 1
  elasticsearchRef:
    name: quickstart
  config:
    ent_search.external_url: https://my-custom-domain:3002
    kibana.host: https://kibana.my-custom-domain:5601
  configRef:
    secretName: smtp-credentials
---
kind: Secret
apiVersion: v1
metadata:
  name: smtp-credentials
stringData:
  enterprise-search.yml: |-
    email.account.enabled: true
    email.account.smtp.auth: plain
    email.account.smtp.starttls.enable: false
    email.account.smtp.host: 127.0.0.1
    email.account.smtp.port: 25
    email.account.smtp.user: myuser
    email.account.smtp.password: mypassword
    email.account.email_defaults.from: my@email.com</pre>
</div>
<p>ECK merges the content of <code class="literal">config</code> and <code class="literal">configRef</code> into a single internal Secret. In case of duplicate settings, the <code class="literal">configRef</code> secret has precedence.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-enterprise-search-custom-pod-template"></a>Customize the Pod template<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h3>
</div></div></div>
<p>You can override the Enterprise Search Pod&#8217;s specification through the <code class="literal">podTemplate</code> element.</p>
<p>This example overrides the default 4Gi deployment to use 8Gi instead, and makes the deployment highly-available with 3 Pods:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apiVersion: enterprisesearch.k8s.elastic.co/v1
kind: EnterpriseSearch
metadata:
  name: enterprise-search-quickstart
spec:
  version: 8.14.3
  count: 3
  elasticsearchRef:
    name: quickstart
  podTemplate:
    spec:
      containers:
      - name: enterprise-search
        resources:
          requests:
            cpu: 3
            memory: 8Gi
          limits:
            memory: 8Gi
        env:
        - name: JAVA_OPTS
          value: -Xms7500m -Xmx7500m</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-enterprise-search-custom-pod-template-security-context"></a>Customize the Pod template security context<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h4>
</div></div></div>
<p>The Enterprise Search Pod&#8217;s security context can be customized through the <code class="literal">podTemplate</code> element.
However, if <code class="literal">readOnlyRootFilesystem</code> is set to <code class="literal">true</code> without additional configuration, the Pod will fail to start.
This happens because Enterprise Search (a Ruby service) requires write access to certain directories within <code class="literal">/usr/share/enterprise-search</code>, which include WAR files and configurations.</p>
<p>To work around this, use an init container to copy the necessary WAR files to a temporary writable location, before starting the Enterprise Search container with mounted writable volumes.
Having the temporary directories (<code class="literal">/tmp</code>) in-memory also ensures Ruby has a temporary directory to work with during startup.</p>
<p>This example demonstrates the workaround:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apiVersion: enterprisesearch.k8s.elastic.co/v1
kind: EnterpriseSearch
metadata:
  name: testing
spec:
  version: 8.14.3
  image: docker.elastic.co/enterprise-search/enterprise-search:8.14.3
  count: 1
  elasticsearchRef:
    name: testing
  podTemplate:
    spec:
      containers:
        - name: enterprise-search
          image: docker.elastic.co/enterprise-search/enterprise-search:8.14.3
          securityContext: <a id="CO27-1"></a><i class="conum" data-value="1"></i>
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            allowPrivilegeEscalation: false
            runAsUser: 1000 <a id="CO27-2"></a><i class="conum" data-value="2"></i>
          volumeMounts: <a id="CO27-3"></a><i class="conum" data-value="3"></i>
          - name: search-tmp
            mountPath: /usr/share/enterprise-search/tmp
          - name: tmp
            mountPath: /tmp
          - name: filebeat-data
            mountPath: /usr/share/enterprise-search/filebeat/data
          - name: war-files
            mountPath: /usr/share/enterprise-search/lib/war
          resources:
            requests:
              cpu: 3
              memory: 8Gi
            limits:
              memory: 8Gi
          env: <a id="CO27-4"></a><i class="conum" data-value="4"></i>
          - name: JAVA_OPTS
            value: -Xms7500m -Xmx7500m
      initContainers: <a id="CO27-5"></a><i class="conum" data-value="5"></i>
      - name: init-war-dir
        image: docker.elastic.co/enterprise-search/enterprise-search:8.14.3
        command: ['sh', '-c', 'cp --verbose -r /usr/share/enterprise-search/lib/war/. /usr/share/enterprise-search-war-tmp']
        volumeMounts:
        - name: war-files
          mountPath: /usr/share/enterprise-search-war-tmp
      volumes: <a id="CO27-6"></a><i class="conum" data-value="6"></i>
      - name: war-files
        emptyDir: {}
      - name: filebeat-data
        emptyDir: {}
      - name: search-tmp
        emptyDir:
          medium: Memory
      - name: tmp
        emptyDir:
          medium: Memory</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds a security context to define permissions and access control settings for the <code class="literal">enterprise-search</code> container.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Sets the user to random UID <code class="literal">1000</code> to run the container as a non-root user.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds volume mounts for <code class="literal">search-tmp</code>, <code class="literal">tmp</code>, <code class="literal">filebeat-data</code>, and <code class="literal">war-files</code> to the <code class="literal">enterprise-search</code> container.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds the variable <code class="literal">JAVA_OPTS</code> to pass options and configurations to the Java Virtual Machine (JVM).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds an init container to copy WAR files to a temporary location.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO27-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Adds volumes for WAR files and adds volumes with in-memory storage for <code class="literal">search-tmp</code> and <code class="literal">tmp</code>.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-enterprise-search-expose"></a>Expose Enterprise Search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h3>
</div></div></div>
<p>By default ECK manages self-signed TLS certificates to secure the connection to Enterprise Search. It also restricts the Kubernetes service to <code class="literal">ClusterIP</code> type that cannot be accessed publicly.</p>
<p>Check <a href="k8s-accessing-elastic-services.html" class="ulink" target="_top">how to access Elastic Stack services</a> to customize TLS settings and expose the service.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When exposed outside the scope of <code class="literal">localhost</code>, make sure to set both <code class="literal">ent_search.external_url</code>, and <code class="literal">kibana.host</code> accordingly in the Enterprise Search configuration.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-enterprise-search-connect-es"></a>Customize the connection to an Elasticsearch cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">elasticsearchRef</code> element allows ECK to automatically configure Enterprise Search to establish a secured connection to a managed Elasticsearch cluster. By default it targets all nodes in your cluster. If you want to direct traffic to specific nodes of your Elasticsearch cluster, refer to <a class="xref" href="k8s-traffic-splitting.html" title="Traffic Splitting"><em>Traffic Splitting</em></a> for more information and examples.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-enterprise-search-connect-non-eck-es"></a>Connect to an external Elasticsearch cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s_automatically"></a>Automatically<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h4>
</div></div></div>
<p>Refer to <a class="xref" href="k8s-connect-to-unmanaged-resources.html" title="Connect to external Elastic resources"><em>Connect to external Elastic resources</em></a> to automatically configure Enterprise Search using connection settings from a <code class="literal">Secret</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s_manually"></a>Manually<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/2.14/docs/orchestrating-elastic-stack-applications/enterprise-search.asciidoc">edit</a></h4>
</div></div></div>
<p>If you do not want to use the <code class="literal">elasticsearchRef</code> mechanism you can manually configure Enterprise Search to access any available Elasticsearch cluster:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apiVersion: enterprisesearch.k8s.elastic.co/v1
kind: EnterpriseSearch
metadata:
  name: enterprise-search-quickstart
spec:
  version: 8.14.3
  count: 1
  configRef:
    secretName: elasticsearch-credentials
---
kind: Secret
apiVersion: v1
metadata:
  name: elasticsearch-credentials
stringData:
  enterprise-search.yml: |-
    elasticsearch.host: &lt;a href="https://elasticsearch-url:9200" class="ulink" target="_top"&gt;https://elasticsearch-url:9200&lt;/a&gt;
    elasticsearch.username: elastic
    elasticsearch.password: my-password
    elasticsearch.ssl.enabled: true</pre>
</div>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="k8s-enterprise-search-quickstart.html">« Quickstart</a>
</span>
<span class="next">
<a href="k8s-enterprise-search-troubleshoot.html">Troubleshooting »</a>
</span>
</div>
</body>
</html>
