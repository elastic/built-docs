<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Enabling the metrics endpoint | Elastic Cloud on Kubernetes [master] | Elastic</title>
<meta class="elastic" name="content" content="Enabling the metrics endpoint | Elastic Cloud on Kubernetes [master]">

<link rel="home" href="index.html" title="Elastic Cloud on Kubernetes [master]"/>
<link rel="up" href="k8s-configure-operator-metrics.html" title="Configure the metrics endpoint"/>
<link rel="prev" href="k8s-configure-operator-metrics.html" title="Configure the metrics endpoint"/>
<link rel="next" href="k8s-securing-the-metrics-endpoint.html" title="Securing the metrics endpoint"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="ECK"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Kubernetes/Reference/master"/>
<meta name="DC.subject" content="ECK"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud on Kubernetes [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-operating-eck.html">Operating ECK</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-configure-operator-metrics.html">Configure the metrics endpoint</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="k8s-configure-operator-metrics.html">« Configure the metrics endpoint</a>
</span>
<span class="next">
<a href="k8s-securing-the-metrics-endpoint.html">Securing the metrics endpoint »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="k8s-enabling-the-metrics-endpoint"></a>Enabling the metrics endpoint<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/operating-eck/configure-operator-metrics.asciidoc">edit</a></h2>
</div></div></div>
<p>The metrics endpoint is not enabled by default. To enable the metrics endpoint, follow the instructions in the next sections depending on whether you installed ECK through the Helm chart or the manifests.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s_using_the_operator_helm_chart"></a>Using the operator Helm chart<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/operating-eck/configure-operator-metrics.asciidoc">edit</a></h3>
</div></div></div>
<p>If you installed ECK through the Helm chart commands listed in <a class="xref" href="k8s-install-helm.html" title="Install ECK using the Helm chart">Install ECK using the Helm chart</a>, you can now set  <code class="literal">config.metrics.port</code> to a value greater than 0 in your values file and the metrics endpoint will be enabled.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s_using_the_operator_manifests"></a>Using the operator manifests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/operating-eck/configure-operator-metrics.asciidoc">edit</a></h3>
</div></div></div>
<p>If you installed ECK using the manifests using the commands listed in <a class="xref" href="k8s-deploy-eck.html" title="Deploy ECK in your Kubernetes cluster"><em>Deploy ECK in your Kubernetes cluster</em></a> some additional changes will be required to enable the metrics endpoint.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Enable the metrics endpoint in the <code class="literal">ConfigMap</code>.
</li>
</ul>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">cat &lt;&lt;EOF | kubectl apply -f -
kind: ConfigMap
apiVersion: v1
metadata:
  name: elastic-operator
  namespace: elastic-system
data:
  eck.yaml: |-
    log-verbosity: 0
    metrics-port: 8080
    metrics-host: 0.0.0.0
    container-registry: docker.elastic.co
    max-concurrent-reconciles: 3
    ca-cert-validity: 8760h
    ca-cert-rotate-before: 24h
    cert-validity: 8760h
    cert-rotate-before: 24h
    disable-config-watch: false
    exposed-node-labels: [topology.kubernetes.io/.*,failure-domain.beta.kubernetes.io/.*]
    set-default-security-context: auto-detect
    kube-client-timeout: 60s
    elasticsearch-client-timeout: 180s
    disable-telemetry: false
    distribution-channel: all-in-one
    validate-storage-class: true
    enable-webhook: true
    webhook-name: elastic-webhook.k8s.elastic.co
    webhook-port: 9443
    operator-namespace: elastic-system
    enable-leader-election: true
    elasticsearch-observation-interval: 10s
    ubi-only: false
EOF</pre>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Patch the <code class="literal">StatefulSet</code> to expose the metrics port.
</li>
</ul>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">kubectl patch sts -n elastic-system elastic-operator --patch-file=/dev/stdin &lt;&lt;-EOF
spec:
  template:
    spec:
      containers:
        - name: manager
          ports:
          - containerPort: 9443
            name: https-webhook
            protocol: TCP
          - containerPort: 8080
            protocol: TCP
            name: metrics
EOF</pre>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Restart the ECK operator.
</li>
</ul>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">kubectl delete pod -n elastic-system elastic-operator-0</pre>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If using the Prometheus operator, install a <code class="literal">PodMonitor</code> to allow scraping of the metrics endpoint by Prometheus.
</li>
</ul>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  name: elastic-operator
  namespace: elastic-system
  labels:
    control-plane: elastic-operator
    app.kubernetes.io/component: metrics
spec:
  podMetricsEndpoints:
    - port: metrics
      path: /metrics
      interval: 1m
      scrapeTimeout: 30s
  namespaceSelector:
    matchNames:
      - elastic-system
  selector:
    matchLabels:
      control-plane: elastic-operator
EOF</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="k8s-configure-operator-metrics.html">« Configure the metrics endpoint</a>
</span>
<span class="next">
<a href="k8s-securing-the-metrics-endpoint.html">Securing the metrics endpoint »</a>
</span>
</div>
</div>
</body>
</html>
