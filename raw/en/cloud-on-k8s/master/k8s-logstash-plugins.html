<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Logstash plugins | Elastic Cloud on Kubernetes [master] | Elastic</title>
<meta class="elastic" name="content" content="Logstash plugins | Elastic Cloud on Kubernetes [master]">

<link rel="home" href="index.html" title="Elastic Cloud on Kubernetes [master]"/>
<link rel="up" href="k8s-logstash.html" title="Run Logstash on ECK"/>
<link rel="prev" href="k8s-logstash-securing-api.html" title="Securing Logstash API"/>
<link rel="next" href="k8s-logstash-configuration-examples.html" title="Configuration examples"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="ECK"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Kubernetes/Reference/master"/>
<meta name="DC.subject" content="ECK"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Cloud on Kubernetes [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-orchestrating-elastic-stack-applications.html">Orchestrating Elastic Stack applications</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="k8s-logstash.html">Run Logstash on ECK</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="k8s-logstash-securing-api.html">« Securing Logstash API</a>
</span>
<span class="next">
<a href="k8s-logstash-configuration-examples.html">Configuration examples »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="k8s-logstash-plugins"></a>Logstash plugins<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h2>
</div></div></div>
<p>The power of Logstash is in the plugins&#8212;&#8203;<a href="/guide/en/logstash/8.14/input-plugins.html" class="ulink" target="_top">inputs</a>, <a href="/guide/en/logstash/8.14/output-plugins.html" class="ulink" target="_top">outputs</a>, <a href="/guide/en/logstash/8.14/filter-plugins.html" class="ulink" target="_top">filters,</a> and <a href="/guide/en/logstash/8.14/codec-plugins.html" class="ulink" target="_top">codecs</a>.</p>
<p>In Logstash on ECK, you can use the same plugins that you use for other Logstash instances&#8212;&#8203;including Elastic-supported, community-supported, and custom plugins.
However, you may have other factors to consider, such as how you configure your Kubernetes resources, how you specify additional resources, and how you scale your Logstash installation.</p>
<p>In this section, we&#8217;ll cover:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-plugin-resources" title="Providing additional resources for plugins">Providing additional resources for plugins (read-only and writable storage)</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-working-with-plugins-scaling" title="Scaling Logstash on ECK">Scaling Logstash on ECK</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-working-with-plugin-considerations" title="Plugin-specific considerations">Plugin-specific considerations</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-working-with-custom-plugins" title="Adding custom plugins">Adding custom plugins</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-plugin-resources"></a>Providing additional resources for plugins<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h3>
</div></div></div>
<p>The plugins in your pipeline can impact how you can configure your Kubernetes resources, including the need to specify additional resources in your manifest.
The most common resources you need to allow for are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Read-only assets, such as private keys, translate dictionaries, or JDBC drivers
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-working-with-plugins-writable" title="Writable storage">Writable storage</a> to save application state
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-working-with-plugins-ro"></a>Read-only assets<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>Many plugins require or allow read-only assets in order to work correctly.
These may be ConfigMaps or Secrets files that have a 1 MiB limit, or larger assets such as JDBC drivers, that need to be stored in a PersistentVolume.</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="k8s-logstash-working-with-plugins-small-ro"></a>ConfigMaps and Secrets (1 MiB max)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h5>
</div></div></div>
<p>Each instance of a <code class="literal">ConfigMap</code> or <code class="literal">Secret</code> has a <a href="https://kubernetes.io/docs/concepts/configuration/configmap/#:~:text=The%20data%20stored%20in%20a,separate%20database%20or%20file%20service" class="ulink" target="_top">maximum size</a> of 1 MiB (mebibyte).
For larger read-only assets, check out <a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-working-with-plugins-large-ro" title="Larger read-only assets (1 MiB+)">Larger read-only assets (1 MiB+)</a>.</p>
<p>In the plugin documentation, look for configurations that call for a <code class="literal">path</code> or an <code class="literal">array</code> of <code class="literal">paths</code>.</p>
<p><span class="strong strong"><strong>Sensitive assets, such as private keys</strong></span></p>
<p>Some plugins need access to private keys or certificates in order to access an external resource.
Make the keys or certificates available to the Logstash resource in your manifest.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>These settings are typically identified by an <code class="literal">ssl_</code> prefix, such as <code class="literal">ssl_key</code>, <code class="literal">ssl_keystore_path</code>, <code class="literal">ssl_certificate</code>, for example.</p>
</div>
</div>
<p>To use these in your manifest, create a Secret representing the asset, a Volume in your <code class="literal">podTemplate.spec</code> containing that Secret, and then mount that Volume with a VolumeMount in the <code class="literal">podTemplateSpec.container</code> section of your Logstash resource.</p>
<p>First, create your secrets.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">kubectl create secret generic logstash-crt --from-file=logstash.crt
kubectl create secret generic logstash-key --from-file=logstash.key</pre>
</div>
<p>Then, create your Logstash resource.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">spec:
  podTemplate:
    spec:
      volumes:
        - name: logstash-ssl-crt
          secret:
            secretName: logstash-crt
        - name: logstash-ssl-key
          secret:
            secretName: logstash-key
      containers:
        - name: logstash
          volumeMounts:
            - name: logstash-ssl-key
              mountPath: "/usr/share/logstash/data/logstash.key"
              readOnly: true
            - name: logstash-ssl-crt
              mountPath: "/usr/share/logstash/data/logstash.crt"
              readOnly: true
  pipelines:
    - pipeline.id: main
      config.string: |
        input {
          http {
            port =&gt; 8443
            ssl_certificate =&gt; "/usr/share/logstash/data/logstash.crt"
            ssl_key =&gt; "/usr/share/logstash/data/logstash.key"
          }
        }</pre>
</div>
<p><span class="strong strong"><strong>Static read-only files</strong></span></p>
<p>Some plugins require or allow access to small static read-only files.
You can use these for a variety of reasons.
Examples include adding custom <code class="literal">grok</code> patterns for <a href="/guide/en/logstash/8.14/plugins-filters-grok.html" class="ulink" target="_top"><code class="literal">logstash-filter-grok</code></a> to use for lookup, source code for [<code class="literal">logstash-filter-ruby</code>], a dictionary for <a href="/guide/en/logstash/8.14/plugins-filters-translate.html" class="ulink" target="_top"><code class="literal">logstash-filter-translate</code></a> or the location of a SQL statement for <a href="/guide/en/logstash/8.14/plugins-inputs-jdbc.html" class="ulink" target="_top"><code class="literal">logstash-input-jdbc</code></a>.
Make these files available to the Logstash resource in your manifest.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>In the plugin documentation, these plugin settings are typically identified by <code class="literal">path</code> or an <code class="literal">array</code> of <code class="literal">paths</code>.</p>
</div>
</div>
<p>To use these in your manifest, create a ConfigMap or Secret representing the asset, a Volume in your <code class="literal">podTemplate.spec</code> containing the ConfigMap or Secret, and mount that Volume with a VolumeMount in your <code class="literal">podTemplateSpec.container</code> section of your Logstash resource.</p>
<p>This example illustrates configuring a ConfigMap from a ruby source file, and including it in a <a href="/guide/en/logstash/8.14/plugins-filters-ruby.html" class="ulink" target="_top"><code class="literal">logstash-filter-ruby</code></a> plugin.</p>
<p>First, create the ConfigMap.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">kubectl create configmap ruby --from-file=drop_some.rb</pre>
</div>
<p>Then, create your Logstash resource.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">spec:
  podTemplate:
    spec:
      volumes:
        - name: ruby_drop
          configMap:
            name: ruby
      containers:
        - name: logstash
          volumeMounts:
            - name: ruby_drop
              mountPath: "/usr/share/logstash/data/drop_percentage.rb"
              readOnly: true
  pipelines:
    - pipeline.id: main
      config.string: |
        input {
          beats {
            port =&gt; 5044
          }
        }
        filter {
          ruby {
            path =&gt; "/usr/share/logstash/data/drop_percentage.rb"
            script_params =&gt; { "percentage" =&gt; 0.9 }
          }
        }</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-working-with-plugins-large-ro"></a>Larger read-only assets (1 MiB+)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>Some plugins require or allow access to static read-only files that exceed the 1 MiB (mebibyte) limit imposed by ConfigMap and Secret.
For example, you may need JAR files to load drivers when using a JDBC or JMS plugin, or a large <a href="/guide/en/logstash/8.14/plugins-filters-translate.html" class="ulink" target="_top"><code class="literal">logstash-filter-translate</code></a> dictionary.</p>
<p>You can add files using:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong><a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-ic" title="Add files using PersistentVolume populated by an initContainer">PersistentVolume populated by an initContainer</a>.</strong></span> Add a volumeClaimTemplate and a volumeMount to your Logstash resource and upload data to that volume, either using an <code class="literal">initContainer</code>, or direct upload if your Kubernetes provider supports it.
You can use the default <code class="literal">logstash-data</code> volumeClaimTemplate , or a custom one depending on your storage needs.
</li>
<li class="listitem">
<span class="strong strong"><strong><a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-custom-images" title="Add files using a custom Docker image">Custom Docker image</a>.</strong></span> Use a custom docker image that includes the static content that your Logstash pods will need.
</li>
</ul>
</div>
<p>Check out <a class="xref" href="k8s-bundles-plugins.html" title="Custom configuration files and plugins">Custom configuration files and plugins</a> for more details on which option might be most suitable for you.</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="k8s-logstash-ic"></a>Add files using PersistentVolume populated by an initContainer<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h5>
</div></div></div>
<p>This example creates a volumeClaimTemplate called <code class="literal">workdir</code>, with volumeMounts referring to this mounted to the main container and an initContainer. The initContainer initiates a  download of a PostgreSQL JDBC driver JAR file, and stored it the volumeMount, which is then used in the JDBC input in the pipeline configuration.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">spec:
  podTemplate:
    spec:
      initContainers:
      - name: download-postgres
        command: ["/bin/sh"]
        args: ["-c", "curl -o /data/postgresql.jar -L https://jdbc.postgresql.org/download/postgresql-42.6.0.jar"]
        volumeMounts:
          - name: workdir
            mountPath: /data
      containers:
        - name: logstash
          volumeMounts:
            - name: workdir
              mountPath: /usr/share/logstash/jars <a id="CO32-1"></a><i class="conum" data-value="1"></i>
  volumeClaimTemplates:
    - metadata:
        name: workdir
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 50Mi
  pipelines:
    - pipeline.id: main
      config.string: |
        input {
          jdbc {
             jdbc_driver_library =&gt; "/usr/share/logstash/jars/postgresql.jar"
             jdbc_driver_class =&gt; "org.postgresql.Driver"
             <a id="CO32-2"></a><i class="conum" data-value="2"></i>
          }
        }</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO32-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Should match the <code class="literal">mountPath</code> of the <code class="literal">container</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO32-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Remainder of plugin configuration goes here</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="k8s-logstash-custom-images"></a>Add files using a custom Docker image<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h5>
</div></div></div>
<p>This example downloads the same <code class="literal">postgres</code> JDBC driver, and adds it to the Logstash classpath in the Docker image.</p>
<p>First, create a Dockerfile based on the Logstash Docker image.
Download the JDBC driver, and save it alongside the other JAR files in the Logstash classpath:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">FROM docker.elastic.co/logstash/logstash:8.14.0
RUN curl -o /usr/share/logstash/logstash-core/lib/jars/postgresql.jar -L https://jdbc.postgresql.org/download/postgresql-42.6.0.jar <a id="CO33-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Placing the JAR file in the <code class="literal">/usr/share/logstash/logstash-core/lib/jars</code> folder adds it to the Logstash classpath.</p>
</td>
</tr>
</table>
</div>
<p>After you build and deploy the custom image, include it in the Logstash manifest.
Check out <a class="xref" href="k8s-custom-images.html" title="Create custom images"><em>Create custom images</em></a> for more details.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">  count: 1
  version: {version} <a id="CO34-1"></a><i class="conum" data-value="1"></i>
  image: &lt;CUSTOM_IMAGE&gt;
  pipelines:
    - pipeline.id: main
      config.string: |
        input {
          jdbc {
              <a id="CO34-2"></a><i class="conum" data-value="2"></i>
             jdbc_driver_class =&gt; "org.postgresql.Driver"
              <a id="CO34-3"></a><i class="conum" data-value="3"></i>
          }
        }</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The correct version is required as ECK reasons about available APIs and capabilities based on the version field.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note that when you place the JAR file on the Logstash classpath, you do not need to specify the <code class="literal">jdbc_driver_library</code> location in the plugin configuration.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Remainder of plugin configuration goes here</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-working-with-plugins-writable"></a>Writable storage<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>Some Logstash plugins need access to writable storage.
This could be for checkpointing to keep track of events already processed, a place to temporarily write events before sending a batch of events, or just to actually write events to disk in the case of <a href="/guide/en/logstash/8.14/plugins-outputs-file.html" class="ulink" target="_top"><code class="literal">logstash-output-file</code></a>.</p>
<p>Logstash on ECK by default supplies a small 1.5 GiB (gibibyte) default persistent volume to each pod.
This volume is called <code class="literal">logstash-data</code> and is located at <code class="literal">/usr/logstash/data</code>, and is typically the default location for most plugin use cases.
This volume is stable across restarts of Logstash pods and is suitable for many use cases.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When plugins use writable storage, each plugin must store its data a dedicated folder or file to avoid overwriting data.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="k8s-logstash-working-with-plugins-writable-checkpointing"></a>Checkpointing<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h5>
</div></div></div>
<p>Some Logstash plugins need to write "checkpoints" to local storage in order to keep track of events that have already been processed.
Plugins that retrieve data from external sources need to do this if the external source does not provide any mechanism to track state internally.</p>
<p>Not all external data sources have mechanisms to track state internally, and Logstash checkpoints can help persist data.</p>
<p>In the plugin documentation, look for configurations that call for a <code class="literal">path</code> with a settings like <code class="literal">sincedb</code>, <code class="literal">sincedb_path</code>, <code class="literal">sequence_path</code>, or <code class="literal">last_run_metadata_path</code>. Check out specific plugin documentation in the <a href="/guide/en/logstash/8.14" class="ulink" target="_top">Logstash Reference</a> for details.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">spec:
  pipelines:
    - pipeline.id: main
      config.string: |
        input {
          jdbc {
             jdbc_driver_library =&gt; "/usr/share/logstash/jars/postgresql.jar"
             jdbc_driver_class =&gt; "org.postgresql.Driver"
             last_metadata_path =&gt; "/usr/share/logstash/data/main/logstash_jdbc_last_run <a id="CO35-1"></a><i class="conum" data-value="1"></i>
          }
        }</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO35-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>If you are using more than one plugin of the same type, specify a unique location for each plugin to use.</p>
</td>
</tr>
</table>
</div>
<p>If the default <code class="literal">logstash-data</code> volume is insufficient for your needs, see the volume section for details on how to add additional volumes.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="k8s-logstash-working-with-plugins-writable-temp"></a>Writable staging or temporary data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h5>
</div></div></div>
<p>Some Logstash plugins write data to a staging directory or file before processing for input, or outputting to their final destination.
Often these staging folders can be persisted across restarts to avoid duplicating processing of data.</p>
<p>In the plugin documentation, look for  names such as <code class="literal">tmp_directory</code>, <code class="literal">temporary_directory</code>, <code class="literal">staging_directory</code>.</p>
<p>To persist data across pod restarts, set this value to point to the default <code class="literal">logstash-data</code> volume or your own PersistentVolumeClaim.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">spec:
  pipelines:
    - pipeline.id: main
      config.string: |
        output {
          s3 {
             id =&gt; "main_s3_output"
             temporary_directory =&gt; "/usr/share/logstash/data/main/main_s3_output<a id="CO36-1"></a><i class="conum" data-value="1"></i>
          }
        }</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>If you are using more than one plugin of the same type, specify a unique location for each plugin to use.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-logstash-working-with-plugins-scaling"></a>Scaling Logstash on ECK<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The use of autoscalers, such as the HorizontalPodAutoscaler or the VerticalPodAutoscaler, with Logstash on ECK is not yet supported.</p>
</div>
</div>
<p>Logstash scalability is highly dependent on the plugins in your pipelines.
Some plugins can restrict how you can scale out your Logstash deployment, based on the way that the plugins gather or enrich data.</p>
<p>Plugin categories that require special considerations are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-agg-filters" title="Filter plugins: aggregating filters">Filter plugins: aggregating filters</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-inputs-data-pushed" title="Input plugins: events pushed to Logstash">Input plugins: events pushed to Logstash</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-inputs-local-checkpoints" title="Input plugins: Logstash maintains state">Input plugins: Logstash maintains state</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-inputs-external-state" title="Input plugins: external source stores state">Input plugins: external source stores state</a>
</li>
</ul>
</div>
<p>If the pipeline <em>does not</em> contain any plugins from these categories, you can increase the number of Logstash instances by setting the <code class="literal">count</code> property in the Logstash resource:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apiVersion: logstash.k8s.elastic.co/v1alpha1
kind: Logstash
metadata:
  name: quickstart
spec:
  version: 8.14.0
  count: 3</pre>
</div>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Horizontal scaling for Logstash plugins</strong></p>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Not all Logstash deployments can be scaled horizontally by increasing the number of Logstash Pods defined in the Logstash resource.
Depending on the types of plugins in a Logstash installation, increasing the number of pods may cause data duplication, data loss, incorrect data, or may waste resources with pods unable to be utilized correctly.
</li>
<li class="listitem">
The ability of a Logstash installation to scale horizontally is bound by its most restrictive plugin(s). Even if all pipelines are using <a href="/guide/en/logstash/8.14/plugins-inputs-elastic_agent.html" class="ulink" target="_top"><code class="literal">logstash-input-elastic_agent</code></a> or <a href="/guide/en/logstash/8.14/plugins-inputs-beats.html" class="ulink" target="_top"><code class="literal">logstash-input-beats</code></a> which should enable full horizontal scaling, introducing a more restrictive input or filter plugin forces the restrictions for pod scaling associated with that plugin.
</li>
</ul>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-agg-filters"></a>Filter plugins: aggregating filters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>Logstash installations that use aggregating filters should be treated with particular care:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
They <span class="strong strong"><strong>must</strong></span> specify <code class="literal">pipeline.workers=1</code> for any pipelines that use them.
</li>
<li class="listitem">
The number of pods cannot be scaled above 1.
</li>
</ul>
</div>
<p>Examples of aggregating filters include <a href="/guide/en/logstash/8.14/plugins-filters-aggregate.html" class="ulink" target="_top"><code class="literal">logstash-filter-aggregate</code></a>, <a href="/guide/en/logstash/8.14/plugins-filters-csv.html" class="ulink" target="_top"><code class="literal">logstash-filter-csv</code></a> when <code class="literal">autodetect_column_names</code> set to <code class="literal">true</code>, and any <a href="/guide/en/logstash/8.14/plugins-filters-ruby.html" class="ulink" target="_top"><code class="literal">logstash-filter-ruby</code></a> implementations that perform aggregations.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-inputs-data-pushed"></a>Input plugins: events pushed to Logstash<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>Logstash installations with inputs that enable Logstash to receive data should be able to scale freely and have load spread across them horizontally.
These plugins include <a href="/guide/en/logstash/8.14/plugins-inputs-beats.html" class="ulink" target="_top"><code class="literal">logstash-input-beats</code></a>, <a href="/guide/en/logstash/8.14/plugins-inputs-elastic_agent.html" class="ulink" target="_top"><code class="literal">logstash-input-elastic_agent</code></a>,  <a href="/guide/en/logstash/8.14/plugins-inputs-tcp.html" class="ulink" target="_top"><code class="literal">logstash-input-tcp</code></a>, and <a href="/guide/en/logstash/8.14/plugins-inputs-http.html" class="ulink" target="_top"><code class="literal">logstash-input-http</code></a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-inputs-local-checkpoints"></a>Input plugins: Logstash maintains state<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>Logstash installations that use input plugins that retrieve data from an external source, and <span class="strong strong"><strong>maintain local checkpoint state</strong></span>, or would require some level of co-ordination between nodes to split up work can specify <code class="literal">pipeline.workers</code> freely, but should keep the pod count at 1 for each Logstash installation.</p>
<p>Note that plugins that retrieve data from external sources, and require some level of coordination between nodes to split up work, are not good candidates for scaling horizontally, and would likely produce some data duplication.</p>
<p>Input plugins that include configuration settings such as  <code class="literal">sincedb</code>, <code class="literal">checkpoint</code> or <code class="literal">sql_last_run_metadata</code> may fall into this category.</p>
<p>Examples of these plugins include <a href="/guide/en/logstash/8.14/plugins-inputs-jdbc.html" class="ulink" target="_top"><code class="literal">logstash-input-jdbc</code></a> (which has no automatic way to split queries across Logstash instances), <a href="/guide/en/logstash/8.14/plugins-inputs-s3.html" class="ulink" target="_top"><code class="literal">logstash-input-s3</code></a> (which has no way to split which buckets to read across Logstash instances), or <a href="/guide/en/logstash/8.14/plugins-inputs-file.html" class="ulink" target="_top"><code class="literal">logstash-input-file</code></a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-inputs-external-state"></a>Input plugins: external source stores state<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>Logstash installations that use input plugins that retrieve data from an external source, and <span class="strong strong"><strong>rely on the external source to store state</strong></span> can scale based on the parameters of the external source.</p>
<p>For example, a Logstash installation that uses a <a href="/guide/en/logstash/8.14/plugins-inputs-kafka.html" class="ulink" target="_top"><code class="literal">logstash-input-kafka</code></a> plugin to retrieve data can scale the number of pods up to the number of partitions used, as a partition can have at most one consumer belonging to the same consumer group.
Any pods created beyond that threshold cannot be scheduled to receive data.</p>
<p>Examples of these plugins include <a href="/guide/en/logstash/8.14/plugins-inputs-kafka.html" class="ulink" target="_top"><code class="literal">logstash-input-kafka</code></a>, <a href="/guide/en/logstash/8.14/plugins-inputs-azure_event_hubs.html" class="ulink" target="_top"><code class="literal">logstash-input-azure_event_hubs</code></a>, and <a href="/guide/en/logstash/8.14/plugins-inputs-kinesis.html" class="ulink" target="_top"><code class="literal">logstash-input-kinesis</code></a>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-logstash-working-with-plugin-considerations"></a>Plugin-specific considerations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h3>
</div></div></div>
<p>Some plugins have additional requirements and guidelines for optimal performance in a Logstash ECK environment.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-plugin-considerations-ls-integration" title="Logstash integration plugin">Logstash integration plugin</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-plugin-considerations-es-output" title="Elasticsearch output plugin">Elasticsearch output plugin</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-plugin-considerations-integration-filter" title="Elastic_integration filter plugin">Elastic_integration filter plugin</a>
</li>
<li class="listitem">
<a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-plugin-considerations-agent-beats" title="Elastic Agent input and Beats input plugins">Elastic Agent input and Beats input plugins</a>
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Use these guidelines <em>in addition</em> to the general guidelines provided in <a class="xref" href="k8s-logstash-plugins.html#k8s-logstash-working-with-plugins-scaling" title="Scaling Logstash on ECK">Scaling Logstash on ECK</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-plugin-considerations-ls-integration"></a>Logstash integration plugin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>When your pipeline uses the <a href="/guide/en/logstash/8.14/plugins-integrations-logstash.html" class="ulink" target="_top"><code class="literal">Logstash integration</code></a> plugin, add <code class="literal">keepalive=&gt;false</code> to the <a href="/guide/en/logstash/8.14/plugins-outputs-logstash.html" class="ulink" target="_top">logstash-output</a> definition to ensure that load balancing works correctly rather than keeping affinity to the same pod.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-plugin-considerations-es-output"></a>Elasticsearch output plugin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>The <a href="/guide/en/logstash/8.14/plugins-outputs-elasticsearch.html" class="ulink" target="_top"><code class="literal">elasticsearch output</code></a> plugin requires certain roles to be configured in order to enable Logstash to communicate with Elasticsearch.</p>
<p>You can customize roles in Elasticsearch. Check out <a class="xref" href="k8s-users-and-roles.html" title="Users and roles">creating custom roles</a></p>
<div class="pre_wrapper lang-logstash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-logstash">kind: Secret
apiVersion: v1
metadata:
  name: my-roles-secret
stringData:
  roles.yml: |-
    eck_logstash_user_role:
      "cluster": ["monitor", "manage_ilm", "read_ilm", "manage_logstash_pipelines", "manage_index_templates", "cluster:admin/ingest/pipeline/get"],
      "indices": [
        {
          "names": [ "logstash", "logstash-*", "ecs-logstash", "ecs-logstash-*", "logs-*", "metrics-*", "synthetics-*", "traces-*" ],
          "privileges": ["manage", "write", "create_index", "read", "view_index_metadata"]
        }
      ]</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-plugin-considerations-integration-filter"></a>Elastic_integration filter plugin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>The <a href="/guide/en/logstash/8.14/plugins-filters-elastic_integration.html" class="ulink" target="_top"><code class="literal">elastic_integration filter</code></a> plugin allows the use of <a class="xref" href="k8s-logstash-configuration.html#k8s-logstash-esref" title="elasticsearchRefs for establishing a secured connection"><code class="literal">ElasticsearchRef</code></a> and environment variables.</p>
<div class="pre_wrapper lang-logstash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-logstash">  elastic_integration {
            pipeline_name =&gt; "logstash-pipeline"
            hosts =&gt; [ "${ECK_ES_HOSTS}" ]
            username =&gt; "${ECK_ES_USER}"
            password =&gt; "${ECK_ES_PASSWORD}"
            ssl_certificate_authorities =&gt; "${ECK_ES_SSL_CERTIFICATE_AUTHORITY}"
          }</pre>
</div>
<p>The Elastic_integration filter requires certain roles to be configured on the Elasticsearch cluster to enable Logstash to read ingest pipelines.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml"># Sample role definition
kind: Secret
apiVersion: v1
metadata:
  name: my-roles-secret
stringData:
  roles.yml: |-
    eck_logstash_user_role:
      cluster: [ "monitor", "manage_index_templates", "read_pipeline"]</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="k8s-logstash-plugin-considerations-agent-beats"></a>Elastic Agent input and Beats input plugins<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h4>
</div></div></div>
<p>When you use the <a href="/guide/en/logstash/8.14/plugins-inputs-elastic_agent.html" class="ulink" target="_top">Elastic Agent input</a> or the <a href="/guide/en/logstash/8.14/plugins-inputs-beats.html" class="ulink" target="_top">Beats input</a>,
set the <a href="/guide/en/beats/filebeat/8.14/logstash-output.html#_ttl" class="ulink" target="_top"><code class="literal">ttl</code></a> value on the Agent or Beat to ensure that load is distributed appropriately.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s-logstash-working-with-custom-plugins"></a>Adding custom plugins<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/main/docs/orchestrating-elastic-stack-applications/logstash.asciidoc">edit</a></h3>
</div></div></div>
<p>If you need plugins in addition to those included in the standard Logstash distribution, you can add them.
Create a custom Docker image that includes the installed plugins, using the <code class="literal">bin/logstash-plugin install</code> utility to add more plugins to the image so that they can be used by Logstash pods.</p>
<p>This sample Dockerfile installs the <a href="/guide/en/logstash/8.14/plugins-filters-tld.html" class="ulink" target="_top"><code class="literal">logstash-filter-tld</code></a> plugin to the official Logstash Docker image:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">FROM docker.elastic.co/logstash/logstash:8.14.0
RUN bin/logstash-plugin install logstash-filter-tld</pre>
</div>
<p>Then after building and deploying the custom image (refer to <a class="xref" href="k8s-custom-images.html" title="Create custom images"><em>Create custom images</em></a> for more details), include it in the Logstash manifest:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">spec:
  count: 1
  version: 8.14.0 <a id="CO37-1"></a><i class="conum" data-value="1"></i>
  image: &lt;CUSTOM_IMAGE&gt;</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The correct version is required as ECK reasons about available APIs and capabilities based on the version field.</p>
</td>
</tr>
</table>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="k8s-logstash-securing-api.html">« Securing Logstash API</a>
</span>
<span class="next">
<a href="k8s-logstash-configuration-examples.html">Configuration examples »</a>
</span>
</div>
</div>
</body>
</html>
