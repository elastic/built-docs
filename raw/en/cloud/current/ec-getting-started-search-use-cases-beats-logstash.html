<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ingest data from Beats to Elastic Cloud with Logstash as a proxy | Elasticsearch Service Documentation | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Service Documentation"/>
<link rel="up" href="ec-cloud-ingest-data.html" title="Indexing data into Elasticsearch"/>
<link rel="prev" href="ec-getting-started-python.html" title="Ingest data with Python on Elastic Cloud"/>
<link rel="next" href="ec-getting-started-search-use-cases-db-logstash.html" title="Ingest data from a relational database into Elastic Cloud"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="latest"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation</a></span>
»
<span class="breadcrumb-link"><a href="ec-cloud-ingest-data.html">Indexing data into Elasticsearch</a></span>
»
<span class="breadcrumb-node">Ingest data from Beats to Elastic Cloud with Logstash as a proxy</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ec-getting-started-python.html">« Ingest data with Python on Elastic Cloud</a>
</span>
<span class="next">
<a href="ec-getting-started-search-use-cases-db-logstash.html">Ingest data from a relational database into Elastic Cloud »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ec-getting-started-search-use-cases-beats-logstash"></a>Ingest data from Beats to Elastic Cloud with Logstash as a proxy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h2>
</div></div></div>
<p>This guide explains how to ingest data from Filebeat and Metricbeat to Logstash as an intermediary, and then send that data to Elastic Cloud. Using Logstash as a proxy limits your Elastic stack traffic through a single, external-facing firewall exception or rule. Consider the following features of this type of setup:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>You can send multiple instances of Beats data through your local network’s demilitarized zone (DMZ) to Logstash. Logstash then acts as a proxy through your firewall to send the Beats data to Elastic Cloud, as shown in the following diagram:</p>
<p><span class="image"><img src="images/ec-logstash-beats-dataflow.png" alt="A diagram showing data from multiple Beats into Logstash" width="output to Elasticsearch" height="and viewable from Kibana"></span></p>
</li>
<li class="listitem">
This proxying reduces the firewall exceptions or rules necessary for Beats to communicate with Elasticsearch Service. It’s common to have many Beats dispersed across a network, each installed close to the data that it monitors, and each Beat individually communicating with an Elastic Cloud deployment. Multiple Beats support multiple servers. Rather than configure each Beat to send its data directly to Elasticsearch Service, you can use Logstash to proxy this traffic through one firewall exception or rule.
</li>
<li class="listitem">
This setup is not suitable in simple scenarios when there is only one or a couple of Beats in use. Logstash makes the most sense for proxying when there are many Beats.
</li>
</ul>
</div>
<p>The configuration in this example makes use of the System module, available for both Filebeat and Metricbeat. Filebeat’s System sends server system log details (that is, login success/failures, sudo <em>superuser do</em> command usage, and other key usage details). Metricbeat’s System module sends memory, CPU, disk, and other server usage metrics.</p>
<p>In the following sections you are going to learn how to:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ec-getting-started-search-use-cases-beats-logstash.html#ec-beats-logstash-instance" title="Get Logstash and Elasticsearch Service">Get Logstash and Elasticsearch Service</a>
</li>
<li class="listitem">
<a class="xref" href="ec-getting-started-search-use-cases-beats-logstash.html#ec-beats-logstash-metricbeat" title="Set up Metricbeat">Set up Metricbeat</a>
</li>
<li class="listitem">
<a class="xref" href="ec-getting-started-search-use-cases-beats-logstash.html#ec-beats-logstash-filebeat" title="Set up FileBeat">Set up FileBeat</a>
</li>
<li class="listitem">
<a class="xref" href="ec-getting-started-search-use-cases-beats-logstash.html#ec-beats-logstash-listen" title="Configure Logstash to listen for Beats">Configure Logstash to listen for Beats</a>
</li>
<li class="listitem">
<a class="xref" href="ec-getting-started-search-use-cases-beats-logstash.html#ec-beats-logstash-stdout" title="Output Logstash data to stdout">Output Logstash data to stdout</a>
</li>
<li class="listitem">
<a class="xref" href="ec-getting-started-search-use-cases-beats-logstash.html#ec-beats-logstash-elasticsearch" title="Output Logstash data to Elasticsearch">Output Logstash data to Elasticsearch</a>
</li>
<li class="listitem">
<a class="xref" href="ec-getting-started-search-use-cases-beats-logstash.html#ec-beats-logstash-view-kibana" title="View data in Kibana">View data in Kibana</a>
</li>
</ol>
</div>
<p><em>Time required: 1 hour</em></p>
<h3><a id="ec-beats-logstash-instance"></a>Get Logstash and Elasticsearch Service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a href="/cloud/elasticsearch-service/signup?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">Get a free trial</a>.
</li>
<li class="listitem">
Log into <a href="https://cloud.elastic.co?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">Elastic Cloud</a>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create deployment</strong></span>.
</li>
<li class="listitem">
Give your deployment a name. You can leave all other settings at their default values.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create deployment</strong></span> and save your Elastic deployment credentials. You will need these credentials later on.
</li>
<li class="listitem">
<p>You also need the Cloud ID later on, as it simplifies sending data to Elastic Cloud. Click on the deployment name from the Elastic Cloud portal or the <span class="strong strong"><strong>Deployments</strong></span> page and copy down the information under <span class="strong strong"><strong>Cloud ID</strong></span>:</p>
<p><span class="image"><img src="images/ec-cloud-id-scenarios.png" alt="A picture highlighting the Cloud ID information available for the deployment"></span></p>
<p>Prefer not to subscribe to yet another service? You can also get Elasticsearch Service through <a class="xref" href="ec-marketplaces.html" title="Subscribing from a marketplace">AWS, Azure, and GCP marketplaces</a>.</p>
</li>
<li class="listitem">
<a href="/downloads/logstash" class="ulink" target="_top">Download</a> and unpack Logstash version 7.12.0 on the local machine that hosts Beats or another machine granted access to the Beats machines.
</li>
</ol>
</div>
<h3><a id="ec-beats-logstash-metricbeat"></a>Set up Metricbeat<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h3>
<p>Now that Logstash and your Elasticsearch Service deployment are set up, you can configure Metricbeat to send operational data to Logstash.</p>
<p>Install Metricbeat as close as possible to the service that you want to monitor. For example, if you have four servers with MySQL running, we recommend that you run Metricbeat on each server. This allows Metricbeat to access your service from <em>localhost</em>. This setup does not cause any additional network traffic and enables Metricbeat to collect metrics even in the event of network problems. Metrics from multiple Metricbeat instances are combined on the Logstash server.</p>
<p>If you have multiple servers with metrics data, repeat the following steps to configure Metricbeat on each server.</p>
<p><span class="strong strong"><strong>Download Metricbeat</strong></span></p>
<p><a href="/downloads/beats/metricbeat" class="ulink" target="_top">Download Metricbeat</a> and unpack it on the local server from which you want to collect data.</p>
<p><span class="strong strong"><strong>Enable the Metricbeat system module</strong></span></p>
<p>Metricbeat has <a href="/guide/en/beats/metricbeat/7.14/metricbeat-modules.html" class="ulink" target="_top">many modules</a> available that collect common metrics. You can <a href="/guide/en/beats/metricbeat/7.14/configuration-metricbeat.html" class="ulink" target="_top">configure additional modules</a> as needed. For this example we’re using Metricbeat’s default configuration, which has the <a href="/guide/en/beats/metricbeat/7.14/metricbeat-module-system.html" class="ulink" target="_top">System module</a> enabled. The System module allows you to monitor servers with the default set of metrics: <em>cpu</em>, <em>load</em>, <em>memory</em>, <em>network</em>, <em>process</em>, <em>process_summary</em>, <em>socket_summary</em>, <em>filesystem</em>, <em>fsstat</em>, and <em>uptime</em>.</p>
<p><span class="strong strong"><strong>Load the Metricbeat Kibana dashboards</strong></span></p>
<p>Metricbeat comes packaged with example Kibana dashboards, visualizations, and searches for visualizing Metricbeat data in Kibana. Before you can use the dashboards, you need to create the index pattern <em>metricbeat-*</em>, and load the dashboards into Kibana. This needs to be done from a local Beats machine that has access to the Internet.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open a command line instance and then go to <em>&lt;localpath&gt;/metricbeat-7.12.0/</em>
</li>
<li class="listitem">
<p>Run the following command, replacing:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<em>&lt;cloudID&gt;</em> with the Cloud ID of your Elastic Cloud deployment. You can include or omit the <code class="literal">&lt;Deploymentname&gt;:</code> prefix at the beginning of the Cloud ID. Both versions work fine.
</li>
<li class="listitem">
<p><em>&lt;username&gt;</em> and <em>&lt;password&gt;</em> with the credentials you use to log into Elastic Cloud. Make sure to keep the colon between <em>&lt;username&gt;</em> and <em>&lt;password&gt;</em>.</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">sudo ./metricbeat setup \
  -E cloud.id=&lt;cloudID&gt; \
  -E cloud.auth=&lt;username&gt;:&lt;password&gt;</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Depending on variables including the installation location, environment and local permissions, you might need to <a href="/guide/en/beats/libbeat/7.14/config-file-permissions.html" class="ulink" target="_top">change the ownership</a> of the metricbeat.yml.</p>
<p>You might encounter similar permissions hurdles as you work through multiple sections of this document. These permission requirements are there for a good reason, a security safeguard to prevent unauthorized access and modification of key Elastic files.</p>
<p>If this isn’t a production environment and you want a fast-pass with less permissions hassles, then you can disable strict permission checks from the command line by using <code class="literal">--strict.perms=false</code> when executing Beats (for example, <code class="literal">./metricbeat --strict.perms=false</code>).</p>
<p>Depending on your system, you may also find that some commands need to be run as root, by prefixing <code class="literal">sudo</code> to the command.</p>
</div>
</div>
<p>Your results should be similar to the following:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">Index setup finished.
Loading dashboards (Kibana must be running and reachable)
Loaded dashboards</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Close the command line interface instance.
</li>
<li class="listitem">
In <em>&lt;localpath&gt;/metricbeat-7.12.0/</em> (where <em>&lt;localpath&gt;</em> is the directory where Metricbeat is installed), open the <em>metricbeat.yml</em> configuration file for editing.
</li>
<li class="listitem">
Scroll down to the <em>Elasticsearch Output</em> section. Place a comment pound sign (<em>#</em>) in front of <em>output.elasticsearch</em> and Elasticsearch <em>hosts</em>.
</li>
<li class="listitem">
<p>Scroll down to the <em>Logstash Output</em> section. Remove the comment pound sign (<em>#</em>) from in front of <em>output.logstash</em> and <em>hosts</em>, as follows:</p>
<p><span class="image"><img src="ec-logstash-beats-metricbeat-yml.png" alt="A picture showing the metricbeat.yml file with the changes described in the preceding text"></span></p>
</li>
<li class="listitem">
In the <em>output.logstash</em> section, update <em>hosts</em> with the connection information to access your Logstash server. The default <em>hosts: ["localhost:5044"]</em>, assumes that Logstash and Metricbeat are on the same server. If another server is used, replace this value with the IP address or hostname of the other server, and include the port used (for example, <em>127.1.1.1:5044</em>).
</li>
</ol>
</div>
<h3><a id="ec-beats-logstash-filebeat"></a>Set up FileBeat<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h3>
<p>The next step is to configure Filebeat to send operational data to Logstash. As with Metricbeat, install Filebeat as close as possible to the service that you want to monitor.</p>
<p><span class="strong strong"><strong>Download Filebeat</strong></span></p>
<p><a href="/downloads/beats/filebeat" class="ulink" target="_top">Download Filebeat</a> and unpack it on the local server from which you want to collect data.</p>
<p><span class="strong strong"><strong>Enable the Filebeat system module</strong></span></p>
<p>Filebeat has <a href="/guide/en/beats/filebeat/7.14/filebeat-modules.html" class="ulink" target="_top">many modules</a> available that collect common metrics. You can <a href="/guide/en/beats/filebeat/7.14/configuration-filebeat-modules.html" class="ulink" target="_top">configure additional modules</a> as needed. For this example we’re using Filebeat’s <a href="/guide/en/beats/filebeat/7.14/filebeat-module-system.html" class="ulink" target="_top">System module</a>. This module reads in the various system log files (with information including login successes or failures, sudo command usage, and other key usage details) based on the detected operating system. For this example, a Linux-based OS is used and Filebeat ingests logs from the <em>/var/log/</em> folder. It’s important to verify that Filebeat is given permission to access your logs folder through standard file and folder permissions.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <em>&lt;localpath&gt;/filebeat-7.12.0/modules.d/</em> where <em>&lt;localpath&gt;</em> is the directory where Filebeat is installed.
</li>
<li class="listitem">
Scroll to the bottom of the file listing to find a file named <em>system.yml.disabled</em>. This is the system module and it’s currently disabled.
</li>
<li class="listitem">
<p>Rename the file from <em>system.yml.disabled</em> to <em>system.yml</em>.</p>
<p><span class="image"><img src="ec-logstash-beats-system-yml.png" alt="A picture showing the renamed system.yml file in the directory listing"></span></p>
</li>
</ol>
</div>
<p>The system module is now enabled in Filebeat and it will be used the next time Filebeat starts.</p>
<p><span class="strong strong"><strong>Load the Filebeat Kibana dashboards</strong></span></p>
<p>Filebeat comes packaged with example Kibana dashboards, visualizations, and searches for visualizing Filebeat data in Kibana. Before you can use the dashboards, you need to create the index pattern <em>filebeat-*</em>, and load the dashboards into Kibana. This needs to be done from a Beats machine that has access to the Internet.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open a command line instance and then go to <em>&lt;localpath&gt;/filebeat-7.12.0/</em>
</li>
<li class="listitem">
<p>Run the following command, replacing:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<em>&lt;cloudID&gt;</em> with the Cloud ID of your Elastic Cloud deployment. You can include or omit the <code class="literal">&lt;Deploymentname&gt;:</code> prefix at the beginning of the Cloud ID. Both versions work fine.
</li>
<li class="listitem">
<p><em>&lt;username&gt;</em> and <em>&lt;password&gt;</em> with the credentials you use to log into Elastic Cloud. Make sure to keep the colon between <em>&lt;username&gt;</em> and <em>&lt;password&gt;</em>.</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">sudo ./filebeat setup \
  -E cloud.id=&lt;cloudID&gt; \
  -E cloud.auth=&lt;username&gt;:&lt;password&gt;</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Depending on variables including the installation location, environment and local permissions, you might need to <a href="/guide/en/beats/libbeat/7.14/config-file-permissions.html" class="ulink" target="_top">change the ownership</a> of the metricbeat.yml.</p>
</div>
</div>
<p>Your results should be similar to the following:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">Index setup finished.
Loading dashboards (Kibana must be running and reachable)
Loaded dashboards
Setting up ML using setup --machine-learning is going to be removed in 8.0.0. Please use the ML app instead.
See more: https://www.elastic.co/guide/en/machine-learning/current/index.html
Loaded machine learning job configurations
Loaded Ingest pipelines</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Exit the CLI.
</li>
</ol>
</div>
<p>The index patterns for <em>filebeat-*</em> and <em>metricbeat-*</em> are now available in Elasticsearch. To verify:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ec-access-kibana.html" title="Access Kibana">Login to Kibana</a>.
</li>
<li class="listitem">
Open the Kibana main menu and click <span class="strong strong"><strong>Stack Management</strong></span> and then <span class="strong strong"><strong>Index Patterns</strong></span>.
</li>
<li class="listitem">
In the search bar, search for <em>index patterns</em>.
</li>
<li class="listitem">
<p>In the search results, click <em>Kibana / Index Patterns Management</em>. The display should be similar to the following:</p>
<p><span class="image"><img src="ec-logstash-beats-index-patterns.png" alt="A screen capture of the Kibana Index patterns page" width="with "logs-<span class="strong strong"><strong>"" height="filebeat-</strong></span>"></span></p>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Finish configuring Filebeat</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In <em>&lt;localpath&gt;/filebeat-7.12.0/</em> (where <em>&lt;localpath&gt;</em> is the directory where Filebeat is installed), open the <em>filebeat.yml</em> configuration file for editing.
</li>
<li class="listitem">
Scroll down to the <em>Outputs</em> section. Place a comment pound sign (<em>#</em>) in front of <em>output.elasticsearch</em> and Elasticsearch <em>hosts</em>.
</li>
<li class="listitem">
<p>Scroll down to the <em>Logstash Output</em> section. Remove the comment pound sign (<em>#</em>) from in front of <em>output.logstash</em> and <em>hosts</em> as follows:</p>
<p><span class="image"><img src="ec-logstash-beats-filebeat-yml.png" alt="A picture showing the filebeat.yml file with the changes described in the preceding text"></span></p>
</li>
<li class="listitem">
Still in the <em>output.logstash</em> section, update <em>hosts</em> with the connection information to access your Logstash server. The default <em>hosts: ["localhost:5044"]</em>, assumes that Logstash and Filebeat are on the same server. If another server is used, replace this value with the IP address or hostname of the other server, and include the port used (for example, <em>127.1.1.1:5044</em>).
</li>
</ol>
</div>
<h3><a id="ec-beats-logstash-listen"></a>Configure Logstash to listen for Beats<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h3>
<p>Now the Filebeat and Metricbeat are set up, let&#8217;s configure a Logstash pipeline to input data from Beats and send results to the standard output. This enables you to verify the data output before sending it for indexing in Elasticsearch.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In <em>&lt;localpath&gt;/logstash-7.12.0/</em>, create a new text file named <em>beats.conf</em>.
</li>
<li class="listitem">
<p>Copy and paste the following code into the new text file. This code creates a Logstash pipeline through a JDBC plugin.</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">input {
beats{port =&gt; 5044}
}
output {
stdout{codec =&gt; rubydebug}
}</pre>
</div>
<p>Following are some additional details about the configuration file settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<em>beats{port &#8658; 5044}</em>: Logstash listens for Beats input on the default port of 5044. Only one line is needed to do this. Logstash can handle input from many Beats of the same and also of varying types (Metricbeat, Filebeat, and others).
</li>
<li class="listitem">
<em>stdout{codec &#8658; rubydebug}</em>: This sends output to the standard output, which displays through your command line interface. This setting enables you to verify the data before you send it to Elasticsearch, in a later step.
</li>
</ul>
</div>
</li>
<li class="listitem">
Save the new <em>beats.conf</em> file in your Logstash folder. To learn more about the file format and options, see <a href="/guide/en/logstash/7.14/config-examples.html" class="ulink" target="_top">Logstash Configuration Examples</a>.
</li>
</ol>
</div>
<h3><a id="ec-beats-logstash-stdout"></a>Output Logstash data to stdout<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h3>
<p>Now, let&#8217;s try out the Logstash pipeline with the Metricbeats and Filebeats configurations from the prior steps. Each Beat sends data into a Logstash pipeline, and the results display on the standard output where you can verify that everything looks correct.</p>
<p><span class="strong strong"><strong>Test Metricbeat to stdout</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Open a command line interface instance. Go to <em>&lt;localpath&gt;/logstash-7.12.0/</em>, where &lt;localpath&gt; is the directory where Logstash is installed, and start Logstash by running the following command:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">bin/logstash -f beats.conf</pre>
</div>
</li>
<li class="listitem">
<p>Open a second command line interface instance. Go to <em>&lt;localpath&gt;/metricbeat-7.12.0/</em>, where &lt;localpath&gt; is the directory where Metricbeat is installed, and start Metricbeat by running the following command:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./metricbeat -c metricbeat.yml</pre>
</div>
</li>
<li class="listitem">
<p>Switch back to your first command line interface instance with Logstash. Now, Metricbeat events are input into Logstash and the output data is directed to the standard output. Your results should be similar to the following:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">"tags" =&gt; [
          [0] "beats_input_raw_event"
],
"agent" =&gt; {
          "type" =&gt; "metricbeat",
          "name" =&gt; "john-VirtualBox",
       "version" =&gt; "7.12.0",
  "ephemeral_id" =&gt; "1e69064c-d49f-4ec0-8414-9ab79b6f27a4",
            "id" =&gt; "1b6c39e8-025f-4310-bcf1-818930a411d4",
      "hostname" =&gt; "john-VirtualBox"
},
"service" =&gt; {
          "type" =&gt; "system"
},
"event" =&gt; {
      "duration" =&gt; 39833,
        "module" =&gt; "system",
       "dataset" =&gt; "system.cpu"
},
    "@timestamp" =&gt; 2021-04-21T17:06:05.231Z,
     "metricset" =&gt; {
          "name" =&gt; "cpu",
        "period" =&gt; 10000
},
"@version" =&gt; "1","host" =&gt; {
            "id" =&gt; "939972095cf1459c8b22cc608eff85da",
            "ip" =&gt; [
              [0] "10.0.2.15",
              [1] "fe80::3700:763c:4ba3:e48c"
],
"name" =&gt; "john-VirtualBox","mac" =&gt; [
              [0] "08:00:27:a3:c7:a9"
],
"os" =&gt; {
          "type" =&gt; "linux",</pre>
</div>
</li>
<li class="listitem">
Switch back to the Metricbeat command line instance. Enter <em>CTRL + C</em> to shut down Metricbeat, and then exit the CLI.
</li>
<li class="listitem">
Switch back to the Logstash command line instance. Enter <em>CTRL + C</em> to shut down Logstash, and then exit the CLI.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Test Filebeat to stdout</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Open a command line interface instance. Go to <em>&lt;localpath&gt;/logstash-7.12.0/</em>, where &lt;localpath&gt; is the directory where Logstash is installed, and start Logstash by running the following command:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">bin/logstash -f beats.conf</pre>
</div>
</li>
<li class="listitem">
<p>Open a second command line interface instance. Go to <em>&lt;localpath&gt;/filebeat-7.12.0/</em>, where &lt;localpath&gt; is the directory where Filebeat is installed, and start Filebeat by running the following command:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./filebeat -c filebeat.yml</pre>
</div>
</li>
<li class="listitem">
<p>Switch back to your first command line interface instance with Logstash. Now, Filebeat events are input into Logstash and the output data is directed to the standard output. Your results should be similar to the following:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">{
       "service" =&gt; {
        "type" =&gt; "system"
    },
         "event" =&gt; {
        "timezone" =&gt; "-04:00",
         "dataset" =&gt; "system.syslog",
          "module" =&gt; "system"
    },
       "fileset" =&gt; {
        "name" =&gt; "syslog"
    },
         "agent" =&gt; {
                  "id" =&gt; "113dc127-21fa-4ebb-ab86-8a151d6a23a6",
                "type" =&gt; "filebeat",
             "version" =&gt; "7.12.0",
            "hostname" =&gt; "john-VirtualBox",
        "ephemeral_id" =&gt; "1058ad74-8494-4a5e-9f48-ad7c5b9da915",
                "name" =&gt; "john-VirtualBox"
    },
    "@timestamp" =&gt; 2021-04-28T15:33:41.727Z,
         "input" =&gt; {
        "type" =&gt; "log"
    },
           "ecs" =&gt; {
        "version" =&gt; "1.8.0"
    },
      "@version" =&gt; "1",
           "log" =&gt; {
        "offset" =&gt; 73281,
          "file" =&gt; {
            "path" =&gt; "/var/log/syslog"
        }
    },</pre>
</div>
</li>
<li class="listitem">
Review the Logstash output results to make sure your data looks correct. Enter <em>CTRL + C</em> to shut down Logstash.
</li>
<li class="listitem">
Switch back to the Filebeats CLI. Enter <em>CTRL + C</em> to shut down Filebeat.
</li>
</ol>
</div>
<h3><a id="ec-beats-logstash-elasticsearch"></a>Output Logstash data to Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h3>
<p>In this section, you configure Logstash to send the Metricbeat and Filebeat data to Elasticsearch. You modify the <em>beats.conf</em> created earlier, and specify the output credentials needed for our Elastic Cloud deployment. Then, you start Logstash to send the Beats data into Elasticsearch.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your <em>&lt;localpath&gt;/logstash-7.12.0/</em> folder, open <em>beats.conf</em> for editing.
</li>
<li class="listitem">
<p>Replace the <em>output {}</em> section of the JSON with the following code:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">output {
  elasticsearch {
    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}"
    cloud_id =&gt; "&lt;myDeployment&gt;"
    ssl =&gt; true
    ilm_enabled =&gt; true
    # api_key =&gt; "&lt;myAPIid:myAPIkey&gt;"
    user =&gt; "&lt;Username&gt;"
    password =&gt; "&lt;Password&gt;"
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>In the code that you added, replace:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<em>&lt;myDeployment&gt;</em> with the Cloud ID of your Elastic Cloud deployment. You can include or omit the <code class="literal">&lt;Deploymentname&gt;:</code> prefix at the beginning of the Cloud ID. Both versions work fine.
</li>
<li class="listitem">
<p><em>&lt;username&gt;</em> and <em>&lt;password&gt;</em> with the credentials you use to log into Elastic Cloud. Make sure to keep the colon between <em>&lt;username&gt;</em> and <em>&lt;password&gt;</em>. Alternatively, you may choose to use an API key to authenticate, as discussed in the next step. In this case, uncomment the <code class="literal">api_key</code> setting and leave the <code class="literal">user</code> and <code class="literal">password</code> settings commented out (<code class="literal">#</code>).</p>
<p>Following are some additional details about the configuration file settings:</p>
</li>
<li class="listitem">
<p><em>index</em>: We specify the name of the Elasticsearch index with which to associate the Beats output.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<em>%{[@metadata][beat]}</em> sets the first part of the index name to the value of the Beat metadata field.
</li>
<li class="listitem">
<p><em>%{[@metadata][version]}</em> sets the second part of the index name to the Beat version.</p>
<p>If you use Metricbeat version 7.12.0, the index created in Elasticsearch is named <em>metricbeat-7.12.0</em>. Similarly, using the 7.12.0 version of Filebeat, the Elasticsearch index is named <em>filebeat-7.12.0</em>.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<em>cloud_id</em>: This is the ID that uniquely identifies your Elasticsearch Service deployment.
</li>
<li class="listitem">
<em>ssl</em>: This should be set to <code class="literal">true</code> so that Secure Socket Layer (SSL) certificates are used for secure communication between Logstash and your Elasticsearch Service deployment.
</li>
<li class="listitem">
<em>ilm_enabled</em>: Enables and disables Elasticsearch Service <a href="/guide/en/elasticsearch/reference/7.14/index-lifecycle-management.html" class="ulink" target="_top">index lifecycle management</a>.
</li>
<li class="listitem">
<em>api_key</em>: If you choose to use an API key to authenticate (as discussed in the next step), you can provide it here.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Optional</strong></span>: For additional security, you can generate an Elasticsearch API key through the Elastic Cloud console and configure Logstash to use the new key to connect securely to the Elastic Cloud.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to the <a href="https://cloud.elastic.co?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">Elasticsearch Service Console</a>.
</li>
<li class="listitem">
<p>Select your deployment on the home page in the Elasticsearch Service card or go to the deployments page.</p>
<p>Narrow your deployments by name, ID, or choose from several other filters. To customize your view, use a combination of filters, or change the format from a grid to a list.</p>
</li>
<li class="listitem">
From your deployment menu, click <span class="strong strong"><strong>Elasticsearch</strong></span> and then <span class="strong strong"><strong>API Console</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Post</strong></span> from the drop-down list and enter <code class="literal">/_security/api_key</code> in the field.
</li>
<li class="listitem">
<p>Enter the following JSON request:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
 "name": "logstash-apikey",
 "role_descriptors": {
   "logstash_read_write": {
     "cluster": ["manage_index_templates", "monitor"],
     "index": [
       {
         "names": ["logstash-*","metricbeat-*","filebeat-*"],
         "privileges": ["create_index", "write", "read", "manage"]
       }
     ]
   }
 }
}</pre>
</div>
<p>This creates an API key with the cluster <code class="literal">monitor</code> privilege which gives read-only access for determining the cluster state, and <code class="literal">manage_index_templates</code> which allows all operations on index templates. Some additional privileges also allow <code class="literal">create_index</code>, <code class="literal">write</code>, and <code class="literal">manage</code> operations for the specified index. The index <code class="literal">manage</code> privilege is added to enable index refreshes.</p>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Submit</strong></span>. The output should be similar to the following:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "api_key": "aB1cdeF-GJI23jble4NOH4",
  "id": "2GBe63fBcxgJAetmgZeh",
  "name": "logstash_api_key"
}</pre>
</div>
</li>
<li class="listitem">
<p>Enter your new <code class="literal">api_key</code> value into the Logstash <code class="literal">beats.conf</code> file, in the format <code class="literal">&lt;id&gt;:&lt;api_key&gt;</code>. If your results were as shown in this example, you would enter <code class="literal">2GBe63fBcxgJAetmgZeh:aB1cdeF-GJI23jble4NOH4</code>. Remember to remove the pound (<code class="literal">#</code>) sign to uncomment the line, and comment out the <code class="literal">username</code> and <code class="literal">password</code> lines:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">output {
  elasticsearch {
    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}"
    cloud_id =&gt; "&lt;myDeployment&gt;"
    ssl =&gt; true
    ilm_enabled =&gt; true
    api_key =&gt; "2GBe63fBcxgJAetmgZeh:aB1cdeF-GJI23jble4NOH4"
    # user =&gt; "&lt;Username&gt;"
    # password =&gt; "&lt;Password&gt;"
  }
}</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Open a command line interface instance, go to your Logstash installation path, and start Logstash:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">bin/logstash -f beats.conf</pre>
</div>
</li>
<li class="listitem">
<p>Open a second command line interface instance, go to your Metricbeat installation path, and start Metricbeat:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./metricbeat -c metricbeat.yml</pre>
</div>
</li>
<li class="listitem">
<p>Open a third command line interface instance, go to your Filebeat installation path, and start Filebeat:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">./filebeat -c filebeat.yml</pre>
</div>
</li>
<li class="listitem">
Logstash now outputs the Filebeat and Metricbeat data to your Elasticsearch Service instance.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In this guide, you manually launch each of the Elastic stack applications through the command line interface. In production, you may prefer to configure Logstash, Metricbeat, and Filebeat to run as System Services. See the following pages for the steps to configure each application to run as a service:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/logstash/7.14/running-logstash.html" class="ulink" target="_top">Running Logstash as a service on Debian or RPM</a>
</li>
<li class="listitem">
<a href="/guide/en/beats/metricbeat/7.14/running-with-systemd.html" class="ulink" target="_top">Metricbeat and systemd</a>
</li>
<li class="listitem">
<a href="/guide/en/beats/filebeat/7.14/filebeat-starting.html" class="ulink" target="_top">Start filebeat</a>
</li>
</ul>
</div>
</div>
</div>
<h3><a id="ec-beats-logstash-view-kibana"></a>View data in Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-62/docs/shared/ec-ce-getting-started-use-cases-beats-logstash.asciidoc">edit</a></h3>
<p>In this section, you log into Elastic Cloud, open Kibana, and view the Kibana dashboards populated with our Metricbeat and Filebeat data.</p>
<p><span class="strong strong"><strong>View the Metricbeat dashboard</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="ec-access-kibana.html" title="Access Kibana">Login to Kibana</a>.
</li>
<li class="listitem">
Open the Kibana main menu and click <span class="strong strong"><strong>Analytics</strong></span> and then <span class="strong strong"><strong>Dashboard</strong></span>.
</li>
<li class="listitem">
In the search box, search for <em>metricbeat system</em>. The search results show several dashboards available for you to explore.
</li>
<li class="listitem">
In the search results, click <em>[Metricbeat System] Overview ECS</em>. A Metricbeat dashboard opens:
</li>
</ol>
</div>
<p><span class="image"><img src="ec-logstash-beats-metricbeat-dashboard.png" alt="A screencapture of the Kibana dashboard named Metricbeat System Overview ECS"></span></p>
<p><span class="strong strong"><strong>View the Filebeat dashboard</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the Kibana main menu and click <span class="strong strong"><strong>Analytics</strong></span> and then <span class="strong strong"><strong>Dashboard</strong></span>.
</li>
<li class="listitem">
In the search box, search for <em>filebeat system</em>.
</li>
<li class="listitem">
In the search results, click <em>[Filebeat System] Syslog dashboard ECS</em>. A Filebeat dashboard displaying your Filebeat data:
</li>
</ol>
</div>
<p><span class="image"><img src="ec-logstash-beats-filebeat-dashboard.png" alt="A screencapture of the Kibana dashboard named Filebeat System ECS"></span></p>
<p>Now, you should have a good understanding of how to configure Logstash to ingest data from multiple Beats. You have the basics needed to begin experimenting with your own combination of Beats and modules.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ec-getting-started-python.html">« Ingest data with Python on Elastic Cloud</a>
</span>
<span class="next">
<a href="ec-getting-started-search-use-cases-db-logstash.html">Ingest data from a relational database into Elastic Cloud »</a>
</span>
</div>
</div>
</body>
</html>
