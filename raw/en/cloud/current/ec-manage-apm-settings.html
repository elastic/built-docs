<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Edit APM user settings | Elasticsearch Service Documentation | Elastic</title>
<meta class="elastic" name="content" content="Edit APM user settings | Elasticsearch Service Documentation">

<link rel="home" href="index.html" title="Elasticsearch Service Documentation"/>
<link rel="up" href="ec-editing-user-settings.html" title="Edit your user settings"/>
<link rel="prev" href="ec-manage-kibana-settings.html" title="Edit Kibana user settings"/>
<link rel="next" href="ec-manage-appsearch-settings.html" title="Add App Search user settings"/>
<meta class="elastic" name="product_version" content="latest"/>
<meta class="elastic" name="product_name" content="Elastic Cloud"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="latest"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-prepare-production.html">Preparing a deployment for production</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-editing-user-settings.html">Edit your user settings</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ec-manage-kibana-settings.html">« Edit Kibana user settings</a>
</span>
<span class="next">
<a href="ec-manage-appsearch-settings.html">Add App Search user settings »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ec-manage-apm-settings"></a>Edit APM user settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-88/docs/saas/ec-editing-user-settings.asciidoc">edit</a></h2>
</div></div></div>
<p>Change how Elastic APM runs by providing your own user settings.
Starting in Elastic Stack version 8.0, how you change APM settings and the settings that are available to you
depend on how you spin up Elastic APM. There are two modes:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Fleet-managed APM integration
</span>
</dt>
<dd>
<p>
New deployments created in Elastic Stack version 8.0 and later will be managed by Fleet.
</p>
<p>Check <a href="/guide/en/apm/guide/8.7/input-apm.html" class="ulink" target="_top">APM integration input settings</a> for information on how to configure Elastic APM in this mode.</p>
</dd>
<dt>
<span class="term">
Standalone APM Server (legacy)
</span>
</dt>
<dd>
<p>
Deployments created prior to Elastic Stack version 8.0 are in legacy mode.
Upgrading to or past Elastic Stack 8.0 will not remove you from legacy mode.
</p>
<p>Check <a class="xref" href="ec-manage-apm-settings.html#ec-edit-apm-standalone-settings" title="Edit standalone APM settings (legacy)">Edit standalone APM settings (legacy)</a> and <a class="xref" href="ec-manage-apm-settings.html#ec-apm-settings" title="Supported standalone APM settings (legacy)">Supported standalone APM settings (legacy)</a> for information on how to configure Elastic APM in this mode.</p>
</dd>
</dl>
</div>
<p>To learn more about the differences between these modes, or to switch from Standalone APM Server (legacy) mode to Fleet-managed,
check <a href="/guide/en/apm/guide/8.7/upgrade-to-apm-integration.html" class="ulink" target="_top">Switch to the Elastic APM integration</a>.</p>
<h4><a id="ec-edit-apm-standalone-settings"></a>Edit standalone APM settings (legacy)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-88/docs/saas/ec-editing-user-settings.asciidoc">edit</a></h4>
<p>User settings are appended to the <code class="literal">apm-server.yml</code> configuration file for your instance and provide custom configuration options.</p>
<p>To add user settings:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to the <a href="https://cloud.elastic.co?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">Elasticsearch Service Console</a>.
</li>
<li class="listitem">
<p>Find your deployment on the home page in the Elasticsearch Service card and click the gear icon to access it directly. Or, select Elasticsearch Service to go to the deployments page to view all of your deployments.</p>
<p>On the deployments page you can narrow your deployments by name, ID, or choose from several other filters. To customize your view, use a combination of filters, or change the format from a grid to a list.</p>
</li>
<li class="listitem">
From your deployment menu, go to the <span class="strong strong"><strong>Edit</strong></span> page.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>APM</strong></span> section, select <span class="strong strong"><strong>Edit user settings</strong></span>. (For existing deployments with user settings, you may have to expand the <span class="strong strong"><strong>Edit apm-server.yml</strong></span> caret instead.)
</li>
<li class="listitem">
Update the user settings.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Save changes</strong></span>.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a setting is not supported by Elasticsearch Service, you will get an error message when you try to save.</p>
</div>
</div>
<h4><a id="ec-apm-settings"></a>Supported standalone APM settings (legacy)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-88/docs/saas/ec-editing-user-settings.asciidoc">edit</a></h4>
<p>Elasticsearch Service supports the following setting when running APM in standalone mode (legacy).</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Some settings that could break your cluster if set incorrectly are blocklisted. The following settings are generally safe in cloud environments. For detailed information about APM settings, check the <a href="/guide/en/apm/guide/8.7/configuring-howto-apm-server.html" class="ulink" target="_top">APM documentation</a>.</p>
</div>
</div>
<p><span class="strong strong"><strong>For version 8.0 and later:</strong></span></p>
<p>This stack version removes support for some previously supported settings. These are all of the supported settings for this version:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.agent.config.cache.expiration</code>
</span>
</dt>
<dd>
When using APM agent configuration, determines cache expiration from information fetched from Kibana. Defaults to <code class="literal">30s</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.aggregation.transactions.*</code>
</span>
</dt>
<dd>
This functionality is experimental and may be changed or removed completely in a future release. When enabled, APM Server produces transaction histogram metrics that are used to power the APM app. Shifting this responsibility from APM app to APM Server results in improved query performance and removes the need to store unsampled transactions.
</dd>
</dl>
</div>
<p>The following <code class="literal">apm-server.auth.anonymous.*</code> settings can be configured to restrict anonymous access to specified agents and/or services. This is primarily intended to allow limited access for untrusted agents, such as Real User Monitoring.
Anonymous auth is automatically enabled when RUM is enabled. Otherwise, anonymous auth is disabled.
When anonymous auth is enabled, only agents matching <code class="literal">allow_agent</code> and services matching <code class="literal">allow_service</code> are allowed. See below for details on default values for these.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.auth.anonymous.allow_agent</code>
</span>
</dt>
<dd>
Allow anonymous access only for specified agents.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.anonymous.allow_service</code>
</span>
</dt>
<dd>
Allow anonymous access only for specified service names. By default, all service names are allowed. This is replacing the config option <code class="literal">apm-server.rum.allow_service_names</code>, previously available for <code class="literal">7.x</code> deployments.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.anonymous.rate_limit.event_limit</code>
</span>
</dt>
<dd>
Rate limiting is defined per unique client IP address, for a limited number of IP addresses. Sites with many concurrent clients should consider increasing this limit. Defaults to 1000. This is replacing the config option <code class="literal">apm-server.rum.event_rate.limit</code>, previously available for <code class="literal">7.x</code> deployments.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.anonymous.rate_limit.ip_limit</code>
</span>
</dt>
<dd>
Defines the maximum amount of events allowed per IP per second. Defaults to 300. The overall maximum event throughput for anonymous access is (event_limit * ip_limit). This is replacing the config option <code class="literal">apm-server.rum.event_rate.lru_size</code>, previously available for <code class="literal">7.x</code> deployments.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.api_key.enabled</code>
</span>
</dt>
<dd>
Enables agent authorization using Elasticsearch API Keys. This is replacing the config option <code class="literal">apm-server.api_key.enabled</code>, previously available for <code class="literal">7.x</code> deployments.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.api_key.limit</code>
</span>
</dt>
<dd>
Restrict how many unique API keys are allowed per minute. Should be set to at least the amount of different API keys configured in your monitored services. Every unique API key triggers one request to Elasticsearch. This is replacing the config option <code class="literal">apm-server.api_key.limit</code>, previously available for <code class="literal">7.x</code> deployments.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.capture_personal_data</code>
</span>
</dt>
<dd>
When set to <code class="literal">true</code>, the server captures the IP of the instrumented service and its User Agent. Enabled by default.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.default_service_environment</code>
</span>
</dt>
<dd>
If specified, APM Server will record this value in events which have no service environment defined, and add it to agent configuration queries to Kibana when none is specified in the request from the agent.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.max_event_size</code>
</span>
</dt>
<dd>
Specifies the maximum allowed size of an event for processing by the server, in bytes. Defaults to <code class="literal">307200</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.allow_headers</code>
</span>
</dt>
<dd>
A list of Access-Control-Allow-Headers to allow RUM requests, in addition to "Content-Type", "Content-Encoding", and "Accept".
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.allow_origins</code>
</span>
</dt>
<dd>
A list of permitted origins for real user monitoring. User-agents will send an origin header that will be validated against this list. An origin is made of a protocol scheme, host, and port, without the URL path. Allowed origins in this setting can have a wildcard <code class="literal">*</code> to match anything (for example: <code class="literal">http://*.example.com</code>). If an item in the list is a single <code class="literal">*</code>, all origins will be allowed.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.enabled</code>
</span>
</dt>
<dd>
Enable Real User Monitoring (RUM) Support. By default RUM is enabled. RUM does not support token based authorization. Enabled RUM endpoints will not require any authorization configured for other endpoints.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.exclude_from_grouping</code>
</span>
</dt>
<dd>
A regexp to be matched against a stacktrace frame&#8217;s <code class="literal">file_name</code>. If the regexp matches, the stacktrace frame is not used for calculating error groups. The default pattern excludes stacktrace frames that have a filename starting with <code class="literal">/webpack</code>
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.library_pattern</code>
</span>
</dt>
<dd>
A regexp to be matched against a stacktrace frame&#8217;s <code class="literal">file_name</code> and <code class="literal">abs_path</code> attributes. If the regexp matches, the stacktrace frame is considered to be a library frame.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.source_mapping.enabled</code>
</span>
</dt>
<dd>
If a source map has previously been uploaded, source mapping is automatically applied to all error and transaction documents sent to the RUM endpoint. Sourcemapping is enabled by default when RUM is enabled.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.source_mapping.cache.expiration</code>
</span>
</dt>
<dd>
The <code class="literal">cache.expiration</code> determines how long a source map should be cached in memory. Note that values configured without a time unit will be interpreted as seconds.
</dd>
<dt>
<span class="term">
<code class="literal">logging.level</code>
</span>
</dt>
<dd>
Sets the minimum log level. The default log level is error. Available log levels are: error, warning, info, or debug.
</dd>
<dt>
<span class="term">
<code class="literal">logging.selectors</code>
</span>
</dt>
<dd>
Enable debug output for selected components. To enable all selectors use ["*"]. Other available selectors are "beat", "publish", or "service". Multiple selectors can be chained.
</dd>
<dt>
<span class="term">
<code class="literal">logging.metrics.enabled</code>
</span>
</dt>
<dd>
If enabled, apm-server periodically logs its internal metrics that have changed in the last period. For each metric that changed, the delta from the value at the beginning of the period is logged. Also, the total values for all non-zero internal metrics are logged on shutdown. The default is false.
</dd>
<dt>
<span class="term">
<code class="literal">logging.metrics.period</code>
</span>
</dt>
<dd>
The period after which to log the internal metrics. The default is 30s.
</dd>
<dt>
<span class="term">
<code class="literal">max_procs</code>
</span>
</dt>
<dd>
Sets the maximum number of CPUs that can be executing simultaneously. The default is the number of logical CPUs available in the system.
</dd>
<dt>
<span class="term">
<code class="literal">output.elasticsearch.flush_interval</code>
</span>
</dt>
<dd>
The maximum duration to accumulate events for a bulk request before being flushed to Elasticsearch. The value must have a duration suffix. The default is 1s.
</dd>
<dt>
<span class="term">
<code class="literal">output.elasticsearch.flush_bytes</code>
</span>
</dt>
<dd>
The bulk request size threshold, in bytes, before flushing to Elasticsearch. The value must have a suffix. The default is 5MB.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.17 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.16 and the following:</p>
<p>Allow anonymous access only for specified agents and/or services. This is primarily intended to allow limited access for untrusted agents, such as Real User Monitoring.
Anonymous auth is automatically enabled when RUM is enabled. Otherwise, anonymous auth is disabled.
When anonymous auth is enabled, only agents matching allow_agent and services matching allow_service are allowed. See below for details on default values for these.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.auth.anonymous.allow_agent</code>
</span>
</dt>
<dd>
Allow anonymous access only for specified agents.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.anonymous.allow_service</code>
</span>
</dt>
<dd>
Allow anonymous access only for specified service names. By default, all service names are allowed. This will be replacing the config option <code class="literal">apm-server.rum.allow_service_names</code> from <code class="literal">8.0</code> on.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.anonymous.rate_limit.event_limit</code>
</span>
</dt>
<dd>
Rate limiting is defined per unique client IP address, for a limited number of IP addresses. Sites with many concurrent clients should consider increasing this limit. Defaults to 1000. This will be replacing the config option`apm-server.rum.event_rate.limit` from <code class="literal">8.0</code> on.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.anonymous.rate_limit.ip_limit</code>
</span>
</dt>
<dd>
Defines the maximum amount of events allowed per IP per second. Defaults to 300. The overall maximum event throughput for anonymous access is (event_limit * ip_limit). This will be replacing the config option <code class="literal">apm-server.rum.event_rate.lru_size</code> from <code class="literal">8.0</code> on.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.api_key.enabled</code>
</span>
</dt>
<dd>
Enables agent authorization using Elasticsearch API Keys.  This will be replacing the config option <code class="literal">apm-server.api_key.enabled</code> from <code class="literal">8.0</code> on.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.auth.api_key.limit</code>
</span>
</dt>
<dd>
Restrict how many unique API keys are allowed per minute. Should be set to at least the amount of different API keys configured in your monitored services. Every unique API key triggers one request to Elasticsearch. This will be replacing the config option <code class="literal">apm-server.api_key.limit</code> from <code class="literal">8.0</code> on.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.14 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.13 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.aggregation.transactions.*</code>
</span>
</dt>
<dd>
This functionality is experimental and may be changed or removed completely in a future release. When enabled, APM Server produces transaction histogram metrics that are used to power the APM app. Shifting this responsibility from APM app to APM Server results in improved query performance and removes the need to store unsampled transactions.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.13 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.12 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.default_service_environment</code>
</span>
</dt>
<dd>
If specified, APM Server will record this value in events which have no service environment defined, and add it to agent configuration queries to Kibana when none is specified in the request from the agent.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.allow_service_names</code>
</span>
</dt>
<dd>
A list of service names to allow, to limit service-specific indices and data streams created for unauthenticated RUM events. If the list is empty, any service name is allowed.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.9 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.7 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.ilm.setup.mapping</code>
</span>
</dt>
<dd>
ILM policies now support configurable index suffixes. You can append the <code class="literal">policy_name</code> with an <code class="literal">index_suffix</code> based on the <code class="literal">event_type</code>, which can be one of <code class="literal">span</code>, <code class="literal">transaction</code>, <code class="literal">error</code>, or <code class="literal">metric</code>.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.7 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.6 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.rum.allow_headers</code>
</span>
</dt>
<dd>
List of Access-Control-Allow-Headers to allow RUM requests, in addition to "Content-Type", "Content-Encoding", and "Accept".
</dd>
<dt>
<span class="term">
<code class="literal">setup.template.append_fields</code>
</span>
</dt>
<dd>
A list of fields to be added to the Elasticsearch template and Kibana data view (formerly <em>index pattern</em>).
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.6 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.5 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.api_key.enabled</code>
</span>
</dt>
<dd>
Enabled by default. For any requests where APM Server accepts a <code class="literal">secret_token</code> in the authorization header, it now alternatively accepts an API Key.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.api_key.limit</code>
</span>
</dt>
<dd>
Configure how many unique API keys are allowed per minute. Should be set to at least the amount of different API keys used in monitored services. Default value is 100.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.5 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.4 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.ilm.setup.enabled</code>
</span>
</dt>
<dd>
When enabled, APM Server creates aliases, event type specific settings and ILM policies. If disabled, event type specific templates need to be managed manually.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.ilm.setup.overwrite</code>
</span>
</dt>
<dd>
Set to <code class="literal">true</code> to apply custom policies and to properly overwrite templates when switching between using ILM and not using ILM.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.ilm.setup.require_policy</code>
</span>
</dt>
<dd>
Set to <code class="literal">false</code> when policies are set up outside of APM Server but referenced in this configuration.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.ilm.setup.policies</code>
</span>
</dt>
<dd>
Array of ILM policies. Each entry has a <code class="literal">name</code> and a <code class="literal">policy</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.ilm.setup.mapping</code>
</span>
</dt>
<dd>
Array of mappings of ILM policies to event types. Each entry has a <code class="literal">policy_name</code> and an <code class="literal">event_type</code>, which can be one of <code class="literal">span</code>, <code class="literal">transaction</code>, <code class="literal">error</code>, or <code class="literal">metric</code>.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.4 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.3 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.rum.source_mapping.enabled</code>
</span>
</dt>
<dd>
When events are monitored using the RUM agent, APM Server tries to apply source mapping by default. This configuration option allows you to disable source mapping on stack traces.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.source_mapping.cache.expiration</code>
</span>
</dt>
<dd>
Sets how long a source map should be cached before being refetched from Elasticsearch. Default value is 5m.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.3 and later:</strong></span></p>
<p>This stack version includes all of the settings from 7.2 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">output.elasticsearch.pipeline</code>
</span>
</dt>
<dd>
APM comes with a default pipeline definition. This allows overriding it. To disable, you can set <code class="literal">pipeline: _none</code>
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.agent.config.cache.expiration</code>
</span>
</dt>
<dd>
When using APM agent configuration, determines cache expiration from information fetched from Kibana. Defaults to <code class="literal">30s</code>.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 7.2 and later:</strong></span></p>
<p>This stack version includes all of the settings from 6.5 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.ilm.enabled</code>
</span>
</dt>
<dd>
Enables index lifecycle management (ILM) for the indices created by the APM Server. Defaults to <code class="literal">false</code>. If you&#8217;re updating an existing APM Server, you must also set <code class="literal">setup.template.overwrite: true</code>. If you don&#8217;t, the index template will not be overridden and ILM changes will not take effect.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 6.5 and later:</strong></span></p>
<p>This stack version includes all of the settings from 6.4 and the following:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.max_event_size</code>
</span>
</dt>
<dd>
Specifies the maximum allowed size of an event for processing by the server, in bytes. Defaults to <code class="literal">307200</code>.
</dd>
<dt>
<span class="term">
<code class="literal">output.elasticsearch.pipelines</code>
</span>
</dt>
<dd>
Adds an array for pipeline selector configurations that support conditionals, format string-based field access, and name mappings used to <a href="/guide/en/apm/guide/8.7/configuring-ingest-node.html" class="ulink" target="_top">parse data using ingest node pipelines</a>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.register.ingest.pipeline.enabled</code>
</span>
</dt>
<dd>
Loads the pipeline definitions to Elasticsearch when the APM Server starts up. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.register.ingest.pipeline.overwrite</code>
</span>
</dt>
<dd>
Overwrites the existing pipeline definitions in Elasticsearch. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.event_rate.lru_size</code>
</span>
</dt>
<dd>
Defines the number of unique IP addresses that can be tracked in the LRU cache, which keeps a rate limit for each of the most recently seen IP addresses. Defaults to <code class="literal">1000</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.event_rate.limit</code>
</span>
</dt>
<dd>
Sets the rate limit per second for each IP address for events sent to the APM Server v2 RUM endpoint. Defaults to <code class="literal">300</code>.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>With the version 6.5 release, we recommend verifying that your agents continue to be <a href="/guide/en/apm/guide/8.7/agent-server-compatibility.html" class="ulink" target="_top">compatible with your APM Server</a>.</p>
</div>
</div>
<p><span class="strong strong"><strong>For version 6.4 and later:</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.rum.enabled</code>
</span>
</dt>
<dd>
Enables/disables Real User Monitoring (RUM) support. Defaults to <code class="literal">true</code> (enabled).
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.allow_origins</code>
</span>
</dt>
<dd>
Specifies a list of permitted origins from user agents. The default is <code class="literal">*</code>, which allows everything.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.library_pattern</code>
</span>
</dt>
<dd>
Differentiates library frames against  <a href="/guide/en/apm/guide/8.7/configuration-rum.html#rum-library-pattern" class="ulink" target="_top">specific attributes</a>. The default value is <code class="literal">"node_modules|bower_components|~"</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.exclude_from_grouping</code>
</span>
</dt>
<dd>
Configures the RegExp to be matched against a stacktrace frame&#8217;s <code class="literal">file_name</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.rum.rate_limit</code>
</span>
</dt>
<dd>
Sets the rate limit per second for each IP address for requests sent to the RUM endpoint. Defaults to <code class="literal">10</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.capture_personal_data</code>
</span>
</dt>
<dd>
When set to <code class="literal">true</code>, the server captures the IP of the instrumented service and its User Agent. Enabled by default.
</dd>
<dt>
<span class="term">
<code class="literal">setup.template.settings.index.number_of_shards</code>
</span>
</dt>
<dd>
Specifies the number of shards for the Elasticsearch template.
</dd>
<dt>
<span class="term">
<code class="literal">setup.template.settings.index.number_of_replicas</code>
</span>
</dt>
<dd>
Specifies the number of replicas for the Elasticsearch template.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>For version 6.3:</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">apm-server.frontend.enabled</code>
</span>
</dt>
<dd>
Enables/disables frontend support.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.frontend.allow_origins</code>
</span>
</dt>
<dd>
Specifies the comma-separated list of permitted origins from user agents. The default is <code class="literal">*</code>, which allows everything.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.frontend.library_pattern</code>
</span>
</dt>
<dd>
Differentiates library frames against <a href="/guide/en/apm/server/6.3/configuration-frontend.html" class="ulink" target="_top">specific attributes</a>. The default value is <code class="literal">"node_modules|bower_components|~"</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.frontend.exclude_from_grouping</code>
</span>
</dt>
<dd>
Configures the RegExp to be matched against a stacktrace frame&#8217;s <code class="literal">file_name</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.frontend.rate_limit</code>
</span>
</dt>
<dd>
Sets the rate limit per second per IP address for requests sent to the frontend endpoint. Defaults to <code class="literal">10</code>.
</dd>
<dt>
<span class="term">
<code class="literal">apm-server.capture_personal_data</code>
</span>
</dt>
<dd>
When set to <code class="literal">true</code>, the server captures the IP address of the instrumented service and its User Agent. Enabled by default.
</dd>
<dt>
<span class="term">
<code class="literal">max_procs</code>
</span>
</dt>
<dd>
Max number of CPUs used simultaneously. Defaults to the number of logical CPUs available.
</dd>
<dt>
<span class="term">
<code class="literal">setup.template.enabled</code>
</span>
</dt>
<dd>
Set to false to disable loading of Elasticsearch templates used for APM indices. If set to false, you must load the template manually.
</dd>
<dt>
<span class="term">
<code class="literal">setup.template.name</code>
</span>
</dt>
<dd>
Name of the template. Defaults to <code class="literal">apm-server</code>.
</dd>
<dt>
<span class="term">
<code class="literal">setup.template.pattern</code>
</span>
</dt>
<dd>
The template pattern to apply to the default index settings. Default is <code class="literal">apm-*</code>
</dd>
<dt>
<span class="term">
<code class="literal">setup.template.settings.index.number_of_shards</code>
</span>
</dt>
<dd>
Specifies the number of shards for the Elasticsearch template.
</dd>
<dt>
<span class="term">
<code class="literal">setup.template.settings.index.number_of_replicas</code>
</span>
</dt>
<dd>
Specifies the number of replicas for the Elasticsearch template.
</dd>
<dt>
<span class="term">
<code class="literal">output.elasticsearch.bulk_max_size</code>
</span>
</dt>
<dd>
<p>
Maximum number of events to bulk together in a single Elasticsearch bulk API request. By default, this number changes based on the size of the instance and server version:
</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Instance size</th>
<th align="left" valign="top">Version 6.5+</th>
<th align="left" valign="top">Version &lt;6.5</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>512MB</p></td>
<td align="left" valign="top"><p>267</p></td>
<td align="left" valign="top"><p>53</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1GB</p></td>
<td align="left" valign="top"><p>381</p></td>
<td align="left" valign="top"><p>68</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2GB</p></td>
<td align="left" valign="top"><p>533</p></td>
<td align="left" valign="top"><p>95</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>4GB</p></td>
<td align="left" valign="top"><p>762</p></td>
<td align="left" valign="top"><p>70</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>8GB</p></td>
<td align="left" valign="top"><p>1067</p></td>
<td align="left" valign="top"><p>96</p></td>
</tr>
</tbody>
</table>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">output.elasticsearch.indices</code>
</span>
</dt>
<dd>
Array of index selector rules supporting conditionals and formatted string.
</dd>
<dt>
<span class="term">
<code class="literal">output.elasticsearch.index</code>
</span>
</dt>
<dd>
The index to write the events to. If changed, <code class="literal">setup.template.name</code> and <code class="literal">setup.template.pattern</code> must be changed accordingly.
</dd>
<dt>
<span class="term">
<code class="literal">output.elasticsearch.worker</code>
</span>
</dt>
<dd>
<p>
Maximum number of concurrent workers publishing events to Elasticsearch. By default, this number changes based on the size of the instance and server version:
</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Instance size</th>
<th align="left" valign="top">Version 6.5+</th>
<th align="left" valign="top">Version &lt;6.5</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>512MB</p></td>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1GB</p></td>
<td align="left" valign="top"><p>7</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2GB</p></td>
<td align="left" valign="top"><p>10</p></td>
<td align="left" valign="top"><p>5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>4GB</p></td>
<td align="left" valign="top"><p>14</p></td>
<td align="left" valign="top"><p>10</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>8GB</p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>10</p></td>
</tr>
</tbody>
</table>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">queue.mem.events</code>
</span>
</dt>
<dd>
<p>
Maximum number of events to concurrently store in the internal queue. By default, this number changes based on the size of the instance and server version:
</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Instance size</th>
<th align="left" valign="top">Version 6.5+</th>
<th align="left" valign="top">Version &lt;6.5</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>512MB</p></td>
<td align="left" valign="top"><p>2000</p></td>
<td align="left" valign="top"><p>266</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>1GB</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>339</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2GB</p></td>
<td align="left" valign="top"><p>8000</p></td>
<td align="left" valign="top"><p>476</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>4GB</p></td>
<td align="left" valign="top"><p>16000</p></td>
<td align="left" valign="top"><p>699</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>8GB</p></td>
<td align="left" valign="top"><p>32000</p></td>
<td align="left" valign="top"><p>958</p></td>
</tr>
</tbody>
</table>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">queue.mem.flush.min_events</code>
</span>
</dt>
<dd>
Minimum number of events to have before pushing them to Elasticsearch. By default, this number changes based on the size of the instance.
</dd>
<dt>
<span class="term">
<code class="literal">queue.mem.flush.timeout</code>
</span>
</dt>
<dd>
Maximum duration before sending the events to the output if the <code class="literal">min_events</code> is not crossed.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Logging settings
</span>
</dt>
<dt>
<span class="term">
<code class="literal">logging.level</code>
</span>
</dt>
<dd>
Specifies the minimum log level. One of <em>debug</em>, <em>info</em>, <em>warning</em>, or <em>error</em>. Defaults to <em>info</em>.
</dd>
<dt>
<span class="term">
<code class="literal">logging.selectors</code>
</span>
</dt>
<dd>
The list of debugging-only selector tags used by different APM Server components. Use <em>*</em> to enable debug output for all components. For example, add <em>publish</em> to display all the debug messages related to event publishing.
</dd>
<dt>
<span class="term">
<code class="literal">logging.metrics.enabled</code>
</span>
</dt>
<dd>
If enabled, APM Server periodically logs its internal metrics that have changed in the last period. Defaults to <em>true</em>.
</dd>
<dt>
<span class="term">
<code class="literal">logging.metrics.period</code>
</span>
</dt>
<dd>
The period after which to log the internal metrics. Defaults to <em>30s</em>.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To change logging settings you must first <a class="xref" href="ec-enable-logging-and-monitoring.html" title="Enable logging and monitoring">enable deployment logging</a>.</p>
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ec-manage-kibana-settings.html">« Edit Kibana user settings</a>
</span>
<span class="next">
<a href="ec-manage-appsearch-settings.html">Add App Search user settings »</a>
</span>
</div>
</div>
</body>
</html>
