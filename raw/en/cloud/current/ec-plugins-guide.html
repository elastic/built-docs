<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Managing plugins and extensions through the API | Elasticsearch Service Documentation | Elastic</title>
<meta class="elastic" name="content" content="Managing plugins and extensions through the API | Elasticsearch Service Documentation">

<link rel="home" href="index.html" title="Elasticsearch Service Documentation"/>
<link rel="up" href="ec-adding-plugins.html" title="Add plugins and extensions"/>
<link rel="prev" href="ec-custom-bundles.html" title="Upload custom plugins and bundles"/>
<link rel="next" href="ec-regional-deployment-aliases.html" title="Custom endpoint aliases"/>
<meta class="elastic" name="product_version" content="latest"/>
<meta class="elastic" name="product_name" content="Elastic Cloud"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="latest"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="ec-custom-bundles.html">« Upload custom plugins and bundles</a>
</span>
<span class="next">
<a href="ec-regional-deployment-aliases.html">Custom endpoint aliases »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-prepare-production.html">Preparing a deployment for production</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-adding-plugins.html">Add plugins and extensions</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Managing plugins and extensions through the API</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ec-plugins-guide"></a>Managing plugins and extensions through the API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h2>
</div></div></div>
<p>This guide provides a full list of tasks for managing <a class="xref" href="ec-adding-plugins.html" title="Add plugins and extensions">plugins and extensions</a> in Elasticsearch Service, using the API.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-create" title="Create an extension">Create an extension</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-add-plan" title="Add an extension to a deployment plan">Add an extension to a deployment plan</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-get-extension" title="Get an extension">Get an extension</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-update-name" title="Update the name of an existing extension">Update the name of an existing extension</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-update-type" title="Update the type of an existing extension">Update the type of an existing extension</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-update-version-bundle" title="Update the version of an existing bundle">Update the version of an existing bundle</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-update-version-plugin" title="Update the version of an existing plugin">Update the version of an existing plugin</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-update-file" title="Update the file associated to an existing extension">Update the file associated to an existing extension</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-upgrade-elasticsearch" title="Upgrade Elasticsearch">Upgrade Elasticsearch</a>
</li>
<li class="listitem">
<a class="xref" href="ec-plugins-guide.html#ec-extension-guide-delete" title="Delete an extension">Delete an extension</a>
</li>
</ul>
</div>
<h3><a id="ec-extension-guide-create"></a>Create an extension<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>There are two methods to create an extension. You can:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Stream the file from a publicly-accessible download URL.
</li>
<li class="listitem">
Upload the file from a local file path.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For plugins larger than 200MB the download URL option <span class="strong strong"><strong>must</strong></span> be used. Plugins larger than 8GB cannot be uploaded with either method.</p>
</div>
</div>
<p>These two examples are for the <code class="literal">plugin</code> extension type. For bundles, change <code class="literal">extension_type</code> to <code class="literal">bundle</code>.</p>
<p>For plugins, <code class="literal">version</code> must match (exactly) the <code class="literal">elasticsearch.version</code> field defined in the plugin&#8217;s <code class="literal">plugin-descriptor.properties</code> file. Check <a href="/guide/en/elasticsearch/plugins/8.15/plugin-authors.html#plugin-authors" class="ulink" target="_top">Help for plugin authors</a> for details. For plugins larger than 5GB, the <code class="literal">plugin-descriptor.properties</code> file needs to be at the top of the archive. This ensures that the our verification process is able to detect that it is an Elasticsearch plugin; otherwise the plugin will be rejected by the API. This order can be achieved by specifying at time of creating the ZIP file: <code class="literal">zip -r name-of-plugin.zip plugin-descriptor.properties *</code>.</p>
<p>For bundles, we recommend setting <code class="literal">version</code> using wildcard notation that matches the major version of the Elasticsearch deployment. For example, if Elasticsearch is on version 8.4.3, simply set <code class="literal">8.*</code> as the version. The value <code class="literal">8.*</code> means that the bundle is compatible with all 8.x versions of Elasticsearch.</p>
<p><a id="ec-extension-guide-create-option1"></a><span class="strong strong"><strong>Option 1: Stream the file from a publicly-accessible download URL</strong></span></p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X POST \
  https://api.elastic-cloud.com/api/v1/deployments/extensions \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{
   "download_url" : "https://my_site/custom-plugin-8.4.3.zip",
   "extension_type" : "plugin",
   "name" : "custom-plugin",
   "version" : "8.4.3"
}'</pre>
</div>
<p>The single POST request creates an extension with the metadata, validates, and streams the file from the <code class="literal">download_url</code> specified. The accepted protocols for <code class="literal">download_url</code> are <code class="literal">http</code> and <code class="literal">https</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">download_url</code> must be directly and publicly accessible. There is currently no support for redirection or authentication unless it contains security credentials/tokens expected by your HTTP service as part of the URL. Otherwise, use the following Option 2 to upload the file from a local path.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When the file is larger than 5GB, the request may timeout after 2-5 minutes, but streaming will continue on the server. Check the Extensions page in the Cloud UI after 5-10 minutes to make sure that the plugin has been created. A successfully created plugin will contain correct name, type, version, size, and last modified information.</p>
</div>
</div>
<p><a id="ec-extension-guide-create-option2"></a><span class="strong strong"><strong>Option 2: Upload the file from a local file path</strong></span></p>
<p>This option requires a two step process. First, create the metadata for the extension:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X POST \
  https://api.elastic-cloud.com/api/v1/deployments/extensions \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{
    "extension_type": "plugin",
    "name": "custom-plugin",
    "version" : "8.4.3"
}'</pre>
</div>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
    "url": "repo://4226448541",
    "version": "8.4.3",
    "extension_type": "plugin",
    "id": "4226448541",
    "name": "custom-plugin"
}</pre>
</div>
<p>The response returns a <code class="literal">url</code> you can reference later in the plan (the numeric value in the <code class="literal">url</code> is the <code class="literal">EXTENSION_ID</code>). Use this <code class="literal">EXTENSION_ID</code> in the following PUT call:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -v -X PUT "https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID" \
-H 'Content-type:application/zip' \
-H "Authorization: ApiKey $CLOUD_API_KEY" \
-H 'Expect:' \
-T "/path_to/custom-plugin-8.4.3.zip"</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using curl, always use the <code class="literal">-T</code> option.  DO NOT use <code class="literal">-F</code> (we have seen inconsistency in curl behavior across systems; using <code class="literal">-F</code> can result in partially uploaded or truncated files).</p>
</div>
</div>
<p>The above PUT request uploads the file from the local path specified. This request is synchronous. An HTTP 200 response indicates that the file has been successfully uploaded and is ready for use.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
    "url": "repo://2286113333",
    "version": "8.4.3",
    "extension_type": "plugin",
    "id": "2286113333",
    "name": "custom-plugin"
}</pre>
</div>
<h3><a id="ec-extension-guide-add-plan"></a>Add an extension to a deployment plan<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>Once the extension is created and uploaded, you can add the extension using its <code class="literal">EXTENSION_ID</code> in an <a class="xref" href="Deployment_-_CRUD.html#update-deployment" title="Update Deployment">update deployment API call</a>.</p>
<p>The following are examples of a GCP plan. Your specific deployment plan will be different. The important parts related to extensions are in the <code class="literal">user_plugins</code> object.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
    "name": "Extensions",
    "prune_orphans": false,
    "resources": {
        "elasticsearch": [
            {
                "region": "gcp-us-central1",
                "ref_id": "main-elasticsearch",
                "plan": {
                    "cluster_topology": [

                      ...

                    ],
                    "elasticsearch": {
                        "version": "8.4.3",
                        "enabled_built_in_plugins": [ ],
                      "user_bundles": [
                        {
                          "name": "custom-plugin",
                          "url": "repo://2286113333",
                          "elasticsearch_version": "8.4.3"
                        }
                      ]
                    },
                    "deployment_template": {
                        "id": "gcp-storage-optimized-v3"
                    }
                }
            }
        ]
    }
}</pre>
</div>
<p>You can use the <a href="/guide/en/elasticsearch/reference/8.15/cat-plugins.html" class="ulink" target="_top">cat plugins API</a> to confirm that the plugin has been deployed successfully to Elasticsearch.</p>
<p>The previous examples are for plugins. For bundles, use the <code class="literal">user_bundles</code> construct instead.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">      "user_bundles": [
              {
                    "elasticsearch_version": "8.*",
                    "name": "custom-bundle",
                    "url": "repo://5886113212"
              }
       ]</pre>
</div>
<h3><a id="ec-extension-guide-get-extension"></a>Get an extension<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>You can use the GET call to retrieve information about an extension.</p>
<p>To list all extensions for the account:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X GET \
  https://api.elastic-cloud.com/api/v1/deployments/extensions \
  -H 'Content-Type: application/json' \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \</pre>
</div>
<p>To get a specific extension:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X GET \
  https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID \
  -H 'Content-Type: application/json' \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \</pre>
</div>
<p>The previous GET calls support an optional <code class="literal">include_deployments</code> parameter. When set to <code class="literal">true</code>, the call also returns the deployments that currently have the extension in-use:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X GET \
  https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID?include_deployments=true \
  -H 'Content-Type: application/json' \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \</pre>
</div>
<p>For example, the previous call returns:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
    "name": "custom-plugin",
    "url": "repo://2286113333",
    "extension_type": "plugin",
    "deployments": [
        "f91f3a9360a74e9d8c068cd2698c92ea"
    ],
    "version": "8.4.3",
    "id": "2286113333"
}</pre>
</div>
<h3><a id="ec-extension-guide-update-name"></a>Update the name of an existing extension<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>To update the name of an existing extension, simply update the name field without uploading a new file. You do not have to specify the <code class="literal">download_url</code> when only making metadata changes to an extension.</p>
<p>Example using the <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-create-option1">Option 1</a> create an extension method:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X POST \
  https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{
   "extension_type" : "plugin",
    "name": "custom-plugin-07012020",
   "version" : "8.4.3"
}'</pre>
</div>
<p>Example using the <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-create-option2">Option 2</a> create an extension method:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X POST \
  https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{
   "extension_type" : "plugin",
    "name": "custom-plugin-07012020",
   "version" : "8.4.3"
}'</pre>
</div>
<p>Updating the name of an existing extension does not change its <code class="literal">EXTENSION_ID</code>.</p>
<h3><a id="ec-extension-guide-update-type"></a>Update the type of an existing extension<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>Updating <code class="literal">extension_type</code> has no effect. You cannot change the extension&#8217;s type (<code class="literal">plugin</code> versus <code class="literal">bundle</code>) after the initial creation of a plugin.</p>
<h3><a id="ec-extension-guide-update-version-bundle"></a>Update the version of an existing bundle<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>For bundles, we recommend setting <code class="literal">version</code> using wildcard notation that matches the major version of the Elasticsearch deployment. For example, if Elasticsearch is on version 8.4.3, simply set <code class="literal">8.*</code> as the version. The value <code class="literal">8.*</code> means that the bundle is compatible with all 7.x versions of Elasticsearch.</p>
<p>For example, if the bundle was previously uploaded with the version <code class="literal">8.4.2</code>, simply update the version field. You no longer have to specify the <code class="literal">download_url</code> when only making metadata changes to a bundle.</p>
<p>Example using the <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-create-option1">Option 1</a> create an extension method:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X POST \
  https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{
   "extension_type" : "bundle",
    "name": "custom-bundle",
   "version" : "8.*"
}'</pre>
</div>
<p>Example using the <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-create-option2">Option 2</a> create an extension method:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X POST \
  https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{
    "extension_type" : "bundle",
    "name": "custom-bundle",
    "version" : "8.*"
}'</pre>
</div>
<p>Updating the name of an existing extension does not change its <code class="literal">EXTENSION_ID</code>.</p>
<h3><a id="ec-extension-guide-update-version-plugin"></a>Update the version of an existing plugin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>For plugins, <code class="literal">version</code> must match (exactly) the <code class="literal">elasticsearch.version</code> field defined in the plugin&#8217;s <code class="literal">plugin-descriptor.properties</code> file.  Check <a href="/guide/en/elasticsearch/plugins/8.15/plugin-authors.html#plugin-authors" class="ulink" target="_top">Help for plugin authors</a> for details. If you change the version, the associated plugin file <em>must</em> also be updated accordingly.</p>
<h3><a id="ec-extension-guide-update-file"></a>Update the file associated to an existing extension<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>You may want to update an uploaded file for an existing extension without performing an Elasticsearch upgrade. If you are updating the extension to prepare for an Elasticsearch upgrade, check the <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-upgrade-elasticsearch" title="Upgrade Elasticsearch">Upgrade Elasticsearch</a> scenario later on this page.</p>
<p>This example is for the <code class="literal">plugin</code> extension type. For bundles, change <code class="literal">extension_type</code> to <code class="literal">bundle</code>.</p>
<p>If you used <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-create-option1">Option 1</a> to create the extension, simply re-run the POST request with the <code class="literal">download_url</code> pointing to the location of your updated extension file.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X POST \
  https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{
   "download_url" : "https://my_site/custom-plugin-8.4.3-10212022.zip",
   "extension_type" : "plugin",
    "name": "custom-plugin-10212022",
   "version" : "8.4.3"
}'</pre>
</div>
<p>If you used <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-create-option2">Option 2</a> to create the extension, simply re-run the PUT request with the <code class="literal">file</code> parameter pointing to the location of your updated extension file.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -v -X PUT "https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID" \
-H 'Content-type:application/zip' \
-H "Authorization: ApiKey $CLOUD_API_KEY" \
-H 'Expect:' \
-T "/path_to/custom-plugin-8.4.3-10212022.zip"</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are not making any other plan changes and simply updating an extension file, you need to issue a no-op plan so that Elasticsearch will make use of this new file. A <em>no-op</em> (no operation) plan triggers a rolling restart on the deployment, applying the same (unchanged) plan as the current plan.</p>
</div>
</div>
<p>Updating the file of an existing extension or bundle does not change its <code class="literal">EXTENSION_ID</code>.</p>
<h3><a id="ec-extension-guide-upgrade-elasticsearch"></a>Upgrade Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>When you upgrade Elasticsearch in a deployment, you must ensure that:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Bundles are on versions that are compatible with the Elasticsearch version that you are upgrading to.
</li>
<li class="listitem">
Plugins match (exactly) the Elasticsearch upgrade version.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>To prepare existing bundle and update the plan:</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Update the bundle version to be compatible with the Elasticsearch upgrade version.</strong></span></p>
<p>Bundles using wildcard notation for versions (for example, <code class="literal">7.*</code>, <code class="literal">8.*</code>) in their extension metadata are compatible with all minor versions of the same Elasticsearch major version. In other words, if you are performing a patch (for example, from <code class="literal">8.4.2</code> to <code class="literal">8.4.3</code>) or a minor (for example <code class="literal">8.3.0</code> to <code class="literal">8.4.3</code>) version upgrade of Elasticsearch and you are already using <code class="literal">8.*</code> as the <code class="literal">version</code> for the extension, you are ready for the Elasticsearch upgrade and can proceed to Step 2.</p>
<p>However, if you are using a specific <code class="literal">version</code> for bundles, or upgrading to a major version, you must update the metadata of the extension to specify the matching Elasticsearch <code class="literal">version</code> that you are upgrading to, or use the wildcard syntax described in the previous paragraph. For example, if you are upgrading from version 7.x to 8.x, set <code class="literal">version</code> to <code class="literal">8.*</code> before the upgrade. Refer to <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-update-version-bundle" title="Update the version of an existing bundle">Update the version of an existing bundle</a>.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Update the bundle reference as part of an upgrade plan.</strong></span></p>
<p>Submit a plan change that performs the following operations in a <em>single</em> <a class="xref" href="Deployment_-_CRUD.html#update-deployment" title="Update Deployment">Update Deployment</a> API call:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Upgrade the version of Elasticsearch to the upgrade version (for example, <code class="literal">8.4.3</code>).
</li>
<li class="listitem">
Update reference to the existing bundle to be compatible with Elasticsearch upgrade version (for example, <code class="literal">8.*</code>).
</li>
</ul>
</div>
<p>This triggers a rolling upgrade plan change to the later Elasticsearch version and updates the reference to the bundle at the same time.</p>
<p>The following example shows the upgrade of an Elasticsearch deployment and its bundle. You can also upgrade other deployment resources within the same plan change.</p>
<p>Update <code class="literal">resources.elasticsearch.plan.elasticsearch.version</code> and <code class="literal">resources.elasticsearch.plan.cluster_topology.elasticsearch.user_bundles.elasticsearch_version</code> accordingly.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
    "name": "Extensions",
    "prune_orphans": false,
    "resources": {
        "elasticsearch": [
            {
                "region": "gcp-us-central1",
                "ref_id": "main-elasticsearch",
                "plan": {
                    "cluster_topology": [
                      ...
                    ],
                    "elasticsearch": {
                        "version": "8.4.3",
                        "enabled_built_in_plugins": [],
                        "user_bundles": [
                            {
                                  "elasticsearch_version": "7.*",
                                  "name": "custom-bundle",
                                  "url": "repo://5886113212"
                            }
                        ]

                    },
                    "deployment_template": {
                        "id": "gcp-storage-optimized-v3"
                    }
                }
            }
        ]
    }
}</pre>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>To create a new plugin and update the plan:</strong></span></p>
<p>Unlike bundles, plugins <em>must</em> match the Elasticsearch version down to the patch level (for example, <code class="literal">8.4.3</code>). When upgrading Elasticsearch to a new patch, minor, or major version, update the version in the extension metadata and update the extension file. The following example updates an existing plugin and upgrades the Elasticsearch deployment from version 8.3.0 to 8.4.3.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Create a new plugin that matches the Elasticsearch upgrade version.</strong></span></p>
<p>Follow the steps in <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-get-extension" title="Get an extension">Get an extension</a> to create a new extension with a <code class="literal">version</code> metadata field and the plugin&#8217;s <code class="literal">elasticsearch.version</code> field in <code class="literal">plugin-descriptor.properties</code> that matches the Elasticsearch upgrade version (for example, <code class="literal">8.4.3</code>).</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Remove the old plugin and add the new plugin to the upgrade plan.</strong></span></p>
<p>Submit a plan change that performs the following operations in a <em>single</em> <a class="xref" href="Deployment_-_CRUD.html#update-deployment" title="Update Deployment">Update Deployment</a> API call:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Upgrade the version of Elasticsearch to the upgrade version (for example, <code class="literal">8.4.3</code>).
</li>
<li class="listitem">
Remove reference to the the plugin on the older version (for example, <code class="literal">8.3.0</code>) from the plan.
</li>
<li class="listitem">
Add reference to the new plugin on the upgrade version (for example, <code class="literal">8.4.3</code>) to the plan.
</li>
</ul>
</div>
<p>This triggers a rolling upgrade plan change to the later Elasticsearch version, removes reference to the older plugin, and deploys your updated plugin at the same time.</p>
<p>The following example shows the upgrade of an Elasticsearch deployment and its plugin. You can also upgrade other deployment resources within the same plan change.</p>
<p>Update deployment plans, update <code class="literal">resources.elasticsearch.plan.elasticsearch.version</code> and <code class="literal">resources.elasticsearch.plan.cluster_topology.elasticsearch.user_plugins.elasticsearch_version</code> accordingly.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
    "name": "Extensions",
    "prune_orphans": false,
    "resources": {
        "elasticsearch": [
            {
                "region": "gcp-us-central1",
                "ref_id": "main-elasticsearch",
                "plan": {
                    "cluster_topology": [
                      ...
                    ],
                    "elasticsearch": {
                        "version": "8.4.3",
                        "enabled_built_in_plugins": [],
                        "user_plugins": [
                           {
                                "elasticsearch_version": "8.4.3",
                                "name": "custom-plugin",
                                "url": "repo://4226448541"
                            }
                        ]

                    },
                    "deployment_template": {
                        "id": "gcp-storage-optimized-v3"
                    }
                }
            }
        ]
    }
}</pre>
</div>
<p>You can use the <a href="/guide/en/elasticsearch/reference/8.15/cat-plugins.html" class="ulink" target="_top">cat plugins API</a> to confirm that the plugin has been upgraded successfully to Elasticsearch.</p>
</li>
</ol>
</div>
<h3><a id="ec-extension-guide-delete"></a>Delete an extension<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-110/docs/saas/ec-plugins-guide.asciidoc">edit</a></h3>
<p>You can delete an extension simply by calling a DELETE against the EXTENSION_ID of interest:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -X DELETE \
  https://api.elastic-cloud.com/api/v1/deployments/extensions/EXTENSION_ID \
  -H "Authorization: ApiKey $CLOUD_API_KEY" \
  -H 'Content-Type: application/json'</pre>
</div>
<p>Only extensions not currently referenced in a deployment plan can be deleted. If you attempt to delete an extension that is in use, you will receive an HTTP 400 Bad Request error like the following, indicating the deployments that are currently using the extension.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
    "errors": [
        {
            "message": "Cannot delete extension [EXTENSION_ID]. It is used by deployments [DEPLOYMENT_NAME].",
            "code": "extensions.extension_in_use"
        }
    ]
}</pre>
</div>
<p>To remove an extension reference from a deployment plan, simply update the deployment with the extension reference deleted from the <code class="literal">user_plugins</code> or <code class="literal">user_bundles</code> arrays. Check <a class="xref" href="ec-plugins-guide.html#ec-extension-guide-add-plan" title="Add an extension to a deployment plan">Add an extension to a deployment plan</a> for where these are specified in the plan.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ec-custom-bundles.html">« Upload custom plugins and bundles</a>
</span>
<span class="next">
<a href="ec-regional-deployment-aliases.html">Custom endpoint aliases »</a>
</span>
</div>
</body>
</html>
