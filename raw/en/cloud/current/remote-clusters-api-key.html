<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Add remote clusters using API key authentication | Elasticsearch Service Documentation | Elastic</title>
<meta class="elastic" name="content" content="Add remote clusters using API key authentication | Elasticsearch Service Documentation">

<link rel="home" href="index.html" title="Elasticsearch Service Documentation"/>
<link rel="up" href="ec-enable-ccs.html" title="Enable cross-cluster search and cross-cluster replication"/>
<link rel="prev" href="ec-enable-ccs.html" title="Enable cross-cluster search and cross-cluster replication"/>
<link rel="next" href="ec-configure-as-remote-clusters.html" title="Add remote clusters using TLS certificate authentication"/>
<meta class="elastic" name="product_version" content="latest"/>
<meta class="elastic" name="product_name" content="Elastic Cloud"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="latest"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-best-practices-data.html">Best practices for managing your data</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-enable-ccs.html">Enable cross-cluster search and cross-cluster replication</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ec-enable-ccs.html">« Enable cross-cluster search and cross-cluster replication</a>
</span>
<span class="next">
<a href="ec-configure-as-remote-clusters.html">Add remote clusters using TLS certificate authentication »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="remote-clusters-api-key"></a>Add remote clusters using API key authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-103/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>API key authentication enables a local cluster to authenticate itself with a
remote cluster via a
<a href="/guide/en/elasticsearch/reference/8.13/security-api-create-cross-cluster-api-key.html" class="ulink" target="_top">cross-cluster API key</a>. The
API key needs to be created by an administrator of the remote cluster. The local
cluster is configured to provide this API key on each request to the remote
cluster. The remote cluster verifies the API key and grants access, based on the
API key&#8217;s privileges.</p>
<p>All cross-cluster requests from the local cluster are bound by the API key&#8217;s
privileges, regardless of local users associated with the requests. For example,
if the API key only allows read access to <code class="literal">my-index</code> on the remote cluster, even
a superuser from the local cluster is limited by this constraint. This mechanism
enables the remote cluster&#8217;s administrator to have full control over who can
access what data with cross-cluster search and/or cross-cluster replication. The
remote cluster&#8217;s administrator can be confident that no access is possible
beyond what is explicitly assigned to the API key.</p>
<p>On the local cluster side, not every local user needs to access every piece of
data allowed by the API key. An administrator of the local cluster can further
configure additional permission constraints on local users so each user only
gets access to the necessary remote data. Note it is only possible to further
reduce the permissions allowed by the API key for individual local users. It is
impossible to increase the permissions to go beyond what is allowed by the API
key.</p>
<p>To add a remote cluster using API key authentication:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="remote-clusters-api-key.html#remote-clusters-prerequisites-api-key" title="Prerequisites and limitations">Review the prerequisites and limitations</a>
</li>
<li class="listitem">
<a class="xref" href="remote-clusters-api-key.html#remote-clusters-api-key-generate" title="Create a cross-cluster API key on the remote deployment">Create a cross-cluster API key on the remote deployment</a>
</li>
<li class="listitem">
<a class="xref" href="remote-clusters-api-key.html#remote-clusters-api-key-keystore" title="Add the cross-cluster API key to the keystore of the local deployment">Add the cross-cluster API key to the keystore of the local deployment</a>
</li>
<li class="listitem">
<a class="xref" href="remote-clusters-api-key.html#remote-clusters-api-key-connect" title="Connect to a remote cluster">Connect to a remote cluster</a>
</li>
<li class="listitem">
<a class="xref" href="remote-clusters-api-key.html#remote-clusters-api-key-privileges" title="Configure roles and users">Configure roles and users</a>
</li>
</ol>
</div>
<p>If you run into any issues, refer to
<a href="/guide/en/elasticsearch/reference/8.13/remote-clusters-troubleshooting.html" class="ulink" target="_top">Troubleshooting</a>.</p>
<h4><a id="remote-clusters-prerequisites-api-key"></a>Prerequisites and limitations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-103/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The local and remote deployments must be on version 8.10 or later.
</li>
<li class="listitem">
The local and remote deployments must be Elasticsearch Service deployments hosted on Elastic Cloud.
</li>
<li class="listitem">
The local and remote deployments must be hosted in the same region.
</li>
<li class="listitem">
API key authentication can&#8217;t be used in combination with traffic filters.
</li>
<li class="listitem">
Contrary to the certificate based security model, the API key based security model does not require setting up trust between the local and remote clusters.
</li>
</ul>
</div>
<h4><a id="remote-clusters-api-key-generate"></a>Create a cross-cluster API key on the remote deployment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-103/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
On the remote deployment, use the Elasticsearch
<a href="/guide/en/elasticsearch/reference/8.13/security-api-create-cross-cluster-api-key.html" class="ulink" target="_top">Create cross-cluster key
API</a> or <a href="/guide/en/kibana/8.13/api-keys.html" class="ulink" target="_top">Kibana</a> to create a cross-cluster API key.
Configure it with access to the indices you want to use for cross-cluster search or cross-cluster replication.
</li>
<li class="listitem">
Copy the encoded key (<code class="literal">encoded</code> in the response) to a safe location. You will
need it in the next step.
</li>
</ul>
</div>
<h4><a id="remote-clusters-api-key-keystore"></a>Add the cross-cluster API key to the keystore of the local deployment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-103/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><a class="xref" href="ec-configuring-keystore.html#ec-add-secret-values" title="Add secret values">Add a secret value to the keystore</a> of the local
deployment:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to the <a href="https://cloud.elastic.co?page=docs&amp;placement=docs-body" class="ulink" target="_top">Elasticsearch Service Console</a>.
</li>
<li class="listitem">
<p>Find your deployment on the home page in the Elasticsearch Service card and select <span class="strong strong"><strong>Manage</strong></span> to access it directly. Or, select <span class="strong strong"><strong>Dedicated deployments</strong></span> to go to the deployments page to view all of your deployments.</p>
<p>On the deployments page you can narrow your deployments by name, ID, or choose from several other filters. To customize your view, use a combination of filters, or change the format from a grid to a list.</p>
</li>
<li class="listitem">
From the deployment menu, select <span class="strong strong"><strong>Security</strong></span>.
</li>
<li class="listitem">
Locate <span class="strong strong"><strong>Elasticsearch keystore</strong></span>.
</li>
<li class="listitem">
<p>Add a setting:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Enter the name <code class="literal">cluster.remote.ALIAS.credentials</code>, replacing <code class="literal">ALIAS</code> with the alias you will use to connect to the remote cluster later.
</li>
<li class="listitem">
Paste the encoded cross-cluster API key as the secret.
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Restart the local deployment.
</li>
</ul>
</div>
<h4><a id="remote-clusters-api-key-connect"></a>Connect to a remote cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-103/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h4>
<p>On the local cluster, add the remote cluster using Kibana or the Elasticsearch API.</p>
<h5><a id="ec-configure-as-remote-clusters-using-kibana-api-key"></a>Using Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-103/docs/shared/ec-ce-enable-ccs-add-remote-cluster.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the Kibana main menu, and select <span class="strong strong"><strong>Stack Management &gt; Data &gt; Remote Clusters &gt; Add a remote cluster</strong></span>.
</li>
<li class="listitem">
Enable <span class="strong strong"><strong>Manually enter proxy address and server name</strong></span>.
</li>
<li class="listitem">
<p>Fill in the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Name</strong></span>: This <em>cluster alias</em> is a unique identifier that represents the
connection to the remote cluster and is used to distinguish between local and
remote indices.
</li>
<li class="listitem">
<span class="strong strong"><strong>Proxy address</strong></span>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elasticsearch Service deployment you want to use as a remote.
Change the port into <code class="literal">9443</code>.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Server name</strong></span>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elasticsearch Service deployment you want to use as a remote.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ce-copy-remote-cluster-parameters.png" alt="Remote Cluster Parameters in Deployment">
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Next</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add remote cluster</strong></span> (you have already established trust in a previous step).
</li>
</ol>
</div>
<h5><a id="ec-configure-as-remote-clusters-using-elasticsearch-api-api-key"></a>Using the Elasticsearch API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-103/docs/shared/ec-ce-enable-ccs-add-remote-cluster.asciidoc">edit</a></h5>
<p>To configure a deployment as a remote cluster, use the <a href="/guide/en/elasticsearch/reference/8.13/cluster-update-settings.html" class="ulink" target="_top">cluster update settings API</a>. Configure the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">mode</code>: <code class="literal">proxy</code>
</li>
<li class="listitem">
<code class="literal">proxy_address</code>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elasticsearch Service deployment you want to use as a remote.
Change the port into <code class="literal">9443</code>.
Also, using the API, this value can be obtained from the Elasticsearch resource info, concatenating the field <code class="literal">metadata.endpoint</code> and port <code class="literal">9443</code> using a semicolon.
</li>
<li class="listitem">
<code class="literal">server_name</code>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elasticsearch Service deployment you want to use as a remote. Also, using the API, this can be obtained from the Elasticsearch resource info field <code class="literal">metadata.endpoint</code>.
</li>
</ul>
</div>
<p>This is an example of the API call to <code class="literal">_cluster/settings</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">PUT /_cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "alias-for-my-remote-cluster": {
          "mode":"proxy",
          "proxy_address": "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io:9443",
          "server_name": "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io"
        }
      }
    }
  }
}</pre>
</div>
<h4><a id="remote-clusters-api-key-privileges"></a>Configure roles and users<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-103/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h4>
<p>To use a remote cluster for cross-cluster replication or cross-cluster search, you need to create user roles with
<a href="/guide/en/elasticsearch/reference/8.13/defining-roles.html#roles-remote-indices-priv" class="ulink" target="_top">remote indices privileges</a>
on the local cluster. Refer to
<a href="/guide/en/elasticsearch/reference/8.13/remote-clusters-api-key.html#remote-clusters-privileges-api-key" class="ulink" target="_top">Configure
roles and users</a>.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ec-enable-ccs.html">« Enable cross-cluster search and cross-cluster replication</a>
</span>
<span class="next">
<a href="ec-configure-as-remote-clusters.html">Add remote clusters using TLS certificate authentication »</a>
</span>
</div>
</div>
</body>
</html>
