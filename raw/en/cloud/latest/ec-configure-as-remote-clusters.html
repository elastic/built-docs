<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Add remote clusters using TLS certificate authentication | Elasticsearch Service Documentation | Elastic</title>
<meta class="elastic" name="content" content="Add remote clusters using TLS certificate authentication | Elasticsearch Service Documentation">

<link rel="home" href="index.html" title="Elasticsearch Service Documentation"/>
<link rel="up" href="ec-enable-ccs.html" title="Enable cross-cluster search and cross-cluster replication"/>
<link rel="prev" href="remote-clusters-api-key.html" title="Add remote clusters using API key authentication"/>
<link rel="next" href="ec-migrate-ccs.html" title="Migrate the cross-cluster search deployment template"/>
<meta class="elastic" name="product_version" content="latest"/>
<meta class="elastic" name="product_name" content="Elastic Cloud"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="latest"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-best-practices-data.html">Best practices for managing your data</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-enable-ccs.html">Enable cross-cluster search and cross-cluster replication</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="remote-clusters-api-key.html">« Add remote clusters using API key authentication</a>
</span>
<span class="next">
<a href="ec-migrate-ccs.html">Migrate the cross-cluster search deployment template »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ec-configure-as-remote-clusters"></a>Add remote clusters using TLS certificate authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-101/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h2>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Configure both the local cluster and the remote cluster in your environment to <a class="xref" href="ec-trust-management.html" title="Trust management">trust each other</a>. The steps are different depending on where the local and remote cluster live.
</li>
<li class="listitem">
On the local cluster, add the remote cluster using Kibana, the Elasticsearch API, or
the Elasticsearch Service RESTful API.
</li>
</ol>
</div>
<h4><a id="ec-configure-as-remote-clusters-using-kibana{id-postfix}"></a>Using Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-101/docs/shared/ec-ce-enable-ccs-add-remote-cluster.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the Kibana main menu, and select <span class="strong strong"><strong>Stack Management &gt; Data &gt; Remote Clusters &gt; Add a remote cluster</strong></span>.
</li>
<li class="listitem">
Enable <span class="strong strong"><strong>Manually enter proxy address and server name</strong></span>.
</li>
<li class="listitem">
<p>Fill in the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Name</strong></span>: This <em>cluster alias</em> is a unique identifier that represents the
connection to the remote cluster and is used to distinguish between local and
remote indices.
</li>
<li class="listitem">
<span class="strong strong"><strong>Proxy address</strong></span>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elasticsearch Service deployment you want to use as a remote.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Server name</strong></span>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elasticsearch Service deployment you want to use as a remote.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ce-copy-remote-cluster-parameters.png" alt="Remote Cluster Parameters in Deployment">
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Next</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add remote cluster</strong></span> (you have already established trust in a previous step).
</li>
</ol>
</div>
<h4><a id="ec-configure-as-remote-clusters-using-elasticsearch-api{id-postfix}"></a>Using the Elasticsearch API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-101/docs/shared/ec-ce-enable-ccs-add-remote-cluster.asciidoc">edit</a></h4>
<p>To configure a deployment as a remote cluster, use the <a href="/guide/en/elasticsearch/reference/8.12/cluster-update-settings.html" class="ulink" target="_top">cluster update settings API</a>. Configure the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">mode</code>: <code class="literal">proxy</code>
</li>
<li class="listitem">
<code class="literal">proxy_address</code>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elasticsearch Service deployment you want to use as a remote.
Also, using the API, this value can be obtained from the Elasticsearch resource info, concatenating the field <code class="literal">metadata.endpoint</code> and port <code class="literal">9400</code> using a semicolon.
</li>
<li class="listitem">
<code class="literal">server_name</code>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the Elasticsearch Service deployment you want to use as a remote. Also, using the API, this can be obtained from the Elasticsearch resource info field <code class="literal">metadata.endpoint</code>.
</li>
</ul>
</div>
<p>This is an example of the API call to <code class="literal">_cluster/settings</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">PUT /_cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "alias-for-my-remote-cluster": {
          "mode":"proxy",
          "proxy_address": "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io:9400",
          "server_name": "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io"
        }
      }
    }
  }
}</pre>
</div>
<details>
<summary class="title"><span class="strong strong"><strong>Stack Version above 6.7.0 and below 7.6.0</strong></span></summary>
<div class="content">
<p>When the cluster to be configured as a remote is above 6.7.0 and below 7.6.0, the remote cluster must be configured using the <a href="/guide/en/elasticsearch/reference/8.12/remote-clusters.html#sniff-mode" class="ulink" target="_top">sniff mode</a> with the proxy field.
For each remote cluster you need to pass the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Proxy</strong></span>: This value can be found on the <span class="strong strong"><strong>Security</strong></span> page of the deployment you want to use as a remote under the name <code class="literal">Proxy Address</code>. Also, using the API, this can be obtained from the elasticsearch resource info, concatenating the fields <code class="literal">metadata.endpoint</code> and <code class="literal">metadata.ports.transport_passthrough</code> using a semicolon.
</li>
<li class="listitem">
<span class="strong strong"><strong>Seeds</strong></span>: This field is an array that must contain only one value, which is the <code class="literal">server name</code> that can be found on the <span class="strong strong"><strong>Security</strong></span> page of the {s} deployment you want to use as a remote concatenated with <code class="literal">:1</code>. Also, using the API, this can be obtained from the Elasticsearch resource info, concatenating the fields <code class="literal">metadata.endpoint</code> and <code class="literal">1</code> with a semicolon.
</li>
<li class="listitem">
<span class="strong strong"><strong>Mode</strong></span>: sniff (or empty, since sniff is the default value)
</li>
</ul>
</div>
<p>This is an example of the API call to <code class="literal">_cluster/settings</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "persistent": {
    "cluster": {
      "remote": {
        "my-remote-cluster-1": {
          "seeds": [
            "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io:1"
          ],
          "proxy": "a542184a7a7d45b88b83f95392f450ab.192.168.44.10.ip.es.io:9400"
        }
      }
    }
  }
}</pre>
</div>
</div>
</details>
<h4><a id="ec-configure-as-remote-clusters-using-cloud-api"></a>Using the Elasticsearch Service RESTful API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-101/docs/shared/ec-ce-enable-ccs-add-remote-cluster.asciidoc">edit</a></h4>
<p>The following PUT request configures a remote cluster which also lives inside Elasticsearch Service and belongs to the same organization (for other scenarios, <a class="xref" href="ec-configure-as-remote-clusters.html#ec-configure-as-remote-clusters-using-elasticsearch-api{id-postfix}" title="Using the Elasticsearch API">the Elasticsearch API</a> should be used instead):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -H 'Content-Type: application/json' -X PUT -H "Authorization: ApiKey $EC_API_KEY" https://api.elastic-cloud.com/api/v1/deployments/$DEPLOYMENT_ID/elasticsearch/$REF_ID/remote-clusters -d '
{
  "resources" : [
    {
      "deployment_id": "$DEPLOYMENT_ID_REMOTE",
      "elasticsearch_ref_id": "$REF_ID_REMOTE",
      "alias": "alias-your-remote",
      "skip_unavailable" : true
    }
  ]
}'</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">DEPLOYMENT_ID_REMOTE</code>
</span>
</dt>
<dd>
The ID of your remote deployment, as shown in the Cloud UI or obtained through the API.
</dd>
<dt>
<span class="term">
<code class="literal">REF_ID_REMOTE</code>
</span>
</dt>
<dd>
The unique ID of the Elasticsearch resources inside your remote deployment (you can obtain these values through the API).
</dd>
</dl>
</div>
<p>Note the following when using the Elasticsearch Service RESTful API:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
A cluster alias must contain only letters, numbers, dashes (-), or underscores (_).
</li>
<li class="listitem">
To learn about skipping disconnected clusters, refer to the <a href="/guide/en/elasticsearch/reference/8.12/modules-cross-cluster-search.html#skip-unavailable-clusters" class="ulink" target="_top">Elasticsearch documentation</a>.
</li>
<li class="listitem">
When remote clusters are already configured for a deployment, the <code class="literal">PUT</code> request replaces the existing configuration with the new configuration passed. Passing an empty array of resources will remove all remote clusters.
</li>
</ol>
</div>
<p>The following API request retrieves the remote clusters configuration:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -X GET -H "Authorization: ApiKey $EC_API_KEY" https://api.elastic-cloud.com/api/v1/deployments/$DEPLOYMENT_ID/elasticsearch/$REF_ID/remote-clusters</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The response will include just the remote clusters from the same organization in Elasticsearch Service.
In order to obtain the whole list of remote clusters, use Kibana or the Elasticsearch API <a href="/guide/en/elasticsearch/reference/8.12/cluster-remote-info.html" class="ulink" target="_top">Elasticsearch API</a> directly.</p>
</div>
</div>
<h3><a id="ec-configure-self-managed-as-remote-cluster"></a>Configure a self-managed cluster as the remote cluster of an Elasticsearch Service cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-101/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Configure both the local cluster and the remote cluster in your environment to <a class="xref" href="ec-trust-management.html" title="Trust management">trust each other</a>. The steps are different depending on where the local and remote cluster live.
</li>
<li class="listitem">
Open the Kibana main menu, and select <span class="strong strong"><strong>Stack Management &gt; Data &gt; Remote Clusters &gt; Add a remote cluster</strong></span>.
</li>
<li class="listitem">
To add a self-managed remote cluster, fill in the fields. You may need to use sniff mode or the proxy mode depending on the topology of your self-managed cluster and your network configuration. Find more details in the <a href="/guide/en/elasticsearch/reference/8.12/remote-clusters.html" class="ulink" target="_top">remote clusters documentation</a>.
</li>
</ol>
</div>
<h3><a id="ec-enable-ccr"></a>Enable CCR and the Remote Clusters UI in Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-101/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h3>
<p>If your deployment was created before February 2021, CCR won&#8217;t be enabled and you won&#8217;t find the Remote Clusters UI in Kibana even though your deployment meets all the <a class="xref" href="ec-enable-ccs.html#ec-ccs-ccr-prerequisites" title="Prerequisites">criteria</a>.</p>
<p>To enable these features, go to the <span class="strong strong"><strong>Security</strong></span> page of your deployment and under <span class="strong strong"><strong>Trust management</strong></span> select <span class="strong strong"><strong>Enable CCR</strong></span>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>CCR is not supported for indices used by Enterprise Search.</p>
</div>
</div>
<h3><a id="ec-ccs-ccr-traffic-filtering"></a>Remote clusters and traffic filtering<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-101/docs/shared/ec-ce-enable-ccs.asciidoc">edit</a></h3>
<p>For remote clusters configured using TLS certificate authentication,
<a class="xref" href="ec-traffic-filtering-deployment-configuration.html" title="Traffic Filtering">traffic filtering</a> can be
enabled to restrict access to deployments that are used as a local or remote
cluster without any impact to cross-cluster search or cross-cluster replication.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="remote-clusters-api-key.html">« Add remote clusters using API key authentication</a>
</span>
<span class="next">
<a href="ec-migrate-ccs.html">Migrate the cross-cluster search deployment template »</a>
</span>
</div>
</div>
</body>
</html>
