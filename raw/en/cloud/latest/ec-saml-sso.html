<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configure Elastic Cloud SAML single sign-on | Elasticsearch Service Documentation | Elastic</title>
<meta class="elastic" name="content" content="Configure Elastic Cloud SAML single sign-on | Elasticsearch Service Documentation">

<link rel="home" href="index.html" title="Elasticsearch Service Documentation"/>
<link rel="up" href="ec-organizations.html" title="Managing your organization"/>
<link rel="prev" href="ec-user-privileges.html" title="User roles and privileges"/>
<link rel="next" href="ec-saml-sso-okta.html" title="Register Elastic Cloud SAML in Okta"/>
<meta class="elastic" name="product_version" content="latest"/>
<meta class="elastic" name="product_name" content="Elastic Cloud"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="latest"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="ec-user-privileges.html">« User roles and privileges</a>
</span>
<span class="next">
<a href="ec-saml-sso-okta.html">Register Elastic Cloud SAML in Okta »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-organizations.html">Managing your organization</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configure Elastic Cloud SAML single sign-on</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="ec-saml-sso"></a>Configure Elastic Cloud SAML single sign-on</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Elastic Cloud supports SAML single sign-on (SSO) after you you register a SAML 2.0 identity provider (IdP).
Your organization&#8217;s members can sign into an organization-specific SSO login URL then join your Elastic Cloud organization automatically.</p>
<div class="position-relative"><h3><a id="ec_prerequisites_4"></a>Prerequisites</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>You must have a SAML 2.0 compatible identity provider.</p>
<div class="position-relative"><h3><a id="ec_known_issues_and_risks"></a>Known issues and risks</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>Actions taken on the IdP are not automatically reflected in Elastic Cloud.
For example, if you remove a user from your IdP, they are not removed from the Elastic Cloud organization and their active sessions are not invalidated.
To immediately revoke a user&#8217;s active sessions, an organization owner must remove the user from the Elastic Cloud organization or remove their assigned roles.</p>
<p>At this time, users that join your Elastic Cloud organization by using IdP authentication are not automatically assigned roles.
You must manually assign roles to organization members after they have joined the organization.</p>
<p>The IdP registration and domain claim features are available only by using APIs, which are in subject to change while in technical preview.
The features are not yet available in the Elastic Cloud UI.</p>
<div class="position-relative"><h3><a id="ec-saml-sso-claim-domain"></a>Claim a domain</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>Before you can register and use your IdP with Elastic Cloud, you must claim one or more domains.
Only users that have email addresses that match claimed domains can authenticate with your IdP.</p>
<p>You must have authority to modify your domain&#8217;s DNS records and an organization owner API key.
To create the latter, refer to <a class="xref" href="ec-api-authentication.html" title="Access and authentication"><em>Access and authentication</em></a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Generate a verification code for your domain:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -XPOST \
-H 'Content-Type: application/json' \
-H "Authorization: ApiKey $EC_API_KEY" \
"https://api.elastic-cloud.com/api/v1/organizations/$ORGANIZATION_ID/domains/domain_claims/_generate_verification_code" \
-d '
{
  "domain_claim_request": "$DOMAIN"
}
'</pre>
</div>
</li>
<li class="listitem">
<p>Update the DNS settings for your domain to add a new TXT record with name <code class="literal">_elastic_domain_challenge</code>. Put the verification code that you generated in the previous step into the TXT record.</p>
<p>For a claim on the domain <code class="literal">example.com</code>, a dig command should look like:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">dig _elastic_domain_challenge.example.com TXT
...
;; ANSWER SECTION:
_elastic_domain_challenge.example.com. 60 IN	TXT "1234rvic48untuh8uckoroaelpz7iid4uk5b8g0m2e4q57b07kak66r7xetoge8zn"
...</pre>
</div>
</li>
<li class="listitem">
<p>Verify the domain ownership for your domain:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -XPOST \
-H 'Content-Type: application/json' \
-H "Authorization: ApiKey $EC_API_KEY" \
"https://api.elastic-cloud.com/api/v1/organizations/$ORGANIZATION_ID/domains/domain_claims/_verify" \
-d '
{
  "domain_claim_request": "$DOMAIN"
}
'</pre>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>It may take some time for the DNS records to be updated and propagated in the network. If verification isn&#8217;t successful, wait a while and try again.</p>
</div>
</div>
<p>If the members of your Elastic Cloud organization have email addresses from multiple domains, you can claim multiple domains.</p>
<div class="position-relative"><h3><a id="ec-saml-sso-register-idp"></a>Register a SAML IdP</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>After you have claimed one or more domains, you can register your IdP with Elastic Cloud.
The steps vary by IdP; for more specific details, refer to <a class="xref" href="ec-saml-sso-entra.html" title="Register Elastic Cloud SAML in Microsoft Entra ID">Register Elastic Cloud SAML in Microsoft Entra ID</a> and <a class="xref" href="ec-saml-sso-okta.html" title="Register Elastic Cloud SAML in Okta">Register Elastic Cloud SAML in Okta</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a new SAML 2 application in your IdP.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Use placeholder values for the assertion consumer service (ACS) and SP entity ID/audience.
Those values will be provided by Elastic Cloud in a later step.
</li>
<li class="listitem">
Configure your application to send an <code class="literal">email</code> attribute statement with the email address of your organization members.
The email should match the domain that you claimed.
</li>
<li class="listitem">
Optionally configure the application to send <code class="literal">firstName</code> and <code class="literal">lastName</code> attribute statements, which will be used to set the respective fields of the user&#8217;s Elastic Cloud account.
</li>
<li class="listitem">
Note the SAML issuer and the SSO URL, which is the URL of the IdP where users will be redirected at login.
</li>
<li class="listitem">
Make sure to download the public certificate of the SAML 2 application.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Register the IdP with Elastic Cloud:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -XPUT \
-H 'Content-Type: application/json' \
-H "Authorization: ApiKey $EC_API_KEY" \
"https://api.elastic-cloud.com/api/v1/organizations/$ORGANIZATION_ID/idp" \
-d '
{
  "enabled": true,
  "login_identifier_prefix": "&lt;businessname&gt;", <a id="CO39-1"></a><i class="conum" data-value="1"></i>
  "saml_idp": {
    "public_certificate": [ <a id="CO39-2"></a><i class="conum" data-value="2"></i>
      "&lt;publiccert&gt;"
    ],
    "issuer": "&lt;issuer&gt;", <a id="CO39-3"></a><i class="conum" data-value="3"></i>
    "sso_url": "&lt;ssourl&gt;" <a id="CO39-4"></a><i class="conum" data-value="4"></i>
  }
}
'</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">login_identifier_prefix</code> is a customizable piece of the Elastic Cloud SSO url that your organization members can use to authenticate. This could be the name of your business. You can use lowercase alphanumeric characters and hyphens in this value and you can change it later.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">public_certificate</code> PEM-formatted certificate from your IdP. Base64 encode the entire contents of the PEM-formatted certificate so that the value sent is a single uninterrupted Base64-encoded string.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">issuer</code> is a value provided by your IdP.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">sso_url</code> is the SAML2 HTTP-POST endpoint of your IdP that will receive the SAML2 request.</p>
</td>
</tr>
</table>
</div>
<p>If successful, the API will return the details of the registered IdP containing important details that will need to be provided to the IdP.
For example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
	"login_identifier": "&lt;loginidentifier&gt;",
	"sso_login_url": "https://cloud.elastic.co/login/sso/&lt;loginidentifier&gt;", <a id="CO40-1"></a><i class="conum" data-value="1"></i>
	"metadata_url": "https://cloud.elastic.co/api/v1/organizations/&lt;orgid&gt;/idp/metadata.xml",
	"acs": "&lt;acs&gt;", <a id="CO40-2"></a><i class="conum" data-value="2"></i>
	"sp_entity_id": "https://cloud.elastic.co/organizations/&lt;orgid&gt;", <a id="CO40-3"></a><i class="conum" data-value="3"></i>
	"signing_certificate": [ <a id="CO40-4"></a><i class="conum" data-value="4"></i>
		"&lt;cert&gt;"
	]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">sso_login_url</code> is the URL you can provide to organization members to initiate SSO with your Elastic Cloud organization.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">acs</code> is the SAML assertion consumer service that your SAML IdP should send SAML assertions.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">sp_entity_id</code> is the SAML entity ID of the service provider that your SAML IdP should send in the SAML audience.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">signing_certificate</code> is the Base64-encoded DER-encoded certificate that SAML requests to your IdP will be signed with.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>Update the SAML 2 application in your IdP with the values from the API response in the previous step.</p>
<p>If your IdP accepts a <code class="literal">metadata.xml</code> file, you can fetch the file from the API.
For example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -XGET \
-H "Authorization: ApiKey $EC_API_KEY" \
"https://api.elastic-cloud.com/api/v1/organizations/$ORGANIZATION_ID/idp/metadata.xml"</pre>
</div>
</li>
</ol>
</div>
<div class="position-relative"><h3><a id="ec_test_sso"></a>Test SSO</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>After you register the IdP in Elastic Cloud and configure your IdP, you can test authentication.
To begin SSO, open the <code class="literal">sso_login_url</code> in your browser.
If everything is configured correctly you should be redirected to your IdP for authentication and then redirected back to Elastic Cloud signed in.
Users who are not a member of the Elastic Cloud organization can authenticate with your IdP to automatically create an Elastic Cloud account provided that their email matches the claimed domain.</p>
<p>At this time, new users in your Elastic Cloud organization will join without any roles assigned.
An administrator must manually assign roles to the organization members.</p>
<div class="position-relative"><h3><a id="ec_enforce_sso"></a>Enforce SSO</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>After SSO is configured successfully, you may wish to enforce SSO authentication for members of your organization.
This enforcement requires members to authenticate with SSO through the organization&#8217;s SAML IdP and prevents them from logging in by any other methods.
It ensures that users who have been off-boarded in your IdP can no longer authenticate to Elastic Cloud.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you turn on enforcement, you will be unable to access Elastic Cloud if your IdP is unavailable or misconfigured or there is an Elastic Cloud incident.
It is recommended that you maintain and store an Elastic Cloud API key with organization owner level privileges so that an administrator can disable enforcement in an emergency. Refer to <a class="xref" href="ec-api-authentication.html#ec-api-keys" title="Create an API key">Create an API key</a>.
You can also open a support issue if you lose access to your Elastic Cloud account.</p>
</div>
</div>
<p>To turn on enforcement, use the following API call:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -XPUT \
-H 'Content-Type: application/json' \
-H "Authorization: ApiKey $EC_API_KEY" \
"https://api.elastic-cloud.com/api/v1/organizations/$ORGANIZATION_ID" \
-d '
{
  "enforce_authentication_method": "sso"
}
'</pre>
</div>
<p>To turn off enforcement, use the following API call:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -XPUT \
-H 'Content-Type: application/json' \
-H "Authorization: ApiKey $EC_API_KEY" \
"https://api.elastic-cloud.com/api/v1/organizations/$ORGANIZATION_ID" \
-d '
{
  "enforce_authentication_method": null
}
'</pre>
</div>
<div class="position-relative"><h3><a id="ec_disable_sso"></a>Disable SSO</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>To disable SSO and make it unavailable for your organization, update the organization IdP with <code class="literal">enabled: false</code>.
For example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -XPUT \
-H 'Content-Type: application/json' \
-H "Authorization: ApiKey $EC_API_KEY" \
"https://api.elastic-cloud.com/api/v1/organizations/$ORGANIZATION_ID/idp" \
-d '
{
  "enabled": false,
  "login_identifier_prefix": "&lt;businessname&gt;",
  "saml_idp": {
    "public_certificate": [
      "&lt;publiccert&gt;"
    ],
    "issuer": "&lt;issuer&gt;",
    "sso_url": "&lt;ssourl&gt;"
  }
}
'</pre>
</div>
<div class="position-relative"><h3><a id="ec_troubleshoot_sso"></a>Troubleshoot SSO</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<div class="position-relative"><h4><a id="ec_sso_screen_is_not_redirecting_to_my_idp"></a>SSO screen is not redirecting to my IdP</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>Double check the <code class="literal">saml_idp.sso_url</code> provided during IdP registration.
This should be the URL to your IdP&#8217;s SAML application.
Elastic Cloud will redirect to this URL during sign in.</p>
<div class="position-relative"><h4><a id="ec_failure_to_redirect_back_to_elastic_cloud_after_idp_log_in"></a>Failure to redirect back to Elastic Cloud after IdP log in</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>There could be a variety of issues that might result in sign in failure.
Try tracing the SAML request with a SAML tracer.
Double check the components of the SAML request:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">Destination</code> and <code class="literal">Recipient</code> should match the <code class="literal">acs</code> provided by the Elastic Cloud IdP registration API.
</li>
<li class="listitem">
An <code class="literal">AttributeStatement</code> named <code class="literal">email</code> should be sent with the email matching a domain claimed by your Elastic Cloud organization.
</li>
<li class="listitem">
The <code class="literal">AudienceRestriction</code> <code class="literal">Audience</code> should match the <code class="literal">sp_entity_id</code> provided by the Elastic Cloud IdP registration API.
</li>
<li class="listitem">
The <code class="literal">Issuer</code> should match the value provided to the Elastic Cloud IdP registration API.
</li>
</ul>
</div>
<div class="position-relative"><h3><a id="ec_limitations"></a>Limitations</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-114/docs/saas/ec-organizations-saml-sso.asciidoc">edit</a></div>
<p>At this time, the following features are not supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Role mappings: Assign Elastic Cloud roles based on a SAML attribute passed by your IdP. Manage the role mappings in the Elastic Cloud UI.
</li>
<li class="listitem">
Domain claiming and IdP registration UI: Manage the IdP configuration for your organization and your claimed domains in the Elastic Cloud UI
</li>
<li class="listitem">
Email-based SSO lookup: Enter an email address at sign-in and be redirected to the right IdP with no need for the organization SSO URL.
</li>
</ul>
</div>
<p>These features will be available in a future release.</p>


</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ec-user-privileges.html">« User roles and privileges</a>
</span>
<span class="next">
<a href="ec-saml-sso-okta.html">Register Elastic Cloud SAML in Okta »</a>
</span>
</div>
</body>
</html>
