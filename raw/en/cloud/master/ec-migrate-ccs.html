<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Migrate the cross-cluster search deployment template | Elasticsearch Service Documentation [master] | Elastic</title>
<meta class="elastic" name="content" content="Migrate the cross-cluster search deployment template | Elasticsearch Service Documentation [master]">

<link rel="home" href="index.html" title="Elasticsearch Service Documentation [master]"/>
<link rel="up" href="ec-enable-ccs.html" title="Enable cross-cluster search and cross-cluster replication"/>
<link rel="prev" href="ec-configure-as-remote-clusters.html" title="Configure an Elasticsearch Service deployment as a remote cluster"/>
<link rel="next" href="ec-enable-ccs-for-eck.html" title="Enabling CCS/R between Elasticsearch Service and ECK"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elastic Cloud"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Cloud/Reference/master"/>
<meta name="DC.subject" content="Elastic Cloud"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Service Documentation [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-best-practices-data.html">Best practices for managing your data</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ec-enable-ccs.html">Enable cross-cluster search and cross-cluster replication</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ec-configure-as-remote-clusters.html">« Configure an Elasticsearch Service deployment as a remote cluster</a>
</span>
<span class="next">
<a href="ec-enable-ccs-for-eck.html">Enabling CCS/R between Elasticsearch Service and ECK »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ec-migrate-ccs"></a>Migrate the cross-cluster search deployment template<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/master/docs/shared/ec-ce-migrate-ccs.asciidoc">edit</a></h2>
</div></div></div>
<p>The cross-cluster search deployment template is now deprecated and has been removed from the Elasticsearch Service user console. You no longer need to use the dedicated cross-cluster template to search across deployments. Instead, you can now use any template to <a class="xref" href="ec-enable-ccs.html" title="Enable cross-cluster search and cross-cluster replication">configure remote clusters</a> and search across them when using stack version 6.7 or above. Existing deployments created using this template are not affected, but they are required to migrate to another template before upgrading to the next 8.0 major version.</p>
<p>There are two different approaches to do this migration:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="ec-migrate-ccs.html#ec-migrate-ccs-deployment-using-api" title="Use the API to migrate deployments that use the cross-cluster search template">Migrate using the API</a>
</li>
<li class="listitem">
<a class="xref" href="ec-migrate-ccs.html#ec-migrate-ccs-deployment-using-snapshot" title="Use a snapshot to migrate deployments that use the cross-cluster search deployment template">Migrate using a snapshot</a>
</li>
</ul>
</div>
<h3><a id="ec-migrate-ccs-deployment-using-api"></a>Use the API to migrate deployments that use the cross-cluster search template<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/master/docs/shared/ec-ce-migrate-ccs.asciidoc">edit</a></h3>
<p>You can use a PUT request to update your deployment, changing both the deployment template ID and the instances required by the new template.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>First, choose the new template you want to use and obtain its ID. This template ID can be obtained from the <a href="https://cloud.elastic.co?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">Elasticsearch Service Console</a> <span class="strong strong"><strong>Create Deployment</strong></span> page by selecting <span class="strong strong"><strong>Equivalent API request</strong></span> and inspecting the result for the field <code class="literal">deployment_template</code>. For example, we are going to use the "Storage optimized" deployment template, and in our GCP region the id is <code class="literal">gcp-storage-optimized-v5</code>.</p>
<p>You can also find the template in the <a class="xref" href="ec-regions-templates-instances.html" title="Available regions, deployment templates and instance configurations">list of templates available for each region</a>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ec-migrate-deployment-template(2).png" alt="Deployment Template ID">
</div>
</div>
</li>
<li class="listitem">
<p>Make a request to update your deployment with two changes:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Under <code class="literal">deployment_template</code>, set <code class="literal">id</code> to the value obtained in the previous step.
</li>
<li class="listitem">
Change the cluster topology to match the new template that your deployment will migrate to.
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -H 'Content-Type: application/json' -X PUT -H "Authorization: ApiKey $EC_API_KEY" https://api.elastic-cloud.com/api/v1/deployments/$DEPLOYMENT_ID -d "{
  "resources": {
    "integrations_server": [
      {
        "elasticsearch_cluster_ref_id": "main-elasticsearch",
        "region": "gcp-us-central1",
        "plan": {
          "cluster_topology": [
            {
              "instance_configuration_id": "gcp.integrationsserver.n2.68x32x45.2",
              "zone_count": 1,
              "size": {
                "resource": "memory",
                "value": 1024
              }
            }
          ],
          "integrations_server": {
            "version": "8.7.1"
          }
        },
        "ref_id": "main-integrations_server"
      }
    ],
    "elasticsearch": [
      {
        "region": "gcp-us-central1",
        "settings": {
          "dedicated_masters_threshold": 6
        },
        "plan": {
          "cluster_topology": [
            {
              "zone_count": 2,
              "elasticsearch": {
                "node_attributes": {
                  "data": "hot"
                }
              },
              "instance_configuration_id": "gcp.es.datahot.n2.68x10x45",
              "node_roles": [
                "master",
                "ingest",
                "transform",
                "data_hot",
                "remote_cluster_client",
                "data_content"
              ],
              "id": "hot_content",
              "size": {
                "resource": "memory",
                "value": 8192
              }
            },
            {
              "zone_count": 2,
              "elasticsearch": {
                "node_attributes": {
                  "data": "warm"
                }
              },
              "instance_configuration_id": "gcp.es.datawarm.n2.68x10x190",
              "node_roles": [
                "data_warm",
                "remote_cluster_client"
              ],
              "id": "warm",
              "size": {
                "resource": "memory",
                "value": 0
              }
            },
            {
              "zone_count": 1,
              "elasticsearch": {
                "node_attributes": {
                  "data": "cold"
                }
              },
              "instance_configuration_id": "gcp.es.datacold.n2.68x10x190",
              "node_roles": [
                "data_cold",
                "remote_cluster_client"
              ],
              "id": "cold",
              "size": {
                "resource": "memory",
                "value": 0
              }
            },
            {
              "zone_count": 1,
              "elasticsearch": {
                "node_attributes": {
                  "data": "frozen"
                }
              },
              "instance_configuration_id": "gcp.es.datafrozen.n2.68x10x95",
              "node_roles": [
                "data_frozen"
              ],
              "id": "frozen",
              "size": {
                "resource": "memory",
                "value": 0
              }
            },
            {
              "zone_count": 3,
              "instance_configuration_id": "gcp.es.master.n2.68x32x45.2",
              "node_roles": [
                "master",
                "remote_cluster_client"
              ],
              "id": "master",
              "size": {
                "resource": "memory",
                "value": 0
              }
            },
            {
              "zone_count": 2,
              "instance_configuration_id": "gcp.es.coordinating.n2.68x16x45.2",
              "node_roles": [
                "ingest",
                "remote_cluster_client"
              ],
              "id": "coordinating",
              "size": {
                "resource": "memory",
                "value": 0
              }
            },
            {
              "zone_count": 1,
              "instance_configuration_id": "gcp.es.ml.n2.68x32x45",
              "node_roles": [
                "ml",
                "remote_cluster_client"
              ],
              "id": "ml",
              "size": {
                "resource": "memory",
                "value": 0
              }
            }
          ],
          "elasticsearch": {
            "version": "8.7.1",
            "enabled_built_in_plugins": []
          },
          "deployment_template": {
            "id": "gcp-storage-optimized-v5"
          }
        },
        "ref_id": "main-elasticsearch"
      }
    ],
    "enterprise_search": [
      {
        "elasticsearch_cluster_ref_id": "main-elasticsearch",
        "region": "gcp-us-central1",
        "plan": {
          "cluster_topology": [
            {
              "node_type": {
                "connector": true,
                "appserver": true,
                "worker": true
              },
              "instance_configuration_id": "gcp.enterprisesearch.n2.68x32x45",
              "zone_count": 1,
              "size": {
                "resource": "memory",
                "value": 2048
              }
            }
          ],
          "enterprise_search": {
            "version": "8.7.1"
          }
        },
        "ref_id": "main-enterprise_search"
      }
    ],
    "kibana": [
      {
        "elasticsearch_cluster_ref_id": "main-elasticsearch",
        "region": "gcp-us-central1",
        "plan": {
          "cluster_topology": [
            {
              "instance_configuration_id": "gcp.kibana.n2.68x32x45",
              "zone_count": 1,
              "size": {
                "resource": "memory",
                "value": 1024
              }
            }
          ],
          "kibana": {
            "version": "8.7.1"
          }
        },
        "ref_id": "main-kibana"
      }
    ]
  },
  "settings": {
    "autoscaling_enabled": false
  },
  "name": "My deployment",
  "metadata": {
    "system_owned": false
  }
}"</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">DEPLOYMENT_ID</code>
</span>
</dt>
<dd>
The ID of your deployment, as shown in the Cloud UI or obtained through the API.
</dd>
<dt>
<span class="term">
<code class="literal">REGION</code>
</span>
</dt>
<dd>
The region of your deployment, as shown in the Cloud UI or obtained through the API.
</dd>
</dl>
</div>
<p>Note that the <code class="literal">ref_id</code> and version numbers for your resources may not be the same as shown in this example. Make sure to use the ones your deployment has.</p>
<h3><a id="ec-migrate-ccs-deployment-using-snapshot"></a>Use a snapshot to migrate deployments that use the cross-cluster search deployment template<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/master/docs/shared/ec-ce-migrate-ccs.asciidoc">edit</a></h3>
<p>You can make this change in the user <a href="https://cloud.elastic.co?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">Elasticsearch Service Console</a>. The only drawback of this method is that it changes the URL used to access the Elasticsearch cluster and Kibana.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
From the deployment menu, open the <span class="strong strong"><strong>Snapshots</strong></span> page and click <span class="strong strong"><strong>Take Snapshot now</strong></span>. Wait for the snapshot to finish.
</li>
<li class="listitem">
<p>From the main <span class="strong strong"><strong>Deployments</strong></span> page, click <span class="strong strong"><strong>Create deployment</strong></span>. Next to <span class="strong strong"><strong>Settings</strong></span> toggle on <span class="strong strong"><strong>Restore snapshot data</strong></span>, and then select your deployment and the snapshot that you created.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ec-create-from-snapshot-updated.png" alt="Create a Deployment using a snapshot">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ec-configure-as-remote-clusters.html">« Configure an Elasticsearch Service deployment as a remote cluster</a>
</span>
<span class="next">
<a href="ec-enable-ccs-for-eck.html">Enabling CCS/R between Elasticsearch Service and ECK »</a>
</span>
</div>
</div>
</body>
</html>
