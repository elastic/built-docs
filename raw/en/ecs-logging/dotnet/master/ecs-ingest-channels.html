<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ECS Ingest Channels | ECS Logging .NET Reference | Elastic</title>
<meta class="elastic" name="content" content="ECS Ingest Channels | ECS Logging .NET Reference">

<link rel="home" href="index.html" title="ECS Logging .NET Reference"/>
<link rel="up" href="data-shippers.html" title="Data Shippers"/>
<link rel="prev" href="data-shippers.html" title="Data Shippers"/>
<link rel="next" href="serilog-data-shipper.html" title="Elastic.Serilog.Sinks"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="ECS Logging .NET Reference"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/ECS-logging/.NET/Guide"/>
<meta name="DC.subject" content="ECS Logging .NET Reference"/>
<meta name="DC.identifier" content="master"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
    <div class="related-products-title">ECS Logging:</div>
    <div class="dropdown-anchor" tabindex="0">.NET Reference<span class="dropdown-icon"></span></div>
    <div class="dropdown-content">
      <ul>
        <li><a href="/guide/en/ecs-logging/overview/current/intro.html">Reference</a></li>
        <li><a href="/guide/en/ecs-logging/go-logrus/current/intro.html">Go (Logrus) Reference</a></li>
        <li><a href="/guide/en/ecs-logging/go-zap/current/intro.html">Go (zap) Reference</a></li>
        <li><a href="/guide/en/ecs-logging/java/current/intro.html">Java Reference</a></li>
        <li><a href="/guide/en/ecs-logging/dotnet/current/intro.html">.NET Reference</a></li>
        <li><a href="/guide/en/ecs-logging/nodejs/current/intro.html">Node.js Reference</a></li>
        <li><a href="/guide/en/ecs-logging/ruby/current/intro.html">Ruby Reference</a></li>
        <li><a href="/guide/en/ecs-logging/php/current/intro.html">PHP Reference</a></li>
        <li><a href="/guide/en/ecs-logging/python/current/intro.html">Python Reference</a></li>
      </ul>
    </div>
  </div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-shippers.html">Data Shippers</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="data-shippers.html">« Data Shippers</a>
</span>
<span class="next">
<a href="serilog-data-shipper.html">Elastic.Serilog.Sinks »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ecs-ingest-channels"></a>ECS Ingest Channels<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ecs-dotnet/edit/main/docs/data-shippers/ingest-commonschema.asciidoc">edit</a></h2>
</div></div></div>
<p>A specialization of <a href="https://www.nuget.org/packages/Elastic.Ingest.Elasticsearch#readme-body-tab" class="ulink" target="_top"><code class="literal">Elastic.Ingest.Elasticsearch</code></a> that offers two channel implementations that make it easy to write ECS formatted data and bootstrap the target datastreams/indices with ECS mappings and settings.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_installation_5"></a>Installation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ecs-dotnet/edit/main/docs/data-shippers/ingest-commonschema.asciidoc">edit</a></h3>
</div></div></div>
<p>Add a reference to the <code class="literal">Elastic.Ingest.Elasticsearch.CommonSchema</code> package:</p>
<div class="pre_wrapper lang-xml">
<pre class="programlisting prettyprint lang-xml">&lt;PackageReference Include="Elastic.Ingest.Elasticsearch.CommonSchema" Version="8.6.0" /&gt;</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_usage_5"></a>Usage<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ecs-dotnet/edit/main/docs/data-shippers/ingest-commonschema.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_ecsdatastreamchanneltevent"></a>EcsDataStreamChannel&lt;TEvent&gt;<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ecs-dotnet/edit/main/docs/data-shippers/ingest-commonschema.asciidoc">edit</a></h4>
</div></div></div>
<p>A channel that specializes to writing data with a timestamp to Elasticsearch data streams.</p>
<p>A channel can be created to push data to the <code class="literal">logs-dotnet-default</code> data stream.</p>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">var dataStream = new DataStreamName("logs", "dotnet");
var bufferOptions = new BufferOptions { }
var options = new DataStreamChannelOptions&lt;EcsDocument&gt;(transport)
{
  DataStream = dataStream,
  BufferOptions = bufferOptions
};
var channel = new EcsDataStreamChannel&lt;EcsDocument&gt;(options);</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Learn more about Elastic&#8217;s data stream naming convention in <a href="/blog/an-introduction-to-the-elastic-data-stream-naming-scheme" class="ulink" target="_top">this blog post</a>.</p>
</div>
</div>
<p>We can now push data to Elasticsearch using the <code class="literal">EcsDataStreamChannel</code></p>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">var doc = new EcsDocument
{
    Timestamp = DateTimeOffset.Now,
    Message = "Hello World!",
}
channel.TryWrite(doc);</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_ecsindexchanneltevent"></a>EcsIndexChannel&lt;TEvent&gt;<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ecs-dotnet/edit/main/docs/data-shippers/ingest-commonschema.asciidoc">edit</a></h4>
</div></div></div>
<p>A channel that specializes in writing catalog data to Elastic indices.</p>
<p>We can create an <code class="literal">EcsIndexChannel&lt;&gt;</code> to push <code class="literal">EcsDocument</code> (or subclassed) instances.</p>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">var options = new IndexChannelOptions&lt;EcsDocument&gt;(transport)
{
    IndexFormat = "catalog-data-{0:yyyy.MM.dd}",
    // BulkOperationIdLookup = c =&gt; null,
    TimestampLookup = c =&gt; c.Timestamp,
};
var channel = new EcsIndexChannel&lt;CatalogDocument&gt;(options);</pre>
</div>
<p>Now we can push data using:</p>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">var doc = new CatalogDocument
{
    Created = date,
    Title = "Hello World!",
    Id = "hello-world"
}
channel.TryWrite(doc);</pre>
</div>
<p>This will push data to <code class="literal">catalog-data-2023.01.1</code> because <code class="literal">TimestampLookup</code> yields <code class="literal">Timestamp</code> to <code class="literal">IndexFormat</code>.</p>
<p><code class="literal">IndexFormat</code> can also simply be a fixed string to write to an Elasticsearch alias/index.</p>
<p><code class="literal">BulkOperationIdLookup</code> determines if the document should be pushed to Elasticsearch using a <code class="literal">create</code> or <code class="literal">index</code> operation.</p>
<h3><a id="_bootstrapping_target_datastream_or_index"></a>Bootstrapping target Datastream or Index<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ecs-dotnet/edit/main/docs/data-shippers/ingest-commonschema.asciidoc">edit</a></h3>
<p>Optionally the target data stream or index can be bootstrapped using the following.</p>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">await channel.BootstrapElasticsearchAsync(BootstrapMethod.Failure, "7-days-default");</pre>
</div>
<p>This will bootstrap:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Set up component templates for all ECS fieldsets
</li>
<li class="listitem">
reference: <a href="/guide/en/ecs/8.7/ecs-field-reference.html" class="ulink" target="_top">https://www.elastic.co/guide/en/ecs/8.7/ecs-field-reference.html</a>
</li>
<li class="listitem">
templates: <a href="https://github.com/elastic/ecs/tree/main/generated/elasticsearch/composable/component" class="ulink" target="_top">https://github.com/elastic/ecs/tree/main/generated/elasticsearch/composable/component</a>
</li>
<li class="listitem">
Create a special <code class="literal">*-settings</code> component template for the datastream/indices that sets up ILM.
</li>
<li class="listitem">
Set up an <a href="/guide/en/elasticsearch/reference/8.7/index-templates.html" class="ulink" target="_top">index template</a> for the target data streams or indices.
</li>
</ul>
</div>
<p>If the index template already exists no further bootstrapping will occur.</p>
<p>Just like <code class="literal">Elastic.Ingest.Elasticsearch</code> the channel is aware that <code class="literal">logs</code> and <code class="literal">metrics</code> have default component templates and ensures the new index tempate references them.</p>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="data-shippers.html">« Data Shippers</a>
</span>
<span class="next">
<a href="serilog-data-shipper.html">Elastic.Serilog.Sinks »</a>
</span>
</div>
</div>
</body>
</html>
