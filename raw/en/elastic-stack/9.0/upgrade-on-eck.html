<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upgrade on Elastic Cloud on Kubernetes (ECK) | Elastic Installation and Upgrade Guide [9.0] | Elastic</title>
<meta class="elastic" name="content" content="Upgrade on Elastic Cloud on Kubernetes (ECK) | Elastic Installation and Upgrade Guide [9.0]">

<link rel="home" href="index.html" title="Elastic Installation and Upgrade Guide [9.0]"/>
<link rel="up" href="upgrade-deployment-cluster.html" title="Upgrade your deployment or cluster"/>
<link rel="prev" href="upgrade-on-ece.html" title="Upgrade on Elastic Cloud Enterprise (ECE)"/>
<link rel="next" href="upgrading-elastic-stack-on-prem.html" title="Upgrade Elastic on self-managed infrastructure"/>
<meta class="elastic" name="product_version" content="9.0"/>
<meta class="elastic" name="product_name" content="Elastic Stack"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Installation and Upgrade/9.0"/>
<meta name="DC.subject" content="Elastic Stack"/>
<meta name="DC.identifier" content="9.0"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="upgrade-on-ece.html">« Upgrade on Elastic Cloud Enterprise (ECE)</a>
</span>
<span class="next">
<a href="upgrading-elastic-stack-on-prem.html">Upgrade Elastic on self-managed infrastructure »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Installation and Upgrade Guide [9.0]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="upgrading-elastic-stack.html">Upgrade to Elastic 9.0.0-beta1</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="upgrade-deployment-cluster.html">Upgrade your deployment or cluster</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Upgrade on Elastic Cloud on Kubernetes (ECK)</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrade-on-eck.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="upgrade-on-eck"></a>Upgrade on Elastic Cloud on Kubernetes (ECK)</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrade-on-eck.asciidoc">edit</a></div>
</div></div></div>
<p>The ECK orchestrator can safely perform upgrades to newer versions of the various Elastic Stack resources.</p>
<p>To upgrade on ECK, first do the following:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Ensure you&#8217;re <a class="xref" href="upgrading-elastic-stack.html#prepare-upgrade-9.0" title="Prepare to upgrade">prepared to upgrade</a>.
</li>
<li class="listitem">
Ensure the ECK version is <a href="/guide/en/cloud-on-k8s/current/k8s-supported.html" class="ulink" target="_top">compatible</a> with the Elastic Stack version you’re targeting. If necessary, <a class="xref" href="upgrade-orchestrator.html" title="Upgrade your orchestrator">upgrade your orchestrator</a>.
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="perform-upgrade-eck"></a>Perform the upgrade</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrade-on-eck.asciidoc">edit</a></div>
<p>When you are ready, modify the <code class="literal">version</code> field in the resource spec to the desired stack version and the orchestrator will start the upgrade process automatically. Do this for each resource, including Elasticsearch and Kibana. In the following example, we’re modifying the version to <code class="literal">9.0.0</code>.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: elasticsearch-sample
  namespace: production
spec:
  version: 9.0.0
  monitoring:
    metrics:
      elasticsearchRefs:
        - name: monitoring-cluster
          namespace: observability
    logs:
      elasticsearchRefs:
        - name: monitoring-cluster
          namespace: observability
  http:
    service:
      spec:
        type: LoadBalancer
  nodeSets:
  - name: master
    count: 3
    config:
      node.roles: ["master"]
      xpack.ml.enabled: true
      node.store.allow_mmap: false
    volumeClaimTemplates:
    - metadata:
        name: elasticsearch-data
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 20Gi
        storageClassName: standard
    podTemplate:
      metadata:
        labels:
          key: sample
      spec:
        initContainers:
        - name: sysctl
          securityContext:
            privileged: true
          command: ['sh', '-c', 'sysctl -w vm.max_map_count=262144']
        containers:
        - name: elasticsearch
          resources:
            requests:
              memory: 2Gi
              cpu: 0.5
            limits:
              memory: 2Gi
              cpu: 1
  - name: data
    count: 3
    config:
      node.roles: ["data", "ingest", "ml", "transform"]
      node.store.allow_mmap: false
    volumeClaimTemplates:
    - metadata:
        name: elasticsearch-data
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 20Gi
        storageClassName: standard
    podTemplate:
      metadata:
        labels:
          key: sample
      spec:
        initContainers:
        - name: sysctl
          securityContext:
            privileged: true
          command: ['sh', '-c', 'sysctl -w vm.max_map_count=262144']
        containers:
        - name: elasticsearch
          resources:
            requests:
              memory: 2Gi
              cpu: 0.5
            limits:
              memory: 2Gi
              cpu: 1
---
apiVersion: kibana.k8s.elastic.co/v1
kind: Kibana
metadata:
  name: kibana-sample
  namespace: production
spec:
  version: 9.0.0
  monitoring:
    metrics:
      elasticsearchRefs:
        - name: monitoring-cluster
          namespace: observability
    logs:
      elasticsearchRefs:
        - name: monitoring-cluster
          namespace: observability
  http:
    service:
      spec:
        type: LoadBalancer
  count: 1
  elasticsearchRef:
    name: elasticsearch-sample</pre>
</div>
<p>ECK will ensure that Elastic Stack resources are upgraded in the correct order. For more information on how the orchestrator performs upgrades and how to tune its behavior, check out <a href="/guide/en/cloud-on-k8s/current/k8s-orchestration.html" class="ulink" target="_top">Nodes orchestration</a>.</p>
<p>Next, upgrade your ingest components in the following order:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Logstash: <a href="/guide/en/logstash/current/upgrading-logstash.html" class="ulink" target="_top">upgrade instructions</a>
</li>
<li class="listitem">
Beats: <a href="/guide/en/beats/libbeat/current/upgrading.html" class="ulink" target="_top">upgrade instructions</a>
</li>
<li class="listitem">
Elastic Agent: <a href="/guide/en/fleet/current/upgrade-elastic-agent.html" class="ulink" target="_top">upgrade instructions</a>
</li>
<li class="listitem">
APM agents: <a href="/guide/en/observability/current/apm-upgrade.html" class="ulink" target="_top">upgrade instructions</a>
</li>
</ol>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="upgrade-on-ece.html">« Upgrade on Elastic Cloud Enterprise (ECE)</a>
</span>
<span class="next">
<a href="upgrading-elastic-stack-on-prem.html">Upgrade Elastic on self-managed infrastructure »</a>
</span>
</div>
</body>
</html>
