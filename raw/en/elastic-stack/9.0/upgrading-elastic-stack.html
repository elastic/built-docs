<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upgrade to Elastic 9.0.0-rc1 | Elastic Installation and Upgrade Guide [9.0] | Elastic</title>
<meta class="elastic" name="content" content="Upgrade to Elastic 9.0.0-rc1 | Elastic Installation and Upgrade Guide [9.0]">

<link rel="home" href="index.html" title="Elastic Installation and Upgrade Guide [9.0]"/>
<link rel="up" href="index.html" title="Elastic Installation and Upgrade Guide [9.0]"/>
<link rel="prev" href="release-notes-logstash-9.0.0.html" title="Logstash release notes"/>
<link rel="next" href="upgrade-orchestrator.html" title="Upgrade your orchestrator"/>
<meta class="elastic" name="product_version" content="9.0"/>
<meta class="elastic" name="product_name" content="Elastic Stack"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Installation and Upgrade/9.0"/>
<meta name="DC.subject" content="Elastic Stack"/>
<meta name="DC.identifier" content="9.0"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="release-notes-logstash-9.0.0.html">« Logstash release notes</a>
</span>
<span class="next">
<a href="upgrade-orchestrator.html">Upgrade your orchestrator »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Installation and Upgrade Guide [9.0]</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Upgrade to Elastic 9.0.0-rc1</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrading-stack.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="part">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="upgrading-elastic-stack"></a>Upgrade to Elastic 9.0.0-rc1</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrading-stack.asciidoc">edit</a></div>
</div></div></div>
<div class="openblock partintro">
<div class="content">
<p>Upgrading to the latest version provides you access to Elastic latest features, enhancements, performance improvements, and bug fixes, many of which enable you to save your organization money, respond faster to potential threats, and improve the tools you use to investigate and analyze your data. As new versions are released, older versions reach their end of life at a regular cadence, so it’s important to ensure that your deployment is fully maintained and supported. For more information, refer to Elastic’s <a href="/support/eol" class="ulink" target="_top">Product End of Life Dates</a>.</p>
<div class="position-relative"><h2><a id="plan-upgrade"></a>Plan your upgrade</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrading-stack.asciidoc">edit</a></div>
<p>Before you upgrade, there are a number of things that you need to plan for before performing the actual upgrade, so create a test plan. Consider the following recommendations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Plan for an appropriate amount of time to complete the upgrade. Depending on your configuration and the size of your cluster, the process can take up a few weeks or or more to complete.
</li>
<li class="listitem">
Consider opening a <a href="https://support.elastic.co/case" class="ulink" target="_top">support case</a> with Elastic to alert our Elastic Support team of your system change. If you need additional assistance, <a href="/consulting" class="ulink" target="_top">Elastic Consulting Services</a> provides the technical expertise and step-by-step approach for upgrading your Elastic deployment.
</li>
<li class="listitem">
Schedule a system maintenance window within your organization.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Check system requirements</strong></span></p>
<p>Ensure the version you’re upgrading to for Elasticsearch, Kibana, and any ingest components supports your current operating system. Refer to the Product and Operating System <a href="/support/matrix#matrix_os" class="ulink" target="_top">support matrix</a>.</p>
<p><span class="strong strong"><strong>JVM and FIPS compliance</strong></span></p>
<p>By default, Elasticsearch includes a bundled Java Virtual Machine (JVM) supported by Elastic. While we strongly recommend using the bundled JVM in all installations of Elasticsearch, if you choose to use your own JVM, ensure it’s compatible by reviewing the Product and JVM <a href="/support/matrix#matrix_jvm" class="ulink" target="_top">support matrix</a>. Elasticsearch 9.0+ requires Java 21 or later.</p>
<p>If you’re running Elasticsearch in FIPS 140-2 mode, Elasticsearch 9.0+ has been tested with <a href="https://www.bouncycastle.org/java.html" class="ulink" target="_top">Bouncy Castle</a>'s FIPS implementation and is the recommended Java security provider when running Elasticsearch.</p>
<p><span class="strong strong"><strong>Conduct a component inventory</strong></span></p>
<p>It is very important to map all the components that are being used on the Elastic Stack. When you upgrade your deployment, you may also need to upgrade all the other components. You should record if each component is used, and if it is, you should record its current version. While this is not a comprehensive list, here are some components you should check:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elasticsearch
</li>
<li class="listitem">
Elasticsearch Hadoop
</li>
<li class="listitem">
Elasticsearch Plugins
</li>
<li class="listitem">
Elasticsearch clients
</li>
<li class="listitem">
Kibana
</li>
<li class="listitem">
Logstash
</li>
<li class="listitem">
Logstash plugins
</li>
<li class="listitem">
Beats
</li>
<li class="listitem">
Beats modules
</li>
<li class="listitem">
APM agents
</li>
<li class="listitem">
APM server
</li>
<li class="listitem">
Elastic Agent
</li>
<li class="listitem">
Fleet
</li>
<li class="listitem">
Enterprise Search server
</li>
<li class="listitem">
Security
</li>
<li class="listitem">
Browsers
</li>
<li class="listitem">
External services (Kafka, etc.)
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you do your inventory, you can <a href="/guide/en/elasticsearch/reference/current/enable-audit-logging.html" class="ulink" target="_top">enable audit logging</a> to evaluate resources that are accessing your deployment.</p>
</div>
</div>
<div class="position-relative"><h2><a id="choose-upgrade-path"></a>Choose your upgrade path</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrading-stack.asciidoc">edit</a></div>
<p>The procedures you follow to upgrade depend on your infrastructure and deployment method. You’ve installed Elastic components using either Elastic-managed infrastructure or self-managed infrastructure.</p>
<p>Elastic-managed infrastructure includes Elastic Cloud – the umbrella term for Elastic Cloud Hosted (ECH) and Elastic Cloud Serverless. Elastic Cloud Serverless (“Serverless”) is the fully managed cloud offering and has three products: Elasticsearch Serverless, Elastic Observability Serverless, and Elastic Security Serverless. All serverless products are built on top of the Search AI Lake. Customers receive the latest features automatically when updates are published.</p>
<p>Elastic Cloud Hosted is Elastic’s cloud offering for managing Elastic Stack deployments, built on top of Elasticsearch. A single click in the Elastic Cloud console can upgrade a deployment to a newer version.</p>
<p>Self-managed infrastructure — either on-prem or on public cloud, includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic Stack
</li>
<li class="listitem">
Elastic Cloud Enterprise (ECE)
</li>
<li class="listitem">
Elastic Cloud on Kubernetes (ECK)
</li>
</ul>
</div>
<p>For ECE and ECK, you need to ensure the orchestrator is running a compatible version with the Elastic Stack version you’re upgrading to. If not, you need to <a class="xref" href="upgrade-orchestrator.html" title="Upgrade your orchestrator">upgrade</a> your orchestrator before you can upgrade your cluster.</p>
<p>If you’re running the Elastic Stack on your own self-managed infrastructure, you’ll need to upgrade each component individually.</p>
<div class="position-relative"><h2><a id="prepare-upgrade-9.0"></a>Prepare to upgrade</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrading-stack.asciidoc">edit</a></div>
<p>Before you upgrade to 9.0.0-rc1, it&#8217;s important to take some preparation steps. Unless noted, these following recommendations are best practices regardless of deployment method.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Upgrading from a release candidate build, such as 9.0.0-rc1, is not supported. Pre-releases should only be used for testing in a temporary environment.</p>
</div>
</div>
<p>To upgrade to 9.0.0-rc1 from 8.17 or earlier, <span class="strong strong"><strong>you must first upgrade to the latest patch version of 8.18</strong></span>. This enables you to use the <span class="strong strong"><strong>Upgrade Assistant</strong></span> to identify and resolve issues,
reindex indices created before 8.0 or mark them as read-only, and perform a rolling upgrade.</p>
<p><span class="strong strong"><strong>Upgrading to 8.18 before upgrading to 9.0.0-rc1 is required
even if you opt to do a full-cluster restart of your Elasticsearch cluster.</strong></span></p>
<p>Alternatively, you can create a new 9.0.0-rc1 deployment and reindex from remote.
For more information, refer to <a class="xref" href="upgrade-elastic-stack-for-elastic-cloud.html#upgrading-reindex" title="Reindex to upgrade">Reindex to upgrade</a>.</p>
<p>Beats and Logstash 8.18 are compatible with Elasticsearch 9.0.0-rc1
to give you flexibility in scheduling the upgrade.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p class="admon_title">Remote cluster compatibility</p>
<p>If you use cross-cluster search, note that 9.0.0-rc1 can only search remote clusters running the previous minor version or later.
For more information, see <a href="/guide/en/elasticsearch/reference/current/modules-cross-cluster-search.html" class="ulink" target="_top">Searching across clusters</a>.</p>
<p>If you use cross-cluster replication, a cluster that contains follower indices must run the same or newer version as the remote cluster.
For more information, see <a href="/guide/en/elasticsearch/reference/current/xpack-ccr.html" class="ulink" target="_top">Cross cluster replication</a> for version compatibility matrix.</p>
<p>You can view your remote clusters from <span class="strong strong"><strong>Stack Management &gt; Remote Clusters</strong></span>.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Once you&#8217;ve upgraded to 8.18, use the <a href="/guide/en/kibana/current/upgrade-assistant.html" class="ulink" target="_top"><span class="strong strong"><strong>Upgrade Assistant</strong></span></a> to prepare for your upgrade from 8.18 to 9.0.0-rc1. The Upgrade Assistant identifies deprecated settings and guides you through resolving issues and reindexing indices created before 8.0. Elasticsearch fully supports indices created in the current or previous major version. Older indices are partly supported as read-only archives with limited capabilities.
</li>
<li class="listitem">
<p>Ensure you have a current <a href="/guide/en/elasticsearch/reference/current/snapshots-take-snapshot.html" class="ulink" target="_top">snapshot</a> before making configuration changes or reindexing.
<span class="strong strong"><strong>You must resolve all critical issues before proceeding with the upgrade.</strong></span> If you make any additional changes, take a new snapshot to back up your data.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you’re upgrading on Elastic Cloud Hosted, to keep your data safe during the upgrade process, a snapshot is taken automatically before any changes are made to your cluster. If you’re upgrading on Elastic Cloud Enterprise, you need to <a href="/guide/en/cloud-enterprise/current/ece-manage-repositories.html" class="ulink" target="_top">configure a snapshot repository</a> to enable snapshots.</p>
</div>
</div>
</li>
<li class="listitem">
Ensure you carefully review the deprecation logs from the Upgrade Assistant to determine if your applications are using features that are not supported or behave differently in 9.0.0-rc1.
</li>
<li class="listitem">
<p>Major version upgrades can include breaking changes that require you to take additional steps to ensure that your applications behave as expected after the upgrade. Review all 9.0.0-rc1 <a class="xref" href="elastic-stack-breaking-changes.html" title="Breaking changes">breaking changes</a> for each product you use to view more information about changes that could affect your application. Ensure you test against the new version before upgrading existing deployments.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Ensure you check the breaking changes for each minor 8.x release up to 9.0.0-rc1.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Make the recommended changes to ensure that your clients continue to operate as expected after the upgrade.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>As a temporary solution, you can submit requests to 9.x
using the 8.x syntax with the REST API compatibility mode.
While this enables you to submit requests that use the old syntax,
it does not guarantee the same behavior.
REST API compatibility should be a bridge to smooth out the upgrade process,
not a long term strategy.
For more information, see <a href="/guide/en/elasticsearch/reference/current/rest-api-compatibility.html" class="ulink" target="_top">REST API compatibility</a>.</p>
</div>
</div>
</li>
<li class="listitem">
If you use any Elasticsearch plugins, ensure there is a version of each plugin that is compatible with 9.0.0-rc1.
</li>
<li class="listitem">
<p>We recommend creating a 9.0 test deployment and testing the upgrade in an isolated environment before upgrading your production deployment. Ensure that both your test and production environments have the same settings.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot downgrade Elasticsearch nodes after upgrading. If you cannot complete the upgrade process, you will need to <a href="/guide/en/elasticsearch/reference/current/snapshots-restore-snapshot.html" class="ulink" target="_top">restore from the snapshot</a>.</p>
</div>
</div>
</li>
<li class="listitem">
If you use a separate <a href="/guide/en/elasticsearch/reference/current/monitoring-production.html" class="ulink" target="_top">monitoring cluster</a>, you should upgrade the monitoring cluster before the production cluster. In general, the monitoring cluster and the clusters being monitored should be running the same version of the stack. A monitoring cluster cannot monitor production clusters running newer versions of the stack. If necessary, the monitoring cluster can monitor production clusters running the latest release of the previous major version.
</li>
<li class="listitem">
To reduce overhead on the cluster during the upgrade, close machine learning jobs. Although machine learning jobs can run during a rolling upgrade, doing so increases the cluster workload.
</li>
<li class="listitem">
If you have <code class="literal">.ml-anomalies-*</code> anomaly detection result indices created in Elasticsearch 7.x, reindex, mark as read-only, or delete them before you upgrade to 9.0.0-rc1. For more information, refer to <a class="xref" href="upgrading-elastic-stack.html#anomaly-detection-results-migration" title="Migrate anomaly detection results">Migrate anomaly detection results</a>.
</li>
<li class="listitem">
If you have transform destination indices created in Elasticsearch 7.x, reset, reindex, or delete them before you upgrade to 9.0.0-rc1. For more information, refer to <a class="xref" href="upgrading-elastic-stack.html#breaking_90_transform_destination_index" title="Transform destination indices migration">Migrate transform destination indices</a>.
</li>
</ol>
</div>
<div class="position-relative"><h3><a id="anomaly-detection-results-migration"></a>Migrate anomaly detection results</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrading-stack.asciidoc">edit</a></div>
<p>The anomaly detection result indices <code class="literal">.ml-anomalies-*</code> created in Elasticsearch 7.x must be either reindexed, marked read-only, or deleted before upgrading to 9.x.</p>
<p><span class="strong strong"><strong>Reindexing</strong></span>: While anomaly detection results are being reindexed, jobs continue to run and process new data. However, you cannot completely delete an anomaly detection job that stores results in this index until the reindexing is complete.</p>
<p><span class="strong strong"><strong>Marking indices as read-only</strong></span>: This is useful for large indexes that contain the results of only one or a few anomaly detection jobs. You need to update or delete all obsolete model snapshots before using this option. If you delete these jobs later, you will not be able to create a new job with the same name.</p>
<p><span class="strong strong"><strong>Deleting</strong></span>: Delete jobs that are no longer needed in the Machine Learning app in Kibana. The result index is deleted when all jobs that store results in it have been deleted.</p>
<details>
<summary class="title">Which indices require attention?</summary>
<div class="content">
<p>To identify indices that require action, use the <a href="/docs/api/doc/elasticsearch/operation/operation-migration-deprecations-1" class="ulink" target="_top">Deprecation info API</a>:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET /.ml-anomalies-*/_migration/deprecations</pre>
</div>
<div class="console_widget" data-snippet="snippets/1.console"></div>
<p>The response contains the list of critical deprecation warnings in the <code class="literal">index_settings</code> section:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">  "index_settings": {
    ".ml-anomalies-shared": [
      {
        "level": "critical",
        "message": "Index created before 8.0",
        "url": "https://ela.st/es-deprecation-8-reindex",
        "details": "This index was created with version 7.8.23 and is not compatible with 9.0. Reindex or remove the index before upgrading.",
        "resolve_during_rolling_upgrade": false
      }
    ]
  }</pre>
</div>
<div class="console_widget" data-snippet="snippets/2.console"></div>
</div>
</details>
<details>
<summary class="title">Reindexing anomaly result indices</summary>
<div class="content">
<p>For an index with less than 10GB that contains results from multiple jobs that are still required, we recommend reindexing into a new format using UI. You can use the <a href="/docs/api/doc/elasticsearch/operation/operation-cat-indices-1" class="ulink" target="_top">Get index information API</a> to obtain the size of an index:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _cat/indices/.ml-anomalies-custom-example?v&amp;h=index,store.size</pre>
</div>
<div class="console_widget" data-snippet="snippets/3.console"></div>
<p>The reindexing can be initiated in the Kibana Upgrade Assistant.</p>
<p>If an index size is greater than 10 GB, it is recommended to use the Reindex API. Reindexing consists of the following steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Set the original index to read-only.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT .ml-anomalies-custom-example/_block/read_only</pre>
</div>
<div class="console_widget" data-snippet="snippets/4.console"></div>
</li>
<li class="listitem">
<p>Create a new index from the legacy index.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _create_from/.ml-anomalies-custom-example/.reindexed-v9-ml-anomalies-custom-example</pre>
</div>
<div class="console_widget" data-snippet="snippets/5.console"></div>
</li>
<li class="listitem">
<p>Reindex documents. To accelerate the reindexing process, it is recommended that the number of replicas be set to <code class="literal">0</code> before the reindexing and then set back to the original number once it is completed.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Get the number of replicas.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET /.reindexed-v9-ml-anomalies-custom-example/_settings</pre>
</div>
<div class="console_widget" data-snippet="snippets/6.console"></div>
<p>Note the number of replicas in the response. For example:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">{
  ".reindexed-v9-ml-anomalies-custom-example": {
    "settings": {
      "index": {
        "number_of_replicas": "1",
        "number_of_shards": "1"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/7.console"></div>
</li>
<li class="listitem">
<p>Set the number of replicas to <code class="literal">0</code>. You must also set the <code class="literal">auto_expand_replicas</code> parameter to <code class="literal">false</code> to change the number of replicas:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /.reindexed-v9-ml-anomalies-custom-example/_settings
{
  "index": {
    "auto_expand_replicas": false,
    "number_of_replicas": 0
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/8.console"></div>
</li>
<li class="listitem">
<p>Start the reindexing process in asynchronous mode.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _reindex?wait_for_completion=false
{
  "source": {
    "index": ".ml-anomalies-custom-example"
  },
  "dest": {
    "index": ".reindexed-v9-ml-anomalies-custom-example"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/9.console"></div>
<p>The response will contain a <code class="literal">task_id</code>. You can check when the task is completed using the following command:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _tasks/&lt;task_id&gt;</pre>
</div>
<div class="console_widget" data-snippet="snippets/10.console"></div>
</li>
<li class="listitem">
<p>Set the number of replicas to the original number when the reindexing is finished. Optionally, you can set the <code class="literal">auto_expand_replicas</code> parameter back to its default value (<code class="literal">0-1</code>) to allow the number of replicas to be automatically adjusted based on the number of data nodes in the cluster.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /.reindexed-v9-ml-anomalies-custom-example/_settings
{
  "index": {
    "number_of_replicas": "&lt;original_number_of_replicas&gt;",
    "auto_expand_replicas": "0-1"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/11.console"></div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Get the aliases the original index is pointing to.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET .ml-anomalies-custom-example/_alias</pre>
</div>
<div class="console_widget" data-snippet="snippets/12.console"></div>
<p>The response may contain multiple aliases if the results of multiple jobs are stored in the same index.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">{
  ".ml-anomalies-custom-example": {
    "aliases": {
      ".ml-anomalies-example1": {
        "filter": {
          "term": {
            "job_id": {
              "value": "example1"
            }
          }
        },
        "is_hidden": true
      },
      ".ml-anomalies-example2": {
        "filter": {
          "term": {
            "job_id": {
              "value": "example2"
            }
          }
        },
        "is_hidden": true
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/13.console"></div>
</li>
<li class="listitem">
<p>Now you can reassign the aliases to the new index and delete the original index in one step. Note that when adding the new index to the aliases, you must use the same <code class="literal">filter</code> and <code class="literal">is_hidden</code> parameters as for the original index.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _aliases
{
  "actions": [
    {
      "add": {
        "index": ".reindexed-v9-ml-anomalies-custom-example",
        "alias": ".ml-anomalies-example1",
        "filter": {
          "term": {
            "job_id": {
              "value": "example1"
            }
          }
        },
        "is_hidden": true
      }
    },
    {
      "add": {
        "index": ".reindexed-v9-ml-anomalies-custom-example",
        "alias": ".ml-anomalies-example2",
        "filter": {
          "term": {
            "job_id": {
              "value": "example2"
            }
          }
        },
        "is_hidden": true
      }
    },
    {
      "remove": {
        "index": ".ml-anomalies-custom-example",
        "aliases": ".ml-anomalies-*"
      }
    },
    {
      "remove_index": {
        "index": ".ml-anomalies-custom-example"
      }
    },
    {
      "add": {
        "index": ".reindexed-v9-ml-anomalies-custom-example",
        "alias": ".ml-anomalies-custom-example",
        "is_hidden": true
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/14.console"></div>
</li>
</ol>
</div>
</div>
</details>
<details>
<summary class="title">Marking anomaly result indices as read-only</summary>
<div class="content">
<p>Legacy indices created in Elasticsearch 7.x can be made read-only and supported in Elasticsearch 9.x. Making an index with a large amount of historical results read-only allows for a quick migration to the next major release, since you don&#8217;t have to wait for the data to be reindexed into the new format. However, it has the limitation that even after deleting an anomaly detection job, the historical results associated with this job are not completely deleted. Therefore, the system will prevent you from creating a new job with the same name.</p>
<p>Be sure to resolve any obsolete model snapshot warnings before marking the index read-only.</p>
<p>To set the index as read-only, add the write block to the index:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT .ml-anomalies-custom-example/_block/write</pre>
</div>
<div class="console_widget" data-snippet="snippets/15.console"></div>
<p>Indices created in Elasticsearch 7.x that have a write block will not raise a critical deprecation warning.</p>
</div>
</details>
<details>
<summary class="title">Deleting anomaly result indices</summary>
<div class="content">
<p>If an index contains results of the jobs that are no longer required. To list all jobs that stored results in an index, use the terms aggregation:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET .ml-anomalies-custom-example/_search
{
  "size": 0,
  "aggs": {
    "job_ids": {
      "terms": {
        "field": "job_id",
        "size": 100
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/16.console"></div>
<p>The jobs can be deleted in the UI. After the last job is deleted, the index will be deleted as well.</p>
</div>
</details>
<div class="position-relative"><h3><a id="breaking_90_transform_destination_index"></a>Transform destination indices migration</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/9.0/docs/en/install-upgrade/upgrading-stack.asciidoc">edit</a></div>
<p>The transform destination indices created in Elasticsearch 7.x must be either reset, reindexed, or deleted before upgrading to 9.x.</p>
<p><span class="strong strong"><strong>Resetting</strong></span>: You can reset the transform to delete all state, checkpoints, and the destination index (if it was created by the transform). The next time you start the transform, it will reprocess all data from the source index, creating a new destination index in Elasticsearch 8.x compatible with 9.x. However, if data had been deleted from the source index, you will lose all previously computed results that had been stored in the destination index.</p>
<p><span class="strong strong"><strong>Reindexing</strong></span>: You can reindex the destination index and then update the transform to write to the new destination index. This is useful if there are results that you want to retain that may not exist in the source index. To prevent the transform and reindex tasks from conflicting with one another, you can either pause the transform while the reindex runs, or you can write to the new destination index while the reindex backfills old results.</p>
<p><span class="strong strong"><strong>Deleting</strong></span>: You can delete any transforms that are no longer being used. Once the transform is deleted, you can either delete the destination index or make it read-only.</p>
<details>
<summary class="title">Which indices require attention?</summary>
<div class="content">
<p>To identify indices that require action, use the <a href="/docs/api/doc/elasticsearch/operation/operation-migration-deprecations-1" class="ulink" target="_top">Deprecation info API</a>:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET /_migration/deprecations</pre>
</div>
<div class="console_widget" data-snippet="snippets/17.console"></div>
<p>The response contains the list of critical deprecation warnings in the <code class="literal">index_settings</code> section:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">"index_settings": {
    "my-destination-index": [
      {
        "level": "critical",
        "message": "One or more Transforms write to this index with a compatibility version &lt; 9.0",
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/master/migrating-9.0.html#breaking_90_transform_destination_index",
        "details": "Transforms [my-transform] write to this index with version [7.8.23].",
        "resolve_during_rolling_upgrade": false
      }
    ]
  }</pre>
</div>
<div class="console_widget" data-snippet="snippets/18.console"></div>
</div>
</details>
<details>
<summary class="title">Resetting the transform</summary>
<div class="content">
<p>If the index was created by the transform, you can use the <a href="/docs/api/doc/elasticsearch/operation/operation-transform-reset-transform" class="ulink" target="_top">Transform Reset API</a> to delete the destination index and recreate it the next time the transform runs.</p>
<p>If the index was not created by the transform, and you still want to reset it, you can manually delete and recreate the index, then call the Reset API.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _transform/my-transform/_reset</pre>
</div>
<div class="console_widget" data-snippet="snippets/19.console"></div>
</div>
</details>
<details>
<summary class="title">Reindexing the transform&#8217;s destination index while the transform is paused</summary>
<div class="content">
<p>When Kibana Upgrade Assistant reindexes the documents, Kibana will put a write block on the old destination index, copy the results to a new index, delete the old index, and create an alias to the new index. During this time, the transform will pause and wait for the destination to become writable again.  If you do not want the transform to pause, continue to <a class="xref" href="upgrading-elastic-stack.html#reindexing-transform-running" title="Reindexing the transform&#8217;s destination index while the transform is running">reindexing the transform&#8217;s destination index while the transform is running</a>.</p>
<p>If an index is less than 10GB of size, we recommend using Kibana&#8217;s Upgrade Assistant to automatically migrate the index.</p>
<p>If an index size is greater than 10 GB it is recommended to use the Reindex API. Reindexing consists of the following steps:</p>
<p>You can use the <a href="/docs/api/doc/elasticsearch/operation/operation-cat-indices-1" class="ulink" target="_top">Get index information API</a> to obtain the size of an index:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _cat/indices/.transform-destination-example?v&amp;h=index,store.size</pre>
</div>
<div class="console_widget" data-snippet="snippets/20.console"></div>
<p>The reindexing can be initiated in the Kibana Upgrade Assistant.</p>
<p>If an index size is greater than 10 GB, it is recommended to use the Reindex API. Reindexing consists of the following steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Set the original index to read-only.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT .transform-destination-example/_block/read_only</pre>
</div>
<div class="console_widget" data-snippet="snippets/21.console"></div>
</li>
<li class="listitem">
<p>Create a new index from the legacy index.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _create_from/.transform-destination-example/.reindexed-v9-transform-destination-example</pre>
</div>
<div class="console_widget" data-snippet="snippets/22.console"></div>
</li>
<li class="listitem">
<p>Reindex documents. To accelerate the reindexing process, it is recommended that the number of replicas be set to <code class="literal">0</code> before the reindexing and then set back to the original number once it is completed.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Get the number of replicas.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET /.reindexed-v9-transform-destination-example/_settings</pre>
</div>
<div class="console_widget" data-snippet="snippets/23.console"></div>
<p>Note the number of replicas in the response. For example:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">{
  ".reindexed-v9-transform-destination-example": {
    "settings": {
      "index": {
        "number_of_replicas": "1",
        "number_of_shards": "1"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/24.console"></div>
</li>
<li class="listitem">
<p>Set the number of replicas to <code class="literal">0.</code></p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /.reindexed-v9-transform-destination-example/_settings
{
  "index": {
    "number_of_replicas": 0
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/25.console"></div>
</li>
<li class="listitem">
<p>Start the reindexing process in asynchronous mode.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _reindex?wait_for_completion=false
{
  "source": {
    "index": ".transform-destination-example"
  },
  "dest": {
    "index": ".reindexed-v9-transform-destination-example"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/26.console"></div>
<p>The response will contain a <code class="literal">task_id</code>. You can check when the task is completed using the following command:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _tasks/&lt;task_id&gt;</pre>
</div>
<div class="console_widget" data-snippet="snippets/27.console"></div>
</li>
<li class="listitem">
<p>Set the number of replicas to the original number when the reindexing is finished.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /.reindexed-v9-transform-destination-example/_settings
{
  "index": {
    "number_of_replicas": "&lt;original_number_of_replicas&gt;"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/28.console"></div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Get the aliases the original index is pointing to.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET .transform-destination-example/_alias</pre>
</div>
<div class="console_widget" data-snippet="snippets/29.console"></div>
<p>The response may contain multiple aliases if the results of multiple jobs are stored in the same index.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">{
  ".transform-destination-example": {
    "aliases": {
      ".transform-destination-example1": {
        "filter": {
          "term": {
            "job_id": {
              "value": "example1"
            }
          }
        },
        "is_hidden": true
      },
      ".transform-destination-example2": {
        "filter": {
          "term": {
            "job_id": {
              "value": "example2"
            }
          }
        },
        "is_hidden": true
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/30.console"></div>
</li>
<li class="listitem">
<p>Now you can reassign the aliases to the new index and delete the original index in one step. Note that when adding the new index to the aliases, you must use the same <code class="literal">filter</code> and <code class="literal">is_hidden</code> parameters as for the original index.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _aliases
{
  "actions": [
    {
      "add": {
        "index": ".reindexed-v9-transform-destination-example",
        "alias": ".transform-destination-example1",
        "filter": {
          "term": {
            "job_id": {
              "value": "example1"
            }
          }
        },
        "is_hidden": true
      }
    },
    {
      "add": {
        "index": ".reindexed-v9-transform-destination-example",
        "alias": ".transform-destination-example2",
        "filter": {
          "term": {
            "job_id": {
              "value": "example2"
            }
          }
        },
        "is_hidden": true
      }
    },
    {
      "remove": {
        "index": ".transform-destination-example",
        "aliases": ".transform-destination-*"
      }
    },
    {
      "remove_index": {
        "index": ".transform-destination-example"
      }
    },
    {
      "add": {
        "index": ".reindexed-v9-transform-destination-example",
        "alias": ".transform-destination-example",
        "is_hidden": true
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/31.console"></div>
</li>
</ol>
</div>
</div>
</details>
<details id="reindexing-transform-running">
<summary class="title">Reindexing the transform&#8217;s destination index while the transform is running</summary>
<div class="content">
<p>If you want the transform and the reindex task to write documents to the new destination index at the same time:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Set the original index to read-only.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _create_from/my-destination-index/my-new-destination-index</pre>
</div>
<div class="console_widget" data-snippet="snippets/32.console"></div>
</li>
<li class="listitem">
<p>Update the transform to write to the new destination index:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _transform/my-transform/_update
{
 "dest": {
   "index": "my-new-destination-index"
 }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/33.console"></div>
</li>
<li class="listitem">
<p>Reindex documents. To accelerate the reindexing process, it is recommended that the number of replicas be set to 0 before the reindexing and then set back to the original number once it is completed.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Get the number of replicas.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET /my-destination-index/_settings</pre>
</div>
<div class="console_widget" data-snippet="snippets/34.console"></div>
</li>
<li class="listitem">
<p>Note the number of replicas in the response. For example:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">{
  "my-destination-index": {
    "settings": {
      "index": {
        "number_of_replicas": "1",
        "number_of_shards": "1"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/35.console"></div>
</li>
<li class="listitem">
<p>Set the number of replicas to <code class="literal">0.</code></p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /my-destination-index/_settings
{
  "index": {
    "number_of_replicas": 0
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/36.console"></div>
</li>
<li class="listitem">
Start the reindexing process in asynchronous mode. Set the <code class="literal">op_type</code> to <code class="literal">create</code> so the reindex does not overwrite work that the transform is doing.
</li>
</ol>
</div>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _reindex
{
 "conflicts": "proceed",
 "source": {
   "index": "my-destination-index"
 },
 "dest": {
   "index": "my-new-destination-index",
   "op_type": "create"
 }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/37.console"></div>
<p>+
The response will contain a <code class="literal">task_id</code>. You can check when the task is completed using the following command:</p>
<p>+</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _tasks/&lt;task_id&gt;</pre>
</div>
<div class="console_widget" data-snippet="snippets/38.console"></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Set the number of replicas to the original number when the reindexing is finished.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /my-new-destination-index/_settings
{
  "index": {
    "number_of_replicas": "&lt;original_number_of_replicas&gt;"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/39.console"></div>
</li>
<li class="listitem">
<p>Get the aliases the original index is pointing to.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET my-destination-index/_alias

{
  "my-destination-index": {
    "aliases": {
      "my-destination-alias": {},
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/40.console"></div>
</li>
<li class="listitem">
<p>Now you can reassign the aliases to the new index and delete the original index in one step. Note that when adding the new index to the aliases, you must use the same <code class="literal">filter</code> and <code class="literal">is_hidden</code> parameters as for the original index.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _aliases
{
  "actions": [
    {
      "add": {
        "index": "my-new-destination-index",
        "alias": "my-destination-alias"
      }
    },
    {
      "remove": {
        "index": "my-destination-index",
        "aliases": "my-destination-alias"
      }
    },
    {
      "remove_index": {
        "index": "my-destination-index"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/41.console"></div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</details>
<details>
<summary class="title">Deleting the transform</summary>
<div class="content">
<p>You can use the <a href="/docs/api/doc/elasticsearch/operation/operation-transform-delete-transform" class="ulink" target="_top">Transform Delete API</a> to delete the transform and stop it from writing to the destination index.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">DELETE _transform/my-transform</pre>
</div>
<div class="console_widget" data-snippet="snippets/42.console"></div>
<p>If the destination index is no longer needed, it can be deleted alongside the transform.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">DELETE _transform/my-transform?delete_dest_index</pre>
</div>
<div class="console_widget" data-snippet="snippets/43.console"></div>
</div>
</details>
</div>
</div>



</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="release-notes-logstash-9.0.0.html">« Logstash release notes</a>
</span>
<span class="next">
<a href="upgrade-orchestrator.html">Upgrade your orchestrator »</a>
</span>
</div>
</body>
</html>
