<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Apache http-client I/O reactor errors | Elasticsearch Java API Client [master] | Elastic</title>
<meta class="elastic" name="content" content="Apache http-client I/O reactor errors | Elasticsearch Java API Client [master]">

<link rel="home" href="index.html" title="Elasticsearch Java API Client [master]"/>
<link rel="up" href="troubleshooting.html" title="Troubleshooting"/>
<link rel="prev" href="no-such-method-request-options.html" title="NoSuchMethodError RequestOptions$Builder.removeHeader when creating a client"/>
<link rel="next" href="serialize-without-typed-keys.html" title="Serializing aggregations and suggestions without typed keys"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Clients"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Clients/Java/master"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Java API Client [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="troubleshooting.html">Troubleshooting</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="no-such-method-request-options.html">« <code class="literal">NoSuchMethodError RequestOptions$Builder.removeHeader</code> when creating a client</a>
</span>
<span class="next">
<a href="serialize-without-typed-keys.html">Serializing aggregations and suggestions without typed keys »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="io-reactor-errors"></a>Apache http-client I/O reactor errors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/troubleshooting/io-reactor-errors.asciidoc">edit</a></h2>
</div></div></div>
<p>Sending requests can sometimes fail with one of the following errors, coming from the Apache http-client library:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">Request cannot be executed; I/O reactor status: STOPPED</code>
</li>
<li class="listitem">
<code class="literal">I/O reactor terminated abnormally</code>
</li>
<li class="listitem">
<code class="literal">I/O reactor has been shut down</code>
</li>
</ul>
</div>
<p>The I/O Reactor is the internal event loop in the http client library. It can terminate when an application callback throws an <code class="literal">Error</code>, like an <code class="literal">OutOfMemoryError</code> or a <code class="literal">StackOverflowError</code>. Remember that <code class="literal">Error</code> is different from a regular <code class="literal">Exception</code> and – <a href="https://docs.oracle.com/javase/8/docs/api/?java/lang/Error.html" class="ulink" target="_top">quoting the Java documentation</a> – <em>indicates serious problems that a reasonable application should not try to catch</em>.</p>
<p>In the context of the Elasticsearch Java clients, this can happen on two occasions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
the application calls the low level <code class="literal">RestClient</code> directly, using the asynchronous <code class="literal">performRequestAsync</code> method, and an <code class="literal">Error</code> is thrown in the <code class="literal">ResponseListener</code> provided by the application.
</li>
<li class="listitem">
an <code class="literal">OutOfMemoryError</code> happens while buffering the body of an http response.
</li>
</ul>
</div>
<p>In the first case, it is the application&#8217;s responsibility to catch <code class="literal">Error</code> in its <code class="literal">ResponseListener</code> and decide what to do when these errors happen.</p>
<p>The second case is taken care of in the Java API Client since version 8.12: the error is wrapped in a <code class="literal">RuntimeException</code> that is reported to the application.</p>
<p>In previous versions of the Java API Client, you can copy/paste the <code class="literal">SafeResponseConsumer</code> class in your project and initialize the <code class="literal">RestClientTransport</code> as follows:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">RestClient restClient = ...
JsonpMapper mapper = ...
RestClientOptions options = new RestClientOptions(
    SafeResponseConsumer.DEFAULT_REQUEST_OPTIONS
);
RestClientTransport transport = new RestClientTransport(
    restClient, mapper, options
);</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="no-such-method-request-options.html">« <code class="literal">NoSuchMethodError RequestOptions$Builder.removeHeader</code> when creating a client</a>
</span>
<span class="next">
<a href="serialize-without-typed-keys.html">Serializing aggregations and suggestions without typed keys »</a>
</span>
</div>
</div>
</body>
</html>
