<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Migrating from the High Level Rest Client | Elasticsearch Java API Client [master] | Elastic</title>
<meta class="elastic" name="content" content="Migrating from the High Level Rest Client | Elasticsearch Java API Client [master]">

<link rel="home" href="index.html" title="Elasticsearch Java API Client [master]"/>
<link rel="up" href="_setup.html" title="Setup"/>
<link rel="prev" href="connecting.html" title="Connecting"/>
<link rel="next" href="opentelemetry.html" title="Using OpenTelemetry"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Clients"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Clients/Java/master"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="connecting.html">« Connecting</a>
</span>
<span class="next">
<a href="opentelemetry.html">Using OpenTelemetry »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Java API Client [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="_setup.html">Setup</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Migrating from the High Level Rest Client</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/setup/migrate-hlrc.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="migrate-hlrc"></a>Migrating from the High Level Rest Client<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/setup/migrate-hlrc.asciidoc">edit</a></h2>
</div></div></div>
<p>The Elasticsearch Java API Client is an entirely new client library that has no relation
to the older High Level Rest Client (HLRC). This was a deliberate choice to
provide a library that is independent from the Elasticsearch server code and that
provides a very consistent and easier to use API for all Elasticsearch features.</p>
<p>Migrating from the HLRC therefore requires some code rewrite in your
application. This transition can however happen progressively as the two client
libraries can coexist in a single application with no operational overhead.</p>
<h4><a id="_compatibility_mode_using_a_7_17_client_with_elasticsearch_8_x"></a>Compatibility mode: using a 7.17 client with Elasticsearch 8.x<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/setup/migrate-hlrc.asciidoc">edit</a></h4>
<p>The HLRC version <code class="literal">7.17</code> can be used with Elasticsearch version <code class="literal">8.x</code> by enabling
HLRC&#8217;s compatibility mode (see code sample below). In this mode HLRC sends
additional headers that instruct Elasticsearch <code class="literal">8.x</code> to behave like a <code class="literal">7.x</code> server.</p>
<p>The Java API Client doesn&#8217;t need this setting as compatibility mode is always
enabled.</p>
<p>You can use the HLRC version <code class="literal">7.x</code> with the Java API Client version <code class="literal">8.x</code>:</p>
<div class="pre_wrapper lang-groovy">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-groovy">dependencies {
    implementation 'co.elastic.clients:elasticsearch-java:8.16.0'
    implementation 'org.elasticsearch.client:elasticsearch-rest-high-level-client:7.17.4'
    // other dependencies <a id="CO4-1"></a><i class="conum" data-value="1"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO4-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>See <a class="xref" href="installation.html" title="Installation">Installation</a></p>
</td>
</tr>
</table>
</div>
<h4><a id="_using_the_same_http_client_with_the_hlrc_and_the_java_api_client"></a>Using the same http client with the HLRC and the Java API Client<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/setup/migrate-hlrc.asciidoc">edit</a></h4>
<p>To avoid any operational overhead during the transition phase where an
application would use both the HLRC and the new Java API Client, both clients
can share the same Low Level Rest Client, which is the network layer that
manages all connections, round-robin strategies, node sniffing, and so on.</p>
<p>The code below shows how to initialize both clients with the same HTTP client:</p>
<div class="pre_wrapper lang-java">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-java">// Create the low-level client
RestClient httpClient = RestClient.builder(
    new HttpHost("localhost", 9200)
).build();

// Create the HLRC
RestHighLevelClient hlrc = new RestHighLevelClientBuilder(httpClient)
    .setApiCompatibilityMode(true) <a id="CO5-1"></a><i class="conum" data-value="1"></i>
    .build();

// Create the Java API Client with the same low level client
ElasticsearchTransport transport = new RestClientTransport(
    httpClient,
    new JacksonJsonpMapper()
);

ElasticsearchClient esClient = new ElasticsearchClient(transport);

// hlrc and esClient share the same httpClient</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO5-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enables compatibility mode that allows HLRC <code class="literal">7.17</code> to work with Elasticsearch <code class="literal">8.x</code>.</p>
</td>
</tr>
</table>
</div>
<h4><a id="_transition_strategies"></a>Transition strategies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-java/edit/main/docs/setup/migrate-hlrc.asciidoc">edit</a></h4>
<p>There are different ways you can start transitioning away from the HLRC in your
application code.</p>
<p>For example:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
keep the existing code as-is and use the new Java API Client for new features
in your application, then later migrate the existing code,
</li>
<li class="listitem">
rewrite the parts of your application where the new Java API Client is much
easier to use than that of the HLRC, like everything related to search,
</li>
<li class="listitem">
rewrite those parts where you need to map application objects to/from JSON, by
leveraging the tight integration of the new Java API Client with JSON object
mappers.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="connecting.html">« Connecting</a>
</span>
<span class="next">
<a href="opentelemetry.html">Using OpenTelemetry »</a>
</span>
</div>
</body>
</html>
