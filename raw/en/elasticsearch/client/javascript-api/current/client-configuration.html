<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Client configuration | Elasticsearch Node.js client [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Node.js client [7.x]"/>
<link rel="up" href="index.html" title="Elasticsearch Node.js client [7.x]"/>
<link rel="prev" href="changelog-client.html" title="Changelog"/>
<link rel="next" href="api-reference.html" title="API Reference"/>
<meta name="DC.type" content="Learn/Docs/Clients/JavaScript/7.x"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="7.x"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Node.js client [7.x]</a></span>
»
<span class="breadcrumb-node">Client configuration</span>
</div>
<div class="navheader">
<span class="prev">
<a href="changelog-client.html">« Changelog</a>
</span>
<span class="next">
<a href="api-reference.html">API Reference »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="client-configuration"></a>Client configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/configuration.asciidoc">edit</a></h1>
</div></div></div>
<p>The client is designed to be easily configured for your needs. In the following
section, you can see the possible basic options that you can use to configure
it.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { Client } = require('@elastic/elasticsearch')

const client = new Client({
  node: 'http://localhost:9200',
  maxRetries: 5,
  requestTimeout: 60000,
  sniffOnStart: true
})</pre>
</div>
<h3><a id="_basic_options"></a>Basic options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/configuration.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">node</code> or <code class="literal">nodes</code></p></td>
<td align="left" valign="top">
<p>The Elasticsearch endpoint to use.<br>
It can be a single string or an array of strings:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">node: 'http://localhost:9200'</pre>
</div>
<p>Or it can be an object (or an array of objects) that represents the node:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">node: {
  url: new URL('http://localhost:9200'),
  ssl: 'ssl options',
  agent: 'http agent options',
  id: 'custom node id',
  headers: { 'custom': 'headers' }
  roles: {
    master: true,
    data: true,
    ingest: true,
    ml: false
  }
}</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">auth</code></p></td>
<td align="left" valign="top">
<p>Your authentication data. You can use both basic authentication and
<a href="/guide/en/elasticsearch/reference/7.x/security-api-create-api-key.html" class="ulink" target="_top">ApiKey</a>.<br>
See <a href="/guide/en/elasticsearch/client/javascript-api/current/auth-reference.html" class="ulink" target="_top">Authentication</a>
for more details.<br>
<em>Default:</em> <code class="literal">null</code></p>
<p>Basic authentication:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">auth: {
  username: 'elastic',
  password: 'changeme'
}</pre>
</div>
<p><a href="/guide/en/elasticsearch/reference/7.x/security-api-create-api-key.html" class="ulink" target="_top">ApiKey</a> authentication:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">auth: {
  apiKey: 'base64EncodedKey'
}</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">maxRetries</code></p></td>
<td align="left" valign="top"><p><code class="literal">number</code> - Max number of retries for each request.<br>
<em>Default:</em> <code class="literal">3</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">requestTimeout</code></p></td>
<td align="left" valign="top"><p><code class="literal">number</code> - Max request timeout in milliseconds for each request.<br>
<em>Default:</em> <code class="literal">30000</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">pingTimeout</code></p></td>
<td align="left" valign="top"><p><code class="literal">number</code> - Max ping request timeout in milliseconds for each request.<br>
<em>Default:</em> <code class="literal">3000</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sniffInterval</code></p></td>
<td align="left" valign="top"><p><code class="literal">number, boolean</code> - Perform a sniff operation every <code class="literal">n</code> milliseconds. Sniffing might not be the best solution for you, take a look <a href="/blog/elasticsearch-sniffing-best-practices-what-when-why-how" class="ulink" target="_top">here</a> to know more.<br>
<em>Default:</em> <code class="literal">false</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sniffOnStart</code></p></td>
<td align="left" valign="top"><p><code class="literal">boolean</code> - Perform a sniff once the client is started. Sniffing might not be the best solution for you, take a look <a href="/blog/elasticsearch-sniffing-best-practices-what-when-why-how" class="ulink" target="_top">here</a> to know more.<br>
<em>Default:</em> <code class="literal">false</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sniffEndpoint</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code> - Endpoint to ping during a sniff.<br>
<em>Default:</em> <code class="literal">'_nodes/_all/http'</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">sniffOnConnectionFault</code></p></td>
<td align="left" valign="top"><p><code class="literal">boolean</code> - Perform a sniff on connection fault. Sniffing might not be the best solution for you, take a look <a href="/blog/elasticsearch-sniffing-best-practices-what-when-why-how" class="ulink" target="_top">here</a> to know more.<br>
<em>Default:</em> <code class="literal">false</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">resurrectStrategy</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code> - Configure the node resurrection strategy.<br>
<em>Options:</em> <code class="literal">'ping'</code>, <code class="literal">'optimistic'</code>, <code class="literal">'none'</code><br>
<em>Default:</em> <code class="literal">'ping'</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">suggestCompression</code></p></td>
<td align="left" valign="top"><p><code class="literal">boolean</code> - Adds <code class="literal">accept-encoding</code> header to every request.<br>
<em>Default:</em> <code class="literal">false</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">compression</code></p></td>
<td align="left" valign="top"><p><code class="literal">string, boolean</code> - Enables gzip request body compression.<br>
<em>Options:</em> <code class="literal">'gzip'</code>, <code class="literal">false</code><br>
<em>Default:</em> <code class="literal">false</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ssl</code></p></td>
<td align="left" valign="top"><p><code class="literal">http.SecureContextOptions</code> - ssl <a href="https://nodejs.org/api/tls.html" class="ulink" target="_top">configuraton</a>.<br>
<em>Default:</em> <code class="literal">null</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">proxy</code></p></td>
<td align="left" valign="top">
<p><code class="literal">string, URL</code> - If you are using an http(s) proxy, you can put its url here.
The client will automatically handle the connection to it.<br>
<em>Default:</em> <code class="literal">null</code></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const client = new Client({
  node: 'http://localhost:9200',
  proxy: 'http://localhost:8080'
})

const client = new Client({
  node: 'http://localhost:9200',
  proxy: 'http://user:pwd@localhost:8080'
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent</code></p></td>
<td align="left" valign="top">
<p><code class="literal">http.AgentOptions, function</code> - http agent <a href="https://nodejs.org/api/http.html#http_new_agent_options" class="ulink" target="_top">options</a>,
or a function that returns an actual http agent instance. If you want to disable the http agent use entirely
(and disable the <code class="literal">keep-alive</code> feature), set the agent to <code class="literal">false</code>.<br>
<em>Default:</em> <code class="literal">null</code></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const client = new Client({
  node: 'http://localhost:9200',
  agent: { agent: 'options' }
})

const client = new Client({
  node: 'http://localhost:9200',
  // the function takes as parameter the option
  // object passed to the Connection constructor
  agent: (opts) =&gt; new CustomAgent()
})

const client = new Client({
  node: 'http://localhost:9200',
  // Disable agent and keep-alive
  agent: false
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">nodeFilter</code></p></td>
<td align="left" valign="top">
<p><code class="literal">function</code> - Filters which node not to use for a request.<br>
<em>Default:</em></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">function defaultNodeFilter (node) {
  // avoid master only nodes
  if (node.roles.master === true &amp;&amp;
      node.roles.data === false &amp;&amp;
      node.roles.ingest === false) {
    return false
  }
  return true
}</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">nodeSelector</code></p></td>
<td align="left" valign="top">
<p><code class="literal">function</code> - custom selection strategy.<br>
<em>Options:</em> <code class="literal">'round-robin'</code>, <code class="literal">'random'</code>, custom function<br>
<em>Default:</em> <code class="literal">'round-robin'</code><br>
<em>Custom function example:</em></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">function nodeSelector (connections) {
  const index = calculateIndex()
  return connections[index]
}</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">generateRequestId</code></p></td>
<td align="left" valign="top">
<p><code class="literal">function</code> - function to generate the request id for every request, it takes
two parameters, the request parameters and options.<br>
By default it generates an incremental integer for every request.<br>
<em>Custom function example:</em></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">function generateRequestId (params, options) {
  // your id generation logic
  // must be syncronous
  return 'id'
}</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string, symbol</code> - The name to identify the client instance in the events.<br>
<em>Default:</em> <code class="literal">elasticsearch-js</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">opaqueIdPrefix</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code> - A string that will be use to prefix any <code class="literal">X-Opaque-Id</code> header.<br>
See <a href="/guide/en/elasticsearch/client/javascript-api/current/observability.html#" class="ulink" target="_top">https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/observability.html#</a><em>x-opaque-id_support[<code class="literal">X-Opaque-Id</code> support] for more details.<br>
_Default:</em> <code class="literal">null</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">headers</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code> - A set of custom headers to send in every request.<br>
<em>Default:</em> <code class="literal">{}</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">context</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code> - A custom object that you can use for observability in yoru events.
It will be merged with the API level context option.<br>
<em>Default:</em> <code class="literal">null</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">cloud</code></p></td>
<td align="left" valign="top">
<p><code class="literal">object</code> - Custom configuration for connecting to
<a href="https://cloud.elastic.co" class="ulink" target="_top">Elastic Cloud</a>. See <a href="/guide/en/elasticsearch/client/javascript-api/current/auth-reference.html" class="ulink" target="_top">Authentication</a>
for more details.<br>
<em>Default:</em> <code class="literal">null</code><br>
<em>Cloud configuration example:</em></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const client = new Client({
  cloud: {
    id: 'name:bG9jYWxob3N0JGFiY2QkZWZnaA=='
  },
  auth: {
    username: 'elastic',
    password: 'changeme'
  }
})</pre>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<h3><a id="_advanced_configuration"></a>Advanced configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/configuration.asciidoc">edit</a></h3>
<p>If you need to customize the client behavior heavily, you are in the right
place! The client allows you to customize the following internals:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">Transport</code> class
</li>
<li class="listitem">
<code class="literal">ConnectionPool</code> class
</li>
<li class="listitem">
<code class="literal">Connection</code> class
</li>
<li class="listitem">
<code class="literal">Serializer</code> class
</li>
</ul>
</div>
<h3><a id="_transport"></a><code class="literal">Transport</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/configuration.asciidoc">edit</a></h3>
<p>This class is responsible for performing the request to Elasticsearch and handling
errors, it also handles the sniffing.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { Client, Transport } = require('@elastic/elasticsearch')

class MyTransport extends Transport {
  request (params, options, callback) {
    // your code
  }
}

const client = new Client({
    Transport: MyTransport
})</pre>
</div>
<p>Sometimes you need to inject a small snippet of your code and then continue to
use the usual client code. In such cases, call <code class="literal">super.method</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">class MyTransport extends Transport {
  request (params, options, callback) {
    // your code
    return super.request(params, options, callback)
  }
}</pre>
</div>
<h3><a id="_connectionpool"></a><code class="literal">ConnectionPool</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/configuration.asciidoc">edit</a></h3>
<p>This class is responsible for keeping in memory all the Elasticsearch Connection that we
are using. There is a single Connection for every node. The connection pool
handles the resurrection strategies and the updates of the pool.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { Client, ConnectionPool } = require('@elastic/elasticsearch')

class MyConnectionPool extends ConnectionPool {
  markAlive (connection) {
    // your code
    super.markAlive(connection)
  }
}

const client = new Client({
    ConnectionPool: MyConnectionPool
})</pre>
</div>
<h3><a id="_connection"></a><code class="literal">Connection</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/configuration.asciidoc">edit</a></h3>
<p>This class represents a single node, it holds every information we have on the
node, such as roles, id, URL, custom headers and so on. The actual HTTP request
is performed here, this means that if you want to swap the default HTTP client
(Node.js core), you should override the <code class="literal">request</code> method of this class.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { Client, Connection } = require('@elastic/elasticsearch')

class MyConnection extends Connection {
  request (params, callback) {
    // your code
  }
}

const client = new Client({
  Connection: MyConnection
})</pre>
</div>
<h3><a id="_serializer"></a><code class="literal">Serializer</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/configuration.asciidoc">edit</a></h3>
<p>This class is responsible for the serialization of every request, it offers the
following methods:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">serialize(object: any): string;</code> serializes request objects.
</li>
<li class="listitem">
<code class="literal">deserialize(json: string): any;</code> deserializes response strings.
</li>
<li class="listitem">
<code class="literal">ndserialize(array: any[]): string;</code> serializes bulk request objects.
</li>
<li class="listitem">
<code class="literal">qserialize(object: any): string;</code> serializes request query parameters.
</li>
</ul>
</div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { Client, Serializer } = require('@elastic/elasticsearch')

class MySerializer extends Serializer {
  serialize (object) {
    // your code
  }
}

const client = new Client({
  Serializer: MySerializer
})</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="changelog-client.html">« Changelog</a>
</span>
<span class="next">
<a href="api-reference.html">API Reference »</a>
</span>
</div>
</div>
</body>
</html>
