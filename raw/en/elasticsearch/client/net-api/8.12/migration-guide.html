<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Migration guide: From NEST v7 to .NET Client v8 | Elasticsearch .NET Client [8.12] | Elastic</title>
<meta class="elastic" name="content" content="Migration guide: From NEST v7 to .NET Client v8 | Elasticsearch .NET Client [8.12]">

<link rel="home" href="index.html" title="Elasticsearch .NET Client [8.12]"/>
<link rel="up" href="usage.html" title="Using the .NET Client"/>
<link rel="prev" href="examples.html" title="CRUD usage examples"/>
<link rel="next" href="troubleshooting.html" title="Troubleshooting"/>
<meta class="elastic" name="product_version" content="8.12"/>
<meta class="elastic" name="product_name" content="Clients"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Clients/.Net/8.12"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="8.12"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="examples.html">« CRUD usage examples</a>
</span>
<span class="next">
<a href="troubleshooting.html">Troubleshooting »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch .NET Client [8.12]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="usage.html">Using the .NET Client</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Migration guide: From NEST v7 to .NET Client v8</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="migration-guide"></a>Migration guide: From NEST v7 to .NET Client v8</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
</div></div></div>
<p>The following migration guide explains the current state of the client, missing
features, breaking changes and our rationale for some of the design choices we have introduced.</p>
<div class="position-relative"><h3><a id="_version_8_is_a_refresh"></a>Version 8 is a refresh</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is important to highlight that v8 of the Elasticsearch .NET Client represents
a new start for the client design. It is important to review how this may affect
your code and usage.</p>
</div>
</div>
<p>Mature code becomes increasingly hard to maintain over time.
Major releases allow us to simplify and better align our language clients with
each other in terms of design. It is crucial to find the right balance
between uniformity across programming languages and the idiomatic concerns of
each language. For .NET, we typically compare and contrast with <a href="https://github.com/elastic/elasticsearch-java" class="ulink" target="_top">Java</a> and <a href="https://github.com/elastic/go-elasticsearch" class="ulink" target="_top">Go</a>
to make sure that our approach is equivalent for each of these. We also take
heavy inspiration from Microsoft framework design guidelines and the conventions
of the wider .NET community.</p>
<div class="position-relative"><h4><a id="_new_elastic_clients_elasticsearch_nuget_package"></a>New Elastic.Clients.Elasticsearch NuGet package</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>We have shipped the new code-generated client as a
<a href="https://www.nuget.org/packages/Elastic.Clients.Elasticsearch/" class="ulink" target="_top">NuGet package</a>
with a new root namespace, <code class="literal">Elastic.Clients.Elasticsearch</code>.
The v8 client is built upon the foundations of the v7 <code class="literal">NEST</code> client, but there
are changes. By shipping as a new package, the expectation is that migration can
be managed with a phased approach.</p>
<p>While this is a new package, we have aligned the major version (v8.x.x) with the
supported Elasticsearch server version to clearly indicate the client/server compatibility.
The v8 client is designed to work with version 8 of Elasticsearch.</p>
<p>The v7 <code class="literal">NEST</code> client continues to be supported but will not gain new features or
support for new Elasticsearch endpoints. It should be considered deprecated in favour of
the new client.</p>
<div class="position-relative"><h4><a id="_limited_feature_set"></a>Limited feature set</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>The version 8 Elasticsearch .NET Client does not have feature parity with the previous v7 <code class="literal">NEST</code>
high-level client.</p>
</div>
</div>
<p>If a feature you depend on is missing (and not explicitly documented below as a
feature that we do not plan to reintroduce), open <a href="https://github.com/elastic/elasticsearch-net/issues/new/choose" class="ulink" target="_top">an issue</a>
or comment on a relevant existing issue to highlight your need to us. This will
help us prioritise our roadmap.</p>
<div class="position-relative"><h3><a id="_code_generation"></a>Code generation</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>Given the size of the Elasticsearch API surface today, it is no longer practical
to maintain thousands of types (requests, responses, queries, aggregations, etc.)
by hand. To ensure consistent, accurate, and timely alignment between language
clients and Elasticsearch, the 8.x clients, and many of the associated types are now
automatically code-generated from a <a href="https://github.com/elastic/elasticsearch-specification" class="ulink" target="_top">shared specification</a>. This is a common solution to maintaining alignment between
client and server among SDKs and libraries, such as those for Azure, AWS and the
Google Cloud Platform.</p>
<p>Code-generation from a specification has inevitably led to some differences
between the existing v7 <code class="literal">NEST</code> types and those available in the new v7 Elasticsearch .NET Client.
For version 8, we generate strictly from the specification, special
casing a few areas to improve usability or to align with language idioms.</p>
<p>The base type hierarchy for concepts such as <code class="literal">Properties</code>, <code class="literal">Aggregations</code> and
<code class="literal">Queries</code> is no longer present in generated code, as these arbitrary groupings do
not align with concrete concepts of the public server API. These considerations
do not preclude adding syntactic sugar and usability enhancements to types in future
releases on a case-by-case basis.</p>
<div class="position-relative"><h3><a id="_elastic_transport"></a>Elastic.Transport</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>The .NET client includes a transport layer responsible for abstracting HTTP
concepts and to provide functionality such as our request pipeline. This
supports round-robin load-balancing of requests to nodes, pinging failed
nodes and sniffing the cluster for node roles.</p>
<p>In v7, this layer shipped as <code class="literal">Elasticsearch.Net</code> and was considered our low-level
client which could be used to send and receive raw JSON bytes between the client
and server.</p>
<p>As part of the work for 8.0.0, we have moved the transport layer out into
a <a href="https://www.nuget.org/packages/Elastic.Transport" class="ulink" target="_top">new dedicated package</a> and
<a href="https://github.com/elastic/elastic-transport-net" class="ulink" target="_top">repository</a>, named
<code class="literal">Elastic.Transport</code>. This supports reuse across future clients and allows
consumers with extremely high-performance requirements to build upon this foundation.</p>
<div class="position-relative"><h3><a id="_system_text_json_for_serialization"></a>System.Text.Json for serialization</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>The v7 <code class="literal">NEST</code> high-level client used an internalized and modified version of
<a href="https://github.com/neuecc/Utf8Json" class="ulink" target="_top">Utf8Json</a> for request and response
serialization. This was introduced for its performance improvements
over <a href="https://www.newtonsoft.com/json" class="ulink" target="_top">Json.NET</a>, the more common JSON framework at
the time.</p>
<p>While Utf8Json provides good value, we have identified minor bugs and
performance issues that have required maintenance over time. Some of these
are hard to change without more significant effort. This library is no longer
maintained, and any such changes cannot easily be contributed back to the
original project.</p>
<p>With .NET Core 3.0, Microsoft shipped new <a href="https://devblogs.microsoft.com/dotnet/try-the-new-system-text-json-apis" class="ulink" target="_top">System.Text.Json APIs</a>
that are included in-the-box with current versions of .NET. We have adopted
<code class="literal">System.Text.Json</code> for all serialization. Consumers can still define and register
their own <code class="literal">Serializer</code> implementation for their document types should they prefer
to use a different serialization library.</p>
<p>By adopting <code class="literal">System.Text.Json</code>, we now depend on a well-maintained and supported
library from Microsoft. <code class="literal">System.Text.Json</code> is designed from the ground up to support
the latest performance optimizations in .NET and, as a result, provides both fast and low-allocation serialization.</p>
<div class="position-relative"><h3><a id="_mockability_of_elasticsearchclient"></a>Mockability of ElasticsearchClient</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>Testing code is an important part of software development. We recommend
that consumers prefer introducing an abstraction for their use of the Elasticsearch .NET Client
as the prefered way to decouple consuming code from client types and support unit
testing.</p>
<p>To support user testing scenarios, we have unsealed the <code class="literal">ElasticsearchClient</code>
type and made its methods virtual. This supports mocking the type directly for unit
testing. This is an improvement over the original <code class="literal">IElasticClient</code> interface from
<code class="literal">NEST</code> (v7) which only supported mocking of top-level client methods.</p>
<p>We have also introduced a <code class="literal">TestableResponseFactory</code> in <code class="literal">Elastic.Transport</code> to
make it easier to create response instances with specific status codes and validity
that can be used during unit testing.</p>
<p>These changes are in addition to our existing support for testing with an
<code class="literal">InMemoryConnection</code>, virtualized clusters and with our
<a href="https://github.com/elastic/elasticsearch-net-abstractions/blob/master/src/Elastic.Elasticsearch.Managed" class="ulink" target="_top"><code class="literal">Elastic.Elasticsearch.Managed</code></a> library for integration
testing against real Elasticsearch instances.</p>
<div class="position-relative"><h3><a id="_migrating_to_elastic_clients_elasticsearch"></a>Migrating to Elastic.Clients.Elasticsearch</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>The version 8 client does not currently have full-feature parity with <code class="literal">NEST</code>. The
client primary use case is for application developers communicating with Elasticsearch.</p>
</div>
</div>
<p>The version 8 client focuses on core endpoints, more specifically for common CRUD
scenarios. The intention is to reduce the feature gap in subsequent versions. Review this documentation carefully to learn about the missing features and reduced API surface details before migrating from the v7 <code class="literal">NEST</code> client!</p>
<p>The choice to code-generate a new evolution of the Elasticsearch .NET Client introduces some
significant breaking changes.</p>
<p>The v8 client is shipped as a new <a href="https://www.nuget.org/packages/Elastic.Clients.Elasticsearch/" class="ulink" target="_top">NuGet package</a>
which can be installed alongside v7 <code class="literal">NEST</code>. Some consumers may prefer a phased migration with both
packages side-by-side for a short period of time to manage complex migrations. In addition, <code class="literal">NEST</code> 7.17.x can continue to be used in
<a href="/guide/en/elasticsearch/client/net-api/7.17/connecting-to-elasticsearch-v8.html" class="ulink" target="_top">compatibility mode</a>
with Elasticsearch 8.x servers until the v8 Elasticsearch .NET Client features
align with application requirements.</p>
<div class="position-relative"><h3><a id="_breaking_changes"></a>Breaking Changes</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>As a result of code-generating a majority of the client types, version 8 of
the client includes multiple breaking changes.</p>
</div>
</div>
<p>We have strived to keep the core foundation reasonably similar, but types emitted
through code-generation are subject to change between <code class="literal">NEST</code> (v7) and the new
<code class="literal">Elastic.Clients.Elasticsearch</code> (v8) package.</p>
<div class="position-relative"><h4><a id="_namespaces"></a>Namespaces</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>The package and top-level namespace for the v8 client have been renamed to
<code class="literal">Elastic.Clients.Elasticsearch</code>. All types belong to this namespace. When
necessary, to avoid potential conflicts, types are generated into suitable
sub-namespaces based on the <a href="https://github.com/elastic/elasticsearch-specification" class="ulink" target="_top">Elasticsearch specification</a>. Additional <code class="literal">using</code> directives may be required to access such types
when using the Elasticsearch .NET Client.</p>
<p>Transport layer concepts have moved to the new <code class="literal">Elastic.Transport</code> NuGet package
and related types are defined under its namespace. Some configuration and low-level transport functionality may require a <code class="literal">using</code> directive for the <code class="literal">Elastic.Transport</code>
namespace.</p>
<div class="position-relative"><h4><a id="_type_names"></a>Type names</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>Type names may have changed from previous versions. These are not listed explicitly due to the potentially vast number of subtle differences.
Type names will now more closely align to those used in the JSON and as documented
in the Elasticsearch documentation.</p>
<div class="position-relative"><h4><a id="_class_members"></a>Class members</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>Types may include renamed properties based on the Elasticsearch specification,
which differ from the original <code class="literal">NEST</code> property names. The types used for properties
may also have changed due to code-generation. If you identify missing or
incorrectly-typed properties, please open <a href="https://github.com/elastic/elasticsearch-net/issues/new/choose" class="ulink" target="_top">an issue</a> to alert us.</p>
<div class="position-relative"><h4><a id="_sealing_classes"></a>Sealing classes</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>Opinions on "sealing by default" within the .NET ecosystem tend to be quite
polarized. Microsoft seal all internal types for potential performance gains
and we see a benefit in starting with that approach for the Elasticsearch .NET Client,
even for our public API surface.</p>
<p>While it prevents inheritance and, therefore, may inhibit a few consumer scenarios,
sealing by default is intended to avoid the unexpected or invalid
extension of types that could inadvertently be broken in the future.</p>
<div class="position-relative"><h4><a id="_removed_features"></a>Removed features</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>As part of the clean-slate redesign of the new client,
certain features are removed from the v8.0 client. These are listed below:</p>
<div class="position-relative"><h5><a id="_attribute_mappings"></a>Attribute mappings</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>In previous versions of the <code class="literal">NEST</code> client, attributes could be used to configure
the mapping behaviour and inference for user types. It is recommended that
mapping be completed via the fluent API when configuring client instances.
<code class="literal">System.Text.Json</code> attributes may be used to rename
and ignore properties during source serialization.</p>
<div class="position-relative"><h5><a id="_cat_apis"></a>CAT APIs</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>The <a href="/guide/en/elasticsearch/reference/current/cat.html" class="ulink" target="_top">CAT APIs</a>
of Elasticsearch are intended for human-readable usage and will no longer be supported
via the v8 Elasticsearch .NET Client.</p>
<div class="position-relative"><h5><a id="_interface_removal"></a>Interface removal</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>Several interfaces are removed to simplify the library and avoid interfaces where only a
single implementation of that interface is expected to exist, such as
<code class="literal">IElasticClient</code> in <code class="literal">NEST</code>. Abstract base classes are preferred
over interfaces across the library, as this makes it easier to add enhancements
without introducing breaking changes for derived types.</p>
<div class="position-relative"><h4><a id="_missing_features"></a>Missing features</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>The following are some of the main features which
have not been re-implemented for the v8 client.
These might be reviewed and prioritized for inclusion in
future releases.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Query DSL operators for combining queries.
</li>
<li class="listitem">
Scroll Helper.
</li>
<li class="listitem">
Fluent API for union types.
</li>
<li class="listitem">
<code class="literal">AutoMap</code> for field datatype inference.
</li>
<li class="listitem">
Visitor pattern support for types such as <code class="literal">Properties</code>.
</li>
<li class="listitem">
Support for <code class="literal">JoinField</code> which affects <code class="literal">ChildrenAggregation</code>.
</li>
<li class="listitem">
Conditionless queries.
</li>
<li class="listitem">
DiagnosticSources have been removed in <code class="literal">Elastic.Transport</code> to provide a clean-slate
for an improved diagnostics story. The Elasticsearch .NET Client emits <a href="https://opentelemetry.io/" class="ulink" target="_top">OpenTelemetry</a> compatible <code class="literal">Activity</code> spans which can be consumed by APM agents such as the <a href="/guide/en/apm/agent/dotnet/current/index.html" class="ulink" target="_top">Elastic APM Agent for .NET</a>.
</li>
<li class="listitem">
Documentation is a work in progress, and we will expand on the documented scenarios
in future releases.
</li>
</ul>
</div>
<div class="position-relative"><h3><a id="_reduced_api_surface"></a>Reduced API surface</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>In the current versions of the code-generated .NET client, supporting commonly used
endpoints is critical. Some specific queries and aggregations need further work to generate code correctly,
hence they are not included yet.
Ensure that the features you are using are currently supported before migrating.</p>
<p>An up to date list of all supported and unsupported endpoints can be found on <a href="https://github.com/elastic/elasticsearch-net/issues/7890" class="ulink" target="_top">GitHub</a>.</p>
<div class="position-relative"><h3><a id="_workarounds_for_missing_features"></a>Workarounds for missing features</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-net/edit/8.12/docs/migration-guide.asciidoc">edit</a></div>
<p>If you encounter a missing feature with the v8 client, there are several ways to temporarily work around this issue until we officially reintroduce the feature.</p>
<p><code class="literal">NEST</code> 7.17.x can continue to be used in
<a href="/guide/en/elasticsearch/client/net-api/7.17/connecting-to-elasticsearch-v8.html" class="ulink" target="_top">compatibility mode</a>
with Elasticsearch 8.x servers until the v8 Elasticsearch .NET Client features
align with application requirements.</p>
<p>As a last resort, the low-level client <code class="literal">Elastic.Transport</code> can be used to create any desired request by hand:</p>
<div class="pre_wrapper lang-csharp">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-csharp">var body = """
	{
	  "name": "my-api-key",
	  "expiration": "1d",
	  "...": "..."
	}
	""";

var response = await client.Transport.RequestAsync&lt;StringResponse&gt;(HttpMethod.POST, "/_security/api_key", PostData.String(body));</pre>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="examples.html">« CRUD usage examples</a>
</span>
<span class="next">
<a href="troubleshooting.html">Troubleshooting »</a>
</span>
</div>
</body>
</html>
