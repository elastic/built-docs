<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configuration | Elasticsearch-PHP [0.4] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch-PHP [0.4]"/>
<link rel="up" href="index.html" title="Elasticsearch-PHP [0.4]"/>
<link rel="prev" href="_installation_2.html" title="Installation"/>
<link rel="next" href="_index_operations.html" title="Index Operations"/>
<meta name="DC.type" content="Learn/Docs/Clients/PHP/0.4"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="0.4"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch-PHP [0.4]</a></span>
»
<span class="breadcrumb-node">Configuration</span>
</div>
<div class="navheader">
<span class="prev">
<a href="_installation_2.html">« Installation</a>
</span>
<span class="next">
<a href="_index_operations.html">Index Operations »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="_configuration"></a>Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/configuration.asciidoc">edit</a></h1>
</div></div></div>
<p>Almost every aspect of the client is configurable.  The client is built around <a href="http://pimple.sensiolabs.org" class="ulink" target="_top">Pimple</a> a light-weight dependency injection container.  Most users will only need to configure a few parameters to suit their needs.</p>
<p>However, since the container also controls all object instantiation, it is possible for users to completely change the internal components used by the client.  A user could, for example, write a custom ConnectionPool class and use that instead of the default connection pools that ship with the client</p>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_example_configuring_the_hosts"></a>Example: Configuring the Hosts<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/configuration.asciidoc">edit</a></h2>
</div></div></div>
<p>A common operation will be telling the client what nodes are in your cluster.  By default, the client will connect to <em>localhost:9200</em>, which obviously doesn&#8217;t work in many production environments.</p>
<p>All configurations (both simple parameters and more advanced component-replacement) are injected into the constructor of the client.</p>
<p>The client accepts an array of hosts that you would like to connect to.  Each value in the array must be a string (either with or without the port number):</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$params = array();
$params['hosts'] = array (
    '192.168.1.1:9200',         // IP + Port
    '192.168.1.2',              // Just IP
    'mydomain.server.com:9201', // Domain + Port
    'mydomain2.server.com'      // Just Domain
);

$client = new Elasticsearch\Client($params);</pre>
</div>
<p>This associative array holds all custom configurations that you may want to set.  Often, you&#8217;ll only need to configure the hosts, but if you need more advanced behavior, read on.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_example_configuring_http_basic_auth"></a>Example: Configuring HTTP Basic Auth<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/configuration.asciidoc">edit</a></h2>
</div></div></div>
<p>HTTP basic authentication is a very common requirement.  To enable Basic Auth in the client, simply set a parameter with the required auth parameters:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$params = array();
$params['connectionParams']['auth'] = array(
    'username',
    'password',
    'Basic' <a id="CO1-1"></a><i class="conum" data-value="1"></i>
);
$client = new Elasticsearch\Client($params);</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Accepts four different options: <code class="literal">Basic</code>, <code class="literal">Digets</code>, <code class="literal">NTLM</code>, <code class="literal">Any</code></p>
</td>
</tr>
</table>
</div>
<p>After being initialized with authentication credentials, all outgoing requests will automatically include the HTTP auth headers.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_example_configuring_the_logger"></a>Example: Configuring the Logger<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/configuration.asciidoc">edit</a></h2>
</div></div></div>
<p>By default, logging in the client is disabled for performance reasons.  If you wish to enable logging, simply set the <code class="literal">logging</code> parameter to true:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$params = array();
$params['logging'] = true;
$client = new Elasticsearch\Client($params);</pre>
</div>
<p>&#8203;<br></p>
<p>This will enable logging to a file called <code class="literal">elasticsearch.log</code> inside your project directory.  The default logging level is <code class="literal">WARN</code>.  This is a logging level
that only describes important events that should probably require action from you.</p>
<p>Often, you&#8217;ll want to change the logging location.  To change this location, simply do the following:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$params = array();
$params['logging'] = true;
$params['logPath'] = '/var/logs/elasticsearch/elasticsearch.log';
$client = new Elasticsearch\Client($params);</pre>
</div>
<p>&#8203;<br></p>
<p>Not all parameters are strings.  For example, we can change the logging level of the client:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$params = array();
$params['logging']  = true;
$params['logPath']  = '/var/logs/elasticsearch/elasticsearch.log';
$params['logLevel'] = Psr\Log\LogLevel::INFO;
$client = new Elasticsearch\Client($params);</pre>
</div>
<p>&#8203;<br></p>
<p>Easy, right?  Let&#8217;s get a little more complicated and specify a custom logger.  By default, the client uses a file-based logger provided by the <a href="https://github.com/Seldaek/monolog" class="ulink" target="_top">Monolog</a> framework.  Monolog provides a variety of loggers.</p>
<p>Let&#8217;s log to the SysLog instead of a file:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">use Monolog\Logger;

// Build a Monolog logger that uses the SyslogHandler
$logger    = new Logger('log');
$handler   = new SyslogHandler('my_user');
$processor = new IntrospectionProcessor();

$logger-&gt;pushHandler($handler);
$logger-&gt;pushProcessor($processor);

// Over-ride the client's logger object with your own
$params['logging']   = true;
$params['logObject'] = $logger;
$client = new Elasticsearch\Client($params);</pre>
</div>
<p>&#8203;<br></p>
<p>The client uses the generic <a href="https://github.com/php-fig/log" class="ulink" target="_top">PSR\Log interface</a>, which means that any PSR\Log compatible loggers will work just fine in the client.
Replacing the logger with another PSR\Log compatible logger is similar to the previous example of configuring a Monolog logger:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">use Monolog\Logger;

$logger = new MySpecialPSRLogger();


$params['logging'] = true;
$params['logObject'] = $logger;
$client = new Elasticsearch\Client($params);</pre>
</div>
<p>&#8203;<br></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_example_configuring_the_selector_class"></a>Example: Configuring the Selector Class<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/configuration.asciidoc">edit</a></h2>
</div></div></div>
<p>When we changed the logger object, we provided a complete object that we wanted to over-ride the default with.  There are many configurations where this won&#8217;t work.  For example, the Connection class must be instantiated repeatedly when new connections are made.</p>
<p>Rather than provide an anonymous function or callback which builds new objects, the client simply accepts a class path which is used to build new objects.</p>
<p>Let&#8217;s configure the Selector class.  By default, the client uses a Round-Robin selector (called RoundRobinSelector, unsurprisingly).  This will select connections in a loop, evenly distributing requests against your whole cluster.</p>
<p>Let&#8217;s change it to a different Selector - the RandomSelector:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$params['selectorClass'] = '\Elasticsearch\ConnectionPool\Selectors\RandomSelector';
$client = new Elasticsearch\Client($params);</pre>
</div>
<p>&#8203;<br></p>
<p>The client will now query random nodes.  Let&#8217;s go one step further and define our own selector, using custom business logic that is specific to your domain.  Most configurable components in the client adhere to an interface, which makes it easy to swap them out for your own class.</p>
<p>Let&#8217;s make a selector that only chooses the first connection.  This is obviously not a good selector (!!!), but it demonstrates the concept well:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">namespace MyProject\Selectors;

use Elasticsearch\Connections\ConnectionInterface;
use Elasticsearch\ConnectionPool\Selectors\SelectorInterface

class FirstSelector implements SelectorInterface
{

    /**
     * Selects the first connection
     *
     * @param array $connections Array of Connection objects
     *
     * @return ConnectionInterface
     */
    public function select($connections)
    {
        return $connections[0];
    }

}</pre>
</div>
<p>&#8203;<br></p>
<p>And now we can specify that when creating the client:</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$params['selectorClass'] = '\MyProject\Selectors\FirstSelector';
$client = new Elasticsearch\Client($params);</pre>
</div>
<p>&#8203;<br></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_full_list_of_configurations"></a>Full list of configurations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/configuration.asciidoc">edit</a></h2>
</div></div></div>
<p><strong>Default Configurations.</strong></p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">$paramDefaults = array(
    'connectionClass'       =&gt; '\Elasticsearch\Connections\GuzzleConnection',
    'connectionFactoryClass'=&gt; '\Elasticsearch\Connections\ConnectionFactory',
    'connectionPoolClass'   =&gt; '\Elasticsearch\ConnectionPool\StaticNoPingConnectionPool',
    'selectorClass'         =&gt; '\Elasticsearch\ConnectionPool\Selectors\RoundRobinSelector',
    'serializerClass'       =&gt; '\Elasticsearch\Serializers\ArrayToJSONSerializer',
    'sniffOnStart'          =&gt; false,
    'connectionParams'      =&gt; array(),
    'logging'               =&gt; false,
    'logObject'             =&gt; null,
    'logPath'               =&gt; 'elasticsearch.log',
    'logLevel'              =&gt; Log\LogLevel::WARNING,
    'traceObject'           =&gt; null,
    'tracePath'             =&gt; 'elasticsearch.log',
    'traceLevel'            =&gt; Log\LogLevel::WARNING,
    'guzzleOptions'         =&gt; array(),
    'connectionPoolParams'  =&gt; array(
        'randomizeHosts' =&gt; true
    ),
    'retries'               =&gt; null
);</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="_installation_2.html">« Installation</a>
</span>
<span class="next">
<a href="_index_operations.html">Index Operations »</a>
</span>
</div>
</div>
</body>
</html>
