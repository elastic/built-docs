<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Using OpenTelemetry | Elasticsearch Python Client [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Using OpenTelemetry | Elasticsearch Python Client [8.15]">

<link rel="home" href="index.html" title="Elasticsearch Python Client [8.15]"/>
<link rel="up" href="integrations.html" title="Integrations"/>
<link rel="prev" href="integrations.html" title="Integrations"/>
<link rel="next" href="esql-pandas.html" title="ES|QL and Pandas"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Clients"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Clients/Python/8.15"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="integrations.html">« Integrations</a>
</span>
<span class="next">
<a href="esql-pandas.html">ES|QL and Pandas »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Python Client [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="integrations.html">Integrations</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Using OpenTelemetry</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.15/docs/guide/open-telemetry.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="opentelemetry"></a>Using OpenTelemetry<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.15/docs/guide/open-telemetry.asciidoc">edit</a></h2>
</div></div></div>
<p>You can use <a href="https://opentelemetry.io/" class="ulink" target="_top">OpenTelemetry</a> to monitor the performance and behavior of your Elasticsearch requests through the Elasticsearch Python client.
The Python client comes with built-in OpenTelemetry instrumentation that emits <a href="/guide/en/apm/guide/current/apm-distributed-tracing.html" class="ulink" target="_top">distributed tracing spans</a> by default.
With that, applications using <a href="/blog/manual-instrumentation-of-python-applications-opentelemetry" class="ulink" target="_top">manual OpenTelemetry instrumentation</a> or <a href="/blog/auto-instrumentation-of-python-applications-opentelemetry" class="ulink" target="_top">automatic OpenTelemetry instrumentation</a> are enriched with additional spans that contain insightful information about the execution of the Elasticsearch requests.</p>
<p>The native instrumentation in the Python client follows the <a href="https://opentelemetry.io/docs/specs/semconv/database/elasticsearch/" class="ulink" target="_top">OpenTelemetry Semantic Conventions for Elasticsearch</a>. In particular, the instrumentation in the client covers the logical layer of Elasticsearch requests. A single span per request is created that is processed by the service through the Python client. The following image shows a trace that records the handling of two different Elasticsearch requests: an <code class="literal">info</code> request and a <code class="literal">search</code> request.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/otel-waterfall-without-http.png" alt="Distributed trace with Elasticsearch spans">
</div>
</div>
<p>Usually, OpenTelemetry auto-instrumentation modules come with instrumentation support for HTTP-level communication. In this case, in addition to the logical Elasticsearch client requests, spans will be captured for the physical HTTP requests emitted by the client. The following image shows a trace with both, Elasticsearch spans (in blue) and the corresponding HTTP-level spans (in red) after having installed the ``opentelemetry-instrumentation-urllib3`` package:</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/otel-waterfall-with-http.png" alt="Distributed trace with Elasticsearch spans">
</div>
</div>
<p>Advanced Python client behavior such as nodes round-robin and request retries are revealed through the combination of logical Elasticsearch spans and the physical HTTP spans. The following example shows a <code class="literal">search</code> request in a scenario with two nodes:</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/otel-waterfall-retry.png" alt="Distributed trace with Elasticsearch spans">
</div>
</div>
<p>The first node is unavailable and results in an HTTP error, while the retry to the second node succeeds. Both HTTP requests are subsumed by the logical Elasticsearch request span (in blue).</p>
<h4><a id="_setup_the_opentelemetry_instrumentation"></a>Setup the OpenTelemetry instrumentation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.15/docs/guide/open-telemetry.asciidoc">edit</a></h4>
<p>When using the <a href="https://opentelemetry.io/docs/languages/python/instrumentation/" class="ulink" target="_top">manual Python OpenTelemetry instrumentation</a> or the <a href="https://opentelemetry.io/docs/languages/python/automatic/" class="ulink" target="_top">OpenTelemetry Python agent</a>, the Python client&#8217;s OpenTelemetry instrumentation is enabled by default and uses the global OpenTelemetry SDK with the global tracer provider.
If you&#8217;re getting started with OpenTelemetry instrumentation, the following blog posts have step-by-step instructions to ingest and explore tracing data with the Elastic stack:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/blog/manual-instrumentation-of-python-applications-opentelemetry" class="ulink" target="_top">Manual instrumentation with OpenTelemetry for Python applications</a>
</li>
<li class="listitem">
<a href="/blog/auto-instrumentation-of-python-applications-opentelemetry" class="ulink" target="_top">Automatic instrumentation with OpenTelemetry for Python applications</a>
</li>
</ul>
</div>
<h3><a id="_comparison_with_community_instrumentation"></a>Comparison with community instrumentation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.15/docs/guide/open-telemetry.asciidoc">edit</a></h3>
<p>The <a href="https://opentelemetry-python-contrib.readthedocs.io/en/latest/instrumentation/elasticsearch/elasticsearch.html" class="ulink" target="_top">commmunity OpenTelemetry Elasticsearch instrumentation</a> also instruments the client and sends OpenTelemetry traces, but was developed before the OpenTelemetry Semantic Conventions for Elasticsearch, so the traces attributes are inconsistent with other OpenTelemetry Elasticsearch client instrumentations. To avoid tracing the same requests twice, make sure to use only one instrumentation, either by uninstalling the opentelemetry-instrumentation-elasticsearch Python package or by <a class="xref" href="opentelemetry.html#opentelemetry-config-enable" title="Enable / Disable the OpenTelemetry instrumentation">disabling the native instrumentation</a>.</p>
<h4><a id="_configuring_the_opentelemetry_instrumentation"></a>Configuring the OpenTelemetry instrumentation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.15/docs/guide/open-telemetry.asciidoc">edit</a></h4>
<p>You can configure this OpenTelemetry instrumentation through environment variables.
The following configuration options are available.</p>
<h5><a id="opentelemetry-config-enable"></a>Enable / Disable the OpenTelemetry instrumentation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.15/docs/guide/open-telemetry.asciidoc">edit</a></h5>
<p>With this configuration option you can enable (default) or disable the built-in OpenTelemetry instrumentation.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment Variable</p></td>
<td align="left" valign="top"><p><code class="literal">OTEL_PYTHON_INSTRUMENTATION_ELASTICSEARCH_ENABLED</code></p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_capture_search_request_bodies"></a>Capture search request bodies<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.15/docs/guide/open-telemetry.asciidoc">edit</a></h5>
<p>Per default, the built-in OpenTelemetry instrumentation does not capture request bodies due to data privacy considerations. You can use this option to enable capturing of search queries from the request bodies of Elasticsearch search requests in case you wish to gather this information regardless. The options are to capture the raw search query or not capture it at all.</p>
<p><span class="strong strong"><strong>Default:</strong></span> <code class="literal">omit</code></p>
<p><span class="strong strong"><strong>Valid Options:</strong></span> <code class="literal">omit</code>, <code class="literal">raw</code></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Environment Variable</p></td>
<td align="left" valign="top"><p><code class="literal">OTEL_PYTHON_INSTRUMENTATION_ELASTICSEARCH_CAPTURE_SEARCH_QUERY</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="_overhead"></a>Overhead<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.15/docs/guide/open-telemetry.asciidoc">edit</a></h4>
<p>The OpenTelemetry instrumentation (as any other monitoring approach) may come with a slight overhead on CPU, memory, and/or latency. The overhead may only occur when the instrumentation is enabled (default) and an OpenTelemetry SDK is active in the target application. When the instrumentation is disabled or no OpenTelemetry SDK is active within the target application, monitoring overhead is not expected when using the client.</p>
<p>Even in cases where the instrumentation is enabled and is actively used (by an OpenTelemetry SDK), the overhead is minimal and negligible in the vast majority of cases. In edge cases where there is a noticeable overhead, the <a class="xref" href="opentelemetry.html#opentelemetry-config-enable" title="Enable / Disable the OpenTelemetry instrumentation">instrumentation can be explicitly disabled</a> to eliminate any potential impact on performance.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="integrations.html">« Integrations</a>
</span>
<span class="next">
<a href="esql-pandas.html">ES|QL and Pandas »</a>
</span>
</div>
</body>
</html>
