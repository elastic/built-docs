<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Connecting | Elasticsearch Python Client [8.7] | Elastic</title>
<meta class="elastic" name="content" content="Connecting | Elasticsearch Python Client [8.7]">

<link rel="home" href="index.html" title="Elasticsearch Python Client [8.7]"/>
<link rel="up" href="index.html" title="Elasticsearch Python Client [8.7]"/>
<link rel="prev" href="installation.html" title="Installation"/>
<link rel="next" href="config.html" title="Configuration"/>
<meta class="elastic" name="product_version" content="8.7"/>
<meta class="elastic" name="product_name" content="Clients"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Clients/Python/8.7"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="8.7"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Python Client [8.7]</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="installation.html">« Installation</a>
</span>
<span class="next">
<a href="config.html">Configuration »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="connecting"></a>Connecting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h1>
</div></div></div>
<p>This page contains the information you need to connect the Client with Elasticsearch.</p>
<h3><a id="connect-ec"></a>Connecting to Elastic Cloud<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h3>
<p><a href="/guide/en/cloud/current/ec-getting-started.html" class="ulink" target="_top">Elastic Cloud</a>
is the easiest way to get started with Elasticsearch. When connecting to Elastic Cloud
with the Python Elasticsearch client you should always use the <code class="literal">cloud_id</code>
parameter to connect. You can find this value within the "Manage Deployment"
page after you&#8217;ve created a cluster (look in the top-left if you&#8217;re in Kibana).</p>
<p>We recommend using a Cloud ID whenever possible because your client will be
automatically configured for optimal use with Elastic Cloud including HTTPS and
HTTP compression.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Password for the 'elastic' user generated by Elasticsearch
ELASTIC_PASSWORD = "&lt;password&gt;"

# Found in the 'Manage Deployment' page
CLOUD_ID = "deployment-name:dXMtZWFzdDQuZ2Nw..."

# Create the client instance
client = Elasticsearch(
    cloud_id=CLOUD_ID,
    basic_auth=("elastic", ELASTIC_PASSWORD)
)

# Successful response!
client.info()
# {'name': 'instance-0000000000', 'cluster_name': ...}</pre>
</div>
<h3><a id="connect-self-managed-new"></a>Connecting to a self-managed cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h3>
<p>By default Elasticsearch will start with security features like authentication and TLS
enabled. To connect to the Elasticsearch cluster you&#8217;ll need to configure the Python Elasticsearch
client to use HTTPS with the generated CA certificate in order to make requests
successfully.</p>
<p>If you&#8217;re just getting started with Elasticsearch we recommend reading the documentation
on <a href="/guide/en/elasticsearch/reference/current/settings.html" class="ulink" target="_top">configuring</a>
and
<a href="/guide/en/elasticsearch/reference/current/starting-elasticsearch.html" class="ulink" target="_top">starting Elasticsearch</a>
to ensure your cluster is running as expected.</p>
<p>When you start Elasticsearch for the first time you&#8217;ll see a distinct block like the one
below in the output from Elasticsearch (you may have to scroll up if it&#8217;s been a while):</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">----------------------------------------------------------------
-&gt; Elasticsearch security features have been automatically configured!
-&gt; Authentication is enabled and cluster connections are encrypted.

-&gt;  Password for the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):
  lhQpLELkjkrawaBoaz0Q

-&gt;  HTTP CA certificate SHA-256 fingerprint:
  a52dd93511e8c6045e21f16654b77c9ee0f34aea26d9f40320b531c474676228
...
----------------------------------------------------------------</pre>
</div>
<p>Note down the <code class="literal">elastic</code> user password and HTTP CA fingerprint for the next
sections. In the examples below they will be stored in the variables
<code class="literal">ELASTIC_PASSWORD</code> and <code class="literal">CERT_FINGERPRINT</code> respectively.</p>
<p>Depending on the circumstances there are two options for verifying the HTTPS
connection, either verifying with the CA certificate itself or via the HTTP CA
certificate fingerprint.</p>
<h4><a id="_verifying_https_with_ca_certificates"></a>Verifying HTTPS with CA certificates<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h4>
<p>Using the <code class="literal">ca_certs</code> option is the default way the Python Elasticsearch client verifies
an HTTPS connection.</p>
<p>The generated root CA certificate can be found in the <code class="literal">certs</code> directory in your
Elasticsearch config location (<code class="literal">$ES_CONF_PATH/certs/http_ca.crt</code>). If you&#8217;re running Elasticsearch
in Docker there is
<a href="/guide/en/elasticsearch/reference/current/docker.html" class="ulink" target="_top">additional documentation for retrieving the CA certificate</a>.</p>
<p>Once you have the <code class="literal">http_ca.crt</code> file somewhere accessible pass the path to the
client via <code class="literal">ca_certs</code>:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Password for the 'elastic' user generated by Elasticsearch
ELASTIC_PASSWORD = "&lt;password&gt;"

# Create the client instance
client = Elasticsearch(
    "https://localhost:9200",
    ca_certs="/path/to/http_ca.crt",
    basic_auth=("elastic", ELASTIC_PASSWORD)
)

# Successful response!
client.info()
# {'name': 'instance-0000000000', 'cluster_name': ...}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you don&#8217;t specify <code class="literal">ca_certs</code> or <code class="literal">ssl_assert_fingerprint</code> then the
<a href="https://certifiio.readthedocs.io" class="ulink" target="_top">certifi package</a> will be used for <code class="literal">ca_certs</code> by
default if available.</p>
</div>
</div>
<h4><a id="_verifying_https_with_certificate_fingerprints_python_3_10_or_later"></a>Verifying HTTPS with certificate fingerprints (Python 3.10 or later)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Using this method <span class="strong strong"><strong>requires using Python 3.10 or later</strong></span> and isn&#8217;t
available when using the <code class="literal">aiohttp</code> HTTP client library so can&#8217;t be used with
<code class="literal">AsyncElasticsearch</code>.</p>
</div>
</div>
<p>This method of verifying the HTTPS connection takes advantage of the certificate
fingerprint value noted down earlier. Take this SHA256 fingerprint value and
pass it to the Python Elasticsearch client via <code class="literal">ssl_assert_fingerprint</code>:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Fingerprint either from Elasticsearch startup or above script.
# Colons and uppercase/lowercase don't matter when using
# the 'ssl_assert_fingerprint' parameter
CERT_FINGERPRINT = "A5:2D:D9:35:11:E8:C6:04:5E:21:F1:66:54:B7:7C:9E:E0:F3:4A:EA:26:D9:F4:03:20:B5:31:C4:74:67:62:28"

# Password for the 'elastic' user generated by Elasticsearch
ELASTIC_PASSWORD = "&lt;password&gt;"

client = Elasticsearch(
    "https://localhost:9200",
    ssl_assert_fingerprint=CERT_FINGERPRINT,
    basic_auth=("elastic", ELASTIC_PASSWORD)
)

# Successful response!
client.info()
# {'name': 'instance-0000000000', 'cluster_name': ...}</pre>
</div>
<p>The certificate fingerprint can be calculated using <code class="literal">openssl x509</code> with the
certificate file:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">openssl x509 -fingerprint -sha256 -noout -in /path/to/http_ca.crt</pre>
</div>
<p>If you don&#8217;t have access to the generated CA file from Elasticsearch you can use the
following script to output the root CA fingerprint of the Elasticsearch instance with
<code class="literal">openssl s_client</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh"># Replace the values of 'localhost' and '9200' to the
# corresponding host and port values for the cluster.
openssl s_client -connect localhost:9200 -servername localhost -showcerts &lt;/dev/null 2&gt;/dev/null \
  | openssl x509 -fingerprint -sha256 -noout -in /dev/stdin</pre>
</div>
<p>The output of <code class="literal">openssl x509</code> will look something like this:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">SHA256 Fingerprint=A5:2D:D9:35:11:E8:C6:04:5E:21:F1:66:54:B7:7C:9E:E0:F3:4A:EA:26:D9:F4:03:20:B5:31:C4:74:67:62:28</pre>
</div>
<h3><a id="connect-no-security"></a>Connecting without security enabled<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h3>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Running Elasticsearch without security enabled is not recommended.</p>
</div>
</div>
<p>If your cluster is configured with
<a href="/guide/en/elasticsearch/reference/current/security-settings.html" class="ulink" target="_top">security explicitly disabled</a>
then you can connect via HTTP:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Create the client instance
client = Elasticsearch("http://localhost:9200")

# Successful response!
client.info()
# {'name': 'instance-0000000000', 'cluster_name': ...}</pre>
</div>
<h3><a id="connect-url"></a>Connecting to multiple nodes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h3>
<p>The Python Elasticsearch client supports sending API requests to multiple nodes in the
cluster. This means that work will be more evenly spread across the cluster
instead of hammering the same node over and over with requests. To configure the
client with multiple nodes you can pass a list of URLs, each URL will be used as
a separate node in the pool.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# List of nodes to connect use with different hosts and ports.
NODES = [
    "https://localhost:9200",
    "https://localhost:9201",
    "https://localhost:9202",
]

# Password for the 'elastic' user generated by Elasticsearch
ELASTIC_PASSWORD = "&lt;password&gt;"

client = Elasticsearch(
    NODES,
    ca_certs="/path/to/http_ca.crt",
    basic_auth=("elastic", ELASTIC_PASSWORD)
)</pre>
</div>
<p>By default nodes are selected using round-robin, but alternate node selection
strategies can be configured with <code class="literal">node_selector_class</code> parameter.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your Elasticsearch cluster is behind a load balancer like when using Elastic
Cloud you won&#8217;t need to configure multiple nodes. Instead use the load balancer
host and port.</p>
</div>
</div>
<h3><a id="authentication"></a>Authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h3>
<p>This section contains code snippets to show you how to connect to various Elasticsearch
providers. All authentication methods are supported on the client constructor
or via the per-request <code class="literal">.options()</code> method:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Authenticate from the constructor
es = Elasticsearch(
    "https://localhost:9200",
    ca_certs="/path/to/http_ca.crt",
    basic_auth=("username", "password")
)

# Authenticate via the .options() method:
es.options(
    basic_auth=("username", "password")
).indices.get(index="*")

# You can persist the authenticated client to use
# later or use for multiple API calls:
auth_client = es.options(
    api_key=("api-key-id", "api-key-secret")
)
for i in range(10):
    auth_client.index(
        index="example-index",
        document={"field": i}
    )</pre>
</div>
<h4><a id="auth-basic"></a>HTTP Basic authentication (Username and Password)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h4>
<p>HTTP Basic authentication uses the <code class="literal">basic_auth</code> parameter by passing in a
username and password within a tuple:</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Adds the HTTP header 'Authorization: Basic &lt;base64 username:password&gt;'
es = Elasticsearch(
    "https://localhost:9200",
    ca_certs="/path/to/http_ca.crt",
    basic_auth=("username", "password")
)</pre>
</div>
<h4><a id="auth-bearer"></a>HTTP Bearer authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h4>
<p>HTTP Bearer authentication uses the <code class="literal">bearer_auth</code> parameter by passing the token
as a string. This authentication method is used by
<a href="/guide/en/elasticsearch/reference/8.7/security-api-create-service-token.html" class="ulink" target="_top">Service Account Tokens</a>
and <a href="/guide/en/elasticsearch/reference/8.7/security-api-get-token.html" class="ulink" target="_top">Bearer Tokens</a>.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Adds the HTTP header 'Authorization: Bearer token-value'
es = Elasticsearch(
    "https://localhost:9200",
    bearer_auth="token-value"
)</pre>
</div>
<h4><a id="auth-apikey"></a>API Key authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h4>
<p>You can configure the client to use Elasticsearch&#8217;s API Key for connecting to your
cluster. Note that you need the values of <code class="literal">id</code> and <code class="literal">api_key</code> to
<a href="/guide/en/elasticsearch/reference/current/security-api-create-api-key.html" class="ulink" target="_top">authenticate via an API Key</a>.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Adds the HTTP header 'Authorization: ApiKey &lt;base64 api_key.id:api_key.api_key&gt;'
es = Elasticsearch(
    "https://localhost:9200",
    ca_certs="/path/to/http_ca.crt",
    api_key=("api_key.id", "api_key.api_key")
)</pre>
</div>
<h3><a id="compatibility-mode"></a>Enabling the Compatibility Mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h3>
<p>The Elasticsearch server version 8.0 is introducing a new compatibility mode that allows
you a smoother upgrade experience from 7 to 8. In a nutshell, you can use the
latest 7.x Python Elasticsearch Elasticsearch client with an 8.x Elasticsearch server, giving more room to
coordinate the upgrade of your codebase to the next major version.</p>
<p>If you want to leverage this functionality, please make sure that you are using
the latest 7.x Python Elasticsearch client and set the environment variable
<code class="literal">ELASTIC_CLIENT_APIVERSIONING</code> to <code class="literal">true</code>. The client is handling the rest
internally. For every 8.0 and beyond Python Elasticsearch client, you&#8217;re all set! The
compatibility mode is enabled by default.</p>
<h3><a id="connecting-faas"></a>Using the Client in a Function-as-a-Service Environment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h3>
<p>This section illustrates the best practices for leveraging the Elasticsearch client in a
Function-as-a-Service (FaaS) environment.</p>
<p>The most influential optimization is to initialize the client outside of the
function, the global scope.</p>
<p>This practice does not only improve performance but also enables background
functionality as – for example –
<a href="/blog/elasticsearch-sniffing-best-practices-what-when-why-how" class="ulink" target="_top">sniffing</a>.
The following examples provide a skeleton for the best practices.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The async client shouldn&#8217;t be used within Function-as-a-Service as a new event
           loop must be started for each invocation. Instead the synchronous <code class="literal">Elasticsearch</code>
           client is recommended.</p>
</div>
</div>
<h4><a id="connecting-faas-gcp"></a>GCP Cloud Functions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Client initialization
client = Elasticsearch(
    cloud_id="deployment-name:ABCD...",
    api_key=...
)

def main(request):
    # Use the client
    client.search(index=..., query={"match_all": {}})</pre>
</div>
<h4><a id="connecting-faas-aws"></a>AWS Lambda<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">from elasticsearch import Elasticsearch

# Client initialization
client = Elasticsearch(
    cloud_id="deployment-name:ABCD...",
    api_key=...
)

def main(event, context):
    # Use the client
    client.search(index=..., query={"match_all": {}})</pre>
</div>
<h4><a id="connecting-faas-azure"></a>Azure Functions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-py/edit/8.7/docs/guide/connecting.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">import azure.functions as func
from elasticsearch import Elasticsearch

# Client initialization
client = Elasticsearch(
    cloud_id="deployment-name:ABCD...",
    api_key=...
)

def main(request: func.HttpRequest) -&gt; func.HttpResponse:
    # Use the client
    client.search(index=..., query={"match_all": {}})</pre>
</div>
<p>Resources used to assess these recommendations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://cloud.google.com/functions/docs/bestpractices/tips#use_global_variables_to_reuse_objects_in_future_invocations" class="ulink" target="_top">GCP Cloud Functions: Tips &amp; Tricks</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html" class="ulink" target="_top">Best practices for working with AWS Lambda functions</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-python?tabs=azurecli-linux%2Capplication-level#global-variables" class="ulink" target="_top">Azure Functions Python developer guide</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/lambda/latest/operatorguide/global-scope.html" class="ulink" target="_top">AWS Lambda: Comparing the effect of global scope</a>
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="installation.html">« Installation</a>
</span>
<span class="next">
<a href="config.html">Configuration »</a>
</span>
</div>
</div>
</body>
</html>
