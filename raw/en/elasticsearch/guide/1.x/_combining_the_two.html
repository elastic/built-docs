<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Combining the Two | Elasticsearch: The Definitive Guide [1.x] | Elastic</title>
<meta class="elastic" name="content" content="Combining the Two | Elasticsearch: The Definitive Guide [1.x]">

<link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [1.x]"/>
<link rel="up" href="aggs-high-level.html" title="High-Level Concepts"/>
<link rel="prev" href="_metrics.html" title="Metrics"/>
<link rel="next" href="_aggregation_test_drive.html" title="Aggregation Test-Drive"/>
<meta class="elastic" name="product_version" content="1.x"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Legacy/Elasticsearch/Definitive Guide/1.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="1.x"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<p>
  <strong>WARNING</strong>: The 1.x versions of Elasticsearch have passed their
  <a href="https://www.elastic.co/support/eol">EOL dates</a>. If you are running
  a 1.x version, we strongly advise you to upgrade.
</p>
<p>
  This documentation is no longer maintained and may be removed. For the latest
  information, see the <a
  href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">current
  Elasticsearch documentation</a>.
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide [1.x]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="aggregations.html">Aggregations</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="aggs-high-level.html">High-Level Concepts</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="_metrics.html">« Metrics</a>
</span>
<span class="next">
<a href="_aggregation_test_drive.html">Aggregation Test-Drive »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_combining_the_two"></a>Combining the Two<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/301_Aggregation_Overview.asciidoc">edit</a></h2>
</div></div></div>
<p>An <em>aggregation</em> is a combination of buckets and metrics.  An aggregation may have
a single bucket, or a single metric, or one of each.  It may even have multiple
buckets nested inside other buckets. For example, we can partition documents by which country they belong to (a bucket), and
then calculate the average salary per country (a metric).</p>
<p>Because buckets can be nested, we can derive a much more complex aggregation:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Partition documents by country (bucket).
</li>
<li class="listitem">
Then partition each country bucket by gender (bucket).
</li>
<li class="listitem">
Then partition each gender bucket by age ranges (bucket).
</li>
<li class="listitem">
Finally, calculate the average salary for each age range (metric)
</li>
</ol>
</div>
<p>This will give you the average salary per <code class="literal">&lt;country, gender, age&gt;</code> combination.  All in
one request and with one pass over the data!</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="_metrics.html">« Metrics</a>
</span>
<span class="next">
<a href="_aggregation_test_drive.html">Aggregation Test-Drive »</a>
</span>
</div>
</div>
</body>
</html>
