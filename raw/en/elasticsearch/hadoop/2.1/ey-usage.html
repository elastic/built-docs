<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="Reference documentation of elasticsearch-hadoop">
<title>Usage | Elasticsearch for Apache Hadoop [2.1] | Elastic</title>
<meta class="elastic" name="content" content="Usage | Elasticsearch for Apache Hadoop [2.1]">

<link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop [2.1]"/>
<link rel="up" href="es-yarn.html" title="Elasticsearch on YARN"/>
<link rel="prev" href="ey-setup.html" title="Understanding the YARN environment"/>
<link rel="next" href="reference.html" title="Elasticsearch for Apache Hadoop"/>
<meta class="elastic" name="product_version" content="2.1"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Apache Hadoop/2.1"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="2.1"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<p>
  <strong>WARNING</strong>: Version 2.1 has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div class="navheader">
<span class="prev">
<a href="ey-setup.html">« Understanding the YARN environment</a>
</span>
<span class="next">
<a href="reference.html">Elasticsearch for Apache Hadoop »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop [2.1]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="es-yarn.html">Elasticsearch on YARN</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Usage</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="ey-usage"></a>Usage</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
</div></div></div>
<p>Elasticsearch on YARN allows through the command-line to provision, start, monitor and stop an Elasticsearch cluster inside a YARN environment.</p>
<p>Simply download elasticsearch-yarn-&lt;version&gt;.jar in a location of choice and make sure to have Hadoop/YARN available and configured in your classpath; double check through the <code class="literal">hadoop version</code> command:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop version

Hadoop 2.4.1
Subversion http://svn.apache.org/repos/asf/hadoop/common -r 1604318
Compiled by jenkins on 2014-06-21T05:43Z
Compiled with protoc 2.5.0
From source with checksum bb7ac0a3c73dc131f4844b873c74b630
This command was run using /opt/share/hadoop/common/hadoop-common-2.4.1.jar</pre>
</div>
<p>Once you have confirmed Hadoop is properly configured, do a basic sanity check for Elasticsearch on YARN by invoking <code class="literal">hadoop jar</code>:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar
No command specified
Usage:
     -download-es  : Downloads Elasticsearch.zip
     -install      : Installs/Provisions Elasticsearch-YARN into HDFS
     -install-es   : Installs/Provisions Elasticsearch into HDFS
     -start        : Starts provisioned Elasticsearch in YARN
     -status       : Reports status of Elasticsearch in YARN
     -stop         : Stops Elasticsearch in YARN
     -help         : Prints this help

Configuration options can be specified _after_ each command; see the documentation for more information.</pre>
</div>
<p>Each command should be self-explanatory. The typical usage scenario is:</p>
<div class="position-relative"><h3><a id="yarn-es-download"></a>Download the Elasticsearch version needed</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
<p>This is a <em>one-time</em> action; if you already have Elasticsearch at hand, deploy it under <code class="literal">downloads</code> sub-folder. To wit:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt; -download-es
Downloading Elasticsearch 1.6.0
Downloading ...........................................................................DONE</pre>
</div>
<p>If you want to use a different version of Elasticsearch, you can specify so through the <code class="literal">es.version</code> parameter (see the <a class="xref" href="ey-usage.html#yarn-options" title="Configuration">Configuration</a> section.</p>
<div class="position-relative"><h3><a id="yarn-cfg-es"></a>(Optional) Configuring Elasticsearch</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
<p>If the default Elasticsearch is not suitable, for example certain plugins need to be installed or the storage path needs to be defined as mentioned <a class="xref" href="ey-setup.html#ev-setup-storage" title="Storage">here</a>, one should do so by modifying the Elasticsearch archive as it will serve as the blueprint of <em>all</em> nodes installed within YARN.</p>
<div class="position-relative"><h3><a id="yarn-provision-es"></a>Provision Elasticsearch into HDFS</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
<p>Now that we have downloaded Elasticsearch, let us upload it into HDFS so it becomes available to the Hadoop nodes.
This is another <em>one-time</em> action (as long as your HDFS cluster and the target location remain in place):</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar -install-es

Uploaded /opt/es-yarn/downloads/elasticsearch-&lt;version&gt;.zip to HDFS at hdfs://127.0.0.1:50463/apps/elasticsearch/elasticsearch-&lt;version&gt;.zip</pre>
</div>
<p>This command uploads the <code class="literal">elasticsearch-&lt;version&gt;.zip</code>  (that we just downloaded) to HDFS (based on the Hadoop configuration detected in the classpath) under <code class="literal">/apps/elasticsearch</code> folder. Again the location can be <a class="xref" href="ey-usage.html#yarn-options" title="Configuration">changed</a> if needed.</p>
<p>Note that the uploaded ZIP can be configured accordingly to your setup - for example, one can include her own configuration (such as using a certain storage location) to override the defaults or for example certain plugins.
The zip acts as a template so be sure to include everything that need in it.</p>
<div class="position-relative"><h3><a id="yarn-provision"></a>Provision Elasticsearch-YARN into HDFS</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
<p>Let us do the same <em>one-time</em> command with the Elasticsearch-YARN jar:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar -install

Uploaded opt/es-yarn/elasticsearch-yarn-&lt;version&gt;.jar to HDFS at hdfs://127.0.0.1:50463/apps/elasticsearch/elasticsearch-yarn-&lt;version&gt;.jar</pre>
</div>
<p>You can verify the provisioning by interrogating HDFS either through the web console or <code class="literal">hadoop</code> CLI:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop fs -ls /apps/elasticsearch
Found 2 items
-rw-r--r--   1 hdfs hdfs   30901787 2014-11-13 10:17 /apps/elasticsearch/elasticsearch-&lt;version&gt;.zip
-rw-r--r--   1 hdfs hdfs      52754 2014-11-13 16:16 /apps/elasticsearch/elasticsearch-yarn-&lt;version&gt;.jar</pre>
</div>
<div class="position-relative"><h3><a id="yarn-start"></a>Start Elasticsearch on YARN</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
<p>Once the necessary artifacts are in HDFS, one can start Elasticsearch:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar -start
Launched a 1 node Elasticsearch-YARN cluster [application_1415813090693_0001@http://hadoop:8088/proxy/application_1415921358606_0001/] at Wed Nov 14 19:24:53 EET 2014</pre>
</div>
<p>By default only a single node is created; to start multiple nodes use the <code class="literal">containers</code> parameter (see <a class="xref" href="ey-usage.html#yarn-options" title="Configuration">Configuration</a> for more information):</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar -start containers=2
Launched a 2 nodes Elasticsearch-YARN cluster [application_1415921358606_0006@http://hadoop:8088/proxy/application_1415921358606_0006/] at Wed Nov 14 19:28:46 EET 2014</pre>
</div>
<p>That&#8217;s it!</p>
<div class="position-relative"><h3><a id="yarn-status"></a>Get status of Elasticsearch clusters in YARN</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
<p>There are plenty of tools in Hadoop to check running YARN applications; with Elasticsearch YARN try the <code class="literal">-status</code> command:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar -status
Id                              State       Status     Start Time         Finish Time        Tracking URL
application_1415921358606_0007  RUNNING     UNDEFINED  11/14/14 19:34 PM  N/A                http://hadoop:8088/proxy/application_1415921358606_0007/A</pre>
</div>
<p>If you prefer the web ui, point your browser to the cluster console (typically on port 8088 - <code class="literal"><a href="http://hadoop:8088/cluster" class="ulink" target="_top">http://hadoop:8088/cluster</a></code>) and the newly created Elasticsearch cluster, or rather
its <code class="literal">ApplicationMaster</code> will show up:</p>
<div class="imageblock text-center">
<div class="content">
<img src="yarn/img/yarn-app-list.png" alt="AppManager List">
</div>
</div>
<p>One can inspect the containers manually by checking the container list (typically by accessing the <code class="literal">ApplicationManager</code> UI):</p>
<div class="imageblock text-center">
<div class="content">
<img src="yarn/img/yarn-container-list.png" alt="Container List">
</div>
</div>
<p>You should be able to see the application and the associated containers marked as <code class="literal">RUNNING</code> ; if that is not the case, check out the logs to see what is wrong.</p>
<div class="position-relative"><h3><a id="yarn-stop"></a>Stop Elasticsearch clusters in YARN</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
<p>To shutdown your cluster, use the <code class="literal">-stop</code> command:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar -stop
Stopped Elasticsearch-YARN cluster with id application_1415921358606_0007</pre>
</div>
<div class="position-relative"><h3><a id="yarn-options"></a>Configuration</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/yarn/usage.adoc">edit</a></div>
<p>Elasticsearch on YARN offers various knobs for tweaking its behavior - all can be passed as options after each command, overriding the default configuration. Multiple options can be specified (if you specify the same parameter multiple times, the last one wins):</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar [-command] [option.name]=[option.value] [option.name]=[option.value]</pre>
</div>
<p>The following parameter are available:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">download.local.dir</code> (default ./downloads/)
</span>
</dt>
<dd>
Local folder where Elasticsearch on YARN downloads remote artifacts (like <code class="literal">Elasticsearch.zip</code>)
</dd>
<dt>
<span class="term">
<code class="literal">hdfs.upload.dir</code> (default /apps/elasticsearch/)
</span>
</dt>
<dd>
HDFS folder used for provisioning
</dd>
<dt>
<span class="term">
<code class="literal">es.version</code> (default 1.6.0)
</span>
</dt>
<dd>
Elasticsearch version used for downloading, provisioning HDFS and running on the YARN cluster
</dd>
<dt>
<span class="term">
<code class="literal">containers</code> (default 1)
</span>
</dt>
<dd>
The number of containers or Elasticsearch nodes for starting the cluster
</dd>
<dt>
<span class="term">
<code class="literal">container.mem</code> (default 2048)
</span>
</dt>
<dd>
Memory requested for <em>each</em> YARN container
</dd>
<dt>
<span class="term">
<code class="literal">container.vcores</code> (default 1)
</span>
</dt>
<dd>
CPU cores requested for <em>each</em> YARN container
</dd>
<dt>
<span class="term">
<code class="literal">container.priority</code> (default -1)
</span>
</dt>
<dd>
YARN queue priority for each container
</dd>
<dt>
<span class="term">
<code class="literal">env.&lt;NAME&gt;</code>
</span>
</dt>
<dd>
Pattern for setting up environment variables on each container - each property starting with <code class="literal">env.</code> prefix will be set remotely on <em>each</em> container:
</dd>
</dl>
</div>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar [-command] env.ES_USE_GC_LOGGING=true env.PROP=someValue</pre>
</div>
<p>Sets up on each container two variables <code class="literal">ES_USE_GC_LOGGING</code> and <code class="literal">PROP</code>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">loadConfig</code>
</span>
</dt>
<dd>
Property file to be loaded as configuration. That is, instead of specifying the options in each command, save them to a file and use that instead.
For example the above example, the two options (for setting the container environment variables) can be moved into a properties file
</dd>
</dl>
</div>
<div class="pre_wrapper lang-init">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-init"># extra-cfg.properties
env.ES_USE_GC_LOGGING=true
env.PROP=someValue</pre>
</div>
<p>and tell Elasticsearch on YARN to load it:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ hadoop jar elasticsearch-yarn-&lt;version&gt;.jar [-command] loadConfig=extra-cfg.properties</pre>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ey-setup.html">« Understanding the YARN environment</a>
</span>
<span class="next">
<a href="reference.html">Elasticsearch for Apache Hadoop »</a>
</span>
</div>
</body>
</html>
