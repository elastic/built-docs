<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Using Datetime in Painless | Painless Scripting Language [master] | Elastic</title>
<link rel="home" href="index.html" title="Painless Scripting Language [master]"/>
<link rel="up" href="painless-guide.html" title="Painless Guide"/>
<link rel="prev" href="painless-walkthrough.html" title="A Brief Painless Walkthrough"/>
<link rel="next" href="modules-scripting-painless-dispatch.html" title="How painless dispatches functions"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Painless/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Painless Scripting Language [master]</a></span>
»
<span class="breadcrumb-link"><a href="painless-guide.html">Painless Guide</a></span>
»
<span class="breadcrumb-node">Using Datetime in Painless</span>
</div>
<div class="navheader">
<span class="prev">
<a href="painless-walkthrough.html">« A Brief Painless Walkthrough</a>
</span>
<span class="next">
<a href="modules-scripting-painless-dispatch.html">How painless dispatches functions »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="painless-datetime"></a>Using Datetime in Painless<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_api"></a>Datetime API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Datetimes in Painless use the standard Java libraries and are available through
the Painless <a class="xref" href="painless-api-reference-shared.html" title="Shared API">Shared API</a>. Most of the classes
from the following Java packages are available to use in Painless scripts:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="painless-api-reference-shared-java-time.html" title="Shared API for package java.time">java.time</a>
</li>
<li class="listitem">
<a class="xref" href="painless-api-reference-shared-java-time-chrono.html" title="Shared API for package java.time.chrono">java.time.chrono</a>
</li>
<li class="listitem">
<a class="xref" href="painless-api-reference-shared-java-time-format.html" title="Shared API for package java.time.format">java.time.format</a>
</li>
<li class="listitem">
<a class="xref" href="painless-api-reference-shared-java-time-temporal.html" title="Shared API for package java.time.temporal">java.time.temporal</a>
</li>
<li class="listitem">
<a class="xref" href="painless-api-reference-shared-java-time-zone.html" title="Shared API for package java.time.zone">java.time.zone</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_representation"></a>Datetime Representation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Datetimes in Painless are most commonly represented as a numeric value, a
string value, or a complex value.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
numeric
</span>
</dt>
<dd>
a datetime representation as a number from a starting offset called
an epoch; in Painless this is typically a <a class="xref" href="painless-types.html#primitive-types" title="Primitive Types">long</a> as
milliseconds since an epoch of 1970-01-01 00:00:00 Zulu Time
</dd>
<dt>
<span class="term">
string
</span>
</dt>
<dd>
a datetime representation as a sequence of characters defined by
a standard format or a custom format; in Painless this is typically a
<a class="xref" href="painless-types.html#string-type" title="String Type">String</a> of the standard format
<a href="https://en.wikipedia.org/wiki/ISO_8601" class="ulink" target="_top">ISO 8601</a>
</dd>
<dt>
<span class="term">
complex
</span>
</dt>
<dd>
a datetime representation as a complex type
(<a class="xref" href="painless-types.html#reference-types" title="Reference Types">object</a>) that abstracts away internal details of how the
datetime is stored and often provides utilities for modification and
comparison; in Painless this is typically a
<a class="xref" href="painless-api-reference-shared-java-time.html#painless-api-reference-shared-ZonedDateTime" title="ZonedDateTime">ZonedDateTime</a>
</dd>
</dl>
</div>
<p>Switching between different representations of datetimes is often necessary to
achieve a script&#8217;s objective(s). A typical pattern in a script is to switch a
numeric or string datetime to a complex datetime, modify or compare the complex
datetime, and then switch it back to a numeric or string datetime for storage
or to return a result.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_parsing_and_formatting"></a>Datetime Parsing and Formatting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Datetime parsing is a switch from a string datetime to a complex datetime, and
datetime formatting is a switch from a complex datetime to a string datetime.</p>
<p>A <a class="xref" href="painless-api-reference-shared-java-time-format.html#painless-api-reference-shared-DateTimeFormatter" title="DateTimeFormatter">DateTimeFormatter</a> is a
complex type (<a class="xref" href="painless-types.html#reference-types" title="Reference Types">object</a>) that defines the allowed sequence
of characters for a string datetime. Datetime parsing and formatting often
require a DateTimeFormatter. For more information about how to use a
DateTimeFormatter see the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html" class="ulink" target="_top">Java documentation</a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_parsing_examples"></a>Datetime Parsing Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>parse from milliseconds</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">String milliSinceEpochString = "434931330000";
long milliSinceEpoch = Long.parseLong(milliSinceEpochString);
Instant instant = Instant.ofEpochMilli(milliSinceEpoch);
ZonedDateTime zdt = ZonedDateTime.ofInstant(instant, ZoneId.of('Z'));</pre>
</div>
</li>
<li class="listitem">
<p>parse from ISO 8601</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">String datetime = '1983-10-13T22:15:30Z';
ZonedDateTime zdt = ZonedDateTime.parse(datetime); <a id="CO1-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the parse method uses ISO 8601 by default.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>parse from RFC 1123</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">String datetime = 'Thu, 13 Oct 1983 22:15:30 GMT';
ZonedDateTime zdt = ZonedDateTime.parse(datetime,
        DateTimeFormatter.RFC_1123_DATE_TIME); <a id="CO2-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO2-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the use of a built-in DateTimeFormatter.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>parse from a custom format</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">String datetime = 'custom y 1983 m 10 d 13 22:15:30 Z';
DateTimeFormatter dtf = DateTimeFormatter.ofPattern(
        "'custom' 'y' yyyy 'm' MM 'd' dd HH:mm:ss VV");
ZonedDateTime zdt = ZonedDateTime.parse(datetime, dtf); <a id="CO3-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO3-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the use of a custom DateTimeFormatter.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_formatting_examples"></a>Datetime Formatting Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>format to ISO 8601</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
String datetime = zdt.format(DateTimeFormatter.ISO_INSTANT); <a id="CO4-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO4-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the use of a built-in DateTimeFormatter.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>format to a custom format</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
DateTimeFormatter dtf = DateTimeFormatter.ofPattern(
        "'date:' yyyy/MM/dd 'time:' HH:mm:ss");
String datetime = zdt.format(dtf); <a id="CO5-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO5-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the use of a custom DateTimeFormatter.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_conversion"></a>Datetime Conversion<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Datetime conversion is a switch from a numeric datetime to a complex datetime
and vice versa.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_conversion_examples"></a>Datetime Conversion Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>convert from milliseconds</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">long milliSinceEpoch = 434931330000L;
Instant instant = Instant.ofEpochMilli(milliSinceEpoch);
ZonedDateTime zdt = ZonedDateTime.ofInstant(instant, ZoneId.of('Z'));</pre>
</div>
</li>
<li class="listitem">
<p>convert to milliseconds</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
long milliSinceEpoch = zdt.toInstant().toEpochMilli();</pre>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_pieces"></a>Datetime Pieces<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Datetime representations often contain the data to extract individual datetime
pieces such as year, hour, timezone, etc. Use individual pieces of a datetime
to create a complex datetime, and use a complex datetime to extract individual
pieces.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_pieces_examples"></a>Datetime Pieces Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>create a complex datetime from pieces</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">int year = 1983;
int month = 10;
int day = 13;
int hour = 22;
int minutes = 15;
int seconds = 30;
int nanos = 0;
ZonedDateTime zdt = ZonedDateTime.of(
        year, month, day, hour, minutes, seconds, nanos, ZoneId.of('Z'));</pre>
</div>
</li>
<li class="listitem">
<p>extract pieces from a complex datetime</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 100, ZoneId.of(tz));
int year = zdt.getYear();
int month = zdt.getMonthValue();
int day = zdt.getDayOfMonth();
int hour = zdt.getHour();
int minutes = zdt.getMinute();
int seconds = zdt.getSecond();
int nanos = zdt.getNano();</pre>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_modification"></a>Datetime Modification<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Use either a numeric datetime or a complex datetime to do modification such as
adding several seconds to a datetime or subtracting several days from a
datetime. Use standard <a class="xref" href="painless-operators-numeric.html" title="Operators: Numeric">numeric operators</a> to
modify a numeric datetime. Use
<a class="xref" href="painless-api-reference-shared-java-time.html#painless-api-reference-shared-ZonedDateTime" title="ZonedDateTime">methods</a> (or fields) to modify
a complex datetime. Note many complex datetimes are immutable so upon
modification a new complex datetime is created that requires
<a class="xref" href="painless-variables.html#variable-assignment" title="Assignment">assignment</a> or immediate use.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_modification_examples"></a>Datetime Modification Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Subtract three seconds from a numeric datetime in milliseconds</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">long milliSinceEpoch = 434931330000L;
milliSinceEpoch = milliSinceEpoch - 1000L*3L;</pre>
</div>
</li>
<li class="listitem">
<p>Add three days to a complex datetime</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime updatedZdt = zdt.plusDays(3);</pre>
</div>
</li>
<li class="listitem">
<p>Subtract 125 minutes from a complex datetime</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime updatedZdt = zdt.minusMinutes(125);</pre>
</div>
</li>
<li class="listitem">
<p>Set the year on a complex datetime</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime updatedZdt = zdt.withYear(1976);</pre>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_difference_elapsed_time"></a>Datetime Difference (Elapsed Time)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Use either two numeric datetimes or two complex datetimes to calculate the
difference (elapsed time) between two different datetimes. Use
<a class="xref" href="painless-operators-numeric.html#subtraction-operator" title="Subtraction">subtraction</a> to calculate the difference between two
numeric datetimes of the same time unit such as milliseconds. For
complex datetimes there is often a method or another complex type
(<a class="xref" href="painless-types.html#reference-types" title="Reference Types">object</a>) available to calculate the difference. Use
<a class="xref" href="painless-api-reference-shared-java-time-temporal.html#painless-api-reference-shared-ChronoUnit" title="ChronoUnit">ChronoUnit</a>
to calculate the difference between two complex datetimes if supported.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_difference_examples"></a>Datetime Difference Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Difference in milliseconds between two numeric datetimes</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">long startTimestamp = 434931327000L;
long endTimestamp = 434931330000L;
long differenceInMillis = endTimestamp - startTimestamp;</pre>
</div>
</li>
<li class="listitem">
<p>Difference in milliseconds between two complex datetimes</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 11000000, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 35, 0, ZoneId.of('Z'));
long differenceInMillis = ChronoUnit.MILLIS.between(zdt1, zdt2);</pre>
</div>
</li>
<li class="listitem">
<p>Difference in days between two complex datetimes</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 11000000, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 17, 22, 15, 35, 0, ZoneId.of('Z'));
long differenceInDays = ChronoUnit.DAYS.between(zdt1, zdt2);</pre>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_comparison"></a>Datetime Comparison<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Use either two numeric datetimes or two complex datetimes to do a datetime
comparison. Use standard <a class="xref" href="painless-operators-boolean.html" title="Operators: Boolean">comparison operators</a>
to compare two numeric datetimes of the same time unit such as milliseconds.
For complex datetimes there is often a method or another complex type
(<a class="xref" href="painless-types.html#reference-types" title="Reference Types">object</a>) available to do the comparison.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_comparison_examples"></a>Datetime Comparison Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Greater than comparison of two numeric datetimes in milliseconds</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">long timestamp1 = 434931327000L;
long timestamp2 = 434931330000L;

if (timestamp1 &gt; timestamp2) {
   // handle condition
}</pre>
</div>
</li>
<li class="listitem">
<p>Equality comparison of two complex datetimes</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));

if (zdt1.equals(zdt2)) {
    // handle condition
}</pre>
</div>
</li>
<li class="listitem">
<p>Less than comparison of two complex datetimes</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 17, 22, 15, 35, 0, ZoneId.of('Z'));

if (zdt1.isBefore(zdt2)) {
    // handle condition
}</pre>
</div>
</li>
<li class="listitem">
<p>Greater than comparison of two complex datetimes</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 17, 22, 15, 35, 0, ZoneId.of('Z'));

if (zdt1.isAfter(zdt2)) {
    // handle condition
}</pre>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_zone"></a>Datetime Zone<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Both string datetimes and complex datetimes have a timezone with a default of
<code class="literal">UTC</code>. Numeric datetimes do not have enough explicit information to
have a timezone, so <code class="literal">UTC</code> is always assumed. Use
<a class="xref" href="painless-api-reference-shared-java-time.html#painless-api-reference-shared-ZonedDateTime" title="ZonedDateTime">methods</a> (or fields) in
conjunction with a <a class="xref" href="painless-api-reference-shared-java-time.html#painless-api-reference-shared-ZoneId" title="ZoneId">ZoneId</a> to change
the timezone for a complex datetime. Parse a string datetime into a complex
datetime to change the timezone, and then format the complex datetime back into
a desired string datetime. Note many complex datetimes are immutable so upon
modification a new complex datetime is created that requires
<a class="xref" href="painless-variables.html#variable-assignment" title="Assignment">assignment</a> or immediate use.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_zone_examples"></a>Datetime Zone Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Modify the timezone for a complex datetime</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime utc =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime pst = utc.withZoneSameInstant(ZoneId.of('America/Los_Angeles'));</pre>
</div>
</li>
<li class="listitem">
<p>Modify the timezone for a string datetime</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">String gmtString = 'Thu, 13 Oct 1983 22:15:30 GMT';
ZonedDateTime gmtZdt = ZonedDateTime.parse(gmtString,
        DateTimeFormatter.RFC_1123_DATE_TIME); <a id="CO6-1"></a><i class="conum" data-value="1"></i>
ZonedDateTime pstZdt =
        gmtZdt.withZoneSameInstant(ZoneId.of('America/Los_Angeles'));
String pstString = pstZdt.format(DateTimeFormatter.RFC_1123_DATE_TIME);</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO6-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the use of a built-in DateTimeFormatter.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_input"></a>Datetime Input<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>There are several common ways datetimes are used as input for a script
determined by the <a class="xref" href="painless-contexts.html" title="Painless contexts">Painless context</a>. Typically, datetime
input will be accessed from parameters specified by the user, from an original
source document, or from an indexed document.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_input_from_user_parameters"></a>Datetime Input From User Parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<p>Use the <a href="/guide/en/elasticsearch/reference/master/modules-scripting-using.html#_script_parameters" class="ulink" target="_top">params section</a>
during script specification to pass in a numeric datetime or string datetime as
a script input. Access to user-defined parameters within a script is dependent
on the Painless context, though, the parameters are most commonly accessible
through an input called <code class="literal">params</code>.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Parse a numeric datetime from user parameters to a complex datetime</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Input:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">...
"script": {
    ...
    "params": {
        "input_datetime": 434931327000
    }
}
...</pre>
</div>
</li>
<li class="listitem">
<p>Script:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">long inputDateTime = params['input_datetime'];
Instant instant = Instant.ofEpochMilli(inputDateTime);
ZonedDateTime zdt = ZonedDateTime.ofInstant(instant, ZoneId.of('Z'));</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Parse a string datetime from user parameters to a complex datetime</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Input:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">...
"script": {
    ...
    "params": {
        "input_datetime": "custom y 1983 m 10 d 13 22:15:30 Z"
    }
}
...</pre>
</div>
</li>
<li class="listitem">
<p>Script:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">String datetime = params['input_datetime'];
DateTimeFormatter dtf = DateTimeFormatter.ofPattern(
        "'custom' 'y' yyyy 'm' MM 'd' dd HH:mm:ss VV");
ZonedDateTime zdt = ZonedDateTime.parse(datetime, dtf); <a id="CO7-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO7-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the use of a custom DateTimeFormatter.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_input_from_a_source_document"></a>Datetime Input From a Source Document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<p>Use an original <a href="/guide/en/elasticsearch/reference/master/mapping-source-field.html" class="ulink" target="_top">source</a> document as a script
input to access a numeric datetime or string datetime for a specific field
within that document. Access to an original source document within a script is
dependent on the Painless context and is not always available. An original
source document is most commonly accessible through an input called
<code class="literal">ctx['_source']</code> or <code class="literal">params['_source']</code>.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Parse a numeric datetime from a sourced document to a complex datetime</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Input:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">{
  ...
  "input_datetime": 434931327000
  ...
}</pre>
</div>
</li>
<li class="listitem">
<p>Script:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">long inputDateTime = ctx['_source']['input_datetime']; <a id="CO8-1"></a><i class="conum" data-value="1"></i>
Instant instant = Instant.ofEpochMilli(inputDateTime);
ZonedDateTime zdt = ZonedDateTime.ofInstant(instant, ZoneId.of('Z'));</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO8-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note access to <code class="literal">_source</code> is dependent on the Painless context.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Parse a string datetime from a sourced document to a complex datetime</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Input:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">{
  ...
  "input_datetime": "1983-10-13T22:15:30Z"
  ...
}</pre>
</div>
</li>
<li class="listitem">
<p>Script:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">String datetime = params['_source']['input_datetime']; <a id="CO9-1"></a><i class="conum" data-value="1"></i>
ZonedDateTime zdt = ZonedDateTime.parse(datetime); <a id="CO9-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note access to <code class="literal">_source</code> is dependent on the Painless context.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the parse method uses ISO 8601 by default.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_input_from_an_indexed_document"></a>Datetime Input From an Indexed Document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<p>Use an indexed document as a script input to access a complex datetime for a
specific field within that document where the field is mapped as a
<a href="/guide/en/elasticsearch/reference/master/date.html" class="ulink" target="_top">standard date</a> or a <a href="/guide/en/elasticsearch/reference/master/date_nanos.html" class="ulink" target="_top">nanosecond date</a>.
Numeric datetime fields mapped as <a href="/guide/en/elasticsearch/reference/master/number.html" class="ulink" target="_top">numeric</a> and string
datetime fields mapped as <a href="/guide/en/elasticsearch/reference/master/keyword.html" class="ulink" target="_top">keyword</a> are accessible through an
indexed document as well. Access to an indexed document within a script is
dependent on the Painless context and is not always available. An indexed
document is most commonly accessible through an input called <code class="literal">doc</code>.</p>
<p><span class="strong strong"><strong>Examples</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Format a complex datetime from an indexed document to a string datetime</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Assumptions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The field <code class="literal">input_datetime</code> exists in all indexes as part of the query
</li>
<li class="listitem">
All indexed documents contain the field <code class="literal">input_datetime</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Mappings:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">{
  "mappings": {
    ...
    "properties": {
      ...
      "input_datetime": {
        "type": "date"
      }
      ...
    }
    ...
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>Script:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime input = doc['input_datetime'].value;
String output = input.format(DateTimeFormatter.ISO_INSTANT); <a id="CO10-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note the use of a built-in DateTimeFormatter.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Find the difference between two complex datetimes from an indexed document</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Assumptions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The fields <code class="literal">start</code> and <code class="literal">end</code> may <span class="strong strong"><strong>not</strong></span> exist in all indexes as part of the
query
</li>
<li class="listitem">
The fields <code class="literal">start</code> and <code class="literal">end</code> may <span class="strong strong"><strong>not</strong></span> have values in all indexed documents
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Mappings:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">{
  "mappings": {
    ...
    "properties": {
      ...
      "start": {
        "type": "date"
      },
      "end": {
        "type": "date"
      }
      ...
    }
    ...
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>Script:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">if (doc.containsKey('start') &amp;&amp; doc.containsKey('end')) { <a id="CO11-1"></a><i class="conum" data-value="1"></i>

    if (doc['start'].size() &gt; 0 &amp;&amp; doc['end'].size() &gt; 0) { <a id="CO11-2"></a><i class="conum" data-value="2"></i>

        ZonedDateTime start = doc['start'].value;
        ZonedDateTime end = doc['end'].value;
        long differenceInMillis = ChronoUnit.MILLIS.between(start, end);

        // handle difference in times
    } else {
        // handle fields without values
    }
} else {
    // handle index with missing fields
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>When a query&#8217;s results span multiple indexes, some indexes may not
contain a specific field. Use the <code class="literal">containsKey</code> method call on the <code class="literal">doc</code> input
to ensure a field exists as part of the index for the current document.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Some fields within a document may have no values. Use the <code class="literal">size</code> method
call on a field within the <code class="literal">doc</code> input to ensure that field has at least one
value for the current document.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_now"></a>Datetime Now<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<p>Under most Painless contexts the current datetime, <code class="literal">now</code>, is not supported.
There are two primary reasons for this. The first is that scripts are often run once
per document, so each time the script is run a different <code class="literal">now</code> is returned. The
second is that scripts are often run in a distributed fashion without a way to
appropriately synchronize <code class="literal">now</code>. Instead, pass in a user-defined parameter with
either a string datetime or numeric datetime for <code class="literal">now</code>. A numeric datetime is
preferred as there is no need to parse it for comparison.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_datetime_now_examples"></a>Datetime Now Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Use a numeric datetime as <code class="literal">now</code></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Assumptions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The field <code class="literal">input_datetime</code> exists in all indexes as part of the query
</li>
<li class="listitem">
All indexed documents contain the field <code class="literal">input_datetime</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Mappings:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">{
  "mappings": {
      ...
      "properties": {
        ...
        "input_datetime": {
        "type": "date"
      }
      ...
    }
    ...
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>Input:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">...
"script": {
    ...
    "params": {
        "now": &lt;generated numeric datetime in milliseconds since epoch&gt;
    }
}
...</pre>
</div>
</li>
<li class="listitem">
<p>Script:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">long now = params['now'];
ZonedDateTime inputDateTime = doc['input_datetime'];
long millisDateTime = zdt.toInstant().toEpochMilli();
long elapsedTime = now - millisDateTime;</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Use a string datetime as <code class="literal">now</code></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Assumptions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The field <code class="literal">input_datetime</code> exists in all indexes as part of the query
</li>
<li class="listitem">
All indexed documents contain the field <code class="literal">input_datetime</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Mappings:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">{
  "mappings": {
    ...
    "properties": {
      ...
      "input_datetime": {
        "type": "date"
      }
      ...
    }
    ...
  }
}</pre>
</div>
</li>
<li class="listitem">
<p>Input:</p>
<div class="pre_wrapper lang-JSON">
<pre class="programlisting prettyprint lang-JSON">...
"script": {
    ...
    "params": {
        "now": "&lt;generated string datetime in ISO-8601&gt;"
    }
}
...</pre>
</div>
</li>
<li class="listitem">
<p>Script:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">String nowString = params['now'];
ZonedDateTime nowZdt = ZonedDateTime.parse(nowString); <a id="CO12-1"></a><i class="conum" data-value="1"></i>
long now = ZonedDateTime.toInstant().toEpochMilli();
ZonedDateTime inputDateTime = doc['input_datetime'];
long millisDateTime = zdt.toInstant().toEpochMilli();
long elapsedTime = now - millisDateTime;</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO12-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note this parses the same string datetime every time the script runs. Use a
numeric datetime to avoid a significant performance hit.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_datetime_examples_in_contexts"></a>Datetime Examples in Contexts<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_load_the_example_data"></a>Load the Example Data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<p>Run the following curl commands to load the data necessary for the context
examples into an Elasticsearch cluster:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create <a href="/guide/en/elasticsearch/reference/master/mapping.html" class="ulink" target="_top">mappings</a> for the sample data.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /messages
{
  "mappings": {
    "properties": {
      "priority": {
        "type": "integer"
      },
      "datetime": {
        "type": "date"
      },
      "message": {
        "type": "text"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/15.console"></div>
</li>
<li class="listitem">
<p>Load the sample data.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_bulk
{ "index" : { "_index" : "messages", "_id" : "1" } }
{ "priority": 1, "datetime": "2019-07-17T12:13:14Z", "message": "m1" }
{ "index" : { "_index" : "messages", "_id" : "2" } }
{ "priority": 1, "datetime": "2019-07-24T01:14:59Z", "message": "m2" }
{ "index" : { "_index" : "messages", "_id" : "3" } }
{ "priority": 2, "datetime": "1983-10-14T00:36:42Z", "message": "m3" }
{ "index" : { "_index" : "messages", "_id" : "4" } }
{ "priority": 3, "datetime": "1983-10-10T02:15:15Z", "message": "m4" }
{ "index" : { "_index" : "messages", "_id" : "5" } }
{ "priority": 3, "datetime": "1983-10-10T17:18:19Z", "message": "m5" }
{ "index" : { "_index" : "messages", "_id" : "6" } }
{ "priority": 1, "datetime": "2019-08-03T17:19:31Z", "message": "m6" }
{ "index" : { "_index" : "messages", "_id" : "7" } }
{ "priority": 3, "datetime": "2019-08-04T17:20:00Z", "message": "m7" }
{ "index" : { "_index" : "messages", "_id" : "8" } }
{ "priority": 2, "datetime": "2019-08-04T18:01:01Z", "message": "m8" }
{ "index" : { "_index" : "messages", "_id" : "9" } }
{ "priority": 3, "datetime": "1983-10-10T19:00:45Z", "message": "m9" }
{ "index" : { "_index" : "messages", "_id" : "10" } }
{ "priority": 2, "datetime": "2019-07-23T23:39:54Z", "message": "m10" }</pre>
</div>
<div class="console_widget" data-snippet="snippets/16.console"></div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_day_of_the_week_bucket_aggregation_example"></a>Day-of-the-Week Bucket Aggregation Example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example uses a
<a href="/guide/en/elasticsearch/reference/master/search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-script" class="ulink" target="_top">terms aggregation</a>
as part of the
<a class="xref" href="painless-bucket-script-agg-context.html" title="Bucket script aggregation context">bucket script aggregation context</a> to
display the number of messages from each day-of-the-week.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /messages/_search?pretty=true
{
  "aggs": {
    "day-of-week-count": {
      "terms": {
        "script": "return doc[\"datetime\"].value.getDayOfWeekEnum();"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/17.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_morningevening_bucket_aggregation_example"></a>Morning/Evening Bucket Aggregation Example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example uses a
<a href="/guide/en/elasticsearch/reference/master/search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-script" class="ulink" target="_top">terms aggregation</a>
as part of the
<a class="xref" href="painless-bucket-script-agg-context.html" title="Bucket script aggregation context">bucket script aggregation context</a> to
display the number of messages received in the morning versus the evening.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /messages/_search?pretty=true
{
  "aggs": {
    "am-pm-count": {
      "terms": {
        "script": "return doc[\"datetime\"].value.getHour() &lt; 12 ? \"AM\" : \"PM\";"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/18.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_age_of_a_message_script_field_example"></a>Age of a Message Script Field Example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/painless/painless-guide/painless-datetime.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example uses a
<a href="/guide/en/elasticsearch/reference/master/search-fields.html#script-fields" class="ulink" target="_top">script field</a> as part of the
<a class="xref" href="painless-field-context.html" title="Field context">field context</a> to display the elapsed time between
"now" and when a message was received.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search?pretty=true
{
  "query": {
    "match_all": {}
  },
  "script_fields": {
    "message_age": {
      "script": {
        "source": "ZonedDateTime now = ZonedDateTime.ofInstant(Instant.ofEpochMilli(params[\"now\"]), ZoneId.of(\"Z\")); ZonedDateTime mdt = doc[\"datetime\"].value; String age; long years = mdt.until(now, ChronoUnit.YEARS); age = years + \"Y \"; mdt = mdt.plusYears(years); long months = mdt.until(now, ChronoUnit.MONTHS); age += months + \"M \"; mdt = mdt.plusMonths(months); long days = mdt.until(now, ChronoUnit.DAYS); age += days + \"D \"; mdt = mdt.plusDays(days); long hours = mdt.until(now, ChronoUnit.HOURS); age += hours + \"h \"; mdt = mdt.plusHours(hours); long minutes = mdt.until(now, ChronoUnit.MINUTES); age += minutes + \"m \"; mdt = mdt.plusMinutes(minutes); long seconds = mdt.until(now, ChronoUnit.SECONDS); age += hours + \"s\"; return age;",
        "params": {
          "now": 1574005645830
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/19.console"></div>
<p>The following shows the script broken into multiple lines:</p>
<div class="pre_wrapper lang-Painless">
<pre class="programlisting prettyprint lang-Painless">ZonedDateTime now = ZonedDateTime.ofInstant(
        Instant.ofEpochMilli(params['now']), ZoneId.of('Z')); <a id="CO13-1"></a><i class="conum" data-value="1"></i>
ZonedDateTime mdt = doc['datetime'].value; <a id="CO13-2"></a><i class="conum" data-value="2"></i>

String age;

long years = mdt.until(now, ChronoUnit.YEARS); <a id="CO13-3"></a><i class="conum" data-value="3"></i>
age = years + 'Y '; <a id="CO13-4"></a><i class="conum" data-value="4"></i>
mdt = mdt.plusYears(years); <a id="CO13-5"></a><i class="conum" data-value="5"></i>

long months = mdt.until(now, ChronoUnit.MONTHS);
age += months + 'M ';
mdt = mdt.plusMonths(months);

long days = mdt.until(now, ChronoUnit.DAYS);
age += days + 'D ';
mdt = mdt.plusDays(days);

long hours = mdt.until(now, ChronoUnit.HOURS);
age += hours + 'h ';
mdt = mdt.plusHours(hours);

long minutes = mdt.until(now, ChronoUnit.MINUTES);
age += minutes + 'm ';
mdt = mdt.plusMinutes(minutes);

long seconds = mdt.until(now, ChronoUnit.SECONDS);
age += hours + 's';

return age; <a id="CO13-6"></a><i class="conum" data-value="6"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Parse the datetime "now" as input from the user-defined params.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Store the datetime the message was received as a <code class="literal">ZonedDateTime</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Find the difference in years between "now" and the datetime the message was
received.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Add the difference in years later returned in the format
<code class="literal">Y &lt;years&gt; ...</code> for the age of a message.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Add the years so only the remainder of the months, days, etc. remain as the
difference between "now" and the datetime the message was received. Repeat this
pattern until the desired granularity is reached (seconds in this example).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Return the age of the message in the format
<code class="literal">Y &lt;years&gt; M &lt;months&gt; D &lt;days&gt; h &lt;hours&gt; m &lt;minutes&gt; s &lt;seconds&gt;</code>.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="painless-walkthrough.html">« A Brief Painless Walkthrough</a>
</span>
<span class="next">
<a href="modules-scripting-painless-dispatch.html">How painless dispatches functions »</a>
</span>
</div>
</div>
</body>
</html>
