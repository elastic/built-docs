<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Metric aggregation map context | Painless Scripting Language [master] | Elastic</title>
<meta class="elastic" name="content" content="Metric aggregation map context | Painless Scripting Language [master]">

<link rel="home" href="index.html" title="Painless Scripting Language [master]"/>
<link rel="up" href="painless-contexts.html" title="Painless contexts"/>
<link rel="prev" href="painless-metric-agg-init-context.html" title="Metric aggregation initialization context"/>
<link rel="next" href="painless-metric-agg-combine-context.html" title="Metric aggregation combine context"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Painless/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="painless-metric-agg-init-context.html">« Metric aggregation initialization context</a>
</span>
<span class="next">
<a href="painless-metric-agg-combine-context.html">Metric aggregation combine context »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Painless Scripting Language [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="painless-contexts.html">Painless contexts</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Metric aggregation map context</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/painless/painless-contexts/painless-metric-agg-map-context.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="painless-metric-agg-map-context"></a>Metric aggregation map context<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/painless/painless-contexts/painless-metric-agg-map-context.asciidoc">edit</a></h2>
</div></div></div>
<p>Use a Painless script to
<a href="/guide/en/elasticsearch/reference/master/search-aggregations-metrics-scripted-metric-aggregation.html" class="ulink" target="_top">map</a>
values for use in a scripted metric aggregation. A map script is run once per
collected document following an optional
<a class="xref" href="painless-metric-agg-init-context.html" title="Metric aggregation initialization context">initialization script</a> and is required as
part of a full metric aggregation.</p>
<p><span class="strong strong"><strong>Variables</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">params</code> (<code class="literal">Map</code>, read-only)
</span>
</dt>
<dd>
User-defined parameters passed in as part of the query.
</dd>
<dt>
<span class="term">
<code class="literal">state</code> (<code class="literal">Map</code>)
</span>
</dt>
<dd>
<code class="literal">Map</code> used to add values for processing in a
<a class="xref" href="painless-metric-agg-map-context.html" title="Metric aggregation map context">combine script</a> or to be returned from the aggregation.
</dd>
<dt>
<span class="term">
<code class="literal">doc</code> (<code class="literal">Map</code>, read-only)
</span>
</dt>
<dd>
Contains the fields of the current document where each field is a
<code class="literal">List</code> of values.
</dd>
<dt>
<span class="term">
<code class="literal">_score</code> (<code class="literal">double</code> read-only)
</span>
</dt>
<dd>
The similarity score of the current document.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Side Effects</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">state</code> (<code class="literal">Map</code>)
</span>
</dt>
<dd>
Use this <code class="literal">Map</code> to add values for processing in a combine script.
Additional values must be of the type <code class="literal">Map</code>, <code class="literal">List</code>, <code class="literal">String</code> or
primitive. The same <code class="literal">state</code> <code class="literal">Map</code> is shared between all aggregated documents
on a given shard. If an initialization script is provided as part of the
aggregation then values added from the initialization script are
available. If no combine script is specified, values must be
directly stored in <code class="literal">state</code> in a usable form. If no combine script and no
<a class="xref" href="painless-metric-agg-reduce-context.html" title="Metric aggregation reduce context">reduce script</a> are specified, the
<code class="literal">state</code> values are used as the result.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Return</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">void</code>
</span>
</dt>
<dd>
No expected return value.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>API</strong></span></p>
<p>The standard <a class="xref" href="painless-api-reference-shared.html" title="Shared API">Painless API</a> is available.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="painless-metric-agg-init-context.html">« Metric aggregation initialization context</a>
</span>
<span class="next">
<a href="painless-metric-agg-combine-context.html">Metric aggregation combine context »</a>
</span>
</div>
</body>
</html>
