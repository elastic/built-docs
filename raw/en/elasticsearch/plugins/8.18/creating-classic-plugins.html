<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Creating classic plugins | Elasticsearch Plugins and Integrations [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Creating classic plugins | Elasticsearch Plugins and Integrations [8.18]">

<link rel="home" href="index.html" title="Elasticsearch Plugins and Integrations [8.18]"/>
<link rel="up" href="plugin-authors.html" title="Creating an Elasticsearch plugin"/>
<link rel="prev" href="example-text-analysis-plugin.html" title="Example text analysis plugin"/>
<link rel="next" href="_entitlements.html" title="Entitlements"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Plugins/8.18"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.18"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="example-text-analysis-plugin.html">« Example text analysis plugin</a>
</span>
<span class="next">
<a href="_entitlements.html">Entitlements »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Plugins and Integrations [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="plugin-authors.html">Creating an Elasticsearch plugin</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Creating classic plugins</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.18/docs/plugins/development/creating-classic-plugins.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="creating-classic-plugins"></a>Creating classic plugins</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.18/docs/plugins/development/creating-classic-plugins.asciidoc">edit</a></div>
</div></div></div>
<p>Classic plugins provide Elasticsearch with mechanisms for custom authentication,
authorization, scoring, and more.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p class="admon_title">Plugin release lifecycle</p>
<p>Classic plugins require you to build a new version for each new Elasticsearch release.
This version is checked when the plugin is installed and when it is loaded. Elasticsearch
will refuse to start in the presence of plugins with the incorrect
<code class="literal">elasticsearch.version</code>.</p>
</div>
</div>
<div class="position-relative"><h4><a id="_classic_plugin_file_structure"></a>Classic plugin file structure</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.18/docs/plugins/development/creating-classic-plugins.asciidoc">edit</a></div>
<p>Classic plugins are ZIP files composed of JAR files and
<a class="xref" href="plugin-descriptor-file-classic.html" title="The plugin descriptor file for classic plugins">a metadata file called
<code class="literal">plugin-descriptor.properties</code></a>, a Java properties file that describes the
plugin.</p>
<p>Note that only JAR files at the root of the plugin are added to the classpath
for the plugin. If you need other resources, package them into a resources JAR.</p>
<div class="position-relative"><h4><a id="_example_plugins"></a>Example plugins</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.18/docs/plugins/development/creating-classic-plugins.asciidoc">edit</a></div>
<p>The Elasticsearch repository contains <a href="https://github.com/elastic/elasticsearch/tree/main/plugins/examples" class="ulink" target="_top">examples of plugins</a>. Some of these include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
a plugin with <a href="https://github.com/elastic/elasticsearch/tree/main/plugins/examples/custom-settings" class="ulink" target="_top">custom settings</a>
</li>
<li class="listitem">
a plugin with a <a href="https://github.com/elastic/elasticsearch/tree/main/plugins/examples/custom-processor" class="ulink" target="_top">custom ingest processor</a>
</li>
<li class="listitem">
adding <a href="https://github.com/elastic/elasticsearch/tree/main/plugins/examples/rest-handler" class="ulink" target="_top">custom rest endpoints</a>
</li>
<li class="listitem">
adding a <a href="https://github.com/elastic/elasticsearch/tree/main/plugins/examples/rescore" class="ulink" target="_top">custom rescorer</a>
</li>
<li class="listitem">
a script <a href="https://github.com/elastic/elasticsearch/tree/main/plugins/examples/script-expert-scoring" class="ulink" target="_top">implemented in Java</a>
</li>
</ul>
</div>
<p>These examples provide the bare bones needed to get started. For more
information about how to write a plugin, we recommend looking at the
<a href="https://github.com/elastic/elasticsearch/tree/main/plugins/" class="ulink" target="_top">source code of existing plugins</a> for inspiration.</p>
<div class="position-relative"><h4><a id="_testing_your_plugin"></a>Testing your plugin</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.18/docs/plugins/development/creating-classic-plugins.asciidoc">edit</a></div>
<p>Use <code class="literal">bin/elasticsearch-plugin install file:///path/to/your/plugin</code>
to install your plugin for testing. The Java plugin is auto-loaded only if it&#8217;s in the
<code class="literal">plugins/</code> directory.</p>
<div class="position-relative"><h4><a id="_entitlements_policy"></a>Entitlements policy</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.18/docs/plugins/development/creating-classic-plugins.asciidoc">edit</a></div>
<p>Some plugins may need additional <em>entitlements</em>.</p>
<p>Elasticsearch limits the ability to perform certain security-sensitive actions as part of its <em>Entitlement</em> security mechanism (e.g. to limit the potential fallout from remote code execution (RCE) vulnerabilities).</p>
<p>The Entitlement model is based on Java modules.
An <em>entitlement</em> granted to a Java module allows the module&#8217;s code to perform the security-sensitive action associated with that entitlement. For example, the ability to create threads is limited to modules that have the <code class="literal">manage_threads</code> entitlement; likewise, the ability to read a file from the filesystem is limited to modules that have the <code class="literal">files</code> entitlement for that particular file.</p>
<p>In practice, an entitlement allows plugin code to call a well-defined set of corresponding JDK methods; without the entitlement calls to those JDK methods are denied and throw a <code class="literal">NotEntitledException</code>. Plugin can include the optional <code class="literal">entitlement-policy.yaml</code> file to define modules and required entitlements. Any additional entitlement requested by the plugin will be displayed to the user with a large warning, and users will have to confirm them when installing the plugin interactively. Therefore, it is best to avoid requesting any spurious entitlement!</p>
<p>If you are using the Elasticsearch Gradle build system, place this file in <code class="literal">src/main/plugin-metadata</code> and it will be applied during unit tests as well.</p>
<p>An entitlement policy applies to all of your plugin jars (your own code and third party dependencies). You have to write your policy file accordingly. For example, if a plugin uses the Example API client to perform network operations, it will need a policy that may look like this:</p>
<div class="pre_wrapper lang-YAML">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-YAML">org.elasticsearch.example-plugin:
  - manage_threads
com.example.api.client:
  - set_https_connection_properties
  - outbound_network</pre>
</div>
<p>Note how the network related entitlements are granted to the <code class="literal">com.example.api.client</code> module, as the code performing the sensitive network operations is in the <code class="literal">example-api-client</code> dependency.</p>
<p>If your plugin is not modular, all entitlements must be specified under the catch-all <code class="literal">ALL-UNNAMED</code> module name:</p>
<div class="pre_wrapper lang-YAML">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-YAML">ALL-UNNAMED:
  - manage_threads
  - set_https_connection_properties
  - outbound_network</pre>
</div>


</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="example-text-analysis-plugin.html">« Example text analysis plugin</a>
</span>
<span class="next">
<a href="_entitlements.html">Entitlements »</a>
</span>
</div>
</body>
</html>
