<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shadow replica indices | Elasticsearch Guide [1.5] | Elastic</title>
<meta class="elastic" name="content" content="Shadow replica indices | Elasticsearch Guide [1.5]">

<link rel="home" href="index.html" title="Elasticsearch Guide [1.5]"/>
<link rel="up" href="indices.html" title="Indices APIs"/>
<link rel="prev" href="indices-upgrade.html" title="Upgrade"/>
<link rel="next" href="_node_level_settings_related_to_shadow_replicas.html" title="Node level settings related to shadow replicas"/>
<meta class="elastic" name="product_version" content="1.5"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/1.5"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="1.5"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<p>
  <strong>WARNING</strong>: Version 1.5 of Elasticsearch has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div class="navheader">
<span class="prev">
<a href="indices-upgrade.html">« Upgrade</a>
</span>
<span class="next">
<a href="_node_level_settings_related_to_shadow_replicas.html">Node level settings related to shadow replicas »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [1.5]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Shadow replica indices</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/1.5/docs/reference/indices/shadow-replicas.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="indices-shadow-replicas"></a>Shadow replica indices</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/1.5/docs/reference/indices/shadow-replicas.asciidoc">edit</a></div>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>If you would like to use a shared filesystem, you can use the shadow replicas
settings to choose where on disk the data for an index should be kept, as well
as how Elasticsearch should replay operations on all the replica shards of an
index.</p>
<p>In order to fully utilize the <code class="literal">index.data_path</code> and <code class="literal">index.shadow_replicas</code>
settings, you need to enable using it in elasticsearch.yml:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">node.enable_custom_paths: true</pre>
</div>
<p>You can then create an index with a custom data path, where each node will use
this path for the data:</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Because shadow replicas do not index the document on replica shards, it&#8217;s
possible for the replica&#8217;s known mapping to be behind the index&#8217;s known mapping
if the latest cluster state has not yet been processed on the node containing
the replica. Because of this, it is highly recommended to use pre-defined
mappings when using shadow replicas.</p>
</div>
</div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">curl -XPUT 'localhost:9200/my_index' -d '
{
    "index" : {
        "number_of_shards" : 1,
        "number_of_replicas" : 4,
        "data_path": "/var/data/my_index",
        "shadow_replicas": true
    }
}'</pre>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>In the above example, the "/var/data/my_index" path is a shared filesystem that
must be available on every node in the Elasticsearch cluster. You must also
ensure that the Elasticsearch process has the correct permissions to read from
and write to the directory used in the <code class="literal">index.data_path</code> setting.</p>
</div>
</div>
<p>An index that has been created with the <code class="literal">index.shadow_replicas</code> setting set to
"true" will not replicate document operations to any of the replica shards,
instead, it will only continually refresh. Once segments are available on the
filesystem where the shadow replica resides (after an Elasticsearch "flush"), a
regular refresh (governed by the <code class="literal">index.refresh_interval</code>) can be used to make
the new data searchable.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Since documents are only indexed on the primary shard, realtime GET
requests could fail to return a document if executed on the replica shard,
therefore, GET API requests automatically have the <code class="literal">?preference=_primary</code> flag
set if there is no preference flag already set.</p>
</div>
</div>
<p>In order to ensure the data is being synchronized in a fast enough manner, you
may need to tune the flush threshold for the index to a desired number. A flush
is needed to fsync segment files to disk, so they will be visible to all other
replica nodes. Users should test what flush threshold levels they are
comfortable with, as increased flushing can impact indexing performance.</p>
<p>The Elasticsearch cluster will still detect the loss of a primary shard, and
transform the replica into a primary in this situation. This transformation will
take slightly longer, since no <code class="literal">IndexWriter</code> is maintained for each shadow
replica.</p>
<p>Below is the list of settings that can be changed using the update
settings API:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index.data_path</code> (string)
</span>
</dt>
<dd>
Path to use for the index&#8217;s data. Note that by default Elasticsearch will
append the node ordinal by default to the path to ensure multiple instances
of Elasticsearch on the same machine do not share a data directory.
</dd>
<dt>
<span class="term">
<code class="literal">index.shadow_replicas</code>
</span>
</dt>
<dd>
Boolean value indicating this index should use shadow replicas. Defaults to
<code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">index.shared_filesystem</code>
</span>
</dt>
<dd>
Boolean value indicating this index uses a shared filesystem. Defaults to
the <code class="literal">true</code> if <code class="literal">index.shadow_replicas</code> is set to true, <code class="literal">false</code> otherwise.
</dd>
</dl>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="indices-upgrade.html">« Upgrade</a>
</span>
<span class="next">
<a href="_node_level_settings_related_to_shadow_replicas.html">Node level settings related to shadow replicas »</a>
</span>
</div>
</body>
</html>
