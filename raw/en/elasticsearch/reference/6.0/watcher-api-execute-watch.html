<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Execute Watch API | Elasticsearch Reference [6.0] | Elastic</title>
<meta class="elastic" name="content" content="Execute Watch API | Elasticsearch Reference [6.0]">

<link rel="home" href="index.html" title="Elasticsearch Reference [6.0]"/>
<link rel="up" href="watcher-api.html" title="Watcher APIs"/>
<link rel="prev" href="watcher-api-delete-watch.html" title="Delete Watch API"/>
<link rel="next" href="watcher-api-ack-watch.html" title="Ack Watch API"/>
<meta class="elastic" name="product_version" content="6.0"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/6.0"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="6.0"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<p>
  <strong>WARNING</strong>: Version 6.0 of Elasticsearch has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div class="navheader">
<span class="prev">
<a href="watcher-api-delete-watch.html">« Delete Watch API</a>
</span>
<span class="next">
<a href="watcher-api-ack-watch.html">Ack Watch API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [6.0]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="xpack-api.html">X-Pack APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="watcher-api.html">Watcher APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Execute Watch API</h1></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/api/doc/elasticsearch/operation/operation-watcher-execute-watch">latest documentation</a>.
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="watcher-api-execute-watch"></a>Execute Watch API<a class="xpack_tag" href="/subscriptions"></a></h2></div>
</div></div></div>
<p>The execute watch API forces the execution of a stored watch. It can be used to
force execution of the watch outside of its triggering logic, or to simulate the
watch execution for debugging purposes.</p>
<div class="position-relative"><h4><a id="_request_39"></a>Request</h4></div>
<p><code class="literal">POST _xpack/watcher/watch/&lt;watch_id&gt;/_execute</code><br></p>
<p><code class="literal">POST _xpack/watcher/watch/_execute</code></p>
<div class="position-relative"><h4><a id="_description_26"></a>Description</h4></div>
<p>For testing and debugging purposes, you also have fine-grained control on how
the watch runs. You can execute the watch without executing all of its actions
or alternatively by simulating them. You can also force execution by ignoring
the watch condition and control whether a watch record would be written to the
watch history after execution.</p>
<div class="position-relative"><h5><a id="watcher-api-execute-inline-watch"></a>Inline Watch Execution</h5></div>
<p>You can use the Execute API to execute watches that are not yet registered by
specifying the watch definition inline. This serves as great tool for testing
and debugging your watches prior to adding them to Watcher.</p>
<div class="position-relative"><h4><a id="_path_parameters_35"></a>Path Parameters</h4></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">watch_id</code>
</span>
</dt>
<dd>
(string) Identifier for the watch.
</dd>
</dl>
</div>
<div class="position-relative"><h4><a id="_query_parameters_7"></a>Query Parameters</h4></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">debug</code>
</span>
</dt>
<dd>
(boolean) Defines whether the watch runs in debug mode. The default value is
<code class="literal">false</code>.
</dd>
</dl>
</div>
<div class="position-relative"><h4><a id="_request_body_25"></a>Request Body</h4></div>
<p>This API supports the following fields:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="center" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">trigger_data</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p></p></td>
<td align="left" valign="top"><p>This structure is parsed as the data of the trigger event
                                              that will be used during the watch execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ignore_condition</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>When set to <code class="literal">true</code>, the watch execution uses the
                                              <a href="/guide/en/x-pack/6.0/condition-always.html" class="ulink" target="_top">Always Condition</a>.
                                              This can also be specified as a HTTP parameter.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">alternative_input</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>When present, the watch uses this object as a payload
                                              instead of executing its own input.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action_modes</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>Determines how to handle the watch actions as part of the
                                              watch execution. See <a class="xref" href="watcher-api-execute-watch.html#watcher-api-execute-watch-action-mode" title="Action Execution Modes">Action Execution Modes</a>
                                              for more information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">record_execution</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>When set to <code class="literal">true</code>, the watch record representing the watch
                                              execution result is persisted to the <code class="literal">.watcher-history</code>
                                              index for the current time. In addition, the status of the
                                              watch is updated, possibly throttling subsequent executions.
                                              This can also be specified as a HTTP parameter.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">watch</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="center" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>When present, this
                                              <a href="/guide/en/x-pack/6.0/how-watcher-works.html#watch-definition" class="ulink" target="_top">watch</a> is used
                                              instead of the one specified in the request. This watch is
                                              not persisted to the index and record_execution cannot be set.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="position-relative"><h5><a id="watcher-api-execute-watch-action-mode"></a>Action Execution Modes</h5></div>
<p>Action modes define how actions are handled during the watch execution. There
are five possible modes an action can be associated with:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">simulate</code></p></td>
<td align="left" valign="top"><p>The action execution is simulated. Each action type
                      define its own simulation operation mode. For example, the
                      <a href="/guide/en/x-pack/6.0/actions-email.html" class="ulink" target="_top">email</a> action creates
                      the email that would have been sent but does not actually
                      send it. In this mode, the action might be throttled if the
                      current state of the watch indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">force_simulate</code></p></td>
<td align="left" valign="top"><p>Similar to the the <code class="literal">simulate</code> mode, except the action is
                      not be throttled even if the current state of the watch
                      indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">execute</code></p></td>
<td align="left" valign="top"><p>Executes the action as it would have been executed if the
                      watch would have been triggered by its own trigger. The
                      execution might be throttled if the current state of the
                      watch indicates it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">force_execute</code></p></td>
<td align="left" valign="top"><p>Similar to the <code class="literal">execute</code> mode, except the action is not
                      throttled even if the current state of the watch indicates
                      it should be.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">skip</code></p></td>
<td align="left" valign="top"><p>The action is skipped and is not executed or simulated.
                      Effectively forces the action to be throttled.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="position-relative"><h4><a id="_authorization_34"></a>Authorization</h4></div>
<p>You must have <code class="literal">manage_watcher</code> cluster privileges to use this API. For more
information, see <a href="/guide/en/x-pack/6.0/security-privileges.html" class="ulink" target="_top">Security Privileges</a>.</p>
<div class="position-relative"><h4><a id="_examples_43"></a>Examples</h4></div>
<p>The following example executes the <code class="literal">my_watch</code> watch:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _xpack/watcher/watch/my_watch/_execute</pre>
</div>
<div class="console_widget" data-snippet="snippets/1284.console"></div>
<p>The following example shows a comprehensive example of executing the <code class="literal">my-watch</code> watch:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _xpack/watcher/watch/my_watch/_execute
{
  "trigger_data" : { <a id="CO346-1"></a><i class="conum" data-value="1"></i>
     "triggered_time" : "now",
     "scheduled_time" : "now"
  },
  "alternative_input" : { <a id="CO346-2"></a><i class="conum" data-value="2"></i>
    "foo" : "bar"
  },
  "ignore_condition" : true, <a id="CO346-3"></a><i class="conum" data-value="3"></i>
  "action_modes" : {
    "my-action" : "force_simulate" <a id="CO346-4"></a><i class="conum" data-value="4"></i>
  },
  "record_execution" : true <a id="CO346-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1285.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO346-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The triggered and schedule times are provided.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO346-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The input as defined by the watch is ignored and instead the provided input
is used as the execution payload.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO346-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The condition as defined by the watch is ignored and is assumed to
evaluate to <code class="literal">true</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO346-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Forces the simulation of <code class="literal">my-action</code>. Forcing the simulation means that
throttling is ignored and the watch is simulated by Watcher instead of
being executed normally.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO346-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The execution of the watch creates a watch record in the watch history,
and the throttling state of the watch is potentially updated accordingly.</p>
</td>
</tr>
</table>
</div>
<p>This is an example of the output:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "_id": "my_watch_0-2015-06-02T23:17:55.124Z", <a id="CO347-1"></a><i class="conum" data-value="1"></i>
  "watch_record": { <a id="CO347-2"></a><i class="conum" data-value="2"></i>
    "watch_id": "my_watch",
    "node": "my_node",
    "messages": [],
    "trigger_event": {
      "type": "manual",
      "triggered_time": "2015-06-02T23:17:55.124Z",
      "manual": {
        "schedule": {
          "scheduled_time": "2015-06-02T23:17:55.124Z"
        }
      }
    },
    "state": "executed",
    "status": {
      "version": 1,
      "state": {
        "active": true,
        "timestamp": "2015-06-02T23:17:55.111Z"
      },
      "last_checked": "2015-06-02T23:17:55.124Z",
      "last_met_condition": "2015-06-02T23:17:55.124Z",
      "actions": {
        "test_index": {
          "ack": {
            "timestamp": "2015-06-02T23:17:55.124Z",
            "state": "ackable"
          },
          "last_execution": {
            "timestamp": "2015-06-02T23:17:55.124Z",
            "successful": true
          },
          "last_successful_execution": {
            "timestamp": "2015-06-02T23:17:55.124Z",
            "successful": true
          }
        }
      }
    },
    "input": {
      "simple": {
        "payload": {
          "send": "yes"
        }
      }
    },
    "condition": {
      "always": {}
    },
    "result": { <a id="CO347-3"></a><i class="conum" data-value="3"></i>
      "execution_time": "2015-06-02T23:17:55.124Z",
      "execution_duration": 12608,
      "input": {
        "type": "simple",
        "payload": {
          "foo": "bar"
        },
        "status": "success"
      },
      "condition": {
        "type": "always",
        "met": true,
        "status": "success"
      },
      "actions": [
        {
          "id": "test_index",
          "index": {
            "response": {
              "index": "test",
              "type": "test2",
              "version": 1,
              "created": true,
              "result": "created",
              "id": "AVSHKzPa9zx62AzUzFXY"
            }
          },
          "status": "success",
          "type": "index"
        }
      ]
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO347-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the watch record as it would be stored in the <code class="literal">.watcher-history</code> index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO347-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The watch record document as it would be stored in the <code class="literal">.watcher-history</code> index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO347-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The watch execution results.</p>
</td>
</tr>
</table>
</div>
<p>You can set a different execution mode for every action by associating the mode
name with the action id:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _xpack/watcher/watch/my_watch/_execute
{
  "action_modes" : {
    "action1" : "force_simulate",
    "action2" : "skip"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1286.console"></div>
<p>You can also associate a single execution mode with all the actions in the watch
using <code class="literal">_all</code> as the action id:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _xpack/watcher/watch/my_watch/_execute
{
  "action_modes" : {
    "_all" : "force_execute"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1287.console"></div>
<p>The following example shows how to execute a watch inline:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _xpack/watcher/watch/_execute
{
  "watch" : {
    "trigger" : { "schedule" : { "interval" : "10s" } },
    "input" : {
      "search" : {
        "request" : {
          "indices" : [ "logs" ],
          "body" : {
            "query" : {
              "match" : { "message": "error" }
            }
          }
        }
      }
    },
    "condition" : {
      "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }}
    },
    "actions" : {
      "log_error" : {
        "logging" : {
          "text" : "Found {{ctx.payload.hits.total}} errors in the logs"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1288.console"></div>
<p>All other settings for this API still apply when inlining a watch. In the
following snippet, while the inline watch defines a <code class="literal">compare</code> condition,
during the execution this condition will be ignored:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _xpack/watcher/watch/_execute
{
  "ignore_condition" : true,
  "watch" : {
    "trigger" : { "schedule" : { "interval" : "10s" } },
    "input" : {
      "search" : {
        "request" : {
          "indices" : [ "logs" ],
          "body" : {
            "query" : {
              "match" : { "message": "error" }
            }
          }
        }
      }
    },
    "condition" : {
      "compare" : { "ctx.payload.hits.total" : { "gt" : 0 }}
    },
    "actions" : {
      "log_error" : {
        "logging" : {
          "text" : "Found {{ctx.payload.hits.total}} errors in the logs"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1289.console"></div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="watcher-api-delete-watch.html">« Delete Watch API</a>
</span>
<span class="next">
<a href="watcher-api-ack-watch.html">Ack Watch API »</a>
</span>
</div>
</body>
</html>
