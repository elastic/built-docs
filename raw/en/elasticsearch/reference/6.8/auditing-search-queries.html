<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Auditing search queries | Elasticsearch Guide [6.8] | Elastic</title>
<meta class="elastic" name="content" content="Auditing search queries | Elasticsearch Guide [6.8]">

<link rel="home" href="index.html" title="Elasticsearch Guide [6.8]"/>
<link rel="up" href="auditing.html" title="Auditing security events"/>
<link rel="prev" href="audit-index.html" title="Index audit output"/>
<link rel="next" href="forwarding-audit-logfiles.html" title="Forwarding audit logs to a remote cluster"/>
<meta class="elastic" name="product_version" content="6.8"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/6.8"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="6.8"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<p>
  <strong>NOTE</strong>: You are looking at documentation for an older release. 
  For the latest information, see the 
  <a href="../current/index.html">current release documentation</a>. 
</p>
</div>
<div class="navheader">
<span class="prev">
<a href="audit-index.html">« Index audit output</a>
</span>
<span class="next">
<a href="forwarding-audit-logfiles.html">Forwarding audit logs to a remote cluster »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [6.8]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure a cluster</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="auditing.html">Auditing security events</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Auditing search queries</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.8/x-pack/docs/en/security/auditing/auditing-search-queries.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/deploy-manage/security/logging-configuration/auditing-search-queries">latest documentation</a>.
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="auditing-search-queries"></a>Auditing search queries<a class="xpack_tag" href="/subscriptions"></a></h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/6.8/x-pack/docs/en/security/auditing/auditing-search-queries.asciidoc">edit</a></div>
</div></div></div>
<p>There is no <a class="xref" href="audit-event-types.html" title="Audit event types">audit event type</a> specifically
dedicated to search queries. Search queries are analyzed and then processed; the
processing triggers authorization actions that are audited.
However, the original raw query, as submitted by the client, is not accessible
downstream when authorization auditing occurs.</p>
<p>Search queries are contained inside HTTP request bodies, however, and some
audit events that are generated by the REST layer can be toggled to output
the request body to the audit log.</p>
<p>To make certain audit events include the request body, edit the following
settings in the <code class="literal">elasticsearch.yml</code> file:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>For the <code class="literal">logfile</code> audit output:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.security.audit.logfile.events.emit_request_body: true</pre>
</div>
</li>
<li class="listitem">
<p>For the <code class="literal">index</code> output: <span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.7.0</span>]
<span class="Admonishment-detail">
Deprecated in 6.7.0.
</span>
</span></p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.security.audit.index.events.emit_request_body: true</pre>
</div>
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>No filtering is performed when auditing, so sensitive data might be
audited in plain text when audit events include the request body. Also, the
request body can contain malicious content that can break a parser consuming
the audit logs.</p>
</div>
</div>
<p>There are only a handful of <a class="xref" href="audit-event-types.html" title="Audit event types">audit event types</a> that are
generated in the REST layer and can access the request body. Most of them are not
included by default.</p>
<p>A good practical piece of advice is to add <code class="literal">authentication_success</code> to the event
types that are audited. Add it to the list in the
<code class="literal">xpack.security.audit.logfile.events.include</code> or
<code class="literal">xpack.security.audit.index.events.include</code> settings. This type is not audited
by default.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Typically, the include list contains other event types as well, such as
<code class="literal">access_granted</code> or <code class="literal">access_denied</code>.</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="audit-index.html">« Index audit output</a>
</span>
<span class="next">
<a href="forwarding-audit-logfiles.html">Forwarding audit logs to a remote cluster »</a>
</span>
</div>
</body>
</html>
