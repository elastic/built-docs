<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>elasticsearch-migrate | Elasticsearch Reference [7.10] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.10]"/>
<link rel="up" href="commands.html" title="Command line tools"/>
<link rel="prev" href="elasticsearch-keystore.html" title="elasticsearch-keystore"/>
<link rel="next" href="node-tool.html" title="elasticsearch-node"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.10"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.10"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.10]</a></span>
»
<span class="breadcrumb-link"><a href="commands.html">Command line tools</a></span>
»
<span class="breadcrumb-node">elasticsearch-migrate</span>
</div>
<div class="navheader">
<span class="prev">
<a href="elasticsearch-keystore.html">« elasticsearch-keystore</a>
</span>
<span class="next">
<a href="node-tool.html">elasticsearch-node »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="migrate-tool"></a>elasticsearch-migrate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/commands/migrate-tool.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">7.2.0</span>]
<span class="Admonishment-detail">
Deprecated in 7.2.0. This tool is deprecated. Use the native realm directly.
</span>
</span></p>
<p>The <code class="literal">elasticsearch-migrate</code> command migrates existing file-based users and roles
to the native realm. From 5.0 onward, you should use the <code class="literal">native</code> realm to
manage roles and local users.</p>
<h3><a id="_synopsis_4"></a>Synopsis<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/commands/migrate-tool.asciidoc">edit</a></h3>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch-migrate
(native (-U, --url &lt;url&gt;)
[-h, --help] [-E &lt;KeyValuePair&gt;]
[-n, --users &lt;uids&gt;] [-r, --roles &lt;roles&gt;]
[-u, --username &lt;uid&gt;] [-p, --password &lt;password&gt;]
[-s, --silent] [-v, --verbose])</pre>
</div>
<h3><a id="_description_4"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/commands/migrate-tool.asciidoc">edit</a></h3>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When migrating from Shield 2.x, the <code class="literal">elasticsearch-migrate</code> tool should be
run prior to upgrading to ensure all roles can be migrated as some may be in a
deprecated format that X-Pack cannot read. The <code class="literal">migrate</code> tool is available in
Shield 2.4.0 and higher.</p>
</div>
</div>
<p>The <code class="literal">elasticsearch-migrate</code> tool loads the existing file-based users and roles
and calls the user and roles APIs to add them to the native realm. You can
migrate all users and roles, or specify the ones you want to migrate. Users and
roles that already exist in the <code class="literal">native</code> realm are not replaced or
overridden. If the names you specify with the <code class="literal">--users</code> and <code class="literal">--roles</code> options
don&#8217;t exist in the <code class="literal">file</code> realm, they are skipped.</p>
<h3><a id="migrate-tool-options"></a>Parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/commands/migrate-tool.asciidoc">edit</a></h3>
<p>The <code class="literal">native</code> subcommand supports the following options:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">-E &lt;KeyValuePair&gt;</code>
</span>
</dt>
<dd>
Configures a setting.
</dd>
<dt>
<span class="term">
<code class="literal">-h, --help</code>
</span>
</dt>
<dd>
Returns all of the command parameters.
</dd>
<dt>
<span class="term">
<code class="literal">-n</code>, <code class="literal">--users</code>
</span>
</dt>
<dd>
Comma-separated list of the users that you want to migrate. If this parameter is
not specified, all users are migrated.
</dd>
<dt>
<span class="term">
<code class="literal">-p</code>, <code class="literal">--password</code>
</span>
</dt>
<dd>
Password to use for authentication with Elasticsearch.
</dd>
<dt>
<span class="term">
<code class="literal">-r</code>, <code class="literal">--roles</code>
</span>
</dt>
<dd>
Comma-separated list of the roles that you want to migrate. If this parameter is
not specified, all roles are migrated.
</dd>
<dt>
<span class="term">
<code class="literal">-s, --silent</code>
</span>
</dt>
<dd>
Shows minimal output.
</dd>
<dt>
<span class="term">
<code class="literal">-U</code>, <code class="literal">--url</code>
</span>
</dt>
<dd>
Endpoint URL of the Elasticsearch cluster to which you want to migrate the
file-based users and roles. This parameter is required.
</dd>
<dt>
<span class="term">
<code class="literal">-u</code>, <code class="literal">--username</code>
</span>
</dt>
<dd>
Username to use for authentication with Elasticsearch.
</dd>
<dt>
<span class="term">
<code class="literal">-v, --verbose</code>
</span>
</dt>
<dd>
Shows verbose output.
</dd>
</dl>
</div>
<h3><a id="_examples_6"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.10/docs/reference/commands/migrate-tool.asciidoc">edit</a></h3>
<p>Run the <code class="literal">elasticsearch-migrate</code> tool when X-Pack is installed. For example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ bin/elasticsearch-migrate native -U http://localhost:9200 -u elastic
-p x-pack-test-password -n lee,foo -r role1,role2,role3,role4,foo
starting migration of users and roles...
importing users from [/home/es/config/shield/users]...
found existing users: [test_user, joe3, joe2]
migrating user [lee]
{"user":{"created":true}}
no user [foo] found, skipping
importing roles from [/home/es/config/shield/roles.yml]...
found existing roles: [marvel_user, role_query_fields, admin_role, role3, admin,
remote_marvel_agent, power_user, role_new_format_name_array, role_run_as,
logstash, role_fields, role_run_as1, role_new_format, kibana4_server, user,
transport_client, role1.ab, role_query]
migrating role [role1]
{"role":{"created":true}}
migrating role [role2]
{"role":{"created":true}}
role [role3] already exists, skipping
no role [foo] found, skipping
users and roles imported.</pre>
</div>
<p>Additionally, the <code class="literal">-E</code> flag can be used to specify additional settings. For example
to specify a different configuration directory, the command would look like:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">$ bin/elasticsearch-migrate native -U http://localhost:9200 -u elastic
-p x-pack-test-password -E path.conf=/etc/elasticsearch</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="elasticsearch-keystore.html">« elasticsearch-keystore</a>
</span>
<span class="next">
<a href="node-tool.html">elasticsearch-node »</a>
</span>
</div>
</div>
</body>
</html>
