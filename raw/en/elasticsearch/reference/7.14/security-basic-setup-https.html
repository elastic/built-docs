<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Set up basic security for the Elastic Stack plus secured HTTPS traffic | Elasticsearch Guide [7.14] | Elastic</title>
<meta class="elastic" name="content" content="Set up basic security for the Elastic Stack plus secured HTTPS traffic | Elasticsearch Guide [7.14]">

<link rel="home" href="index.html" title="Elasticsearch Guide [7.14]"/>
<link rel="up" href="configuring-stack-security.html" title="Configure security for the Elastic Stack"/>
<link rel="prev" href="security-basic-setup.html" title="Set up basic security for the Elastic Stack"/>
<link rel="next" href="configuring-tls-docker.html" title="Encrypting communications in an Elasticsearch Docker Container"/>
<meta class="elastic" name="product_version" content="7.14"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.14"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [7.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="configuring-stack-security.html">Configure security for the Elastic Stack</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="security-basic-setup.html">« Set up basic security for the Elastic Stack</a>
</span>
<span class="next">
<a href="configuring-tls-docker.html">Encrypting communications in an Elasticsearch Docker Container »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-basic-setup-https"></a>Set up basic security for the Elastic Stack plus secured HTTPS traffic<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h2>
</div></div></div>

<p>In a production environment, some Elasticsearch features such as tokens and
API keys will be disabled unless you enable TLS on the HTTP layer. This
additional layer of security ensures that all communications to and from your
cluster are secured.</p>
<p>When you run the <code class="literal">elasticsearch-certutil</code> tool in <code class="literal">http</code> mode, the tool asks
several questions about how you want to generate certificates. While there are
numerous options, the following choices result in certificates that should
work for most environments.</p>
<div class="sidebar">
<a id="signing-certificates"></a>
<div class="titlepage"><div><div>
<p class="title"><strong>Signing certificates</strong></p>
</div></div></div>
<p>The first question that the <code class="literal">elasticsearch-certutil</code> tool prompts you with is
whether you want to generate a Certificate Signing Request (CSR). Answer
<code class="literal">n</code> if you want to sign your own certificates, or <code class="literal">y</code> if you want to sign
certificates with a central CA.</p>
<h5><a id="_sign_your_own_certificates"></a>Sign your own certificates<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h5>
<p>If you want to use the CA that you created when
<a class="xref" href="security-basic-setup.html#generate-certificates" title="Generate the certificate authority">Generating the certificate authority</a> answer <code class="literal">n</code> when
asked if you want to generate a CSR. You then specify the location of your CA,
which the tool uses to sign and generate a <code class="literal">.p12</code> certificate. The steps in
this procedure follow this workflow.</p>
<h5><a id="_sign_certificates_with_a_central_ca"></a>Sign certificates with a central CA<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h5>
<p>If you work in an environment with a central security team, they can likely
generate a certificate for you. Infrastructure within your organization
might already be configured to trust an existing CA, so it may be easier
for clients to connect to Elasticsearch if you use a CSR and send that
request to the team that controls your CA. To use a central CA, answer <code class="literal">y</code> to
the first question.</p>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="basic-setup-https-prerequisites"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h3>
</div></div></div>
<p>Complete all steps in <a class="xref" href="security-basic-setup.html" title="Set up basic security for the Elastic Stack">Set up basic security for the Elastic Stack</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encrypt-http-communication"></a>Encrypt HTTP client communications for Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h3>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On <span class="strong strong"><strong>every</strong></span> node in your cluster, stop Elasticsearch and Kibana if they are running.
</li>
<li class="listitem">
<p>On any single node, from the directory where you installed Elasticsearch, run the Elasticsearch
HTTP certificate tool to generate a Certificate Signing Request (CSR).</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil http</pre>
</div>
<p>This command generates a <code class="literal">.zip</code> file that contains certificates and keys
to use with Elasticsearch and Kibana. Each folder contains a <code class="literal">README.txt</code>
explaining how to use these files.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
When asked if you want to generate a CSR, enter <code class="literal">n</code>.
</li>
<li class="listitem">
When asked if you want to use an existing CA, enter <code class="literal">y</code>.
</li>
<li class="listitem">
Enter the path to your CA. This is the absolute path to
the <code class="literal">elastic-stack-ca.p12</code> file that you generated for your cluster.
</li>
<li class="listitem">
Enter the password for your CA.
</li>
<li class="listitem">
Enter an expiration value for your certificate. You can enter the
validity period in years, months, or days. For example, enter <code class="literal">90D</code> for 90
days.
</li>
<li class="listitem">
<p>When asked if you want to generate one certificate per node, enter <code class="literal">y</code>.</p>
<p>Each certificate will have its own private key, and will be issued for a
specific hostname or IP address.</p>
</li>
<li class="listitem">
When prompted, enter the name of the first node in your cluster. Use the same node name that you used when <a class="xref" href="security-basic-setup.html#generate-certificates" title="Generate the certificate authority">generating node certificates</a>.
</li>
<li class="listitem">
<p>Enter all hostnames used to connect to your first node. These hostnames
will be added as DNS names in the Subject Alternative Name (SAN) field in your certificate.</p>
<p>List every hostname and variant used to connect to your cluster over HTTPS.</p>
</li>
<li class="listitem">
Enter the IP addresses that clients can use to connect to your node.
</li>
<li class="listitem">
Repeat these steps for each additional node in your cluster.
</li>
</ol>
</div>
</li>
<li class="listitem">
After generating a certificate for each of your nodes, enter a password for
your private key when prompted.
</li>
<li class="listitem">
<p>Unzip the generated <code class="literal">elasticsearch-ssl-http.zip</code> file. This compressed file
contains one directory for both Elasticsearch and Kibana.</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">/elasticsearch
|_ README.txt
|_ http.p12
|_ sample-elasticsearch.yml</pre>
</div>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">/kibana
|_ README.txt
|_ elasticsearch-ca.pem
|_ sample-kibana.yml</pre>
</div>
</li>
<li class="listitem">
<p>On <span class="strong strong"><strong>every</strong></span> node in your cluster, complete the following steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Copy the relevant <code class="literal">http.p12</code> certificate to the <code class="literal">$ES_PATH_CONF</code> directory.
</li>
<li class="listitem">
<p>Edit the <code class="literal">elasticsearch.yml</code> file to enable HTTPS security and specify the
location of the <code class="literal">http.p12</code> security certificate.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.keystore.path: http.p12</pre>
</div>
</li>
<li class="listitem">
<p>Add the password for your private key to the secure settings in Elasticsearch.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password</pre>
</div>
</li>
<li class="listitem">
Start Elasticsearch.
</li>
</ol>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup-https.html#encrypt-kibana-http" title="Encrypt HTTP client communications for Kibana">Encrypt HTTP client communications for Kibana</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encrypt-kibana-http"></a>Encrypt HTTP client communications for Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h3>
</div></div></div>
<p>Browsers send traffic to Kibana and Kibana sends traffic to Elasticsearch.
These communication channels are configured separately to use TLS. You encrypt
traffic between your browser and Kibana, and then encrypt traffic between
Kibana and Elasticsearch.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="encrypt-kibana-elasticsearch"></a>Encrypt traffic between Kibana and Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h4>
</div></div></div>
<p>When you ran the <code class="literal">elasticsearch-certutil</code> tool with the <code class="literal">http</code> option, it
created a <code class="literal">/kibana</code> directory containing an <code class="literal">elasticsearch-ca.pem</code> file. You
use this file to configure Kibana to trust the Elasticsearch CA for the HTTP
layer.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Copy the <code class="literal">elasticsearch-ca.pem</code> file to the Kibana configuration directory,
as defined by the <code class="literal">$KBN_PATH_CONF</code> path.
</li>
<li class="listitem">
<p>Open <code class="literal">kibana.yml</code> and add the following line to specify the location of the
security certificate for the HTTP layer.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.ssl.certificateAuthorities: $KBN_PATH_CONF/elasticsearch-ca.pem</pre>
</div>
</li>
<li class="listitem">
<p>Add the following line to specify the HTTPS URL for your Elasticsearch
cluster.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.hosts: https://&lt;your_elasticsearch_host&gt;:9200</pre>
</div>
</li>
<li class="listitem">
Restart Kibana.
</li>
</ol>
</div>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Connect to a secure monitoring cluster</strong></p>
</div></div></div>
<p>If the Elastic monitoring features are enabled and you configured a separate
Elasticsearch monitoring cluster, you can also configure Kibana to connect to
the monitoring cluster via HTTPS. The steps are the same, but each setting is
prefixed by <code class="literal">monitoring</code>. For example, <code class="literal">monitoring.ui.elasticsearch.hosts</code> and
<code class="literal">monitoring.ui.elasticsearch.ssl.truststore.path</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must create a separate <code class="literal">elasticsearch-ca.pem</code> security file for the
monitoring cluster.</p>
</div>
</div>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup-https.html#encrypt-kibana-browser" title="Encrypt traffic between your browser and Kibana">Encrypt traffic between your browser and Kibana</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="encrypt-kibana-browser"></a>Encrypt traffic between your browser and Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h4>
</div></div></div>
<p>You create a server certificate and private key for Kibana. Kibana uses this
server certificate and corresponding private key when receiving connections
from web browsers.</p>
<p>When you obtain a server certificate, you must set its subject alternative
name (SAN) correctly to ensure that browsers will trust it. You can set one or
more SANs to the Kibana server’s fully-qualified domain name (FQDN), hostname,
or IP address. When choosing the SAN, pick whichever attribute you&#8217;ll use to
connect to Kibana in your browser, which is likely the FQDN.</p>
<p>The following instructions create a Certificate Signing Request (CSR) for Kibana.
A CSR contains information that a CA uses to generate and sign a security
certificate. The certificate can be trusted (signed by a public, trusted CA)
or untrusted (signed by an internal CA). A self-signed or internally-signed
certificate is acceptable for development environments and building a proof of
concept, but should not be used in a production environment.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Before going to production, use a trusted CA such as <a href="https://letsencrypt.org/" class="ulink" target="_top">Let&#8217;s
Encrypt</a> or your organization&#8217;s internal CA to sign the certificate. Using a
signed certificate establishes browser trust for connections to Kibana for
internal access or on the public internet.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Generate a server certificate and private key for Kibana.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil csr -name kibana-server -dns example.com,www.example.com</pre>
</div>
<p>The CSR has a common name (CN) of <code class="literal">kibana-server</code>, a SAN of <code class="literal">example.com</code>,
and another SAN of <code class="literal">www.example.com</code>.</p>
<p>This command generates a <code class="literal">csr-bundle.zip</code> file by default with the following
contents:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">/kibana-server
|_ kibana-server.csr
|_ kibana-server.key</pre>
</div>
</li>
<li class="listitem">
Unzip the <code class="literal">csr-bundle.zip</code> file to obtain the <code class="literal">kibana-server.csr</code> unsigned
security certificate and the <code class="literal">kibana-server.key</code> unencrypted private key.
</li>
<li class="listitem">
Send the <code class="literal">kibana-server.csr</code> certificate signing request to your internal
CA or trusted CA for signing to obtain a signed certificate. The signed file
can be in different formats, such as a <code class="literal">.crt</code> file like <code class="literal">kibana-server.crt</code>.
</li>
<li class="listitem">
<p>Open <code class="literal">kibana.yml</code> and add the following lines to configure Kibana to access
the server certificate and unencrypted private key.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">server.ssl.certificate: $KBN_PATH_CONF/kibana-server.crt
server.ssl.key: $KBN_PATH_CONF/kibana-server.key</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">$KBN_PATH_CONF</code> contains the path for the Kibana configuration files. If
you installed Kibana using archive distributions (<code class="literal">zip</code> or <code class="literal">tar.gz</code>), the
path defaults to <code class="literal">$KBN_HOME/config</code>. If you used package distributions
(Debian or RPM), the path defaults to <code class="literal">/etc/kibana</code>.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Add the following line to <code class="literal">kibana.yml</code> to enable TLS for inbound
connections.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">server.ssl.enabled: true</pre>
</div>
</li>
<li class="listitem">
Start Kibana.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>After making these changes, you must always access Kibana via HTTPS. For
example, <code class="literal">https://&lt;your_kibana_host&gt;.com</code>.</p>
</div>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup-https.html#configure-beats-security" title="Configure Beats security">Configure Beats security</a></p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="configure-beats-security"></a>Configure Beats security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h3>
</div></div></div>
<p>The Beats are open source data shippers that you install as agents on your
servers to send operational data to Elasticsearch. Each Beat is a separately
installable product. The following steps cover configuring security for
Metricbeat. Follow these steps for each <a href="/guide/en/elastic-stack-get-started/7.9/get-started-elastic-stack.html#install-beats" class="ulink" target="_top">additonal Beat</a> you want to configure security for.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prerequisites_11"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h4>
</div></div></div>
<p><a href="/guide/en/beats/metricbeat/7.9/metricbeat-installation-configuration.html" class="ulink" target="_top">Install Metricbeat</a> using your preferred method.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot connect to the Elastic Stack or set up assets for Metricbeat
before completing the following steps.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_create_roles_for_metricbeat"></a>Create roles for Metricbeat<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h4>
</div></div></div>
<p>Typically, you need to create the following separate roles:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>setup</strong></span> role for setting up index templates and other dependencies
</li>
<li class="listitem">
<span class="strong strong"><strong>monitoring</strong></span> role for sending monitoring information
</li>
<li class="listitem">
<span class="strong strong"><strong>writer</strong></span> role for publishing events collected by Metricbeat
</li>
<li class="listitem">
<span class="strong strong"><strong>reader</strong></span> role for Kibana users who need to view and create visualizations that access Metricbeat data
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>These instructions assume that you are using the default name for
Metricbeat indices. If the indicated index names are not listed, or you are
using a custom name, enter it manually when defining roles and modify the
privileges to match your index naming pattern.</p>
</div>
</div>
<p>To create users and roles from Stack Management in Kibana, select <span class="strong strong"><strong>Roles</strong></span>
or <span class="strong strong"><strong>Users</strong></span> from the side navigation.</p>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup-https.html#beats-setup-role" title="Create a setup role and user">Create a setup role</a></p>
<h6><a id="beats-setup-role"></a>Create a setup role and user<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h6>
<p>Administrators who set up Metricbeat typically need to load mappings,
dashboards, and other objects used to index data into Elasticsearch and visualize it in
Kibana.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Setting up Metricbeat is an admin-level task that requires extra
privileges. As a best practice, grant the setup role to administrators only,
and use a more restrictive role for event publishing.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create the setup role:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_setup</strong></span> as the role name.
</li>
<li class="listitem">
Choose the <span class="strong strong"><strong>monitor</strong></span> and <span class="strong strong"><strong>manage_ilm</strong></span> cluster privileges.
</li>
<li class="listitem">
<p>On the <span class="strong strong"><strong>metricbeat-\</strong></span>* indices, choose the <span class="strong strong"><strong>manage</strong></span> and <span class="strong strong"><strong>write</strong></span>
privileges.</p>
<p>If the <span class="strong strong"><strong>metricbeat-\</strong></span>* indices aren&#8217;t listed, enter that pattern into the
list of indices.</p>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Create the setup user:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_setup</strong></span> as the user name.
</li>
<li class="listitem">
Enter the username, password, and other user details.
</li>
<li class="listitem">
<p>Assign the following roles to the <span class="strong strong"><strong>metricbeat_setup</strong></span> user:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">metricbeat_setup</code></p></td>
<td align="left" valign="top"><p>Set up Metricbeat.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kibana_admin</code></p></td>
<td align="left" valign="top"><p>Load dependencies, such as example dashboards, if available, into Kibana</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ingest_admin</code></p></td>
<td align="left" valign="top"><p>Set up index templates and, if available, ingest pipelines</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup-https.html#beats-monitoring-role" title="Create a monitoring role and user">Create a monitoring role</a></p>
<h6><a id="beats-monitoring-role"></a>Create a monitoring role and user<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h6>
<p>To send monitoring data securely, create a monitoring user and grant it the
necessary privileges.</p>
<p>You can use the built-in <code class="literal">beats_system</code> user, if it’s available in your
environment. Because the built-in users are not available in Elastic Cloud,
these instructions create a user that is explicitly used for monitoring
Metricbeat.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create the monitoring role:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_monitoring</strong></span> as the role name.
</li>
<li class="listitem">
Choose the <span class="strong strong"><strong>monitor</strong></span> cluster privilege.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>.monitoring-beats-\</strong></span>* indices, choose the <span class="strong strong"><strong>create_index</strong></span> and
<span class="strong strong"><strong>create_doc</strong></span> privileges.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Create the monitoring user:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_monitoring</strong></span> as the user name.
</li>
<li class="listitem">
Enter the username, password, and other user details.
</li>
<li class="listitem">
<p>Assign the following roles to the <span class="strong strong"><strong>metricbeat_monitoring</strong></span> user:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">metricbeat_monitoring</code></p></td>
<td align="left" valign="top"><p>Monitor Metricbeat.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kibana_admin</code></p></td>
<td align="left" valign="top"><p>Use Kibana</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">monitoring_user</code></p></td>
<td align="left" valign="top"><p>Use Stack Monitoring in Kibana to monitor Metricbeat</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup-https.html#beats-writer-role" title="Create a writer role and user">Create a writer role</a></p>
<h6><a id="beats-writer-role"></a>Create a writer role and user<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h6>
<p>Users who publish events to Elasticsearch need to create and write to Metricbeat indices. To minimize the privileges required by the writer role, use the setup role to pre-load dependencies. This section assumes that you’ve
<a class="xref" href="security-basic-setup-https.html#beats-setup-role" title="Create a setup role and user">created the setup role</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create the writer role:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_writer</strong></span> as the role name.
</li>
<li class="listitem">
Choose the <span class="strong strong"><strong>monitor</strong></span> and <span class="strong strong"><strong>read_ilm</strong></span> cluster privileges.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>metricbeat-\</strong></span>* indices, choose the <span class="strong strong"><strong>create_doc</strong></span>, <span class="strong strong"><strong>create_index</strong></span>, and <span class="strong strong"><strong>view_index_metadata</strong></span> privileges.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Create the writer user:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_writer</strong></span> as the user name.
</li>
<li class="listitem">
Enter the username, password, and other user details.
</li>
<li class="listitem">
<p>Assign the following roles to the <span class="strong strong"><strong>metricbeat_writer</strong></span> user:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">metricbeat_writer</code></p></td>
<td align="left" valign="top"><p>Monitor Metricbeat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">remote_monitoring_collector</code></p></td>
<td align="left" valign="top"><p>Collect monitoring metrics from Metricbeat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">remote_monitoring_agent</code></p></td>
<td align="left" valign="top"><p>Send monitoring data to the monitoring cluster</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup-https.html#beats-reader-role" title="Create a reader role and user">Create a reader role</a></p>
<h6><a id="beats-reader-role"></a>Create a reader role and user<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h6>
<p>Kibana users typically need to view dashboards and visualizations that contain
Metricbeat data. These users might also need to create and edit dashboards
and visualizations. Create the reader role to assign proper privileges to these
users.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create the reader role:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_reader</strong></span> as the role name.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>metricbeat-\</strong></span>* indices, choose the <span class="strong strong"><strong>read</strong></span> privilege.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Kibana</strong></span>, click <span class="strong strong"><strong>Add Kibana privilege</strong></span>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Under <span class="strong strong"><strong>Spaces</strong></span>, choose <span class="strong strong"><strong>Default</strong></span>.
</li>
<li class="listitem">
Choose <span class="strong strong"><strong>Read</strong></span> or <span class="strong strong"><strong>All</strong></span> for Discover, Visualize, Dashboard, and Metrics.
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Create the reader user:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter <span class="strong strong"><strong>metricbeat_reader</strong></span> as the user name.
</li>
<li class="listitem">
Enter the username, password, and other user details.
</li>
<li class="listitem">
<p>Assign the following roles to the <span class="strong strong"><strong>metricbeat_reader</strong></span> user:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Role</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">metricbeat_reader</code></p></td>
<td align="left" valign="top"><p>Read Metricbeat data.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">monitoring_user</code></p></td>
<td align="left" valign="top"><p>Allow users to monitor the health of Metricbeat
itself. Only assign this role to users who manage Metricbeat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">beats_admin</code></p></td>
<td align="left" valign="top"><p>Create and manage configurations in Beats central
management. Only assign this role to users who need to use Beats central
management.</p></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup-https.html#configure-metricbeat-tls" title="Configure Metricbeat to use TLS">Configure Metricbeat to use TLS</a></p>
<h5><a id="configure-metricbeat-tls"></a>Configure Metricbeat to use TLS<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.14/x-pack/docs/en/security/securing-communications/security-basic-setup-https.asciidoc">edit</a></h5>
<p>Before starting Metricbeat, you configure the connections to Elasticsearch and
Kibana. You can configure authentication to send data to your secured cluster
using basic authentication, API key authentication, or Public Key
Infrastructure (PKI) certificates.</p>
<p>The following instructions use the credentials for the <code class="literal">metricbeat_writer</code>
and <code class="literal">metricbeat_setup</code> users that you created. If you need a greater level of
security, we recommend using PKI certificates.</p>
<p>After configuring connections to Elasticsearch and Kibana, you&#8217;ll enable the
<code class="literal">elasticsearch-xpack</code> module and configure that module to use HTTPS.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>In production environments, we strongly recommend using a separate
cluster (referred to as the monitoring cluster) to store your data. Using a
separate monitoring cluster prevents production cluster outages from impacting
your ability to access your monitoring data. It also prevents monitoring
activities from impacting the performance of your production cluster.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the node where you
<a class="xref" href="security-basic-setup-https.html#encrypt-http-communication" title="Encrypt HTTP client communications for Elasticsearch">generated certificates for the HTTP layer</a>,
navigate to the <code class="literal">/kibana</code> directory.
</li>
<li class="listitem">
Copy the <code class="literal">elasticsearch-ca.pem</code> certificate to the directory where you
installed Metricbeat.
</li>
<li class="listitem">
<p>Open the <code class="literal">metricbeat.yml</code> configuration file and configure the connection
to Elasticsearch.</p>
<p>Under <code class="literal">output.elasticsearch</code>, specify the following fields:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
 hosts: ["&lt;your_elasticsearch_host&gt;:9200"]
 protocol: "https"
 username: "metricbeat_writer"
 password: "&lt;password&gt;"
 ssl:
   certificate_authorities: ["elasticsearch-ca.pem"]
   verification_mode: "certificate"</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">hosts</code>
</span>
</dt>
<dd>
Specifies the host where your Elasticsearch cluster is running.
</dd>
<dt>
<span class="term">
<code class="literal">protocol</code>
</span>
</dt>
<dd>
Indicates the protocol to use when connecting to Elasticsearch.
This value must be <code class="literal">https</code>.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
Name of the user with privileges required to publish events to
Elasticsearch. The <code class="literal">metricbeat_writer</code> user that you created has these
privileges.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
Password for the indicated <code class="literal">username</code>.
</dd>
<dt>
<span class="term">
<code class="literal">certificate_authorities</code>
</span>
</dt>
<dd>
Indicates the path to the local <code class="literal">.pem</code> file that
contains your CA&#8217;s certificate.
</dd>
</dl>
</div>
</li>
<li class="listitem">
<p>Configure the connection to Kibana.</p>
<p>Under <code class="literal">setup.kibana</code>, specify the following fields:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">setup.kibana
 host: "https://&lt;your_elasticsearch_host&gt;:5601"
 ssl.enabled: true
 username: "metricbeat_setup"
 password: "p@ssw0rd"</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">hosts</code>
</span>
</dt>
<dd>
The URLs of the Elasticsearch instances to use for all your
queries. Ensure that you include <code class="literal">https</code> in the URL.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
Name of the user with privileges required to set up dashboards in Kibana. The <code class="literal">metricbeat_setup</code> user that you created has these privileges.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
Password for the indicated <code class="literal">username</code>.
</dd>
</dl>
</div>
</li>
<li class="listitem">
<p>Enable the <code class="literal">elasticsearch-xpack</code> module.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./metricbeat modules enable elasticsearch-xpack</pre>
</div>
</li>
<li class="listitem">
<p>Modify the <code class="literal">elasticsearch-xpack</code> module to use HTTPS. This module collects
metrics about Elasticsearch.</p>
<p>Open <code class="literal">/modules.d/elasticsearch-xpack.yml</code> and specify the following fields:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: elasticsearch
 xpack.enabled: true
 period: 10s
 hosts: ["https://&lt;your_elasticsearch_host&gt;:9200"]
 username: "remote_monitoring_user"
 password: "&lt;password&gt;"
 ssl:     <a id="CO522-1"></a><i class="conum" data-value="1"></i>
   enabled: true
   certificate_authorities: ["elasticsearch-ca.pem"]
   verification_mode: "certificate"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO522-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Configuring SSL is required when monitoring a node with encrypted traffic.
See <a href="/guide/en/beats/metricbeat/7.14/configuration-ssl.html" class="ulink" target="_top">Configure SSL for Metricbeat</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">hosts</code>
</span>
</dt>
<dd>
Specifies the host where your Elasticsearch cluster is running.
Ensure that you include <code class="literal">https</code> in the URL.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
Name of the user with privileges to collect metric data. The
built-in <code class="literal">monitoring_user</code> user has these privileges. Alternatively,
you can create a user and assign it the <code class="literal">monitoring_user</code> role.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
Password for the indicated <code class="literal">username</code>.
</dd>
<dt>
<span class="term">
<code class="literal">certificate_authorities</code>
</span>
</dt>
<dd>
Indicates the path to the local <code class="literal">.pem</code> file that
contains your CA&#8217;s certificate.
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>If you want to use the predefined assets for parsing, indexing, and
visualizing your data, run the following command to load these assets:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./metricbeat setup -e</pre>
</div>
</li>
<li class="listitem">
<p>Start Elasticsearch, and then start Metricbeat.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./metricbeat -e</pre>
</div>
<p><code class="literal">-e</code> is optional and sends output to standard error instead of the configured
log output.</p>
</li>
<li class="listitem">
<p>Log in to Kibana, open the main menu, and click <span class="strong strong"><strong>Stack Monitoring</strong></span>.</p>
<p>You’ll see cluster alerts that require your attention and a summary of the available monitoring metrics for Elasticsearch. Click any of the header links on the available cards to view additional information.</p>
</li>
</ol>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="security-basic-setup.html">« Set up basic security for the Elastic Stack</a>
</span>
<span class="next">
<a href="configuring-tls-docker.html">Encrypting communications in an Elasticsearch Docker Container »</a>
</span>
</div>
</div>
</body>
</html>
