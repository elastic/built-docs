<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create datafeeds API | Elasticsearch Guide [7.3] | Elastic</title>
<meta class="elastic" name="content" content="Create datafeeds API | Elasticsearch Guide [7.3]">

<link rel="home" href="index.html" title="Elasticsearch Guide [7.3]"/>
<link rel="up" href="ml-apis.html" title="Machine learning anomaly detection APIs"/>
<link rel="prev" href="ml-put-calendar.html" title="Create calendar API"/>
<link rel="next" href="ml-put-filter.html" title="Create filter API"/>
<meta class="elastic" name="product_version" content="7.3"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.3"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.3"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [7.3]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-apis.html">Machine learning anomaly detection APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-put-calendar.html">« Create calendar API</a>
</span>
<span class="next">
<a href="ml-put-filter.html">Create filter API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-put-datafeed"></a>Create datafeeds API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>Instantiates a datafeed.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-request"></a>Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _ml/datafeeds/&lt;feed_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-prereqs"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must create an anomaly detection job before you create a datafeed.
</li>
<li class="listitem">
If Elasticsearch security features are enabled, you must have <code class="literal">manage_ml</code> or <code class="literal">manage</code>
cluster privileges to use this API. See
<a class="xref" href="security-privileges.html" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-desc"></a>Description<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>You can associate only one datafeed to each anomaly detection job.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must use Kibana or this API to create a datafeed. Do not put a
datafeed directly to the <code class="literal">.ml-config</code> index using the Elasticsearch index API. If Elasticsearch
security features are enabled, do not give users <code class="literal">write</code> privileges on the
<code class="literal">.ml-config</code> index.
</li>
<li class="listitem">
When Elasticsearch security features are enabled, your datafeed remembers which roles
the user who created it had at the time of creation and runs the query using
those same roles.
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-path-parms"></a>Path parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-request-body"></a>Request body<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, object) If set, the datafeed performs aggregation searches. For more
information, see <a class="xref" href="ml-datafeed-resource.html" title="Datafeed resources">Datafeed resources</a>.
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>
</span>
</dt>
<dd>
(Optional, object) Specifies how data searches are split into time chunks. See
<a class="xref" href="ml-datafeed-resource.html#ml-datafeed-chunking-config" title="Chunking configuration objects">Chunking configuration objects</a>.
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>
</span>
</dt>
<dd>
(Optional, object) Specifies whether the data feed checks for missing data and
the size of the window. See <a class="xref" href="ml-datafeed-resource.html#ml-datafeed-delayed-data-check-config" title="Delayed data check configuration objects">Delayed data check configuration objects</a>.
</dd>
<dt>
<span class="term">
<code class="literal">frequency</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>) The interval at which scheduled queries
are made while the datafeed runs in real time. The default value is either the
bucket span for short bucket spans, or, for longer bucket spans, a sensible
fraction of the bucket span. For example: <code class="literal">150s</code>.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
<p>
(Required, array) An array of index names. Wildcards are supported. For
example: <code class="literal">["it_ops_metrics", "server*"]</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If any indices are in remote clusters then <code class="literal">cluster.remote.connect</code> must
not be set to <code class="literal">false</code> on any ML node.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(Required, string) A numerical character string that uniquely identifies the
anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object) The Elasticsearch query domain-specific language (DSL). This value
corresponds to the query object in an Elasticsearch search POST body. All the options
that are supported by Elasticsearch can be used, as this object is passed verbatim to
Elasticsearch. By default, this property has the following value:
<code class="literal">{"match_all": {"boost": 1}}</code>.
</dd>
<dt>
<span class="term">
<code class="literal">query_delay</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>) The number of seconds behind real time
that data is queried. For example, if data from 10:04 a.m. might not be
searchable in Elasticsearch until 10:06 a.m., set this property to 120 seconds. The
default value is <code class="literal">60s</code>.
</dd>
<dt>
<span class="term">
<code class="literal">script_fields</code>
</span>
</dt>
<dd>
(Optional, object) Specifies scripts that evaluate custom expressions and
returns script fields to the datafeed. The
<a class="xref" href="ml-job-resource.html#ml-detectorconfig" title="Detector Configuration Objects">detector configuration objects</a> in a job can contain
functions that use these script fields. For more information, see
<a class="xref" href="search-request-body.html#request-body-search-script-fields" title="Script Fields">Script fields</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, unsigned integer) The <code class="literal">size</code> parameter that is used in Elasticsearch
searches. The default value is <code class="literal">1000</code>.
</dd>
</dl>
</div>
<p>For more information about these properties,
see <a class="xref" href="ml-datafeed-resource.html" title="Datafeed resources">Datafeed resources</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-datafeed-example"></a>Examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/put-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example creates the <code class="literal">datafeed-total-requests</code> datafeed:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _ml/datafeeds/datafeed-total-requests
{
  "job_id": "total-requests",
  "indices": ["server-metrics"]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1550.console"></div>
<p>When the datafeed is created, you receive the following results:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "datafeed_id": "datafeed-total-requests",
  "job_id": "total-requests",
  "query_delay": "83474ms",
  "indices": [
    "server-metrics"
  ],
  "query": {
    "match_all": {
      "boost": 1.0
    }
  },
  "scroll_size": 1000,
  "chunking_config": {
    "mode": "auto"
  }
}</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ml-put-calendar.html">« Create calendar API</a>
</span>
<span class="next">
<a href="ml-put-filter.html">Create filter API »</a>
</span>
</div>
</div>
</body>
</html>
