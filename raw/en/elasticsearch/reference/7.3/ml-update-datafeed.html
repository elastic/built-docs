<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Update datafeeds API | Elasticsearch Reference [7.3] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.3]"/>
<link rel="up" href="ml-apis.html" title="Machine learning anomaly detection APIs"/>
<link rel="prev" href="ml-stop-datafeed.html" title="Stop datafeeds API"/>
<link rel="next" href="ml-update-filter.html" title="Update filter API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.3"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.3"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.3]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="ml-apis.html">Machine learning anomaly detection APIs</a></span>
»
<span class="breadcrumb-node">Update datafeeds API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-stop-datafeed.html">« Stop datafeeds API</a>
</span>
<span class="next">
<a href="ml-update-filter.html">Update filter API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-update-datafeed"></a>Update datafeeds API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>Updates certain properties of a datafeed.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-request"></a>Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/datafeeds/&lt;feed_id&gt;/_update</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-prereqs"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If Elasticsearch security features are enabled, you must have <code class="literal">manage_ml</code>, or <code class="literal">manage</code>
cluster privileges to use this API. See
<a class="xref" href="security-privileges.html" title="Security privileges">Security privileges</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-desc"></a>Description<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>If you update a datafeed property, you must stop and start the datafeed for the
change to be applied.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When Elasticsearch security features are enabled, your datafeed remembers
which roles the user who updated it had at the time of update and runs the query
using those same roles.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-path-parms"></a>Path parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;feed_id&gt;</code>
</span>
</dt>
<dd>
(Required, string) Identifier for the datafeed.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-request-body"></a>Request body<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>The following properties can be updated after the datafeed is created:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, object) If set, the datafeed performs aggregation searches. For more
information, see <a class="xref" href="ml-datafeed-resource.html" title="Datafeed resources">Datafeed resources</a>.
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>
</span>
</dt>
<dd>
(Optional, object) Specifies how data searches are split into time chunks. See
<a class="xref" href="ml-datafeed-resource.html#ml-datafeed-chunking-config" title="Chunking configuration objects">Chunking configuration objects</a>.
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>
</span>
</dt>
<dd>
(Optional, object) Specifies whether the data feed checks for missing data and
the size of the window. See <a class="xref" href="ml-datafeed-resource.html#ml-datafeed-delayed-data-check-config" title="Delayed data check configuration objects">Delayed data check configuration objects</a>.
</dd>
<dt>
<span class="term">
<code class="literal">frequency</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>) The interval at which scheduled queries
are made while the datafeed runs in real time. The default value is either the
bucket span for short bucket spans, or, for longer bucket spans, a sensible
fraction of the bucket span. For example: <code class="literal">150s</code>.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
(Optional, array) An array of index names. Wildcards are supported. For
example: <code class="literal">["it_ops_metrics", "server*"]</code>.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
<p>
(Optional, object) The Elasticsearch query domain-specific language (DSL). This value
corresponds to the query object in an Elasticsearch search POST body. All the options
that are supported by Elasticsearch can be used, as this object is passed verbatim to
Elasticsearch. By default, this property has the following value:
<code class="literal">{"match_all": {"boost": 1}}</code>.
</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you change the query, then the analyzed data will also be changed,
therefore the required time to learn might be long and the understandability of
the results is unpredictable.
If you want to make significant changes to the source data, we would recommend
you clone it and create a second job containing the amendments. Let both run in
parallel and close one when you are satisfied with the results of the other job.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">query_delay</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="common-options.html#time-units" title="Time units">time units</a>) The number of seconds behind real-time
that data is queried. For example, if data from 10:04 a.m. might not be
searchable in Elasticsearch until 10:06 a.m., set this property to 120 seconds. The
default value is <code class="literal">60s</code>.
</dd>
<dt>
<span class="term">
<code class="literal">script_fields</code>
</span>
</dt>
<dd>
(Optional, object) Specifies scripts that evaluate custom expressions and
returns script fields to the datafeed. The
<a class="xref" href="ml-job-resource.html#ml-detectorconfig" title="Detector Configuration Objects">detector configuration objects</a> in a job can contain
functions that use these script fields. For more information, see
<a class="xref" href="search-request-body.html#request-body-search-script-fields" title="Script Fields">Script fields</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, unsigned integer) The <code class="literal">size</code> parameter that is used in Elasticsearch
searches. The default value is <code class="literal">1000</code>.
</dd>
</dl>
</div>
<p>For more information about these properties, see <a class="xref" href="ml-datafeed-resource.html" title="Datafeed resources">Datafeed resources</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-update-datafeed-example"></a>Examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.3/docs/reference/ml/anomaly-detection/apis/update-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example updates the query for the <code class="literal">datafeed-total-requests</code>
datafeed so that only log entries of error level are analyzed:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/datafeeds/datafeed-total-requests/_update
{
  "query": {
    "term": {
      "level": "error"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1588.console"></div>
<p>When the datafeed is updated, you receive the full datafeed configuration with
with the updated values:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "datafeed_id": "datafeed-total-requests",
  "job_id": "total-requests",
  "query_delay": "83474ms",
  "indices": ["server-metrics"],
  "query": {
    "term": {
      "level": {
        "value": "error",
        "boost": 1.0
      }
    }
  },
  "scroll_size": 1000,
  "chunking_config": {
    "mode": "auto"
  }
}</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ml-stop-datafeed.html">« Stop datafeeds API</a>
</span>
<span class="next">
<a href="ml-update-filter.html">Update filter API »</a>
</span>
</div>
</div>
</body>
</html>
