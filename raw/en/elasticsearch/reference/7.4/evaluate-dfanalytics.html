<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Evaluate data frame analytics API | Elasticsearch Reference [7.4] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.4]"/>
<link rel="up" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"/>
<link rel="prev" href="delete-dfanalytics.html" title="Delete data frame analytics jobs API"/>
<link rel="next" href="estimate-memory-usage-dfanalytics.html" title="Estimate memory usage API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.4"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.4"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.4]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="ml-df-analytics-apis.html">Machine learning data frame analytics APIs</a></span>
»
<span class="breadcrumb-node">Evaluate data frame analytics API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="delete-dfanalytics.html">« Delete data frame analytics jobs API</a>
</span>
<span class="next">
<a href="estimate-memory-usage-dfanalytics.html">Estimate memory usage API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="evaluate-dfanalytics"></a>Evaluate data frame analytics API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>Evaluates the data frame analytics for an annotated index.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-request"></a>Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/data_frame/_evaluate</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-prereq"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You must have <code class="literal">monitor_ml</code> privilege to use this API. For more
information, see <a class="xref" href="security-privileges.html" title="Security privileges">Security privileges</a> and <a class="xref" href="built-in-roles.html" title="Built-in roles">Built-in roles</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-desc"></a>Description<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p>The API packages together commonly used evaluation metrics for various types of
machine learning features. This has been designed for use on indexes created by
data frame analytics. Evaluation requires both a ground truth field and an analytics
result field to be present.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-request-body"></a>Request body<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Required, object) Defines the <code class="literal">index</code> in which the evaluation will be
performed.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object) A query clause that retrieves a subset of data from the
source index. See <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL</a>.
</dd>
<dt>
<span class="term">
<code class="literal">evaluation</code>
</span>
</dt>
<dd>
<p>
(Required, object) Defines the type of evaluation you want to perform. See
<a class="xref" href="ml-evaluate-dfanalytics-resources.html" title="Data frame analytics evaluation resources">Data frame analytics evaluation resources</a>.
</p>
<p>Available evaluation types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">binary_soft_classification</code>
</li>
<li class="listitem">
<code class="literal">regression</code>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-evaluate-dfanalytics-example"></a>Examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_binary_soft_classification"></a>Binary soft classification<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
  "index": "my_analytics_dest_index",
  "evaluation": {
    "binary_soft_classification": {
      "actual_field": "is_outlier",
      "predicted_probability_field": "ml.outlier_score"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1710.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "binary_soft_classification": {
    "auc_roc": {
      "score": 0.92584757746414444
    },
    "confusion_matrix": {
      "0.25": {
          "tp": 5,
          "fp": 9,
          "tn": 204,
          "fn": 5
      },
      "0.5": {
          "tp": 1,
          "fp": 5,
          "tn": 208,
          "fn": 9
      },
      "0.75": {
          "tp": 0,
          "fp": 4,
          "tn": 209,
          "fn": 10
      }
    },
    "precision": {
        "0.25": 0.35714285714285715,
        "0.5": 0.16666666666666666,
        "0.75": 0
    },
    "recall": {
        "0.25": 0.5,
        "0.5": 0.1,
        "0.75": 0
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_regression_2"></a>Regression<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ml/df-analytics/apis/evaluate-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
  "index": "house_price_predictions", <a id="CO582-1"></a><i class="conum" data-value="1"></i>
  "query": {
      "bool": {
        "filter": [
          { "term":  { "ml.is_training": false } } <a id="CO582-2"></a><i class="conum" data-value="2"></i>
        ]
      }
  },
  "evaluation": {
    "regression": {
      "actual_field": "price", <a id="CO582-3"></a><i class="conum" data-value="3"></i>
      "predicted_field": "ml.price_prediction", <a id="CO582-4"></a><i class="conum" data-value="4"></i>
      "metrics": {
        "r_squared": {},
        "mean_squared_error": {}
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1711.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The output destination index from a data frame analytics regression analysis.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>In this example, a test/train split (<code class="literal">training_percent</code>) was defined for the
regression analysis. This query limits evaluation to be performed on the test split
only.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The ground truth value for the actual house price. This is required in order
to evaluate results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO582-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The predicted value for house price calculated by the regression analysis.</p>
</td>
</tr>
</table>
</div>
<p>The following example calculates the training error:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
  "index": "student_performance_mathematics_reg",
  "query": {
    "term": {
      "ml.is_training": {
        "value": true <a id="CO583-1"></a><i class="conum" data-value="1"></i>
      }
    }
  },
  "evaluation": {
    "regression": {
      "actual_field": "G3", <a id="CO583-2"></a><i class="conum" data-value="2"></i>
      "predicted_field": "ml.G3_prediction", <a id="CO583-3"></a><i class="conum" data-value="3"></i>
      "metrics": {
        "r_squared": {},
        "mean_squared_error": {}
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1712.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO583-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>In this example, a test/train split (<code class="literal">training_percent</code>) was defined for the
regression analysis. This query limits evaluation to be performed on the train split
only. It means that a training error will be calculated.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO583-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the ground truth value for the actual student
performance. This is required in order to evaluate results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO583-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the predicted value for student performance
calculated by the regression analysis.</p>
</td>
</tr>
</table>
</div>
<p>The next example calculates the testing error. The only difference compared with
the previous example is that <code class="literal">ml.is_training</code> is set to <code class="literal">false</code> this time, so
the query excludes the train split from the evaluation.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
  "index": "student_performance_mathematics_reg",
  "query": {
    "term": {
      "ml.is_training": {
        "value": false <a id="CO584-1"></a><i class="conum" data-value="1"></i>
      }
    }
  },
  "evaluation": {
    "regression": {
      "actual_field": "G3", <a id="CO584-2"></a><i class="conum" data-value="2"></i>
      "predicted_field": "ml.G3_prediction", <a id="CO584-3"></a><i class="conum" data-value="3"></i>
      "metrics": {
        "r_squared": {},
        "mean_squared_error": {}
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1713.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO584-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>In this example, a test/train split (<code class="literal">training_percent</code>) was defined for the
regression analysis. This query limits evaluation to be performed on the test split
only. It means that a testing error will be calculated.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO584-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the ground truth value for the actual student
performance. This is required in order to evaluate results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO584-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the predicted value for student performance
calculated by the regression analysis.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="delete-dfanalytics.html">« Delete data frame analytics jobs API</a>
</span>
<span class="next">
<a href="estimate-memory-usage-dfanalytics.html">Estimate memory usage API »</a>
</span>
</div>
</div>
</body>
</html>
