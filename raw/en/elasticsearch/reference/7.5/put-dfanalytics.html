<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create data frame analytics jobs API | Elasticsearch Reference [7.5] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.5]"/>
<link rel="up" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"/>
<link rel="prev" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"/>
<link rel="next" href="delete-dfanalytics.html" title="Delete data frame analytics jobs API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.5"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.5"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.5]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="ml-df-analytics-apis.html">Machine learning data frame analytics APIs</a></span>
»
<span class="breadcrumb-node">Create data frame analytics jobs API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-df-analytics-apis.html">« Machine learning data frame analytics APIs</a>
</span>
<span class="next">
<a href="delete-dfanalytics.html">Delete data frame analytics jobs API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="put-dfanalytics"></a>Create data frame analytics jobs API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>Instantiates a data frame analytics job.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-request"></a>Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _ml/data_frame/analytics/&lt;data_frame_analytics_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-prereq"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p>If the Elasticsearch security features are enabled, you must have the following
built-in roles and privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">machine_learning_admin</code>
</li>
<li class="listitem">
<code class="literal">kibana_user</code> (UI only)
</li>
<li class="listitem">
source index: <code class="literal">read</code>, <code class="literal">view_index_metadata</code>
</li>
<li class="listitem">
destination index: <code class="literal">read</code>, <code class="literal">create_index</code>, <code class="literal">manage</code> and <code class="literal">index</code>
</li>
<li class="listitem">
cluster: <code class="literal">monitor</code> (UI only)
</li>
</ul>
</div>
<p>For more information, see <a class="xref" href="security-privileges.html" title="Security privileges">Security privileges</a> and <a class="xref" href="built-in-roles.html" title="Built-in roles">Built-in roles</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-desc"></a>Description<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<p>This API creates a data frame analytics job that performs an analysis on the source
index and stores the outcome in a destination index.</p>
<p>The destination index will be automatically created if it does not exist. The
<code class="literal">index.number_of_shards</code> and <code class="literal">index.number_of_replicas</code> settings of the source
index will be copied over the destination index. When the source index matches
multiple indices, these settings will be set to the maximum values found in the
source indices.</p>
<p>The mappings of the source indices are also attempted to be copied over
to the destination index, however, if the mappings of any of the fields don&#8217;t
match among the source indices, the attempt will fail with an error message.</p>
<p>If the destination index already exists, then it will be use as is. This makes
it possible to set up the destination index in advance with custom settings
and mappings.</p>
<h5><a id="ml-hyperparam-optimization"></a>Hyperparameter optimization<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h5>
<p>If you don&#8217;t supply regression or classification parameters, <em>hyperparameter
optimization</em> occurs, which sets a value for the undefined parameters. The
starting point is calculated for data dependent parameters by examining the loss
on the training data. Subject to the size constraint, this operation provides an
upper bound on the improvement in validation loss.</p>
<p>A fixed number of rounds is used for optimization which depends on the number of
parameters being optimized. The optimization starts with random search, then
Bayesian optimization is performed that is targeting maximum expected
improvement. If you override any parameters by explicitely setting it, the
optimization calculates the value of the remaining parameters accordingly and
uses the value you provided for the overridden parameter. The number of rounds
are reduced respectively. The validation error is estimated in each round by
using 4-fold cross validation.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-path-params"></a>Path parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;data_frame_analytics_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the data frame analytics job. This identifier can contain lowercase
alphanumeric characters (a-z and 0-9), hyphens, and underscores. It must start
and end with alphanumeric characters.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-request-body"></a>Request body<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_lazy_start</code>
</span>
</dt>
<dd>
(Optional, boolean)
Whether this job should be allowed to start when there is insufficient machine learning node
capacity for it to be immediately assigned to a node. The default is <code class="literal">false</code>,
which means that the <a class="xref" href="start-dfanalytics.html" title="Start data frame analytics jobs API">Start data frame analytics jobs</a> will return an error if a machine learning node
with capacity to run the job cannot immediately be found. (However, this is also
subject to the cluster-wide <code class="literal">xpack.ml.max_lazy_ml_nodes</code> setting - see
<a class="xref" href="ml-settings.html#advanced-ml-settings" title="Advanced machine learning settings">Advanced machine learning settings</a>.) If this option is set to <code class="literal">true</code> then the
<a class="xref" href="start-dfanalytics.html" title="Start data frame analytics jobs API">Start data frame analytics jobs</a> will not return an error, and the job will wait in the
<code class="literal">starting</code> state until sufficient machine learning node capacity is available.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The analysis configuration, which contains the information necessary to perform
one of the following types of analysis: classification, outlier detection, or
regression.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>
</span>
</dt>
<dd>
<p>
(Required<sup>*</sup>, object)
The configuration information necessary to perform
<a href="/guide/en/machine-learning/7.5/dfa-classification.html" class="ulink" target="_top">classification</a>.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Advanced parameters are for fine-tuning classification analysis. They are set
automatically by <a class="xref" href="put-dfanalytics.html#ml-hyperparam-optimization" title="Hyperparameter optimization">hyperparameter optimization</a>
to give minimum validation error. It is highly recommended to use the default
values unless you fully understand the function of these parameters.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">dependent_variable</code>
</span>
</dt>
<dd>
<p>
(Required, string)
</p>
<p>Defines which field of the document is to be predicted.
This parameter is supplied by field name and must match one of the fields in
the index being used to train. If this field is missing from a document, then
that document will not be used for training, but a prediction with the trained
model will be generated for it. It is also known as continuous target variable.</p>
<p>The data type of the field must be numeric (<code class="literal">integer</code>, <code class="literal">short</code>, <code class="literal">long</code>, <code class="literal">byte</code>),
categorical (<code class="literal">ip</code> or <code class="literal">keyword</code>), or boolean.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">eta</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. The shrinkage applied to the weights. Smaller
values result in larger forests which have better generalization error. However,
the smaller the value the longer the training will take. For more information,
about shrinkage, see
<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Shrinkage" class="ulink" target="_top">this wiki article</a>.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">feature_bag_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Defines the fraction of features that will be
used when selecting a random bag for each candidate split.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">maximum_number_trees</code>
</span>
</dt>
<dd>
(Optional, integer)
Advanced configuration option. Defines the maximum number of trees the forest is
allowed to contain. The maximum value is 2000.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">gamma</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Regularization parameter to prevent overfitting
on the training dataset. Multiplies a linear penalty associated with the size of
individual trees in the forest. The higher the value the more training will
prefer smaller trees. The smaller this parameter the larger individual trees
will be and the longer train will take.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">lambda</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Regularization parameter to prevent overfitting
on the training dataset. Multiplies an L2 regularisation term which applies to
leaf weights of the individual trees in the forest. The higher the value the
more training will attempt to keep leaf weights small. This makes the prediction
function smoother at the expense of potentially not being able to capture
relevant relationships between the features and the dependent variable. The smaller this
parameter the larger individual trees will be and the longer train will take.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">num_top_classes</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines the number of categories for which the predicted
probabilities are reported. It must be non-negative. If it is greater than the
total number of categories (in the 7.5.2 version of the Elastic Stack, it&#8217;s two)
to predict then we will report all category probabilities. Defaults to 2.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">prediction_field_name</code>
</span>
</dt>
<dd>
(Optional, string)
Defines the name of the prediction field in the results.
Defaults to <code class="literal">&lt;dependent_variable&gt;_prediction</code>.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">classification</code>.<code class="literal">training_percent</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines what percentage of the eligible documents that will
be used for training. Documents that are ignored by the analysis (for example
those that contain arrays with more than one value) won’t be included in the
calculation for used percentage. Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">outlier_detection</code>
</span>
</dt>
<dd>
<p>
(Required<sup>*</sup>, object)
The configuration information necessary to perform
<a href="/guide/en/machine-learning/7.5/dfa-outlier-detection.html" class="ulink" target="_top">outlier detection</a>:
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">outlier_detection</code>.<code class="literal">compute_feature_influence</code>
</span>
</dt>
<dd>
(Optional, boolean)
If <code class="literal">true</code>, the feature influence calculation is enabled. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">outlier_detection</code>.<code class="literal">feature_influence_threshold</code>
</span>
</dt>
<dd>
(Optional, double)
The minimum outlier score that a document needs to have in order to calculate its
feature influence score. Value range: 0-1 (<code class="literal">0.1</code> by default).
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">outlier_detection</code>.<code class="literal">method</code>
</span>
</dt>
<dd>
(Optional, string)
Sets the method that outlier detection uses. If the method is not set outlier detection
uses an ensemble of different methods and normalises and combines their
individual outlier scores to obtain the overall outlier score. We recommend to use the
ensemble method. Available methods are <code class="literal">lof</code>, <code class="literal">ldof</code>, <code class="literal">distance_kth_nn</code>,
<code class="literal">distance_knn</code>.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">outlier_detection</code>.<code class="literal">n_neighbors</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines the value for how many nearest neighbors each method of
outlier detection will use to calculate its outlier score. When the value is not set,
different values will be used for different ensemble members. This helps
improve diversity in the ensemble. Therefore, only override this if you are
confident that the value you choose is appropriate for the data set.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">outlier_detection</code>.<code class="literal">outlier_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
Sets the proportion of the data set that is assumed to be outlying prior to
outlier detection. For example, 0.05 means it is assumed that 5% of values are real
outliers and 95% are inliers.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">outlier_detection</code>.<code class="literal">standardization_enabled</code>
</span>
</dt>
<dd>
(Optional, boolean)
If <code class="literal">true</code>, then the following operation is performed on the columns before
computing outlier scores: (x_i - mean(x_i)) / sd(x_i). Defaults to <code class="literal">true</code>. For
more information, see
<a href="https://en.wikipedia.org/wiki/Feature_scaling#Standardization_(Z-score_Normalization)" class="ulink" target="_top">this wiki page about standardization</a>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>
</span>
</dt>
<dd>
<p>
(Required<sup>*</sup>, object)
The configuration information necessary to perform
<a href="/guide/en/machine-learning/7.5/dfa-regression.html" class="ulink" target="_top">regression</a>.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Advanced parameters are for fine-tuning regression analysis. They are set
automatically by <a class="xref" href="put-dfanalytics.html#ml-hyperparam-optimization" title="Hyperparameter optimization">hyperparameter optimization</a>
to give minimum validation error. It is highly recommended to use the default
values unless you fully understand the function of these parameters.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>.<code class="literal">dependent_variable</code>
</span>
</dt>
<dd>
<p>
(Required, string)
</p>
<p>Defines which field of the document is to be predicted.
This parameter is supplied by field name and must match one of the fields in
the index being used to train. If this field is missing from a document, then
that document will not be used for training, but a prediction with the trained
model will be generated for it. It is also known as continuous target variable.</p>
<p>The data type of the field must be numeric.</p>
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>.<code class="literal">eta</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. The shrinkage applied to the weights. Smaller
values result in larger forests which have better generalization error. However,
the smaller the value the longer the training will take. For more information,
about shrinkage, see
<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Shrinkage" class="ulink" target="_top">this wiki article</a>.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>.<code class="literal">feature_bag_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Defines the fraction of features that will be
used when selecting a random bag for each candidate split.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>.<code class="literal">maximum_number_trees</code>
</span>
</dt>
<dd>
(Optional, integer)
Advanced configuration option. Defines the maximum number of trees the forest is
allowed to contain. The maximum value is 2000.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>.<code class="literal">gamma</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Regularization parameter to prevent overfitting
on the training dataset. Multiplies a linear penalty associated with the size of
individual trees in the forest. The higher the value the more training will
prefer smaller trees. The smaller this parameter the larger individual trees
will be and the longer train will take.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>.<code class="literal">lambda</code>
</span>
</dt>
<dd>
(Optional, double)
Advanced configuration option. Regularization parameter to prevent overfitting
on the training dataset. Multiplies an L2 regularisation term which applies to
leaf weights of the individual trees in the forest. The higher the value the
more training will attempt to keep leaf weights small. This makes the prediction
function smoother at the expense of potentially not being able to capture
relevant relationships between the features and the dependent variable. The smaller this
parameter the larger individual trees will be and the longer train will take.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>.<code class="literal">prediction_field_name</code>
</span>
</dt>
<dd>
(Optional, string)
Defines the name of the prediction field in the results.
Defaults to <code class="literal">&lt;dependent_variable&gt;_prediction</code>.
</dd>
<dt>
<span class="term">
<code class="literal">analysis</code>.<code class="literal">regression</code>.<code class="literal">training_percent</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines what percentage of the eligible documents that will
be used for training. Documents that are ignored by the analysis (for example
those that contain arrays with more than one value) won’t be included in the
calculation for used percentage. Defaults to <code class="literal">100</code>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">analyzed_fields</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specify <code class="literal">includes</code> and/or <code class="literal">excludes</code> patterns to select which fields will be
included in the analysis. The patterns specified in <code class="literal">excludes</code> are applied last,
therefore <code class="literal">excludes</code> takes precedence. In other words, if the same field is
specified in both <code class="literal">includes</code> and <code class="literal">excludes</code>, then the field will not be included
in the analysis.
</p>
<p>The supported fields for each type of analysis are as follows:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Outlier detection requires numeric or boolean data to analyze. The algorithms
don&#8217;t support missing values therefore fields that have data types other than
numeric or boolean are ignored. Documents where included fields contain missing
values, null values, or an array are also ignored. Therefore the <code class="literal">dest</code> index
may contain documents that don&#8217;t have an outlier score.
</li>
<li class="listitem">
Regression supports fields that are numeric, <code class="literal">boolean</code>, <code class="literal">text</code>,
<code class="literal">keyword</code>, and <code class="literal">ip</code>. It is also tolerant of missing values. Fields that are
supported are included in the analysis, other fields are ignored. Documents
where included fields contain  an array with two or more values are also
ignored. Documents in the <code class="literal">dest</code> index  that don’t contain a results field are
not included in the regression analysis.
</li>
<li class="listitem">
Classification supports fields that are numeric, <code class="literal">boolean</code>, <code class="literal">text</code>,
<code class="literal">keyword</code>, and <code class="literal">ip</code>. It is also tolerant of missing values. Fields that are
supported are included in the analysis, other fields are ignored. Documents
where included fields contain an array with two or more values are also ignored.
Documents in the <code class="literal">dest</code> index that don’t contain a results field are not
included in the classification analysis. Classification analysis can be improved by mapping
ordinal variable values to a  single number. For example, in case of age ranges,
you can model the values as "0-14" = 0, "15-24" = 1, "25-34" = 2, and so on.
If <code class="literal">analyzed_fields</code> is not set, only the relevant fields will be included. For
example, all the numeric fields for outlier detection.
</li>
</ul>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">analyzed_fields</code>.<code class="literal">excludes</code>
</span>
</dt>
<dd>
(Optional, array)
An array of strings that defines the fields that will be excluded from the
analysis. You do not need to add fields with unsupported data types to
<code class="literal">excludes</code>, these fields are excluded from the analysis automatically.
</dd>
<dt>
<span class="term">
<code class="literal">analyzed_fields</code>.<code class="literal">includes</code>
</span>
</dt>
<dd>
(Optional, array)
An array of strings that defines the fields that will be included in the analysis.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string)
A description of the job.
</dd>
<dt>
<span class="term">
<code class="literal">dest</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The destination configuration, consisting of <code class="literal">index</code> and
optionally <code class="literal">results_field</code> (<code class="literal">ml</code> by default).
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Required, string) Defines the <em>destination index</em> to store the results of
the data frame analytics job.
</dd>
<dt>
<span class="term">
<code class="literal">results_field</code>
</span>
</dt>
<dd>
(Optional, string) Defines the name of the field in which to store the
results of the analysis. Default to <code class="literal">ml</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">model_memory_limit</code>
</span>
</dt>
<dd>
(Optional, string)
The approximate maximum amount of memory resources that are permitted for
analytical processing. The default value for data frame analytics jobs is <code class="literal">1gb</code>. If
your <code class="literal">elasticsearch.yml</code> file contains an <code class="literal">xpack.ml.max_model_memory_limit</code>
setting, an error occurs when you try to create data frame analytics jobs that have
<code class="literal">model_memory_limit</code> values greater than that setting. For more information, see
<a class="xref" href="ml-settings.html" title="Machine learning settings in Elasticsearch">Machine learning settings</a>.
</dd>
<dt>
<span class="term">
<code class="literal">source</code>
</span>
</dt>
<dd>
<p>
(object)
The configuration of how to source the analysis data. It requires an
<code class="literal">index</code>. Optionally, <code class="literal">query</code> and <code class="literal">_source</code> may be specified.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Required, string or array) Index or indices on which to perform the
analysis. It can be a single index or index pattern as well as an array of
indices or patterns.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object) The Elasticsearch query domain-specific language
(<a class="xref" href="query-dsl.html" title="Query DSL">DSL</a>). This value corresponds to the query object in an Elasticsearch
search POST body. All the options that are supported by Elasticsearch can be used,
as this object is passed verbatim to Elasticsearch. By default, this property has
the following value: <code class="literal">{"match_all": {}}</code>.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
<p>
(Optional, object) Specify <code class="literal">includes</code> and/or <code class="literal">excludes</code> patterns to select
which fields will be present in the destination. Fields that are excluded
cannot be included in the analysis.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">includes</code>
</span>
</dt>
<dd>
(array) An array of strings that defines the fields that will be
included in the destination.
</dd>
<dt>
<span class="term">
<code class="literal">excludes</code>
</span>
</dt>
<dd>
(array) An array of strings that defines the fields that will be
excluded from the destination.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-put-dfanalytics-example"></a>Examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-put-dfanalytics-example-preprocess"></a>Preprocessing actions example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example shows how to limit the scope of the analysis to certain
fields, specify excluded fields in the destination index, and use a query to
filter your data before analysis.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/model-flight-delays-pre
{
  "source": {
    "index": [
      "kibana_sample_data_flights" <a id="CO586-1"></a><i class="conum" data-value="1"></i>
    ],
    "query": { <a id="CO586-2"></a><i class="conum" data-value="2"></i>
      "range": {
        "DistanceKilometers": {
          "gt": 0
        }
      }
    },
    "_source": { <a id="CO586-3"></a><i class="conum" data-value="3"></i>
      "includes": [],
      "excludes": [
        "FlightDelay",
        "FlightDelayType"
      ]
    }
  },
  "dest": { <a id="CO586-4"></a><i class="conum" data-value="4"></i>
    "index": "df-flight-delays",
    "results_field": "ml-results"
  },
  "analysis": {
  "regression": {
    "dependent_variable": "FlightDelayMin",
    "training_percent": 90
    }
  },
  "analyzed_fields": { <a id="CO586-5"></a><i class="conum" data-value="5"></i>
    "includes": [],
    "excludes": [
      "FlightNum"
    ]
  },
  "model_memory_limit": "100mb"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1747.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO586-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The source index to analyze.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO586-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This query filters out entire documents that will not be present in the
destination index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO586-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">_source</code> object defines fields in the dataset that will be included or
excluded in the destination index. In this case, <code class="literal">includes</code> does not specify any
fields, so the default behavior takes place: all the fields of the source index
will included except the ones that are explicitly specified in <code class="literal">excludes</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO586-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defines the destination index that contains the results of the analysis and
the fields of the source index specified in the <code class="literal">_source</code> object. Also defines
the name of the <code class="literal">results_field</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO586-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specifies fields to be included in or excluded from the analysis. This does
not affect whether the fields will be present in the destination index, only
affects whether they are used in the analysis.</p>
</td>
</tr>
</table>
</div>
<p>In this example, we can see that all the fields of the source index are included
in the destination index except <code class="literal">FlightDelay</code> and <code class="literal">FlightDelayType</code> because
these are defined as excluded fields by the <code class="literal">excludes</code> parameter of the
<code class="literal">_source</code> object. The <code class="literal">FlightNum</code> field is included in the destination index,
however it is not included in the analysis because it is explicitly specified as
excluded field by the <code class="literal">excludes</code> parameter of the <code class="literal">analyzed_fields</code> object.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-put-dfanalytics-example-od"></a>Outlier detection example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example creates the <code class="literal">loganalytics</code> data frame analytics job, the analysis
type is <code class="literal">outlier_detection</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/loganalytics
{
  "description": "Outlier detection on log data",
  "source": {
    "index": "logdata"
  },
  "dest": {
    "index": "logdata_out"
  },
  "analysis": {
    "outlier_detection": {
      "compute_feature_influence": true,
      "outlier_fraction": 0.05,
      "standardization_enabled": true
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1748.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
    "id": "loganalytics",
    "description": "Outlier detection on log data",
    "source": {
        "index": ["logdata"],
        "query": {
            "match_all": {}
        }
    },
    "dest": {
        "index": "logdata_out",
        "results_field": "ml"
    },
    "analysis": {
        "outlier_detection": {
            "compute_feature_influence": true,
            "outlier_fraction": 0.05,
            "standardization_enabled": true
        }
    },
    "model_memory_limit": "1gb",
    "create_time" : 1562265491319,
    "version" : "7.5.2",
    "allow_lazy_start" : false
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-put-dfanalytics-example-r"></a>Regression examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example creates the <code class="literal">house_price_regression_analysis</code>
data frame analytics job, the analysis type is <code class="literal">regression</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/house_price_regression_analysis
{
  "source": {
    "index": "houses_sold_last_10_yrs"
  },
  "dest": {
    "index": "house_price_predictions"
  },
  "analysis":
    {
      "regression": {
        "dependent_variable": "price"
      }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1749.console"></div>
<p>The API returns the following result:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id" : "house_price_regression_analysis",
  "source" : {
    "index" : [
      "houses_sold_last_10_yrs"
    ],
    "query" : {
      "match_all" : { }
    }
  },
  "dest" : {
    "index" : "house_price_predictions",
    "results_field" : "ml"
  },
  "analysis" : {
    "regression" : {
      "dependent_variable" : "price",
      "training_percent" : 100
    }
  },
  "model_memory_limit" : "1gb",
  "create_time" : 1567168659127,
  "version" : "7.5.0",
  "allow_lazy_start" : false
}</pre>
</div>
<p>The following example creates a job and specifies a training percent:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/student_performance_mathematics_0.3
{
 "source": {
   "index": "student_performance_mathematics"
 },
 "dest": {
   "index":"student_performance_mathematics_reg"
 },
 "analysis":
   {
     "regression": {
       "dependent_variable": "G3",
       "training_percent": 70  <a id="CO587-1"></a><i class="conum" data-value="1"></i>
     }
   }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1750.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO587-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">training_percent</code> defines the percentage of the data set that will be
used for training the model.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ml-put-dfanalytics-example-c"></a>Classification example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.5/docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example creates the <code class="literal">loan_classification</code> data frame analytics job, the
analysis type is <code class="literal">classification</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/loan_classification
{
  "source" : {
    "index": "loan-applicants"
  },
  "dest" : {
    "index": "loan-applicants-classified"
  },
  "analysis" : {
    "classification": {
      "dependent_variable": "label",
      "training_percent": 75,
      "num_top_classes": 2
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1751.console"></div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ml-df-analytics-apis.html">« Machine learning data frame analytics APIs</a>
</span>
<span class="next">
<a href="delete-dfanalytics.html">Delete data frame analytics jobs API »</a>
</span>
</div>
</div>
</body>
</html>
