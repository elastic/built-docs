<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Index templates | Elasticsearch Reference [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.x]"/>
<link rel="up" href="indices.html" title="Index APIs"/>
<link rel="prev" href="indices-open-close.html" title="Open index API"/>
<link rel="next" href="indices-put-template.html" title="Put index template API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.x"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="indices.html">Index APIs</a></span>
»
<span class="breadcrumb-node">Index templates</span>
</div>
<div class="navheader">
<span class="prev">
<a href="indices-open-close.html">« Open index API</a>
</span>
<span class="next">
<a href="indices-put-template.html">Put index template API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="indices-templates"></a>Index templates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/indices/index-templates.asciidoc">edit</a></h2>
</div></div></div>

<p>This documentation is about composable templates. For legacy templates please see the
<a class="xref" href="indices-templates-v1.html" title="Put index template API">legacy template documentation</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In Elasticsearch 7.8 composable templates were introduced. When a composable template matches a given index
it always takes precedence over a legacy template. If no composable template matches, a legacy
template may still match and be applied.</p>
</div>
</div>
<p><a id="getting"></a>An index template is a way to tell Elasticsearch how to configure an index when it is created.
For data streams, the index template configures the stream&#8217;s backing indices as they
are created. Templates are configured prior to index creation and then when an
index is created either manually or through indexing a document, the template
settings are used as a basis for creating the index.</p>
<p>There are two types of templates, index templates and <a class="xref" href="indices-component-template.html" title="Put component template API">component
templates</a>. Component templates are reusable building blocks that configure mappings, settings, and
aliases. You use component templates to construct index templates, they aren&#8217;t directly applied to a
set of indices. Index templates can contain a collection of component templates, as well as directly
specify settings, mappings, and aliases.</p>
<p>If a new data stream or index matches more than one index template, the index template with the highest priority is used.</p>
<p>If an index is created with explicit settings and also matches an index template,
the settings from the create index request take precedence over settings specified in the index template and its component templates.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _component_template/component_template1
{
  "template": {
    "mappings": {
      "properties": {
        "@timestamp": {
          "type": "date"
        }
      }
    }
  }
}

PUT _component_template/other_component_template
{
  "template": {
    "mappings": {
      "properties": {
        "ip_address": {
          "type": "ip"
        }
      }
    }
  }
}

PUT _index_template/template_1
{
  "index_patterns": ["te*", "bar*"],
  "template": {
    "settings": {
      "number_of_shards": 1
    },
    "mappings": {
      "properties": {
        "host_name": {
          "type": "keyword"
        },
        "created_at": {
          "type": "date",
          "format": "EEE MMM dd HH:mm:ss Z yyyy"
        }
      }
    },
    "aliases": {
      "mydata": { }
    }
  },
  "priority": 10,
  "composed_of": ["component_template1", "other_component_template"],
  "version": 3,
  "_meta": {
    "description": "my custom"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1790.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="simulating-templates"></a>Simulating template composition<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/indices/index-templates.asciidoc">edit</a></h3>
</div></div></div>
<p>Since templates can be composed not only of multiple component templates, but also the index
template itself, there are two simulation APIs to determine what the resulting index settings will
be.</p>
<p>To simulate the settings that would be applied to a matching index name:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_index_template/_simulate_index/myindex</pre>
</div>
<div class="console_widget" data-snippet="snippets/1791.console"></div>
<p>To simulate the settings that would be applied from a particular template:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_index_template/_simulate/template_1

POST /_index_template/_simulate
{
  "index_patterns": ["foo"],
  "template": {
    "settings": {
      "number_of_replicas": 0
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1792.console"></div>
<p>Here&#8217;s an example demonstrating simulating both an index name and template name:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_component_template/ct1 <a id="CO580-1"></a><i class="conum" data-value="1"></i>
{
  "template": {
    "settings": {
      "index.number_of_shards": 2
    }
  }
}

PUT /_component_template/ct2 <a id="CO580-2"></a><i class="conum" data-value="2"></i>
{
  "template": {
    "settings": {
      "index.number_of_replicas": 0
    },
    "mappings": {
      "properties": {
        "@timestamp": {
          "type": "date"
        }
      }
    }
  }
}

PUT /_index_template/final-template <a id="CO580-3"></a><i class="conum" data-value="3"></i>
{
  "index_patterns": ["logdata-*"],
  "composed_of": ["ct1", "ct2"],
  "priority": 5
}

POST /_index_template/_simulate_index/logdata-2019-02-01 <a id="CO580-4"></a><i class="conum" data-value="4"></i>

POST /_index_template/_simulate/final-template <a id="CO580-5"></a><i class="conum" data-value="5"></i>

POST /_index_template/_simulate <a id="CO580-6"></a><i class="conum" data-value="6"></i>
{
  "index_patterns": ["logdata-*"],
  "composed_of": ["ct2"],
  "priority": 10,
  "template": {
    "settings": {
      "index.number_of_replicas": 1
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1793.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO580-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creating a component template (ct1) setting the number of shards to two</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO580-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creating another component template (ct2) setting the number of replicas to zero with mappings</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO580-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creating an index template called "final" template using ct1 and ct2</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO580-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Simulate the settings that would be applied for a new index "logdata-2019-02-01"</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO580-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Simulate the settings composed using the "final-template" index template</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO580-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Simulate the settings composed using a custom specified template</p>
</td>
</tr>
</table>
</div>
<p>The output of the simulate API from the last example call looks like:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "template" : {
    "settings" : {
      "index" : {
        "number_of_replicas" : "1" <a id="CO581-1"></a><i class="conum" data-value="1"></i>
      }
    },
    "mappings" : {
      "properties" : {
        "@timestamp" : { <a id="CO581-2"></a><i class="conum" data-value="2"></i>
          "type" : "date"
        }
      }
    },
    "aliases" : { }
  },
  "overlapping" : [ <a id="CO581-3"></a><i class="conum" data-value="3"></i>
    {
      "name" : "final-template",
      "index_patterns" : [
        "logdata-*"
      ]
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of replicas from the simulated template body</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">@timestamp</code> field inherited from the "ct2" component template</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO581-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Any overlapping templates that would have matched, but have lower priority</p>
</td>
</tr>
</table>
</div>
<p>When simulating a template and specifying a template in the body of the request, the simulated
template is not added to the existing templates, it is only used for the simulation.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="indices-open-close.html">« Open index API</a>
</span>
<span class="next">
<a href="indices-put-template.html">Put index template API »</a>
</span>
</div>
</div>
</body>
</html>
