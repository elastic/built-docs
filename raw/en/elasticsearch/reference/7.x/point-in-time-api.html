<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Point in time API | Elasticsearch Reference [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.x]"/>
<link rel="up" href="search.html" title="Search APIs"/>
<link rel="prev" href="async-search.html" title="Async search"/>
<link rel="next" href="scroll-api.html" title="Scroll API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.x"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="search.html">Search APIs</a></span>
»
<span class="breadcrumb-node">Point in time API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="async-search.html">« Async search</a>
</span>
<span class="next">
<a href="scroll-api.html">Scroll API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="point-in-time-api"></a>Point in time API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/search/point-in-time-api.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>A search request by default executes against the most recent visible data of
the target indices, which is called point in time. Elasticsearch pit (point in time)
is a lightweight view into the state of the data as it existed when initiated.
In some cases, it&#8217;s preferred to perform multiple search requests using
the same point in time. For example, if <a class="xref" href="indices-refresh.html" title="Refresh API">refreshes</a> happen between
search_after requests, then the results of those requests might not be consistent as
changes happening between searches are only visible to the more recent point in time.</p>
<p>A point in time must be opened explicitly before being used in search requests. The
keep_alive parameter tells Elasticsearch how long it should keep a point in time alive,
e.g. <code class="literal">?keep_alive=5m</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /my-index-000001/_pit?keep_alive=1m</pre>
</div>
<div class="console_widget" data-snippet="snippets/2196.console"></div>
<p>The result from the above request includes a <code class="literal">id</code>, which should
be passed to the <code class="literal">id</code> of the <code class="literal">pit</code> parameter of a search request.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_search <a id="CO665-1"></a><i class="conum" data-value="1"></i>
{
    "size": 100,
    "query": {
        "match" : {
            "title" : "elasticsearch"
        }
    },
    "pit": {
	    "id":  "46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==", <a id="CO665-2"></a><i class="conum" data-value="2"></i>
	    "keep_alive": "1m"  <a id="CO665-3"></a><i class="conum" data-value="3"></i>
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2197.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO665-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A search request with the <code class="literal">pit</code> parameter must not specify <code class="literal">index</code>, <code class="literal">routing</code>,
and <a href="/guide/en/elasticsearch/reference/7.x/search-request-body.html#request-body-search-preference" class="ulink" target="_top"><code class="literal">preference</code></a>
as these parameters are copied from the point in time.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO665-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">id</code> parameter tells Elasticsearch to execute the request using contexts
from this point int time.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO665-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">keep_alive</code> parameter tells Elasticsearch how long it should extend
the time to live of the point in time.</p>
</td>
</tr>
</table>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The open point in time request and each subsequent search request can
return different <code class="literal">id</code>; thus always use the most recently received <code class="literal">id</code> for the
next search request.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="point-in-time-keep-alive"></a>Keeping point in time alive<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/search/point-in-time-api.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">keep_alive</code> parameter, which is passed to a open point in time request and
search request, extends the time to live of the corresponding point in time.
The value (e.g. <code class="literal">1m</code>, see <a class="xref" href="common-options.html#time-units" title="Time units">Time units</a>) does not need to be long enough to
process all data&#8201;&#8212;&#8201;it just needs to be long enough for the next request.</p>
<p>Normally, the background merge process optimizes the index by merging together
smaller segments to create new, bigger segments. Once the smaller segments are
no longer needed they are deleted. However, open point-in-times prevent the
old segments from being deleted since they are still in use.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Keeping older segments alive means that more disk space and file handles
are needed. Ensure that you have configured your nodes to have ample free file
handles. See <a class="xref" href="file-descriptors.html" title="File Descriptors">File Descriptors</a>.</p>
</div>
</div>
<p>Additionally, if a segment contains deleted or updated documents then the
point in time must keep track of whether each document in the segment was live at
the time of the initial search request. Ensure that your nodes have sufficient heap
space if you have many open point-in-times on an index that is subject to ongoing
deletes or updates.</p>
<p>You can check how many point-in-times (i.e, search contexts) are open with the
<a class="xref" href="cluster-nodes-stats.html" title="Nodes stats API">nodes stats API</a>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_nodes/stats/indices/search</pre>
</div>
<div class="console_widget" data-snippet="snippets/2198.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="close-point-in-time-api"></a>Close point in time API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/search/point-in-time-api.asciidoc">edit</a></h3>
</div></div></div>
<p>Point-in-time is automatically closed when its <code class="literal">keep_alive</code> has
been elapsed. However keeping point-in-times has a cost, as discussed in the
<a class="xref" href="point-in-time-api.html#point-in-time-keep-alive" title="Keeping point in time alive">previous section</a>. Point-in-times should be closed
as soon as they are no longer used in search requests.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /_pit
{
    "id" : "46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA=="
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2199.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
   "succeeded": true, <a id="CO666-1"></a><i class="conum" data-value="1"></i>
   "num_freed": 3     <a id="CO666-2"></a><i class="conum" data-value="2"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO666-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>If true, all search contexts associated with the point-in-time id are successfully closed</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO666-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The number of search contexts have been successfully closed</p>
</td>
</tr>
</table>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="async-search.html">« Async search</a>
</span>
<span class="next">
<a href="scroll-api.html">Scroll API »</a>
</span>
</div>
</div>
</body>
</html>
