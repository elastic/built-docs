<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Index recovery settings | Elasticsearch Reference [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.x]"/>
<link rel="up" href="settings.html" title="Configuring Elasticsearch"/>
<link rel="prev" href="index-management-settings.html" title="Index management settings"/>
<link rel="next" href="indexing-buffer.html" title="Indexing buffer settings"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.x"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span>
»
<span class="breadcrumb-link"><a href="settings.html">Configuring Elasticsearch</a></span>
»
<span class="breadcrumb-node">Index recovery settings</span>
</div>
<div class="navheader">
<span class="prev">
<a href="index-management-settings.html">« Index management settings</a>
</span>
<span class="next">
<a href="indexing-buffer.html">Indexing buffer settings »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="recovery"></a>Index recovery settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/indices/recovery.asciidoc">edit</a></h2>
</div></div></div>
<p>Peer recovery syncs data from a primary shard to a new or existing shard copy.</p>
<p>Peer recovery automatically occurs when Elasticsearch:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Recreates a shard lost during node failure
</li>
<li class="listitem">
Relocates a shard to another node due to a cluster rebalance or changes to the
<a class="xref" href="modules-cluster.html" title="Cluster-level shard allocation and routing settings">shard allocation settings</a>
</li>
</ul>
</div>
<p>You can view a list of in-progress and completed recoveries using the
<a class="xref" href="cat-recovery.html" title="cat recovery API">cat recovery API</a>.</p>
<h4><a id="_recovery_settings"></a>Recovery settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/indices/recovery.asciidoc">edit</a></h4>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">indices.recovery.max_bytes_per_sec</code>
</span>
</dt>
<dd>
(<a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">Dynamic</a>) Limits total inbound and outbound
recovery traffic for each node. Applies to both peer recoveries as well
as snapshot recoveries (i.e., restores from a snapshot). Defaults to <code class="literal">40mb</code>
unless the node is a dedicated <a class="xref" href="data-tiers.html#cold-tier" title="Cold tier">cold</a> or
<a class="xref" href="data-tiers.html#frozen-tier" title="Frozen tier">frozen</a> node, in which case the default relates to the
total memory available to the node:
</dd>
</dl>
</div>
<div class="table">
<p class="title"><strong>Table 1. Recovery Rate for Cold Nodes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Recovery Rate for Cold Nodes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">total memory</th>
<th align="left" valign="top">default value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>&#8656; 4 GB</p></td>
<td align="left" valign="top"><p>40 MB/s</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>&gt; 4 GB and &#8656; 8 GB</p></td>
<td align="left" valign="top"><p>60 MB/s</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>&gt; 8 GB and &#8656; 16 GB</p></td>
<td align="left" valign="top"><p>90 MB/s</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>&gt; 16 GB and &#8656; 32 GB</p></td>
<td align="left" valign="top"><p>125 MB/s</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>&gt; 32 GB</p></td>
<td align="left" valign="top"><p>250 MB/s</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>+
This limit applies to each node separately. If multiple nodes in a cluster
perform recoveries at the same time, the cluster&#8217;s total recovery traffic may
exceed this limit.</p>
<p>+
If this limit is too high, ongoing recoveries may consume an excess of bandwidth
and other resources, which can destabilize the cluster.</p>
<p>+
This is a dynamic setting, which means you can set it in each node&#8217;s
<code class="literal">elasticsearch.yml</code> config file and you can update it dynamically using the
<a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">cluster update settings API</a>. If you set it
dynamically then the same limit applies on every node in the cluster. If you do
not set it dynamically then you can set a different limit on each node, which is
useful if some of your nodes have better bandwidth than others. For example, if
you are using <a class="xref" href="overview-index-lifecycle-management.html" title="ILM overview">Index Lifecycle Management</a>
then you may be able to give your hot nodes a higher recovery bandwidth limit
than your warm nodes.</p>
<h4><a id="_expert_peer_recovery_settings"></a>Expert peer recovery settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/indices/recovery.asciidoc">edit</a></h4>
<p>You can use the following <em>expert</em> setting to manage resources for peer
recoveries.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">indices.recovery.max_concurrent_file_chunks</code>
</span>
</dt>
<dd>
<p>
(<a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">Dynamic</a>, Expert) Number of file chunk requests
sent in parallel for each recovery. Defaults to <code class="literal">2</code>.
</p>
<p>You can increase the value of this setting when the recovery of a single shard
is not reaching the traffic limit set by <code class="literal">indices.recovery.max_bytes_per_sec</code>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">indices.recovery.max_concurrent_operations</code>
</span>
</dt>
<dd>
<p>
(<a class="xref" href="cluster-update-settings.html" title="Cluster update settings API">Dynamic</a>, Expert) Number of operations sent
in parallel for each recovery. Defaults to <code class="literal">1</code>.
</p>
<p>Concurrently replaying operations during recovery can be very resource-intensive
and may interfere with indexing, search, and other activities in your cluster.
Do not increase this setting without carefully verifying that your cluster has
the resources available to handle the extra load that will result.</p>
</dd>
</dl>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="index-management-settings.html">« Index management settings</a>
</span>
<span class="next">
<a href="indexing-buffer.html">Indexing buffer settings »</a>
</span>
</div>
</div>
</body>
</html>
