<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Grant API key API | Elasticsearch Reference [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.x]"/>
<link rel="up" href="security-api.html" title="Security APIs"/>
<link rel="prev" href="security-api-get-user.html" title="Get users API"/>
<link rel="next" href="security-api-has-privileges.html" title="Has privileges API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.x"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="security-api.html">Security APIs</a></span>
»
<span class="breadcrumb-node">Grant API key API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="security-api-get-user.html">« Get users API</a>
</span>
<span class="next">
<a href="security-api-has-privileges.html">Has privileges API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-api-grant-api-key"></a>Grant API key API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/x-pack/docs/en/rest-api/security/grant-api-keys.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>Creates an API key on behalf of another user.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-grant-api-key-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/x-pack/docs/en/rest-api/security/grant-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /_security/api_key/grant</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-grant-api-key-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/x-pack/docs/en/rest-api/security/grant-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To use this API, you must have the <code class="literal">grant_api_key</code> cluster privilege.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-grant-api-key-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/x-pack/docs/en/rest-api/security/grant-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>This API is similar to <a class="xref" href="security-api-create-api-key.html" title="Create API key API">Create API keys</a>, however it creates the
API key for a user that is different than the user that runs the API.</p>
<p>The caller must have authentication credentials (either an access token, or a username and password) for the user on whose behalf the API key will be created. It is not possible to use this API to create an API key without that user&#8217;s credentials.</p>
<p>This API is intended be used by applications that need to create and manage API keys for end users, but cannot guarantee that those users have permission to create API keys on their own behalf (see <a class="xref" href="security-api-create-api-key.html#security-api-create-api-key-prereqs" title="Prerequisites">Prerequisites</a>).
The API keys are created by the Elasticsearch API key service, which is automatically
enabled when you configure TLS on the HTTP interface. See <a class="xref" href="configuring-tls.html#tls-http" title="Encrypting HTTP client communications">Encrypting HTTP client communications</a>.
Alternatively, you can explicitly enable the
<code class="literal">xpack.security.authc.api_key.enabled</code> setting. When you are running in
production mode, a bootstrap check prevents you from enabling the API key
service unless you also enable TLS on the HTTP interface.</p>
<p>A successful grant API key API call returns a JSON structure that contains the
API key, its unique id, and its name. If applicable, it also returns expiration
information for the API key in milliseconds.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>By default, API keys never expire. You can specify expiration information
when you create the API keys.</p>
</div>
</div>
<p>See <a class="xref" href="security-settings.html#api-key-service-settings" title="API key service settings">API key service settings</a> for configuration settings related to API key
service.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-grant-api-key-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/x-pack/docs/en/rest-api/security/grant-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>The following parameters can be specified in the body of a POST request:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">access_token</code>
</span>
</dt>
<dd>
(Required*, string)
The user&#8217;s access token. If you specify the <code class="literal">access_token</code> grant type, this
parameter is required. It is not valid with other grant types.
</dd>
<dt>
<span class="term">
<code class="literal">api_key</code>
</span>
</dt>
<dd>
<p>
(Required, object)
Defines the API key.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">expiration</code>
</span>
</dt>
<dd>
(Optional, string) Expiration time for the API key. By default, API keys never
expire.
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string) Specifies the name for this API key.
</dd>
<dt>
<span class="term">
<code class="literal">role_descriptors</code>
</span>
</dt>
<dd>
(Optional, array-of-role-descriptor) An array of role descriptors for this API
key. This parameter is optional. When it is not specified or is an empty array,
the API key has a point in time snapshot of permissions of the specified user or
access token. If you supply role descriptors, the resultant permissions are an
intersection of API keys permissions and the permissions of the user or access
token. The structure of role descriptor is the same as the request for create
role API. For more details, see <a class="xref" href="security-api-put-role.html" title="Create or update roles API">Create or update roles</a>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">grant_type</code>
</span>
</dt>
<dd>
<p>
(Required, string)
The type of grant. Supported grant types are: <code class="literal">access_token</code>,<code class="literal">password</code>.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">access_token</code>
</span>
</dt>
<dd>
(Required*, string)
In this type of grant, you must supply an access token that was created by the
Elasticsearch token service. For more information, see
<a class="xref" href="security-api-get-token.html" title="Get token API">Get token</a> and <a class="xref" href="configuring-tls.html#tls-http" title="Encrypting HTTP client communications">Encrypting HTTP client communications</a>.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
In this type of grant, you must supply the user ID and password for which you
want to create the API key.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
(Optional*, string)
The user&#8217;s password. If you specify the <code class="literal">password</code> grant type, this parameter is
required. It is not valid with other grant types.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
(Optional*, string)
The user name that identifies the user. If you specify the <code class="literal">password</code> grant type,
this parameter is required. It is not valid with other grant types.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-grant-api-key-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/x-pack/docs/en/rest-api/security/grant-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/api_key/grant
{
  "grant_type": "password",
  "username" : "test_admin",
  "password" : "x-pack-test-password",
  "api_key" : {
    "name": "my-api-key",
    "expiration": "1d",
    "role_descriptors": {
      "role-a": {
        "cluster": ["all"],
        "index": [
          {
          "names": ["index-a*"],
          "privileges": ["read"]
          }
        ]
      },
      "role-b": {
        "cluster": ["all"],
        "index": [
          {
          "names": ["index-b*"],
          "privileges": ["all"]
          }
        ]
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2354.console"></div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="security-api-get-user.html">« Get users API</a>
</span>
<span class="next">
<a href="security-api-has-privileges.html">Has privileges API »</a>
</span>
</div>
</div>
</body>
</html>
