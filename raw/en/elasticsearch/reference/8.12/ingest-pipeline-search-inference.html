<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Inference processing | Elasticsearch Guide [8.12] | Elastic</title>
<meta class="elastic" name="content" content="Inference processing | Elasticsearch Guide [8.12]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.12]"/>
<link rel="up" href="ingest-pipeline-search.html" title="Ingest pipelines in Search"/>
<link rel="prev" href="ingest-pipeline-search.html" title="Ingest pipelines in Search"/>
<link rel="next" href="nlp-example.html" title="Tutorial: Natural language processing (NLP)"/>
<meta class="elastic" name="product_version" content="8.12"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.12"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.12"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.12]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ingest.html">Ingest pipelines</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ingest-pipeline-search.html">Ingest pipelines in Search</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ingest-pipeline-search.html">« Ingest pipelines in Search</a>
</span>
<span class="next">
<a href="nlp-example.html">Tutorial: Natural language processing (NLP) »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ingest-pipeline-search-inference"></a>Inference processing<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h2>
</div></div></div>
<p>When you create an index through the <span class="strong strong"><strong>Content</strong></span> UI, a set of default ingest pipelines are also created, including a ML inference pipeline.
The <a class="xref" href="ingest-pipeline-search.html#ingest-pipeline-search-details-specific-ml-reference" title="&lt;index-name&gt;@ml-inference Reference">ML inference pipeline</a> uses inference processors to analyze fields and enrich documents with the output.
Inference processors use ML trained models, so you need to use a built-in model or <a href="/guide/en/machine-learning/8.12/ml-nlp-deploy-models.html" class="ulink" target="_blank" rel="noopener">deploy a trained model in your cluster</a> to use this feature.</p>
<p>This guide focuses on the ML inference pipeline, its use, and how to manage it.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature is not available at all Elastic subscription levels.
Refer to the Elastic subscriptions pages for <a href="/subscriptions/cloud" class="ulink" target="_blank" rel="noopener">Elastic Cloud</a> and <a href="/subscriptions" class="ulink" target="_top">self-managed</a> deployments.</p>
</div>
</div>
<h4><a id="ingest-pipeline-search-inference-nlp-use-cases"></a>NLP use cases<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<p><a href="/guide/en/machine-learning/8.12/ml-nlp-overview.html" class="ulink" target="_blank" rel="noopener">Natural Language Processing (NLP)</a> allows developers to create rich search experiences that go beyond the standards of lexical search.
A few examples of ways to improve search experiences through the use of NLP models:</p>
<h4><a id="ingest-pipeline-search-inference-elser"></a>ELSER text expansion<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<p>Using Elastic&#8217;s <a href="/guide/en/machine-learning/8.12/ml-nlp-elser.html" class="ulink" target="_blank" rel="noopener">ELSER machine learning model</a> you can easily incorporate text expansion for your queries.
This works by using ELSER to provide semantic enrichments to your documents upon ingestion, combined with the power of <a class="xref" href="search-application-overview.html" title="Elastic Search Applications">Elastic Search Application templates</a> to provide automated text expansion at query time.</p>
<h4><a id="ingest-pipeline-search-inference-ner"></a>Named entity recognition (NER)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<p>Most commonly used to detect entities such as People, Places, and Organization information from text, <a href="/guide/en/machine-learning/8.12/ml-nlp-extract-info.html#ml-nlp-ner" class="ulink" target="_blank" rel="noopener">NER</a> can be used to extract key information from text and group results based on that information.
A sports news media site could use NER to automatically extract names of professional athletes, stadiums, and sports teams in their articles and link to season stats or schedules.</p>
<h4><a id="ingest-pipeline-search-inference-text-classification"></a>Text classification<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<p><a href="/guide/en/machine-learning/8.12/ml-nlp-classify-text.html#ml-nlp-text-classification" class="ulink" target="_blank" rel="noopener">Text classification</a> is commonly used for sentiment analysis and can be used for similar tasks, such as labeling content as containing hate speech in public forums, or triaging and labeling support tickets so they reach the correct level of escalation automatically.</p>
<h4><a id="ingest-pipeline-search-inference-text-embedding"></a>Text embedding<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<p>Analyzing a text field using a <a href="/guide/en/machine-learning/8.12/ml-nlp-search-compare.html#ml-nlp-text-embedding" class="ulink" target="_blank" rel="noopener">Text embedding</a> model will generate a <a class="xref" href="dense-vector.html" title="Dense vector field type">dense vector</a> representation of the text.
This array of numeric values encodes the semantic <em>meaning</em> of the text.
Using the same model with a user&#8217;s search query will produce a vector that can then be used to search, ranking results based on vector similarity - semantic similarity - as opposed to traditional word or text similarity.</p>
<p>A common use case is a user searching FAQs, or a support agent searching a knowledge base, where semantically similar content may be indexed with little similarity in phrasing.</p>
<h4><a id="ingest-pipeline-search-inference-nlp-in-enterprise-search"></a>NLP in Content UI<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<h5><a id="ingest-pipeline-search-inference-overview"></a>Overview of ML inference pipeline<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h5>
<p>The diagram below shows how documents are processed during ingestion.</p>
<div class="imageblock">
<div class="content">
<img src="images/ingest/document-enrichment-diagram.png" alt="ML inference pipeline diagram">
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Documents are processed by the <code class="literal">my-index-0001</code> pipeline, which happens automatically when indexing through a an Elastic connector or crawler.
</li>
<li class="listitem">
The <code class="literal">_run_ml_inference</code> field is set to <code class="literal">true</code> to ensure the ML inference pipeline (<code class="literal">my-index-0001@ml-inference</code>) is executed.
This field is removed during the ingestion process.
</li>
<li class="listitem">
The inference processor analyzes the <code class="literal">message</code> field on the document using the <code class="literal">my-positivity-model-id</code> trained model.
The inference output is stored in the <code class="literal">ml.inference.positivity_prediction</code> field.
</li>
<li class="listitem">
The resulting enriched document is then indexed into the <code class="literal">my-index-0001</code> index.
</li>
<li class="listitem">
The <code class="literal">ml.inference.positivity_prediction</code> field can now be used at query time to search for documents above or below a certain threshold.
</li>
</ul>
</div>
<h4><a id="ingest-pipeline-search-inference-find-deploy-manage-trained-models"></a>Find, deploy, and manage trained models<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<p>This feature is intended to make it easier to use your ML trained models.
First, you need to figure out which model works best for your data.
Make sure to use a <a href="/guide/en/machine-learning/8.12/ml-nlp-model-ref.html" class="ulink" target="_blank" rel="noopener">compatible third party NLP model</a>.
Since these are publicly available, it is not possible to fine-tune models before <a href="/guide/en/machine-learning/8.12/ml-nlp-deploy-models.html" class="ulink" target="_blank" rel="noopener">deploying them</a>.</p>
<p>Trained models must be available in the current <a href="/guide/en/kibana/8.12/xpack-spaces.html" class="ulink" target="_blank" rel="noopener">Kibana Space</a> and running in order to use them.
By default, models should be available in all Kibana Spaces that have the <span class="strong strong"><strong>Analytics</strong></span> &gt; <span class="strong strong"><strong>Machine Learning</strong></span> feature enabled.
To manage your trained models, use the Kibana UI and navigate to <span class="strong strong"><strong>Stack Management &#8594; Machine Learning &#8594; Trained Models</strong></span>.
Spaces can be controlled in the <span class="strong strong"><strong>spaces</strong></span> column.
To stop or start a model, go to the <span class="strong strong"><strong>Machine Learning</strong></span> tab in the <span class="strong strong"><strong>Analytics</strong></span> menu of Kibana and click <span class="strong strong"><strong>Trained Models</strong></span> in the <span class="strong strong"><strong>Model Management</strong></span> section.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">monitor_ml</code> <a class="xref" href="security-privileges.html" title="Security privileges">Elasticsearch cluster privilege</a> is required to manage ML models and ML inference pipelines which use those models.</p>
</div>
</div>
<h5><a id="ingest-pipeline-search-inference-add-inference-processors"></a>Add inference processors to your ML inference pipeline<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h5>
<p>To create the index-specific ML inference pipeline, go to <span class="strong strong"><strong>Search &#8594; Content &#8594; Indices &#8594; &lt;your index&gt; &#8594; Pipelines</strong></span> in the Kibana UI.</p>
<p>If you only see the <code class="literal">ent-search-generic-ingestion</code> pipeline, you will need to click <span class="strong strong"><strong>Copy and customize</strong></span> to create index-specific pipelines.
This will create the <code class="literal">{index_name}@ml-inference</code> pipeline.</p>
<p>Once your index-specific ML inference pipeline is ready, you can add inference processors that use your ML trained models.
To add an inference processor to the ML inference pipeline, click the <span class="strong strong"><strong>Add Inference Pipeline</strong></span> button in the <span class="strong strong"><strong>Machine Learning Inference Pipelines</strong></span> card.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ingest/document-enrichment-add-inference-pipeline.png" alt="Add Inference Pipeline">
</div>
</div>
<p>Here, you&#8217;ll be able to:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Choose a name for your pipeline.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This name will need to be unique across the whole deployment.
If you want this pipeline to be index-specific, we recommend including the name of your index in the pipeline name.
</li>
<li class="listitem">
If you do not set the pipeline name, a default unique name will be provided upon selecting a trained model.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Select the ML trained model you want to use.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The model must be deployed before you can select it.
To begin deployment of a model, click the <span class="strong strong"><strong>Deploy</strong></span> button.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Select one or more source fields as input for the inference processor.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If there are no source fields available, your index will need a <a class="xref" href="mapping.html" title="Mapping">field mapping</a>.
</li>
</ul>
</div>
</li>
<li class="listitem">
(Optional) Choose a name for your target field(s).
This is where the output of the inference model will be stored. Changing the default name is only possible if you have a single source field selected.
</li>
<li class="listitem">
Add the source-target field mapping to the configuration by clicking the <span class="strong strong"><strong>Add</strong></span> button.
</li>
<li class="listitem">
Repeat steps 3-5 for each field mapping you want to add.
</li>
<li class="listitem">
(Optional) Test the pipeline with a sample document.
</li>
<li class="listitem">
(Optional) Review the pipeline definition before creating it with the <span class="strong strong"><strong>Create pipeline</strong></span> button.
</li>
</ol>
</div>
<h5><a id="ingest-pipeline-search-inference-manage-inference-processors"></a>Manage and delete inference processors from your ML inference pipeline<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h5>
<p>Inference processors added to your index-specific ML inference pipelines are normal Elasticsearch pipelines.
Once created, each processor will have options to <span class="strong strong"><strong>View in Stack Management</strong></span> and <span class="strong strong"><strong>Delete Pipeline</strong></span>.
Deleting an inference processor from within the <span class="strong strong"><strong>Content</strong></span> UI deletes the pipeline and also removes its reference from your index-specific ML inference pipeline.</p>
<p>These pipelines can also be viewed, edited, and deleted in Kibana via <span class="strong strong"><strong>Stack Management &#8594; Ingest Pipelines</strong></span>, just like all other Elasticsearch ingest pipelines.
You may also use the <a class="xref" href="ingest-apis.html" title="Ingest APIs">Ingest pipeline APIs</a>.
If you delete any of these pipelines outside of the <span class="strong strong"><strong>Content</strong></span> UI in Kibana, make sure to edit the ML inference pipelines that reference them.</p>
<h4><a id="ingest-pipeline-search-inference-test-inference-pipeline"></a>Test your ML inference pipeline<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<p>You can verify the expected structure of the inference output before indexing any documents while creating the machine learning inference pipeline under the <span class="strong strong"><strong>Test</strong></span> tab.
Provide a sample document, click <span class="strong strong"><strong>Simulate</strong></span>, and look for the <code class="literal">ml.inference</code> object in the results.</p>
<p>To ensure the ML inference pipeline will be run when ingesting documents, you must make sure the documents you are ingesting have a field named <code class="literal">_run_ml_inference</code> that is set to <code class="literal">true</code> and you must set the pipeline to <code class="literal">{index_name}</code>.
For connector and crawler indices, this will happen automatically if you&#8217;ve configured the settings appropriately for the pipeline name <code class="literal">{index_name}</code>.
To manage these settings:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Search &gt; Content &gt; Indices &gt; &lt;your index&gt; &gt; Pipelines</strong></span>.
</li>
<li class="listitem">
Click on the <span class="strong strong"><strong>Settings</strong></span> link in the <span class="strong strong"><strong>Ingest Pipelines</strong></span> card for the <code class="literal">{index_name}</code> pipeline.
</li>
<li class="listitem">
Ensure <span class="strong strong"><strong>ML inference pipelines</strong></span> is selected.
If it is not, select it and save the changes.
</li>
</ol>
</div>
<h4><a id="ingest-pipeline-search-inference-learn-more"></a>Learn More<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.12/docs/reference/ingest/search-inference-processing.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
See <a class="xref" href="ingest-pipeline-search.html#ingest-pipeline-search-in-enterprise-search" title="Overview">Overview</a> for information on the various pipelines that are created.
</li>
<li class="listitem">
Learn about <a href="/guide/en/machine-learning/8.12/ml-nlp-elser.html" class="ulink" target="_top">ELSER</a>, Elastic&#8217;s proprietary retrieval model for semantic search with sparse vectors.
</li>
<li class="listitem">
<a href="https://huggingface.co/models?library=pytorch&amp;pipeline_tag=token-classification&amp;sort=downloads" class="ulink" target="_blank" rel="noopener">NER HuggingFace Models</a>
</li>
<li class="listitem">
<a href="https://huggingface.co/models?library=pytorch&amp;pipeline_tag=text-classification&amp;sort=downloads" class="ulink" target="_blank" rel="noopener">Text Classification HuggingFace Models</a>
</li>
<li class="listitem">
<a href="https://huggingface.co/models?library=pytorch&amp;pipeline_tag=sentence-similarity&amp;sort=downloads" class="ulink" target="_blank" rel="noopener">Text Embedding HuggingFace Models</a>
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ingest-pipeline-search.html">« Ingest pipelines in Search</a>
</span>
<span class="next">
<a href="nlp-example.html">Tutorial: Natural language processing (NLP) »</a>
</span>
</div>
</div>
</body>
</html>
