<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Synonym graph token filter | Elasticsearch Guide [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Synonym graph token filter | Elasticsearch Guide [8.14]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.14]"/>
<link rel="up" href="analysis-tokenfilters.html" title="Token filter reference"/>
<link rel="prev" href="analysis-synonym-tokenfilter.html" title="Synonym token filter"/>
<link rel="next" href="analysis-trim-tokenfilter.html" title="Trim token filter"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.14"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="analysis-synonym-tokenfilter.html">« Synonym token filter</a>
</span>
<span class="next">
<a href="analysis-trim-tokenfilter.html">Trim token filter »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="analysis.html">Text analysis</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="analysis-tokenfilters.html">Token filter reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Synonym graph token filter</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="analysis-synonym-graph-tokenfilter"></a>Synonym graph token filter<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h2>
</div></div></div>

<p>The <code class="literal">synonym_graph</code> token filter allows to easily handle <a class="xref" href="search-with-synonyms.html" title="Search with synonyms">synonyms</a>,
including multi-word synonyms correctly during the analysis process.</p>
<p>In order to properly handle multi-word synonyms this token filter
creates a <a class="xref" href="token-graphs.html" title="Token graphs">graph token stream</a> during processing. For more
information on this topic and its various complexities, please read the
<a href="http://blog.mikemccandless.com/2012/04/lucenes-tokenstreams-are-actually.html" class="ulink" target="_top">Lucene&#8217;s TokenStreams are actually graphs</a> blog post.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<a id="synonym-graph-index-note"></a>
<p>This token filter is designed to be used as part of a search analyzer
only. If you want to apply synonyms during indexing please use the
standard <a class="xref" href="analysis-synonym-tokenfilter.html" title="Synonym token filter">synonym token filter</a>.</p>
</div>
</div>
<h4><a id="analysis-synonym-graph-define-synonyms"></a>Define synonyms sets<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h4>
<p>Synonyms in a synonyms set are defined using <span class="strong strong"><strong>synonym rules</strong></span>.
Each synonym rule contains words that are synonyms.</p>
<p>You can use two formats to define synonym rules: Solr and WordNet.</p>
<h5><a id="_solr_format_2"></a>Solr format<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonyms-format.asciidoc">edit</a></h5>
<p>This format uses two different definitions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Equivalent synonyms: Define groups of words that are equivalent. Words are separated by commas. Example:</p>
<div class="pre_wrapper lang-synonyms">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-synonyms">ipod, i-pod, i pod
computer, pc, laptop</pre>
</div>
</li>
<li class="listitem">
<p>Explicit synonyms: Matches a group of words to other words. Words on the left hand side of the rule definition are expanded into all the possibilities described on the right hand side. Example:</p>
<div class="pre_wrapper lang-synonyms">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-synonyms">personal computer =&gt; pc
sea biscuit, sea biscit =&gt; seabiscuit</pre>
</div>
</li>
</ul>
</div>
<h5><a id="_wordnet_format_2"></a>WordNet format<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonyms-format.asciidoc">edit</a></h5>
<p><a href="https://wordnet.princeton.edu/" class="ulink" target="_top">WordNet</a> defines synonyms sets spanning multiple lines. Each line contains the following information:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Synonyms set numeric identifier
</li>
<li class="listitem">
Ordinal of the synonym in the synonyms set
</li>
<li class="listitem">
Synonym word
</li>
<li class="listitem">
Word type identifier: Noun (n), verb (v), adjective (a) or adverb (b).
</li>
<li class="listitem">
Depth of the word in the synonym net
</li>
</ul>
</div>
<p>The following example defines a synonym set for the words "come", "advance" and "approach":</p>
<div class="pre_wrapper lang-synonyms">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-synonyms">s(100000002,1,'come',v,1,0).
s(100000002,2,'advance',v,1,0).
s(100000002,3,'approach',v,1,0).""";</pre>
</div>
<h4><a id="analysis-synonym-graph-configure-sets"></a>Configure synonyms sets<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h4>
<p>Synonyms can be configured using the <a class="xref" href="search-with-synonyms.html#synonyms-store-synonyms-api" title="Synonyms API">synonyms API</a>, a <a class="xref" href="search-with-synonyms.html#synonyms-store-synonyms-file" title="Synonyms File">synonyms file</a>, or directly <a class="xref" href="search-with-synonyms.html#synonyms-store-synonyms-inline" title="Inline">inlined</a> in the token filter configuration.
See <a class="xref" href="search-with-synonyms.html#synonyms-store-synonyms" title="Store your synonyms set">store your synonyms set</a> for more details on each option.</p>
<p>Use <code class="literal">synonyms_set</code> configuration option to provide a synonym set created via Synonyms Management APIs:</p>
<div class="pre_wrapper lang-JSON">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-JSON">  "filter": {
    "synonyms_filter": {
      "type": "synonym_graph",
      "synonyms_set": "my-synonym-set",
      "updateable": true
    }
  }</pre>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Synonyms sets must exist before they can be added to indices.
If an index is created referencing a nonexistent synonyms set, the index will remain in a partially created and inoperable state.
The only way to recover from this scenario is to ensure the synonyms set exists then either delete and re-create the index, or close and re-open the index.</p>
</div>
</div>
<p>Use <code class="literal">synonyms_path</code> to provide a synonym file :</p>
<div class="pre_wrapper lang-JSON">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-JSON">  "filter": {
    "synonyms_filter": {
      "type": "synonym_graph",
      "synonyms_path": "analysis/synonym-set.txt"
    }
  }</pre>
</div>
<p>The above configures a <code class="literal">synonym</code> filter, with a path of
<code class="literal">analysis/synonym-set.txt</code> (relative to the <code class="literal">config</code> location).</p>
<p>Use <code class="literal">synonyms</code> to define inline synonyms:</p>
<div class="pre_wrapper lang-JSON">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-JSON">  "filter": {
    "synonyms_filter": {
      "type": "synonym_graph",
      "synonyms": ["pc =&gt; personal computer", "computer, pc, laptop"]
    }
  }</pre>
</div>
<p>Additional settings are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">updateable</code> (defaults to <code class="literal">false</code>). If <code class="literal">true</code> allows
<a class="xref" href="indices-reload-analyzers.html" title="Reload search analyzers API">reloading</a> search analyzers to pick up
changes to synonym files. Only to be used for search analyzers.
</li>
<li class="listitem">
<code class="literal">expand</code> (defaults to <code class="literal">true</code>).
Expands definitions for equivalent synonym rules.
See <a class="xref" href="analysis-synonym-graph-tokenfilter.html#synonym-graph-tokenizer-expand-equivalent-synonyms" title="expand equivalent synonym rules">expand equivalent synonyms</a>.
</li>
<li class="listitem">
<code class="literal">lenient</code> (defaults to <code class="literal">false</code>).
If <code class="literal">true</code> ignores errors while parsing the synonym configuration.
It is important to note that only those synonym rules which cannot get parsed are ignored.
See <a class="xref" href="analysis-synonym-graph-tokenfilter.html#synonym-graph-tokenizer-stop-token-filter" title="Synonyms and stop token filters">synonyms and stop token filters</a> for an example of <code class="literal">lenient</code> behaviour for invalid synonym rules.
</li>
</ul>
</div>
<h5><a id="synonym-graph-tokenizer-expand-equivalent-synonyms"></a><code class="literal">expand</code> equivalent synonym rules<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h5>
<p>The <code class="literal">expand</code> parameter controls whether to expand equivalent synonym rules.
Consider a synonym defined like:</p>
<p><code class="literal">foo, bar, baz</code></p>
<p>Using <code class="literal">expand: true</code>, the synonym rule would be expanded into:</p>
<pre class="screen">foo =&gt; foo
foo =&gt; bar
foo =&gt; baz
bar =&gt; foo
bar =&gt; bar
bar =&gt; baz
baz =&gt; foo
baz =&gt; bar
baz =&gt; baz</pre>
<p>When <code class="literal">expand</code> is set to <code class="literal">false</code>, the synonym rule is not expanded and the first synonym is treated as the canonical representation. The synonym would be equivalent to:</p>
<pre class="screen">foo =&gt; foo
bar =&gt; foo
baz =&gt; foo</pre>
<p>The <code class="literal">expand</code> parameter does not affect explicit synonym rules, like <code class="literal">foo, bar =&gt; baz</code>.</p>
<h5><a id="synonym-graph-tokenizer-ignore_case-deprecated"></a><code class="literal">tokenizer</code> and <code class="literal">ignore_case</code> are deprecated<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h5>
<p>The <code class="literal">tokenizer</code> parameter controls the tokenizers that will be used to
tokenize the synonym, this parameter is for backwards compatibility for indices that created before 6.0.
The <code class="literal">ignore_case</code> parameter works with <code class="literal">tokenizer</code> parameter only.</p>
<h4><a id="analysis-synonym-graph-analizers-configure"></a>Configure analyzers with synonym graph token filters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h4>
<p>To apply synonyms, you will need to include a synonym graph token filter into an analyzer:</p>
<div class="pre_wrapper lang-JSON">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-JSON">      "analyzer": {
        "my_analyzer": {
          "type": "custom",
          "tokenizer": "standard",
          "filter": ["stemmer", "synonym_graph"]
        }
      }</pre>
</div>
<h5><a id="analysis-synonym-graph-token-order"></a>Token filters ordering<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h5>
<p>Order is important for your token filters.
Text will be processed first through filters preceding the synonym filter before being processed by the synonym filter.</p>
<p>Elasticsearch will also use the token filters preceding the synonym filter in a tokenizer chain to parse the entries in a synonym file or synonym set.
In the above example, the synonyms graph token filter is placed after a stemmer. The stemmer will also be applied to the synonym entries.</p>
<p>Because entries in the synonym map cannot have stacked positions, some token filters may cause issues here.
Token filters that produce multiple versions of a token may choose which version of the token to emit when parsing synonyms.
For example, <code class="literal">asciifolding</code> will only produce the folded version of the token.
Others, like <code class="literal">multiplexer</code>, <code class="literal">word_delimiter_graph</code> or <code class="literal">ngram</code> will throw an error.</p>
<p>If you need to build analyzers that include both multi-token filters and synonym filters, consider using the <a class="xref" href="analysis-multiplexer-tokenfilter.html" title="Multiplexer token filter">multiplexer</a> filter, with the multi-token filters in one branch and the synonym filter in the other.</p>
<h5><a id="synonym-graph-tokenizer-stop-token-filter"></a>Synonyms and <code class="literal">stop</code> token filters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h5>
<p>Synonyms and <a class="xref" href="analysis-stop-tokenfilter.html" title="Stop token filter">stop token filters</a> interact with each other in the following ways:</p>
<h6><a id="_stop_token_filter_before_synonym_token_filter_2"></a>Stop token filter <span class="strong strong"><strong>before</strong></span> synonym token filter<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h6>
<p>Stop words will be removed from the synonym rule definition.
This can can cause errors on the synonym rule.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Invalid synonym rules can cause errors when applying analyzer changes.
For reloadable analyzers, this prevents reloading and applying changes.
You must correct errors in the synonym rules and reload the analyzer.</p>
<p>An index with invalid synonym rules cannot be reopened, making it inoperable when:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A node containing the index starts
</li>
<li class="listitem">
The index is opened from a closed state
</li>
<li class="listitem">
A node restart occurs (which reopens the node assigned shards)
</li>
</ul>
</div>
</div>
</div>
<p>For <span class="strong strong"><strong>explicit synonym rules</strong></span> like <code class="literal">foo, bar =&gt; baz</code> with a stop filter that removes <code class="literal">bar</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If <code class="literal">lenient</code> is set to <code class="literal">false</code>, an error will be raised as <code class="literal">bar</code> would be removed from the left hand side of the synonym rule.
</li>
<li class="listitem">
If <code class="literal">lenient</code> is set to <code class="literal">true</code>, the rule <code class="literal">foo =&gt; baz</code> will be added and <code class="literal">bar =&gt; baz</code> will be ignored.
</li>
</ul>
</div>
<p>If the stop filter removed <code class="literal">baz</code> instead:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If <code class="literal">lenient</code> is set to <code class="literal">false</code>, an error will be raised as <code class="literal">baz</code> would be removed from the right hand side of the synonym rule.
</li>
<li class="listitem">
If <code class="literal">lenient</code> is set to <code class="literal">true</code>, the synonym will have no effect as the target word is removed.
</li>
</ul>
</div>
<p>For <span class="strong strong"><strong>equivalent synonym rules</strong></span> like <code class="literal">foo, bar, baz</code> and <code class="literal">expand: true, with a stop filter that removes `bar</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If <code class="literal">lenient</code> is set to <code class="literal">false</code>, an error will be raised as <code class="literal">bar</code> would be removed from the synonym rule.
</li>
<li class="listitem">
If <code class="literal">lenient</code> is set to <code class="literal">true</code>, the synonyms added would be equivalent to the following synonym rules, which do not contain the removed word:
</li>
</ul>
</div>
<pre class="screen">foo =&gt; foo
foo =&gt; baz
baz =&gt; foo
baz =&gt; baz</pre>
<h6><a id="_stop_token_filter_after_synonym_token_filter_2"></a>Stop token filter <span class="strong strong"><strong>after</strong></span> synonym token filter<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc">edit</a></h6>
<p>The stop filter will remove the terms from the resulting synonym expansion.</p>
<p>For example, a synonym rule like <code class="literal">foo, bar =&gt; baz</code> and a stop filter that removes <code class="literal">baz</code> will get no matches for <code class="literal">foo</code> or <code class="literal">bar</code>, as both would get expanded to <code class="literal">baz</code> which is removed by the stop filter.</p>
<p>If the stop filter removed <code class="literal">foo</code> instead, then searching for <code class="literal">foo</code> would get expanded to <code class="literal">baz</code>, which is not removed by the stop filter thus potentially providing matches for <code class="literal">baz</code>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="analysis-synonym-tokenfilter.html">« Synonym token filter</a>
</span>
<span class="next">
<a href="analysis-trim-tokenfilter.html">Trim token filter »</a>
</span>
</div>
</body>
</html>
