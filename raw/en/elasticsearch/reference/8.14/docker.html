<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Install Elasticsearch with Docker | Elasticsearch Guide [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Install Elasticsearch with Docker | Elasticsearch Guide [8.14]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.14]"/>
<link rel="up" href="install-elasticsearch.html" title="Installing Elasticsearch"/>
<link rel="prev" href="rpm.html" title="Install Elasticsearch with RPM"/>
<link rel="next" href="settings.html" title="Configuring Elasticsearch"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.14"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="rpm.html">« Install Elasticsearch with RPM</a>
</span>
<span class="next">
<a href="settings.html">Configuring Elasticsearch »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="install-elasticsearch.html">Installing Elasticsearch</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Install Elasticsearch with Docker</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docker"></a>Install Elasticsearch with Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h2>
</div></div></div>
<p>Docker images for Elasticsearch are available from the Elastic Docker registry. A list of
all published Docker images and tags is available at
<a href="https://www.docker.elastic.co" class="ulink" target="_top">www.docker.elastic.co</a>. The source code is in
<a href="https://github.com/elastic/elasticsearch/blob/8.14/distribution/docker" class="ulink" target="_top">GitHub</a>.</p>
<p>This package contains both free and subscription features.
<a class="xref" href="license-settings.html" title="License settings">Start a 30-day trial</a> to try out all of the features.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you just want to test Elasticsearch in local development, refer to <a class="xref" href="run-elasticsearch-locally.html" title="Run Elasticsearch locally in Docker (without security)"><em>Local dev setup (Docker)</em></a>.
Please note that this setup is not suitable for production environments.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-cli-run-dev-mode"></a>Run Elasticsearch in Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>Use Docker commands to start a single-node Elasticsearch cluster for development or
testing. You can then run additional Docker commands to add nodes to the test
cluster or run Kibana.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>This setup doesn&#8217;t run multiple Elasticsearch nodes or Kibana by default. To create a
multi-node cluster with Kibana, use Docker Compose instead. See
<a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">Start a multi-node cluster with Docker Compose</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_start_a_single_node_cluster"></a>Start a single-node cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Install Docker. Visit <a href="https://docs.docker.com/get-docker/" class="ulink" target="_top">Get Docker</a> to
install Docker for your environment.</p>
<p>If using Docker Desktop, make sure to allocate at least 4GB of memory. You can
adjust memory usage in Docker Desktop by going to <span class="strong strong"><strong>Settings &gt; Resources</strong></span>.</p>
</li>
<li class="listitem">
<p>Create a new docker network.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker network create elastic</pre>
</div>
</li>
<li class="listitem">
<p>Pull the Elasticsearch Docker image.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker pull docker.elastic.co/elasticsearch/elasticsearch:8.14.3</pre>
</div>
</li>
<li class="listitem">
<p>Optional: Install
<a href="https://docs.sigstore.dev/system_config/installation/" class="ulink" target="_top">Cosign</a> for your
environment. Then use Cosign to verify the Elasticsearch image&#8217;s signature.</p>
<a id="docker-verify-signature"></a><div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">wget https://artifacts.elastic.co/cosign.pub
cosign verify --key cosign.pub docker.elastic.co/elasticsearch/elasticsearch:8.14.3</pre>
</div>
<p>The <code class="literal">cosign</code> command prints the check results and the signature payload in JSON format:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">Verification for docker.elastic.co/elasticsearch/elasticsearch:8.14.3 --
The following checks were performed on each of these signatures:
  - The cosign claims were validated
  - Existence of the claims in the transparency log was verified offline
  - The signatures were verified against the specified public key</pre>
</div>
</li>
<li class="listitem">
<p>Start an Elasticsearch container.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run --name es01 --net elastic -p 9200:9200 -it -m 1GB docker.elastic.co/elasticsearch/elasticsearch:8.14.3</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Use the <code class="literal">-m</code> flag to set a memory limit for the container. This removes the
need to <a class="xref" href="docker.html#docker-set-heap-size" title="Manually set the heap size">manually set the JVM size</a>.</p>
</div>
</div>
<p>The command prints the <code class="literal">elastic</code> user password and an enrollment token for Kibana.</p>
</li>
<li class="listitem">
<p>Copy the generated <code class="literal">elastic</code> password and enrollment token. These credentials
are only shown when you start Elasticsearch for the first time. You can regenerate the
credentials using the following commands.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana</pre>
</div>
<p>We recommend storing the <code class="literal">elastic</code> password as an environment variable in your shell. Example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">export ELASTIC_PASSWORD="your_password"</pre>
</div>
</li>
<li class="listitem">
<p>Copy the <code class="literal">http_ca.crt</code> SSL certificate from the container to your local machine.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker cp es01:/usr/share/elasticsearch/config/certs/http_ca.crt .</pre>
</div>
</li>
<li class="listitem">
<p>Make a REST API call to Elasticsearch to ensure the Elasticsearch container is running.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl --cacert http_ca.crt -u elastic:$ELASTIC_PASSWORD https://localhost:9200</pre>
</div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_add_more_nodes"></a>Add more nodes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Use an existing node to generate a enrollment token for the new node.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node</pre>
</div>
<p>The enrollment token is valid for 30 minutes.</p>
</li>
<li class="listitem">
<p>Start a new Elasticsearch container. Include the enrollment token as an environment variable.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -e ENROLLMENT_TOKEN="&lt;token&gt;" --name es02 --net elastic -it -m 1GB docker.elastic.co/elasticsearch/elasticsearch:8.14.3</pre>
</div>
</li>
<li class="listitem">
<p>Call the <a class="xref" href="cat-nodes.html" title="cat nodes API">cat nodes API</a> to verify the node was added to the cluster.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl --cacert http_ca.crt -u elastic:$ELASTIC_PASSWORD https://localhost:9200/_cat/nodes</pre>
</div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="run-kibana-docker"></a>Run Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Pull the Kibana Docker image.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker pull docker.elastic.co/kibana/kibana:8.14.3</pre>
</div>
</li>
<li class="listitem">
<p>Optional: Verify the Kibana image&#8217;s signature.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">wget https://artifacts.elastic.co/cosign.pub
cosign verify --key cosign.pub docker.elastic.co/kibana/kibana:8.14.3</pre>
</div>
</li>
<li class="listitem">
<p>Start a Kibana container.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run --name kib01 --net elastic -p 5601:5601 docker.elastic.co/kibana/kibana:8.14.3</pre>
</div>
</li>
<li class="listitem">
When Kibana starts, it outputs a unique generated link to the terminal. To
access Kibana, open this link in a web browser.
</li>
<li class="listitem">
<p>In your browser, enter the enrollment token that was generated when you started Elasticsearch.</p>
<p>To regenerate the token, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana</pre>
</div>
</li>
<li class="listitem">
<p>Log in to Kibana as the <code class="literal">elastic</code> user with the password that was generated
when you started Elasticsearch.</p>
<p>To regenerate the password, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic</pre>
</div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="remove-containers-docker"></a>Remove containers<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>To remove the containers and their network, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh"># Remove the Elastic network
docker network rm elastic

# Remove Elasticsearch containers
docker rm es01
docker rm es02

# Remove the Kibana container
docker rm kib01</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_next_steps_5"></a>Next steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You now have a test Elasticsearch environment set up. Before you start
serious development or go into production with Elasticsearch, review the
<a class="xref" href="docker.html#docker-prod-prerequisites" title="Using the Docker images in production">requirements and recommendations</a> to apply when running Elasticsearch in Docker in production.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-compose-file"></a>Start a multi-node cluster with Docker Compose<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>Use Docker Compose to start a three-node Elasticsearch cluster with Kibana. Docker Compose
lets you start multiple containers with a single command.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_configure_and_start_the_cluster"></a>Configure and start the cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Install Docker Compose. Visit the
<a href="https://docs.docker.com/compose/install/" class="ulink" target="_top">Docker Compose docs</a> to install Docker
Compose for your environment.</p>
<p>If you&#8217;re using Docker Desktop, Docker Compose is installed automatically. Make
sure to allocate at least 4GB of memory to Docker Desktop. You can adjust memory
usage in Docker Desktop by going to <span class="strong strong"><strong>Settings &gt; Resources</strong></span>.</p>
</li>
<li class="listitem">
Create or navigate to an empty directory for the project.
</li>
<li class="listitem">
<p>Download and save the following files in the project directory:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/elasticsearch/blob/8.14/docs/reference/setup/install/docker/.env" class="ulink" target="_top"><code class="literal">.env</code></a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/elasticsearch/blob/8.14/docs/reference/setup/install/docker/docker-compose.yml" class="ulink" target="_top"><code class="literal">docker-compose.yml</code></a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>In the <code class="literal">.env</code> file, specify a password for the <code class="literal">ELASTIC_PASSWORD</code> and
<code class="literal">KIBANA_PASSWORD</code> variables.</p>
<p>The passwords must be alphanumeric and can&#8217;t contain special characters, such as
<code class="literal">!</code> or <code class="literal">@</code>. The bash script included in the <code class="literal">docker-compose.yml</code> file only
works with alphanumeric characters. Example:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt"># Password for the 'elastic' user (at least 6 characters)
ELASTIC_PASSWORD=changeme

# Password for the 'kibana_system' user (at least 6 characters)
KIBANA_PASSWORD=changeme
...</pre>
</div>
</li>
<li class="listitem">
<p>In the <code class="literal">.env</code> file, set <code class="literal">STACK_VERSION</code> to the current Elastic Stack version.</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">...
# Version of Elastic products
STACK_VERSION=8.14.3
...</pre>
</div>
</li>
<li class="listitem">
<p>By default, the Docker Compose configuration exposes port <code class="literal">9200</code> on all network interfaces.</p>
<p>To avoid exposing port <code class="literal">9200</code> to external hosts, set <code class="literal">ES_PORT</code> to <code class="literal">127.0.0.1:9200</code>
in the <code class="literal">.env</code> file. This ensures Elasticsearch is only accessible from the host
machine.</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">...
# Port to expose Elasticsearch HTTP API to the host
#ES_PORT=9200
ES_PORT=127.0.0.1:9200
...</pre>
</div>
</li>
<li class="listitem">
<p>To start the cluster, run the following command from the project directory.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker-compose up -d</pre>
</div>
</li>
<li class="listitem">
After the cluster has started, open <a href="http://localhost:5601" class="ulink" target="_top">http://localhost:5601</a> in a web browser to
access Kibana.
</li>
<li class="listitem">
Log in to Kibana as the <code class="literal">elastic</code> user using the <code class="literal">ELASTIC_PASSWORD</code> you set
earlier.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_stop_and_remove_the_cluster"></a>Stop and remove the cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>To stop the cluster, run <code class="literal">docker-compose down</code>. The data in the Docker volumes
is preserved and loaded when you restart the cluster with <code class="literal">docker-compose up</code>.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker-compose down</pre>
</div>
<p>To delete the network, containers, and volumes when you stop the cluster,
specify the <code class="literal">-v</code> option:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker-compose down -v</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_next_steps_6"></a>Next steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You now have a test Elasticsearch environment set up. Before you start
serious development or go into production with Elasticsearch, review the
<a class="xref" href="docker.html#docker-prod-prerequisites" title="Using the Docker images in production">requirements and recommendations</a> to apply when running Elasticsearch in Docker in production.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-prod-prerequisites"></a>Using the Docker images in production<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>The following requirements and recommendations apply when running Elasticsearch in Docker in production.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_set_vm_max_map_count_to_at_least_262144"></a>Set <code class="literal">vm.max_map_count</code> to at least <code class="literal">262144</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> kernel setting must be set to at least <code class="literal">262144</code> for production use.</p>
<p>How you set <code class="literal">vm.max_map_count</code> depends on your platform.</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_linux"></a>Linux<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
</div></div></div>
<p>To view the current value for the <code class="literal">vm.max_map_count</code> setting, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">grep vm.max_map_count /etc/sysctl.conf
vm.max_map_count=262144</pre>
</div>
<p>To apply the setting on a live system, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sysctl -w vm.max_map_count=262144</pre>
</div>
<p>To permanently change the value for the <code class="literal">vm.max_map_count</code> setting, update the
value in <code class="literal">/etc/sysctl.conf</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_macos_with_docker_for_mac"></a>macOS with <a href="https://docs.docker.com/docker-for-mac" class="ulink" target="_top">Docker for Mac</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> setting must be set within the xhyve virtual machine:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the command line, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">screen ~/Library/Containers/com.docker.docker/Data/vms/0/tty</pre>
</div>
</li>
<li class="listitem">
<p>Press enter and use <code class="literal">sysctl</code> to configure <code class="literal">vm.max_map_count</code>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sysctl -w vm.max_map_count=262144</pre>
</div>
</li>
<li class="listitem">
To exit the <code class="literal">screen</code> session, type <code class="literal">Ctrl a d</code>.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_windows_and_macos_with_docker_desktop"></a>Windows and macOS with <a href="https://www.docker.com/products/docker-desktop" class="ulink" target="_top">Docker Desktop</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> setting must be set via docker-machine:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker-machine ssh
sudo sysctl -w vm.max_map_count=262144</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_windows_with_docker_desktop_wsl_2_backend"></a>Windows with <a href="https://docs.docker.com/docker-for-windows/wsl" class="ulink" target="_top">Docker Desktop WSL 2 backend</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> setting must be set in the "docker-desktop" WSL instance before the
Elasticsearch container will properly start. There are several ways to do this, depending
on your version of Windows and your version of WSL.</p>
<p>If you are on Windows 10 before version 22H2, or if you are on Windows 10 version 22H2 using the
built-in version of WSL, you must either manually set it every time you restart Docker before starting
your Elasticsearch container, or (if you do not wish to do so on every restart) you must globally set
every WSL2 instance to have the <code class="literal">vm.max_map_count</code> changed. This is because these versions of WSL
do not properly process the /etc/sysctl.conf file.</p>
<p>To manually set it every time you reboot, you must run the following commands in a command prompt
or PowerShell window every time you restart Docker:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">wsl -d docker-desktop -u root
sysctl -w vm.max_map_count=262144</pre>
</div>
<p>If you are on these versions of WSL and you do not want to have to run those commands every
time you restart Docker, you can globally change every WSL distribution with this setting
by modifying your %USERPROFILE%\.wslconfig as follows:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">[wsl2]
kernelCommandLine = "sysctl.vm.max_map_count=262144"</pre>
</div>
<p>This will cause all WSL2 VMs to have that setting assigned when they start.</p>
<p>If you are on Windows 11, or Windows 10 version 22H2 and have installed the Microsoft Store
version of WSL, you can modify the /etc/sysctl.conf within the "docker-desktop" WSL
distribution, perhaps with commands like this:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">wsl -d docker-desktop -u root
vi /etc/sysctl.conf</pre>
</div>
<p>and appending a line which reads:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">vm.max_map_count = 262144</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_configuration_files_must_be_readable_by_the_elasticsearch_user"></a>Configuration files must be readable by the <code class="literal">elasticsearch</code> user<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch runs inside the container as user <code class="literal">elasticsearch</code> using
uid:gid <code class="literal">1000:0</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>One exception is <a href="https://docs.openshift.com/container-platform/3.6/creating_images/guidelines.html#openshift-specific-guidelines" class="ulink" target="_top">Openshift</a>,
which runs containers using an arbitrarily assigned user ID.
Openshift presents persistent volumes with the gid set to <code class="literal">0</code>, which works without any adjustments.</p>
</div>
</div>
<p>If you are bind-mounting a local directory or file, it must be readable by the <code class="literal">elasticsearch</code> user.
In addition, this user must have write access to the <a class="xref" href="important-settings.html#path-settings" title="Path settings">config, data and log dirs</a>
(Elasticsearch needs write access to the <code class="literal">config</code> directory so that it can generate a keystore).
A good strategy is to grant group access to gid <code class="literal">0</code> for the local directory.</p>
<p>For example, to prepare a local directory for storing data through a bind-mount:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">mkdir esdatadir
chmod g+rwx esdatadir
chgrp 0 esdatadir</pre>
</div>
<p>You can also run an Elasticsearch container using both a custom UID and GID. You
must ensure that file permissions will not prevent Elasticsearch from executing. You
can use one of two options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Bind-mount the <code class="literal">config</code>, <code class="literal">data</code> and <code class="literal">logs</code>
directories. If you intend to install plugins and prefer not to
<a class="xref" href="docker.html#_c_customized_image" title="Using custom Docker images">create a custom Docker image</a>, you must also
bind-mount the <code class="literal">plugins</code> directory.
</li>
<li class="listitem">
Pass the <code class="literal">--group-add 0</code> command line option to <code class="literal">docker run</code>. This
ensures that the user under which Elasticsearch is running is also a member of the
<code class="literal">root</code> (GID 0) group inside the container.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_increase_ulimits_for_nofile_and_nproc"></a>Increase ulimits for nofile and nproc<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Increased ulimits for <a class="xref" href="setting-system-settings.html" title="Configuring system settings">nofile</a> and <a class="xref" href="max-number-threads-check.html" title="Maximum number of threads check">nproc</a>
must be available for the Elasticsearch containers.
Verify the <a href="https://github.com/moby/moby/tree/ea4d1243953e6b652082305a9c3cda8656edab26/contrib/init" class="ulink" target="_top">init system</a>
for the Docker daemon sets them to acceptable values.</p>
<p>To check the Docker daemon defaults for ulimits, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run --rm docker.elastic.co/elasticsearch/elasticsearch:8.14.3 /bin/bash -c 'ulimit -Hn &amp;&amp; ulimit -Sn &amp;&amp; ulimit -Hu &amp;&amp; ulimit -Su'</pre>
</div>
<p>If needed, adjust them in the Daemon or override them per container.
For example, when using <code class="literal">docker run</code>, set:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">--ulimit nofile=65535:65535</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_disable_swapping"></a>Disable swapping<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Swapping needs to be disabled for performance and node stability.
For information about ways to do this, see <a class="xref" href="setup-configuration-memory.html" title="Disable swapping">Disable swapping</a>.</p>
<p>If you opt for the <code class="literal">bootstrap.memory_lock: true</code> approach,
you also need to define the <code class="literal">memlock: true</code> ulimit in the
<a href="https://docs.docker.com/engine/reference/commandline/dockerd/#default-ulimits" class="ulink" target="_top">Docker Daemon</a>,
or explicitly set for the container as shown in the  <a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">sample compose file</a>.
When using <code class="literal">docker run</code>, you can specify:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">-e "bootstrap.memory_lock=true" --ulimit memlock=-1:-1</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_randomize_published_ports"></a>Randomize published ports<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>The image <a href="https://docs.docker.com/engine/reference/builder/#/expose" class="ulink" target="_top">exposes</a>
TCP ports 9200 and 9300. For production clusters, randomizing the
published ports with <code class="literal">--publish-all</code> is recommended,
unless you are pinning one container per host.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-set-heap-size"></a>Manually set the heap size<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch automatically sizes JVM heap based on a nodes&#8217;s
<a class="xref" href="modules-node.html#node-roles" title="Node roles">roles</a> and the total memory available to the node&#8217;s container. We
recommend this default sizing for most production environments. If needed, you
can override default sizing by manually setting JVM heap size.</p>
<p>To manually set the heap size in production, bind mount a <a class="xref" href="advanced-configuration.html#set-jvm-options" title="Set JVM options">JVM
options</a> file under <code class="literal">/usr/share/elasticsearch/config/jvm.options.d</code> that
includes your desired <a class="xref" href="advanced-configuration.html#set-jvm-heap-size" title="Set the JVM heap size">heap size</a> settings.</p>
<p>For testing, you can also manually set the heap size using the <code class="literal">ES_JAVA_OPTS</code>
environment variable. For example, to use 1GB, use the following command.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -e ES_JAVA_OPTS="-Xms1g -Xmx1g" -e ENROLLMENT_TOKEN="&lt;token&gt;" --name es01 -p 9200:9200 --net elastic -it docker.elastic.co/elasticsearch/elasticsearch:8.14.3</pre>
</div>
<p>The <code class="literal">ES_JAVA_OPTS</code> variable overrides all other JVM options.
We do not recommend using <code class="literal">ES_JAVA_OPTS</code> in production.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_pin_deployments_to_a_specific_image_version"></a>Pin deployments to a specific image version<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Pin your deployments to a specific version of the Elasticsearch Docker image. For
example <code class="literal">docker.elastic.co/elasticsearch/elasticsearch:8.14.3</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_always_bind_data_volumes"></a>Always bind data volumes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You should use a volume bound on <code class="literal">/usr/share/elasticsearch/data</code> for the following reasons:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
The data of your Elasticsearch node won&#8217;t be lost if the container is killed
</li>
<li class="listitem">
Elasticsearch is I/O sensitive and the Docker storage driver is not ideal for fast I/O
</li>
<li class="listitem">
It allows the use of advanced
<a href="https://docs.docker.com/engine/extend/plugins/#volume-plugins" class="ulink" target="_top">Docker volume plugins</a>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_avoid_using_loop_lvm_mode"></a>Avoid using <code class="literal">loop-lvm</code> mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>If you are using the devicemapper storage driver, do not use the default <code class="literal">loop-lvm</code> mode.
Configure docker-engine to use
<a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-docker-with-devicemapper" class="ulink" target="_top">direct-lvm</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_centralize_your_logs"></a>Centralize your logs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Consider centralizing your logs by using a different
<a href="https://docs.docker.com/engine/admin/logging/overview/" class="ulink" target="_top">logging driver</a>. Also
note that the default json-file logging driver is not ideally suited for
production use.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-configuration-methods"></a>Configuring Elasticsearch with Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>When you run in Docker, the <a class="xref" href="settings.html#config-files-location" title="Config files location">Elasticsearch configuration files</a> are loaded from
<code class="literal">/usr/share/elasticsearch/config/</code>.</p>
<p>To use custom configuration files, you <a class="xref" href="docker.html#docker-config-bind-mount" title="Mounting Elasticsearch configuration files">bind-mount the files</a>
over the configuration files in the image.</p>
<p>You can set individual Elasticsearch configuration parameters using Docker environment variables.
The <a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">sample compose file</a> and the
<a class="xref" href="docker.html#docker-cli-run-dev-mode" title="Run Elasticsearch in Docker">single-node example</a> use this method. You can
use the setting name directly as the environment variable name. If
you cannot do this, for example because your orchestration platform forbids
periods in environment variable names, then you can use an alternative
style by converting the setting name as follows.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Change the setting name to uppercase
</li>
<li class="listitem">
Prefix it with <code class="literal">ES_SETTING_</code>
</li>
<li class="listitem">
Escape any underscores (<code class="literal">_</code>) by duplicating them
</li>
<li class="listitem">
Convert all periods (<code class="literal">.</code>) to underscores (<code class="literal">_</code>)
</li>
</ol>
</div>
<p>For example, <code class="literal">-e bootstrap.memory_lock=true</code> becomes
<code class="literal">-e ES_SETTING_BOOTSTRAP_MEMORY__LOCK=true</code>.</p>
<p>You can use the contents of a file to set the value of the
<code class="literal">ELASTIC_PASSWORD</code> or <code class="literal">KEYSTORE_PASSWORD</code> environment variables, by
suffixing the environment variable name with <code class="literal">_FILE</code>. This is useful for
passing secrets such as passwords to Elasticsearch without specifying them directly.</p>
<p>For example, to set the Elasticsearch bootstrap password from a file, you can bind mount the
file and set the <code class="literal">ELASTIC_PASSWORD_FILE</code> environment variable to the mount location.
If you mount the password file to <code class="literal">/run/secrets/bootstrapPassword.txt</code>, specify:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">-e ELASTIC_PASSWORD_FILE=/run/secrets/bootstrapPassword.txt</pre>
</div>
<p>You can override the default command for the image to pass Elasticsearch configuration
parameters as command line options. For example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run &lt;various parameters&gt; bin/elasticsearch -Ecluster.name=mynewclustername</pre>
</div>
<p>While bind-mounting your configuration files is usually the preferred method in production,
you can also <a class="xref" href="docker.html#_c_customized_image" title="Using custom Docker images">create a custom Docker image</a>
that contains your configuration.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-config-bind-mount"></a>Mounting Elasticsearch configuration files<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Create custom config files and bind-mount them over the corresponding files in the Docker image.
For example, to bind-mount <code class="literal">custom_elasticsearch.yml</code> with <code class="literal">docker run</code>, specify:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">-v full_path_to/custom_elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</pre>
</div>
<p>If you bind-mount a custom <code class="literal">elasticsearch.yml</code> file, ensure it includes the
<code class="literal">network.host: 0.0.0.0</code> setting. This setting ensures the node is reachable for
HTTP and transport traffic, provided its ports are exposed. The Docker image&#8217;s
built-in <code class="literal">elasticsearch.yml</code> file includes this setting by default.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The container <span class="strong strong"><strong>runs Elasticsearch as user <code class="literal">elasticsearch</code> using
uid:gid <code class="literal">1000:0</code></strong></span>. Bind mounted host directories and files must be accessible by this user,
and the data and log directories must be writable by this user.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-keystore-bind-mount"></a>Create an encrypted Elasticsearch keystore<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch will auto-generate a keystore file for <a class="xref" href="secure-settings.html" title="Secure settings">secure
settings</a>. This file is obfuscated but not encrypted.</p>
<p>To encrypt your secure settings with a password and have them persist outside
the container, use a <code class="literal">docker run</code> command to manually create the keystore
instead. The command must:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Bind-mount the <code class="literal">config</code> directory. The command will create an
<code class="literal">elasticsearch.keystore</code> file in this directory. To avoid errors, do
not directly bind-mount the <code class="literal">elasticsearch.keystore</code> file.
</li>
<li class="listitem">
Use the <code class="literal">elasticsearch-keystore</code> tool with the <code class="literal">create -p</code> option. You&#8217;ll be
prompted to enter a password for the keystore.
</li>
</ul>
</div>
<p>For example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -it --rm \
-v full_path_to/config:/usr/share/elasticsearch/config \
docker.elastic.co/elasticsearch/elasticsearch:8.14.3 \
bin/elasticsearch-keystore create -p</pre>
</div>
<p>You can also use a <code class="literal">docker run</code> command to add or update secure settings in the
keystore. You&#8217;ll be prompted to enter the setting values. If the keystore is
encrypted, you&#8217;ll also be prompted to enter the keystore password.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -it --rm \
-v full_path_to/config:/usr/share/elasticsearch/config \
docker.elastic.co/elasticsearch/elasticsearch:8.14.3 \
bin/elasticsearch-keystore \
add my.secure.setting \
my.other.secure.setting</pre>
</div>
<p>If you&#8217;ve already created the keystore and don&#8217;t need to update it, you can
bind-mount the <code class="literal">elasticsearch.keystore</code> file directly. You can use the
<code class="literal">KEYSTORE_PASSWORD</code> environment variable to provide the keystore password to the
container at startup. For example, a <code class="literal">docker run</code> command might have the
following options:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">-v full_path_to/config/elasticsearch.keystore:/usr/share/elasticsearch/config/elasticsearch.keystore
-e KEYSTORE_PASSWORD=mypassword</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_c_customized_image"></a>Using custom Docker images<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>In some environments, it might make more sense to prepare a custom image that contains
your configuration. A <code class="literal">Dockerfile</code> to achieve this might be as simple as:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">FROM docker.elastic.co/elasticsearch/elasticsearch:8.14.3
COPY --chown=elasticsearch:elasticsearch elasticsearch.yml /usr/share/elasticsearch/config/</pre>
</div>
<p>You could then build and run the image with:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker build --tag=elasticsearch-custom .
docker run -ti -v /usr/share/elasticsearch/data elasticsearch-custom</pre>
</div>
<p>Some plugins require additional security permissions.
You must explicitly accept them either by:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Attaching a <code class="literal">tty</code> when you run the Docker image and allowing the permissions when prompted.
</li>
<li class="listitem">
Inspecting the security permissions and accepting them (if appropriate) by adding the <code class="literal">--batch</code> flag to the plugin install command.
</li>
</ul>
</div>
<p>See <a href="/guide/en/elasticsearch/plugins/8.14/_other_command_line_parameters.html" class="ulink" target="_top">Plugin management</a>
for more information.</p>
<h4><a id="troubleshoot-docker-errors"></a>Troubleshoot Docker errors for Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
<p>Here’s how to resolve common errors when running Elasticsearch with Docker.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_elasticsearch_keystore_is_a_directory"></a>elasticsearch.keystore is a directory<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Exception in thread "main" org.elasticsearch.bootstrap.BootstrapException: java.io.IOException: Is a directory: SimpleFSIndexInput(path="/usr/share/elasticsearch/config/elasticsearch.keystore") Likely root cause: java.io.IOException: Is a directory</pre>
</div>
<p>A <a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">keystore-related</a> <code class="literal">docker run</code> command attempted
to directly bind-mount an <code class="literal">elasticsearch.keystore</code> file that doesn&#8217;t exist. If
you use the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to mount a file that doesn&#8217;t exist, Docker
instead creates a directory with the same name.</p>
<p>To resolve this error:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Delete the <code class="literal">elasticsearch.keystore</code> directory in the <code class="literal">config</code> directory.
</li>
<li class="listitem">
Update the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to point to the <code class="literal">config</code> directory path
rather than the keystore file&#8217;s path. For an example, see
<a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">Create an encrypted Elasticsearch keystore</a>.
</li>
<li class="listitem">
Retry the command.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_elasticsearch_keystore_device_or_resource_busy"></a>elasticsearch.keystore: Device or resource busy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Exception in thread "main" java.nio.file.FileSystemException: /usr/share/elasticsearch/config/elasticsearch.keystore.tmp -&gt; /usr/share/elasticsearch/config/elasticsearch.keystore: Device or resource busy</pre>
</div>
<p>A <code class="literal">docker run</code> command attempted to <a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">update the
keystore</a> while directly bind-mounting the <code class="literal">elasticsearch.keystore</code> file. To
update the keystore, the container requires access to other files in the
<code class="literal">config</code> directory, such as <code class="literal">keystore.tmp</code>.</p>
<p>To resolve this error:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Update the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to point to the <code class="literal">config</code> directory
path rather than the keystore file&#8217;s path. For an example, see
<a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">Create an encrypted Elasticsearch keystore</a>.
</li>
<li class="listitem">
Retry the command.
</li>
</ol>
</div>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="rpm.html">« Install Elasticsearch with RPM</a>
</span>
<span class="next">
<a href="settings.html">Configuring Elasticsearch »</a>
</span>
</div>
</body>
</html>
