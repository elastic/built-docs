<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tutorial: Customize built-in ILM policies | Elasticsearch Guide [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Tutorial: Customize built-in ILM policies | Elasticsearch Guide [8.14]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.14]"/>
<link rel="up" href="data-management.html" title="Data management"/>
<link rel="prev" href="index-lifecycle-management.html" title="ILM: Manage the index lifecycle"/>
<link rel="next" href="getting-started-index-lifecycle-management.html" title="Tutorial: Automate rollover with ILM"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.14"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="index-lifecycle-management.html">« ILM: Manage the index lifecycle</a>
</span>
<span class="next">
<a href="getting-started-index-lifecycle-management.html">Tutorial: Automate rollover with ILM »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-management.html">Data management</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Tutorial: Customize built-in ILM policies</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="example-using-index-lifecycle-policy"></a>Tutorial: Customize built-in ILM policies<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h2>
</div></div></div>

<p>Elasticsearch includes the following built-in ILM policies:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">logs@lifecycle</code>
</li>
<li class="listitem">
<code class="literal">metrics@lifecycle</code>
</li>
<li class="listitem">
<code class="literal">synthetics@lifecycle</code>
</li>
</ul>
</div>
<p>Elastic Agent uses these policies to manage backing indices for its data streams.
This tutorial shows you how to use Kibana’s <span class="strong strong"><strong>Index Lifecycle Policies</strong></span> to
customize these policies based on your application&#8217;s performance, resilience,
and retention requirements.</p>
<h3><a id="example-using-index-lifecycle-policy-scenario"></a>Scenario<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>You want to send log files to an Elasticsearch cluster so you can visualize and analyze
the data. This data has the following retention requirements:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
When the write index reaches 50GB or is 30 days old, roll over to a new index.
</li>
<li class="listitem">
After rollover, keep indices in the hot data tier for 30 days.
</li>
<li class="listitem">
<p>30 days after rollover:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Move indices to the warm data tier.
</li>
<li class="listitem">
Set replica shards to 1.
</li>
<li class="listitem">
<a class="xref" href="indices-forcemerge.html" title="Force merge API">Force merge</a> multiple index segments to free up the
space used by deleted documents.
</li>
</ul>
</div>
</li>
<li class="listitem">
Delete indices 90 days after rollover.
</li>
</ul>
</div>
<h3><a id="example-using-index-lifecycle-policy-prerequisites"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>To complete this tutorial, you&#8217;ll need:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>An Elasticsearch cluster with hot and warm data tiers.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Elasticsearch Service:
Elastic Stack deployments on Elasticsearch Service include a hot tier by default. To add a warm
tier, edit your deployment and click <span class="strong strong"><strong>Add capacity</strong></span> for the warm data tier.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-ess-add-warm-data-tier.png" alt="Add a warm data tier to your deployment">
</div>
</div>
</li>
<li class="listitem">
<p>Self-managed cluster:
Assign <code class="literal">data_hot</code> and <code class="literal">data_warm</code> roles to nodes as described in
<a class="xref" href="data-tiers.html" title="Data tiers"><em>Data tiers</em></a>.</p>
<p>For example, include the <code class="literal">data_warm</code> node role in the <code class="literal">elasticsearch.yml</code> file
of each node in the warm tier:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">node.roles: [ data_warm ]</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
A host with Elastic Agent installed and configured to send logs to your Elasticsearch
cluster.
</li>
</ul>
</div>
<h3><a id="example-using-index-lifecycle-policy-duplicate-ilm-policy"></a>Duplicate the policy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>Elastic Agent uses data streams with an index pattern of <code class="literal">logs-*-*</code> to store log
monitoring data. The managed <code class="literal">logs@lifecycle</code> ILM policy automatically manages
backing indices for these data streams.</p>
<p>If you don&#8217;t want to use the policy defaults, then you can customize the managed policy and then save it as a new policy. You can then use the new policy in related component templates and index templates.</p>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>You should never edit managed policies directly. Changes to managed policies might be rolled back or overwritten.</p>
</div>
</div>
<p>To save the <code class="literal">logs@lifecycle</code> policy as a new policy in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the menu and go to <span class="strong strong"><strong>Stack Management</strong></span> &gt; <span class="strong strong"><strong>Index Lifecycle Policies</strong></span>.
</li>
<li class="listitem">
Toggle <span class="strong strong"><strong>Include managed system policies</strong></span>.
</li>
<li class="listitem">
Select the <code class="literal">logs@lifecycle</code> policy.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Edit policy logs</strong></span> page, toggle <span class="strong strong"><strong>Save as new policy</strong></span>, and then provide a new name for the policy, for example, <code class="literal">logs-custom</code>.
</li>
</ol>
</div>
<p>The <code class="literal">logs@lifecycle</code> policy uses the recommended rollover defaults: Start writing to a new
index when the current write index reaches 50GB or becomes 30 days old.</p>
<p>To view or change the rollover settings, click <span class="strong strong"><strong>Advanced settings</strong></span> for the hot
phase. Then disable <span class="strong strong"><strong>Use recommended defaults</strong></span> to display the rollover
settings.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-hotphaserollover-default.png" alt="View rollover defaults">
</div>
</div>
<h3><a id="ilm-ex-modify-policy"></a>Modify the policy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>The default <code class="literal">logs@lifecycle</code> policy is designed to prevent the creation of many tiny daily
indices. You can modify your copy of the policy to meet your performance requirements and
manage resource usage.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Activate the warm phase and click <span class="strong strong"><strong>Advanced settings</strong></span>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Set <span class="strong strong"><strong>Move data into phase when</strong></span> to <span class="strong strong"><strong>30 days old</strong></span>. This moves indices to
the warm tier 30 days after rollover.
</li>
<li class="listitem">
Enable <span class="strong strong"><strong>Set replicas</strong></span> and change <span class="strong strong"><strong>Number of replicas</strong></span> to <span class="strong strong"><strong>1</strong></span>.
</li>
<li class="listitem">
Enable <span class="strong strong"><strong>Force merge data</strong></span> and set <span class="strong strong"><strong>Number of segments</strong></span> to <span class="strong strong"><strong>1</strong></span>.
</li>
</ol>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-modify-default-warm-phase-rollover.png" alt="Add a warm phase with custom settings">
</div>
</div>
</li>
<li class="listitem">
<p>In the warm phase, click the trash icon to enable the delete phase.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-enable-delete-phase.png" alt="Enable the delete phase">
</div>
</div>
<p>In the delete phase, set <span class="strong strong"><strong>Move data into phase when</strong></span> to <span class="strong strong"><strong>90 days old</strong></span>. This
deletes indices 90 days after rollover.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ilm/tutorial-ilm-delete-rollover.png" alt="Add a delete phase">
</div>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save as new policy</strong></span>.
</li>
</ol>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Copies of managed ILM policies are also marked as <span class="strong strong"><strong>Managed</strong></span>. You can use the <a class="xref" href="ilm-put-lifecycle.html" title="Create or update lifecycle policy API">Create or update lifecycle policy API</a> to update the <code class="literal">_meta.managed</code> parameter to <code class="literal">false</code>.</p>
</div>
</div>
<h3><a id="example-using-index-lifecycle-policy-apply-policy"></a>Apply the policy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/ilm/example-index-lifecycle-policy.asciidoc">edit</a></h3>
<p>To apply your new ILM policy to the <code class="literal">logs</code> index template, create or edit the <code class="literal">logs@custom</code> component template.</p>
<p>A <code class="literal">*@custom</code> component template allows you to customize the mappings and settings of managed index templates, without having to override managed index templates or component templates. This type of component template is automatically picked up by the index template. <a class="xref" href="indices-component-template.html#put-component-template-api-path-params" title="Path parameters">Learn more</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Click on the <span class="strong strong"><strong>Component Template</strong></span> tab and click <span class="strong strong"><strong>Create component template</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Logistics</strong></span>, name the component template <code class="literal">logs@custom</code>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Index settings</strong></span>, set the ILM policy name created in the previous step:</p>
<div class="pre_wrapper lang-JSON">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-JSON">{
    "index": {
        "lifecycle": {
            "name": "logs-custom"
        }
    }
}</pre>
</div>
</li>
<li class="listitem">
Continue to <span class="strong strong"><strong>Review</strong></span>, and then click <span class="strong strong"><strong>Save component template</strong></span>.
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Index Templates</strong></span>, tab, and then select the <code class="literal">logs</code> index template.
</li>
<li class="listitem">
In the summary, view the <span class="strong strong"><strong>Component templates</strong></span> list. <code class="literal">logs@custom</code> should be listed.
</li>
</ol>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="index-lifecycle-management.html">« ILM: Manage the index lifecycle</a>
</span>
<span class="next">
<a href="getting-started-index-lifecycle-management.html">Tutorial: Automate rollover with ILM »</a>
</span>
</div>
</body>
</html>
