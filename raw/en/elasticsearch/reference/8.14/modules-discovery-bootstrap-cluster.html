<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bootstrapping a cluster | Elasticsearch Guide [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Bootstrapping a cluster | Elasticsearch Guide [8.14]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.14]"/>
<link rel="up" href="modules-discovery.html" title="Discovery and cluster formation"/>
<link rel="prev" href="modules-discovery-voting.html" title="Voting configurations"/>
<link rel="next" href="cluster-state-publishing.html" title="Publishing the cluster state"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.14"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="modules-discovery-voting.html">« Voting configurations</a>
</span>
<span class="next">
<a href="cluster-state-publishing.html">Publishing the cluster state »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="modules-discovery.html">Discovery and cluster formation</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Bootstrapping a cluster</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/modules/discovery/bootstrapping.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="modules-discovery-bootstrap-cluster"></a>Bootstrapping a cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/modules/discovery/bootstrapping.asciidoc">edit</a></h2>
</div></div></div>
<p>Starting an Elasticsearch cluster for the very first time requires the initial
set of <a class="xref" href="modules-node.html#master-node" title="Master-eligible node">master-eligible nodes</a> to be explicitly defined on one or
more of the master-eligible nodes in the cluster. This is known as <em>cluster
bootstrapping</em>. This is only required the first time a cluster starts up.
Freshly-started nodes that are joining a running cluster obtain this
information from the cluster&#8217;s elected master.</p>
<p>The initial set of master-eligible nodes is defined in the
<a class="xref" href="important-settings.html#initial_master_nodes" title="cluster.initial_master_nodes"><code class="literal">cluster.initial_master_nodes</code> setting</a>. This should be
set to a list containing one of the following items for each master-eligible
node:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <a class="xref" href="important-settings.html#node-name" title="Node name setting">node name</a> of the node.
</li>
<li class="listitem">
The node&#8217;s hostname if <code class="literal">node.name</code> is not set, because <code class="literal">node.name</code> defaults
to the node&#8217;s hostname. You must use either the fully-qualified hostname or
the bare hostname <a class="xref" href="modules-discovery-bootstrap-cluster.html#modules-discovery-bootstrap-cluster-fqdns" title="Node name formats must match">depending on
your system configuration</a>.
</li>
<li class="listitem">
The IP address of the node&#8217;s <a class="xref" href="modules-network.html#modules-network-binding-publishing" title="Binding and publishing">transport
publish address</a>, if it is not possible to use the <code class="literal">node.name</code> of the node.
This is normally the IP address to which
<a class="xref" href="modules-network.html#common-network-settings" title="Commonly used network settings"><code class="literal">network.host</code></a> resolves but
<a class="xref" href="modules-network.html#advanced-network-settings" title="Advanced network settings">this can be overridden</a>.
</li>
<li class="listitem">
The IP address and port of the node&#8217;s publish address, in the form <code class="literal">IP:PORT</code>,
if it is not possible to use the <code class="literal">node.name</code> of the node and there are
multiple nodes sharing a single IP address.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>After the cluster has formed, remove the <code class="literal">cluster.initial_master_nodes</code> setting
from each node&#8217;s configuration. It should not be set for master-ineligible
nodes, master-eligible nodes joining an existing cluster, or nodes which are
restarting.</p>
<p>If you leave <code class="literal">cluster.initial_master_nodes</code> in place once the cluster has
formed then there is a risk that a future misconfiguration may result in
bootstrapping a new cluster alongside your existing cluster. It may not be
possible to recover from this situation without losing data.</p>
</div>
</div>
<p>The simplest way to create a new cluster is for you to select one of your
master-eligible nodes that will bootstrap itself into a single-node cluster,
which all the other nodes will then join. This simple approach is not resilient
to failures until the other master-eligible nodes have joined the cluster. For
example, if you have a master-eligible node with <a class="xref" href="important-settings.html#node-name" title="Node name setting">node name</a>
<code class="literal">master-a</code> then configure it as follows (omitting
<code class="literal">cluster.initial_master_nodes</code> from the configuration of all other nodes):</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">cluster.initial_master_nodes: master-a</pre>
</div>
<p>For fault-tolerant cluster bootstrapping, use all the master-eligible nodes.
For instance, if your cluster has 3 master-eligible nodes with <a class="xref" href="important-settings.html#node-name" title="Node name setting">node
names</a> <code class="literal">master-a</code>, <code class="literal">master-b</code> and <code class="literal">master-c</code> then configure them all as
follows:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">cluster.initial_master_nodes:
  - master-a
  - master-b
  - master-c</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must set <code class="literal">cluster.initial_master_nodes</code> to the same list of
nodes on each node on which it is set in order to be sure that only a single
cluster forms during bootstrapping. If <code class="literal">cluster.initial_master_nodes</code> varies
across the nodes on which it is set then you may bootstrap multiple clusters.
It is usually not possible to recover from this situation without losing data.</p>
</div>
</div>
<div class="sidebar">
<a id="modules-discovery-bootstrap-cluster-fqdns"></a>
<div class="titlepage"><div><div>
<p class="title"><strong>Node name formats must match</strong></p>
</div></div></div>
<p>The node names used in the
<code class="literal">cluster.initial_master_nodes</code> list must exactly match the <code class="literal">node.name</code>
properties of the nodes. By default the node name is set to the machine&#8217;s
hostname which may or may not be fully-qualified depending on your system
configuration. If each node name is a fully-qualified domain name such as
<code class="literal">master-a.example.com</code> then you must use fully-qualified domain names in the
<code class="literal">cluster.initial_master_nodes</code> list too; conversely if your node names are bare
hostnames (without the <code class="literal">.example.com</code> suffix) then you must use bare hostnames
in the <code class="literal">cluster.initial_master_nodes</code> list. If you use a mix of fully-qualified
and bare hostnames, or there is some other mismatch between <code class="literal">node.name</code> and
<code class="literal">cluster.initial_master_nodes</code>, then the cluster will not form successfully and
you will see log messages like the following.</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">[master-a.example.com] master not discovered yet, this node has
not previously joined a bootstrapped (v7+) cluster, and this
node must discover master-eligible nodes [master-a, master-b] to
bootstrap a cluster: have discovered [{master-b.example.com}{...</pre>
</div>
<p>This message shows the node names <code class="literal">master-a.example.com</code> and
<code class="literal">master-b.example.com</code> as well as the <code class="literal">cluster.initial_master_nodes</code> entries
<code class="literal">master-a</code> and <code class="literal">master-b</code>, and it is clear from this message that they do not
match exactly.</p>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="bootstrap-cluster-name"></a>Choosing a cluster name<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/modules/discovery/bootstrapping.asciidoc">edit</a></h3>
</div></div></div>
<p>The <a class="xref" href="important-settings.html#cluster-name" title="Cluster name setting"><code class="literal">cluster.name</code></a> setting enables you to create multiple
clusters which are separated from each other. Nodes verify that they agree on
their cluster name when they first connect to each other, and Elasticsearch
will only form a cluster from nodes that all have the same cluster name. The
default value for the cluster name is <code class="literal">elasticsearch</code>, but it is recommended to
change this to reflect the logical name of the cluster.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="bootstrap-auto-bootstrap"></a>Auto-bootstrapping in development mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/modules/discovery/bootstrapping.asciidoc">edit</a></h3>
</div></div></div>
<p>By default each node will automatically bootstrap itself into a single-node
cluster the first time it starts. If any of the following settings are
configured then auto-bootstrapping will not take place:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">discovery.seed_providers</code>
</li>
<li class="listitem">
<code class="literal">discovery.seed_hosts</code>
</li>
<li class="listitem">
<code class="literal">cluster.initial_master_nodes</code>
</li>
</ul>
</div>
<p>To add a new node into an existing cluster, configure <code class="literal">discovery.seed_hosts</code> or
other relevant discovery settings so that the new node can discover the
existing master-eligible nodes in the cluster. To bootstrap a new multi-node
cluster, configure <code class="literal">cluster.initial_master_nodes</code> as described in the
<a class="xref" href="modules-discovery-bootstrap-cluster.html" title="Bootstrapping a cluster">section on cluster bootstrapping</a> as
well as <code class="literal">discovery.seed_hosts</code> or other relevant discovery settings.</p>
<div class="sidebar">
<a id="modules-discovery-bootstrap-cluster-joining"></a>
<div class="titlepage"><div><div>
<p class="title"><strong>Forming a single cluster</strong></p>
</div></div></div>
<p>Once an Elasticsearch node has joined an existing cluster, or bootstrapped a new
cluster, it will not join a different cluster. Elasticsearch will not merge separate
clusters together after they have formed, even if you subsequently try and
configure all the nodes into a single cluster. This is because there is no way
to merge these separate clusters together without a risk of data loss. You can
tell that you have formed separate clusters by checking the cluster UUID
reported by <code class="literal">GET /</code> on each node.</p>
<p>If you intended to add a node into an existing cluster but instead bootstrapped
a separate single-node cluster then you must start again:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Shut down the node.
</li>
<li class="listitem">
Completely wipe the node by deleting the contents of its <a class="xref" href="modules-node.html#data-path" title="path.data">data
folder</a>.
</li>
<li class="listitem">
Configure <code class="literal">discovery.seed_hosts</code> or <code class="literal">discovery.seed_providers</code> and other
relevant discovery settings. Ensure <code class="literal">cluster.initial_master_nodes</code> is not set
on any node.
</li>
<li class="listitem">
Restart the node and verify that it joins the existing cluster rather than
forming its own one-node cluster.
</li>
</ol>
</div>
<p>If you intended to form a new multi-node cluster but instead bootstrapped a
collection of single-node clusters then you must start again:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Shut down all the nodes.
</li>
<li class="listitem">
Completely wipe each node by deleting the contents of their <a class="xref" href="modules-node.html#data-path" title="path.data">data
folders</a>.
</li>
<li class="listitem">
Configure <code class="literal">cluster.initial_master_nodes</code> as described above.
</li>
<li class="listitem">
Configure <code class="literal">discovery.seed_hosts</code> or <code class="literal">discovery.seed_providers</code> and other
relevant discovery settings.
</li>
<li class="listitem">
Restart all the nodes and verify that they have formed a single cluster.
</li>
<li class="listitem">
Remove <code class="literal">cluster.initial_master_nodes</code> from every node&#8217;s configuration.
</li>
</ol>
</div>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="modules-discovery-voting.html">« Voting configurations</a>
</span>
<span class="next">
<a href="cluster-state-publishing.html">Publishing the cluster state »</a>
</span>
</div>
</body>
</html>
