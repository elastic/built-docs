<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="hot-spotting, hotspot, hot-spot, hot spot, hotspots, hotspotting">
<title>Create or update query ruleset | Elasticsearch Guide [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Create or update query ruleset | Elasticsearch Guide [8.14]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.14]"/>
<link rel="up" href="query-rules-apis.html" title="Query rules APIs"/>
<link rel="prev" href="query-rules-apis.html" title="Query rules APIs"/>
<link rel="next" href="get-query-ruleset.html" title="Get query ruleset"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.14"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.14"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="query-rules-apis.html">Query rules APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="query-rules-apis.html">« Query rules APIs</a>
</span>
<span class="next">
<a href="get-query-ruleset.html">Get query ruleset »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="put-query-ruleset"></a>Create or update query ruleset<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/query-rules/apis/put-query-ruleset.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>

<p>Creates or updates a query ruleset.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="put-query-ruleset-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/query-rules/apis/put-query-ruleset.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _query_rules/&lt;ruleset_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="put-query-ruleset-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/query-rules/apis/put-query-ruleset.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_search_query_rules</code> privilege.</p>
<p class="child_attributes"><a id="put-query-ruleset-request-body"></a>(Required, object) Contains parameters for a query ruleset:</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_request_body_2"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/query-rules/apis/put-query-ruleset.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">rules</code>
</span>
</dt>
<dd>
(Required, array of objects) The specific rules included in this query ruleset.
</dd>
</dl>
</div>
<p>There is a limit of 100 rules per ruleset.
This can be increased up to 1000 using the <code class="literal">xpack.applications.rules.max_rules_per_ruleset</code> cluster setting.</p>
<p>Each rule must have the following information:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">rule_id</code> (Required, string) A unique identifier for this rule.
</li>
<li class="listitem">
<code class="literal">type</code> (Required, string) The type of rule.
At this time only <code class="literal">pinned</code> query rule types are allowed.
</li>
<li class="listitem">
<code class="literal">criteria</code> (Required, array of objects) The criteria that must be met for the rule to be applied.
If multiple criteria are specified for a rule, all criteria must be met for the rule to be applied.
</li>
<li class="listitem">
<code class="literal">actions</code> (Required, object) The actions to take when the rule is matched.
The format of this action depends on the rule type.
</li>
</ul>
</div>
<p>Criteria must have the following information:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">type</code> (Required, string) The type of criteria.
The following criteria types are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">exact</code>
Only exact matches meet the criteria defined by the rule.
Applicable for string or numerical values.
</li>
<li class="listitem">
<code class="literal">fuzzy</code>
Exact matches or matches within the allowed <a href="https://en.wikipedia.org/wiki/Levenshtein_distance" class="ulink" target="_top">Levenshtein Edit Distance</a> meet the criteria defined by the rule.
Only applicable for string values.
</li>
<li class="listitem">
<code class="literal">prefix</code>
Matches that start with this value meet the criteria defined by the rule.
Only applicable for string values.
</li>
<li class="listitem">
<code class="literal">suffix</code>
Matches that end with this value meet the criteria defined by the rule.
Only applicable for string values.
</li>
<li class="listitem">
<code class="literal">contains</code>
Matches that contain this value anywhere in the field meet the criteria defined by the rule.
Only applicable for string values.
</li>
<li class="listitem">
<code class="literal">lt</code>
Matches with a value less than this value meet the criteria defined by the rule.
Only applicable for numerical values.
</li>
<li class="listitem">
<code class="literal">lte</code>
Matches with a value less than or equal to this value meet the criteria defined by the rule.
Only applicable for numerical values.
</li>
<li class="listitem">
<code class="literal">gt</code>
Matches with a value greater than this value meet the criteria defined by the rule.
Only applicable for numerical values.
</li>
<li class="listitem">
<code class="literal">gte</code>
Matches with a value greater than or equal to this value meet the criteria defined by the rule.
Only applicable for numerical values.
</li>
<li class="listitem">
<code class="literal">always</code>
Matches all queries, regardless of input.
</li>
</ul>
</div>
</li>
<li class="listitem">
<code class="literal">metadata</code> (Optional, string) The metadata field to match against.
This metadata will be used to match against <code class="literal">match_criteria</code> sent in the <a class="xref" href="query-dsl-rule-query.html" title="Rule query">Rule</a>.
Required for all criteria types except <code class="literal">global</code>.
</li>
<li class="listitem">
<code class="literal">values</code> (Optional, array of strings) The values to match against the metadata field.
Only one value must match for the criteria to be met.
Required for all criteria types except <code class="literal">global</code>.
</li>
</ul>
</div>
<p>Actions depend on the rule type.
For <code class="literal">pinned</code> rules, actions follow the format specified by the <a class="xref" href="query-dsl-pinned-query.html" title="Pinned Query">Pinned Query</a>.
The following actions are allowed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ids</code> (Optional, array of strings) The unique <a class="xref" href="mapping-id-field.html" title="_id field">document IDs</a> of the documents to pin.
Only one of <code class="literal">ids</code> or <code class="literal">docs</code> may be specified, and at least one must be specified.
</li>
<li class="listitem">
<p><code class="literal">docs</code> (Optional, array of objects) The documents to pin.
Only one of <code class="literal">ids</code> or <code class="literal">docs</code> may be specified, and at least one must be specified.
You can specify the following attributes for each document:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">_index</code> (Required, string) The index of the document to pin.
</li>
<li class="listitem">
<code class="literal">_id</code> (Required, string) The unique <a class="xref" href="mapping-id-field.html" title="_id field">document ID</a>.
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Due to limitations within <a class="xref" href="query-dsl-pinned-query.html" title="Pinned Query">Pinned queries</a>, you can only pin documents using <code class="literal">ids</code> or <code class="literal">docs</code>, but cannot use both in single rule.
It is advised to use one or the other in query rulesets, to avoid errors.
Additionally, pinned queries have a maximum limit of 100 pinned hits.
If multiple matching rules pin more than 100 documents, only the first 100 documents are pinned in the order they are specified in the ruleset.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="put-query-ruleset-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.14/docs/reference/query-rules/apis/put-query-ruleset.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example creates a new query ruleset called <code class="literal">my-ruleset</code>.</p>
<p>Two rules are associated with <code class="literal">my-ruleset</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">my-rule1</code> will pin documents with IDs <code class="literal">id1</code> and <code class="literal">id2</code> when <code class="literal">user_query</code> contains <code class="literal">pugs</code> <em>or</em> <code class="literal">puggles</code> <span class="strong strong"><strong>and</strong></span> <code class="literal">user_country</code> exactly matches <code class="literal">us</code>.
</li>
<li class="listitem">
<code class="literal">my-rule2</code> will pin documents from different, specified indices with IDs <code class="literal">id3</code> and <code class="literal">id4</code> when the <code class="literal">query_string</code> fuzzily matches <code class="literal">rescue dogs</code>.
</li>
</ul>
</div>
<a id="e619e896ce3dad9dcfc6f8700438be98"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _query_rules/my-ruleset
{
    "rules": [
        {
            "rule_id": "my-rule1",
            "type": "pinned",
            "criteria": [
                {
                    "type": "contains",
                    "metadata": "user_query",
                    "values": [ "pugs", "puggles" ]
                },
                {
                    "type": "exact",
                    "metadata": "user_country",
                    "values": [ "us" ]
                }
            ],
            "actions": {
                "ids": [
                    "id1",
                    "id2"
                ]
            }
        },
        {
            "rule_id": "my-rule2",
            "type": "pinned",
            "criteria": [
                {
                    "type": "fuzzy",
                    "metadata": "user_query",
                    "values": [ "rescue dogs" ]
                }
            ],
            "actions": {
                "docs": [
                    {
                        "_index": "index1",
                        "_id": "id3"
                    },
                    {
                        "_index": "index2",
                        "_id": "id4"
                    }
                ]
            }
        }
    ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2931.console"></div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="query-rules-apis.html">« Query rules APIs</a>
</span>
<span class="next">
<a href="get-query-ruleset.html">Get query ruleset »</a>
</span>
</div>
</div>
</body>
</html>
