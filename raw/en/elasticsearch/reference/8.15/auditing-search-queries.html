<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Auditing search queries | Elasticsearch Guide [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Auditing search queries | Elasticsearch Guide [8.15]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.15]"/>
<link rel="up" href="enable-audit-logging.html" title="Enable audit logging"/>
<link rel="prev" href="audit-log-ignore-policy.html" title="Logfile audit events ignore policies"/>
<link rel="next" href="ip-filtering.html" title="Restricting connections with IP filtering"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.15"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.15"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="audit-log-ignore-policy.html">« Logfile audit events ignore policies</a>
</span>
<span class="next">
<a href="ip-filtering.html">Restricting connections with IP filtering »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="enable-audit-logging.html">Enable audit logging</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Auditing search queries</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/security/auditing/auditing-search-queries.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="auditing-search-queries"></a>Auditing search queries<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/security/auditing/auditing-search-queries.asciidoc">edit</a></h2>
</div></div></div>
<p>There is no <a class="xref" href="audit-event-types.html" title="Audit events">audit event type</a> specifically
dedicated to search queries. Search queries are analyzed and then processed; the
processing triggers authorization actions that are audited.
However, the original raw query, as submitted by the client, is not accessible
downstream when authorization auditing occurs.</p>
<p>Search queries are contained inside HTTP request bodies, however, and some
audit events that are generated by the REST layer, on the coordinating node,
can be toggled to output the request body to the audit log. Therefore, one
must audit request bodies in order to audit search queries.</p>
<p>To make certain audit events include the request body, edit the following
setting in the <code class="literal">elasticsearch.yml</code> file:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.security.audit.logfile.events.emit_request_body: true</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>No filtering is performed when auditing, so sensitive data might be
audited in plain text when audit events include the request body. Also, the
request body can contain malicious content that can break a parser consuming
the audit logs.</p>
</div>
</div>
<p>The request body is printed as an escaped JSON string value (RFC 4627) to the <code class="literal">request.body</code>
event attribute.</p>
<p>Not all events contain the <code class="literal">request.body</code> attribute, even when the above setting
is toggled. The ones that do are: <code class="literal">authentication_success</code>,
<code class="literal">authentication_failed</code>, <code class="literal">realm_authentication_failed</code>, <code class="literal">tampered_request</code>, <code class="literal">run_as_denied</code>,
and <code class="literal">anonymous_access_denied</code>. The <code class="literal">request.body</code> attribute is printed on the coordinating node only
(the node that handles the REST request). Most of these event types are
<a class="xref" href="auditing-settings.html#xpack-sa-lf-events-include">not included by default</a>.</p>
<p>A good practical piece of advice is to add <code class="literal">authentication_success</code> to the event
types that are audited (add it to the list in the <code class="literal">xpack.security.audit.logfile.events.include</code>),
as this event type is not audited by default.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Typically, the include list contains other event types as well, such as
<code class="literal">access_granted</code> or <code class="literal">access_denied</code>.</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="audit-log-ignore-policy.html">« Logfile audit events ignore policies</a>
</span>
<span class="next">
<a href="ip-filtering.html">Restricting connections with IP filtering »</a>
</span>
</div>
</body>
</html>
