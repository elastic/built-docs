<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch diagnostic, diagnostics">
<title>Upgrade model snapshots API | Elasticsearch Guide [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Upgrade model snapshots API | Elasticsearch Guide [8.15]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.15]"/>
<link rel="up" href="ml-ad-apis.html" title="Machine learning anomaly detection APIs"/>
<link rel="prev" href="ml-update-snapshot.html" title="Update model snapshots API"/>
<link rel="next" href="ml-df-analytics-apis.html" title="Machine learning data frame analytics APIs"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.15"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="ml-update-snapshot.html">« Update model snapshots API</a>
</span>
<span class="next">
<a href="ml-df-analytics-apis.html">Machine learning data frame analytics APIs »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-ad-apis.html">Machine learning anomaly detection APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Upgrade model snapshots API</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-upgrade-job-model-snapshot"></a>Upgrade model snapshots API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h2>
</div></div></div>

<p>Upgrades an anomaly detection model snapshot to the latest major version.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>From Elasticsearch 8.10.0,  a new version number is used to
track the configuration and state changes in the machine learning plugin. This new
version number is decoupled from the product version and will increment
independently.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-request"></a>Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST _ml/anomaly_detectors/&lt;job_id&gt;/model_snapshots/&lt;snapshot_id&gt;/_upgrade</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-prereqs"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.
</li>
<li class="listitem">
The upgraded snapshot must have a version matching the previous major version.
</li>
<li class="listitem">
The upgraded snapshot must NOT be the current anomaly detection job snapshot.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-desc"></a>Description<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<p>Over time, older snapshot formats are deprecated and removed. Anomaly detection jobs
support only snapshots that are from the current or previous major version.</p>
<p>This API provides a means to upgrade a snapshot to the current major version.
This aids in preparing the cluster for an upgrade to the next major version.</p>
<p>Only one snapshot per anomaly detection job can be upgraded at a time and the upgraded
snapshot cannot be the current snapshot of the anomaly detection job.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-path-parms"></a>Path parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;snapshot_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the model snapshot.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-query-parms"></a>Query parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, time) Controls the time to wait for the request to complete. The
default value is 30 minutes.
</dd>
<dt>
<span class="term">
<code class="literal">wait_for_completion</code>
</span>
</dt>
<dd>
(Optional, boolean) When true, the API won&#8217;t respond until the upgrade is
complete. Otherwise, it responds as soon as the upgrade task is assigned to a
node. Default is false.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-response-body"></a>Response body<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
(string) The ID of the assigned node for the upgrade task if it is still running.
</dd>
<dt>
<span class="term">
<code class="literal">completed</code>
</span>
</dt>
<dd>
(boolean) When true, this means the task is complete. When false, it is still running.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-upgrade-job-model-snapshot-example"></a>Examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/ml/anomaly-detection/apis/upgrade-job-model-snapshot.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ml.upgradeJobSnapshot({
  job_id: "low_request_rate",
  snapshot_id: 1828371,
  timeout: "45m",
  wait_for_completion: "true",
});
console.log(response);</pre>
</div>
<a id="a9dd9595e96c307b8c798beaeb571521"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _ml/anomaly_detectors/low_request_rate/model_snapshots/1828371/_upgrade?timeout=45m&amp;wait_for_completion=true</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/2960.console"></div>
<p>When the snapshot upgrade starts, you receive the following results:</p>
<a id="9b2607007f1a3123b9c5235d50253480"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "completed" : false,
  "node" : "node-1"
}</pre>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ml-update-snapshot.html">« Update model snapshots API</a>
</span>
<span class="next">
<a href="ml-df-analytics-apis.html">Machine learning data frame analytics APIs »</a>
</span>
</div>
</body>
</html>
