<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch diagnostic, diagnostics">
<title>Create API key API | Elasticsearch Guide [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Create API key API | Elasticsearch Guide [8.15]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.15]"/>
<link rel="up" href="security-api.html" title="Security APIs"/>
<link rel="prev" href="security-api-clear-service-token-caches.html" title="Clear service account token caches API"/>
<link rel="next" href="security-api-put-privileges.html" title="Create or update application privileges API"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.15"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="security-api-clear-service-token-caches.html">« Clear service account token caches API</a>
</span>
<span class="next">
<a href="security-api-put-privileges.html">Create or update application privileges API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="security-api.html">Security APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Create API key API</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/rest-api/security/create-api-keys.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-api-create-api-key"></a>Create API key API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/rest-api/security/create-api-keys.asciidoc">edit</a></h2>
</div></div></div>

<p>Creates an API key for access without requiring basic authentication.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-create-api-key-request"></a>Request<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/rest-api/security/create-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">POST /_security/api_key</code></p>
<p><code class="literal">PUT /_security/api_key</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-create-api-key-prereqs"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/rest-api/security/create-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To use this API, you must have at least the <code class="literal">manage_own_api_key</code> cluster privilege.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the credential that is used to authenticate this request is
an API key, the derived API key cannot have any privileges. If you specify privileges, the API returns an error.
See the note under <a class="xref" href="security-api-create-api-key.html#api-key-role-descriptors"><code class="literal">role_descriptors</code></a>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-create-api-key-desc"></a>Description<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/rest-api/security/create-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>The API keys are created by the Elasticsearch API key service, which is automatically enabled.
For instructions on disabling the API key service, see <a class="xref" href="security-settings.html#api-key-service-settings" title="API key service settings">API key service settings</a>.</p>
<p>A successful request returns a JSON structure that contains the
API key, its unique id, and its name. If applicable, it also returns expiration
information for the API key in milliseconds.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>By default, API keys never expire. You can specify expiration information
when you create the API keys.</p>
</div>
</div>
<p>See <a class="xref" href="security-settings.html#api-key-service-settings" title="API key service settings">API key service settings</a> for configuration settings related to API key
service.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-create-api-key-request-body"></a>Request body<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/rest-api/security/create-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>The following parameters can be specified in the body of a POST or PUT request:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string) Specifies the name for this API key.
</dd>
</dl>
</div>
<div class="variablelist">
<a id="api-key-role-descriptors"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">role_descriptors</code>
</span>
</dt>
<dd>
<p>
(Optional, object) The role descriptors for this API
key. This parameter is optional. When it is not specified or is an empty array,
then the API key will have a <em>point in time snapshot of permissions of the
authenticated user</em>. If you supply role descriptors then the resultant permissions
would be an intersection of API keys permissions and authenticated user&#8217;s permissions
thereby limiting the access scope for API keys.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Due to the way in which this permission intersection is calculated, it is not
possible to create an API key that is a child of another API key, unless the derived
key is created without any privileges. In this case, you must explicitly specify a
role descriptor with no privileges. The derived API key can be used for
authentication; it will not have authority to call Elasticsearch APIs.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">applications</code>
</span>
</dt>
<dd>
<p>
(list) A list of application privilege entries.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">application</code> (required)
</span>
</dt>
<dd>
(string) The name of the application to which this entry applies
</dd>
<dt>
<span class="term">
<code class="literal">privileges</code> (required)
</span>
</dt>
<dd>
(list) A list of strings, where each element is the name of an application
privilege or action.
</dd>
<dt>
<span class="term">
<code class="literal">resources</code> (required)
</span>
</dt>
<dd>
(list) A list resources to which the privileges are applied.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">cluster</code>
</span>
</dt>
<dd>
(list) A list of cluster privileges. These privileges define the
cluster level actions that API keys are able to execute.
</dd>
<dt>
<span class="term">
<code class="literal">global</code>
</span>
</dt>
<dd>
(object) An object defining global privileges. A global privilege is
a form of cluster privilege that is request-aware. Support for global privileges
is currently limited to the management of application privileges.
This field is optional.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
<p>
(list) A list of indices permissions entries.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">field_security</code>
</span>
</dt>
<dd>
(object) The document fields that the API keys have
read access to. For more information, see
<a class="xref" href="field-and-document-access-control.html" title="Setting up field and document level security">Setting up field and document level security</a>.
</dd>
<dt>
<span class="term">
<code class="literal">names</code> (required)
</span>
</dt>
<dd>
(list) A list of indices (or index name patterns) to which the
permissions in this entry apply.
</dd>
<dt>
<span class="term">
<code class="literal">privileges</code>(required)
</span>
</dt>
<dd>
(list) The index level privileges that the API keys
have on the specified indices.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
A search query that defines the documents the API keys have
read access to. A document within the specified indices must match this query in
order for it to be accessible by the API keys.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">metadata</code>
</span>
</dt>
<dd>
(object) Optional meta-data. Within the <code class="literal">metadata</code> object, keys
that begin with <code class="literal">_</code> are reserved for system usage.
</dd>
<dt>
<span class="term">
<code class="literal">restriction</code>
</span>
</dt>
<dd>
<p>
(object) Optional restriction for when the role descriptor is allowed to be effective. For more information, see
<a class="xref" href="role-restriction.html" title="Role restriction">Role restriction</a>.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">workflows</code>
</span>
</dt>
<dd>
<p>
(list) A list of workflows to which the API key is restricted.
For a full list see <a class="xref" href="role-restriction.html#workflows-restriction" title="Workflows">Workflows</a>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In order to use role restriction, an API key must be created with a <span class="strong strong"><strong>single role descriptor</strong></span>.</p>
</div>
</div>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">run_as</code>
</span>
</dt>
<dd>
(list) A list of users that the API keys can impersonate.
For more information, see
<a class="xref" href="run-as-privilege.html" title="Submitting requests on behalf of other users">Submitting requests on behalf of other users</a>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">expiration</code>
</span>
</dt>
<dd>
(Optional, string) Expiration time for the API key. By default, API keys never
expire.
</dd>
<dt>
<span class="term">
<code class="literal">metadata</code>
</span>
</dt>
<dd>
(Optional, object) Arbitrary metadata that you want to associate with the API key.
It supports nested data structure.
Within the <code class="literal">metadata</code> object, keys beginning with <code class="literal">_</code> are reserved for
system usage.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="security-api-create-api-key-example"></a>Examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.15/docs/reference/rest-api/security/create-api-keys.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example creates an API key:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.security.createApiKey({
  name: "my-api-key",
  expiration: "1d",
  role_descriptors: {
    "role-a": {
      cluster: ["all"],
      indices: [
        {
          names: ["index-a*"],
          privileges: ["read"],
        },
      ],
    },
    "role-b": {
      cluster: ["all"],
      indices: [
        {
          names: ["index-b*"],
          privileges: ["all"],
        },
      ],
    },
  },
  metadata: {
    application: "my-application",
    environment: {
      level: 1,
      trusted: true,
      tags: ["dev", "staging"],
    },
  },
});
console.log(response);</pre>
</div>
<a id="4a4b8a406681584a91c0e614c1fa4344"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_security/api_key
{
  "name": "my-api-key",
  "expiration": "1d",   <a id="CO861-1"></a><i class="conum" data-value="1"></i>
  "role_descriptors": { <a id="CO861-2"></a><i class="conum" data-value="2"></i>
    "role-a": {
      "cluster": ["all"],
      "indices": [
        {
          "names": ["index-a*"],
          "privileges": ["read"]
        }
      ]
    },
    "role-b": {
      "cluster": ["all"],
      "indices": [
        {
          "names": ["index-b*"],
          "privileges": ["all"]
        }
      ]
    }
  },
  "metadata": {
    "application": "my-application",
    "environment": {
       "level": 1,
       "trusted": true,
       "tags": ["dev", "staging"]
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/3163.console"></div>
<div class="calloutlist default has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO861-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Optional expiration for the API key being generated. If expiration is not
provided then the API keys do not expire.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO861-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Optional role descriptors for this API key. If not provided, permissions
of the authenticated user are applied.</p>
</td>
</tr>
</table>
</div>
<p>A successful call returns a JSON structure that provides
API key information.</p>
<a id="c998a7ff6ea618f1a7451fc9a9926d39"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "id": "VuaCfGcBCdbkQm-e5aOx",        <a id="CO862-1"></a><i class="conum" data-value="1"></i>
  "name": "my-api-key",
  "expiration": 1544068612110,         <a id="CO862-2"></a><i class="conum" data-value="2"></i>
  "api_key": "ui2lp2axTNmsyakw9tvNnw", <a id="CO862-3"></a><i class="conum" data-value="3"></i>
  "encoded": "VnVhQ2ZHY0JDZGJrUW0tZTVhT3g6dWkybHAyYXhUTm1zeWFrdzl0dk5udw=="  <a id="CO862-4"></a><i class="conum" data-value="4"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO862-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Unique <code class="literal">id</code> for this API key</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO862-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Optional expiration in milliseconds for this API key</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO862-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Generated API key</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO862-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>API key credentials which is the Base64-encoding of the UTF-8
representation of the <code class="literal">id</code> and <code class="literal">api_key</code> joined by a colon (<code class="literal">:</code>).</p>
</td>
</tr>
</table>
</div>
<p>To use the generated API key, send a request with an <code class="literal">Authorization</code> header that
contains an <code class="literal">ApiKey</code> prefix followed by the API key credentials
(the <code class="literal">encoded</code> value from the response).</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">curl -H "Authorization: ApiKey VnVhQ2ZHY0JDZGJrUW0tZTVhT3g6dWkybHAyYXhUTm1zeWFrdzl0dk5udw==" \
http://localhost:9200/_cluster/health\?pretty <a id="CO863-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO863-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>If your node has <code class="literal">xpack.security.http.ssl.enabled</code> set to <code class="literal">true</code>, then you
must specify <code class="literal">https</code> when creating your API key</p>
</td>
</tr>
</table>
</div>
<p>On a Unix-like system, the <code class="literal">encoded</code> value can be created with the following
command:</p>
<a id="concat-api-key"></a><div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">echo -n "VuaCfGcBCdbkQm-e5aOx:ui2lp2axTNmsyakw9tvNnw" | base64 <a id="CO864-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO864-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Use <code class="literal">-n</code> so that the <code class="literal">echo</code> command doesn&#8217;t print the trailing newline
character</p>
</td>
</tr>
</table>
</div>
<p>The following example creates an API key with a <a class="xref" href="role-restriction.html" title="Role restriction">restriction</a> to the <code class="literal">search_application_query</code> workflow,
which allows to call only <a class="xref" href="search-application-search.html" title="Search Application Search">Search Application Search API</a>:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.security.createApiKey({
  name: "my-restricted-api-key",
  role_descriptors: {
    "my-restricted-role-descriptor": {
      indices: [
        {
          names: ["my-search-app"],
          privileges: ["read"],
        },
      ],
      restriction: {
        workflows: ["search_application_query"],
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="1b076ceb1ead9f6897c2f351f0e45f74"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_security/api_key
{
  "name": "my-restricted-api-key",
  "role_descriptors": {
    "my-restricted-role-descriptor": {
      "indices": [
        {
          "names": ["my-search-app"],
          "privileges": ["read"]
        }
      ],
      "restriction":  {
        "workflows": ["search_application_query"]
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/3164.console"></div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="security-api-clear-service-token-caches.html">« Clear service account token caches API</a>
</span>
<span class="next">
<a href="security-api-put-privileges.html">Create or update application privileges API »</a>
</span>
</div>
</body>
</html>
