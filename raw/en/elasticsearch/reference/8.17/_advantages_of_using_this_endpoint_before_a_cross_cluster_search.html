<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Advantages of using this endpoint before a cross-cluster search | Elasticsearch Guide [8.17] | Elastic</title>
<meta class="elastic" name="content" content="Advantages of using this endpoint before a cross-cluster search | Elasticsearch Guide [8.17]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.17]"/>
<link rel="up" href="indices.html" title="Index APIs"/>
<link rel="prev" href="indices-resolve-cluster-api.html" title="Resolve cluster API"/>
<link rel="next" href="indices-rollover-index.html" title="Rollover API"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.17"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.17"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="indices-resolve-cluster-api.html">« Resolve cluster API</a>
</span>
<span class="next">
<a href="indices-rollover-index.html">Rollover API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="indices.html">Index APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Advantages of using this endpoint before a cross-cluster search</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/indices/resolve-cluster.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="_advantages_of_using_this_endpoint_before_a_cross_cluster_search"></a>Advantages of using this endpoint before a cross-cluster search</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/indices/resolve-cluster.asciidoc">edit</a></div>
</div></div></div>
<p>You may want to exclude a cluster or index from a search when:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
A remote cluster could not be connected to and is configured with <code class="literal">skip_unavailable</code>=<code class="literal">false</code>.
Executing a cross-cluster search under those conditions will cause
<a class="xref" href="modules-cross-cluster-search.html#cross-cluster-search-failures" title="Cross-cluster search failures">the entire search to fail</a>.
</li>
<li class="listitem">
A cluster has no matching indices, aliases or data streams for the index expression
(or your user does not have permissions to search them). For example, suppose your
index expression is <code class="literal">logs*,remote1:logs*</code> and the <code class="literal">remote1</code> cluster has no indices, aliases or data
streams that match <code class="literal">logs*</code>. In that case, that cluster will return no results from that cluster if
you include it in a cross-cluster search.
</li>
<li class="listitem">
The index expression (combined with any query parameters you specify) will likely cause an exception
to be thrown when you do the search. In these cases, the "error" field in the <code class="literal">_resolve/cluster</code> response
will be present. (This is also where security/permission errors will be shown.)
</li>
<li class="listitem">
A remote cluster is an older version that does not support the feature you want to
use in your search.
</li>
</ol>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="resolve-cluster-api-example"></a>Examples</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/indices/resolve-cluster.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.resolve_cluster(
    name="my-index*,clust*:my-index*",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.resolve_cluster(
  name: 'my-index*,clust*:my-index*'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.resolveCluster({
  name: "my-index*,clust*:my-index*",
});
console.log(response);</pre>
</div>
<a id="2b7687e3d7c06824950e00618c297864"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET /_resolve/cluster/my-index*,clust*:my-index*</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/2846.console"></div>
<p>The API returns the following response:</p>
<a id="2fc4e59ba2027eed14b9d470ab1ef0d5"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "(local)": {          <a id="CO798-1"></a><i class="conum" data-value="1"></i>
    "connected": true,
    "skip_unavailable": false,
    "matching_indices": true,
    "version": {
      "number": "8.13.0",
      "build_flavor": "default",
      "minimum_wire_compatibility_version": "7.17.0",
      "minimum_index_compatibility_version": "7.0.0"
    }
  },
  "cluster_one": {
    "connected": true,         <a id="CO798-2"></a><i class="conum" data-value="2"></i>
    "skip_unavailable": true,  <a id="CO798-3"></a><i class="conum" data-value="3"></i>
    "matching_indices": true,  <a id="CO798-4"></a><i class="conum" data-value="4"></i>
    "version": {
      "number": "8.13.0",      <a id="CO798-5"></a><i class="conum" data-value="5"></i>
      "build_flavor": "default",
      "minimum_wire_compatibility_version": "7.17.0",
      "minimum_index_compatibility_version": "7.0.0"
    }
  },
  "cluster_two": {
    "connected": true,
    "skip_unavailable": false,
    "matching_indices": true,
    "version": {
      "number": "8.13.0",
      "build_flavor": "default",
      "minimum_wire_compatibility_version": "7.17.0",
      "minimum_index_compatibility_version": "7.0.0"
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO798-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Each cluster has its own response section. The cluster you sent the request to is labelled as "(local)".</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO798-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The querying cluster attempts to make a request to each remote cluster. If successful, <code class="literal">connected</code>=<code class="literal">true</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO798-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">skip_unavailable</code> setting for each remote cluster, as configured on the local cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO798-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Indicates whether any index, alias or data stream matches the index expression specified for that cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO798-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The Elasticsearch server version.</p>
</td>
</tr>
</table>
</div>
<div class="position-relative"><h4><a id="resolve-cluster-api-error-example"></a>Identifying potential problems with your cross-cluster search</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/indices/resolve-cluster.asciidoc">edit</a></div>
<p>The following request shows several examples of how modifying your query can
prevent search failures.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.resolve_cluster(
    name="not-present,clust*:my-index*,oldcluster:*",
    ignore_unavailable=False,
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.resolve_cluster(
  name: 'not-present,clust*:my-index*,oldcluster:*',
  ignore_unavailable: false
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.resolveCluster({
  name: "not-present,clust*:my-index*,oldcluster:*",
  ignore_unavailable: "false",
});
console.log(response);</pre>
</div>
<a id="357edc9d10e98ed776401c7a439a1a55"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET /_resolve/cluster/not-present,clust*:my-index*,oldcluster:*?ignore_unavailable=false</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/2847.console"></div>
<a id="1a149429f985bde2b2a18ccba5f64e3f"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "(local)": {
    "connected": true,
    "skip_unavailable": false,
    "error": "no such index [not_present]"  <a id="CO799-1"></a><i class="conum" data-value="1"></i>
  },
  "cluster_one": {
    "connected": true,
    "skip_unavailable": true,
    "matching_indices": false,    <a id="CO799-2"></a><i class="conum" data-value="2"></i>
    "version": {
      "number": "8.13.0",
      "build_flavor": "default",
      "minimum_wire_compatibility_version": "7.17.0",
      "minimum_index_compatibility_version": "7.0.0"
    }
  },
  "cluster_two": {
    "connected": false,           <a id="CO799-3"></a><i class="conum" data-value="3"></i>
    "skip_unavailable": false
  },
  "oldcluster": {         <a id="CO799-4"></a><i class="conum" data-value="4"></i>
    "connected": true,
    "skip_unavailable": false,
    "matching_indices": true
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO799-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The local cluster has no index called <code class="literal">not_present</code>. Searching against it
using the specified <code class="literal">ignore_unavailable=false</code> param will return a "no such
index" error. Other types of errors can show up here as well, such as security
permission errors when the user does not have authorization to search the
specified index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO799-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">cluster_one</code> remote cluster has no indices that match the pattern
<code class="literal">my-index*</code>. There may be no indices that match the pattern or the index
could be closed. (You can check this by using the
<a class="xref" href="indices-resolve-index-api.html" title="Resolve index API">resolve index</a> API.)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO799-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">cluster_two</code> remote cluster is not connected (the attempt to connect
failed). Since this cluster is marked as <code class="literal">skip_unavailable=false</code>, you should
probably exclude this cluster from the search by adding <code class="literal">-cluster_two:*</code> to the
search index expression.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO799-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">oldcluster</code> remote cluster shows that it has matching indices, but no
version information is included. This indicates that the cluster version predates
the introduction of the <code class="literal">_resolve/cluster</code> API in 8.13.0., so you may want to
exclude it from your cross-cluster search. (Note: the endpoint was able to tell there were
matching indices because it fell back to using the <a class="xref" href="indices-resolve-index-api.html" title="Resolve index API">resolve index</a> API.)</p>
</td>
</tr>
</table>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="indices-resolve-cluster-api.html">« Resolve cluster API</a>
</span>
<span class="next">
<a href="indices-rollover-index.html">Rollover API »</a>
</span>
</div>
</body>
</html>
