<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Simulate multi-component templates | Elasticsearch Guide [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Simulate multi-component templates | Elasticsearch Guide [8.18]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.18]"/>
<link rel="up" href="index-templates.html" title="Index templates"/>
<link rel="prev" href="index-templates.html" title="Index templates"/>
<link rel="next" href="ignore_missing_component_templates.html" title="Config ignore_missing_component_templates"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.18"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.18"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="index-templates.html">« Index templates</a>
</span>
<span class="next">
<a href="ignore_missing_component_templates.html">Config ignore_missing_component_templates »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index-templates.html">Index templates</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Simulate multi-component templates</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.18/docs/reference/indices/simulate-multi-component-templates.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="simulate-multi-component-templates"></a>Simulate multi-component templates</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.18/docs/reference/indices/simulate-multi-component-templates.asciidoc">edit</a></div>
</div></div></div>
<p>Since templates can be composed not only of multiple component templates, but also the index
template itself, there are two simulation APIs to determine what the resulting index settings will
be.</p>
<p>To simulate the settings that would be applied to a particular index name:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.simulate_index_template(
    name="my-index-000001",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.simulateIndexTemplate({
  name: "my-index-000001",
});
console.log(response);</pre>
</div>
<a id="caaafef1a76c2bec677704c2dc233218"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST /_index_template/_simulate_index/my-index-000001</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/665.console"></div>
<p>To simulate the settings that would be applied from an existing template:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.simulate_template(
    name="template_1",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.simulateTemplate({
  name: "template_1",
});
console.log(response);</pre>
</div>
<a id="0f7aa40ad26d59a9268630b980a3d594"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST /_index_template/_simulate/template_1</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/666.console"></div>
<p>You can also specify a template definition in the simulate request.
This enables you to verify that settings will be applied as expected before you add a new template.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.cluster.put_component_template(
    name="ct1",
    template={
        "settings": {
            "index.number_of_shards": 2
        }
    },
)
print(resp)

resp1 = client.cluster.put_component_template(
    name="ct2",
    template={
        "settings": {
            "index.number_of_replicas": 0
        },
        "mappings": {
            "properties": {
                "@timestamp": {
                    "type": "date"
                }
            }
        }
    },
)
print(resp1)

resp2 = client.indices.simulate_template(
    index_patterns=[
        "my*"
    ],
    template={
        "settings": {
            "index.number_of_shards": 3
        }
    },
    composed_of=[
        "ct1",
        "ct2"
    ],
)
print(resp2)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.cluster.put_component_template(
  name: 'ct1',
  body: {
    template: {
      settings: {
        'index.number_of_shards' =&gt; 2
      }
    }
  }
)
puts response

response = client.cluster.put_component_template(
  name: 'ct2',
  body: {
    template: {
      settings: {
        'index.number_of_replicas' =&gt; 0
      },
      mappings: {
        properties: {
          "@timestamp": {
            type: 'date'
          }
        }
      }
    }
  }
)
puts response

response = client.indices.simulate_template(
  body: {
    index_patterns: [
      'my*'
    ],
    template: {
      settings: {
        'index.number_of_shards' =&gt; 3
      }
    },
    composed_of: [
      'ct1',
      'ct2'
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.cluster.putComponentTemplate({
  name: "ct1",
  template: {
    settings: {
      "index.number_of_shards": 2,
    },
  },
});
console.log(response);

const response1 = await client.cluster.putComponentTemplate({
  name: "ct2",
  template: {
    settings: {
      "index.number_of_replicas": 0,
    },
    mappings: {
      properties: {
        "@timestamp": {
          type: "date",
        },
      },
    },
  },
});
console.log(response1);

const response2 = await client.indices.simulateTemplate({
  index_patterns: ["my*"],
  template: {
    settings: {
      "index.number_of_shards": 3,
    },
  },
  composed_of: ["ct1", "ct2"],
});
console.log(response2);</pre>
</div>
<a id="bd298b11933605c641626750c981d70b"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT /_component_template/ct1
{
  "template": {
    "settings": {
      "index.number_of_shards": 2
    }
  }
}

PUT /_component_template/ct2
{
  "template": {
    "settings": {
      "index.number_of_replicas": 0
    },
    "mappings": {
      "properties": {
        "@timestamp": {
          "type": "date"
        }
      }
    }
  }
}

POST /_index_template/_simulate
{
  "index_patterns": ["my*"],
  "template": {
    "settings" : {
        "index.number_of_shards" : 3
    }
  },
  "composed_of": ["ct1", "ct2"]
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/667.console"></div>
<p>The response shows the settings, mappings, and aliases that would be applied to matching indices,
and any overlapping templates whose configuration would be superseded by the simulated template body
or higher-priority templates.</p>
<a id="f8f399289e0bfadd897e4e8c9d2fd965"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "template" : {
    "settings" : {
      "index" : {
        "number_of_shards" : "3",   <a id="CO216-2"></a><i class="conum" data-value="1"></i>
        "number_of_replicas" : "0",
        "routing" : {
          "allocation" : {
            "include" : {
              "_tier_preference" : "data_content"
            }
          }
        }
      }
    },
    "mappings" : {
      "properties" : {
        "@timestamp" : {
          "type" : "date"           <a id="CO216-3"></a><i class="conum" data-value="2"></i>
        }
      }
    },
    "aliases" : { }
  },
  "overlapping" : [
    {
      "name" : "template_1",        <a id="CO216-4"></a><i class="conum" data-value="3"></i>
      "index_patterns" : [
        "my*"
      ]
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO216-1"><i class="conum" data-value="1"></i></a><a href="#CO216-2"></a></p>
</td>
<td align="left" valign="top">
<p>The number of shards from the simulated template body</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO216-3"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">@timestamp</code> field inherited from the <code class="literal">ct2</code> component template</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO216-4"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Any overlapping templates that would have matched, but have lower priority</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="index-templates.html">« Index templates</a>
</span>
<span class="next">
<a href="ignore_missing_component_templates.html">Config ignore_missing_component_templates »</a>
</span>
</div>
</body>
</html>
