<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chat completion inference API | Elasticsearch Guide [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Chat completion inference API | Elasticsearch Guide [8.19]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.19]"/>
<link rel="up" href="inference-apis.html" title="Inference APIs"/>
<link rel="prev" href="post-inference-api.html" title="Perform inference API"/>
<link rel="next" href="put-inference-api.html" title="Create inference API"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.19"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="post-inference-api.html">« Perform inference API</a>
</span>
<span class="next">
<a href="put-inference-api.html">Create inference API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="inference-apis.html">Inference APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Chat completion inference API</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="chat-completion-inference-api"></a>Chat completion inference API</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
</div></div></div>
<p>Streams a chat completion response.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The inference APIs enable you to use certain services, such as built-in machine learning models (ELSER, E5), models uploaded through Eland, Cohere, OpenAI, Azure, Google AI Studio, Google Vertex AI, Anthropic, Watsonx.ai, or Hugging Face.
For built-in models and models uploaded through Eland, the inference APIs offer an alternative way to use and manage trained models.
However, if you do not plan to use the inference APIs to use these models or if you want to use non-NLP models, use the <a class="xref" href="ml-df-trained-models-apis.html" title="Machine learning trained model APIs"><em>Machine learning trained model APIs</em></a>.</p>
</div>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-request"></a>Request</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<p><code class="literal">POST /_inference/&lt;inference_id&gt;/_stream</code></p>
<p><code class="literal">POST /_inference/chat_completion/&lt;inference_id&gt;/_stream</code></p>
<div class="position-relative"><h4><a id="chat-completion-inference-api-prereqs"></a>Prerequisites</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires the <code class="literal">monitor_inference</code> <a class="xref" href="security-privileges.html#privileges-list-cluster" title="Cluster privileges">cluster privilege</a>
(the built-in <code class="literal">inference_admin</code> and <code class="literal">inference_user</code> roles grant this privilege)
</li>
<li class="listitem">
You must use a client that supports streaming.
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-desc"></a>Description</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<p>The chat completion inference API enables real-time responses for chat completion tasks by delivering answers incrementally, reducing response times during computation.
It only works with the <code class="literal">chat_completion</code> task type for <code class="literal">openai</code> and <code class="literal">elastic</code> inference services.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">chat_completion</code> task type is only available within the _stream API and only supports streaming.
</li>
<li class="listitem">
The Chat completion inference API and the Stream inference API differ in their response structure and capabilities.
The Chat completion inference API provides more comprehensive customization options through more fields and function calling support.
If you use the <code class="literal">openai</code> service or the <code class="literal">elastic</code> service, use the Chat completion inference API.
</li>
</ul>
</div>
</div>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-path-params"></a>Path parameters</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;inference_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
The unique identifier of the inference endpoint.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;task_type&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
The type of inference task that the model performs. If included, this must be set to the value <code class="literal">chat_completion</code>.
</dd>
</dl>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-request-body"></a>Request body</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">messages</code>
</span>
</dt>
<dd>
<p>
(Required, array of objects) A list of objects representing the conversation.
Requests should generally only add new messages from the user (role <code class="literal">user</code>). The other message roles (<code class="literal">assistant</code>, <code class="literal">system</code>, or <code class="literal">tool</code>) should generally only be copied from the response to a previous completion request, such that the messages array is built up throughout a conversation.
</p>
<details>
<summary class="title">Assistant message</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">content</code>
</span>
</dt>
<dd>
<p>
(Required unless <code class="literal">tool_calls</code> is specified, string or array of objects)
The contents of the message.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<p>String example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": "Some string"
}</pre>
</div>
<p>Object example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": [
        {
            "text": "Some text",
            "type": "text"
        }
    ]
}</pre>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">text</code>
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
This must be set to the value <code class="literal">text</code>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">role</code>
</span>
</dt>
<dd>
(Required, string)
The role of the message author. This should be set to <code class="literal">assistant</code> for this type of message.
</dd>
<dt>
<span class="term">
<code class="literal">tool_calls</code>
</span>
</dt>
<dd>
<p>
(Optional, array of objects)
The tool calls generated by the model.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "tool_calls": [
        {
            "id": "call_KcAjWtAww20AihPHphUh46Gd",
            "type": "function",
            "function": {
                "name": "get_current_weather",
                "arguments": "{\"location\":\"Boston, MA\"}"
            }
        }
    ]
}</pre>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
(Required, string)
The identifier of the tool call.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
The type of tool call. This must be set to the value <code class="literal">function</code>.
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The function that the model called.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string)
The name of the function to call.
</dd>
<dt>
<span class="term">
<code class="literal">arguments</code>
</span>
</dt>
<dd>
(Required, string)
The arguments to call the function with in JSON format.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">System message</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">content</code>
</span>
</dt>
<dd>
<p>
(Required, string or array of objects)
The contents of the message.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<p>String example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": "Some string"
}</pre>
</div>
<p>Object example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": [
        {
            "text": "Some text",
            "type": "text"
        }
    ]
}</pre>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">text</code>
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
This must be set to the value <code class="literal">text</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">role</code>
</span>
</dt>
<dd>
(Required, string)
The role of the message author. This should be set to <code class="literal">system</code> for this type of message.
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">Tool message</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">content</code>
</span>
</dt>
<dd>
<p>
(Required, string or array of objects)
The contents of the message.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<p>String example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": "Some string"
}</pre>
</div>
<p>Object example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": [
        {
            "text": "Some text",
            "type": "text"
        }
    ]
}</pre>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">text</code>
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
This must be set to the value <code class="literal">text</code>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">role</code>
</span>
</dt>
<dd>
(Required, string)
The role of the message author. This should be set to <code class="literal">tool</code> for this type of message.
</dd>
<dt>
<span class="term">
<code class="literal">tool_call_id</code>
</span>
</dt>
<dd>
(Required, string)
The tool call that this message is responding to.
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">User message</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">content</code>
</span>
</dt>
<dd>
<p>
(Required, string or array of objects)
The contents of the message.
</p>
<details>
<summary class="title">Examples</summary>
<div class="content">
<p>String example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": "Some string"
}</pre>
</div>
<p>Object example</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "content": [
        {
            "text": "Some text",
            "type": "text"
        }
    ]
}</pre>
</div>
</div>
</details>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">text</code>
</span>
</dt>
<dd>
(Required, string)
The text content.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
This must be set to the value <code class="literal">text</code>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">role</code>
</span>
</dt>
<dd>
(Required, string)
The role of the message author. This should be set to <code class="literal">user</code> for this type of message.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">model</code>
</span>
</dt>
<dd>
(Optional, string)
The ID of the model to use. By default, the model ID is set to the value included when creating the inference endpoint.
</dd>
<dt>
<span class="term">
<code class="literal">max_completion_tokens</code>
</span>
</dt>
<dd>
(Optional, integer)
The upper bound limit for the number of tokens that can be generated for a completion request.
</dd>
<dt>
<span class="term">
<code class="literal">stop</code>
</span>
</dt>
<dd>
(Optional, array of strings)
A sequence of strings to control when the model should stop generating additional tokens.
</dd>
<dt>
<span class="term">
<code class="literal">temperature</code>
</span>
</dt>
<dd>
(Optional, float)
The sampling temperature to use.
</dd>
<dt>
<span class="term">
<code class="literal">tools</code>
</span>
</dt>
<dd>
<p>
(Optional, array of objects)
A list of tools that the model can call.
</p>
<details>
<summary class="title">Structure</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
The type of tool, must be set to the value <code class="literal">function</code>.
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
<p>
(Required, object)
The function definition.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string)
A description of what the function does. This is used by the model to choose when and how to call the function.
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string)
The name of the function.
</dd>
<dt>
<span class="term">
<code class="literal">parameters</code>
</span>
</dt>
<dd>
(Optional, object)
The parameters the functional accepts. This should be formatted as a JSON object.
</dd>
<dt>
<span class="term">
<code class="literal">strict</code>
</span>
</dt>
<dd>
(Optional, boolean)
Whether to enable schema adherence when generating the function call.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">Examples</summary>
<div class="content">
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "tools": [
        {
            "type": "function",
            "function": {
                "name": "get_price_of_item",
                "description": "Get the current price of an item",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "item": {
                            "id": "12345"
                        },
                        "unit": {
                            "type": "currency"
                        }
                    }
                }
            }
        }
    ]
}</pre>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">tool_choice</code>
</span>
</dt>
<dd>
<p>
(Optional, string or object)
Controls which tool is called by the model.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
String representation
</span>
</dt>
<dd>
One of <code class="literal">auto</code>, <code class="literal">none</code>, or <code class="literal">requrired</code>. <code class="literal">auto</code> allows the model to choose between calling tools and generating a message. <code class="literal">none</code> causes the model to not call any tools. <code class="literal">required</code> forces the model to call one or more tools.
</dd>
<dt>
<span class="term">
Object representation
</span>
</dt>
<dd>
<details>
<summary class="title">Structure</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string)
The type of the tool. This must be set to the value <code class="literal">function</code>.
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
<p>
(Required, object)
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string)
The name of the function to call.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
<details>
<summary class="title">Examples</summary>
<div class="content">
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
    "tool_choice": {
        "type": "function",
        "function": {
            "name": "get_current_weather"
        }
    }
}</pre>
</div>
</div>
</details>
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">top_p</code>
</span>
</dt>
<dd>
(Optional, float)
Nucleus sampling, an alternative to sampling with temperature.
</dd>
</dl>
</div>
<div class="position-relative"><h4><a id="chat-completion-inference-api-example"></a>Examples</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/inference/chat-completion-inference.asciidoc">edit</a></div>
<p>The following example performs a chat completion on the example question with streaming.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.inference.chat_completion_unified(
    inference_id="openai-completion",
    chat_completion_request={
        "model": "gpt-4o",
        "messages": [
            {
                "role": "user",
                "content": "What is Elastic?"
            }
        ]
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.inference.streamInference({
  task_type: "chat_completion",
  inference_id: "openai-completion",
  model: "gpt-4o",
  messages: [
    {
      role: "user",
      content: "What is Elastic?",
    },
  ],
});
console.log(response);</pre>
</div>
<a id="120fcf9f55128d6a81d5e87a9c235bbd"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST _inference/chat_completion/openai-completion/_stream
{
    "model": "gpt-4o",
    "messages": [
        {
            "role": "user",
            "content": "What is Elastic?"
        }
    ]
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2995.console"></div>
<p>The following example performs a chat completion using an Assistant message with <code class="literal">tool_calls</code>.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.inference.chat_completion_unified(
    inference_id="openai-completion",
    chat_completion_request={
        "messages": [
            {
                "role": "assistant",
                "content": "Let's find out what the weather is",
                "tool_calls": [
                    {
                        "id": "call_KcAjWtAww20AihPHphUh46Gd",
                        "type": "function",
                        "function": {
                            "name": "get_current_weather",
                            "arguments": "{\"location\":\"Boston, MA\"}"
                        }
                    }
                ]
            },
            {
                "role": "tool",
                "content": "The weather is cold",
                "tool_call_id": "call_KcAjWtAww20AihPHphUh46Gd"
            }
        ]
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.inference.streamInference({
  task_type: "chat_completion",
  inference_id: "openai-completion",
  messages: [
    {
      role: "assistant",
      content: "Let's find out what the weather is",
      tool_calls: [
        {
          id: "call_KcAjWtAww20AihPHphUh46Gd",
          type: "function",
          function: {
            name: "get_current_weather",
            arguments: '{"location":"Boston, MA"}',
          },
        },
      ],
    },
    {
      role: "tool",
      content: "The weather is cold",
      tool_call_id: "call_KcAjWtAww20AihPHphUh46Gd",
    },
  ],
});
console.log(response);</pre>
</div>
<a id="82bb6c61dab959f4446dc5ecab7ecbdf"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST _inference/chat_completion/openai-completion/_stream
{
    "messages": [
        {
            "role": "assistant",
            "content": "Let's find out what the weather is",
            "tool_calls": [ <a id="CO872-1"></a><i class="conum" data-value="1"></i>
                {
                    "id": "call_KcAjWtAww20AihPHphUh46Gd",
                    "type": "function",
                    "function": {
                        "name": "get_current_weather",
                        "arguments": "{\"location\":\"Boston, MA\"}"
                    }
                }
            ]
        },
        { <a id="CO872-2"></a><i class="conum" data-value="2"></i>
            "role": "tool",
            "content": "The weather is cold",
            "tool_call_id": "call_KcAjWtAww20AihPHphUh46Gd"
        }
    ]
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2996.console"></div>
<div class="calloutlist default has-python has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO872-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Each tool call needs a corresponding Tool message.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO872-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The corresponding Tool message.</p>
</td>
</tr>
</table>
</div>
<p>The following example performs a chat completion using a User message with <code class="literal">tools</code> and <code class="literal">tool_choice</code>.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.inference.chat_completion_unified(
    inference_id="openai-completion",
    chat_completion_request={
        "messages": [
            {
                "role": "user",
                "content": [
                    {
                        "type": "text",
                        "text": "What's the price of a scarf?"
                    }
                ]
            }
        ],
        "tools": [
            {
                "type": "function",
                "function": {
                    "name": "get_current_price",
                    "description": "Get the current price of a item",
                    "parameters": {
                        "type": "object",
                        "properties": {
                            "item": {
                                "id": "123"
                            }
                        }
                    }
                }
            }
        ],
        "tool_choice": {
            "type": "function",
            "function": {
                "name": "get_current_price"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.inference.streamInference({
  task_type: "chat_completion",
  inference_id: "openai-completion",
  messages: [
    {
      role: "user",
      content: [
        {
          type: "text",
          text: "What's the price of a scarf?",
        },
      ],
    },
  ],
  tools: [
    {
      type: "function",
      function: {
        name: "get_current_price",
        description: "Get the current price of a item",
        parameters: {
          type: "object",
          properties: {
            item: {
              id: "123",
            },
          },
        },
      },
    },
  ],
  tool_choice: {
    type: "function",
    function: {
      name: "get_current_price",
    },
  },
});
console.log(response);</pre>
</div>
<a id="45954b8aaedfed57012be8b6538b0a24"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST _inference/chat_completion/openai-completion/_stream
{
    "messages": [
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "What's the price of a scarf?"
                }
            ]
        }
    ],
    "tools": [
        {
            "type": "function",
            "function": {
                "name": "get_current_price",
                "description": "Get the current price of a item",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "item": {
                            "id": "123"
                        }
                    }
                }
            }
        }
    ],
    "tool_choice": {
        "type": "function",
        "function": {
            "name": "get_current_price"
        }
    }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2997.console"></div>
<p>The API returns the following response when a request is made to the OpenAI service:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">event: message
data: {"chat_completion":{"id":"chatcmpl-Ae0TWsy2VPnSfBbv5UztnSdYUMFP3","choices":[{"delta":{"content":"","role":"assistant"},"index":0}],"model":"gpt-4o-2024-08-06","object":"chat.completion.chunk"}}

event: message
data: {"chat_completion":{"id":"chatcmpl-Ae0TWsy2VPnSfBbv5UztnSdYUMFP3","choices":[{"delta":{"content":Elastic"},"index":0}],"model":"gpt-4o-2024-08-06","object":"chat.completion.chunk"}}

event: message
data: {"chat_completion":{"id":"chatcmpl-Ae0TWsy2VPnSfBbv5UztnSdYUMFP3","choices":[{"delta":{"content":" is"},"index":0}],"model":"gpt-4o-2024-08-06","object":"chat.completion.chunk"}}

(...)

event: message
data: {"chat_completion":{"id":"chatcmpl-Ae0TWsy2VPnSfBbv5UztnSdYUMFP3","choices":[],"model":"gpt-4o-2024-08-06","object":"chat.completion.chunk","usage":{"completion_tokens":28,"prompt_tokens":16,"total_tokens":44}}} <a id="CO873-1"></a><i class="conum" data-value="1"></i>

event: message
data: [DONE]</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO873-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The last object message of the stream contains the token usage information.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="post-inference-api.html">« Perform inference API</a>
</span>
<span class="next">
<a href="put-inference-api.html">Create inference API »</a>
</span>
</div>
</body>
</html>
