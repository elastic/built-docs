<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Failure store | Elasticsearch Guide [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Failure store | Elasticsearch Guide [8.19]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.19]"/>
<link rel="up" href="data-streams.html" title="Data streams"/>
<link rel="prev" href="tutorial-migrate-data-stream-from-ilm-to-dsl.html" title="Tutorial: Migrate ILM managed data stream to data stream lifecycle"/>
<link rel="next" href="failure-store-recipes.html" title="Using failure stores to address ingestion issues"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.19"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="tutorial-migrate-data-stream-from-ilm-to-dsl.html">« Tutorial: Migrate ILM managed data stream to data stream lifecycle</a>
</span>
<span class="next">
<a href="failure-store-recipes.html">Using failure stores to address ingestion issues »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-streams.html">Data streams</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Failure store</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="failure-store"></a>Failure store</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
</div></div></div>
<p>A failure store is a secondary set of indices inside a data stream, dedicated to storing failed documents. A failed document is any document that, without the failure store enabled, would cause an ingest pipeline exception or that has a structure that conflicts with a data stream&#8217;s mappings. In the absence of the failure store, a failed document would cause the indexing operation to fail, with an error message returned in the operation response.</p>
<p>When a data stream&#8217;s failure store is enabled, these failures are instead captured in a separate index and persisted to be analyzed later. Clients receive a successful response with a flag indicating the failure was redirected.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Failure stores do not capture failures caused by backpressure or document version conflicts. These failures are always returned as-is since they warrant specific action by the client.</p>
</div>
</div>
<p>On this page, you&#8217;ll learn how to set up, use, and manage a failure store, as well as the structure of failure store documents.</p>
<p>For examples of how to use failure stores to identify and fix errors in ingest pipelines and your data, refer to <a class="xref" href="failure-store-recipes.html" title="Using failure stores to address ingestion issues">Using failure stores to address ingestion issues</a>.</p>
<div class="position-relative"><h3><a id="set-up-failure-store"></a>Set up a data stream failure store</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>Each data stream has its own failure store that can be enabled to accept failed documents. By default, this failure store is disabled and any ingestion problems are raised in the response to write operations.</p>
<div class="position-relative"><h4><a id="set-up-failure-store-new"></a>Set up for new data streams</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>You can specify in a data stream&#8217;s <a class="xref" href="index-templates.html" title="Index templates">index templates</a> if it should enable the failure store when it is first created.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Unlike the <code class="literal">settings</code> and <code class="literal">mappings</code> fields on an <a class="xref" href="index-templates.html" title="Index templates">index template</a> which are repeatedly applied to new data stream write indices on rollover, the <code class="literal">data_stream_options</code> section of a template is applied to a data stream only once when the data stream is first created. To configure existing data streams, use the <a href="/docs/api/doc/elasticsearch/operation/operation-indices-put-data-stream-options" class="ulink" target="_top">Update data stream options API</a>.</p>
</div>
</div>
<p>To enable the failure store on a new data stream, enable it in the <code class="literal">data_stream_options</code> of the template:</p>
<a id="15755171c81ce65fec5d15f2bb93c58e"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _index_template/my-index-template
{
  "index_patterns": ["my-datastream-*"],
  "data_stream": { },
  "template": {
    "data_stream_options": { <a id="CO245-1"></a><i class="conum" data-value="1"></i>
      "failure_store": {
        "enabled": true <a id="CO245-2"></a><i class="conum" data-value="2"></i>
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/794.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO245-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The options for a data stream to be applied at creation time.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO245-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The failure store feature will be enabled for new data streams that match this template.</p>
</td>
</tr>
</table>
</div>
<p>After a matching data stream is created, its failure store will be enabled.</p>
<div class="position-relative"><h4><a id="set-up-failure-store-existing"></a>Set up for existing data streams</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>Enabling the failure store via <a class="xref" href="index-templates.html" title="Index templates">index templates</a> can only affect data streams that are newly created. Existing data streams that use a template are not affected by changes to the template&#8217;s <code class="literal">data_stream_options</code> field.
To modify an existing data stream&#8217;s options, use the <a href="/docs/api/doc/elasticsearch/operation/operation-indices-put-data-stream-options" class="ulink" target="_top">Update data stream options API</a>:</p>
<a id="42a6ea91cfce34790547e46846564756"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _data_stream/my-datastream-existing/_options
{
  "failure_store": {
    "enabled": true <a id="CO246-1"></a><i class="conum" data-value="1"></i>
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/795.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO246-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The failure store option will now be enabled.</p>
</td>
</tr>
</table>
</div>
<p>The failure store redirection can be disabled using this API as well. When the failure store is deactivated, only failed document redirection is halted. Any existing failure data in the data stream will remain until removed by manual deletion or until the data expires due to reaching its max configured retention.</p>
<a id="51c8b52f8a32ef7d7dc9d7ff86c42f90"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _data_stream/my-datastream-existing/_options
{
  "failure_store": {
    "enabled": false <a id="CO247-1"></a><i class="conum" data-value="1"></i>
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/796.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO247-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Redirecting failed documents into the failure store will now be disabled.</p>
</td>
</tr>
</table>
</div>
<div class="position-relative"><h4><a id="set-up-failure-store-cluster-setting"></a>Enable failure store via cluster setting</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>If you have a large number of existing data streams you may want to enable their failure stores in one place. Instead of updating each of their options individually, set <code class="literal">data_streams.failure_store.enabled</code> to a list of index patterns in the <a href="/docs/api/doc/elasticsearch/operation/operation-cluster-put-settings" class="ulink" target="_top">cluster settings</a>. Any data streams that match one of these patterns will operate with their failure store enabled.</p>
<a id="0bf6dfdf930904202e96d39a43cc3f47"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent" : {
    "data_streams.failure_store.enabled" : [ "my-datastream-*", "logs-*" ] <a id="CO248-1"></a><i class="conum" data-value="1"></i>
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/797.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO248-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Indices that match <code class="literal">my-datastream-*</code> or <code class="literal">logs-*</code> will redirect failures to the failure store unless explicitly disabled.</p>
</td>
</tr>
</table>
</div>
<p>Matching data streams will ignore this configuration if the failure store is explicitly enabled or disabled in their <a href="/docs/api/doc/elasticsearch/operation/operation-indices-put-data-stream-options" class="ulink" target="_top">data stream options</a>.</p>
<a id="2f0bb369c81448bf8d6ca06b4cefda4c"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _data_stream/my-datastream-1/_options
{
  "failure_store": {
    "enabled": false <a id="CO249-1"></a><i class="conum" data-value="1"></i>
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/798.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO249-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The failure store for <code class="literal">my-datastream-1</code> is disabled even though it matches <code class="literal">my-datastream-*</code>. The data stream options override the cluster setting.</p>
</td>
</tr>
</table>
</div>
<div class="position-relative"><h3><a id="use-failure-store"></a>Using a failure store</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>The failure store is meant to ease the burden of detecting and handling failures when ingesting data to Elasticsearch. Clients are less likely to encounter unrecoverable failures when writing documents, and developers are more easily able to troubleshoot faulty pipelines and mappings.</p>
<p>For examples of how to use failure stores to identify and fix errors in ingest pipelines and your data, refer to <a class="xref" href="failure-store-recipes.html" title="Using failure stores to address ingestion issues">Using failure stores to address ingestion issues</a>.</p>
<div class="position-relative"><h4><a id="use-failure-store-redirect"></a>Failure redirection</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>Once a failure store is enabled for a data stream it will begin redirecting documents that fail due to common ingestion problems instead of returning errors in write operations. Clients are notified in a non-intrusive way when a document is redirected to the failure store.</p>
<p>Each data stream&#8217;s failure store is made up of a list of indices that are dedicated to storing failed documents. These failure indices function much like a data stream&#8217;s normal backing indices: There is a write index that accepts failed documents, the indices can be rolled over, and they&#8217;re automatically cleaned up over time subject to a lifecycle policy. Failure indices are lazily created the first time they are needed to store a failed document.</p>
<p>When a document bound for a data stream encounters a problem during its ingestion, the response is annotated with the <code class="literal">failure_store</code> field which describes how Elasticsearch responded to that problem. The <code class="literal">failure_store</code> field is present on both the <a href="/docs/api/doc/elasticsearch/operation/operation-bulk" class="ulink" target="_top">bulk</a> and <a href="/docs/api/doc/elasticsearch/operation/operation-create" class="ulink" target="_top">index</a> API responses when applicable. Clients can use this information to augment their behavior based on the response from Elasticsearch.</p>
<p>Here we have a bulk operation that sends two documents. Both are writing to the <code class="literal">id</code> field which is mapped as a <code class="literal">long</code> field type. The first document will be accepted, but the second document would cause a failure because the value <code class="literal">invalid_text</code> cannot be parsed as a <code class="literal">long</code>. This second document will be redirected to the failure store:</p>
<a id="0551626f75cbad56d9a63b11556dcfa7"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST my-datastream-new/_bulk
{"create":{}}
{"@timestamp": "2025-05-01T00:00:00Z", "id": 1234} <a id="CO250-1"></a><i class="conum" data-value="1"></i>
{"create":{}}
{"@timestamp": "2025-05-01T00:00:00Z", "id": "invalid_text"} <a id="CO250-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="console_widget" data-snippet="snippets/799.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO250-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A correctly formatted document.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO250-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Invalid document that cannot be parsed using the current mapping.</p>
</td>
</tr>
</table>
</div>
<a id="424f8318f009de2175e34d5341417366"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "errors": false, <a id="CO251-1"></a><i class="conum" data-value="1"></i>
  "took": 400,
  "items": [
    {
      "create": {
        "_index": ".ds-my-datastream-new-2025.05.01-000001", <a id="CO251-2"></a><i class="conum" data-value="2"></i>
        "_id": "YUvQipYB_ZAKuDfZRosB",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 1,
          "successful": 1,
          "failed": 0
        },
        "_seq_no": 3,
        "_primary_term": 1,
        "status": 201
      }
    },
    {
      "create": {
        "_index": ".fs-my-datastream-new-2025.05.01-000002", <a id="CO251-3"></a><i class="conum" data-value="3"></i>
        "_id": "lEu8jZYB_ZAKuDfZNouU",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 1,
          "successful": 1,
          "failed": 0
        },
        "_seq_no": 10,
        "_primary_term": 1,
        "failure_store": "used", <a id="CO251-4"></a><i class="conum" data-value="4"></i>
        "status": 201
      }
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO251-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The response code is <code class="literal">200 OK</code>, and the response body does not report any errors encountered.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO251-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The first document is accepted into the data stream&#8217;s write index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO251-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The second document encountered a problem during ingest and was redirected to the data stream&#8217;s failure store.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO251-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The response is annotated with a field indicating that the failure store was used to persist the second document.</p>
</td>
</tr>
</table>
</div>
<p>If the document was redirected to a data stream&#8217;s failure store due to a problem, then the <code class="literal">failure_store</code> field on the response will be <code class="literal">used</code>, and the response will not return any error information:</p>
<a id="29566a4a03a4a13014d90a5a4d011d31"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "_index": ".fs-my-datastream-new-2025.05.01-000002", <a id="CO252-1"></a><i class="conum" data-value="1"></i>
  "_id": "lEu8jZYB_ZAKuDfZNouU",
  "_version": 1,
  "result": "created",
  "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 11,
  "_primary_term": 1,
  "failure_store": "used" <a id="CO252-2"></a><i class="conum" data-value="2"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO252-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The document for this index operation was sent to the failure store&#8217;s write index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO252-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The response is annotated with a flag indicating the document was redirected.</p>
</td>
</tr>
</table>
</div>
<p>If the document could have been redirected to a data stream&#8217;s failure store but the failure store was disabled, then the <code class="literal">failure_store</code> field on the response will be <code class="literal">not_enabled</code>, and the response will display the error encountered as normal.</p>
<a id="e7f1a9501dc2b526a21a5ca693c5e958"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "error": {
    "root_cause": [ <a id="CO253-1"></a><i class="conum" data-value="1"></i>
      {
        "type": "document_parsing_exception",
        "reason": "[1:53] failed to parse field [id] of type [long] in document with id 'Y0vQipYB_ZAKuDfZR4sR'. Preview of field's value: 'invalid_text'"
      }
    ],
    "type": "document_parsing_exception",
    "reason": "[1:53] failed to parse field [id] of type [long] in document with id 'Y0vQipYB_ZAKuDfZR4sR'. Preview of field's value: 'invalid_text'",
    "caused_by": {
      "type": "illegal_argument_exception",
      "reason": "For input string: \"invalid_text\""
    },
    "failure_store": "not_enabled" <a id="CO253-2"></a><i class="conum" data-value="2"></i>
  },
  "status": 400 <a id="CO253-3"></a><i class="conum" data-value="3"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO253-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The failure is returned to the client as normal when the failure store is not enabled.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO253-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The response is annotated with a flag indicating the failure store could have accepted the document, but it was not enabled.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO253-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The response status is <code class="literal">400 Bad Request</code> due to the mapping problem.</p>
</td>
</tr>
</table>
</div>
<p>If the document was redirected to a data stream&#8217;s failure store but that failed document could not be stored (e.g. due to shard unavailability or a similar problem), then the <code class="literal">failure_store</code> field on the response will be <code class="literal">failed</code>, and the response will display the error for the original failure, as well as a suppressed error detailing why the failure could not be stored:</p>
<a id="f332f45f23e86aac9cc0531c90da3eba"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "error": {
    "root_cause": [
      {
        "type": "document_parsing_exception", <a id="CO254-1"></a><i class="conum" data-value="1"></i>
        "reason": "[1:53] failed to parse field [id] of type [long] in document with id 'Y0vQipYB_ZAKuDfZR4sR'. Preview of field's value: 'invalid_text'",
        "suppressed": [
          {
            "type": "cluster_block_exception", <a id="CO254-2"></a><i class="conum" data-value="2"></i>
            "reason": "index [.fs-my-datastream-2025.05.01-000002] blocked by: [FORBIDDEN/5/index read-only (api)];"
          }
        ]
      }
    ],
    "type": "document_parsing_exception", <a id="CO254-3"></a><i class="conum" data-value="3"></i>
    "reason": "[1:53] failed to parse field [id] of type [long] in document with id 'Y0vQipYB_ZAKuDfZR4sR'. Preview of field's value: 'invalid_text'",
    "caused_by": {
      "type": "illegal_argument_exception",
      "reason": "For input string: \"invalid_text\""
    },
    "suppressed": [
      {
        "type": "cluster_block_exception",
        "reason": "index [.fs-my-datastream-2025.05.01-000002] blocked by: [FORBIDDEN/5/index read-only (api)];"
      }
    ],
    "failure_store": "failed" <a id="CO254-4"></a><i class="conum" data-value="4"></i>
  },
  "status": 400 <a id="CO254-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO254-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The root cause of the problem was a mapping mismatch.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO254-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The document could not be redirected because the failure store was not able to accept writes at this time due to an unforeseeable issue.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO254-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The complete exception tree is present on the response.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO254-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The response is annotated with a flag indicating the failure store would have accepted the document, but it was not able to.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO254-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The response status is <code class="literal">400 Bad Request</code> due to the original mapping problem.</p>
</td>
</tr>
</table>
</div>
<div class="position-relative"><h4><a id="use-failure-store-searching"></a>Searching failures</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>Once you have accumulated some failures, the failure store can be searched much like a regular data stream.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Documents redirected to the failure store in the event of a failed ingest pipeline will be stored in their original, unprocessed form. If an ingest pipeline normally redacts sensitive information from a document, then failed documents in their original, unprocessed form may contain sensitive information.</p>
<p>Furthermore, failed documents are likely to be structured differently than normal data in a data stream, and thus special care should be taken when making use of <a class="xref" href="document-level-security.html" title="Document level security">document level security</a> or <a class="xref" href="field-level-security.html" title="Field level security">field level security</a>. Any security policies that expect to utilize these features for both regular documents and failure documents should account for any differences in document structure between the two document types.</p>
<p>To limit visibility on potentially sensitive data, users require the <a class="xref" href="security-privileges.html#privileges-list-indices" title="Indices privileges"><code class="literal">read_failure_store</code></a> index privilege for a data stream in order to search that data stream&#8217;s failure store data.</p>
</div>
</div>
<p>Searching a data stream&#8217;s failure store can be done by making use of the existing search APIs available in Elasticsearch.</p>
<p>To indicate that the search should be performed on failure store data, use the <a class="xref" href="api-conventions.html#component-selectors" title="Component selectors">component selector syntax</a> to indicate which part of the data stream to target in the search operation. Appending the <code class="literal">::failures</code> suffix to the name of the data stream indicates that the operation should be performed against that data stream&#8217;s failure store instead of its regular backing indices.</p>
<div class="position-relative"><h5><a id="_esql"></a>ES|QL</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<a id="54fc2f2d7a0a9843aeae5d7bab78471f"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _query?format=txt
{
    "query": """FROM my-datastream::failures | DROP error.stack_trace | LIMIT 1""" <a id="CO255-1"></a><i class="conum" data-value="1"></i>
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/800.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO255-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>We drop the <code class="literal">error.stack_trace</code> field here just to keep the example free of newlines.</p>
</td>
</tr>
</table>
</div>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">       @timestamp       |    document.id     |document.index |document.routing|                                                            error.message                                                            |error.pipeline |error.pipeline_trace|error.processor_tag|error.processor_type|        error.type
------------------------+--------------------+---------------+----------------+-------------------------------------------------------------------------------------------------------------------------------------+---------------+--------------------+-------------------+--------------------+--------------------------
2025-05-01T12:00:00.000Z|Y0vQipYB_ZAKuDfZR4sR|my-datastream  |null            |[1:45] failed to parse field [id] of type [long] in document with id 'Y0vQipYB_ZAKuDfZR4sR'. Preview of field's value: 'invalid_text'|null           |null                |null               |null                |document_parsing_exception</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Because the <code class="literal">document.source</code> field is unmapped, it is absent from the ES|SQL results.</p>
</div>
</div>
<div class="position-relative"><h5><a id="_search_api"></a>Search API</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<a id="4d7ecaf879ddd3bcb7876915515be056"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET my-datastream::failures/_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/801.console"></div>
<p>An example of a search result with the failed document present:</p>
<a id="9736cf7f79d69a5e08878d01d923d34b"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 0,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1,
    "hits": [
      {
        "_index": ".fs-my-datastream-2025.05.01-000002",
        "_id": "lEu8jZYB_ZAKuDfZNouU",
        "_score": 1,
        "_source": {
          "@timestamp": "2025-05-01T12:00:00.000Z",
          "document": {
            "id": "Y0vQipYB_ZAKuDfZR4sR",
            "index": "my-datastream",
            "source": {
              "@timestamp": "2025-05-01T00:00:00Z",
              "id": "invalid_text"
            }
          },
          "error": {
            "type": "document_parsing_exception",
            "message": "[1:53] failed to parse field [id] of type [long] in document with id 'Y0vQipYB_ZAKuDfZR4sR'. Preview of field's value: 'invalid_text'",
            "stack_trace": """o.e.i.m.DocumentParsingException: [1:53] failed to parse field [id] of type [long] in document with id 'Y0vQipYB_ZAKuDfZR4sR'. Preview of field's value: 'invalid_text'
	at o.e.i.m.FieldMapper.rethrowAsDocumentParsingException(FieldMapper.java:241)
	at o.e.i.m.FieldMapper.parse(FieldMapper.java:194)
	... 24 more
Caused by: j.l.IllegalArgumentException: For input string: "invalid_text"
	at o.e.x.s.AbstractXContentParser.toLong(AbstractXContentParser.java:189)
	at o.e.x.s.AbstractXContentParser.longValue(AbstractXContentParser.java:210)
	... 31 more
"""
          }
        }
      }
    ]
  }
}</pre>
</div>
<div class="position-relative"><h5><a id="_sql"></a>SQL</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<a id="fa8eca1f33f0bfdbb497c906115ce8d7"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _sql?format=txt
{
    "query": """SELECT * FROM "my-datastream::failures" LIMIT 1"""
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/802.console"></div>
<p>An example of a search result with the failed document present:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">       @timestamp       |    document.id     |document.index |document.routing|                                                            error.message                                                            |error.pipeline |error.pipeline_trace|error.processor_tag|error.processor_type|                                                                                                                                                                                                                                                                            error.stack_trace                                                                                                                                                                                                                                                                            |        error.type
------------------------+--------------------+---------------+----------------+-------------------------------------------------------------------------------------------------------------------------------------+---------------+--------------------+-------------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------
2025-05-05T20:49:10.899Z|sXk1opYBL1dfU_1htCAE|my-datastream  |null            |[1:45] failed to parse field [id] of type [long] in document with id 'sXk1opYBL1dfU_1htCAE'. Preview of field's value: 'invalid_text'|null           |null                |null               |null                |o.e.i.m.DocumentParsingException: [1:45] failed to parse field [id] of type [long] in document with id 'sXk1opYBL1dfU_1htCAE'. Preview of field's value: 'invalid_text'
	at o.e.i.m.FieldMapper.rethrowAsDocumentParsingException(FieldMapper.java:241)
	at o.e.i.m.FieldMapper.parse(FieldMapper.java:194)
	... 19 more
Caused by: j.l.IllegalArgumentException: For input string: "invalid_text"
	at o.e.x.s.AbstractXContentParser.toLong(AbstractXContentParser.java:189)
	at o.e.x.s.AbstractXContentParser.longValue(AbstractXContentParser.java:210)
	... 26 more
|document_parsing_exception</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Because the <code class="literal">document.source</code> field is unmapped, it is absent from the ES|SQL and SQL results.</p>
</div>
</div>
<div class="position-relative"><h4><a id="use-failure-store-document"></a>Failure document structure</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>Failure documents have a uniform structure that is handled internally by Elasticsearch.
<code class="literal">@timestamp</code>:: (<code class="literal">date</code>) The timestamp at which the document encountered a failure in Elasticsearch.
<code class="literal">document</code>:: (<code class="literal">object</code>) The document at time of failure. If the document failed in an ingest pipeline, then the document will be the unprocessed version of the document as it arrived in the original indexing request. If the document failed due to a mapping issue, then the document will be as it was after any ingest pipelines were applied to it.</p>
<p>+</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">document.id</code> (<code class="literal">keyword</code>) The ID of the original document at the time of failure.
</li>
<li class="listitem">
<code class="literal">document.routing</code> (<code class="literal">keyword</code>, optional) The routing of the original document at the time of failure if it was specified.
</li>
<li class="listitem">
<code class="literal">document.index</code> (<code class="literal">keyword</code>) The index that the document was being written to when it failed.
</li>
<li class="listitem">
<code class="literal">document.source</code> (unmapped object) The body of the original document. This field is unmapped and only present in the failure document&#8217;s source. This prevents mapping conflicts in the failure store when redirecting failed documents. If you need to include fields from the original document&#8217;s source in your queries, use <a class="xref" href="runtime-search-request.html" title="Define runtime fields in a search request">runtime fields</a> on the search request.
</li>
</ul>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">error</code>
</span>
</dt>
<dd>
<p>
(<code class="literal">object</code>) Information about the failure that prevented this document from being indexed.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">error.message</code> (<code class="literal">match_only_text</code>) The error message that describes the failure.
</li>
<li class="listitem">
<code class="literal">error.stack_trace</code> (<code class="literal">text</code>) A compressed stack trace from Elasticsearch for the failure.
</li>
<li class="listitem">
<code class="literal">error.type</code> (<code class="literal">keyword</code>) The type classification of the failure. Values are the same type returned within failed indexing API responses.
</li>
<li class="listitem">
<code class="literal">error.pipeline</code> (<code class="literal">keyword</code>, optional) If the failure occurred in an ingest pipeline, this will contain the name of the pipeline.
</li>
<li class="listitem">
<code class="literal">error.pipeline_trace</code> (<code class="literal">keyword</code>, optional array) If the failure occurred in an ingest pipeline, this will contain the list of pipelines that the document had visited up until the failure.
</li>
<li class="listitem">
<code class="literal">error.processor_tag</code> (<code class="literal">keyword</code>, optional) If the failure occurred in an ingest processor that is annotated with a tag, the tag contents will be present here.
</li>
<li class="listitem">
<code class="literal">error.processor_type</code> (<code class="literal">keyword</code>, optional) If the failure occurred in an ingest processor, this will contain the processor type. (e.g. <code class="literal">script</code>, <code class="literal">append</code>, <code class="literal">enrich</code>, etc.)
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="position-relative"><h5><a id="use-failure-store-document-source"></a>Failure document source</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>The contents of a failure&#8217;s <code class="literal">document</code> field is dependent on when the failure occurred in ingestion. When sending data to a data stream, documents can fail in two different phases: during an ingest pipeline and during indexing.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Documents that fail during an ingest pipeline will store the source of the document as it was originally sent to Elasticsearch. Changes from pipelines are discarded before redirecting the failure.
</li>
<li class="listitem">
Documents that fail during indexing will store the source of the document as it was during the index operation. Any changes from pipelines will be reflected in the source of the document that is redirected.
To help demonstrate the differences between these kinds of failures, we will use the following pipeline and template definition.
</li>
</ol>
</div>
<a id="30e0e277a5a2c22037072d04f9fdf109"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-datastream-example-pipeline
{
  "processors": [
    {
      "set": { <a id="CO256-1"></a><i class="conum" data-value="1"></i>
        "override": false,
        "field": "@timestamp",
        "copy_from": "_ingest.timestamp"
      }
    },
    {
      "set": { <a id="CO256-2"></a><i class="conum" data-value="2"></i>
        "field": "published",
        "copy_from": "data"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/803.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO256-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>We use this processor to add a <code class="literal">@timestamp</code> to the document if one is missing.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO256-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>A simple processor that copies the <code class="literal">data</code> field to the <code class="literal">published</code> field.</p>
</td>
</tr>
</table>
</div>
<a id="9bf143cafe68af4cf8d35dbef7bf4ea9"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _index_template/my-datastream-example-template
{
    "index_patterns": ["my-datastream-ingest*"],
    "data_stream": {},
    "template": {
      "settings": {
        "index.default_pipeline": "my-datastream-example-pipeline" // Calling the pipeline by default.
      },
      "mappings": {
        "properties": {
          "published": { // A field of type long to hold our result.
            "type": "long"
          }
        }
      },
      "data_stream_options": {
        "failure_store": {
          "enabled": true // Failure store is enabled.
        }
      }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/804.console"></div>
<p>During ingestion, documents are first processed by any applicable ingest pipelines. This process modifies a copy of the document and only saves the changes to the original document after all pipelines have completed. If a document is sent to the failure store because of a failure during an ingest pipeline, any changes to the document made by the pipelines it has been through will be discarded before redirecting the failure. This means that the document will be in the same state as when it was originally sent by the client. This has the benefit of being able to see the document before any pipelines have run on it, and allows for the original document to be used in simulate operations to further troubleshoot any problems in the ingest pipeline.
Using the pipeline and template defined above, we will send a document that is missing a required field for the pipeline. The document will fail:</p>
<a id="c2845e640c11ced810bba2b9daac141b"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST my-datastream-ingest/_doc
{
  "random": 42 // Not the field we're looking for.
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/805.console"></div>
<a id="f7d88e2abdd239b770e22fadb417a045"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "_index": ".fs-my-datastream-ingest-2025.05.09-000002",
  "_id": "eXS-tpYBwrYNjPmat9Cx",
  "_version": 1,
  "result": "created",
  "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 0,
  "_primary_term": 1,
  "failure_store": "used" <a id="CO257-1"></a><i class="conum" data-value="1"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO257-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The document failed and went to the failure store.</p>
</td>
</tr>
</table>
</div>
<p>Inspecting the corresponding failure document will show the document in its original form as it was sent to Elasticsearch.</p>
<a id="8203c7e97fb51c9a7e20cbb9f95db9af"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET my-datastream-ingest::failures/_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/806.console"></div>
<a id="9d250aec2953e5a8d33b76c6ba0af209"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 0,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1,
    "hits": [
      {
        "_index": ".fs-my-datastream-ingest-2025.05.09-000002",
        "_id": "eXS-tpYBwrYNjPmat9Cx",
        "_score": 1,
        "_source": {
          "@timestamp": "2025-05-09T20:31:13.759Z",
          "document": { <a id="CO258-1"></a><i class="conum" data-value="1"></i>
            "index": "my-datastream-ingest",
            "source": {
              "random": 42
            }
          },
          "error": {
            "type": "illegal_argument_exception",
            "message": "field [data] not present as part of path [data]", <a id="CO258-2"></a><i class="conum" data-value="2"></i>
            "stack_trace": """j.l.IllegalArgumentException: field [data] not present as part of path [data]
	at o.e.i.IngestDocument.getFieldValue(IngestDocument.java:202)
	at o.e.i.c.SetProcessor.execute(SetProcessor.java:86)
	... 14 more
""",
            "pipeline_trace": [
              "my-datastream-example-pipeline"
            ],
            "pipeline": "my-datastream-example-pipeline",
            "processor_type": "set"
          }
        }
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO258-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">document</code> field shows the state of the document is from before any pipeline executions.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO258-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The pipeline failed after the timestamp would have been added.
We can see that the document failed on the second processor in the pipeline. The first processor would have added a <code class="literal">@timestamp</code> field. Since the pipeline failed, we find that it has no <code class="literal">@timestamp</code> field added because it did not save any changes from before the pipeline failed.
The second time when failures can occur is during indexing. After the documents have been processed by any applicable pipelines, they are parsed using the index mappings before being indexed into the shard. If a document is sent to the failure store due to a failure in this process, then it will be stored as it was after any ingestion had occurred. This is because, by this point, the original document has already been overwritten by the ingest pipeline changes. This has the benefit of allowing you to see what the document looked like during the mapping and indexing phase of the write operation.</p>
</td>
</tr>
</table>
</div>
<p>Building on the example above, we send a document that has a text value where we expect a numeric value:</p>
<a id="0c3bcd8b59bd209614399c2f8c6cd5ce"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST my-datastream-ingest/_doc
{
  "data": "this field is invalid" <a id="CO259-1"></a><i class="conum" data-value="1"></i>
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/807.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO259-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The mappings above expect this field to have been a numeric value.</p>
</td>
</tr>
</table>
</div>
<a id="20c0e907e45c907f2155fdad1e32e8d2"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "_index": ".fs-my-datastream-ingest-2025.05.09-000002",
  "_id": "sXTVtpYBwrYNjPmaFNAY",
  "_version": 1,
  "result": "created",
  "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 0,
  "_primary_term": 1,
  "failure_store": "used" <a id="CO260-1"></a><i class="conum" data-value="1"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO260-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The document failed and was sent to the failure store.
If we obtain the corresponding failure document, we can see that the document stored has had the default pipeline applied to it.</p>
</td>
</tr>
</table>
</div>
<a id="8203c7e97fb51c9a7e20cbb9f95db9af"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET my-datastream-ingest::failures/_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/808.console"></div>
<a id="ad595bcbed75b7f38bcfdaf269559473"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 0,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1,
    "hits": [
      {
        "_index": ".fs-my-datastream-ingest-2025.05.09-000002",
        "_id": "sXTVtpYBwrYNjPmaFNAY",
        "_score": 1,
        "_source": {
          "@timestamp": "2025-05-09T20:55:38.943Z",
          "document": { <a id="CO261-1"></a><i class="conum" data-value="1"></i>
            "id": "sHTVtpYBwrYNjPmaEdB5",
            "index": "my-datastream-ingest",
            "source": {
              "@timestamp": "2025-05-09T20:55:38.362486755Z",
              "data": "this field is invalid",
              "published": "this field is invalid"
            }
          },
          "error": {
            "type": "document_parsing_exception", <a id="CO261-2"></a><i class="conum" data-value="2"></i>
            "message": "[1:91] failed to parse field [published] of type [long] in document with id 'sHTVtpYBwrYNjPmaEdB5'. Preview of field's value: 'this field is invalid'",
            "stack_trace": """o.e.i.m.DocumentParsingException: [1:91] failed to parse field [published] of type [long] in document with id 'sHTVtpYBwrYNjPmaEdB5'. Preview of field's value: 'this field is invalid'
	at o.e.i.m.FieldMapper.rethrowAsDocumentParsingException(FieldMapper.java:241)
	at o.e.i.m.FieldMapper.parse(FieldMapper.java:194)
	... 24 more
Caused by: j.l.IllegalArgumentException: For input string: "this field is invalid"
	at o.e.x.s.AbstractXContentParser.toLong(AbstractXContentParser.java:189)
	at o.e.x.s.AbstractXContentParser.longValue(AbstractXContentParser.java:210)
	... 31 more
"""
          }
        }
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO261-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">document</code> field reflects the document after the ingest pipeline has run.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO261-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The document failed to be indexed because of a mapping mismatch.
The <code class="literal">document</code> field attempts to show the effective input to whichever process led to the failure occurring. This gives you all the information you need to reproduce the problem.</p>
</td>
</tr>
</table>
</div>
<div class="position-relative"><h3><a id="manage-failure-store"></a>Manage a data stream&#8217;s failure store</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>Failure data can accumulate in a data stream over time. To help manage this accumulation, most administrative operations that can be done on a data stream can be applied to the data stream&#8217;s failure store.</p>
<div class="position-relative"><h4><a id="manage-failure-store-rollover"></a>Failure store rollover</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>A data stream treats its failure store much like a secondary set of <a class="xref" href="data-streams.html#backing-indices" title="Backing indices">backing indices</a>. Multiple dedicated hidden indices serve search requests for the failure store, while one index acts as the current write index. You can use the <a href="/docs/api/doc/elasticsearch/operation/operation-indices-rollover" class="ulink" target="_top">rollover</a> API to rollover the failure store. Much like the regular indices in a data stream, a new write index will be created in the failure store to accept new failure documents.</p>
<a id="c938d8f62dc02103dc7074ec6d351a9e"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST my-datastream::failures/_rollover</pre>
</div>
<div class="console_widget" data-snippet="snippets/809.console"></div>
<a id="e8b91b2c18cf80a9ced391c16d896c90"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "acknowledged": true,
  "shards_acknowledged": true,
  "old_index": ".fs-my-datastream-2025.05.01-000002",
  "new_index": ".fs-my-datastream-2025.05.01-000003",
  "rolled_over": true,
  "dry_run": false,
  "lazy": false,
  "conditions": {}
}</pre>
</div>
<div class="position-relative"><h4><a id="manage-failure-store-lifecycle"></a>Failure store lifecycle</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>Failure stores have their retention managed using an internal <a class="xref" href="data-stream-lifecycle.html" title="Data stream lifecycle">data stream lifecycle</a>. A thirty day (30d) retention is applied to failure store data. You can view the active lifecycle for a failure store index by calling the <a href="/docs/api/doc/elasticsearch/operation/operation-indices-get-data-stream" class="ulink" target="_top">get data stream API</a>:</p>
<a id="21c6cc867659cd7a29384b93dc29c170"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _data_stream/my-datastream</pre>
</div>
<div class="console_widget" data-snippet="snippets/810.console"></div>
<a id="37205306b96072fb967f048480a95477"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "data_streams": [
    {
      "name": "my-datastream",
      "timestamp_field": {
        "name": "@timestamp"
      },
      "indices": [
        {
          "index_name": ".ds-my-datastream-2025.05.01-000001",
          "index_uuid": "jUbUNf-8Re-Nca8vJkHnkA",
          "managed_by": "Data stream lifecycle",
          "prefer_ilm": true,
          "index_mode": "standard"
        }
      ],
      "generation": 2,
      "status": "GREEN",
      "template": "my-datastream-template",
      "lifecycle": {
        "enabled": true
      },
      "next_generation_managed_by": "Data stream lifecycle",
      "prefer_ilm": true,
      "hidden": false,
      "system": false,
      "allow_custom_routing": false,
      "replicated": false,
      "rollover_on_write": false,
      "index_mode": "standard",
      "failure_store": { <a id="CO262-1"></a><i class="conum" data-value="1"></i>
        "enabled": true,
        "rollover_on_write": false,
        "indices": [
          {
            "index_name": ".fs-my-datastream-2025.05.05-000002",
            "index_uuid": "oYS2WsjkSKmdazWuS4RP9Q",
            "managed_by": "Data stream lifecycle"  <a id="CO262-2"></a><i class="conum" data-value="2"></i>
          }
        ],
        "lifecycle": {
          "enabled": true,
          "effective_retention": "30d",  <a id="CO262-3"></a><i class="conum" data-value="3"></i>
          "retention_determined_by": "default_failures_retention"  <a id="CO262-4"></a><i class="conum" data-value="4"></i>
        }
      }
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO262-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Information about the failure store is presented in the response under its own field.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO262-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Indices are managed by data stream lifecycles by default.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO262-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>An effective retention period of thirty days (30d) is present by default.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO262-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The retention is currently determined by the default.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The default retention respects any maximum retention values. If <a class="xref" href="tutorial-manage-data-stream-retention.html#what-is-retention" title="What is data stream retention?">maximum retention</a> is configured lower than thirty days then the maximum retention will be used as the default value.</p>
</div>
</div>
<p>You can update the default retention period for failure stores in your deployment by updating the <code class="literal">data_streams.lifecycle.retention.failures_default</code> cluster setting. New and existing data streams that have no retention configured on their failure stores will use this value to determine their retention period.</p>
<a id="02ef4cd3ca104bcb917e07272f82bee3"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent": {
    "data_streams.lifecycle.retention.failures_default": "15d"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/811.console"></div>
<p>You can also specify the failure store retention period for a data stream on its data stream options. These can be specified via the index template for new data streams, or via the <a href="/docs/api/doc/elasticsearch/operation/operation-indices-put-data-stream-options" class="ulink" target="_top">Update data stream options</a> API for existing data streams.</p>
<a id="b7d0c082c6b8cf0c0e4d90be675e1f22"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT _data_stream/my-datastream/_options
{
    "failure_store": {
        "enabled": true, <a id="CO263-1"></a><i class="conum" data-value="1"></i>
        "lifecycle": {
            "data_retention": "10d" <a id="CO263-2"></a><i class="conum" data-value="2"></i>
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/812.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO263-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Ensure that the failure store remains enabled.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO263-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set only this data stream&#8217;s failure store retention to ten days.</p>
</td>
</tr>
</table>
</div>
<div class="position-relative"><h4><a id="manage-failure-store-indices"></a>Add and remove from failure store</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/failure-store.asciidoc">edit</a></div>
<p>Failure stores support adding and removing indices from them using the <a href="/docs/api/doc/elasticsearch/operation/operation-indices-modify-data-stream" class="ulink" target="_top">Update data streams</a> API.</p>
<a id="c70484c6f9bd683fa94e3e628ff9ff2c"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST _data_stream/_modify
{
  "actions":[
    {
      "remove_backing_index": { <a id="CO264-1"></a><i class="conum" data-value="1"></i>
        "data_stream": "my-datastream",
        "index": ".fs-my-datastream-2025.05.05-000002", <a id="CO264-2"></a><i class="conum" data-value="2"></i>
        "failure_store": true <a id="CO264-3"></a><i class="conum" data-value="3"></i>
      }
    },
    {
      "add_backing_index": { <a id="CO264-4"></a><i class="conum" data-value="4"></i>
        "data_stream": "my-datastream",
        "index": "restored-failure-index", <a id="CO264-5"></a><i class="conum" data-value="5"></i>
        "failure_store": true <a id="CO264-6"></a><i class="conum" data-value="6"></i>
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/813.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO264-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Action to remove a backing index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO264-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of an auto-generated failure store index that should be removed.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO264-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set <code class="literal">failure_store</code> to true to have the modify API target operate on the data stream&#8217;s failure store.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO264-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Action to add a backing index.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO264-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of an index that should be added to the failure store.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO264-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set <code class="literal">failure_store</code> to true to have the modify API target operate on the data stream&#8217;s failure store.
This API gives you fine-grained control over the indices in your failure store, allowing you to manage backup and restoration operations as well as isolate failure data for later remediation.</p>
</td>
</tr>
</table>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="tutorial-migrate-data-stream-from-ilm-to-dsl.html">« Tutorial: Migrate ILM managed data stream to data stream lifecycle</a>
</span>
<span class="next">
<a href="failure-store-recipes.html">Using failure stores to address ingestion issues »</a>
</span>
</div>
</body>
</html>
