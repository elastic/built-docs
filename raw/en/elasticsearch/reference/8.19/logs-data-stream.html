<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Logs data stream | Elasticsearch Guide [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Logs data stream | Elasticsearch Guide [8.19]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.19]"/>
<link rel="up" href="data-streams.html" title="Data streams"/>
<link rel="prev" href="tsds-reindex.html" title="Reindex a time series data stream (TSDS)"/>
<link rel="next" href="data-stream-lifecycle.html" title="Data stream lifecycle"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.19"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="tsds-reindex.html">« Reindex a time series data stream (TSDS)</a>
</span>
<span class="next">
<a href="data-stream-lifecycle.html">Data stream lifecycle »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-streams.html">Data streams</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Logs data stream</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/manage-data/data-store/data-streams/logs-data-stream">latest documentation</a>.
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="logs-data-stream"></a>Logs data stream</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Elasticsearch <code class="literal">logsdb</code> index mode is generally available in Elastic Cloud Hosted
and self-managed Elasticsearch as of version 8.17, and is enabled by default for
logs in <a href="/elasticsearch/serverless" class="ulink" target="_top">Elastic Cloud Serverless</a>.</p>
</div>
</div>
<p>A logs data stream is a data stream type that stores log data more efficiently.</p>
<p>In benchmarks, log data stored in a logs data stream used ~2.5 times less disk space than a regular data
stream. The exact impact varies by data set.</p>
<div class="position-relative"><h3><a id="how-to-use-logsds"></a>Create a logs data stream</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Fleet integrations use <a class="xref" href="index-templates.html" title="Index templates">index templates</a> managed by Elastic. To modify these backing templates, update their <a href="/guide/en/observability/8.19/logs-index-template.html#custom-logs-template-edit" class="ulink" target="_top">composite <code class="literal">custom</code> templates</a>.</p>
</div>
</div>
<p>To create a logs data stream, set your <a class="xref" href="index-templates.html" title="Index templates">template</a> <code class="literal">index.mode</code> to <code class="literal">logsdb</code>:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.put_index_template(
    name="my-index-template",
    index_patterns=[
        "my-datastream-*"
    ],
    data_stream={},
    template={
        "settings": {
            "index.mode": "logsdb"
        }
    },
    priority=101,
)
print(resp)</pre>
</div>
<a id="4ab7c13d27ec8f9e6705a0e77fe53c20"></a>
<div class="pre_wrapper lang-console default has-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python">PUT _index_template/my-index-template
{
  "index_patterns": ["my-datastream-*"],
  "data_stream": { },
  "template": {
     "settings": {
        "index.mode": "logsdb" <a id="CO228-1"></a><i class="conum" data-value="1"></i>
     }
  },
  "priority": 101 <a id="CO228-2"></a><i class="conum" data-value="2"></i>
}</pre>
</div>
<div class="console_widget has-python" data-snippet="snippets/765.console"></div>
<div class="calloutlist default has-python lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO228-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The index mode setting.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO228-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The index template priority. By default, Elasticsearch ships with a <code class="literal">logs-*-*</code> index template with a priority of 100. To make sure your index template takes priority over the default <code class="literal">logs-*-*</code> template, set its <code class="literal">priority</code> to a number higher than 100. For more information, see <a class="xref" href="index-templates.html#avoid-index-pattern-collisions" title="Avoid index pattern collisions">Avoid index pattern collisions</a>.</p>
</td>
</tr>
</table>
</div>
<p>After the index template is created, new indices that use the template will be configured as a logs data stream. You can start indexing data and <a class="xref" href="use-a-data-stream.html" title="Use a data stream">using the data stream</a>.</p>
<p>You can also set the index mode and adjust other template settings in <a class="xref" href="index-mgmt.html" title="Index management in Kibana">the Elastic UI</a>.</p>
<div class="position-relative"><h3><a id="logsdb-synthetic-source"></a>Synthetic source</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>If you have the required <a href="/subscriptions" class="ulink" target="_top">subscription</a>, <code class="literal">logsdb</code> index mode uses <a class="xref" href="mapping-source-field.html#synthetic-source" title="Synthetic _source">synthetic <code class="literal">_source</code></a>, which omits storing the original <code class="literal">_source</code>
field. Instead, the document source is synthesized from doc values or stored fields upon document retrieval.</p>
<p>If you don&#8217;t have the required <a href="/subscriptions" class="ulink" target="_top">subscription</a>, <code class="literal">logsdb</code> mode uses the original <code class="literal">_source</code> field.</p>
<p>Before using synthetic source, make sure to review the <a class="xref" href="mapping-source-field.html#synthetic-source-restrictions" title="Synthetic _source restrictions">restrictions</a>.</p>
<p>When working with multi-value fields, the <code class="literal">index.mapping.synthetic_source_keep</code> setting controls how field values
are preserved for <a class="xref" href="mapping-source-field.html#synthetic-source" title="Synthetic _source">synthetic source</a> reconstruction. In <code class="literal">logsdb</code>, the default value is <code class="literal">arrays</code>,
which retains both duplicate values and the order of entries. However, the exact structure of
array elements and objects is not necessarily retained. Preserving duplicates and ordering can be critical for some
log fields, such as DNS A records, HTTP headers, and log entries that represent sequential or repeated events.</p>
<div class="position-relative"><h3><a id="logsdb-sort-settings"></a>Index sort settings</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>In <code class="literal">logsdb</code> index mode, indices are sorted by the fields <code class="literal">host.name</code> and <code class="literal">@timestamp</code> by default.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the <code class="literal">@timestamp</code> field is not present, it is automatically injected.
</li>
<li class="listitem">
<p>If the <code class="literal">host.name</code> field is not present, it is automatically injected as a <code class="literal">keyword</code> field, if possible.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If <code class="literal">host.name</code> can&#8217;t be injected (for example, <code class="literal">host</code> is a keyword field) or can&#8217;t be used for sorting
(for example, its value is an IP address), only the <code class="literal">@timestamp</code> is used for sorting.
</li>
<li class="listitem">
If <code class="literal">host.name</code> is injected and <code class="literal">subobjects</code> is set to <code class="literal">true</code> (default), the <code class="literal">host</code> field is mapped as
an object field named <code class="literal">host</code> with a <code class="literal">name</code> child field of type <code class="literal">keyword</code>. If <code class="literal">subobjects</code> is set to <code class="literal">false</code>,
a single <code class="literal">host.name</code> field is mapped as a <code class="literal">keyword</code> field.
</li>
</ul>
</div>
</li>
<li class="listitem">
To prioritize the latest data, <code class="literal">host.name</code> is sorted in ascending order and <code class="literal">@timestamp</code> is sorted in
descending order.
</li>
</ul>
</div>
<p>You can override the default sort settings by manually configuring <code class="literal">index.sort.field</code>
and <code class="literal">index.sort.order</code>. For more details, see <a class="xref" href="index-modules-index-sorting.html" title="Index Sorting"><em>Index Sorting</em></a>.</p>
<p>To modify the sort configuration of an existing data stream, update the data stream&#8217;s
component templates, and then perform or wait for a <a class="xref" href="data-streams.html#data-streams-rollover" title="Rollover">rollover</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you apply custom sort settings, the <code class="literal">@timestamp</code> field is injected into the mappings but is not
automatically added to the list of sort fields. For best results, include it manually as the last sort
field, with <code class="literal">desc</code> ordering.</p>
</div>
</div>
<div class="position-relative"><h4><a id="logsdb-host-name"></a>Existing data streams</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>If you&#8217;re enabling <code class="literal">logsdb</code> index mode on a data stream that already exists, make sure to check mappings and sorting. The <code class="literal">logsdb</code> mode automatically maps <code class="literal">host.name</code> as a keyword if it&#8217;s included in the sort settings. If a <code class="literal">host.name</code> field already exists but has a different type, mapping errors might occur, preventing <code class="literal">logsdb</code> mode from being fully applied.</p>
<p>To avoid mapping conflicts, consider these options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Adjust mappings:</strong></span> Check your existing mappings to ensure that <code class="literal">host.name</code> is mapped as a keyword.
</li>
<li class="listitem">
<span class="strong strong"><strong>Change sorting:</strong></span> If needed, you can remove <code class="literal">host.name</code> from the sort settings and use a different set of fields. Sorting by <code class="literal">@timestamp</code> can be a good fallback.
</li>
<li class="listitem">
<span class="strong strong"><strong>Switch to a different <a class="xref" href="index-modules.html#index-mode-setting">index mode</a></strong></span>: If resolving <code class="literal">host.name</code> mapping conflicts is not feasible, you can choose not to use <code class="literal">logsdb</code> mode.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>On existing data streams, <code class="literal">logsdb</code> mode is applied on <a class="xref" href="data-streams.html#data-streams-rollover" title="Rollover">rollover</a> (automatic or manual).</p>
</div>
</div>
<div class="position-relative"><h4><a id="logsdb-sort-routing"></a>Optimized routing on sort fields</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>If you have the required [subscription](<a href="/subscriptions" class="ulink" target="_top">https://www.elastic.co/subscriptions</a>), you can enable routing optimizations
to reduce the storage footprint of <code class="literal">logsdb</code> indexes. A routing optimization uses the fields in the sort configuration
(except for <code class="literal">@timestamp</code>) to route documents to shards.</p>
<p>In benchmarks,
routing optimizations reduced storage requirements by 20% compared to the default <code class="literal">logsdb</code> configuration, with a negligible penalty to ingestion
performance (1-4%). Routing optimizations can benefit data streams that are expected to grow substantially over
time. Exact results depend on the sort configuration and the nature of the logged data.</p>
<p>To configure a routing optimization:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Include the index setting <code class="literal">[index.logsdb.route_on_sort_fields:true]</code> in the data stream configuration.
</li>
<li class="listitem">
<a class="xref" href="index-modules-index-sorting.html" title="Index Sorting">Configure index sorting</a> with two or more fields, in addition to <code class="literal">@timestamp</code>.
</li>
<li class="listitem">
Make sure the <a class="xref" href="mapping-id-field.html" title="_id field"><code class="literal">_id</code></a> field is not populated in ingested documents. It should be
auto-generated instead.
</li>
</ul>
</div>
<p>A custom sort configuration is required, to improve storage efficiency and to minimize hotspots
from logging spikes that may route documents to a single shard. For best results, use a few sort fields
that have a relatively low cardinality and don&#8217;t co-vary (for example, <code class="literal">host.name</code> and <code class="literal">host.id</code> are not optimal).</p>
<div class="position-relative"><h3><a id="logsdb-specialized-codecs"></a>Specialized codecs</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>By default, <code class="literal">logsdb</code> index mode uses the <code class="literal">best_compression</code> <a class="xref" href="index-modules.html#index-codec">codec</a>, which applies <a href="https://en.wikipedia.org/wiki/Zstd" class="ulink" target="_top">ZSTD</a>
compression to stored fields. You can switch to the <code class="literal">default</code> codec for faster compression with a slightly larger storage footprint.</p>
<p>The <code class="literal">logsdb</code> index mode also automatically applies specialized codecs for numeric doc values, in order to optimize storage usage. Numeric fields are
encoded using the following sequence of codecs:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Delta encoding</strong></span>:
Stores the difference between consecutive values instead of the actual values.
</li>
<li class="listitem">
<span class="strong strong"><strong>Offset encoding</strong></span>:
Stores the difference from a base value rather than between consecutive values.
</li>
<li class="listitem">
<span class="strong strong"><strong>Greatest Common Divisor (GCD) encoding</strong></span>:
Finds the greatest common divisor of a set of values and stores the differences as multiples of the GCD.
</li>
<li class="listitem">
<span class="strong strong"><strong>Frame Of Reference (FOR) encoding</strong></span>:
Determines the smallest number of bits required to encode a block of values and uses
bit-packing to fit such values into larger 64-bit blocks.
</li>
</ul>
</div>
<p>Each encoding is evaluated according to heuristics determined by the data distribution.
For example, the algorithm checks whether the data is monotonically non-decreasing or
non-increasing. If so, delta encoding is applied; otherwise, the process
continues with the next encoding method (offset).</p>
<p>Encoding is specific to each Lucene segment and is reapplied when segments are merged. The merged Lucene segment
might use a different encoding than the original segments, depending on the characteristics of the merged data.</p>
<p>For keyword fields, <span class="strong strong"><strong>Run Length Encoding (RLE)</strong></span> is applied to the ordinals, which represent positions in the Lucene
segment-level keyword dictionary. This compression is used when multiple consecutive documents share the same keyword.</p>
<div class="position-relative"><h3><a id="logsdb-ignored-settings"></a><code class="literal">ignore</code> settings</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>The <code class="literal">logsdb</code> index mode uses the following <code class="literal">ignore</code> settings. You can override these settings as needed.</p>
<div class="position-relative"><h4><a id="logsdb-ignore-malformed"></a><code class="literal">ignore_malformed</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>By default, <code class="literal">logsdb</code> index mode sets <code class="literal">ignore_malformed</code> to <code class="literal">true</code>. With this setting, documents with malformed fields
can be indexed without causing ingestion failures.</p>
<div class="position-relative"><h4><a id="logs-db-ignore-above"></a><code class="literal">ignore_above</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>In <code class="literal">logsdb</code> index mode, the <code class="literal">index.mapping.ignore_above</code> setting is applied by default at the index level to ensure
efficient storage and indexing of large keyword fields. This applies to all members of the keyword type family (keyword,
constant_keyword, and wildcard). The index-level default for <code class="literal">ignore_above</code> is 8191 <em>characters.</em> Using UTF-8 encoding,
this results in a limit of 32764 bytes, depending on character encoding.</p>
<p>The mapping-level <code class="literal">ignore_above</code> setting takes precedence. If a specific field has an <code class="literal">ignore_above</code> value
defined in its mapping, that value overrides the index-level <code class="literal">index.mapping.ignore_above</code> value. This default
behavior helps to optimize indexing performance by preventing excessively large string values from being indexed.</p>
<p>If you need to customize the limit, you can override it at the mapping level or change the index level default.</p>
<div class="position-relative"><h4><a id="logs-db-ignore-limit"></a><code class="literal">ignore_dynamic_beyond_limit</code></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>In <code class="literal">logsdb</code> index mode, the setting <code class="literal">index.mapping.total_fields.ignore_dynamic_beyond_limit</code> is set to <code class="literal">true</code> by
default. This setting allows dynamically mapped fields to be added on top of statically defined fields, even when the total number of fields exceeds the <code class="literal">index.mapping.total_fields.limit</code>. Instead of triggering an index failure, additional dynamically mapped fields are ignored so that ingestion can continue.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When automatically injected, <code class="literal">host.name</code> and <code class="literal">@timestamp</code> count toward the limit of mapped fields. If <code class="literal">host.name</code> is mapped with <code class="literal">subobjects: true</code>, it has two fields. When mapped with <code class="literal">subobjects: false</code>, <code class="literal">host.name</code> has only one field.</p>
</div>
</div>
<div class="position-relative"><h3><a id="logsdb-nodocvalue-fields"></a>Fields without <code class="literal">doc_values</code></h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>When the <code class="literal">logsdb</code> index mode uses synthetic <code class="literal">_source</code> and <code class="literal">doc_values</code> are disabled for a field in the mapping,
Elasticsearch might set the <code class="literal">store</code> setting to <code class="literal">true</code> for that field. This ensures that the field&#8217;s
data remains accessible for reconstructing the document&#8217;s source when using
<a class="xref" href="mapping-source-field.html#synthetic-source" title="Synthetic _source">synthetic source</a>.</p>
<p>For example, this adjustment occurs with text fields when <code class="literal">store</code> is <code class="literal">false</code> and no suitable multi-field is available for
reconstructing the original value.</p>
<div class="position-relative"><h3><a id="logsdb-settings-summary"></a>Settings reference</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/logs.asciidoc">edit</a></div>
<p>The <code class="literal">logsdb</code> index mode uses the following settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.mode</code></strong></span>: <code class="literal">"logsdb"</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.mapping.synthetic_source_keep</code></strong></span>: <code class="literal">"arrays"</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.sort.field</code></strong></span>: <code class="literal">["host.name", "@timestamp"]</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.sort.order</code></strong></span>: <code class="literal">["desc", "desc"]</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.sort.mode</code></strong></span>: <code class="literal">["min", "min"]</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.sort.missing</code></strong></span>: <code class="literal">["_first", "_first"]</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.codec</code></strong></span>: <code class="literal">"best_compression"</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.mapping.ignore_malformed</code></strong></span>: <code class="literal">true</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.mapping.ignore_above</code></strong></span>: <code class="literal">8191</code>
</li>
<li class="listitem">
<span class="strong strong"><strong><code class="literal">index.mapping.total_fields.ignore_dynamic_beyond_limit</code></strong></span>: <code class="literal">true</code>
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="tsds-reindex.html">« Reindex a time series data stream (TSDS)</a>
</span>
<span class="next">
<a href="data-stream-lifecycle.html">Data stream lifecycle »</a>
</span>
</div>
</body>
</html>
