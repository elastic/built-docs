<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ingest pipelines | Elasticsearch Guide [8.6] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [8.6]"/>
<link rel="up" href="index.html" title="Elasticsearch Guide [8.6]"/>
<link rel="prev" href="downsampling-ilm.html" title="Run downsampling with ILM"/>
<link rel="next" href="common-log-format-example.html" title="Example: Parse logs in the Common Log Format"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.6"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.6"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.6]</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="downsampling-ilm.html">« Run downsampling with ILM</a>
</span>
<span class="next">
<a href="common-log-format-example.html">Example: Parse logs in the Common Log Format »</a>
</span>
</div>
<div class="part">
<div class="titlepage"><div><div>
<h1 class="title"><a id="ingest"></a>Ingest pipelines<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h1>
</div></div></div>
<div class="openblock partintro">
<div class="content">
<p>Ingest pipelines let you perform common transformations on your data before
indexing. For example, you can use pipelines to remove fields, extract values
from text, and enrich your data.</p>
<p>A pipeline consists of a series of configurable tasks called
<a class="xref" href="processors.html" title="Ingest processor reference">processors</a>. Each processor runs sequentially, making specific
changes to incoming documents. After the processors have run, Elasticsearch adds the
transformed documents to your data stream or index.</p>
<div class="imageblock text-center">
<div class="content">
<img src="images/ingest/ingest-process.svg" alt="Ingest pipeline diagram">
</div>
</div>
<p>You can create and manage ingest pipelines using Kibana&#8217;s <span class="strong strong"><strong>Ingest Pipelines</strong></span>
feature or the <a class="xref" href="ingest-apis.html" title="Ingest APIs">ingest APIs</a>. Elasticsearch stores pipelines in the
<a class="xref" href="cluster-state.html" title="Cluster state API">cluster state</a>.</p>
<h3><a id="ingest-prerequisites"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Nodes with the <a class="xref" href="modules-node.html#node-ingest-node" title="Ingest node"><code class="literal">ingest</code></a> node role handle pipeline
processing. To use ingest pipelines, your cluster must have at least one node
with the <code class="literal">ingest</code> role. For heavy ingest loads, we recommend creating
<a class="xref" href="modules-node.html#node-ingest-node" title="Ingest node">dedicated ingest nodes</a>.
</li>
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">manage_pipeline</code>
<a class="xref" href="security-privileges.html#privileges-list-cluster" title="Cluster privileges">cluster privilege</a> to manage ingest pipelines. To use
Kibana&#8217;s <span class="strong strong"><strong>Ingest Pipelines</strong></span> feature, you also need the
<code class="literal">cluster:monitor/nodes/info</code> cluster privileges.
</li>
<li class="listitem">
Pipelines including the <code class="literal">enrich</code> processor require additional setup. See
<a class="xref" href="ingest-enriching-data.html" title="Enrich your data"><em>Enrich your data</em></a>.
</li>
</ul>
</div>
<h3><a id="create-manage-ingest-pipelines"></a>Create and manage pipelines<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>In Kibana, open the main menu and click <span class="strong strong"><strong>Stack Management &gt; Ingest
Pipelines</strong></span>. From the list view, you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
View a list of your pipelines and drill down into details
</li>
<li class="listitem">
Edit or clone existing pipelines
</li>
<li class="listitem">
Delete pipelines
</li>
</ul>
</div>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ingest/ingest-pipeline-list.png" alt="Kibana&#8217;s Ingest Pipelines list view">
</div>
</div>
<p>To create a pipeline, click <span class="strong strong"><strong>Create pipeline &gt; New pipeline</strong></span>. For an example
tutorial, see <a class="xref" href="common-log-format-example.html" title="Example: Parse logs in the Common Log Format"><em>Example: Parse logs</em></a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <span class="strong strong"><strong>New pipeline from CSV</strong></span> option lets you use a CSV to create an ingest
pipeline that maps custom data to the <a href="/guide/en/ecs/8.6" class="ulink" target="_top">Elastic Common Schema (ECS)</a>.
Mapping your custom data to ECS makes the data easier to search and lets you
reuse visualizations from other datasets. To get started, check
<a href="/guide/en/ecs/8.6/ecs-converting.html" class="ulink" target="_top">Map custom data to ECS</a>.</p>
</div>
</div>
<p>You can also use the <a class="xref" href="ingest-apis.html" title="Ingest APIs">ingest APIs</a> to create and manage pipelines.
The following <a class="xref" href="put-pipeline-api.html" title="Create or update pipeline API">create pipeline API</a> request creates
a pipeline containing two <a class="xref" href="set-processor.html" title="Set processor"><code class="literal">set</code></a> processors followed by a
<a class="xref" href="lowercase-processor.html" title="Lowercase processor"><code class="literal">lowercase</code></a> processor. The processors run sequentially
in the order specified.</p>
<a id="70f89dd6b71ea890ad3cf47d83e43344"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "description": "My optional pipeline description",
  "processors": [
    {
      "set": {
        "description": "My optional processor description",
        "field": "my-long-field",
        "value": 10
      }
    },
    {
      "set": {
        "description": "Set 'my-boolean-field' to true",
        "field": "my-boolean-field",
        "value": true
      }
    },
    {
      "lowercase": {
        "field": "my-keyword-field"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/657.console"></div>
<h3><a id="manage-pipeline-versions"></a>Manage pipeline versions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>When you create or update a pipeline, you can specify an optional <code class="literal">version</code>
integer. You can use this version number with the
<a class="xref" href="put-pipeline-api.html#put-pipeline-api-query-params" title="Query parameters"><code class="literal">if_version</code></a> parameter to conditionally
update the pipeline. When the <code class="literal">if_version</code> parameter is specified, a successful
update increments the pipeline&#8217;s version.</p>
<a id="d0c03847106d23ad632ceb624d647c37"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline-id
{
  "version": 1,
  "processors": [ ... ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/658.console"></div>
<p>To unset the <code class="literal">version</code> number using the API, replace or update the pipeline
without specifying the <code class="literal">version</code> parameter.</p>
<h3><a id="test-pipeline"></a>Test a pipeline<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Before using a pipeline in production, we recommend you test it using sample
documents. When creating or editing a pipeline in Kibana, click <span class="strong strong"><strong>Add
documents</strong></span>. In the <span class="strong strong"><strong>Documents</strong></span> tab, provide sample documents and click <span class="strong strong"><strong>Run
the pipeline</strong></span>.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ingest/test-a-pipeline.png" alt="Test a pipeline in Kibana">
</div>
</div>
<p>You can also test pipelines using the <a class="xref" href="simulate-pipeline-api.html" title="Simulate pipeline API">simulate pipeline
API</a>. You can specify a configured pipeline in the request path. For example,
the following request tests <code class="literal">my-pipeline</code>.</p>
<a id="15d4be58359542775f4aff88e6d8adb5"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ingest/pipeline/my-pipeline/_simulate
{
  "docs": [
    {
      "_source": {
        "my-keyword-field": "FOO"
      }
    },
    {
      "_source": {
        "my-keyword-field": "BAR"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/659.console"></div>
<p>Alternatively, you can specify a pipeline and its processors in the request
body.</p>
<a id="28415647fced5f983b42f8435332a625"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ingest/pipeline/_simulate
{
  "pipeline": {
    "processors": [
      {
        "lowercase": {
          "field": "my-keyword-field"
        }
      }
    ]
  },
  "docs": [
    {
      "_source": {
        "my-keyword-field": "FOO"
      }
    },
    {
      "_source": {
        "my-keyword-field": "BAR"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/660.console"></div>
<p>The API returns transformed documents:</p>
<a id="b9d0f9d9ff2d82251c41cb0c451b26e2"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "docs": [
    {
      "doc": {
        "_index": "_index",
        "_id": "_id",
        "_version": "-3",
        "_source": {
          "my-keyword-field": "foo"
        },
        "_ingest": {
          "timestamp": "2099-03-07T11:04:03.000Z"
        }
      }
    },
    {
      "doc": {
        "_index": "_index",
        "_id": "_id",
        "_version": "-3",
        "_source": {
          "my-keyword-field": "bar"
        },
        "_ingest": {
          "timestamp": "2099-03-07T11:04:04.000Z"
        }
      }
    }
  ]
}</pre>
</div>
<h3><a id="add-pipeline-to-indexing-request"></a>Add a pipeline to an indexing request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Use the <code class="literal">pipeline</code> query parameter to apply a pipeline to documents in
<a class="xref" href="docs-index_.html" title="Index API">individual</a> or <a class="xref" href="docs-bulk.html" title="Bulk API">bulk</a> indexing requests.</p>
<a id="e5c710b08a545522d50b4ce35503bc46"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-data-stream/_doc?pipeline=my-pipeline
{
  "@timestamp": "2099-03-07T11:04:05.000Z",
  "my-keyword-field": "foo"
}

PUT my-data-stream/_bulk?pipeline=my-pipeline
{ "create":{ } }
{ "@timestamp": "2099-03-07T11:04:06.000Z", "my-keyword-field": "foo" }
{ "create":{ } }
{ "@timestamp": "2099-03-07T11:04:07.000Z", "my-keyword-field": "bar" }</pre>
</div>
<div class="console_widget" data-snippet="snippets/661.console"></div>
<p>You can also use the <code class="literal">pipeline</code> parameter with the <a class="xref" href="docs-update-by-query.html" title="Update By Query API">update
by query</a> or <a class="xref" href="docs-reindex.html" title="Reindex API">reindex</a> APIs.</p>
<a id="24bdccb07bba7e7e6ff45d3d4cd83064"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST my-data-stream/_update_by_query?pipeline=my-pipeline

POST _reindex
{
  "source": {
    "index": "my-data-stream"
  },
  "dest": {
    "index": "my-new-data-stream",
    "op_type": "create",
    "pipeline": "my-pipeline"
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/662.console"></div>
<h3><a id="set-default-pipeline"></a>Set a default pipeline<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Use the <a class="xref" href="index-modules.html#index-default-pipeline"><code class="literal">index.default_pipeline</code></a> index setting to set
a default pipeline. Elasticsearch applies this pipeline to indexing requests if no
<code class="literal">pipeline</code> parameter is specified.</p>
<h3><a id="set-final-pipeline"></a>Set a final pipeline<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Use the <a class="xref" href="index-modules.html#index-final-pipeline"><code class="literal">index.final_pipeline</code></a> index setting to set a
final pipeline. Elasticsearch applies this pipeline after the request or default
pipeline, even if neither is specified.</p>
<h3><a id="pipelines-for-beats"></a>Pipelines for Beats<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>To add an ingest pipeline to an Elastic Beat, specify the <code class="literal">pipeline</code>
parameter under <code class="literal">output.elasticsearch</code> in <code class="literal">&lt;BEAT_NAME&gt;.yml</code>. For example,
for Filebeat, you&#8217;d specify <code class="literal">pipeline</code> in <code class="literal">filebeat.yml</code>.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["localhost:9200"]
  pipeline: my-pipeline</pre>
</div>
<h3><a id="pipelines-for-fleet-elastic-agent"></a>Pipelines for Fleet and Elastic Agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Elastic Agent integrations ship with default ingest pipelines that preprocess and enrich data before indexing.
<a href="/guide/en/fleet/8.6/index.html" class="ulink" target="_top">Fleet</a> applies these pipelines using <a class="xref" href="index-templates.html" title="Index templates">index
templates</a> that include <a class="xref" href="ingest.html#set-default-pipeline" title="Set a default pipeline">pipeline index settings</a>. Elasticsearch
matches these templates to your Fleet data streams based on the
<a href="/guide/en/fleet/8.6/data-streams.html#data-streams-naming-scheme" class="ulink" target="_top">stream&#8217;s naming
scheme</a>.</p>
<p>Each default integration pipeline calls a nonexistent, unversioned <code class="literal">@custom</code> ingest pipeline.
If unaltered, this pipeline call has no effect on your data. However, you can modify this call to
create custom pipelines for integrations that persist across upgrades.
Refer to <a href="/guide/en/fleet/8.6/data-streams-pipeline-tutorial.html" class="ulink" target="_top">Tutorial: Transform data with custom ingest pipelines</a> to learn more.</p>
<p>Fleet doesn&#8217;t provide a default ingest pipeline for the <span class="strong strong"><strong>Custom logs</strong></span> integration,
but you can specify a pipeline for this integration using an
<a class="xref" href="ingest.html#pipeline-custom-logs-index-template">index template</a> or a
<a class="xref" href="ingest.html#pipeline-custom-logs-configuration">custom configuration</a>.</p>
<p><a id="pipeline-custom-logs-index-template"></a><span class="strong strong"><strong>Option 1: Index template</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><a class="xref" href="ingest.html#create-manage-ingest-pipelines" title="Create and manage pipelines">Create</a> and <a class="xref" href="ingest.html#test-pipeline" title="Test a pipeline">test</a> your
ingest pipeline. Name your pipeline <code class="literal">logs-&lt;dataset-name&gt;-default</code>. This makes
tracking the pipeline for your integration easier.</p>
<p>For example, the following request creates a pipeline for the <code class="literal">my-app</code> dataset.
The pipeline&#8217;s name is <code class="literal">logs-my_app-default</code>.</p>
<a id="16a9ebe102b53495de9d2231f5ae7158"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/logs-my_app-default
{
  "description": "Pipeline for `my_app` dataset",
  "processors": [ ... ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/663.console"></div>
</li>
<li class="listitem">
<p>Create an <a class="xref" href="index-templates.html" title="Index templates">index template</a> that includes your pipeline in
the <a class="xref" href="index-modules.html#index-default-pipeline"><code class="literal">index.default_pipeline</code></a> or
<a class="xref" href="index-modules.html#index-final-pipeline"><code class="literal">index.final_pipeline</code></a> index setting. Ensure the
template is <a class="xref" href="set-up-a-data-stream.html#create-index-template" title="Create an index template">data stream enabled</a>. The
template&#8217;s index pattern should match <code class="literal">logs-&lt;dataset-name&gt;-*</code>.</p>
<p>You can create this template using Kibana&#8217;s <a class="xref" href="index-mgmt.html#manage-index-templates" title="Manage index templates"><span class="strong strong"><strong>Index
Management</strong></span></a> feature or the <a class="xref" href="indices-put-template.html" title="Create or update index template API">create index template
API</a>.</p>
<p>For example, the following request creates a template matching <code class="literal">logs-my_app-*</code>.
The template uses a component template that contains the
<code class="literal">index.default_pipeline</code> index setting.</p>
<a id="c92b761c18d8e1c3df75c04a21503e16"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console"># Creates a component template for index settings
PUT _component_template/logs-my_app-settings
{
  "template": {
    "settings": {
      "index.default_pipeline": "logs-my_app-default",
      "index.lifecycle.name": "logs"
    }
  }
}

# Creates an index template matching `logs-my_app-*`
PUT _index_template/logs-my_app-template
{
  "index_patterns": ["logs-my_app-*"],
  "data_stream": { },
  "priority": 500,
  "composed_of": ["logs-my_app-settings", "logs-my_app-mappings"]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/664.console"></div>
</li>
<li class="listitem">
When adding or editing your <span class="strong strong"><strong>Custom logs</strong></span> integration in Fleet,
click <span class="strong strong"><strong>Configure integration &gt; Custom log file &gt; Advanced options</strong></span>.
</li>
<li class="listitem">
<p>In <span class="strong strong"><strong>Dataset name</strong></span>, specify your dataset&#8217;s name. Fleet will add new data
for the integration to the resulting <code class="literal">logs-&lt;dataset-name&gt;-default</code> data stream.</p>
<p>For example, if your dataset&#8217;s name was <code class="literal">my_app</code>, Fleet adds new data to the
<code class="literal">logs-my_app-default</code> data stream.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ingest/custom-logs.png" alt="Set up custom log integration in Fleet">
</div>
</div>
</li>
<li class="listitem">
<p>Use the <a class="xref" href="indices-rollover-index.html" title="Rollover API">rollover API</a> to roll over your data stream.
This ensures Elasticsearch applies the index template and its pipeline settings to any
new data for the integration.</p>
<a id="4ce4563e207233c48ffe849728052dca"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST logs-my_app-default/_rollover/</pre>
</div>
<div class="console_widget" data-snippet="snippets/665.console"></div>
</li>
</ol>
</div>
<p><a id="pipeline-custom-logs-configuration"></a><span class="strong strong"><strong>Option 2: Custom configuration</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><a class="xref" href="ingest.html#create-manage-ingest-pipelines" title="Create and manage pipelines">Create</a> and <a class="xref" href="ingest.html#test-pipeline" title="Test a pipeline">test</a> your
ingest pipeline. Name your pipeline <code class="literal">logs-&lt;dataset-name&gt;-default</code>. This makes
tracking the pipeline for your integration easier.</p>
<p>For example, the following request creates a pipeline for the <code class="literal">my-app</code> dataset.
The pipeline&#8217;s name is <code class="literal">logs-my_app-default</code>.</p>
<a id="16a9ebe102b53495de9d2231f5ae7158"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/logs-my_app-default
{
  "description": "Pipeline for `my_app` dataset",
  "processors": [ ... ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/666.console"></div>
</li>
<li class="listitem">
When adding or editing your <span class="strong strong"><strong>Custom logs</strong></span> integration in Fleet,
click <span class="strong strong"><strong>Configure integration &gt; Custom log file &gt; Advanced options</strong></span>.
</li>
<li class="listitem">
<p>In <span class="strong strong"><strong>Dataset name</strong></span>, specify your dataset&#8217;s name. Fleet will add new data
for the integration to the resulting <code class="literal">logs-&lt;dataset-name&gt;-default</code> data stream.</p>
<p>For example, if your dataset&#8217;s name was <code class="literal">my_app</code>, Fleet adds new data to the
<code class="literal">logs-my_app-default</code> data stream.</p>
</li>
<li class="listitem">
<p>In <span class="strong strong"><strong>Custom Configurations</strong></span>, specify your pipeline in the <code class="literal">pipeline</code> policy
setting.</p>
<div class="imageblock text-center screenshot">
<div class="content">
<img src="images/ingest/custom-logs-pipeline.png" alt="Custom pipeline configuration for custom log integration">
</div>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Elastic Agent standalone</strong></span></p>
<p>If you run Elastic Agent standalone, you can apply pipelines using an
<a class="xref" href="index-templates.html" title="Index templates">index template</a> that includes the
<a class="xref" href="index-modules.html#index-default-pipeline"><code class="literal">index.default_pipeline</code></a> or
<a class="xref" href="index-modules.html#index-final-pipeline"><code class="literal">index.final_pipeline</code></a> index setting. Alternatively,
you can specify the <code class="literal">pipeline</code> policy setting in your <code class="literal">elastic-agent.yml</code>
configuration. See <a href="/guide/en/fleet/8.6/install-standalone-elastic-agent.html" class="ulink" target="_top">Install standalone Elastic Agents</a>.</p>
<h3><a id="pipelines-in-enterprise-search"></a>Pipelines in Enterprise Search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>When you create Elasticsearch indices for <a href="/guide/en/enterprise-search/8.6/index.html" class="ulink" target="_blank" rel="noopener">Enterprise Search</a> use cases, for example, using the <a href="/guide/en/enterprise-search/8.6/crawler.html" class="ulink" target="_blank" rel="noopener">web crawler</a> or <a href="/guide/en/enterprise-search/8.6/connectors.html" class="ulink" target="_blank" rel="noopener">connectors</a>, these indices are automatically set up with specific ingest pipelines.
These processors help optimize your content for search.
Refer to the <a href="/guide/en/enterprise-search/8.6/ingest-pipelines.html" class="ulink" target="_blank" rel="noopener">Enterprise Search documentation</a> for more information.</p>
<h3><a id="access-source-fields"></a>Access source fields in a processor<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Processors have read and write access to an incoming document&#8217;s source fields.
To access a field key in a processor, use its field name. The following <code class="literal">set</code>
processor accesses <code class="literal">my-long-field</code>.</p>
<a id="9120b6a49ec39a1571339fddf8e1a26f"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "set": {
        "field": "my-long-field",
        "value": 10
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/667.console"></div>
<p>You can also prepend the <code class="literal">_source</code> prefix.</p>
<a id="3fe9006f6c7faea162e43fb250f4da38"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "set": {
        "field": "_source.my-long-field",
        "value": 10
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/668.console"></div>
<p>Use dot notation to access object fields.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your document contains flattened objects, use the
<a class="xref" href="dot-expand-processor.html" title="Dot expander processor"><code class="literal">dot_expander</code></a> processor to expand them first. Other
ingest processors cannot access flattened objects.</p>
</div>
</div>
<a id="d050c6fa7d806457a5f32d30b07e9521"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "dot_expander": {
        "description": "Expand 'my-object-field.my-property'",
        "field": "my-object-field.my-property"
      }
    },
    {
      "set": {
        "description": "Set 'my-object-field.my-property' to 10",
        "field": "my-object-field.my-property",
        "value": 10
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/669.console"></div>
<p><a id="template-snippets"></a>Several processor parameters support <a href="https://mustache.github.io" class="ulink" target="_top">Mustache</a>
template snippets. To access field values in a template snippet, enclose the
field name in triple curly brackets:<code class="literal">{{{field-name}}}</code>. You can use template
snippets to dynamically set field names.</p>
<a id="adf728b0c11c5c309c730205609a379d"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "set": {
        "description": "Set dynamic '&lt;service&gt;' field to 'code' value",
        "field": "{{{service}}}",
        "value": "{{{code}}}"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/670.console"></div>
<h3><a id="access-metadata-fields"></a>Access metadata fields in a processor<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Processors can access the following metadata fields by name:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">_index</code>
</li>
<li class="listitem">
<code class="literal">_id</code>
</li>
<li class="listitem">
<code class="literal">_routing</code>
</li>
<li class="listitem">
<code class="literal">_dynamic_templates</code>
</li>
</ul>
</div>
<a id="9e5ae957fd0663662bfbed9d1effe99e"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "set": {
        "description": "Set '_routing' to 'geoip.country_iso_code' value",
        "field": "_routing",
        "value": "{{{geoip.country_iso_code}}}"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/671.console"></div>
<p>Use a Mustache template snippet to access metadata field values. For example,
<code class="literal">{{{_routing}}}</code> retrieves a document&#8217;s routing value.</p>
<a id="e6e47da87079a8b67f767a2a01878cf2"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "set": {
        "description": "Use geo_point dynamic template for address field",
        "field": "_dynamic_templates",
        "value": {
          "address": "geo_point"
        }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/672.console"></div>
<p>The set processor above tells ES to use the dynamic template named <code class="literal">geo_point</code>
for the field <code class="literal">address</code> if this field is not defined in the mapping of the index
yet. This processor overrides the dynamic template for the field <code class="literal">address</code> if
already defined in the bulk request, but has no effect on other dynamic
templates defined in the bulk request.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you <a class="xref" href="docs-index_.html#create-document-ids-automatically" title="Create document IDs automatically">automatically generate</a>
document IDs, you cannot use <code class="literal">{{{_id}}}</code> in a processor. Elasticsearch assigns
auto-generated <code class="literal">_id</code> values after ingest.</p>
</div>
</div>
<h3><a id="access-ingest-metadata"></a>Access ingest metadata in a processor<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Ingest processors can add and access ingest metadata using the <code class="literal">_ingest</code> key.</p>
<p>Unlike source and metadata fields, Elasticsearch does not index ingest metadata fields by
default. Elasticsearch also allows source fields that start with an <code class="literal">_ingest</code> key. If
your data includes such source fields, use <code class="literal">_source._ingest</code> to access them.</p>
<p>Pipelines only create the <code class="literal">_ingest.timestamp</code> ingest metadata field by default.
This field contains a timestamp of when Elasticsearch received the document&#8217;s indexing
request. To index <code class="literal">_ingest.timestamp</code> or other ingest metadata fields, use the
<code class="literal">set</code> processor.</p>
<a id="e47a71a2e314dbbee5db8142a23957ce"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "set": {
        "description": "Index the ingest timestamp as 'event.ingested'",
        "field": "event.ingested",
        "value": "{{{_ingest.timestamp}}}"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/673.console"></div>
<h3><a id="handling-pipeline-failures"></a>Handling pipeline failures<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>A pipeline&#8217;s processors run sequentially. By default, pipeline processing stops
when one of these processors fails or encounters an error.</p>
<p>To ignore a processor failure and run the pipeline&#8217;s remaining processors, set
<code class="literal">ignore_failure</code> to <code class="literal">true</code>.</p>
<a id="3d6935e04de21ab2f103e5b61cfd7a5b"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "rename": {
        "description": "Rename 'provider' to 'cloud.provider'",
        "field": "provider",
        "target_field": "cloud.provider",
        "ignore_failure": true
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/674.console"></div>
<p>Use the <code class="literal">on_failure</code> parameter to specify a list of processors to run
immediately after a processor failure. If <code class="literal">on_failure</code> is specified, Elasticsearch
afterward runs the pipeline&#8217;s remaining processors, even if the <code class="literal">on_failure</code>
configuration is empty.</p>
<a id="5e6419bc3e2db0d0f05bce58d8cc9215"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "rename": {
        "description": "Rename 'provider' to 'cloud.provider'",
        "field": "provider",
        "target_field": "cloud.provider",
        "on_failure": [
          {
            "set": {
              "description": "Set 'error.message'",
              "field": "error.message",
              "value": "Field 'provider' does not exist. Cannot rename to 'cloud.provider'",
              "override": false
            }
          }
        ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/675.console"></div>
<p>Nest a list of <code class="literal">on_failure</code> processors for nested error handling.</p>
<a id="f2c9afd052878b2ec00908739b0d0f74"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "rename": {
        "description": "Rename 'provider' to 'cloud.provider'",
        "field": "provider",
        "target_field": "cloud.provider",
        "on_failure": [
          {
            "set": {
              "description": "Set 'error.message'",
              "field": "error.message",
              "value": "Field 'provider' does not exist. Cannot rename to 'cloud.provider'",
              "override": false,
              "on_failure": [
                {
                  "set": {
                    "description": "Set 'error.message.multi'",
                    "field": "error.message.multi",
                    "value": "Document encountered multiple ingest errors",
                    "override": true
                  }
                }
              ]
            }
          }
        ]
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/676.console"></div>
<p>You can also specify <code class="literal">on_failure</code> for a pipeline. If a processor without an
<code class="literal">on_failure</code> value fails, Elasticsearch uses this pipeline-level parameter as a fallback.
Elasticsearch will not attempt to run the pipeline&#8217;s remaining processors.</p>
<a id="48b21c5aaf16b87f1a9b1a18a5d27cbd"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [ ... ],
  "on_failure": [
    {
      "set": {
        "description": "Index document to 'failed-&lt;index&gt;'",
        "field": "_index",
        "value": "failed-{{{ _index }}}"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/677.console"></div>
<p>Additional information about the pipeline failure may be available in the
document metadata fields <code class="literal">on_failure_message</code>, <code class="literal">on_failure_processor_type</code>,
<code class="literal">on_failure_processor_tag</code>, and <code class="literal">on_failure_pipeline</code>. These fields are
accessible only from within an <code class="literal">on_failure</code> block.</p>
<p>The following example uses the metadata fields to include information about
pipeline failures in documents.</p>
<a id="a0bcad37014cb534a720722c3cb3fefd"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [ ... ],
  "on_failure": [
    {
      "set": {
        "description": "Record error information",
        "field": "error_information",
        "value": "Processor {{ _ingest.on_failure_processor_type }} with tag {{ _ingest.on_failure_processor_tag }} in pipeline {{ _ingest.on_failure_pipeline }} failed with message {{ _ingest.on_failure_message }}"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/678.console"></div>
<h3><a id="conditionally-run-processor"></a>Conditionally run a processor<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Each processor supports an optional <code class="literal">if</code> condition, written as a
<a href="/guide/en/elasticsearch/painless/8.6/painless-guide.html" class="ulink" target="_top">Painless script</a>. If provided, the processor only
runs when the <code class="literal">if</code> condition is <code class="literal">true</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">if</code> condition scripts run in Painless&#8217;s
<a href="/guide/en/elasticsearch/painless/8.6/painless-ingest-processor-context.html" class="ulink" target="_top">ingest processor context</a>. In
<code class="literal">if</code> conditions, <code class="literal">ctx</code> values are read-only.</p>
</div>
</div>
<a id="afdb19ad1ebb4f64e235528b640817b6"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "drop": {
        "description": "Drop documents with 'network.name' of 'Guest'",
        "if": "ctx?.network?.name == 'Guest'"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/679.console"></div>
<p>If the <a class="xref" href="circuit-breaker.html#script-painless-regex-enabled"><code class="literal">script.painless.regex.enabled</code></a> cluster
setting is enabled, you can use regular expressions in your <code class="literal">if</code> condition
scripts. For supported syntax, see <a href="/guide/en/elasticsearch/painless/8.6/painless-regexes.html" class="ulink" target="_top">Painless
regular expressions</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If possible, avoid using regular expressions. Expensive regular expressions
can slow indexing speeds.</p>
</div>
</div>
<a id="2006f577a113bda40905cf7b405bf1cf"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "set": {
        "description": "If 'url.scheme' is 'http', set 'url.insecure' to true",
        "if": "ctx.url?.scheme =~ /^http[^s]/",
        "field": "url.insecure",
        "value": true
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/680.console"></div>
<p>You must specify <code class="literal">if</code> conditions as valid JSON on a single line. However, you
can use the <a href="/guide/en/kibana/8.6/console-kibana.html#configuring-console" class="ulink" target="_top">Kibana
console</a>'s triple quote syntax to write and debug larger scripts.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If possible, avoid using complex or expensive <code class="literal">if</code> condition scripts.
Expensive condition scripts can slow indexing speeds.</p>
</div>
</div>
<a id="fd04289c54493e19c1d3ac70d0b489c4"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "drop": {
        "description": "Drop documents that don't contain 'prod' tag",
        "if": """
            Collection tags = ctx.tags;
            if(tags != null){
              for (String tag : tags) {
                if (tag.toLowerCase().contains('prod')) {
                  return false;
                }
              }
            }
            return true;
        """
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/681.console"></div>
<p>You can also specify a <a class="xref" href="modules-scripting-stored-scripts.html" title="Stored scripts">stored script</a> as the
<code class="literal">if</code> condition.</p>
<a id="8b38eeb41eb388ee6d92f26b5c0cc48d"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _scripts/my-prod-tag-script
{
  "script": {
    "lang": "painless",
    "source": """
      Collection tags = ctx.tags;
      if(tags != null){
        for (String tag : tags) {
          if (tag.toLowerCase().contains('prod')) {
            return false;
          }
        }
      }
      return true;
    """
  }
}

PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "drop": {
        "description": "Drop documents that don't contain 'prod' tag",
        "if": { "id": "my-prod-tag-script" }
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/682.console"></div>
<p>Incoming documents often contain object fields. If a processor script attempts
to access a field whose parent object does not exist, Elasticsearch returns a
<code class="literal">NullPointerException</code>. To avoid these exceptions, use
<a href="/guide/en/elasticsearch/painless/8.6/painless-operators-reference.html#null-safe-operator" class="ulink" target="_top">null safe
operators</a>, such as <code class="literal">?.</code>, and write your scripts to be null safe.</p>
<p>For example, <code class="literal">ctx.network?.name.equalsIgnoreCase('Guest')</code> is not null safe.
<code class="literal">ctx.network?.name</code> can return null. Rewrite the script as
<code class="literal">'Guest'.equalsIgnoreCase(ctx.network?.name)</code>, which is null safe because
<code class="literal">Guest</code> is always non-null.</p>
<p>If you can&#8217;t rewrite a script to be null safe, include an explicit null check.</p>
<a id="c630a1f891aa9aa651f9982b832a42e1"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/my-pipeline
{
  "processors": [
    {
      "drop": {
        "description": "Drop documents that contain 'network.name' of 'Guest'",
        "if": "ctx.network?.name != null &amp;&amp; ctx.network.name.contains('Guest')"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/683.console"></div>
<h3><a id="conditionally-apply-pipelines"></a>Conditionally apply pipelines<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Combine an <code class="literal">if</code> condition with the <a class="xref" href="pipeline-processor.html" title="Pipeline processor"><code class="literal">pipeline</code></a> processor
to apply other pipelines to documents based on your criteria. You can use this
pipeline as the <a class="xref" href="ingest.html#set-default-pipeline" title="Set a default pipeline">default pipeline</a> in an
<a class="xref" href="index-templates.html" title="Index templates">index template</a> used to configure multiple data streams or
indices.</p>
<a id="b42e7d627cd79e4c5e7a4a3cd8b19ce0"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ingest/pipeline/one-pipeline-to-rule-them-all
{
  "processors": [
    {
      "pipeline": {
        "description": "If 'service.name' is 'apache_httpd', use 'httpd_pipeline'",
        "if": "ctx.service?.name == 'apache_httpd'",
        "name": "httpd_pipeline"
      }
    },
    {
      "pipeline": {
        "description": "If 'service.name' is 'syslog', use 'syslog_pipeline'",
        "if": "ctx.service?.name == 'syslog'",
        "name": "syslog_pipeline"
      }
    },
    {
      "fail": {
        "description": "If 'service.name' is not 'apache_httpd' or 'syslog', return a failure message",
        "if": "ctx.service?.name != 'apache_httpd' &amp;&amp; ctx.service?.name != 'syslog'",
        "message": "This pipeline requires service.name to be either `syslog` or `apache_httpd`"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/684.console"></div>
<h3><a id="get-pipeline-usage-stats"></a>Get pipeline usage statistics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.6/docs/reference/ingest.asciidoc">edit</a></h3>
<p>Use the <a class="xref" href="cluster-nodes-stats.html" title="Nodes stats API">node stats</a> API to get global and per-pipeline
ingest statistics. Use these stats to determine which pipelines run most
frequently or spend the most time processing.</p>
<a id="1fe2ed1d65c4774755de44c9b9d6ed67"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _nodes/stats/ingest?filter_path=nodes.*.ingest</pre>
</div>
<div class="console_widget" data-snippet="snippets/685.console"></div>
</div>
</div>



</div>
<div class="navfooter">
<span class="prev">
<a href="downsampling-ilm.html">« Run downsampling with ILM</a>
</span>
<span class="next">
<a href="common-log-format-example.html">Example: Parse logs in the Common Log Format »</a>
</span>
</div>
</div>
</body>
</html>
