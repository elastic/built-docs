<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Install Elasticsearch with Docker | Elasticsearch Guide [8.7] | Elastic</title>
<meta class="elastic" name="content" content="Install Elasticsearch with Docker | Elasticsearch Guide [8.7]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.7]"/>
<link rel="up" href="install-elasticsearch.html" title="Installing Elasticsearch"/>
<link rel="prev" href="rpm.html" title="Install Elasticsearch with RPM"/>
<link rel="next" href="run-elasticsearch-locally.html" title="Run Elasticsearch locally"/>
<meta class="elastic" name="product_version" content="8.7"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.7"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.7"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.7]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="install-elasticsearch.html">Installing Elasticsearch</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="rpm.html">« Install Elasticsearch with RPM</a>
</span>
<span class="next">
<a href="run-elasticsearch-locally.html">Run Elasticsearch locally »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docker"></a>Install Elasticsearch with Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch is also available as Docker images. A list of all published Docker
images and tags is available at
<a href="https://www.docker.elastic.co" class="ulink" target="_top">www.docker.elastic.co</a>. The source files are
in
<a href="https://github.com/elastic/elasticsearch/blob/8.7/distribution/docker" class="ulink" target="_top">Github</a>.</p>
<p>This package contains both free and subscription features.
<a class="xref" href="license-settings.html" title="License settings">Start a 30-day trial</a> to try out all of the features.</p>
<p>Starting in Elasticsearch 8.0, security is enabled by default. With security enabled,
Elastic Stack security features require TLS encryption for the transport networking
layer, or your cluster will fail to start.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_install_docker_desktop_or_docker_engine"></a>Install Docker Desktop or Docker Engine<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>Install the appropriate <a href="https://docs.docker.com/get-docker/" class="ulink" target="_top">Docker application</a>
for your operating system.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure that Docker is allotted at least 4GiB of memory. In Docker
Desktop, you configure resource usage on the Advanced tab in Preference (macOS)
or Settings (Windows).</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_pull_the_elasticsearch_docker_image"></a>Pull the Elasticsearch Docker image<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>Obtaining Elasticsearch for Docker is as simple as issuing a <code class="literal">docker pull</code> command
against the Elastic Docker registry.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker pull docker.elastic.co/elasticsearch/elasticsearch:8.7.1</pre>
</div>
<p>Now that you have the Elasticsearch Docker image, you can start a
<a class="xref" href="docker.html#docker-cli-run-dev-mode" title="Start a single-node cluster with Docker">single-node</a> or <a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">multi-node</a>
cluster.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-cli-run-dev-mode"></a>Start a single-node cluster with Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>If you&#8217;re starting a single-node Elasticsearch cluster in a Docker container, security
will be automatically enabled and configured for you. When you start Elasticsearch for
the first time, the following security configuration occurs automatically:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="docker.html#elasticsearch-security-certificates" title="Security certificates and keys">Certificates and keys</a> are generated
for the transport and HTTP layers.
</li>
<li class="listitem">
The Transport Layer Security (TLS) configuration settings are written to
<code class="literal">elasticsearch.yml</code>.
</li>
<li class="listitem">
A password is generated for the <code class="literal">elastic</code> user.
</li>
<li class="listitem">
An enrollment token is generated for Kibana.
</li>
</ul>
</div>
<p>You can then <a href="/guide/en/kibana/8.7/docker.html" class="ulink" target="_top">start Kibana</a> and enter the enrollment
token, which is valid for 30 minutes. This token automatically applies the
security settings from your Elasticsearch cluster, authenticates to Elasticsearch with the
<code class="literal">kibana_system</code> user, and writes the security configuration to <code class="literal">kibana.yml</code>.</p>
<p>The following commands start a single-node Elasticsearch cluster for development or
testing.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create a new docker network for Elasticsearch and Kibana</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker network create elastic</pre>
</div>
</li>
<li class="listitem">
<p>Start Elasticsearch in Docker. A password is generated for the <code class="literal">elastic</code> user and
output to the terminal, plus an enrollment token for enrolling Kibana.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run --name es01 --net elastic -p 9200:9200 -it docker.elastic.co/elasticsearch/elasticsearch:8.7.1</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You might need to scroll back a bit in the terminal to view the password
and enrollment token.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Copy the generated password and enrollment token and save them in a secure
location. These values are shown only when you start Elasticsearch for the first time.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you need to reset the password for the <code class="literal">elastic</code> user or other
built-in users, run the <a class="xref" href="reset-password.html" title="elasticsearch-reset-password"><code class="literal">elasticsearch-reset-password</code></a> tool.
This tool is available in the Elasticsearch <code class="literal">/bin</code> directory of the Docker container.
For example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-reset-password</pre>
</div>
</div>
</div>
</li>
<li class="listitem">
<p>Copy the <code class="literal">http_ca.crt</code> security certificate from your Docker container to
your local machine.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker cp es01:/usr/share/elasticsearch/config/certs/http_ca.crt .</pre>
</div>
</li>
<li class="listitem">
<p>Open a new terminal and verify that you can connect to your Elasticsearch cluster by
making an authenticated call, using the <code class="literal">http_ca.crt</code> file that you copied from
your Docker container. Enter the password for the <code class="literal">elastic</code> user when prompted.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl --cacert http_ca.crt -u elastic https://localhost:9200</pre>
</div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_enroll_additional_nodes"></a>Enroll additional nodes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>When you start Elasticsearch for the first time, the installation process configures a single-node cluster by default. This process also generates an enrollment token
and prints it to your terminal. If you want a node to join an existing cluster,
start the new node with the generated enrollment token.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Generating enrollment tokens</strong></p>
</div></div></div>
<p>The enrollment token is valid for 30 minutes. If you need to generate a
new enrollment token, run the
<a class="xref" href="create-enrollment-token.html" title="elasticsearch-create-enrollment-token"><code class="literal">elasticsearch-create-enrollment-token</code></a> tool on your
existing node. This tool is available in the Elasticsearch <code class="literal">bin</code> directory of the Docker
container.</p>
<p>For example, run the following command on the existing <code class="literal">es01</code> node to
generate an enrollment token for new Elasticsearch nodes:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker exec -it es01 /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node</pre>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In the terminal where you started your first node, copy the generated
enrollment token for adding new Elasticsearch nodes.
</li>
<li class="listitem">
<p>On your new node, start Elasticsearch and include the generated enrollment token.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -e ENROLLMENT_TOKEN="&lt;token&gt;" --name es02 --net elastic -it docker.elastic.co/elasticsearch/elasticsearch:8.7.1</pre>
</div>
<p>Elasticsearch is now configured to join the existing cluster.</p>
</li>
</ol>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_setting_jvm_heap_size"></a>Setting JVM heap size<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>If you experience issues where the container where your first node is running
exits when your second node starts, explicitly set values for the JVM heap size.
To <a class="xref" href="advanced-configuration.html#set-jvm-heap-size" title="Set the JVM heap size">manually configure the heap size</a>, include the
<code class="literal">ES_JAVA_OPTS</code> variable and set values for <code class="literal">-Xms</code> and <code class="literal">-Xmx</code> when starting each
node. For example, the following command starts node <code class="literal">es02</code> and sets the
minimum and maximum JVM heap size to 1 GB:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -e ES_JAVA_OPTS="-Xms1g -Xmx1g" -e ENROLLMENT_TOKEN="&lt;token&gt;" --name es02 -p 9201:9200 --net elastic -it docker.elastic.co/elasticsearch/elasticsearch:8.7.1</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_next_steps_5"></a>Next steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You now have a test Elasticsearch environment set up. Before you start
serious development or go into production with Elasticsearch, review the
<a class="xref" href="docker.html#docker-prod-prerequisites" title="Using the Docker images in production">requirements and recommendations</a> to apply when running Elasticsearch in Docker in production.</p>
</div>

<div class="section exclude">
<div class="titlepage"><div><div>
<h4 class="title"><a id="elasticsearch-security-certificates"></a>Security certificates and keys<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/security-files-reference.asciidoc">edit</a></h4>
</div></div></div>
<p>When you install Elasticsearch, the following certificates and keys are
generated in the Elasticsearch configuration directory, which are used to connect a Kibana
instance to your secured Elasticsearch cluster and to encrypt internode communication.
The files are listed here for reference.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">http_ca.crt</code>
</span>
</dt>
<dd>
The CA certificate that is used to sign the certificates for the HTTP layer of
this Elasticsearch cluster.
</dd>
<dt>
<span class="term">
<code class="literal">http.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the HTTP layer for this node.
</dd>
<dt>
<span class="term">
<code class="literal">transport.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the transport layer for all
the nodes in your cluster.
</dd>
</dl>
</div>
<p><code class="literal">http.p12</code> and <code class="literal">transport.p12</code> are password-protected PKCS#12 keystores. Elasticsearch
stores the passwords for these keystores as <a class="xref" href="secure-settings.html" title="Secure settings">secure
settings</a>. To retrieve the passwords so that you can inspect or change the
keystore contents, use the
<a class="xref" href="elasticsearch-keystore.html" title="elasticsearch-keystore"><code class="literal">bin/elasticsearch-keystore</code></a> tool.</p>
<p>Use the following command to retrieve the password for <code class="literal">http.p12</code>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">bin/elasticsearch-keystore show xpack.security.http.ssl.keystore.secure_password</pre>
</div>
<p>Use the following command to retrieve the password for <code class="literal">transport.p12</code>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">bin/elasticsearch-keystore show xpack.security.transport.ssl.keystore.secure_password</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-compose-file"></a>Start a multi-node cluster with Docker Compose<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>To get a multi-node Elasticsearch cluster and Kibana up and running in Docker with
security enabled, you can use Docker Compose.</p>
<p>This configuration provides a simple method of starting a secured cluster that
you can use for development before building a distributed deployment with
multiple hosts.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prerequisites"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Install the appropriate <a href="https://docs.docker.com/get-docker/" class="ulink" target="_top">Docker application</a>
for your operating system.</p>
<p>If you&#8217;re running on Linux, install <a href="https://docs.docker.com/compose/install/" class="ulink" target="_top">Docker Compose</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure that Docker is allotted at least 4GB of memory. In Docker Desktop,
you configure resource usage on the Advanced tab in Preferences (macOS) or
Settings (Windows).</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_the_environment"></a>Prepare the environment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Create the following configuration files in a new, empty directory. These files
are also available from the
<a href="https://github.com/elastic/elasticsearch/tree/master/docs/reference/setup/install/docker" class="ulink" target="_top">elasticsearch</a>
repository on GitHub.</p>

<h5><a id="docker-env-file"></a><code class="literal">.env</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
<p>The <code class="literal">.env</code> file sets environment variables that are used when you run the
<code class="literal">docker-compose.yml</code> configuration file. Ensure that you specify a strong
password for the <code class="literal">elastic</code> and <code class="literal">kibana_system</code> users with the
<code class="literal">ELASTIC_PASSWORD</code> and <code class="literal">KIBANA_PASSWORD</code> variables. These variable are
referenced by the <code class="literal">docker-compose.yml</code> file.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Your passwords must be alphanumeric, and cannot contain special
characters such as <code class="literal">!</code> or <code class="literal">@</code>. The <code class="literal">bash</code> script included in the
<code class="literal">docker-compose.yml</code> file only operates on alphanumeric characters.</p>
</div>
</div>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt"># Password for the 'elastic' user (at least 6 characters)
ELASTIC_PASSWORD=

# Password for the 'kibana_system' user (at least 6 characters)
KIBANA_PASSWORD=

# Version of Elastic products
STACK_VERSION=8.7.1

# Set the cluster name
CLUSTER_NAME=docker-cluster

# Set to 'basic' or 'trial' to automatically start the 30-day trial
LICENSE=basic
#LICENSE=trial

# Port to expose Elasticsearch HTTP API to the host
ES_PORT=9200
#ES_PORT=127.0.0.1:9200

# Port to expose Kibana to the host
KIBANA_PORT=5601
#KIBANA_PORT=80

# Increase or decrease based on the available host memory (in bytes)
MEM_LIMIT=1073741824

# Project namespace (defaults to the current folder name if not set)
#COMPOSE_PROJECT_NAME=myproject</pre>
</div>
<h5><a id="docker-file"></a><code class="literal">docker-compose.yml</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
<p>This <code class="literal">docker-compose.yml</code> file creates a three-node secure Elasticsearch cluster with authentication and network encryption enabled, and a Kibana instance securely connected to it.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Exposing ports</strong></p>
</div></div></div>
<p>This configuration exposes port <code class="literal">9200</code> on all network interfaces. Because
of how Docker handles ports, a port that isn&#8217;t bound to <code class="literal">localhost</code> leaves your
Elasticsearch cluster publicly accessible, potentially ignoring any firewall settings.
If you don&#8217;t want to expose port <code class="literal">9200</code> to external hosts, set the value for
<code class="literal">ES_PORT</code> in the <code class="literal">.env</code> file to something like <code class="literal">127.0.0.1:9200</code>. Elasticsearch will
then only be accessible from the host machine itself.</p>
</div>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">version: "2.2"

services:
  setup:
    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}
    volumes:
      - certs:/usr/share/elasticsearch/config/certs
    user: "0"
    command: &gt;
      bash -c '
        if [ x${ELASTIC_PASSWORD} == x ]; then
          echo "Set the ELASTIC_PASSWORD environment variable in the .env file";
          exit 1;
        elif [ x${KIBANA_PASSWORD} == x ]; then
          echo "Set the KIBANA_PASSWORD environment variable in the .env file";
          exit 1;
        fi;
        if [ ! -f config/certs/ca.zip ]; then
          echo "Creating CA";
          bin/elasticsearch-certutil ca --silent --pem -out config/certs/ca.zip;
          unzip config/certs/ca.zip -d config/certs;
        fi;
        if [ ! -f config/certs/certs.zip ]; then
          echo "Creating certs";
          echo -ne \
          "instances:\n"\
          "  - name: es01\n"\
          "    dns:\n"\
          "      - es01\n"\
          "      - localhost\n"\
          "    ip:\n"\
          "      - 127.0.0.1\n"\
          "  - name: es02\n"\
          "    dns:\n"\
          "      - es02\n"\
          "      - localhost\n"\
          "    ip:\n"\
          "      - 127.0.0.1\n"\
          "  - name: es03\n"\
          "    dns:\n"\
          "      - es03\n"\
          "      - localhost\n"\
          "    ip:\n"\
          "      - 127.0.0.1\n"\
          &gt; config/certs/instances.yml;
          bin/elasticsearch-certutil cert --silent --pem -out config/certs/certs.zip --in config/certs/instances.yml --ca-cert config/certs/ca/ca.crt --ca-key config/certs/ca/ca.key;
          unzip config/certs/certs.zip -d config/certs;
        fi;
        echo "Setting file permissions"
        chown -R root:root config/certs;
        find . -type d -exec chmod 750 \{\} \;;
        find . -type f -exec chmod 640 \{\} \;;
        echo "Waiting for Elasticsearch availability";
        until curl -s --cacert config/certs/ca/ca.crt https://es01:9200 | grep -q "missing authentication credentials"; do sleep 30; done;
        echo "Setting kibana_system password";
        until curl -s -X POST --cacert config/certs/ca/ca.crt -u "elastic:${ELASTIC_PASSWORD}" -H "Content-Type: application/json" https://es01:9200/_security/user/kibana_system/_password -d "{\"password\":\"${KIBANA_PASSWORD}\"}" | grep -q "^{}"; do sleep 10; done;
        echo "All done!";
      '
    healthcheck:
      test: ["CMD-SHELL", "[ -f config/certs/es01/es01.crt ]"]
      interval: 1s
      timeout: 5s
      retries: 120

  es01:
    depends_on:
      setup:
        condition: service_healthy
    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}
    volumes:
      - certs:/usr/share/elasticsearch/config/certs
      - esdata01:/usr/share/elasticsearch/data
    ports:
      - ${ES_PORT}:9200
    environment:
      - node.name=es01
      - cluster.name=${CLUSTER_NAME}
      - cluster.initial_master_nodes=es01,es02,es03
      - discovery.seed_hosts=es02,es03
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
      - bootstrap.memory_lock=true
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=certs/es01/es01.key
      - xpack.security.http.ssl.certificate=certs/es01/es01.crt
      - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.key=certs/es01/es01.key
      - xpack.security.transport.ssl.certificate=certs/es01/es01.crt
      - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.verification_mode=certificate
      - xpack.license.self_generated.type=${LICENSE}
    mem_limit: ${MEM_LIMIT}
    ulimits:
      memlock:
        soft: -1
        hard: -1
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

  es02:
    depends_on:
      - es01
    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}
    volumes:
      - certs:/usr/share/elasticsearch/config/certs
      - esdata02:/usr/share/elasticsearch/data
    environment:
      - node.name=es02
      - cluster.name=${CLUSTER_NAME}
      - cluster.initial_master_nodes=es01,es02,es03
      - discovery.seed_hosts=es01,es03
      - bootstrap.memory_lock=true
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=certs/es02/es02.key
      - xpack.security.http.ssl.certificate=certs/es02/es02.crt
      - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.key=certs/es02/es02.key
      - xpack.security.transport.ssl.certificate=certs/es02/es02.crt
      - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.verification_mode=certificate
      - xpack.license.self_generated.type=${LICENSE}
    mem_limit: ${MEM_LIMIT}
    ulimits:
      memlock:
        soft: -1
        hard: -1
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

  es03:
    depends_on:
      - es02
    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}
    volumes:
      - certs:/usr/share/elasticsearch/config/certs
      - esdata03:/usr/share/elasticsearch/data
    environment:
      - node.name=es03
      - cluster.name=${CLUSTER_NAME}
      - cluster.initial_master_nodes=es01,es02,es03
      - discovery.seed_hosts=es01,es02
      - bootstrap.memory_lock=true
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=certs/es03/es03.key
      - xpack.security.http.ssl.certificate=certs/es03/es03.crt
      - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.key=certs/es03/es03.key
      - xpack.security.transport.ssl.certificate=certs/es03/es03.crt
      - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.verification_mode=certificate
      - xpack.license.self_generated.type=${LICENSE}
    mem_limit: ${MEM_LIMIT}
    ulimits:
      memlock:
        soft: -1
        hard: -1
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

  kibana:
    depends_on:
      es01:
        condition: service_healthy
      es02:
        condition: service_healthy
      es03:
        condition: service_healthy
    image: docker.elastic.co/kibana/kibana:${STACK_VERSION}
    volumes:
      - certs:/usr/share/kibana/config/certs
      - kibanadata:/usr/share/kibana/data
    ports:
      - ${KIBANA_PORT}:5601
    environment:
      - SERVERNAME=kibana
      - ELASTICSEARCH_HOSTS=https://es01:9200
      - ELASTICSEARCH_USERNAME=kibana_system
      - ELASTICSEARCH_PASSWORD=${KIBANA_PASSWORD}
      - ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES=config/certs/ca/ca.crt
    mem_limit: ${MEM_LIMIT}
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "curl -s -I http://localhost:5601 | grep -q 'HTTP/1.1 302 Found'",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

volumes:
  certs:
    driver: local
  esdata01:
    driver: local
  esdata02:
    driver: local
  esdata03:
    driver: local
  kibanadata:
    driver: local</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_start_your_cluster_with_security_enabled_and_configured"></a>Start your cluster with security enabled and configured<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Modify the <code class="literal">.env</code> file and enter strong password values for both the
<code class="literal">ELASTIC_PASSWORD</code> and <code class="literal">KIBANA_PASSWORD</code> variables.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must use the <code class="literal">ELASTIC_PASSWORD</code> value for further interactions with
the cluster. The <code class="literal">KIBANA_PASSWORD</code> value is only used internally when
configuring Kibana.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Create and start the three-node Elasticsearch cluster and Kibana instance:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker-compose up -d</pre>
</div>
</li>
<li class="listitem">
When the deployment has started, open a browser and navigate to <a href="http://localhost:5601" class="ulink" target="_top">http://localhost:5601</a> to
access Kibana, where you can load sample data and interact with your cluster.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_stop_and_remove_the_deployment"></a>Stop and remove the deployment<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>To stop the cluster, run <code class="literal">docker-compose down</code>. The data in the Docker volumes
is preserved and loaded when you restart the cluster with <code class="literal">docker-compose up</code>.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker-compose down</pre>
</div>
<p>To <span class="strong strong"><strong>delete</strong></span> the network, containers, and volumes when you stop the cluster,
specify the <code class="literal">-v</code> option:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker-compose down -v</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_next_steps_6"></a>Next steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You now have a test Elasticsearch environment set up. Before you start
serious development or go into production with Elasticsearch, review the
<a class="xref" href="docker.html#docker-prod-prerequisites" title="Using the Docker images in production">requirements and recommendations</a> to apply when running Elasticsearch in Docker in production.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-prod-prerequisites"></a>Using the Docker images in production<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>The following requirements and recommendations apply when running Elasticsearch in Docker in production.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_set_vm_max_map_count_to_at_least_262144"></a>Set <code class="literal">vm.max_map_count</code> to at least <code class="literal">262144</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> kernel setting must be set to at least <code class="literal">262144</code> for production use.</p>
<p>How you set <code class="literal">vm.max_map_count</code> depends on your platform.</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_linux"></a>Linux<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
</div></div></div>
<p>To view the current value for the <code class="literal">vm.max_map_count</code> setting, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">grep vm.max_map_count /etc/sysctl.conf
vm.max_map_count=262144</pre>
</div>
<p>To apply the setting on a live system, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sysctl -w vm.max_map_count=262144</pre>
</div>
<p>To permanently change the value for the <code class="literal">vm.max_map_count</code> setting, update the
value in <code class="literal">/etc/sysctl.conf</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_macos_with_docker_for_mac"></a>macOS with <a href="https://docs.docker.com/docker-for-mac" class="ulink" target="_top">Docker for Mac</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> setting must be set within the xhyve virtual machine:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the command line, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">screen ~/Library/Containers/com.docker.docker/Data/vms/0/tty</pre>
</div>
</li>
<li class="listitem">
<p>Press enter and use <code class="literal">sysctl</code> to configure <code class="literal">vm.max_map_count</code>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">sysctl -w vm.max_map_count=262144</pre>
</div>
</li>
<li class="listitem">
To exit the <code class="literal">screen</code> session, type <code class="literal">Ctrl a d</code>.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_windows_and_macos_with_docker_desktop"></a>Windows and macOS with <a href="https://www.docker.com/products/docker-desktop" class="ulink" target="_top">Docker Desktop</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> setting must be set via docker-machine:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker-machine ssh
sudo sysctl -w vm.max_map_count=262144</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_windows_with_docker_desktop_wsl_2_backend"></a>Windows with <a href="https://docs.docker.com/docker-for-windows/wsl" class="ulink" target="_top">Docker Desktop WSL 2 backend</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> setting must be set in the "docker-desktop" WSL instance before the
ElasticSearch container will properly start. There are several ways to do this, depending
on your version of Windows and your version of WSL.</p>
<p>If you are on Windows 10 before version 22H2, or if you are on Windows 10 version 22H2 using the
built-in version of WSL, you must either manually set it every time you restart Docker before starting
your ElasticSearch container, or (if you do not wish to do so on every restart) you must globally set
every WSL2 instance to have the <code class="literal">vm.max_map_count</code> changed. This is because these versions of WSL
do not properly process the /etc/sysctl.conf file.</p>
<p>To manually set it every time you reboot, you must run the following commands in a command prompt
or PowerShell window every time you restart Docker:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">wsl -d docker-desktop -u root
sysctl -w vm.max_map_count=262144</pre>
</div>
<p>If you are on these versions of WSL and you do not want to have to run those commands every
time you restart Docker, you can globally change every WSL distribution with this setting
by modifying your %USERPROFILE%\.wslconfig as follows:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">[wsl2]
kernelCommandLine = "sysctl.vm.max_map_count=262144"</pre>
</div>
<p>This will cause all WSL2 VMs to have that setting assigned when they start.</p>
<p>If you are on Windows 11, or Windows 10 version 22H2 and have installed the Microsoft Store
version of WSL, you can modify the /etc/sysctl.conf within the "docker-desktop" WSL
distribution, perhaps with commands like this:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">wsl -d docker-desktop -u root
vi /etc/sysctl.conf</pre>
</div>
<p>and appending a line which reads:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">vm.max_map_count = 262144</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_configuration_files_must_be_readable_by_the_elasticsearch_user"></a>Configuration files must be readable by the <code class="literal">elasticsearch</code> user<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch runs inside the container as user <code class="literal">elasticsearch</code> using
uid:gid <code class="literal">1000:0</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>One exception is <a href="https://docs.openshift.com/container-platform/3.6/creating_images/guidelines.html#openshift-specific-guidelines" class="ulink" target="_top">Openshift</a>,
which runs containers using an arbitrarily assigned user ID.
Openshift presents persistent volumes with the gid set to <code class="literal">0</code>, which works without any adjustments.</p>
</div>
</div>
<p>If you are bind-mounting a local directory or file, it must be readable by the <code class="literal">elasticsearch</code> user.
In addition, this user must have write access to the <a class="xref" href="important-settings.html#path-settings" title="Path settings">config, data and log dirs</a>
(Elasticsearch needs write access to the <code class="literal">config</code> directory so that it can generate a keystore).
A good strategy is to grant group access to gid <code class="literal">0</code> for the local directory.</p>
<p>For example, to prepare a local directory for storing data through a bind-mount:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">mkdir esdatadir
chmod g+rwx esdatadir
chgrp 0 esdatadir</pre>
</div>
<p>You can also run an Elasticsearch container using both a custom UID and GID. You
must ensure that file permissions will not prevent Elasticsearch from executing. You
can use one of two options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Bind-mount the <code class="literal">config</code>, <code class="literal">data</code> and <code class="literal">logs</code>
directories. If you intend to install plugins and prefer not to
<a class="xref" href="docker.html#_c_customized_image" title="Using custom Docker images">create a custom Docker image</a>, you must also
bind-mount the <code class="literal">plugins</code> directory.
</li>
<li class="listitem">
Pass the <code class="literal">--group-add 0</code> command line option to <code class="literal">docker run</code>. This
ensures that the user under which Elasticsearch is running is also a member of the
<code class="literal">root</code> (GID 0) group inside the container.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_increase_ulimits_for_nofile_and_nproc"></a>Increase ulimits for nofile and nproc<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Increased ulimits for <a class="xref" href="setting-system-settings.html" title="Configuring system settings">nofile</a> and <a class="xref" href="max-number-threads-check.html" title="Maximum number of threads check">nproc</a>
must be available for the Elasticsearch containers.
Verify the <a href="https://github.com/moby/moby/tree/ea4d1243953e6b652082305a9c3cda8656edab26/contrib/init" class="ulink" target="_top">init system</a>
for the Docker daemon sets them to acceptable values.</p>
<p>To check the Docker daemon defaults for ulimits, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run --rm docker.elastic.co/elasticsearch/elasticsearch:{version} /bin/bash -c 'ulimit -Hn &amp;&amp; ulimit -Sn &amp;&amp; ulimit -Hu &amp;&amp; ulimit -Su'</pre>
</div>
<p>If needed, adjust them in the Daemon or override them per container.
For example, when using <code class="literal">docker run</code>, set:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">--ulimit nofile=65535:65535</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_disable_swapping"></a>Disable swapping<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Swapping needs to be disabled for performance and node stability.
For information about ways to do this, see <a class="xref" href="setup-configuration-memory.html" title="Disable swapping">Disable swapping</a>.</p>
<p>If you opt for the <code class="literal">bootstrap.memory_lock: true</code> approach,
you also need to define the <code class="literal">memlock: true</code> ulimit in the
<a href="https://docs.docker.com/engine/reference/commandline/dockerd/#default-ulimits" class="ulink" target="_top">Docker Daemon</a>,
or explicitly set for the container as shown in the  <a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">sample compose file</a>.
When using <code class="literal">docker run</code>, you can specify:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">-e "bootstrap.memory_lock=true" --ulimit memlock=-1:-1</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_randomize_published_ports"></a>Randomize published ports<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>The image <a href="https://docs.docker.com/engine/reference/builder/#/expose" class="ulink" target="_top">exposes</a>
TCP ports 9200 and 9300. For production clusters, randomizing the
published ports with <code class="literal">--publish-all</code> is recommended,
unless you are pinning one container per host.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-set-heap-size"></a>Manually set the heap size<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch automatically sizes JVM heap based on a nodes&#8217;s
<a class="xref" href="modules-node.html#node-roles" title="Node roles">roles</a> and the total memory available to the node&#8217;s container. We
recommend this default sizing for most production environments. If needed, you
can override default sizing by manually setting JVM heap size.</p>
<p>To manually set the heap size in production, bind mount a <a class="xref" href="advanced-configuration.html#set-jvm-options" title="Set JVM options">JVM
options</a> file under <code class="literal">/usr/share/elasticsearch/config/jvm.options.d</code> that
includes your desired <a class="xref" href="advanced-configuration.html#set-jvm-heap-size" title="Set the JVM heap size">heap size</a> settings.</p>
<p>For testing, you can also manually set the heap size using the <code class="literal">ES_JAVA_OPTS</code>
environment variable. For example, to use 16GB, specify <code class="literal">-e
ES_JAVA_OPTS="-Xms16g -Xmx16g"</code> with <code class="literal">docker run</code>. The <code class="literal">ES_JAVA_OPTS</code> variable
overrides all other JVM options. We do not recommend using <code class="literal">ES_JAVA_OPTS</code> in
production. The <code class="literal">docker-compose.yml</code> file above sets the heap size to 512MB.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_pin_deployments_to_a_specific_image_version"></a>Pin deployments to a specific image version<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Pin your deployments to a specific version of the Elasticsearch Docker image. For
example <code class="literal">docker.elastic.co/elasticsearch/elasticsearch:8.7.1</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_always_bind_data_volumes"></a>Always bind data volumes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You should use a volume bound on <code class="literal">/usr/share/elasticsearch/data</code> for the following reasons:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
The data of your Elasticsearch node won&#8217;t be lost if the container is killed
</li>
<li class="listitem">
Elasticsearch is I/O sensitive and the Docker storage driver is not ideal for fast I/O
</li>
<li class="listitem">
It allows the use of advanced
<a href="https://docs.docker.com/engine/extend/plugins/#volume-plugins" class="ulink" target="_top">Docker volume plugins</a>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_avoid_using_loop_lvm_mode"></a>Avoid using <code class="literal">loop-lvm</code> mode<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>If you are using the devicemapper storage driver, do not use the default <code class="literal">loop-lvm</code> mode.
Configure docker-engine to use
<a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-docker-with-devicemapper" class="ulink" target="_top">direct-lvm</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_centralize_your_logs"></a>Centralize your logs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Consider centralizing your logs by using a different
<a href="https://docs.docker.com/engine/admin/logging/overview/" class="ulink" target="_top">logging driver</a>. Also
note that the default json-file logging driver is not ideally suited for
production use.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-configuration-methods"></a>Configuring Elasticsearch with Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>When you run in Docker, the <a class="xref" href="settings.html#config-files-location" title="Config files location">Elasticsearch configuration files</a> are loaded from
<code class="literal">/usr/share/elasticsearch/config/</code>.</p>
<p>To use custom configuration files, you <a class="xref" href="docker.html#docker-config-bind-mount" title="Mounting Elasticsearch configuration files">bind-mount the files</a>
over the configuration files in the image.</p>
<p>You can set individual Elasticsearch configuration parameters using Docker environment variables.
The <a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">sample compose file</a> and the
<a class="xref" href="docker.html#docker-cli-run-dev-mode" title="Start a single-node cluster with Docker">single-node example</a> use this method. You can
use the setting name directly as the environment variable name. If
you cannot do this, for example because your orchestration platform forbids
periods in environment variable names, then you can use an alternative
style by converting the setting name as follows.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Change the setting name to uppercase
</li>
<li class="listitem">
Prefix it with <code class="literal">ES_SETTING_</code>
</li>
<li class="listitem">
Escape any underscores (<code class="literal">_</code>) by duplicating them
</li>
<li class="listitem">
Convert all periods (<code class="literal">.</code>) to underscores (<code class="literal">_</code>)
</li>
</ol>
</div>
<p>For example, <code class="literal">-e bootstrap.memory_lock=true</code> becomes
<code class="literal">-e ES_SETTING_BOOTSTRAP_MEMORY__LOCK=true</code>.</p>
<p>You can use the contents of a file to set the value of the
<code class="literal">ELASTIC_PASSWORD</code> or <code class="literal">KEYSTORE_PASSWORD</code> environment variables, by
suffixing the environment variable name with <code class="literal">_FILE</code>. This is useful for
passing secrets such as passwords to Elasticsearch without specifying them directly.</p>
<p>For example, to set the Elasticsearch bootstrap password from a file, you can bind mount the
file and set the <code class="literal">ELASTIC_PASSWORD_FILE</code> environment variable to the mount location.
If you mount the password file to <code class="literal">/run/secrets/bootstrapPassword.txt</code>, specify:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">-e ELASTIC_PASSWORD_FILE=/run/secrets/bootstrapPassword.txt</pre>
</div>
<p>You can override the default command for the image to pass Elasticsearch configuration
parameters as command line options. For example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run &lt;various parameters&gt; bin/elasticsearch -Ecluster.name=mynewclustername</pre>
</div>
<p>While bind-mounting your configuration files is usually the preferred method in production,
you can also <a class="xref" href="docker.html#_c_customized_image" title="Using custom Docker images">create a custom Docker image</a>
that contains your configuration.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-config-bind-mount"></a>Mounting Elasticsearch configuration files<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Create custom config files and bind-mount them over the corresponding files in the Docker image.
For example, to bind-mount <code class="literal">custom_elasticsearch.yml</code> with <code class="literal">docker run</code>, specify:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">-v full_path_to/custom_elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</pre>
</div>
<p>If you bind-mount a custom <code class="literal">elasticsearch.yml</code> file, ensure it includes the
<code class="literal">network.host: 0.0.0.0</code> setting. This setting ensures the node is reachable for
HTTP and transport traffic, provided its ports are exposed. The Docker image&#8217;s
built-in <code class="literal">elasticsearch.yml</code> file includes this setting by default.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The container <span class="strong strong"><strong>runs Elasticsearch as user <code class="literal">elasticsearch</code> using
uid:gid <code class="literal">1000:0</code></strong></span>. Bind mounted host directories and files must be accessible by this user,
and the data and log directories must be writable by this user.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-keystore-bind-mount"></a>Create an encrypted Elasticsearch keystore<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch will auto-generate a keystore file for <a class="xref" href="secure-settings.html" title="Secure settings">secure
settings</a>. This file is obfuscated but not encrypted.</p>
<p>To encrypt your secure settings with a password and have them persist outside
the container, use a <code class="literal">docker run</code> command to manually create the keystore
instead. The command must:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Bind-mount the <code class="literal">config</code> directory. The command will create an
<code class="literal">elasticsearch.keystore</code> file in this directory. To avoid errors, do
not directly bind-mount the <code class="literal">elasticsearch.keystore</code> file.
</li>
<li class="listitem">
Use the <code class="literal">elasticsearch-keystore</code> tool with the <code class="literal">create -p</code> option. You&#8217;ll be
prompted to enter a password for the keystore.
</li>
</ul>
</div>
<p>For example:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -it --rm \
-v full_path_to/config:/usr/share/elasticsearch/config \
docker.elastic.co/elasticsearch/elasticsearch:8.7.1 \
bin/elasticsearch-keystore create -p</pre>
</div>
<p>You can also use a <code class="literal">docker run</code> command to add or update secure settings in the
keystore. You&#8217;ll be prompted to enter the setting values. If the keystore is
encrypted, you&#8217;ll also be prompted to enter the keystore password.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -it --rm \
-v full_path_to/config:/usr/share/elasticsearch/config \
docker.elastic.co/elasticsearch/elasticsearch:8.7.1 \
bin/elasticsearch-keystore \
add my.secure.setting \
my.other.secure.setting</pre>
</div>
<p>If you&#8217;ve already created the keystore and don&#8217;t need to update it, you can
bind-mount the <code class="literal">elasticsearch.keystore</code> file directly. You can use the
<code class="literal">KEYSTORE_PASSWORD</code> environment variable to provide the keystore password to the
container at startup. For example, a <code class="literal">docker run</code> command might have the
following options:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">-v full_path_to/config/elasticsearch.keystore:/usr/share/elasticsearch/config/elasticsearch.keystore
-e KEYSTORE_PASSWORD=mypassword</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_c_customized_image"></a>Using custom Docker images<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>In some environments, it might make more sense to prepare a custom image that contains
your configuration. A <code class="literal">Dockerfile</code> to achieve this might be as simple as:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">FROM docker.elastic.co/elasticsearch/elasticsearch:8.7.1
COPY --chown=elasticsearch:elasticsearch elasticsearch.yml /usr/share/elasticsearch/config/</pre>
</div>
<p>You could then build and run the image with:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker build --tag=elasticsearch-custom .
docker run -ti -v /usr/share/elasticsearch/data elasticsearch-custom</pre>
</div>
<p>Some plugins require additional security permissions.
You must explicitly accept them either by:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Attaching a <code class="literal">tty</code> when you run the Docker image and allowing the permissions when prompted.
</li>
<li class="listitem">
Inspecting the security permissions and accepting them (if appropriate) by adding the <code class="literal">--batch</code> flag to the plugin install command.
</li>
</ul>
</div>
<p>See <a href="/guide/en/elasticsearch/plugins/8.7/_other_command_line_parameters.html" class="ulink" target="_top">Plugin management</a>
for more information.</p>
<h4><a id="troubleshoot-docker-errors"></a>Troubleshoot Docker errors for Elasticsearch<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
<p>Here’s how to resolve common errors when running Elasticsearch with Docker.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_elasticsearch_keystore_is_a_directory"></a>elasticsearch.keystore is a directory<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Exception in thread "main" org.elasticsearch.bootstrap.BootstrapException: java.io.IOException: Is a directory: SimpleFSIndexInput(path="/usr/share/elasticsearch/config/elasticsearch.keystore") Likely root cause: java.io.IOException: Is a directory</pre>
</div>
<p>A <a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">keystore-related</a> <code class="literal">docker run</code> command attempted
to directly bind-mount an <code class="literal">elasticsearch.keystore</code> file that doesn&#8217;t exist. If
you use the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to mount a file that doesn&#8217;t exist, Docker
instead creates a directory with the same name.</p>
<p>To resolve this error:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Delete the <code class="literal">elasticsearch.keystore</code> directory in the <code class="literal">config</code> directory.
</li>
<li class="listitem">
Update the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to point to the <code class="literal">config</code> directory path
rather than the keystore file&#8217;s path. For an example, see
<a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">Create an encrypted Elasticsearch keystore</a>.
</li>
<li class="listitem">
Retry the command.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_elasticsearch_keystore_device_or_resource_busy"></a>elasticsearch.keystore: Device or resource busy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.7/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Exception in thread "main" java.nio.file.FileSystemException: /usr/share/elasticsearch/config/elasticsearch.keystore.tmp -&gt; /usr/share/elasticsearch/config/elasticsearch.keystore: Device or resource busy</pre>
</div>
<p>A <code class="literal">docker run</code> command attempted to <a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">update the
keystore</a> while directly bind-mounting the <code class="literal">elasticsearch.keystore</code> file. To
update the keystore, the container requires access to other files in the
<code class="literal">config</code> directory, such as <code class="literal">keystore.tmp</code>.</p>
<p>To resolve this error:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Update the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to point to the <code class="literal">config</code> directory
path rather than the keystore file&#8217;s path. For an example, see
<a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">Create an encrypted Elasticsearch keystore</a>.
</li>
<li class="listitem">
Retry the command.
</li>
</ol>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="rpm.html">« Install Elasticsearch with RPM</a>
</span>
<span class="next">
<a href="run-elasticsearch-locally.html">Run Elasticsearch locally »</a>
</span>
</div>
</div>
</body>
</html>
