<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Run downsampling using data stream lifecycle | Elasticsearch Guide [8.x] | Elastic</title>
<meta class="elastic" name="content" content="Run downsampling using data stream lifecycle | Elasticsearch Guide [8.x]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.x]"/>
<link rel="up" href="tsds.html" title="Time series data stream (TSDS)"/>
<link rel="prev" href="downsampling-manual.html" title="Run downsampling manually"/>
<link rel="next" href="tsds-reindex.html" title="Reindex a time series data stream (TSDS)"/>
<meta class="elastic" name="product_version" content="8.x"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.x"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="downsampling-manual.html">« Run downsampling manually</a>
</span>
<span class="next">
<a href="tsds-reindex.html">Reindex a time series data stream (TSDS) »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.x]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-streams.html">Data streams</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="tsds.html">Time series data stream (TSDS)</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Run downsampling using data stream lifecycle</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/downsampling-dsl.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/manage-data/data-store/data-streams/run-downsampling-using-data-stream-lifecycle">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="downsampling-dsl"></a>Run downsampling using data stream lifecycle</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/downsampling-dsl.asciidoc">edit</a></div>
</div></div></div>

<p>This is a simplified example that allows you to see quickly how
<a class="xref" href="downsampling.html" title="Downsampling a time series data stream">downsampling</a> works as part of a datastream lifecycle to reduce the
storage size of a sampled set of metrics. The example uses typical Kubernetes
cluster monitoring data. To test out downsampling with data stream lifecycle, follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Check the <a class="xref" href="downsampling-dsl.html#downsampling-dsl-prereqs" title="Prerequisites">prerequisites</a>.
</li>
<li class="listitem">
<a class="xref" href="downsampling-dsl.html#downsampling-dsl-create-index-template" title="Create an index template with data stream lifecycle">Create an index template with data stream lifecycle</a>.
</li>
<li class="listitem">
<a class="xref" href="downsampling-dsl.html#downsampling-dsl-ingest-data" title="Ingest time series data">Ingest time series data</a>.
</li>
<li class="listitem">
<a class="xref" href="downsampling-dsl.html#downsampling-dsl-view-data-stream-state" title="View current state of data stream">View current state of data stream</a>.
</li>
<li class="listitem">
<a class="xref" href="downsampling-dsl.html#downsampling-dsl-rollover" title="Roll over the data stream">Roll over the data stream</a>.
</li>
<li class="listitem">
<a class="xref" href="downsampling-dsl.html#downsampling-dsl-view-results" title="View downsampling results">View downsampling results</a>.
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="downsampling-dsl-prereqs"></a>Prerequisites</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/downsampling-dsl.asciidoc">edit</a></div>
<p>Refer to <a class="xref" href="set-up-tsds.html#tsds-prereqs" title="Prerequisites">time series data stream prerequisites</a>.</p>
<div class="position-relative"><h4><a id="downsampling-dsl-create-index-template"></a>Create an index template with data stream lifecycle</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/downsampling-dsl.asciidoc">edit</a></div>
<p>This creates an index template for a basic data stream. The available parameters
for an index template are described in detail in <a class="xref" href="set-up-a-data-stream.html" title="Set up a data stream">Set up a
time series data stream</a>.</p>
<p>For simplicity, in the time series mapping all <code class="literal">time_series_metric</code> parameters
are set to type <code class="literal">gauge</code>, but the <code class="literal">counter</code> metric type may also be used. The
<code class="literal">time_series_metric</code> values determine the kind of statistical representations
that are used during downsampling.</p>
<p>The index template includes a set of static <a class="xref" href="tsds.html#time-series-dimension" title="Dimensions">time series
dimensions</a>: <code class="literal">host</code>, <code class="literal">namespace</code>, <code class="literal">node</code>, and <code class="literal">pod</code>. The time series dimensions
are not changed by the downsampling process.</p>
<p>To enable downsampling, this template includes a <code class="literal">lifecycle</code> section with <a class="xref" href="data-streams-put-lifecycle.html#data-streams-put-lifecycle-downsampling-example" title="Examples">downsampling</a> object. <code class="literal">fixed_interval</code> parameter sets downsampling interval at which you want to aggregate the original time series data. <code class="literal">after</code> parameter specifies how much time after index was rolled over should pass before downsampling is performed.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.put_index_template(
    name="datastream_template",
    index_patterns=[
        "datastream*"
    ],
    data_stream={},
    template={
        "lifecycle": {
            "downsampling": [
                {
                    "after": "1m",
                    "fixed_interval": "1h"
                }
            ]
        },
        "settings": {
            "index": {
                "mode": "time_series"
            }
        },
        "mappings": {
            "properties": {
                "@timestamp": {
                    "type": "date"
                },
                "kubernetes": {
                    "properties": {
                        "container": {
                            "properties": {
                                "cpu": {
                                    "properties": {
                                        "usage": {
                                            "properties": {
                                                "core": {
                                                    "properties": {
                                                        "ns": {
                                                            "type": "long"
                                                        }
                                                    }
                                                },
                                                "limit": {
                                                    "properties": {
                                                        "pct": {
                                                            "type": "float"
                                                        }
                                                    }
                                                },
                                                "nanocores": {
                                                    "type": "long",
                                                    "time_series_metric": "gauge"
                                                },
                                                "node": {
                                                    "properties": {
                                                        "pct": {
                                                            "type": "float"
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                },
                                "memory": {
                                    "properties": {
                                        "available": {
                                            "properties": {
                                                "bytes": {
                                                    "type": "long",
                                                    "time_series_metric": "gauge"
                                                }
                                            }
                                        },
                                        "majorpagefaults": {
                                            "type": "long"
                                        },
                                        "pagefaults": {
                                            "type": "long",
                                            "time_series_metric": "gauge"
                                        },
                                        "rss": {
                                            "properties": {
                                                "bytes": {
                                                    "type": "long",
                                                    "time_series_metric": "gauge"
                                                }
                                            }
                                        },
                                        "usage": {
                                            "properties": {
                                                "bytes": {
                                                    "type": "long",
                                                    "time_series_metric": "gauge"
                                                },
                                                "limit": {
                                                    "properties": {
                                                        "pct": {
                                                            "type": "float"
                                                        }
                                                    }
                                                },
                                                "node": {
                                                    "properties": {
                                                        "pct": {
                                                            "type": "float"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "workingset": {
                                            "properties": {
                                                "bytes": {
                                                    "type": "long",
                                                    "time_series_metric": "gauge"
                                                }
                                            }
                                        }
                                    }
                                },
                                "name": {
                                    "type": "keyword"
                                },
                                "start_time": {
                                    "type": "date"
                                }
                            }
                        },
                        "host": {
                            "type": "keyword",
                            "time_series_dimension": True
                        },
                        "namespace": {
                            "type": "keyword",
                            "time_series_dimension": True
                        },
                        "node": {
                            "type": "keyword",
                            "time_series_dimension": True
                        },
                        "pod": {
                            "type": "keyword",
                            "time_series_dimension": True
                        }
                    }
                }
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putIndexTemplate({
  name: "datastream_template",
  index_patterns: ["datastream*"],
  data_stream: {},
  template: {
    lifecycle: {
      downsampling: [
        {
          after: "1m",
          fixed_interval: "1h",
        },
      ],
    },
    settings: {
      index: {
        mode: "time_series",
      },
    },
    mappings: {
      properties: {
        "@timestamp": {
          type: "date",
        },
        kubernetes: {
          properties: {
            container: {
              properties: {
                cpu: {
                  properties: {
                    usage: {
                      properties: {
                        core: {
                          properties: {
                            ns: {
                              type: "long",
                            },
                          },
                        },
                        limit: {
                          properties: {
                            pct: {
                              type: "float",
                            },
                          },
                        },
                        nanocores: {
                          type: "long",
                          time_series_metric: "gauge",
                        },
                        node: {
                          properties: {
                            pct: {
                              type: "float",
                            },
                          },
                        },
                      },
                    },
                  },
                },
                memory: {
                  properties: {
                    available: {
                      properties: {
                        bytes: {
                          type: "long",
                          time_series_metric: "gauge",
                        },
                      },
                    },
                    majorpagefaults: {
                      type: "long",
                    },
                    pagefaults: {
                      type: "long",
                      time_series_metric: "gauge",
                    },
                    rss: {
                      properties: {
                        bytes: {
                          type: "long",
                          time_series_metric: "gauge",
                        },
                      },
                    },
                    usage: {
                      properties: {
                        bytes: {
                          type: "long",
                          time_series_metric: "gauge",
                        },
                        limit: {
                          properties: {
                            pct: {
                              type: "float",
                            },
                          },
                        },
                        node: {
                          properties: {
                            pct: {
                              type: "float",
                            },
                          },
                        },
                      },
                    },
                    workingset: {
                      properties: {
                        bytes: {
                          type: "long",
                          time_series_metric: "gauge",
                        },
                      },
                    },
                  },
                },
                name: {
                  type: "keyword",
                },
                start_time: {
                  type: "date",
                },
              },
            },
            host: {
              type: "keyword",
              time_series_dimension: true,
            },
            namespace: {
              type: "keyword",
              time_series_dimension: true,
            },
            node: {
              type: "keyword",
              time_series_dimension: true,
            },
            pod: {
              type: "keyword",
              time_series_dimension: true,
            },
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="d4158d486e7fee2702a14068b69e3b33"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">PUT _index_template/datastream_template
{
  "index_patterns": [
    "datastream*"
  ],
  "data_stream": {},
  "template": {
    "lifecycle": {
      "downsampling": [
        {
          "after": "1m",
          "fixed_interval": "1h"
        }
      ]
    },
    "settings": {
      "index": {
        "mode": "time_series"
      }
    },
    "mappings": {
      "properties": {
        "@timestamp": {
          "type": "date"
        },
        "kubernetes": {
          "properties": {
            "container": {
              "properties": {
                "cpu": {
                  "properties": {
                    "usage": {
                      "properties": {
                        "core": {
                          "properties": {
                            "ns": {
                              "type": "long"
                            }
                          }
                        },
                        "limit": {
                          "properties": {
                            "pct": {
                              "type": "float"
                            }
                          }
                        },
                        "nanocores": {
                          "type": "long",
                          "time_series_metric": "gauge"
                        },
                        "node": {
                          "properties": {
                            "pct": {
                              "type": "float"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "memory": {
                  "properties": {
                    "available": {
                      "properties": {
                        "bytes": {
                          "type": "long",
                          "time_series_metric": "gauge"
                        }
                      }
                    },
                    "majorpagefaults": {
                      "type": "long"
                    },
                    "pagefaults": {
                      "type": "long",
                      "time_series_metric": "gauge"
                    },
                    "rss": {
                      "properties": {
                        "bytes": {
                          "type": "long",
                          "time_series_metric": "gauge"
                        }
                      }
                    },
                    "usage": {
                      "properties": {
                        "bytes": {
                          "type": "long",
                          "time_series_metric": "gauge"
                        },
                        "limit": {
                          "properties": {
                            "pct": {
                              "type": "float"
                            }
                          }
                        },
                        "node": {
                          "properties": {
                            "pct": {
                              "type": "float"
                            }
                          }
                        }
                      }
                    },
                    "workingset": {
                      "properties": {
                        "bytes": {
                          "type": "long",
                          "time_series_metric": "gauge"
                        }
                      }
                    }
                  }
                },
                "name": {
                  "type": "keyword"
                },
                "start_time": {
                  "type": "date"
                }
              }
            },
            "host": {
              "type": "keyword",
              "time_series_dimension": true
            },
            "namespace": {
              "type": "keyword",
              "time_series_dimension": true
            },
            "node": {
              "type": "keyword",
              "time_series_dimension": true
            },
            "pod": {
              "type": "keyword",
              "time_series_dimension": true
            }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/751.console"></div>
<div class="position-relative"><h4><a id="downsampling-dsl-ingest-data"></a>Ingest time series data</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/downsampling-dsl.asciidoc">edit</a></div>
<p>Use a bulk API request to automatically create your TSDS and index a set of ten
documents.</p>
<p><span class="strong strong"><strong>Important:</strong></span> Before running this bulk request you need to update the
timestamps to within three to five hours after your current time. That is,
search <code class="literal">2022-06-21T15</code> and replace with your present date, and adjust the hour
to your current time plus three hours.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.bulk(
    index="datastream",
    refresh=True,
    operations=[
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:49:00Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 91153,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 463314616
                        },
                        "usage": {
                            "bytes": 307007078,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 585236
                        },
                        "rss": {
                            "bytes": 102728
                        },
                        "pagefaults": 120901,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:45:50Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 124501,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 982546514
                        },
                        "usage": {
                            "bytes": 360035574,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 1339884
                        },
                        "rss": {
                            "bytes": 381174
                        },
                        "pagefaults": 178473,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:44:50Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 38907,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 862723768
                        },
                        "usage": {
                            "bytes": 379572388,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 431227
                        },
                        "rss": {
                            "bytes": 386580
                        },
                        "pagefaults": 233166,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:44:40Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 86706,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 567160996
                        },
                        "usage": {
                            "bytes": 103266017,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 1724908
                        },
                        "rss": {
                            "bytes": 105431
                        },
                        "pagefaults": 233166,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:44:00Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 150069,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 639054643
                        },
                        "usage": {
                            "bytes": 265142477,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 1786511
                        },
                        "rss": {
                            "bytes": 189235
                        },
                        "pagefaults": 138172,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:42:40Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 82260,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 854735585
                        },
                        "usage": {
                            "bytes": 309798052,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 924058
                        },
                        "rss": {
                            "bytes": 110838
                        },
                        "pagefaults": 259073,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:42:10Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 153404,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 279586406
                        },
                        "usage": {
                            "bytes": 214904955,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 1047265
                        },
                        "rss": {
                            "bytes": 91914
                        },
                        "pagefaults": 302252,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:40:20Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 125613,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 822782853
                        },
                        "usage": {
                            "bytes": 100475044,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 2109932
                        },
                        "rss": {
                            "bytes": 278446
                        },
                        "pagefaults": 74843,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:40:10Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 100046,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 567160996
                        },
                        "usage": {
                            "bytes": 362826547,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 1986724
                        },
                        "rss": {
                            "bytes": 402801
                        },
                        "pagefaults": 296495,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        },
        {
            "create": {}
        },
        {
            "@timestamp": "2022-06-21T15:38:30Z",
            "kubernetes": {
                "host": "gke-apps-0",
                "node": "gke-apps-0-0",
                "pod": "gke-apps-0-0-0",
                "container": {
                    "cpu": {
                        "usage": {
                            "nanocores": 40018,
                            "core": {
                                "ns": 12828317850
                            },
                            "node": {
                                "pct": 0.0000277905
                            },
                            "limit": {
                                "pct": 0.0000277905
                            }
                        }
                    },
                    "memory": {
                        "available": {
                            "bytes": 1062428344
                        },
                        "usage": {
                            "bytes": 265142477,
                            "node": {
                                "pct": 0.01770037710617187
                            },
                            "limit": {
                                "pct": 0.00009923134671484496
                            }
                        },
                        "workingset": {
                            "bytes": 2294743
                        },
                        "rss": {
                            "bytes": 340623
                        },
                        "pagefaults": 224530,
                        "majorpagefaults": 0
                    },
                    "start_time": "2021-03-30T07:59:06Z",
                    "name": "container-name-44"
                },
                "namespace": "namespace26"
            }
        }
    ],
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.bulk(
  index: 'datastream',
  refresh: true,
  body: [
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:49:00Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 91_153,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 463_314_616
            },
            usage: {
              bytes: 307_007_078,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 585_236
            },
            rss: {
              bytes: 102_728
            },
            pagefaults: 120_901,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:45:50Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 124_501,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 982_546_514
            },
            usage: {
              bytes: 360_035_574,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 1_339_884
            },
            rss: {
              bytes: 381_174
            },
            pagefaults: 178_473,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:44:50Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 38_907,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 862_723_768
            },
            usage: {
              bytes: 379_572_388,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 431_227
            },
            rss: {
              bytes: 386_580
            },
            pagefaults: 233_166,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:44:40Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 86_706,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 567_160_996
            },
            usage: {
              bytes: 103_266_017,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 1_724_908
            },
            rss: {
              bytes: 105_431
            },
            pagefaults: 233_166,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:44:00Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 150_069,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 639_054_643
            },
            usage: {
              bytes: 265_142_477,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 1_786_511
            },
            rss: {
              bytes: 189_235
            },
            pagefaults: 138_172,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:42:40Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 82_260,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 854_735_585
            },
            usage: {
              bytes: 309_798_052,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 924_058
            },
            rss: {
              bytes: 110_838
            },
            pagefaults: 259_073,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:42:10Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 153_404,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 279_586_406
            },
            usage: {
              bytes: 214_904_955,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 1_047_265
            },
            rss: {
              bytes: 91_914
            },
            pagefaults: 302_252,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:40:20Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 125_613,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 822_782_853
            },
            usage: {
              bytes: 100_475_044,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 2_109_932
            },
            rss: {
              bytes: 278_446
            },
            pagefaults: 74_843,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:40:10Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 100_046,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 567_160_996
            },
            usage: {
              bytes: 362_826_547,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 1_986_724
            },
            rss: {
              bytes: 402_801
            },
            pagefaults: 296_495,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    },
    {
      create: {}
    },
    {
      "@timestamp": '2022-06-21T15:38:30Z',
      kubernetes: {
        host: 'gke-apps-0',
        node: 'gke-apps-0-0',
        pod: 'gke-apps-0-0-0',
        container: {
          cpu: {
            usage: {
              nanocores: 40_018,
              core: {
                ns: 12_828_317_850
              },
              node: {
                pct: 2.77905e-05
              },
              limit: {
                pct: 2.77905e-05
              }
            }
          },
          memory: {
            available: {
              bytes: 1_062_428_344
            },
            usage: {
              bytes: 265_142_477,
              node: {
                pct: 0.01770037710617187
              },
              limit: {
                pct: 9.923134671484496e-05
              }
            },
            workingset: {
              bytes: 2_294_743
            },
            rss: {
              bytes: 340_623
            },
            pagefaults: 224_530,
            majorpagefaults: 0
          },
          start_time: '2021-03-30T07:59:06Z',
          name: 'container-name-44'
        },
        namespace: 'namespace26'
      }
    }
  ]
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.bulk({
  index: "datastream",
  refresh: "true",
  operations: [
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:49:00Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 91153,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 463314616,
            },
            usage: {
              bytes: 307007078,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 585236,
            },
            rss: {
              bytes: 102728,
            },
            pagefaults: 120901,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:45:50Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 124501,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 982546514,
            },
            usage: {
              bytes: 360035574,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 1339884,
            },
            rss: {
              bytes: 381174,
            },
            pagefaults: 178473,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:44:50Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 38907,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 862723768,
            },
            usage: {
              bytes: 379572388,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 431227,
            },
            rss: {
              bytes: 386580,
            },
            pagefaults: 233166,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:44:40Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 86706,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 567160996,
            },
            usage: {
              bytes: 103266017,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 1724908,
            },
            rss: {
              bytes: 105431,
            },
            pagefaults: 233166,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:44:00Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 150069,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 639054643,
            },
            usage: {
              bytes: 265142477,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 1786511,
            },
            rss: {
              bytes: 189235,
            },
            pagefaults: 138172,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:42:40Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 82260,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 854735585,
            },
            usage: {
              bytes: 309798052,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 924058,
            },
            rss: {
              bytes: 110838,
            },
            pagefaults: 259073,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:42:10Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 153404,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 279586406,
            },
            usage: {
              bytes: 214904955,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 1047265,
            },
            rss: {
              bytes: 91914,
            },
            pagefaults: 302252,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:40:20Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 125613,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 822782853,
            },
            usage: {
              bytes: 100475044,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 2109932,
            },
            rss: {
              bytes: 278446,
            },
            pagefaults: 74843,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:40:10Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 100046,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 567160996,
            },
            usage: {
              bytes: 362826547,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 1986724,
            },
            rss: {
              bytes: 402801,
            },
            pagefaults: 296495,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
    {
      create: {},
    },
    {
      "@timestamp": "2022-06-21T15:38:30Z",
      kubernetes: {
        host: "gke-apps-0",
        node: "gke-apps-0-0",
        pod: "gke-apps-0-0-0",
        container: {
          cpu: {
            usage: {
              nanocores: 40018,
              core: {
                ns: 12828317850,
              },
              node: {
                pct: 0.0000277905,
              },
              limit: {
                pct: 0.0000277905,
              },
            },
          },
          memory: {
            available: {
              bytes: 1062428344,
            },
            usage: {
              bytes: 265142477,
              node: {
                pct: 0.01770037710617187,
              },
              limit: {
                pct: 0.00009923134671484496,
              },
            },
            workingset: {
              bytes: 2294743,
            },
            rss: {
              bytes: 340623,
            },
            pagefaults: 224530,
            majorpagefaults: 0,
          },
          start_time: "2021-03-30T07:59:06Z",
          name: "container-name-44",
        },
        namespace: "namespace26",
      },
    },
  ],
});
console.log(response);</pre>
</div>
<a id="408060f0c52300588a6dee774f4fd6a5"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT /datastream/_bulk?refresh
{"create": {}}
{"@timestamp":"2022-06-21T15:49:00Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":91153,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":463314616},"usage":{"bytes":307007078,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":585236},"rss":{"bytes":102728},"pagefaults":120901,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:45:50Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":124501,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":982546514},"usage":{"bytes":360035574,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":1339884},"rss":{"bytes":381174},"pagefaults":178473,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:44:50Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":38907,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":862723768},"usage":{"bytes":379572388,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":431227},"rss":{"bytes":386580},"pagefaults":233166,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:44:40Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":86706,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":567160996},"usage":{"bytes":103266017,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":1724908},"rss":{"bytes":105431},"pagefaults":233166,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:44:00Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":150069,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":639054643},"usage":{"bytes":265142477,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":1786511},"rss":{"bytes":189235},"pagefaults":138172,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:42:40Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":82260,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":854735585},"usage":{"bytes":309798052,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":924058},"rss":{"bytes":110838},"pagefaults":259073,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:42:10Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":153404,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":279586406},"usage":{"bytes":214904955,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":1047265},"rss":{"bytes":91914},"pagefaults":302252,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:40:20Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":125613,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":822782853},"usage":{"bytes":100475044,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":2109932},"rss":{"bytes":278446},"pagefaults":74843,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:40:10Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":100046,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":567160996},"usage":{"bytes":362826547,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":1986724},"rss":{"bytes":402801},"pagefaults":296495,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}
{"create": {}}
{"@timestamp":"2022-06-21T15:38:30Z","kubernetes":{"host":"gke-apps-0","node":"gke-apps-0-0","pod":"gke-apps-0-0-0","container":{"cpu":{"usage":{"nanocores":40018,"core":{"ns":12828317850},"node":{"pct":2.77905e-05},"limit":{"pct":2.77905e-05}}},"memory":{"available":{"bytes":1062428344},"usage":{"bytes":265142477,"node":{"pct":0.01770037710617187},"limit":{"pct":9.923134671484496e-05}},"workingset":{"bytes":2294743},"rss":{"bytes":340623},"pagefaults":224530,"majorpagefaults":0},"start_time":"2021-03-30T07:59:06Z","name":"container-name-44"},"namespace":"namespace26"}}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/752.console"></div>
<div class="position-relative"><h4><a id="downsampling-dsl-view-data-stream-state"></a>View current state of data stream</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/downsampling-dsl.asciidoc">edit</a></div>
<p>Now that you&#8217;ve created and added documents to the data stream, check to confirm
the current state of the new index.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.get_data_stream()
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.get_data_stream
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.getDataStream();
console.log(response);</pre>
</div>
<a id="8357aa6099089940589ae3e97e7bcffa"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET _data_stream</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/753.console"></div>
<p>If the data stream lifecycle policy has not yet been applied, your results will be like the
following. Note the original <code class="literal">index_name</code>: <code class="literal">.ds-datastream-2024.04.29-000001</code>.</p>
<a id="7dd63f2fb2f68848a7cacb5ec78fbedf"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "data_streams": [
    {
      "name": "datastream",
      "timestamp_field": {
        "name": "@timestamp"
      },
      "indices": [
        {
          "index_name": ".ds-datastream-2024.04.29-000001",
          "index_uuid": "vUMNtCyXQhGdlo1BD-cGRw",
          "managed_by": "Data stream lifecycle"
        }
      ],
      "generation": 1,
      "status": "GREEN",
      "template": "datastream_template",
      "lifecycle": {
        "enabled": true,
        "downsampling": [
          {
            "after": "1m",
            "fixed_interval": "1h"
          }
        ]
      },
      "next_generation_managed_by": "Data stream lifecycle",
      "hidden": false,
      "system": false,
      "allow_custom_routing": false,
      "replicated": false,
      "rollover_on_write": false,
      "time_series": {
        "temporal_ranges": [
          {
            "start": "2024-04-29T15:55:46.000Z",
            "end": "2024-04-29T18:25:46.000Z"
          }
        ]
      }
    }
  ]
}</pre>
</div>
<p>Next, run a search query:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="datastream",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  index: 'datastream'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "datastream",
});
console.log(response);</pre>
</div>
<a id="511e5bb8ab881171b7e8629095e30b85"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET datastream/_search</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/754.console"></div>
<p>The query returns your ten newly added documents.</p>
<a id="3b8b6f74abe80c3ca22eb64cff7b9727"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 23,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 10,
      "relation": "eq"
    },
...</pre>
</div>
<div class="position-relative"><h4><a id="downsampling-dsl-rollover"></a>Roll over the data stream</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/downsampling-dsl.asciidoc">edit</a></div>
<p>Data stream lifecycle will automatically roll over data stream and perform downsampling. This step is only needed in order to see downsampling results in scope of this tutorial.</p>
<p>Roll over the data stream using the <a class="xref" href="indices-rollover-index.html" title="Rollover API">rollover API</a>:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.rollover(
    alias="datastream",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.rollover({
  alias: "datastream",
});
console.log(response);</pre>
</div>
<a id="22b176a184517cf1b5801f5eb4f17f97"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST /datastream/_rollover/</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/755.console"></div>
<div class="position-relative"><h4><a id="downsampling-dsl-view-results"></a>View downsampling results</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/data-streams/downsampling-dsl.asciidoc">edit</a></div>
<p>By default, data stream lifecycle actions are executed every five minutes. Downsampling takes place after the index is rolled over and the <a class="xref" href="tsds-index-settings.html#index-time-series-end-time">index time series end time</a>
has lapsed as the source index is still expected to receive major writes until then. Index is now rolled over after previous step but its time series range end is likely still in the future. Once index time series range is in the past, re-run the <code class="literal">GET _data_stream</code> request.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.get_data_stream()
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.get_data_stream
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.getDataStream();
console.log(response);</pre>
</div>
<a id="8357aa6099089940589ae3e97e7bcffa"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET _data_stream</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/756.console"></div>
<p>After the data stream lifecycle action was executed, original
<code class="literal">.ds-datastream-2024.04.29-000001</code> index is replaced with a new, downsampled
index, in this case <code class="literal">downsample-1h-.ds-datastream-2024.04.29-000001</code>.</p>
<a id="4b5c4c3fea539a7a08ed1c7151bfe824"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "data_streams": [
    {
      "name": "datastream",
      "timestamp_field": {
        "name": "@timestamp"
      },
      "indices": [
        {
          "index_name": "downsample-1h-.ds-datastream-2024.04.29-000001",
          "index_uuid": "VqXuShP4T8ODAOnWFcqitg",
          "managed_by": "Data stream lifecycle"
        },
        {
          "index_name": ".ds-datastream-2024.04.29-000002",
          "index_uuid": "8gCeSdjUSWG-o-PeEAJ0jA",
          "managed_by": "Data stream lifecycle"
        }
      ],
...</pre>
</div>
<p>Run a search query on the datastream (note that when querying downsampled indices there are <a class="xref" href="downsampling.html#querying-downsampled-indices-notes" title="Notes on downsample queries">a few nuances to be aware of</a>).</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="datastream",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  index: 'datastream'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: "datastream",
});
console.log(response);</pre>
</div>
<a id="511e5bb8ab881171b7e8629095e30b85"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET datastream/_search</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/757.console"></div>
<p>The new downsampled index contains just one document that includes the <code class="literal">min</code>,
<code class="literal">max</code>, <code class="literal">sum</code>, and <code class="literal">value_count</code> statistics based off of the original sampled
metrics.</p>
<a id="11d569307eab5f8d8d16ba565b2f0a0f"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "took": 26,
  "timed_out": false,
  "_shards": {
    "total": 2,
    "successful": 2,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1,
    "hits": [
      {
        "_index": "downsample-1h-.ds-datastream-2024.04.29-000001",
        "_id": "0eL0wMf38sl_s5JnAAABjyrMjoA",
        "_score": 1,
        "_source": {
          "@timestamp": "2024-04-29T17:00:00.000Z",
          "_doc_count": 10,
          "kubernetes": {
            "container": {
              "cpu": {
                "usage": {
                  "core": {
                    "ns": 12828317850
                  },
                  "limit": {
                    "pct": 0.0000277905
                  },
                  "nanocores": {
                    "min": 38907,
                    "max": 153404,
                    "sum": 992677,
                    "value_count": 10
                  },
                  "node": {
                    "pct": 0.0000277905
                  }
                }
              },
              "memory": {
                "available": {
                  "bytes": {
                    "min": 279586406,
                    "max": 1062428344,
                    "sum": 7101494721,
                    "value_count": 10
                  }
                },
                "majorpagefaults": 0,
                "pagefaults": {
                  "min": 74843,
                  "max": 302252,
                  "sum": 2061071,
                  "value_count": 10
                },
                "rss": {
                  "bytes": {
                    "min": 91914,
                    "max": 402801,
                    "sum": 2389770,
                    "value_count": 10
                  }
                },
                "usage": {
                  "bytes": {
                    "min": 100475044,
                    "max": 379572388,
                    "sum": 2668170609,
                    "value_count": 10
                  },
                  "limit": {
                    "pct": 0.00009923134
                  },
                  "node": {
                    "pct": 0.017700378
                  }
                },
                "workingset": {
                  "bytes": {
                    "min": 431227,
                    "max": 2294743,
                    "sum": 14230488,
                    "value_count": 10
                  }
                }
              },
              "name": "container-name-44",
              "start_time": "2021-03-30T07:59:06.000Z"
            },
            "host": "gke-apps-0",
            "namespace": "namespace26",
            "node": "gke-apps-0-0",
            "pod": "gke-apps-0-0-0"
          }
        }
      }
    ]
  }
}</pre>
</div>
<p>Use the <a class="xref" href="data-stream-stats-api.html" title="Data stream stats API">data stream stats API</a> to get statistics for
the data stream, including the storage size.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.data_streams_stats(
    name="datastream",
    human=True,
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.data_streams_stats(
  name: 'datastream',
  human: true
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.dataStreamsStats({
  name: "datastream",
  human: "true",
});
console.log(response);</pre>
</div>
<a id="397ab5f9ea0b69ae85038bb0b9915180"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET /_data_stream/datastream/_stats?human=true</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/758.console"></div>
<a id="508a192dc18fe5975a1ebeb2b38736c5"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "_shards": {
    "total": 4,
    "successful": 4,
    "failed": 0
  },
  "data_stream_count": 1,
  "backing_indices": 2,
  "total_store_size": "37.3kb",
  "total_store_size_bytes": 38230,
  "data_streams": [
    {
      "data_stream": "datastream",
      "backing_indices": 2,
      "store_size": "37.3kb",
      "store_size_bytes": 38230,
      "maximum_timestamp": 1714410000000
    }
  ]
}</pre>
</div>
<p>This example demonstrates how downsampling works as part of a data stream lifecycle to
reduce the storage size of metrics data as it becomes less current and less
frequently queried.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="downsampling-manual.html">« Run downsampling manually</a>
</span>
<span class="next">
<a href="tsds-reindex.html">Reindex a time series data stream (TSDS) »</a>
</span>
</div>
</body>
</html>
