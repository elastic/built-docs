<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Role restriction | Elasticsearch Guide [8.x] | Elastic</title>
<meta class="elastic" name="content" content="Role restriction | Elasticsearch Guide [8.x]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.x]"/>
<link rel="up" href="authorization.html" title="User authorization"/>
<link rel="prev" href="defining-roles.html" title="Defining roles"/>
<link rel="next" href="security-privileges.html" title="Security privileges"/>
<meta class="elastic" name="product_version" content="8.x"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.x"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="defining-roles.html">« Defining roles</a>
</span>
<span class="next">
<a href="security-privileges.html">Security privileges »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.x]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="authorization.html">User authorization</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Role restriction</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/security/authorization/role-restriction.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/deploy-manage/users-roles/cluster-or-deployment-auth/role-restriction">latest documentation</a>.
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="role-restriction"></a>Role restriction</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/security/authorization/role-restriction.asciidoc">edit</a></div>
</div></div></div>
<p>Role restriction can be used to specify conditions under which a role should be effective.
When conditions are not met, the role will be disabled, which will result in access being denied.
Not specifying restriction means the role is not restricted and thus always effective.
This is the default behaviour.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Currently, the role restriction is only supported for <a class="xref" href="security-api-create-api-key.html" title="Create API key API">API keys</a>,
with limitation that the API key can only have a single role descriptor.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="workflows-restriction"></a>Workflows</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/security/authorization/role-restriction.asciidoc">edit</a></div>
</div></div></div>
<p>Workflows allow to restrict the role to be effective exclusively when calling certain REST APIs.
Calling a REST API that is not allowed by a workflow, will result in the role being disabled.
The below section lists workflows that you can restrict the role to:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">search_application_query</code>
</span>
</dt>
<dd>
This workflow restricts the role to the <a class="xref" href="search-application-search.html" title="Search Application Search">Search Application Search API</a> only.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Workflow names are case-sensitive.</p>
</div>
</div>
<div class="position-relative"><h4><a id="_examples_5"></a>Examples</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/security/authorization/role-restriction.asciidoc">edit</a></div>
<p>The following example creates an API key with a <a class="xref" href="role-restriction.html" title="Role restriction">restriction</a> to the <code class="literal">search_application_query</code> workflow,
which allows to call only <a class="xref" href="search-application-search.html" title="Search Application Search">Search Application Search API</a>:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.security.create_api_key(
    name="my-restricted-api-key",
    role_descriptors={
        "my-restricted-role-descriptor": {
            "indices": [
                {
                    "names": [
                        "my-search-app"
                    ],
                    "privileges": [
                        "read"
                    ]
                }
            ],
            "restriction": {
                "workflows": [
                    "search_application_query"
                ]
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.security.createApiKey({
  name: "my-restricted-api-key",
  role_descriptors: {
    "my-restricted-role-descriptor": {
      indices: [
        {
          names: ["my-search-app"],
          privileges: ["read"],
        },
      ],
      restriction: {
        workflows: ["search_application_query"],
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="1b076ceb1ead9f6897c2f351f0e45f74"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST /_security/api_key
{
  "name": "my-restricted-api-key",
  "role_descriptors": {
    "my-restricted-role-descriptor": {
      "indices": [
        {
          "names": ["my-search-app"],
          "privileges": ["read"]
        }
      ],
      "restriction":  {
        "workflows": ["search_application_query"]
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2298.console"></div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="defining-roles.html">« Defining roles</a>
</span>
<span class="next">
<a href="security-privileges.html">Security privileges »</a>
</span>
</div>
</body>
</html>
