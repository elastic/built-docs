<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Update trained model deployment API | Elasticsearch Guide [8.x] | Elastic</title>
<meta class="elastic" name="content" content="Update trained model deployment API | Elasticsearch Guide [8.x]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.x]"/>
<link rel="up" href="ml-df-trained-models-apis.html" title="Machine learning trained model APIs"/>
<link rel="prev" href="stop-trained-model-deployment.html" title="Stop trained model deployment API"/>
<link rel="next" href="migration-api.html" title="Migration APIs"/>
<meta class="elastic" name="product_version" content="8.x"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.x"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="stop-trained-model-deployment.html">« Stop trained model deployment API</a>
</span>
<span class="next">
<a href="migration-api.html">Migration APIs »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.x]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-df-trained-models-apis.html">Machine learning trained model APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Update trained model deployment API</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/ml/trained-models/apis/update-trained-model-deployment.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="update-trained-model-deployment"></a>Update trained model deployment API</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/ml/trained-models/apis/update-trained-model-deployment.asciidoc">edit</a></div>
</div></div></div>

<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>New API reference</strong></p>
</div></div></div>
<p>For the most up-to-date API details, refer to <a href="/docs/api/doc/elasticsearch/v8/group/endpoint-ml-trained-model" class="ulink" target="_top">Machine learning trained model APIs</a>.</p>
</div>
<p>Updates certain properties of a trained model deployment.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="update-trained-model-deployment-request"></a>Request</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/ml/trained-models/apis/update-trained-model-deployment.asciidoc">edit</a></div>
</div></div></div>
<p><code class="literal">POST _ml/trained_models/&lt;deployment_id&gt;/deployment/_update</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="update-trained-model-deployments-prereqs"></a>Prerequisites</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/ml/trained-models/apis/update-trained-model-deployment.asciidoc">edit</a></div>
</div></div></div>
<p>Requires the <code class="literal">manage_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_admin</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="update-trained-model-deployment-desc"></a>Description</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/ml/trained-models/apis/update-trained-model-deployment.asciidoc">edit</a></div>
</div></div></div>
<p>You can update a trained model deployment whose <code class="literal">assignment_state</code> is <code class="literal">started</code>.
You can enable adaptive allocations to automatically scale model allocations up
and down based on the actual resource requirement of the processes.
Or you can manually increase or decrease the number of allocations of a model
deployment.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="update-trained-model-deployments-path-parms"></a>Path parameters</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/ml/trained-models/apis/update-trained-model-deployment.asciidoc">edit</a></div>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;deployment_id&gt;</code>
</span>
</dt>
<dd>
(Required, string)
A unique identifier for the deployment of the model.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="update-trained-model-deployment-request-body"></a>Request body</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/ml/trained-models/apis/update-trained-model-deployment.asciidoc">edit</a></div>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">adaptive_allocations</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Adaptive allocations configuration object.
If enabled, the number of allocations of the model is set based on the current load the process gets.
When the load is high, a new model allocation is automatically created (respecting the value of <code class="literal">max_number_of_allocations</code> if it&#8217;s set).
When the load is low, a model allocation is automatically removed (respecting the value of <code class="literal">min_number_of_allocations</code> if it&#8217;s set).
If <code class="literal">adaptive_allocations</code> is enabled, do not set the number of allocations manually.
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Optional, Boolean)
If <code class="literal">true</code>, <code class="literal">adaptive_allocations</code> is enabled.
Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">max_number_of_allocations</code>
</span>
</dt>
<dd>
(Optional, integer)
Specifies the maximum number of allocations to scale to.
If set, it must be greater than or equal to <code class="literal">min_number_of_allocations</code>.
</dd>
<dt>
<span class="term">
<code class="literal">min_number_of_allocations</code>
</span>
</dt>
<dd>
(Optional, integer)
Specifies the minimum number of allocations to scale to.
If set, it must be greater than or equal to <code class="literal">0</code>.
If not defined, the deployment scales to <code class="literal">0</code>.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">number_of_allocations</code>
</span>
</dt>
<dd>
(Optional, integer)
The total number of allocations this model is assigned across machine learning nodes.
Increasing this value generally increases the throughput.
If <code class="literal">adaptive_allocations</code> is enabled, do not set this value, because it&#8217;s automatically set.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="update-trained-model-deployment-example"></a>Examples</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/8.x/docs/reference/ml/trained-models/apis/update-trained-model-deployment.asciidoc">edit</a></div>
</div></div></div>
<p>The following example updates the deployment for a
<code class="literal">elastic__distilbert-base-uncased-finetuned-conll03-english</code> trained model to have 4 allocations:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.ml.update_trained_model_deployment(
    model_id="elastic__distilbert-base-uncased-finetuned-conll03-english",
    number_of_allocations=4,
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ml.update_trained_model_deployment(
  model_id: 'elastic__distilbert-base-uncased-finetuned-conll03-english',
  body: {
    number_of_allocations: 4
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ml.updateTrainedModelDeployment({
  model_id: "elastic__distilbert-base-uncased-finetuned-conll03-english",
  number_of_allocations: 4,
});
console.log(response);</pre>
</div>
<a id="70cc66bf4054ebf0ad4955cb99d9ab80"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">POST _ml/trained_models/elastic__distilbert-base-uncased-finetuned-conll03-english/deployment/_update
{
  "number_of_allocations": 4
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/3094.console"></div>
<p>The API returns the following results:</p>
<a id="cc9c1a787723585faeb0b8923117dd08"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
    "assignment": {
        "task_parameters": {
            "model_id": "elastic__distilbert-base-uncased-finetuned-conll03-english",
            "model_bytes": 265632637,
            "threads_per_allocation" : 1,
            "number_of_allocations" : 4,
            "queue_capacity" : 1024
        },
        "routing_table": {
            "uckeG3R8TLe2MMNBQ6AGrw": {
                "current_allocations": 1,
                "target_allocations": 4,
                "routing_state": "started",
                "reason": ""
            }
        },
        "assignment_state": "started",
        "start_time": "2022-11-02T11:50:34.766591Z"
    }
}</pre>
</div>
<p>The following example updates the deployment for a
<code class="literal">elastic__distilbert-base-uncased-finetuned-conll03-english</code> trained model to
enable adaptive allocations with the minimum number of 3 allocations and the
maximum number of 10:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.ml.update_trained_model_deployment(
    model_id="elastic__distilbert-base-uncased-finetuned-conll03-english",
    adaptive_allocations={
        "enabled": True,
        "min_number_of_allocations": 3,
        "max_number_of_allocations": 10
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ml.updateTrainedModelDeployment({
  model_id: "elastic__distilbert-base-uncased-finetuned-conll03-english",
  adaptive_allocations: {
    enabled: true,
    min_number_of_allocations: 3,
    max_number_of_allocations: 10,
  },
});
console.log(response);</pre>
</div>
<a id="dfce1be1d035aff0b8fdf4a8839f7795"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST _ml/trained_models/elastic__distilbert-base-uncased-finetuned-conll03-english/deployment/_update
{
  "adaptive_allocations": {
    "enabled": true,
    "min_number_of_allocations": 3,
    "max_number_of_allocations": 10
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/3095.console"></div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="stop-trained-model-deployment.html">« Stop trained model deployment API</a>
</span>
<span class="next">
<a href="migration-api.html">Migration APIs »</a>
</span>
</div>
</body>
</html>
