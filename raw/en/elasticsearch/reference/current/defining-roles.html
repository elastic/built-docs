<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Defining roles | Elasticsearch Guide [8.17] | Elastic</title>
<meta class="elastic" name="content" content="Defining roles | Elasticsearch Guide [8.17]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.17]"/>
<link rel="up" href="authorization.html" title="User authorization"/>
<link rel="prev" href="built-in-roles.html" title="Built-in roles"/>
<link rel="next" href="role-restriction.html" title="Role restriction"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.17"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.17"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="built-in-roles.html">« Built-in roles</a>
</span>
<span class="next">
<a href="role-restriction.html">Role restriction »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="authorization.html">User authorization</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Defining roles</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="defining-roles"></a>Defining roles</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
</div></div></div>
<p>A role is defined by the following JSON structure:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "run_as": [ ... ], <a id="CO714-1"></a><i class="conum" data-value="1"></i>
  "cluster": [ ... ], <a id="CO714-2"></a><i class="conum" data-value="2"></i>
  "global": { ... }, <a id="CO714-3"></a><i class="conum" data-value="3"></i>
  "indices": [ ... ], <a id="CO714-4"></a><i class="conum" data-value="4"></i>
  "applications": [ ... ], <a id="CO714-5"></a><i class="conum" data-value="5"></i>
  "remote_indices": [ ... ], <a id="CO714-6"></a><i class="conum" data-value="6"></i>
  "remote_cluster": [ ... ], <a id="CO714-7"></a><i class="conum" data-value="7"></i>
  "metadata": { ... }, <a id="CO714-8"></a><i class="conum" data-value="8"></i>
  "description": "..." <a id="CO714-9"></a><i class="conum" data-value="9"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of usernames the owners of this role can <a class="xref" href="run-as-privilege.html" title="Submitting requests on behalf of other users">impersonate</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of cluster privileges. These privileges define the
cluster level actions users with this role are able to execute. This field
is optional (missing <code class="literal">cluster</code> privileges effectively mean no cluster level
permissions).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>An object defining global privileges. A global privilege is a form of
cluster privilege that is request sensitive. A standard cluster privilege
makes authorization decisions based solely on the action being executed.
A global privilege also considers the parameters included in the request.
Support for global privileges is currently limited to the management of
application privileges. This field is optional.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of indices permissions entries. This field is optional (missing <code class="literal">indices</code>
privileges effectively mean no index level permissions).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of application privilege entries. This field is optional.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of indices permissions entries for
<a class="xref" href="remote-clusters-api-key.html" title="Add remote clusters using API key authentication">remote clusters configured with the API key based model</a>.
This field is optional (missing <code class="literal">remote_indices</code> privileges effectively mean
no index level permissions for any API key based remote clusters).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-7"><i class="conum" data-value="7"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of cluster permissions entries for
<a class="xref" href="remote-clusters-api-key.html" title="Add remote clusters using API key authentication">remote clusters configured with the API key based model</a>.
This field is optional (missing <code class="literal">remote_cluster</code> privileges effectively means
no additional cluster permissions for any API key based remote clusters).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-8"><i class="conum" data-value="8"></i></a></p>
</td>
<td align="left" valign="top">
<p>Metadata field associated with the role, such as <code class="literal">metadata.app_tag</code>.
Metadata is internally indexed as a <a class="xref" href="flattened.html" title="Flattened field type">flattened</a> field type.
This means that all sub-fields act like <code class="literal">keyword</code> fields when querying and sorting.
Metadata values can be simple values, but also lists and maps.
This field is optional.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO714-9"><i class="conum" data-value="9"></i></a></p>
</td>
<td align="left" valign="top">
<p>A string value with the description text of the role.
The maximum length of it is <code class="literal">1000</code> chars.
The field is internally indexed as a <a class="xref" href="text.html#text-field-type" title="Text field type">text</a> field type
(with default values for all parameters).
This field is optional.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<a id="valid-role-name"></a>
<p>Role names must be at least 1 and no more than 507 characters. They can
      contain alphanumeric characters (<code class="literal">a-z</code>, <code class="literal">A-Z</code>, <code class="literal">0-9</code>), spaces,
      punctuation, and printable symbols in the <a href="https://en.wikipedia.org/wiki/Basic_Latin_(Unicode_block)" class="ulink" target="_top">Basic Latin (ASCII) block</a>.
      Leading or trailing whitespace is not allowed.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="roles-indices-priv"></a>Indices privileges</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
</div></div></div>
<p>The following describes the structure of an indices permissions entry:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "names": [ ... ], <a id="CO715-1"></a><i class="conum" data-value="1"></i>
  "privileges": [ ... ], <a id="CO715-2"></a><i class="conum" data-value="2"></i>
  "field_security" : { ... }, <a id="CO715-3"></a><i class="conum" data-value="3"></i>
  "query": "...", <a id="CO715-4"></a><i class="conum" data-value="4"></i>
  "allow_restricted_indices": false <a id="CO715-5"></a><i class="conum" data-value="5"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO715-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of data streams, indices, and aliases to which the permissions
in this entry apply. Supports wildcards (<code class="literal">*</code>).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO715-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The index level privileges the owners of the role have on the associated
data streams and indices specified in the <code class="literal">names</code> argument.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO715-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specification for document fields the owners of the role have read access to.
See <a class="xref" href="field-and-document-access-control.html" title="Setting up field and document level security">Setting up field and document level security</a> for details.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO715-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>A search query that defines the documents the owners of the role have read
access to. A document within the associated data streams and indices must match this query
in order for it to be accessible by the owners of the role.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO715-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Restricted indices are a special category of indices that are used
internally to store configuration data and should not be directly accessed.
Only internal system roles should normally grant privileges over the restricted indices.
<span class="strong strong"><strong>Toggling this flag is very strongly discouraged because it could effectively grant unrestricted
operations on critical data, making the entire system unstable or leaking sensitive information.</strong></span>
If however, for administrative purposes, you need to create a role with privileges covering
restricted indices, you must set this field to <code class="literal">true</code> (default is <code class="literal">false</code>), and then the
<code class="literal">names</code> field will cover the restricted indices as well.</p>
</td>
</tr>
</table>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">names</code> parameter accepts wildcard and regular expressions that may refer to
multiple data streams, indices, and aliases.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Wildcard (default) - simple wildcard matching where <code class="literal">*</code> is a placeholder
for zero or more characters, <code class="literal">?</code> is a placeholder for a single character
and <code class="literal">\</code> may be used as an escape character.
</li>
<li class="listitem">
Regular Expressions - A more powerful syntax for matching more complex
patterns. This regular expression is based on Lucene&#8217;s regexp automaton
syntax. To enable this syntax, it must be wrapped within a pair of
forward slashes (<code class="literal">/</code>). Any pattern starting with <code class="literal">/</code> and not ending with
<code class="literal">/</code> is considered to be malformed.
</li>
</ul>
</div>
<p><strong>Example Regular Expressions.</strong></p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">"foo-bar":               # match the literal `foo-bar`
"foo-*":                 # match anything beginning with "foo-"
"logstash-201?-*":       # ? matches any one character
"/.*-201[0-9]-.*/":      # use a regex to match anything containing 2010-2019
"/foo":                  # syntax error - missing final /</pre>
</div>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="roles-global-priv"></a>Global privileges</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
</div></div></div>
<p>The following describes the structure of the global privileges entry:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "application": {
    "manage": {    <a id="CO716-1"></a><i class="conum" data-value="1"></i>
      "applications": [ ... ] <a id="CO716-2"></a><i class="conum" data-value="2"></i>
    }
  },
  "profile": {
    "write": { <a id="CO716-3"></a><i class="conum" data-value="3"></i>
      "applications": [ ... ] <a id="CO716-4"></a><i class="conum" data-value="4"></i>
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO716-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The privilege for the ability to manage application privileges</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO716-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The list of application names that may be managed. This list supports
wildcards (e.g. <code class="literal">"myapp-*"</code>) and regular expressions (e.g.
<code class="literal">"/app[0-9]*/"</code>)</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO716-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The privilege for the ability to write the <code class="literal">access</code> and <code class="literal">data</code> of any user profile</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO716-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The list of names, wildcards and regular expressions to which the write
privilege is restricted to</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="roles-application-priv"></a>Application privileges</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
</div></div></div>
<p>The following describes the structure of an application privileges entry:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "application": "my_app", <a id="CO717-1"></a><i class="conum" data-value="1"></i>
  "privileges": [ ... ],   <a id="CO717-2"></a><i class="conum" data-value="2"></i>
  "resources": [ ... ]     <a id="CO717-3"></a><i class="conum" data-value="3"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO717-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the application.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO717-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The list of the names of the application privileges to grant to this role.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO717-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The resources to which those privileges apply. These are handled in the same
way as index name pattern in <code class="literal">indices</code> permissions. These resources do not
have any special meaning to the Elasticsearch security features.</p>
</td>
</tr>
</table>
</div>
<p>For details about the validation rules for these fields, see the
<a class="xref" href="security-api-put-privileges.html" title="Create or update application privileges API">add application privileges API</a>.</p>
<p>A role may refer to application privileges that do not exist - that is, they
have not yet been defined through the add application privileges API (or they
were defined, but have since been deleted). In this case, the privilege has
no effect, and will not grant any actions in the
<a class="xref" href="security-api-has-privileges.html" title="Has privileges API">has privileges API</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="roles-remote-indices-priv"></a>Remote indices privileges</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
</div></div></div>
<p>For <a class="xref" href="remote-clusters-api-key.html" title="Add remote clusters using API key authentication">remote clusters configured with the API key based model</a>, remote indices privileges
can be used to specify desired indices privileges for matching remote clusters. The final
effective index privileges will be an intersection of the remote indices privileges
and the <a class="xref" href="security-api-create-cross-cluster-api-key.html" title="Create Cross-Cluster API key API">cross-cluster API key</a>'s indices privileges.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Remote indices are effective for remote clusters configured with the API key based model.
They have no effect for remote clusters configured with the certificate based model.</p>
</div>
</div>
<p>The remote indices privileges entry has an extra mandatory <code class="literal">clusters</code> field compared to
an <a class="xref" href="defining-roles.html#roles-indices-priv" title="Indices privileges">indices privileges entry</a>. Otherwise the two have identical structure.
The following describes the structure of a remote indices permissions entry:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "clusters": [ ... ], <a id="CO718-1"></a><i class="conum" data-value="1"></i>
  "names": [ ... ], <a id="CO718-2"></a><i class="conum" data-value="2"></i>
  "privileges": [ ... ], <a id="CO718-3"></a><i class="conum" data-value="3"></i>
  "field_security" : { ... }, <a id="CO718-4"></a><i class="conum" data-value="4"></i>
  "query": "...", <a id="CO718-5"></a><i class="conum" data-value="5"></i>
  "allow_restricted_indices": false <a id="CO718-6"></a><i class="conum" data-value="6"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO718-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of remote cluster aliases. It supports literal strings as well as
<a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax">wildcards</a> and <a class="xref" href="regexp-syntax.html" title="Regular expression syntax">regular expressions</a>.
This field is required.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO718-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of data streams, indices, and aliases to which the permissions
in this entry apply. Supports wildcards (<code class="literal">*</code>).</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO718-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The index level privileges the owners of the role have on the associated
data streams and indices specified in the <code class="literal">names</code> argument.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO718-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specification for document fields the owners of the role have read access to.
See <a class="xref" href="field-and-document-access-control.html" title="Setting up field and document level security">Setting up field and document level security</a> for details.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO718-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>A search query that defines the documents the owners of the role have read
access to. A document within the associated data streams and indices must match this query
in order for it to be accessible by the owners of the role.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO718-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>Restricted indices are a special category of indices that are used
internally to store configuration data and should not be directly accessed.
Only internal system roles should normally grant privileges over the restricted indices.
<span class="strong strong"><strong>Toggling this flag is very strongly discouraged because it could effectively grant unrestricted
operations on critical data, making the entire system unstable or leaking sensitive information.</strong></span>
If however, for administrative purposes, you need to create a role with privileges covering
restricted indices, you must set this field to <code class="literal">true</code> (default is <code class="literal">false</code>), and then the
<code class="literal">names</code> field will cover the restricted indices as well.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="roles-remote-cluster-priv"></a>Remote cluster privileges</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
</div></div></div>
<p>For <a class="xref" href="remote-clusters-api-key.html" title="Add remote clusters using API key authentication">remote clusters configured with the API key based model</a>, remote cluster privileges
can be used to specify additional cluster privileges for matching remote clusters.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Remote cluster privileges are only effective for remote clusters configured with the API key based model.
They have no effect on remote clusters configured with the certificate based model.</p>
</div>
</div>
<p>The following describes the structure of a remote cluster permissions entry:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "clusters": [ ... ], <a id="CO719-1"></a><i class="conum" data-value="1"></i>
  "privileges": [ ... ] <a id="CO719-2"></a><i class="conum" data-value="2"></i>
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO719-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>A list of remote cluster aliases. It supports literal strings as well as
<a class="xref" href="api-conventions.html#api-multi-index" title="Multi-target syntax">wildcards</a> and <a class="xref" href="regexp-syntax.html" title="Regular expression syntax">regular expressions</a>.
This field is required.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO719-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The cluster level privileges for the remote cluster. The allowed values here are a subset of the
<a class="xref" href="security-privileges.html#privileges-list-cluster" title="Cluster privileges">cluster privileges</a>.
The <a class="xref" href="security-api-get-builtin-privileges.html#security-api-get-builtin-privileges-request" title="Request">builtin privileges API</a> can be used to determine
which privileges are allowed here. This field is required.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_example_9"></a>Example</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
</div></div></div>
<p>The following snippet shows an example definition of a <code class="literal">clicks_admin</code> role:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.security.put_role(
    name="clicks_admin",
    run_as=[
        "clicks_watcher_1"
    ],
    cluster=[
        "monitor"
    ],
    indices=[
        {
            "names": [
                "events-*"
            ],
            "privileges": [
                "read"
            ],
            "field_security": {
                "grant": [
                    "category",
                    "@timestamp",
                    "message"
                ]
            },
            "query": "{\"match\": {\"category\": \"click\"}}"
        }
    ],
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.security.putRole({
  name: "clicks_admin",
  run_as: ["clicks_watcher_1"],
  cluster: ["monitor"],
  indices: [
    {
      names: ["events-*"],
      privileges: ["read"],
      field_security: {
        grant: ["category", "@timestamp", "message"],
      },
      query: '{"match": {"category": "click"}}',
    },
  ],
});
console.log(response);</pre>
</div>
<a id="d3e5edac5b461020017fd9d8ec7a91fa"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST /_security/role/clicks_admin
{
  "run_as": [ "clicks_watcher_1" ],
  "cluster": [ "monitor" ],
  "indices": [
    {
      "names": [ "events-*" ],
      "privileges": [ "read" ],
      "field_security" : {
        "grant" : [ "category", "@timestamp", "message" ]
      },
      "query": "{\"match\": {\"category\": \"click\"}}"
    }
  ]
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2269.console"></div>
<p>Based on the above definition, users owning the <code class="literal">clicks_admin</code> role can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Impersonate the <code class="literal">clicks_watcher_1</code> user and execute requests on its behalf.
</li>
<li class="listitem">
Monitor the Elasticsearch cluster
</li>
<li class="listitem">
Read data from all indices prefixed with <code class="literal">events-</code>
</li>
<li class="listitem">
Within these indices, only read the events of the <code class="literal">click</code> category
</li>
<li class="listitem">
Within these document, only read the <code class="literal">category</code>, <code class="literal">@timestamp</code> and <code class="literal">message</code>
fields.
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>For a complete list of available <a class="xref" href="security-privileges.html" title="Security privileges">cluster and indices privileges</a></p>
</div>
</div>
<p>There are two available mechanisms to define roles: using the <em>Role Management APIs</em>
or in local files on the Elasticsearch nodes. You can also implement
custom roles providers. If you need to integrate with another system to retrieve
user roles, you can build a custom roles provider plugin. For more information,
see <a class="xref" href="custom-roles-authorization.html" title="Customizing roles and authorization">Customizing roles and authorization</a>.</p>
<div class="position-relative"><h3><a id="roles-management-ui"></a>Role management UI</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
<p>You can manage users and roles easily in Kibana. To
manage roles, log in to Kibana and go to <span class="strong strong"><strong>Management / Security / Roles</strong></span>.</p>
<div class="position-relative"><h3><a id="roles-management-api"></a>Role management API</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
<p>The <em>Role Management APIs</em> enable you to add, update, remove and retrieve roles
dynamically. When you use the APIs to manage roles in the <code class="literal">native</code> realm, the
roles are stored in an internal Elasticsearch index. For more information and examples,
see <a class="xref" href="security-api.html#security-role-apis" title="Roles">Roles</a>.</p>
<div class="position-relative"><h3><a id="roles-management-file"></a>File-based role management</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/security/authorization/managing-roles.asciidoc">edit</a></div>
<p>Apart from the <em>Role Management APIs</em>, roles can also be defined in local
<code class="literal">roles.yml</code> file located in <code class="literal">ES_PATH_CONF</code>. This is a YAML file where each
role definition is keyed by its name.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the same role name is used in the <code class="literal">roles.yml</code> file and through the
<em>Role Management APIs</em>, the role found in the file will be used.</p>
</div>
</div>
<p>While the <em>Role Management APIs</em> is the preferred mechanism to define roles,
using the <code class="literal">roles.yml</code> file becomes useful if you want to define fixed roles that
no one (beside an administrator having physical access to the Elasticsearch nodes)
would be able to change. Please note however, that the <code class="literal">roles.yml</code> file is provided as a
minimal administrative function and is not intended to cover and be used
to define roles for all use cases.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot view, edit, or remove any roles that are defined in <code class="literal">roles.yml</code> by
using the <a class="xref" href="defining-roles.html#roles-management-ui" title="Role management UI">role management UI</a> or the
<a class="xref" href="defining-roles.html#roles-management-api" title="Role management API">role management APIs</a>.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">roles.yml</code> file is managed locally by the node and is not globally by the
cluster. This means that with a typical multi-node cluster, the exact same
changes need to be applied on each and every node in the cluster.</p>
<p>A safer approach would be to apply the change on one of the nodes and have the
<code class="literal">roles.yml</code> distributed/copied to all other nodes in the cluster (either
manually or using a configuration management system such as Puppet or Chef).</p>
</div>
</div>
<p>The following snippet shows an example of the <code class="literal">roles.yml</code> file configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">click_admins:
  run_as: [ 'clicks_watcher_1' ]
  cluster: [ 'monitor' ]
  indices:
    - names: [ 'events-*' ]
      privileges: [ 'read' ]
      field_security:
        grant: ['category', '@timestamp', 'message' ]
      query: '{"match": {"category": "click"}}'</pre>
</div>
<p>Elasticsearch continuously monitors the <code class="literal">roles.yml</code> file and automatically picks
up and applies any changes to it.</p>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="built-in-roles.html">« Built-in roles</a>
</span>
<span class="next">
<a href="role-restriction.html">Role restriction »</a>
</span>
</div>
</body>
</html>
