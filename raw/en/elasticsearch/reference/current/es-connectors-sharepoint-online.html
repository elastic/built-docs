<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Elastic SharePoint Online connector reference | Elasticsearch Guide [8.17] | Elastic</title>
<meta class="elastic" name="content" content="Elastic SharePoint Online connector reference | Elasticsearch Guide [8.17]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.17]"/>
<link rel="up" href="es-connectors-refs.html" title="Connectors references"/>
<link rel="prev" href="es-connectors-servicenow.html" title="Elastic ServiceNow connector reference"/>
<link rel="next" href="es-connectors-sharepoint.html" title="Elastic SharePoint Server connector reference"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.17"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.17"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="es-connectors-servicenow.html">« Elastic ServiceNow connector reference</a>
</span>
<span class="next">
<a href="es-connectors-sharepoint.html">Elastic SharePoint Server connector reference »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="es-connectors.html">Ingest content with Elastic connectors</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="es-connectors-refs.html">Connectors references</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Elastic SharePoint Online connector reference</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="es-connectors-sharepoint-online"></a>Elastic SharePoint Online connector reference</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
</div></div></div>

<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Looking for the SharePoint <span class="strong strong"><strong>Server</strong></span> connector? See <a class="xref" href="es-connectors-sharepoint.html" title="Elastic SharePoint Server connector reference">SharePoint Server reference</a>.</p>
</div>
</div>
<p>The <em>Elastic SharePoint Online connector</em> is a <a class="xref" href="es-connectors.html" title="Ingest content with Elastic connectors">connector</a> for <a href="https://www.microsoft.com/en-ww/microsoft-365/sharepoint/" class="ulink" target="_blank" rel="noopener">Microsoft SharePoint Online</a>.</p>
<p>This connector is written in Python using the <a href="https://github.com/elastic/connectors/tree/8.17" class="ulink" target="_blank" rel="noopener">Elastic connector framework</a>.</p>
<p>View the <a href="https://github.com/elastic/connectors/tree/8.17/connectors/sources/sharepoint_online.py" class="ulink" target="_blank" rel="noopener"><span class="strong strong"><strong>source code</strong></span> for this connector</a> (branch <em>8.17</em>, compatible with Elastic <em>8.17</em>).</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Choose your connector reference</strong></p>
</div></div></div>
<p>Are you using a managed connector on Elastic Cloud or a self-managed connector? Expand the documentation based on your deployment method.</p>
</div>
<div class="position-relative"><h4><a id="es-connectors-sharepoint-online-native-connector-reference"></a><span class="strong strong"><strong>Elastic managed connector reference</strong></span></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<details>
<summary class="title">View <span class="strong strong"><strong>Elastic managed connector</strong></span> reference</summary>
<div class="content">
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-availability-prerequisites"></a>Availability and prerequisites</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>This connector is available as a <span class="strong strong"><strong>managed connector</strong></span> in Elastic versions <span class="strong strong"><strong>8.9.0 and later</strong></span>.
To use this connector natively in Elastic Cloud, satisfy all <a class="xref" href="es-native-connectors.html" title="Elastic managed connectors">managed connector requirements</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This connector requires a subscription.
View the requirements for this feature under the <span class="strong strong"><strong>Elastic Search</strong></span> section of the <a href="/subscriptions" class="ulink" target="_blank" rel="noopener">Elastic Stack subscriptions</a> page.</p>
</div>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-usage"></a>Usage</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>To use this connector as a <span class="strong strong"><strong>managed connector</strong></span>, see <a class="xref" href="es-native-connectors.html" title="Elastic managed connectors"><em>Elastic managed connectors</em></a>.</p>
<p>For additional operations, see <a class="xref" href="es-connectors-usage.html" title="Connectors UI in Kibana"><em>Connectors UI in Kibana</em></a>.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-sharepoint-prerequisites"></a>SharePoint prerequisites</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-oauth-app-create"></a>Create SharePoint OAuth app</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>Before you can configure the connector, you must create an <span class="strong strong"><strong>OAuth App</strong></span> in the SharePoint Online platform.
Your connector will authenticate to SharePoint as the registered OAuth application/client.
You&#8217;ll collect values (<code class="literal">client ID</code>, <code class="literal">tenant ID</code>, and <code class="literal">client secret</code>) during this process that you&#8217;ll need for the <a class="xref" href="es-connectors-sharepoint-online.html#es-connectors-sharepoint-online-configuration" title="Configuration">configuration step</a> in Kibana.</p>
<p>To get started, first log in to SharePoint Online and access your administrative dashboard.
Ensure you are logged in as the Azure Portal <span class="strong strong"><strong>service account</strong></span>.</p>
<p>Follow these steps:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Sign in to <a href="https://portal.azure.com/" class="ulink" target="_top">https://portal.azure.com/</a> and click on <span class="strong strong"><strong>Azure Active Directory</strong></span>.
</li>
<li class="listitem">
Locate <span class="strong strong"><strong>App Registrations</strong></span> and Click <span class="strong strong"><strong>New Registration</strong></span>.
</li>
<li class="listitem">
Give your app a name - like "Search".
</li>
<li class="listitem">
Leave the <span class="strong strong"><strong>Redirect URIs</strong></span> blank for now.
</li>
<li class="listitem">
<span class="strong strong"><strong>Register</strong></span> the application.
</li>
<li class="listitem">
Find and keep the <span class="strong strong"><strong>Application (client) ID</strong></span> and <span class="strong strong"><strong>Directory (tenant) ID</strong></span> handy.
</li>
<li class="listitem">
Create a certificate and private key. This can, for example, be done by running <code class="literal">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout azure_app.key -out azure_app.crt</code> command. Store both in a safe and secure place
</li>
<li class="listitem">
Locate the <span class="strong strong"><strong>Certificates</strong></span> by navigating to <span class="strong strong"><strong>Client credentials: Certificates &amp; Secrets</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Upload certificate</strong></span>
</li>
<li class="listitem">
Upload the certificate created in one of previous steps: <code class="literal">azure_app.crt</code>
</li>
<li class="listitem">
<p>Set up the permissions the OAuth App will request from the Azure Portal service account.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Navigate to <span class="strong strong"><strong>API Permissions</strong></span> and click <span class="strong strong"><strong>Add Permission</strong></span>.
</li>
<li class="listitem">
<p>Add <span class="strong strong"><strong>application permissions</strong></span> until the list looks like the following:</p>
<pre class="screen">Graph API
- Sites.Selected
- Files.Read.All
- Group.Read.All
- User.Read.All

Sharepoint
- Sites.Selected</pre>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the <code class="literal">Comma-separated list of sites</code> configuration is set to <code class="literal">*</code> or if a user enables the toggle button <code class="literal">Enumerate all sites</code>, the connector requires <code class="literal">Sites.Read.All</code> permission.</p>
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>Grant admin consent</strong></span>, using the <code class="literal">Grant Admin Consent</code> link from the permissions screen.
</li>
<li class="listitem">
Save the tenant name (i.e. Domain name) of Azure platform.
</li>
</ul>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>The connector requires application permissions.  It does not support delegated permissions (scopes).</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The connector uses the <a href="https://learn.microsoft.com/en-us/sharepoint/dev/apis/sharepoint-rest-graph" class="ulink" target="_blank" rel="noopener">Graph API</a> (stable <a href="https://learn.microsoft.com/en-us/graph/api/overview?view=graph-rest-1.0#other-api-versions" class="ulink" target="_blank" rel="noopener">v1.0 API</a>) where possible to fetch data from Sharepoint Online.
When entities are not available via the Graph API the connector falls back to using the Sharepoint <a href="https://learn.microsoft.com/en-us/sharepoint/dev/sp-add-ins/get-to-know-the-sharepoint-rest-service" class="ulink" target="_blank" rel="noopener">REST API</a>.</p>
</div>
</div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-oauth-app-permissions"></a>SharePoint permissions</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>Microsoft is <a href="https://learn.microsoft.com/en-us/sharepoint/dev/sp-add-ins/retirement-announcement-for-azure-acs" class="ulink" target="_top">retiring Azure Access Control Service (ACS)</a>. This affects permission configuration:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Tenants created after November 1st, 2024</strong></span>: Certificate authentication is required
</li>
<li class="listitem">
<span class="strong strong"><strong>Tenants created before November 1st, 2024</strong></span>: Secret-based authentication must be migrated to certificate authentication by April 2nd, 2026
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-oauth-app-certificate-auth"></a>Certificate Authentication</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>This authentication method does not require additional setup other than creating and uploading certificates to the OAuth App.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-oauth-app-secret-auth"></a>Secret Authentication</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This method is only applicable to tenants created before November 1st, 2024. This method will be fully retired as of April 2nd, 2026.</p>
</div>
</div>
<p>Refer to the following documentation for setting <a href="https://learn.microsoft.com/en-us/sharepoint/dev/solution-guidance/security-apponly-azureacs" class="ulink" target="_blank" rel="noopener">SharePoint permissions</a>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To set <code class="literal">DisableCustomAppAuthentication</code> to false, connect to SharePoint using PowerShell and run <code class="literal">set-spotenant -DisableCustomAppAuthentication $false</code>
</li>
<li class="listitem">
<p>To assign full permissions to the tenant in SharePoint Online, go to the tenant URL in your browser.
The URL follows this pattern: <code class="literal">https://&lt;office_365_admin_tenant_URL&gt;/_layouts/15/appinv.aspx</code>.
This loads the SharePoint admin center page.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
In the <span class="strong strong"><strong>App ID</strong></span> box, enter the application ID that you recorded earlier, and then click <span class="strong strong"><strong>Lookup</strong></span>.
The application name will appear in the Title box.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>App Domain</strong></span> box, type &lt;tenant_name&gt;.onmicrosoft.com
</li>
<li class="listitem">
<p>In the <span class="strong strong"><strong>App&#8217;s Permission Request XML</strong></span> box, type the following XML string:</p>
<div class="pre_wrapper lang-xml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-xml">&lt;AppPermissionRequests AllowAppOnlyPolicy="true"&gt;
&lt;AppPermissionRequest Scope="http://sharepoint/content/tenant" Right="FullControl" /&gt;
&lt;AppPermissionRequest Scope="http://sharepoint/social/tenant" Right="Read" /&gt;
&lt;/AppPermissionRequests&gt;</pre>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-sites-selected-permissions"></a>Granting <code class="literal">Sites.Selected</code> permissions</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>To configure <code class="literal">Sites.Selected</code> permissions, follow these steps in the Azure Active Directory portal. These permissions enable precise access control to specific SharePoint sites.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Sign in to the <a href="https://portal.azure.com/" class="ulink" target="_blank" rel="noopener">Azure Active Directory portal</a>.
</li>
<li class="listitem">
Navigate to <span class="strong strong"><strong>App registrations</strong></span> and locate the application created for the connector.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>API permissions</strong></span>, click <span class="strong strong"><strong>Add permission</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Microsoft Graph</strong></span> &gt; <span class="strong strong"><strong>Application permissions</strong></span>, then add <code class="literal">Sites.Selected</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Grant admin consent</strong></span> to approve the permission.
</li>
</ol>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to the official <a href="https://learn.microsoft.com/en-us/graph/permissions-reference" class="ulink" target="_top">Microsoft documentation</a> for managing permissions in Azure AD.</p>
</div>
</div>
<p>To assign access to specific SharePoint sites using <code class="literal">Sites.Selected</code>:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Use Microsoft Graph Explorer or PowerShell to grant access.
</li>
<li class="listitem">
<p>To fetch the site ID, run the following Graph API query:</p>
<div class="pre_wrapper lang-http">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-http">GET https://graph.microsoft.com/v1.0/sites?select=webUrl,Title,Id&amp;$search="&lt;Name of the site&gt;*"</pre>
</div>
<p>This will return the <code class="literal">id</code> of the site.</p>
</li>
<li class="listitem">
<p>Use the <code class="literal">id</code> to assign read or write access:</p>
<div class="pre_wrapper lang-http">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-http">POST https://graph.microsoft.com/v1.0/sites/&lt;siteId&gt;/permissions
{
    "roles": ["read"], // or "write"
    "grantedToIdentities": [
        {
            "application": {
                "id": "&lt;App_Client_ID&gt;",
                "displayName": "&lt;App_Display_Name&gt;"
            }
        }
    ]
}</pre>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using the <code class="literal">Comma-separated list of sites</code> configuration field, ensure the sites specified match those granted <code class="literal">Sites.Selected</code> permission in SharePoint.
If the <code class="literal">Comma-separated list of sites</code> field is set to <code class="literal">*</code> or the <code class="literal">Enumerate all sites</code> toggle is enabled, the connector will attempt to access all sites. This requires broader permissions, which are not supported with <code class="literal">Sites.Selected</code>.</p>
</div>
</div>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Graph API permissions</strong></p>
</div></div></div>
<p>Microsoft recommends using Graph API for all operations with Sharepoint Online. Graph API is well-documented and more efficient at fetching data, which helps avoid throttling.
Refer to <a href="https://learn.microsoft.com/en-us/sharepoint/dev/general-development/how-to-avoid-getting-throttled-or-blocked-in-sharepoint-online" class="ulink" target="_blank" rel="noopener">Microsoft&#8217;s throttling policies</a> for more information.</p>
<p>Here&#8217;s a summary of why we use these Graph API permissions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Sites.Selected</strong></span> is used to fetch the sites and their metadata
</li>
<li class="listitem">
<span class="strong strong"><strong>Files.Read.All</strong></span> is used to fetch Site Drives and files in these drives
</li>
<li class="listitem">
<span class="strong strong"><strong>Groups.Read.All</strong></span> is used to fetch groups for document-level permissions
</li>
<li class="listitem">
<span class="strong strong"><strong>User.Read.All</strong></span> is used to fetch user information for document-level permissions
</li>
</ul>
</div>
<p>Due to the way the Graph API is designed, these permissions are "all or nothing" - it&#8217;s currently impossible to limit access to these resources.</p>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-compatability"></a>Compatibility</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>This connector is compatible with SharePoint Online.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-configuration"></a>Configuration</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>Use the following configuration fields to set up the connector:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Tenant ID
</span>
</dt>
<dd>
The tenant id for the Azure account hosting the Sharepoint Online instance.
</dd>
<dt>
<span class="term">
Tenant Name
</span>
</dt>
<dd>
The tenant name for the Azure account hosting the Sharepoint Online instance.
</dd>
<dt>
<span class="term">
Client ID
</span>
</dt>
<dd>
The client id to authenticate with SharePoint Online.
</dd>
<dt>
<span class="term">
Authentication Method
</span>
</dt>
<dd>
Authentication method to use to connector to Sharepoint Online and Rest APIs. <code class="literal">secret</code> is deprecated and <code class="literal">certificate</code> is recommended.
</dd>
<dt>
<span class="term">
Secret value
</span>
</dt>
<dd>
The secret value to authenticate with SharePoint Online, if Authentication Method: <code class="literal">secret</code> is chosen.
</dd>
<dt>
<span class="term">
Content of certificate file
</span>
</dt>
<dd>
Content of certificate file if Authentication Method: <code class="literal">certificate</code> is chosen.
</dd>
<dt>
<span class="term">
Content of private key file
</span>
</dt>
<dd>
Content of private key file if Authentication Method: <code class="literal">certificate</code> is chosen.
</dd>
<dt>
<span class="term">
Comma-separated list of sites
</span>
</dt>
<dd>
<p>
List of site collection names or paths to fetch from SharePoint.
When enumerating all sites, these values should be the <em>names</em> of the sites.
Use <code class="literal">*</code> to include all available sites.
Examples:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">collection1</code>
</li>
<li class="listitem">
<code class="literal">collection1,sub-collection</code>
</li>
<li class="listitem">
<p><code class="literal">*</code></p>
<p>When <span class="strong strong"><strong>not</strong></span> enumerating all sites, these values should be the <em>paths</em> (URL after <code class="literal">/sites/</code>) of the sites.
Examples:</p>
</li>
<li class="listitem">
<code class="literal">collection1</code>
</li>
<li class="listitem">
<code class="literal">collection1,collection1/sub-collection</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Enumerate all sites?
</span>
</dt>
<dd>
If enabled, the full list of all sites will be fetched from the API, in bulk, and will be filtered down to match the configured list of site names.
If disabled, each path in the configured list of site paths will be fetched individually from the API.
When disabled, <code class="literal">*</code> is not a valid configuration for <code class="literal">Comma-separated list of sites</code>.
Enabling this configuration is most useful when syncing large numbers (more than total/200) of sites.
This is because, at high volumes, it is more efficient to fetch sites in bulk.
When syncing fewer sites, disabling this configuration can result in improved performance.
This is because, at low volumes, it is more efficient to only fetch the sites that you need.
</dd>
<dt>
<span class="term">
Fetch sub-sites of configured sites?
</span>
</dt>
<dd>
Whether sub-sites of the configured site(s) should be automatically fetched.
This option is only available when not enumerating all sites (see above).
</dd>
<dt>
<span class="term">
Enable document level security
</span>
</dt>
<dd>
<p>
Toggle to enable <a class="xref" href="es-dls.html" title="Document level security">document level security (DLS)</a>.
When enabled, full and incremental syncs will fetch access control lists for each document and store them in the <code class="literal">_allow_access_control</code> field.
Access control syncs will fetch users' access control lists and store them in a separate index.
</p>
<p>Once enabled, the following granular permissions toggles will be available:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Fetch drive item permissions</strong></span>: Enable this option to fetch <span class="strong strong"><strong>drive item</strong></span> specific permissions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Fetch unique page permissions</strong></span>: Enable this option to fetch unique <span class="strong strong"><strong>page</strong></span> permissions. If this setting is disabled a page will inherit permissions from its parent site.
</li>
<li class="listitem">
<span class="strong strong"><strong>Fetch unique list permissions</strong></span>: Enable this option to fetch unique <span class="strong strong"><strong>list</strong></span> permissions. If this setting is disabled a list will inherit permissions from its parent site.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Fetch unique list item permissions</strong></span>: Enable this option to fetch unique <span class="strong strong"><strong>list item</strong></span> permissions. If this setting is disabled a list item will inherit permissions from its parent site.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If left empty the default value <code class="literal">true</code> will be used for these granular permissions toggles.
Note that these settings may increase sync times.</p>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-documents-syncs"></a>Documents and syncs</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>The connector syncs the following SharePoint object types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Sites</strong></span> (and subsites)
</li>
<li class="listitem">
<span class="strong strong"><strong>Lists</strong></span>
</li>
<li class="listitem">
<span class="strong strong"><strong>List items</strong></span> and <span class="strong strong"><strong>attachment content</strong></span>
</li>
<li class="listitem">
<span class="strong strong"><strong>Document libraries</strong></span> and <span class="strong strong"><strong>attachment content</strong></span> (including web pages)
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Content from files bigger than 10 MB won&#8217;t be extracted. (Self-managed connectors can use the <a class="xref" href="es-connectors-content-extraction.html#es-connectors-content-extraction-local" title="Extraction Service">self-managed local extraction service</a> to handle larger binary files.)
</li>
<li class="listitem">
Permissions are not synced by default. Enable <a class="xref" href="es-dls.html" title="Document level security">document-level security (DLS)</a> to sync permissions.
</li>
</ul>
</div>
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p><span class="strong strong"><strong>Making Sharepoint Site Pages Web Part content searchable</strong></span></p>
<p>If you&#8217;re using Web Parts on Sharepoint Site Pages and want to make this content searchable, you&#8217;ll need to consult the <a href="https://learn.microsoft.com/en-us/sharepoint/dev/spfx/web-parts/guidance/integrate-web-part-properties-with-sharepoint#specify-web-part-property-value-type/" class="ulink" target="_blank" rel="noopener">official documentation</a>.</p>
<p>We recommend setting <code class="literal">isHtmlString</code> to <span class="strong strong"><strong>True</strong></span> for all Web Parts that need to be searchable.</p>
</div>
</div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-documents-syncs-limitations"></a>Limitations</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The connector does not currently sync content from Teams-connected sites.
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-sync-rules"></a>Sync rules</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p><em>Basic</em> sync rules are identical for all connectors and are available by default.
For more information read <a class="xref" href="es-sync-rules.html#es-sync-rules-types" title="Types of sync rule">Types of sync rule</a>.</p>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-sync-rules-advanced"></a>Advanced sync rules</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>A <a class="xref" href="es-connectors-sync-types.html#es-connectors-sync-types-full" title="Full syncs">full sync</a> is required for advanced sync rules to take effect.</p>
</div>
</div>
<p>The following section describes <span class="strong strong"><strong>advanced sync rules</strong></span> for this connector.
Advanced sync rules are defined through a source-specific DSL JSON snippet.</p>
<p><a class="xref" href="es-sync-rules.html#es-sync-rules-advanced" title="Advanced sync rules">Advanced rules</a> for the Sharepoint Online connector enable you to avoid extracting and syncing older data that might no longer be relevant for search.</p>
<p>Example:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
	"skipExtractingDriveItemsOlderThan": 60
}</pre>
</div>
<p>This rule will not extract content of any drive items (files in document libraries) that haven&#8217;t been modified for 60 days or more.</p>
<p><a id="es-connectors-sharepoint-online-sync-rules-limitations"></a><span class="strong strong"><strong>Limitations of sync rules with incremental syncs</strong></span></p>
<p>Changing sync rules after Sharepoint Online content has already been indexed can bring unexpected results, when using <a class="xref" href="es-connectors-sync-types.html#es-connectors-sync-types-incremental" title="Incremental syncs">incremental syncs</a>.</p>
<p>Incremental syncs ensure <em>updates</em> from 3rd-party system, but do not modify existing documents in the index.</p>
<p><span class="strong strong"><strong>To avoid these issues, run a full sync after changing sync rules (basic or advanced).</strong></span></p>
<p>Let&#8217;s take a look at several examples where incremental syncs might lead to inconsistent data on your index.</p>
<p><a id="es-connectors-sharepoint-online-sync-rules-limitations-restrictive-added"></a><span class="strong strong"><strong>Example: Restrictive basic sync rule added after a full sync</strong></span></p>
<p>Imagine your Sharepoint Online drive contains the following drive items:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">/Documents/Report.doc
/Documents/Spreadsheet.xls
/Presentations/Q4-2020-Report.pdf
/Presentations/Q4-2020-Report-Data.xls
/Personal/Documents/Sales.xls</pre>
</div>
<p>After a sync, all these drive items will be stored on your Elasticsearch index.
Let&#8217;s add a basic sync rule, filtering files by their path:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Exclude WHERE path CONTAINS "Documents"</pre>
</div>
<p>These filtering rules will exclude all files with "Documents" in their path, leaving only files in <code class="literal">/Presentations</code> directory:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">/Presentations/Q4-2020-Report.pdf
/Presentations/Q4-2020-Report-Data.xls</pre>
</div>
<p>If no files were changed, incremental sync will not receive information about changes from Sharepoint Online and won&#8217;t be able to delete any files, leaving the index in the same state it was before the sync.</p>
<p>After a <span class="strong strong"><strong>full sync</strong></span>, the index will be updated and files that are excluded by sync rules will be removed.</p>
<p><a id="es-connectors-sharepoint-online-sync-rules-limitations-restrictive-removed"></a><span class="strong strong"><strong>Example: Restrictive basic sync rules removed after a full sync</strong></span></p>
<p>Imagine that Sharepoint Online drive has the following drive items:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">/Documents/Report.doc
/Documents/Spreadsheet.xls
/Presentations/Q4-2020-Report.pdf
/Presentations/Q4-2020-Report-Data.xls
/Personal/Documents/Sales.xls</pre>
</div>
<p>Before doing a sync, we add a restrictive basic filtering rule:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Exclude WHERE path CONTAINS "Documents"</pre>
</div>
<p>After a full sync, the index will contain only files in the <code class="literal">/Presentations</code> directory:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">/Presentations/Q4-2020-Report.pdf
/Presentations/Q4-2020-Report-Data.xls</pre>
</div>
<p>Afterwards, we can remove the filtering rule and run an incremental sync. If no changes happened to the files, incremental sync will not mirror these changes in the Elasticsearch index, because Sharepoint Online will not report any changes to the items.
Only a <span class="strong strong"><strong>full sync</strong></span> will include the items previously ignored by the sync rule.</p>
<p><a id="es-connectors-sharepoint-online-sync-rules-limitations-restrictive-changed"></a><span class="strong strong"><strong>Example: Advanced sync rules edge case</strong></span></p>
<p>Advanced sync rules can be applied to limit which documents will have content extracted.
For example, it&#8217;s possible to set a rule so that documents older than 180 days won&#8217;t have content extracted.</p>
<p>However, there is an edge case.
Imagine a document that is 179 days old and its content is extracted and indexed into Elasticsearch.
After 2 days, this document will be 181 days old.
Since this document was already ingested it will not be modified.
Therefore, the content will not be removed from the index, following an incremental sync.</p>
<p>In this situation, if you want older documents to be removed, you will need to clean the index up manually.
For example, you can manually run an Elasticsearch query that removes drive item content older than 180 days:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.update_by_query(
    index="INDEX_NAME",
    conflicts="proceed",
    query={
        "bool": {
            "filter": [
                {
                    "match": {
                        "object_type": "drive_item"
                    }
                },
                {
                    "exists": {
                        "field": "file"
                    }
                },
                {
                    "range": {
                        "lastModifiedDateTime": {
                            "lte": "now-180d"
                        }
                    }
                }
            ]
        }
    },
    script={
        "source": "ctx._source.body = ''",
        "lang": "painless"
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.updateByQuery({
  index: "INDEX_NAME",
  conflicts: "proceed",
  query: {
    bool: {
      filter: [
        {
          match: {
            object_type: "drive_item",
          },
        },
        {
          exists: {
            field: "file",
          },
        },
        {
          range: {
            lastModifiedDateTime: {
              lte: "now-180d",
            },
          },
        },
      ],
    },
  },
  script: {
    source: "ctx._source.body = ''",
    lang: "painless",
  },
});
console.log(response);</pre>
</div>
<a id="4da0cb8693e9ceceee2ba3b558014bbf"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST INDEX_NAME/_update_by_query?conflicts=proceed
{
  "query": {
    "bool": {
      "filter": [
        {
          "match": {
            "object_type": "drive_item"
          }
        },
        {
          "exists": {
            "field": "file"
          }
        },
        {
          "range": {
            "lastModifiedDateTime": {
              "lte": "now-180d"
            }
          }
        }
      ]
    }
  },
  "script": {
    "source": "ctx._source.body = ''",
    "lang": "painless"
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/1878.console"></div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-dls"></a>Document-level security</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>Document-level security (DLS) enables you to restrict access to documents based on a user&#8217;s permissions.
This feature is available by default for this connector.</p>
<p>Refer to <a class="xref" href="es-connectors-sharepoint-online.html#es-connectors-sharepoint-online-configuration" title="Configuration">configuration</a> on this page for how to enable DLS for this connector.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a class="xref" href="es-dls-e2e-guide.html" title="Leverage document-level security from connectors in Search Applications">DLS in Search Applications</a> to learn how to ingest data from SharePoint Online with DLS enabled, when building a search application.</p>
</div>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-content-extraction"></a>Content extraction</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-content-extraction-pipeline"></a>Default content extraction</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>The default content extraction service is powered by the Enterprise Search default ingest pipeline.
(See <a href="/guide/en/elasticsearch/reference/8.17/ingest-pipeline-search.html" class="ulink" target="_top">Ingest pipelines for Search indices</a>.)</p>
<p>See <a class="xref" href="es-connectors-content-extraction.html" title="Content extraction">Content extraction</a>.</p>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-content-extraction-local"></a>Local content extraction (for large files)</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>The SharePoint Online self-managed connector supports large file content extraction (&gt; <span class="strong strong"><strong>100MB</strong></span>).
This requires:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A self-managed deployment of the Elastic Text Extraction Service.
</li>
<li class="listitem">
Text extraction to be <em>disabled</em> in the default ingest pipeline settings.
</li>
</ul>
</div>
<p>Refer to <a class="xref" href="es-connectors-content-extraction.html#es-connectors-content-extraction-local" title="Extraction Service">local content extraction</a> for more information.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-known-issues"></a>Known issues</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Documents failing to sync due to SharePoint file and folder limits</strong></span></p>
<p>SharePoint has limits on the number of files and folders that can be synced.
You might encounter an error like the following written to the body of documents that failed to sync:
<code class="literal">The file size exceeds the allowed limit. CorrelationId: fdb36977-7cb8-4739-992f-49878ada6686, UTC DateTime: 4/21/2022 11:24:22 PM</code></p>
<p>Refer to <a href="https://support.microsoft.com/en-us/office/download-files-and-folders-from-onedrive-or-sharepoint-5c7397b7-19c7-4893-84fe-d02e8fa5df05#:~:text=Downloads%20are%20subject%20to%20the,zip%20file%20and%2020GB%20overall" class="ulink" target="_blank" rel="noopener">SharePoint documentation</a> for more information about these limits.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Syncing a large number of files</strong></span></p>
<p>The connector will fail to download files from folders that contain more than 5000 files.
The List View Threshold (default 5000) is a limit that prevents operations with a high performance impact on the SharePoint Online environment.</p>
<p><span class="strong strong"><strong>Workaround:</strong></span> Reduce batch size to avoid this issue.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Syncing large files</strong></span></p>
<p>SharePoint has file size limits, but these are configurable.</p>
<p><span class="strong strong"><strong>Workaround:</strong></span> Increase the file size limit.
Refer to <a href="https://learn.microsoft.com/en-us/sharepoint/manage-site-collection-storage-limits#set-automatic-or-manual-site-storage-limits" class="ulink" target="_blank" rel="noopener">SharePoint documentation</a> for more information.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Deleted documents counter is not updated during incremental syncs</strong></span></p>
<p>If the configuration <code class="literal">Enumerate All Sites?</code> is enabled, incremental syncs may not behave as expected.
Drive Item documents that were deleted between incremental syncs may not be detected as deleted.</p>
<p><span class="strong strong"><strong>Workaround</strong></span>: Disable <code class="literal">Enumerate All Sites?</code>, and configure full site paths for all desired sites.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Refer to <a class="xref" href="es-connectors-known-issues.html" title="Connector known issues"><em>Known issues</em></a> for a list of known issues for all connectors.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-troubleshooting"></a>Troubleshooting</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>See <a class="xref" href="es-connectors-troubleshooting.html" title="Troubleshooting connectors">Troubleshooting</a>.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-onlinesecurity"></a>Security</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>See <a class="xref" href="es-connectors-security.html" title="Connectors security">Security</a>.</p>
</div>
</details>
<div class="position-relative"><h4><a id="es-connectors-sharepoint-online-connector-client-reference"></a><span class="strong strong"><strong>Self-managed connector</strong></span></h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<details>
<summary class="title">View <span class="strong strong"><strong>self-managed connector</strong></span> reference</summary>
<div class="content">
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-availability-prerequisites"></a>Availability and prerequisites</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>This connector is available as a self-managed <span class="strong strong"><strong>self-managed connector</strong></span>.
To use this connector as a self-managed connector, satisfy all <a class="xref" href="es-build-connector.html" title="Self-managed connectors">self-managed connector requirements</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This connector requires a subscription.
View the requirements for this feature under the <span class="strong strong"><strong>Elastic Search</strong></span> section of the <a href="/subscriptions" class="ulink" target="_blank" rel="noopener">Elastic Stack subscriptions</a> page.</p>
</div>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-usage"></a>Usage</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>To use this connector as a <span class="strong strong"><strong>self-managed connector</strong></span>, see <a class="xref" href="es-build-connector.html" title="Self-managed connectors"><em>Self-managed connectors</em></a>
For additional operations, see <a class="xref" href="es-connectors-usage.html" title="Connectors UI in Kibana"><em>Connectors UI in Kibana</em></a>.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-sharepoint-prerequisites"></a>SharePoint prerequisites</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-client-oauth-app-create"></a>Create SharePoint OAuth app</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>Before you can configure the connector, you must create an <span class="strong strong"><strong>OAuth App</strong></span> in the SharePoint Online platform.
Your connector will authenticate to SharePoint as the registered OAuth application/client.
You&#8217;ll collect values (<code class="literal">client ID</code>, <code class="literal">tenant ID</code>, and <code class="literal">client secret</code>) during this process that you&#8217;ll need for the <a class="xref" href="es-connectors-sharepoint-online.html#es-connectors-sharepoint-online-client-configuration" title="Configuration">configuration step</a> in Kibana.</p>
<p>To get started, first log in to SharePoint Online and access your administrative dashboard.
Ensure you are logged in as the Azure Portal <span class="strong strong"><strong>service account</strong></span>.</p>
<p>Follow these steps:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Sign in to <a href="https://portal.azure.com/" class="ulink" target="_top">https://portal.azure.com/</a> and click on <span class="strong strong"><strong>Azure Active Directory</strong></span>.
</li>
<li class="listitem">
Locate <span class="strong strong"><strong>App Registrations</strong></span> and Click <span class="strong strong"><strong>New Registration</strong></span>.
</li>
<li class="listitem">
Give your app a name - like "Search".
</li>
<li class="listitem">
Leave the <span class="strong strong"><strong>Redirect URIs</strong></span> blank for now.
</li>
<li class="listitem">
<span class="strong strong"><strong>Register</strong></span> the application.
</li>
<li class="listitem">
Find and keep the <span class="strong strong"><strong>Application (client) ID</strong></span> and <span class="strong strong"><strong>Directory (tenant) ID</strong></span> handy.
</li>
<li class="listitem">
Create a certificate and private key. This can, for example, be done by running <code class="literal">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout azure_app.key -out azure_app.crt</code> command. Store both in a safe and secure place
</li>
<li class="listitem">
Locate the <span class="strong strong"><strong>Certificates</strong></span> by navigating to <span class="strong strong"><strong>Client credentials: Certificates &amp; Secrets</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Upload certificate</strong></span>
</li>
<li class="listitem">
Upload the certificate created in one of previous steps: <code class="literal">azure_app.crt</code>
</li>
<li class="listitem">
<p>Set up the permissions the OAuth App will request from the Azure Portal service account.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Navigate to <span class="strong strong"><strong>API Permissions</strong></span> and click <span class="strong strong"><strong>Add Permission</strong></span>.
</li>
<li class="listitem">
<p>Add <span class="strong strong"><strong>application permissions</strong></span> until the list looks like the following:</p>
<pre class="screen">Graph API
- Sites.Selected
- Files.Read.All
- Group.Read.All
- User.Read.All

Sharepoint
- Sites.Selected</pre>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the <code class="literal">Comma-separated list of sites</code> configuration is set to <code class="literal">*</code> or if a user enables the toggle button <code class="literal">Enumerate all sites</code>, the connector requires <code class="literal">Sites.Read.All</code> permission.</p>
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>Grant admin consent</strong></span>, using the <code class="literal">Grant Admin Consent</code> link from the permissions screen.
</li>
<li class="listitem">
Save the tenant name (i.e. Domain name) of Azure platform.
</li>
</ul>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>The connector requires application permissions.  It does not support delegated permissions (scopes).</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The connector uses the <a href="https://learn.microsoft.com/en-us/sharepoint/dev/apis/sharepoint-rest-graph" class="ulink" target="_blank" rel="noopener">Graph API</a> (stable <a href="https://learn.microsoft.com/en-us/graph/api/overview?view=graph-rest-1.0#other-api-versions" class="ulink" target="_blank" rel="noopener">v1.0 API</a>) where possible to fetch data from Sharepoint Online.
When entities are not available via the Graph API the connector falls back to using the Sharepoint <a href="https://learn.microsoft.com/en-us/sharepoint/dev/sp-add-ins/get-to-know-the-sharepoint-rest-service" class="ulink" target="_blank" rel="noopener">REST API</a>.</p>
</div>
</div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-client-oauth-app-permissions"></a>SharePoint permissions</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>Microsoft is <a href="https://learn.microsoft.com/en-us/sharepoint/dev/sp-add-ins/retirement-announcement-for-azure-acs" class="ulink" target="_top">retiring Azure Access Control Service (ACS)</a>. This affects permission configuration:
* <span class="strong strong"><strong>Tenants created after November 1st, 2024</strong></span>: Certificate authentication is required
* <span class="strong strong"><strong>Tenants created before November 1st, 2024</strong></span>: Secret-based authentication must be migrated to certificate authentication by April 2nd, 2026</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-oauth-app-certificate-auth"></a>Certificate Authentication</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>This authentication method does not require additional setup other than creating and uploading certificates to the OAuth App.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-oauth-app-secret-auth"></a>Secret Authentication</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This method is only applicable to tenants created before November 1st, 2024. This method will be fully retired as of April 2nd, 2026.</p>
</div>
</div>
<p>Refer to the following documentation for setting <a href="https://learn.microsoft.com/en-us/sharepoint/dev/solution-guidance/security-apponly-azureacs" class="ulink" target="_blank" rel="noopener">SharePoint permissions</a>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To set <code class="literal">DisableCustomAppAuthentication</code> to false, connect to SharePoint using PowerShell and run <code class="literal">set-spotenant -DisableCustomAppAuthentication $false</code>
</li>
<li class="listitem">
<p>To assign full permissions to the tenant in SharePoint Online, go to the tenant URL in your browser.
The URL follows this pattern: <code class="literal">https://&lt;office_365_admin_tenant_URL&gt;/_layouts/15/appinv.aspx</code>.
This loads the SharePoint admin center page.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
In the <span class="strong strong"><strong>App ID</strong></span> box, enter the application ID that you recorded earlier, and then click <span class="strong strong"><strong>Lookup</strong></span>.
The application name will appear in the Title box.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>App Domain</strong></span> box, type &lt;tenant_name&gt;.onmicrosoft.com
</li>
<li class="listitem">
<p>In the <span class="strong strong"><strong>App&#8217;s Permission Request XML</strong></span> box, type the following XML string:</p>
<div class="pre_wrapper lang-xml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-xml">&lt;AppPermissionRequests AllowAppOnlyPolicy="true"&gt;
&lt;AppPermissionRequest Scope="http://sharepoint/content/tenant" Right="FullControl" /&gt;
&lt;AppPermissionRequest Scope="http://sharepoint/social/tenant" Right="Read" /&gt;
&lt;/AppPermissionRequests&gt;</pre>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-sites-selected-permissions-self-managed"></a>Granting <code class="literal">Sites.Selected</code> permissions</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>To configure <code class="literal">Sites.Selected</code> permissions, follow these steps in the Azure Active Directory portal. These permissions enable precise access control to specific SharePoint sites.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Sign in to the <a href="https://portal.azure.com/" class="ulink" target="_blank" rel="noopener">Azure Active Directory portal</a>.
</li>
<li class="listitem">
Navigate to <span class="strong strong"><strong>App registrations</strong></span> and locate the application created for the connector.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>API permissions</strong></span>, click <span class="strong strong"><strong>Add permission</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Microsoft Graph</strong></span> &gt; <span class="strong strong"><strong>Application permissions</strong></span>, then add <code class="literal">Sites.Selected</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Grant admin consent</strong></span> to approve the permission.
</li>
</ol>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to the official <a href="https://learn.microsoft.com/en-us/graph/permissions-reference" class="ulink" target="_top">Microsoft documentation</a> for managing permissions in Azure AD.</p>
</div>
</div>
<p>To assign access to specific SharePoint sites using <code class="literal">Sites.Selected</code>:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Use Microsoft Graph Explorer or PowerShell to grant access.
</li>
<li class="listitem">
<p>To fetch the site ID, run the following Graph API query:</p>
<div class="pre_wrapper lang-http">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-http">GET https://graph.microsoft.com/v1.0/sites?select=webUrl,Title,Id&amp;$search="&lt;Name of the site&gt;*"</pre>
</div>
<p>This will return the <code class="literal">id</code> of the site.</p>
</li>
<li class="listitem">
<p>Use the <code class="literal">id</code> to assign read or write access:</p>
<div class="pre_wrapper lang-http">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-http">POST https://graph.microsoft.com/v1.0/sites/&lt;siteId&gt;/permissions
{
    "roles": ["read"], // or "write"
    "grantedToIdentities": [
        {
            "application": {
                "id": "&lt;App_Client_ID&gt;",
                "displayName": "&lt;App_Display_Name&gt;"
            }
        }
    ]
}</pre>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using the <code class="literal">Comma-separated list of sites</code> configuration field, ensure the sites specified match those granted <code class="literal">Sites.Selected</code> permission in SharePoint.
If the <code class="literal">Comma-separated list of sites</code> field is set to <code class="literal">*</code> or the <code class="literal">Enumerate all sites</code> toggle is enabled, the connector will attempt to access all sites. This requires broader permissions, which are not supported with <code class="literal">Sites.Selected</code>.</p>
</div>
</div>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Graph API permissions</strong></p>
</div></div></div>
<p>Microsoft recommends using Graph API for all operations with Sharepoint Online. Graph API is well-documented and more efficient at fetching data, which helps avoid throttling.
Refer to <a href="https://learn.microsoft.com/en-us/sharepoint/dev/general-development/how-to-avoid-getting-throttled-or-blocked-in-sharepoint-online" class="ulink" target="_blank" rel="noopener">Microsoft&#8217;s throttling policies</a> for more information.</p>
<p>Here&#8217;s a summary of why we use these Graph API permissions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Sites.Selected</strong></span> is used to fetch the sites and their metadata
</li>
<li class="listitem">
<span class="strong strong"><strong>Files.Read.All</strong></span> is used to fetch Site Drives and files in these drives
</li>
<li class="listitem">
<span class="strong strong"><strong>Groups.Read.All</strong></span> is used to fetch groups for document-level permissions
</li>
<li class="listitem">
<span class="strong strong"><strong>User.Read.All</strong></span> is used to fetch user information for document-level permissions
</li>
</ul>
</div>
<p>Due to the way the Graph API is designed, these permissions are "all or nothing" - it&#8217;s currently impossible to limit access to these resources.</p>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-compatability"></a>Compatibility</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>This connector is compatible with SharePoint Online.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-configuration"></a>Configuration</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using the <a class="xref" href="es-build-connector.html" title="Self-managed connectors">self-managed connector</a> workflow, initially these fields will use the default configuration set in the <a href="https://github.com/elastic/connectors/tree/8.17/connectors/sources/sharepoint_online.py" class="ulink" target="_blank" rel="noopener">connector source code</a>.
These are set in the <code class="literal">get_default_configuration</code> function definition.</p>
<p>These configurable fields will be rendered with their respective <span class="strong strong"><strong>labels</strong></span> in the Kibana UI.
Once connected, you&#8217;ll be able to update these values in Kibana.</p>
</div>
</div>
<p>Use the following configuration fields to set up the connector:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">tenant_id</code>
</span>
</dt>
<dd>
The tenant id for the Azure account hosting the Sharepoint Online instance.
</dd>
<dt>
<span class="term">
<code class="literal">tenant_name</code>
</span>
</dt>
<dd>
The tenant name for the Azure account hosting the Sharepoint Online instance.
</dd>
<dt>
<span class="term">
<code class="literal">client_id</code>
</span>
</dt>
<dd>
The client id to authenticate with SharePoint Online.
</dd>
<dt>
<span class="term">
<code class="literal">auth_method</code>
</span>
</dt>
<dd>
Authentication method to use to connector to Sharepoint Online and Rest APIs. <code class="literal">secret</code> is deprecated and <code class="literal">certificate</code> is recommended.
</dd>
<dt>
<span class="term">
<code class="literal">secret_value</code>
</span>
</dt>
<dd>
The secret value to authenticate with SharePoint Online, if auth_method: <code class="literal">secret</code> is chosen.
</dd>
<dt>
<span class="term">
<code class="literal">certificate</code>
</span>
</dt>
<dd>
Content of certificate file if auth_method: <code class="literal">certificate</code> is chosen.
</dd>
<dt>
<span class="term">
<code class="literal">private_key</code>
</span>
</dt>
<dd>
Content of private key file if auth_method: <code class="literal">certificate</code> is chosen.
</dd>
<dt>
<span class="term">
<code class="literal">site_collections</code>
</span>
</dt>
<dd>
<p>
List of site collection names or paths to fetch from SharePoint.
When enumerating all sites, these values should be the <em>names</em> of the sites.
Use <code class="literal">*</code> to include all available sites.
Examples:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">collection1</code>
</li>
<li class="listitem">
<code class="literal">collection1,sub-collection</code>
</li>
<li class="listitem">
<p><code class="literal">*</code></p>
<p>When <span class="strong strong"><strong>not</strong></span> enumerating all sites, these values should be the <em>paths</em> (URL after <code class="literal">/sites/</code>) of the sites.
Examples:</p>
</li>
<li class="listitem">
<code class="literal">collection1</code>
</li>
<li class="listitem">
<code class="literal">collection1,collection1/sub-collection</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">enumerate_all_sites</code>
</span>
</dt>
<dd>
<p>
If enabled, the full list of all sites will be fetched from the API, in bulk, and will be filtered down to match the configured list of site names.
If disabled, each path in the configured list of site paths will be fetched individually from the API.
Enabling this configuration is most useful when syncing large numbers (more than total/200) of sites.
This is because, at high volumes, it is more efficient to fetch sites in bulk.
When syncing fewer sites, disabling this configuration can result in improved performance.
This is because, at low volumes, it is more efficient to only fetch the sites that you need.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When disabled, <code class="literal">*</code> is not a valid configuration for <code class="literal">Comma-separated list of sites</code>.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">fetch_subsites</code>
</span>
</dt>
<dd>
Whether sub-sites of the configured site(s) should be automatically fetched.
This option is only available when not enumerating all sites (see above).
</dd>
<dt>
<span class="term">
<code class="literal">use_text_extraction_service</code>
</span>
</dt>
<dd>
Toggle to enable local text extraction service for documents.
Requires a separate deployment of the <a class="xref" href="es-connectors-content-extraction.html#es-connectors-content-extraction-local" title="Extraction Service">Elastic Text Extraction Service</a>.
Requires that ingest pipeline settings disable text extraction.
Default value is <code class="literal">False</code>.
</dd>
<dt>
<span class="term">
<code class="literal">use_document_level_security</code>
</span>
</dt>
<dd>
<p>
Toggle to enable <a class="xref" href="es-dls.html" title="Document level security">document level security (DLS)</a>.
When enabled, full and incremental syncs will fetch access control lists for each document and store them in the <code class="literal">_allow_access_control</code> field.
Access control syncs will fetch users' access control lists and store them in a separate index.
</p>
<p>Once enabled, the following granular permissions toggles will be available:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Fetch drive item permissions</strong></span>: Enable this option to fetch <span class="strong strong"><strong>drive item</strong></span> specific permissions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Fetch unique page permissions</strong></span>: Enable this option to fetch unique <span class="strong strong"><strong>page</strong></span> permissions. If this setting is disabled a page will inherit permissions from its parent site.
</li>
<li class="listitem">
<span class="strong strong"><strong>Fetch unique list permissions</strong></span>: Enable this option to fetch unique <span class="strong strong"><strong>list</strong></span> permissions. If this setting is disabled a list will inherit permissions from its parent site.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Fetch unique list item permissions</strong></span>: Enable this option to fetch unique <span class="strong strong"><strong>list item</strong></span> permissions. If this setting is disabled a list item will inherit permissions from its parent site.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If left empty the default value <code class="literal">true</code> will be used for these granular permissions toggles.
Note that these settings may increase sync times.</p>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-docker"></a>Deployment using Docker</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>You can deploy the SharePoint Online connector as a self-managed connector using Docker.
Follow these instructions.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Step 1: Download sample configuration file</strong></span></summary>
<div class="content">
<p>Download the sample configuration file.
You can either download it manually or run the following command:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl https://raw.githubusercontent.com/elastic/connectors/main/config.yml.example --output ~/connectors-config/config.yml</pre>
</div>
<p>Remember to update the <code class="literal">--output</code> argument value if your directory name is different, or you want to use a different config file name.</p>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>Step 2: Update the configuration file for your self-managed connector</strong></span></summary>
<div class="content">
<p>Update the configuration file with the following settings to match your environment:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">elasticsearch.host</code>
</li>
<li class="listitem">
<code class="literal">elasticsearch.api_key</code>
</li>
<li class="listitem">
<code class="literal">connectors</code>
</li>
</ul>
</div>
<p>If you&#8217;re running the connector service against a Dockerized version of Elasticsearch and Kibana, your config file will look like this:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml"># When connecting to your cloud deployment you should edit the host value
elasticsearch.host: http://host.docker.internal:9200
elasticsearch.api_key: &lt;ELASTICSEARCH_API_KEY&gt;

connectors:
  -
    connector_id: &lt;CONNECTOR_ID_FROM_KIBANA&gt;
    service_type: sharepoint_online
    api_key: &lt;CONNECTOR_API_KEY_FROM_KIBANA&gt; # Optional. If not provided, the connector will use the elasticsearch.api_key instead</pre>
</div>
<p>Using the <code class="literal">elasticsearch.api_key</code> is the recommended authentication method. However, you can also use <code class="literal">elasticsearch.username</code> and <code class="literal">elasticsearch.password</code> to authenticate with your Elasticsearch instance.</p>
<p>Note: You can change other default configurations by simply uncommenting specific settings in the configuration file and modifying their values.</p>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>Step 3: Run the Docker image</strong></span></summary>
<div class="content">
<p>Run the Docker image with the Connector Service using the following command:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run \
-v ~/connectors-config:/config \
--network "elastic" \
--tty \
--rm \
docker.elastic.co/enterprise-search/elastic-connectors:8.17.2 \
/app/bin/elastic-ingest \
-c /config/config.yml</pre>
</div>
</div>
</details>
<p>Refer to <a href="https://github.com/elastic/connectors/tree/8.17/docs/DOCKER.md" class="ulink" target="_blank" rel="noopener"><code class="literal">DOCKER.md</code></a> in the <code class="literal">elastic/connectors</code> repo for more details.</p>
<p>Find all available Docker images in the <a href="https://www.docker.elastic.co/r/enterprise-search/elastic-connectors" class="ulink" target="_top">official registry</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>We also have a quickstart self-managed option using Docker Compose, so you can spin up all required services at once: Elasticsearch, Kibana, and the connectors service.
Refer to this <a href="https://github.com/elastic/connectors/tree/main/scripts/stack#readme" class="ulink" target="_top">README</a> in the <code class="literal">elastic/connectors</code> repo for more information.</p>
</div>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-documents-syncs"></a>Documents and syncs</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>The connector syncs the following SharePoint object types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Sites</strong></span> (and subsites)
</li>
<li class="listitem">
<span class="strong strong"><strong>Lists</strong></span>
</li>
<li class="listitem">
<span class="strong strong"><strong>List items</strong></span> and <span class="strong strong"><strong>attachment content</strong></span>
</li>
<li class="listitem">
<span class="strong strong"><strong>Document libraries</strong></span> and <span class="strong strong"><strong>attachment content</strong></span> (including web pages)
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p><span class="strong strong"><strong>Making Sharepoint Site Pages Web Part content searchable</strong></span></p>
<p>If you&#8217;re using Web Parts on Sharepoint Site Pages and want to make this content searchable, you&#8217;ll need to consult the <a href="https://learn.microsoft.com/en-us/sharepoint/dev/spfx/web-parts/guidance/integrate-web-part-properties-with-sharepoint#specify-web-part-property-value-type/" class="ulink" target="_blank" rel="noopener">official documentation</a>.</p>
<p>We recommend setting <code class="literal">isHtmlString</code> to <span class="strong strong"><strong>True</strong></span> for all Web Parts that need to be searchable.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Content from files bigger than 10 MB won&#8217;t be extracted by default. Use the <a class="xref" href="es-connectors-content-extraction.html#es-connectors-content-extraction-local" title="Extraction Service">self-managed local extraction service</a> to handle larger binary files.
</li>
<li class="listitem">
Permissions are not synced by default. Enable <a class="xref" href="es-dls.html" title="Document level security">document-level security (DLS)</a> to sync permissions.
</li>
</ul>
</div>
</div>
</div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-client-documents-syncs-limitations"></a>Limitations</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The connector does not currently sync content from Teams-connected sites.
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-sync-rules"></a>Sync rules</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p><em>Basic</em> sync rules are identical for all connectors and are available by default.
For more information read <a class="xref" href="es-sync-rules.html#es-sync-rules-types" title="Types of sync rule">Types of sync rule</a>.</p>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-client-sync-rules-advanced"></a>Advanced sync rules</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>A <a class="xref" href="es-connectors-sync-types.html#es-connectors-sync-types-full" title="Full syncs">full sync</a> is required for advanced sync rules to take effect.</p>
</div>
</div>
<p>The following section describes <span class="strong strong"><strong>advanced sync rules</strong></span> for this connector.
Advanced sync rules are defined through a source-specific DSL JSON snippet.</p>
<p><a class="xref" href="es-sync-rules.html#es-sync-rules-advanced" title="Advanced sync rules">Advanced rules</a> for the Sharepoint Online connector enable you to avoid extracting and syncing older data that might no longer be relevant for search.</p>
<p>Example:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
	"skipExtractingDriveItemsOlderThan": 60
}</pre>
</div>
<p>This rule will not extract content of any drive items (files in document libraries) that haven&#8217;t been modified for 60 days or more.</p>
<p><a id="es-connectors-sharepoint-online-client-sync-rules-limitations"></a><span class="strong strong"><strong>Limitations of sync rules with incremental syncs</strong></span></p>
<p>Changing sync rules after Sharepoint Online content has already been indexed can bring unexpected results, when using <a class="xref" href="es-connectors-sync-types.html#es-connectors-sync-types-incremental" title="Incremental syncs">incremental syncs</a>.</p>
<p>Incremental syncs ensure <em>updates</em> from 3rd-party system, but do not modify existing documents in the index.</p>
<p><span class="strong strong"><strong>To avoid these issues, run a full sync after changing sync rules (basic or advanced).</strong></span></p>
<p>Let&#8217;s take a look at several examples where incremental syncs might lead to inconsistent data on your index.</p>
<p><a id="es-connectors-sharepoint-online-client-sync-rules-limitations-restrictive-added"></a><span class="strong strong"><strong>Example: Restrictive basic sync rule added after a full sync</strong></span></p>
<p>Imagine your Sharepoint Online drive contains the following drive items:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">/Documents/Report.doc
/Documents/Spreadsheet.xls
/Presentations/Q4-2020-Report.pdf
/Presentations/Q4-2020-Report-Data.xls
/Personal/Documents/Sales.xls</pre>
</div>
<p>After a sync, all these drive items will be stored on your Elasticsearch index.
Let&#8217;s add a basic sync rule, filtering files by their path:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Exclude WHERE path CONTAINS "Documents"</pre>
</div>
<p>These filtering rules will exclude all files with "Documents" in their path, leaving only files in <code class="literal">/Presentations</code> directory:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">/Presentations/Q4-2020-Report.pdf
/Presentations/Q4-2020-Report-Data.xls</pre>
</div>
<p>If no files were changed, incremental sync will not receive information about changes from Sharepoint Online and won&#8217;t be able to delete any files, leaving the index in the same state it was before the sync.</p>
<p>After a <span class="strong strong"><strong>full sync</strong></span>, the index will be updated and files that are excluded by sync rules will be removed.</p>
<p><a id="es-connectors-sharepoint-online-client-sync-rules-limitations-restrictive-removed"></a><span class="strong strong"><strong>Example: Restrictive basic sync rules removed after a full sync</strong></span></p>
<p>Imagine that Sharepoint Online drive has the following drive items:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">/Documents/Report.doc
/Documents/Spreadsheet.xls
/Presentations/Q4-2020-Report.pdf
/Presentations/Q4-2020-Report-Data.xls
/Personal/Documents/Sales.xls</pre>
</div>
<p>Before doing a sync, we add a restrictive basic filtering rule:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">Exclude WHERE path CONTAINS "Documents"</pre>
</div>
<p>After a full sync, the index will contain only files in the <code class="literal">/Presentations</code> directory:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">/Presentations/Q4-2020-Report.pdf
/Presentations/Q4-2020-Report-Data.xls</pre>
</div>
<p>Afterwards, we can remove the filtering rule and run an incremental sync. If no changes happened to the files, incremental sync will not mirror these changes in the Elasticsearch index, because Sharepoint Online will not report any changes to the items.
Only a <span class="strong strong"><strong>full sync</strong></span> will include the items previously ignored by the sync rule.</p>
<p><a id="es-connectors-sharepoint-online-client-sync-rules-limitations-restrictive-changed"></a><span class="strong strong"><strong>Example: Advanced sync rules edge case</strong></span></p>
<p>Advanced sync rules can be applied to limit which documents will have content extracted.
For example, it&#8217;s possible to set a rule so that documents older than 180 days won&#8217;t have content extracted.</p>
<p>However, there is an edge case.
Imagine a document that is 179 days old and its content is extracted and indexed into Elasticsearch.
After 2 days, this document will be 181 days old.
Since this document was already ingested it will not be modified.
Therefore, the content will not be removed from the index, following an incremental sync.</p>
<p>In this situation, if you want older documents to be removed, you will need to clean the index up manually.
For example, you can manually run an Elasticsearch query that removes drive item content older than 180 days:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.update_by_query(
    index="INDEX_NAME",
    conflicts="proceed",
    query={
        "bool": {
            "filter": [
                {
                    "match": {
                        "object_type": "drive_item"
                    }
                },
                {
                    "exists": {
                        "field": "file"
                    }
                },
                {
                    "range": {
                        "lastModifiedDateTime": {
                            "lte": "now-180d"
                        }
                    }
                }
            ]
        }
    },
    script={
        "source": "ctx._source.body = ''",
        "lang": "painless"
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.updateByQuery({
  index: "INDEX_NAME",
  conflicts: "proceed",
  query: {
    bool: {
      filter: [
        {
          match: {
            object_type: "drive_item",
          },
        },
        {
          exists: {
            field: "file",
          },
        },
        {
          range: {
            lastModifiedDateTime: {
              lte: "now-180d",
            },
          },
        },
      ],
    },
  },
  script: {
    source: "ctx._source.body = ''",
    lang: "painless",
  },
});
console.log(response);</pre>
</div>
<a id="4da0cb8693e9ceceee2ba3b558014bbf"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST INDEX_NAME/_update_by_query?conflicts=proceed
{
  "query": {
    "bool": {
      "filter": [
        {
          "match": {
            "object_type": "drive_item"
          }
        },
        {
          "exists": {
            "field": "file"
          }
        },
        {
          "range": {
            "lastModifiedDateTime": {
              "lte": "now-180d"
            }
          }
        }
      ]
    }
  },
  "script": {
    "source": "ctx._source.body = ''",
    "lang": "painless"
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/1879.console"></div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-dls"></a>Document-level security</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>Document-level security (DLS) enables you to restrict access to documents based on a user&#8217;s permissions.
This feature is available by default for this connector.</p>
<p>Refer to <a class="xref" href="es-connectors-sharepoint-online.html#es-connectors-sharepoint-online-client-configuration" title="Configuration">configuration</a> on this page for how to enable DLS for this connector.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a class="xref" href="es-dls-e2e-guide.html" title="Leverage document-level security from connectors in Search Applications">DLS in Search Applications</a> to learn how to ingest data from SharePoint Online with DLS enabled, when building a search application.</p>
</div>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-content-extraction"></a>Content extraction</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-client-content-extraction-pipeline"></a>Default content extraction</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>The default content extraction service is powered by the Enterprise Search default ingest pipeline.
(See <a href="/guide/en/elasticsearch/reference/8.17/ingest-pipeline-search.html" class="ulink" target="_top">Ingest pipelines for Search indices</a>.)</p>
<p>See <a class="xref" href="es-connectors-content-extraction.html" title="Content extraction">Content extraction</a>.</p>
<div class="position-relative"><h6><a id="es-connectors-sharepoint-online-client-content-extraction-local"></a>Local content extraction (for large files)</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>The SharePoint Online self-managed connector supports large file content extraction (&gt; <span class="strong strong"><strong>100MB</strong></span>).
This requires:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A self-managed deployment of the Elastic Text Extraction Service.
</li>
<li class="listitem">
Text extraction to be <em>disabled</em> in the default ingest pipeline settings.
</li>
</ul>
</div>
<p>Refer to <a class="xref" href="es-connectors-content-extraction.html#es-connectors-content-extraction-local" title="Extraction Service">local content extraction</a> for more information.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-testing"></a>End-to-end testing</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>The connector framework enables operators to run functional tests against a real data source.
Refer to <a class="xref" href="es-build-connector.html#es-build-connector-testing" title="Connector testing">Connector testing</a> for more details.</p>
<p>To perform E2E testing for the SharePoint Online connector, run the following command:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">$ make ftest NAME=sharepoint_online</pre>
</div>
<p>For faster tests, add the <code class="literal">DATA_SIZE=small</code> flag:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">make ftest NAME=sharepoint_online DATA_SIZE=small</pre>
</div>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-known-issues"></a>Known issues</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Documents failing to sync due to SharePoint file and folder limits</strong></span></p>
<p>SharePoint has limits on the number of files and folders that can be synced.
You might encounter an error like the following written to the body of documents that failed to sync:
<code class="literal">The file size exceeds the allowed limit. CorrelationId: fdb36977-7cb8-4739-992f-49878ada6686, UTC DateTime: 4/21/2022 11:24:22 PM</code></p>
<p>Refer to <a href="https://support.microsoft.com/en-us/office/download-files-and-folders-from-onedrive-or-sharepoint-5c7397b7-19c7-4893-84fe-d02e8fa5df05#:~:text=Downloads%20are%20subject%20to%20the,zip%20file%20and%2020GB%20overall" class="ulink" target="_blank" rel="noopener">SharePoint documentation</a> for more information about these limits.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Syncing a large number of files</strong></span></p>
<p>The connector will fail to download files from folders that contain more than 5000 files.
The List View Threshold (default 5000) is a limit that prevents operations with a high performance impact on the SharePoint Online environment.</p>
<p><span class="strong strong"><strong>Workaround:</strong></span> Reduce batch size to avoid this issue.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Syncing large files</strong></span></p>
<p>SharePoint has file size limits, but these are configurable.</p>
<p><span class="strong strong"><strong>Workaround:</strong></span> Increase the file size limit.
Refer to <a href="https://learn.microsoft.com/en-us/sharepoint/manage-site-collection-storage-limits#set-automatic-or-manual-site-storage-limits" class="ulink" target="_blank" rel="noopener">SharePoint documentation</a> for more information.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Deleted documents counter is not updated during incremental syncs</strong></span></p>
<p>If the configuration <code class="literal">Enumerate All Sites?</code> is enabled, incremental syncs may not behave as expected.
Drive Item documents that were deleted between incremental syncs may not be detected as deleted.</p>
<p><span class="strong strong"><strong>Workaround</strong></span>: Disable <code class="literal">Enumerate All Sites?</code>, and configure full site paths for all desired sites.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>Refer to <a class="xref" href="es-connectors-known-issues.html" title="Connector known issues"><em>Known issues</em></a> for a list of known issues for all connectors.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-troubleshooting"></a>Troubleshooting</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>See <a class="xref" href="es-connectors-troubleshooting.html" title="Troubleshooting connectors">Troubleshooting</a>.</p>
<div class="position-relative"><h5><a id="es-connectors-sharepoint-online-client-security"></a>Security</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.17/docs/reference/connector/docs/connectors-sharepoint-online.asciidoc">edit</a></div>
<p>See <a class="xref" href="es-connectors-security.html" title="Connectors security">Security</a>.</p>
</div>
</details>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="es-connectors-servicenow.html">« Elastic ServiceNow connector reference</a>
</span>
<span class="next">
<a href="es-connectors-sharepoint.html">Elastic SharePoint Server connector reference »</a>
</span>
</div>
</body>
</html>
