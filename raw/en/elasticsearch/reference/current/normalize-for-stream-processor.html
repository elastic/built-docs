<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Normalize for Stream processor | Elasticsearch Guide [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Normalize for Stream processor | Elasticsearch Guide [8.19]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.19]"/>
<link rel="up" href="processors.html" title="Ingest processor reference"/>
<link rel="prev" href="network-direction-processor.html" title="Network direction processor"/>
<link rel="next" href="pipeline-processor.html" title="Pipeline processor"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.19"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="network-direction-processor.html">« Network direction processor</a>
</span>
<span class="next">
<a href="pipeline-processor.html">Pipeline processor »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ingest.html">Ingest pipelines</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="processors.html">Ingest processor reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Normalize for Stream processor</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/ingest/processors/normalize-for-stream.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="normalize-for-stream-processor"></a>Normalize for Stream processor</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/ingest/processors/normalize-for-stream.asciidoc">edit</a></div>
</div></div></div>

<p>Detects whether a document is OpenTelemetry-compliant and if not -
normalizes it as described below. If used in combination with the OTel-related
mappings such as the ones defined in <code class="literal">logs-otel@template</code>, the resulting
document can be queried seamlessly by clients that expect either <a href="/guide/en/ecs/current/index.html" class="ulink" target="_top">ECS</a> or <a href="https://github.com/open-telemetry/semantic-conventions" class="ulink" target="_top">OpenTelemetry-Semantic-Conventions</a> formats.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This processor is in tech preview and is not available in our serverless offering.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="normalize-for-stream-detecting"></a>Detecting OpenTelemetry compliance</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/ingest/processors/normalize-for-stream.asciidoc">edit</a></div>
</div></div></div>
<p>The processor detects OpenTelemetry compliance by checking the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">resource</code> exists as a key and the value is a map
</li>
<li class="listitem">
<code class="literal">resource</code> either doesn&#8217;t contain an <code class="literal">attributes</code> field, or contains an <code class="literal">attributes</code> field of type map
</li>
<li class="listitem">
<code class="literal">scope</code> is either missing or a map
</li>
<li class="listitem">
<code class="literal">attributes</code> is either missing or a map
</li>
<li class="listitem">
<code class="literal">body</code> is either missing or a map
</li>
<li class="listitem">
<code class="literal">body</code> either doesn&#8217;t contain a <code class="literal">text</code> field, or contains a <code class="literal">text</code> field of type <code class="literal">String</code>
</li>
<li class="listitem">
<code class="literal">body</code> either doesn&#8217;t contain a <code class="literal">structured</code> field, or contains a <code class="literal">structured</code> field that is not of type <code class="literal">String</code>
</li>
</ul>
</div>
<p>If all of these conditions are met, the document is considered OpenTelemetry-compliant and is not modified by the processor.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="normalize-for-stream-normalization"></a>Normalization</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/ingest/processors/normalize-for-stream.asciidoc">edit</a></div>
</div></div></div>
<p>If the document is not OpenTelemetry-compliant, the processor normalizes it as follows:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Specific ECS fields are renamed to have their corresponding OpenTelemetry Semantic Conventions attribute names. These include the following:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>ECS Field</p></td>
<td align="left" valign="top"><p>Semantic Conventions Attribute</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">span.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">span_id</code></p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">trace.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">trace_id</code></p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">message</code></p></td>
<td align="left" valign="top"><p><code class="literal">body.text</code></p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">log.level</code></p></td>
<td align="left" valign="top"><p><code class="literal">severity_text</code></p></td>
<td align="left" valign="top"><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>The processor first looks for the nested form of the ECS field and if such does not exist, it looks for a top-level field with the dotted field name.</p>
</li>
<li class="listitem">
<p>Other specific ECS fields that describe resources and have corresponding counterparts in the OpenTelemetry Semantic Conventions are moved to the <code class="literal">resource.attribtues</code> map. Fields that are considered resource attributes are such that conform to the following conditions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
They are ECS fields that have corresponding counterparts (either with
the same name or with a different name) in OpenTelemetry Semantic Conventions.
</li>
<li class="listitem">
The corresponding OpenTelemetry attribute is defined in
<a href="https://github.com/open-telemetry/semantic-conventions/tree/main/model" class="ulink" target="_top">Semantic Conventions</a>
within a group that is defined as <code class="literal">type: enitity</code>.
</li>
</ul>
</div>
</li>
<li class="listitem">
All other fields, except for <code class="literal">@timestamp</code>, are moved to the <code class="literal">attributes</code> map.
</li>
<li class="listitem">
All non-array entries of the <code class="literal">attributes</code> and <code class="literal">resource.attributes</code> maps are flattened. Flattening means that nested objects are merged into their parent object, and the keys are concatenated with a dot. See examples below.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="normalize-for-stream-examples"></a>Examples</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.19/docs/reference/ingest/processors/normalize-for-stream.asciidoc">edit</a></div>
</div></div></div>
<p>If an OpenTelemetry-compliant document is detected, the processor does nothing. For example, the following document will stay unchanged:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "resource": {
    "attributes": {
      "service.name": "my-service"
    }
  },
  "scope": {
    "name": "my-library",
    "version": "1.0.0"
  },
  "attributes": {
    "http.method": "GET"
  },
  "body": {
    "text": "Hello, world!"
  }
}</pre>
</div>
<p>If a non-OpenTelemetry-compliant document is detected, the processor normalizes it. For example, the following document:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "@timestamp": "2023-10-01T12:00:00Z",
  "service": {
    "name": "my-service",
    "version": "1.0.0",
    "environment": "production",
    "language": {
      "name": "python",
      "version": "3.8"
    }
  },
  "log": {
    "level": "INFO"
  },
  "message": "Hello, world!",
  "http": {
    "method": "GET",
    "url": {
      "path": "/api/v1/resource"
    },
    "headers": [
      {
        "name": "Authorization",
        "value": "Bearer token"
      },
      {
        "name": "User-Agent",
        "value": "my-client/1.0"
      }
    ]
  },
  "span" : {
    "id": "1234567890abcdef"
  },
  "span.id": "abcdef1234567890",
  "trace.id": "abcdef1234567890abcdef1234567890"
}</pre>
</div>
<p>will be normalized into the following form:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "@timestamp": "2023-10-01T12:00:00Z",
  "resource": {
    "attributes": {
      "service.name": "my-service",
      "service.version": "1.0.0",
      "service.environment": "production"
    }
  },
  "attributes": {
    "service.language.name": "python",
    "service.language.version": "3.8",
    "http.method": "GET",
    "http.url.path": "/api/v1/resource",
    "http.headers": [
      {
        "name": "Authorization",
        "value": "Bearer token"
      },
      {
        "name": "User-Agent",
        "value": "my-client/1.0"
      }
    ]
  },
  "body": {
    "text": "Hello, world!"
  },
  "span_id": "1234567890abcdef",
  "trace_id": "abcdef1234567890abcdef1234567890"
}</pre>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="network-direction-processor.html">« Network direction processor</a>
</span>
<span class="next">
<a href="pipeline-processor.html">Pipeline processor »</a>
</span>
</div>
</body>
</html>
