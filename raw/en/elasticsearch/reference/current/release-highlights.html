<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch diagnostic, diagnostics">
<title>What&#8217;s new in 8.16 | Elasticsearch Guide [8.16] | Elastic</title>
<meta class="elastic" name="content" content="What&#8217;s new in 8.16 | Elasticsearch Guide [8.16]">

<link rel="home" href="index.html" title="Elasticsearch Guide [8.16]"/>
<link rel="up" href="breaking-changes.html" title="Migration guide"/>
<link rel="prev" href="transient-settings-migration-guide.html" title="Transient settings migration guide"/>
<link rel="next" href="es-release-notes.html" title="Release notes"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.16"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.16"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="transient-settings-migration-guide.html">« Transient settings migration guide</a>
</span>
<span class="next">
<a href="es-release-notes.html">Release notes »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="breaking-changes.html">Migration guide</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>What&#8217;s new in 8.16</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="release-highlights"></a>What&#8217;s new in 8.16</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
</div></div></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Coming in 8.16.</p>
</div>
</div>
<p>Here are the highlights of what&#8217;s new and improved in Elasticsearch 8.16!
For detailed information about this release, see the <a class="xref" href="es-release-notes.html" title="Release notes">Release notes</a> and
<a class="xref" href="breaking-changes.html" title="Migration guide">Migration guide</a>.</p>
<p>Other versions:</p>
<p><a href="/guide/en/elasticsearch/reference/8.15/release-highlights.html" class="ulink" target="_top">8.15</a>
| <a href="/guide/en/elasticsearch/reference/8.14/release-highlights.html" class="ulink" target="_top">8.14</a>
| <a href="/guide/en/elasticsearch/reference/8.13/release-highlights.html" class="ulink" target="_top">8.13</a>
| <a href="/guide/en/elasticsearch/reference/8.12/release-highlights.html" class="ulink" target="_top">8.12</a>
| <a href="/guide/en/elasticsearch/reference/8.11/release-highlights.html" class="ulink" target="_top">8.11</a>
| <a href="/guide/en/elasticsearch/reference/8.10/release-highlights.html" class="ulink" target="_top">8.10</a>
| <a href="/guide/en/elasticsearch/reference/8.9/release-highlights.html" class="ulink" target="_top">8.9</a>
| <a href="/guide/en/elasticsearch/reference/8.8/release-highlights.html" class="ulink" target="_top">8.8</a>
| <a href="/guide/en/elasticsearch/reference/8.7/release-highlights.html" class="ulink" target="_top">8.7</a>
| <a href="/guide/en/elasticsearch/reference/8.6/release-highlights.html" class="ulink" target="_top">8.6</a>
| <a href="/guide/en/elasticsearch/reference/8.5/release-highlights.html" class="ulink" target="_top">8.5</a>
| <a href="/guide/en/elasticsearch/reference/8.4/release-highlights.html" class="ulink" target="_top">8.4</a>
| <a href="/guide/en/elasticsearch/reference/8.3/release-highlights.html" class="ulink" target="_top">8.3</a>
| <a href="/guide/en/elasticsearch/reference/8.2/release-highlights.html" class="ulink" target="_top">8.2</a>
| <a href="/guide/en/elasticsearch/reference/8.1/release-highlights.html" class="ulink" target="_top">8.1</a>
| <a href="/guide/en/elasticsearch/reference/8.0/release-highlights.html" class="ulink" target="_top">8.0</a></p>
<div class="position-relative"><h3><a id="always_allow_rebalancing_by_default"></a>Always allow rebalancing by default</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
<p>In earlier versions of Elasticsearch the <code class="literal">cluster.routing.allocation.allow_rebalance</code> setting defaults to
<code class="literal">indices_all_active</code> which blocks all rebalancing moves while the cluster is in <code class="literal">yellow</code> or <code class="literal">red</code> health. This was
appropriate for the legacy allocator which might do too many rebalancing moves otherwise. Today&#8217;s allocator has
better support for rebalancing a cluster that is not in <code class="literal">green</code> health, and expects to be able to rebalance some
shards away from over-full nodes to avoid allocating shards to undesirable locations in the first place. From
version 8.16 <code class="literal">allow_rebalance</code> setting defaults to <code class="literal">always</code> unless the legacy allocator is explicitly enabled.</p>
<p><a href="https://github.com/elastic/elasticsearch/pull/111015" class="ulink" target="_top">#111015</a></p>
<div class="position-relative"><h3><a id="add_global_retention_in_data_stream_lifecycle"></a>Add global retention in data stream lifecycle</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
<p>Data stream lifecycle now supports configuring retention on a cluster level,
namely global retention. Global retention \nallows us to configure two different
retentions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">data_streams.lifecycle.retention.default</code> is applied to all data streams managed
by the data stream lifecycle that do not have retention defined on the data stream level.
</li>
<li class="listitem">
<code class="literal">data_streams.lifecycle.retention.max</code> is applied to all data streams managed by the
data stream lifecycle and it allows any data stream \ndata to be deleted after the <code class="literal">max_retention</code> has passed.
</li>
</ul>
</div>
<p><a href="https://github.com/elastic/elasticsearch/pull/111972" class="ulink" target="_top">#111972</a></p>
<div class="position-relative"><h3><a id="enable_zstandard_compression_for_indices_with_index_codec_set_to_best_compression"></a>Enable ZStandard compression for indices with index.codec set to best_compression</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
<p>Before DEFLATE compression was used to compress stored fields in indices with index.codec index setting set to
best_compression, with this change ZStandard is used as compression algorithm to stored fields for indices with
index.codec index setting set to best_compression. The usage ZStandard results in less storage usage with a
similar indexing throughput depending on what options are used. Experiments with indexing logs have shown that
ZStandard offers ~12% lower storage usage and a ~14% higher indexing throughput compared to DEFLATE.</p>
<p><a href="https://github.com/elastic/elasticsearch/pull/112665" class="ulink" target="_top">#112665</a></p>
<p>[[8_x_remove_zstd_feature_flag_for_index_codec_best_compression]]
=== [8.x] Remove zstd feature flag for index codec best compression
Backports the following commits to 8.x:  - Remove zstd feature flag for
index codec best compression. (#112665)</p>
<p><a href="https://github.com/elastic/elasticsearch/pull/112857" class="ulink" target="_top">#112857</a></p>
<div class="position-relative"><h3><a id="esql_introduce_per_agg_filter"></a>ESQL: Introduce per agg filter</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
<p>Add support for aggregation scoped filters that work dynamically on the
data in each group.</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">| STATS success = COUNT(*) WHERE 200 &lt;= code AND code &lt; 300,
        redirect = COUNT(*) WHERE 300 &lt;= code AND code &lt; 400,
        client_err = COUNT(*) WHERE 400 &lt;= code AND code &lt; 500,
        server_err = COUNT(*) WHERE 500 &lt;= code AND code &lt; 600,
        total_count = COUNT(*)</pre>
</div>
<p>Implementation wise, the base AggregateFunction has been extended to
allow a filter to be passed on. This is required to incorporate the
filter as part of the aggregate equality/identity which would fail with
the filter as an external component.
As part of the process, the serialization for the existing aggregations
had to be fixed so AggregateFunction implementations so that it
delegates to their parent first.</p>
<p><a href="https://github.com/elastic/elasticsearch/pull/113735" class="ulink" target="_top">#113735</a></p>
<div class="position-relative"><h3><a id="esql_multi_value_fields_supported_in_geospatial_predicates"></a>ESQL: Multi-value fields supported in Geospatial predicates</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
<p>Supporting multi-value fields in <code class="literal">WHERE</code> predicates is a challenge due to not knowing whether <code class="literal">ALL</code> or <code class="literal">ANY</code>
of the values in the field should pass the predicate.
For example, should the field <code class="literal">age:[10,30]</code> pass the predicate <code class="literal">WHERE age&gt;20</code> or not?
This ambiguity does not exist with the spatial predicates
<code class="literal">ST_INTERSECTS</code> and <code class="literal">ST_DISJOINT</code>, because the choice between <code class="literal">ANY</code> or <code class="literal">ALL</code>
is implied by the predicate itself.
Consider a predicate checking a field named <code class="literal">location</code> against a test geometry named <code class="literal">shape</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ST_INTERSECTS(field, shape)</code> - true if <code class="literal">ANY</code> value can intersect the shape
</li>
<li class="listitem">
<code class="literal">ST_DISJOINT(field, shape)</code> - true only if <code class="literal">ALL</code> values are disjoint from the shape
</li>
</ul>
</div>
<p>This works even if the shape argument is itself a complex or compound geometry.</p>
<p>Similar logic exists for <code class="literal">ST_CONTAINS</code> and <code class="literal">ST_WITHIN</code> predicates, but these are not as easily solved
with <code class="literal">ANY</code> or <code class="literal">ALL</code>, because a collection of geometries contains another collection if each of the contained
geometries is within at least one of the containing geometries. Evaluating this requires that the multi-value
field is first combined into a single geometry before performing the predicate check.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ST_CONTAINS(field, shape)</code> - true if the combined geometry contains the shape
</li>
<li class="listitem">
<code class="literal">ST_WITHIN(field, shape)</code> - true if the combined geometry is within the shape
</li>
</ul>
</div>
<p><a href="https://github.com/elastic/elasticsearch/pull/112063" class="ulink" target="_top">#112063</a></p>
<div class="position-relative"><h3><a id="enhance_sort_push_down_to_lucene_to_cover_references_to_fields_st_distance_function"></a>Enhance SORT push-down to Lucene to cover references to fields and ST_DISTANCE function</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
<p>The most used and likely most valuable geospatial search query in Elasticsearch is the sorted proximity search,
finding items within a certain distance of a point of interest and sorting the results by distance.
This has been possible in ES|QL since 8.15.0, but the sorting was done in-memory, not pushed down to Lucene.
Now the sorting is pushed down to Lucene, which results in a significant performance improvement.</p>
<p>Queries that perform both filtering and sorting on distance are supported. For example:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM test
| EVAL distance = ST_DISTANCE(location, TO_GEOPOINT("POINT(37.7749, -122.4194)"))
| WHERE distance &lt; 1000000
| SORT distance ASC, name DESC
| LIMIT 10</pre>
</div>
<p>In addition, the support for sorting on EVAL expressions has been extended to cover references to fields:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM test
| EVAL ref = field
| SORT ref ASC
| LIMIT 10</pre>
</div>
<p><a href="https://github.com/elastic/elasticsearch/pull/112938" class="ulink" target="_top">#112938</a></p>
<div class="position-relative"><h3><a id="cross_cluster_search_telemetry"></a>Cross-cluster search telemetry</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.16/docs/reference/release-notes/highlights.asciidoc">edit</a></div>
<p>The cross-cluster search telemetry is collected when cross-cluster searches
are performed, and is returned as "ccs" field in <code class="literal">_cluster/stats</code> output.
It also add a new parameter <code class="literal">include_remotes=true</code> to the <code class="literal">_cluster/stats</code> API
which will collect data from connected remote clusters.</p>
<p><a href="https://github.com/elastic/elasticsearch/pull/113825" class="ulink" target="_top">#113825</a></p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="transient-settings-migration-guide.html">« Transient settings migration guide</a>
</span>
<span class="next">
<a href="es-release-notes.html">Release notes »</a>
</span>
</div>
</body>
</html>
