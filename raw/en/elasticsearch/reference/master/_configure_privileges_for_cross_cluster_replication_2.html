<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configure privileges for cross-cluster replication | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Configure privileges for cross-cluster replication | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="ccr-getting-started-tutorial.html" title="Tutorial: Set up cross-cluster replication"/>
<link rel="prev" href="_connect_to_a_remote_cluster.html" title="Connect to a remote cluster"/>
<link rel="next" href="ccr-getting-started-follower-index.html" title="Create a follower index to replicate a specific index"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="_connect_to_a_remote_cluster.html">« Connect to a remote cluster</a>
</span>
<span class="next">
<a href="ccr-getting-started-follower-index.html">Create a follower index to replicate a specific index »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="xpack-ccr.html">Cross-cluster replication</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ccr-getting-started-tutorial.html">Tutorial: Set up cross-cluster replication</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configure privileges for cross-cluster replication</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/security/authentication/remote-clusters-privileges-cert.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="_configure_privileges_for_cross_cluster_replication_2"></a>Configure privileges for cross-cluster replication</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/security/authentication/remote-clusters-privileges-cert.asciidoc">edit</a></div>
</div></div></div>
<p>The cross-cluster replication user requires different cluster and index privileges on the remote
cluster and local cluster. Use the following requests to create separate roles
on the local and remote clusters, and then create a user with the required
roles.</p>
<div class="position-relative"><h4><a id="_remote_cluster_4"></a>Remote cluster</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/security/authentication/remote-clusters-privileges-cert.asciidoc">edit</a></div>
<p>On the remote cluster that contains the leader index, the cross-cluster replication role requires
the <code class="literal">read_ccr</code> cluster privilege, and <code class="literal">monitor</code> and <code class="literal">read</code> privileges on the
leader index.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If requests are authenticated with an <a class="xref" href="security-api-create-api-key.html" title="Create API key API">API key</a>, the API key
requires the above privileges on the <span class="strong strong"><strong>local</strong></span> cluster, instead of the remote.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If requests are issued <a class="xref" href="run-as-privilege.html" title="Submitting requests on behalf of other users">on behalf of other users</a>,
then the authenticating user must have the <code class="literal">run_as</code> privilege on the remote
cluster.</p>
</div>
</div>
<p>The following request creates a <code class="literal">remote-replication</code> role on the remote cluster:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.security.put_role(
    name="remote-replication",
    cluster=[
        "read_ccr"
    ],
    indices=[
        {
            "names": [
                "leader-index-name"
            ],
            "privileges": [
                "monitor",
                "read"
            ]
        }
    ],
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.security.putRole({
  name: "remote-replication",
  cluster: ["read_ccr"],
  indices: [
    {
      names: ["leader-index-name"],
      privileges: ["monitor", "read"],
    },
  ],
});
console.log(response);</pre>
</div>
<a id="b2dec193082462c775169db438308bc3"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST /_security/role/remote-replication
{
  "cluster": [
    "read_ccr"
  ],
  "indices": [
    {
      "names": [
        "leader-index-name"
      ],
      "privileges": [
        "monitor",
        "read"
      ]
    }
  ]
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2373.console"></div>
<div class="position-relative"><h4><a id="_local_cluster_4"></a>Local cluster</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/security/authentication/remote-clusters-privileges-cert.asciidoc">edit</a></div>
<p>On the local cluster that contains the follower index, the <code class="literal">remote-replication</code>
role requires the <code class="literal">manage_ccr</code> cluster privilege, and <code class="literal">monitor</code>, <code class="literal">read</code>, <code class="literal">write</code>,
and <code class="literal">manage_follow_index</code> privileges on the follower index.</p>
<p>The following request creates a <code class="literal">remote-replication</code> role on the local cluster:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.security.put_role(
    name="remote-replication",
    cluster=[
        "manage_ccr"
    ],
    indices=[
        {
            "names": [
                "follower-index-name"
            ],
            "privileges": [
                "monitor",
                "read",
                "write",
                "manage_follow_index"
            ]
        }
    ],
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.security.putRole({
  name: "remote-replication",
  cluster: ["manage_ccr"],
  indices: [
    {
      names: ["follower-index-name"],
      privileges: ["monitor", "read", "write", "manage_follow_index"],
    },
  ],
});
console.log(response);</pre>
</div>
<a id="cf9f51d719a2e90ffe36ed6fe56a4a69"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST /_security/role/remote-replication
{
  "cluster": [
    "manage_ccr"
  ],
  "indices": [
    {
      "names": [
        "follower-index-name"
      ],
      "privileges": [
        "monitor",
        "read",
        "write",
        "manage_follow_index"
      ]
    }
  ]
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2374.console"></div>
<p>After creating the <code class="literal">remote-replication</code> role on each cluster, use the
<a class="xref" href="security-api-put-user.html" title="Create or update users API">create or update users API</a> to create a user on
the local cluster cluster and assign the <code class="literal">remote-replication</code> role. For
example, the following request assigns the <code class="literal">remote-replication</code> role to a user
named <code class="literal">cross-cluster-user</code>:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.security.put_user(
    username="cross-cluster-user",
    password="l0ng-r4nd0m-p@ssw0rd",
    roles=[
        "remote-replication"
    ],
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.security.putUser({
  username: "cross-cluster-user",
  password: "l0ng-r4nd0m-p@ssw0rd",
  roles: ["remote-replication"],
});
console.log(response);</pre>
</div>
<a id="9d5855075e7008270459cc88c189043d"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">POST /_security/user/cross-cluster-user
{
  "password" : "l0ng-r4nd0m-p@ssw0rd",
  "roles" : [ "remote-replication" ]
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/2375.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You only need to create this user on the <span class="strong strong"><strong>local</strong></span> cluster.</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="_connect_to_a_remote_cluster.html">« Connect to a remote cluster</a>
</span>
<span class="next">
<a href="ccr-getting-started-follower-index.html">Create a follower index to replicate a specific index »</a>
</span>
</div>
</body>
</html>
