<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Watcher index action | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Watcher index action | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="actions.html" title="Watcher actions"/>
<link rel="prev" href="actions-webhook.html" title="Watcher webhook action"/>
<link rel="next" href="actions-logging.html" title="Watcher logging Action"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="actions-webhook.html">« Watcher webhook action</a>
</span>
<span class="next">
<a href="actions-logging.html">Watcher logging Action »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="xpack-alerting.html">Watcher</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="actions.html">Watcher actions</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Watcher index action</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/watcher/actions/index.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="actions-index"></a>Watcher index action<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/watcher/actions/index.asciidoc">edit</a></h2>
</div></div></div>

<p>Use the <code class="literal">index</code> action to index data into Elasticsearch.
See <a class="xref" href="actions-index.html#index-action-attributes" title="Index action attributes">Index action attributes</a> for the supported attributes.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_configuring_index_actions"></a>Configuring index actions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/watcher/actions/index.asciidoc">edit</a></h3>
</div></div></div>
<p>The following snippet shows a simple <code class="literal">index</code> action definition:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">"actions" : {
  "index_payload" : { <a id="CO689-1"></a><i class="conum" data-value="1"></i>
    "condition": { ... }, <a id="CO689-2"></a><i class="conum" data-value="2"></i>
    "transform": { ... }, <a id="CO689-3"></a><i class="conum" data-value="3"></i>
    "index" : {
      "index" : "my-index-000001", <a id="CO689-4"></a><i class="conum" data-value="4"></i>
      "doc_id": "my-id" <a id="CO689-5"></a><i class="conum" data-value="5"></i>
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The id of the action</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>An optional <a class="xref" href="condition.html" title="Watcher conditions">condition</a> to restrict action execution</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>An optional <a class="xref" href="transform.html" title="Payload transforms">transform</a> to transform the payload and prepare the data that should be indexed</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The index, alias, or data stream to which the data will be written</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO689-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>An optional <code class="literal">_id</code> for the document</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="index-action-attributes"></a>Index action attributes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/watcher/actions/index.asciidoc">edit</a></h3>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Required</th>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">index</code></p></td>
<td align="left" valign="top"><p>yes<sup>*</sup></p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top">
<p>The index, alias, or data stream to index into. Date math expressions like <code class="literal">&lt;my-index-{now/d}&gt;</code> are also supported.</p>
<p><sup>*</sup>If you dynamically set an <code class="literal">_index</code> value, this parameter isn&#8217;t required. See
<a class="xref" href="actions-index.html#anatomy-actions-index-multi-doc-support" title="Multi-document support">Multi-document support</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">doc_id</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The optional <code class="literal">_id</code> of the document.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">op_type</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p><code class="literal">index</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="docs-index_.html#docs-index-api-op_type">op_type</a> for the index operation.
                                                      Must be one of either <code class="literal">index</code> or <code class="literal">create</code>. Must be <code class="literal">create</code> if
                                                      <code class="literal">index</code> is a data stream.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">execution_time_field</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>The field that will store/index the watch execution
                                                      time.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">timeout</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>60s</p></td>
<td align="left" valign="top"><p>The timeout for waiting for the index api call to
                                                      return. If no response is returned within this time,
                                                      the index action times out and fails. This setting
                                                      overrides the default timeouts.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">refresh</code></p></td>
<td align="left" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>-</p></td>
<td align="left" valign="top"><p>Optional setting of the <a href="/guide/en/elasticsearch/reference/master/docs-refresh.html" class="ulink" target="_top">refresh policy</a>
                                                      for the write request</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="anatomy-actions-index-multi-doc-support"></a>Multi-document support<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/watcher/actions/index.asciidoc">edit</a></h3>
</div></div></div>
<p>Like with all other actions, you can use a <a class="xref" href="transform.html" title="Payload transforms">transform</a> to replace
the current execution context payload with another and by that change the document
that will end up indexed.</p>
<p>The index action plays well with transforms with its support for the special <code class="literal">_doc</code>
payload field.</p>
<p>When resolving the document to be indexed, the index action first looks up for a
<code class="literal">_doc</code> field in the payload. When not found, the payload is indexed as a single
document.</p>
<p>When a <code class="literal">_doc</code> field exists, if the field holds an object, it is extracted and indexed
as a single document. If the field holds an array of objects, each object is treated as
a document and the index action indexes all of them in a bulk.</p>
<p>An <code class="literal">_index</code>, or <code class="literal">_id</code> value can be added per document to dynamically set the index and ID
of the indexed document.</p>
<p>The following snippet shows a multi-document <code class="literal">index</code> action definition:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">"actions": {
  "index_payload": {
    "transform": {
      "script": """
      def documents = ctx.payload.hits.hits.stream()
        .map(hit -&gt; [
          "_index": "my-index-000001", <a id="CO690-1"></a><i class="conum" data-value="1"></i>
          "_id": hit._id, <a id="CO690-2"></a><i class="conum" data-value="2"></i>
          "severity": "Sev: " + hit._source.severity <a id="CO690-3"></a><i class="conum" data-value="3"></i>
        ])
        .collect(Collectors.toList());
      return [ "_doc" : documents]; <a id="CO690-4"></a><i class="conum" data-value="4"></i>
      """
    },
    "index": {} <a id="CO690-5"></a><i class="conum" data-value="5"></i>
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO690-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The document&#8217;s index</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO690-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>An optional <code class="literal">_id</code> for the document</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO690-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>A new <code class="literal">severity</code> field derived from the original document</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO690-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The payload <code class="literal">_doc</code> field which is an array of documents</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO690-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Since the <code class="literal">_index</code> was informed per document this should be empty</p>
</td>
</tr>
</table>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="actions-webhook.html">« Watcher webhook action</a>
</span>
<span class="next">
<a href="actions-logging.html">Watcher logging Action »</a>
</span>
</div>
</body>
</html>
