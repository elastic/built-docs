<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Set JVM options | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Set JVM options | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="settings.html" title="Configuring Elasticsearch"/>
<link rel="prev" href="notification-settings.html" title="Watcher settings in Elasticsearch"/>
<link rel="next" href="system-config.html" title="Important system configuration"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="notification-settings.html">« Watcher settings in Elasticsearch</a>
</span>
<span class="next">
<a href="system-config.html">Important system configuration »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="settings.html">Configuring Elasticsearch</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Set JVM options</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/advanced-configuration.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="advanced-configuration"></a>Set JVM options</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/advanced-configuration.asciidoc">edit</a></div>
</div></div></div>
<p><a id="set-jvm-options"></a>If needed, you can override the default JVM options by adding custom options
files (preferred) or setting the <code class="literal">ES_JAVA_OPTS</code> environment variable.</p>
<p>JVM options files must have the suffix <em>.options</em> and contain a line-delimited
list of JVM arguments. JVM processes options files in lexicographic order.</p>
<p>Where you put the JVM options files depends on the type of installation:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
tar.gz or .zip: Add custom JVM options files to <code class="literal">config/jvm.options.d/</code>.
</li>
<li class="listitem">
Debian or RPM: Add custom JVM options files to <code class="literal">/etc/elasticsearch/jvm.options.d/</code>.
</li>
<li class="listitem">
Docker: Bind mount custom JVM options files into
<code class="literal">/usr/share/elasticsearch/config/jvm.options.d/</code>.
</li>
</ul>
</div>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>Setting your own JVM options is generally not recommended and could negatively
impact performance and stability. Using the Elasticsearch-provided defaults
is recommended in most circumstances.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<a id="readiness-tcp-port"></a>
<p>Do not modify the root <code class="literal">jvm.options</code> file. Use files in <code class="literal">jvm.options.d/</code> instead.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="jvm-options-syntax"></a>JVM options syntax</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/advanced-configuration.asciidoc">edit</a></div>
</div></div></div>
<p>A JVM options file contains a line-delimited list of JVM arguments.
Arguments are preceded by a dash (<code class="literal">-</code>).
To apply the setting to specific versions, prepend the version
or a range of versions followed by a colon.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Apply a setting to all versions:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">-Xmx2g</pre>
</div>
</li>
<li class="listitem">
<p>Apply a setting to a specific version:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">17:-Xmx2g</pre>
</div>
</li>
<li class="listitem">
<p>Apply a setting to a range of versions:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">17-18:-Xmx2g</pre>
</div>
<p>To apply a setting to a specific version and any later versions,
omit the upper bound of the range.
For example, this setting applies to Java 17 and later:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">17-:-Xmx2g</pre>
</div>
</li>
</ul>
</div>
<p>Blank lines are ignored. Lines beginning with <code class="literal">#</code> are treated as comments
and ignored. Lines that aren&#8217;t commented out and aren&#8217;t recognized
as valid JVM arguments are rejected and Elasticsearch will fail to start.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="jvm-options-env"></a>Use environment variables to set JVM options</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/advanced-configuration.asciidoc">edit</a></div>
</div></div></div>
<p>In production, use JVM options files to override the
default settings. In testing and development environments,
you can also set JVM options through the <code class="literal">ES_JAVA_OPTS</code> environment variable.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">export ES_JAVA_OPTS="$ES_JAVA_OPTS -Djava.io.tmpdir=/path/to/temp/dir"
./bin/elasticsearch</pre>
</div>
<p>If you&#8217;re using the RPM or Debian packages, you can specify
<code class="literal">ES_JAVA_OPTS</code> in the <a class="xref" href="setting-system-settings.html#sysconfig" title="Sysconfig file">system configuration file</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elasticsearch ignores the <code class="literal">JAVA_TOOL_OPTIONS</code> and <code class="literal">JAVA_OPTS</code> environment variables.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="set-jvm-heap-size"></a>Set the JVM heap size</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/advanced-configuration.asciidoc">edit</a></div>
</div></div></div>
<p>By default, Elasticsearch automatically sets the JVM heap size based on a node&#8217;s
<a class="xref" href="modules-node.html#node-roles" title="Node role settings">roles</a> and total memory.
Using the default sizing is recommended for most production environments.</p>
<p>To override the default heap size, set the minimum and maximum heap size
settings, <code class="literal">Xms</code> and <code class="literal">Xmx</code>. The minimum and maximum values must be the same.</p>
<p>The heap size should be based on the available RAM:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Set <code class="literal">Xms</code> and <code class="literal">Xmx</code> to no more than 50% of your total memory. Elasticsearch requires
memory for purposes other than the JVM heap. For example, Elasticsearch uses
off-heap buffers for efficient network communication and relies
on the operating system&#8217;s filesystem cache for
efficient access to files. The JVM itself also requires some memory. It&#8217;s
normal for Elasticsearch to use more memory than the limit
configured with the <code class="literal">Xmx</code> setting.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When running in a container, such as <a class="xref" href="docker.html" title="Install Elasticsearch with Docker">Docker</a>, total memory is
defined as the amount of memory visible to the container, not the total system
memory on the host.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Set <code class="literal">Xms</code> and <code class="literal">Xmx</code> to no more than the threshold for compressed ordinary
object pointers (oops). The exact threshold varies but 26GB is safe on most
systems and can be as large as 30GB on some systems. To verify you are under the
threshold, check the Elasticsearch log for an entry like this:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">heap size [1.9gb], compressed ordinary object pointers [true]</pre>
</div>
<p>Or check the <code class="literal">jvm.using_compressed_ordinary_object_pointers</code> value for the nodes using the <a class="xref" href="cluster-nodes-info.html" title="Nodes info API">nodes info API</a>:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.nodes.info(
    node_id="_all",
    metric="jvm",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.nodes.info(
  node_id: '_all',
  metric: 'jvm'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.nodes.info({
  node_id: "_all",
  metric: "jvm",
});
console.log(response);</pre>
</div>
<a id="7cd23457e220c8b64c5b0041d2acc27a"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET _nodes/_all/jvm</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/43.console"></div>
</li>
</ul>
</div>
<p>The more heap available to Elasticsearch, the more memory it can use for its internal
caches. This leaves less memory for the operating system to use
for the filesystem cache. Larger heaps can also cause longer garbage
collection pauses.</p>
<p>To configure the heap size, add the <code class="literal">Xms</code> and <code class="literal">Xmx</code> JVM arguments to a
custom JVM options file with the extension <code class="literal">.options</code> and
store it in the <code class="literal">jvm.options.d/</code> directory.
For example, to set the maximum heap size to 2GB, set both <code class="literal">Xms</code> and <code class="literal">Xmx</code> to <code class="literal">2g</code>:</p>
<div class="pre_wrapper lang-txt">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-txt">-Xms2g
-Xmx2g</pre>
</div>
<p>For testing, you can also set the heap sizes using the <code class="literal">ES_JAVA_OPTS</code>
environment variable:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">ES_JAVA_OPTS="-Xms2g -Xmx2g" ./bin/elasticsearch</pre>
</div>
<p>The <code class="literal">ES_JAVA_OPTS</code> variable overrides all other JVM
options. We do not recommend using <code class="literal">ES_JAVA_OPTS</code> in production.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are running Elasticsearch as a Windows service, you can change the heap size
using the service manager. See <a class="xref" href="zip-windows.html#windows-service" title="Install and run Elasticsearch as a service on Windows">Install and run Elasticsearch as a service on Windows</a>.</p>
</div>
</div>
<div class="position-relative"><h3><a id="heap-dump-path-setting"></a>JVM heap dump path setting</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/important-settings/heap-dump-path.asciidoc">edit</a></div>
<p>By default, Elasticsearch configures the JVM to dump the heap on out of
memory exceptions to the default data directory. On <a class="xref" href="rpm.html" title="Install Elasticsearch with RPM">RPM</a> and
<a class="xref" href="deb.html" title="Install Elasticsearch with Debian Package">Debian</a> packages, the data directory is <code class="literal">/var/lib/elasticsearch</code>. On
<a class="xref" href="targz.html" title="Install Elasticsearch from archive on Linux or MacOS">Linux and MacOS</a> and <a class="xref" href="zip-windows.html" title="Install Elasticsearch with .zip on Windows">Windows</a> distributions,
the <code class="literal">data</code> directory is located under the root of the Elasticsearch installation.</p>
<p>If this path is not suitable for receiving heap dumps, modify the
<code class="literal">-XX:HeapDumpPath=...</code> entry in <a class="xref" href="advanced-configuration.html#set-jvm-options"><code class="literal">jvm.options</code></a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If you specify a directory, the JVM will generate a filename for the heap
dump based on the PID of the running instance.
</li>
<li class="listitem">
If you specify a fixed filename instead of a directory, the file must
not exist when the JVM needs to perform a heap dump on an out of memory
exception. Otherwise, the heap dump will fail.
</li>
</ul>
</div>
<div class="position-relative"><h3><a id="gc-logging"></a>GC logging settings</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/important-settings/gc-logging.asciidoc">edit</a></div>
<p>By default, Elasticsearch enables garbage collection (GC) logs. These are configured in
<a class="xref" href="advanced-configuration.html#set-jvm-options"><code class="literal">jvm.options</code></a> and output to the same default location as
the Elasticsearch logs. The default configuration rotates the logs every 64 MB and
can consume up to 2 GB of disk space.</p>
<p>You can reconfigure JVM logging using the command line options described in
<a href="https://openjdk.java.net/jeps/158" class="ulink" target="_top">JEP 158: Unified JVM Logging</a>. Unless you
change the default <code class="literal">jvm.options</code> file directly, the Elasticsearch default
configuration is applied in addition to your own settings. To disable the
default configuration, first disable logging by supplying the
<code class="literal">-Xlog:disable</code> option, then supply your own command line options. This
disables <em>all</em> JVM logging, so be sure to review the available options
and enable everything that you require.</p>
<p>To see further options not contained in the original JEP, see
<a href="https://docs.oracle.com/en/java/javase/13/docs/specs/man/java.html#enable-logging-with-the-jvm-unified-logging-framework" class="ulink" target="_top">Enable
Logging with the JVM Unified Logging Framework</a>.</p>
<div class="position-relative"><h4><a id="_examples_2"></a>Examples</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/important-settings/gc-logging.asciidoc">edit</a></div>
<p>Change the default GC log output location to <code class="literal">/opt/my-app/gc.log</code> by
  creating <code class="literal">$ES_HOME/config/jvm.options.d/gc.options</code> with some sample
  options:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell"># Turn off all previous logging configuratons
-Xlog:disable

# Default settings from JEP 158, but with `utctime` instead of `uptime` to match the next line
-Xlog:all=warning:stderr:utctime,level,tags

# Enable GC logging to a custom location with a variety of options
-Xlog:gc*,gc+age=trace,safepoint:file=/opt/my-app/gc.log:utctime,level,pid,tags:filecount=32,filesize=64m</pre>
</div>
<p>Configure an Elasticsearch <a class="xref" href="docker.html" title="Install Elasticsearch with Docker">Docker container</a> to send GC debug logs to
  standard error (<code class="literal">stderr</code>). This lets the container orchestrator
  handle the output. If using the <code class="literal">ES_JAVA_OPTS</code> environment variable,
  specify:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">MY_OPTS="-Xlog:disable -Xlog:all=warning:stderr:utctime,level,tags -Xlog:gc=debug:stderr:utctime"
docker run -e ES_JAVA_OPTS="$MY_OPTS" # etc</pre>
</div>
<div class="position-relative"><h3><a id="error-file-path"></a>JVM fatal error log setting</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/setup/important-settings/error-file.asciidoc">edit</a></div>
<p>By default, Elasticsearch configures the JVM to write fatal error logs
to the default logging directory. On <a class="xref" href="rpm.html" title="Install Elasticsearch with RPM">RPM</a> and <a class="xref" href="deb.html" title="Install Elasticsearch with Debian Package">Debian</a> packages,
this directory is <code class="literal">/var/log/elasticsearch</code>. On <a class="xref" href="targz.html" title="Install Elasticsearch from archive on Linux or MacOS">Linux and MacOS</a> and <a class="xref" href="zip-windows.html" title="Install Elasticsearch with .zip on Windows">Windows</a> distributions, the <code class="literal">logs</code>
directory is located under the root of the Elasticsearch installation.</p>
<p>These are logs produced by the JVM when it encounters a fatal error, such as a
segmentation fault. If this path is not suitable for receiving logs,
modify the <code class="literal">-XX:ErrorFile=...</code> entry in <a class="xref" href="advanced-configuration.html#set-jvm-options"><code class="literal">jvm.options</code></a>.</p>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="notification-settings.html">« Watcher settings in Elasticsearch</a>
</span>
<span class="next">
<a href="system-config.html">Important system configuration »</a>
</span>
</div>
</body>
</html>
