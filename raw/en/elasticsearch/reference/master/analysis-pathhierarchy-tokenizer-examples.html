<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Path Hierarchy Tokenizer Examples | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="analysis-tokenizers.html" title="Tokenizer reference"/>
<link rel="prev" href="analysis-pathhierarchy-tokenizer.html" title="Path Hierarchy Tokenizer"/>
<link rel="next" href="analysis-pattern-tokenizer.html" title="Pattern Tokenizer"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="analysis.html">Text analysis</a></span>
»
<span class="breadcrumb-link"><a href="analysis-tokenizers.html">Tokenizer reference</a></span>
»
<span class="breadcrumb-node">Path Hierarchy Tokenizer Examples</span>
</div>
<div class="navheader">
<span class="prev">
<a href="analysis-pathhierarchy-tokenizer.html">« Path Hierarchy Tokenizer</a>
</span>
<span class="next">
<a href="analysis-pattern-tokenizer.html">Pattern Tokenizer »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="analysis-pathhierarchy-tokenizer-examples"></a>Path Hierarchy Tokenizer Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/analysis/tokenizers/pathhierarchy-tokenizer-examples.asciidoc">edit</a></h2>
</div></div></div>
<p>A common use-case for the <code class="literal">path_hierarchy</code> tokenizer is filtering results by
file paths. If indexing a file path along with the data, the use of the
<code class="literal">path_hierarchy</code> tokenizer to analyze the path allows filtering the results
by different parts of the file path string.</p>
<p>This example configures an index to have two custom analyzers and applies
those analyzers to multifields of the <code class="literal">file_path</code> text field that will
store filenames. One of the two analyzers uses reverse tokenization.
Some sample documents are then indexed to represent some file paths
for photos inside photo folders of two different users.</p>
<a id="840b6c5c3d9c56aed854cfab8da04486"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT file-path-test
{
  "settings": {
    "analysis": {
      "analyzer": {
        "custom_path_tree": {
          "tokenizer": "custom_hierarchy"
        },
        "custom_path_tree_reversed": {
          "tokenizer": "custom_hierarchy_reversed"
        }
      },
      "tokenizer": {
        "custom_hierarchy": {
          "type": "path_hierarchy",
          "delimiter": "/"
        },
        "custom_hierarchy_reversed": {
          "type": "path_hierarchy",
          "delimiter": "/",
          "reverse": "true"
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "file_path": {
        "type": "text",
        "fields": {
          "tree": {
            "type": "text",
            "analyzer": "custom_path_tree"
          },
          "tree_reversed": {
            "type": "text",
            "analyzer": "custom_path_tree_reversed"
          }
        }
      }
    }
  }
}

POST file-path-test/_doc/1
{
  "file_path": "/User/alice/photos/2017/05/16/my_photo1.jpg"
}

POST file-path-test/_doc/2
{
  "file_path": "/User/alice/photos/2017/05/16/my_photo2.jpg"
}

POST file-path-test/_doc/3
{
  "file_path": "/User/alice/photos/2017/05/16/my_photo3.jpg"
}

POST file-path-test/_doc/4
{
  "file_path": "/User/alice/photos/2017/05/15/my_photo1.jpg"
}

POST file-path-test/_doc/5
{
  "file_path": "/User/bob/photos/2017/05/16/my_photo1.jpg"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/892.console"></div>
<p>A search for a particular file path string against the text field matches all
the example documents, with Bob&#8217;s documents ranking highest due to <code class="literal">bob</code> also
being one of the terms created by the standard analyzer boosting relevance for
Bob&#8217;s documents.</p>
<a id="bd767ea03171fe71c73f58f16d5da92f"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET file-path-test/_search
{
  "query": {
    "match": {
      "file_path": "/User/bob/photos/2017/05"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/893.console"></div>
<p>It&#8217;s simple to match or filter documents with file paths that exist within a
particular directory using the <code class="literal">file_path.tree</code> field.</p>
<a id="b724f547c5d67e95bbc0a9920e47033c"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET file-path-test/_search
{
  "query": {
    "term": {
      "file_path.tree": "/User/alice/photos/2017/05/16"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/894.console"></div>
<p>With the reverse parameter for this tokenizer, it&#8217;s also possible to match
from the other end of the file path, such as individual file names or a deep
level subdirectory. The following example shows a search for all files named
<code class="literal">my_photo1.jpg</code> within any directory via the <code class="literal">file_path.tree_reversed</code> field
configured to use the reverse parameter in the mapping.</p>
<a id="f1dc6f69453867ffafe86e998dd464d9"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET file-path-test/_search
{
  "query": {
    "term": {
      "file_path.tree_reversed": {
        "value": "my_photo1.jpg"
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/895.console"></div>
<p>Viewing the tokens generated with both forward and reverse is instructive
in showing the tokens created for the same file path value.</p>
<a id="acc52da725a996ae696b00d9f818dfde"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST file-path-test/_analyze
{
  "analyzer": "custom_path_tree",
  "text": "/User/alice/photos/2017/05/16/my_photo1.jpg"
}

POST file-path-test/_analyze
{
  "analyzer": "custom_path_tree_reversed",
  "text": "/User/alice/photos/2017/05/16/my_photo1.jpg"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/896.console"></div>
<p>It&#8217;s also useful to be able to filter with file paths when combined with other
types of searches, such as this example looking for any files paths with <code class="literal">16</code>
that also must be in Alice&#8217;s photo directory.</p>
<a id="4bba59cf745ac7b996bf90308bc26957"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET file-path-test/_search
{
  "query": {
    "bool" : {
      "must" : {
        "match" : { "file_path" : "16" }
      },
      "filter": {
        "term" : { "file_path.tree" : "/User/alice" }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/897.console"></div>
</div>
<div class="navfooter">
<span class="prev">
<a href="analysis-pathhierarchy-tokenizer.html">« Path Hierarchy Tokenizer</a>
</span>
<span class="next">
<a href="analysis-pattern-tokenizer.html">Pattern Tokenizer »</a>
</span>
</div>
</div>
</body>
</html>
