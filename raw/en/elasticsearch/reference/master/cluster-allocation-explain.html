<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch diagnostic, diagnostics">
<title>Cluster allocation explain API | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Cluster allocation explain API | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="cluster.html" title="Cluster APIs"/>
<link rel="prev" href="cluster.html" title="Cluster APIs"/>
<link rel="next" href="cluster-get-settings.html" title="Cluster get settings API"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="cluster.html">« Cluster APIs</a>
</span>
<span class="next">
<a href="cluster-get-settings.html">Cluster get settings API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Cluster allocation explain API</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="cluster-allocation-explain"></a>Cluster allocation explain API</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>

<p>Provides an explanation for a shard&#8217;s current <a class="xref" href="index-modules-allocation.html" title="Index Shard Allocation">allocation</a>.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.cluster.allocation_explain(
    index="my-index-000001",
    shard=0,
    primary=False,
    current_node="my-node",
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.cluster.allocation_explain(
  body: {
    index: 'my-index-000001',
    shard: 0,
    primary: false,
    current_node: 'my-node'
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.cluster.allocationExplain({
  index: "my-index-000001",
  shard: 0,
  primary: false,
  current_node: "my-node",
});
console.log(response);</pre>
</div>
<a id="1cecd4d87a92427175157d41859df2af"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET _cluster/allocation/explain
{
  "index": "my-index-000001",
  "shard": 0,
  "primary": false,
  "current_node": "my-node"
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/2389.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="cluster-allocation-explain-api-request"></a>Request</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p><code class="literal">GET _cluster/allocation/explain</code></p>
<p><code class="literal">POST _cluster/allocation/explain</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="cluster-allocation-explain-api-prereqs"></a>Prerequisites</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the <code class="literal">monitor</code> or
<code class="literal">manage</code> <a class="xref" href="security-privileges.html#privileges-list-cluster" title="Cluster privileges">cluster privilege</a> to use this API.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="cluster-allocation-explain-api-desc"></a>Description</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>The purpose of the cluster allocation explain API is to provide
explanations for shard allocations in the cluster. For unassigned shards,
the explain API provides an explanation for why the shard is unassigned.
For assigned shards, the explain API provides an explanation for why the
shard is remaining on its current node and has not moved or rebalanced to
another node. This API can be very useful when attempting to diagnose why a
shard is unassigned or why a shard continues to remain on its current node when
you might expect otherwise.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="cluster-allocation-explain-api-query-params"></a>Query parameters</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">include_disk_info</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns information about disk usage and
shard sizes. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">include_yes_decisions</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns <em>YES</em> decisions in explanation.
Defaults to <code class="literal">false</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="cluster-allocation-explain-api-request-body"></a>Request body</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">current_node</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the node ID or the name of the node currently
holding the shard to explain. To explain an unassigned shard, omit this
parameter.
</dd>
<dt>
<span class="term">
<code class="literal">index</code>
</span>
</dt>
<dd>
(Optional, string) Specifies the name of the index that you would like an
explanation for.
</dd>
<dt>
<span class="term">
<code class="literal">primary</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, returns explanation for the primary shard
for the given shard ID.
</dd>
<dt>
<span class="term">
<code class="literal">shard</code>
</span>
</dt>
<dd>
(Optional, integer) Specifies the ID of the shard that you would like an
explanation for.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="cluster-allocation-explain-api-examples"></a>Examples</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_unassigned_primary_shard"></a>Unassigned primary shard</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="_conflicting_settings"></a>Conflicting settings</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>The following request gets an allocation explanation for an unassigned primary
shard.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.cluster.allocation_explain(
    index="my-index-000001",
    shard=0,
    primary=True,
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.cluster.allocation_explain(
  body: {
    index: 'my-index-000001',
    shard: 0,
    primary: true
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.cluster.allocationExplain({
  index: "my-index-000001",
  shard: 0,
  primary: true,
});
console.log(response);</pre>
</div>
<a id="ab8de34fcfc0277901cb39618ecfc9d5"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET _cluster/allocation/explain
{
  "index": "my-index-000001",
  "shard": 0,
  "primary": true
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/2390.console"></div>
<p>The API response indicates the shard can only be allocated to a nonexistent
node.</p>
<a id="fcfd33f9e624b6f54245f4067401b2da"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "index" : "my-index-000001",
  "shard" : 0,
  "primary" : true,
  "current_state" : "unassigned",                 <a id="CO764-1"></a><i class="conum" data-value="1"></i>
  "unassigned_info" : {
    "reason" : "INDEX_CREATED",                   <a id="CO764-2"></a><i class="conum" data-value="2"></i>
    "at" : "2017-01-04T18:08:16.600Z",
    "last_allocation_status" : "no"
  },
  "can_allocate" : "no",                          <a id="CO764-3"></a><i class="conum" data-value="3"></i>
  "allocate_explanation" : "Elasticsearch isn't allowed to allocate this shard to any of the nodes in the cluster. Choose a node to which you expect this shard to be allocated, find this node in the node-by-node explanation, and address the reasons which prevent Elasticsearch from allocating this shard there.",
  "node_allocation_decisions" : [
    {
      "node_id" : "8qt2rY-pT6KNZB3-hGfLnw",
      "node_name" : "node-0",
      "transport_address" : "127.0.0.1:9401",
      "roles" : ["data", "data_cold", "data_content", "data_frozen", "data_hot", "data_warm", "ingest", "master", "ml", "remote_cluster_client", "transform"],
      "node_attributes" : {},
      "node_decision" : "no",                     <a id="CO764-4"></a><i class="conum" data-value="4"></i>
      "weight_ranking" : 1,
      "deciders" : [
        {
          "decider" : "filter",                   <a id="CO764-5"></a><i class="conum" data-value="5"></i>
          "decision" : "NO",
          "explanation" : "node does not match index setting [index.routing.allocation.include] filters [_name:\"nonexistent_node\"]"  <a id="CO764-6"></a><i class="conum" data-value="6"></i>
        }
      ]
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO764-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The current state of the shard.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO764-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The reason for the shard originally becoming unassigned.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO764-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether to allocate the shard.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO764-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether to allocate the shard to the particular node.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO764-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>The decider which led to the <code class="literal">no</code> decision for the node.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO764-6"><i class="conum" data-value="6"></i></a></p>
</td>
<td align="left" valign="top">
<p>An explanation as to why the decider returned a <code class="literal">no</code> decision, with a helpful hint pointing to the setting that led to the decision. In this example, a newly created index has <a class="xref" href="indices-get-settings.html" title="Get index settings API">an index setting</a> that requires that it only be allocated to a node named <code class="literal">nonexistent_node</code>, which does not exist, so the index is unable to allocate.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="_maximum_number_of_retries_exceeded"></a>Maximum number of retries exceeded</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>The following response contains an allocation explanation for an unassigned
primary shard that has reached the maximum number of allocation retry attempts.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "index" : "my-index-000001",
  "shard" : 0,
  "primary" : true,
  "current_state" : "unassigned",
  "unassigned_info" : {
    "at" : "2017-01-04T18:03:28.464Z",
    "failed shard on node [mEKjwwzLT1yJVb8UxT6anw]: failed recovery, failure RecoveryFailedException",
    "reason": "ALLOCATION_FAILED",
    "failed_allocation_attempts": 5,
    "last_allocation_status": "no",
  },
  "can_allocate": "no",
  "allocate_explanation": "cannot allocate because allocation is not permitted to any of the nodes",
  "node_allocation_decisions" : [
    {
      "node_id" : "3sULLVJrRneSg0EfBB-2Ew",
      "node_name" : "node_t0",
      "transport_address" : "127.0.0.1:9400",
      "roles" : ["data_content", "data_hot"],
      "node_decision" : "no",
      "store" : {
        "matching_size" : "4.2kb",
        "matching_size_in_bytes" : 4325
      },
      "deciders" : [
        {
          "decider": "max_retry",
          "decision" : "NO",
          "explanation": "shard has exceeded the maximum number of retries [5] on failed allocation attempts - manually call [/_cluster/reroute?retry_failed=true] to retry, [unassigned_info[[reason=ALLOCATION_FAILED], at[2024-07-30T21:04:12.166Z], failed_attempts[5], failed_nodes[[mEKjwwzLT1yJVb8UxT6anw]], delayed=false, details[failed shard on node [mEKjwwzLT1yJVb8UxT6anw]: failed recovery, failure RecoveryFailedException], allocation_status[deciders_no]]]"
        }
      ]
    }
  ]
}</pre>
</div>
<p>If decider message indicates a transient allocation issue, use
<a class="xref" href="cluster-reroute.html" title="Cluster reroute API">the cluster reroute API</a> to retry allocation.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="_no_valid_shard_copy"></a>No valid shard copy</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>The following response contains an allocation explanation for an unassigned
primary shard that was previously allocated.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "index" : "my-index-000001",
  "shard" : 0,
  "primary" : true,
  "current_state" : "unassigned",
  "unassigned_info" : {
    "reason" : "NODE_LEFT",
    "at" : "2017-01-04T18:03:28.464Z",
    "details" : "node_left[OIWe8UhhThCK0V5XfmdrmQ]",
    "last_allocation_status" : "no_valid_shard_copy"
  },
  "can_allocate" : "no_valid_shard_copy",
  "allocate_explanation" : "Elasticsearch can't allocate this shard because there are no copies of its data in the cluster. Elasticsearch will allocate this shard when a node holding a good copy of its data joins the cluster. If no such node is available, restore this index from a recent snapshot."
}</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a shard is unassigned with an allocation status of <code class="literal">no_valid_shard_copy</code>, then you should <a class="xref" href="red-yellow-cluster-status.html#fix-cluster-status-recover-nodes" title="Recover lost nodes">make sure that all nodes are in the cluster</a>. If all the nodes containing in-sync copies of a shard are lost, then you can <a class="xref" href="red-yellow-cluster-status.html#fix-cluster-status-restore" title="Recover data for a lost primary shard">recover the data for the shard</a>.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_unassigned_replica_shard"></a>Unassigned replica shard</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="_allocation_delayed"></a>Allocation delayed</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>The following response contains an allocation explanation for a replica that&#8217;s
unassigned due to <a class="xref" href="delayed-allocation.html" title="Delaying allocation when a node leaves">delayed allocation</a>.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "index" : "my-index-000001",
  "shard" : 0,
  "primary" : false,
  "current_state" : "unassigned",
  "unassigned_info" : {
    "reason" : "NODE_LEFT",
    "at" : "2017-01-04T18:53:59.498Z",
    "details" : "node_left[G92ZwuuaRY-9n8_tc-IzEg]",
    "last_allocation_status" : "no_attempt"
  },
  "can_allocate" : "allocation_delayed",
  "allocate_explanation" : "The node containing this shard copy recently left the cluster. Elasticsearch is waiting for it to return. If the node does not return within [%s] then Elasticsearch will allocate this shard to another node. Please wait.",
  "configured_delay" : "1m",                      <a id="CO765-1"></a><i class="conum" data-value="1"></i>
  "configured_delay_in_millis" : 60000,
  "remaining_delay" : "59.8s",                    <a id="CO765-2"></a><i class="conum" data-value="2"></i>
  "remaining_delay_in_millis" : 59824,
  "node_allocation_decisions" : [
    {
      "node_id" : "pmnHu_ooQWCPEFobZGbpWw",
      "node_name" : "node_t2",
      "transport_address" : "127.0.0.1:9402",
      "roles" : ["data_content", "data_hot"],
      "node_decision" : "yes"
    },
    {
      "node_id" : "3sULLVJrRneSg0EfBB-2Ew",
      "node_name" : "node_t0",
      "transport_address" : "127.0.0.1:9400",
      "roles" : ["data_content", "data_hot"],
      "node_decision" : "no",
      "store" : {                                 <a id="CO765-3"></a><i class="conum" data-value="3"></i>
        "matching_size" : "4.2kb",
        "matching_size_in_bytes" : 4325
      },
      "deciders" : [
        {
          "decider" : "same_shard",
          "decision" : "NO",
          "explanation" : "a copy of this shard is already allocated to this node [[my-index-000001][0], node[3sULLVJrRneSg0EfBB-2Ew], [P], s[STARTED], a[id=eV9P8BN1QPqRc3B4PLx6cg]]"
        }
      ]
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO765-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The configured delay before allocating a replica shard that does not exist due to the node holding it leaving the cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO765-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The remaining delay before allocating the replica shard.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO765-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Information about the shard data found on a node.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="_allocation_throttled"></a>Allocation throttled</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>The following response contains an allocation explanation for a replica that&#8217;s
queued to allocate but currently waiting on other queued shards.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "index" : "my-index-000001",
  "shard" : 0,
  "primary" : false,
  "current_state" : "unassigned",
  "unassigned_info" : {
    "reason" : "NODE_LEFT",
    "at" : "2017-01-04T18:53:59.498Z",
    "details" : "node_left[G92ZwuuaRY-9n8_tc-IzEg]",
    "last_allocation_status" : "no_attempt"
  },
  "can_allocate": "throttled",
  "allocate_explanation": "Elasticsearch is currently busy with other activities. It expects to be able to allocate this shard when those activities finish. Please wait.",
  "node_allocation_decisions" : [
    {
      "node_id" : "3sULLVJrRneSg0EfBB-2Ew",
      "node_name" : "node_t0",
      "transport_address" : "127.0.0.1:9400",
      "roles" : ["data_content", "data_hot"],
      "node_decision" : "no",
      "deciders" : [
        {
          "decider": "throttling",
          "decision": "THROTTLE",
          "explanation": "reached the limit of incoming shard recoveries [2], cluster setting [cluster.routing.allocation.node_concurrent_incoming_recoveries=2] (can also be set via [cluster.routing.allocation.node_concurrent_recoveries])"
        }
      ]
    }
  ]
}</pre>
</div>
<p>This is a transient message that might appear when a large amount of shards are allocating.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_assigned_shard"></a>Assigned shard</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="_cannot_remain_on_current_node"></a>Cannot remain on current node</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>The following response contains an allocation explanation for an assigned shard.
The response indicates the shard is not allowed to remain on its current node
and must be reallocated.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "index" : "my-index-000001",
  "shard" : 0,
  "primary" : true,
  "current_state" : "started",
  "current_node" : {
    "id" : "8lWJeJ7tSoui0bxrwuNhTA",
    "name" : "node_t1",
    "transport_address" : "127.0.0.1:9401",
    "roles" : ["data_content", "data_hot"]
  },
  "can_remain_on_current_node" : "no",            <a id="CO766-1"></a><i class="conum" data-value="1"></i>
  "can_remain_decisions" : [                      <a id="CO766-2"></a><i class="conum" data-value="2"></i>
    {
      "decider" : "filter",
      "decision" : "NO",
      "explanation" : "node does not match index setting [index.routing.allocation.include] filters [_name:\"nonexistent_node\"]"
    }
  ],
  "can_move_to_other_node" : "no",                <a id="CO766-3"></a><i class="conum" data-value="3"></i>
  "move_explanation" : "This shard may not remain on its current node, but Elasticsearch isn't allowed to move it to another node. Choose a node to which you expect this shard to be allocated, find this node in the node-by-node explanation, and address the reasons which prevent Elasticsearch from allocating this shard there.",
  "node_allocation_decisions" : [
    {
      "node_id" : "_P8olZS8Twax9u6ioN-GGA",
      "node_name" : "node_t0",
      "transport_address" : "127.0.0.1:9400",
      "roles" : ["data_content", "data_hot"],
      "node_decision" : "no",
      "weight_ranking" : 1,
      "deciders" : [
        {
          "decider" : "filter",
          "decision" : "NO",
          "explanation" : "node does not match index setting [index.routing.allocation.include] filters [_name:\"nonexistent_node\"]"
        }
      ]
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO766-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the shard is allowed to remain on its current node.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO766-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The deciders that factored into the decision of why the shard is not allowed to remain on its current node.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO766-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the shard is allowed to be allocated to another node.</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="_must_remain_on_current_node"></a>Must remain on current node</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>The following response contains an allocation explanation for a shard that must
remain on its current node. Moving the shard to another node would not improve
cluster balance.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "index" : "my-index-000001",
  "shard" : 0,
  "primary" : true,
  "current_state" : "started",
  "current_node" : {
    "id" : "wLzJm4N4RymDkBYxwWoJsg",
    "name" : "node_t0",
    "transport_address" : "127.0.0.1:9400",
    "roles" : ["data_content", "data_hot"],
    "weight_ranking" : 1
  },
  "can_remain_on_current_node" : "yes",
  "can_rebalance_cluster" : "yes",                <a id="CO767-1"></a><i class="conum" data-value="1"></i>
  "can_rebalance_to_other_node" : "no",           <a id="CO767-2"></a><i class="conum" data-value="2"></i>
  "rebalance_explanation" : "Elasticsearch cannot rebalance this shard to another node since there is no node to which allocation is permitted which would improve the cluster balance. If you expect this shard to be rebalanced to another node, find this node in the node-by-node explanation and address the reasons which prevent Elasticsearch from rebalancing this shard there.",
  "node_allocation_decisions" : [
    {
      "node_id" : "oE3EGFc8QN-Tdi5FFEprIA",
      "node_name" : "node_t1",
      "transport_address" : "127.0.0.1:9401",
      "roles" : ["data_content", "data_hot"],
      "node_decision" : "worse_balance",          <a id="CO767-3"></a><i class="conum" data-value="3"></i>
      "weight_ranking" : 1
    }
  ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO767-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether rebalancing is allowed on the cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO767-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Whether the shard can be rebalanced to another node.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO767-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The reason the shard cannot be rebalanced to the node, in this case indicating that it offers no better balance than the current node.</p>
</td>
</tr>
</table>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_no_arguments"></a>No arguments</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/cluster/allocation-explain.asciidoc">edit</a></div>
</div></div></div>
<p>If you call the API with no arguments, Elasticsearch retrieves an allocation explanation
for an arbitrary unassigned primary or replica shard, returning any unassigned primary shards first.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.cluster.allocation_explain()
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.cluster.allocation_explain
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.cluster.allocationExplain();
console.log(response);</pre>
</div>
<a id="4ca15672fc5ab1d80a127d086b6d2837"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">GET _cluster/allocation/explain</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/2391.console"></div>
<p>If the cluster contains no unassigned shards, the API returns a <code class="literal">400</code> error.</p>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="cluster.html">« Cluster APIs</a>
</span>
<span class="next">
<a href="cluster-get-settings.html">Cluster get settings API »</a>
</span>
</div>
</body>
</html>
