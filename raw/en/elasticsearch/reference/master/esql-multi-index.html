<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Using ES|QL to query multiple indices | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Using ES|QL to query multiple indices | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="esql-using.html" title="Using ES|QL"/>
<link rel="prev" href="esql-elastic-security.html" title="Using ES|QL in Elastic Security"/>
<link rel="next" href="esql-cross-clusters.html" title="Using ES|QL across clusters"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="esql-elastic-security.html">« Using ES|QL in Elastic Security</a>
</span>
<span class="next">
<a href="esql-cross-clusters.html">Using ES|QL across clusters »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql.html">ES|QL</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql-using.html">Using ES|QL</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Using ES|QL to query multiple indices</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-multi-index.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="esql-multi-index"></a>Using ES|QL to query multiple indices<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-multi-index.asciidoc">edit</a></h2>
</div></div></div>

<p>With ES|QL, you can execute a single query across multiple indices, data streams, or aliases.
To do so, use wildcards and date arithmetic. The following example uses a comma-separated list and a wildcard:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM employees-00001,other-employees-*</pre>
</div>
<p>Use the format <code class="literal">&lt;remote_cluster_name&gt;:&lt;target&gt;</code> to <a class="xref" href="esql-cross-clusters.html" title="Using ES|QL across clusters">query data streams and indices
on remote clusters</a>:</p>
<div class="pre_wrapper lang-esql">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql">FROM cluster_one:employees-00001,cluster_two:other-employees-*</pre>
</div>
<h3><a id="esql-multi-index-invalid-mapping"></a>Field type mismatches<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-multi-index.asciidoc">edit</a></h3>
<p>When querying multiple indices, data streams, or aliases, you might find that the same field is mapped to multiple different types.
For example, consider the two indices with the following field mappings:</p>
<p><span class="strong strong"><strong>index: events_ip</strong></span></p>
<pre class="screen">{
  "mappings": {
    "properties": {
      "@timestamp":     { "type": "date" },
      "client_ip":      { "type": "ip" },
      "event_duration": { "type": "long" },
      "message":        { "type": "keyword" }
    }
  }
}</pre>
<p><span class="strong strong"><strong>index: events_keyword</strong></span></p>
<pre class="screen">{
  "mappings": {
    "properties": {
      "@timestamp":     { "type": "date" },
      "client_ip":      { "type": "keyword" },
      "event_duration": { "type": "long" },
      "message":        { "type": "keyword" }
    }
  }
}</pre>
<p>When you query each of these individually with a simple query like <code class="literal">FROM events_ip</code>, the results are provided with type-specific columns:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM events_ip
| SORT @timestamp DESC</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">@timestamp:date</th>
<th align="left" valign="top">client_ip:ip</th>
<th align="left" valign="top">event_duration:long</th>
<th align="left" valign="top">message:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:55:01.543Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>1756467</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:53:55.832Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>5033755</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:52:55.015Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>8268153</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
</tbody>
</table>
</div>
<p>Note how the <code class="literal">client_ip</code> column is correctly identified as type <code class="literal">ip</code>, and all values are displayed.
However, if instead the query sources two conflicting indices with <code class="literal">FROM events_*</code>, the type of the <code class="literal">client_ip</code> column cannot be determined
and is reported as <code class="literal">unsupported</code> with all values returned as <code class="literal">null</code>.</p>
<a id="query-unsupported"></a><div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM events_*
| SORT @timestamp DESC</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">@timestamp:date</th>
<th align="left" valign="top">client_ip:unsupported</th>
<th align="left" valign="top">event_duration:long</th>
<th align="left" valign="top">message:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:55:01.543Z</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>1756467</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:53:55.832Z</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>5033755</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:52:55.015Z</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>8268153</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:51:54.732Z</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>725448</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:33:34.937Z</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>1232382</p></td>
<td align="left" valign="top"><p>Disconnected</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T12:27:28.948Z</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>2764889</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T12:15:03.360Z</p></td>
<td align="left" valign="top"><p>null</p></td>
<td align="left" valign="top"><p>3450233</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.3</p></td>
</tr>
</tbody>
</table>
</div>
<p>In addition, if the query refers to this unsupported field directly, the query fails:</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM events_*
| KEEP @timestamp, client_ip, event_duration, message
| SORT @timestamp DESC</pre>
</div>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">Cannot use field [client_ip] due to ambiguities being mapped as
[2] incompatible types:
    [ip] in [events_ip],
    [keyword] in [events_keyword]</pre>
</div>
<h3><a id="esql-multi-index-union-types"></a>Union types<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-multi-index.asciidoc">edit</a></h3>
<p>ES|QL has a way to handle <a class="xref" href="esql-multi-index.html#esql-multi-index-invalid-mapping" title="Field type mismatches">field type mismatches</a>. When the same field is mapped to multiple types in multiple indices,
the type of the field is understood to be a <em>union</em> of the various types in the index mappings.
As seen in the preceding examples, this <em>union type</em> cannot be used in the results,
and cannot be referred to by the query&#8201;&#8212;&#8201;except when it&#8217;s passed to a type conversion function that accepts all the types in the <em>union</em> and converts the field
to a single type. ES|QL offers a suite of <a class="xref" href="esql-functions-operators.html#esql-type-conversion-functions" title="ES|QL type conversion functions">type conversion functions</a> to achieve this.</p>
<p>In the above examples, the query can use a command like <code class="literal">EVAL client_ip = TO_IP(client_ip)</code> to resolve
the union of <code class="literal">ip</code> and <code class="literal">keyword</code> to just <code class="literal">ip</code>.
You can also use the type-conversion syntax <code class="literal">EVAL client_ip = client_ip::IP</code>.
Alternatively, the query could use <a class="xref" href="esql-functions-operators.html#esql-to_string" title="TO_STRING"><code class="literal">TO_STRING</code></a> to convert all supported types into <code class="literal">KEYWORD</code>.</p>
<p>For example, the <a class="xref" href="esql-multi-index.html#query-unsupported">query</a> that returned <code class="literal">client_ip:unsupported</code> with <code class="literal">null</code> values can be improved using the <code class="literal">TO_IP</code> function or the equivalent <code class="literal">field::ip</code> syntax.
These changes also resolve the error message.
As long as the only reference to the original field is to pass it to a conversion function that resolves the type ambiguity, no error results.</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM events_*
| EVAL client_ip = TO_IP(client_ip)
| KEEP @timestamp, client_ip, event_duration, message
| SORT @timestamp DESC</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">@timestamp:date</th>
<th align="left" valign="top">client_ip:ip</th>
<th align="left" valign="top">event_duration:long</th>
<th align="left" valign="top">message:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:55:01.543Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>1756467</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:53:55.832Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>5033755</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:52:55.015Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>8268153</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:51:54.732Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>725448</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T13:33:34.937Z</p></td>
<td align="left" valign="top"><p>172.21.0.5</p></td>
<td align="left" valign="top"><p>1232382</p></td>
<td align="left" valign="top"><p>Disconnected</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T12:27:28.948Z</p></td>
<td align="left" valign="top"><p>172.21.2.113</p></td>
<td align="left" valign="top"><p>2764889</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2023-10-23T12:15:03.360Z</p></td>
<td align="left" valign="top"><p>172.21.2.162</p></td>
<td align="left" valign="top"><p>3450233</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.3</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="esql-multi-index-index-metadata"></a>Index metadata<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-multi-index.asciidoc">edit</a></h3>
<p>It can be helpful to know the particular index from which each row is sourced.
To get this information, use the <a class="xref" href="esql-metadata-fields.html" title="ES|QL metadata fields"><code class="literal">METADATA</code></a> option on the <a class="xref" href="esql-commands.html#esql-from" title="FROM"><code class="literal">FROM</code></a> command.</p>
<div class="pre_wrapper lang-esql merge styled">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-esql merge styled">FROM events_* METADATA _index
| EVAL client_ip = TO_IP(client_ip)
| KEEP _index, @timestamp, client_ip, event_duration, message
| SORT @timestamp DESC</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px" class="monospaced styled">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
<col class="col_5"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">_index:keyword</th>
<th align="left" valign="top">@timestamp:date</th>
<th align="left" valign="top">client_ip:ip</th>
<th align="left" valign="top">event_duration:long</th>
<th align="left" valign="top">message:keyword</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>events_ip</p></td>
<td align="left" valign="top"><p>2023-10-23T13:55:01.543Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>1756467</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>events_ip</p></td>
<td align="left" valign="top"><p>2023-10-23T13:53:55.832Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>5033755</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>events_ip</p></td>
<td align="left" valign="top"><p>2023-10-23T13:52:55.015Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>8268153</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>events_keyword</p></td>
<td align="left" valign="top"><p>2023-10-23T13:51:54.732Z</p></td>
<td align="left" valign="top"><p>172.21.3.15</p></td>
<td align="left" valign="top"><p>725448</p></td>
<td align="left" valign="top"><p>Connection error</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>events_keyword</p></td>
<td align="left" valign="top"><p>2023-10-23T13:33:34.937Z</p></td>
<td align="left" valign="top"><p>172.21.0.5</p></td>
<td align="left" valign="top"><p>1232382</p></td>
<td align="left" valign="top"><p>Disconnected</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>events_keyword</p></td>
<td align="left" valign="top"><p>2023-10-23T12:27:28.948Z</p></td>
<td align="left" valign="top"><p>172.21.2.113</p></td>
<td align="left" valign="top"><p>2764889</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>events_keyword</p></td>
<td align="left" valign="top"><p>2023-10-23T12:15:03.360Z</p></td>
<td align="left" valign="top"><p>172.21.2.162</p></td>
<td align="left" valign="top"><p>3450233</p></td>
<td align="left" valign="top"><p>Connected to 10.1.0.3</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="esql-elastic-security.html">« Using ES|QL in Elastic Security</a>
</span>
<span class="next">
<a href="esql-cross-clusters.html">Using ES|QL across clusters »</a>
</span>
</div>
</body>
</html>
