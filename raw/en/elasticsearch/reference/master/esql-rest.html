<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ES|QL REST API | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="ES|QL REST API | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="esql-using.html" title="Using ES|QL"/>
<link rel="prev" href="esql-using.html" title="Using ES|QL"/>
<link rel="next" href="esql-kibana.html" title="Using ES|QL in Kibana"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql.html">ES|QL</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="esql-using.html">Using ES|QL</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="esql-using.html">« Using ES|QL</a>
</span>
<span class="next">
<a href="esql-kibana.html">Using ES|QL in Kibana »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="esql-rest"></a>ES|QL REST API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h2>
</div></div></div>

<h3><a id="esql-rest-overview"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h3>
<p>The <a class="xref" href="esql-query-api.html" title="ES|QL query API">ES|QL query API</a> accepts an ES|QL query string in the
<code class="literal">query</code> parameter, runs it, and returns the results. For example:</p>
<a id="a9541c64512ebc5fcff2dc48487dc0b7"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_query?format=txt
{
  "query": "FROM library | KEEP author, name, page_count, release_date | SORT page_count DESC | LIMIT 5"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1707.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">     author      |        name        |  page_count   | release_date
-----------------+--------------------+---------------+------------------------
Peter F. Hamilton|Pandora's Star      |768            |2004-03-02T00:00:00.000Z
Vernor Vinge     |A Fire Upon the Deep|613            |1992-06-01T00:00:00.000Z
Frank Herbert    |Dune                |604            |1965-06-01T00:00:00.000Z
Alastair Reynolds|Revelation Space    |585            |2000-03-15T00:00:00.000Z
James S.A. Corey |Leviathan Wakes     |561            |2011-06-02T00:00:00.000Z</pre>
</div>
<h4><a id="esql-kibana-console"></a>Kibana Console<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>If you are using <a href="/guide/en/kibana/master/console-kibana.html" class="ulink" target="_top">Kibana Console</a> (which is
highly recommended), take advantage of the triple quotes <code class="literal">"""</code> when creating the
query. This not only automatically escapes double quotes (<code class="literal">"</code>) inside the query
string but also supports multi-line requests:</p>
<a id="f7139b3c0e066be832b9100ae17157cc"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_query?format=txt
{
  "query": """
    FROM library
    | KEEP author, name, page_count, release_date
    | SORT page_count DESC
    | LIMIT 5
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1708.console"></div>
<h4><a id="esql-rest-format"></a>Response formats<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>ES|QL can return the data in the following human readable and binary formats.
You can set the format by specifying the <code class="literal">format</code> parameter in the URL or by
setting the <code class="literal">Accept</code> or <code class="literal">Content-Type</code> HTTP header.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The URL parameter takes precedence over the HTTP headers. If neither is
specified then the response is returned in the same format as the request.</p>
</div>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong><code class="literal">format</code></strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>HTTP header</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>Description</strong></span></p></td>
</tr>
<tr>
<td align="left" colspan="3" valign="top"><p><span class="strong strong"><strong>Human readable</strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">csv</code></p></td>
<td align="left" valign="top"><p><code class="literal">text/csv</code></p></td>
<td align="left" valign="top"><p><a href="https://en.wikipedia.org/wiki/Comma-separated_values" class="ulink" target="_top">Comma-separated values</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">json</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/json</code></p></td>
<td align="left" valign="top"><p><a href="https://www.json.org/" class="ulink" target="_top">JSON</a> (JavaScript Object Notation) human-readable format</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">tsv</code></p></td>
<td align="left" valign="top"><p><code class="literal">text/tab-separated-values</code></p></td>
<td align="left" valign="top"><p><a href="https://en.wikipedia.org/wiki/Tab-separated_values" class="ulink" target="_top">Tab-separated values</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">txt</code></p></td>
<td align="left" valign="top"><p><code class="literal">text/plain</code></p></td>
<td align="left" valign="top"><p>CLI-like representation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">yaml</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/yaml</code></p></td>
<td align="left" valign="top"><p><a href="https://en.wikipedia.org/wiki/YAML" class="ulink" target="_top">YAML</a> (YAML Ain&#8217;t Markup Language) human-readable format</p></td>
</tr>
<tr>
<td align="left" colspan="3" valign="top"><p><span class="strong strong"><strong>Binary</strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">cbor</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/cbor</code></p></td>
<td align="left" valign="top"><p><a href="https://cbor.io/" class="ulink" target="_top">Concise Binary Object Representation</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">smile</code></p></td>
<td align="left" valign="top"><p><code class="literal">application/smile</code></p></td>
<td align="left" valign="top"><p><a href="https://en.wikipedia.org/wiki/Smile_(data_interchange_format)" class="ulink" target="_top">Smile</a> binary data format similar
to CBOR</p></td>
</tr>
</tbody>
</table>
</div>
<p>The <code class="literal">csv</code> format accepts a formatting URL query attribute, <code class="literal">delimiter</code>, which
indicates which character should be used to separate the CSV values. It defaults
to comma (<code class="literal">,</code>) and cannot take any of the following values: double quote (<code class="literal">"</code>),
carriage-return (<code class="literal">\r</code>) and new-line (<code class="literal">\n</code>). The tab (<code class="literal">\t</code>) can also not be used.
Use the <code class="literal">tsv</code> format instead.</p>
<h4><a id="esql-rest-filtering"></a>Filtering using Elasticsearch Query DSL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>Specify a Query DSL query in the <code class="literal">filter</code> parameter to filter the set of
documents that an ES|QL query runs on.</p>
<a id="3613f402ee63f0efb6b8d9c6a919b410"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_query?format=txt
{
  "query": """
    FROM library
    | KEEP author, name, page_count, release_date
    | SORT page_count DESC
    | LIMIT 5
  """,
  "filter": {
    "range": {
      "page_count": {
        "gte": 100,
        "lte": 200
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1709.console"></div>
<p>Which returns:</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">    author     |                name                |  page_count   | release_date
---------------+------------------------------------+---------------+------------------------
Douglas Adams  |The Hitchhiker's Guide to the Galaxy|180            |1979-10-12T00:00:00.000Z</pre>
</div>
<h4><a id="esql-rest-columnar"></a>Columnar results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>By default, ES|QL returns results as rows. For example, <code class="literal">FROM</code> returns each
individual document as one row. For the <code class="literal">json</code>, <code class="literal">yaml</code>, <code class="literal">cbor</code> and <code class="literal">smile</code>
<a class="xref" href="esql-rest.html#esql-rest-format" title="Response formats">formats</a>, ES|QL can return the results in a columnar
fashion where one row represents all the values of a certain column in the
results.</p>
<a id="dc33160f4087443f867080a8f5b2cfbd"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_query?format=json
{
  "query": """
    FROM library
    | KEEP author, name, page_count, release_date
    | SORT page_count DESC
    | LIMIT 5
  """,
  "columnar": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1710.console"></div>
<p>Which returns:</p>
<a id="716b89c135c054fb55cbc343fc1239b1"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "columns": [
    {"name": "author", "type": "text"},
    {"name": "name", "type": "text"},
    {"name": "page_count", "type": "integer"},
    {"name": "release_date", "type": "date"}
  ],
  "values": [
    ["Peter F. Hamilton", "Vernor Vinge", "Frank Herbert", "Alastair Reynolds", "James S.A. Corey"],
    ["Pandora's Star", "A Fire Upon the Deep", "Dune", "Revelation Space", "Leviathan Wakes"],
    [768, 613, 604, 585, 561],
    ["2004-03-02T00:00:00.000Z", "1992-06-01T00:00:00.000Z", "1965-06-01T00:00:00.000Z", "2000-03-15T00:00:00.000Z", "2011-06-02T00:00:00.000Z"]
  ]
}</pre>
</div>
<h4><a id="esql-locale-param"></a>Returning localized results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>Use the <code class="literal">locale</code> parameter in the request body to return results (especially dates) formatted per the conventions of the locale.
If <code class="literal">locale</code> is not specified, defaults to <code class="literal">en-US</code> (English).
Refer to <a href="https://www.oracle.com/java/technologies/javase/jdk17-suported-locales.html" class="ulink" target="_top">JDK Supported Locales</a>.</p>
<p>Syntax: the <code class="literal">locale</code> parameter accepts language tags in the (case-insensitive) format <code class="literal">xy</code> and <code class="literal">xy-XY</code>.</p>
<p>For example, to return a month name in French:</p>
<a id="c4607ca79b2bcde39305d6f4f21cad37"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_query
{
  "locale": "fr-FR",
  "query": """
          ROW birth_date_string = "2023-01-15T00:00:00.000Z"
          | EVAL birth_date = date_parse(birth_date_string)
          | EVAL month_of_birth = DATE_FORMAT("MMMM",birth_date)
          | LIMIT 5
   """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1711.console"></div>
<h4><a id="esql-rest-params"></a>Passing parameters to a query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>Values, for example for a condition, can be passed to a query "inline", by
integrating the value in the query string itself:</p>
<a id="6dcd3916679f6aa64f79524c75991ebd"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_query
{
  "query": """
    FROM library
    | EVAL year = DATE_EXTRACT("year", release_date)
    | WHERE page_count &gt; 300 AND author == "Frank Herbert"
    | STATS count = COUNT(*) by year
    | WHERE count &gt; 0
    | LIMIT 5
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1712.console"></div>
<p>To avoid any attempts of hacking or code injection, extract the values in a
separate list of parameters. Use question mark placeholders (<code class="literal">?</code>) in the query
string for each of the parameters:</p>
<a id="927b20a221f975b75d1227b67d0eb7e2"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_query
{
  "query": """
    FROM library
    | EVAL year = DATE_EXTRACT("year", release_date)
    | WHERE page_count &gt; ? AND author == ?
    | STATS count = COUNT(*) by year
    | WHERE count &gt; ?
    | LIMIT 5
  """,
  "params": [300, "Frank Herbert", 0]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1713.console"></div>
<h4><a id="esql-rest-async-query"></a>Running an async ES|QL query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/esql/esql-rest.asciidoc">edit</a></h4>
<p>The <a class="xref" href="esql-async-query-api.html" title="ES|QL async query API">ES|QL async query API</a> lets you asynchronously
execute a query request, monitor its progress, and retrieve results when
they become available.</p>
<p>Executing an ES|QL query is commonly quite fast, however queries across
large data sets or frozen data can take some time. To avoid long waits,
run an async ES|QL query.</p>
<p>Queries initiated by the async query API may return results or not. The
<code class="literal">wait_for_completion_timeout</code> property determines how long to wait for
the results. If the results are not available by this time, a
<a class="xref" href="esql-async-query-api.html#esql-async-query-api-response-body-query-id">query id</a> is returned which
can be later used to retrieve the results. For example:</p>
<a id="3f1fe5f5f99b98d0891f38003e10b636"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST /_query/async
{
  "query": """
    FROM library
    | EVAL year = DATE_TRUNC(1 YEARS, release_date)
    | STATS MAX(page_count) BY year
    | SORT year
    | LIMIT 5
  """,
  "wait_for_completion_timeout": "2s"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1714.console"></div>
<p>If the results are not available within the given timeout period, 2
seconds in this case, no results are returned but rather a response that
includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A query ID
</li>
<li class="listitem">
An <code class="literal">is_running</code> value of <em>true</em>, indicating the query is ongoing
</li>
</ul>
</div>
<p>The query continues to run in the background without blocking other
requests.</p>
<a id="629d8404571b200cd16ac40ba40b1167"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_running": true
}</pre>
</div>
<p>To check the progress of an async query, use the <a class="xref" href="esql-async-query-get-api.html" title="ES|QL async query get API">ES|QL async query get API</a> with the query ID. Specify how long you&#8217;d like
to wait for complete results in the <code class="literal">wait_for_completion_timeout</code> parameter.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.esql.async_query_get(
  id: 'FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=',
  wait_for_completion_timeout: '30s'
)
puts response</pre>
</div>
<a id="2afdf0d83724953aa2875b5fb37d60cc"></a>
<div class="pre_wrapper lang-console default has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby">GET /_query/async/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?wait_for_completion_timeout=30s</pre>
</div>
<div class="console_widget has-ruby" data-snippet="snippets/1715.console"></div>
<p>If the response&#8217;s <code class="literal">is_running</code> value is <code class="literal">false</code>, the query has finished
and the results are returned.</p>
<a id="40e357182857594f7cd6adc266fda532"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "is_running": false,
  "columns": ...
}</pre>
</div>
<p>Use the <a class="xref" href="esql-async-query-delete-api.html" title="ES|QL async query delete API">ES|QL async query delete API</a> to
delete an async query before the <code class="literal">keep_alive</code> period ends. If the query
is still running, Elasticsearch cancels it.</p>
<a id="67b71a95b6fe6c83faae51ea038a1bf1"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">DELETE /_query/async/FmdMX2pIang3UWhLRU5QS0lqdlppYncaMUpYQ05oSkpTc3kwZ21EdC1tbFJXQToxOTI=</pre>
</div>
<div class="console_widget" data-snippet="snippets/1716.console"></div>
</div>
<div class="navfooter">
<span class="prev">
<a href="esql-using.html">« Using ES|QL</a>
</span>
<span class="next">
<a href="esql-kibana.html">Using ES|QL in Kibana »</a>
</span>
</div>
</div>
</body>
</html>
