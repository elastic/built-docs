<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rollover | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Rollover | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="ilm-actions.html" title="Index lifecycle actions"/>
<link rel="prev" href="ilm-readonly.html" title="Read only"/>
<link rel="next" href="ilm-downsample.html" title="Downsample"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="ilm-readonly.html">« Read only</a>
</span>
<span class="next">
<a href="ilm-downsample.html">Downsample »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="data-management.html">Data management</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ilm-actions.html">Index lifecycle actions</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Rollover</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ilm-rollover"></a>Rollover<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h2>
</div></div></div>
<p>Phases allowed: hot.</p>
<p>Rolls over a target to a new index when the existing index satisfies
the specified rollover conditions.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When an index is rolled over, the previous index&#8217;s age is updated to reflect the rollover time.
This date, rather than the index&#8217;s <code class="literal">creation_date</code>, is used in index lifecycle management
<code class="literal">min_age</code> phase calculations. <a class="xref" href="index-lifecycle-error-handling.html#min-age-calculation" title="How min_age is calculated">Learn more</a>.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the rollover action is used on a <a class="xref" href="ccr-put-follow.html" title="Create follower API">follower index</a>,
policy execution waits until the leader index rolls over (or is
<a class="xref" href="skipping-rollover.html" title="Skip rollover">otherwise marked complete</a>),
then converts the follower index into a regular index with the
<a class="xref" href="ilm-unfollow.html" title="Unfollow">Unfollow action</a>.</p>
</div>
</div>
<p>A rollover target can be a <a class="xref" href="data-streams.html" title="Data streams">data stream</a> or an <a class="xref" href="aliases.html" title="Aliases">index
alias</a>. When targeting a data stream, the new index becomes the data stream&#8217;s
write index and its generation is incremented.</p>
<p>To roll over an index alias, the alias and its write index must meet the
following conditions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The index name must match the pattern <em>^.*-\d+$</em>, for example (<code class="literal">my-index-000001</code>).
</li>
<li class="listitem">
The <code class="literal">index.lifecycle.rollover_alias</code> must be configured as the alias to roll over.
</li>
<li class="listitem">
The index must be the <a class="xref" href="aliases.html#write-index" title="Write index">write index</a> for the alias.
</li>
</ul>
</div>
<p>For example, if <code class="literal">my-index-000001</code> has the alias <code class="literal">my_data</code>,
the following settings must be configured.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'my-index-000001',
  body: {
    settings: {
      'index.lifecycle.name' =&gt; 'my_policy',
      'index.lifecycle.rollover_alias' =&gt; 'my_data'
    },
    aliases: {
      my_data: {
        is_write_index: true
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "my-index-000001",
  settings: {
    "index.lifecycle.name": "my_policy",
    "index.lifecycle.rollover_alias": "my_data",
  },
  aliases: {
    my_data: {
      is_write_index: true,
    },
  },
});
console.log(response);</pre>
</div>
<a id="eaf6a846ded090fd6ac48269ad2b328b"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT my-index-000001
{
  "settings": {
    "index.lifecycle.name": "my_policy",
    "index.lifecycle.rollover_alias": "my_data"
  },
  "aliases": {
    "my_data": {
      "is_write_index": true
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1829.console"></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ilm-rollover-options"></a>Options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h3>
</div></div></div>
<p>A rollover action must specify at least one <code class="literal">max_*</code> condition, it may include zero
or more <code class="literal">min_*</code> conditions. An empty rollover action is invalid.</p>
<p>The index will roll over once any <code class="literal">max_*</code> condition is satisfied and all
<code class="literal">min_*</code> conditions are satisfied. Note, however, that empty indices are not rolled
over by default.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">max_age</code>
</span>
</dt>
<dd>
(Optional,  <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Triggers rollover after the maximum elapsed time from index creation is reached.
The elapsed time is always calculated since the index creation time, even if the
index origination date is configured to a custom date, such as when using the
<a class="xref" href="ilm-settings.html#index-lifecycle-parse-origination-date">index.lifecycle.parse_origination_date</a> or
<a class="xref" href="ilm-settings.html#index-lifecycle-origination-date">index.lifecycle.origination_date</a> settings.
</dd>
<dt>
<span class="term">
<code class="literal">max_docs</code>
</span>
</dt>
<dd>
(Optional, integer)
Triggers rollover after the specified maximum number of documents is reached.
Documents added since the last refresh are not included in the document count.
The document count does <span class="strong strong"><strong>not</strong></span> include documents in replica shards.
</dd>
<dt>
<span class="term">
<code class="literal">max_size</code>
</span>
</dt>
<dd>
<p>
(Optional, <a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte units</a>)
Triggers rollover when the index reaches a certain size.
This is the total size of all primary shards in the index.
Replicas are not counted toward the maximum index size.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To see the current index size, use the <a class="xref" href="cat-indices.html" title="cat indices API">_cat indices</a> API.
The <code class="literal">pri.store.size</code> value shows the combined size of all primary shards.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">max_primary_shard_size</code>
</span>
</dt>
<dd>
<p>
(Optional, <a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte units</a>)
Triggers rollover when the largest primary shard in the index reaches a certain size.
This is the maximum size of the primary shards in the index. As with <code class="literal">max_size</code>,
replicas are ignored.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To see the current shard size, use the <a class="xref" href="cat-shards.html" title="cat shards API">_cat shards</a> API.
The <code class="literal">store</code> value shows the size each shard, and <code class="literal">prirep</code> indicates whether a
shard is a primary (<code class="literal">p</code>) or a replica (<code class="literal">r</code>).</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">max_primary_shard_docs</code>
</span>
</dt>
<dd>
<p>
(Optional, integer)
Triggers rollover when the largest primary shard in the index reaches a certain number of documents.
This is the maximum docs of the primary shards in the index. As with <code class="literal">max_docs</code>,
replicas are ignored.
</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To see the current shard docs, use the <a class="xref" href="cat-shards.html" title="cat shards API">_cat shards</a> API.
The <code class="literal">docs</code> value shows the number of documents each shard.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">min_age</code>
</span>
</dt>
<dd>
(Optional,  <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
Prevents rollover until after the minimum elapsed time from index creation is reached.
See notes on <code class="literal">max_age</code>.
</dd>
<dt>
<span class="term">
<code class="literal">min_docs</code>
</span>
</dt>
<dd>
(Optional, integer)
Prevents rollover until after the specified minimum number of documents is reached.
See notes on <code class="literal">max_docs</code>.
</dd>
<dt>
<span class="term">
<code class="literal">min_size</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte units</a>)
Prevents rollover until the index reaches a certain size.
See notes on <code class="literal">max_size</code>.
</dd>
<dt>
<span class="term">
<code class="literal">min_primary_shard_size</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#byte-units" title="Byte size units">byte units</a>)
Prevents rollover until the largest primary shard in the index reaches a certain size.
See notes on <code class="literal">max_primary_shard_size</code>.
</dd>
<dt>
<span class="term">
<code class="literal">min_primary_shard_docs</code>
</span>
</dt>
<dd>
(Optional, integer)
Prevents rollover until the largest primary shard in the index reaches a certain number of documents.
See notes on <code class="literal">max_primary_shard_docs</code>.
</dd>
</dl>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Empty indices will not be rolled over, even if they have an associated <code class="literal">max_age</code> that
would otherwise result in a roll over occurring. A policy can override this behavior, and explicitly
opt in to rolling over empty indices, by adding a <code class="literal">"min_docs": 0</code> condition. This can also be
disabled on a cluster-wide basis by setting <code class="literal">indices.lifecycle.rollover.only_if_has_documents</code> to
<code class="literal">false</code>.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The rollover action implicitly always rolls over a data stream or alias if one or more shards contain
200000000 or more documents. Normally a shard will reach 50GB long before it reaches 200M documents,
but this isn&#8217;t the case for space efficient data sets. Search performance will very likely suffer
if a shard contains more than 200M documents. This is the reason of the builtin limit.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ilm-rollover-ex"></a>Example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ilm-rollover-primar-shardsize-ex"></a>Roll over based on largest primary shard size<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h4>
</div></div></div>
<p>This example rolls the index over when its largest primary shard is at least 50 gigabytes.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'my_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_primary_shard_size: '50gb'
            }
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "my_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_primary_shard_size: "50gb",
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="ba66768ed04f7b87906badff40ff40ed"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_primary_shard_size": "50gb"
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1830.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ilm-rollover-size-ex"></a>Roll over based on index size<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h4>
</div></div></div>
<p>This example rolls the index over when it is at least 100 gigabytes.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'my_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_size: '100gb'
            }
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "my_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_size: "100gb",
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="9ba868784f417a8d3679b3c8ed5939ad"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_size": "100gb"
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1831.console"></div>
</div>

<div class="ilm-rollover-documents-ex]">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_roll_over_based_on_document_count"></a>Roll over based on document count<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h4>
</div></div></div>
<p>This example rolls the index over when it contains at least one hundred million documents.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'my_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_docs: 100_000_000
            }
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "my_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_docs: 100000000,
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="cfd4b34f35e531a20739a3b308d57134"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_docs": 100000000
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1832.console"></div>
</div>

<div class="ilm-rollover-documents-ex]">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_roll_over_based_on_document_count_of_the_largest_primary_shard"></a>Roll over based on document count of the largest primary shard<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h4>
</div></div></div>
<p>This example rolls the index over when it contains at least ten million documents of the largest primary shard.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'my_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_primary_shard_docs: 10_000_000
            }
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "my_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_primary_shard_docs: 10000000,
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="ae591d49e54b838c15cdcf64a8dee9c2"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_primary_shard_docs": 10000000
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1833.console"></div>
</div>

<div class="ilm-rollover-age-ex]">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_roll_over_based_on_index_age"></a>Roll over based on index age<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h4>
</div></div></div>
<p>This example rolls the index over if it was created at least 7 days ago.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'my_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_age: '7d'
            }
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "my_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_age: "7d",
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="d4a41fb74b41b41a0ee114a2311f2815"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_age": "7d"
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1834.console"></div>
</div>

<div class="ilm-rollover-conditions-ex]">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_roll_over_using_multiple_conditions"></a>Roll over using multiple conditions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h4>
</div></div></div>
<p>When you specify multiple rollover conditions,
the index is rolled over when <em>any</em> of the <code class="literal">max_*</code> and <em>all</em> of the <code class="literal">min_*</code> conditions are met.
This example rolls the index over if it is at least 7 days old or at least 100 gigabytes,
but only as long as the index contains at least 1000 documents.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'my_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_age: '7d',
              max_size: '100gb',
              min_docs: 1000
            }
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "my_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_age: "7d",
            max_size: "100gb",
            min_docs: 1000,
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="d84a861ce563508aeaaf30a9dd84b5cf"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_age": "7d",
            "max_size": "100gb",
            "min_docs": 1000
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1835.console"></div>
</div>

<div class="ilm-rollover-conditions-ex]">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_roll_over_while_maintaining_shard_sizes"></a>Roll over while maintaining shard sizes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h4>
</div></div></div>
<p>This example rolls the index over when the primary shard size is at least 50gb,
or when the index is at least 30 days old, but only as long as a primary shard is at least 1gb.
For low-volume indices, this prevents the creation of many small shards.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'my_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_primary_shard_size: '50gb',
              max_age: '30d',
              min_primary_shard_size: '1gb'
            }
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "my_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_primary_shard_size: "50gb",
            max_age: "30d",
            min_primary_shard_size: "1gb",
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="236f50d89a07b83119af72e367e685da"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_primary_shard_size": "50gb",
            "max_age": "30d",
            "min_primary_shard_size": "1gb"
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1836.console"></div>
</div>

<div class="ilm-rollover-block-ex]">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_rollover_condition_blocks_phase_transition"></a>Rollover condition blocks phase transition<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ilm/actions/ilm-rollover.asciidoc">edit</a></h4>
</div></div></div>
<p>The rollover action only completes if one of its conditions is met.
This means that any subsequent phases are blocked until rollover succeeds.</p>
<p>For example, the following policy deletes the index one day after it rolls over.
It does not delete the index one day after it was created.</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ilm.put_lifecycle(
  policy: 'rollover_policy',
  body: {
    policy: {
      phases: {
        hot: {
          actions: {
            rollover: {
              max_size: '50gb'
            }
          }
        },
        delete: {
          min_age: '1d',
          actions: {
            delete: {}
          }
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ilm.putLifecycle({
  name: "rollover_policy",
  policy: {
    phases: {
      hot: {
        actions: {
          rollover: {
            max_size: "50gb",
          },
        },
      },
      delete: {
        min_age: "1d",
        actions: {
          delete: {},
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="8e0f43829df9af20547ea6896f4c0124"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">PUT /_ilm/policy/rollover_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_size": "50gb"
          }
        }
      },
      "delete": {
        "min_age": "1d",
        "actions": {
          "delete": {}
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/1837.console"></div>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ilm-readonly.html">« Read only</a>
</span>
<span class="next">
<a href="ilm-downsample.html">Downsample »</a>
</span>
</div>
</body>
</html>
