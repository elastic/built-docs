<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Index Sorting | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Index Sorting | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="index-modules.html" title="Index modules"/>
<link rel="prev" href="index-modules-history-retention.html" title="History retention"/>
<link rel="next" href="index-modules-index-sorting-conjunctions.html" title="Use index sorting to speed up conjunctions"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="index-modules-history-retention.html">« History retention</a>
</span>
<span class="next">
<a href="index-modules-index-sorting-conjunctions.html">Use index sorting to speed up conjunctions »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index-modules.html">Index modules</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Index Sorting</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/index-sorting.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="index-modules-index-sorting"></a>Index Sorting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/index-sorting.asciidoc">edit</a></h2>
</div></div></div>
<p>When creating a new index in Elasticsearch it is possible to configure how the Segments
inside each Shard will be sorted. By default Lucene does not apply any sort.
The <code class="literal">index.sort.*</code> settings define which fields should be used to sort the documents inside each Segment.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is allowed to apply index sorting to mappings with nested objects, so long as the
<code class="literal">index.sort.*</code> setting contains no nested fields.</p>
</div>
</div>
<p>For instance the following example shows how to define a sort on a single field:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="my-index-000001",
    body={
        "settings": {
            "index": {"sort.field": "date", "sort.order": "desc"}
        },
        "mappings": {"properties": {"date": {"type": "date"}}},
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'my-index-000001',
  body: {
    settings: {
      index: {
        'sort.field' =&gt; 'date',
        'sort.order' =&gt; 'desc'
      }
    },
    mappings: {
      properties: {
        date: {
          type: 'date'
        }
      }
    }
  }
)
puts response</pre>
</div>
<a id="156bc64c94f9f3334fbce25165d2286a"></a>
<div class="pre_wrapper lang-console default has-python has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby">PUT my-index-000001
{
  "settings": {
    "index": {
      "sort.field": "date", <a id="CO33-1"></a><i class="conum" data-value="1"></i>
      "sort.order": "desc"  <a id="CO33-2"></a><i class="conum" data-value="2"></i>
    }
  },
  "mappings": {
    "properties": {
      "date": {
        "type": "date"
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby" data-snippet="snippets/106.console"></div>
<div class="calloutlist default has-python has-ruby lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This index is sorted by the <code class="literal">date</code> field</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO33-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>&#8230;&#8203; in descending order.</p>
</td>
</tr>
</table>
</div>
<p>It is also possible to sort the index by more than one field:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="my-index-000001",
    body={
        "settings": {
            "index": {
                "sort.field": ["username", "date"],
                "sort.order": ["asc", "desc"],
            }
        },
        "mappings": {
            "properties": {
                "username": {"type": "keyword", "doc_values": True},
                "date": {"type": "date"},
            }
        },
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'my-index-000001',
  body: {
    settings: {
      index: {
        'sort.field' =&gt; [
          'username',
          'date'
        ],
        'sort.order' =&gt; [
          'asc',
          'desc'
        ]
      }
    },
    mappings: {
      properties: {
        username: {
          type: 'keyword',
          doc_values: true
        },
        date: {
          type: 'date'
        }
      }
    }
  }
)
puts response</pre>
</div>
<a id="d4fb482a51d67a1af48e429af6019a46"></a>
<div class="pre_wrapper lang-console default has-python has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby">PUT my-index-000001
{
  "settings": {
    "index": {
      "sort.field": [ "username", "date" ], <a id="CO34-1"></a><i class="conum" data-value="1"></i>
      "sort.order": [ "asc", "desc" ]       <a id="CO34-2"></a><i class="conum" data-value="2"></i>
    }
  },
  "mappings": {
    "properties": {
      "username": {
        "type": "keyword",
        "doc_values": true
      },
      "date": {
        "type": "date"
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby" data-snippet="snippets/107.console"></div>
<div class="calloutlist default has-python has-ruby lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This index is sorted by <code class="literal">username</code> first then by <code class="literal">date</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO34-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>&#8230;&#8203; in ascending order for the <code class="literal">username</code> field and in descending order for the <code class="literal">date</code> field.</p>
</td>
</tr>
</table>
</div>
<p>Index sorting supports the following settings:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index.sort.field</code>
</span>
</dt>
<dd>
The list of fields used to sort the index.
Only <code class="literal">boolean</code>, <code class="literal">numeric</code>, <code class="literal">date</code> and <code class="literal">keyword</code> fields with <code class="literal">doc_values</code> are allowed here.
</dd>
<dt>
<span class="term">
<code class="literal">index.sort.order</code>
</span>
</dt>
<dd>
<p>
The sort order to use for each field.
The order option can have the following values:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">asc</code>:  For ascending order
</li>
<li class="listitem">
<code class="literal">desc</code>: For descending order.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">index.sort.mode</code>
</span>
</dt>
<dd>
<p>
Elasticsearch supports sorting by multi-valued fields.
The mode option controls what value is picked to sort the document.
The mode option can have the following values:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">min</code>: 	Pick the lowest value.
</li>
<li class="listitem">
<code class="literal">max</code>: 	Pick the highest value.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">index.sort.missing</code>
</span>
</dt>
<dd>
<p>
The missing parameter specifies how docs which are missing the field should be treated.
 The missing value can have the following values:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">_last</code>: Documents without value for the field are sorted last.
</li>
<li class="listitem">
<code class="literal">_first</code>: Documents without value for the field are sorted first.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Index sorting can be defined only once at index creation. It is not allowed to add or update
a sort on an existing index. Index sorting also has a cost in terms of indexing throughput since
documents must be sorted at flush and merge time. You should test the impact on your application
before activating this feature.</p>
</div>
</div>
<h3><a id="early-terminate"></a>Early termination of search request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/index-sorting.asciidoc">edit</a></h3>
<p>By default in Elasticsearch a search request must visit every document that matches a query to
retrieve the top documents sorted by a specified sort.
Though when the index sort and the search sort are the same it is possible to limit
the number of documents that should be visited per segment to retrieve the N top ranked documents globally.
For example, let&#8217;s say we have an index that contains events sorted by a timestamp field:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="events",
    body={
        "settings": {
            "index": {"sort.field": "timestamp", "sort.order": "desc"}
        },
        "mappings": {"properties": {"timestamp": {"type": "date"}}},
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'events',
  body: {
    settings: {
      index: {
        'sort.field' =&gt; 'timestamp',
        'sort.order' =&gt; 'desc'
      }
    },
    mappings: {
      properties: {
        timestamp: {
          type: 'date'
        }
      }
    }
  }
)
puts response</pre>
</div>
<a id="8d7193902a353872740a3324c60c5001"></a>
<div class="pre_wrapper lang-console default has-python has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby">PUT events
{
  "settings": {
    "index": {
      "sort.field": "timestamp",
      "sort.order": "desc" <a id="CO35-1"></a><i class="conum" data-value="1"></i>
    }
  },
  "mappings": {
    "properties": {
      "timestamp": {
        "type": "date"
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby" data-snippet="snippets/108.console"></div>
<div class="calloutlist default has-python has-ruby lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO35-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This index is sorted by timestamp in descending order (most recent first)</p>
</td>
</tr>
</table>
</div>
<p>You can search for the last 10 events with:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="events",
    body={"size": 10, "sort": [{"timestamp": "desc"}]},
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  index: 'events',
  body: {
    size: 10,
    sort: [
      {
        timestamp: 'desc'
      }
    ]
  }
)
puts response</pre>
</div>
<a id="fc8a426f8a5112e61e2acb913982a8d9"></a>
<div class="pre_wrapper lang-console default has-python has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby">GET /events/_search
{
  "size": 10,
  "sort": [
    { "timestamp": "desc" }
  ]
}</pre>
</div>
<div class="console_widget has-python has-ruby" data-snippet="snippets/109.console"></div>
<p>Elasticsearch will detect that the top docs of each segment are already sorted in the index
and will only compare the first N documents per segment.
The rest of the documents matching the query are collected to count the total number of results
and to build aggregations.</p>
<p>If you&#8217;re only looking for the last 10 events and have no interest in
the total number of documents that match the query you can set <code class="literal">track_total_hits</code>
to false:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index="events",
    body={
        "size": 10,
        "sort": [{"timestamp": "desc"}],
        "track_total_hits": False,
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  index: 'events',
  body: {
    size: 10,
    sort: [
      {
        timestamp: 'desc'
      }
    ],
    track_total_hits: false
  }
)
puts response</pre>
</div>
<a id="e1f6ea7c0937cf7e6ea7e8209e52e8bb"></a>
<div class="pre_wrapper lang-console default has-python has-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby">GET /events/_search
{
  "size": 10,
  "sort": [ <a id="CO36-1"></a><i class="conum" data-value="1"></i>
      { "timestamp": "desc" }
  ],
  "track_total_hits": false
}</pre>
</div>
<div class="console_widget has-python has-ruby" data-snippet="snippets/110.console"></div>
<div class="calloutlist default has-python has-ruby lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The index sort will be used to rank the top documents and each segment will early terminate the collection after the first 10 matches.</p>
</td>
</tr>
</table>
</div>
<p>This time, Elasticsearch will not try to count the number of documents and will be able to terminate the query
as soon as N documents have been collected per segment.</p>
<a id="44a1acf9f77e74727d4847090036bd6c"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "_shards": ...
   "hits" : {  <a id="CO37-1"></a><i class="conum" data-value="1"></i>
      "max_score" : null,
      "hits" : []
  },
  "took": 20,
  "timed_out": false
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The total number of hits matching the query is unknown because of early termination.</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Aggregations will collect all documents that match the query regardless
of the value of <code class="literal">track_total_hits</code></p>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="index-modules-history-retention.html">« History retention</a>
</span>
<span class="next">
<a href="index-modules-index-sorting-conjunctions.html">Use index sorting to speed up conjunctions »</a>
</span>
</div>
</body>
</html>
