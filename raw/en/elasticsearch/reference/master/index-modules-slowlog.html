<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Slow log | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Slow log | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="index-modules.html" title="Index modules"/>
<link rel="prev" href="index-modules-similarity.html" title="Similarity module"/>
<link rel="next" href="index-modules-store.html" title="Store"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="index-modules-similarity.html">« Similarity module</a>
</span>
<span class="next">
<a href="index-modules-store.html">Store »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index-modules.html">Index modules</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Slow log</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="index-modules-slowlog"></a>Slow log</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
</div></div></div>
<p>The slow log records database searching and indexing events that have execution durations above specified thresholds. You can use these logs to investigate analyze or troubleshoot your cluster&#8217;s historical search and indexing performance.</p>
<p>Slow logs report task duration at the shard level for searches, and at the index level
for indexing, but might not encompass the full task execution time observed on the client. For example, slow logs don&#8217;t surface HTTP network delays or the impact of <a class="xref" href="task-queue-backlog.html" title="Backlogged task queue">task queues</a>.</p>
<p>Events that meet the specified threshold are emitted into <a class="xref" href="logging.html" title="Elasticsearch application logging">Elasticsearch logging</a> under the <code class="literal">fileset.name</code> of <code class="literal">slowlog</code>. These logs can be viewed in the following locations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If <a class="xref" href="monitoring-overview.html" title="Monitoring overview">Elasticsearch monitoring</a> is enabled, from
<a href="/guide/en/kibana/master/xpack-monitoring.html" class="ulink" target="_top">Stack Monitoring</a>. Slow log events have a <code class="literal">logger</code> value of <code class="literal">index.search.slowlog</code> or <code class="literal">index.indexing.slowlog</code>.
</li>
<li class="listitem">
From local Elasticsearch service logs directory. Slow log files have a suffix of <code class="literal">_index_search_slowlog.json</code> or <code class="literal">_index_indexing_slowlog.json</code>.
</li>
</ul>
</div>
<div class="position-relative"><h3><a id="slow-log-format"></a>Slow log format</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>The following is an example of a search event in the slow log:</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a call was initiated with an <code class="literal">X-Opaque-ID</code> header, then the ID is automatically included in Search slow logs in the <span class="strong strong"><strong>elasticsearch.slowlog.id</strong></span> field. See <a class="xref" href="api-conventions.html#x-opaque-id" title="X-Opaque-Id HTTP header">X-Opaque-Id HTTP header</a> for details and best practices.</p>
</div>
</div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "@timestamp": "2024-12-21T12:42:37.255Z",
  "auth.type": "REALM",
  "ecs.version": "1.2.0",
  "elasticsearch.cluster.name": "distribution_run",
  "elasticsearch.cluster.uuid": "Ui23kfF1SHKJwu_hI1iPPQ",
  "elasticsearch.node.id": "JK-jn-XpQ3OsDUsq5ZtfGg",
  "elasticsearch.node.name": "node-0",
  "elasticsearch.slowlog.id": "tomcat-123",
  "elasticsearch.slowlog.message": "[index6][0]",
  "elasticsearch.slowlog.search_type": "QUERY_THEN_FETCH",
  "elasticsearch.slowlog.source": "{\"query\":{\"match_all\":{\"boost\":1.0}}}",
  "elasticsearch.slowlog.stats": "[]",
  "elasticsearch.slowlog.took": "747.3micros",
  "elasticsearch.slowlog.took_millis": 0,
  "elasticsearch.slowlog.total_hits": "1 hits",
  "elasticsearch.slowlog.total_shards": 1,
  "event.dataset": "elasticsearch.index_search_slowlog",
  "fileset.name" : "slowlog",
  "log.level": "WARN",
  "log.logger": "index.search.slowlog.query",
  "process.thread.name": "elasticsearch[runTask-0][search][T#5]",
  "service.name": "ES_ECS",
  "user.name": "elastic",
  "user.realm": "reserved"
}</pre>
</div>
<p>The following is an example of an indexing event in the slow log:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "@timestamp" : "2024-12-11T22:34:22.613Z",
  "auth.type": "REALM",
  "ecs.version": "1.2.0",
  "elasticsearch.cluster.name" : "41bd111609d849fc9bf9d25b5df9ce96",
  "elasticsearch.cluster.uuid" : "BZTn4I9URXSK26imlia0QA",
  "elasticsearch.index.id" : "3VfGR7wRRRKmMCEn7Ii58g",
  "elasticsearch.index.name": "my-index-000001",
  "elasticsearch.node.id" : "GGiBgg21S3eqPDHzQiCMvQ",
  "elasticsearch.node.name" : "instance-0000000001",
  "elasticsearch.slowlog.id" : "RCHbt5MBT0oSsCOu54AJ",
  "elasticsearch.slowlog.source": "{\"key\":\"value\"}"
  "elasticsearch.slowlog.took" : "0.01ms",
  "event.dataset": "elasticsearch.index_indexing_slowlog",
  "fileset.name" : "slowlog",
  "log.level" : "TRACE",
  "log.logger" : "index.indexing.slowlog.index",
  "service.name" : "ES_ECS",
  "user.name": "elastic",
  "user.realm": "reserved"
}</pre>
</div>
<div class="position-relative"><h3><a id="enable-slow-log"></a>Enable slow logging</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>You can enable slow logging at two levels:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For all indices under the <a class="xref" href="settings.html" title="Configuring Elasticsearch">Elasticsearch <code class="literal">log4j2.properties</code> configuration file</a>. This method requires a node restart.
</li>
<li class="listitem">
At the index level, using the <a class="xref" href="indices-update-settings.html" title="Update index settings API">update indices settings API</a>
</li>
</ul>
</div>
<p>By default, all thresholds are set to <code class="literal">-1</code>, which results in no events being logged.</p>
<p>Slow log thresholds can be enabled for the four logging levels: <code class="literal">trace</code>, <code class="literal">debug</code>, <code class="literal">info</code>, and <code class="literal">warn</code>. You can mimic setting log level thresholds by disabling more verbose levels.</p>
<p>To view the current slow log settings, use the <a class="xref" href="indices-get-settings.html" title="Get index settings API">get index settings API</a>:</p>
<a id="bccd4eb26b1a325d103b12e198a13c08"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _all/_settings?expand_wildcards=all&amp;filter_path=*.settings.index.*.slowlog</pre>
</div>
<div class="console_widget" data-snippet="snippets/425.console"></div>
<div class="position-relative"><h4><a id="search-slow-log"></a>Enable slow logging for search events</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>Search slow logs emit per shard. They must be enabled separately for the shard&#8217;s <a href="/blog/understanding-query-then-fetch-vs-dfs-query-then-fetch" class="ulink" target="_top">query and fetch search phases</a>.</p>
<p>You can use the <code class="literal">index.search.slowlog.include.user</code> setting to append <code class="literal">user.*</code> and <code class="literal">auth.type</code> fields to slow log entries. These fields contain information about the user who triggered the request.</p>
<p>The following snippet adjusts all available search slow log settings across all indices using the
<a class="xref" href="settings.html" title="Configuring Elasticsearch"><code class="literal">log4j2.properties</code> configuration file</a>:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">index.search.slowlog.threshold.query.warn: 10s
index.search.slowlog.threshold.query.info: 5s
index.search.slowlog.threshold.query.debug: 2s
index.search.slowlog.threshold.query.trace: 500ms

index.search.slowlog.threshold.fetch.warn: 1s
index.search.slowlog.threshold.fetch.info: 800ms
index.search.slowlog.threshold.fetch.debug: 500ms
index.search.slowlog.threshold.fetch.trace: 200ms

index.search.slowlog.include.user: true</pre>
</div>
<p>The following snippet adjusts the same settings for a single index using the <a class="xref" href="indices-update-settings.html" title="Update index settings API">update indices settings API</a>:</p>
<a id="3312c82f81816bf76629db9582991812"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001/_settings
{
  "index.search.slowlog.threshold.query.warn": "10s",
  "index.search.slowlog.threshold.query.info": "5s",
  "index.search.slowlog.threshold.query.debug": "2s",
  "index.search.slowlog.threshold.query.trace": "500ms",
  "index.search.slowlog.threshold.fetch.warn": "1s",
  "index.search.slowlog.threshold.fetch.info": "800ms",
  "index.search.slowlog.threshold.fetch.debug": "500ms",
  "index.search.slowlog.threshold.fetch.trace": "200ms",
  "index.search.slowlog.include.user": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/426.console"></div>
<div class="position-relative"><h4><a id="index-slow-log"></a>Enable slow logging for indexing events</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>Indexing slow logs emit per index document.</p>
<p>You can use the <code class="literal">index.indexing.slowlog.include.user</code> setting to append <code class="literal">user.*</code> and <code class="literal">auth.type</code> fields to slow log entries. These fields contain information about the user who triggered the request.</p>
<p>The following snippet adjusts all available indexing slow log settings across all indices using the
<a class="xref" href="settings.html" title="Configuring Elasticsearch"><code class="literal">log4j2.properties</code> configuration file</a>:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">index.indexing.slowlog.threshold.index.warn: 10s
index.indexing.slowlog.threshold.index.info: 5s
index.indexing.slowlog.threshold.index.debug: 2s
index.indexing.slowlog.threshold.index.trace: 500ms

index.indexing.slowlog.source: 1000
index.indexing.slowlog.reformat: true

index.indexing.slowlog.include.user: true</pre>
</div>
<p>The following snippet adjusts the same settings for a single index using the <a class="xref" href="indices-update-settings.html" title="Update index settings API">update indices settings API</a>:</p>
<a id="074e4602d1ca54412380a40867d078bc"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /my-index-000001/_settings
{
  "index.indexing.slowlog.threshold.index.warn": "10s",
  "index.indexing.slowlog.threshold.index.info": "5s",
  "index.indexing.slowlog.threshold.index.debug": "2s",
  "index.indexing.slowlog.threshold.index.trace": "500ms",
  "index.indexing.slowlog.source": "1000",
  "index.indexing.slowlog.reformat": true,
  "index.indexing.slowlog.include.user": true
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/427.console"></div>
<div class="position-relative"><h5><a id="_logging_the_source_field"></a>Logging the <code class="literal">_source</code> field</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>By default, Elasticsearch logs the first 1000 characters of the <code class="literal">_source</code> in the slow log. You can adjust how <code class="literal">_source</code> is logged using the <code class="literal">index.indexing.slowlog.source</code> setting. Set <code class="literal">index.indexing.slowlog.source</code> to <code class="literal">false</code> or <code class="literal">0</code> to skip logging the source entirely. Set <code class="literal">index.indexing.slowlog.source</code> to <code class="literal">true</code> to log the entire source regardless of size.</p>
<p>The original <code class="literal">_source</code> is reformatted by default to make sure that it fits on a single log line. If preserving the original document format is important, then you can turn off reformatting by setting <code class="literal">index.indexing.slowlog.reformat</code> to <code class="literal">false</code>. This causes source to be logged with the original formatting intact, potentially spanning multiple log lines.</p>
<div class="position-relative"><h3><a id="troubleshoot-slow-log"></a>Best practices for slow logging</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>Logging slow requests can be resource intensive to your Elasticsearch cluster depending on the qualifying traffic&#8217;s volume. For example, emitted logs might increase the index disk usage of your <a class="xref" href="monitoring-overview.html" title="Monitoring overview">Elasticsearch monitoring</a> cluster. To reduce the impact of slow logs, consider the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Enable slow logs against specific indices rather than across all indices.
</li>
<li class="listitem">
Set high thresholds to reduce the number of logged events.
</li>
<li class="listitem">
Enable slow logs only when troubleshooting.
</li>
</ul>
</div>
<p>If you aren&#8217;t sure how to start investigating traffic issues, consider enabling the <code class="literal">warn</code> threshold with a high <code class="literal">30s</code> threshold at the index level using the <a class="xref" href="indices-update-settings.html" title="Update index settings API">update indices settings API</a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Enable for search requests:</p>
<a id="6b67c6121efb86ee100d40c2646f77b5"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /*/_settings
{
  "index.search.slowlog.include.user": true,
  "index.search.slowlog.threshold.fetch.warn": "30s",
  "index.search.slowlog.threshold.query.warn": "30s"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/428.console"></div>
</li>
<li class="listitem">
<p>Enable for indexing requests:</p>
<a id="ec4b43c3ebd8816799fa004596b2f0cb"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /*/_settings
{
  "index.indexing.slowlog.include.user": true,
  "index.indexing.slowlog.threshold.index.warn": "30s"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/429.console"></div>
</li>
</ul>
</div>
<p>Slow log thresholds being met does not guarantee cluster performance issues. In the event that symptoms are noticed, slow logs can provide helpful data to diagnose upstream traffic patterns or sources to resolve client-side issues. For example, you can use data included in <code class="literal">X-Opaque-ID</code>, the <code class="literal">_source</code> request body, or <code class="literal">user.*</code> fields to identify the source of your issue. This is similar to troubleshooting <a class="xref" href="task-queue-backlog.html" title="Backlogged task queue">live expensive tasks</a>.</p>
<p>If you&#8217;re experiencing search performance issues, then you might also consider investigating searches flagged for their query durations using the <a class="xref" href="search-profile.html" title="Profile API">profile API</a>. You can then use the profiled query to investigate optimization options using the <a href="/guide/en/kibana/master/xpack-profiler.html" class="ulink" target="_top">query profiler</a>. This type of investigation should usually take place in a non-production environment.</p>
<p>Slow logging checks each event against the reporting threshold when the event is complete. This means that it can&#8217;t report if events trigger <a class="xref" href="circuit-breaker-errors.html" title="Circuit breaker errors">circuit breaker errors</a>. If suspect circuit breaker errors, then you should also consider enabling <a class="xref" href="enable-audit-logging.html" title="Enable audit logging">audit logging</a>, which logs events before they are executed.</p>
<div class="position-relative"><h3><a id="_learn_more"></a>Learn more</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>To learn about other ways to optimize your search and indexing requests, refer to <a class="xref" href="tune-for-search-speed.html" title="Tune for search speed">tune for search speed</a> and <a class="xref" href="tune-for-indexing-speed.html" title="Tune for indexing speed">tune for indexing speed</a>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="index-modules-similarity.html">« Similarity module</a>
</span>
<span class="next">
<a href="index-modules-store.html">Store »</a>
</span>
</div>
</body>
</html>
