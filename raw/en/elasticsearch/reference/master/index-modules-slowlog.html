<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Slow Log | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Slow Log | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="index-modules.html" title="Index modules"/>
<link rel="prev" href="index-modules-similarity.html" title="Similarity module"/>
<link rel="next" href="index-modules-store.html" title="Store"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="index-modules-similarity.html">« Similarity module</a>
</span>
<span class="next">
<a href="index-modules-store.html">Store »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index-modules.html">Index modules</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Slow Log</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="index-modules-slowlog"></a>Slow Log</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
</div></div></div>
<div class="position-relative"><h3><a id="search-slow-log"></a>Search Slow Log</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>Shard level slow search log allows to log slow search (query and fetch
phases) into a dedicated log file.</p>
<p>Thresholds can be set for both the query phase of the execution, and
fetch phase, here is a sample:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">index.search.slowlog.threshold.query.warn: 10s
index.search.slowlog.threshold.query.info: 5s
index.search.slowlog.threshold.query.debug: 2s
index.search.slowlog.threshold.query.trace: 500ms

index.search.slowlog.threshold.fetch.warn: 1s
index.search.slowlog.threshold.fetch.info: 800ms
index.search.slowlog.threshold.fetch.debug: 500ms
index.search.slowlog.threshold.fetch.trace: 200ms</pre>
</div>
<p>All of the above settings are <em>dynamic</em> and can be set for each index using the
<a class="xref" href="indices-update-settings.html" title="Update index settings API">update indices settings</a> API. For example:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.put_settings(
    index="my-index-000001",
    settings={
        "index.search.slowlog.threshold.query.warn": "10s",
        "index.search.slowlog.threshold.query.info": "5s",
        "index.search.slowlog.threshold.query.debug": "2s",
        "index.search.slowlog.threshold.query.trace": "500ms",
        "index.search.slowlog.threshold.fetch.warn": "1s",
        "index.search.slowlog.threshold.fetch.info": "800ms",
        "index.search.slowlog.threshold.fetch.debug": "500ms",
        "index.search.slowlog.threshold.fetch.trace": "200ms"
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_settings(
  index: 'my-index-000001',
  body: {
    'index.search.slowlog.threshold.query.warn' =&gt; '10s',
    'index.search.slowlog.threshold.query.info' =&gt; '5s',
    'index.search.slowlog.threshold.query.debug' =&gt; '2s',
    'index.search.slowlog.threshold.query.trace' =&gt; '500ms',
    'index.search.slowlog.threshold.fetch.warn' =&gt; '1s',
    'index.search.slowlog.threshold.fetch.info' =&gt; '800ms',
    'index.search.slowlog.threshold.fetch.debug' =&gt; '500ms',
    'index.search.slowlog.threshold.fetch.trace' =&gt; '200ms'
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putSettings({
  index: "my-index-000001",
  settings: {
    "index.search.slowlog.threshold.query.warn": "10s",
    "index.search.slowlog.threshold.query.info": "5s",
    "index.search.slowlog.threshold.query.debug": "2s",
    "index.search.slowlog.threshold.query.trace": "500ms",
    "index.search.slowlog.threshold.fetch.warn": "1s",
    "index.search.slowlog.threshold.fetch.info": "800ms",
    "index.search.slowlog.threshold.fetch.debug": "500ms",
    "index.search.slowlog.threshold.fetch.trace": "200ms",
  },
});
console.log(response);</pre>
</div>
<a id="23af230e824f48b9cd56a4cf973d788c"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT /my-index-000001/_settings
{
  "index.search.slowlog.threshold.query.warn": "10s",
  "index.search.slowlog.threshold.query.info": "5s",
  "index.search.slowlog.threshold.query.debug": "2s",
  "index.search.slowlog.threshold.query.trace": "500ms",
  "index.search.slowlog.threshold.fetch.warn": "1s",
  "index.search.slowlog.threshold.fetch.info": "800ms",
  "index.search.slowlog.threshold.fetch.debug": "500ms",
  "index.search.slowlog.threshold.fetch.trace": "200ms"
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/100.console"></div>
<p>By default thresholds are disabled (set to <code class="literal">-1</code>).</p>
<p>The logging is done on the shard level scope, meaning the execution of a
search request within a specific shard. It does not encompass the whole
search request, which can be broadcast to several shards in order to
execute. Some of the benefits of shard level logging is the association
of the actual execution on the specific machine, compared with request
level.</p>
<p>The search slow log file is configured in the <code class="literal">log4j2.properties</code> file.</p>
<div class="position-relative"><h4><a id="_identifying_search_slow_log_origin"></a>Identifying search slow log origin</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>It is often useful to identify what triggered a slow running query.
To include information about the user that triggered a slow search,
use the <code class="literal">index.search.slowlog.include.user</code> setting.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.put_settings(
    index="my-index-000001",
    settings={
        "index.search.slowlog.include.user": True
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_settings(
  index: 'my-index-000001',
  body: {
    'index.search.slowlog.include.user' =&gt; true
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putSettings({
  index: "my-index-000001",
  settings: {
    "index.search.slowlog.include.user": true,
  },
});
console.log(response);</pre>
</div>
<a id="34cdeefb09bbbe5206957a8bc1bd513d"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT /my-index-000001/_settings
{
  "index.search.slowlog.include.user": true
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/101.console"></div>
<p>This will result in user information being included in the slow log.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "@timestamp": "2024-02-21T12:42:37.255Z",
  "log.level": "WARN",
  "auth.type": "REALM",
  "elasticsearch.slowlog.id": "tomcat-123",
  "elasticsearch.slowlog.message": "[index6][0]",
  "elasticsearch.slowlog.search_type": "QUERY_THEN_FETCH",
  "elasticsearch.slowlog.source": "{\"query\":{\"match_all\":{\"boost\":1.0}}}",
  "elasticsearch.slowlog.stats": "[]",
  "elasticsearch.slowlog.took": "747.3micros",
  "elasticsearch.slowlog.took_millis": 0,
  "elasticsearch.slowlog.total_hits": "1 hits",
  "elasticsearch.slowlog.total_shards": 1,
  "user.name": "elastic",
  "user.realm": "reserved",
  "ecs.version": "1.2.0",
  "service.name": "ES_ECS",
  "event.dataset": "elasticsearch.index_search_slowlog",
  "process.thread.name": "elasticsearch[runTask-0][search][T#5]",
  "log.logger": "index.search.slowlog.query",
  "elasticsearch.cluster.uuid": "Ui23kfF1SHKJwu_hI1iPPQ",
  "elasticsearch.node.id": "JK-jn-XpQ3OsDUsq5ZtfGg",
  "elasticsearch.node.name": "node-0",
  "elasticsearch.cluster.name": "distribution_run"
}</pre>
</div>
<p>If a call was initiated with an <code class="literal">X-Opaque-ID</code> header, then the ID is included
in Search Slow logs in the <span class="strong strong"><strong>elasticsearch.slowlog.id</strong></span> field. See
<a class="xref" href="api-conventions.html#x-opaque-id" title="X-Opaque-Id HTTP header">X-Opaque-Id HTTP header</a> for details and best practices.</p>
<div class="position-relative"><h3><a id="index-slow-log"></a>Index Slow log</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>The indexing slow log, similar in functionality to the search slow
log. The log file name ends with <code class="literal">_index_indexing_slowlog.json</code>. Log and
the thresholds are configured in the same way as the search slowlog.
Index slowlog sample:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">index.indexing.slowlog.threshold.index.warn: 10s
index.indexing.slowlog.threshold.index.info: 5s
index.indexing.slowlog.threshold.index.debug: 2s
index.indexing.slowlog.threshold.index.trace: 500ms
index.indexing.slowlog.source: 1000</pre>
</div>
<p>All of the above settings are <em>dynamic</em> and can be set for each index using the
<a class="xref" href="indices-update-settings.html" title="Update index settings API">update indices settings</a> API. For example:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.put_settings(
    index="my-index-000001",
    settings={
        "index.indexing.slowlog.threshold.index.warn": "10s",
        "index.indexing.slowlog.threshold.index.info": "5s",
        "index.indexing.slowlog.threshold.index.debug": "2s",
        "index.indexing.slowlog.threshold.index.trace": "500ms",
        "index.indexing.slowlog.source": "1000"
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_settings(
  index: 'my-index-000001',
  body: {
    'index.indexing.slowlog.threshold.index.warn' =&gt; '10s',
    'index.indexing.slowlog.threshold.index.info' =&gt; '5s',
    'index.indexing.slowlog.threshold.index.debug' =&gt; '2s',
    'index.indexing.slowlog.threshold.index.trace' =&gt; '500ms',
    'index.indexing.slowlog.source' =&gt; '1000'
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putSettings({
  index: "my-index-000001",
  settings: {
    "index.indexing.slowlog.threshold.index.warn": "10s",
    "index.indexing.slowlog.threshold.index.info": "5s",
    "index.indexing.slowlog.threshold.index.debug": "2s",
    "index.indexing.slowlog.threshold.index.trace": "500ms",
    "index.indexing.slowlog.source": "1000",
  },
});
console.log(response);</pre>
</div>
<a id="844928da2ff9a1394af5347a5e2e4f78"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT /my-index-000001/_settings
{
  "index.indexing.slowlog.threshold.index.warn": "10s",
  "index.indexing.slowlog.threshold.index.info": "5s",
  "index.indexing.slowlog.threshold.index.debug": "2s",
  "index.indexing.slowlog.threshold.index.trace": "500ms",
  "index.indexing.slowlog.source": "1000"
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/102.console"></div>
<p>To include information about the user that triggered a slow indexing event,
use the <code class="literal">index.indexing.slowlog.include.user</code> setting.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.put_settings(
    index="my-index-000001",
    settings={
        "index.indexing.slowlog.include.user": True
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.put_settings(
  index: 'my-index-000001',
  body: {
    'index.indexing.slowlog.include.user' =&gt; true
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.putSettings({
  index: "my-index-000001",
  settings: {
    "index.indexing.slowlog.include.user": true,
  },
});
console.log(response);</pre>
</div>
<a id="2f07b81fd47ec3b074242a760f0c4e9e"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT /my-index-000001/_settings
{
  "index.indexing.slowlog.include.user": true
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/103.console"></div>
<p>By default Elasticsearch will log the first 1000 characters of the _source in
the slowlog. You can change that with <code class="literal">index.indexing.slowlog.source</code>. Setting
it to <code class="literal">false</code> or <code class="literal">0</code> will skip logging the source entirely, while setting it to
<code class="literal">true</code> will log the entire source regardless of size. The original <code class="literal">_source</code> is
reformatted by default to make sure that it fits on a single log line. If preserving
the original document format is important, you can turn off reformatting by setting
<code class="literal">index.indexing.slowlog.reformat</code> to <code class="literal">false</code>, which will cause the source to be
logged "as is" and can potentially span multiple log lines.</p>
<p>The index slow log file is configured in the <code class="literal">log4j2.properties</code> file.</p>
<div class="position-relative"><h3><a id="_slow_log_levels"></a>Slow log levels</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/index-modules/slowlog.asciidoc">edit</a></div>
<p>You can mimic the search or indexing slow log level by setting appropriate
threshold making "more verbose" loggers to be switched off.
If for instance we want to simulate <code class="literal">index.indexing.slowlog.level: INFO</code>
then all we need to do is to set
<code class="literal">index.indexing.slowlog.threshold.index.debug</code> and <code class="literal">index.indexing.slowlog.threshold.index.trace</code> to <code class="literal">-1</code>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="index-modules-similarity.html">« Similarity module</a>
</span>
<span class="next">
<a href="index-modules-store.html">Store »</a>
</span>
</div>
</body>
</html>
