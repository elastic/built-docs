<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Get anomaly detection jobs API | Elasticsearch Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="ml-ad-apis.html" title="Machine learning anomaly detection APIs"/>
<link rel="prev" href="ml-get-influencer.html" title="Get influencers API"/>
<link rel="next" href="ml-get-job-stats.html" title="Get anomaly detection job statistics API"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="ml-ad-apis.html">Machine learning anomaly detection APIs</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-get-influencer.html">« Get influencers API</a>
</span>
<span class="next">
<a href="ml-get-job-stats.html">Get anomaly detection job statistics API »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-get-job"></a>Get anomaly detection jobs API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h2>
</div></div></div>

<p>Retrieves configuration information for anomaly detection jobs.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/&lt;job_id&gt;,&lt;job_id&gt;</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/</code><br></p>
<p><code class="literal">GET _ml/anomaly_detectors/_all</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">monitor_ml</code> cluster privilege. This privilege is included in the
<code class="literal">machine_learning_user</code> built-in role.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>This API returns a maximum of 10,000 jobs.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;job_id&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
Identifier for the anomaly detection job. It can be a job identifier, a group
name, or a wildcard expression. You can get information for multiple
anomaly detection jobs in a single API request by using a group name, a comma-separated
list of jobs, or a wildcard expression. You can get information for all
anomaly detection jobs by using <code class="literal">_all</code>, by specifying <code class="literal">*</code> as the job identifier, or by
omitting the identifier.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">allow_no_match</code>
</span>
</dt>
<dd>
<p>
(Optional, Boolean)
Specifies what to do when the request:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Contains wildcard expressions and there are no jobs that match.
</li>
<li class="listitem">
Contains the <code class="literal">_all</code> string or no identifiers and there are no matches.
</li>
<li class="listitem">
Contains wildcard expressions and there are only partial matches.
</li>
</ul>
</div>
<p>The default value is <code class="literal">true</code>, which returns an empty <code class="literal">jobs</code> array
when there are no matches and the subset of results when there are partial
matches. If this parameter is <code class="literal">false</code>, the request returns a <code class="literal">404</code> status code
when there are no matches or only partial matches.</p>
</dd>
<dt>
<span class="term">
<code class="literal">exclude_generated</code>
</span>
</dt>
<dd>
(Optional, Boolean)
Indicates if certain fields should be removed from the configuration on
retrieval. This allows the configuration to be in an acceptable format to be retrieved
and then added to another cluster. Default is false.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-results"></a>Response body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<p>The API returns an array of anomaly detection job resources. For the full list of
properties, see <a class="xref" href="ml-put-job.html#ml-put-job-request-body" title="Request body">create anomaly detection jobs API</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">blocked</code>
</span>
</dt>
<dd>
<p>
(object) When present, it explains that a task is executed on the job
that blocks it from opening.
</p>
<details open>
<summary class="title">Properties of <code class="literal">blocked</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">reason</code>
</span>
</dt>
<dd>
(string) The reason the job is blocked. Values may be <code class="literal">delete</code>, <code class="literal">reset</code>, <code class="literal">revert</code>.
Each value means the corresponding action is being executed.
</dd>
<dt>
<span class="term">
<code class="literal">task_id</code>
</span>
</dt>
<dd>
(string) The task id of the blocking action. You can use the <a class="xref" href="tasks.html" title="Task management API">Task management</a> API to
monitor progress.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">create_time</code>
</span>
</dt>
<dd>
(string) The time the job was created. For example, <code class="literal">1491007356077</code>. This
property is informational; you cannot change its value.
</dd>
<dt>
<span class="term">
<code class="literal">datafeed_config</code>
</span>
</dt>
<dd>
<p>
(object) The datafeed configured for the current anomaly detection job.
</p>
<details open>
<summary class="title">Properties of <code class="literal">datafeed_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">authorization</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
The security privileges that the datafeed uses to run its queries. If
Elastic Stack security features were disabled at the time of the most recent update to
the datafeed, this property is omitted.
</p>
<details open>
<summary class="title">Properties of <code class="literal">authorization</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">api_key</code>
</span>
</dt>
<dd>
<p>
(object) If an API key was used for the most recent update to the datafeed, its
name and identifier are listed in the response.
</p>
<details open>
<summary class="title">Properties of <code class="literal">api_key</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">id</code>
</span>
</dt>
<dd>
(string) The identifier for the API key.
</dd>
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(string) The name of the API key.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">roles</code>
</span>
</dt>
<dd>
(array of strings) If a user ID was used for the most recent update to the
datafeed, its roles at the time of the update are listed in the response.
</dd>
<dt>
<span class="term">
<code class="literal">service_account</code>
</span>
</dt>
<dd>
(string) If a service account was used for the most recent update to the datafeed,
the account name is listed in the response.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">datafeed_id</code>
</span>
</dt>
<dd>
(Optional, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</dd>
<dt>
<span class="term">
<code class="literal">aggregations</code>
</span>
</dt>
<dd>
(Optional, object)
If set, the datafeed performs aggregation searches. Support for aggregations is
limited and should be used only with low cardinality data. For more information,
see
<a href="/guide/en/machine-learning/master/ml-configuring-aggregation.html" class="ulink" target="_top">Aggregating data for faster performance</a>.
</dd>
<dt>
<span class="term">
<code class="literal">chunking_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Datafeeds might be required to search over long time periods, for several
months or years. This search is split into time chunks in order to ensure the
load on Elasticsearch is managed. Chunking configuration controls how the size of these
time chunks are calculated and is an advanced configuration option.
</p>
<details open>
<summary class="title">Properties of <code class="literal">chunking_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">mode</code>
</span>
</dt>
<dd>
<p>
(string)
There are three available modes:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">auto</code>: The chunk size is dynamically calculated. This is the default and
recommended value when the datafeed does not use aggregations.
</li>
<li class="listitem">
<code class="literal">manual</code>: Chunking is applied according to the specified <code class="literal">time_span</code>. Use this
mode when the datafeed uses aggregations.
</li>
<li class="listitem">
<code class="literal">off</code>: No chunking is applied.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">time_span</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The time span that each search will be querying. This setting is only applicable
when the mode is set to <code class="literal">manual</code>. For example: <code class="literal">3h</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">delayed_data_check_config</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies whether the datafeed checks for missing data and the size of the
window. For example: <code class="literal">{"enabled": true, "check_window": "1h"}</code>.
</p>
<p>The datafeed can optionally search over indices that have already been read in
an effort to determine whether any data has subsequently been added to the
index. If missing data is found, it is a good indication that the <code class="literal">query_delay</code>
option is set too low and the data is being indexed after the datafeed has passed
that moment in time. See
<a href="/guide/en/machine-learning/master/ml-delayed-data-detection.html" class="ulink" target="_top">Working with delayed data</a>.</p>
<p>This check runs only on real-time datafeeds.</p>
<details open>
<summary class="title">Properties of <code class="literal">delayed_data_check_config</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">check_window</code>
</span>
</dt>
<dd>
(<a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The window of time that is searched for late data. This window of time ends with
the latest finalized bucket. It defaults to <code class="literal">null</code>, which causes an appropriate
<code class="literal">check_window</code> to be calculated when the real-time datafeed runs. In particular,
the default <code class="literal">check_window</code> span calculation is based on the maximum of <code class="literal">2h</code> or
<code class="literal">8 * bucket_span</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Boolean)
Specifies whether the datafeed periodically checks for delayed data. Defaults to
<code class="literal">true</code>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">frequency</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The interval at which scheduled queries are made while the datafeed runs in real
time. The default value is either the bucket span for short bucket spans, or,
for longer bucket spans, a sensible fraction of the bucket span. For example:
<code class="literal">150s</code>. When <code class="literal">frequency</code> is shorter than the bucket span, interim results for
the last (partial) bucket are written then eventually overwritten by the full
bucket results. If the datafeed uses aggregations, this value must be divisible
by the interval of the date histogram aggregation.
</dd>
<dt>
<span class="term">
<code class="literal">indices</code>
</span>
</dt>
<dd>
<p>
(Required, array)
An array of index names. Wildcards are supported. For example:
<code class="literal">["it_ops_metrics", "server*"]</code>.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If any indices are in remote clusters then the machine learning nodes need to have the
<code class="literal">remote_cluster_client</code> role.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">indices_options</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies index expansion options that are used during search.
</p>
<p>For example:</p>
<pre class="screen">{
   "expand_wildcards": ["all"],
   "ignore_unavailable": true,
   "allow_no_indices": "false",
   "ignore_throttled": true
}</pre>
<p>For more information about these options, see <a class="xref" href="multi-index.html" title="Multi-target syntax">Multi-target syntax</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">job_id</code>
</span>
</dt>
<dd>
(Required, string)
Identifier for the anomaly detection job.
</dd>
<dt>
<span class="term">
<code class="literal">max_empty_searches</code>
</span>
</dt>
<dd>
(Optional,integer)
If a real-time datafeed has never seen any data (including during any initial
training period) then it will automatically stop itself and close its associated
job after this many real-time searches that return no documents. In other words,
it will stop after <code class="literal">frequency</code> times <code class="literal">max_empty_searches</code> of real-time
operation. If not set then a datafeed with no end time that sees no data will
remain started until it is explicitly stopped. By default this setting is not
set.
</dd>
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(Optional, object)
The Elasticsearch query domain-specific language (DSL). This value corresponds to the
query object in an Elasticsearch search POST body. All the options that are supported by
Elasticsearch can be used, as this object is passed verbatim to Elasticsearch. By default, this
property has the following value: <code class="literal">{"match_all": {"boost": 1}}</code>.
</dd>
<dt>
<span class="term">
<code class="literal">query_delay</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="api-conventions.html#time-units" title="Time units">time units</a>)
The number of seconds behind real time that data is queried. For example, if
data from 10:04 a.m. might not be searchable in Elasticsearch until 10:06 a.m., set this
property to 120 seconds. The default value is randomly selected between <code class="literal">60s</code>
and <code class="literal">120s</code>. This randomness improves the query performance when there are
multiple jobs running on the same node. For more information, see
<a href="/guide/en/machine-learning/master/ml-delayed-data-detection.html" class="ulink" target="_top">Handling delayed data</a>.
</dd>
<dt>
<span class="term">
<code class="literal">runtime_mappings</code>
</span>
</dt>
<dd>
<p>
(Optional, object)
Specifies runtime fields for the datafeed search.
</p>
<p>For example:</p>
<pre class="screen">{
  "day_of_week": {
    "type": "keyword",
    "script": {
      "source": "emit(doc['@timestamp'].value.dayOfWeekEnum.getDisplayName(TextStyle.FULL, Locale.ROOT))"
    }
  }
}</pre>
</dd>
<dt>
<span class="term">
<code class="literal">script_fields</code>
</span>
</dt>
<dd>
(Optional, object)
Specifies scripts that evaluate custom expressions and returns script fields to
the datafeed. The detector configuration objects in a job can contain functions
that use these script fields. For more information, see
<a href="/guide/en/machine-learning/master/ml-configuring-transform.html" class="ulink" target="_top">Transforming data with script fields</a>
and <a class="xref" href="search-fields.html#script-fields" title="Script fields">Script fields</a>.
</dd>
<dt>
<span class="term">
<code class="literal">scroll_size</code>
</span>
</dt>
<dd>
(Optional, unsigned integer)
The <code class="literal">size</code> parameter that is used in Elasticsearch searches when the datafeed does not use
aggregations. The default value is <code class="literal">1000</code>. The maximum value is the value of
<code class="literal">index.max_result_window</code> which is 10,000 by default.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">finished_time</code>
</span>
</dt>
<dd>
(string) If the job closed or failed, this is the time the job finished,
otherwise it is <code class="literal">null</code>. This property is informational; you cannot change its
value.
</dd>
<dt>
<span class="term">
<code class="literal">job_type</code>
</span>
</dt>
<dd>
(string) Reserved for future use, currently set to <code class="literal">anomaly_detector</code>.
</dd>
<dt>
<span class="term">
<code class="literal">job_version</code>
</span>
</dt>
<dd>
(string) The version of Elasticsearch that existed on the node when the job was created.
</dd>
<dt>
<span class="term">
<code class="literal">model_snapshot_id</code>
</span>
</dt>
<dd>
(string)
A numerical character string that uniquely identifies the model snapshot. For
example, <code class="literal">1575402236000</code>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-response-codes"></a>Response codes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">404</code> (Missing resources)
</span>
</dt>
<dd>
If <code class="literal">allow_no_match</code> is <code class="literal">false</code>, this code indicates that there are no
resources that match the request or only partial matches for the request.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-get-job-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/get-job.asciidoc">edit</a></h3>
</div></div></div>
<a id="86280dcb49aa89083be4b2644daf1b7c"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/anomaly_detectors/high_sum_total_sales</pre>
</div>
<div class="console_widget" data-snippet="snippets/2516.console"></div>
<p>The API returns the following results:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">{
  "count": 1,
  "jobs": [
    {
      "job_id" : "high_sum_total_sales",
      "job_type" : "anomaly_detector",
      "job_version" : "8.4.0",
      "create_time" : 1655852735889,
      "finished_time" : 1655852745980,
      "model_snapshot_id" : "1575402237",
      "custom_settings" : {
        "created_by" : "ml-module-sample",
        ...
      },
      "datafeed_config" : {
        "datafeed_id" : "datafeed-high_sum_total_sales",
        "job_id" : "high_sum_total_sales",
        "authorization" : {
          "roles" : [
            "superuser"
          ]
        },
        "query_delay" : "93169ms",
        "chunking_config" : {
          "mode" : "auto"
        },
        "indices_options" : {
          "expand_wildcards" : [
            "open"
          ],
          "ignore_unavailable" : false,
          "allow_no_indices" : true,
          "ignore_throttled" : true
        },
        "query" : {
          "bool" : {
            "filter" : [
              {
                "term" : {
                  "event.dataset" : "sample_ecommerce"
                }
              }
            ]
          }
        },
        "indices" : [
          "kibana_sample_data_ecommerce"
        ],
        "scroll_size" : 1000,
        "delayed_data_check_config" : {
          "enabled" : true
        }
      },
      "groups" : [
        "kibana_sample_data",
        "kibana_sample_ecommerce"
      ],
      "description" : "Find customers spending an unusually high amount in an hour",
      "analysis_config" : {
        "bucket_span" : "1h",
        "detectors" : [
          {
            "detector_description" : "High total sales",
            "function" : "high_sum",
            "field_name" : "taxful_total_price",
            "over_field_name" : "customer_full_name.keyword",
            "detector_index" : 0
          }
        ],
        "influencers" : [
          "customer_full_name.keyword",
          "category.keyword"
        ],
        "model_prune_window": "30d"
      },
      "analysis_limits" : {
        "model_memory_limit" : "13mb",
        "categorization_examples_limit" : 4
      },
      "data_description" : {
        "time_field" : "order_date",
        "time_format" : "epoch_ms"
      },
      "model_plot_config" : {
        "enabled" : true,
        "annotations_enabled" : true
      },
      "model_snapshot_retention_days" : 10,
      "daily_model_snapshot_retention_after_days" : 1,
      "results_index_name" : "shared",
      "allow_lazy_open" : false
    }
  ]
}</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ml-get-influencer.html">« Get influencers API</a>
</span>
<span class="next">
<a href="ml-get-job-stats.html">Get anomaly detection job statistics API »</a>
</span>
</div>
</div>
</body>
</html>
