<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch diagnostic, diagnostics">
<title>Preview datafeeds API | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Preview datafeeds API | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="ml-ad-apis.html" title="Machine learning anomaly detection APIs"/>
<link rel="prev" href="ml-post-data.html" title="Post data to jobs API"/>
<link rel="next" href="ml-reset-job.html" title="Reset anomaly detection jobs API"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="ml-post-data.html">« Post data to jobs API</a>
</span>
<span class="next">
<a href="ml-reset-job.html">Reset anomaly detection jobs API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ml-ad-apis.html">Machine learning anomaly detection APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Preview datafeeds API</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-preview-datafeed"></a>Preview datafeeds API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h2>
</div></div></div>

<p>Previews a datafeed.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">GET _ml/datafeeds/&lt;datafeed_id&gt;/_preview</code><br></p>
<p><code class="literal">POST _ml/datafeeds/&lt;datafeed_id&gt;/_preview</code><br></p>
<p><code class="literal">GET _ml/datafeeds/_preview</code><br></p>
<p><code class="literal">POST _ml/datafeeds/_preview</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the following privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
cluster: <code class="literal">manage_ml</code> (the <code class="literal">machine_learning_admin</code> built-in role grants this
privilege)
</li>
<li class="listitem">
source index configured in the datafeed: <code class="literal">read</code>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-desc"></a>Description<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>The preview datafeeds API returns the first "page" of search results from a
datafeed. You can preview an existing datafeed or provide configuration details
for the datafeed and anomaly detection job in the API. The preview shows the structure of
the data that will be passed to the anomaly detection engine.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When Elasticsearch security features are enabled, the datafeed query is
previewed using the credentials of the user calling the preview datafeed API.
When the datafeed is started it runs the query using the roles of the last user
to create or update it. If the two sets of roles differ then the preview may
not accurately reflect what the datafeed will return when started. To avoid
such problems, the same user that creates or updates the datafeed should preview
it to ensure it is returning the expected data. Alternatively, use
<a class="xref" href="http-clients.html#http-clients-secondary-authorization" title="Secondary authorization">secondary authorization headers</a> to
supply the credentials.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-path-parms"></a>Path parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;datafeed_id&gt;</code>
</span>
</dt>
<dd>
<p>
(Optional, string)
A numerical character string that uniquely identifies the
datafeed. This identifier can contain lowercase alphanumeric characters (a-z
and 0-9), hyphens, and underscores. It must start and end with alphanumeric
characters.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you provide the <code class="literal">&lt;datafeed_id&gt;</code> as a path parameter, you cannot
provide datafeed or anomaly detection job configuration details in the request body.</p>
</div>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-query-parms"></a>Query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">end</code>
</span>
</dt>
<dd>
<p>
(Optional, string) The time that the datafeed preview should end. The preview may not go to the end of the provided value
as only the first page of results are returned. The time can be specified by using one of the following formats:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
ISO 8601 format with milliseconds, for example <code class="literal">2017-01-22T06:00:00.000Z</code>
</li>
<li class="listitem">
ISO 8601 format without milliseconds, for example <code class="literal">2017-01-22T06:00:00+00:00</code>
</li>
<li class="listitem">
Milliseconds since the epoch, for example <code class="literal">1485061200000</code>
</li>
</ul>
</div>
<p>Date-time arguments using either of the ISO 8601 formats must have a time zone
designator, where <code class="literal">Z</code> is accepted as an abbreviation for UTC time.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When a URL is expected (for example, in browsers), the <code class="literal">+</code> used in time
zone designators must be encoded as <code class="literal">%2B</code>.</p>
</div>
</div>
<p>This value is exclusive.</p>
</dd>
<dt>
<span class="term">
<code class="literal">start</code>
</span>
</dt>
<dd>
(Optional, string) The time that the datafeed preview should begin, which can be
specified by using the same formats as the <code class="literal">end</code> parameter. This value is
inclusive.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you don&#8217;t provide either the <code class="literal">start</code> or <code class="literal">end</code> parameter, the datafeed preview will search over the entire
time of data but exclude data within <code class="literal">cold</code> or <code class="literal">frozen</code> <a class="xref" href="data-tiers.html" title="Data tiers">data tiers</a>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-request-body"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">datafeed_config</code>
</span>
</dt>
<dd>
(Optional, object) The datafeed definition to preview. For valid definitions, see
the <a class="xref" href="ml-put-datafeed.html#ml-put-datafeed-request-body" title="Request body">create datafeeds API</a>.
</dd>
<dt>
<span class="term">
<code class="literal">job_config</code>
</span>
</dt>
<dd>
(Optional, object) The configuration details for the anomaly detection job that is
associated with the datafeed. If the <code class="literal">datafeed_config</code> object does not include a
<code class="literal">job_id</code> that references an existing anomaly detection job, you must supply this
<code class="literal">job_config</code> object. If you include both a <code class="literal">job_id</code> and a <code class="literal">job_config</code>, the
latter information is used. You cannot specify a <code class="literal">job_config</code> object unless you also supply a <code class="literal">datafeed_config</code> object. For valid definitions, see the
<a class="xref" href="ml-put-job.html#ml-put-job-request-body" title="Request body">create anomaly detection jobs API</a>.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ml-preview-datafeed-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ml/anomaly-detection/apis/preview-datafeed.asciidoc">edit</a></h3>
</div></div></div>
<p>This is an example of providing the ID of an existing datafeed:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ml.preview_datafeed(
  datafeed_id: 'datafeed-high_sum_total_sales'
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ml.previewDatafeed({
  datafeed_id: "datafeed-high_sum_total_sales",
});
console.log(response);</pre>
</div>
<a id="38eed000de433b540116928681c520d3"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">GET _ml/datafeeds/datafeed-high_sum_total_sales/_preview</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/2945.console"></div>
<p>The data that is returned for this example is as follows:</p>
<a id="cb9301147c1c73e6d4b6abfbe731e2f7"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">[
  {
    "order_date" : 1574294659000,
    "category.keyword" : "Men's Clothing",
    "customer_full_name.keyword" : "Sultan Al Benson",
    "taxful_total_price" : 35.96875
  },
  {
    "order_date" : 1574294918000,
    "category.keyword" : [
      "Women's Accessories",
      "Women's Clothing"
    ],
    "customer_full_name.keyword" : "Pia Webb",
    "taxful_total_price" : 83.0
  },
  {
    "order_date" : 1574295782000,
    "category.keyword" : [
      "Women's Accessories",
      "Women's Shoes"
    ],
    "customer_full_name.keyword" : "Brigitte Graham",
    "taxful_total_price" : 72.0
  }
]</pre>
</div>
<p>The following example provides datafeed and anomaly detection job configuration
details in the API:</p>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.ml.preview_datafeed(
  body: {
    datafeed_config: {
      indices: [
        'kibana_sample_data_ecommerce'
      ],
      query: {
        bool: {
          filter: [
            {
              term: {
                _index: 'kibana_sample_data_ecommerce'
              }
            }
          ]
        }
      },
      scroll_size: 1000
    },
    job_config: {
      description: 'Find customers spending an unusually high amount in an hour',
      analysis_config: {
        bucket_span: '1h',
        detectors: [
          {
            detector_description: 'High total sales',
            function: 'high_sum',
            field_name: 'taxful_total_price',
            over_field_name: 'customer_full_name.keyword'
          }
        ],
        influencers: [
          'customer_full_name.keyword',
          'category.keyword'
        ]
      },
      analysis_limits: {
        model_memory_limit: '10mb'
      },
      data_description: {
        time_field: 'order_date',
        time_format: 'epoch_ms'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.ml.previewDatafeed({
  datafeed_config: {
    indices: ["kibana_sample_data_ecommerce"],
    query: {
      bool: {
        filter: [
          {
            term: {
              _index: "kibana_sample_data_ecommerce",
            },
          },
        ],
      },
    },
    scroll_size: 1000,
  },
  job_config: {
    description: "Find customers spending an unusually high amount in an hour",
    analysis_config: {
      bucket_span: "1h",
      detectors: [
        {
          detector_description: "High total sales",
          function: "high_sum",
          field_name: "taxful_total_price",
          over_field_name: "customer_full_name.keyword",
        },
      ],
      influencers: ["customer_full_name.keyword", "category.keyword"],
    },
    analysis_limits: {
      model_memory_limit: "10mb",
    },
    data_description: {
      time_field: "order_date",
      time_format: "epoch_ms",
    },
  },
});
console.log(response);</pre>
</div>
<a id="08c9af9dd519c011deedd406f3061836"></a>
<div class="pre_wrapper lang-console default has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-ruby has-js">POST _ml/datafeeds/_preview
{
  "datafeed_config": {
    "indices" : [
      "kibana_sample_data_ecommerce"
    ],
    "query" : {
      "bool" : {
        "filter" : [
          {
            "term" : {
              "_index" : "kibana_sample_data_ecommerce"
            }
          }
        ]
      }
    },
    "scroll_size" : 1000
  },
  "job_config": {
    "description" : "Find customers spending an unusually high amount in an hour",
    "analysis_config" : {
      "bucket_span" : "1h",
      "detectors" : [
        {
          "detector_description" : "High total sales",
          "function" : "high_sum",
          "field_name" : "taxful_total_price",
          "over_field_name" : "customer_full_name.keyword"
        }
      ],
      "influencers" : [
        "customer_full_name.keyword",
        "category.keyword"
      ]
    },
    "analysis_limits" : {
      "model_memory_limit" : "10mb"
    },
    "data_description" : {
      "time_field" : "order_date",
      "time_format" : "epoch_ms"
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-js" data-snippet="snippets/2946.console"></div>
<p>The data that is returned for this example is as follows:</p>
<a id="cb9301147c1c73e6d4b6abfbe731e2f7"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">[
  {
    "order_date" : 1574294659000,
    "category.keyword" : "Men's Clothing",
    "customer_full_name.keyword" : "Sultan Al Benson",
    "taxful_total_price" : 35.96875
  },
  {
    "order_date" : 1574294918000,
    "category.keyword" : [
      "Women's Accessories",
      "Women's Clothing"
    ],
    "customer_full_name.keyword" : "Pia Webb",
    "taxful_total_price" : 83.0
  },
  {
    "order_date" : 1574295782000,
    "category.keyword" : [
      "Women's Accessories",
      "Women's Shoes"
    ],
    "customer_full_name.keyword" : "Brigitte Graham",
    "taxful_total_price" : 72.0
  }
]</pre>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ml-post-data.html">« Post data to jobs API</a>
</span>
<span class="next">
<a href="ml-reset-job.html">Reset anomaly detection jobs API »</a>
</span>
</div>
</body>
</html>
