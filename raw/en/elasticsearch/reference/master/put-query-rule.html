<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch diagnostic, diagnostics">
<title>Create or update query rule | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Create or update query rule | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="query-rules-apis.html" title="Query rules APIs"/>
<link rel="prev" href="delete-query-ruleset.html" title="Delete query ruleset"/>
<link rel="next" href="get-query-rule.html" title="Get query rule"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="delete-query-ruleset.html">« Delete query ruleset</a>
</span>
<span class="next">
<a href="get-query-rule.html">Get query rule »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="query-rules-apis.html">Query rules APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Create or update query rule</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-rules/apis/put-query-rule.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="put-query-rule"></a>Create or update query rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-rules/apis/put-query-rule.asciidoc">edit</a></h2>
</div></div></div>

<p>Creates or updates an individual query rule within a query ruleset.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="put-query-rule-request"></a>Request<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-rules/apis/put-query-rule.asciidoc">edit</a></h3>
</div></div></div>
<p><code class="literal">PUT _query_rules/&lt;ruleset_id&gt;/_rule/&lt;rule_id&gt;</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="put-query-rule-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-rules/apis/put-query-rule.asciidoc">edit</a></h3>
</div></div></div>
<p>Requires the <code class="literal">manage_search_query_rules</code> privilege.</p>
<p class="child_attributes"><a id="put-query-rule-request-body"></a>(Required, object) Contains parameters for a query rule:</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_request_body_3"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-rules/apis/put-query-rule.asciidoc">edit</a></h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
<p>
(Required, string) The type of rule.
At this time the following query rule types are allowed:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">pinned</code> will identify and pin specific documents to the top of search results.
</li>
<li class="listitem">
<code class="literal">exclude</code> will exclude specific documents from search results.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">criteria</code>
</span>
</dt>
<dd>
(Required, array of objects) The criteria that must be met for the rule to be applied.
If multiple criteria are specified for a rule, all criteria must be met for the rule to be applied.
</dd>
</dl>
</div>
<p>Criteria must have the following information:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">type</code> (Required, string) The type of criteria.
The following criteria types are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">exact</code>
Only exact matches meet the criteria defined by the rule.
Applicable for string or numerical values.
</li>
<li class="listitem">
<code class="literal">fuzzy</code>
Exact matches or matches within the allowed <a href="https://en.wikipedia.org/wiki/Levenshtein_distance" class="ulink" target="_top">Levenshtein Edit Distance</a> meet the criteria defined by the rule.
Only applicable for string values.
</li>
<li class="listitem">
<code class="literal">prefix</code>
Matches that start with this value meet the criteria defined by the rule.
Only applicable for string values.
</li>
<li class="listitem">
<code class="literal">suffix</code>
Matches that end with this value meet the criteria defined by the rule.
Only applicable for string values.
</li>
<li class="listitem">
<code class="literal">contains</code>
Matches that contain this value anywhere in the field meet the criteria defined by the rule.
Only applicable for string values.
</li>
<li class="listitem">
<code class="literal">lt</code>
Matches with a value less than this value meet the criteria defined by the rule.
Only applicable for numerical values.
</li>
<li class="listitem">
<code class="literal">lte</code>
Matches with a value less than or equal to this value meet the criteria defined by the rule.
Only applicable for numerical values.
</li>
<li class="listitem">
<code class="literal">gt</code>
Matches with a value greater than this value meet the criteria defined by the rule.
Only applicable for numerical values.
</li>
<li class="listitem">
<code class="literal">gte</code>
Matches with a value greater than or equal to this value meet the criteria defined by the rule.
Only applicable for numerical values.
</li>
<li class="listitem">
<code class="literal">always</code>
Matches all queries, regardless of input.
</li>
</ul>
</div>
</li>
<li class="listitem">
<code class="literal">metadata</code> (Optional, string) The metadata field to match against.
This metadata will be used to match against <code class="literal">match_criteria</code> sent in the <a class="xref" href="query-dsl-rule-query.html" title="Rule query">Rule</a>.
Required for all criteria types except <code class="literal">always</code>.
</li>
<li class="listitem">
<p><code class="literal">values</code> (Optional, array of strings) The values to match against the metadata field.
Only one value must match for the criteria to be met.
Required for all criteria types except <code class="literal">always</code>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actions</code>
</span>
</dt>
<dd>
(Required, object) The actions to take when the rule is matched.
The format of this action depends on the rule type.
</dd>
</dl>
</div>
</li>
</ul>
</div>
<p>Actions depend on the rule type.
The following actions are allowed for <code class="literal">pinned</code> or <code class="literal">exclude</code> rules:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ids</code> (Optional, array of strings) The unique <a class="xref" href="mapping-id-field.html" title="_id field">document IDs</a> of the documents to apply the rule to.
Only one of <code class="literal">ids</code> or <code class="literal">docs</code> may be specified, and at least one must be specified.
</li>
<li class="listitem">
<p><code class="literal">docs</code> (Optional, array of objects) The documents to apply the rule to.
Only one of <code class="literal">ids</code> or <code class="literal">docs</code> may be specified, and at least one must be specified.
There is a maximum value of 100 documents in a rule.
You can specify the following attributes for each document:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">_index</code> (Required, string) The index of the document.
If null, all documents with the specified <code class="literal">_id</code> will be affected across all searched indices.
</li>
<li class="listitem">
<code class="literal">_id</code> (Required, string) The unique <a class="xref" href="mapping-id-field.html" title="_id field">document ID</a>.
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Due to limitations within <a class="xref" href="query-dsl-pinned-query.html" title="Pinned Query">Pinned queries</a>, you can only pin documents using <code class="literal">ids</code> or <code class="literal">docs</code>, but cannot use both in single rule.
It is advised to use one or the other in query rulesets, to avoid errors.
Additionally, pinned queries have a maximum limit of 100 pinned hits.
If multiple matching rules pin more than 100 documents, only the first 100 documents are pinned in the order they are specified in the ruleset.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="put-query-rule-example"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-rules/apis/put-query-rule.asciidoc">edit</a></h3>
</div></div></div>
<p>The following example creates a new query rule with the ID <code class="literal">my-rule1</code> in a query ruleset called <code class="literal">my-ruleset</code>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">my-rule1</code> will select documents to promote with IDs <code class="literal">id1</code> and <code class="literal">id2</code> when <code class="literal">user_query</code> contains <code class="literal">pugs</code> <em>or</em> <code class="literal">puggles</code> <span class="strong strong"><strong>and</strong></span> <code class="literal">user_country</code> exactly matches <code class="literal">us</code>.
</li>
</ul>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.transport.request({
  method: "PUT",
  path: "/_query_rules/my-ruleset/_rule/my-rule1",
  body: {
    type: "pinned",
    criteria: [
      {
        type: "contains",
        metadata: "user_query",
        values: ["pugs", "puggles"],
      },
      {
        type: "exact",
        metadata: "user_country",
        values: ["us"],
      },
    ],
    actions: {
      ids: ["id1", "id2"],
    },
  },
});
console.log(response);</pre>
</div>
<a id="c21aaedb5752a83489476fa3b5e2e9ff"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _query_rules/my-ruleset/_rule/my-rule1
{
    "type": "pinned",
    "criteria": [
        {
            "type": "contains",
            "metadata": "user_query",
            "values": [ "pugs", "puggles" ]
        },
        {
            "type": "exact",
            "metadata": "user_country",
            "values": [ "us" ]
        }
    ],
    "actions": {
        "ids": [
            "id1",
            "id2"
        ]
    }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/3024.console"></div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="delete-query-ruleset.html">« Delete query ruleset</a>
</span>
<span class="next">
<a href="get-query-rule.html">Get query rule »</a>
</span>
</div>
</body>
</html>
