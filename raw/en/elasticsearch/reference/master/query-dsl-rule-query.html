<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rule query | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Rule query | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="specialized-queries.html" title="Specialized queries"/>
<link rel="prev" href="query-dsl-pinned-query.html" title="Pinned Query"/>
<link rel="next" href="term-level-queries.html" title="Term-level queries"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="query-dsl-pinned-query.html">« Pinned Query</a>
</span>
<span class="next">
<a href="term-level-queries.html">Term-level queries »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="specialized-queries.html">Specialized queries</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Rule query</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-dsl/rule-query.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="query-dsl-rule-query"></a>Rule query</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-dsl/rule-query.asciidoc">edit</a></div>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">rule_query</code> was renamed to <code class="literal">rule</code> in 8.15.0.
The old syntax using <code class="literal">rule_query</code> and <code class="literal">ruleset_id</code> is deprecated and will be removed in a future release, so it is strongly advised to migrate existing rule queries to the new API structure.</p>
</div>
</div>
<p>Applies <a class="xref" href="query-rules-apis.html" title="Query rules APIs">query rules</a> to the query before returning results.
Query rules can be used to promote documents in the manner of a <a class="xref" href="query-dsl-pinned-query.html" title="Pinned Query">Pinned Query</a> based on matching defined rules, or to identify specific documents to exclude from a contextual result set.
If no matching query rules are defined, the "organic" matches for the query are returned.
All matching rules are applied in the order in which they appear in the query ruleset.
If the same document matches both an <code class="literal">exclude</code> rule and a <code class="literal">pinned</code> rule, the document will be excluded.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To use the rule query, you first need a defined set of query rules.
Use the <a class="xref" href="query-rules-apis.html" title="Query rules APIs">query rules management APIs</a> to create and manage query rules.
For more information and examples see <a class="xref" href="search-using-query-rules.html" title="Searching with query rules">Searching with query rules</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_example_request_2"></a>Example request</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-dsl/rule-query.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    query={
        "rule": {
            "match_criteria": {
                "user_query": "pugs"
            },
            "ruleset_ids": [
                "my-ruleset"
            ],
            "organic": {
                "match": {
                    "description": "puggles"
                }
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  query: {
    rule: {
      match_criteria: {
        user_query: "pugs",
      },
      ruleset_ids: ["my-ruleset"],
      organic: {
        match: {
          description: "puggles",
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="09cb1b18bf4033b4afafb25bd3dab12c"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">GET /_search
{
  "query": {
    "rule": {
      "match_criteria": {
        "user_query": "pugs"
      },
      "ruleset_ids": ["my-ruleset"],
      "organic": {
        "match": {
          "description": "puggles"
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/1352.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="rule-query-top-level-parameters"></a>Top-level parameters for <code class="literal">rule_query</code></h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-dsl/rule-query.asciidoc">edit</a></div>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">ruleset_ids</code>
</span>
</dt>
<dd>
(Required, array) An array of one or more unique <a class="xref" href="query-rules-apis.html" title="Query rules APIs">query ruleset</a> ID with query-based rules to match and apply as applicable.
Rulesets and their associated rules are evaluated in the order in which they are specified in the query and ruleset.
The maximum number of rulesets to specify is 10.
</dd>
<dt>
<span class="term">
<code class="literal">match_criteria</code>
</span>
</dt>
<dd>
(Required, object) Defines the match criteria to apply to rules in the given query ruleset.
Match criteria should match the keys defined in the <code class="literal">criteria.metadata</code> field of the rule.
</dd>
<dt>
<span class="term">
<code class="literal">organic</code>
</span>
</dt>
<dd>
(Required, object) Any choice of <a class="xref" href="query-dsl.html" title="Query DSL">query</a> used to return results, that may be modified by matching query rules.
If no query rules are matched and applied, this query will be executed with no modification.
</dd>
</dl>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="query-dsl-pinned-query.html">« Pinned Query</a>
</span>
<span class="next">
<a href="term-level-queries.html">Term-level queries »</a>
</span>
</div>
</body>
</html>
