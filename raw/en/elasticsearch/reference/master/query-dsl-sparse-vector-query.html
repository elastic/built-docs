<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sparse vector query | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Sparse vector query | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="query-dsl.html" title="Query DSL"/>
<link rel="prev" href="query-dsl-text-expansion-query.html" title="Text expansion query"/>
<link rel="next" href="_example_request_using_precomputed_vectors.html" title="Example request using precomputed vectors"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="query-dsl-text-expansion-query.html">« Text expansion query</a>
</span>
<span class="next">
<a href="_example_request_using_precomputed_vectors.html">Example request using precomputed vectors »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="query-dsl-sparse-vector-query"></a>Sparse vector query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-dsl/sparse-vector-query.asciidoc">edit</a></h2>
</div></div></div>

<p>The sparse vector query executes a query consisting of sparse vectors, such as built by a learned sparse retrieval model.
This can be achieved with one of two strategies:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Using an natural language processing model to convert query text into a list of token-weight pairs
</li>
<li class="listitem">
Sending in precalculated token-weight pairs as query vectors
</li>
</ul>
</div>
<p>These token-weight pairs are then used in a query against a <a class="xref" href="sparse-vector.html" title="Sparse vector field type">sparse vector</a>.
At query time, query vectors are calculated using the same inference model that was used to create the tokens.
When querying, these query vectors are ORed together with their respective weights, which means scoring is effectively a <a class="xref" href="query-dsl-script-score-query.html#vector-functions-dot-product" title="Dot product">dot product</a> calculation between stored dimensions and query dimensions.</p>
<p>For example, a stored vector <code class="literal">{"feature_0": 0.12, "feature_1": 1.2, "feature_2": 3.0}</code> with query vector <code class="literal">{"feature_0": 2.5, "feature_2": 0.2}</code> would score the document <code class="literal">_score = 0.12*2.5 + 3.0*0.2 = 0.9</code></p>
<h3><a id="sparse-vector-query-ex-request"></a>Example request using an natural language processing model<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/query-dsl/sparse-vector-query.asciidoc">edit</a></h3>
<a id="65b6185356f16f2f0d84bc5aee2ed0fc"></a>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">GET _search
{
   "query":{
      "sparse_vector": {
        "field": "ml.tokens",
        "inference_id": "the inference ID to produce the token weights",
        "query": "the query string"
      }
   }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1314.console"></div>

</div>
<div class="navfooter">
<span class="prev">
<a href="query-dsl-text-expansion-query.html">« Text expansion query</a>
</span>
<span class="next">
<a href="_example_request_using_precomputed_vectors.html">Example request using precomputed vectors »</a>
</span>
</div>
</div>
</body>
</html>
