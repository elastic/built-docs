<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Search Applications search API and templates | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Search Applications search API and templates | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="search-application-overview.html" title="Elastic Search Applications"/>
<link rel="prev" href="search-application-overview.html" title="Elastic Search Applications"/>
<link rel="next" href="search-application-security.html" title="Using search applications with untrusted clients"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="search-application-overview.html">« Elastic Search Applications</a>
</span>
<span class="next">
<a href="search-application-security.html">Using search applications with untrusted clients »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="search-with-elasticsearch.html">Search your data</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="search-application-overview.html">Elastic Search Applications</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Search Applications search API and templates</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="search-application-api"></a>Search Applications search API and templates<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h2>
</div></div></div>

<p>Your <a class="xref" href="search-application-overview.html" title="Elastic Search Applications">search applications</a> use <a class="xref" href="search-template.html" title="Search templates">search templates</a> to perform searches.
Templates help reduce complexity by exposing only template parameters, while using the full power of Elasticsearch&#8217;s query DSL to formulate queries.
Templates may be set when creating or updating a search application, and can be customized.
This template can be edited or updated at any time using the <a class="xref" href="put-search-application.html" title="Put Search Application">Put Search Application API</a> API call.</p>
<p>In a nutshell, you create search templates with parameters instead of specific hardcoded search values.
At search time, you pass in the actual values for these parameters, enabling customized searches without rewriting the entire query structure.
Search Application templates:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Simplify query requests
</li>
<li class="listitem">
Reduce request size
</li>
<li class="listitem">
Ensure security and performance, as the query is predefined and can&#8217;t be changed arbitrarily
</li>
</ul>
</div>
<p>This document provides information and sample templates to get you started using <a class="xref" href="search-application-overview.html" title="Elastic Search Applications">search applications</a> for additional use cases.
These templates are designed to be easily modified to meet your needs.
Once you&#8217;ve created a search application with a template, you can search your search application using this template.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Search templates use the <a href="https://mustache.github.io/" class="ulink" target="_top">Mustache</a> templating language.
Mustache variables are typically enclosed in double curly brackets like this: <code class="literal">{{my-var}}</code>.</p>
<p>Learn more by reading about <a class="xref" href="search-template.html" title="Search templates">search templates</a>.</p>
</div>
</div>
<h4><a id="search-application-api-default-template"></a>Default template example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h4>
<p>If no template is stored with a search application, a minimal <a class="xref" href="search-application-api.html#search-application-api-default-template" title="Default template example">default search template</a> will be applied at search time.
The default template implements a simple search use case.</p>
<p>To create a search application with the default template, issue a <a class="xref" href="put-search-application.html" title="Put Search Application">create or update Search Application</a> request without specifying a template:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.put({
  name: "my_search_application",
  search_application: {
    indices: ["index1", "index2"],
  },
});
console.log(response);</pre>
</div>
<a id="ba3b9783aa188c6841e1926c5ab1472d"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _application/search_application/my_search_application
{
  "indices": ["index1", "index2"]
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1093.console"></div>
<p>You can then use the <a class="xref" href="get-search-application.html" title="Get Search Application">get search application</a> API call to view your newly created search application, which will also include the default template that was created for you:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.get({
  name: "my_search_application",
});
console.log(response);</pre>
</div>
<a id="9ad14a9d7bf2699e2d86b6a607d410c0"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">GET _application/search_application/my_search_application</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1094.console"></div>
<p>In this case, the response would be:</p>
<a id="1174c2c9557dccc151760b64df6e155c"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "name": "my_search_application",
  "indices": [
    "index1",
    "index2"
  ],
  "updated_at_millis": 1715802354482,
  "template": {
    "script": {
      "source": """{
  "query": {
    "query_string": {
        "query": "{{query_string}}",
        "default_field": "{{default_field}}"
        }
    }
}
""",
      "lang": "mustache",
      "params": {
        "default_field": "*",
        "query_string": "*"
      }
    }
  }
}</pre>
</div>
<p>The default template is very minimal:</p>
<a id="53f46b27522321603617ad8abba27b03"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "template": {
    "script": {
      "source": {
        "query": {
          "query_string": {
            "query": "{{query_string}}",
            "default_field": "{{default_field}}"
          }
        }
      },
      "params": {
        "query_string": "*",
        "default_field": "*"
      }
    }
  }
}</pre>
</div>
<p>This may be useful for initial exploration of search templates, but you&#8217;ll likely want to update this.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This template does not support additional parameters, including <code class="literal">from</code>, <code class="literal">size</code> or <code class="literal">boost</code>.
If you need to use these, you can customize the template associated with your search application accordingly to include them as parameters.</p>
</div>
</div>
<p>You can see the parameters and their default values by viewing the template, but it also may be valuable to view the query that will be generated if you <a class="xref" href="search-application-search.html" title="Search Application Search">search your search application</a> with various parameters.</p>
<p>You can use the <a class="xref" href="search-application-render-query.html" title="Render Search Application Query">render search application query</a> to view the query this template would generate, including with default parameters.
For example, searching the search application with no parameters:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.renderQuery({
  name: "my_search_application",
});
console.log(response);</pre>
</div>
<a id="b0bddf2ffaa83049b195829c06b875cd"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_render_query</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1095.console"></div>
<p>will return:</p>
<a id="4f7259fc6dcfd03e4db8ee52d808a801"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "query": {
    "query_string": {
      "query": "*",
      "default_field": "*",
      "fields": []
    }
  }
}</pre>
</div>
<p>This uses the default parameters that were defined with the template.
You can also specify one or mre parameters to the render call, for example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.renderQuery({
  name: "my_search_application",
});
console.log(response);</pre>
</div>
<a id="a162eb50853331c80596f5994e9d1c38"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_render_query
{
  "params": {
    "query_string": "rock climbing"
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1096.console"></div>
<p>will return:</p>
<a id="3f9bdd85f6e290198884e9b95fd877f6"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "query": {
    "query_string": {
      "query": "rock climbing",
      "default_field": "*",
      "fields": []
    }
  }
}</pre>
</div>
<p>In this case, the <code class="literal">{{query_string}}</code> parameter has been replaced with the value <code class="literal">rock climbing</code>, and the <code class="literal">{{default_field}}</code> parameter was not specified so used the default value of <code class="literal">*</code>.</p>
<p>When you actually perform a search with no parameters, it will execute the underlying query that the render call returned.
In this case, a search with no parameters will return all results, in a similar manner to a parameterless call to <code class="literal">/_search</code>.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
});
console.log(response);</pre>
</div>
<a id="b84932030e60a2cd58884b9dc6d3147f"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1097.console"></div>
<p>Searching with the <code class="literal">query_string</code> and/or <code class="literal">default_field</code> parameters will perform a <a class="xref" href="query-dsl-query-string-query.html" title="Query string query"><code class="literal">query_string</code></a> query.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>The default template is subject to change in future versions of the Search Applications feature.</p>
</div>
</div>
<p>Try some of the other examples in this document to experiment with specific use cases, or try creating your own!</p>
<h4><a id="search-application-api-searching"></a>Searching a search application<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h4>
<h5><a id="search-application-api-searching-templates"></a>Template search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h5>
<p>The simplest way to interact with a search application is to use the search template that&#8217;s created and stored with it.
Each search application has a single template associated with it, which defines search criteria, parameters and defaults.</p>
<p>You send search requests to a search application using the <a class="xref" href="search-application-search.html" title="Search Application Search">Search Application Search API</a>.</p>
<p>With the default template, a search looks like this:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
  params: {
    query_string: "kayaking",
  },
});
console.log(response);</pre>
</div>
<a id="20c595907b4afbf26bd60e816a6ddf6a"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search
{
  "params": {
    "query_string": "kayaking"
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1098.console"></div>
<p>In this example, we&#8217;ve overridden the <code class="literal">query_string</code> parameter&#8217;s default value of <code class="literal">*</code>.
Since we didn&#8217;t specify <code class="literal">default_field</code> the value of this parameter will still be <code class="literal">*</code>.</p>
<h5><a id="search-application-api-searching-alias"></a>Alias search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h5>
<p>If you don&#8217;t want to set up a search template for your search application, an alias will be created with the same name as your search application.
This may be helpful when experimenting with specific search queries that you want to use when building your search application&#8217;s search template.</p>
<p>If your search application&#8217;s name is <code class="literal">my_search_application</code>, your alias will be <code class="literal">my_search_application</code>.
You can search this using the <a class="xref" href="search-search.html" title="Search API">search API</a>.</p>
<h5><a id="search-application-cross-cluster-search"></a>Cross cluster search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h5>
<p>Search applications do not currently support cross-cluster search because it is not possible to add a remote cluster&#8217;s index or index pattern to an index alias.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You should use the Search Applications management APIs to update your application and <em>not</em> directly use Elasticsearch APIs such as the alias API.
For example, use <a class="xref" href="put-search-application.html" title="Put Search Application">PUT Search Application</a> with the <code class="literal">indices</code> parameter.
This will automatically keep the associated alias up to date and ensure that indices are added to the search application correctly.</p>
</div>
</div>
<h4><a id="search-application-api-examples"></a>Search template examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h4>
<p>We have created a number of examples to explore specific use cases.
Use these as a starting point for creating your own search templates.</p>
<h5><a id="search-application-api-bm25-template"></a>Text search example<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h5>
<p>The following template supports a <code class="literal">multi_match</code> search over specified fields and boosts:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.put({
  name: "my_search_application",
  search_application: {
    indices: ["index1", "index2"],
    template: {
      script: {
        lang: "mustache",
        source:
          '\n      {\n        "query": {\n          "multi_match": {\n            "query": "{{query_string}}",\n            "fields": [{{#text_fields}}"{{name}}^{{boost}}",{{/text_fields}}]\n          }\n        },\n        "explain": "{{explain}}",\n        "from": "{{from}}",\n        "size": "{{size}}"\n      }\n      ',
        params: {
          query_string: "*",
          text_fields: [
            {
              name: "title",
              boost: 10,
            },
            {
              name: "description",
              boost: 5,
            },
          ],
          explain: false,
          from: 0,
          size: 10,
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="fe8c3e2632f5057bfbd1898a8fe4d0d2"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _application/search_application/my_search_application
{
  "indices": ["index1", "index2"],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
      {
        "query": {
          "multi_match": {
            "query": "{{query_string}}",
            "fields": [{{#text_fields}}"{{name}}^{{boost}}",{{/text_fields}}]
          }
        },
        "explain": "{{explain}}",
        "from": "{{from}}",
        "size": "{{size}}"
      }
      """,
      "params": {
        "query_string": "*",
        "text_fields": [
          {"name": "title", "boost": 10},
          {"name": "description", "boost": 5}
        ],
        "explain": false,
        "from": 0,
        "size": 10
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1099.console"></div>
<p>A search query using this template might look like this:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
  params: {
    size: 5,
    query_string: "mountain climbing",
    text_fields: [
      {
        name: "title",
        boost: 10,
      },
      {
        name: "description",
        boost: 2,
      },
      {
        name: "state",
        boost: 1,
      },
    ],
  },
});
console.log(response);</pre>
</div>
<a id="193d86b6cc34e12c2be806d27816a35c"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search
{
  "params": {
    "size": 5,
    "query_string": "mountain climbing",
    "text_fields": [
          {"name": "title", "boost": 10},
          {"name": "description", "boost": 2},
          {"name": "state", "boost": 1}
     ]
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1100.console"></div>
<p>The <code class="literal">text_fields</code> parameters can be overridden with new/different fields and boosts to experiment with the best configuration for your use case.
This template also supports pagination and <code class="literal">explain</code> via parameters.</p>
<h5><a id="search-application-api-rrf-template"></a>Text search + ELSER with RRF<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h5>
<p>This example supports the <a class="xref" href="rrf.html" title="Reciprocal rank fusion">reciprocal rank fusion (RRF)]</a> method for combining BM25 and <a href="/guide/en/machine-learning/master/ml-nlp-elser.html" class="ulink" target="_top">ELSER</a> searches.
Reciprocal Rank Fusion consistently improves the combined results of different search algorithms.
It outperforms all other ranking algorithms, and often surpasses the best individual results, without calibration.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.put({
  name: "my-search-app",
  search_application: {
    indices: ["index1"],
    template: {
      script: {
        lang: "mustache",
        source:
          '\n      {\n        "retriever": {\n          "rrf": {\n            "retrievers": [\n              {{#text_fields}}\n              {\n                "standard": {\n                  "query": {\n                    "match": {\n                      "{{.}}": "{{query_string}}"\n                    }\n                  }\n                }\n              },\n              {{/text_fields}}\n              {{#elser_fields}}\n              {\n                "standard": {\n                  "query": {\n                    "sparse_vector": {\n                      "field": "ml.inference.{{.}}_expanded.predicted_value",\n                      "inference_id": "&lt;elser_inference_id&gt;",\n                      "query": "{{query_string}}"\n                    }\n                  }\n                }\n              },\n              {{/elser_fields}}\n            ],\n            "rank_window_size": {{rrf.rank_window_size}},\n            "rank_constant": {{rrf.rank_constant}}\n          }\n        }\n      }\n      ',
        params: {
          elser_fields: ["title", "meta_description"],
          text_fields: ["title", "meta_description"],
          query_string: "",
          rrf: {
            rank_window_size: 100,
            rank_constant: 60,
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="1bceb160ed2bcd51ee040caf21acf780"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _application/search_application/my-search-app
{
  "indices": [
    "index1"
  ],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
      {
        "retriever": {
          "rrf": {
            "retrievers": [
              {{#text_fields}}
              {
                "standard": {
                  "query": {
                    "match": {
                      "{{.}}": "{{query_string}}"
                    }
                  }
                }
              },
              {{/text_fields}}
              {{#elser_fields}}
              {
                "standard": {
                  "query": {
                    "sparse_vector": {
                      "field": "ml.inference.{{.}}_expanded.predicted_value",
                      "inference_id": "&lt;elser_inference_id&gt;",
                      "query": "{{query_string}}"
                    }
                  }
                }
              },
              {{/elser_fields}}
            ],
            "rank_window_size": {{rrf.rank_window_size}},
            "rank_constant": {{rrf.rank_constant}}
          }
        }
      }
      """,
      "params": {
        "elser_fields": ["title", "meta_description"],
        "text_fields": ["title", "meta_description"],
        "query_string": "",
        "rrf": {
          "rank_window_size": 100,
          "rank_constant": 60
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1101.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Replace <code class="literal">&lt;elser_model_id&gt;</code> with the model ID of your ELSER deployment.</p>
</div>
</div>
<p>A sample query for this template will look like the following example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my-search-app",
  params: {
    query_string:
      "What is the most popular brand of coffee sold in the United States?",
    elser_fields: ["title", "meta_description"],
    text_fields: ["title", "meta_description"],
    rrf: {
      rank_window_size: 50,
      rank_constant: 25,
    },
  },
});
console.log(response);</pre>
</div>
<a id="8edcd80d9b545a222dcc2f25ca4c6d5f"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my-search-app/_search
{
  "params": {
    "query_string": "What is the most popular brand of coffee sold in the United States?",
    "elser_fields": ["title", "meta_description"],
    "text_fields": ["title", "meta_description"],
    "rrf": {
      "rank_window_size": 50,
      "rank_constant": 25
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1102.console"></div>
<h5><a id="search-application-api-catchall-template"></a>Text search + ELSER<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h5>
<p>The Elastic Learned Sparse EncodeR (<a href="/guide/en/machine-learning/master/ml-nlp-elser.html" class="ulink" target="_top">ELSER</a>) improves search relevance through text-expansion, which enables semantic search.
This experimental template requires ELSER to be enabled for one or more fields.
Refer to <a class="xref" href="semantic-search-elser.html" title="Tutorial: semantic search with ELSER">Semantic search with ELSER</a> for more information on how to use ELSER.
In this case, ELSER is enabled on the <code class="literal">title</code> and <code class="literal">description</code> fields.</p>
<p>This example provides a single template that you can use for various search application scenarios: text search, ELSER, or all of the above.
It also provides a simple default <code class="literal">query_string</code> query if no parameters are specified.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.put({
  name: "my_search_application",
  search_application: {
    indices: ["index1", "index2"],
    template: {
      script: {
        lang: "mustache",
        source:
          '\n      {\n        "query": {\n          "bool": {\n            "should": [\n              {{#text}}\n              {\n                "multi_match": {\n                  "query": "{{query_string}}",\n                  "fields": [{{#text_fields}}"{{name}}^{{boost}}",{{/text_fields}}],\n                  "boost": "{{text_query_boost}}"\n                }\n              },\n              {{/text}}\n              {{#elser}}\n              {{#elser_fields}}\n              {\n                "sparse_vector": {\n                  "field": "ml.inference.{{.}}_expanded.predicted_value",\n                  "inference_id": "&lt;elser_inference_id&gt;",\n                  "query": "{{query_string}}"\n                }\n              },\n              {{/elser_fields}}\n              { "bool": { "must": [] } },\n              {{/elser}}\n              {{^text}}\n              {{^elser}}\n              {\n                "query_string": {\n                  "query": "{{query_string}}",\n                  "default_field": "{{default_field}}",\n                  "default_operator": "{{default_operator}}",\n                  "boost": "{{text_query_boost}}"\n                }\n              },\n              {{/elser}}\n              {{/text}}\n              { "bool": { "must": [] } }\n              ],\n            "minimum_should_match": 1\n          }\n        },\n        "min_score": "{{min_score}}",\n        "explain": "{{explain}}",\n        "from": "{{from}}",\n        "size": "{{size}}"\n      }\n      ',
        params: {
          text: false,
          elser: false,
          elser_fields: [
            {
              name: "title",
              boost: 1,
            },
            {
              name: "description",
              boost: 1,
            },
          ],
          text_fields: [
            {
              name: "title",
              boost: 10,
            },
            {
              name: "description",
              boost: 5,
            },
            {
              name: "state",
              boost: 1,
            },
          ],
          query_string: "*",
          text_query_boost: 4,
          default_field: "*",
          default_operator: "OR",
          explain: false,
          from: 0,
          size: 10,
          min_score: 0,
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="89aed93f641a5e243bdc3ee5cdc2acc6"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _application/search_application/my_search_application
{
  "indices": [
    "index1",
    "index2"
  ],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
      {
        "query": {
          "bool": {
            "should": [
              {{#text}}
              {
                "multi_match": {
                  "query": "{{query_string}}",
                  "fields": [{{#text_fields}}"{{name}}^{{boost}}",{{/text_fields}}],
                  "boost": "{{text_query_boost}}"
                }
              },
              {{/text}}
              {{#elser}}
              {{#elser_fields}}
              {
                "sparse_vector": {
                  "field": "ml.inference.{{.}}_expanded.predicted_value",
                  "inference_id": "&lt;elser_inference_id&gt;",
                  "query": "{{query_string}}"
                }
              },
              {{/elser_fields}}
              { "bool": { "must": [] } },
              {{/elser}}
              {{^text}}
              {{^elser}}
              {
                "query_string": {
                  "query": "{{query_string}}",
                  "default_field": "{{default_field}}",
                  "default_operator": "{{default_operator}}",
                  "boost": "{{text_query_boost}}"
                }
              },
              {{/elser}}
              {{/text}}
              { "bool": { "must": [] } }
              ],
            "minimum_should_match": 1
          }
        },
        "min_score": "{{min_score}}",
        "explain": "{{explain}}",
        "from": "{{from}}",
        "size": "{{size}}"
      }
      """,
      "params": {
        "text": false,
        "elser": false,
        "elser_fields": [
          {"name": "title", "boost": 1},
          {"name": "description", "boost": 1}
        ],
        "text_fields": [
          {"name": "title", "boost": 10},
          {"name": "description", "boost": 5},
          {"name": "state", "boost": 1}
        ],
        "query_string": "*",
        "text_query_boost": 4,
        "default_field": "*",
        "default_operator": "OR",
        "explain": false,
        "from": 0,
        "size": 10,
        "min_score": 0
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1103.console"></div>
<p>A text search query using this template might look like this:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
  params: {
    text: true,
    size: 5,
    query_string: "mountain climbing",
    text_fields: [
      {
        name: "title",
        boost: 10,
      },
      {
        name: "description",
        boost: 5,
      },
      {
        name: "state",
        boost: 1,
      },
    ],
  },
});
console.log(response);</pre>
</div>
<a id="b00ac39faf96785e89be8d4205fb984d"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search
{
  "params": {
    "text": true,
    "size": 5,
    "query_string": "mountain climbing",
    "text_fields": [
          {"name": "title", "boost": 10},
          {"name": "description", "boost": 5},
          {"name": "state", "boost": 1}
     ]
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1104.console"></div>
<p>An ELSER search query using this template will look like the following example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
  params: {
    elser: true,
    query_string: "where is the best mountain climbing?",
    elser_fields: [
      {
        name: "title",
        boost: 1,
      },
      {
        name: "description",
        boost: 1,
      },
    ],
  },
});
console.log(response);</pre>
</div>
<a id="64c804869ddfbcb9075817d0bbf71b5c"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search
{
  "params": {
    "elser": true,
    "query_string": "where is the best mountain climbing?",
    "elser_fields": [
      {"name": "title", "boost": 1},
      {"name": "description", "boost": 1}
    ]
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1105.console"></div>
<p>A combined text search and ELSER search query using this template will look like the following example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
  params: {
    elser: true,
    text: true,
    query_string: "where is the best mountain climbing?",
    elser_fields: [
      {
        name: "title",
        boost: 1,
      },
      {
        name: "description",
        boost: 1,
      },
    ],
    text_query_boost: 4,
    min_score: 10,
  },
});
console.log(response);</pre>
</div>
<a id="5d5cdbd4c5c62a90ff2a39cba4a59368"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search
{
  "params": {
    "elser": true,
    "text": true,
    "query_string": "where is the best mountain climbing?",
    "elser_fields": [
      {"name": "title", "boost": 1},
      {"name": "description", "boost": 1}
    ],
    "text_query_boost": 4,
    "min_score": 10
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1106.console"></div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Text search results and ELSER search results are expected to have significantly different scores in some cases, which makes ranking challenging.
To find the best search result mix for your dataset, we suggest experimenting with the boost values provided in the example template:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">text_query_boost</code> to boost the BM25 query as a whole
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/query-dsl-query-string-query.html#_boosting" class="ulink" target="_top"><code class="literal">boost</code></a> fields to boost individual text search fields
</li>
<li class="listitem">
<a class="xref" href="search-search.html#search-api-min-score"><code class="literal">min_score</code></a> parameter to omit significantly low confidence results
</li>
</ul>
</div>
<p>The above boosts should be sufficient for many use cases, but there are cases when adding a <a class="xref" href="filter-search-results.html#rescore" title="Rescore filtered search results">rescore</a> query or <a class="xref" href="search-multiple-indices.html#index-boost" title="Index boost">index boost</a> to your template may be beneficial.
Remember to update your search application to use the new template using the <a class="xref" href="put-search-application.html" title="Put Search Application">put search application command</a>.</p>
</div>
</div>
<p>Finally, a parameterless search using this template would fall back to a default search returning all documents:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
});
console.log(response);</pre>
</div>
<a id="b84932030e60a2cd58884b9dc6d3147f"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1107.console"></div>
<h5><a id="search-application-api-elser-template"></a>ELSER search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h5>
<p>This example supports a streamlined version of ELSER search.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.put({
  name: "my_search_application",
  search_application: {
    indices: ["index1", "index2"],
    template: {
      script: {
        lang: "mustache",
        source:
          '\n        {\n          "query": {\n            "bool": {\n              "should": [\n                {{#elser_fields}}\n                {\n                  "sparse_vector": {\n                      "field": "ml.inference.{{.}}_expanded.predicted_value",\n                      "inference_id": "&lt;elser_inference_id&gt;",\n                      "query": "{{query_string}}"\n                    }\n                },\n                {{/elser_fields}}\n                ]\n            }\n          },\n          "min_score": "{{min_score}}"\n        }\n        ',
        params: {
          query_string: "*",
          min_score: "10",
          elser_fields: [
            {
              name: "title",
            },
            {
              name: "description",
            },
          ],
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="a9dd5cd3f2b31e7c8129ea63bab868b4"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _application/search_application/my_search_application
{
  "indices": [
    "index1",
    "index2"
    ],
    "template": {
      "script": {
        "lang": "mustache",
        "source": """
        {
          "query": {
            "bool": {
              "should": [
                {{#elser_fields}}
                {
                  "sparse_vector": {
                      "field": "ml.inference.{{.}}_expanded.predicted_value",
                      "inference_id": "&lt;elser_inference_id&gt;",
                      "query": "{{query_string}}"
                    }
                },
                {{/elser_fields}}
                ]
            }
          },
          "min_score": "{{min_score}}"
        }
        """,
        "params": {
          "query_string": "*",
          "min_score": "10",
          "elser_fields": [
            {
              "name": "title"
            },
            {
              "name": "description"
            }
            ]
        }
      }
    }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1108.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Replace <code class="literal">&lt;elser_model_id&gt;</code> with the model ID of your ELSER deployment.</p>
</div>
</div>
<p>A sample query for this template will look like the following example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
  params: {
    query_string: "Where is the best place for mountain climbing?",
  },
});
console.log(response);</pre>
</div>
<a id="87d970b4944b6d742c484d7184996c8a"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search
  {
    "params": {
      "query_string": "Where is the best place for mountain climbing?"
    }
  }</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1109.console"></div>
<h5><a id="search-applications-knn-template"></a>kNN search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/search/search-your-data/search-application-api.asciidoc">edit</a></h5>
<p>This example supports <a class="xref" href="knn-search.html" title="k-nearest neighbor (kNN) search">k-nearest neighbor (kNN) search</a></p>
<p>A template supporting exact kNN search will look like the following example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.put({
  name: "my_search_application",
  search_application: {
    indices: ["index1"],
    template: {
      script: {
        lang: "mustache",
        source:
          '\n        {\n          "query": {\n            "script_score": {\n              "query": {\n                "bool": {\n                  "filter": {\n                    "range": {\n                      "{{field}}": {\n                        "{{operator}}": {{value}}\n                      }\n                    }\n                  }\n                }\n              },\n              "script": {\n                "source": "cosineSimilarity({{#toJson}}query_vector{{/toJson}}, \'{{dense_vector_field}}\') + 1.0"\n              }\n            }\n          }\n        }\n        ',
        params: {
          field: "price",
          operator: "gte",
          value: 1000,
          dense_vector_field: "product-vector",
          query_vector: [],
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="608cadc6b8a3f194612b69279ccc96de"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _application/search_application/my_search_application
{
  "indices": [
    "index1"
  ],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
        {
          "query": {
            "script_score": {
              "query": {
                "bool": {
                  "filter": {
                    "range": {
                      "{{field}}": {
                        "{{operator}}": {{value}}
                      }
                    }
                  }
                }
              },
              "script": {
                "source": "cosineSimilarity({{#toJson}}query_vector{{/toJson}}, '{{dense_vector_field}}') + 1.0"
              }
            }
          }
        }
        """,
      "params": {
        "field": "price",
        "operator": "gte",
        "value": 1000,
        "dense_vector_field": "product-vector",
        "query_vector": []
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1110.console"></div>
<p>A search query using this template will look like the following example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
  params: {
    field: "price",
    operator: "gte",
    value: 500,
  },
});
console.log(response);</pre>
</div>
<a id="40a42f005144cfed3dd1dcf2638e8211"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search
{
  "params": {
    "field": "price",
    "operator": "gte",
    "value": 500
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1111.console"></div>
<p>A template supporting approximate kNN search will look like the following example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.put({
  name: "my_search_application",
  search_application: {
    indices: ["index1"],
    template: {
      script: {
        lang: "mustache",
        source:
          '\n      {\n          "knn": {\n            "field": "{{knn_field}}",\n            "query_vector": {{#toJson}}query_vector{{/toJson}},\n            "k": "{{k}}",\n            "num_candidates": {{num_candidates}}\n          },\n          "fields": {{#toJson}}fields{{/toJson}}\n      }\n      ',
        params: {
          knn_field: "image-vector",
          query_vector: [],
          k: 10,
          num_candidates: 100,
          fields: ["title", "file-type"],
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="dee3023098d9e63aa9e113beea5686da"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">PUT _application/search_application/my_search_application
{
  "indices": [
    "index1"
  ],
  "template": {
    "script": {
      "lang": "mustache",
      "source": """
      {
          "knn": {
            "field": "{{knn_field}}",
            "query_vector": {{#toJson}}query_vector{{/toJson}},
            "k": "{{k}}",
            "num_candidates": {{num_candidates}}
          },
          "fields": {{#toJson}}fields{{/toJson}}
      }
      """,
      "params": {
        "knn_field": "image-vector",
        "query_vector": [],
        "k": 10,
        "num_candidates": 100,
        "fields": ["title", "file-type"]
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1112.console"></div>
<p>A search query using this template will look like the following example:</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.searchApplication.search({
  name: "my_search_application",
  params: {
    knn_field: "image-vector",
    query_vector: [-5, 9, -12],
    k: 10,
    num_candidates: 100,
    fields: ["title", "file-type"],
  },
});
console.log(response);</pre>
</div>
<a id="a43954d055f042d625a905513821f5f0"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST _application/search_application/my_search_application/_search
{
  "params": {
    "knn_field": "image-vector",
        "query_vector": [-5, 9, -12],
        "k": 10,
        "num_candidates": 100,
        "fields": ["title", "file-type"]
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/1113.console"></div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="search-application-overview.html">« Elastic Search Applications</a>
</span>
<span class="next">
<a href="search-application-security.html">Using search applications with untrusted clients »</a>
</span>
</div>
</body>
</html>
