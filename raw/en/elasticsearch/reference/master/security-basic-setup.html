<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Set up basic security for the Elastic Stack | Elasticsearch Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="configuring-stack-security.html" title="Configure security for the Elastic Stack"/>
<link rel="prev" href="security-minimal-setup.html" title="Set up minimal security for Elasticsearch"/>
<link rel="next" href="security-basic-setup-https.html" title="Set up basic security for the Elastic Stack plus secured HTTPS traffic"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
»
<span class="breadcrumb-link"><a href="configuring-stack-security.html">Configure security for the Elastic Stack</a></span>
»
<span class="breadcrumb-node">Set up basic security for the Elastic Stack</span>
</div>
<div class="navheader">
<span class="prev">
<a href="security-minimal-setup.html">« Set up minimal security for Elasticsearch</a>
</span>
<span class="next">
<a href="security-basic-setup-https.html">Set up basic security for the Elastic Stack plus secured HTTPS traffic »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="security-basic-setup"></a>Set up basic security for the Elastic Stack<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h2>
</div></div></div>

<p>After adding password protection in the <a class="xref" href="security-minimal-setup.html" title="Set up minimal security for Elasticsearch">minimal security configuration</a>, you&#8217;ll need to configure Transport Layer Security
(TLS). The transport layer handles all internal communication between nodes in
your cluster.</p>
<p>The transport layer relies on mutual TLS for both encryption and
authentication of nodes. Correctly applying TLS ensures that a malicious node
cannot join the cluster and exchange data with other nodes. While implementing
username and password authentication at the HTTP layer is useful for securing a
local cluster, the security of communication between nodes requires TLS.</p>
<p>Configuring TLS between nodes is the basic security setup to prevent
unauthorized nodes from accessing to your cluster.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Understanding transport contexts</strong></p>
</div></div></div>
<p>Transport Layer Security (TLS) is the name of an industry standard protocol for
applying security controls (such as encryption) to network communications. TLS
is the modern name for what used to be called Secure Sockets Layer (SSL). The
Elasticsearch documentation uses the terms TLS and SSL interchangeably.</p>
<p>Transport Protocol is the name of the protocol that Elasticsearch nodes use to
communicate with one another. This name is specific to Elasticsearch and distinguishes
the transport port (default <code class="literal">9300</code>) from the HTTP port (default <code class="literal">9200</code>). Nodes
communicate with one another using the transport port, and REST clients
communicate with Elasticsearch using the HTTP port.</p>
<p>Although the word <em>transport</em> appears in both contexts, they mean different
things. It&#8217;s possible to apply TLS to both the Elasticsearch transport port and the HTTP
port. We know that these overlapping terms can be confusing, so to clarify, in
this scenario we&#8217;re applying TLS to the Elasticsearch transport port. In
<a class="xref" href="security-basic-setup-https.html" title="Set up basic security for the Elastic Stack plus secured HTTPS traffic">the next scenario</a>, we&#8217;ll apply TLS to the Elasticsearch
HTTP port.</p>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="basic-setup-prerequisites"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>Complete the steps in <a class="xref" href="security-minimal-setup.html" title="Set up minimal security for Elasticsearch">Minimal security for the Elastic Stack</a> to enable Elasticsearch security features on every node in your cluster. You can
then encrypt communications between your nodes with TLS.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You only need to create passwords for the built-in users one time for the
entire cluster.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="generate-certificates"></a>Generate the certificate authority<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>You can add as many nodes as you want in a cluster but they must be able to
communicate with each other. The communication between nodes in a cluster is
handled by the transport module. To secure your cluster, you must ensure that
internode communications are encrypted and verified, which is achieved with
mutual TLS.</p>
<p>In a secured cluster, Elasticsearch nodes use certificates to identify
themselves when communicating with other nodes.</p>
<p>The cluster must validate the authenticity of these certificates. The
recommended approach is to trust a specific certificate authority (CA). When
nodes are added to your cluster they must use a certificate signed by the same
CA.</p>
<p>For the transport layer, we recommend using a separate, dedicated CA instead
of an existing, possibly shared CA so that node membership is tightly controlled. Use the <code class="literal">elasticsearch-certutil</code> tool to
generate a CA for your cluster.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Use the <code class="literal">elasticsearch-certutil</code> tool to generate a CA for your cluster.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil ca</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
When prompted, accept the default file name, which is <code class="literal">elastic-stack-ca.p12</code>. This file contains the public certificate for your CA and the private key used to sign certificates for each node.
</li>
<li class="listitem">
Enter a password for your CA. You can choose to leave the password blank
if you&#8217;re not deploying to a production environment.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Generate a certificate and private key for your node. You include the
<code class="literal">elastic-stack-ca.p12</code> output file that you generated in the previous step.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Enter the password for your CA, or press <span class="strong strong"><strong>Enter</strong></span> if you did not configure one in the previous step.
</li>
<li class="listitem">
<p>Create a password for the certificate and accept the default file name.</p>
<p>The output file is a keystore named <code class="literal">elastic-certificates.p12</code>. This file
contains a node certificate, node key, and CA certificate.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">--ca &lt;ca_file&gt;</code>
</span>
</dt>
<dd>
Name of the CA file used to sign your certificates. The
default file name from the <code class="literal">elasticsearch-certutil</code> tool is <code class="literal">elastic-stack-ca.p12</code>.
</dd>
</dl>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Copy the <code class="literal">elastic-certificates.p12</code> file to the <code class="literal">ES_PATH_CONF</code>
directory on every node in your cluster.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="security-basic-setup.html#encrypt-internode-communication" title="Encrypt internode communications with TLS">Encrypt internode communications with TLS</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encrypt-internode-communication"></a>Encrypt internode communications with TLS<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>The transport networking layer is used for internal communication between
nodes in a cluster. When security features are enabled, you must use TLS to
ensure that communication between the nodes is encrypted.</p>
<p>Now that you&#8217;ve generated a certificate authority and certificates, you&#8217;ll
update your cluster to use these files.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Complete the following steps for each node in your cluster. To join the
same cluster, all nodes must share the same <code class="literal">cluster.name</code> value.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Open the <code class="literal">ES_PATH_CONF/elasticsearch.yml</code> file and make the following
changes:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the <code class="literal">cluster-name</code> setting and enter a name for your cluster:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">cluster.name: my-cluster</pre>
</div>
</li>
<li class="listitem">
<p>Add the <code class="literal">node.name</code> setting and enter the name of the certificate that
you generated for this node. For simplicity, it&#8217;s good practice for this value
to match the certificate name that you defined in your <code class="literal">certificates.yaml</code> file:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">node.name: node-1</pre>
</div>
</li>
<li class="listitem">
<p>Add the following settings to enable internode communication and provide
access to the node&#8217;s certificate:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.client_authentication: required
xpack.security.transport.ssl.keystore.path: &lt;node-name&gt;.p12
xpack.security.transport.ssl.truststore.path: &lt;node-name&gt;.p12</pre>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>If you entered a password when creating the node certificate, run the following commands to store the password in the Elasticsearch keystore:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password</pre>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password</pre>
</div>
</li>
<li class="listitem">
Complete the previous steps for each node in your cluster.
</li>
<li class="listitem">
<p>Restart Elasticsearch. The method for <a class="xref" href="starting-elasticsearch.html" title="Starting Elasticsearch">starting</a> and <a class="xref" href="starting-elasticsearch.html" title="Starting Elasticsearch">stopping</a> Elasticsearch varies depending on how you installed it.</p>
<p>For example, if you installed Elasticsearch with an archive distribution
(<code class="literal">tar.gz</code> or <code class="literal">.zip</code>), you can enter <code class="literal">Ctrl+C</code> on the command line to stop
Elasticsearch.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must perform a full cluster restart. Nodes that are configured to
use TLS for transport cannot communicate with nodes that use unencrypted transport connection (and vice-versa).</p>
</div>
</div>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="encrypting-internode-whatsnext"></a>What&#8217;s next?<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/securing-communications/security-basic-setup.asciidoc">edit</a></h3>
</div></div></div>
<p>Congratulations! You&#8217;ve encrypted communications between the nodes in your
cluster and can pass the
<a class="xref" href="bootstrap-checks-xpack.html#bootstrap-checks-tls" title="SSL/TLS check">TLS bootstrap check</a>.</p>
<p>To add another layer of security, <a class="xref" href="security-basic-setup-https.html" title="Set up basic security for the Elastic Stack plus secured HTTPS traffic">Set up basic security for the Elastic Stack plus secured HTTPS traffic</a>. In addition to
configuring TLS on the transport interface of your Elasticsearch cluster, you configure
TLS on the HTTP interface for both Elasticsearch and Kibana.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="security-minimal-setup.html">« Set up minimal security for Elasticsearch</a>
</span>
<span class="next">
<a href="security-basic-setup-https.html">Set up basic security for the Elastic Stack plus secured HTTPS traffic »</a>
</span>
</div>
</div>
</body>
</html>
