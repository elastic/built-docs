<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Semantic text field type | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Semantic text field type | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="mapping-types.html" title="Field data types"/>
<link rel="prev" href="search-as-you-type.html" title="Search-as-you-type field type"/>
<link rel="next" href="shape.html" title="Shape field type"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="search-as-you-type.html">« Search-as-you-type field type</a>
</span>
<span class="next">
<a href="shape.html">Shape field type »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="mapping-types.html">Field data types</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Semantic text field type</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="semantic-text"></a>Semantic text field type</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
</div></div></div>

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>The <code class="literal">semantic_text</code> field type automatically generates embeddings for text content using an inference endpoint.
Long passages are <a class="xref" href="semantic-text.html#auto-text-chunking" title="Automatic text chunking">automatically chunked</a> to smaller sections to enable the processing of larger corpuses of text.</p>
<p>The <code class="literal">semantic_text</code> field type specifies an inference endpoint identifier that will be used to generate embeddings.
You can create the inference endpoint by using the <a class="xref" href="put-inference-api.html" title="Create inference API">Create inference API</a>.
This field type and the <a class="xref" href="query-dsl-semantic-query.html" title="Semantic query"><code class="literal">semantic</code> query</a> type make it simpler to perform semantic search on your data.</p>
<p>Using <code class="literal">semantic_text</code>, you won&#8217;t need to specify how to generate embeddings for
your data, or how to index it. The inference endpoint automatically determines
the embedding generation, indexing, and query to use.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="my-index-000001",
    mappings={
        "properties": {
            "inference_field": {
                "type": "semantic_text",
                "inference_id": "my-elser-endpoint"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "my-index-000001",
  mappings: {
    properties: {
      inference_field: {
        type: "semantic_text",
        inference_id: "my-elser-endpoint",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="19f1f9f25933f8e7aba59a10881c648b"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">PUT my-index-000001
{
  "mappings": {
    "properties": {
      "inference_field": {
        "type": "semantic_text",
        "inference_id": "my-elser-endpoint"
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/301.console"></div>
<div class="position-relative"><h4><a id="semantic-text-params"></a>Parameters for <code class="literal">semantic_text</code> fields</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">inference_id</code>
</span>
</dt>
<dd>
(Required, string)
Inference endpoint that will be used to generate the embeddings for the field.
Use the <a class="xref" href="put-inference-api.html" title="Create inference API">Create inference API</a> to create the endpoint.
</dd>
</dl>
</div>
<div class="position-relative"><h4><a id="infer-endpoint-validation"></a>Inference endpoint validation</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
<p>The <code class="literal">inference_id</code> will not be validated when the mapping is created, but when documents are ingested into the index.
When the first document is indexed, the <code class="literal">inference_id</code> will be used to generate underlying indexing structures for the field.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Removing an inference endpoint will cause ingestion of documents and semantic queries to fail on indices that define <code class="literal">semantic_text</code> fields with that inference endpoint as their <code class="literal">inference_id</code>.
Trying to <a class="xref" href="delete-inference-api.html" title="Delete inference API">delete an inference endpoint</a> that is used on a <code class="literal">semantic_text</code> field will result in an error.</p>
</div>
</div>
<div class="position-relative"><h4><a id="auto-text-chunking"></a>Automatic text chunking</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
<p>Inference endpoints have a limit on the amount of text they can process.
To allow for large amounts of text to be used in semantic search, <code class="literal">semantic_text</code> automatically generates smaller passages if needed, called <em>chunks</em>.</p>
<p>Each chunk will include the text subpassage and the corresponding embedding generated from it.
When querying, the individual passages will be automatically searched for each document, and the most relevant passage will be used to compute a score.</p>
<p>Documents are split into 250-word sections with a 100-word overlap so that each section shares 100 words with the previous section.
This overlap ensures continuity and prevents vital contextual information in the input text from being lost by a hard break.</p>
<div class="position-relative"><h4><a id="semantic-text-structure"></a><code class="literal">semantic_text</code> structure</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
<p>Once a document is ingested, a <code class="literal">semantic_text</code> field will have the following structure:</p>
<a id="08ac29f8fbac92b4f7fd58f00fb1fc25"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">"inference_field": {
  "text": "these are not the droids you're looking for", <a id="CO88-1"></a><i class="conum" data-value="1"></i>
  "inference": {
    "inference_id": "my-elser-endpoint", <a id="CO88-2"></a><i class="conum" data-value="2"></i>
    "model_settings": { <a id="CO88-3"></a><i class="conum" data-value="3"></i>
      "task_type": "sparse_embedding"
    },
    "chunks": [ <a id="CO88-4"></a><i class="conum" data-value="4"></i>
      {
        "text": "these are not the droids you're looking for",
        "embeddings": {
          (...)
        }
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO88-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field will become an object structure to accommodate both the original
text and the inference results.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO88-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">inference_id</code> used to generate the embeddings.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO88-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Model settings, including the task type and dimensions/similarity if
applicable.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO88-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Inference results will be grouped in chunks, each with its corresponding
text and embeddings.</p>
</td>
</tr>
</table>
</div>
<p>Refer to <a class="xref" href="semantic-search-semantic-text.html" title="Tutorial: semantic search with semantic_text">this tutorial</a> to learn more about
semantic search using <code class="literal">semantic_text</code> and the <code class="literal">semantic</code> query.</p>
<div class="position-relative"><h4><a id="custom-indexing"></a>Customizing <code class="literal">semantic_text</code> indexing</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
<p><code class="literal">semantic_text</code> uses defaults for indexing data based on the inference endpoint
specified. It enables you to quickstart your semantic search by providing
automatic inference and a dedicated query so you don&#8217;t need to provide further
details.</p>
<p>In case you want to customize data indexing, use the
<a class="xref" href="sparse-vector.html" title="Sparse vector field type"><code class="literal">sparse_vector</code></a> or <a class="xref" href="dense-vector.html" title="Dense vector field type"><code class="literal">dense_vector</code></a> field
types and create an ingest pipeline with an
<a class="xref" href="inference-processor.html" title="Inference processor">inference processor</a> to generate the embeddings.
<a class="xref" href="semantic-search-inference.html" title="Tutorial: semantic search with the inference API">This tutorial</a> walks you through the process. In
these cases - when you use <code class="literal">sparse_vector</code> or <code class="literal">dense_vector</code> field types instead
of the <code class="literal">semantic_text</code> field type to customize indexing - using the
<a class="xref" href="query-dsl-semantic-query.html" title="Semantic query"><code class="literal">semantic_query</code></a> is not supported for querying the
field data.</p>
<div class="position-relative"><h4><a id="update-script"></a>Updates to <code class="literal">semantic_text</code> fields</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
<p>Updates that use scripts are not supported for an index contains a <code class="literal">semantic_text</code> field.
Even if the script targets non-<code class="literal">semantic_text</code> fields, the update will fail when the index contains a <code class="literal">semantic_text</code> field.</p>
<div class="position-relative"><h4><a id="copy-to-support"></a><code class="literal">copy_to</code> support</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
<p>The <code class="literal">semantic_text</code> field type can be the target of
<a class="xref" href="copy-to.html" title="copy_to"><code class="literal">copy_to</code> fields</a>. This means you can use a single <code class="literal">semantic_text</code>
field to collect the values of other fields for semantic search. Each value has
its embeddings calculated separately; each field value is a separate set of chunk(s) in
the resulting embeddings.</p>
<p>This imposes a restriction on bulk requests and ingestion pipelines that update documents with <code class="literal">semantic_text</code> fields.
In these cases, all fields that are copied to a <code class="literal">semantic_text</code> field, including the <code class="literal">semantic_text</code> field value, must have a value to ensure every embedding is calculated correctly.</p>
<p>For example, the following mapping:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="test-index",
    mappings={
        "properties": {
            "infer_field": {
                "type": "semantic_text",
                "inference_id": "my-elser-endpoint"
            },
            "source_field": {
                "type": "text",
                "copy_to": "infer_field"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "test-index",
  mappings: {
    properties: {
      infer_field: {
        type: "semantic_text",
        inference_id: "my-elser-endpoint",
      },
      source_field: {
        type: "text",
        copy_to: "infer_field",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="8593715fcc70315a0816b435551258e0"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">PUT test-index
{
    "mappings": {
        "properties": {
            "infer_field": {
                "type": "semantic_text",
                "inference_id": "my-elser-endpoint"
            },
            "source_field": {
                "type": "text",
                "copy_to": "infer_field"
            }
        }
    }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/302.console"></div>
<p>Will need the following bulk update request to ensure that <code class="literal">infer_field</code> is updated correctly:</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.bulk(
    index="test-index",
    operations=[
        {
            "update": {
                "_id": "1"
            }
        },
        {
            "doc": {
                "infer_field": "updated inference field",
                "source_field": "updated source field"
            }
        }
    ],
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.bulk({
  index: "test-index",
  operations: [
    {
      update: {
        _id: "1",
      },
    },
    {
      doc: {
        infer_field: "updated inference field",
        source_field: "updated source field",
      },
    },
  ],
});
console.log(response);</pre>
</div>
<a id="38ba93890494bfa7beece58dffa44f98"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">PUT test-index/_bulk
{"update": {"_id": "1"}}
{"doc": {"infer_field": "updated inference field", "source_field": "updated source field"}}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/303.console"></div>
<p>Notice that both the <code class="literal">semantic_text</code> field and the source field are updated in the bulk request.</p>
<div class="position-relative"><h4><a id="limitations"></a>Limitations</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/semantic-text.asciidoc">edit</a></div>
<p><code class="literal">semantic_text</code> field types have the following limitations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">semantic_text</code> fields are not currently supported as elements of <a class="xref" href="nested.html" title="Nested field type">nested fields</a>.
</li>
<li class="listitem">
<code class="literal">semantic_text</code> fields can&#8217;t be defined as <a class="xref" href="multi-fields.html" title="fields">multi-fields</a> of another field, nor can they contain other fields as multi-fields.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="search-as-you-type.html">« Search-as-you-type field type</a>
</span>
<span class="next">
<a href="shape.html">Shape field type »</a>
</span>
</div>
</body>
</html>
