<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Set up a data stream | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="data-streams.html" title="Data streams"/>
<link rel="prev" href="data-streams.html" title="Data streams"/>
<link rel="next" href="use-a-data-stream.html" title="Use a data stream"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="data-streams.html">Data streams</a></span>
»
<span class="breadcrumb-node">Set up a data stream</span>
</div>
<div class="navheader">
<span class="prev">
<a href="data-streams.html">« Data streams</a>
</span>
<span class="next">
<a href="use-a-data-stream.html">Use a data stream »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="set-up-a-data-stream"></a>Set up a data stream<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/data-streams/set-up-a-data-stream.asciidoc">edit</a></h2>
</div></div></div>
<p>To set up a data stream, follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Check the <a class="xref" href="set-up-a-data-stream.html#data-stream-prereqs" title="Prerequisites">prerequisites</a>.
</li>
<li class="listitem">
<a class="xref" href="set-up-a-data-stream.html#configure-a-data-stream-ilm-policy" title="Optional: Configure an ILM lifecycle policy for a data stream">Optional: Configure an ILM lifecycle policy for a data stream</a>.
</li>
<li class="listitem">
<a class="xref" href="set-up-a-data-stream.html#create-a-data-stream-template" title="Create a composable template for a data stream">Create a composable template for a data stream</a>.
</li>
<li class="listitem">
<a class="xref" href="set-up-a-data-stream.html#create-a-data-stream" title="Create a data stream">Create a data stream</a>.
</li>
</ol>
</div>
<p>After you set up a data stream, you can <a class="xref" href="use-a-data-stream.html" title="Use a data stream">use the data
stream</a> for indexing, searches, and other supported operations.</p>
<h3><a id="data-stream-prereqs"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/data-streams/set-up-a-data-stream.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Elasticsearch data streams are intended for time-series data only. Each document
indexed to a data stream must contain a shared timestamp field.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Data streams work well with most common log formats. While no schema is
required to use data streams, we recommend the <a href="/guide/en/ecs/1.4" class="ulink" target="_top">Elastic Common Schema
(ECS)</a>.</p>
</div>
</div>
</li>
<li class="listitem">
Data streams are designed to be append-only. While you can index new documents
directly to a data stream, you cannot use a data stream to directly update or
delete individual documents. To update or delete specific documents in a data
stream, submit a <a class="xref" href="docs-delete.html" title="Delete API">delete</a> or <a class="xref" href="docs-update.html" title="Update API">update</a> API request to
the backing index containing the document.
</li>
</ul>
</div>
<h3><a id="configure-a-data-stream-ilm-policy"></a>Optional: Configure an ILM lifecycle policy for a data stream<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/data-streams/set-up-a-data-stream.asciidoc">edit</a></h3>
<p>You can use <a class="xref" href="index-lifecycle-management.html" title="ILM: Manage the index lifecycle">index lifecycle management (ILM)</a> to automatically
manage a data stream&#8217;s backing indices. For example, you could use ILM
to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Spin up a new write index for the data stream when the current one reaches a
certain size or age.
</li>
<li class="listitem">
Move older backing indices to slower, less expensive hardware.
</li>
<li class="listitem">
Delete stale backing indices to enforce data retention standards.
</li>
</ul>
</div>
<p>To use ILM with a data stream, you must
<a class="xref" href="set-up-lifecycle-policy.html" title="Configure a lifecycle policy">configure a lifecycle policy</a>. This lifecycle policy
should contain the automated actions to take on backing indices and the
triggers for such actions.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>While optional, we recommend using ILM to scale data streams in
production.</p>
</div>
</div>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following <a class="xref" href="ilm-put-lifecycle.html" title="Create lifecycle policy API">create lifecycle policy API</a> request
configures the <code class="literal">logs_policy</code> lifecycle policy.</p>
<p>The <code class="literal">logs_policy</code> policy uses the <a class="xref" href="ilm-rollover.html" title="Rollover"><code class="literal">rollover</code> action</a> to create a
new write index for the data stream when the current one reaches 25GB in size.
The policy also deletes backing indices 30 days after their rollover.</p>
<a id="f9be1f5f76008daf901192c86b45c02c"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_ilm/policy/logs_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_size": "25GB"
          }
        }
      },
      "delete": {
        "min_age": "30d",
        "actions": {
          "delete": {}
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/76.console"></div>
</div>
</details>
<h3><a id="create-a-data-stream-template"></a>Create a composable template for a data stream<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/data-streams/set-up-a-data-stream.asciidoc">edit</a></h3>
<p>Each data stream requires a <a class="xref" href="indices-templates.html" title="Index templates">composable template</a>. The data
stream uses this template to create its backing indices.</p>
<p>Composable templates for data streams must contain:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A name or wildcard (<code class="literal">*</code>) pattern for the data stream in the <code class="literal">index_patterns</code>
property.
</li>
<li class="listitem">
A <code class="literal">data_stream</code> definition containing the <code class="literal">timestamp_field</code> property.
This timestamp field must be included in every document indexed to the data
stream.
</li>
<li class="listitem">
A <a class="xref" href="date.html" title="Date datatype"><code class="literal">date</code></a> or <a class="xref" href="date_nanos.html" title="Date nanoseconds datatype"><code class="literal">date_nanos</code></a> field mapping for the
timestamp field specified in the <code class="literal">timestamp_field</code> property.
</li>
<li class="listitem">
If you intend to use ILM, you must specify the
<a class="xref" href="set-up-a-data-stream.html#configure-a-data-stream-ilm-policy" title="Optional: Configure an ILM lifecycle policy for a data stream">lifecycle policy</a> in the
<code class="literal">index.lifecycle.name</code> setting.
</li>
</ul>
</div>
<p>You can also specify other mappings and settings you&#8217;d like to apply to the
stream&#8217;s backing indices.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following <a class="xref" href="indices-templates.html" title="Index templates">put composable template API</a> request
configures the <code class="literal">logs_data_stream</code> template.</p>
<a id="ae5ff198a730fdc95b8fbcf53f2216a9"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_index_template/logs_data_stream
{
  "index_patterns": [ "logs*" ],
  "data_stream": {
    "timestamp_field": "@timestamp"
  },
  "template": {
    "mappings": {
      "properties": {
        "@timestamp": {
          "type": "date"
        }
      }
    },
    "settings": {
      "index.lifecycle.name": "logs_policy"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/77.console"></div>
</div>
</details>
<h3><a id="create-a-data-stream"></a>Create a data stream<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/data-streams/set-up-a-data-stream.asciidoc">edit</a></h3>
<p>With a composable template, you can create a data stream using one of two
methods:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Submit an <a class="xref" href="use-a-data-stream.html#add-documents-to-a-data-stream" title="Add documents to a data stream">indexing request</a> to a target
matching the name or wildcard pattern defined in the template&#8217;s <code class="literal">index_patterns</code>
property.</p>
<p>If the indexing request&#8217;s target doesn&#8217;t exist, Elasticsearch creates the data stream and
uses the target name as the name for the stream.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Data streams support only specific types of indexing requests. See
<a class="xref" href="use-a-data-stream.html#add-documents-to-a-data-stream" title="Add documents to a data stream">Add documents to a data stream</a>.</p>
</div>
</div>
<details>
<summary class="title"><span class="strong strong"><strong>Example: Index documents to create a data stream</strong></span></summary>
<div class="content">
<p>The following <a class="xref" href="docs-index_.html" title="Index API">index API</a> request targets <code class="literal">logs</code>, which matches
the wildcard pattern for the <code class="literal">logs_data_stream</code> template. Because no existing
index or data stream uses this name, this request creates the <code class="literal">logs</code> data stream
and indexes the document to it.</p>
<a id="1ce0576497abe7e1a9d6ca7fbcf3e910"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /logs/_doc/
{
  "@timestamp": "2020-12-06T11:04:05.000Z",
  "user": {
    "id": "vlb44hny"
  },
  "message": "Login attempt failed"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/78.console"></div>
<p>The API returns the following response. Note the <code class="literal">_index</code> property contains
<code class="literal">.ds-logs-000001</code>, indicating the document was indexed to the write index of the
new <code class="literal">logs</code> data stream.</p>
<a id="8bbd21e8d49f8af8d1ece3b581c225c8"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "_index": ".ds-logs-000001",
  "_id": "qecQmXIBT4jB8tq1nG0j",
  "_version": 1,
  "result": "created",
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 0,
  "_primary_term": 1
}</pre>
</div>
</div>
</details>
</li>
<li class="listitem">
<p>Use the <a class="xref" href="indices-create-data-stream.html" title="Create data stream API">create data stream API</a> to manually
create a data stream. The name of the data stream must match the
name or wildcard pattern defined in the template&#8217;s <code class="literal">index_patterns</code> property.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example: Manually create a data stream</strong></span></summary>
<div class="content">
<p>The following <a class="xref" href="indices-create-data-stream.html" title="Create data stream API">create data stream API</a> request
targets <code class="literal">logs_alt</code>, which matches the wildcard pattern for the
<code class="literal">logs_data_stream</code> template. Because no existing index or data stream uses this
name, this request creates the <code class="literal">logs_alt</code> data stream.</p>
<a id="ef335d1d0b71879ea1b07be1d20a2a1c"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_data_stream/logs_alt</pre>
</div>
<div class="console_widget" data-snippet="snippets/79.console"></div>
</div>
</details>
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="data-streams.html">« Data streams</a>
</span>
<span class="next">
<a href="use-a-data-stream.html">Use a data stream »</a>
</span>
</div>
</div>
</body>
</html>
