<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Shard allocation, relocation, and recovery | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Shard allocation, relocation, and recovery | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="settings.html" title="Configuring Elasticsearch"/>
<link rel="prev" href="security-settings.html" title="Security settings in Elasticsearch"/>
<link rel="next" href="shard-request-cache.html" title="Shard request cache settings"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="security-settings.html">« Security settings in Elasticsearch</a>
</span>
<span class="next">
<a href="shard-request-cache.html">Shard request cache settings »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="settings.html">Configuring Elasticsearch</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Shard allocation, relocation, and recovery</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="shard-allocation-relocation-recovery"></a>Shard allocation, relocation, and recovery</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>Each <a class="xref" href="documents-indices.html" title="Data in: documents and indices">index</a> in Elasticsearch is divided into one or more <a class="xref" href="scalability.html" title="Scalability and resilience: clusters, nodes, and shards">shards</a>.
Each document in an index belongs to a single shard.</p>
<p>A cluster can contain multiple copies of a shard. Each shard has one distinguished shard copy called the <em>primary</em>, and zero or more non-primary copies called <em>replicas</em>. The primary shard copy serves as the main entry point for all indexing operations. The operations on the primary shard copy are then forwarded to its replicas.</p>
<p>Replicas maintain redundant copies of your data across the <a class="xref" href="modules-node.html" title="Nodes">nodes</a> in your cluster, protecting against hardware failure and increasing capacity to serve read requests like searching or retrieving a document. If the primary shard copy fails, then a replica is promoted to primary and takes over the primary&#8217;s responsibilities.</p>
<p>Over the course of normal operation, Elasticsearch allocates shard copies to nodes, relocates shard copies across nodes to balance the cluster or satisfy new allocation constraints, and recovers shards to initialize new copies. In this topic, you&#8217;ll learn how these operations work and how you can control them.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To learn about optimizing the number and size of shards in your cluster, refer to <a class="xref" href="size-your-shards.html" title="Size your shards">Size your shards</a>. To learn about how read and write operations are replicated across shards and shard copies, refer to <a class="xref" href="docs-replication.html" title="Reading and Writing documents">Reading and writing documents</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="shard-allocation"></a>Shard allocation</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>Shard allocation is the process of assigning shard copies to nodes. This can
happen during initial recovery, replica allocation, rebalancing, when nodes are added to or removed from the cluster, or when cluster or index settings that impact allocation are updated.</p>
<p>By default, the primary and replica shard copies for an index can be allocated to any node in the cluster, and may be relocated to rebalance the cluster.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_adjust_shard_allocation_settings"></a>Adjust shard allocation settings</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>You can control how shard copies are allocated using the following settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="modules-cluster.html" title="Cluster-level shard allocation and routing settings">Cluster-level shard allocation settings</a>: Use these settings to control how shard copies are allocated and balanced across the entire cluster. For example, you might want to allocate nodes availability zones, or prevent certain nodes from being used so you can perform maintenance.
</li>
<li class="listitem">
<a class="xref" href="index-modules-allocation.html" title="Index Shard Allocation">Index-level shard allocation settings</a>: Use these settings to control how the shard copies for a specific index are allocated. For example, you might want to allocate an index to a node in a specific data tier, or to an node with specific attributes.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_monitor_shard_allocation"></a>Monitor shard allocation</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>If a shard copy is unassigned, it means that the shard copy is not allocated to any node in the cluster. This can happen if there are not enough nodes in the cluster to allocate the shard copy, or if the shard copy can&#8217;t be allocated to any node that satisfies the shard allocation filtering rules. When a shard copy is unassigned, your cluster is considered unhealthy and returns a yellow or red cluster health status.</p>
<p>You can use the following APIs to monitor shard allocation:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="cluster-allocation-explain.html" title="Cluster allocation explain API">Cluster allocation explain</a>
</li>
<li class="listitem">
<a class="xref" href="cat-allocation.html" title="cat allocation API">cat allocation</a>
</li>
<li class="listitem">
<a class="xref" href="cluster-health.html" title="Cluster health API">cluster health</a>
</li>
</ul>
</div>
<p><a class="xref" href="red-yellow-cluster-status.html" title="Red or yellow cluster health status">Learn more about troubleshooting unassigned shard copies and recovering your cluster health</a>.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="shard-recovery"></a>Shard recovery</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>Shard recovery is the process of initializing a shard copy, such as restoring a
primary shard from a snapshot or creating a replica shard from a primary shard.
When a shard recovery completes, the recovered shard is available for search
and indexing.</p>
<p>Recovery automatically occurs during the following processes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
When creating an index for the first time.
</li>
<li class="listitem">
When a node rejoins the cluster and starts up any missing primary shard copies using the data that it holds in its data path.
</li>
<li class="listitem">
Creation of new replica shard copies from the primary.
</li>
<li class="listitem">
Relocation of a shard copy to a different node in the same cluster.
</li>
<li class="listitem">
A <a class="xref" href="snapshots-restore-snapshot.html" title="Restore a snapshot">snapshot restore</a> operation.
</li>
<li class="listitem">
A <a class="xref" href="indices-clone-index.html" title="Clone index API">clone</a>, <a class="xref" href="indices-shrink-index.html" title="Shrink index API">shrink</a>, or
<a class="xref" href="indices-split-index.html" title="Split index API">split</a> operation.
</li>
</ul>
</div>
<p>You can determine the cause of a shard recovery using the <a class="xref" href="indices-recovery.html" title="Index recovery API">recovery</a> or  <a class="xref" href="cat-recovery.html" title="cat recovery API">cat recovery</a> APIs.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_adjust_shard_recovery_settings"></a>Adjust shard recovery settings</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>To control how shards are recovered, for example the resources that can be used by recovery operations, and which indices should be prioritized for recovery, you can adjust the following settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="recovery.html" title="Index recovery settings">Index recovery settings</a>
</li>
<li class="listitem">
<a class="xref" href="modules-cluster.html" title="Cluster-level shard allocation and routing settings">Cluster-level shard allocation settings</a>
</li>
<li class="listitem">
<a class="xref" href="index-modules-allocation.html" title="Index Shard Allocation">Index-level shard allocation settings</a>, including <a class="xref" href="delayed-allocation.html" title="Delaying allocation when a node leaves">delayed allocation</a> and <a class="xref" href="recovery-prioritization.html" title="Index recovery prioritization">index recovery prioritization</a>
</li>
</ul>
</div>
<p>Shard recovery operations also respect general shard allocation settings.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_monitor_shard_recovery"></a>Monitor shard recovery</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>You can use the following APIs to monitor shard allocation:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
View a list of in-progress and completed recoveries using the <a class="xref" href="cat-recovery.html" title="cat recovery API">cat recovery API</a>
</li>
<li class="listitem">
View detailed information about a specific recovery using the <a class="xref" href="indices-recovery.html" title="Index recovery API">index recovery API</a>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="shard-relocation"></a>Shard relocation</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>Shard relocation is the process of moving shard copies from one node to another. This can happen when a node joins or leaves the cluster, or when the cluster is rebalancing.</p>
<p>When a shard copy is relocated, it is created as a new shard copy on the target node. When the shard copy is fully allocated and recovered, the old shard copy is deleted. If the shard copy being relocated is a primary, then the new shard copy is marked as primary before the old shard copy is deleted.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_adjust_shard_relocation_settings"></a>Adjust shard relocation settings</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/modules/shard-ops.asciidoc">edit</a></div>
</div></div></div>
<p>You can control how and when shard copies are relocated. For example, you can adjust the rebalancing settings that control when shard copies are relocated to balance the cluster, or the high watermark for disk-based shard allocation that can trigger relocation. These settings are part of the <a class="xref" href="modules-cluster.html" title="Cluster-level shard allocation and routing settings">cluster-level shard allocation settings</a>.</p>
<p>Shard relocation operations also respect shard allocation and recovery settings.</p>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="security-settings.html">« Security settings in Elasticsearch</a>
</span>
<span class="next">
<a href="shard-request-cache.html">Shard request cache settings »</a>
</span>
</div>
</body>
</html>
