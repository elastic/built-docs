<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="Elasticsearch diagnostic, diagnostics">
<title>Simulate ingest API | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Simulate ingest API | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="ingest-apis.html" title="Ingest APIs"/>
<link rel="prev" href="simulate-pipeline-api.html" title="Simulate pipeline API"/>
<link rel="next" href="geoip-stats-api.html" title="GeoIP stats API"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="simulate-pipeline-api.html">« Simulate pipeline API</a>
</span>
<span class="next">
<a href="geoip-stats-api.html">GeoIP stats API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ingest-apis.html">Ingest APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Simulate ingest API</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="simulate-ingest-api"></a>Simulate ingest API</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>

<p>Executes ingest pipelines against a set of provided documents, optionally
with substitute pipeline definitions. This API is meant to be used for
troubleshooting or pipeline development, as it does not actually index any
data into Elasticsearch.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.simulate.ingest({
  body: {
    docs: [
      {
        _index: "my-index",
        _id: "id",
        _source: {
          foo: "bar",
        },
      },
      {
        _index: "my-index",
        _id: "id",
        _source: {
          foo: "rab",
        },
      },
    ],
    pipeline_substitutions: {
      "my-pipeline": {
        processors: [
          {
            set: {
              field: "field3",
              value: "value3",
            },
          },
        ],
      },
    },
    component_template_substitutions: {
      "my-component-template": {
        template: {
          mappings: {
            dynamic: "true",
            properties: {
              field3: {
                type: "keyword",
              },
            },
          },
          settings: {
            index: {
              default_pipeline: "my-pipeline",
            },
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="dbce6cb1eaf9b2cc36b7f9a13afc63ea"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_ingest/_simulate
{
  "docs": [
    {
      "_index": "my-index",
      "_id": "id",
      "_source": {
        "foo": "bar"
      }
    },
    {
      "_index": "my-index",
      "_id": "id",
      "_source": {
        "foo": "rab"
      }
    }
  ],
  "pipeline_substitutions": { <a id="CO820-1"></a><i class="conum" data-value="1"></i>
    "my-pipeline": {
      "processors": [
        {
          "set": {
            "field": "field3",
            "value": "value3"
          }
        }
      ]
    }
  },
  "component_template_substitutions": { <a id="CO820-2"></a><i class="conum" data-value="2"></i>
    "my-component-template": {
      "template": {
        "mappings": {
          "dynamic": "true",
          "properties": {
            "field3": {
              "type": "keyword"
            }
          }
        },
        "settings": {
          "index": {
            "default_pipeline": "my-pipeline"
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/3081.console"></div>
<div class="calloutlist default has-js lang-console">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO820-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This replaces the existing <code class="literal">my-pipeline</code> pipeline with the contents given here for the duration of this request.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO820-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This replaces the existing <code class="literal">my-component-template</code> component template with the contents given here for the duration of this request.
These templates can be used to change the pipeline(s) used, or to modify the mapping that will be used to validate the result.</p>
</td>
</tr>
</table>
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="simulate-ingest-api-request"></a>Request</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<p><code class="literal">POST /_ingest/_simulate</code></p>
<p><code class="literal">GET /_ingest/_simulate</code></p>
<p><code class="literal">POST /_ingest/&lt;target&gt;/_simulate</code></p>
<p><code class="literal">GET /_ingest/&lt;target&gt;/_simulate</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="simulate-ingest-api-prereqs"></a>Prerequisites</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If the Elasticsearch security features are enabled, you must have the
<code class="literal">index</code> or <code class="literal">create</code> <a class="xref" href="security-privileges.html#privileges-list-indices" title="Indices privileges">index privileges</a>
to use this API.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="simulate-ingest-api-desc"></a>Description</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<p>The simulate ingest API simulates ingesting data into an index. It
executes the default and final pipeline for that index against a set
of documents provided in the body of the request. If a pipeline
contains a <a class="xref" href="reroute-processor.html" title="Reroute processor">reroute processor</a>, it follows that
reroute processor to the new index, executing that index&#8217;s pipelines
as well the same way that a non-simulated ingest would. No data is
indexed into Elasticsearch. Instead, the transformed document is returned,
along with the list of pipelines that have been executed and the name
of the index where the document would have been indexed if this were
not a simulation. The transformed document is validated against the
mappings that would apply to this index, and any validation error is
reported in the result.</p>
<p>This API differs from the
<a class="xref" href="simulate-pipeline-api.html" title="Simulate pipeline API">simulate pipeline API</a> in that you specify a
single pipeline for that API, and it only runs that one pipeline. The
simulate pipeline API is more useful for developing a single pipeline,
while the simulate ingest API is more useful for troubleshooting the
interaction of the various pipelines that get applied when ingesting
into an index.</p>
<p>By default, the pipeline definitions that are currently in the system
are used. However, you can supply substitute pipeline definitions in the
body of the request. These will be used in place of the pipeline
definitions that are already in the system. This can be used to replace
existing pipeline definitions or to create new ones. The pipeline
substitutions are only used within this request.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="simulate-ingest-api-path-params"></a>Path parameters</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;target&gt;</code>
</span>
</dt>
<dd>
(Optional, string)
The index to simulate ingesting into. This can be overridden by specifying an index
on each document. If you provide a &lt;target&gt; in the request path, it is used for any
documents that don’t explicitly specify an index argument.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="simulate-ingest-api-query-params"></a>Query parameters</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">pipeline</code>
</span>
</dt>
<dd>
(Optional, string)
Pipeline to use as the default pipeline. This can be used to override the default pipeline
of the index being ingested into.
</dd>
</dl>
</div>
</div>

<div class="section child_attributes">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="simulate-ingest-api-request-body"></a>Request body</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">docs</code>
</span>
</dt>
<dd>
<p>
(Required, array of objects)
Sample documents to test in the pipeline.
</p>
<details open>
<summary class="title">Properties of <code class="literal">docs</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">_id</code>
</span>
</dt>
<dd>
(Optional, string)
Unique identifier for the document.
</dd>
<dt>
<span class="term">
<code class="literal">_index</code>
</span>
</dt>
<dd>
(Optional, string)
Name of the index that the document will be ingested into.
</dd>
<dt>
<span class="term">
<code class="literal">_source</code>
</span>
</dt>
<dd>
(Required, object)
JSON body for the document.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">pipeline_substitutions</code>
</span>
</dt>
<dd>
<p>
(Optional, map of strings to objects)
Map of pipeline IDs to substitute pipeline definition objects.
</p>
<details open>
<summary class="title">Properties of pipeline definition objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">description</code>
</span>
</dt>
<dd>
(Optional, string)
Description of the ingest pipeline.
</dd>
<dt>
<span class="term">
<code class="literal">on_failure</code>
</span>
</dt>
<dd>
<p>
(Optional, array of <a class="xref" href="processors.html" title="Ingest processor reference">processor</a> objects)
Processors to run immediately after a processor failure.
</p>
<p>Each processor supports a processor-level <code class="literal">on_failure</code> value. If a processor
without an <code class="literal">on_failure</code> value fails, Elasticsearch uses this pipeline-level parameter as
a fallback. The processors in this parameter run sequentially in the order
specified. Elasticsearch will not attempt to run the pipeline&#8217;s remaining processors.</p>
</dd>
<dt>
<span class="term">
<code class="literal">processors</code>
</span>
</dt>
<dd>
(Required, array of <a class="xref" href="processors.html" title="Ingest processor reference">processor</a> objects)
Processors used to perform transformations on documents before indexing.
Processors run sequentially in the order specified.
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
<p>
(Optional, integer)
Version number used by external systems to track ingest pipelines.
</p>
<p>See the <a class="xref" href="put-pipeline-api.html#put-pipeline-api-query-params" title="Query parameters"><code class="literal">if_version</code></a> parameter above for
how the version attribute is used.</p>
</dd>
<dt>
<span class="term">
<code class="literal">_meta</code>
</span>
</dt>
<dd>
(Optional, object)
Optional metadata about the ingest pipeline. May have any contents. This
map is not automatically generated by Elasticsearch.
</dd>
<dt>
<span class="term">
<code class="literal">deprecated</code>
</span>
</dt>
<dd>
(Optional, boolean)
Marks this ingest pipeline as deprecated.
When a deprecated ingest pipeline is referenced as the default or final pipeline when creating or updating a non-deprecated index template,
Elasticsearch will emit a deprecation warning.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">component_template_substitutions</code>
</span>
</dt>
<dd>
<p>
(Optional, map of strings to objects)
Map of component template names to substitute component template definition objects.
</p>
<details open>
<summary class="title">Properties of component template definition objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">template</code>
</span>
</dt>
<dd>
<p>
(Required, object)
This is the template to be applied, may optionally include a <code class="literal">mappings</code>,
<code class="literal">settings</code>, or <code class="literal">aliases</code> configuration.
</p>
<details open>
<summary class="title">Properties of <code class="literal">template</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">aliases</code>
</span>
</dt>
<dd>
<p>
(Optional, object of objects) Aliases to add.
</p>
<p>If the index template includes a <code class="literal">data_stream</code> object, these are data stream
aliases. Otherwise, these are index aliases. Data stream aliases ignore the
<code class="literal">index_routing</code>, <code class="literal">routing</code>, and <code class="literal">search_routing</code> options.</p>
<details open>
<summary class="title">Properties of <code class="literal">aliases</code> objects</summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;alias&gt;</code>
</span>
</dt>
<dd>
<p>
(Required, object) The key is the alias name. Index alias names support
<a class="xref" href="api-conventions.html#api-date-math-index-names" title="Date math support in index and index alias names">date math</a>.
</p>
<p>The object body contains options for the alias. Supports an empty object.</p>
<details open>
<summary class="title">Properties of <code class="literal">&lt;alias&gt;</code></summary>
<div class="content">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl.html" title="Query DSL">Query DSL object</a>) Query used to limit documents the
alias can access.
</dd>
<dt>
<span class="term">
<code class="literal">index_routing</code>
</span>
</dt>
<dd>
(Optional, string) Value used to route indexing operations to a specific shard.
If specified, this overwrites the <code class="literal">routing</code> value for indexing operations.
</dd>
<dt>
<span class="term">
<code class="literal">is_hidden</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the alias is <a class="xref" href="api-conventions.html#multi-hidden" title="Hidden data streams and indices">hidden</a>. Defaults to
<code class="literal">false</code>. All indices for the alias must have the same <code class="literal">is_hidden</code> value.
</dd>
<dt>
<span class="term">
<code class="literal">is_write_index</code>
</span>
</dt>
<dd>
(Optional, Boolean) If <code class="literal">true</code>, the index is the <a class="xref" href="aliases.html#write-index" title="Write index">write index</a> for
the alias. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">routing</code>
</span>
</dt>
<dd>
(Optional, string) Value used to route indexing and search operations to a
specific shard.
</dd>
<dt>
<span class="term">
<code class="literal">search_routing</code>
</span>
</dt>
<dd>
(Optional, string) Value used to route search operations to a specific shard. If
specified, this overwrites the <code class="literal">routing</code> value for search operations.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">mappings</code>
</span>
</dt>
<dd>
<p>(Optional, <a class="xref" href="mapping.html" title="Mapping">mapping object</a>) Mapping for fields in the index. If
specified, this mapping can include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Field names
</li>
<li class="listitem">
<a class="xref" href="mapping-types.html" title="Field data types">Field data types</a>
</li>
<li class="listitem">
<a class="xref" href="mapping-params.html" title="Mapping parameters">Mapping parameters</a>
</li>
</ul>
</div>
<p>See <a class="xref" href="mapping.html" title="Mapping">Mapping</a>.</p>
</dd>
<dt>
<span class="term">
<code class="literal">settings</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="index-modules.html#index-modules-settings" title="Index settings">index setting object</a>) Configuration
options for the index. See <a class="xref" href="index-modules.html#index-modules-settings" title="Index settings">Index settings</a>.
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<code class="literal">version</code>
</span>
</dt>
<dd>
(Optional, integer)
Version number used to manage component templates externally.
This number is not automatically generated or incremented by Elasticsearch.
</dd>
<dt>
<span class="term">
<code class="literal">allow_auto_create</code>
</span>
</dt>
<dd>
(Optional, Boolean)
This setting overrides the value of the
<a class="xref" href="docs-index_.html#index-creation" title="Automatically create data streams and indices"><code class="literal">action.auto_create_index</code></a> cluster setting. If set to
<code class="literal">true</code> in a template, then indices can be automatically created using that
template even if auto-creation of indices is disabled via
<code class="literal">actions.auto_create_index</code>. If set to <code class="literal">false</code>, then indices or data streams matching the
template must always be explicitly created, and may never be automatically
created.
</dd>
<dt>
<span class="term">
<code class="literal">_meta</code>
</span>
</dt>
<dd>
(Optional, object)
Optional user metadata about the component template. May have any contents.
This map is not automatically generated by Elasticsearch.
</dd>
<dt>
<span class="term">
<code class="literal">deprecated</code>
</span>
</dt>
<dd>
(Optional, boolean)
Marks this component template as deprecated.
When a deprecated component template is referenced when creating or updating a non-deprecated index template,
Elasticsearch will emit a deprecation warning.
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="simulate-ingest-api-example"></a>Examples</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="simulate-ingest-api-pre-existing-pipelines-ex"></a>Use pre-existing pipeline definitions</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<p>In this example the index <code class="literal">index</code> has a default pipeline called <code class="literal">my-pipeline</code> and a final
pipeline called <code class="literal">my-final-pipeline</code>. Since both documents are being ingested into <code class="literal">index</code>,
both pipelines are executed using the pipeline definitions that are already in the system.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.simulate.ingest(
    body={
        "docs": [
            {
                "_index": "my-index",
                "_id": "123",
                "_source": {
                    "foo": "bar"
                }
            },
            {
                "_index": "my-index",
                "_id": "456",
                "_source": {
                    "foo": "rab"
                }
            }
        ]
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.simulate.ingest(
  body: {
    docs: [
      {
        _index: 'my-index',
        _id: '123',
        _source: {
          foo: 'bar'
        }
      },
      {
        _index: 'my-index',
        _id: '456',
        _source: {
          foo: 'rab'
        }
      }
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.simulate.ingest({
  body: {
    docs: [
      {
        _index: "my-index",
        _id: "123",
        _source: {
          foo: "bar",
        },
      },
      {
        _index: "my-index",
        _id: "456",
        _source: {
          foo: "rab",
        },
      },
    ],
  },
});
console.log(response);</pre>
</div>
<a id="19c00c6b29bc7dbc5e92b3668da2da93"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">POST /_ingest/_simulate
{
  "docs": [
    {
      "_index": "my-index",
      "_id": "123",
      "_source": {
        "foo": "bar"
      }
    },
    {
      "_index": "my-index",
      "_id": "456",
      "_source": {
        "foo": "rab"
      }
    }
  ]
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/3082.console"></div>
<p>The API returns the following response:</p>
<a id="ba579829ea2427c12ac06ecc79656948"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
   "docs": [
      {
         "doc": {
            "_id": "123",
            "_index": "my-index",
            "_version": -3,
            "_source": {
               "field1": "value1",
               "field2": "value2",
               "foo": "bar"
            },
            "executed_pipelines": [
               "my-pipeline",
               "my-final-pipeline"
            ]
         }
      },
      {
         "doc": {
            "_id": "456",
            "_index": "my-index",
            "_version": -3,
            "_source": {
               "field1": "value1",
               "field2": "value2",
               "foo": "rab"
            },
            "executed_pipelines": [
               "my-pipeline",
               "my-final-pipeline"
            ]
         }
      }
   ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="simulate-ingest-api-request-body-ex"></a>Specify a pipeline substitution in the request body</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<p>In this example the index <code class="literal">my-index</code> has a default pipeline called <code class="literal">my-pipeline</code> and a final
pipeline called <code class="literal">my-final-pipeline</code>. But a substitute definition of <code class="literal">my-pipeline</code> is
provided in <code class="literal">pipeline_substitutions</code>. The substitute <code class="literal">my-pipeline</code> will be used in place of
the <code class="literal">my-pipeline</code> that is in the system, and then the <code class="literal">my-final-pipeline</code> that is already
defined in the system will be executed.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.simulate.ingest(
    body={
        "docs": [
            {
                "_index": "my-index",
                "_id": "123",
                "_source": {
                    "foo": "bar"
                }
            },
            {
                "_index": "my-index",
                "_id": "456",
                "_source": {
                    "foo": "rab"
                }
            }
        ],
        "pipeline_substitutions": {
            "my-pipeline": {
                "processors": [
                    {
                        "uppercase": {
                            "field": "foo"
                        }
                    }
                ]
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.simulate.ingest(
  body: {
    docs: [
      {
        _index: 'my-index',
        _id: '123',
        _source: {
          foo: 'bar'
        }
      },
      {
        _index: 'my-index',
        _id: '456',
        _source: {
          foo: 'rab'
        }
      }
    ],
    pipeline_substitutions: {
      "my-pipeline": {
        processors: [
          {
            uppercase: {
              field: 'foo'
            }
          }
        ]
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.simulate.ingest({
  body: {
    docs: [
      {
        _index: "my-index",
        _id: "123",
        _source: {
          foo: "bar",
        },
      },
      {
        _index: "my-index",
        _id: "456",
        _source: {
          foo: "rab",
        },
      },
    ],
    pipeline_substitutions: {
      "my-pipeline": {
        processors: [
          {
            uppercase: {
              field: "foo",
            },
          },
        ],
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="bcdfaa4487747249699a86a0dcd22f5e"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">POST /_ingest/_simulate
{
  "docs": [
    {
      "_index": "my-index",
      "_id": "123",
      "_source": {
        "foo": "bar"
      }
    },
    {
      "_index": "my-index",
      "_id": "456",
      "_source": {
        "foo": "rab"
      }
    }
  ],
  "pipeline_substitutions": {
    "my-pipeline": {
      "processors": [
        {
          "uppercase": {
            "field": "foo"
          }
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/3083.console"></div>
<p>The API returns the following response:</p>
<a id="6e013ecf5dacf18e02ba1a6d11d09cc8"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
   "docs": [
      {
         "doc": {
            "_id": "123",
            "_index": "my-index",
            "_version": -3,
            "_source": {
               "field2": "value2",
               "foo": "BAR"
            },
            "executed_pipelines": [
               "my-pipeline",
               "my-final-pipeline"
            ]
         }
      },
      {
         "doc": {
            "_id": "456",
            "_index": "my-index",
            "_version": -3,
            "_source": {
               "field2": "value2",
               "foo": "RAB"
            },
            "executed_pipelines": [
               "my-pipeline",
               "my-final-pipeline"
            ]
         }
      }
   ]
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="simulate-ingest-api-substitute-component-templates-ex"></a>Specify a component template substitution in the request body</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/ingest/apis/simulate-ingest.asciidoc">edit</a></div>
</div></div></div>
<p>In this example, imagine that the index <code class="literal">my-index</code> has a strict mapping with only the <code class="literal">foo</code>
keyword field defined. Say that field mapping came from a component template named
<code class="literal">my-mappings-template</code>. We want to test adding a new field, <code class="literal">bar</code>. So a substitute definition of
<code class="literal">my-mappings-template</code> is provided in <code class="literal">component_template_substitutions</code>. The substitute
<code class="literal">my-mappings-template</code> will be used in place of the existing mapping for <code class="literal">my-index</code> and in place
of the <code class="literal">my-mappings-template</code> that is in the system.</p>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.simulate.ingest({
  body: {
    docs: [
      {
        _index: "my-index",
        _id: "123",
        _source: {
          foo: "foo",
        },
      },
      {
        _index: "my-index",
        _id: "456",
        _source: {
          bar: "rab",
        },
      },
    ],
    component_template_substitutions: {
      "my-mappings_template": {
        template: {
          mappings: {
            dynamic: "strict",
            properties: {
              foo: {
                type: "keyword",
              },
              bar: {
                type: "keyword",
              },
            },
          },
        },
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="e4b38973c74037335378d8480f1ce894"></a>
<div class="pre_wrapper lang-console default has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-js">POST /_ingest/_simulate
{
  "docs": [
    {
      "_index": "my-index",
      "_id": "123",
      "_source": {
        "foo": "foo"
      }
    },
    {
      "_index": "my-index",
      "_id": "456",
      "_source": {
        "bar": "rab"
      }
    }
  ],
  "component_template_substitutions": {
    "my-mappings_template": {
      "template": {
        "mappings": {
          "dynamic": "strict",
          "properties": {
            "foo": {
              "type": "keyword"
            },
            "bar": {
              "type": "keyword"
            }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-js" data-snippet="snippets/3084.console"></div>
<p>The API returns the following response:</p>
<a id="10454800a8f75bc145b2c236ad6f44f7"></a>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
   "docs": [
      {
         "doc": {
            "_id": "123",
            "_index": "my-index",
            "_version": -3,
            "_source": {
               "foo": "foo"
            },
            "executed_pipelines": []
         }
      },
      {
         "doc": {
            "_id": "456",
            "_index": "my-index",
            "_version": -3,
            "_source": {
               "bar": "rab"
            },
            "executed_pipelines": []
         }
      }
   ]
}</pre>
</div>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="simulate-pipeline-api.html">« Simulate pipeline API</a>
</span>
<span class="next">
<a href="geoip-stats-api.html">GeoIP stats API »</a>
</span>
</div>
</body>
</html>
