<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sort search results | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="search-your-data.html" title="Search your data"/>
<link rel="prev" href="search-shard-routing.html" title="Search shard routing"/>
<link rel="next" href="query-dsl.html" title="Query DSL"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="search-your-data.html">Search your data</a></span>
»
<span class="breadcrumb-node">Sort search results</span>
</div>
<div class="navheader">
<span class="prev">
<a href="search-shard-routing.html">« Search shard routing</a>
</span>
<span class="next">
<a href="query-dsl.html">Query DSL »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="sort-search-results"></a>Sort search results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h2>
</div></div></div>
<p>Allows you to add one or more sorts on specific fields. Each sort can be
reversed as well. The sort is defined on a per field level, with special
field name for <code class="literal">_score</code> to sort by score, and <code class="literal">_doc</code> to sort by index order.</p>
<p>Assuming the following index mapping:</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'my-index-000001',
  body: {
    mappings: {
      properties: {
        post_date: {
          type: 'date'
        },
        user: {
          type: 'keyword'
        },
        name: {
          type: 'keyword'
        },
        age: {
          type: 'integer'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Indices.Create(
	"my-index-000001",
	es.Indices.Create.WithBody(strings.NewReader(`{
	  "mappings": {
	    "properties": {
	      "post_date": {
	        "type": "date"
	      },
	      "user": {
	        "type": "keyword"
	      },
	      "name": {
	        "type": "keyword"
	      },
	      "age": {
	        "type": "integer"
	      }
	    }
	  }
	}`)),
)
fmt.Println(res, err)</pre>
</div>
<a id="3a6238835c7d9f51e6d91f92885fadeb"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">PUT /my-index-000001
{
  "mappings": {
    "properties": {
      "post_date": { "type": "date" },
      "user": {
        "type": "keyword"
      },
      "name": {
        "type": "keyword"
      },
      "age": { "type": "integer" }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/733.console"></div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  index: 'my-index-000001',
  body: {
    sort: [
      {
        post_date: {
          order: 'asc'
        }
      },
      'user',
      {
        name: 'desc'
      },
      {
        age: 'desc'
      },
      '_score'
    ],
    query: {
      term: {
        user: 'kimchy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithIndex("my-index-000001"),
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "post_date": {
	        "order": "asc"
	      }
	    },
	    "user",
	    {
	      "name": "desc"
	    },
	    {
	      "age": "desc"
	    },
	    "_score"
	  ],
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="cd3986003382259348b84859f8ac2466"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /my-index-000001/_search
{
  "sort" : [
    { "post_date" : {"order" : "asc"}},
    "user",
    { "name" : "desc" },
    { "age" : "desc" },
    "_score"
  ],
  "query" : {
    "term" : { "user" : "kimchy" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/734.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">_doc</code> has no real use-case besides being the most efficient sort order.
So if you don&#8217;t care about the order in which documents are returned, then you
should sort by <code class="literal">_doc</code>. This especially helps when <a class="xref" href="paginate-search-results.html#scroll-search-results" title="Scroll search results">scrolling</a>.</p>
</div>
</div>
<h3><a id="_sort_values"></a>Sort Values<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>The sort values for each document returned are also returned as part of
the response.</p>
<h3><a id="_sort_order"></a>Sort Order<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>The <code class="literal">order</code> option can have the following values:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">asc</code>
</p>
</td>
<td valign="top">
<p>
Sort in ascending order
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">desc</code>
</p>
</td>
<td valign="top">
<p>
Sort in descending order
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>The order defaults to <code class="literal">desc</code> when sorting on the <code class="literal">_score</code>, and defaults
to <code class="literal">asc</code> when sorting on anything else.</p>
<h3><a id="_sort_mode_option"></a>Sort mode option<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>Elasticsearch supports sorting by array or multi-valued fields. The <code class="literal">mode</code> option
controls what array value is picked for sorting the document it belongs
to. The <code class="literal">mode</code> option can have the following values:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<code class="literal">min</code>
</p>
</td>
<td valign="top">
<p>
Pick the lowest value.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">max</code>
</p>
</td>
<td valign="top">
<p>
Pick the highest value.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">sum</code>
</p>
</td>
<td valign="top">
<p>
Use the sum of all values as sort value. Only applicable for
number based array fields.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">avg</code>
</p>
</td>
<td valign="top">
<p>
Use the average of all values as sort value. Only applicable
for number based array fields.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<code class="literal">median</code>
</p>
</td>
<td valign="top">
<p>
Use the median of all values as sort value.  Only applicable
for number based array fields.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p>The default sort mode in the ascending sort order is <code class="literal">min</code>&#8201;&#8212;&#8201;the lowest value
is picked. The default sort mode in the descending order is <code class="literal">max</code>&#8201;&#8212;&#8201;the highest value is picked.</p>
<h4><a id="_sort_mode_example_usage"></a>Sort mode example usage<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h4>
<p>In the example below the field price has multiple prices per document.
In this case the result hits will be sorted by price ascending based on
the average price per document.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.index(
  index: 'my-index-000001',
  id: 1,
  refresh: true,
  body: {
    product: 'chocolate',
    price: [
      20,
      4
    ]
  }
)
puts response

response = client.index(
  body: {
    query: {
      term: {
        product: 'chocolate'
      }
    },
    sort: [
      {
        price: {
          order: 'asc',
          mode: 'avg'
        }
      }
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">{
	res, err := es.Index(
		"my-index-000001",
		strings.NewReader(`{
	  "product": "chocolate",
	  "price": [
	    20,
	    4
	  ]
	}`),
		es.Index.WithDocumentID("1"),
		es.Index.WithRefresh("true"),
		es.Index.WithPretty(),
	)
	fmt.Println(res, err)
}

{
	res, err := es.Search(
		es.Search.WithBody(strings.NewReader(`{
	  "query": {
	    "term": {
	      "product": "chocolate"
	    }
	  },
	  "sort": [
	    {
	      "price": {
	        "order": "asc",
	        "mode": "avg"
	      }
	    }
	  ]
	}`)),
		es.Search.WithPretty(),
	)
	fmt.Println(res, err)
}</pre>
</div>
<a id="fe3a927d868cbc530e08e05964d5174a"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">PUT /my-index-000001/_doc/1?refresh
{
   "product": "chocolate",
   "price": [20, 4]
}

POST /_search
{
   "query" : {
      "term" : { "product" : "chocolate" }
   },
   "sort" : [
      {"price" : {"order" : "asc", "mode" : "avg"}}
   ]
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/735.console"></div>
<h3><a id="_sorting_numeric_fields"></a>Sorting numeric fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>For numeric fields it is also possible to cast the values from one type
to another using the <code class="literal">numeric_type</code> option.
This option accepts the following values: [<code class="literal">"double", "long", "date", "date_nanos"</code>]
and can be useful for searches across multiple data streams or indices where the sort field is mapped differently.</p>
<p>Consider for instance these two indices:</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'index_double',
  body: {
    mappings: {
      properties: {
        field: {
          type: 'double'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Indices.Create(
	"index_double",
	es.Indices.Create.WithBody(strings.NewReader(`{
	  "mappings": {
	    "properties": {
	      "field": {
	        "type": "double"
	      }
	    }
	  }
	}`)),
)
fmt.Println(res, err)</pre>
</div>
<a id="44dfac5bc3131014e2c6bb1ebc76b33d"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">PUT /index_double
{
  "mappings": {
    "properties": {
      "field": { "type": "double" }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/736.console"></div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'index_long',
  body: {
    mappings: {
      properties: {
        field: {
          type: 'long'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Indices.Create(
	"index_long",
	es.Indices.Create.WithBody(strings.NewReader(`{
	  "mappings": {
	    "properties": {
	      "field": {
	        "type": "long"
	      }
	    }
	  }
	}`)),
)
fmt.Println(res, err)</pre>
</div>
<a id="532ddf9afdcd0b1c9c0bb331e74d8df3"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">PUT /index_long
{
  "mappings": {
    "properties": {
      "field": { "type": "long" }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/737.console"></div>
<p>Since <code class="literal">field</code> is mapped as a <code class="literal">double</code> in the first index and as a <code class="literal">long</code>
in the second index, it is not possible to use this field to sort requests
that query both indices by default. However you can force the type to one
or the other with the <code class="literal">numeric_type</code> option in order to force a specific
type for all indices:</p>
<div class="pre_wrapper lang-php alternative">
<pre class="programlisting prettyprint lang-php alternative">$params = [
    'index' =&gt; 'index_long,index_double',
    'body' =&gt; [
        'sort' =&gt; [
            [
                'field' =&gt; [
                    'numeric_type' =&gt; 'double',
                ],
            ],
        ],
    ],
];
$response = $client-&gt;search($params);</pre>
</div>
<div class="pre_wrapper lang-csharp alternative">
<pre class="programlisting prettyprint lang-csharp alternative">var searchResponse = client.Search&lt;object&gt;(s =&gt; s
    .Index(new[] { "index_long", "index_double" })
    .Sort(so =&gt; so
        .Field(f =&gt; f
            .Field("field")
            .NumericType(NumericType.Double)
        )
    )
);</pre>
</div>
<div class="pre_wrapper lang-python alternative">
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index=["index_long", "index_double"],
    body={"sort": [{"field": {"numeric_type": "double"}}]},
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  index: 'index_long,index_double',
  body: {
    sort: [
      {
        field: {
          numeric_type: 'double'
        }
      }
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithIndex("index_long,index_double"),
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "field": {
	        "numeric_type": "double"
	      }
	    }
	  ]
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: 'index_long,index_double',
  body: {
    sort: [
      {
        field: {
          numeric_type: 'double'
        }
      }
    ]
  }
})
console.log(response)</pre>
</div>
<a id="2891aa10ee9d474780adf94d5607f2db"></a>
<div class="pre_wrapper lang-console default has-php has-csharp has-python has-ruby has-go has-js">
<pre class="programlisting prettyprint lang-console default has-php has-csharp has-python has-ruby has-go has-js">POST /index_long,index_double/_search
{
   "sort" : [
      {
        "field" : {
            "numeric_type" : "double"
        }
      }
   ]
}</pre>
</div>
<div class="console_widget has-php has-csharp has-python has-ruby has-go has-js" data-snippet="snippets/738.console"></div>
<p>In the example above, values for the <code class="literal">index_long</code> index are casted to
a double in order to be compatible with the values produced by the
<code class="literal">index_double</code> index.
It is also possible to transform a floating point field into a <code class="literal">long</code>
but note that in this case floating points are replaced by the largest
value that is less than or equal (greater than or equal if the value
is negative) to the argument and is equal to a mathematical integer.</p>
<p>This option can also be used to convert a <code class="literal">date</code> field that uses millisecond
resolution to a <code class="literal">date_nanos</code> field with nanosecond resolution.
Consider for instance these two indices:</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'index_double',
  body: {
    mappings: {
      properties: {
        field: {
          type: 'date'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Indices.Create(
	"index_double",
	es.Indices.Create.WithBody(strings.NewReader(`{
	  "mappings": {
	    "properties": {
	      "field": {
	        "type": "date"
	      }
	    }
	  }
	}`)),
)
fmt.Println(res, err)</pre>
</div>
<a id="3bc872dbcdad8ff02cbaea39e7f38352"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">PUT /index_double
{
  "mappings": {
    "properties": {
      "field": { "type": "date" }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/739.console"></div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'index_long',
  body: {
    mappings: {
      properties: {
        field: {
          type: 'date_nanos'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Indices.Create(
	"index_long",
	es.Indices.Create.WithBody(strings.NewReader(`{
	  "mappings": {
	    "properties": {
	      "field": {
	        "type": "date_nanos"
	      }
	    }
	  }
	}`)),
)
fmt.Println(res, err)</pre>
</div>
<a id="69d5710bdec73041c66f21d5f96637e8"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">PUT /index_long
{
  "mappings": {
    "properties": {
      "field": { "type": "date_nanos" }
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/740.console"></div>
<p>Values in these indices are stored with different resolutions so sorting on these
fields will always sort the <code class="literal">date</code> before the <code class="literal">date_nanos</code> (ascending order).
With the <code class="literal">numeric_type</code> type option it is possible to set a single resolution for
the sort, setting to <code class="literal">date</code> will convert the <code class="literal">date_nanos</code> to the millisecond resolution
while <code class="literal">date_nanos</code> will convert the values in the <code class="literal">date</code> field to the nanoseconds resolution:</p>
<div class="pre_wrapper lang-php alternative">
<pre class="programlisting prettyprint lang-php alternative">$params = [
    'index' =&gt; 'index_long,index_double',
    'body' =&gt; [
        'sort' =&gt; [
            [
                'field' =&gt; [
                    'numeric_type' =&gt; 'date_nanos',
                ],
            ],
        ],
    ],
];
$response = $client-&gt;search($params);</pre>
</div>
<div class="pre_wrapper lang-csharp alternative">
<pre class="programlisting prettyprint lang-csharp alternative">var searchResponse = client.Search&lt;object&gt;(s =&gt; s
    .Index(new[] { "index_long", "index_double" })
    .Sort(so =&gt; so
        .Field(f =&gt; f
            .Field("field")
            .NumericType(NumericType.DateNanos)
        )
    )
);</pre>
</div>
<div class="pre_wrapper lang-python alternative">
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    index=["index_long", "index_double"],
    body={"sort": [{"field": {"numeric_type": "date_nanos"}}]},
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  index: 'index_long,index_double',
  body: {
    sort: [
      {
        field: {
          numeric_type: 'date_nanos'
        }
      }
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithIndex("index_long,index_double"),
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "field": {
	        "numeric_type": "date_nanos"
	      }
	    }
	  ]
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  index: 'index_long,index_double',
  body: {
    sort: [
      {
        field: {
          numeric_type: 'date_nanos'
        }
      }
    ]
  }
})
console.log(response)</pre>
</div>
<a id="5f3549ac7fee94682ca0d7439eebdd2a"></a>
<div class="pre_wrapper lang-console default has-php has-csharp has-python has-ruby has-go has-js">
<pre class="programlisting prettyprint lang-console default has-php has-csharp has-python has-ruby has-go has-js">POST /index_long,index_double/_search
{
   "sort" : [
      {
        "field" : {
            "numeric_type" : "date_nanos"
        }
      }
   ]
}</pre>
</div>
<div class="console_widget has-php has-csharp has-python has-ruby has-go has-js" data-snippet="snippets/741.console"></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>To avoid overflow, the conversion to <code class="literal">date_nanos</code> cannot be applied on dates before
1970 and after 2262 as nanoseconds are represented as longs.</p>
</div>
</div>
<h3><a id="nested-sorting"></a>Sorting within nested objects.<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>Elasticsearch also supports sorting by
fields that are inside one or more nested objects. The sorting by nested
field support has a <code class="literal">nested</code> sort option with the following properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">path</code>
</span>
</dt>
<dd>
Defines on which nested object to sort. The actual
sort field must be a direct field inside this nested object.
When sorting by nested field, this field is mandatory.
</dd>
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
A filter that the inner objects inside the nested path
should match with in order for its field values to be taken into account
by sorting. Common case is to repeat the query / filter inside the
nested filter or query. By default no <code class="literal">filter</code> is active.
</dd>
<dt>
<span class="term">
<code class="literal">max_children</code>
</span>
</dt>
<dd>
The maximum number of children to consider per root document
when picking the sort value. Defaults to unlimited.
</dd>
<dt>
<span class="term">
<code class="literal">nested</code>
</span>
</dt>
<dd>
Same as top-level <code class="literal">nested</code> but applies to another nested path within the
current nested object.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elasticsearch will throw an error if a nested field is defined in a sort without
a <code class="literal">nested</code> context.</p>
</div>
</div>
<h4><a id="_nested_sorting_examples"></a>Nested sorting examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h4>
<p>In the below example <code class="literal">offer</code> is a field of type <code class="literal">nested</code>.
The nested <code class="literal">path</code> needs to be specified; otherwise, Elasticsearch doesn&#8217;t know on what nested level sort values need to be captured.</p>
<div class="pre_wrapper lang-php alternative">
<pre class="programlisting prettyprint lang-php alternative">$params = [
    'body' =&gt; [
        'query' =&gt; [
            'term' =&gt; [
                'product' =&gt; 'chocolate',
            ],
        ],
        'sort' =&gt; [
            [
                'offer.price' =&gt; [
                    'mode' =&gt; 'avg',
                    'order' =&gt; 'asc',
                    'nested' =&gt; [
                        'path' =&gt; 'offer',
                        'filter' =&gt; [
                            'term' =&gt; [
                                'offer.color' =&gt; 'blue',
                            ],
                        ],
                    ],
                ],
            ],
        ],
    ],
];
$response = $client-&gt;search($params);</pre>
</div>
<div class="pre_wrapper lang-csharp alternative">
<pre class="programlisting prettyprint lang-csharp alternative">var searchResponse = client.Search&lt;object&gt;(s =&gt; s
    .AllIndices()
    .Query(q =&gt; q
        .Term(t =&gt; t
            .Field("product")
            .Value("chocolate")
        )
    )
    .Sort(so =&gt; so
        .Field(f =&gt; f
            .Field("offer.price")
            .Mode(SortMode.Average)
            .Order(SortOrder.Ascending)
            .Nested(ns =&gt; ns
                .Path("offer")
                .Filter(nf =&gt; nf
                    .Term(tf =&gt; tf
                        .Field("offer.color")
                        .Value("blue")
                    )
                )
            )
        )
    )
);</pre>
</div>
<div class="pre_wrapper lang-python alternative">
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    body={
        "query": {"term": {"product": "chocolate"}},
        "sort": [
            {
                "offer.price": {
                    "mode": "avg",
                    "order": "asc",
                    "nested": {
                        "path": "offer",
                        "filter": {"term": {"offer.color": "blue"}},
                    },
                }
            }
        ],
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    query: {
      term: {
        product: 'chocolate'
      }
    },
    sort: [
      {
        "offer.price": {
          mode: 'avg',
          order: 'asc',
          nested: {
            path: 'offer',
            filter: {
              term: {
                "offer.color": 'blue'
              }
            }
          }
        }
      }
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "query": {
	    "term": {
	      "product": "chocolate"
	    }
	  },
	  "sort": [
	    {
	      "offer.price": {
	        "mode": "avg",
	        "order": "asc",
	        "nested": {
	          "path": "offer",
	          "filter": {
	            "term": {
	              "offer.color": "blue"
	            }
	          }
	        }
	      }
	    }
	  ]
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  body: {
    query: {
      term: {
        product: 'chocolate'
      }
    },
    sort: [
      {
        'offer.price': {
          mode: 'avg',
          order: 'asc',
          nested: {
            path: 'offer',
            filter: {
              term: {
                'offer.color': 'blue'
              }
            }
          }
        }
      }
    ]
  }
})
console.log(response)</pre>
</div>
<a id="de139866a220124360e5e27d1a736ea4"></a>
<div class="pre_wrapper lang-console default has-php has-csharp has-python has-ruby has-go has-js">
<pre class="programlisting prettyprint lang-console default has-php has-csharp has-python has-ruby has-go has-js">POST /_search
{
   "query" : {
      "term" : { "product" : "chocolate" }
   },
   "sort" : [
       {
          "offer.price" : {
             "mode" :  "avg",
             "order" : "asc",
             "nested": {
                "path": "offer",
                "filter": {
                   "term" : { "offer.color" : "blue" }
                }
             }
          }
       }
    ]
}</pre>
</div>
<div class="console_widget has-php has-csharp has-python has-ruby has-go has-js" data-snippet="snippets/742.console"></div>
<p>In the below example <code class="literal">parent</code> and <code class="literal">child</code> fields are of type <code class="literal">nested</code>.
The <code class="literal">nested.path</code> needs to be specified at each level; otherwise, Elasticsearch doesn&#8217;t know on what nested level sort values need to be captured.</p>
<div class="pre_wrapper lang-php alternative">
<pre class="programlisting prettyprint lang-php alternative">$params = [
    'body' =&gt; [
        'query' =&gt; [
            'nested' =&gt; [
                'path' =&gt; 'parent',
                'query' =&gt; [
                    'bool' =&gt; [
                        'must' =&gt; [
                            'range' =&gt; [
                                'parent.age' =&gt; [
                                    'gte' =&gt; 21,
                                ],
                            ],
                        ],
                        'filter' =&gt; [
                            'nested' =&gt; [
                                'path' =&gt; 'parent.child',
                                'query' =&gt; [
                                    'match' =&gt; [
                                        'parent.child.name' =&gt; 'matt',
                                    ],
                                ],
                            ],
                        ],
                    ],
                ],
            ],
        ],
        'sort' =&gt; [
            [
                'parent.child.age' =&gt; [
                    'mode' =&gt; 'min',
                    'order' =&gt; 'asc',
                    'nested' =&gt; [
                        'path' =&gt; 'parent',
                        'filter' =&gt; [
                            'range' =&gt; [
                                'parent.age' =&gt; [
                                    'gte' =&gt; 21,
                                ],
                            ],
                        ],
                        'nested' =&gt; [
                            'path' =&gt; 'parent.child',
                            'filter' =&gt; [
                                'match' =&gt; [
                                    'parent.child.name' =&gt; 'matt',
                                ],
                            ],
                        ],
                    ],
                ],
            ],
        ],
    ],
];
$response = $client-&gt;search($params);</pre>
</div>
<div class="pre_wrapper lang-csharp alternative">
<pre class="programlisting prettyprint lang-csharp alternative">var searchResponse = client.Search&lt;object&gt;(s =&gt; s
    .AllIndices()
    .Query(q =&gt; q
        .Nested(n =&gt; n
            .Path("parent")
            .Query(nq =&gt; nq
                .LongRange(r =&gt; r
                    .Field("parent.age")
                    .GreaterThanOrEquals(21)
                ) &amp;&amp; +nq
                .Nested(nn =&gt; nn
                    .Path("parent.child")
                    .Query(nnq =&gt; nnq
                        .Match(m =&gt; m
                            .Field("parent.child.name")
                            .Query("matt")
                        )
                    )
                )
            )
        )
    )
    .Sort(so =&gt; so
        .Field(f =&gt; f
            .Field("parent.child.age")
            .Mode(SortMode.Min)
            .Order(SortOrder.Ascending)
            .Nested(ns =&gt; ns
                .Path("parent")
                .Filter(nf =&gt; nf
                    .LongRange(tf =&gt; tf
                        .Field("parent.age")
                        .GreaterThanOrEquals(21)
                    )
                )
                .Nested(nns =&gt; nns
                    .Path("parent.child")
                    .Filter(nnf =&gt; nnf
                        .Match(m =&gt; m
                            .Field("parent.child.name")
                            .Query("matt")
                        )
                    )
                )
            )
        )
    )
);</pre>
</div>
<div class="pre_wrapper lang-python alternative">
<pre class="programlisting prettyprint lang-python alternative">resp = client.search(
    body={
        "query": {
            "nested": {
                "path": "parent",
                "query": {
                    "bool": {
                        "must": {"range": {"parent.age": {"gte": 21}}},
                        "filter": {
                            "nested": {
                                "path": "parent.child",
                                "query": {
                                    "match": {"parent.child.name": "matt"}
                                },
                            }
                        },
                    }
                },
            }
        },
        "sort": [
            {
                "parent.child.age": {
                    "mode": "min",
                    "order": "asc",
                    "nested": {
                        "path": "parent",
                        "filter": {"range": {"parent.age": {"gte": 21}}},
                        "nested": {
                            "path": "parent.child",
                            "filter": {
                                "match": {"parent.child.name": "matt"}
                            },
                        },
                    },
                }
            }
        ],
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    query: {
      nested: {
        path: 'parent',
        query: {
          bool: {
            must: {
              range: {
                "parent.age": {
                  gte: 21
                }
              }
            },
            filter: {
              nested: {
                path: 'parent.child',
                query: {
                  match: {
                    "parent.child.name": 'matt'
                  }
                }
              }
            }
          }
        }
      }
    },
    sort: [
      {
        "parent.child.age": {
          mode: 'min',
          order: 'asc',
          nested: {
            path: 'parent',
            filter: {
              range: {
                "parent.age": {
                  gte: 21
                }
              }
            },
            nested: {
              path: 'parent.child',
              filter: {
                match: {
                  "parent.child.name": 'matt'
                }
              }
            }
          }
        }
      }
    ]
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "query": {
	    "nested": {
	      "path": "parent",
	      "query": {
	        "bool": {
	          "must": {
	            "range": {
	              "parent.age": {
	                "gte": 21
	              }
	            }
	          },
	          "filter": {
	            "nested": {
	              "path": "parent.child",
	              "query": {
	                "match": {
	                  "parent.child.name": "matt"
	                }
	              }
	            }
	          }
	        }
	      }
	    }
	  },
	  "sort": [
	    {
	      "parent.child.age": {
	        "mode": "min",
	        "order": "asc",
	        "nested": {
	          "path": "parent",
	          "filter": {
	            "range": {
	              "parent.age": {
	                "gte": 21
	              }
	            }
	          },
	          "nested": {
	            "path": "parent.child",
	            "filter": {
	              "match": {
	                "parent.child.name": "matt"
	              }
	            }
	          }
	        }
	      }
	    }
	  ]
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<pre class="programlisting prettyprint lang-js alternative">const response = await client.search({
  body: {
    query: {
      nested: {
        path: 'parent',
        query: {
          bool: {
            must: {
              range: {
                'parent.age': {
                  gte: 21
                }
              }
            },
            filter: {
              nested: {
                path: 'parent.child',
                query: {
                  match: {
                    'parent.child.name': 'matt'
                  }
                }
              }
            }
          }
        }
      }
    },
    sort: [
      {
        'parent.child.age': {
          mode: 'min',
          order: 'asc',
          nested: {
            path: 'parent',
            filter: {
              range: {
                'parent.age': {
                  gte: 21
                }
              }
            },
            nested: {
              path: 'parent.child',
              filter: {
                match: {
                  'parent.child.name': 'matt'
                }
              }
            }
          }
        }
      }
    ]
  }
})
console.log(response)</pre>
</div>
<a id="22334f4b24bb8977d3e1bf2ffdc29d3f"></a>
<div class="pre_wrapper lang-console default has-php has-csharp has-python has-ruby has-go has-js">
<pre class="programlisting prettyprint lang-console default has-php has-csharp has-python has-ruby has-go has-js">POST /_search
{
   "query": {
      "nested": {
         "path": "parent",
         "query": {
            "bool": {
                "must": {"range": {"parent.age": {"gte": 21}}},
                "filter": {
                    "nested": {
                        "path": "parent.child",
                        "query": {"match": {"parent.child.name": "matt"}}
                    }
                }
            }
         }
      }
   },
   "sort" : [
      {
         "parent.child.age" : {
            "mode" :  "min",
            "order" : "asc",
            "nested": {
               "path": "parent",
               "filter": {
                  "range": {"parent.age": {"gte": 21}}
               },
               "nested": {
                  "path": "parent.child",
                  "filter": {
                     "match": {"parent.child.name": "matt"}
                  }
               }
            }
         }
      }
   ]
}</pre>
</div>
<div class="console_widget has-php has-csharp has-python has-ruby has-go has-js" data-snippet="snippets/743.console"></div>
<p>Nested sorting is also supported when sorting by
scripts and sorting by geo distance.</p>
<h3><a id="_missing_values"></a>Missing Values<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>The <code class="literal">missing</code> parameter specifies how docs which are missing
the sort field should be treated: The <code class="literal">missing</code> value can be
set to <code class="literal">_last</code>, <code class="literal">_first</code>, or a custom value (that
will be used for missing docs as the sort value).
The default is <code class="literal">_last</code>.</p>
<p>For example:</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    sort: [
      {
        price: {
          missing: '_last'
        }
      }
    ],
    query: {
      term: {
        product: 'chocolate'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "price": {
	        "missing": "_last"
	      }
	    }
	  ],
	  "query": {
	    "term": {
	      "product": "chocolate"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="b607eea422295a3e9acd75f9ed1c8cb7"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "sort" : [
    { "price" : {"missing" : "_last"} }
  ],
  "query" : {
    "term" : { "product" : "chocolate" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/744.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a nested inner object doesn&#8217;t match with
the <code class="literal">nested.filter</code> then a missing value is used.</p>
</div>
</div>
<h3><a id="_ignoring_unmapped_fields"></a>Ignoring Unmapped Fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>By default, the search request will fail if there is no mapping
associated with a field. The <code class="literal">unmapped_type</code> option allows you to ignore
fields that have no mapping and not sort by them. The value of this
parameter is used to determine what sort values to emit. Here is an
example of how it can be used:</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    sort: [
      {
        price: {
          unmapped_type: 'long'
        }
      }
    ],
    query: {
      term: {
        product: 'chocolate'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "price": {
	        "unmapped_type": "long"
	      }
	    }
	  ],
	  "query": {
	    "term": {
	      "product": "chocolate"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="0bcd380315ef4691b8c79df6ca53a85f"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "sort" : [
    { "price" : {"unmapped_type" : "long"} }
  ],
  "query" : {
    "term" : { "product" : "chocolate" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/745.console"></div>
<p>If any of the indices that are queried doesn&#8217;t have a mapping for <code class="literal">price</code>
then Elasticsearch will handle it as if there was a mapping of type
<code class="literal">long</code>, with all documents in this index having no value for this field.</p>
<h3><a id="geo-sorting"></a>Geo Distance Sorting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>Allow to sort by <code class="literal">_geo_distance</code>. Here is an example, assuming <code class="literal">pin.location</code> is a field of type <code class="literal">geo_point</code>:</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    sort: [
      {
        _geo_distance: {
          "pin.location": [
            -70,
            40
          ],
          order: 'asc',
          unit: 'km',
          mode: 'min',
          distance_type: 'arc',
          ignore_unmapped: true
        }
      }
    ],
    query: {
      term: {
        user: 'kimchy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "_geo_distance": {
	        "pin.location": [
	          -70,
	          40
	        ],
	        "order": "asc",
	        "unit": "km",
	        "mode": "min",
	        "distance_type": "arc",
	        "ignore_unmapped": true
	      }
	    }
	  ],
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="fbb38243221c8fb311660616e3add9ce"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "sort" : [
    {
      "_geo_distance" : {
          "pin.location" : [-70, 40],
          "order" : "asc",
          "unit" : "km",
          "mode" : "min",
          "distance_type" : "arc",
          "ignore_unmapped": true
      }
    }
  ],
  "query" : {
    "term" : { "user" : "kimchy" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/746.console"></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">distance_type</code>
</span>
</dt>
<dd>
How to compute the distance. Can either be <code class="literal">arc</code> (default), or <code class="literal">plane</code> (faster, but inaccurate on long distances and close to the poles).
</dd>
<dt>
<span class="term">
<code class="literal">mode</code>
</span>
</dt>
<dd>
What to do in case a field has several geo points. By default, the shortest
distance is taken into account when sorting in ascending order and the
longest distance when sorting in descending order. Supported values are
<code class="literal">min</code>, <code class="literal">max</code>, <code class="literal">median</code> and <code class="literal">avg</code>.
</dd>
<dt>
<span class="term">
<code class="literal">unit</code>
</span>
</dt>
<dd>
The unit to use when computing sort values. The default is <code class="literal">m</code> (meters).
</dd>
<dt>
<span class="term">
<code class="literal">ignore_unmapped</code>
</span>
</dt>
<dd>
Indicates if the unmapped field should be treated as a missing value. Setting it to <code class="literal">true</code> is equivalent to specifying
an <code class="literal">unmapped_type</code> in the field sort. The default is <code class="literal">false</code> (unmapped field cause the search to fail).
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>geo distance sorting does not support configurable missing values: the
distance will always be considered equal to <code class="literal">Infinity</code> when a document does not
have values for the field that is used for distance computation.</p>
</div>
</div>
<p>The following formats are supported in providing the coordinates:</p>
<h4><a id="_lat_lon_as_properties"></a>Lat Lon as Properties<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    sort: [
      {
        _geo_distance: {
          "pin.location": {
            lat: 40,
            lon: -70
          },
          order: 'asc',
          unit: 'km'
        }
      }
    ],
    query: {
      term: {
        user: 'kimchy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "_geo_distance": {
	        "pin.location": {
	          "lat": 40,
	          "lon": -70
	        },
	        "order": "asc",
	        "unit": "km"
	      }
	    }
	  ],
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="edae616e1244babf6032aecc6aaaf836"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "sort" : [
    {
      "_geo_distance" : {
        "pin.location" : {
          "lat" : 40,
          "lon" : -70
        },
        "order" : "asc",
        "unit" : "km"
      }
    }
  ],
  "query" : {
    "term" : { "user" : "kimchy" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/747.console"></div>
<h4><a id="_lat_lon_as_string"></a>Lat Lon as String<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h4>
<p>Format in <code class="literal">lat,lon</code>.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    sort: [
      {
        _geo_distance: {
          "pin.location": '40,-70',
          order: 'asc',
          unit: 'km'
        }
      }
    ],
    query: {
      term: {
        user: 'kimchy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "_geo_distance": {
	        "pin.location": "40,-70",
	        "order": "asc",
	        "unit": "km"
	      }
	    }
	  ],
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="8552f4f3bfd69515b883ff43888a199b"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "sort": [
    {
      "_geo_distance": {
        "pin.location": "40,-70",
        "order": "asc",
        "unit": "km"
      }
    }
  ],
  "query": {
    "term": { "user": "kimchy" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/748.console"></div>
<h4><a id="_geohash"></a>Geohash<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    sort: [
      {
        _geo_distance: {
          "pin.location": 'drm3btev3e86',
          order: 'asc',
          unit: 'km'
        }
      }
    ],
    query: {
      term: {
        user: 'kimchy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "_geo_distance": {
	        "pin.location": "drm3btev3e86",
	        "order": "asc",
	        "unit": "km"
	      }
	    }
	  ],
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="9beb260834f8cfb240f6308950dbb9c2"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "sort": [
    {
      "_geo_distance": {
        "pin.location": "drm3btev3e86",
        "order": "asc",
        "unit": "km"
      }
    }
  ],
  "query": {
    "term": { "user": "kimchy" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/749.console"></div>
<h4><a id="_lat_lon_as_array"></a>Lat Lon as Array<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h4>
<p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a href="http://geojson.org/" class="ulink" target="_top">GeoJSON</a>.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    sort: [
      {
        _geo_distance: {
          "pin.location": [
            -70,
            40
          ],
          order: 'asc',
          unit: 'km'
        }
      }
    ],
    query: {
      term: {
        user: 'kimchy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "_geo_distance": {
	        "pin.location": [
	          -70,
	          40
	        ],
	        "order": "asc",
	        "unit": "km"
	      }
	    }
	  ],
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="aee4734ee63dbbbd12a21ee886f7a829"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "sort": [
    {
      "_geo_distance": {
        "pin.location": [ -70, 40 ],
        "order": "asc",
        "unit": "km"
      }
    }
  ],
  "query": {
    "term": { "user": "kimchy" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/750.console"></div>
<h3><a id="_multiple_reference_points"></a>Multiple reference points<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>Multiple geo points can be passed as an array containing any <code class="literal">geo_point</code> format, for example</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    sort: [
      {
        _geo_distance: {
          "pin.location": [
            [
              -70,
              40
            ],
            [
              -71,
              42
            ]
          ],
          order: 'asc',
          unit: 'km'
        }
      }
    ],
    query: {
      term: {
        user: 'kimchy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "sort": [
	    {
	      "_geo_distance": {
	        "pin.location": [
	          [
	            -70,
	            40
	          ],
	          [
	            -71,
	            42
	          ]
	        ],
	        "order": "asc",
	        "unit": "km"
	      }
	    }
	  ],
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="0f2e5e006b663a88ee99b130ab1b4844"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "sort": [
    {
      "_geo_distance": {
        "pin.location": [ [ -70, 40 ], [ -71, 42 ] ],
        "order": "asc",
        "unit": "km"
      }
    }
  ],
  "query": {
    "term": { "user": "kimchy" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/751.console"></div>
<p>and so forth.</p>
<p>The final distance for a document will then be <code class="literal">min</code>/<code class="literal">max</code>/<code class="literal">avg</code> (defined via <code class="literal">mode</code>) distance of all points contained in the document to all points given in the sort request.</p>
<h3><a id="_script_based_sorting"></a>Script Based Sorting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>Allow to sort based on custom scripts, here is an example:</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    query: {
      term: {
        user: 'kimchy'
      }
    },
    sort: {
      _script: {
        type: 'number',
        script: {
          lang: 'painless',
          source: "doc['field_name'].value * params.factor",
          params: {
            factor: 1.1
          }
        },
        order: 'asc'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  },
	  "sort": {
	    "_script": {
	      "type": "number",
	      "script": {
	        "lang": "painless",
	        "source": "doc['field_name'].value * params.factor",
	        "params": {
	          "factor": 1.1
	        }
	      },
	      "order": "asc"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="666c420fe61fa122386da3c356a64943"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "query": {
    "term": { "user": "kimchy" }
  },
  "sort": {
    "_script": {
      "type": "number",
      "script": {
        "lang": "painless",
        "source": "doc['field_name'].value * params.factor",
        "params": {
          "factor": 1.1
        }
      },
      "order": "asc"
    }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/752.console"></div>
<h3><a id="_track_scores"></a>Track Scores<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>When sorting on a field, scores are not computed. By setting
<code class="literal">track_scores</code> to true, scores will still be computed and tracked.</p>
<div class="pre_wrapper lang-ruby alternative">
<pre class="programlisting prettyprint lang-ruby alternative">response = client.search(
  body: {
    track_scores: true,
    sort: [
      {
        post_date: {
          order: 'desc'
        }
      },
      {
        name: 'desc'
      },
      {
        age: 'desc'
      }
    ],
    query: {
      term: {
        user: 'kimchy'
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-go alternative">
<pre class="programlisting prettyprint lang-go alternative">res, err := es.Search(
	es.Search.WithBody(strings.NewReader(`{
	  "track_scores": true,
	  "sort": [
	    {
	      "post_date": {
	        "order": "desc"
	      }
	    },
	    {
	      "name": "desc"
	    },
	    {
	      "age": "desc"
	    }
	  ],
	  "query": {
	    "term": {
	      "user": "kimchy"
	    }
	  }
	}`)),
	es.Search.WithPretty(),
)
fmt.Println(res, err)</pre>
</div>
<a id="acb10091ad335ddd15d71021aaf23c62"></a>
<div class="pre_wrapper lang-console default has-ruby has-go">
<pre class="programlisting prettyprint lang-console default has-ruby has-go">GET /_search
{
  "track_scores": true,
  "sort" : [
    { "post_date" : {"order" : "desc"} },
    { "name" : "desc" },
    { "age" : "desc" }
  ],
  "query" : {
    "term" : { "user" : "kimchy" }
  }
}</pre>
</div>
<div class="console_widget has-ruby has-go" data-snippet="snippets/753.console"></div>
<h3><a id="_memory_considerations"></a>Memory Considerations<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/search-your-data/sort-search-results.asciidoc">edit</a></h3>
<p>When sorting, the relevant sorted field values are loaded into memory.
This means that per shard, there should be enough memory to contain
them. For string based types, the field sorted on should not be analyzed
/ tokenized. For numeric types, if possible, it is recommended to
explicitly set the type to narrower types (like <code class="literal">short</code>, <code class="literal">integer</code> and
<code class="literal">float</code>).</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="search-shard-routing.html">« Search shard routing</a>
</span>
<span class="next">
<a href="query-dsl.html">Query DSL »</a>
</span>
</div>
</div>
</body>
</html>
