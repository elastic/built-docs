<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sparse vector field type | Elasticsearch Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Sparse vector field type | Elasticsearch Guide [master]">

<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="mapping-types.html" title="Field data types"/>
<link rel="prev" href="shape.html" title="Shape field type"/>
<link rel="next" href="text.html" title="Text type family"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Elasticsearch"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="shape.html">« Shape field type</a>
</span>
<span class="next">
<a href="text.html">Text type family »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="mapping-types.html">Field data types</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Sparse vector field type</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/sparse-vector.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="sparse-vector"></a>Sparse vector field type</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/sparse-vector.asciidoc">edit</a></div>
</div></div></div>

<p>A <code class="literal">sparse_vector</code> field can index features and weights so that they can later be used to query documents in queries with a <a class="xref" href="query-dsl-sparse-vector-query.html" title="Sparse vector query"><code class="literal">sparse_vector</code></a>.
This field can also be used with a legacy <a class="xref" href="query-dsl-text-expansion-query.html" title="Text expansion query"><code class="literal">text_expansion</code></a> query.</p>
<p><code class="literal">sparse_vector</code> is the field type that should be used with <a class="xref" href="semantic-search-elser.html#elser-mappings" title="Create the index mapping">ELSER mappings</a>.</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="my-index",
    mappings={
        "properties": {
            "text.tokens": {
                "type": "sparse_vector"
            }
        }
    },
)
print(resp)</pre>
</div>
<div class="pre_wrapper lang-ruby alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby alternative">response = client.indices.create(
  index: 'my-index',
  body: {
    mappings: {
      properties: {
        'text.tokens' =&gt; {
          type: 'sparse_vector'
        }
      }
    }
  }
)
puts response</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "my-index",
  mappings: {
    properties: {
      "text.tokens": {
        type: "sparse_vector",
      },
    },
  },
});
console.log(response);</pre>
</div>
<a id="7011fcdd231804f9c3894154ae2c3fbc"></a>
<div class="pre_wrapper lang-console default has-python has-ruby has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-ruby has-js">PUT my-index
{
  "mappings": {
    "properties": {
      "text.tokens": {
        "type": "sparse_vector"
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-ruby has-js" data-snippet="snippets/324.console"></div>
<p>See <a class="xref" href="semantic-search-elser.html" title="Tutorial: semantic search with ELSER">semantic search with ELSER</a> for a complete example on adding documents to a <code class="literal">sparse_vector</code> mapped field using ELSER.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="index-multi-value-sparse-vectors"></a>Multi-value sparse vectors</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/main/docs/reference/mapping/types/sparse-vector.asciidoc">edit</a></div>
</div></div></div>
<p>When passing in arrays of values for sparse vectors the max value for similarly named features is selected.</p>
<p>The paper Adapting Learned Sparse Retrieval for Long Documents (<a href="https://arxiv.org/pdf/2305.18494.pdf" class="ulink" target="_top">https://arxiv.org/pdf/2305.18494.pdf</a>) discusses this in more detail.
In summary, research findings support representation aggregation typically outperforming score aggregation.</p>
<p>For instances where you want to have overlapping feature names use should store them separately or use nested fields.</p>
<p>Below is an example of passing in a document with overlapping feature names.
Consider that in this example two categories exist for positive sentiment and negative sentiment.
However, for the purposes of retrieval we also want the overall impact rather than specific sentiment.
In the example <code class="literal">impact</code> is stored as a multi-value sparse vector and only the max values of overlapping names are stored.
More specifically the final <code class="literal">GET</code> query here returns a <code class="literal">_score</code> of ~1.2 (which is the <code class="literal">max(impact.delicious[0], impact.delicious[1])</code> and is approximate because we have a relative error of 0.4% as explained below)</p>
<div class="pre_wrapper lang-python alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python alternative">resp = client.indices.create(
    index="my-index-000001",
    mappings={
        "properties": {
            "text": {
                "type": "text",
                "analyzer": "standard"
            },
            "impact": {
                "type": "sparse_vector"
            },
            "positive": {
                "type": "sparse_vector"
            },
            "negative": {
                "type": "sparse_vector"
            }
        }
    },
)
print(resp)

resp1 = client.index(
    index="my-index-000001",
    document={
        "text": "I had some terribly delicious carrots.",
        "impact": [
            {
                "I": 0.55,
                "had": 0.4,
                "some": 0.28,
                "terribly": 0.01,
                "delicious": 1.2,
                "carrots": 0.8
            },
            {
                "I": 0.54,
                "had": 0.4,
                "some": 0.28,
                "terribly": 2.01,
                "delicious": 0.02,
                "carrots": 0.4
            }
        ],
        "positive": {
            "I": 0.55,
            "had": 0.4,
            "some": 0.28,
            "terribly": 0.01,
            "delicious": 1.2,
            "carrots": 0.8
        },
        "negative": {
            "I": 0.54,
            "had": 0.4,
            "some": 0.28,
            "terribly": 2.01,
            "delicious": 0.02,
            "carrots": 0.4
        }
    },
)
print(resp1)

resp2 = client.search(
    index="my-index-000001",
    query={
        "term": {
            "impact": {
                "value": "delicious"
            }
        }
    },
)
print(resp2)</pre>
</div>
<div class="pre_wrapper lang-js alternative">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js alternative">const response = await client.indices.create({
  index: "my-index-000001",
  mappings: {
    properties: {
      text: {
        type: "text",
        analyzer: "standard",
      },
      impact: {
        type: "sparse_vector",
      },
      positive: {
        type: "sparse_vector",
      },
      negative: {
        type: "sparse_vector",
      },
    },
  },
});
console.log(response);

const response1 = await client.index({
  index: "my-index-000001",
  document: {
    text: "I had some terribly delicious carrots.",
    impact: [
      {
        I: 0.55,
        had: 0.4,
        some: 0.28,
        terribly: 0.01,
        delicious: 1.2,
        carrots: 0.8,
      },
      {
        I: 0.54,
        had: 0.4,
        some: 0.28,
        terribly: 2.01,
        delicious: 0.02,
        carrots: 0.4,
      },
    ],
    positive: {
      I: 0.55,
      had: 0.4,
      some: 0.28,
      terribly: 0.01,
      delicious: 1.2,
      carrots: 0.8,
    },
    negative: {
      I: 0.54,
      had: 0.4,
      some: 0.28,
      terribly: 2.01,
      delicious: 0.02,
      carrots: 0.4,
    },
  },
});
console.log(response1);

const response2 = await client.search({
  index: "my-index-000001",
  query: {
    term: {
      impact: {
        value: "delicious",
      },
    },
  },
});
console.log(response2);</pre>
</div>
<a id="63ecdab34940af053acc409164914c32"></a>
<div class="pre_wrapper lang-console default has-python has-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console default has-python has-js">PUT my-index-000001
{
  "mappings": {
    "properties": {
      "text": {
        "type": "text",
        "analyzer": "standard"
      },
      "impact": {
        "type": "sparse_vector"
      },
      "positive": {
        "type": "sparse_vector"
      },
      "negative": {
        "type": "sparse_vector"
      }
    }
  }
}

POST my-index-000001/_doc
{
    "text": "I had some terribly delicious carrots.",
    "impact": [{"I": 0.55, "had": 0.4, "some": 0.28, "terribly": 0.01, "delicious": 1.2, "carrots": 0.8},
               {"I": 0.54, "had": 0.4, "some": 0.28, "terribly": 2.01, "delicious": 0.02, "carrots": 0.4}],
    "positive": {"I": 0.55, "had": 0.4, "some": 0.28, "terribly": 0.01, "delicious": 1.2, "carrots": 0.8},
    "negative": {"I": 0.54, "had": 0.4, "some": 0.28, "terribly": 2.01, "delicious": 0.02, "carrots": 0.4}
}

GET my-index-000001/_search
{
  "query": {
    "term": {
      "impact": {
         "value": "delicious"
      }
    }
  }
}</pre>
</div>
<div class="console_widget has-python has-js" data-snippet="snippets/325.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">sparse_vector</code> fields can not be included in indices that were <span class="strong strong"><strong>created</strong></span> on Elasticsearch versions between 8.0 and 8.10</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">sparse_vector</code> fields only support strictly positive values.
Negative values will be rejected.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">sparse_vector</code> fields do not support <a class="xref" href="analysis.html" title="Text analysis">analyzers</a>, querying, sorting or aggregating.
They may only be used within specialized queries.
The recommended query to use on these fields are <a class="xref" href="query-dsl-sparse-vector-query.html" title="Sparse vector query"><code class="literal">sparse_vector</code></a> queries.
They may also be used within legacy <a class="xref" href="query-dsl-text-expansion-query.html" title="Text expansion query"><code class="literal">text_expansion</code></a> queries.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p><code class="literal">sparse_vector</code> fields only preserve 9 significant bits for the precision, which translates to a relative error of about 0.4%.</p>
</div>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="shape.html">« Shape field type</a>
</span>
<span class="next">
<a href="text.html">Text type family »</a>
</span>
</div>
</body>
</html>
