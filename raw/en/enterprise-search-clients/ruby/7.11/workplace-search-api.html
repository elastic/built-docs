<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Workplace Search API | enterprise-search-ruby [7.11] | Elastic</title>
<link rel="home" href="index.html" title="enterprise-search-ruby [7.11]"/>
<link rel="up" href="index.html" title="enterprise-search-ruby [7.11]"/>
<link rel="prev" href="app-search-api.html" title="App Search API"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search Clients/Ruby/7.11"/>
<meta name="DC.subject" content="Enterprise Search Clients"/>
<meta name="DC.identifier" content="7.11"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">enterprise-search-ruby [7.11]</a></span>
»
<span class="breadcrumb-node">Workplace Search API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="app-search-api.html">« App Search API</a>
</span>
<span class="next">
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="workplace-search-api"></a>Workplace Search API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/enterprise-search-ruby/edit/7.11/docs/guide/workplace-search-api.asciidoc">edit</a></h1>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_documents_2"></a>Documents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/enterprise-search-ruby/edit/7.11/docs/guide/workplace-search-api.asciidoc">edit</a></h2>
</div></div></div>
<div class="pre_wrapper lang-rb">
<pre class="programlisting prettyprint lang-rb"># Index Documents
documents = [
  { id: 'e68fbc2688f1', title: 'Frankenstein; Or, The Modern Prometheus', author: 'Mary Wollstonecraft Shelley' },
  { id: '0682bb06af1a', title: 'Jungle Tales', author: 'Horacio Quiroga' },
  { id: '75015d85370d', title: 'Lenguas de diamante', author: 'Juana de Ibarbourou' },
  { id: 'c535e226aee3', title: 'Metamorphosis', author: 'Franz Kafka' }
]

response = client.index_documents(content_source_id, body: documents)

# Delete Documents
response = client.delete_documents(content_source_id, body: ['e68fbc2688f1', 'c535e226aee3'])</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_oauth_authentication"></a>OAuth Authentication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/enterprise-search-ruby/edit/7.11/docs/guide/workplace-search-api.asciidoc">edit</a></h2>
</div></div></div>
<p>You need to configure the OAuth Application for Search in order to use the Workplace Search client&#8217;s <code class="literal">search</code> and <code class="literal">create_analytics</code> endpoints. You need to follow the steps in <a href="/guide/en/workplace-search/current/building-custom-search-workplace-search.html#configuring-search-oauth" class="ulink" target="_top">Configuring the OAuth Application for Search</a> to retrieve the credentials: Client ID and Client Secret to request access tokens from the authentication server.</p>
<div class="pre_wrapper lang-rb">
<pre class="programlisting prettyprint lang-rb">client = Elastic::EnterpriseSearch::WorkplaceSearch::Client.new(http_auth: &lt;access_token&gt;)

client_id = &lt;client_id&gt;
client_secret = &lt;client_secret&gt;
redirect_uri = &lt;redirect_uri&gt;

# Get the authorization URL:
client.authorization_url(client_id, redirect_uri)
&gt; https://host:port/ws/oauth/authorize?response_type=code&amp;client_id=client_id&amp;redirect_uri=https%3A%2F%2Flocalhost%3A3002</pre>
</div>
<p>Open the URL to authorize your application. Successful authorization redirects the user in accordance to the redirect URI provided (and configured for the application). The application server must now request for an access_token, which is generated by Workplace Search using the oauth/token endpoint, using the Client ID and Client Secret.</p>
<div class="pre_wrapper lang-rb">
<pre class="programlisting prettyprint lang-rb">authorization_code = '&lt;paste code from redirect&gt;'

access_token = client.request_access_token(client_id, client_secret, authorization_code, redirect_uri)

# The access_token can now be used to issue a search request:
client.search(body: {query: 'search query'}, access_token: access_token)</pre>
</div>
<p>See <a href="/guide/en/workplace-search/current/workplace-search-search-api.html#search-api-overview" class="ulink" target="_top">Search API Overview</a> for more search parameters.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_permissions"></a>Permissions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/enterprise-search-ruby/edit/7.11/docs/guide/workplace-search-api.asciidoc">edit</a></h2>
</div></div></div>
<div class="pre_wrapper lang-rb">
<pre class="programlisting prettyprint lang-rb"># List permissions
client.list_permissions(content_source_id)

# Get a user permissions
response = client.user_permissions(content_source_id, { user: 'enterprise_search' })

# Clear user permissions
client.put_user_permissions(content_source_id, { permissions: [], user: 'enterpise_search' })

# Add permissions to a user
client.add_user_permissions(
  content_source_id,
  { permissions: ['permission1', 'permission2'], user: user }
)

# Updates user permissions
client.put_user_permissions(content_source_id, { permissions: [], user: user })

# Remove permissions from a user
client.remove_user_permissions(
  content_source_id,
  { permissions: ['permission1', 'permission2'], user: user }
)</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_external_identities"></a>External Identities<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/enterprise-search-ruby/edit/7.11/docs/guide/workplace-search-api.asciidoc">edit</a></h2>
</div></div></div>
<div class="pre_wrapper lang-rb">
<pre class="programlisting prettyprint lang-rb"># Create external identities
body = { user: 'elastic_user', source_user_id: 'example@elastic.co' }
client.create_external_identity(content_source_id, body: body)

# Retrieve an external identity
client.external_identity(content_source_id, user: 'elastic_user')

# List external identities
client.list_external_identities(content_source_id)

# Update external identity
body = { source_user_id: 'example2@elastic.co' }
client.put_external_identity(content_source_id, user: 'elastic_user', body: body)

# Delete an external identity
client.delete_external_identity(content_source_id, user: 'elastic_user')</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_create_analytics_event"></a>Create Analytics Event<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/enterprise-search-ruby/edit/7.11/docs/guide/workplace-search-api.asciidoc">edit</a></h2>
</div></div></div>
<p>You need to set up OAuth Authentication for analytics events.</p>
<div class="pre_wrapper lang-rb">
<pre class="programlisting prettyprint lang-rb">body = {
  type: 'click',
  query_id: 'search_query_id',
  document_id: 'document_id',
  page: 1,
  content_source_id: 'content_source_id',
  rank: 1,
  event: 'api'
}

client.create_analytics_event(access_token: oauth_access_token, body: body)</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="app-search-api.html">« App Search API</a>
</span>
<span class="next">
</span>
</div>
</div>
</body>
</html>
