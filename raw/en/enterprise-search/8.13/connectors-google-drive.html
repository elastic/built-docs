<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Elastic Google Drive connector reference | Enterprise Search documentation [8.13] | Elastic</title>
<meta class="elastic" name="content" content="Elastic Google Drive connector reference | Enterprise Search documentation [8.13]">

<link rel="home" href="index.html" title="Enterprise Search documentation [8.13]"/>
<link rel="up" href="connectors-references.html" title="Connectors references"/>
<link rel="prev" href="connectors-google-cloud.html" title="Google Cloud Storage Connector"/>
<link rel="next" href="connectors-jira.html" title="Elastic Jira connector reference"/>
<meta class="elastic" name="product_version" content="8.13"/>
<meta class="elastic" name="product_name" content="Enterprise Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/8.13"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="8.13"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
<div id="related-products" class="dropdown">
<div class="related-products-title"></div>
<div class="dropdown-anchor" tabindex="0">Enterprise Search<span class="dropdown-icon"></span></div>
<div class="dropdown-content">
<ul>
<li class="dropdown-category">Enterprise Search guides</li>
<ul>
<li><a href="/guide/en/enterprise-search/current/index.html" target="_blank">Enterprise Search</a></li>
<li><a href="/guide/en/app-search/current/index.html" target="_blank">App Search</a></li>
<li><a href="/guide/en/workplace-search/current/index.html" target="_blank">Workplace Search</a></li>
</ul>
<li class="dropdown-category">Programming language clients</li>
<ul>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/enterprise-search-node/current/index.html" target="_blank">Node.js client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/php/current/index.html" target="_blank">PHP client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/python/current/index.html" target="_blank">Python client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/ruby/current/index.html" target="_blank">Ruby client</a></li>
</ul>
</ul>
</div>
</div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="connectors-references.html">Connectors references</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="connectors-google-cloud.html">« Google Cloud Storage Connector</a>
</span>
<span class="next">
<a href="connectors-jira.html">Elastic Jira connector reference »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="connectors-google-drive"></a>Elastic Google Drive connector reference<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h2>
</div></div></div>

<p>The <em>Elastic Google Drive connector</em> is a <a class="xref" href="connectors.html" title="Elastic connectors">connector</a> for <a href="https://www.google.com/drive" class="ulink" target="_blank" rel="noopener">Google Drive</a>.
This connector is written in Python using the <a href="https://github.com/elastic/connectors/tree/8.13" class="ulink" target="_blank" rel="noopener">Elastic connector framework</a>.</p>
<p>View the <a href="https://github.com/elastic/connectors/tree/8.13/connectors/sources/google_drive.py" class="ulink" target="_blank" rel="noopener"><span class="strong strong"><strong>source code</strong></span> for this connector</a> (branch <em>8.13</em>, compatible with Elastic <em>8.13</em>).</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Choose your connector reference</strong></p>
</div></div></div>
<p>Are you using a native connector on Elastic Cloud or a self-managed connector client? Expand the documentation based on your deployment method.</p>
</div>
<h3><a id="connectors-google-drive-native-connector-reference"></a><span class="strong strong"><strong>Native connector (Elastic Cloud)</strong></span><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h3>
<details>
<summary class="title">View <span class="strong strong"><strong>native connector</strong></span> reference</summary>
<div class="content">
<h4><a id="connectors-google-drive-availability-and-prerequisites"></a>Availability and prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>This connector is available as a <span class="strong strong"><strong>native connector</strong></span> as of Elastic version <span class="strong strong"><strong>8.11.0</strong></span>.</p>
<p>To use this connector natively in Elastic Cloud, satisfy all <a class="xref" href="native-connectors.html#native-connectors-prerequisites" title="Availability and prerequisites">native connector requirements</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This connector is in <span class="strong strong"><strong>beta</strong></span> and is subject to change.
The design and code is less mature than official GA features and is being provided as-is with no warranties.
Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<h4><a id="connectors-google-drive-usage"></a>Usage<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>To use this connector natively in Elastic Cloud, see <a class="xref" href="native-connectors.html" title="Native connectors (managed service)"><em>Native connectors (managed service)</em></a>.</p>
<p>For additional operations, see <a class="xref" href="connectors-usage.html" title="Using connectors"><em>Using connectors</em></a>.</p>
<h4><a id="connectors-google-drive-connector-authentication-prerequisites"></a>Connector authentication prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>Before syncing any data from Google Drive, you need to create a <a href="https://cloud.google.com/iam/docs/service-account-overview" class="ulink" target="_blank" rel="noopener">service account</a> with appropriate access to Google Drive API.</p>
<p>To get started, log into <a href="https://cloud.google.com" class="ulink" target="_blank" rel="noopener">Google Cloud Platform</a> and go to the <code class="literal">Console</code>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Create a Google Cloud Project.</strong></span> Give your project a name, change the project ID and click the Create button.
</li>
<li class="listitem">
<span class="strong strong"><strong>Enable Google APIs.</strong></span> Choose APIs &amp; Services from the left menu and click on <code class="literal">Enable APIs and Services</code>. You need to enable the <span class="strong strong"><strong>Drive API</strong></span>.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create a Service Account.</strong></span> In the <code class="literal">APIs &amp; Services</code> section, click on <code class="literal">Credentials</code> and click on <code class="literal">Create credentials</code> to create a service account. Give your service account a name and a service account ID. This is like an email address and will be used to identify your service account in the future. Click <code class="literal">Done</code> to finish creating the service account. Your service account needs to have access to at least the following scope:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/drive.readonly</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create a Key File</strong></span>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
In the Cloud Console, go to <code class="literal">IAM and Admin</code> &gt; <code class="literal">Service accounts</code> page.
</li>
<li class="listitem">
Click the email address of the service account that you want to create a key for.
</li>
<li class="listitem">
Click the <code class="literal">Keys</code> tab. Click the <code class="literal">Add key</code> drop-down menu, then select <code class="literal">Create new key</code>.
</li>
<li class="listitem">
Select JSON as the Key type and then click <code class="literal">Create</code>. This will download a JSON file that will contain the service account credentials.
</li>
</ul>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>[Optional] Share Google Drive Folders.</strong></span> If you use domain-wide delegation for syncing data you can skip this step. Go to your Google Drive. Right-click the folder or shared drive, choose <code class="literal">Share</code> and add the email address of the service account you created in step 3. as a viewer to this folder.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you grant a service account access to a specific folder or shared drive in Google Drive, it&#8217;s important to note that the permissions extend to all the children within that folder or drive.
This means that any folders or files contained within the granted folder or drive inherit the same access privileges as the parent.</p>
</div>
</div>
<h5><a id="connectors-google-drive-additional-prerequisites-for-domain-wide-delegation"></a>Additional authentication prerequisites for domain-wide delegation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h5>
<p>This step is <span class="strong strong"><strong>required</strong></span> when <span class="strong strong"><strong>Use domain-wide delegation for data sync</strong></span> or <span class="strong strong"><strong>Enable document level security</strong></span> configuration option is enabled.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Enable Google APIs</strong></span>.</p>
<p>Choose APIs &amp; Services from the left menu and click on <code class="literal">Enable APIs and Services</code>. You need to enable the <span class="strong strong"><strong>Admin SDK API</strong></span> and <span class="strong strong"><strong>Drive API</strong></span>.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Google Workspace domain-wide delegation of authority</strong></span>.</p>
<p>To access drive and user data in a Google Workspace domain, the service account that you created needs to be granted access by a super administrator for the domain. You can follow <a href="https://developers.google.com/cloud-search/docs/guides/delegation" class="ulink" target="_blank" rel="noopener">the official documentation</a> to perform Google Workspace domain-wide delegation of authority.</p>
<p>You need to grant the following <span class="strong strong"><strong>OAuth Scopes</strong></span> to your service account:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/admin.directory.group.readonly</code>
</li>
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/admin.directory.user.readonly</code>
</li>
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/drive.readonly</code>
</li>
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/drive.metadata.readonly</code>
</li>
</ul>
</div>
<p>This step allows the connector to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
access user data and their group memberships in a Google Workspace organization
</li>
<li class="listitem">
access Google Drive data in drives associated to Google Workspace members
</li>
</ul>
</div>
</li>
</ol>
</div>
<h4><a id="connectors-google-drive-configuration"></a>Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>The following configuration fields are required:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Google Drive service account JSON
</span>
</dt>
<dd>
The service account credentials generated from Google Cloud Platform (JSON string).
Refer to the <a href="https://developers.google.com/workspace/guides/create-credentials#create_credentials_for_a_service_account" class="ulink" target="_blank" rel="noopener">Google Cloud documentation</a> for more information.
</dd>
<dt>
<span class="term">
Enable document level security
</span>
</dt>
<dd>
<p>
Toggle to enable <a href="/guide/en/enterprise-search/master/dls.html" class="ulink" target="_blank" rel="noopener">document level security (DLS)</a>.
DLS is supported for the Google Drive connector.
When enabled:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Full syncs will fetch access control lists for each document and store them in the <code class="literal">_allow_access_control</code> field.
</li>
<li class="listitem">
Access control syncs will fetch users' access control lists and store them in a separate index.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Google Workspace admin email
</span>
</dt>
<dd>
Google Workspace admin email.
Required to enable document level security (DLS) or domain-wide delegation for data sync.
A service account with delegated authority can impersonate an admin user with permissions to access Google Workspace user data and their group memberships.
Refer to the <a href="https://support.google.com/a/answer/162106?hl=en" class="ulink" target="_blank" rel="noopener">Google Cloud documentation</a> for more information.
</dd>
</dl>
</div>
<h4><a id="connectors-google-drive-documents-and-syncs"></a>Documents and syncs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>The connector will fetch all files and folders the service account has access to.</p>
<p>It will attempt to extract the content from Google Suite documents (Google Docs, Google Sheets and Google Slides) and regular files.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Files bigger than 10 MB won&#8217;t be extracted
</li>
<li class="listitem">
Permissions are not synced by default.
You must first enable <a class="xref" href="connectors-google-drive.html#connectors-google-drive-document-level-security" title="Document level security">DLS</a>.
Otherwise, <span class="strong strong"><strong>all documents</strong></span> indexed to an Elastic deployment will be visible to <span class="strong strong"><strong>all users with access</strong></span> to that Elastic Deployment.
</li>
</ul>
</div>
</div>
</div>
<h4><a id="connectors-google-drive-sync-rules"></a>Sync rules<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p><a class="xref" href="sync-rules.html#sync-rules-basic" title="Basic sync rules">Basic sync rules</a> are identical for all connectors and are available by default.</p>
<p>Advanced sync rules are not available for this connector in the present version.
Currently filtering is controlled via ingest pipelines.</p>
<h4><a id="connectors-google-drive-document-level-security"></a>Document level security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>Document level security (DLS) enables you to restrict access to documents based on a user’s permissions.
Refer to <a class="xref" href="connectors-google-drive.html#connectors-google-drive-configuration" title="Configuration">configuration</a> on this page for how to enable DLS for this connector.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a class="xref" href="dls-e2e-guide.html" title="Leverage document-level security from connectors in Search Applications">DLS in Search Applications</a> to learn how to ingest data from a connector with DLS enabled, when building a search application.
The example uses SharePoint Online as the data source, but the same steps apply to every connector.</p>
</div>
</div>
<h4><a id="connectors-google-drive-content-extraction"></a>Content extraction<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-content-extraction.html" title="Content extraction">Content extraction</a> for more information.</p>
<h4><a id="connectors-google-drive-known-issues"></a>Known issues<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>There are currently no known issues for this connector.</p>
<h4><a id="connectors-google-drive-troubleshooting"></a>Troubleshooting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-troubleshooting.html" title="Troubleshooting connectors">Troubleshooting</a>.</p>
<h4><a id="connectors-google-drive-security"></a>Security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-security.html" title="Connectors security">Security</a>.</p>
</div>
</details>
<h3><a id="connectors-google-drive-connector-client-reference"></a><span class="strong strong"><strong>Connector client (self-managed)</strong></span><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h3>
<details>
<summary class="title">View <span class="strong strong"><strong>connector client</strong></span> reference</summary>
<div class="content">
<h4><a id="connectors-google-drive-client-availability-and-prerequisites"></a>Availability and prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>This connector is available as a self-managed <span class="strong strong"><strong>connector client</strong></span>. To use this connector, satisfy all <a class="xref" href="build-connector.html" title="Connector clients (self-managed)">connector client requirements</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This connector is in <span class="strong strong"><strong>beta</strong></span> and is subject to change.
The design and code is less mature than official GA features and is being provided as-is with no warranties.
Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<h4><a id="connectors-google-drive-client-usage"></a>Usage<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>To use this connector as a <span class="strong strong"><strong>connector client</strong></span>, see <a class="xref" href="build-connector.html" title="Connector clients (self-managed)"><em>Connector clients (self-managed)</em></a>
For additional usage operations, see <a class="xref" href="connectors-usage.html" title="Using connectors"><em>Using connectors</em></a>.</p>
<h4><a id="connectors-google-drive-client-connector-authentication-prerequisites"></a>Connector authentication prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>Before syncing any data from Google Drive, you need to create a <a href="https://cloud.google.com/iam/docs/service-account-overview" class="ulink" target="_blank" rel="noopener">service account</a> with appropriate access to Google Drive API.</p>
<p>To get started, log into <a href="https://cloud.google.com" class="ulink" target="_blank" rel="noopener">Google Cloud Platform</a> and go to the <code class="literal">Console</code>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Create a Google Cloud Project.</strong></span> Give your project a name, change the project ID and click the Create button.
</li>
<li class="listitem">
<span class="strong strong"><strong>Enable Google APIs.</strong></span> Choose APIs &amp; Services from the left menu and click on <code class="literal">Enable APIs and Services</code>. You need to enable the <span class="strong strong"><strong>Drive API</strong></span>.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create a Service Account.</strong></span> In the <code class="literal">APIs &amp; Services</code> section, click on <code class="literal">Credentials</code> and click on <code class="literal">Create credentials</code> to create a service account. Give your service account a name and a service account ID. This is like an email address and will be used to identify your service account in the future. Click <code class="literal">Done</code> to finish creating the service account. Your service account needs to have access to at least the following scope:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/drive.readonly</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create a Key File</strong></span>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
In the Cloud Console, go to <code class="literal">IAM and Admin</code> &gt; <code class="literal">Service accounts</code> page.
</li>
<li class="listitem">
Click the email address of the service account that you want to create a key for.
</li>
<li class="listitem">
Click the <code class="literal">Keys</code> tab. Click the <code class="literal">Add key</code> drop-down menu, then select <code class="literal">Create new key</code>.
</li>
<li class="listitem">
Select JSON as the Key type and then click <code class="literal">Create</code>. This will download a JSON file that will contain the service account credentials.
</li>
</ul>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>[Optional] Share Google Drive Folders.</strong></span> If you use domain-wide delegation for syncing data you can skip this step. Go to your Google Drive. Right-click the folder or shared drive, choose <code class="literal">Share</code> and add the email address of the service account you created in step 3. as a viewer to this folder.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you grant a service account access to a specific folder or shared drive in Google Drive, it&#8217;s important to note that the permissions extend to all the children within that folder or drive.
This means that any folders or files contained within the granted folder or drive inherit the same access privileges as the parent.</p>
</div>
</div>
<h5><a id="connectors-google-drive-client-additional-prerequisites-for-domain-wide-delegation"></a>Additional authentication prerequisites for domain-wide delegation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h5>
<p>This step is <span class="strong strong"><strong>required</strong></span> when <span class="strong strong"><strong>Use domain-wide delegation for data sync</strong></span> or <span class="strong strong"><strong>Enable document level security</strong></span> configuration option is enabled.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Enable Google APIs</strong></span>.</p>
<p>Choose APIs &amp; Services from the left menu and click on <code class="literal">Enable APIs and Services</code>. You need to enable the <span class="strong strong"><strong>Admin SDK API</strong></span> and <span class="strong strong"><strong>Drive API</strong></span>.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Google Workspace domain-wide delegation of authority</strong></span>.</p>
<p>To access drive and user data in a Google Workspace domain, the service account that you created needs to be granted access by a super administrator for the domain. You can follow <a href="https://developers.google.com/cloud-search/docs/guides/delegation" class="ulink" target="_blank" rel="noopener">the official documentation</a> to perform Google Workspace domain-wide delegation of authority.</p>
<p>You need to grant the following <span class="strong strong"><strong>OAuth Scopes</strong></span> to your service account:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/admin.directory.group.readonly</code>
</li>
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/admin.directory.user.readonly</code>
</li>
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/drive.readonly</code>
</li>
<li class="listitem">
<code class="literal">https://www.googleapis.com/auth/drive.metadata.readonly</code>
</li>
</ul>
</div>
<p>This step allows the connector to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
access user data and their group memberships in a Google Workspace organization
</li>
<li class="listitem">
access Google Drive data in drives associated to Google Workspace members
</li>
</ul>
</div>
</li>
</ol>
</div>
<h4><a id="connectors-google-drive-client-configuration"></a>Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using the <a class="xref" href="build-connector.html" title="Connector clients (self-managed)">connector client</a> workflow, initially these fields will use the default configuration set in the <a href="https://github.com/elastic/connectors/tree/8.13/connectors/sources/google_drive.py" class="ulink" target="_blank" rel="noopener">connector source code</a>.
These are set in the <code class="literal">get_default_configuration</code> function definition.</p>
<p>These configurable fields will be rendered with their respective <span class="strong strong"><strong>labels</strong></span> in the Kibana UI.
Once connected, you&#8217;ll be able to update these values in Kibana.</p>
</div>
</div>
<p>The following configuration fields are required:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">service_account_credentials</code>
</span>
</dt>
<dd>
The service account credentials generated from Google Cloud Platform (JSON string).
Refer to the <a href="https://developers.google.com/workspace/guides/create-credentials#create_credentials_for_a_service_account" class="ulink" target="_blank" rel="noopener">Google Cloud documentation</a> for more information.
</dd>
<dt>
<span class="term">
<code class="literal">use_domain_wide_delegation_for_sync</code>
</span>
</dt>
<dd>
Use <a href="https://developers.google.com/cloud-search/docs/guides/delegation" class="ulink" target="_top">domain-wide delegation</a> to automatically sync content from all shared and personal drives in the Google workspace.
This eliminates the need to manually share Google Drive data with your service account, though it may increase the sync time.
If disabled, only items and folders manually shared with the service account will be synced.
</dd>
<dt>
<span class="term">
<code class="literal">google_workspace_admin_email_for_data_sync</code>
</span>
</dt>
<dd>
Required when domain-wide delegation for data sync is enabled.
This email is used for discovery and syncing of shared drives. Only the shared drives this user has access to are synced.
</dd>
<dt>
<span class="term">
<code class="literal">google_workspace_email_for_shared_drives_sync</code>
</span>
</dt>
<dd>
Required when domain-wide delegation for data sync is enabled.
Provide the Google Workspace user email for discovery and syncing of shared drives. Only the shared drives this user has access to will be synced.
</dd>
<dt>
<span class="term">
<code class="literal">use_document_level_security</code>
</span>
</dt>
<dd>
<p>
Toggle to enable <a href="/guide/en/enterprise-search/master/dls.html" class="ulink" target="_blank" rel="noopener">document level security (DLS)</a>.
DLS is supported for the Google Drive connector.
When enabled:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Full syncs will fetch access control lists for each document and store them in the <code class="literal">_allow_access_control</code> field.
</li>
<li class="listitem">
Access control syncs will fetch users' access control lists and store them in a separate index.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">google_workspace_admin_email</code>
</span>
</dt>
<dd>
Google Workspace admin email.
Required to enable document level security (DLS) or domain-wide delegation for data sync.
A service account with delegated authority can impersonate an admin user with permissions to access Google Workspace user data and their group memberships.
Refer to the <a href="https://support.google.com/a/answer/162106?hl=en" class="ulink" target="_blank" rel="noopener">Google Cloud documentation</a> for more information.
</dd>
<dt>
<span class="term">
<code class="literal">max_concurrency</code>
</span>
</dt>
<dd>
The maximum number of concurrent HTTP requests to the Google Drive API.
Increasing this value can improve data retrieval speed, but it may also place higher demands on system resources and network bandwidth.
</dd>
<dt>
<span class="term">
<code class="literal">use_text_extraction_service</code>
</span>
</dt>
<dd>
Requires a separate deployment of the <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-local" title="Extraction Service">Elastic Text Extraction Service</a>.
Requires that pipeline settings disable text extraction.
Default value is <code class="literal">False</code>.
</dd>
</dl>
</div>
<h4><a id="connectors-google-drive-client-deployment-using-docker"></a>Deployment using Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>You can deploy the Google Drive connector as a self-managed connector client using Docker.
Follow these instructions.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Step 1: Download sample configuration file</strong></span></summary>
<div class="content">
<p>Download the sample configuration file.
You can either download it manually or run the following command:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl https://raw.githubusercontent.com/elastic/connectors/main/config.yml.example --output ~/connectors-config/config.yml</pre>
</div>
<p>Remember to update the <code class="literal">--output</code> argument value if your directory name is different, or you want to use a different config file name.</p>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>Step 2: Update the configuration file for your self-managed connector</strong></span></summary>
<div class="content">
<p>Update the configuration file with the following settings to match your environment:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">elasticsearch.host</code>
</li>
<li class="listitem">
<code class="literal">elasticsearch.api_key</code>
</li>
<li class="listitem">
<code class="literal">connectors</code>
</li>
</ul>
</div>
<p>If you&#8217;re running the connector service against a Dockerized version of Elasticsearch and Kibana, your config file will look like this:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml"># When connecting to your cloud deployment you should edit the host value
elasticsearch.host: http://host.docker.internal:9200
elasticsearch.api_key: &lt;ELASTICSEARCH_API_KEY&gt;

connectors:
  -
    connector_id: &lt;CONNECTOR_ID_FROM_KIBANA&gt;
    service_type: google_drive
    api_key: &lt;CONNECTOR_API_KEY_FROM_KIBANA&gt;</pre>
</div>
<p>Using the <code class="literal">elasticsearch.api_key</code> is the recommended authentication method. However, you can also use <code class="literal">elasticsearch.username</code> and <code class="literal">elasticsearch.password</code> to authenticate with your Elasticsearch instance.</p>
<p>Note: You can change other default configurations by simply uncommenting specific settings in the configuration file and modifying their values.</p>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>Step 3: Run the Docker image</strong></span></summary>
<div class="content">
<p>Run the Docker image with the Connector Service using the following command:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run \
-v ~/connectors-config:/config \
--network "elastic" \
--tty \
--rm \
docker.elastic.co/enterprise-search/elastic-connectors:8.13.0.0 \
/app/bin/elastic-ingest \
-c /config/config.yml</pre>
</div>
</div>
</details>
<p>Refer to <a href="https://github.com/elastic/connectors/tree/8.13/docs/DOCKER.md" class="ulink" target="_blank" rel="noopener"><code class="literal">DOCKER.md</code></a> in the <code class="literal">elastic/connectors</code> repo for more details.</p>
<p>Find all available Docker images in the <a href="https://www.docker.elastic.co/r/enterprise-search/elastic-connectors" class="ulink" target="_top">official registry</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>We also have a quickstart self-managed option using Docker Compose, so you can spin up all required services at once: Elasticsearch, Kibana, and the connectors service.
Refer to this <a href="https://github.com/elastic/connectors/tree/main/scripts/stack#readme" class="ulink" target="_top">README</a> in the <code class="literal">elastic/connectors</code> repo for more information.</p>
</div>
</div>
<h4><a id="connectors-google-drive-client-documents-and-syncs"></a>Documents and syncs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>The connector will fetch all files and folders the service account has access to.</p>
<p>It will attempt to extract the content from Google Suite documents (Google Docs, Google Sheets and Google Slides) and regular files.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Files bigger than 10 MB won&#8217;t be extracted
</li>
<li class="listitem">
Permissions are not synced by default.
You must first enable <a class="xref" href="connectors-google-drive.html#connectors-google-drive-client-document-level-security" title="Document level security">DLS</a>.
Otherwise, <span class="strong strong"><strong>all documents</strong></span> indexed to an Elastic deployment will be visible to <span class="strong strong"><strong>all users with access</strong></span> to that Elastic Deployment.
</li>
</ul>
</div>
</div>
</div>
<h4><a id="connectors-google-drive-client-sync-rules"></a>Sync rules<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p><a class="xref" href="sync-rules.html#sync-rules-basic" title="Basic sync rules">Basic sync rules</a> are identical for all connectors and are available by default.</p>
<p>Advanced sync rules are not available for this connector in the present version.
Currently filtering is controlled via ingest pipelines.</p>
<h4><a id="connectors-google-drive-client-document-level-security"></a>Document level security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>Document level security (DLS) enables you to restrict access to documents based on a user’s permissions.
Refer to <a class="xref" href="connectors-google-drive.html#connectors-google-drive-client-configuration" title="Configuration">configuration</a> on this page for how to enable DLS for this connector.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a class="xref" href="dls-e2e-guide.html" title="Leverage document-level security from connectors in Search Applications">DLS in Search Applications</a> to learn how to ingest data from a connector with DLS enabled, when building a search application.
The example uses SharePoint Online as the data source, but the same steps apply to every connector.</p>
</div>
</div>
<h4><a id="connectors-google-drive-client-content-extraction"></a>Content extraction<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-content-extraction.html" title="Content extraction">Content extraction</a> for more information.</p>
<h4><a id="connectors-google-drive-client-end-to-end-testing"></a>End-to-end testing<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>The connector framework enables operators to run functional tests against a real data source. Refer to <a class="xref" href="build-connector.html#build-connector-testing" title="Connector testing">Connector testing</a> for more details.</p>
<p>To perform E2E testing for the Google Drive connector, run the following command:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">make ftest NAME=google_drive</pre>
</div>
<p>For faster tests, add the <code class="literal">DATA_SIZE=small</code> flag:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">make ftest NAME=google_drive DATA_SIZE=small</pre>
</div>
<h4><a id="connectors-google-drive-client-known-issues"></a>Known issues<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>There are currently no known issues for this connector.</p>
<h4><a id="connectors-google-drive-client-troubleshooting"></a>Troubleshooting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-troubleshooting.html" title="Troubleshooting connectors">Troubleshooting</a>.</p>
<h4><a id="connectors-google-drive-client-security"></a>Security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.13/enterprise-search-docs/connectors-google-drive.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-security.html" title="Connectors security">Security</a>.</p>
</div>
</details>
</div>
<div class="navfooter">
<span class="prev">
<a href="connectors-google-cloud.html">« Google Cloud Storage Connector</a>
</span>
<span class="next">
<a href="connectors-jira.html">Elastic Jira connector reference »</a>
</span>
</div>
</div>
</body>
</html>
