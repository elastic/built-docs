<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Migrating from 8.7 to 8.8 | Enterprise Search documentation [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Migrating from 8.7 to 8.8 | Enterprise Search documentation [8.14]">

<link rel="home" href="index.html" title="Enterprise Search documentation [8.14]"/>
<link rel="up" href="upgrading-and-migrating.html" title="Upgrading &amp; migrating"/>
<link rel="prev" href="migrating-from-self-managed-app-search.html" title="Migrating from self-managed App Search"/>
<link rel="next" href="server-known-issues.html" title="Enterprise Search server known issues"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Enterprise Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/8.14"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="migrating-from-self-managed-app-search.html">« Migrating from self-managed App Search</a>
</span>
<span class="next">
<a href="server-known-issues.html">Enterprise Search server known issues »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
<div id="related-products" class="dropdown">
<div class="related-products-title"></div>
<div class="dropdown-anchor" tabindex="0">Enterprise Search<span class="dropdown-icon"></span></div>
<div class="dropdown-content">
<ul>
<li class="dropdown-category">Enterprise Search guides</li>
<ul>
<li><a href="/guide/en/enterprise-search/current/index.html" target="_blank">Enterprise Search</a></li>
<li><a href="/guide/en/app-search/current/index.html" target="_blank">App Search</a></li>
<li><a href="/guide/en/workplace-search/current/index.html" target="_blank">Workplace Search</a></li>
</ul>
<li class="dropdown-category">Programming language clients</li>
<ul>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/enterprise-search-node/current/index.html" target="_blank">Node.js client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/php/current/index.html" target="_blank">PHP client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/python/current/index.html" target="_blank">Python client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/ruby/current/index.html" target="_blank">Ruby client</a></li>
</ul>
</ul>
</div>
</div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="server.html">Elastic Enterprise Search server</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="upgrading-and-migrating.html">Upgrading &amp; migrating</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Migrating from 8.7 to 8.8</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/analytics-migration.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="analytics-migration"></a>Migrating from 8.7 to 8.8<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/analytics-migration.asciidoc">edit</a></h2>
</div></div></div>
<p>Behavioral analytics were introduced in beta in Elastic 8.7.
In version 8.8, the data model changes to support dashboards and future features.
To use these new features, you must migrate to the new data model.
Follow the steps in this document to migrate.</p>
<h4><a id="analytics-migration-8-7-to-8-8-create-collection"></a>1. Create a collection<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/analytics-migration.asciidoc">edit</a></h4>
<p>Any existing analytics collections can continue to receive data, but to use the new analytics features, you must create new collections.
You will need to create a new collection to store your analytics data.
You can do this through the Kibana UI.
Refer to <a href="/guide/en/elasticsearch/reference/8.14/behavioral-analytics-start.html" class="ulink" target="_top">Get started with Behavioral Analytics</a>.</p>
<h4><a id="analytics-migration-8-7-to-8-8-add-events"></a>2. Add existing events to the new collection<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/analytics-migration.asciidoc">edit</a></h4>
<p>If you want to keep your existing events, you will need to:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Transform the data using the data structure outlined in <a class="xref" href="analytics-migration.html#analytics-migration-8-7-to-8-8-update-events" title="3. Update events"><em>Update events</em></a>.
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.14/docs-reindex.html" class="ulink" target="_blank" rel="noopener">Reindex</a> them into the new datastream.
The datastream name is based on the collection name that you created.
For example, if you created a collection called <code class="literal">website</code>, the datastream name will be <code class="literal">website-behavioral_analytics-events</code>.
</li>
</ol>
</div>
<p>Refer to the Elasticsearch <a href="/guide/en/elasticsearch/client/javascript-api/current/reindex_examples.html" class="ulink" target="_top">JavaScript client documentation</a> for an example of how to reindex documents.</p>
<h4><a id="analytics-migration-8-7-to-8-8-update-events"></a>3. Update events<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/analytics-migration.asciidoc">edit</a></h4>
<p>You will need to update your events to the new data structure.</p>
<p><span class="strong strong"><strong>Required fields</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
All events
</span>
</dt>
<dd>
<p>
All events require the following fields:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">@timestamp</code> (no change since 8.7)
</li>
<li class="listitem">
<p><code class="literal">data_stream</code>(identifies the datastream the event belongs to)</p>
<div class="pre_wrapper lang-javascript">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-javascript">{
  "@timestamp": 1682671778730,
  "data_stream": {
    "namespace": "&lt;your-collection&gt;", // Name of your collection
    "type": "behavioral_analytics", // Fixed value
    "dataset": "events" // Fixed value
  }
}</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p>For the following events, you will need to update certain fields.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Search Event
</span>
</dt>
<dd>
<p>
This event represents when a user searches.
</p>
<p><span class="strong strong"><strong>Required fields</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">search.query</code></p>
<div class="pre_wrapper lang-javascript">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-javascript">{
  search: {
    "query": "laptop", // required
    "filters": {
      "brand": ["apple"]
    },
    page: {
      current: 1,
      size: 10,
    },
    results: { // optional
      items: [
        {
          document: {
            id: "123",
            index: "products"
          },
          page: {
            url: "http://ww.my-website.com/url"
          }
        }
      ],
      total_results: 100
    },
    sort: {
      name: "relevance"
    }
  },
  event: {
    action: "search"
  },
  session: {
    id: "123"
  },
  user: {
    id: "456"
  }
}</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Search Click Event
</span>
</dt>
<dd>
<p>
This event represents when a user clicks a document from a search.
</p>
<p><span class="strong strong"><strong>Required Fields</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">search.query</code>
</li>
<li class="listitem">
<p>Any of: <code class="literal">document</code> or <code class="literal">page</code>. Both are preferable.</p>
<div class="pre_wrapper lang-javascript">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-javascript">{
  search: {
    "query": "laptop", // required
    "filters": {
      "brand": ["apple"]
    },
    page: {
      current: 1,
      size: 10,
    },
    results: { // optional
      items: [
        {
          document: {
            id: "123",
            index: "products"
          },
          page: {
            url: "http://ww.my-website.com/url"
          }
        }
      ],
      total_results: 100
    },
    sort: {
      name: "relevance"
    }
  },
  event: {
    action: "search_click"
  },
  document: { id: "123", index: "products" },
  page: {
    url: "http://localhost:3000/javascript-tracker",
    title: "my product detail"
  },
  session: {
    id: "123"
  },
  user: {
    id: "456"
  }
}</pre>
</div>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Page View Event
</span>
</dt>
<dd>
<p>
This event represents when a user clicks a document from a search.
</p>
<p><span class="strong strong"><strong>Required Fields</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Any of: <code class="literal">document</code> or <code class="literal">page</code>. Both are preferable.</p>
<div class="pre_wrapper lang-javascript">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-javascript">{
  document: { id: "123", index: "products" },
  page: {
    url: "http://localhost:3000/javascript-tracker",
    title: "my product detail"
  },
  event: {
    action: "page_view"
  },
  session: {
    id: "123"
  },
  user: {
    id: "456"
  }
}</pre>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Need help?</strong></p>
</div></div></div>
<p>If you need help transforming events in an 8.7 datastream, reach out to us on the <a href="https://discuss.elastic.co/c/enterprise-search/" class="ulink" target="_top">Elastic Discuss forums</a>.</p>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Behavioral analytics does not support <em>custom</em> events in 8.8.
You will not be able to use custom events created in 8.7 in the new data model.</p>
</div>
</div>
<h4><a id="analytics-migration-8-7-to-8-8-update-tracker-integration"></a>4. Update your tracker integration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/analytics-migration.asciidoc">edit</a></h4>
<p>Depending on how you integrated the tracker (using either the <code class="literal">browser-tracker</code> or the <code class="literal">javascript-tracker</code>), you will need to update the integration to continue to capture events.</p>
<p>Follow the steps in your collection&#8217;s integration page to update your integration.
Find this under <span class="strong strong"><strong>Search &gt; Behavioral Analytics &gt;</strong></span> <em>&lt;my-collection&gt;</em> <span class="strong strong"><strong>&gt; Integration</strong></span>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="migrating-from-self-managed-app-search.html">« Migrating from self-managed App Search</a>
</span>
<span class="next">
<a href="server-known-issues.html">Enterprise Search server known issues »</a>
</span>
</div>
</body>
</html>
