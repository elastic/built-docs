<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Content extraction | Enterprise Search documentation [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Content extraction | Enterprise Search documentation [8.14]">

<link rel="home" href="index.html" title="Enterprise Search documentation [8.14]"/>
<link rel="up" href="connectors-filter-extract-transform.html" title="Extract, filter, and transform content"/>
<link rel="prev" href="sync-rules.html" title="Connector sync rules"/>
<link rel="next" href="dls.html" title="Document level security"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Enterprise Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/8.14"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="sync-rules.html">« Connector sync rules</a>
</span>
<span class="next">
<a href="dls.html">Document level security »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
<div id="related-products" class="dropdown">
<div class="related-products-title"></div>
<div class="dropdown-anchor" tabindex="0">Enterprise Search<span class="dropdown-icon"></span></div>
<div class="dropdown-content">
<ul>
<li class="dropdown-category">Enterprise Search guides</li>
<ul>
<li><a href="/guide/en/enterprise-search/current/index.html" target="_blank">Enterprise Search</a></li>
<li><a href="/guide/en/app-search/current/index.html" target="_blank">App Search</a></li>
<li><a href="/guide/en/workplace-search/current/index.html" target="_blank">Workplace Search</a></li>
</ul>
<li class="dropdown-category">Programming language clients</li>
<ul>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/enterprise-search-node/current/index.html" target="_blank">Node.js client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/php/current/index.html" target="_blank">PHP client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/python/current/index.html" target="_blank">Python client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/ruby/current/index.html" target="_blank">Ruby client</a></li>
</ul>
</ul>
</div>
</div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="connectors.html">Elastic connectors</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="connectors-filter-extract-transform.html">Extract, filter, and transform content</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Content extraction</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="connectors-content-extraction"></a>Content extraction<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h2>
</div></div></div>
<p>Connectors use the <a href="/guide/en/elasticsearch/reference/8.14/attachment.html" class="ulink" target="_blank" rel="noopener">Elastic ingest attachment processor</a> to extract file contents.
The processor extracts files using the <a href="https://tika.apache.org" class="ulink" target="_blank" rel="noopener">Apache Tika</a> text extraction library.
The logic for content extraction is defined in <a href="https://github.com/elastic/connectors/tree/8.14/connectors/utils.py" class="ulink" target="_blank" rel="noopener">utils.py</a>.</p>
<p>While intended primarily for PDF and Microsoft Office formats, you can use any of the <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-supported-file-types" title="Supported file types">supported formats</a>.</p>
<p>Enterprise Search uses an <a href="/guide/en/elasticsearch/reference/8.14/ingest.html" class="ulink" target="_blank" rel="noopener">Elasticsearch ingest pipeline</a> to power the web crawler&#8217;s binary content extraction.
The default pipeline, <code class="literal">ent-search-generic-ingestion</code>, is automatically created when Enterprise Search first starts.</p>
<p>You can <a href="/guide/en/elasticsearch/reference/8.14/ingest.html#create-manage-ingest-pipelines" class="ulink" target="_blank" rel="noopener">view</a> this pipeline in Kibana.
Customizing your pipeline usage is also an option.
See <a href="/guide/en/elasticsearch/reference/8.14/ingest-pipeline-search.html" class="ulink" target="_top">Ingest pipelines for Search indices</a>.</p>
<p>For advanced use cases, the <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-local" title="Extraction Service">self-hosted extraction service</a> can be used to extract content from files larger than 10MB.</p>
<h4><a id="connectors-content-extraction-supported-file-types"></a>Supported file types<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h4>
<p>The following file types are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">.txt</code>
</li>
<li class="listitem">
<code class="literal">.py</code>
</li>
<li class="listitem">
<code class="literal">.rst</code>
</li>
<li class="listitem">
<code class="literal">.html</code>
</li>
<li class="listitem">
<code class="literal">.markdown</code>
</li>
<li class="listitem">
<code class="literal">.json</code>
</li>
<li class="listitem">
<code class="literal">.xml</code>
</li>
<li class="listitem">
<code class="literal">.csv</code>
</li>
<li class="listitem">
<code class="literal">.md</code>
</li>
<li class="listitem">
<code class="literal">.ppt</code>
</li>
<li class="listitem">
<code class="literal">.rtf</code>
</li>
<li class="listitem">
<code class="literal">.docx</code>
</li>
<li class="listitem">
<code class="literal">.odt</code>
</li>
<li class="listitem">
<code class="literal">.xls</code>
</li>
<li class="listitem">
<code class="literal">.xlsx</code>
</li>
<li class="listitem">
<code class="literal">.rb</code>
</li>
<li class="listitem">
<code class="literal">.paper</code>
</li>
<li class="listitem">
<code class="literal">.sh</code>
</li>
<li class="listitem">
<code class="literal">.pptx</code>
</li>
<li class="listitem">
<code class="literal">.pdf</code>
</li>
<li class="listitem">
<code class="literal">.doc</code>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The ingest attachment processor does not support compressed files, e.g., an archive file containing a set of PDFs.
Expand the archive file and make individual uncompressed files available for the connector to process.</p>
</div>
</div>
<h4><a id="connectors-content-extraction-local"></a>Extraction Service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Currently, content extraction from large files via the Extraction Service is available for a subset of our <span class="strong strong"><strong>self-managed connector clients</strong></span>.
It is not available for native connectors running on Elastic Cloud.
This feature is in <span class="strong strong"><strong>beta</strong></span>.</p>
</div>
</div>
<p>Standard content extraction is done via the Attachment Processor, through Elasticsearch Ingest Pipelines.
The connector client limits file sizes for pipeline extraction to 10MB per file (Elasticsearch also has a hard limit of 100MB per file).</p>
<p>For use cases that require extracting content from files larger than these limits, the <span class="strong strong"><strong>self-managed extraction service</strong></span> can be used for connector clients.
Instead of sending the file as an <code class="literal">attachment</code> to Elasticsearch, the file&#8217;s content is extracted at the edge by the extraction service before ingestion.
The extracted text is then included as the <code class="literal">body</code> field of a document when it is ingested.</p>
<p>To use this feature, you will need to do the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-data-extraction-service" title="Running the extraction service">Run the self-hosted content extraction service</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-content-extraction.html#connectors-extraction-service-configuration" title="Configuring the extraction service">Add the required configuration settings</a>
</li>
<li class="listitem">
Set the value of the configurable field <code class="literal">use_text_extraction_service</code> to <code class="literal">true</code>
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The data extraction service code is now available in this public repository: <a href="https://github.com/elastic/data-extraction-service" class="ulink" target="_top">https://github.com/elastic/data-extraction-service</a>.</p>
</div>
</div>
<h5><a id="connectors-content-extraction-available-connectors"></a>Available connectors<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h5>
<p>Local content extraction is available for the following self-managed connector clients:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="connectors-azure-blob.html" title="Elastic Azure Blob Storage connector reference">Azure Blob Storage</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-confluence.html" title="Elastic Confluence connector reference">Confluence</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-dropbox.html" title="Elastic Dropbox connector reference">Dropbox</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-github.html" title="Elastic GitHub connector reference">GitHub</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-google-cloud.html" title="Google Cloud Storage Connector">Google Cloud Storage</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-google-drive.html" title="Elastic Google Drive connector reference">Google Drive</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-jira.html" title="Elastic Jira connector reference">Jira</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-network-drive.html" title="Elastic network drive connector reference">Network drive</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-onedrive.html" title="Elastic OneDrive connector reference">OneDrive</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-outlook.html" title="Elastic Outlook connector reference">Outlook</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-s3.html" title="Elastic S3 connector reference">S3</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-salesforce.html" title="Elastic Salesforce connector reference">Salesforce</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-servicenow.html" title="Elastic ServiceNow connector reference">ServiceNow</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-sharepoint-online.html" title="Elastic SharePoint Online connector reference">SharePoint Online</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-sharepoint.html" title="Elastic SharePoint Server connector reference">SharePoint Server</a>
</li>
<li class="listitem">
<a class="xref" href="connectors-zoom.html" title="Elastic Zoom connector reference">Zoom</a>
</li>
</ul>
</div>
<h5><a id="connectors-content-extraction-data-extraction-service"></a>Running the extraction service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h5>
<p>Self-hosted content extraction is handled by a <span class="strong strong"><strong>separate</strong></span> extraction service.</p>
<p>The versions for the extraction service do not align with the Elastic stack.
For version <code class="literal">8.11.x</code>, you should use extraction service version <code class="literal">0.3.x</code>.</p>
<p>You can run the service with the following command:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ docker run \
  -p 8090:8090 \
  -it \
  --name extraction-service \
  docker.elastic.co/enterprise-search/data-extraction-service:$EXTRACTION_SERVICE_VERSION</pre>
</div>
<h5><a id="connectors-extraction-service-configuration"></a>Configuring the extraction service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h5>
<p>You can enable your connector client to use the self-hosted extraction service by adding the required configuration.
The connector client determines if the extraction service is enabled by the presence of these fields in the configuration file.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the <code class="literal">config.yml</code> configuration file in your text editor of choice.
</li>
<li class="listitem">
Add the following fields. They can be added anywhere in the file, so long as they begin at the root level.
</li>
</ol>
</div>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml"># data-extraction-service settings
extraction_service:
  host: http://localhost:8090</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>There is no password protection between the connector client and the extraction service.
Self-hosted extraction should only be used if the two services are running on the same network and behind the same firewall.</p>
</div>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Field</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">host</code></p></td>
<td align="left" valign="top"><p>The endpoint for the extraction service. <code class="literal">http://localhost:8090</code> can be used if it is running on the same server as your connector client.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The connector client will perform a preflight check against the configured <code class="literal">host</code> value at startup.
The following line will be output to the log if the data extraction service was found and is running normally.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">Data extraction service found at &lt;HOST&gt;.</pre>
</div>
<p>If you don&#8217;t see this log at startup, refer to <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-troubleshooting" title="Troubleshooting the self-hosted extraction service">troubleshooting self-hosted content extraction service</a>.</p>
<h6><a id="connectors-content-extraction-advanced-configuration"></a>Advanced configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h6>
<p>The following fields can be included in the configuration file.
They are optional and will fallback on default values if they are not specified.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml"># data-extraction-service settings
extraction_service:
  host: http://localhost:8090
  timeout: 30
  use_file_pointers: false
  stream_chunk_size: 65536
  shared_volume_dir: '/app/files'</pre>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Advanced Field</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">timeout</code></p></td>
<td align="left" valign="top"><p>Timeout limit in seconds for content extraction. Defaults to <code class="literal">30</code> if not set. Increase this if you have very large files that timeout during content extraction. In the event of a timeout, the indexed document&#8217;s <code class="literal">body</code> field will be an empty string.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">use_file_pointers</code></p></td>
<td align="left" valign="top"><p>Whether or not to use file pointers instead of sending files to the extraction service. Defaults to <code class="literal">false</code>. Refer to <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-data-extraction-service-file-pointers" title="Using file pointers">using file pointers</a> for more details about this setting.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">stream_chunk_size</code></p></td>
<td align="left" valign="top"><p>The size that files are chunked to facilitate streaming to extraction service, in bytes. Defaults to 65536 (64 KB). Only applicable if <code class="literal">use_file_pointers</code> is <code class="literal">false</code>. Increasing this value may speed up the connector, but will also increase memory usage.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">shared_volume_dir</code></p></td>
<td align="left" valign="top"><p>The shared volume from which the data extraction service will extract files. Defaults to <code class="literal">/app/files</code>. Only applicable if <code class="literal">use_file_pointers</code> is <code class="literal">true</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="connectors-content-extraction-data-extraction-service-file-pointers"></a>Using file pointers<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h5>
<p>The self-hosted extraction service can be set up to use file pointers instead of sending files via HTTP requests.
File pointers are faster than sending files and consume less memory, but require the connector framework and the extraction service to be able to share a file system.
This can be set up with both a dockerized and non-dockerized connector client.</p>
<h6><a id="connectors-content-extraction-data-extraction-service-file-pointers-configuration"></a>Configuration for non-dockerized connector clients<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h6>
<p>If you are running a non-dockerized version of the connector client, you need to determine the local directory where you&#8217;ll download files for extraction.
This can be anywhere on your file system that you are comfortable using.
Be aware that the connector client will download files with randomized filenames to this directory, so there is a chance that any files already present will be overwritten.
For that reason, we recommend using a dedicated directory for self-hosted extraction.</p>
<h7><a id="connectors-content-extraction-data-extraction-service-file-pointers-configuration-example"></a>Example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h7>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>For this example, we will be using <code class="literal">/app/files</code> as both our local directory and our container directory.
When you run the extraction service docker container, you can mount the directory as a volume using the command-line option <code class="literal">-v /app/files:/app/files</code>.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ docker run \
  -p 8090:8090 \
  -it \
  -v /app/files:/app/files \
  --name extraction-service \
  docker.elastic.co/enterprise-search/data-extraction-service:$EXTRACTION_SERVICE_VERSION</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Due to how this feature works in the codebase for non-dockerized setups, <span class="strong strong"><strong>the local filepath and the docker container&#8217;s filepath must be identical</strong></span>.
For example, if using <code class="literal">/app/files</code>, you must mount the directory as <code class="literal">-v /app/files:/app/files</code>.
If either directory is different, the connector client will be unable to provide an accurate file pointer for the extraction service. This is not a factor when using a dockerized connector client.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Next, before running the connector client, be sure to update the config file with the correct information.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml"># data-extraction-service settings
extraction_service:
  host: http://localhost:8090
  use_file_pointers: true
  shared_volume_dir: '/app/files'</pre>
</div>
</li>
<li class="listitem">
Then all that&#8217;s left is to start the connector client and run a sync.
If you encounter any unexpected errors, refer to <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-troubleshooting" title="Troubleshooting the self-hosted extraction service">troubleshooting the self-hosted content extraction service</a>.
</li>
</ol>
</div>
<h6><a id="connectors-content-extraction-data-extraction-service-file-pointers-configuration-dockerized"></a>Configuration for dockerized connector clients<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h6>
<p>When using self-hosted extraction from a dockerized connector client, there are a few extra steps required on top of <a href="https://github.com/elastic/connectors/tree/8.14/docs/DOCKER.md" class="ulink" target="_blank" rel="noopener">running the connector client in docker</a>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The self-hosted extraction service will need to share the same network that the connector client and Elasticsearch are sharing.
</li>
<li class="listitem">
The connector client and the extraction service will also need to share a volume. You can decide what directory inside these docker containers the volume will be mounted onto, but the directory must be the same for both docker containers.
</li>
</ul>
</div>
<h7><a id="connectors-content-extraction-data-extraction-service-file-pointers-configuration-dockerized-example"></a>Example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h7>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>First, set up a volume for the two docker containers to share.
This will be where files are downloaded into and then extracted from.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ docker volume create --name extraction-service-volume</pre>
</div>
</li>
<li class="listitem">
<p>If you haven&#8217;t set up a network yet, you can create it now.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ docker network create elastic</pre>
</div>
</li>
<li class="listitem">
<p>Include the docker volume name and the network as arguments when running the extraction service.
For this example, we will be using <code class="literal">/app/files</code> as our container directory.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ docker run \
  -p 8090:8090 \
  -it \
  -v extraction-service-volume:/app/files \
  --network "elastic" \
  --name extraction-service \
  docker.elastic.co/enterprise-search/data-extraction-service:$EXTRACTION_SERVICE_VERSION</pre>
</div>
</li>
<li class="listitem">
<p>Next, you can follow the instructions for <a href="https://github.com/elastic/connectors/tree/8.14/docs/DOCKER.md" class="ulink" target="_blank" rel="noopener">running the connector client in docker</a> until step <code class="literal">4. Update the configuration file for your self-hosted connector</code>.
When setting up your configuration, be sure to add the following settings for the self-hosted content extraction service.
Note that the <code class="literal">host</code> will now refer to an internal docker endpoint instead of localhost.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml"># data-extraction-service settings
extraction_service:
  host: http://host.docker.internal:8090
  use_file_pointers: true
  shared_volume_dir: '/app/files'</pre>
</div>
</li>
<li class="listitem">
<p>Next, during step <code class="literal">5. Run the Docker image</code>, we only need to add our new shared volume in the run command using <code class="literal">-v extraction-service-volume:/app/files</code>.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ docker run \
  -v ~/connectors-config:/config \
  -v extraction-service-volume:/app/files \
  --network "elastic" \
  --tty \
  --rm \
  docker.elastic.co/enterprise-search/elastic-connectors:$CONNECTOR_CLIENT_VERSION \
  /app/bin/elastic-ingest \
  -c /config/config.yml</pre>
</div>
</li>
<li class="listitem">
Now the connector client and extraction service docker containers should be set up to share files.
Run a test sync to make sure everything is configured correctly.
If you encounter any unexpected errors, refer to <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-troubleshooting" title="Troubleshooting the self-hosted extraction service">troubleshooting the self-hosted extraction service</a>.
</li>
</ol>
</div>
<h5><a id="connectors-content-extraction-local-logs"></a>Self-hosted extraction service logs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h5>
<p>The extraction service produces two different log files that may be informative when troubleshooting.
These are saved at the following file locations internally in the docker container:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/var/log/openresty.log</code> for request traffic logs
</li>
<li class="listitem">
<code class="literal">/var/log/tika.log</code> for tikaserver jar logs
</li>
</ul>
</div>
<p>Logs can be viewed from outside of docker by combining <code class="literal">docker exec</code> with the <code class="literal">tail</code> command.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">$ docker exec extraction-service /bin/sh -c "tail /var/log/openresty.log"
$ docker exec extraction-service /bin/sh -c "tail /var/log/tika.log"</pre>
</div>
<h5><a id="connectors-content-extraction-troubleshooting"></a>Troubleshooting the self-hosted extraction service<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.14/enterprise-search-docs/connectors-content-extraction.asciidoc">edit</a></h5>
<p>The following warning logs may appear while using self-hosted extraction service.
Each log in this section is followed by a description of what may have happened, and suggested fixes.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">Extraction service is not configured, skipping its preflight check.</pre>
</div>
<p>The configuration file is missing the <code class="literal">extraction_service.host</code> field.
If you want to use this service, check that the configuration is formatted correctly and that the required field is present.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">Data extraction service found at &lt;HOST&gt;, but health-check returned &lt;RESPONSE STATUS&gt;.</pre>
</div>
<p>The <code class="literal">/ping</code> endpoint returned a non-<code class="literal">200</code> response.
This could mean that the extraction service is unhealthy and may need to be restarted, or that the configured <code class="literal">extraction_service.host</code> is incorrect.
You can find more information about what happened in the <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-local-logs" title="Self-hosted extraction service logs">data extraction service logs</a>.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">Expected to find a running instance of data extraction service at &lt;HOST&gt; but failed. &lt;ERROR&gt;.</pre>
</div>
<p>The health check returned either a timeout or client connection error.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A timeout may be caused by the extraction service server not running, or not being accessible from the configured <code class="literal">host</code> in the configuration file.
</li>
<li class="listitem">
A server connection error is an internal error on the extraction service. You will need to investigate the <a class="xref" href="connectors-content-extraction.html#connectors-content-extraction-local-logs" title="Self-hosted extraction service logs">data extraction service logs</a>.
</li>
</ul>
</div>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">Extraction service has been initialised but no extraction service configuration was found. No text will be extracted for this sync.</pre>
</div>
<p>You have enabled self-hosted extraction service for the connector, but the configuration file is missing the <code class="literal">extraction_service.host</code> field.
Check that the configuration is formatted correctly and that the required field is present.</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">Extraction service could not parse &lt;FILENAME&gt;. Status: &lt;RESPONSE STATUS&gt;; &lt;ERROR NAME&gt;: &lt;ERROR MESSAGE&gt;.</pre>
</div>
<p>This warning will appear every time a file is not extractable.
Generally the <code class="literal">&lt;ERROR MESSAGE&gt;</code> will provide an explanation for why extraction failed.
Contact support if the message is unclear.
When a file fails extraction, it will be indexed with an empty string in the <code class="literal">body</code> field.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="sync-rules.html">« Connector sync rules</a>
</span>
<span class="next">
<a href="dls.html">Document level security »</a>
</span>
</div>
</body>
</html>
