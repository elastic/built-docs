<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ELSER text expansion | Enterprise Search documentation [8.9] | Elastic</title>
<meta class="elastic" name="content" content="ELSER text expansion | Enterprise Search documentation [8.9]">

<link rel="home" href="index.html" title="Enterprise Search documentation [8.9]"/>
<link rel="up" href="index.html" title="Enterprise Search documentation [8.9]"/>
<link rel="prev" href="document-enrichment.html" title="Document enrichment with ML"/>
<link rel="next" href="engines.html" title="Indices, engines, meta engines, and content sources"/>
<meta class="elastic" name="product_version" content="8.9"/>
<meta class="elastic" name="product_name" content="Enterprise Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/8.9"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="8.9"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
<div id="related-products" class="dropdown">
<div class="related-products-title"></div>
<div class="dropdown-anchor" tabindex="0">Enterprise Search<span class="dropdown-icon"></span></div>
<div class="dropdown-content">
<ul>
<li class="dropdown-category">Enterprise Search guides</li>
<ul>
<li><a href="/guide/en/enterprise-search/current/index.html" target="_blank">Enterprise Search</a></li>
<li><a href="/guide/en/app-search/current/index.html" target="_blank">App Search</a></li>
<li><a href="/guide/en/workplace-search/current/index.html" target="_blank">Workplace Search</a></li>
</ul>
<li class="dropdown-category">Programming language clients</li>
<ul>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/enterprise-search-node/current/index.html" target="_blank">Node.js client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/php/current/index.html" target="_blank">PHP client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/python/current/index.html" target="_blank">Python client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/ruby/current/index.html" target="_blank">Ruby client</a></li>
</ul>
</ul>
</div>
</div>
</span>
</div>
<div class="navheader">
<span class="prev">
<a href="document-enrichment.html">« Document enrichment with ML</a>
</span>
<span class="next">
<a href="engines.html">Indices, engines, meta engines, and content sources »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="elser-text-expansion"></a>ELSER text expansion<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.9/enterprise-search-docs/elser-text-expansion.asciidoc">edit</a></h1>
</div></div></div>
<p>Using Elastic&#8217;s <a href="/guide/en/machine-learning/8.9/ml-nlp-elser.html" class="ulink" target="_blank" rel="noopener">ELSER machine learning model</a> you can easily incorporate text expansion for your queries.
This works by using ELSER to provide automatic semantic enrichments to your documents upon ingestion, combined with the power of using
templates in <a class="xref" href="search-applications.html" title="Elastic Search Applications">Search Applications</a> to provide automated text expansion.</p>
<h2><a id="elser-availability"></a>Availability and prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.9/enterprise-search-docs/elser-text-expansion.asciidoc">edit</a></h2>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The ELSER text expansion model for ingestion and query expansion is a technical preview feature.
Technical preview features are subject to change and are not covered by the support SLA of generally available (GA) features.
Elastic plans to promote this feature to GA in a future release.</p>
</div>
</div>
<p>ELSER text expansion was introduced in Elastic version <span class="strong strong"><strong>8.8.0</strong></span>.</p>
<p>The ELSER model requires at least one ML node with a minimum of 4GB of memory.</p>
<h2><a id="deploy-elser"></a>Deploying the ELSER model<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.9/enterprise-search-docs/elser-text-expansion.asciidoc">edit</a></h2>
<p>You can download and deploy ELSER either from the <a href="/guide/en/machine-learning/8.9/ml-nlp-elser.html#download-deploy-elser" class="ulink" target="_blank" rel="noopener">Machine Learning Trained Models page</a>, or it can be deployed and started while configuring an <a class="xref" href="ingest-pipelines.html" title="Ingest pipelines">ingestion pipeline</a>.</p>
<p>If ELSER is not yet deployed, when you create or edit an <a class="xref" href="ingest-pipelines.html" title="Ingest pipelines">ingestion pipeline</a> you will have the option to deploy it from within your pipeline configuration.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/elser-deploy-model.png" alt="Deploy ELSER in a pipeline">
</div>
</div>
<p>Clicking the "Deploy" button will initiate the ELSER model deployment.
This may take several minutes and the panel will let you know when it is ready.
The deployment happens in the background and you can continue configuring your model while it is being deployed.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/elser-model-deployment.png" alt="ELSER model deployment">
</div>
</div>
<p>Once your ELSER model is deployed, you can then click to start the model in a single threaded instance, or, go to the <a href="/guide/en/machine-learning/8.9/ml-trained-models.html" class="ulink" target="_blank" rel="noopener">trained models configuration</a> to fine-tune the model deployment and start it.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/elser-start-model.png" alt="Start ELSER model">
</div>
</div>
<p>When your ELSER model is deployed and started, it is ready to be used in a pipeline.</p>
<h2><a id="create-elser-pipeline"></a>Creating a pipeline using ELSER<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.9/enterprise-search-docs/elser-text-expansion.asciidoc">edit</a></h2>
<p>Once your ELSER model has been started, you can use the "Add Inference Pipeline" button to add the power of ELSER to your ingestion.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/elser-model-started.png" alt="ELSER model is started">
</div>
</div>
<p>When configuring a pipeline, choose to create a new pipeline or use an existing one, and select the ELSER Text Expansion model, named ".elser_model_1".</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/pipeline-copy-customize.png" alt="Copy and customize the default pipeline">
</div>
</div>
<p>Be certain to copy and customize the default pipeline before adding the ELSER inference processor. If not, the "Add Inference Pipeline" button will be disabled.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/elser-pipeline-model-selection.png" alt="ELSER model selection for the pipeline">
</div>
</div>
<p>ELSER inference works across text fields, and best on shorter spans of text.
During the pipeline creation, you have the option to test your pipeline results and you can select an existing document, or, add in a test document or two to test the model inference.
You can view the results of the inference in the created "ml" field within the resulting document.</p>
<p>Once your pipeline is created, you are ready to ingest documents and utilize ELSER for text expansions in your search queries.</p>
<h2><a id="querying-documents-with-elser"></a>Querying documents with ELSER enrichments<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.9/enterprise-search-docs/elser-text-expansion.asciidoc">edit</a></h2>
<p>The easiest way to get up and running using ELSER text expansion in your queries is to use the <a class="xref" href="search-applications.html" title="Elastic Search Applications">Search Applications</a> feature.</p>
<p>Examples on how to create and use Search Application templates can be found in the <a class="xref" href="search-applications-templates.html#search-applications-templates-elser-template" title="ELSER search">template examples</a>.</p>
<p>You can also use the ELSER model via the Elasticsearch <code class="literal">_search</code> API <a href="/guide/en/elasticsearch/reference/8.9/semantic-search-elser.html#text-expansion-query" class="ulink" target="_blank" rel="noopener">using the text_expansion query</a>.
Using the <a href="/guide/en/kibana/8.9/console-kibana.html" class="ulink" target="_blank" rel="noopener">Kibana Dev Tools console</a>, or an API call on the <code class="literal">_search</code> endpoint, add the key <code class="literal">text_expansion</code> and set the <code class="literal">model_id</code> to the ELSER model under your fieldname.
The <code class="literal">model_text</code> field should be filled in with the text of your query you wish to perform text expansion on.</p>
<h2><a id="elser-limitations"></a>Limitations and notes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/8.9/enterprise-search-docs/elser-text-expansion.asciidoc">edit</a></h2>
<p>There are several caveats, limitations and notes to be aware of when using ELSER text expansion. These include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
When using a self-managed Elastic deployment, to deploy ELSER automatically your cluster must have access to download the ELSER model from Elastic.
Elastic Cloud deployments have access by default.
If your self-managed Elastic deployment does not have external internet access, you can still <a href="/guide/en/machine-learning/8.9/ml-nlp-elser.html#air-gapped-install" class="ulink" target="_blank" rel="noopener">deploy ELSER in an air-gapped environment</a>.
</li>
<li class="listitem">
ELSER works best on small-to-medium sized fields that contain natural language.
For connector or web crawler use cases, this aligns best with fields like <em>title</em>, <em>description</em>, <em>summary</em>, or <em>abstract</em>.
Be aware that ELSER encodes only the first 512 tokens of a field, so it may not be as good a match for <code class="literal">body_content</code> on web crawler documents, or <code class="literal">body</code> fields resulting from extracting text from office documents with connectors.
</li>
<li class="listitem">
Larger documents will take longer at ingestion time, and inference time per document will also increase the more fields in a document that need to be processed.
</li>
<li class="listitem">
The more fields your pipeline has to perform inference on, the longer it will take per document to ingest.
</li>
<li class="listitem">
Document enrichment only happens at ingestion time.
If you have an existing index that you wish to use ELSER text expansion on, you must re-ingest the data.
</li>
<li class="listitem">
Your results may produce high recall within your corpus.
For example, a single term might be expanded to two dozen or more synonyms for each term, whereas using BM25 relevancy ranking alone, the same term might expand to only 3 or 4 n-grams or stems.
A document will be considered a valid result if any of the inferred terms match between a query and a document, even if they&#8217;re both very low confidence.
To limit the results, you may want to implement a <code class="literal">min_score</code> constraint in your query.
</li>
<li class="listitem">
Explainability of text expanded queries are sub-optimal.
You can use the <code class="literal">_explain</code> API for text expansion queries, and it will tell you which expanded terms were found in both the document and the query along with the scoring information.
However, some of these terms won&#8217;t necessarily make sense at first glance.
For example, you might get a term expansion with a value of <code class="literal">##ing</code> (word ends in "ing") or <code class="literal">ch##</code> (word starts with "ch").
</li>
</ul>
</div>
<p>Furthermore, as ELSER is in technical preview, there are several current limitations of note:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The model will only provide inference across the first 512 tokens, per selected field, in your document.
</li>
<li class="listitem">
Multi-valued fields are not directly supported and require a preceding <a href="/guide/en/elasticsearch/reference/8.9/join-processor.html" class="ulink" target="_blank" rel="noopener">join processor</a> if you wish to use them.
For example, a document with the following field definition:
</li>
</ul>
</div>
<pre class="screen">{
  "field": ["some", "values"]
}</pre>
<p>does not work with ELSER.
If you have a multi-valued field such as this, you will want to put the field through a Join Processor within your pipeline first and then run ELSER inference on the joined field.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="document-enrichment.html">« Document enrichment with ML</a>
</span>
<span class="next">
<a href="engines.html">Indices, engines, meta engines, and content sources »</a>
</span>
</div>
</div>
</body>
</html>
