<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Elastic Confluence connector reference | Enterprise Search documentation [master] | Elastic</title>
<meta class="elastic" name="content" content="Elastic Confluence connector reference | Enterprise Search documentation [master]">

<link rel="home" href="index.html" title="Enterprise Search documentation [master]"/>
<link rel="up" href="connectors-references.html" title="Connectors references"/>
<link rel="prev" href="connectors-box.html" title="Elastic Box connector reference"/>
<link rel="next" href="connectors-dropbox.html" title="Elastic Dropbox connector reference"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Enterprise Search"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/master"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
<div id="related-products" class="dropdown">
<div class="related-products-title"></div>
<div class="dropdown-anchor" tabindex="0">Enterprise Search<span class="dropdown-icon"></span></div>
<div class="dropdown-content">
<ul>
<li class="dropdown-category">Enterprise Search guides</li>
<ul>
<li><a href="/guide/en/enterprise-search/current/index.html" target="_blank">Enterprise Search</a></li>
<li><a href="/guide/en/app-search/current/index.html" target="_blank">App Search</a></li>
<li><a href="/guide/en/workplace-search/current/index.html" target="_blank">Workplace Search</a></li>
</ul>
<li class="dropdown-category">Programming language clients</li>
<ul>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/enterprise-search-node/current/index.html" target="_blank">Node.js client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/php/current/index.html" target="_blank">PHP client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/python/current/index.html" target="_blank">Python client</a></li>
<li><a href="https://www.elastic.co/guide/en/enterprise-search-clients/ruby/current/index.html" target="_blank">Ruby client</a></li>
</ul>
</ul>
</div>
</div>
</span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="connectors-references.html">Connectors references</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="connectors-box.html">« Elastic Box connector reference</a>
</span>
<span class="next">
<a href="connectors-dropbox.html">Elastic Dropbox connector reference »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="connectors-confluence"></a>Elastic Confluence connector reference<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h2>
</div></div></div>

<p>The <em>Elastic Confluence connector</em> is a <a class="xref" href="connectors.html" title="Elastic connectors">connector</a> for <a href="https://www.atlassian.com/software/confluence" class="ulink" target="_blank" rel="noopener">Atlassian Confluence</a>.
This connector is written in Python using the <a href="https://github.com/elastic/connectors/tree/main" class="ulink" target="_blank" rel="noopener">Elastic connector framework</a>.</p>
<p>View the <a href="https://github.com/elastic/connectors/tree/main/connectors/sources/confluence.py" class="ulink" target="_blank" rel="noopener"><span class="strong strong"><strong>source code</strong></span> for this connector</a> (branch <em>main</em>, compatible with Elastic <em>8.14</em>).</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Choose your connector reference</strong></p>
</div></div></div>
<p>Are you using a native connector on Elastic Cloud or a self-managed connector client? Expand the documentation based on your deployment method.</p>
</div>
<h3><a id="connectors-confluence-native-connector-reference"></a><span class="strong strong"><strong>Native connector (Elastic Cloud)</strong></span><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h3>
<details>
<summary class="title">View <span class="strong strong"><strong>native connector</strong></span> reference</summary>
<div class="content">
<h4><a id="connectors-confluence-availability-prerequisites"></a>Availability and prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>This connector is available as a <span class="strong strong"><strong>native connector</strong></span> on Elastic Cloud, as of <span class="strong strong"><strong>8.9.1</strong></span>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Confluence Data Center support was added in 8.13.0 in technical preview and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Technical preview features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>To use this connector natively in Elastic Cloud, satisfy all <a class="xref" href="native-connectors.html#native-connectors-prerequisites" title="Availability and prerequisites">native connector requirements</a>.</p>
<h4><a id="connectors-confluence-create-native-connector"></a>Create a Confluence connector<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<h5><a id="connectors-confluence-create-use-the-ui"></a>Use the UI<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h5>
<p>To create a new Confluence connector:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Search &#8594; Connectors</strong></span> page in the Kibana UI.
</li>
<li class="listitem">
Follow the instructions to create a new native  <span class="strong strong"><strong>Confluence</strong></span> connector.
</li>
</ol>
</div>
<p>For additional operations, see <a class="xref" href="connectors-usage.html" title="Using connectors"><em>Using connectors</em></a>.</p>
<h5><a id="connectors-confluence-create-use-the-api"></a>Use the API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h5>
<p>You can use the Elasticsearch <a href="/guide/en/elasticsearch/reference/master/connector-apis.html" class="ulink" target="_top">Create connector API</a> to create a new native Confluence connector.</p>
<p>For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _connector/&lt;my-confluence-connector&gt;
{
  "index_name": "&lt;my-elasticsearch-index&gt;",
  "name": "Content synced from Confluence",
  "service_type": "confluence",
  "is_native": "true"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/16.console"></div>
<details>
<summary class="title">You&#8217;ll also need to <span class="strong strong"><strong>create an API key</strong></span> for the connector to use.</summary>
<div class="content">
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The user needs the cluster privileges <code class="literal">manage_api_key</code> and <code class="literal">write_connector_secrets</code> to generate API keys programmatically.</p>
</div>
</div>
<p>To create an API key for the connector:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Run the following command, replacing values where indicated.
Note the <code class="literal">id</code> and <code class="literal">encoded</code> return values from the response:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/api_key
{
  "name": "&lt;connector_name&gt;-connector-api-key",
  "role_descriptors": {
    "&lt;connector_name&gt;-connector-role": {
      "cluster": [
        "monitor"
      ],
      "indices": [
        {
          "names": [
            "&lt;index_name&gt;",
            ".search-acl-filter-&lt;index_name&gt;",
            ".elastic-connectors-v1*"
          ],
          "privileges": [
            "all"
          ],
          "allow_restricted_indices": false
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/17.console"></div>
</li>
<li class="listitem">
<p>Use the <code class="literal">encoded</code> value to store a connector secret, and note the <code class="literal">id</code> return value from this response:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _connector/_secret
{
  "value": &lt;encoded_api_key&gt;
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/18.console"></div>
</li>
<li class="listitem">
<p>Use the API key <code class="literal">id</code> and the connector secret <code class="literal">id</code> to update the connector:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /_connector/&lt;connector_id&gt;/_api_key_id
{
  "api_key_id": "&lt;API key id&gt;",
  "api_key_secret_id": "&lt;secret id&gt;"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/19.console"></div>
</li>
</ol>
</div>
</div>
</details>
<p>Refer to the <a href="/guide/en/elasticsearch/reference/master/connector-apis.html" class="ulink" target="_top">Elasticsearch API documentation</a> for details of all available Connector APIs.</p>
<h4><a id="connectors-confluence-usage"></a>Usage<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>To use this connector as a <span class="strong strong"><strong>native connector</strong></span>, see <a class="xref" href="connectors.html#connectors-native" title="Native connectors (managed service)">Native connectors <span class="image"><a class="image" href="https://www.elastic.co/cloud/elasticsearch-service/signup?page=docs&amp;placement=docs-body"><img src="https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg" alt="logo cloud" title="Supported on Elasticsearch Service"></a></span> (<em>managed service</em>)</a>.</p>
<p>For additional operations, see <a class="xref" href="connectors-usage.html" title="Using connectors"><em>Using connectors</em></a>.</p>
<h4><a id="connectors-confluence-compatability"></a>Compatibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Confluence Cloud or Confluence Server/Data Center <span class="strong strong"><strong>versions 7 or later</strong></span>.
</li>
</ul>
</div>
<h4><a id="connectors-confluence-configuration"></a>Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>The following configuration fields are required to set up the connector:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Confluence data source
</span>
</dt>
<dd>
Dropdown to determine the Confluence platform type: <code class="literal">Confluence Cloud</code>, <code class="literal">Confluence Server</code>, or <code class="literal">Confluence Data Center</code>. Default value is <code class="literal">Confluence Server</code>.
</dd>
<dt>
<span class="term">
Confluence Data Center username
</span>
</dt>
<dd>
The username of the account for Confluence Data Center.
</dd>
<dt>
<span class="term">
Confluence Data Center password
</span>
</dt>
<dd>
The password of the account to be used for the Confluence Data Center.
</dd>
<dt>
<span class="term">
Confluence Server username
</span>
</dt>
<dd>
The username of the account for Confluence server.
</dd>
<dt>
<span class="term">
Confluence Server password
</span>
</dt>
<dd>
The password of the account to be used for Confluence Server.
</dd>
<dt>
<span class="term">
Confluence Cloud account email
</span>
</dt>
<dd>
The account email for Confluence Cloud.
</dd>
<dt>
<span class="term">
Confluence Cloud API token
</span>
</dt>
<dd>
The API Token to authenticate with Confluence cloud.
</dd>
<dt>
<span class="term">
Confluence URL label
</span>
</dt>
<dd>
<p>
The domain where the Confluence is hosted. Examples:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">https://192.158.1.38:8080/</code>
</li>
<li class="listitem">
<code class="literal">https://test_user.atlassian.net/</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Confluence space keys
</span>
</dt>
<dd>
<p>
Comma-separated list of <a href="https://confluence.atlassian.com/doc/space-keys-829076188.html" class="ulink" target="_top">Space Keys</a> to fetch data from Confluence server or cloud. If the value is <code class="literal">*</code>, the connector will fetch data from all spaces present in the configured <code class="literal">spaces</code>. Default value is <code class="literal">*</code>. Examples:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">EC</code>, <code class="literal">TP</code>
</li>
<li class="listitem">
<code class="literal">*</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Enable SSL
</span>
</dt>
<dd>
Whether SSL verification will be enabled. Default value is <code class="literal">False</code>.
</dd>
<dt>
<span class="term">
SSL certificate
</span>
</dt>
<dd>
<p>
Content of SSL certificate. Note: If <code class="literal">ssl_enabled</code> is <code class="literal">False</code>, the value in this field is ignored. Example certificate:
</p>
<pre class="screen">-----BEGIN CERTIFICATE-----
MIID+jCCAuKgAwIBAgIGAJJMzlxLMA0GCSqGSIb3DQEBCwUAMHoxCzAJBgNVBAYT
...
7RhLQyWn2u00L7/9Omw=
-----END CERTIFICATE-----</pre>
</dd>
<dt>
<span class="term">
Enable document level security
</span>
</dt>
<dd>
Toggle to enable <a class="xref" href="dls.html" title="Document level security">document level security (DLS)</a>.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>DLS is only available for Atlassian Confluence Cloud.</p>
</div>
</div>
<p>+
When enabled, full syncs will fetch access control lists for each document and store them in the <code class="literal">_allow_access_control</code> field.
Access control syncs will fetch users' access control lists and store them in a separate index.</p>
<p>+</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To access user data in Jira Administration, the account you created must be granted <span class="strong strong"><strong>Product Access</strong></span> for Jira Administration.
This access needs to be provided by an administrator from the <a href="http://admin.atlassian.com/" class="ulink" target="_top">Atlassian Admin</a>, and the access level granted should be <code class="literal">Product Admin</code>.</p>
</div>
</div>
<h4><a id="connectors-confluence-documents-syncs"></a>Documents and syncs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>The connector syncs the following Confluence object types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Pages
</li>
<li class="listitem">
Spaces
</li>
<li class="listitem">
Blog Posts
</li>
<li class="listitem">
Attachments
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Files bigger than 10 MB won&#8217;t be extracted
</li>
<li class="listitem">
Permissions are not synced by default.
You must first enable <a class="xref" href="connectors-confluence.html#connectors-confluence-client-document-level-security" title="Document level security">DLS</a>.
Otherwise, <span class="strong strong"><strong>all documents</strong></span> indexed to an Elastic deployment will be visible to <span class="strong strong"><strong>all users with access</strong></span> to that Elastic Deployment.
</li>
</ul>
</div>
</div>
</div>
<h4><a id="connectors-confluence-sync-rules"></a>Sync rules<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p><a class="xref" href="sync-rules.html#sync-rules-basic" title="Basic sync rules">Basic sync rules</a> are identical for all connectors and are available by default.</p>
<p>This connector supports <a class="xref" href="sync-rules.html#sync-rules-advanced" title="Advanced sync rules">advanced sync rules</a> for remote filtering.
These rules cover complex query-and-filter scenarios that cannot be expressed with &lt;basic sync rules.
Advanced sync rules are defined through a source-specific DSL JSON snippet.</p>
<h5><a id="connectors-confluence-sync-rules-examples"></a>Advanced sync rules examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h5>
<p><span class="strong strong"><strong>Example 1</strong></span>: Query for indexing data that is in a particular <span class="strong strong"><strong>Space</strong></span> with key <em>DEV</em>.</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
  {
    "query": "space = DEV"
  }
]</pre>
</div>
<p><span class="strong strong"><strong>Example 2</strong></span>: Queries for indexing data based on <code class="literal">created</code> and <code class="literal">lastmodified</code> time.</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
  {
    "query": "created &gt;= now('-5w')"
  },
  {
    "query": "lastmodified &lt; startOfYear()"
  }
]</pre>
</div>
<p><span class="strong strong"><strong>Example 3</strong></span>: Query for indexing only given types in a <span class="strong strong"><strong>Space</strong></span> with key <em>SD</em>.</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
  {
    "query": "type in ('page', 'attachment') AND space.key = 'SD'"
  }
]</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Syncing recently created/updated items in Confluence may be delayed when using advanced sync rules, because the search endpoint used for CQL queries returns stale results in the response.
For more details refer to the following issue in the <a href="https://jira.atlassian.com/browse/CONFCLOUD-73997" class="ulink" target="_blank" rel="noopener">Confluence documentation</a>.</p>
</div>
</div>
<h4><a id="connectors-confluence-document-level-security"></a>Document level security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>DLS is only available for Atlassian Confluence Cloud.</p>
</div>
</div>
<p>Document level security (DLS) enables you to restrict access to documents based on a user’s permissions.
Refer to <a class="xref" href="connectors-confluence.html#connectors-confluence-configuration" title="Configuration">configuration</a> on this page for how to enable DLS for this connector.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a class="xref" href="dls-e2e-guide.html" title="Leverage document-level security from connectors in Search Applications">DLS in Search Applications</a> to learn how to ingest data from a connector with DLS enabled, when building a search application.
The example uses SharePoint Online as the data source, but the same steps apply to every connector.</p>
</div>
</div>
<h4><a id="connectors-confluence-content-extraction"></a>Content Extraction<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-content-extraction.html" title="Content extraction">Content extraction</a>.</p>
<h4><a id="connectors-confluence-known-issues"></a>Known issues<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>There are currently no known issues for this connector.
Refer to <a class="xref" href="connectors-known-issues.html" title="Connector known issues"><em>Known issues</em></a> for a list of known issues for all connectors.</p>
<h4><a id="connectors-confluence-troubleshooting"></a>Troubleshooting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-troubleshooting.html" title="Troubleshooting connectors">Troubleshooting</a>.</p>
<h4><a id="connectors-confluence-security"></a>Security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-security.html" title="Connectors security">Security</a>.</p>
</div>
</details>
<h3><a id="connectors-confluence-connector-client-reference"></a><span class="strong strong"><strong>Connector client (self-managed)</strong></span><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h3>
<details>
<summary class="title">View <span class="strong strong"><strong>connector client</strong></span> reference</summary>
<div class="content">
<h4><a id="connectors-confluence-client-availability-prerequisites"></a>Availability and prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>This connector is available as a <span class="strong strong"><strong>connector client</strong></span> using the <span class="strong strong"><strong>Elastic connector framework</strong></span>.
This connector client is compatible with Elastic versions <span class="strong strong"><strong>8.7.0+</strong></span>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Confluence Data Center support was added in 8.13.0 in technical preview and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Technical preview features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>To use this connector, satisfy all <a class="xref" href="build-connector.html" title="Connector clients (self-managed)">connector client requirements</a>.</p>
<h4><a id="connectors-confluence-create-connector-client"></a>Create a Confluence connector<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<h5><a id="connectors-confluence-client-create-use-the-ui"></a>Use the UI<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h5>
<p>To create a new Confluence connector:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Search &#8594; Connectors</strong></span> page in the Kibana UI.
</li>
<li class="listitem">
Follow the instructions to create a new  <span class="strong strong"><strong>Confluence</strong></span> connector client.
</li>
</ol>
</div>
<p>For additional operations, see <a class="xref" href="connectors-usage.html" title="Using connectors"><em>Using connectors</em></a>.</p>
<h5><a id="connectors-confluence-client-create-use-the-api"></a>Use the API<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h5>
<p>You can use the Elasticsearch <a href="/guide/en/elasticsearch/reference/master/connector-apis.html" class="ulink" target="_top">Create connector API</a> to create a new self-managed Confluence connector client.</p>
<p>For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _connector/my-confluence-connector
{
  "index_name": "my-elasticsearch-index",
  "name": "Content synced from Confluence",
  "service_type": "confluence"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/20.console"></div>
<details>
<summary class="title">You&#8217;ll also need to <span class="strong strong"><strong>create an API key</strong></span> for the connector to use.</summary>
<div class="content">
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The user needs the cluster privileges <code class="literal">manage_api_key</code> and <code class="literal">write_connector_secrets</code> to generate API keys programmatically.</p>
</div>
</div>
<p>To create an API key for the connector:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Run the following command, replacing values where indicated.
Note the <code class="literal">encoded</code> return values from the response:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /_security/api_key
{
  "name": "&lt;connector_name&gt;-connector-api-key",
  "role_descriptors": {
    "&lt;connector_name&gt;-connector-role": {
      "cluster": [
        "monitor"
      ],
      "indices": [
        {
          "names": [
            "&lt;index_name&gt;",
            ".search-acl-filter-&lt;index_name&gt;",
            ".elastic-connectors-v1*"
          ],
          "privileges": [
            "all"
          ],
          "allow_restricted_indices": false
        }
      ]
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/21.console"></div>
</li>
<li class="listitem">
Update your <code class="literal">config.yml</code> file with the API key <code class="literal">encoded</code> value.
</li>
</ol>
</div>
</div>
</details>
<p>Refer to the <a href="/guide/en/elasticsearch/reference/master/connector-apis.html" class="ulink" target="_top">Elasticsearch API documentation</a> for details of all available Connector APIs.</p>
<h4><a id="connectors-confluence-client-usage"></a>Usage<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>To use this connector as a <span class="strong strong"><strong>connector client</strong></span>, see <a class="xref" href="build-connector.html" title="Connector clients (self-managed)"><em>Connector clients (self-managed)</em></a>
For additional usage operations, see <a class="xref" href="connectors-usage.html" title="Using connectors"><em>Using connectors</em></a>.</p>
<h4><a id="connectors-confluence-client-compatability"></a>Compatibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Confluence Cloud or Confluence Server/Data Center <span class="strong strong"><strong>versions 7 or later</strong></span>
</li>
</ul>
</div>
<h4><a id="connectors-confluence-client-configuration"></a>Configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using the <a class="xref" href="build-connector.html" title="Connector clients (self-managed)">connector client</a> workflow, initially these fields will use the default configuration set in the <a href="https://github.com/elastic/connectors/tree/main/connectors/sources/confluence.py" class="ulink" target="_blank" rel="noopener">connector source code</a>.
These are set in the <code class="literal">get_default_configuration</code> function definition.</p>
<p>These configurable fields will be rendered with their respective <span class="strong strong"><strong>labels</strong></span> in the Kibana UI.
Once connected, you&#8217;ll be able to update these values in Kibana.</p>
</div>
</div>
<p>The following configuration fields are required to set up the connector:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">data_source</code>
</span>
</dt>
<dd>
Dropdown to determine the Confluence platform type: <code class="literal">Confluence Cloud</code>, <code class="literal">Confluence Server</code>, or <code class="literal">Confluence Data Center</code>. Default value is <code class="literal">Confluence Server</code>.
</dd>
<dt>
<span class="term">
<code class="literal">data_center_username</code>
</span>
</dt>
<dd>
The username of the account for Confluence Data Center.
</dd>
<dt>
<span class="term">
<code class="literal">data_center_password</code>
</span>
</dt>
<dd>
The password of the account to be used for the Confluence Data Center.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
The username of the account for Confluence Server.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
The password of the account to be used for the Confluence server.
</dd>
<dt>
<span class="term">
<code class="literal">account_email</code>
</span>
</dt>
<dd>
The account email for the Confluence Cloud.
</dd>
<dt>
<span class="term">
<code class="literal">api_token</code>
</span>
</dt>
<dd>
The API Token to authenticate with Confluence Cloud.
</dd>
<dt>
<span class="term">
<code class="literal">confluence_url</code>
</span>
</dt>
<dd>
<p>
The domain where the Confluence instance is hosted. Examples:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">https://192.158.1.38:8080/</code>
</li>
<li class="listitem">
<code class="literal">https://test_user.atlassian.net/</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">spaces</code>
</span>
</dt>
<dd>
<p>
Comma-separated list of <a href="https://confluence.atlassian.com/doc/space-keys-829076188.html" class="ulink" target="_top">Space Keys</a> to fetch data from Confluence. If the value is <code class="literal">*</code>, the connector will fetch data from all spaces present in the configured <code class="literal">spaces</code>. Default value is <code class="literal">*</code>. Examples:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">EC</code>, <code class="literal">TP</code>
</li>
<li class="listitem">
<code class="literal">*</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">ssl_enabled</code>
</span>
</dt>
<dd>
Whether SSL verification will be enabled. Default value is <code class="literal">False</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ssl_ca</code>
</span>
</dt>
<dd>
<p>
Content of SSL certificate. Note: If <code class="literal">ssl_enabled</code> is <code class="literal">False</code>, the value in this field is ignored. Example certificate:
</p>
<pre class="screen">-----BEGIN CERTIFICATE-----
MIID+jCCAuKgAwIBAgIGAJJMzlxLMA0GCSqGSIb3DQEBCwUAMHoxCzAJBgNVBAYT
...
7RhLQyWn2u00L7/9Omw=
-----END CERTIFICATE-----</pre>
</dd>
<dt>
<span class="term">
<code class="literal">retry_count</code>
</span>
</dt>
<dd>
The number of retry attempts after failed request to Confluence. Default value is <code class="literal">3</code>.
</dd>
<dt>
<span class="term">
<code class="literal">concurrent_downloads</code>
</span>
</dt>
<dd>
The number of concurrent downloads for fetching the attachment content. This speeds up the content extraction of attachments. Defaults to <code class="literal">50</code>.
</dd>
<dt>
<span class="term">
<code class="literal">use_document_level_security</code>
</span>
</dt>
<dd>
<p>
Toggle to enable <a class="xref" href="dls.html" title="Document level security">document level security (DLS)</a>.
Only available for Atlassian Confluence Cloud.
When enabled, full syncs will fetch access control lists for each document and store them in the <code class="literal">_allow_access_control</code> field.
Access control syncs will fetch users' access control lists and store them in a separate index.
</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To access user data in Jira Administration, the account you created must be granted <span class="strong strong"><strong>Product Access</strong></span> for Jira Administration.
This access needs to be provided by an administrator from the <a href="http://admin.atlassian.com/" class="ulink" target="_top">Atlassian Admin</a>, and the access level granted should be <code class="literal">Product Admin</code>.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">use_text_extraction_service</code>
</span>
</dt>
<dd>
Toggle to enable the local text extraction service. Default value is <code class="literal">False</code>.
Requires a separate deployment of the Elastic Text Extraction Service.
Requires that ingest pipeline settings disable text extraction.
</dd>
</dl>
</div>
<h4><a id="connectors-confluence-client-docker"></a>Deployment using Docker<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>You can deploy the Confluence connector as a self-managed connector client using Docker.
Follow these instructions.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Step 1: Download sample configuration file</strong></span></summary>
<div class="content">
<p>Download the sample configuration file.
You can either download it manually or run the following command:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl https://raw.githubusercontent.com/elastic/connectors/main/config.yml.example --output ~/connectors-config/config.yml</pre>
</div>
<p>Remember to update the <code class="literal">--output</code> argument value if your directory name is different, or you want to use a different config file name.</p>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>Step 2: Update the configuration file for your self-managed connector</strong></span></summary>
<div class="content">
<p>Update the configuration file with the following settings to match your environment:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">elasticsearch.host</code>
</li>
<li class="listitem">
<code class="literal">elasticsearch.api_key</code>
</li>
<li class="listitem">
<code class="literal">connectors</code>
</li>
</ul>
</div>
<p>If you&#8217;re running the connector service against a Dockerized version of Elasticsearch and Kibana, your config file will look like this:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml"># When connecting to your cloud deployment you should edit the host value
elasticsearch.host: http://host.docker.internal:9200
elasticsearch.api_key: &lt;ELASTICSEARCH_API_KEY&gt;

connectors:
  -
    connector_id: &lt;CONNECTOR_ID_FROM_KIBANA&gt;
    service_type: confluence
    api_key: &lt;CONNECTOR_API_KEY_FROM_KIBANA&gt;</pre>
</div>
<p>Using the <code class="literal">elasticsearch.api_key</code> is the recommended authentication method. However, you can also use <code class="literal">elasticsearch.username</code> and <code class="literal">elasticsearch.password</code> to authenticate with your Elasticsearch instance.</p>
<p>Note: You can change other default configurations by simply uncommenting specific settings in the configuration file and modifying their values.</p>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>Step 3: Run the Docker image</strong></span></summary>
<div class="content">
<p>Run the Docker image with the Connector Service using the following command:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run \
-v ~/connectors-config:/config \
--network "elastic" \
--tty \
--rm \
docker.elastic.co/enterprise-search/elastic-connectors:8.14.0.0 \
/app/bin/elastic-ingest \
-c /config/config.yml</pre>
</div>
</div>
</details>
<p>Refer to <a href="https://github.com/elastic/connectors/tree/main/docs/DOCKER.md" class="ulink" target="_blank" rel="noopener"><code class="literal">DOCKER.md</code></a> in the <code class="literal">elastic/connectors</code> repo for more details.</p>
<p>Find all available Docker images in the <a href="https://www.docker.elastic.co/r/enterprise-search/elastic-connectors" class="ulink" target="_top">official registry</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>We also have a quickstart self-managed option using Docker Compose, so you can spin up all required services at once: Elasticsearch, Kibana, and the connectors service.
Refer to this <a href="https://github.com/elastic/connectors/tree/main/scripts/stack#readme" class="ulink" target="_top">README</a> in the <code class="literal">elastic/connectors</code> repo for more information.</p>
</div>
</div>
<h4><a id="connectors-confluence-client-documents-syncs"></a>Documents and syncs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>The connector syncs the following Confluence object types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Pages
</li>
<li class="listitem">
Spaces
</li>
<li class="listitem">
Blog Posts
</li>
<li class="listitem">
Attachments
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Content of files bigger than 10 MB won&#8217;t be extracted.
</li>
<li class="listitem">
Permissions are not synced. <span class="strong strong"><strong>All documents</strong></span> indexed to an Elastic deployment will be visible to <span class="strong strong"><strong>all users with access</strong></span> to that Elastic Deployment.
</li>
</ul>
</div>
</div>
</div>
<h4><a id="connectors-confluence-client-sync-rules"></a>Sync rules<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p><a class="xref" href="sync-rules.html#sync-rules-basic" title="Basic sync rules">Basic sync rules</a> are identical for all connectors and are available by default.</p>
<p>This connector supports <a class="xref" href="sync-rules.html#sync-rules-advanced" title="Advanced sync rules">advanced sync rules</a> for remote filtering.
These rules cover complex query-and-filter scenarios that cannot be expressed with &lt;basic sync rules.
Advanced sync rules are defined through a source-specific DSL JSON snippet.</p>
<h5><a id="connectors-confluence-client-sync-rules-examples"></a>Advanced sync rules examples<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h5>
<p><span class="strong strong"><strong>Example 1</strong></span>: Query for indexing data that is in a particular <span class="strong strong"><strong>Space</strong></span> with key <em>DEV</em>.</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
  {
    "query": "space = DEV"
  }
]</pre>
</div>
<p><span class="strong strong"><strong>Example 2</strong></span>: Queries for indexing data based on <code class="literal">created</code> and <code class="literal">lastmodified</code> time.</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
  {
    "query": "created &gt;= now('-5w')"
  },
  {
    "query": "lastmodified &lt; startOfYear()"
  }
]</pre>
</div>
<p><span class="strong strong"><strong>Example 3</strong></span>: Query for indexing only given types in a <span class="strong strong"><strong>Space</strong></span> with key <em>SD</em>.</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
  {
    "query": "type in ('page', 'attachment') AND space.key = 'SD'"
  }
]</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Syncing recently created/updated items in Confluence may be delayed when using advanced sync rules, because the search endpoint used for CQL queries returns stale results in the response.
For more details refer to the following issue in the <a href="https://jira.atlassian.com/browse/CONFCLOUD-73997" class="ulink" target="_blank" rel="noopener">Confluence documentation</a>.</p>
</div>
</div>
<h4><a id="connectors-confluence-client-document-level-security"></a>Document level security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>DLS is only available for Atlassian Confluence Cloud.</p>
</div>
</div>
<p>Document level security (DLS) enables you to restrict access to documents based on a user’s permissions.
Refer to <a class="xref" href="connectors-confluence.html#connectors-confluence-client-configuration" title="Configuration">configuration</a> on this page for how to enable DLS for this connector.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a class="xref" href="dls-e2e-guide.html" title="Leverage document-level security from connectors in Search Applications">DLS in Search Applications</a> to learn how to ingest data from a connector with DLS enabled, when building a search application.
The example uses SharePoint Online as the data source, but the same steps apply to every connector.</p>
</div>
</div>
<h4><a id="connectors-confluence-client-content-extraction"></a>Content Extraction<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-content-extraction.html" title="Content extraction">Content extraction</a>.</p>
<h4><a id="connectors-confluence-client-connector-client-operations"></a>Connector client operations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<h4><a id="connectors-confluence-client-testing"></a>End-to-end testing<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>The connector framework enables operators to run functional tests against a real data source.
Refer to <a class="xref" href="build-connector.html#build-connector-testing" title="Connector testing">Connector testing</a> for more details.</p>
<p>To perform E2E testing for the Confluence connector, run the following command:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">$ make ftest NAME=confluence</pre>
</div>
<p>For faster tests, add the <code class="literal">DATA_SIZE=small</code> flag:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">make ftest NAME=confluence DATA_SIZE=small</pre>
</div>
<h4><a id="connectors-confluence-client-known-issues"></a>Known issues<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>There are currently no known issues for this connector.
Refer to <a class="xref" href="connectors-known-issues.html" title="Connector known issues"><em>Known issues</em></a> for a list of known issues for all connectors.</p>
<h4><a id="connectors-confluence-client-troubleshooting"></a>Troubleshooting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-troubleshooting.html" title="Troubleshooting connectors">Troubleshooting</a>.</p>
<h4><a id="connectors-confluence-client-security"></a>Security<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-confluence.asciidoc">edit</a></h4>
<p>See <a class="xref" href="connectors-security.html" title="Connectors security">Security</a>.</p>
</div>
</details>
</div>
<div class="navfooter">
<span class="prev">
<a href="connectors-box.html">« Elastic Box connector reference</a>
</span>
<span class="next">
<a href="connectors-dropbox.html">Elastic Dropbox connector reference »</a>
</span>
</div>
</div>
</body>
</html>
