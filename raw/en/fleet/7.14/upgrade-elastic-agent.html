<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upgrade Elastic Agent | Fleet and Elastic Agent Guide [7.14] | Elastic</title>
<meta class="elastic" name="content" content="Upgrade Elastic Agent | Fleet and Elastic Agent Guide [7.14]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [7.14]"/>
<link rel="up" href="elastic-agent-installation-configuration.html" title="Elastic Agents"/>
<link rel="prev" href="running-on-kubernetes-standalone.html" title="Run Elastic Agent standalone on Kubernetes"/>
<link rel="next" href="start-elastic-agent.html" title="Start Elastic Agent"/>
<meta class="elastic" name="product_version" content="7.14"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/7.14"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="7.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [7.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="elastic-agent-installation-configuration.html">Elastic Agents</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="running-on-kubernetes-standalone.html">« Run Elastic Agent standalone on Kubernetes</a>
</span>
<span class="next">
<a href="start-elastic-agent.html">Start Elastic Agent »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="upgrade-elastic-agent"></a>Upgrade Elastic Agent<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/7.14/docs/en/ingest-management/elastic-agent/upgrade-elastic-agent.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<h4><a id="upgrade-agent"></a>Upgrade Fleet-managed Elastic Agents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/7.14/docs/en/ingest-management/elastic-agent/upgrade-elastic-agent.asciidoc">edit</a></h4>
<p>Starting with version 7.10, Fleet provides upgrade capabilities. You can view
and select agents that are out of date, and trigger selected agents to download,
install, and run the new version.</p>
<p>This approach simplifies the process of keeping your agents up to date. It also
saves you time because you don’t need third-party tools or processes to
manage upgrades.</p>
<p>Elastic Agents require internet access to perform binary upgrades from Fleet.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The upgrade feature is not supported for upgrading DEB/RPM packages or
Docker images.</p>
</div>
</div>
<p>To upgrade Elastic Agent to a new version:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, select <span class="strong strong"><strong>Agents</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Agents</strong></span>, click <span class="strong strong"><strong>Upgrade available</strong></span> to see a list of agents
that you can upgrade.
</li>
<li class="listitem">
<p>To upgrade a single agent, choose <span class="strong strong"><strong>Upgrade agent</strong></span> from the <span class="strong strong"><strong>Actions</strong></span> menu
next to the agent you want to upgrade.</p>
<p>The <span class="strong strong"><strong>Upgrade agent</strong></span> option is grayed out when an upgrade is unavailable, or
the Kibana version is lower than the agent version.</p>
</li>
<li class="listitem">
<p>To upgrade multiple agents, bulk select the agents and click
<span class="strong strong"><strong>Upgrade agents</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-agents.png" alt="Upgrade menu for bulk upgrade in Fleet">
</div>
</div>
</li>
</ol>
</div>
<h4><a id="upgrade-standalone"></a>Upgrade standalone agents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/7.14/docs/en/ingest-management/elastic-agent/upgrade-elastic-agent.asciidoc">edit</a></h4>
<p>To upgrade a standalone agent running on an edge node:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Make sure the <code class="literal">elastic-agent</code> service is running.
</li>
<li class="listitem">
<p>From the directory where Elastic Agent is installed, run the <code class="literal">upgrade</code> command to
upgrade to a new version. Not sure where the agent is
installed? See <a class="xref" href="elastic-agent-installation.html#installation-layout" title="Installation layout">Installation layout</a>.</p>
<p>For example, on macOS, to upgrade the agent from version 7.10.0 to 7.10.1, you
would run:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">cd /Library/Elastic/Agent/
sudo elastic-agent upgrade 7.10.1</pre>
</div>
</li>
</ol>
</div>
<p>For more command-line options, see the help for the
<a class="xref" href="elastic-agent-cmd-options.html#elastic-agent-upgrade-command" title="elastic-agent upgrade"><code class="literal">upgrade</code></a> command.</p>
<h4><a id="upgrade-7.12-lower"></a>Upgrade from 7.12 or lower<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/7.14/docs/en/ingest-management/elastic-agent/upgrade-elastic-agent.asciidoc">edit</a></h4>
<p>As part of the 7.13 release, we introduce <a class="xref" href="fleet-server.html" title="Fleet Server">Fleet Server</a>,
a mechanism to connect your Elastic Agents to Fleet.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you upgrade to 7.13 from 7.12 or lower, please note the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
All of your existing Elastic Agents will be automatically unenrolled from Fleet and will stop sending data.
</li>
<li class="listitem">
Before you can add your Elastic Agents again to Fleet, you must have Fleet Server running.
</li>
<li class="listitem">
All of your policies will be migrated.
</li>
</ul>
</div>
</div>
</div>
<h5><a id="fleet-prereqs-upgrade"></a>Prerequisite<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/7.14/docs/en/ingest-management/elastic-agent/upgrade-elastic-agent.asciidoc">edit</a></h5>
<p>You must upgrade your deployment to 7.13. If your deployment is running in our <a href="/cloud/elasticsearch-service?page=docs&amp;placement=docs-body" class="ulink" target="_top">hosted Elasticsearch Service</a>
on Elastic Cloud, see <a href="/guide/en/cloud/current/ec-upgrade-deployment.html" class="ulink" target="_top">Upgrade versions</a>. If you are running a self-managed
deployment, see <a href="/guide/en/elastic-stack/7.14/upgrading-elastic-stack.html" class="ulink" target="_top">Upgrading the Elastic Stack</a>.</p>
<h5><a id="set-up-fleet-server"></a>Step 1: Set up Fleet Server<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/7.14/docs/en/ingest-management/elastic-agent/upgrade-elastic-agent.asciidoc">edit</a></h5>
<p>Here’s what you need to set up Fleet Server for each deployment type:</p>
<div class="tabs" data-tab-group="upgrade-fleet">
  <div role="tablist" aria-label="Upgrade">
    <button role="tab"
            aria-selected="true"
            aria-controls="cloud-tab-upgrade"
            id="cloud-upgrade">
      Elasticsearch Service
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="self-managed-tab-upgrade"
            id="self-managed-upgrade"
            tabindex="-1">
      Self-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="cloud-tab-upgrade"
       aria-labelledby="cloud-upgrade">
<p>Elastic Cloud runs a hosted version of Fleet Server.</p>
<p>To confirm that Fleet Server is available in your deployment:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to Kibana and go to <span class="strong strong"><strong>Management &gt; Fleet</strong></span>, and click the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
<p>The following message is displayed. Please note that your Elastic Agents have now
been unenrolled and have stopped sending data.</p>
<p>Select <span class="strong strong"><strong>Do not show this message again</strong></span>, and then click <span class="strong strong"><strong>Close and get started</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-server-prompt.png" alt="Add Fleet Server prompt">
</div>
</div>
<p>If your previous deployment did not include an APM node, you are prompted to enable <span class="strong strong"><strong>APM &amp; Fleet</strong></span>,
required for using Fleet Server.</p>
<p>Click <span class="strong strong"><strong>Edit deployment</strong></span> and add an <span class="strong strong"><strong>APM &amp; Fleet</strong></span> node to your deployment.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/apm-fleet-prompt.png" alt="Add APM &amp; Fleet node prompt">
</div>
</div>
</li>
<li class="listitem">
To confirm that Fleet Server is available in your deployment, click the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Policies</strong></span>, select the <span class="strong strong"><strong>Elastic Cloud agent policy</strong></span> to confirm that Fleet Server
is listed. This policy is managed by Elastic Cloud and can not be modified.</p>
<p>You are now able to install and enroll subsequent Elastic Agents with Fleet Server.</p>
</li>
</ol>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="self-managed-tab-upgrade"
       aria-labelledby="self-managed-upgrade"
       hidden="">
<p>To upgrade to Fleet Server:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to Kibana and go to <span class="strong strong"><strong>Management &gt; Fleet</strong></span>.
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
<p>The following message is displayed. Please note that your Elastic Agents have now
been unenrolled and have stopped sending data.</p>
<p>Select <span class="strong strong"><strong>Do not show this message again</strong></span>, and then click <span class="strong strong"><strong>Close and get started</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-server-prompt-managed.png" alt="Add Fleet Server prompt">
</div>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Fleet settings</strong></span>, and in the <span class="strong strong"><strong>Fleet Server hosts</strong></span> field, enter the
URLs Elastic Agents will use to connect to Fleet Server. For example,
<code class="literal">https://192.0.2.1:8220</code>, where <code class="literal">192.0.2.1</code> is the host IP where you will
install Fleet Server.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Elasticsearch hosts</strong></span> field, specify the Elasticsearch URLs where Elastic Agents will send data.
For example, <code class="literal">https://192.0.2.0:9200</code>.
</li>
<li class="listitem">
Save and apply the settings.
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Agents</strong></span> tab and follow the in-product instructions to add a
Fleet Server.</p>
<p>Start with downloading the Elastic Agent artifact of your choice to the host
to run the Fleet Server:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/add-fleet-server.png" alt="In-product instructions for adding a Fleet Server">
</div>
</div>
<p>The <code class="literal">install</code> command installs the Elastic Agent as a managed service and enrolls it
in a Fleet Server policy. The example below is for Linux and MacOS hosts (Windows usage
will be similar):</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">sudo ./elastic-agent install -f --fleet-server-es=http://localhost:9200 \
--fleet-server-service-token=AAEAAWVsYXN0aWMvZmxlZXQtc2VydmVyL3Rva2VuLTE2MTkxMzg3MzIzMTg6dzEta0JDTmZUZGlDTjlwRmNVTjNVQQ</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>For DEB or RPM artifact usage, substitute the <code class="literal">install</code> command for <code class="literal">enroll</code>.
This is because DEB and RPM usage inherently include installing the Elastic Agent files to disk,
and so the <code class="literal">install</code> command is incompatible with them.</p>
</div>
</div>
<p>When the installation is successful, you&#8217;ll see the Fleet Server Elastic Agent on the
<span class="strong strong"><strong>Agents</strong></span> tab in <span class="strong strong"><strong>Fleet</strong></span>.</p>
<p>Notice that the <span class="strong strong"><strong>Default Fleet Server policy</strong></span> is
assigned to the Elastic Agent. This policy is created when you run Fleet for the
first time.</p>
<p>You now need to install and enroll your Elastic Agents.</p>
</li>
</ol>
</div>
  </div>
</div>
<h5><a id="reenroll-agent"></a>Step 2: Install and enroll Elastic Agent on more hosts<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/7.14/docs/en/ingest-management/elastic-agent/upgrade-elastic-agent.asciidoc">edit</a></h5>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you upgrade to 7.13 from 7.12 or lower, you may see the following error message in the Elasticsearch logs:</p>
<p><code class="literal">Authentication using apikey failed - api key has been invalidated</code></p>
<p>Before installing and enrolling your Elastic Agents, make sure to uninstall your previous Elastic Agents.
See <a class="xref" href="uninstall-elastic-agent.html" title="Uninstall Elastic Agent">Uninstall Elastic Agent</a>.</p>
</div>
</div>
<p>From the perspective of a host, Fleet Server will be running with the version of the installed
Elastic Agent that started it. Any other Elastic Agents enrolling with Fleet Server must have an equal or
lower version than that of the Fleet Server.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Starting from version 7.13.0 Fleet Server is required.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Agents</strong></span> tab in Fleet, click <span class="strong strong"><strong>Add agent</strong></span>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Enroll in Fleet</strong></span>, follow the in-product installation steps.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/add-agent.png" alt="add agent">
</div>
</div>
<p>See the <a href="/downloads/elastic-agent" class="ulink" target="_top">download page</a> for other
installation options.</p>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Notes:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use the default agent policy to get started quickly. This policy includes a
system integration for collecting logs and metrics from the host system. You
can change the policy later.
</li>
<li class="listitem">
<p>The <code class="literal">install</code> command installs the Elastic Agent as a managed service, enrolls it
in the selected policy, and starts the service. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">./elastic-agent install -f --url=https://10.0.2.2:8220 \
--enrollment-token=blJqaUdua0JqYXA0bmNscVVjUkE6ZGh4WWNRSHRRek9aSS1paEs2cHdFQQ==</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you see an "x509: certificate signed by unknown authority" error, you
might be trying to enroll in a Fleet Server that uses self-signed certs. To
fix this problem in a non-production environment, pass the <code class="literal">--insecure</code> flag.
For more information, refer to the <a class="xref" href="fleet-troubleshooting.html#agent-enrollment-certs" title="Elastic Agent enrollment fails on the host with x509: certificate signed by unknown authority message">troubleshooting guide</a>.</p>
</div>
</div>
</li>
<li class="listitem">
Because Elastic Agent is installed as an auto-starting service, it will restart
automatically if the system is rebooted.
</li>
<li class="listitem">
To see where files are installed, see <a class="xref" href="elastic-agent-installation.html#installation-layout" title="Installation layout">Installation layout</a>.
</li>
</ul>
</div>
<p>If installation is successful, you’ll see the agent on the <span class="strong strong"><strong>Agents</strong></span>
tab in <span class="strong strong"><strong>Fleet</strong></span>. Notice that the Default policy is assigned to the
agent.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/kibana-fleet-agents.png" alt="Fleet showing enrolled agents">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the status hangs at Enrolling, make sure the <code class="literal">elastic-agent</code> process
is running.</p>
</div>
</div>
<p>If you run into problems:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Check the Elastic Agent logs. If you use the default policy, agent logs and metrics
are collected automatically unless you change the default settings. For more
information, refer to <a class="xref" href="elastic-agent-logging.html" title="Configure logging for Fleet-managed Elastic Agents">Configure logging for Fleet-managed Elastic Agents</a>.
</li>
<li class="listitem">
Refer to <a class="xref" href="fleet-troubleshooting.html" title="Troubleshoot common problems"><em>Troubleshoot common problems</em></a>.
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="running-on-kubernetes-standalone.html">« Run Elastic Agent standalone on Kubernetes</a>
</span>
<span class="next">
<a href="start-elastic-agent.html">Start Elastic Agent »</a>
</span>
</div>
</div>
</body>
</html>
