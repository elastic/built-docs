<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fleet Server | Fleet and Elastic Agent Guide [7.15] | Elastic</title>
<meta class="elastic" name="content" content="Fleet Server | Fleet and Elastic Agent Guide [7.15]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [7.15]"/>
<link rel="up" href="index.html" title="Fleet and Elastic Agent Guide [7.15]"/>
<link rel="prev" href="fleet-settings.html" title="Fleet UI settings"/>
<link rel="next" href="fleet-enrollment-tokens.html" title="Fleet enrollment tokens"/>
<meta class="elastic" name="product_version" content="7.15"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/7.15"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="7.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [7.15]</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="fleet-settings.html">« Fleet UI settings</a>
</span>
<span class="next">
<a href="fleet-enrollment-tokens.html">Fleet enrollment tokens »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="fleet-server"></a>Fleet Server<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server.asciidoc">edit</a></h1>
</div></div></div>
<p>Fleet Server is a component of the Elastic Stack used to centrally manage
<a class="xref" href="elastic-agent-installation-configuration.html" title="Elastic Agents">Elastic Agents</a>. It&#8217;s launched as part of
an Elastic Agent on a host intended to act as a server. One Fleet Server process can
support many Elastic Agent connections, and serves as a control plane for updating
agent policies, collecting status information, and coordinating actions across
Elastic Agents.</p>
<p>Fleet Server is the mechanism Elastic Agents use to communicate with Elasticsearch:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
When a new agent policy is created, it&#8217;s saved to Elasticsearch.
</li>
<li class="listitem">
To enroll in the policy, Elastic Agents send a request to Fleet Server,
using the enrollment key generated for authentication.
</li>
<li class="listitem">
Fleet Server receives the request and gets the agent policy from Elasticsearch,
then ships the policy to all Elastic Agents enrolled in that policy.
</li>
<li class="listitem">
Elastic Agent uses configuration information in the policy to collect and send data
to Elasticsearch.
</li>
<li class="listitem">
Fleet Server periodically checks Elastic Agents for status information.
</li>
<li class="listitem">
When a policy is updated, Fleet Server retrieves the updated policy from
Elasticsearch and sends it to the connected Elastic Agents.
</li>
</ol>
</div>
<p><span class="image"><img src="images/fleet-server-communication.png" alt="Fleet Server handles communication between Elastic Agent" width="Fleet" height="Elasticsearch"></span></p>
<p>Fleet Server runs as a subprocess inside an Elastic Agent. The agent uses a special
policy that describes the Fleet Server configuration. In large scale
self-managed deployments or on <a href="/cloud/elasticsearch-service?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">hosted Elasticsearch Service</a> on Elastic Cloud,
Fleet Server is typically run as a dedicated Elastic Agent communication host, but
you can optionally use it for data collection on self-managed clusters. For more
details, refer to <a class="xref" href="fleet-server.html#fleet-server-scalability" title="Fleet Server scalability">Fleet Server scalability</a>.</p>
<h3><a id="deployment-models"></a>Fleet Server deployment models<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server.asciidoc">edit</a></h3>
<p>Administrators deploying the Elastic Agent have a few deployment choices
available to satisfy their organization&#8217;s requirements. Fleet Server can be
deployed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
On Elastic Cloud, as part of our hosted Elasticsearch Service, which is managed by Elastic, or
</li>
<li class="listitem">
On-prem and self-managed
</li>
</ul>
</div>
<h4><a id="deployed-in-cloud"></a>Deployed in Elastic Cloud<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server.asciidoc">edit</a></h4>
<p>To simplify the deployment of Elastic Agent, the Fleet Server can be
provisioned and hosted in the Elastic Cloud. In this case, when the deployment is
created, a highly available set of Fleet Servers are automatically deployed.</p>
<p>Administrators can choose the resources allocated to the Fleet Server and
whether they want the Fleet Server to be deployed in multiple availability
zones.</p>
<p>Once deployed on Elastic Cloud as a service, the full life cycle of the
Fleet Server is managed by Elastic. Fleet Server is scalable and highly
available with traffic ingress load balanced across multiple instances to
satisfy the scale requirements.</p>
<div class="imageblock">
<div class="content">
<img src="images/fleet-server-cloud-deployment.png" alt="Fleet Server Cloud deployment model">
</div>
</div>
<h4><a id="deployed-on-prem"></a>Deployed on-prem and self-managed<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server.asciidoc">edit</a></h4>
<p>Fleet Server can be deployed on-premises and managed by the user. In this
deployment model, the administrator is responsible for Fleet Server deployment
and lifecycle management. This mode of operation is predominantly chosen to
satisfy data governance requirements or used in scenarios where the agents only
have access to a private segmented network.</p>
<p>It’s recommended that the administrator provision multiple instances of the
Fleet Server and use a load balancer to better scale the deployment.</p>
<div class="imageblock">
<div class="content">
<img src="images/fleet-server-on-prem-deployment.png" alt="Fleet Server on-prem deployment model">
</div>
</div>
<h3><a id="fleet-server-HA-operations"></a>Fleet Server High availability operations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server.asciidoc">edit</a></h3>
<p>Fleet Server is stateless. Connections to the Fleet Server therefore can be
load balanced as long as the Fleet Server has capacity to accept more
connections. Load balancing is done on a round-robin basis.</p>
<p>In the Elastic Cloud deployment model, multiple Fleet Servers are automatically
provisioned to satisfy the instance size chosen (instance sizes are modified to
satisfy the scale requirement). In addition, if you choose multiple
availability zones to address your fault-tolerance requirements, those
instances are also utilized to balance the load.</p>
<p>In an on-prem deployment, high-availability, fault-tolerance, and lifecycle
management of the Fleet Server are the responsibility of the administrator.</p>
<h3><a id="fleet-server-compatibility"></a>Compatibility and prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server.asciidoc">edit</a></h3>
<p>Fleet Server is compatible with the following Elastic products:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Elastic Stack 7.13 or later (<a href="/cloud/elasticsearch-service?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">hosted Elasticsearch Service</a> on Elastic Cloud, or
a self-managed cluster).</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For version compatibility: Elasticsearch &gt;= Fleet Server &gt;= Elastic Agent (except for
bugfix releases)
</li>
<li class="listitem">
Kibana should be on the same minor version as Elasticsearch.
</li>
</ul>
</div>
</li>
<li class="listitem">
Elastic Cloud Enterprise 2.9&#8212;&#8203;requires you to self-manage the Fleet Server.
</li>
<li class="listitem">
<p>Elastic Cloud Enterprise 2.10 or later&#8212;&#8203;allows you to use a hosted Fleet Server on Elastic Cloud.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires additional wildcard domains and certificates (which normally only
cover <code class="literal">*.cname</code>, not <code class="literal">*.*.cname</code>). This enables us to provide the URL for
Fleet Server of <code class="literal">https://.fleet.</code>.
</li>
<li class="listitem">
The deployment template must contain an APM &amp; Fleet node.
</li>
</ul>
</div>
<p>For more information about hosting Fleet Server on Elastic Cloud Enterprise, refer to
<a href="/guide/en/cloud-enterprise/current/ece-manage-apm-and-fleet.html" class="ulink" target="_top">Manage your APM &amp; Fleet Server</a>.</p>
</li>
</ul>
</div>
<h3><a id="add-fleet-server"></a>Add a Fleet Server<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server.asciidoc">edit</a></h3>
<p>Before using Fleet for central management, Fleet Server must be running. The
steps for running Fleet Server on our <a href="/cloud/elasticsearch-service?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">hosted Elasticsearch Service</a> on Elastic Cloud
are different from the steps for running it as self-managed.</p>
<div class="tabs" data-tab-group="spin-up-stack">
  <div role="tablist" aria-label="Spin up">
    <button role="tab"
            aria-selected="true"
            aria-controls="cloud-tab-spinup"
            id="cloud-spinup">
      Elasticsearch Service
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="self-managed-tab-spinup"
            id="self-managed-spinup"
            tabindex="-1">
      Self-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="cloud-tab-spinup"
       aria-labelledby="cloud-spinup">
<p>Elastic Cloud runs a hosted version of Fleet Server. No extra setup is required
unless you want to scale your deployment.</p>
<p>To confirm that Fleet Server is available in your deployment:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to Kibana and go to <span class="strong strong"><strong>Management &gt; Fleet</strong></span>.
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Agent policy</strong></span>, look for <span class="strong strong"><strong>Elastic Cloud agent policy</strong></span>&#8201;&#8212;&#8201;Fleet Server is the agent enrolled in the Elastic Cloud agent policy.
This policy is managed by Elastic Cloud. You cannot modify it.
Confirm that the agent status is <span class="strong strong"><strong>Healthy</strong></span>.
</li>
</ol>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Don&#8217;t see the Fleet Server agent? Make sure your deployment includes an
APM &amp; Fleet node. This node is required to use Fleet Server.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-server-hosted-container.png" alt="Fleet Server hosted agent">
</div>
</div>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using our hosted Elasticsearch Service, it&#8217;s recommended that you use our hosted
version of Fleet Server. However, you can choose to deploy and self-manage
Fleet Servers.</p>
</div>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="self-managed-tab-spinup"
       aria-labelledby="self-managed-spinup"
       hidden="">
<p>To deploy a self-managed Fleet Server, install an Elastic Agent and enroll it in an
agent policy containing the Fleet Server integration.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to Kibana and go to <span class="strong strong"><strong>Management &gt; Fleet</strong></span>. The first time you visit
this page, it might take a minute to load.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Fleet settings</strong></span>, and in the <span class="strong strong"><strong>Fleet Server hosts</strong></span> field, specify the
URLs Elastic Agents will use to connect to Fleet Server. For example,
<code class="literal">https://192.0.2.1:8220</code>, where <code class="literal">192.0.2.1</code> is the host IP where you will
install Fleet Server.
</li>
<li class="listitem">
<p>In the <span class="strong strong"><strong>Elasticsearch hosts</strong></span> field, specify the Elasticsearch URLs where Elastic Agents will send data.
For example, <code class="literal">https://192.0.2.0:9200</code>.</p>
<p>For more information about these settings, see <a class="xref" href="fleet-settings.html" title="Fleet UI settings"><em>Fleet UI settings</em></a>.</p>
</li>
<li class="listitem">
Save and apply the settings.
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Agents</strong></span> tab and follow the in-product instructions to add a
Fleet server:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/add-fleet-server.png" alt="In-product instructions for adding a Fleet Server">
</div>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Notes:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Make sure you download an x64 architecture installation package.
</li>
<li class="listitem">
<p>For the agent policy, choose one with a Fleet Server integration. If
one doesn&#8217;t exist, create it.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>What is a Fleet Server policy?</strong></p>
</div></div></div>
<p>It is an agent policy that contains a Fleet Server integration. In
self-managed clusters, a default Fleet Server policy is created
automatically when you run Fleet for the first time. If you are deploying a
self-managed Fleet Server to work with our hosted Elasticsearch Service, you
must explicitly <a class="xref" href="agent-policy.html#create-a-policy" title="Create a policy">create a new agent policy</a> that includes a
Fleet Server integration.</p>
</div>
</li>
<li class="listitem">
If you choose <span class="strong strong"><strong>Production</strong></span> deployment mode, read <a class="xref" href="secure-connections.html" title="Encrypt traffic in clusters with a self-managed Fleet Server"><em>Encrypt traffic in clusters with a self-managed Fleet Server</em></a> to
learn how to generate certs.
</li>
<li class="listitem">
It&#8217;s recommended you generate a unique service token for each
Fleet Server. For other ways to generate service tokens, see
<a href="/guide/en/elasticsearch/reference/7.15/service-tokens-command.html" class="ulink" target="_top"><code class="literal">elasticsearch-service-tokens</code></a>.
</li>
<li class="listitem">
<p>The <code class="literal">install</code> command installs the Elastic Agent as a managed service and enrolls it
in a Fleet Server policy. For example, the following command installs
a Fleet Server and uses self-signed certs:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">sudo ./elastic-agent install  -f \
  --fleet-server-es=http://localhost:9200 \
  --fleet-server-service-token=AAEbAWVsYXN0aWMvZmxlaXQtc2VydmVzL3Rva2VuLTE2MeIzNTY1NTQ3Mji6dERXeE9XbW5RRTZqNlJMWEdIRzAtZw \
  --fleet-server-policy=27467ed1-1bfd-11ec-9b88-a7c3d83e2897</pre>
</div>
<p>The following command installs a Fleet Server and uses certificates you
provide. Make sure you replace the values in angle brackets.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">sudo ./elastic-agent install --url=https://192.0.2.1:8220 \ <a id="CO20-1"></a><i class="conum" data-value="1"></i>
 -f \
 --fleet-server-es=https://192.0.2.0:9200 \
 --fleet-server-service-token=AAEAaWVsYXN0aWcvZmxlZXQtc2VydmVyL3rva2VuLTE2MzIzNTYcNTQ3MjI6dER1eE9XbW5RRTZqNlJMWEdIRzAtZw \
  --fleet-server-policy=27467ed1-1bfd-11ec-9b88-a7c3d83e2897 \
  --certificate-authorities=&lt;PATH_TO_CA&gt; \
  --fleet-server-es-ca=&lt;PATH_TO_ES_CERT&gt; \
  --fleet-server-cert=&lt;PATH_TO_FLEET_SERVER_CERT&gt; \
  --fleet-server-cert-key=&lt;PATH_TO_FLEET_SERVER_CERT_KEY&gt;</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO20-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The URL must match the DNS name used to generate the certificate specified
by <code class="literal">--fleet-server-cert</code>.</p>
</td>
</tr>
</table>
</div>
<p>For more Fleet Server commands, see <a class="xref" href="elastic-agent-cmd-options.html" title="Command reference"><em>Command reference</em></a>.</p>
<p>If installation is successful, you&#8217;ll see the Fleet Server Elastic Agent on the
<span class="strong strong"><strong>Agents</strong></span> tab in <span class="strong strong"><strong>Fleet</strong></span>. Notice that the Default Fleet Server Policy is
assigned to the Elastic Agent. This policy is created when you run Fleet for the
first time.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/agents-tab-fleet-server.png" alt="Agent tab showing a healthy agent enrolled in the Default Fleet Server policy">
</div>
</div>
</li>
</ul>
</div>
  </div>
</div>
<p>Now you&#8217;re ready to add Elastic Agents to your host systems. To learn how, see
<a class="xref" href="fleet-quick-start.html#add-agent-to-fleet" title="Step 2: Add an Elastic Agent to Fleet">Step 2: Add an Elastic Agent to Fleet</a>.</p>
<h3><a id="fleet-server-scalability"></a>Fleet Server scalability<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h3>
<p>This section summarizes the resource and Fleet Server configuration
requirements needed to scale your deployment of Elastic Agents. To scale
Fleet Server, you need to modify settings in your deployment and the
Fleet Server agent policy.</p>
<p>First modify your Fleet deployment settings in Elastic Cloud:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to Elastic Cloud and go to your deployment.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Deployments &gt; <em>deployment name</em></strong></span>, click <span class="strong strong"><strong>Edit</strong></span>.
</li>
<li class="listitem">
<p>Under APM &amp; Fleet:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Modify the compute resources available to the server to accommodate a higher
scale of Elastic Agents
</li>
<li class="listitem">
Modify the availability zones to satisfy fault tolerance requirements
</li>
</ul>
</div>
<p>For recommended settings, refer to <a class="xref" href="fleet-server.html#scaling-recommendations" title="Scaling recommendations (Elastic Cloud)">Scaling recommendations (Elastic Cloud)</a>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-server-hosted-container.png" alt="Fleet Server hosted agent">
</div>
</div>
</li>
</ol>
</div>
<p>Next modify the Fleet Server configuration by editing the agent policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In <span class="strong strong"><strong>Fleet</strong></span>, click <span class="strong strong"><strong>Agent Policies</strong></span>. Click on the <span class="strong strong"><strong>Elastic Cloud agent policy</strong></span> to
edit it.
</li>
<li class="listitem">
<p>Open the <span class="strong strong"><strong>Actions</strong></span> menu and select <span class="strong strong"><strong>Edit integration</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/elastic-cloud-agent-policy.png" alt="Elastic Cloud policy">
</div>
</div>
</li>
<li class="listitem">
<p>Under Fleet Server, modify <span class="strong strong"><strong>Max Connections</strong></span> and other
<a class="xref" href="fleet-server.html#fleet-server-configuration" title="Advanced Fleet Server options">advanced settings</a> as described in
<a class="xref" href="fleet-server.html#scaling-recommendations" title="Scaling recommendations (Elastic Cloud)">Scaling recommendations (Elastic Cloud)</a>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-server-configuration.png" alt="Fleet Server configuration">
</div>
</div>
</li>
</ol>
</div>
<h4><a id="fleet-server-configuration"></a>Advanced Fleet Server options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h4>
<p>The following advanced settings are available to fine tune your Fleet Server
deployment.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">cache</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">num_counters</code>
</span>
</dt>
<dd>
Size of the hash table. Best practice is to have this set to 10x max
connections.
</dd>
<dt>
<span class="term">
<code class="literal">max_cost</code>
</span>
</dt>
<dd>
Total size of the cache.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">server.limits</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">policy_throttle</code>
</span>
</dt>
<dd>
How often a new policy is rolled out to the agents.
</dd>
<dt>
<span class="term">
<code class="literal">checkin_limit.interval</code>
</span>
</dt>
<dd>
How fast the agents can check in to the Fleet Server.
</dd>
<dt>
<span class="term">
<code class="literal">checkin_limit.burst</code>
</span>
</dt>
<dd>
Burst of check-ins allowed before falling back to the rate defined by
<code class="literal">interval</code>.
</dd>
<dt>
<span class="term">
<code class="literal">checkin_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents.
</dd>
<dt>
<span class="term">
<code class="literal">artifact_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the artifact API concurrently. It allows
the user to avoid overloading the Fleet Server from artifact API calls.
</dd>
<dt>
<span class="term">
<code class="literal">artifact_limit.interval</code>
</span>
</dt>
<dd>
How often artifacts are rolled out. Default of 100ms allows 10 artifacts to be
rolled out per second.
</dd>
<dt>
<span class="term">
<code class="literal">artifact_limit.burst</code>
</span>
</dt>
<dd>
Number of transactions allowed for a burst, controlling oversubscription on
outbound buffer.
</dd>
<dt>
<span class="term">
<code class="literal">ack_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the Ack API concurrently. It allows the
user to avoid overloading the Fleet Server from Ack API calls.
</dd>
<dt>
<span class="term">
<code class="literal">ack_limit.interval</code>
</span>
</dt>
<dd>
How often an acknowledgment (ACK) is sent. Default value of 10ms enables 100
ACKs per second to be sent.
</dd>
<dt>
<span class="term">
<code class="literal">ack_limit.burst</code>
</span>
</dt>
<dd>
Burst of ACKs to accommodate (default of 20) before falling back to the rate
defined in <code class="literal">interval</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enroll_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the Enroll API concurrently. This setting
allows the user to avoid overloading the Fleet Server from Enrollment API
calls.
</dd>
<dt>
<span class="term">
<code class="literal">enroll_limit.interval</code>
</span>
</dt>
<dd>
Interval between processing enrollment request. Enrollment is both CPU and RAM
intensive, so the number of enrollment requests needs to be limited for overall
system health. Default value of 100ms allows 10 enrollments per second.
</dd>
<dt>
<span class="term">
<code class="literal">enroll_limit.burst</code>
</span>
</dt>
<dd>
Burst of enrollments to accept before falling back to the rate defined by
<code class="literal">interval</code>.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<h4><a id="scaling-recommendations"></a>Scaling recommendations (Elastic Cloud)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h4>
<p>The following tables provide resource requirements and scaling guidelines based
on the number of agents required by your deployment:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="fleet-server.html#resource-requirements-by-number-agents" title="Resource requirements by number of agents">Resource requirements by number of agents</a>
</li>
<li class="listitem">
<a class="xref" href="fleet-server.html#recommend-settings-scaling-agents" title="Recommended settings by number of deployed Elastic Agents">Recommended settings by number of deployed Elastic Agents</a>
</li>
</ul>
</div>
<h5><a id="resource-requirements-by-number-agents"></a>Resource requirements by number of agents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h5>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Number of Agents</th>
<th align="left" valign="top">Memory</th>
<th align="left" valign="top">vCPU</th>
<th align="left" valign="top">Elasticsearch Cluster size</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>50</p></td>
<td align="left" valign="top"><p>512MB</p></td>
<td align="left" valign="top"><p>Up to 2.5 vCPU</p></td>
<td align="left" valign="top"><p>480GB disk | 16GB RAM | up to 5 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>5,000</p></td>
<td align="left" valign="top"><p>1GB</p></td>
<td align="left" valign="top"><p>Up to 2.5 vCPU</p></td>
<td align="left" valign="top"><p>960GB disk | 32GB RAM | 5 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>7,500</p></td>
<td align="left" valign="top"><p>2GB</p></td>
<td align="left" valign="top"><p>Up to 2.5 vCPU</p></td>
<td align="left" valign="top"><p>1.88TB disk | 64GB RAM | 9.8 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10,000</p></td>
<td align="left" valign="top"><p>4GB</p></td>
<td align="left" valign="top"><p>Up to 2.5 vCPU</p></td>
<td align="left" valign="top"><p>3.75TB disk | 128GB RAM | 19.8 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>12,500</p></td>
<td align="left" valign="top"><p>8G</p></td>
<td align="left" valign="top"><p>Up to 2.5 vCPU</p></td>
<td align="left" valign="top"><p>7.5TB disk | 256GB RAM | 39.4 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>30,000</p></td>
<td align="left" valign="top"><p>16GB</p></td>
<td align="left" valign="top"><p>2.5 vCPU</p></td>
<td align="left" valign="top"><p>7.5TB disk | 256GB RAM | 39.4 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>50,000</p></td>
<td align="left" valign="top"><p>32GB</p></td>
<td align="left" valign="top"><p>2.5 vCPU</p></td>
<td align="left" valign="top"><p>11.25TB disk | 384GB RAM |59.2 vCPU</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="recommend-settings-scaling-agents"></a>Recommended settings by number of deployed Elastic Agents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h5>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You might need to scroll to the right to see all the table columns.</p>
</div>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
<col class="col_5"/>
<col class="col_6"/>
<col class="col_7"/>
<col class="col_8"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>50</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>5,000</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>7,500</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>10,000</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>12,500</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>30,000</strong></span></p></td>
<td align="left" valign="top"><p><span class="strong strong"><strong>50,000</strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Max Connections</strong></span></p></td>
<td align="left" valign="top"><p>100</p></td>
<td align="left" valign="top"><p>7,000</p></td>
<td align="left" valign="top"><p>10,000</p></td>
<td align="left" valign="top"><p>20,000</p></td>
<td align="left" valign="top"><p>32,000</p></td>
<td align="left" valign="top"><p>32,000</p></td>
<td align="left" valign="top"><p>32,000</p></td>
</tr>
<tr>
<td align="left" colspan="8" valign="top"><p><span class="strong strong"><strong>Cache settings</strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">num_counters</code></p></td>
<td align="left" valign="top"><p>2000</p></td>
<td align="left" valign="top"><p>20000</p></td>
<td align="left" valign="top"><p>40000</p></td>
<td align="left" valign="top"><p>80000</p></td>
<td align="left" valign="top"><p>160000</p></td>
<td align="left" valign="top"><p>160000</p></td>
<td align="left" valign="top"><p>320000</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">max_cost</code></p></td>
<td align="left" valign="top"><p>2097152</p></td>
<td align="left" valign="top"><p>20971520</p></td>
<td align="left" valign="top"><p>50971520</p></td>
<td align="left" valign="top"><p>104857600</p></td>
<td align="left" valign="top"><p>209715200</p></td>
<td align="left" valign="top"><p>209715200</p></td>
<td align="left" valign="top"><p>209715200</p></td>
</tr>
<tr>
<td align="left" colspan="8" valign="top"><p><span class="strong strong"><strong>Server limits</strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">policy_throttle</code></p></td>
<td align="left" valign="top"><p>200ms</p></td>
<td align="left" valign="top"><p>50ms</p></td>
<td align="left" valign="top"><p>10ms</p></td>
<td align="left" valign="top"><p>5ms</p></td>
<td align="left" valign="top"><p>5ms</p></td>
<td align="left" valign="top"><p>2ms</p></td>
<td align="left" valign="top"><p>5ms</p></td>
</tr>
<tr>
<td align="left" colspan="8" valign="top"><p><code class="literal">checkin_limit:</code></p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">interval</code></p></td>
<td align="left" valign="top"><p>50ms</p></td>
<td align="left" valign="top"><p>5ms</p></td>
<td align="left" valign="top"><p>2ms</p></td>
<td align="left" valign="top"><p>1ms</p></td>
<td align="left" valign="top"><p>500us</p></td>
<td align="left" valign="top"><p>500us</p></td>
<td align="left" valign="top"><p>500us</p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">burst</code></p></td>
<td align="left" valign="top"><p>25</p></td>
<td align="left" valign="top"><p>500</p></td>
<td align="left" valign="top"><p>1000</p></td>
<td align="left" valign="top"><p>2000</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>4000</p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">max</code></p></td>
<td align="left" valign="top"><p>100</p></td>
<td align="left" valign="top"><p>5001</p></td>
<td align="left" valign="top"><p>7501</p></td>
<td align="left" valign="top"><p>10001</p></td>
<td align="left" valign="top"><p>12501</p></td>
<td align="left" valign="top"><p>15001</p></td>
<td align="left" valign="top"><p>25001</p></td>
</tr>
<tr>
<td align="left" colspan="8" valign="top"><p><code class="literal">artifact_limit:</code></p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">interval</code></p></td>
<td align="left" valign="top"><p>100ms</p></td>
<td align="left" valign="top"><p>5ms</p></td>
<td align="left" valign="top"><p>2ms</p></td>
<td align="left" valign="top"><p>1ms</p></td>
<td align="left" valign="top"><p>500us</p></td>
<td align="left" valign="top"><p>500us</p></td>
<td align="left" valign="top"><p>500us</p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">burst</code></p></td>
<td align="left" valign="top"><p>10</p></td>
<td align="left" valign="top"><p>500</p></td>
<td align="left" valign="top"><p>1000</p></td>
<td align="left" valign="top"><p>2000</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>4000</p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">max</code></p></td>
<td align="left" valign="top"><p>10</p></td>
<td align="left" valign="top"><p>1000</p></td>
<td align="left" valign="top"><p>2000</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>8000</p></td>
<td align="left" valign="top"><p>8000</p></td>
<td align="left" valign="top"><p>8000</p></td>
</tr>
<tr>
<td align="left" colspan="8" valign="top"><p><code class="literal">ack_limit:</code></p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">interval</code></p></td>
<td align="left" valign="top"><p>10ms</p></td>
<td align="left" valign="top"><p>4ms</p></td>
<td align="left" valign="top"><p>2ms</p></td>
<td align="left" valign="top"><p>1ms</p></td>
<td align="left" valign="top"><p>500us</p></td>
<td align="left" valign="top"><p>500us</p></td>
<td align="left" valign="top"><p>500us</p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">burst</code></p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>500</p></td>
<td align="left" valign="top"><p>1000</p></td>
<td align="left" valign="top"><p>2000</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>4000</p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">max</code></p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>1000</p></td>
<td align="left" valign="top"><p>2000</p></td>
<td align="left" valign="top"><p>4000</p></td>
<td align="left" valign="top"><p>8000</p></td>
<td align="left" valign="top"><p>8000</p></td>
<td align="left" valign="top"><p>8000</p></td>
</tr>
<tr>
<td align="left" colspan="8" valign="top"><p><code class="literal">enroll_limit:</code></p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">interval</code></p></td>
<td align="left" valign="top"><p>100ms</p></td>
<td align="left" valign="top"><p>20ms</p></td>
<td align="left" valign="top"><p>10ms</p></td>
<td align="left" valign="top"><p>10ms</p></td>
<td align="left" valign="top"><p>10ms</p></td>
<td align="left" valign="top"><p>10ms</p></td>
<td align="left" valign="top"><p>10ms</p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">burst</code></p></td>
<td align="left" valign="top"><p>5</p></td>
<td align="left" valign="top"><p>50</p></td>
<td align="left" valign="top"><p>100</p></td>
<td align="left" valign="top"><p>100</p></td>
<td align="left" valign="top"><p>100</p></td>
<td align="left" valign="top"><p>100</p></td>
<td align="left" valign="top"><p>100</p></td>
</tr>
<tr>
<td align="right" valign="top"><p><code class="literal">max</code></p></td>
<td align="left" valign="top"><p>10</p></td>
<td align="left" valign="top"><p>100</p></td>
<td align="left" valign="top"><p>200</p></td>
<td align="left" valign="top"><p>200</p></td>
<td align="left" valign="top"><p>200</p></td>
<td align="left" valign="top"><p>200</p></td>
<td align="left" valign="top"><p>200</p></td>
</tr>
<tr>
<td align="left" colspan="8" valign="top"><p><span class="strong strong"><strong>Server runtime settings</strong></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">gc_percent</code></p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>20</p></td>
<td align="left" valign="top"><p>20</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="fleet-server-monitoring"></a>Fleet Server monitoring<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.15/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h3>
<p>Monitoring Fleet Server is key since the operation of the Fleet Server is
paramount to the health of the deployed agents and the services they offer. When
Fleet Server is not operating correctly, it may lead to delayed check-ins,
status information, and updates for the agents it manages. The monitoring data
will tell you when to add capacity for Fleet Server, and provide error logs
and information to troubleshoot other issues.</p>
<p>To enable monitoring for Fleet Server, turn on agent monitoring in the agent
policy. For self-managed clusters, monitoring is on by default when you create a
new agent policy or use the existing Default Fleet Server agent policy.
However, it is off by default in the Elastic Cloud agent policy because monitoring
requires additional RAM.</p>
<p>To turn on Fleet Server monitoring in the agent policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In Fleet, go to <span class="strong strong"><strong>Agent Policies</strong></span> and click on the <span class="strong strong"><strong>Elastic Cloud agent policy</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-policy-page.png" alt="Fleet Policy Page">
</div>
</div>
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Settings</strong></span> tab and notice that Agent monitoring is
off by default.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Agent monitoring</strong></span>, select <span class="strong strong"><strong>Collect agent logs</strong></span> and
<span class="strong strong"><strong>Collect agent metrics</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/elastic-cloud-agent-policy-page.png" alt="Elastic Cloud Policy Page">
</div>
</div>
<p>The agent will now be able to collect logs and metrics from the Fleet Server.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Fleet Server is deployed as yet another agent in the system.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Next, set the <span class="strong strong"><strong>Default namespace</strong></span>.</p>
<p>Setting the default namespace lets you segregate Fleet Server monitoring data
from other collected data. This makes it easier to search and visualize the
monitoring data. By default the monitoring data is sent to the <span class="strong strong"><strong>default</strong></span>
namespace.</p>
</li>
<li class="listitem">
To confirm your change, click <span class="strong strong"><strong>Save changes</strong></span>.
</li>
</ol>
</div>
<p>To see the metrics collected for Fleet Server, go to <span class="strong strong"><strong>Analytics &gt; Discover</strong></span>.</p>
<p>In the following example, <code class="literal">fleetserver</code> was configured as the namespace, and
you can see the metrics collected:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/dashboard-with-namespace-showing.png" alt="Namespace">
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/datastream-namespace.png" alt="Datastream">
</div>
</div>
<p>In Kibana, go to <span class="strong strong"><strong>Analytics &gt; Dashboard</strong></span> and search for the predefined dashboard
called <span class="strong strong"><strong>[Elastic Agent] Agent metrics</strong></span>. Choose this dashboard, and run a query
based on the <code class="literal">fleetserver</code> namespace.</p>
<p>The following dashboard shows data for the query <code class="literal">data_stream.namespace:
"fleetserver"</code>. In this example, you can observe CPU and memory usage as a
metric and then resize the Fleet Server, if necessary.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/dashboard-datastream.png" alt="Dashboard Datastream">
</div>
</div>
<p>Note that as an alternative to running the query, you can hide all metrics
except <code class="literal">fleet_server</code> in the dashboard.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="fleet-settings.html">« Fleet UI settings</a>
</span>
<span class="next">
<a href="fleet-enrollment-tokens.html">Fleet enrollment tokens »</a>
</span>
</div>
</div>
</body>
</html>
