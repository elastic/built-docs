<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Enable custom settings in an agent policy | Fleet and Elastic Agent Guide [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Enable custom settings in an agent policy | Fleet and Elastic Agent Guide [8.14]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.14]"/>
<link rel="up" href="agent-policy.html" title="Elastic Agent policies"/>
<link rel="prev" href="create-a-policy-no-ui.html" title="Create an agent policy without using the UI"/>
<link rel="next" href="fleet-roles-and-privileges.html" title="Required roles and privileges"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.14"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="create-a-policy-no-ui.html">« Create an agent policy without using the UI</a>
</span>
<span class="next">
<a href="fleet-roles-and-privileges.html">Required roles and privileges »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="manage-agents-in-fleet.html">Centrally manage Elastic Agents in Fleet</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="agent-policy.html">Elastic Agent policies</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Enable custom settings in an agent policy</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/override-policy-settings.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="enable-custom-policy-settings"></a>Enable custom settings in an agent policy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/override-policy-settings.asciidoc">edit</a></h3>
</div></div></div>
<p>In certain cases it can be useful to enable custom settings that are not available in Fleet, and that override the default behavior for Elastic Agent. Examples include limiting the amount of CPU consumed by an agent, configuring the agent download timeout, and overriding the default port used for monitoring.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Use these custom settings with caution as they are intended for special cases. We do not test all possible combinations of settings which will be passed down to the components of Elastic Agent, so it is possible that certain custom configurations can result in breakages.</p>
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="enable-custom-policy-settings.html#limit-cpu-usage" title="Limit CPU usage">Limit CPU usage</a>
</li>
<li class="listitem">
<a class="xref" href="enable-custom-policy-settings.html#configure-agent-download-timeout" title="Configure the agent download timeout">Configure the agent download timeout</a>
</li>
<li class="listitem">
<a class="xref" href="enable-custom-policy-settings.html#override-default-monitoring-port" title="Override the default monitoring port">Override the default monitoring port</a>
</li>
</ul>
</div>
<h5><a id="limit-cpu-usage"></a>Limit CPU usage<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/override-policy-settings.asciidoc">edit</a></h5>
<p>If you need to limit the amount of CPU consumption you can use the <code class="literal">agent.limits.go_max_procs</code> configuration option. This parameter limits the number of operating system threads that can be executing Go code simultaneously in each Go process. The <code class="literal">agent.limits.go_max_procs</code> option accepts an integer value not less than <code class="literal">0</code>, which is the default value that stands for "all available CPUs".</p>
<p>The <code class="literal">agent.limits.go_max_procs</code> limit applies independently to the agent and each underlying Go process that it supervises. For example, if Elastic Agent is configured to supervise two Beats with <code class="literal">agent.limits.go_max_procs: 2</code> in the policy, then the total CPU limit is six, where each of the three processes (one Elastic Agent and two Beats) may execute independently on two CPUs.</p>
<p>This setting is similar to the Beats <a href="/guide/en/beats/filebeat/8.14/configuration-general-options.html#_max_procs" class="ulink" target="_top"><code class="literal">max_procs</code></a> setting. For more detail, refer to the <a href="https://pkg.go.dev/runtime#GOMAXPROCS" class="ulink" target="_top">GOMAXPROCS</a> function in the Go runtime documentation.</p>
<p>To enable <code class="literal">agent.limits.go_max_procs</code>, run a <a class="xref" href="fleet-api-docs.html" title="Kibana Fleet APIs">Fleet API</a> request from the Kibana <a href="/guide/en/kibana/8.14/console-kibana.html" class="ulink" target="_top">Dev Tools console</a> to override your current Elastic Agent policy and add the <code class="literal">go_max_procs</code> parameter. For example, to limit Go processes supervised by Elastic Agent to two operating system threads each, run:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">PUT kbn:/api/fleet/agent_policies/&lt;policy-id&gt;
{
  "name": "&lt;policy-name&gt;",
  "namespace": "default",
  "overrides": {
    "agent": {
      "limits": {
        "go_max_procs": 2
      }
    }
  }
}</pre>
</div>
<h5><a id="configure-agent-download-timeout"></a>Configure the agent download timeout<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/override-policy-settings.asciidoc">edit</a></h5>
<p>You can configure the the amount of time that Elastic Agent waits for an upgrade package download to complete. This is useful in the case of a slow or intermittent network connection.</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">PUT kbn:/api/fleet/agent_policies/&lt;policy-id&gt;
{
  "name": "Test policy",
  "namespace": "default",
  "overrides": {
    "agent": {
      "download": {
        "timeout": "120s"
      }
    }
  }
}</pre>
</div>
<h5><a id="override-default-monitoring-port"></a>Override the default monitoring port<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/override-policy-settings.asciidoc">edit</a></h5>
<p>You can override the default port that Elastic Agent uses to send monitoring data. It&#8217;s useful to be able to adjust this setting if you have an application running on the machine on which the agent is deployed, and that is using the same port.</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">PUT kbn:/api/fleet/agent_policies/&lt;policy-id&gt;
{
  "name": "Agent policy 1",
  "namespace": "default",
  "overrides": {
    "agent.monitoring.http.port": 6792
  }
}</pre>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="create-a-policy-no-ui.html">« Create an agent policy without using the UI</a>
</span>
<span class="next">
<a href="fleet-roles-and-privileges.html">Required roles and privileges »</a>
</span>
</div>
</body>
</html>
