<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fleet Server scalability | Fleet and Elastic Agent Guide [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Fleet Server scalability | Fleet and Elastic Agent Guide [8.14]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.14]"/>
<link rel="up" href="fleet-deployment-models.html" title="Deployment models"/>
<link rel="prev" href="add-fleet-server-mixed.html" title="Deploy Fleet Server on-premises and Elasticsearch on Cloud"/>
<link rel="next" href="fleet-server-secrets.html" title="Fleet Server Secrets"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.14"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="add-fleet-server-mixed.html">« Deploy Fleet Server on-premises and Elasticsearch on Cloud</a>
</span>
<span class="next">
<a href="fleet-server-secrets.html">Fleet Server Secrets »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="fleet-deployment-models.html">Deployment models</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Fleet Server scalability</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="fleet-server-scalability"></a>Fleet Server scalability<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h2>
</div></div></div>
<p>This page summarizes the resource and Fleet Server configuration
requirements needed to scale your deployment of Elastic Agents. To scale
Fleet Server, you need to modify settings in your deployment and the
Fleet Server agent policy.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to the <a class="xref" href="fleet-server-scalability.html#agent-policy-scaling-recommendations" title="Scaling recommendations">Scaling recommendations</a> section for specific recommendations about using Fleet Server at scale.</p>
</div>
</div>
<p>First modify your Fleet deployment settings in Elastic Cloud:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to Elastic Cloud and go to your deployment.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Deployments &gt; <em>deployment name</em></strong></span>, click <span class="strong strong"><strong>Edit</strong></span>.
</li>
<li class="listitem">
<p>Under Integrations Server:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Modify the compute resources available to the server to accommodate a higher
scale of Elastic Agents
</li>
<li class="listitem">
Modify the availability zones to satisfy fault tolerance requirements
</li>
</ul>
</div>
<p>For recommended settings, refer to <a class="xref" href="fleet-server-scalability.html#scaling-recommendations" title="Scaling recommendations (Elastic Cloud)">Scaling recommendations (Elastic Cloud)</a>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-server-hosted-container.png" alt="Fleet Server hosted agent">
</div>
</div>
</li>
</ol>
</div>
<p>Next modify the Fleet Server configuration by editing the agent policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agent policies</strong></span> tab. Click the name of the <span class="strong strong"><strong>Elastic Cloud agent policy</strong></span> to edit the policy.
</li>
<li class="listitem">
<p>Open the <span class="strong strong"><strong>Actions</strong></span> menu next to the Fleet Server integration and click
<span class="strong strong"><strong>Edit integration</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/elastic-cloud-agent-policy.png" alt="Elastic Cloud policy">
</div>
</div>
</li>
<li class="listitem">
<p>Under Fleet Server, modify <span class="strong strong"><strong>Max Connections</strong></span> and other
<a class="xref" href="fleet-server-scalability.html#fleet-server-configuration" title="Advanced Fleet Server options">advanced settings</a> as described in
<a class="xref" href="fleet-server-scalability.html#scaling-recommendations" title="Scaling recommendations (Elastic Cloud)">Scaling recommendations (Elastic Cloud)</a>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-server-configuration.png" alt="Fleet Server configuration">
</div>
</div>
</li>
</ol>
</div>
<h4><a id="fleet-server-configuration"></a>Advanced Fleet Server options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h4>
<p>The following advanced settings are available to fine tune your Fleet Server
deployment.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">cache</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">num_counters</code>
</span>
</dt>
<dd>
Size of the hash table. Best practice is to have this set to 10 times the max
connections.
</dd>
<dt>
<span class="term">
<code class="literal">max_cost</code>
</span>
</dt>
<dd>
Total size of the cache.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">server.timeouts</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">checkin_timestamp</code>
</span>
</dt>
<dd>
How often Fleet Server updates the "last activity" field for each agent.
Defaults to <code class="literal">30s</code>. In a large-scale deployment, increasing this
setting may improve performance. If this setting is higher than <code class="literal">2m</code>,
most agents will be shown as "offline" in the Fleet UI. For a typical setup,
it&#8217;s recommended that you set this value to less than <code class="literal">2m</code>.
</dd>
<dt>
<span class="term">
<code class="literal">checkin_long_poll</code>
</span>
</dt>
<dd>
How long Fleet Server allows a long poll request from an agent before
timing out. Defaults to <code class="literal">5m</code>. In a large-scale deployment, increasing
this setting may improve performance.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">server.limits</code>
</span>
</dt>
<dd>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">policy_throttle</code>
</span>
</dt>
<dd>
How often a new policy is rolled out to the agents.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<p>Deprecated: Use the <code class="literal">action_limit</code> settings instead.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">action_limit.interval</code>
</span>
</dt>
<dd>
How quickly Fleet Server dispatches pending actions to the agents.
</dd>
<dt>
<span class="term">
<code class="literal">action_limit.burst</code>
</span>
</dt>
<dd>
Burst of actions that may be dispatched before falling back to the rate limit defined by <code class="literal">interval</code>.
</dd>
<dt>
<span class="term">
<code class="literal">checkin_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the checkin API concurrently.
</dd>
<dt>
<span class="term">
<code class="literal">checkin_limit.interval</code>
</span>
</dt>
<dd>
How fast the agents can check in to the Fleet Server.
</dd>
<dt>
<span class="term">
<code class="literal">checkin_limit.burst</code>
</span>
</dt>
<dd>
Burst of check-ins allowed before falling back to the rate defined by
<code class="literal">interval</code>.
</dd>
<dt>
<span class="term">
<code class="literal">checkin_limit.max_body_byte_size</code>
</span>
</dt>
<dd>
Maximum size in bytes of the checkin API request body.
</dd>
<dt>
<span class="term">
<code class="literal">artifact_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the artifact API concurrently. It allows
the user to avoid overloading the Fleet Server from artifact API calls.
</dd>
<dt>
<span class="term">
<code class="literal">artifact_limit.interval</code>
</span>
</dt>
<dd>
How often artifacts are rolled out. Default of <code class="literal">100ms</code> allows 10 artifacts to be
rolled out per second.
</dd>
<dt>
<span class="term">
<code class="literal">artifact_limit.burst</code>
</span>
</dt>
<dd>
Number of transactions allowed for a burst, controlling oversubscription on
outbound buffer.
</dd>
<dt>
<span class="term">
<code class="literal">artifact_limit.max_body_byte_size</code>
</span>
</dt>
<dd>
Maximum size in bytes of the artficact API request body.
</dd>
<dt>
<span class="term">
<code class="literal">ack_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the ack API concurrently. It allows the
user to avoid overloading the Fleet Server from Ack API calls.
</dd>
<dt>
<span class="term">
<code class="literal">ack_limit.interval</code>
</span>
</dt>
<dd>
How often an acknowledgment (ACK) is sent. Default value of <code class="literal">10ms</code> enables 100
ACKs per second to be sent.
</dd>
<dt>
<span class="term">
<code class="literal">ack_limit.burst</code>
</span>
</dt>
<dd>
Burst of ACKs to accommodate (default of 20) before falling back to the rate
defined in <code class="literal">interval</code>.
</dd>
<dt>
<span class="term">
<code class="literal">ack_limit.max_body_byte_size</code>
</span>
</dt>
<dd>
Maximum size in bytes of the ack API request body.
</dd>
<dt>
<span class="term">
<code class="literal">enroll_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the enroll API concurrently. This setting
allows the user to avoid overloading the Fleet Server from Enrollment API
calls.
</dd>
<dt>
<span class="term">
<code class="literal">enroll_limit.interval</code>
</span>
</dt>
<dd>
Interval between processing enrollment request. Enrollment is both CPU and RAM
intensive, so the number of enrollment requests needs to be limited for overall
system health. Default value of <code class="literal">100ms</code> allows 10 enrollments per second.
</dd>
<dt>
<span class="term">
<code class="literal">enroll_limit.burst</code>
</span>
</dt>
<dd>
Burst of enrollments to accept before falling back to the rate defined by
<code class="literal">interval</code>.
</dd>
<dt>
<span class="term">
<code class="literal">enroll_limit.max_body_byte_size</code>
</span>
</dt>
<dd>
Maximum size in bytes of the enroll API request body.
</dd>
<dt>
<span class="term">
<code class="literal">status_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the status API concurrently. This setting allows the user to avoid overloading the Fleet Server from status API calls.
</dd>
<dt>
<span class="term">
<code class="literal">status_limit.interval</code>
</span>
</dt>
<dd>
How frequently agents can submit status requests to the Fleet Server.
</dd>
<dt>
<span class="term">
<code class="literal">status_limit.burst</code>
</span>
</dt>
<dd>
Burst of status requests to accomodate before falling back to the rate defined by interval.
</dd>
<dt>
<span class="term">
<code class="literal">status_limit.max_body_byte_size</code>
</span>
</dt>
<dd>
Maximum size in bytes of the status API request body.
</dd>
<dt>
<span class="term">
<code class="literal">upload_start_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the uploadStart API concurrently. This setting allows the user to avoid overloading the Fleet Server from uploadStart API calls.
</dd>
<dt>
<span class="term">
<code class="literal">upload_start_limit.interval</code>
</span>
</dt>
<dd>
How frequently agents can submit file start upload requests to the Fleet Server.
</dd>
<dt>
<span class="term">
<code class="literal">upload_start_limit.burst</code>
</span>
</dt>
<dd>
Burst of file start upload requests to accomodate before falling back to the rate defined by interval.
</dd>
<dt>
<span class="term">
<code class="literal">upload_start_limit.max_body_byte_size</code>
</span>
</dt>
<dd>
Maximum size in bytes of the uploadStart API request body.
</dd>
<dt>
<span class="term">
<code class="literal">upload_end_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the uploadEnd API concurrently. This setting allows the user to avoid overloading the Fleet Server from uploadEnd API calls.
</dd>
<dt>
<span class="term">
<code class="literal">upload_end_limit.interval</code>
</span>
</dt>
<dd>
How frequently agents can submit file end upload requests to the Fleet Server.
</dd>
<dt>
<span class="term">
<code class="literal">upload_end_limit.burst</code>
</span>
</dt>
<dd>
Burst of file end upload requests to accomodate before falling back to the rate defined by interval.
</dd>
<dt>
<span class="term">
<code class="literal">upload_end_limit.max_body_byte_size</code>
</span>
</dt>
<dd>
Maximum size in bytes of the uploadEnd API request body.
</dd>
<dt>
<span class="term">
<code class="literal">upload_chunk_limit.max</code>
</span>
</dt>
<dd>
Maximum number of agents that can call the uploadChunk API concurrently. This setting allows the user to avoid overloading the Fleet Server from uploadChunk API calls.
</dd>
<dt>
<span class="term">
<code class="literal">upload_chunk_limit.interval</code>
</span>
</dt>
<dd>
How frequently agents can submit file chunk upload requests to the Fleet Server.
</dd>
<dt>
<span class="term">
<code class="literal">upload_chunk_limit.burst</code>
</span>
</dt>
<dd>
Burst of file chunk upload requests to accomodate before falling back to the rate defined by interval.
</dd>
<dt>
<span class="term">
<code class="literal">upload_chunk_limit.max_body_byte_size</code>
</span>
</dt>
<dd>
Maximum size in bytes of the uploadChunk API request body.
</dd>
</dl>
</div>
<h4><a id="scaling-recommendations"></a>Scaling recommendations (Elastic Cloud)<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h4>
<p>The following tables provide the minimum resource requirements and scaling guidelines based
on the number of agents required by your deployment. It should be noted that these compute
resource can be spread across multiple availability zones (for example: a 32GB RAM requirement
can be satisfed with 16GB of RAM in 2 different zones).</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="fleet-server-scalability.html#resource-requirements-by-number-agents" title="Resource requirements by number of agents">Resource requirements by number of agents</a>
</li>
</ul>
</div>
<h5><a id="resource-requirements-by-number-agents"></a>Resource requirements by number of agents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h5>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Number of Agents</p></td>
<td align="left" valign="top"><p>Fleet Server Memory</p></td>
<td align="left" valign="top"><p>Fleet Server vCPU</p></td>
<td align="left" valign="top"><p>Elasticsearch Hot Tier</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>2,000</p></td>
<td align="left" valign="top"><p>2GB</p></td>
<td align="left" valign="top"><p>up to 8 vCPU</p></td>
<td align="left" valign="top"><p>32GB  RAM  | 8 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>5,000</p></td>
<td align="left" valign="top"><p>4GB</p></td>
<td align="left" valign="top"><p>up to 8 vCPU</p></td>
<td align="left" valign="top"><p>32GB  RAM  | 8 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>10,000</p></td>
<td align="left" valign="top"><p>8GB</p></td>
<td align="left" valign="top"><p>up to 8 vCPU</p></td>
<td align="left" valign="top"><p>128GB RAM  | 32 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>15,000</p></td>
<td align="left" valign="top"><p>8GB</p></td>
<td align="left" valign="top"><p>up to 8 vCPU</p></td>
<td align="left" valign="top"><p>256GB RAM  | 64 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>25,000</p></td>
<td align="left" valign="top"><p>8GB</p></td>
<td align="left" valign="top"><p>up to 8 vCPU</p></td>
<td align="left" valign="top"><p>256GB RAM  | 64 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>50,000</p></td>
<td align="left" valign="top"><p>8GB</p></td>
<td align="left" valign="top"><p>up to 8 vCPU</p></td>
<td align="left" valign="top"><p>384GB RAM  | 96 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>75,000</p></td>
<td align="left" valign="top"><p>8GB</p></td>
<td align="left" valign="top"><p>up to 8 vCPU</p></td>
<td align="left" valign="top"><p>384GB RAM  | 96 vCPU</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>100,000</p></td>
<td align="left" valign="top"><p>16GB</p></td>
<td align="left" valign="top"><p>16 vCPU</p></td>
<td align="left" valign="top"><p>512GB RAM  | 128 vCPU</p></td>
</tr>
</tbody>
</table>
</div>
<p>A series of scale performance tests are regularly executed in order to verify the above requirements
and the ability for Fleet to manage the advertised scale of Elastic Agents. These tests go through a set
of acceptance criteria. The criteria mimics a typical platform operator workflow. The test cases are
performing agent installations, version upgrades, policy modifications, and adding/removing integrations,
tags, and policies. Acceptance criteria is passed when the Elastic Agents reach a <code class="literal">Healthy</code> state after any
of these operations.</p>
<h4><a id="agent-policy-scaling-recommendations"></a>Scaling recommendations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-management/fleet/fleet-server-scaling.asciidoc">edit</a></h4>
<p><span class="strong strong"><strong>Elastic Agent policies</strong></span></p>
<p>A single instance of Fleet supports a maximum of 500 Elastic Agent policies. If more policies are configured, UI performance might be impacted.</p>
<p><span class="strong strong"><strong>Elastic Agents</strong></span></p>
<p>When you use Fleet to manage a large volume (10k or more) of Elastic Agents, the check-in from each of the multiple agents triggers an Elasticsearch authentication request. To help reduce the possibility of cache eviction and to speed up propagation of Elastic Agent policy changes and actions, we recommend setting the <a href="/guide/en/elasticsearch/reference/8.14/security-settings.html#api-key-service-settings" class="ulink" target="_top">API key cache size</a> in your Elasticsearch configuration to 2x the maximum number of agents.</p>
<p>For example, with 25,000 running Elastic Agents you could set the cache value to <code class="literal">50000</code>:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.security.authc.api_key.cache.max_keys: 50000</pre>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="add-fleet-server-mixed.html">« Deploy Fleet Server on-premises and Elasticsearch on Cloud</a>
</span>
<span class="next">
<a href="fleet-server-secrets.html">Fleet Server Secrets »</a>
</span>
</div>
</body>
</html>
