<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Deploy Fleet Server on-premises and Elasticsearch on Cloud | Fleet and Elastic Agent Guide [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Deploy Fleet Server on-premises and Elasticsearch on Cloud | Fleet and Elastic Agent Guide [8.15]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.15]"/>
<link rel="up" href="fleet-deployment-models.html" title="Deployment models"/>
<link rel="prev" href="add-fleet-server-on-prem.html" title="Deploy on-premises and self-managed"/>
<link rel="next" href="fleet-server-scalability.html" title="Fleet Server scalability"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.15"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.15"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="add-fleet-server-on-prem.html">« Deploy on-premises and self-managed</a>
</span>
<span class="next">
<a href="fleet-server-scalability.html">Fleet Server scalability »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="fleet-deployment-models.html">Deployment models</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Deploy Fleet Server on-premises and Elasticsearch on Cloud</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="add-fleet-server-mixed"></a>Deploy Fleet Server on-premises and Elasticsearch on Cloud<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></h2>
</div></div></div>
<p>To use Fleet for central management, a <a class="xref" href="fleet-server.html" title="What is Fleet Server?">Fleet Server</a> must
be running and accessible to your hosts.</p>
<p>Another approach is to deploy a cluster of Fleet Servers on-premises and
connect them back to Elastic Cloud with access to Elasticsearch and Kibana.
In this <a class="xref" href="fleet-deployment-models.html" title="Deployment models">deployment model</a>, you are responsible for high-availability,
fault-tolerance, and lifecycle management of Fleet Server.</p>
<p>This approach might be right for you if you would like to limit the control plane traffic
out of your data center. For example, you might take this approach if you are a
managed service provider or a larger enterprise that segregates its networks.</p>
<p>This approach might <em>not</em> be right for you if you don&#8217;t want to manage the life cycle
of an extra compute resource in your environment for Fleet Server to reside on.</p>
<div class="imageblock">
<div class="content">
<img src="images/fleet-server-on-prem-es-cloud.png" alt="Fleet Server on-premise and Elasticsearch on Cloud deployment model">
</div>
</div>
<p>To deploy a self-managed Fleet Server on-premises to work with a hosted Elasticsearch Service,
you need to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Satisfy all <a class="xref" href="add-fleet-server-mixed.html#add-fleet-server-mixed-compatibility" title="Compatibility">compatibility requirements</a> and <a class="xref" href="add-fleet-server-mixed.html#add-fleet-server-mixed-prereq" title="Prerequisites">prerequisites</a>
</li>
<li class="listitem">
Create a <a class="xref" href="add-fleet-server-mixed.html#fleet-server-create-policy" title="Create a Fleet Server policy">Fleet Server policy</a>
</li>
<li class="listitem">
<a class="xref" href="add-fleet-server-mixed.html#fleet-server-add-server" title="Add Fleet Servers">Add Fleet Server</a> by installing an Elastic Agent and enrolling it in an agent policy containing the Fleet Server integration
</li>
</ul>
</div>
<h3><a id="add-fleet-server-mixed-compatibility"></a>Compatibility<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></h3>
<p>Fleet Server is compatible with the following Elastic products:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Elastic Stack 7.13 or later</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For version compatibility: Elasticsearch &gt;= Fleet Server &gt;= Elastic Agent (except for
bugfix releases)
</li>
<li class="listitem">
Kibana should be on the same minor version as Elasticsearch
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Elastic Cloud Enterprise 2.9 or later&#8212;&#8203;allows you to use a hosted Fleet Server on Elastic Cloud.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Requires additional wildcard domains and certificates (which normally only
cover <code class="literal">*.cname</code>, not <code class="literal">*.*.cname</code>). This enables us to provide the URL for
Fleet Server of <code class="literal">https://.fleet.</code>.
</li>
<li class="listitem">
The deployment template must contain an Integrations Server node.
</li>
</ul>
</div>
<p>For more information about hosting Fleet Server on Elastic Cloud Enterprise, refer to
<a href="/guide/en/cloud-enterprise/current/ece-manage-integrations-server.html" class="ulink" target="_top">Manage your Integrations Server</a>.</p>
</li>
</ul>
</div>
<h3><a id="add-fleet-server-mixed-prereq"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></h3>
<p>Before deploying, you need to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Obtain or generate a Cerfiticate Authority (CA) certificate.
</li>
<li class="listitem">
Ensure components have access to the default ports needed for communication.
</li>
</ul>
</div>
<h4><a id="add-fleet-server-mixed-cert-prereq"></a>CA certificate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></h4>
<p>Before setting up Fleet Server using this approach, you will need a
CA certificate to configure Transport Layer Security (TLS)
to encrypt traffic between the Fleet Servers and the Elastic Stack.</p>
<p>If your organization already uses the Elastic Stack, you may already have a CA certificate. If you do not have a CA certificate, you can read more
about generating one in <a class="xref" href="secure-connections.html" title="Configure SSL/TLS for self-managed Fleet Servers">Configure SSL/TLS for self-managed Fleet Servers</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This is not required when testing and iterating using the <span class="strong strong"><strong>Quick start</strong></span> option, but should always be used for production deployments.</p>
</div>
</div>
<h4><a id="default-port-assignments-mixed"></a>Default port assignments<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></h4>
<p>When Elasticsearch or Fleet Server are deployed, components communicate over well-defined, pre-allocated ports.
You may need to allow access to these ports. See the following table for default port assignments:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Component communication</th>
<th align="left" valign="top">Default port</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Elastic Agent → Fleet Server</p></td>
<td align="left" valign="top"><p>8220</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Elastic Agent → Elasticsearch</p></td>
<td align="left" valign="top"><p>443</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Elastic Agent → Logstash</p></td>
<td align="left" valign="top"><p>5044</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Elastic Agent → Fleet</p></td>
<td align="left" valign="top"><p>443</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet Server → Fleet</p></td>
<td align="left" valign="top"><p>443</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Fleet Server → Elasticsearch</p></td>
<td align="left" valign="top"><p>443</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you do not specify the port for Elasticsearch as 443, the Elastic Agent defaults to 9200.</p>
</div>
</div>
<h3><a id="fleet-server-create-policy"></a>Create a Fleet Server policy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></h3>
<p>First, create a Fleet Server policy. The Fleet Server policy manages
and configures the Elastic Agent running on the Fleet Server host to launch a
Fleet Server process.</p>
<p>To create a Fleet Server policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agent policies</strong></span> tab.
</li>
<li class="listitem">
<p>Click on the <span class="strong strong"><strong>Create agent policy</strong></span> button, then:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Provide a meaningful name for the policy that will help you identify this Fleet Server (or cluster) in the future.
</li>
<li class="listitem">
Ensure you select <em>Collect system logs and metrics</em> so the compute system hosting this Fleet Server can be monitored. (This is not required, but is highly recommended.)
</li>
</ol>
</div>
</li>
<li class="listitem">
After creating the Fleet Server policy, navigate to the policy itself and click <span class="strong strong"><strong>Add integration</strong></span>.
</li>
<li class="listitem">
Search for and select the <span class="strong strong"><strong>Fleet Server</strong></span> integration.
</li>
<li class="listitem">
Then click <span class="strong strong"><strong>Add Fleet Server</strong></span>.
</li>
<li class="listitem">
<p>Configure the Fleet Server:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Expand <span class="strong strong"><strong>Change default</strong></span>. Because you are deploying this Fleet Server on-premises,
you need to enter the <em>Host</em> address and <em>Port</em> number, <code class="literal">8220</code>.
(In our example the Fleet Server will be installed on the host <code class="literal">10.128.0.46</code>.)
</li>
<li class="listitem">
It&#8217;s recommended that you also enter the <em>Max agents</em> you intend to support with this Fleet Server.
This can also be modified at a later stage.
This will allow the Fleet Server to handle the load and frequency of updates being sent to the agent
and ensure a smooth operation in a bursty environment.
</li>
</ol>
</div>
</li>
</ol>
</div>
<h3><a id="fleet-server-add-server"></a>Add Fleet Servers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></h3>
<p>Now that the policy exists, you can add Fleet Servers.</p>
<p>A Fleet Server is an Elastic Agent that is enrolled in a Fleet Server policy.
The policy configures the agent to operate in a special mode to serve as a Fleet Server in your deployment.</p>
<p>To add a Fleet Server:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Fleet Server</strong></span>.
</li>
<li class="listitem">
<p>This will open in-product instructions for adding a Fleet Server using
one of two options. Choose <span class="strong strong"><strong>Advanced</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/add-fleet-server-advanced.png" alt="In-product instructions for adding a Fleet Server in advanced mode">
</div>
</div>
</li>
<li class="listitem">
<p>Follow the in-product instructions to add a Fleet Server.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Select the agent policy that you created for this deployment.
</li>
<li class="listitem">
<p>Choose <span class="strong strong"><strong>Production</strong></span> as your deployment mode.</p>
<p>Production mode is the fully secured mode where TLS certificates ensure a secure communication between Fleet Server and Elasticsearch.</p>
</li>
<li class="listitem">
Open the <span class="strong strong"><strong>Fleet Server Hosts</strong></span> dropdown and select <span class="strong strong"><strong>Add new Fleet Server Hosts</strong></span>.
Specify one or more host URLs your Elastic Agents will use to connect to Fleet Server.
For example, <code class="literal">https://192.0.2.1:8220</code>, where <code class="literal">192.0.2.1</code> is the host IP where you will install Fleet Server.
</li>
<li class="listitem">
A <span class="strong strong"><strong>Service Token</strong></span> is required so the Fleet Server can write data to the connected Elasticsearch instance.
Click <span class="strong strong"><strong>Generate service token</strong></span> and copy the generated token.
</li>
<li class="listitem">
Copy the installation instructions provided in Kibana, which include some of the known deployment parameters.
</li>
<li class="listitem">
Replace the value of the <code class="literal">--certificate-authorities</code> parameter with your <a class="xref" href="add-fleet-server-mixed.html#add-fleet-server-mixed-prereq" title="Prerequisites">CA certificate</a>.
</li>
</ol>
</div>
</li>
<li class="listitem">
If installation is successful, a confirmation indicates that Fleet Server
is set up and connected.
</li>
</ol>
</div>
<p>After Fleet Server is installed and enrolled in Fleet, the newly created
Fleet Server policy is applied. You can see this on the Fleet Server policy page.</p>
<p>The Fleet Server agent will also show up on the main Fleet page as another agent
whose life-cycle can be managed (like other agents in the deployment).</p>
<p>You can update your Fleet Server configuration in Kibana at any time
by going to: <span class="strong strong"><strong>Management</strong></span> &#8594; <span class="strong strong"><strong>Fleet</strong></span> &#8594; <span class="strong strong"><strong>Settings</strong></span>. From there you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Update the Fleet Server host URL.
</li>
<li class="listitem">
Configure additional outputs where agents will send data.
</li>
<li class="listitem">
Specify the location from where agents will download binaries.
</li>
<li class="listitem">
Specify proxy URLs to use for Fleet Server or Elastic Agent outputs.
</li>
</ul>
</div>
<h3><a id="fleet-server-install-agents"></a>Next steps<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/8.15/docs/en/ingest-management/fleet/add-fleet-server-mixed.asciidoc">edit</a></h3>
<p>Now you&#8217;re ready to add Elastic Agents to your host systems.
To learn how, see <a class="xref" href="install-fleet-managed-elastic-agent.html" title="Install Fleet-managed Elastic Agents">Install Fleet-managed Elastic Agents</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For on-premises deployments, you can dedicate a policy to all the
agents in the network boundary and configure that policy to include a
specific Fleet Server (or a cluster of Fleet Servers).</p>
<p>Read more in <a class="xref" href="agent-policy.html#add-fleet-server-to-policy" title="Add a Fleet Server to a policy">Add a Fleet Server to a policy</a>.</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="add-fleet-server-on-prem.html">« Deploy on-premises and self-managed</a>
</span>
<span class="next">
<a href="fleet-server-scalability.html">Fleet Server scalability »</a>
</span>
</div>
</body>
</html>
