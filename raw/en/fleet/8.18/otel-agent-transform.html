<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Transform an installed Elastic Agent to run as an OTel Collector | Fleet and Elastic Agent Guide [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Transform an installed Elastic Agent to run as an OTel Collector | Fleet and Elastic Agent Guide [8.18]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.18]"/>
<link rel="up" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector"/>
<link rel="prev" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector"/>
<link rel="next" href="elastic-agent-unprivileged.html" title="Run Elastic Agent without administrative privileges"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.18"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.18"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="otel-agent.html">« Run Elastic Agent as an OTel Collector</a>
</span>
<span class="next">
<a href="elastic-agent-unprivileged.html">Run Elastic Agent without administrative privileges »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="elastic-agent-installation.html">Install Elastic Agents</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="otel-agent.html">Run Elastic Agent as an OTel Collector</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Transform an installed Elastic Agent to run as an OTel Collector</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/elastic-agent/otel-agent-transform.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="otel-agent-transform"></a>Transform an installed Elastic Agent to run as an OTel Collector</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/elastic-agent/otel-agent-transform.asciidoc">edit</a></div>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>If you have a currently installed standalone Elastic Agent, it can be configured to run as an <a class="xref" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector">OTel Collector</a>. This allows you to run Elastic Agent both as a service and in an OTel Collector mode.</p>
<p>In order to configure an installed standalone Elastic Agent to run as an OTel Collector, it&#8217;s enough to include a valid <a class="xref" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector">OTel Collector</a> configuration in the <code class="literal">elastic-agent.yml</code> file, as shown in the following example.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_example_configure_elastic_agent_to_ingest_host_logs_and_metrics_into_elasticsearch_using_the_otel_collector"></a>Example: configure Elastic Agent to ingest host logs and metrics into Elasticsearch using the OTel Collector</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/elastic-agent/otel-agent-transform.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Prerequisites</strong></span></p>
<p>You&#8217;ll need the following:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
A suitable <a class="xref" href="grant-access-to-elasticsearch.html#create-api-key-standalone-agent" title="Create API keys for standalone agents">Elasticsearch API key</a> for authenticating on Elasticsearch
</li>
<li class="listitem">
An installed standalone Elastic Agent
</li>
<li class="listitem">
<p>A valid OTel Collector configuration. In this example we&#8217;ll use the OTel sample configuration included in the Elastic Agent repository: <code class="literal">otel_samples/platformlogs_hostmetrics.yml</code>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/elastic-agent/blob/main/internal/pkg/otel/samples/linux/platformlogs_hostmetrics.yml" class="ulink" target="_top">Linux version</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/elastic-agent/blob/main/internal/pkg/otel/samples/darwin/platformlogs_hostmetrics.yml" class="ulink" target="_top">MacOS version</a>
</li>
</ul>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Steps</strong></span></p>
<p>To change a running standalone Elastic Agent to run as an OTel Collector:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Create a directory where the OTel Collector can save its state. In this example we use <code class="literal">&lt;{agent} install directory&gt;/data/otelcol</code>.
</li>
<li class="listitem">
Open the <code class="literal">&lt;{agent} install directory&gt;/otel_samples/platformlogs_hostmetrics.yml</code> file for editing.
</li>
<li class="listitem">
<p>Set environment details to be used by OTel Collector:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Option 1:</strong></span> Define environment variables for the Elastic Agent service:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ELASTIC_ENDPOINT</code>: The URL of the Elasticsearch instance where data will be sent
</li>
<li class="listitem">
<code class="literal">ELASTIC_API_KEY</code>: The API Key to use to authenticate with Elasticsearch
</li>
<li class="listitem">
<code class="literal">STORAGE_DIR</code>: The directory where the OTel Collector can persist its state
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Option 2:</strong></span> Replace the environment variable references in the sample configuration with the corresponding values:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">${env:ELASTIC_ENDPOINT}</code>:The URL of the Elasticsearch instance where data will be sent
</li>
<li class="listitem">
<code class="literal">${env:ELASTIC_API_KEY}</code>: The API Key to use to authenticate with Elasticsearch
</li>
<li class="listitem">
<code class="literal">${env:STORAGE_DIR}</code>: The directory where the OTel Collector can persist its state
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Save the opened OTel configuration as <code class="literal">elastic-agent.yml</code>, overwriting the default configuration of the installed agent.
</li>
<li class="listitem">
<p>Run the <code class="literal">elastic-agent status</code> command to verify that the new configuration has been correctly applied:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">elastic-agent status</pre>
</div>
<p>The OTel Collector running configuration should appear under <code class="literal">elastic-agent</code> key (note the <code class="literal">extensions</code> and <code class="literal">pipeline</code> keys):</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">┌─ fleet
│  └─ status: (STOPPED) Not enrolled into Fleet
└─ elastic-agent
   ├─ status: (HEALTHY) Running
   ├─ extensions
   │  ├─ status: StatusOK
   │  └─ extension:file_storage
   │     └─ status: StatusOK
   ├─ pipeline:logs/platformlogs
   │  ├─ status: StatusOK
   │  ├─ exporter:elasticsearch/otel
   │  │  └─ status: StatusOK
   │  ├─ processor:resourcedetection
   │  │  └─ status: StatusOK
   │  └─ receiver:filelog/platformlogs
   │     └─ status: StatusOK
   └─ pipeline:metrics/hostmetrics
      ├─ status: StatusOK
      ├─ exporter:elasticsearch/ecs
      │  └─ status: StatusOK
      ├─ processor:attributes/dataset
      │  └─ status: StatusOK
      ├─ processor:elasticinframetrics
      │  └─ status: StatusOK
      ├─ processor:resource/process
      │  └─ status: StatusOK
      ├─ processor:resourcedetection
      │  └─ status: StatusOK
      └─ receiver:hostmetrics/system
         └─ status: StatusOK</pre>
</div>
</li>
<li class="listitem">
Congratulations! Host logs and metrics are now being collected and ingested by the Elastic Agent service running an OTel Collector instance.
For further details about OpenTelemetry collector components supported by Elastic Agent, refer to the <a href="https://github.com/elastic/elastic-agent/tree/main/internal/pkg/otel#components" class="ulink" target="_top">Elastic Distribution for OpenTelemetry Collector README</a>.
</li>
</ol>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="otel-agent.html">« Run Elastic Agent as an OTel Collector</a>
</span>
<span class="next">
<a href="elastic-agent-unprivileged.html">Run Elastic Agent without administrative privileges »</a>
</span>
</div>
</body>
</html>
