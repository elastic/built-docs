<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fleet and Elastic Agent 8.18.7 | Fleet and Elastic Agent Guide [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Fleet and Elastic Agent 8.18.7 | Fleet and Elastic Agent Guide [8.18]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [8.18]"/>
<link rel="up" href="release-notes.html" title="Release notes"/>
<link rel="prev" href="release-notes.html" title="Release notes"/>
<link rel="next" href="release-notes-8.18.6.html" title="Fleet and Elastic Agent 8.18.6"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/8.18"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="8.18"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-8.18.6.html">Fleet and Elastic Agent 8.18.6 »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="release-notes.html">Release notes</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Fleet and Elastic Agent 8.18.7</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/release-notes/release-notes-8.18.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    A newer version is available. Check out the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="release-notes-8.18.7"></a>Fleet and Elastic Agent 8.18.7</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/release-notes/release-notes-8.18.asciidoc">edit</a></div>
</div></div></div>
<div class="position-relative"><h4><a id="known-issues-8.18.7"></a>Known issues</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/release-notes/release-notes-8.18.asciidoc">edit</a></div>
<details id="known-issue-2978-8-18-7">
<summary class="title">Failed upgrades leave Elastic Agent stuck until restart</summary>
<div class="content">
<p>This known issue applies to Elastic Agent 8.18.7 and 9.0.7. Elastic Agent versions 8.19.x and 9.1.x are not affected.</p>
<p>On September 17, 2025, a known issue was discovered that can cause Elastic Agent upgrades to get stuck if an upgrade attempt fails under specific conditions. This happens because the coordinator&#8217;s <code class="literal">overrideState</code> remains set, leaving the agent in a state that appears to be upgrading.</p>
<p><span class="strong strong"><strong>Conditions</strong></span></p>
<p>This issue is triggered if the upgrade fails during one of the early checks inside <code class="literal">Coordinator.Upgrade</code>, for example:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The agent is not upgradeable
</li>
<li class="listitem">
Capabilities check denies the upgrade
</li>
<li class="listitem">
When Elastic Agent is tamper-protected, Endpoint must validate that the upgrade action was correctly signed by Kibana to allow the upgrade. If the signature is missing, invalid, or the connection between Elastic Agent and Endpoint was interrupted, the validation fails. This causes the agent coordinator&#8217;s override state to become stuck until the agent is restarted.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Symptoms</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fleet shows the upgrade action in progress, even though the upgrade remains stuck
</li>
<li class="listitem">
No further upgrade attempts succeed
</li>
<li class="listitem">
Elastic Agent status shows an override state indicating upgrade
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Workaround</strong></span></p>
<p>Restart the Elastic Agent to clear the coordinator&#8217;s <code class="literal">overrideState</code> and allow new upgrade attempts to proceed.</p>
<p><span class="strong strong"><strong>Resolution</strong></span></p>
<p>This issue was fixed in <a href="https://github.com/elastic/elastic-agent/pull/9992" class="ulink" target="_top">#9992</a>, which ensures that the coordinator clears its override state whenever an early failure occurs.</p>
<p>The fix is included in versions 9.1.4 and 8.19.4, and planned for versions 9.0.8 and 8.18.8.</p>
</div>
</details>
<details id="known-issue-5515-8.18.7">
<summary class="title">fleet-agents template is missing mappings</summary>
<div class="content">
<p><span class="strong strong"><strong>Details</strong></span><br></p>
<p>On May 2, 2025 a known issue was discovered that the <code class="literal">.fleet-agents</code> index template was missing a mapping for the <code class="literal">local_metadata.complete</code> attribute. This may cause agent checkins to be rejected and the agents to appear as offline.</p>
<p>In this Fleet&#8217;s logs this will appear as:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">elastic fail 400: document_parsing_exception: [1:209] object mapping for [local_metadata] tried to parse field [local_metadata] as object, but found a concrete value
Eat bulk checkin error; Keep on truckin'</pre>
</div>
<p>And in the Elastic Agent logs it will appear as:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">"log.level":"error","@timestamp":"2025-04-22:12:35:25.295Z","message":"Eat bulk checkin error; Keep on truckin'","component":{"binary":"fleet-server","dataset":"elastic_agent.fleet_server","id":"fleet-server-es-containerhost","type":"fleet-server"},"log":{"source":"fleet-server-es-containerhost"},"service.type":"fleet-server","error.message":"elastic fail 400: document_parsing_exception: [1:209] object mapping for [local_metadata] tried to parse field [local_metadata] as object, but found a concrete value","ecs.version":"1.6.0","service.name":"fleet-server","ecs.version":"1.6.0"</pre>
</div>
<p>This attribute was added to the template in versions: 8.17.11 8.18.3, and 8.19.3.</p>
<p>Further investigation revealed that the <code class="literal">.fleet-agents</code> index template was not correctly applied due to an unchanged <code class="literal">_meta.managed_index_mappings_version</code> number.
This change also affects other attributes as well, such as <code class="literal">upgrade_attempts</code>, <code class="literal">namespaces</code>, <code class="literal">unprivileged</code>, and <code class="literal">unhealthy_reason</code>.
If there is an error related to any of these attributes, there will be a similar error message in the logs.</p>
<p><span class="strong strong"><strong>Impact</strong></span><br></p>
<p>Updating to a version with a fixed <code class="literal">_meta.managed_index_mappings_version</code> will correctly apply the new index template.
The fixed versions are 8.18.8, 8.19.4, 9.0.8, 9.1.4.</p>
</div>
</details>
<div class="position-relative"><h4><a id="features-enhancements-8.18.7"></a>New features and enhancements</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/release-notes/release-notes-8.18.asciidoc">edit</a></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Elastic Agent
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Bump kube-stack Helm Chart to 0.9.1 and enable the cluster collector. <a href="https://github.com/elastic/elastic-agent/pull/9535" class="ulink" target="_top">#9535</a>
</li>
<li class="listitem">
Enhanced loggers for easier debugging of upgrade related issues. <a href="https://github.com/elastic/elastic-agent/issues/9536" class="ulink" target="_top">#9536</a>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="position-relative"><h4><a id="bug-fixes-8.18.7"></a>Bug fixes</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.18/docs/en/ingest-management/release-notes/release-notes-8.18.asciidoc">edit</a></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Elastic Agent
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Redact secrets from pre-config, computed-config, components-expected, and components-actual files in diagnostics archive. <a href="https://github.com/elastic/elastic-agent/pull/9560" class="ulink" target="_top">#9560</a>
</li>
<li class="listitem">
Retry service start command upon failure with 30-second delay. <a href="https://github.com/elastic/elastic-agent/pull/9313" class="ulink" target="_top">#9313</a>
</li>
<li class="listitem">
Fix reporting of scheduled upgrade details across restarts and cancels. <a href="https://github.com/elastic/elastic-agent/pull/9562" class="ulink" target="_top">#9562</a> <a href="https://github.com/elastic/elastic-agent/issues/8778" class="ulink" target="_top">#8778</a>
</li>
<li class="listitem">
Enable root user to re-enroll unprivileged agent for mac and linux. <a href="https://github.com/elastic/elastic-agent/pull/9603" class="ulink" target="_top">#9603</a> <a href="https://github.com/elastic/elastic-agent/issues/8544" class="ulink" target="_top">#8544</a>
</li>
<li class="listitem">
Fix missing liveness healthcheck during container enrollment. <a href="https://github.com/elastic/elastic-agent/pull/9612" class="ulink" target="_top">#9612</a> <a href="https://github.com/elastic/elastic-agent/issues/9611" class="ulink" target="_top">#9611</a>
</li>
<li class="listitem">
Enable admin user to re-enroll unprivileged agent for windows. <a href="https://github.com/elastic/elastic-agent/pull/9623" class="ulink" target="_top">#9623</a> <a href="https://github.com/elastic/elastic-agent/issues/8544" class="ulink" target="_top">#8544</a>
</li>
<li class="listitem">
Treat exit code 284 from Endpoint binary as non-fatal. <a href="https://github.com/elastic/elastic-agent/pull/9687" class="ulink" target="_top">#9687</a>
</li>
<li class="listitem">
Ensure failed upgrade actions are removed from queue and details are set. <a href="https://github.com/elastic/elastic-agent/pull/9634" class="ulink" target="_top">#9634</a> <a href="https://github.com/elastic/elastic-agent/issues/9629" class="ulink" target="_top">#9629</a>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Fleet Server
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Restore connection limiter. <a href="https://github.com/elastic/fleet-server/pull/5372" class="ulink" target="_top">#5372</a></p>
<p>Restore connection level limiter to prevent OOM incidents.
This limiter is used in addition to the request-level throttle so that once
our in-flight requests reaches max_connections a 429 is returned, but if the
total connections the server uses is over max_connections*1.1 the server drops
the connection before the TLS handshake.</p>
</li>
<li class="listitem">
Build fleet-server as fully static binary to restore OS matrix compatibility. <a href="https://github.com/elastic/fleet-server/pull/5392" class="ulink" target="_top">#5392</a> <a href="https://github.com/elastic/fleet-server/issues/5262" class="ulink" target="_top">#5262</a>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-8.18.6.html">Fleet and Elastic Agent 8.18.6 »</a>
</span>
</div>
</body>
</html>
