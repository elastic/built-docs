<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Run Elastic Agent without administrative privileges | Fleet and Elastic Agent Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Run Elastic Agent without administrative privileges | Fleet and Elastic Agent Guide [master]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [master]"/>
<link rel="up" href="elastic-agent-installation.html" title="Install Elastic Agents"/>
<link rel="prev" href="otel-agent.html" title="Run Elastic Agent as an OTel Collector"/>
<link rel="next" href="install-agent-msi.html" title="Install Elastic Agent from an MSI package"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/master"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="otel-agent.html">« Run Elastic Agent as an OTel Collector</a>
</span>
<span class="next">
<a href="install-agent-msi.html">Install Elastic Agent from an MSI package »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="elastic-agent-installation.html">Install Elastic Agents</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Run Elastic Agent without administrative privileges</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/elastic-agent-unprivileged-mode.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="elastic-agent-unprivileged"></a>Run Elastic Agent without administrative privileges</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/elastic-agent-unprivileged-mode.asciidoc">edit</a></div>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Beginning with Elastic Stack version 8.15, Elastic Agent is no longer required to be run by a user with superuser privileges. You can now run agents in an <code class="literal">unprivileged</code> mode that does not require <code class="literal">root</code> access on Linux or macOS, or <code class="literal">admin</code> access on Windows. Being able to run agents without full administrative privileges is often a requirement in organizations where this kind of access is often very limited.</p>
<p>In general, agents running without full administrative privileges will perform and behave exactly as those run by a superuser. There are certain integrations and datastreams that are not available, however. If an integration requires root access, this is <a class="xref" href="elastic-agent-unprivileged.html#unprivileged-integrations" title="Using Elastic integrations">indicated on the integration main page</a>.</p>
<p>You can also <a class="xref" href="elastic-agent-unprivileged.html#unprivileged-change-mode" title="Changing an Elastic Agent&#8217;s privilege mode">change the privilege mode</a> of an Elastic Agent after it has been installed.</p>
<p>Refer to <a class="xref" href="elastic-agent-unprivileged.html#unprivileged-command-behaviors" title="Agent and dashboard behaviors in unprivileged mode">Agent and dashboard behaviors in unprivileged mode</a> and <a class="xref" href="elastic-agent-unprivileged.html#unprivileged-running" title="Run Elastic Agent in unprivileged mode">Run Elastic Agent in <code class="literal">unprivileged</code> mode</a> for the requirements and steps associated with running an agent without full <code class="literal">root</code> or <code class="literal">admin</code> superuser privileges.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="elastic-agent-unprivileged.html#unprivileged-running" title="Run Elastic Agent in unprivileged mode">Run Elastic Agent in <code class="literal">unprivileged</code> mode</a>
</li>
<li class="listitem">
<a class="xref" href="elastic-agent-unprivileged.html#unprivileged-command-behaviors" title="Agent and dashboard behaviors in unprivileged mode">Agent and dashboard behaviors in unprivileged mode</a>
</li>
<li class="listitem">
<a class="xref" href="elastic-agent-unprivileged.html#unprivileged-integrations" title="Using Elastic integrations">Using Elastic integrations</a>
</li>
<li class="listitem">
<a class="xref" href="elastic-agent-unprivileged.html#unprivileged-view-mode" title="Viewing an Elastic Agent privilege mode">Viewing an Elastic Agent privilege mode</a>
</li>
<li class="listitem">
<a class="xref" href="elastic-agent-unprivileged.html#unprivileged-change-mode" title="Changing an Elastic Agent&#8217;s privilege mode">Changing an Elastic Agent&#8217;s privilege mode</a>
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="unprivileged-running"></a>Run Elastic Agent in <code class="literal">unprivileged</code> mode</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/elastic-agent-unprivileged-mode.asciidoc">edit</a></div>
<p>To run Elastic Agent without administrative privileges you use exactly the same commands that you use for Elastic Agent otherwise, with one exception. When you run the <a class="xref" href="elastic-agent-cmd-options.html#elastic-agent-install-command" title="elastic-agent install"><code class="literal">elastic-agent install</code></a> command, add the <code class="literal">--unprivileged</code> flag. For example:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">elastic-agent install \
  --url=https://cedd4e0e21e240b4s2bbbebdf1d6d52f.fleet.eu-west-1.aws.cld.elstc.co:443 \
  --enrollment-token=NEFmVllaa0JLRXhKebVKVTR5TTI6N2JaVlJpSGpScmV0ZUVnZVlRUExFQQ== \
  --unprivileged</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Note the following current restrictions for running Elastic Agent in <code class="literal">unprivileged</code> mode:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>On Linux systems, after Elastic Agent has been installed with the <code class="literal">--unprivileged</code> flag, all Elastic Agent commands can be run without being the root user.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">sudo</code> option is still required for the <code class="literal">elastic-agent install</code> command.
Only <code class="literal">root</code> can install new services.
The installed service will not run as the root user.
</li>
</ul>
</div>
</li>
<li class="listitem">
Using <code class="literal">sudo</code> without specifying an alternate non-root user with <code class="literal">sudo -u</code> in a command may result in <a class="xref" href="fleet-troubleshooting.html#agent-sudo-error" title="Error when running Elastic Agent commands with sudo">an error</a> due to the agent not having the required privileges.
</li>
<li class="listitem">
Using <code class="literal">sudo -u elastic-agent-user</code> will run commands as the user running the Elastic Agent service and will always work.
</li>
<li class="listitem">
<p>For files that allow users in the <code class="literal">elastic-agent</code> group access, using an alternate user that has been added to that group will also work.
There are still some commands that are only accessible to the <code class="literal">elastic-agent-user</code> that runs the service.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>For example, <code class="literal">elastic-agent inspect</code> requires you to prefix the command with <code class="literal">sudo -u elastic-agent-user</code>.</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo -u elastic-agent-user elastic-agent inspect</pre>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="position-relative"><h4><a id="unprivileged-command-behaviors"></a>Agent and dashboard behaviors in unprivileged mode</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/elastic-agent-unprivileged-mode.asciidoc">edit</a></div>
<p>In addition to the <a class="xref" href="elastic-agent-unprivileged.html#unprivileged-integrations" title="Using Elastic integrations">integrations that are not available</a> when Elastic Agent is run in unpriviledged mode, certain data streams are also not available. The following tables show, for different operating systems, the impact when the agent does not have full administrative privileges. In most cases the limitations can be mediated by granting permissions for a user or group to the files indicated.</p>
<div class="table">
<p class="title"><strong>Table 1. macOS</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="macOS">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Action</th>
<th align="left" valign="top">Behavior in unprivileged mode</th>
<th align="left" valign="top">Resolution</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>Log file error: <code class="literal">Unexpected file opening error: Failed opening /var/log/system.log: open /var/log/system.log: permission denied</code>.</p></td>
<td align="left" valign="top"><p>Give read permission to the <code class="literal">elastic-agent</code> group for the <code class="literal">/var/log/system.log</code> file to fix this error.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>On the <code class="literal">[Logs System] Syslog</code> dashboard, the <code class="literal">Syslog events by hostname</code>, <code class="literal">Syslog hostnames and processes</code> and <code class="literal">Syslog logs</code> visualizations are are missing data.</p></td>
<td align="left" valign="top"><p>Give read permission to the <code class="literal">elastic-agent</code> group for the <code class="literal">/var/log/system.log</code> file to fix the missing visualizations.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>On the <code class="literal">[Metrics System] Host overview</code> dashboard, only the processes run by the <code class="literal">elastic-agent-user</code> user are shown in the CPU and memory usage lists.</p></td>
<td align="left" valign="top"><p>To fix the missing processes in the visualization lists you can add add the <code class="literal">elastic-agent-user</code> user to the system <code class="literal">admin</code> group. Note that while this mitigates the issue, it also grants <code class="literal">elastic-agent user</code> with more permissions than may be desired.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent and access the Elastic Agent dashboards</p></td>
<td align="left" valign="top"><p>On the <code class="literal">[Elastic Agent] Agents info</code> dashboard, visualizations including <code class="literal">Most Active Agents</code> and <code class="literal">Integrations per Agent</code> are missing data.</p></td>
<td align="left" valign="top"><p>To fix the missing data in the visualizations you can add add the <code class="literal">elastic-agent-user</code> user to the system <code class="literal">admin</code> group. Note that while this mitigates the issue it also grants <code class="literal">elastic-agent user</code> with more permissions than may be desired.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent and access the Elastic Agent dashboards</p></td>
<td align="left" valign="top"><p>On the <code class="literal">[Elastic Agent] Integrations</code> dashboard, visualizations including <code class="literal">Integration Errors Table</code>, <code class="literal">Events per integration</code> and <code class="literal">Integration Errors</code> are missing data.</p></td>
<td align="left" valign="top"><p>To fix the missing data in the visualizations you can add add the <code class="literal">elastic-agent-user</code> user to the system <code class="literal">admin</code> group. Note that while this mitigates the issue it also grants <code class="literal">elastic-agent user</code> with more permissions than may be desired.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 2. Linux</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Linux">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Action</th>
<th align="left" valign="top">Behavior in unprivileged mode</th>
<th align="left" valign="top">Resolution</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>Log file error: <code class="literal">[elastic_agent.filebeat][error] Harvester could not be started on new file: /var/log/auth.log.1, Err: error setting up harvester: Harvester setup failed. Unexpected file opening error: Failed opening /var/log/auth.log.1: open /var/log/auth.log.1: permission denied</code></p></td>
<td align="left" valign="top"><p>To avoid the error you can add add the <code class="literal">elastic-agent-user</code> user to the <code class="literal">adm</code> group. Note that while this mitigates the issue it also grants <code class="literal">elastic-agent user</code> with more permissions than may be desired.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>Log file error: <code class="literal">[elastic_agent.metricbeat][error] error getting filesystem usage for /run/user/1000/gvfs: error in Statfs syscall: permission denied</code></p></td>
<td align="left" valign="top"><p>To avoid the error you can add add the <code class="literal">elastic-agent-user</code> user to the <code class="literal">adm</code> group. Note that while this mitigates the issue it also grants <code class="literal">elastic-agent user</code> with more permissions than may be desired.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>On the <code class="literal">[Logs System] Syslog</code> dashboard, the <code class="literal">Syslog events by hostname</code>, <code class="literal">Syslog hostnames and processes</code> and <code class="literal">Syslog logs</code> visualizations are are missing data.</p></td>
<td align="left" valign="top"><p>To fix the missing data in the visualizations you can add add the <code class="literal">elastic-agent-user</code> user to the <code class="literal">adm</code> group. Note that while this mitigates the issue it also grants <code class="literal">elastic-agent user</code> with more permissions than may be desired.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent and access the Elastic Agent dashboards</p></td>
<td align="left" valign="top"><p>On the <code class="literal">[Elastic Agent] Agents info</code> dashboard, visualizations including <code class="literal">Most Active Agents</code> and <code class="literal">Integrations per Agent</code> are missing data.</p></td>
<td align="left" valign="top"><p>Giving read permission to the <code class="literal">elastic-agent</code> group for the <code class="literal">/var/log/system.log</code> file will partially fix the visualizations, but errors may still occur because the <code class="literal">elastic-agent-user</code> does not have read access to files in the <code class="literal">/run/user/1000/</code> directory.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent and access the Elastic Agent dashboards</p></td>
<td align="left" valign="top"><p>On the <code class="literal">[Elastic Agent] Integrations</code> dashboard, visualizations including <code class="literal">Integration Errors Table</code>, <code class="literal">Events per integration</code> and <code class="literal">Integration Errors</code> are missing data.</p></td>
<td align="left" valign="top"><p>Give read permission to the <code class="literal">elastic-agent</code> group for the <code class="literal">/var/log/system.log</code> file to fix the missing visualizations.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 3. Windows</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Windows">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Action</th>
<th align="left" valign="top">Behavior in unprivileged mode</th>
<th align="left" valign="top">Resolution</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>Log file error: <code class="literal">failed to open Windows Event Log channel "Security": Access is denied</code></p></td>
<td align="left" valign="top"><p>Add the <code class="literal">elastic-agent-user</code> user to the <code class="literal">Event Log Users</code> group to fix this error.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>Log file error: <code class="literal">cannot open new key in the registry in order to enable the performance counters: Access is denied</code></p></td>
<td align="left" valign="top"><p>Update the permissions for the <code class="literal">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\PartMgr</code> registry to fix this error.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>Most of the System and Elastic Agent dashboard visualizations are missing all data.</p></td>
<td align="left" valign="top"><p>Add the <code class="literal">elastic-agent-user</code> user to the <code class="literal">Event Log Users</code> group and update the permissions for the <code class="literal">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\PartMgr</code> registry to fix the missing visualizations.</p>
<p>Note that the <code class="literal">elastic-agent-user</code> user may still not have access to all processes, so the lists in the <code class="literal">Top processes by CPU usage</code> and <code class="literal">Top processes by memory usage</code> visualizations may be incomplete.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Run Elastic Agent with the System integration</p></td>
<td align="left" valign="top"><p>On the <code class="literal">[Metrics System] Host overview</code> dashboard, the <code class="literal">Disk usage</code> visualizations are missing data.</p></td>
<td align="left" valign="top"><p>This occurs because direct access to the disk or a volume is restricted and not available to users without administrative privileges. Refer to <a href="https://learn.microsoft.com/en-us/windows/win32/secbp/running-with-special-privileges" class="ulink" target="_top">Running with Special Privileges</a> in the Microsoft documentation for details.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="position-relative"><h4><a id="unprivileged-integrations"></a>Using Elastic integrations</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/elastic-agent-unprivileged-mode.asciidoc">edit</a></div>
<p>Most Elastic integrations support running Elastic Agent in unprivileged mode. For the exceptions, any integration that requires Elastic Agent to have root privileges has the requirement indicated at the top of the integration page in Kibana:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/integration-root-requirement.png" alt="Elastic Defend integration page showing root requirement">
</div>
</div>
<p>As well, a warning is displayed in Kibana if you try to add an integration that requires root privileges to an Elastic Agent policy that has agents enrolled in unprivileged mode.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/unprivileged-agent-warning.png" alt="Warning indicating that root privileged agent is required for an integration">
</div>
</div>
<p>Examples of integrations that require Elastic Agent to have administrative privileges are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.elastic.co/en/integrations/endpoint" class="ulink" target="_top">Elastic Defend</a>
</li>
<li class="listitem">
<a href="https://docs.elastic.co/integrations/auditd_manager" class="ulink" target="_top">Auditd Manager</a>
</li>
<li class="listitem">
<a href="https://docs.elastic.co/integrations/fim" class="ulink" target="_top">File Integrity Monitoring</a>
</li>
<li class="listitem">
<a href="https://docs.elastic.co/integrations/network_traffic" class="ulink" target="_top">Network Packet Capture</a>
</li>
<li class="listitem">
<a href="https://docs.elastic.co/integrations/system_audit" class="ulink" target="_top">System Audit</a>
</li>
<li class="listitem">
<a href="https://docs.elastic.co/integrations/profiler_agent" class="ulink" target="_top">Universal Profiling Agent</a>
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="unprivileged-view-mode"></a>Viewing an Elastic Agent privilege mode</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/elastic-agent-unprivileged-mode.asciidoc">edit</a></div>
<p>The <span class="strong strong"><strong>Agent details</strong></span> page shows you the privilege mode for any running Elastic Agent.</p>
<p>To view the status of an Elastic Agent:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
Select an agent and click <span class="strong strong"><strong>View agent</strong></span> in the actions menu.
</li>
<li class="listitem">
<p>The <span class="strong strong"><strong>Agent details</strong></span> tab shows whether the agent is running in <code class="literal">privileged</code> or <code class="literal">unprivileged</code> mode.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/agent-privilege-mode.png" alt="Agent details tab showing the agent is running as non-root">
</div>
</div>
</li>
</ol>
</div>
<p>As well, for any Elastic Agent policy you can view the number of agents that are currently running in privileged or unprivileged mode:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agent policies</strong></span> tab.
</li>
<li class="listitem">
Click the agent policy to view the policy details.
</li>
</ol>
</div>
<p>The number of agents enrolled with the policy is shown. Hover over the link to view the number of privileged and unpriviled agents.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/privileged-and-unprivileged-agents.png" alt="Agent policy tab showing 1 unprivileged agent and 0 privileged enrolled agents">
</div>
</div>
<p>In the event that the Elastic Agent policy has integrations installed that require root privileges, but there are agents running without root privileges, this is shown in the tooltip.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/root-integration-and-unprivileged-agents.png" alt="Agent policy tab showing 1 unprivileged agent and 0 privileged enrolled agents">
</div>
</div>
<div class="position-relative"><h4><a id="unprivileged-change-mode"></a>Changing an Elastic Agent&#8217;s privilege mode</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/elastic-agent-unprivileged-mode.asciidoc">edit</a></div>
<p>For any installed Elastic Agent you can change the mode that it&#8217;s running in by running the <code class="literal">privileged</code> or <code class="literal">unprivileged</code> subcommand.</p>
<p>Change mode from privileged to unprivileged:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo elastic-agent unprivileged</pre>
</div>
<p>Note that changing to <code class="literal">unprivileged</code> mode is prevented if the agent is currently enrolled in a policy that includes an integration that requires administrative access, such as the Elastic Defend integration.</p>
<p>Change mode from unprivileged to privileged:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">sudo elastic-agent privileged</pre>
</div>
<p>When an agent is running in <code class="literal">unprivileged</code> mode, if it doesn&#8217;t have the right level of privilege to read a data source, you can also adjust the agent&#8217;s privileges by adding <code class="literal">elastic-agent-user</code> to the user group that has privileges to read the data source.</p>
<p>As background, when you run Elastic Agent in <code class="literal">unprivileged</code> mode, one user and one group are created on the host. The same names are used for all operating systems:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">elastic-agent-user</code>: The user that is created and that the Elastic Agent service runs as.
</li>
<li class="listitem">
<code class="literal">elastic-agent</code>: The group that is created. Any user in this group has access to control and communicate over the control protocol to the Elastic Agent daemon.
</li>
</ul>
</div>
<p>For example:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
When you install Elastic Agent with the <code class="literal">--unprivileged</code> setting, the <code class="literal">elastic-agent-user</code> user and the <code class="literal">elastic-agent</code> group are created automatically.
</li>
<li class="listitem">
If you then want your user <code class="literal">myuser</code> to be able to run an Elastic Agent command such as <code class="literal">elastic-agent status</code>, add the <code class="literal">myuser</code> user to the <code class="literal">elastic-agent</code> group.
</li>
<li class="listitem">
Then, once added to the group, the <code class="literal">elastic-agent status</code> command will work. Prior to that, the user <code class="literal">myuser</code> running the command will result in a permission error that indicates a problem communicating with the control socket.
</li>
</ol>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="otel-agent.html">« Run Elastic Agent as an OTel Collector</a>
</span>
<span class="next">
<a href="install-agent-msi.html">Install Elastic Agent from an MSI package »</a>
</span>
</div>
</body>
</html>
