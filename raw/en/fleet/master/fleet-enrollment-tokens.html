<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fleet enrollment tokens | Fleet and Elastic Agent Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Fleet enrollment tokens | Fleet and Elastic Agent Guide [master]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [master]"/>
<link rel="up" href="manage-agents-in-fleet.html" title="Centrally manage Elastic Agents in Fleet"/>
<link rel="prev" href="fleet-roles-and-privileges.html" title="Required roles and privileges"/>
<link rel="next" href="fleet-api-docs.html" title="Kibana Fleet APIs"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/master"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="fleet-roles-and-privileges.html">« Required roles and privileges</a>
</span>
<span class="next">
<a href="fleet-api-docs.html">Kibana Fleet APIs »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="manage-agents-in-fleet.html">Centrally manage Elastic Agents in Fleet</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Fleet enrollment tokens</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/security/enrollment-tokens.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="fleet-enrollment-tokens"></a>Fleet enrollment tokens</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/security/enrollment-tokens.asciidoc">edit</a></div>
</div></div></div>
<p>A Fleet enrollment token (referred to as an <code class="literal">enrollment API key</code> in the Fleet API documentation)
is an Elasticsearch API key that you use to enroll one or more Elastic Agents in Fleet.
The enrollment token enrolls the Elastic Agent in a specific
agent policy that defines the data to be collected by the agent. You can
use the token as many times as required. It will remain valid until you revoke
it.</p>
<p>The enrollment token is used for the initial communication between Elastic Agent and
Fleet Server. After the initial connection request from the Elastic Agent,
the Fleet Server passes two API keys to the Elastic Agent:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>An output API key</p>
<p>This API key is used to send data to Elasticsearch. It has the minimal permissions needed
to ingest all the data specified by the agent policy. If the API key is invalid,
the Elastic Agent stops ingesting data into Elasticsearch.</p>
</li>
<li class="listitem">
<p>A communication API key</p>
<p>This API key is used to communicate with the Fleet Server. It has only the
permissions needed to communicate with the Fleet Server. If the API key is
invalid, Fleet Server stops communicating with the Elastic Agent.</p>
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="create-fleet-enrollment-tokens"></a>Create enrollment tokens</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/security/enrollment-tokens.asciidoc">edit</a></div>
<p>Create enrollment tokens and use them to enroll Elastic Agents in specific policies.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you use the Fleet UI to add an agent or create a new policy, Fleet
creates an enrollment token for you automatically.</p>
</div>
</div>
<p>To create an enrollment token:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, go to <span class="strong strong"><strong>Management &#8594; Fleet &#8594; Enrollment tokens</strong></span>.
</li>
<li class="listitem">
<p>Click  <span class="strong strong"><strong>Create enrollment token</strong></span>. Name your token and select an agent policy.</p>
<p>Note that the token name you specify must be unique so as to avoid conflict with any existing API keys.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/create-token.png" alt="Enrollment tokens tab in Fleet">
</div>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create enrollment token</strong></span>.
</li>
<li class="listitem">
<p>In the list of tokens, click the <span class="strong strong"><strong>Show token</strong></span> icon to see the token secret.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/show-token.png" alt="Enrollment tokens tab with Show token icon highlighted">
</div>
</div>
</li>
</ol>
</div>
<p>All Elastic Agents enrolled through this token will use the selected policy unless you
assign or enroll them in a different policy.</p>
<p>To learn how to install Elastic Agents and enroll them in Fleet, refer to
<a class="xref" href="elastic-agent-installation.html" title="Install Elastic Agents"><em>Install Elastic Agents</em></a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can use the Fleet API to get a list of enrollment tokens. For more
information, refer to <a class="xref" href="fleet-api-docs.html" title="Kibana Fleet APIs">Kibana Fleet APIs</a>.</p>
</div>
</div>
<div class="position-relative"><h4><a id="revoke-fleet-enrollment-tokens"></a>Revoke enrollment tokens</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/security/enrollment-tokens.asciidoc">edit</a></div>
<p>You can revoke an enrollment token that you no longer wish to use to enroll Elastic Agents in an agent policy in Fleet.
Revoking an enrollment token essentially invalidates the API key used by agents to communicate with Fleet Server.</p>
<p>To revoke an enrollment token:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, click <span class="strong strong"><strong>Enrollment tokens</strong></span>.
</li>
<li class="listitem">
<p>Find the token you want to revoke in the list and click the <span class="strong strong"><strong>Revoke token</strong></span>
icon.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/revoke-token.png" alt="Enrollment tokens tab with Revoke token highlighted">
</div>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Revoke enrollment token</strong></span>. You can no longer use this token to enroll
Elastic Agents. However, the currently enrolled agents will continue to function.</p>
<p>To re-enroll your Elastic Agents, use an active enrollment token.</p>
</li>
</ol>
</div>
<p>Note that when an enrollment token is revoked it is not immediately deleted.
Deletion occurs automatically after the duration specified in the Elasticsearch
<a href="/guide/en/elasticsearch/reference/master/security-settings.html#api-key-service-settings-delete-retention-period" class="ulink" target="_top"><code class="literal">xpack.security.authc.api_key.delete.retention_period</code></a> setting has expired (see <a href="/guide/en/elasticsearch/reference/master/security-api-invalidate-api-key.html" class="ulink" target="_top">Invalidate API key API</a> for details).</p>
<p>Until the enrollment token has been deleted:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The token name may not be re-used when you <a class="xref" href="fleet-enrollment-tokens.html#create-fleet-enrollment-tokens" title="Create enrollment tokens">create an enrollment token</a>.
</li>
<li class="listitem">
The token continues to be visible in the Fleet UI.
</li>
<li class="listitem">
The token continues to be returned by a <code class="literal">GET /api/fleet/enrollment_api_keys</code> API request.
Revoked enrollment tokens are identified as <code class="literal">"active": false</code>.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="fleet-roles-and-privileges.html">« Required roles and privileges</a>
</span>
<span class="next">
<a href="fleet-api-docs.html">Kibana Fleet APIs »</a>
</span>
</div>
</body>
</html>
