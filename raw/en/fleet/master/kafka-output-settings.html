<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kafka output settings | Fleet and Elastic Agent Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Kafka output settings | Fleet and Elastic Agent Guide [master]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [master]"/>
<link rel="up" href="fleet-settings.html" title="Fleet UI settings"/>
<link rel="prev" href="ls-output-settings.html" title="Logstash output settings"/>
<link rel="next" href="manage-agents.html" title="Elastic Agents"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/master"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="manage-agents-in-fleet.html">Centrally manage Elastic Agents in Fleet</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="fleet-settings.html">Fleet UI settings</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ls-output-settings.html">« Logstash output settings</a>
</span>
<span class="next">
<a href="manage-agents.html">Elastic Agents »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="kafka-output-settings"></a>Kafka output settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h3>
</div></div></div>
<p>Specify these settings to send data over a secure connection to Kafka. In the Fleet <a class="xref" href="fleet-settings.html#output-settings" title="Output settings">Output settings</a>, make sure that the Kafka output type is selected.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Kafka output is currently not supported on Elastic Agents using the Elastic Defend integration.</p>
</div>
</div>
<h5><a id="_general_settings"></a>General settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h5>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-version"></a><span class="strong strong"><strong>Kafka version</strong></span></p>
</td>
<td align="left" valign="top">
<p>The Kafka protocol version that Elastic Agent will request when connecting.
Defaults to <code class="literal">1.0.0</code>.
Currently Kafka versions from <code class="literal">0.8.2.0</code> to <code class="literal">2.6.0</code> are supported, however the latest
Kafka version (<code class="literal">3.x.x</code>) is expected to be compatible when version <code class="literal">2.6.0</code> is selected.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-hosts"></a><span class="strong strong"><strong>Hosts</strong></span></p>
</td>
<td align="left" valign="top">
<p>The addresses your Elastic Agents will use to connect to one or more Kafka brokers.
Use the format <code class="literal">host:port</code> (without any protocol <code class="literal">http://</code>). Click <span class="strong strong"><strong>Add row</strong></span> to specify additional addresses.</p>
<p><span class="strong strong"><strong>Examples:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">localhost:9092</code>
</li>
<li class="listitem">
<code class="literal">mykafkahost:9092</code>
</li>
</ul>
</div>
<p>Refer to the <a class="xref" href="add-a-fleet-server.html" title="Add a Fleet Server">Fleet Server</a> documentation for default ports and other configuration details.</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_authentication_settings"></a>Authentication settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h5>
<p>Select the mechanism that Elastic Agent uses to authenticate with Kafka.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-authentication-none"></a><span class="strong strong"><strong>None</strong></span></p>
</td>
<td align="left" valign="top">
<p>No authentication is used between Elastic Agent and Kafka. This is the default option. In production, it&#8217;s recommended to have an authentication method selected.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Plaintext
</span>
</dt>
<dd>
<p>
Set this option for traffic between Elastic Agent and Kafka to be sent as plaintext, without any transport layer security.
</p>
<p>This is the default option when no authentication is set.</p>
</dd>
<dt>
<span class="term">
Encryption
</span>
</dt>
<dd>
<p>
Set this option for traffic between Elastic Agent and Kafka to use transport layer security.
</p>
<p>When <span class="strong strong"><strong>Encryption</strong></span> is selected, the <span class="strong strong"><strong>Server SSL certificate authorities</strong></span> and <span class="strong strong"><strong>Verification mode</strong></span> mode options become available.</p>
</dd>
</dl>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-authentication-basic"></a><span class="strong strong"><strong>Username / Password</strong></span></p>
</td>
<td align="left" valign="top">
<p>Connect to Kafka with a username and password.</p>
<p>Provide your username and password, and select a SASL (Simple Authentication and Security Layer) mechanism for your login credentials.</p>
<p>When SCRAM is enabled, Elastic Agent uses the <a href="https://en.wikipedia.org/wiki/Salted_Challenge_Response_Authentication_Mechanism" class="ulink" target="_top">SCRAM</a> mechanism to authenticate the user credential. SCRAM is based on the IETF RFC5802 standard which describes a challenge-response mechanism for authenticating users.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Plain - SCRAM is not used to authenticate
</li>
<li class="listitem">
SCRAM-SHA-256 - uses the SHA-256 hashing function
</li>
<li class="listitem">
SCRAM-SHA-512 - uses the SHA-512 hashing function
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-authentication-ssl"></a><span class="strong strong"><strong>SSL</strong></span></p>
</td>
<td align="left" valign="top">
<p>Authenticate using the Secure Sockets Layer (SSL) protocol. Provide the following details for your SSL certificate:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Client SSL certificate
</span>
</dt>
<dd>
<p>
The certificate generated for the client. Copy and paste in the full contents of the certificate. This is the certificate that all the agents will use to connect to Kafka.
</p>
<p>In cases where each client has a unique certificate, the local path to that certificate can be placed here. The agents will pick the certificate in that location when establishing a connection to Kafka.</p>
</dd>
<dt>
<span class="term">
Client SSL certificate key
</span>
</dt>
<dd>
<p>
The private key generated for the client. This must be in PKCS 8 key. Copy and paste in the full contents of the certificate key. This is the certificate key that all the agents will use to connect to Kafka.
</p>
<p>In cases where each client has a unique certificate key, the local path to that certificate key can be placed here. The agents will pick the certificate key in that location when establishing a connection to Kafka.</p>
</dd>
</dl>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><span class="strong strong"><strong>Server SSL certificate authorities</strong></span></p>
</td>
<td align="left" valign="top">
<p>The CA certificate to use to connect to Kafka. This is the CA used to generate the certificate and key for Kafka. Copy and paste in the full contents for the CA certificate.</p>
<p>This setting is optional. This setting is not available when the authentication <code class="literal">None</code> and <code class="literal">Plaintext</code> options are selected.</p>
<p>Click <span class="strong strong"><strong>Add row</strong></span> to specify additional certificate authories.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><span class="strong strong"><strong>Verification mode</strong></span></p>
</td>
<td align="left" valign="top">
<p>Controls the verification of server certificates. Valid values are:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">Full</code>
</span>
</dt>
<dd>
Verifies that the provided certificate is signed by a trusted
authority (CA) and also verifies that the server&#8217;s hostname (or IP address)
matches the names identified within the certificate.
</dd>
<dt>
<span class="term">
<code class="literal">None</code>
</span>
</dt>
<dd>
Performs <em>no verification</em> of the server&#8217;s certificate. This
mode disables many of the security benefits of SSL/TLS and should only be used
after cautious consideration. It is primarily intended as a temporary
diagnostic mechanism when attempting to resolve TLS errors; its use in
production environments is strongly discouraged.
</dd>
<dt>
<span class="term">
<code class="literal">Strict</code>
</span>
</dt>
<dd>
Verifies that the provided certificate is signed by a trusted
authority (CA) and also verifies that the server&#8217;s hostname (or IP address)
matches the names identified within the certificate. If the Subject Alternative
Name is empty, it returns an error.
</dd>
<dt>
<span class="term">
<code class="literal">Certificate</code>
</span>
</dt>
<dd>
Verifies that the provided certificate is signed by a
trusted authority (CA), but does not perform any hostname verification.
</dd>
</dl>
</div>
<p>The default value is <code class="literal">Full</code>. This setting is not available when the authentication <code class="literal">None</code> and <code class="literal">Plaintext</code> options are selected.</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_partitioning_settings"></a>Partitioning settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h5>
<p>The number of partitions created is set automatically by the Kafka broker based on the list of topics. Records are then published to partitions either randomly, in round-robin order, or according to a calculated hash.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-partitioning-random"></a><span class="strong strong"><strong>Random</strong></span></p>
</td>
<td align="left" valign="top">
<p>Publish records to Kafka output broker event partitions randomly. Specify the number of events to be published to the same partition before the partitioner selects a new partition.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-partitioning-roundrobin"></a><span class="strong strong"><strong>Round robin</strong></span></p>
</td>
<td align="left" valign="top">
<p>Publish records to Kafka output broker event partitions in a round-robin fashion. Specify the number of events to be published to the same partition before the partitioner selects a new partition.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-partitioning-hash"></a><span class="strong strong"><strong>Hash</strong></span></p>
</td>
<td align="left" valign="top">
<p>Publish records to Kafka output broker event partitions based on a hash computed from the specified list of fields. If a field is not specified, the Kafka event key value is used.</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_topics_settings"></a>Topics settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h5>
<p>Use these options to dynamically set the Kafka topic for each Elastic Agent event.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-topics-default"></a><span class="strong strong"><strong>Default topic</strong></span></p>
</td>
<td align="left" valign="top">
<p>Set the default topic to use. Click <span class="strong strong"><strong>Add topic processor</strong></span> to specify additional processors to set topics based on event contents.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-topics-processors"></a><span class="strong strong"><strong>Processors</strong></span></p>
</td>
<td align="left" valign="top">
<p>For each processor provide a condition, the event value to check against, and the resulting Kafka topic.</p>
<p>Refer to <a class="xref" href="processor-syntax.html#processor-conditions" title="Conditions">conditions</a> in the Elastic Agent processor syntax for condition descriptions. Currently the <code class="literal">equals</code>, <code class="literal">contains</code>, and <code class="literal">regexp</code> conditions are available.</p>
<p>Events that don&#8217;t match against any defined processor are set to the default topic.</p>
<p>Processors are applied in the order that they appear, from top to bottom.</p>
<p>The value field must be specified in a <code class="literal">[key]: value</code> format with both the key and value being strings. For example, <code class="literal">host.port: 2000</code> or <code class="literal">message: Test</code>.</p>
<p>As an example for setting up your processors, you might want to route log events based on severity. To do so, you can specify a default topic for all events not matched by other processors:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">%{[fields.log_topic]}</code>.
</li>
</ul>
</div>
<p>Then, create a processor to route critical events:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Condition: <code class="literal">Contains</code>
</li>
<li class="listitem">
Value: <code class="literal">message: “CRITICAL”</code>
</li>
<li class="listitem">
Topic: <code class="literal">critical-%{[agent.version]}</code>
</li>
</ul>
</div>
<p>And create another processor to route error events:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Condition: <code class="literal">Contains</code>
</li>
<li class="listitem">
Value: <code class="literal">message: “ERR”</code>
</li>
<li class="listitem">
Topic: <code class="literal">error-%{[agent.version]}</code>
</li>
</ul>
</div>
<p>All non-critical and non-error events will then route to the default <code class="literal">%{[fields.log_topic]}</code> topic.</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_header_settings"></a>Header settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h5>
<p>A header is a key-value pair, and multiple headers can be included with the same key. Only string values are supported. These headers will be included in each produced Kafka message.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-headers-key"></a><span class="strong strong"><strong>Key</strong></span></p>
</td>
<td align="left" valign="top">
<p>The key to set in the Kafka header.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-headers-value"></a><span class="strong strong"><strong>Value</strong></span></p>
</td>
<td align="left" valign="top">
<p>The value to set in the Kafka header.</p>
<p>Click <span class="strong strong"><strong>Add header</strong></span> to configure additional headers to be included in each Kafka message.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-headers-clientid"></a><span class="strong strong"><strong>Client ID</strong></span></p>
</td>
<td align="left" valign="top">
<p>The configurable ClientID used for logging, debugging, and auditing purposes. The default is <code class="literal">Elastic</code>. The Client ID is part of the protocol to identify where the messages are coming from.</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_compression_settings"></a>Compression settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h5>
<p>You can enable compression to reduce the volume of Kafka output.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-compression-codec"></a><span class="strong strong"><strong>Codec</strong></span></p>
</td>
<td align="left" valign="top">
<p>Select a compression codec to use. Supported codecs are <code class="literal">snappy</code>, <code class="literal">lz4</code> and <code class="literal">gzip</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-compression-level"></a><span class="strong strong"><strong>Level</strong></span></p>
</td>
<td align="left" valign="top">
<p>For the <code class="literal">gzip</code> codec you can choose a compression level. The level must be in the range of <code class="literal">1</code> (best speed) to <code class="literal">9</code> (best compression).</p>
<p>Increasing the compression level reduces the network usage but increases the CPU usage. The default value is 4.</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_broker_settings"></a>Broker settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h5>
<p>Configure timeout and buffer size values for the Kafka brokers.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-broker-timeout"></a><span class="strong strong"><strong>Broker timeout</strong></span></p>
</td>
<td align="left" valign="top">
<p>The maximum length of time a Kafka broker waits for the required number of ACKs before timing out (see the <code class="literal">ACK reliability</code> setting further in). The default is 30 seconds.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-broker-reachability-timeout"></a><span class="strong strong"><strong>Broker reachability timeout</strong></span></p>
</td>
<td align="left" valign="top">
<p>The maximum length of time that an Elastic Agent waits for a response from a Kafka broker before timing out. The default is 30 seconds.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-broker-ack-reliability"></a><span class="strong strong"><strong>ACK reliability</strong></span></p>
</td>
<td align="left" valign="top">
<p>The ACK reliability level required from broker. Options are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Wait for local commit
</li>
<li class="listitem">
Wait for all replicas to commit
</li>
<li class="listitem">
Do not wait
</li>
</ul>
</div>
<p>The default is <code class="literal">Wait for local commit</code>.</p>
<p>Note that if ACK reliability is set to <code class="literal">Do not wait</code> no ACKs are returned by Kafka. Messages might be lost silently in the event of an error.</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_other_settings"></a>Other settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/fleet-settings-output-kafka.asciidoc">edit</a></h5>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-other-key"></a><span class="strong strong"><strong>Key</strong></span></p>
</td>
<td align="left" valign="top">
<p>An optional formatted string specifying the Kafka event key. If configured, the event key can be extracted from the event using a format string.</p>
<p>See the <a href="https://kafka.apache.org/intro#intro_topics" class="ulink" target="_top">Kafka documentation</a> for the implications of a particular choice of key; by default, the key is chosen by the Kafka cluster.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-other-proxy"></a><span class="strong strong"><strong>Proxy</strong></span></p>
</td>
<td align="left" valign="top">
<p>Select a proxy URL for Elastic Agent to connect to Kafka.
To learn about proxy configuration, refer to <a class="xref" href="fleet-agent-proxy-support.html" title="Using a proxy server with Elastic Agent and Fleet">Using a proxy server with Elastic Agent and Fleet</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-advanced-yaml-setting"></a><span class="strong strong"><strong>Advanced YAML configuration</strong></span></p>
</td>
<td align="left" valign="top">
<p>YAML settings that will be added to the Kafka output section of each policy
that uses this output. Make sure you specify valid YAML. The UI does not
currently provide validation.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-agent-integrations"></a><span class="strong strong"><strong>Make this output the default for agent integrations</strong></span></p>
</td>
<td align="left" valign="top">
<p>When this setting is on, Elastic Agents use this output to send data if no other
output is set in the <a class="xref" href="agent-policy.html" title="Elastic Agent policies">agent policy</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top">
<p><a id="kafka-output-agent-monitoring"></a><span class="strong strong"><strong>Make this output the default for agent monitoring</strong></span></p>
</td>
<td align="left" valign="top">
<p>When this setting is on, Elastic Agents use this output to send <a class="xref" href="monitor-elastic-agent.html" title="Monitor Elastic Agents">agent monitoring data</a> if no other output is set in the <a class="xref" href="agent-policy.html" title="Elastic Agent policies">agent policy</a>.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ls-output-settings.html">« Logstash output settings</a>
</span>
<span class="next">
<a href="manage-agents.html">Elastic Agents »</a>
</span>
</div>
</div>
</body>
</html>
