<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kubernetes Secrets Provider | Fleet and Elastic Agent Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Kubernetes Secrets Provider | Fleet and Elastic Agent Guide [master]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [master]"/>
<link rel="up" href="providers.html" title="Configure providers for standalone Elastic Agents"/>
<link rel="prev" href="env-provider.html" title="Env Provider"/>
<link rel="next" href="kubernetes_leaderelection-provider.html" title="Kubernetes LeaderElection Provider"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/master"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="env-provider.html">« Env Provider</a>
</span>
<span class="next">
<a href="kubernetes_leaderelection-provider.html">Kubernetes LeaderElection Provider »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="elastic-agent-configuration.html">Configure standalone Elastic Agents</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="providers.html">Configure providers for standalone Elastic Agents</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Kubernetes Secrets Provider</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/configuration/providers/kubernetes_secrets-provider.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="kubernetes_secrets-provider"></a>Kubernetes Secrets Provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/elastic-agent/configuration/providers/kubernetes_secrets-provider.asciidoc">edit</a></h3>
</div></div></div>
<p>Provides access to the Kubernetes Secrets API.</p>
<p>Use the format <code class="literal">${kubernetes_secrets.&lt;default&gt;.&lt;somesecret&gt;.&lt;value&gt;}</code> to reference a Kubernetes Secrets variable, where <code class="literal">default</code> is the namespace of the Secret, <code class="literal">somesecret</code> is the name of the Secret and <code class="literal">value</code> is the field of the Secret to access.</p>
<p>To obtain the values for the secrets, a request to the API Server is made. To avoid multiple requests for the same secret and to not overwhelm the API Server, a cache to store the values is used by default. This configuration can be set by using the variables <code class="literal">cache_*</code> (see below).</p>
<p>The provider needs a <code class="literal">kubeconfig</code> file to establish connection to the Kubernetes API. It can automatically reach the API if it&#8217;s run in an InCluster environment (Elastic Agent runs as pod).</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">providers.kubernetes_secrets:
  #kube_config: /Users/elastic-agent/.kube/config
  #kube_client_options:
  #  qps: 5
  #  burst: 10
  #cache_disable: false
  #cache_refresh_interval: 60s
  #cache_ttl: 1h
  #cache_request_timeout: 5s</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">kube_config</code>
</span>
</dt>
<dd>
(Optional) Use the given config file as configuration for the Kubernetes client. If <code class="literal">kube_config</code> is not set, <code class="literal">KUBECONFIG</code> environment variable will be checked and will fall back to InCluster if it&#8217;s not present.
</dd>
<dt>
<span class="term">
<code class="literal">kube_client_options</code>
</span>
</dt>
<dd>
(Optional) Configure additional options for the Kubernetes client. Supported options are <code class="literal">qps</code> and <code class="literal">burst</code>. If not set, the Kubernetes client&#8217;s default QPS and burst settings are used.
</dd>
<dt>
<span class="term">
<code class="literal">cache_disable</code>
</span>
</dt>
<dd>
(Optional) Disables the cache for the secrets. When disabled, thus is set to <code class="literal">true</code>, code makes a request to the API Server to obtain the value. To continue using the cache, set the variable to <code class="literal">false</code>. Default is <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">cache_refresh_interval</code>
</span>
</dt>
<dd>
(Optional) Defines the period to update all secret values kept in the cache. Defaults to <code class="literal">60s</code>.
</dd>
<dt>
<span class="term">
<code class="literal">cache_ttl</code>
</span>
</dt>
<dd>
(Optional) Defines for how long a secret should be kept in the cache if not being requested. The default is <code class="literal">1h</code>.
</dd>
<dt>
<span class="term">
<code class="literal">cache_request_timeout</code>
</span>
</dt>
<dd>
(Optional) Defines how long the API Server can take to provide the value for a given secret. Defaults to <code class="literal">5s</code>.
</dd>
</dl>
</div>
<p>If you run agent on Kubernetes, the proper rule in the <code class="literal">ClusterRole</code> is required to provide access to the Elastic Agent pod in the Secrets API:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">- apiGroups: [""]
  resources:
    - secrets
  verbs: ["get"]</pre>
</div>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>The above rule will give permission to Elastic Agent pod to access Kubernetes Secrets API. Anyone who has access to the Elastic Agent pod (<code class="literal">kubectl exec</code> for example) will also have access to the Kubernetes Secrets API. This allows access to a specific secret, regardless of the namespace that it belongs to. This option should be carefully considered.</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="env-provider.html">« Env Provider</a>
</span>
<span class="next">
<a href="kubernetes_leaderelection-provider.html">Kubernetes LeaderElection Provider »</a>
</span>
</div>
</body>
</html>
