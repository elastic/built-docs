<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Monitor Elastic Agents | Fleet and Elastic Agent Guide [master] | Elastic</title>
<meta class="elastic" name="content" content="Monitor Elastic Agents | Fleet and Elastic Agent Guide [master]">

<link rel="home" href="index.html" title="Fleet and Elastic Agent Guide [master]"/>
<link rel="up" href="manage-agents.html" title="Elastic Agents"/>
<link rel="prev" href="migrate-elastic-agent.html" title="Migrate Fleet-managed Elastic Agents from one cluster to another"/>
<link rel="next" href="agent-health-status.html" title="Elastic Agent health status"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Fleet and Elastic Agent"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/Elastic Agent/master"/>
<meta name="DC.subject" content="Fleet and Elastic Agent"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="migrate-elastic-agent.html">« Migrate Fleet-managed Elastic Agents from one cluster to another</a>
</span>
<span class="next">
<a href="agent-health-status.html">Elastic Agent health status »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Fleet and Elastic Agent Guide [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="manage-agents-in-fleet.html">Centrally manage Elastic Agents in Fleet</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="manage-agents.html">Elastic Agents</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Monitor Elastic Agents</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="monitor-elastic-agent"></a>Monitor Elastic Agents</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
</div></div></div>
<p>Fleet provides built-in capabilities for monitoring your fleet of Elastic Agents.
In Fleet, you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#view-agent-status" title="View agent status overview">View agent status overview</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#view-agent-details" title="View details for an agent">View details for an agent</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#view-agent-activity" title="View agent activity">View agent activity</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#view-agent-logs" title="View agent logs">View agent logs</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#collect-agent-diagnostics" title="Collect Elastic Agent diagnostics">Collect Elastic Agent diagnostics</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#view-agent-metrics" title="View the Elastic Agent metrics dashboard">View the Elastic Agent metrics dashboard</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#change-agent-monitoring" title="Change Elastic Agent monitoring settings">Change Elastic Agent monitoring settings</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#external-elasticsearch-monitoring" title="Send Elastic Agent monitoring data to a remote Elasticsearch cluster">Send Elastic Agent monitoring data to a remote Elasticsearch cluster</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-elastic-agent.html#fleet-alerting" title="Enable alerts and ML jobs based on Fleet and Elastic Agent status">Enable alerts and ML jobs based on Fleet and Elastic Agent status</a>
</li>
</ul>
</div>
<p>Agent monitoring is turned on by default in the agent policy unless you
turn it off. Want to turn off agent monitoring to stop collecting logs and
metrics? See <a class="xref" href="monitor-elastic-agent.html#change-agent-monitoring" title="Change Elastic Agent monitoring settings">Change Elastic Agent monitoring settings</a>.</p>
<p>Want to receive an alert when your Elastic Agent health status changes?
Refer to <a class="xref" href="monitor-elastic-agent.html#fleet-alerting" title="Enable alerts and ML jobs based on Fleet and Elastic Agent status">Enable alerts and ML jobs based on Fleet and Elastic Agent status</a> and our <a class="xref" href="monitor-elastic-agent.html#fleet-alerting-example" title="Example: Enable an alert for offline Elastic Agents">alerting example</a>.</p>
<p>For more detail about how agents communicate their status to Fleet, refer to <a class="xref" href="agent-health-status.html" title="Elastic Agent health status">Elastic Agent health status</a>.</p>
<div class="position-relative"><h4><a id="view-agent-status"></a>View agent status overview</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>To view the overall status of your Fleet-managed agents, in Kibana, go to
<span class="strong strong"><strong>Management &#8594; Fleet &#8594; Agents</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/kibana-fleet-agents.png" alt="Agents tab showing status of each Elastic Agent">
</div>
</div>
<p>Elastic Agents can have the following statuses:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Healthy</strong></span></p></td>
<td align="left" valign="top"><p>Elastic Agents are enrolled and checked in. There are no agent policy updates or automatic agent binary updates in progress, but the agent binary may still be out of date. Elastic Agents continuously check in to the Fleet Server for required updates.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Unhealthy</strong></span></p></td>
<td align="left" valign="top"><p>Elastic Agents have errors or are running in a degraded state. An agent will be reported as <code class="literal">unhealthy</code> as a result of a configuration problem on the host system. For example, an Elastic Agent may not have the correct permissions required to run an integration that has been added to the Elastic Agent policy. In this case, you may need to investigate and address the situation.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Updating</strong></span></p></td>
<td align="left" valign="top"><p>Elastic Agents are updating the agent policy, updating the binary, or enrolling or unenrolling from Fleet.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Offline</strong></span></p></td>
<td align="left" valign="top"><p>Elastic Agents have stayed in an unhealthy status for a period of time. Offline agent&#8217;s API keys remain valid. You can still see these Elastic Agents in the Fleet UI and investigate them for further diagnosis if required.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Inactive</strong></span></p></td>
<td align="left" valign="top"><p>Elastic Agents have been offline for longer than the time set in your <a class="xref" href="set-inactivity-timeout.html" title="Set inactivity timeout">inactivity timeout</a>. These Elastic Agents are valid, but have been removed from the main Fleet UI.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Unenrolled</strong></span></p></td>
<td align="left" valign="top"><p>Elastic Agents have been manually unenrolled and their API keys have been removed from the system. You can <a class="xref" href="unenroll-elastic-agent.html" title="Unenroll Elastic Agents">unenroll</a> an offline Elastic Agent using Elastic Agent actions if you determine it&#8217;s offline and no longer valid.</p>
<p>These agents need to re-enroll in Fleet to be operational again.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The following diagram shows the flow of Elastic Agent statuses:</p>
<div class="imageblock">
<div class="content">
<img src="images/agent-status-diagram.png" alt="Diagram showing the flow of Fleet Agent statuses">
</div>
</div>
<p>To filter the list of agents by status, click the <span class="strong strong"><strong>Status</strong></span> dropdown and select
one or more statuses.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/agent-status-filter.png" alt="Agent Status dropdown with multiple statuses selected">
</div>
</div>
<p>For advanced filtering, use the search bar to create structured queries
using <a href="/guide/en/kibana/master/kuery-query.html" class="ulink" target="_top">Kibana Query Language</a>. For example, enter
<code class="literal">local_metadata.os.family : "darwin"</code> to see only agents running on macOS.</p>
<div class="position-relative"><h4><a id="view-agent-details"></a>View details for an agent</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>In Fleet, you can access the detailed status of an individual agent and the integrations that are associated with it through the agent policy.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Host</strong></span> column, click the agent&#8217;s name.
</li>
</ol>
</div>
<p>On the <span class="strong strong"><strong>Agent details</strong></span> tab, the <span class="strong strong"><strong>Overview</strong></span> pane shows details about the agent and its performance, including its memory and CPU usage, last activity time, and last checkin message. To access metrics visualizations, you can also <a class="xref" href="monitor-elastic-agent.html#view-agent-metrics" title="View the Elastic Agent metrics dashboard">View the Elastic Agent metrics dashboard</a>.</p>
<div class="imageblock">
<div class="content">
<img src="images/agent-detail-overview.png" alt="Agent details overview pane with various metrics">
</div>
</div>
<p>The <span class="strong strong"><strong>Integrations</strong></span> pane shows the status of the integrations that have been added to the agent policy. Expand any integration to view its health status. Any errors or warnings are displayed as alerts.</p>
<div class="imageblock">
<div class="content">
<img src="images/agent-detail-integrations-health.png" alt="Agent details integrations pane with health status">
</div>
</div>
<p>To gather more detail about a particular error or warning, from the <span class="strong strong"><strong>Actions</strong></span> menu select <span class="strong strong"><strong>View agent JSON</strong></span>. The JSON contains all of the raw agent data tracked by Fleet.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Currently, the <span class="strong strong"><strong>Integrations</strong></span> pane shows the health status only for agent inputs. Health status is not yet available for agent outputs.</p>
</div>
</div>
<div class="position-relative"><h4><a id="view-agent-activity"></a>View agent activity</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>You can view a chronological list of all operations performed by your Elastic Agents.</p>
<p>On the <span class="strong strong"><strong>Agents</strong></span> tab, click <span class="strong strong"><strong>Agent activity</strong></span>. All agent operations are shown, beginning from the most recent, including any in progress operations.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/agent-activity.png" alt="Agent activity panel" width="showing the operations for an Elastic Agent">
</div>
</div>
<div class="position-relative"><h4><a id="view-agent-logs"></a>View agent logs</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>When Fleet reports an agent status like <code class="literal">Offline</code> or <code class="literal">Unhealthy</code>, you might
want to view the agent logs to diagnose potential causes. If agent monitoring
is configured to collect logs (the default), you can view agent logs in Fleet.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Host</strong></span> column, click the agent&#8217;s name.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Agent details</strong></span> tab, verify that <span class="strong strong"><strong>Monitor logs</strong></span> is enabled. If
it&#8217;s not, refer to <a class="xref" href="monitor-elastic-agent.html#change-agent-monitoring" title="Change Elastic Agent monitoring settings">Change Elastic Agent monitoring settings</a>.
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Logs</strong></span> tab.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/view-agent-logs.png" alt="View agent logs under agent details">
</div>
</div>
</li>
</ol>
</div>
<p>On the <span class="strong strong"><strong>Logs</strong></span> tab you can filter, search, and explore the agent logs:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use the search bar to create structured queries using
<a href="/guide/en/kibana/master/kuery-query.html" class="ulink" target="_top">Kibana Query Language</a>.
</li>
<li class="listitem">
<p>Choose one or more datasets to show logs for specific programs, such as
Filebeat or Fleet Server.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/kibana-fleet-datasets.png" alt="Fleet showing datasets for logging">
</div>
</div>
</li>
<li class="listitem">
Change the log level to filter the view by log levels. Want to see debugging
logs? Refer to <a class="xref" href="monitor-elastic-agent.html#change-logging-level" title="Change the logging level">Change the logging level</a>.
</li>
<li class="listitem">
Change the time range to view historical logs.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Open in Logs</strong></span> to tail agent log files in real time. For more
information about logging, refer to
<a href="/guide/en/observability/master/tail-logs.html" class="ulink" target="_top">Tail log files</a>.
</li>
</ul>
</div>
<div class="position-relative"><h4><a id="change-logging-level"></a>Change the logging level</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>The logging level for monitored agents is set to <code class="literal">info</code> by default. You can
change the agent logging level, for example, to turn on debug logging remotely:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>After navigating to the <span class="strong strong"><strong>Logs</strong></span> tab as described in <a class="xref" href="monitor-elastic-agent.html#view-agent-logs" title="View agent logs">View agent logs</a>,
scroll down to find the <span class="strong strong"><strong>Agent logging level</strong></span> setting.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/agent-set-logging-level.png" alt="{Logs} tab showing the agent logging level setting">
</div>
</div>
</li>
<li class="listitem">
<p>Select an <span class="strong strong"><strong>Agent logging level</strong></span>:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top">
<p><code class="literal">error</code></p>
</td>
<td align="left" valign="top"><p>Logs errors and critical errors.</p></td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">warning</code></p>
</td>
<td align="left" valign="top"><p>Logs warnings, errors, and critical errors.</p></td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">info</code></p>
</td>
<td align="left" valign="top"><p>Logs informational messages, including the number of events that are published.
Also logs any warnings, errors, or critical errors.</p></td>
</tr>
<tr>
<td align="left" valign="top">
<p><code class="literal">debug</code></p>
</td>
<td align="left" valign="top"><p>Logs debug messages, including a detailed printout of all events flushed. Also
logs informational messages, warnings, errors, and critical errors.</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Apply changes</strong></span> to apply the updated logging level to the agent.
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="collect-agent-diagnostics"></a>Collect Elastic Agent diagnostics</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>Fleet provides the ability to remotely generate and gather an Elastic Agent&#8217;s diagnostics bundle.
An agent can gather and upload diagnostics if it is online in a <code class="literal">Healthy</code> or <code class="literal">Unhealthy</code> state.
To download the diagnostics bundle for local viewing:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Host</strong></span> column, click the agent&#8217;s name.
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Diagnostics</strong></span> tab.
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Request diagnostics .zip</strong></span> button.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/collect-agent-diagnostics.png" alt="Collect agent diagnostics under agent details">
</div>
</div>
</li>
</ol>
</div>
<p>Any in-progress or previously collected bundles for the Elastic Agent will be listed on this page.</p>
<p>Note that the bundles are stored in Elasticsearch and are removed automatically after 7 days. You can also delete any previously created bundle by clicking the <code class="literal">trash can</code> icon.</p>
<div class="position-relative"><h4><a id="view-agent-metrics"></a>View the Elastic Agent metrics dashboard</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>When agent monitoring is configured to collect metrics (the default), you can
use the <span class="strong strong"><strong>[Elastic Agent] Agent metrics</strong></span> dashboard in Kibana to view details
about Elastic Agent resource usage, event throughput, and errors. This information can
help you identify problems and make decisions about scaling your deployment.</p>
<p>To view agent metrics:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Host</strong></span> column, click the agent&#8217;s name.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Agent details</strong></span> tab, verify that <span class="strong strong"><strong>Monitor metrics</strong></span> is enabled. If
it&#8217;s not, refer to <a class="xref" href="monitor-elastic-agent.html#change-agent-monitoring" title="Change Elastic Agent monitoring settings">Change Elastic Agent monitoring settings</a>.
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>View more agent metrics</strong></span> to navigate to the
<span class="strong strong"><strong>[Elastic Agent] Agent metrics</strong></span> dashboard.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/selected-agent-metrics-dashboard.png" alt="Screen capture showing Elastic Agent metrics">
</div>
</div>
</li>
</ol>
</div>
<p>The dashboard uses standard Kibana visualizations that you can extend to meet
your needs.</p>
<div class="position-relative"><h4><a id="change-agent-monitoring"></a>Change Elastic Agent monitoring settings</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>Agent monitoring is turned on by default in the agent policy. To change agent
monitoring settings for all agents enrolled in a specific agent policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Fleet, open the <span class="strong strong"><strong>Agent policies</strong></span> tab.
</li>
<li class="listitem">
Click the agent policy to edit it, then click <span class="strong strong"><strong>Settings</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Agent monitoring</strong></span>, deselect (or select) one or both of these
settings: <span class="strong strong"><strong>Collect agent logs</strong></span> and <span class="strong strong"><strong>Collect agent metrics</strong></span>.
</li>
<li class="listitem">
Save your changes.
</li>
</ol>
</div>
<p>To turn off agent monitoring when creating a new agent policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In the <span class="strong strong"><strong>Create agent policy</strong></span> flyout, expand <span class="strong strong"><strong>Advanced options</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Agent monitoring</strong></span>, deselect <span class="strong strong"><strong>Collect agent logs</strong></span> and
<span class="strong strong"><strong>Collect agent metrics</strong></span>.
</li>
<li class="listitem">
When you&#8217;re done configuring the agent policy, click <span class="strong strong"><strong>Create agent policy</strong></span>.
</li>
</ol>
</div>
<div class="position-relative"><h4><a id="external-elasticsearch-monitoring"></a>Send Elastic Agent monitoring data to a remote Elasticsearch cluster</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>You may want to store all of the health and status data about your Elastic Agents in a remote Elasticsearch cluster, so that it&#8217;s separate and independent from the deployment where you use Fleet to manage the agents.</p>
<p>To do so, follow the steps in <a class="xref" href="remote-elasticsearch-output.html" title="Remote Elasticsearch output">Remote Elasticsearch output</a>. After the new output is configured, follow the steps to update the Elastic Agent policy and make sure that the <span class="strong strong"><strong>Output for agent monitoring</strong></span> setting is enabled. Elastic Agent monitoring data will use the remote Elasticsearch output that you configured.</p>
<div class="position-relative"><h4><a id="fleet-alerting"></a>Enable alerts and ML jobs based on Fleet and Elastic Agent status</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>You can access the health status of Fleet-managed Elastic Agents and other Fleet settings through internal Fleet indices. This enables you to leverage various applications within the Elastic Stack that can be triggered by the provided information. For instance, you can now create alerts and machine learning (ML) jobs based on these specific fields. Refer to the <a href="/guide/en/kibana/master/alerting-getting-started.html" class="ulink" target="_top">Alerting documentation</a> or see the <a class="xref" href="monitor-elastic-agent.html#fleet-alerting-example" title="Example: Enable an alert for offline Elastic Agents">example</a> on this page to learn how to define rules that can trigger actions when certain conditions are met.</p>
<p>This functionality allows you to effectively track an agent&#8217;s status, and identify scenarios where it has gone offline, is experiencing health issues, or is facing challenges related to input or output.</p>
<p>The following datastreams and fields are available.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Datastream
</span>
</dt>
<dd>
<p>
<code class="literal">metrics-fleet_server.agent_status-default</code>
</p>
<p>This data stream publishes the number of Elastic Agents in various states.</p>
<p><span class="strong strong"><strong>Fields</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">@timestamp</code>
</li>
<li class="listitem">
<code class="literal">fleet.agents.total</code> - A count of all agents
</li>
<li class="listitem">
<code class="literal">fleet.agents.enrolled</code> - A count of all agents currently enrolled
</li>
<li class="listitem">
<code class="literal">fleet.agents.unenrolled</code> - A count of agents currently unenrolled
</li>
<li class="listitem">
<code class="literal">fleet.agents.healthy</code> - A count of agents currently healthy
</li>
<li class="listitem">
<code class="literal">fleet.agents.offline</code> - A count of agents currently offline
</li>
<li class="listitem">
<code class="literal">fleet.agents.updating</code> - A count of agents currently in the process of updating
</li>
<li class="listitem">
<code class="literal">fleet.agents.unhealthy</code> - A count of agents currently unhealthy
</li>
<li class="listitem">
<code class="literal">fleet.agents.inactive</code> - A count of agents currently inactive
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Other fields regarding agent status, based on input and output health, are currently under consideration for future development.</p>
</div>
</div>
</dd>
<dt>
<span class="term">
Datastream
</span>
</dt>
<dd>
<p>
<code class="literal">metrics-fleet_server.agent_versions-default</code>
</p>
<p>This index publishes a separate document for each version number and a count of enrolled agents only.</p>
<p><span class="strong strong"><strong>Fields</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">@timestamp</code>
</li>
<li class="listitem">
<code class="literal">fleet.agent.version</code> - A keyword field containing the version number
</li>
<li class="listitem">
<code class="literal">fleet.agent.count</code> - A count of agents on the specified version
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="position-relative"><h5><a id="fleet-alerting-example"></a>Example: Enable an alert for offline Elastic Agents</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/ingest-docs/edit/main/docs/en/ingest-management/fleet/monitor-elastic-agent.asciidoc">edit</a></div>
<p>You can set up an alert to notify you when one or more Elastic Agents goes offline:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, navigate to <span class="strong strong"><strong>Management &gt; Stack Management &gt; Rules</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create rule</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Elasticsearch query</strong></span> as the rule type.
</li>
<li class="listitem">
Choose a name for the rule, for example <code class="literal">Elastic Agent status</code>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>KQL or Lucene</strong></span> as the query type.
</li>
<li class="listitem">
Select <code class="literal">DATA VIEW metrics-*</code> as the data view.
</li>
<li class="listitem">
Define your query, for example: <code class="literal">fleet.agents.offline &gt;= 1</code>.
</li>
<li class="listitem">
<p>Set the alert group, threshold, and time window. For example:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
WHEN: <code class="literal">count()</code>
</li>
<li class="listitem">
OVER: <code class="literal">all documents</code>
</li>
<li class="listitem">
IS ABOVE: <code class="literal">0</code>
</li>
<li class="listitem">
<p>FOR THE LAST <code class="literal">5 minutes</code></p>
<p>This will generate an alert when one or more agents are reported by the <code class="literal">fleet.agents.offline</code> field over the last five minutes to be offline.</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Set the number of documents to send, for example:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
SIZE: 100
</li>
</ul>
</div>
</li>
<li class="listitem">
Set <span class="strong strong"><strong>Check every</strong></span> to the frequency at which the rule condition should be evaluated. The default setting is one minute.
</li>
<li class="listitem">
<p>Select an action to occur when the rule conditions are met. For example, to set the alert to send an email when an alert occurs, select the Email connector type and specify:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Email connector: <code class="literal">Elastic-Cloud-SMPT</code>
</li>
<li class="listitem">
Action frequency: <code class="literal">For each alert</code> and <code class="literal">On check intervals</code>
</li>
<li class="listitem">
Run when: <code class="literal">Query matched</code>
</li>
<li class="listitem">
To: &lt;the recipient email address&gt;
</li>
<li class="listitem">
Subject: &lt;the email subject line&gt;
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save</strong></span>.
</li>
</ol>
</div>
<p>The new rule will be enabled and an email will be sent to the specified recipient when the alert conditions are met.</p>
<p>From the <span class="strong strong"><strong>Rules</strong></span> page you can select the rule you created to enable or disable it, and to view the rule details including a list of active alerts and an alert history.</p>
<div class="imageblock">
<div class="content">
<img src="images/elastic-agent-status-rule.png" alt="A screen capture showing the details for the new Elastic Agent status rule">
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="migrate-elastic-agent.html">« Migrate Fleet-managed Elastic Agents from one cluster to another</a>
</span>
<span class="next">
<a href="agent-health-status.html">Elastic Agent health status »</a>
</span>
</div>
</body>
</html>
