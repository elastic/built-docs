<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Elastic Agent to Logstash for routing to multiple Elasticsearch clusters and additional destinations | Elastic Ingest Reference Architectures [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Elastic Agent to Logstash for routing to multiple Elasticsearch clusters and additional destinations | Elastic Ingest Reference Architectures [8.14]">

<link rel="home" href="index.html" title="Elastic Ingest Reference Architectures [8.14]"/>
<link rel="up" href="agent-ls.html" title="Elastic Agent to Logstash to Elasticsearch"/>
<link rel="prev" href="ls-networkbridge.html" title="Elastic Agent to Logstash to Elasticsearch: Logstash as a proxy"/>
<link rel="next" href="agent-proxy.html" title="Elastic Agent to proxy to Elasticsearch"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Ingest"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Ingest/Reference/8.14"/>
<meta name="DC.subject" content="Ingest"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="ls-networkbridge.html">« Elastic Agent to Logstash to Elasticsearch: Logstash as a proxy</a>
</span>
<span class="next">
<a href="agent-proxy.html">Elastic Agent to proxy to Elasticsearch »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Ingest Reference Architectures [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="agent-ls.html">Elastic Agent to Logstash to Elasticsearch</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Elastic Agent to Logstash for routing to multiple Elasticsearch clusters and additional destinations</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-arch/13-multitenant.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ls-multi"></a>Elastic Agent to Logstash for routing to multiple Elasticsearch clusters and additional destinations<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-arch/13-multitenant.asciidoc">edit</a></h2>
</div></div></div>
<div class="imageblock">
<div class="content">
<img src="images/ea-ls-multi.png" alt="Image showing Elastic Agent collecting and routing data to multiple destinations">
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Ingest model
</span>
</dt>
<dd>
Elastic Agent to Logstash to Elasticsearch clusters and/or additional destinations
</dd>
<dt>
<span class="term">
Use when
</span>
</dt>
<dd>
Data collected by Elastic Agent needs to be routed to different Elasticsearch clusters or non-Elasticsearch destinations depending on the content
</dd>
<dt>
<span class="term">
Example
</span>
</dt>
<dd>
<p>
Let’s take an example of a Windows workstation, for which we are collecting different types of logs using the System and Windows integrations.
These logs need to be sent to different Elasticsearch clusters and to S3 for backup and a mechanism to send it to other destinations such as different SIEM solutions. In addition, the Elasticsearch destination is derived based on the type of datastream and an organization identifier.
</p>
<p>In such use cases, agents send the data to Logstash as a routing mechanism to different destinations.
Note that the System and Windows integrations must be installed on all Elasticsearch clusters to which the data is routed.</p>
</dd>
<dt>
<span class="term">
Sample config
</span>
</dt>
<dd>
<div class="pre_wrapper lang-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby">input {
  elastic_agent {
    port =&gt; 5044
  }
}
filter {
  translate {
    source =&gt; "[http][host]"
    target =&gt; "[@metadata][tenant]"
    dictionary_path =&gt; "/etc/conf.d/logstash/tenants.yml"
  }
}
output {
  if [@metadata][tenant] == "tenant01" {
    elasticsearch {
      cloud_id =&gt; "&lt;cloud id&gt;"
      api_key =&gt; "&lt;api key&gt;"
    }
  } else if [@metadata][tenant] == "tenant02" {
    elasticsearch {
      cloud_id =&gt; "&lt;cloud id&gt;"
      api_key =&gt; "&lt;api key&gt;"
    }
  }
}</pre>
</div>
</dd>
</dl>
</div>
<h4><a id="multi-resources"></a>Resources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/ingest-docs/edit/8.14/docs/en/ingest-arch/13-multitenant.asciidoc">edit</a></h4>
<p>Info on configuring Elastic Agent:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/fleet/8.14" class="ulink" target="_top">Fleet and Elastic Agent Guide</a>
</li>
<li class="listitem">
<a href="/guide/en/fleet/8.14/elastic-agent-output-configuration.html" class="ulink" target="_top">Configuring outputs for Elastic Agent</a>
</li>
</ul>
</div>
<p>Info on Logstash and Logstash outputs:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/logstash/8.14" class="ulink" target="_top">Logstash Reference</a>
</li>
<li class="listitem">
<a href="/guide/en/logstash/8.14/plugins-outputs-elasticsearch.html" class="ulink" target="_top">Logstash Elasticsearch output plugin</a>
</li>
<li class="listitem">
<a href="/guide/en/logstash/8.14/output-plugins.html" class="ulink" target="_top">Logstash output plugins</a>
</li>
</ul>
</div>
<p>Info on Elasticsearch:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.14" class="ulink" target="_top">Elasticsearch Guide</a>
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ls-networkbridge.html">« Elastic Agent to Logstash to Elasticsearch: Logstash as a proxy</a>
</span>
<span class="next">
<a href="agent-proxy.html">Elastic Agent to proxy to Elasticsearch »</a>
</span>
</div>
</body>
</html>
