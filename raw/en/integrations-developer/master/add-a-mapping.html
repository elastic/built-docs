<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Edit field mappings | Integrations Developer Guide | Elastic</title>
<meta class="elastic" name="content" content="Edit field mappings | Integrations Developer Guide">

<link rel="home" href="index.html" title="Integrations Developer Guide"/>
<link rel="up" href="build-a-new-integration.html" title="Build an integration"/>
<link rel="prev" href="edit-ingest-pipeline.html" title="Edit ingest pipelines"/>
<link rel="next" href="create-dashboards.html" title="Create and export dashboards"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Integrations"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Integrations/Developer"/>
<meta name="DC.subject" content="Integrations"/>
<meta name="DC.identifier" content="master"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Integrations Developer Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="build-a-new-integration.html">Build an integration</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="edit-ingest-pipeline.html">« Edit ingest pipelines</a>
</span>
<span class="next">
<a href="create-dashboards.html">Create and export dashboards »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="add-a-mapping"></a>Edit field mappings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/build-integration.asciidoc">edit</a></h2>
</div></div></div>
<p>Ingest pipelines create fields in an Elasticsearch index, but don&#8217;t define the fields themselves.
Instead, each field requires a defined data type or mapping.</p>
<div class="sidebar">
<div class="titlepage"></div>
<p><span class="strong strong"><strong>Mapping</strong></span> is the process of defining how a document, and the fields it contains, are stored and indexed.
Each document is a collection of fields, each having its own data type. When mapping your data, create a mapping definition containing a list of fields pertinent to the document. A mapping definition also includes metadata fields, like the _source field, which customize how the associated metadata of a document is handled.</p>
<p>To learn more, see <a href="/guide/en/elasticsearch/reference/master/mapping.html" class="ulink" target="_top">mapping</a>.</p>
</div>
<p>In the integration, the <code class="literal">fields</code> directory serves as the blueprint used to create component templates for the integration. The content from all files in this directory will be unified when the integration is built, so the mappings need to be unique per data stream dataset.</p>
<p>Like ingest pipelines, mappings only apply to the data stream dataset, for our example the <code class="literal">apache.access</code> dataset.</p>
<p>+
NOTE: The names of these files are conventions, any file name with a <code class="literal">.yml</code> extension will work.</p>
<p>Integrations have had significant enhancements in how ECS fields are defined. Below is a guide on which approach to use, based on the version of Elastic your integration will support.</p>
<p>+
. ECS mappings component template (&gt;=8.13.0)
Integrations <span class="strong strong"><strong>only</strong></span> supporting version 8.13.0 and up, can use the <a href="https://github.com/elastic/elasticsearch/blob/c2a3ec42632b0339387121efdef13f52c6c66848/x-pack/plugin/core/template-resources/src/main/resources/ecs%40mappings.json" class="ulink" target="_top">ecs@mappings</a> component template installed by Fleet.
This makes explicitly declaring ECS fields unnecessary; the <code class="literal">ecs@mappings</code> component template in Elasticsearch will automatically detect and configure them.
However, should ECS fields be explicitly defined, they will overwrite the dynamic mapping provided by the <code class="literal">ecs@mappings</code> component template.
They can also be imported with an <code class="literal">external</code> declaration, as seen in the example below.</p>
<p>+
. Dynamic mappings imports (&lt;8.13.0 &amp; &gt;=8.13.0)
Integrations supporting the Elastic stack below version 8.13.0 can still dynamically import ECS field mappings by defining <code class="literal">import_mappings: true</code> in the ECS section of the <code class="literal">_dev/build/build.yml</code> file in the root of the package directory.
This introduces a <a href="https://github.com/elastic/elastic-package/blob/f439b96a74c27c5adfc3e7810ad584204bfaf85d/internal/builder/_static/ecs_mappings.yaml" class="ulink" target="_top">dynamic mapping</a> with most of the ECS definitions.
Using this method means that, just like the previous approach, ECS fields don&#8217;t need to be defined in your integration, they are dynamically integrated into the package at build time.
Explicitly defined ECS fields can be used and will also overwrite this mechanism.</p>
<p>An example of the aformentioned <code class="literal">build.yml</code> file for this method:</p>
<p>+</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">dependencies:
  ecs:
    reference: git@v8.6.0
    import_mappings: true</pre>
</div>
<p>+
. Explicit ECS mappings
As mentioned in the previous two approaches, ECS mappings can still be set explicitly and will overwrite the dynamic mappings.
This can be done in two ways:
- Using an <code class="literal">external: ecs</code> reference to import the definition of a specific field.
- Literally defining the ECS field.</p>
<p>The <code class="literal">external: ecs</code> definition instructs the <code class="literal">elastic-package</code> command line tool to refer to an external ECS reference to resolve specific fields. By default it looks at the <a href="https://raw.githubusercontent.com/elastic/ecs/v8.6.0/generated/ecs/ecs_nested.yml" class="ulink" target="_top">ECS reference</a> file hosted on Github.
This external reference file is determined by a Git reference found in the <code class="literal">_dev/build/build.yml</code> file, in the root of the package directory.
The <code class="literal">build.yml</code> file set up for external references:</p>
<p>+</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">dependencies:
  ecs:
    reference: git@v8.6.0</pre>
</div>
<p>Literal definition a ECS field:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">- name: cloud.acount.id
  level: extended
  type: keyword
  ignore_above: 1024
  description: 'The cloud account or organ....'
  example: 43434343</pre>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Local ECS reference file (air-gapped setup)
By changing the Git reference in in <code class="literal">_dev/build/build.yml</code> to the path of the downloaded <a href="https://raw.githubusercontent.com/elastic/ecs/v8.6.0/generated/ecs/ecs_nested.yml" class="ulink" target="_top">ECS reference</a> file, it is possible for the <code class="literal">elastic-package</code> command line tool to look for this file locally. Note that the path should be the full path to the reference file.
Doing this, our <code class="literal">build.yml</code> file looks like:</p>
<pre class="screen">dependencies:
  ecs:
    reference: file:///home/user/integrations/packages/apache/ecs_nested.yml</pre>
</li>
</ol>
</div>
<p>The <code class="literal">access</code> data stream dataset of the Apache integration has four different field definitions:</p>
<p>+
NOTE: The <code class="literal">apache</code> integration below has not yet been updated to use the dynamic ECS field definition and uses <code class="literal">external</code> references to define ECS fields in <code class="literal">ecs.yml</code>.</p>
<p>+</p>
<div class="pre_wrapper lang-text">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-text">apache
└───data_stream
│   └───access
│   │   └───elasticsearch/ingest_pipeline
│   │   │      default.yml
│   │   └───fields
│   │          agent.yml
│   │          base-fields.yml
│   │          ecs.yml
│   │          fields.yml
│   └───error
│   │   └───elasticsearch/ingest_pipeline
│   │   │      default.yml
│   │   └───fields
│   │          agent.yml
│   │          base-fields.yml
│   │          ecs.yml
│   │          fields.yml
│   └───status</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_agent_yml"></a>agent.yml<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/build-integration.asciidoc">edit</a></h3>
</div></div></div>
<p>The <code class="literal">agent.yml</code> file defines fields used by default processors.
Examples: <code class="literal">cloud.account.id</code>, <code class="literal">container.id</code>, <code class="literal">input.type</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_base_fields_yml"></a>base-fields.yml<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/build-integration.asciidoc">edit</a></h3>
</div></div></div>
<p>In this file, the <code class="literal">data_stream</code> subfields <code class="literal">type</code>, <code class="literal">dataset</code> and <code class="literal">namespace</code> are defined as type <code class="literal">constant_keyword</code>, the values for these fields are added by the integration.
The <code class="literal">event.module</code> and <code class="literal">event.dataset</code> fields are defined with a fixed value specific for this integration:
- <code class="literal">event.module: apache</code>
- <code class="literal">event.dataset: apache.access</code>
Field <code class="literal">@timestamp</code> is defined here as type <code class="literal">date</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_fields_yml"></a>fields.yml<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/build-integration.asciidoc">edit</a></h3>
</div></div></div>
<p>Here we define fields that we need in our integration and are not found in the ECS.
The example below defines field <code class="literal">apache.access.ssl.protocol</code> in the Apache integration.</p>
<p>+</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">- name: apache.access
  type: group
  fields:
    - name: ssl.protocol
      type: keyword
      description: |
        SSL protocol version.</pre>
</div>
<p>Learn more about fields in the <a href="/guide/en/integrations-developer/current/general-guidelines.html#_document_all_fields" class="ulink" target="_top">general guidelines</a>.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="edit-ingest-pipeline.html">« Edit ingest pipelines</a>
</span>
<span class="next">
<a href="create-dashboards.html">Create and export dashboards »</a>
</span>
</div>
</div>
</body>
</html>
