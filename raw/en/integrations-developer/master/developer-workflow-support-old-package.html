<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Release a bug fix for supporting older package version | Integrations Developer Guide | Elastic</title>
<meta class="elastic" name="content" content="Release a bug fix for supporting older package version | Integrations Developer Guide">

<link rel="home" href="index.html" title="Integrations Developer Guide"/>
<link rel="up" href="developer-workflows.html" title="Developer workflows"/>
<link rel="prev" href="developer-workflow-fleet-UI.html" title="Development process for Fleet UI"/>
<link rel="next" href="developer-workflow-import-beat.html" title="Import integration from Beats modules"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Integrations"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Integrations/Developer"/>
<meta name="DC.subject" content="Integrations"/>
<meta name="DC.identifier" content="master"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="developer-workflow-fleet-UI.html">« Development process for Fleet UI</a>
</span>
<span class="next">
<a href="developer-workflow-import-beat.html">Import integration from Beats modules »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Integrations Developer Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="developer-workflows.html">Developer workflows</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Release a bug fix for supporting older package version</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/developer-workflow-old-bugfix.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="developer-workflow-support-old-package"></a>Release a bug fix for supporting older package version</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/developer-workflow-old-bugfix.asciidoc">edit</a></div>
</div></div></div>
<p>In some cases, when we drop the support for an older version of the stack and later on find
out needing to add a bug fix to the some old package version, we have to make some manual changes
to release the bug fix to users. For example: in this <a href="https://github.com/elastic/integrations/pull/3688" class="ulink" target="_top">PR</a>
(AWS package version 1.23.4), support for Kibana version 7.x was dropped
and bumped the AWS package version from 1.19.5 to 1.20.0. But we found
a bug in the EC2 dashboard that needs to be fixed with Kibana version 7.x. So instead of
adding a new AWS package version 1.23.5, we need to fix it between 1.19.5 and 1.20.0.</p>
<p>Follow these detailed steps to release a fix for a given package version:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Find git commit (package version) that needs to be fixed</strong></span></p>
<p>In the example above, the commit to be fixed is the one right before this
<a href="https://github.com/elastic/integrations/pull/3688" class="ulink" target="_top">PR</a> updating package <code class="literal">aws</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Using the web:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Look for the merge commit of the PR</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/integrations/commit/aa63e1f6a61d2a017e1f88af2735db129cc68e0c" class="ulink" target="_top">https://github.com/elastic/integrations/commit/aa63e1f6a61d2a017e1f88af2735db129cc68e0c</a>
</li>
<li class="listitem">
It can be found as one of the last messages in the PR
<span class="image"><img src="./images/merge_commit_message.png" alt="merged commit"></span>
</li>
<li class="listitem">
And then show the previous commits for that changeset inside the package folder (e.g. <code class="literal">packages/aws</code>):
</li>
<li class="listitem">
<a href="https://github.com/elastic/integrations/commits/aa63e1f6a61d2a017e1f88af2735db129cc68e0c/packages/aws/" class="ulink" target="_top">https://github.com/elastic/integrations/commits/aa63e1f6a61d2a017e1f88af2735db129cc68e0c/packages/aws/</a>
<span class="image"><img src="./images/browse_package_commits.png" alt="commits from package"></span>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Using the command line:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">cd packages/&lt;package_name&gt;
git log --grep "#&lt;pr_id&gt;" .
git log -n 1 &lt;merge_commit&gt;^ .

# following the example
$ cd packages/aws
$ git log --grep "#3688"
commit aa63e1f6a61d2a017e1f88af2735db129cc68e0c
Author: Joe Reuter &lt;xx@email.de&gt;
Date:   Mon Aug 8 17:14:55 2022 +0200

    Inline all aws dashboards (#3688)

    * inline all aws dashboards

    * format

    * apply the right format

    * inline again

    * format
$ git log -n 1 aa63e1f6a61d2a017e1f88af2735db129cc68e0c^ .
commit 8cb321075afb9b77ea965e1373a03a603d9c9796
Author: Mario Castro &lt;xx@gmail.com&gt;
Date:   Thu Aug 4 16:52:06 2022 +0200

    Move lightweight manifest to integration for EBS data stream (#3856)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Run the <span class="strong strong"><strong>integrations-backport</strong></span> pipeline <a href="https://buildkite.com/elastic/integrations-backport" class="ulink" target="_top">https://buildkite.com/elastic/integrations-backport</a> for creating the backport branch.</p>
<p><span class="strong strong"><strong>Please, pay attention!</strong></span>, if you just run the pipeline it&#8217;ll wait for your inputs, nothing will happen without that.</p>
<div class="imageblock">
<div class="content">
<img src="./images/backport_input_step.png" alt="waiting input step">
</div>
</div>
<p>Pipeline&#8217;s inputs:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>DRY_RUN</strong></span> (default: "true"),
If DRY_RUN is defined as "true" it will check:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
if the package is published,
</li>
<li class="listitem">
if the entered commit exists,
</li>
<li class="listitem">
if the backport branch exists.
Also, it will create the local branch, update the branch with <code class="literal">.buildkite</code> and <code class="literal">.ci</code> folders, and remove other packages except the defined one (if set as input). This local branch will not be pushed to the upstream repository in this mode.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>If DRY_RUN is defined as "false", in addition to written above it will create a commit and push the local branch to the upstream repository <a href="https://github.com/elastic/integrations.git" class="ulink" target="_top">https://github.com/elastic/integrations.git</a>. In this case, the name of the branch will be <code class="literal">+backport-${PACKAGE_NAME}-${TRIMMED_PACKAGE_VERSION}+</code>, for example, <code class="literal">backport-aws-1.19</code>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>BASE_COMMIT</strong></span> (default: "") - enter the commit from the previous step (8cb321075afb9b77ea965e1373a03a603d9c9796)
</li>
<li class="listitem">
<span class="strong strong"><strong>PACKAGE_NAME</strong></span> (default: "") - enter the package name, for example aws
</li>
<li class="listitem">
<span class="strong strong"><strong>PACKAGE_VERSION</strong></span> (default: "") - enter the package version, for example: 1.19.7, 1.0.0-beta1
</li>
<li class="listitem">
<span class="strong strong"><strong>REMOVE_OTHER_PACKAGES</strong></span> (default: "false")
If <span class="strong strong"><strong>REMOVE_OTHER_PACKAGES</strong></span> is defined as "true" all packages from the <span class="strong strong"><strong>packages</strong></span> folder, except the defined package, will be removed from the created branch.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Create a PR for the bug fix</strong></span></p>
<p>Create a new branch in your own remote (it is advised <span class="strong strong"><strong>not using</strong></span> a branch name starting with <code class="literal">backport-</code>), and apply bugfixes there.
Remember to update the version in the package manifest (update patch version like <code class="literal">1.19.&lt;x+1&gt;</code>) and add a new changelog entry for this patch version.</p>
<p>Once ready, open a PR selecting as a base branch the one created above: <code class="literal">backport-&lt;package_name&gt;-&lt;package_major_version&gt;.&lt;package_minor_version&gt;</code> (e.g. <code class="literal">backport-aws-1.19</code>).</p>
<p>Once this PR is merged, this new version of the package is going to be published automatically following the usual CI/CD jobs.</p>
<p>If it is needed to release a new fix for that version, there is no need to create a new branch. Just create a new PR to merge a
new branch onto the same backport branch created previously.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Update changelog in main</strong></span></p>
<p>Once PR has been merged in the corresponding backport branch (e.g. <code class="literal">backport-aws-1.9</code>) and the package has been published,
a new Pull Request should be created manually to update the changelog in the main branch to include the new version published in the backport branch.
Take into account to add the changelog entry following the version order.</p>
<p>In order to keep track, this new PR should have a reference (relates) to the backport PR too in its description.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Known issues and their solutions:</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Missing shellinit command:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Example of the error: <a href="https://buildkite.com/elastic/integrations/builds/7634#018c87f4-7b0c-4d6f-8ddd-b779a9a7a019/507-512" class="ulink" target="_top">https://buildkite.com/elastic/integrations/builds/7634#018c87f4-7b0c-4d6f-8ddd-b779a9a7a019/507-512</a></p>
<p><code class="literal">Error: could not create kibana client: undefined environment variable: ELASTIC_PACKAGE_KIBANA_HOST. If you have started the Elastic stack using the elastic-package tool, please load stack environment variables using 'eval "$(elastic-package stack shellinit)"' or set their values manually</code></p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Solution</strong></span>: add elastic-package stack shellinit command in <code class="literal">.buildkite/scripts/common.sh</code>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">eval "$(elastic-package stack shellinit)"</code></p>
<p>Example: <a href="https://github.com/elastic/integrations/blob/0226f93e0b1493d963a297e2072f79431f6cc443/.buildkite/scripts/common.sh#L828" class="ulink" target="_top">https://github.com/elastic/integrations/blob/0226f93e0b1493d963a297e2072f79431f6cc443/.buildkite/scripts/common.sh#L828</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Not found license file:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Example of the error: <a href="https://buildkite.com/elastic/integrations/builds/7644#018c883c-546f-4d32-ab4a-71e919ddebf8/270-309" class="ulink" target="_top">https://buildkite.com/elastic/integrations/builds/7644#018c883c-546f-4d32-ab4a-71e919ddebf8/270-309</a></p>
<p><code class="literal">Error: checking package failed: building package failed: copying license text file: failure while looking for license "licenses/Elastic-2.0.txt" in repository: failed to find repository license: stat /opt/buildkite-agent/builds/bk-agent-prod-gcp-1703092724145948143/elastic/integrations/licenses/Elastic-2.0.txt: no such file or directory</code></p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Solution</strong></span>: Remove line defining <code class="literal">ELASTIC_PACKAGE_REPOSITORY_LICENSE</code> environment variable.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Example: <a href="https://github.com/elastic/integrations/blob/0daff27f0e0195a483771a50d60ab28ca2830f75/.buildkite/pipeline.yml#L17" class="ulink" target="_top">https://github.com/elastic/integrations/blob/0daff27f0e0195a483771a50d60ab28ca2830f75/.buildkite/pipeline.yml#L17</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="developer-workflow-fleet-UI.html">« Development process for Fleet UI</a>
</span>
<span class="next">
<a href="developer-workflow-import-beat.html">Import integration from Beats modules »</a>
</span>
</div>
</body>
</html>
