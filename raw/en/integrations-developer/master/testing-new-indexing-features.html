<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>How to test new indexing features | Integrations Developer Guide | Elastic</title>
<meta class="elastic" name="content" content="How to test new indexing features | Integrations Developer Guide">

<link rel="home" href="index.html" title="Integrations Developer Guide"/>
<link rel="up" href="integrations-tsds-synthetic-source.html" title="Working with new indexing features"/>
<link rel="prev" href="developer-tsds-guidelines.html" title="TSDS guidelines"/>
<link rel="next" href="elastic-package.html" title="elastic-package reference"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Integrations"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Integrations/Developer"/>
<meta name="DC.subject" content="Integrations"/>
<meta name="DC.identifier" content="master"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Integrations Developer Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="integrations-tsds-synthetic-source.html">Working with new indexing features</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="developer-tsds-guidelines.html">« TSDS guidelines</a>
</span>
<span class="next">
<a href="elastic-package.html"><code class="literal">elastic-package</code> reference »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="testing-new-indexing-features"></a>How to test new indexing features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/integrations-tsds-synthetic-source.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch has been adding new indexing modes and features that allow optimization of storage size and query performance.</p>
<p>We&#8217;d like to enable integration developers to start testing the ingest and query performance of enabling these features before we start making any changes in the integrations themselves or allowing end users to enable these from the Fleet UI.</p>
<p>Today, each of these can already be enabled by leveraging the <code class="literal">*@custom</code> component templates that Fleet installs for each integration data stream, to varying degrees of ease of use (details below). We could improve the UX around this for integration developers by adding an explicit API in Fleet to enable this, however it may not be necessary. See <a href="https://github.com/elastic/kibana/issues/132818" class="ulink" target="_top">elastic/kibana#132818</a> for discussion around how a feature flag API could be added to ease this a bit more.</p>
<p>See the following instructions for testing new indexing features:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="testing-new-indexing-features.html#integrations-dev-synthetic-source" title="Testing synthetic source">Testing synthetic source</a>
</li>
<li class="listitem">
<a class="xref" href="testing-new-indexing-features.html#integrations-dev-doc-value-only-fields" title="Testing doc-value-only fields">Testing <code class="literal">doc-value-only</code> fields</a>
</li>
<li class="listitem">
<a class="xref" href="testing-new-indexing-features.html#integrations-dev-test-tsds" title="Time-series indexing (TSDS)">Time-series indexing (TSDS)</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="integrations-dev-synthetic-source"></a>Testing synthetic source<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/integrations-tsds-synthetic-source.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For background, refer to <a href="elastic/elasticsearch#85649" class="ulink" target="_top">#85649</a>
</li>
<li class="listitem">
For integrations support, refer to <a href="elastic/package-spec#340" class="ulink" target="_top">#340</a>
</li>
</ul>
</div>
<p>This feature is quite easy to enable on an integration using the component template. Here&#8217;s how to do this for the <code class="literal">nginx</code> substatus metrics, for example:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Install the nginx package.
</li>
<li class="listitem">
<p>Run this dev tools command:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /_component_template/metrics-nginx.substatus@custom
{
  "template": {
    "settings": {},
    "mappings": {
      "_source": {
        "mode": "synthetic"
      }
    }
  },
  "_meta": {
    "package": {
      "name": "nginx"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/25.console"></div>
</li>
<li class="listitem">
If a data stream already exists, rollover the data stream to get the new mappings: <code class="literal">POST metrics-nginx.substatus-default/_rollover</code>
</li>
</ol>
</div>
<p>One challenge with leveraging synthetic source is that it doesn&#8217;t support keyword fields that have <code class="literal">ignore_above</code> configured. It may be worth removing this setting for testing on those fields. This can be done by editing the package in <code class="literal">dev</code> and installing it via <code class="literal">elastic-package</code> or overriding it via the custom component template, similar to the <a class="xref" href="testing-new-indexing-features.html#integrations-dev-doc-value-only-fields" title="Testing doc-value-only fields"><code class="literal">doc-value-only</code></a> example.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="integrations-dev-doc-value-only-fields"></a>Testing <code class="literal">doc-value-only</code> fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/integrations-tsds-synthetic-source.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For background, refer to <a href="/blog/whats-new-elasticsearch-kibana-cloud-8-1-0" class="ulink" target="_top">Elasticsearch, Kibana, Elastic Cloud 8.1: Faster indexing, less disk storage, and smarter analytics capabilities</a>.
</li>
<li class="listitem">
For integrations support, refer to <a href="https://github.com/elastic/integrations/issues/3419" class="ulink" target="_top">#3419</a>.
</li>
</ul>
</div>
<p>This feature is  more challenging with component templates because it requires adding <code class="literal">index: false</code> to every long and double field. Providing an API in Fleet would make this a bit easier. Here&#8217;s how to do this manually:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Install the <code class="literal">nginx</code> package.
</li>
<li class="listitem">
Get the mappings included with the package: <code class="literal">GET /_component_template/logs-nginx.access@package</code>.
</li>
<li class="listitem">
Copy the output into your favorite text editor, search for each <code class="literal">"type": "long"</code> and <code class="literal">"type": "double"</code>, and add <code class="literal">"index": false</code>.
</li>
<li class="listitem">
<p>Update the custom component template with the new mappings. For example, here&#8217;s how to set the long fields to <code class="literal">index: false</code>:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /_component_template/merics-nginx.substatus@custom
{
  "template": {
    "settings": {},
    "mappings": {
      "properties": {
        "nginx": {
          "properties": {
            "stubstatus": {
              "properties": {
                "hostname": {
                  "ignore_above": 1024,
                  "type": "keyword"
                },
                "current": {
                  "type": "long",
                  "index": false
                },
                "waiting": {
                  "type": "long",
                  "index": false
                },
                "accepts": {
                  "type": "long",
                  "index": false
                },
                "handled": {
                  "type": "long",
                  "index": false
                },
                "writing": {
                  "type": "long",
                  "index": false
                },
                "dropped": {
                  "type": "long",
                  "index": false
                },
                "active": {
                  "type": "long",
                  "index": false
                },
                "reading": {
                  "type": "long",
                  "index": false
                },
                "requests": {
                  "type": "long",
                  "index": false
                }
              }
            }
          }
        }
      }
    }
  },
  "_meta": {
    "package": {
      "name": "nginx"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/26.console"></div>
</li>
<li class="listitem">
If a data stream already exists, rollover the data stream to get the new mappings: <code class="literal">POST metrics-nginx.substatus-default/_rollover</code>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="integrations-dev-test-tsds"></a>Time-series indexing (TSDS)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/integrations/integrations-tsds-synthetic-source.asciidoc">edit</a></h3>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For background, refer to <a href="https://github.com/elastic/elasticsearch/issues/74660" class="ulink" target="_top">#74660</a>
</li>
<li class="listitem">
For integrations support, refer to <a href="https://github.com/elastic/package-spec/issues/311" class="ulink" target="_top">#311</a>
</li>
</ul>
</div>
<p>Usage of TSDS indexing requires the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Mapping parameters must be added for <code class="literal">time_series_dimension</code> and <code class="literal">time_series_metric</code> on appropriate fields. This is already supported by the package ecosystem and Fleet, so packages can already define these options.
</li>
<li class="listitem">
The <code class="literal">mode: time_series</code> and <code class="literal">routing_path</code> index settings must be added, this can be done by editing the custom component template.
</li>
</ul>
</div>
<p>Note that the <code class="literal">routing_path</code> setting should correspond to fields with <code class="literal">time_series_dimension</code> specified. In the future, ES may automate this setting.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Install the kubernetes package (already has TSDS mappings set up)
</li>
<li class="listitem">
<p>Run this dev tools command:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">PUT /_component_template/metrics-kubernetes.pod@custom
{
  "template": {
    "settings": {
      "index.mode": "time_series",
      "index.routing_path": ["kubernetes.pod.uid"]
    },
    "mappings": {}
  },
  "_meta": {
    "package": {
      "name": "kubernetes"
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/27.console"></div>
</li>
<li class="listitem">
If a data stream already existed, rollover the data stream to get the new mappings: <code class="literal">POST metrics-kubernetes.pod-default/_rollover</code>
</li>
</ol>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="developer-tsds-guidelines.html">« TSDS guidelines</a>
</span>
<span class="next">
<a href="elastic-package.html"><code class="literal">elastic-package</code> reference »</a>
</span>
</div>
</div>
</body>
</html>
