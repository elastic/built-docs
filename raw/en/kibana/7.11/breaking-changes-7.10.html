<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Breaking changes in 7.10 | Kibana Guide [7.11] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [7.11]"/>
<link rel="up" href="breaking-changes.html" title="Breaking Changes"/>
<link rel="prev" href="breaking-changes.html" title="Breaking Changes"/>
<link rel="next" href="breaking-changes-7.9.html" title="Breaking changes in 7.9"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/7.11"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="7.11"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [7.11]</a></span>
»
<span class="breadcrumb-link"><a href="breaking-changes.html">Breaking Changes</a></span>
»
<span class="breadcrumb-node">Breaking changes in 7.10</span>
</div>
<div class="navheader">
<span class="prev">
<a href="breaking-changes.html">« Breaking Changes</a>
</span>
<span class="next">
<a href="breaking-changes-7.9.html">Breaking changes in 7.9 »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="breaking-changes-7.10"></a>Breaking changes in 7.10<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.11/docs/migration/migrate_7_10.asciidoc">edit</a></h2>
</div></div></div>

<p>This page discusses the breaking changes that you need to be aware of when migrating
your application to Kibana 7.10.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="breaking-changes-7.10.html#user-facing-changes-7-10" title="Breaking changes for users">Breaking changes for users</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-7.10.html#general-plugin-API-changes-7-10" title="Breaking changes for plugin developers">Breaking changes for plugin developers</a>
</li>
</ul>
</div>
<h3><a id="user-facing-changes-7-10"></a>Breaking changes for users<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.11/docs/migration/migrate_7_10.asciidoc">edit</a></h3>
<h4><a id="breaking_kibana_legacy_plugins"></a>Legacy plugins support removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.11/docs/migration/migrate_7_10.asciidoc">edit</a></h4>
<p>The legacy plugin system and the legacy plugin API have been removed.
Legacy plugin owners should migrate their plugins to the Kibana Platform plugin API.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/77599" class="ulink" target="_top">#77599</a></strong></span></p>
<h4><a id="breaking_kibana_plugins"></a>Support added for Kibana Platform plugins<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.11/docs/migration/migrate_7_10.asciidoc">edit</a></h4>
<p>The <code class="literal">bin/kibana-plugin</code> CLI has been updated to work with the new Kibana
Platform plugin format instead of the legacy plugin format.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/74604" class="ulink" target="_top">#74604</a></strong></span></p>
<h4><a id="breaking_vega_visualizations"></a>Vega visualizations without $schema property no longer supported<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.11/docs/migration/migrate_7_10.asciidoc">edit</a></h4>
<p>Previously, if you did not provide the $schema property,
the default value was set and hardcoded in the Vega code.
The visualization was then rendered with a warning message.
This introduced difficulties when updating the version of the Vega library.</p>
<p>Now all Vega specs must contain the $schema param. In no $schema
param exists, an error message is returned.
Refer to the <a href="https://vega.github.io/vega/docs/specification/" class="ulink" target="_top">Vega docs</a> for
more information about this property.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/73805" class="ulink" target="_top">#73805</a></strong></span></p>
<h3><a id="general-plugin-API-changes-7-10"></a>Breaking changes for plugin developers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.11/docs/migration/migrate_7_10.asciidoc">edit</a></h3>
<details id="breaking_plugin_v7.10.0_79406">
<summary class="title">Config moved from <code class="literal">xpack.ingestManager</code> to <code class="literal">xpack.fleet</code></summary>
<div class="content">
<p>To rename the Ingest Manger plugin to Fleet:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The Kibana config for Ingest Manager moved from <code class="literal">xpack.ingestManager.*</code> to <code class="literal">xpack.fleet.*</code>.
</li>
<li class="listitem">
The config options specific to agents moved to <code class="literal">xpack.ingestManager.fleet.*</code> and <code class="literal">xpack.fleet.agents.*</code>.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/79406" class="ulink" target="_top">#79406</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_79379">
<summary class="title">Plugins server code no longer transpiled with Babel</summary>
<div class="content">
<p>Kibana plugins can no longer rely on their server code being automatically transpiled with Babel.
The <a href="https://github.com/elastic/kibana/tree/master/packages/kbn-plugin-helpers" class="ulink" target="_top"><code class="literal">@kbn/plugin-helpers</code></a>
provide a build task that will transform a plugin&#8217;s server code to plain JS via Babel,
but plugin authors can use a tool of their choosing to accomplish the same result.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/79176" class="ulink" target="_top">#79176</a></strong></span> and <a href="https://github.com/elastic/kibana/pull/79379" class="ulink" target="_top">#79379</a>*</p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_79193">
<summary class="title">Ingest Manager APIs moved to Fleet</summary>
<div class="content">
<p>The following Ingest Manager API routes changed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
All API routes moved from <code class="literal">/api/ingest_manager/*</code>  to <code class="literal">/api/fleet/*</code>
</li>
<li class="listitem">
<p>All previous Fleet routes moved from <code class="literal">/api/ingest_manager/fleet/*</code>  to <code class="literal">/api/fleet/*</code>. This includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/api/ingest_manager/fleet/agents</code> &#8658; <code class="literal">/api/fleet/agents</code>
</li>
<li class="listitem">
<code class="literal">/api/ingest_manager/fleet/enrollment-api-keys</code> &#8658; <code class="literal">/api/fleet/enrollment-api-keys</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
The Fleet setup API moved from <code class="literal">/api/ingest_manager/fleet/setup</code> to <code class="literal">/api/fleet/agents/setup</code>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/79193" class="ulink" target="_top">#79193</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_78383">
<summary class="title"><code class="literal">SearchSource</code> is now exposed on the server</summary>
<div class="content">
<p>The high-level search API <code class="literal">SearchSource</code> is now available on the server:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">function async myRouteHandler(context, request, response) {
  const searchSource = await data.search.searchSource.asScoped(request);
  searchSource.createEmpty(); // API after calling `asScoped` matches the client-side service
}</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/78383" class="ulink" target="_top">#78383</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_78006">
<summary class="title">Response status helpers added</summary>
<div class="content">
<p>This release introduces the following <code class="literal">search</code> helpers:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">isCompleteResponse</code>
</li>
<li class="listitem">
<code class="literal">isErrorResponse</code>
</li>
<li class="listitem">
<code class="literal">isPartialResponse</code>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/78006" class="ulink" target="_top">#78006</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_77791">
<summary class="title">The index pattern <code class="literal">factory</code> and <code class="literal">crud</code> methods refactored</summary>
<div class="content">
<p>The refactoring includes the following changes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Create new indexPattern instance (unsaved) -
<code class="literal">indexPatternService.make() =&gt;  indexPatternService.create(indexPatternSpec, skipFetchFields)</code>
</li>
<li class="listitem">
Save new index pattern -
<code class="literal">indexPattern.create() =&gt; indexPatternService.createSavedObject(indexPattern)</code>
</li>
<li class="listitem">
Setting the default index pattern is done as part of <code class="literal">indexPatternService.createSavedObject</code>,
 but can also be called individually-
<code class="literal">uiSettings.set('defaultIndex', id) =&gt; indexPatternService.setDefault(indexPatternId, force)</code>
</li>
<li class="listitem">
Update index pattern -
<code class="literal">indexPattern.save() =&gt; indexPatternService.updateSavedObject(indexPattern)</code>
</li>
<li class="listitem">
<p>Additional changes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">indexPatternService.get();</code> no longer returns a new IndexPattern instance
</li>
<li class="listitem">
<code class="literal">indexPattern.fieldsFetcher</code> is replaced by <code class="literal">indexPatternService.getFieldsForWildcard</code> and <code class="literal">indexPatternService.getFieldsForIndexPattern</code>
</li>
<li class="listitem">
<code class="literal">indexPattern.originalBody</code> &#8658; <code class="literal">indexPattern.originalSavedObjectBody</code> updates via <code class="literal">indexPattern.resetOriginalSavedObjectBody</code>
</li>
<li class="listitem">
<code class="literal">indexPattern.refreshFields =&gt; indexPatternService.refreshFields(indexPattern)</code>
</li>
<li class="listitem">
<code class="literal">indexPatternService.createAndSave(indexPatternSpec)</code> convenience method added
</li>
<li class="listitem">
<code class="literal">indexPatternService.getFieldsForWildcard</code> can be called directly. Previously a temp index pattern had to be created.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/77791" class="ulink" target="_top">#77791</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_77788">
<summary class="title">Error notifications now aligned</summary>
<div class="content">
<p>The <code class="literal">data.search</code> service now includes these explicit error types:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">AbortError</code> if the request was canceled by the application or by calling <code class="literal">cancelPending</code>.
</li>
<li class="listitem">
<code class="literal">SearchTimeoutError</code> if the request has timed out on the client <span class="strong strong"><strong>or</strong></span> on the server.
</li>
<li class="listitem">
<code class="literal">PainlessError</code> if there&#8217;s an painless script error inside the response
</li>
<li class="listitem">
If the error is unidentified, it throws the error as is.
</li>
</ul>
</div>
<p>The new <code class="literal">showError</code> function can be used with these errors to show customized toast messages.
Applications may choose to handle errors differently. However, the <code class="literal">SearchTimeoutError</code>
error notification is shown regardless.</p>
<div class="pre_wrapper lang-.ts">
<pre class="programlisting prettyprint lang-.ts">data.search.search(...)
   .catchError((e: Error) =&gt; {
       data.search.showError(e);
   }</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/77788" class="ulink" target="_top">#77788</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_76848">
<summary class="title"><code class="literal">className</code> prop added to QueryStringInput component</summary>
<div class="content">
<p>A <code class="literal">className</code> prop was added to the main container of the QueryStringInput component.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/76848" class="ulink" target="_top">#76848</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_76822">
<summary class="title">KibanaRequest now has a <code class="literal">uuid</code> property</summary>
<div class="content">
<p><code class="literal">KibanaRequest</code> now has a <code class="literal">uuid</code> property, which is a UUID that uniquely identifies the request.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/76822" class="ulink" target="_top">#76822</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_76706">
<summary class="title">Index pattern save moved to index pattern service</summary>
<div class="content">
<p><code class="literal">IndexPattern.save</code> has been replaced with <code class="literal">IndexPatternsService.save</code>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/76706" class="ulink" target="_top">#76706</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_76538">
<summary class="title"><code class="literal">FetchOptions</code> replaced with <code class="literal">ISearchOptions</code></summary>
<div class="content">
<p>The <code class="literal">FetchOptions</code> type was removed&mdash;use the <code class="literal">ISearchOptions</code> type instead.
The <code class="literal">ISearchOptions</code> <code class="literal">signal</code> option was renamed to <code class="literal">abortSignal</code>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/76538" class="ulink" target="_top">#76538</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_75943">
<summary class="title">Legacy Elasticsearch client APIs removed</summary>
<div class="content">
<p>The <code class="literal">__LEGACY</code> APIs have been removed from the <code class="literal">data</code> plugin&#8217;s client-side search service.
Specifically, <code class="literal">data.search.__LEGACY.esClient</code> is no longer exposed,
 and the legacy <code class="literal">elasticsearch-browser</code> package has been removed from the repo.
 If you rely on this client in your plugin, we recommend migrating to
 the new <a href="https://github.com/elastic/elasticsearch-js" class="ulink" target="_top"><code class="literal">elasticsearch-js</code> client</a>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/75943" class="ulink" target="_top">#75943</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_75819">
<summary class="title">Plugin status API added</summary>
<div class="content">
<p>Kibana Platform plugins can now read the status of their dependencies,
their plugin&#8217;s default status, and manually override that status as
reported to the end user and on the <code class="literal">/api/status</code> endpoint.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">class MyPlugin {
  setup(core) {
    // Override default behavior and only elevate severity when elasticsearch is not available
    core.status.set(
      core.status.core$.pipe(core =&gt; core.elasticsearch);
    );
  }
}</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/75819" class="ulink" target="_top">#75819</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_75728">
<summary class="title">New advanced setting <code class="literal">searchTimeout</code> added</summary>
<div class="content">
<p>The behavior of how search requests timeout changed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The Kibana server uses the new Elasticsearch client. The client already uses all timeout configurations
such as <code class="literal">requestTimeout</code>, <code class="literal">shardTimeout</code>, and <code class="literal">maxRetries</code>.
Because the client can&#8217;t override those settings, in OSS,
we removed the code governing the Elasticsearch timeout on the client. Instead, this change adds handling for a timeout error response.
 A nice side effect is being able to remove <code class="literal">injectDefaultVars</code> from the legacy core plugin.
</li>
<li class="listitem">
With Basic+ licenses, users can control the maximum time for a search session
(for example, a single re-load of a dashboard), per space. Aa new Advanced Setting
can be set to a positive value, or to 0, allowing queries to run without a timeout, as long as a user stays on screen.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/75728" class="ulink" target="_top">#75728</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_75717">
<summary class="title"><code class="literal">IndexPattern</code> class no longer uses <code class="literal">getConfig</code> or <code class="literal">uiSettingsValues</code></summary>
<div class="content">
<p>The <code class="literal">IndexPattern</code> class now takes <code class="literal">shortDotsEnable</code> (boolean) and <code class="literal">metaFields</code> (string[]) as arguments.
These were formerly provided by <code class="literal">uiSettings</code></p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/75717" class="ulink" target="_top">#75717</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_75517">
<summary class="title">The <code class="literal">expressions</code> plugin has removed its <code class="literal">__LEGACY</code> APIs</summary>
<div class="content">
<p>The <code class="literal">expressions</code> plugin has removed its <code class="literal">__LEGACY</code> APIs,
which were designed for internal use in Canvas.
In the unlikely event that you rely on the <code class="literal">expressions.__LEGACY</code> namespace,
you will need to copy the relevant code into your plugin before updating.</p>
<p>Also removed is the <code class="literal">createKibanaUtilsCore</code> helper from the <code class="literal">kibana_utils</code> plugin,
which was only used in the legacy Expressions APIs.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/75517" class="ulink" target="_top">#75517</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_75368">
<summary class="title">The search service&#8217;s <code class="literal">getParamsFromSearchRequest</code> helper changed</summary>
<div class="content">
<p>The <code class="literal">getParamsFromSearchRequest</code> helper changed to
prepare for exposing <code class="literal">SearchSource</code> on the server. If your plugin relies on this
helper, update the dependencies passed to it as follows:</p>
<div class="pre_wrapper lang-diff">
<pre class="programlisting prettyprint lang-diff">       import { getSearchParamsFromRequest } from '../../../src/plugins/data/public';

       const params = getSearchParamsFromRequest(request, {
-          injectedMetadata: core.injectedMetadata,
-          uiSettings: core.uiSettings,
+          esShardTimeout: core.injectedMetadata.getInjectedVar('esShardTimeout') as number,
+          getConfig: core.uiSettings.get.bind(core.uiSettings),
       });</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/75368" class="ulink" target="_top">#75368</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_75185">
<summary class="title">Dependencies removed from index pattern list and field list</summary>
<div class="content">
<p>The index pattern <code class="literal">fields</code> class has the following changes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The class is no longer created using a constructor. This produced odd side effects
when array methods were used. In particular, removing the <code class="literal">IndexPattern</code> argument revealed that the
<code class="literal">FieldList</code> constructor was being called when <code class="literal">filter</code> and similar were called, producing an error.
Now, it&#8217;s only created once by <code class="literal">IndexPattern</code>.
</li>
<li class="listitem">
The <code class="literal">IndexPattern</code> object and <code class="literal">onNotification</code> are no longer provided to the creation function.
</li>
</ul>
</div>
<p>The index pattern <code class="literal">field</code> class has the following changes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <code class="literal">IndexPattern</code> object and <code class="literal">onNotification</code> are no longer provided to the constructor.
</li>
<li class="listitem">
The <code class="literal">format</code> attribute no longer exists. Use <code class="literal">IndexPattern.getFormatterForField</code> instead.
</li>
<li class="listitem">
A callback is no longer used when an unknown field type is encountered.
Instead it throws <code class="literal">FieldTypeUnknownError</code>.
</li>
<li class="listitem">
<code class="literal">toSpec</code> now takes an optional argument, <code class="literal">{ getFormatterForField }</code>. This argument takes
the field as an argument and returns a formatter.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/75185" class="ulink" target="_top">#75185</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_74914">
<summary class="title">Agent and package configs renamed to agent and package policies</summary>
<div class="content">
<p>The following Fleet (previously Ingest Manager) API routes changed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/api/ingest_manager/agent_configs/*</code> renamed to <code class="literal">/api/fleet/agent_policies/*</code>
</li>
<li class="listitem">
<code class="literal">/api/ingest_manager/package_configs/*</code> renamed to <code class="literal">/api/fleet/package_policies/*</code>
</li>
</ul>
</div>
<p>All Ingest Manager routes with payload fields that were previously in
reference to agent configs or package configs have been renamed to agent policies
and package policies. For example <code class="literal">configId</code> &#8594; <code class="literal">policyId</code>, <code class="literal">package_configs</code> &#8594; <code class="literal">package_policies</code>.</p>
<p>The following Ingest Manager app routes changed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/app/ingestManager#/configs</code> renamed to <code class="literal">/app/ingestManager#/policies</code>
</li>
</ul>
</div>
<p>The following Ingest Manager settings changed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">xpack.ingestManager.fleet.agentConfigRolloutRateLimitIntervalMs</code> renamed to <code class="literal">xpack.fleet.agents.agentPolicyRolloutRateLimitIntervalMs</code>
</li>
<li class="listitem">
<code class="literal">xpack.fleet.agents.agentConfigRolloutRateLimitRequestPerInterval</code> renamed to <code class="literal">xpack.fleet.agents.agentPolicyRolloutRateLimitRequestPerInterval</code>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/74914" class="ulink" target="_top">#74914</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_74607">
<summary class="title">SearchSource dependencies moved to the server</summary>
<div class="content">
<p>The <code class="literal">getSearchErrorType</code> and the <code class="literal">SearchError</code> class have been
removed from the static exports of the <code class="literal">data</code> plugin&#8217;s contract.
If you rely on these, copy the code directly into your plugin.
The <code class="literal">SearchError</code> interface is still exposed.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/74607" class="ulink" target="_top">#74607</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_74472">
<summary class="title"><code class="literal">data.search.aggs</code> available on the server</summary>
<div class="content">
<p>The <code class="literal">search.aggs</code> service in the <code class="literal">data</code> plugin is now available on the server.
The usage is the same as on the client, except that a scoped saved objects client
must be provided on the server to retrieve the <code class="literal">start</code> contract:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">const savedObjectsClient = savedObjects.getScopedClient(kibanaRequest);
// `aggs.asScopedToClient` will return the same contract as is available in the browser
const aggs = await data.search.aggs.asScopedToClient(savedObjectsClient);
const allAggTypes = aggs.types.getAll();</pre>
</div>
<p>The <code class="literal">calculateAutoTimeExpression</code> method was removed from the <code class="literal">setup</code> contract,
and now only exists on the <code class="literal">data</code> plugin&#8217;s <code class="literal">start</code> contract. The method was
was not used in <code class="literal">setup</code> elsewhere in Kibana, so it was removed for simplicity.</p>
<p>In addition, the agg types registry changed and now accepts a provider
function, which is used to inject dependencies. This might be needed in the agg type definition,
specifically a <code class="literal">getConfig</code> function used to retrieve uiSettings:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">const getMyAgg = ({ getConfig }) =&gt;
  new MetricAggType({
    name: 'myAgg',
    expressionName: 'myAggFunction',
    getSerializedFormat: (agg) =&gt; ({ id: 'number' }),
    params: [
      {
        name: 'someParam',
        write: (agg, output, aggs) =&gt; ({
          const queryLanguage = getConfig('search:queryLanguage');
          ...etc
        })
      }
    ],
  });

// register the agg type provider
dataSetup.search.aggs.registerMetric('myAgg', getMyAgg);</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/74472" class="ulink" target="_top">#74472</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_73730">
<summary class="title">Routes can specify the idle socket timeout</summary>
<div class="content">
<p>Route definitions can now specify the <code class="literal">idleSocket</code> timeout in addition to the <code class="literal">payload</code> timeout.</p>
<p>Resolves <a href="https://github.com/elastic/kibana/issues/73557" class="ulink" target="_top">#73557</a>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/73730" class="ulink" target="_top">#73730</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_73651">
<summary class="title">New Elasticsearch client exposed</summary>
<div class="content">
<p>Kibana provides the new Elasticsearch client
as a part of the Elasticsearch service on the server-side.
The legacy client is deprecated on and subject for removal in <code class="literal">7.x</code>. Reference
the <a href="https://github.com/elastic/kibana/blob/master/src/core/MIGRATION_EXAMPLES.md#elasticsearch-client" class="ulink" target="_top">migration guide</a> to refactor your code</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/73651" class="ulink" target="_top">#73651</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_72093">
<summary class="title">Query input string manager added</summary>
<div class="content">
<p>This PR allows gracefully extracting of the query string state, to be consumed by other services.
You can now use the <code class="literal">data.query.state$</code> observable and receive all state updates in one place.</p>
<div class="pre_wrapper lang-TypeScript">
<pre class="programlisting prettyprint lang-TypeScript">data.query.state$.subscribe((queryState: QueryState) =&gt; {...})</pre>
</div>
<p>This PR also adds the <code class="literal">data.query.queryString</code> service, allowing to you set the
query string <a href="https://github.com/elastic/kibana/issues/52522" class="ulink" target="_top">programmatically</a>.</p>
<div class="pre_wrapper lang-TypeScript">
<pre class="programlisting prettyprint lang-TypeScript">data.query.queryString.setQuery({query: 'abc', language: 'kuery'});</pre>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/72093" class="ulink" target="_top">#72093</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_67157">
<summary class="title">Role-based access control added to the Alerting &amp; Action plugins</summary>
<div class="content">
<p>This PR allows you to assign privileges to the Alerting framework when
defining your feature in <span class="strong strong"><strong>Kibana</strong></span>. When registering your feature, you can add
a list of AlertTypes under your <code class="literal">read</code> and <code class="literal">all</code> keys of the <code class="literal">privileges</code> object, as such:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">features.registerFeature({
      id: 'alertsExample',
      name: 'alertsExample',
      app: [],
      privileges: {
        all: {
          alerting: {
            all: ['example.always-firing', 'example.people-in-space'],
          },
        },
        read: {
          alerting: {
            read: ['example.always-firing', 'example.people-in-space'],
          },
        },
      },
    });</pre>
</div>
<p>This specifies:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If users AbortError granted the <code class="literal">all</code> privilege to the <code class="literal">alertsExample</code> feature,
then they are also granted <code class="literal">all</code> privileges to the <code class="literal">example.always-firing</code> and <code class="literal">example.people-in-space</code> AlertTypes
under the <code class="literal">alertsExample</code> consumer.
</li>
<li class="listitem">
If users are granted the <code class="literal">read</code> privilege to the <code class="literal">alertsExample</code> feature,
then they are also granted <code class="literal">read</code> privileges to the <code class="literal">example.always-firing</code> and <code class="literal">example.people-in-space</code>
AlertTypes under the <code class="literal">alertsExample</code> consumer.
</li>
</ul>
</div>
<p>For example, an <code class="literal">all</code> user will be able to create an <code class="literal">example.always-firing</code> alert
with the <code class="literal">alertsExample</code> as consumer. This will also automatically grant the user the right to
create an <code class="literal">example.always-firing</code> alert from within Alerts management, where <code class="literal">alerts</code> is the consumer.
This <span class="strong strong"><strong>does not</strong></span> grant the user the ability to create an <code class="literal">example.always-firing</code> alert under any other consumer.
For that, the specific consumer will have to grant the user explicit rights through their privilege system.</p>
<p>For example, if Uptime wanted to allow users to create an <code class="literal">example.people-in-space</code>
alert inside of the Uptime solution, then they will have to do the following:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">features.registerFeature({
      id: 'uptime',
      name: 'Uptime',
      app: [],
      privileges: {
        all: {
          alerting: {
            all: ['xpack.uptime.alerts.actionGroups.tls', 'example.people-in-space'],
          },
        },
        read: {
          alerting: {
            read: ['xpack.uptime.alerts.actionGroups.tls', 'example.people-in-space'],
          },
        },
      },
    });</pre>
</div>
<p>This, assuming it&#8217;s added by Uptime, would grant uptime users the privilege
to create both their own <code class="literal">xpack.uptime.alerts.actionGroups.tls</code> alert and
the <code class="literal">example.people-in-space</code> alert with <code class="literal">uptime</code> as the consumer.</p>
<p>This does not allow any Uptime user with <code class="literal">all</code> privileges to create an <code class="literal">example.people-in-space</code> alert.
To create an <code class="literal">example.people-in-space</code> alert, the Uptime user needs both <code class="literal">all</code> in Uptime <span class="strong strong"><strong>and</strong></span> in
AlertsExample, as we always check whether the user is privileged to execute
an operation (create/enable/delete etc.) in both the alert&#8217;s <em>consumer</em> and its <em>producer</em>.</p>
<p>The one exception to this is when the <em>producer</em> is <code class="literal">alerts</code>, which represents a <code class="literal">built-in</code> AlertType,
in which case we only check for <em>consumer</em> privileges as all users are privileged to create built-in types by definition.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/67157" class="ulink" target="_top">#67157</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_73257">
<summary class="title">The EventLog Setup contract now exposes a <code class="literal">registerSavedObjectProvider</code></summary>
<div class="content">
<p>The EventLog Setup contract now exposes a registerSavedObjectProvider method
which can be used to register a Saved Object provider.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">export interface IEventLogService {
   isEnabled(): boolean;
   isLoggingEntries(): boolean;
   isIndexingEntries(): boolean;
   registerProviderActions(provider: string, actions: string[]): void;
   isProviderActionRegistered(provider: string, action: string): boolean;
   getProviderActions(): Map&lt;string, Set&lt;string&gt;&gt;;
   registerSavedObjectProvider(type: string, provider: SavedObjectProvider): void;
   getLogger(properties: IEvent): IEventLogger;
 }</pre>
</div>
<p>This API specifies the Saved Object type and a "provider"
callback that is called whenever a new request asks for that type of Saved Object.</p>
<p>This example shows a provider for the alert SavedObject type,
which creates a new AlertsClient for the request and returns a getter
that attempts to get the SavedObject by its id.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/73257" class="ulink" target="_top">#73257</a></strong></span></p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">eventLogService.registerSavedObjectProvider('alert', (request: KibanaRequest) =&gt; {
    const client = getAlertsClientWithRequest(request);
    return (type: string, id: string) =&gt; client.get({ id });
});</pre>
</div>
<p>The EventLog maintains a registry of each provider,
and creates a getter on demand when the user actually requests an object of a
certain type. An AlertsClient is only instantiated if
the user requests to the events reference an Alert.
Once a getter is created for a specific request,
it is cached for the remainder of the lifecycle of that request.
This means a single provider is used for multiple gets made by the request.</p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_72289">
<summary class="title">New Elasticsearch client in SO service</summary>
<div class="content">
<p>The SO service was refactored to use <a href="https://github.com/elastic/elasticsearch-js" class="ulink" target="_top">elasticsearch-js</a>
under the hood. This change might affect plugins reading the response status field
from the SO error bubbled to the Solutions code because the Elasticsearch error no longer
provides the status field (statusCode is still provided).</p>
<p>Several plugins were adjusted to check SO errors with <code class="literal">SavedObjectsErrorHelpers</code>.
Plugins must use this because we are going to stop wrapping errors in the Boom object.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/72289" class="ulink" target="_top">#72289</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_72029">
<summary class="title">Alerts Management now controlled via Feature Controls and privileges</summary>
<div class="content">
<p>If you want your plugin to grant a user access to Alerts Management,
you must specify it under Management in your feature configuration:</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">management: {
    insightsAndAlerting: ['triggersActions'],
},</pre>
</div>
<p>You can specify it in three places:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Directly on the feature. When security is disabled, this grants access
to every role granted access to the Feature via Feature Controls.
When security is enabled, this specifies that the feature has access to
this management section and is required before you can grant this to a specific role.
</li>
<li class="listitem">
Under the <code class="literal">all</code> privilege. When security is enabled, this grants access
to every role granted the <code class="literal">all</code> privilege to the Feature via Feature Controls.
</li>
<li class="listitem">
Under the <code class="literal">read</code> privilege. When security is enabled, this grants access
to every role granted the <code class="literal">read</code> privilege to the Feature via Feature Controls.
</li>
</ul>
</div>
<p>You&#8217;re likely to have to specify this in 3 places in your plugin
to cover all 3 scenarios. Although this is more verbose than before,
it aligns with the rest of Kibana.
It also means that the Triggers and Actions plugin no longer needs to
know about each plugin that wants to gain access
(which means Kibana can more easily support future alerting usage).</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/72029" class="ulink" target="_top">#72029</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_73778">
<summary class="title">API changed for creating a Jira connector</summary>
<div class="content">
<p><code class="literal">casesConfiguration</code> was renamed to <code class="literal">incidentConfiguration</code>. Added optional <code class="literal">attributeisCaseOwned</code>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/73778" class="ulink" target="_top">#73778</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_74357">
<summary class="title">API changed for creating an IBM Resilient connector</summary>
<div class="content">
<p><code class="literal">casesConfiguration</code> was renamed to <code class="literal">incidentConfiguration</code>. Added optional <code class="literal">attributeisCaseOwned</code>.</p>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/74357" class="ulink" target="_top">#74357</a></strong></span></p>
</div>
</details>
<details id="breaking_plugin_v7.10.0_77327">
<summary class="title">Settings per case per connector</summary>
<div class="content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To create a case (<code class="literal">POST &lt;kibana host&gt;:&lt;port&gt;/api/cases</code>), you must provide a <code class="literal">connector</code>.
Requests without a <code class="literal">connector</code> get a <code class="literal">400 Bad Request</code>.
</li>
<li class="listitem">
To update the connector of a case (<code class="literal">PATCH &lt;kibana host&gt;:&lt;port&gt;/api/cases</code>),
you must provide the <code class="literal">connector</code>. The <code class="literal">connector_id</code> attribute has been
removed in favor of the <code class="literal">connector</code> attribute.
</li>
<li class="listitem">
To set the default connector (<code class="literal">POST &lt;kibana host&gt;:&lt;port&gt;/api/cases/configure</code>),
you must provide a <code class="literal">connector</code>. The <code class="literal">connector_id</code> and <code class="literal">connector_name</code>
attributes have been removed in favor of the <code class="literal">connector</code> attribute.
</li>
<li class="listitem">
To update the connector’s case closure settings
(<code class="literal">PATCH &lt;kibana host&gt;:&lt;port&gt;/api/cases/configure</code>), you must provide a <code class="literal">connector</code>.
The <code class="literal">connector_id</code> and <code class="literal">connector_name</code> attributes have been removed in
favor of the <code class="literal">connector</code> attribute.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>via <a href="https://github.com/elastic/kibana/pull/77327" class="ulink" target="_top">#77327</a></strong></span></p>
</div>
</details>
</div>
<div class="navfooter">
<span class="prev">
<a href="breaking-changes.html">« Breaking Changes</a>
</span>
<span class="next">
<a href="breaking-changes-7.9.html">Breaking changes in 7.9 »</a>
</span>
</div>
</div>
</body>
</html>
