<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Security | Kibana Guide [7.9] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [7.9]"/>
<link rel="up" href="kibana-architecture.html" title="Architecture"/>
<link rel="prev" href="development-visualize-index.html" title="Developing Visualizations"/>
<link rel="next" href="code-exploration.html" title="Exploring Kibana code"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/7.9"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="7.9"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [7.9]</a></span>
»
<span class="breadcrumb-link"><a href="development.html">Developer guide</a></span>
»
<span class="breadcrumb-link"><a href="kibana-architecture.html">Architecture</a></span>
»
<span class="breadcrumb-node">Security</span>
</div>
<div class="navheader">
<span class="prev">
<a href="development-visualize-index.html">« Developing Visualizations</a>
</span>
<span class="next">
<a href="code-exploration.html">Exploring Kibana code »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="development-security"></a>Security<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.9/docs/developer/architecture/security/index.asciidoc">edit</a></h2>
</div></div></div>
<p>Kibana has generally been able to implement security transparently to core and plugin developers, and this largely remains the case. Kibana on two methods that the elasticsearch <code class="literal">Cluster</code> provides: <code class="literal">callWithRequest</code> and <code class="literal">callWithInternalUser</code>.</p>
<p><code class="literal">callWithRequest</code> executes requests against Elasticsearch using the authentication credentials of the Kibana end-user. So, if you log into Kibana with the user of <code class="literal">foo</code> when <code class="literal">callWithRequest</code> is used, Kibana execute the request against Elasticsearch as the user <code class="literal">foo</code>. Historically, <code class="literal">callWithRequest</code> has been used extensively to perform actions that are initiated at the request of Kibana end-users.</p>
<p><code class="literal">callWithInternalUser</code> executes requests against Elasticsearch using the internal Kibana server user, and has historically been used for performing actions that aren&#8217;t initiated by Kibana end users; for example, creating the initial <code class="literal">.kibana</code> index or performing health checks against Elasticsearch.</p>
<p>However, with the changes that role-based access control (RBAC) introduces, this is no longer cut and dry. Kibana now requires all access to the <code class="literal">.kibana</code> index goes through the <code class="literal">SavedObjectsClient</code>. This used to be a best practice, as the <code class="literal">SavedObjectsClient</code> was responsible for translating the documents stored in Elasticsearch to and from Saved Objects, but RBAC is now taking advantage of this abstraction to implement access control and determine when to use <code class="literal">callWithRequest</code> versus <code class="literal">callWithInternalUser</code>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="development-security-rbac"></a>Role-based access control<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.9/docs/developer/architecture/security/rbac.asciidoc">edit</a></h3>
</div></div></div>
<p>Role-based access control (RBAC) in Kibana relies upon the
<a href="/guide/en/elasticsearch/reference/7.9/security-privileges.html#application-privileges" class="ulink" target="_top">application privileges</a>
that Elasticsearch exposes. This allows Kibana to define the privileges that
Kibana wishes to grant to users, assign them to the relevant users using roles,
and then authorize the user to perform a specific action. This is handled within
a secured instance of the <code class="literal">SavedObjectsClient</code> and available transparently to
consumers when using <code class="literal">request.getSavedObjectsClient()</code> or
<code class="literal">savedObjects.getScopedSavedObjectsClient()</code>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="development-rbac-privileges"></a>Kibana Privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.9/docs/developer/architecture/security/rbac.asciidoc">edit</a></h4>
</div></div></div>
<p>When Kibana first starts up, it executes the following <code class="literal">POST</code> request against Elasticsearch. This synchronizes the definition of the privileges with various <code class="literal">actions</code> which are later used to authorize a user:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">POST /_security/privilege
Content-Type: application/json
Authorization: Basic {kib} changeme

{
   "kibana-.kibana":{
       "all":{
           "application":"kibana-.kibana",
           "name":"all",
           "actions":[
               "version:7.0.0-alpha1-SNAPSHOT",
               "action:login",
               "action:*"
           ],
           "metadata":{}
       },
       "read":{
           "application":"kibana-.kibana",
           "name":"read",
           "actions":[
               "version:7.0.0-alpha1-SNAPSHOT",
               "action:login",
               "saved_object:dashboard/get",
               "saved_object:dashboard/bulk_get",
               "saved_object:dashboard/find",
               ...
           ],"metadata":{}}
   }
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The application is created by concatenating the prefix of <code class="literal">kibana-</code> with the value of <code class="literal">kibana.index</code> from the <code class="literal">kibana.yml</code>, so different Kibana tenants are isolated from one another.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="development-rbac-assigning-privileges"></a>Assigning Kibana Privileges<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.9/docs/developer/architecture/security/rbac.asciidoc">edit</a></h4>
</div></div></div>
<p>Kibana privileges are assigned to specific roles using the <code class="literal">applications</code> element. For example, the following role assigns the <a class="xref" href="kibana-privileges.html#kibana-privileges-all">all</a> privilege at <code class="literal">*</code> <code class="literal">resources</code> (which will in the future be used to secure spaces) to the default Kibana <code class="literal">application</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">"new_kibana_user": {
   "applications": [
     {
       "application": "kibana-.kibana",
       "privileges": [
         "all"
       ],
       "resources": [
         "*"
       ]
     }
   ]
 }</pre>
</div>
<p>Roles that grant <a class="xref" href="kibana-privileges.html" title="Kibana privileges">Kibana privileges</a> should be managed using the <a class="xref" href="role-management-api.html" title="Kibana role management APIs"><em>Kibana role management APIs</em></a> or the <span class="strong strong"><strong>Management &#8594; Security &#8594; Roles</strong></span> page, not directly using the Elasticsearch <a href="/guide/en/elasticsearch/reference/7.9/security-api.html#security-role-apis" class="ulink" target="_top">role management API</a>. This role can then be assigned to users using the Elasticsearch
<a href="/guide/en/elasticsearch/reference/7.9/security-api.html#security-user-apis" class="ulink" target="_top">user management APIs</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="development-rbac-authorization"></a>Authorization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.9/docs/developer/architecture/security/rbac.asciidoc">edit</a></h4>
</div></div></div>
<p>The Elasticsearch <a href="/guide/en/elasticsearch/reference/7.9/security-api-has-privileges.html" class="ulink" target="_top">has privileges API</a> determines whether the user is authorized to perform a specific action:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">POST /_security/user/_has_privileges
Content-Type: application/json
Authorization: Basic foo_read_only_user password

{
   "applications":[
       {
           "application":"kibana-.kibana",
           "resources":["*"],
           "privileges":[
             "saved_object:dashboard/save",
           ]
       }
   ]
}</pre>
</div>
<p>Elasticsearch checks if the user is granted a specific action. If the user is assigned a role that grants a privilege, Elasticsearch uses the <a class="xref" href="development-security.html#development-rbac-privileges" title="Kibana Privileges">Kibana privileges</a> definition to associate this with the actions, which makes authorizing users more intuitive and flexible programatically.</p>
<p>Once we have authorized the user to perform a specific action, we can execute the request using <code class="literal">callWithInternalUser</code>.</p>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="development-visualize-index.html">« Developing Visualizations</a>
</span>
<span class="next">
<a href="code-exploration.html">Exploring Kibana code »</a>
</span>
</div>
</div>
</body>
</html>
