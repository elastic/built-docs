<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Troubleshoot common problems | Kibana Guide [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [7.x]"/>
<link rel="up" href="xpack-apm.html" title="APM"/>
<link rel="prev" href="kibana-api.html" title="Kibana API"/>
<link rel="next" href="xpack-siem.html" title="Elastic Security"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/7.x"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="7.x"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="xpack-apm.html">APM</a></span>
»
<span class="breadcrumb-node">Troubleshoot common problems</span>
</div>
<div class="navheader">
<span class="prev">
<a href="kibana-api.html">« Kibana API</a>
</span>
<span class="next">
<a href="xpack-siem.html">Elastic Security »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="troubleshooting"></a>Troubleshoot common problems<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/apm/troubleshooting.asciidoc">edit</a></h2>
</div></div></div>

<p>If you have something to add to this section, please consider creating a pull request with
your proposed changes in the <a href="https://github.com/elastic/kibana" class="ulink" target="_top">Kibana repository</a>.</p>
<p>Also, check out the <a href="https://discuss.elastic.co/c/apm" class="ulink" target="_top">APM discussion forum</a>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="troubleshooting.html#no-apm-data-found" title="No APM data found">No APM data found</a>
</li>
<li class="listitem">
<a class="xref" href="troubleshooting.html#troubleshooting-too-many-transactions" title="Too many unique transaction names">Too many unique transaction names</a>
</li>
<li class="listitem">
<a class="xref" href="troubleshooting.html#troubleshooting-unknown-route" title="Unknown route">Unknown route</a>
</li>
<li class="listitem">
<a class="xref" href="troubleshooting.html#troubleshooting-fields-unsearchable" title="Fields are not searchable">Fields are not searchable</a>
</li>
</ul>
</div>
<h3><a id="no-apm-data-found"></a>No APM data found<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/apm/troubleshooting.asciidoc">edit</a></h3>
<p>This section can help with any of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Data isn&#8217;t displaying in the APM app
</li>
<li class="listitem">
You see a message like "No Services Found",
</li>
<li class="listitem">
You see errors like "Fielddata is disabled on text fields by default&#8230;&#8203;"
</li>
</ul>
</div>
<p>There are a number of factors that could be at play here.
One important thing to double-check first is your index template.</p>
<p><span class="strong strong"><strong>Index template</strong></span>
An APM index template must exist for the APM app to work correctly.
By default, this index template is created by APM Server on startup.
However, this only happens if <code class="literal">setup.template.enabled</code> is <code class="literal">true</code> in <code class="literal">apm-server.yml</code>.
You can create the index template manually by running <code class="literal">apm-server setup</code>.
Take note that index templates <span class="strong strong"><strong>cannot</strong></span> be applied retroactively&#8201;&#8212;&#8201;they are only applied at index creation time.
More information is available in <a href="/guide/en/apm/server/master/apm-server-configuration.html" class="ulink" target="_top">Set up and configure</a>.</p>
<p>You can check for the existence of an APM index template using the
<a href="/guide/en/elasticsearch/reference/7.x/indices-get-template.html" class="ulink" target="_top">Get index template API</a>.
If you&#8217;re using the default index naming pattern, that request would be:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_template/apm-{version}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2.console"></div>
<p><span class="strong strong"><strong>Using Logstash, Kafka, etc.</strong></span>
If you&#8217;re not outputting data directly from APM Server to Elasticsearch (perhaps you&#8217;re using Logstash or Kafka),
then the index template will not be set up automatically. Instead, you&#8217;ll need to
<a href="/guide/en/apm/server/master/apm-server-template.html" class="ulink" target="_top">load the template manually</a>.</p>
<p><span class="strong strong"><strong>Using a custom index names</strong></span>
This problem can also occur if you&#8217;ve customized the index name that you write APM data to.
The default index name that APM writes events to can be found
<a href="/guide/en/apm/server/master/elasticsearch-output.html#index-option-es" class="ulink" target="_top">here</a>.
If you change the default, you must also configure the <code class="literal">setup.template.name</code> and <code class="literal">setup.template.pattern</code> options.
See <a href="/guide/en/apm/server/master/configuration-template.html" class="ulink" target="_top">Load the Elasticsearch index template</a>.
If the Elasticsearch index template has already been successfully loaded to the index,
you can customize the indices that the APM app uses to display data.
Navigate to <span class="strong strong"><strong>APM</strong></span> &gt; <span class="strong strong"><strong>Settings</strong></span> &gt; <span class="strong strong"><strong>Indices</strong></span>, and change all <code class="literal">apm_oss.*Pattern</code> values to
include the new index pattern. For example: <code class="literal">customIndexName-*</code>.</p>
<h3><a id="troubleshooting-too-many-transactions"></a>Too many unique transaction names<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/apm/troubleshooting.asciidoc">edit</a></h3>
<p>Transaction names are defined in each APM Agent; when an Agent supports a framework,
it includes logic for naming the transactions that the framework creates.
In some cases though, like when using an Agent&#8217;s API to create custom transactions,
it is up to the user to define a pattern for transaction naming.
When transactions are named incorrectly, each unique URL can be associated with a unique transaction group—causing
an explosion in the number of transaction groups per service, and leading to inaccuracies in the APM app.</p>
<p>To fix a large number of unique transaction names,
you need to change how you are using the Agent API to name your transactions.
To do this, ensure you are <span class="strong strong"><strong>not</strong></span> naming based on parameters that can change.
For example, user ids, product ids, order numbers, query parameters, etc.,
should be stripped away, and commonality should be found between your unique URLs.</p>
<p>Let&#8217;s look at an example from the RUM Agent documentation. Here are a few URLs you might find on Elastic.co:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">// Blog Posts
https://www.elastic.co/blog/reflections-on-three-years-in-the-elastic-public-sector
https://www.elastic.co/blog/say-heya-to-the-elastic-search-awards
https://www.elastic.co/blog/and-the-winner-of-the-elasticon-2018-training-subscription-drawing-is

// Documentation
https://www.elastic.co/guide/en/elastic-stack/current/index.html
https://www.elastic.co/guide/en/apm/get-started/current/index.html
https://www.elastic.co/guide/en/infrastructure/guide/current/index.html</pre>
</div>
<p>These URLs, like most, include unique names.
If we named transactions based on each unique URL, we&#8217;d end up with the problem described above—a
very large number of different transaction names.
Instead, we should strip away the unique information and group our transactions based on common information.
In this case, that means naming all blog transactions, <code class="literal">/blog</code>, and all documentation transactions, <code class="literal">/guide</code>.</p>
<p>If you feel like you&#8217;d be losing valuable information by following this naming convention, don&#8217;t fret!
You can always add additional metadata to your transactions using <a href="/guide/en/apm/get-started/master/metadata.html#labels-fields" class="ulink" target="_top">labels</a> (indexed) or
<a href="/guide/en/apm/get-started/master/metadata.html#custom-fields" class="ulink" target="_top">custom context</a> (non-indexed).</p>
<p>After ensuring you&#8217;ve correctly named your transactions,
you might still see an error in the APM app related to too many transaction names.
If this is the case, you can increase the default number of transaction groups displayed in the APM app by configuring
<a class="xref" href="apm-settings-kb.html" title="APM settings in Kibana"><code class="literal">xpack.apm.ui.transactionGroupBucketSize</code></a>.</p>
<p><span class="strong strong"><strong>More information</strong></span></p>
<p>While this can happen with any APM Agent, it typically occurs with the RUM Agent.
For more information on how to correctly set <code class="literal">transaction.name</code> in the RUM Agent,
see <a href="/guide/en/apm/agent/rum-js/current/custom-transaction-name.html" class="ulink" target="_top">custom initial page load transaction names</a>.</p>
<p>The RUM Agent can also set the <code class="literal">transaction.name</code> when observing for transaction events.
See <a href="/guide/en/apm/agent/rum-js/current/agent-api.html#observe" class="ulink" target="_top"><code class="literal">apm.observe()</code></a> for more information.</p>
<p>If your problem is occurring in a different Agent, the tips above still apply.
See the relevant <a href="/guide/en/apm/agent" class="ulink" target="_top">Agent API documentation</a> to adjust how you&#8217;re naming your transactions.</p>
<h3><a id="troubleshooting-unknown-route"></a>Unknown route<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/apm/troubleshooting.asciidoc">edit</a></h3>
<p>The <a href="/guide/en/kibana/7.x/transactions.html" class="ulink" target="_top">transaction overview</a> will only display helpful information
when the transactions in your services are named correctly.
If you&#8217;re seeing "GET unknown route" or "unknown route" in the APM app,
it could be a sign that something isn&#8217;t working as it should.</p>
<p>Elastic APM Agents come with built-in support for popular frameworks out-of-the-box.
This means, among other things, that the Agent will try to automatically name HTTP requests.
As an example, the Node.js Agent uses the route that handled the request, while the Java Agent uses the Servlet name.</p>
<p>"Unknown route" indicates that the Agent can&#8217;t determine what to name the request,
perhaps because the technology you&#8217;re using isn&#8217;t supported, the Agent has been installed incorrectly,
or because something is happening to the request that the Agent doesn&#8217;t understand.</p>
<p>To resolve this, you&#8217;ll need to head over to the relevant <a href="/guide/en/apm/agent" class="ulink" target="_top">Agent documentation</a>.
Specifically, view the Agent&#8217;s supported technologies page.
You can also use the Agent&#8217;s public API to manually set a name for the transaction.</p>
<h3><a id="troubleshooting-fields-unsearchable"></a>Fields are not searchable<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/7.x/docs/apm/troubleshooting.asciidoc">edit</a></h3>
<p>In Elasticsearch, index templates are used to define settings and mappings that determine how fields should be analyzed.
The recommended index template file for APM Server is installed by the APM Server packages.
This template, by default, enables and disables indexing on certain fields.</p>
<p>As an example, some agents store cookie values in <code class="literal">http.request.cookies</code>.
Since <code class="literal">http.request</code> has disabled dynamic indexing, and <code class="literal">http.request.cookies</code> is not declared in a custom mapping,
the values in <code class="literal">http.request.cookies</code> are not indexed and thus not searchable.</p>
<p><span class="strong strong"><strong>Ensure an index pattern exists</strong></span>
As a first step, you should ensure the correct index pattern exists.
In Kibana, navigate to <span class="strong strong"><strong>Management &gt; Kibana &gt; Index Patterns</strong></span>.
In the pattern list, you should see an apm index pattern; The default is <code class="literal">apm-*</code>.
If you don&#8217;t, the index pattern doesn&#8217;t exist. See <a class="xref" href="troubleshooting.html#no-apm-data-found" title="No APM data found">No APM data found</a> for information on how to fix this problem.</p>
<p>Selecting the <code class="literal">apm-*</code> index pattern shows a listing of every field defined in the pattern.</p>
<p><span class="strong strong"><strong>Ensure a field is searchable</strong></span>
There are two things you can do to if you&#8217;d like to ensure a field is searchable:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Index your additional data as <a href="/guide/en/apm/get-started/master/metadata.html" class="ulink" target="_top">labels</a> instead.
These are dynamic by default, which means they will be indexed and become searchable and aggregatable.
</li>
<li class="listitem">
Use the <a href="/guide/en/apm/server/master/configuration-template.html" class="ulink" target="_top"><code class="literal">append_fields</code></a> feature. As an example,
adding the following to <code class="literal">apm-server.yml</code> will enable dynamic indexing for <code class="literal">http.request.cookies</code>:
</li>
</ol>
</div>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">setup.template.enabled: true
setup.template.overwrite: true
setup.template.append_fields:
  - name: http.request.cookies
    type: object
    dynamic: true</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="kibana-api.html">« Kibana API</a>
</span>
<span class="next">
<a href="xpack-siem.html">Elastic Security »</a>
</span>
</div>
</div>
</body>
</html>
