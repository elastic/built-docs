<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Troubleshooting CSV reports | Kibana Guide [8.17] | Elastic</title>
<meta class="elastic" name="content" content="Troubleshooting CSV reports | Kibana Guide [8.17]">

<link rel="home" href="index.html" title="Kibana Guide [8.17]"/>
<link rel="up" href="reporting-troubleshooting.html" title="Troubleshooting reporting features"/>
<link rel="prev" href="reporting-troubleshooting.html" title="Troubleshooting reporting features"/>
<link rel="next" href="reporting-troubleshooting-pdf.html" title="Troubleshooting PDF and PNG reports"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Kibana"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/8.17"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="8.17"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="reporting-troubleshooting.html">« Troubleshooting reporting features</a>
</span>
<span class="next">
<a href="reporting-troubleshooting-pdf.html">Troubleshooting PDF and PNG reports »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Kibana Guide [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="reporting-getting-started.html">Reporting and sharing</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="reporting-troubleshooting.html">Troubleshooting reporting features</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Troubleshooting CSV reports</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.17/docs/user/reporting/reporting-csv-troubleshooting.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/explore-analyze/report-and-share/reporting-troubleshooting-csv">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="reporting-troubleshooting-csv"></a>Troubleshooting CSV reports</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.17/docs/user/reporting/reporting-csv-troubleshooting.asciidoc">edit</a></div>
</div></div></div>

<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>We recommend using CSV reports to export moderate amounts of data only. The feature enables analysis of data in external tools, but it is not intended for bulk export or to backup Elasticsearch data. Report timeout and incomplete data issues are likely if you are exporting data where:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
More than 250 MB of data is being exported
</li>
<li class="listitem">
Data is stored on slow storage tiers
</li>
<li class="listitem">
Any shard needed for the search is unavailable
</li>
<li class="listitem">
Network latency between nodes is high
</li>
<li class="listitem">
Cross-cluster search is used
</li>
<li class="listitem">
ES|QL is used and result row count exceeds the limits of ES|QL queries
</li>
</ul>
</div>
<p>To work around the limitations, use filters to create multiple smaller reports, or extract the data you need directly with the Elasticsearch APIs.</p>
<p>For more information on using Elasticsearch APIs directly, see <a href="/guide/en/elasticsearch/reference/8.17/scroll-api.html" class="ulink" target="_top">Scroll API</a>, <a href="/guide/en/elasticsearch/reference/8.17/point-in-time-api.html" class="ulink" target="_top">Point in time API</a>, <a href="/guide/en/elasticsearch/reference/8.17/esql-rest.html" class="ulink" target="_top">ES|QL</a> or <a href="/guide/en/elasticsearch/reference/8.17/sql-rest-format.html#_csv" class="ulink" target="_top">SQL</a> with CSV response data format. We recommend that you use an official Elastic language client: details for each programming language library that Elastic provides are in the <a href="/guide/en/elasticsearch/client/index.html" class="ulink" target="_top">Elasticsearch Client documentation</a>.</p>
<p><a class="xref" href="reporting-settings-kb.html" title="Reporting settings in Kibana">Reporting parameters</a> can be adjusted to overcome some of these limiting scenarios. Results are dependent on data size, availability, and latency factors and are not guaranteed.</p>
</div>
</div>
<p>The CSV export feature in Kibana makes queries to Elasticsearch and formats the results into CSV. This feature
offers a solution that attempts to provide the most benefit to the most use cases. However, things could go
wrong during export. Elasticsearch can stop responding, repeated querying can take so long that authentication
tokens can time out, and the format of exported data can be too complex for spreadsheet applications to handle.
Such situations are outside of the control of Kibana. If the use case becomes complex enough, it&#8217;s recommended
that you create scripts that query Elasticsearch directly, using a scripting language like Python and the
public Elasticsearch APIs.</p>
<p>For advice about common problems, refer to <a class="xref" href="reporting-troubleshooting.html" title="Troubleshooting reporting features"><em>Troubleshooting</em></a>.</p>
<div class="position-relative"><h4><a id="reporting-troubleshooting-csv-configure-scan-api"></a>Configuring CSV export to use the scroll API</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.17/docs/user/reporting/reporting-csv-troubleshooting.asciidoc">edit</a></div>
<p>The Kibana CSV export feature collects all of the data from Elasticsearch by using multiple requests to page
over all of the documents.
Internally, the feature uses the <a href="/guide/en/elasticsearch/reference/8.17/point-in-time-api.html" class="ulink" target="_top">Point in time API and
<code class="literal">search_after</code> parameters in the queries</a> to do so.
There are some limitations related to the point in time API:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Permissions to read data aliases alone will not work: the permissions are needed on the underlying indices or data streams.
</li>
<li class="listitem">
In cases where data shards are unavailable or time out, the export will be empty rather than returning partial data.
</li>
</ol>
</div>
<p>Some users may benefit from using the <a href="/guide/en/elasticsearch/reference/8.17/paginate-search-results.html#scroll-search-results" class="ulink" target="_top">scroll API</a>, an
alternative to paging through the data.
The behavior of this API does not have the limitations of point in time API, however it has its own limitations:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Search is limited to 500 shards at the very most.
</li>
<li class="listitem">
In cases where the data shards are unavailable or time out, the export may return partial data.
</li>
</ol>
</div>
<p>If you prefer the internal implementation of CSV export to use the scroll API, you can configure this in
<code class="literal">kibana.yml</code>:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">xpack.reporting.csv.scroll.strategy: scroll</pre>
</div>
<p>For more details about CSV export settings, go to <a class="xref" href="reporting-settings-kb.html#reporting-csv-settings" title="CSV settings">CSV settings</a>.</p>
<div class="position-relative"><h4><a id="reporting-troubleshooting-csv-socket-hangup"></a>Socket hangups</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.17/docs/user/reporting/reporting-csv-troubleshooting.asciidoc">edit</a></div>
<p>A "socket hangup" is a generic type of error meaning that a remote service (in this case Elasticsearch or a proxy in Cloud) closed the connection.
Kibana can&#8217;t foresee when this might happen and can&#8217;t force the remote service to keep the connection open.
To work around this situation, consider lowering the size of results that come back in each request or increase the amount of time the remote services will
allow to keep the request open.
For example:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">xpack.reporting.csv.scroll.size: 50
xpack.reporting.csv.scroll.duration: 2m</pre>
</div>
<p>Such changes aren&#8217;t guaranteed to solve the issue, but give the functionality a better
chance of working in this use case.
Unfortunately, lowering the scroll size will require more requests to Elasticsearch during export, which adds more time overhead, which could unintentionally create more instances of auth token expiration errors.</p>
<div class="position-relative"><h4><a id="reporting-troubleshooting-inspect-query-used-for-export"></a>Inspecting the query used for CSV export</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.17/docs/user/reporting/reporting-csv-troubleshooting.asciidoc">edit</a></div>
<p>The listing of reports in <span class="strong strong"><strong>Stack Management &gt; Reporting</strong></span> allows you to inspect the query used for CSV export. It can be helpful to see the raw responses
from Elasticsearch, or determine if there are performance improvements to be gained by changing the way you query the data.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Stack Management &gt; Reporting</strong></span> and click the info icon next to a report.
</li>
<li class="listitem">
In the footer of the report flyout, click <span class="strong strong"><strong>Actions</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Inspect query in Console</strong></span> in the <span class="strong strong"><strong>Actions</strong></span> menu.
</li>
<li class="listitem">
This will open the <span class="strong strong"><strong>Console</strong></span> application, pre-filled with the queries used to generate the CSV export.
</li>
</ol>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="https://images.contentstack.io/v3/assets/bltefdd0b53724fa2ce/blt4758e67aaec715d9/67897d0be92e090a6dc626a8/inspect-query-from-csv-export.gif" alt="Inspect the query used for CSV export">
</div>
</div>
<div class="position-relative"><h4><a id="reporting-troubleshooting-csv-token-expired"></a>Token expiration</h4><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.17/docs/user/reporting/reporting-csv-troubleshooting.asciidoc">edit</a></div>
<p>A relatively common type of error seen for CSV exports is: <code class="literal">security_exception Root causes: security_exception: token expired</code>.</p>
<p>This error occurs in deployments that use token-based authentication (SAML tokens) when it takes too long to create the CSV report with the authentication cached in report job details.</p>
<p>This means that the deployment is stable, but the size of the requested report is too large to complete within the time allowed by the authentication token available to the Reporting task.</p>
<div class="position-relative"><h5><a id="avoid-token-expiration"></a>Avoiding token expiration</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.17/docs/user/reporting/reporting-csv-troubleshooting.asciidoc">edit</a></div>
<p>You can use the following workarounds for this error:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Create smaller reports. Instead of creating one report that covers a large time range, create multiple reports that cover segmented time ranges.
</li>
<li class="listitem">
Increase <code class="literal">xpack.security.authc.token.timeout</code>, which is set to <code class="literal">20m</code> by default.
</li>
<li class="listitem">
To avoid token expirations completely, use a type of authentication that doesn&#8217;t expire (such as Basic auth), or run the export using scripts that query Elasticsearch directly.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="reporting-troubleshooting.html">« Troubleshooting reporting features</a>
</span>
<span class="next">
<a href="reporting-troubleshooting-pdf.html">Troubleshooting PDF and PNG reports »</a>
</span>
</div>
</body>
</html>
