<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Azure Module | Logstash Reference [6.5] | Elastic</title>
<link rel="home" href="index.html" title="Logstash Reference [6.5]"/>
<link rel="up" href="logstash-modules.html" title="Working with Logstash Modules"/>
<link rel="prev" href="netflow-module.html" title="Logstash Netflow Module"/>
<link rel="next" href="filebeat-modules.html" title="Working with Filebeat Modules"/>
<meta name="DC.type" content="Learn/Docs/Logstash/Reference/6.5"/>
<meta name="DC.subject" content="Logstash"/>
<meta name="DC.identifier" content="6.5"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Logstash Reference [6.5]</a></span>
»
<span class="breadcrumb-link"><a href="logstash-modules.html">Working with Logstash Modules</a></span>
»
<span class="breadcrumb-node">Azure Module</span>
</div>
<div class="navheader">
<span class="prev">
<a href="netflow-module.html">« Logstash Netflow Module</a>
</span>
<span class="next">
<a href="filebeat-modules.html">Working with Filebeat Modules »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="azure-module"></a>Azure Module<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>The <a href="https://azure.microsoft.com/en-us/overview/what-is-azure/" class="ulink" target="_top">Microsoft Azure</a>
module in Logstash helps you easily integrate your Azure activity logs and SQL
diagnostic logs with the Elastic Stack.</p>
<div class="imageblock">
<div class="content">
<img src="static/images/azure-flow.png" alt="Azure Work Flow" width="80%">
</div>
</div>
<p>You can monitor your Azure cloud environments and SQL DB deployments with
deep operational insights across multiple Azure subscriptions. You can explore
the health of your infrastructure in real-time, accelerating root cause analysis
and decreasing overall time to resolution. The Azure module helps you:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Analyze infrastructure changes and authorization activity
</li>
<li class="listitem">
Identify suspicious behaviors and potential malicious actors
</li>
<li class="listitem">
Perform root-cause analysis by investigating user activity
</li>
<li class="listitem">
Monitor and optimize your SQL DB deployments.
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Logstash Azure module is an
<a href="/products/x-pack" class="ulink" target="_top">X-Pack</a> feature under the Basic License
and is therefore free to use. Please contact
<a href="mailto:monitor-azure@elastic.co" class="ulink" target="_top">monitor-azure@elastic.co</a> for questions or more
information.</p>
</div>
</div>
<p>The Azure module uses the
<a href="/guide/en/logstash/6.5/plugins-inputs-azure_event_hubs.html" class="ulink" target="_top">Logstash Azure Event Hubs
input plugin</a> to consume data from Azure Event Hubs. The module taps directly into the
Azure dashboard, parses and indexes events into Elasticsearch, and installs a
suite of Kibana dashboards to help you start exploring your data immediately.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="azure-dashboards"></a>Dashboards<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<p>These Kibana dashboards are available and ready for you to use. You can use them as they are, or tailor them to meet your needs.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_infrastructure_activity_monitoring"></a>Infrastructure activity monitoring<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Overview</strong></span>. Top-level view into your Azure operations, including info about users, resource groups, service health, access, activities, and alerts.
</li>
<li class="listitem">
<span class="strong strong"><strong>Alerts</strong></span>. Alert info, including activity, alert status, and alerts heatmap
</li>
<li class="listitem">
<span class="strong strong"><strong>User Activity</strong></span>. Info about system users, their activity, and requests.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_sql_database_monitoring"></a>SQL Database monitoring<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>SQL DB Overview</strong></span>. Top-level view into your SQL Databases, including counts for databases, servers, resource groups, and subscriptions.
</li>
<li class="listitem">
<span class="strong strong"><strong>SQL DB Database View</strong></span>. Detailed info about each SQL Database, including wait time, errors, DTU and storage utilization, size, and read and write input/output.
</li>
<li class="listitem">
<span class="strong strong"><strong>SQL DB Queries</strong></span>. Info about SQL Database queries and performance.
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="azure-module-prereqs"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<p>Azure Monitor enabled with Azure Event Hubs and the Elastic Stack are required
for this module.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure-elk-prereqs"></a>Elastic prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>The instructions below assume that you have Logstash, Elasticsearch, and Kibana running locally.
You can also run Logstash, Elasticsearch, and Kibana on separate hosts.</p>
<p>The Elastic Stack version 6.4 (or later) is required for this module.</p>
<p>The Azure module uses the <code class="literal">azure_event_hubs</code> input plugin to consume logs and
metrics from your Azure environment. It is installed by default with Logstash 6.4
(or later). Basic understanding of the plugin and options is helpful when you
set up the Azure module.
See the <a href="/guide/en/logstash/6.5/plugins-inputs-azure_event_hubs.html" class="ulink" target="_top">azure_event_hubs input
plugin documentation</a> for more information.</p>
<p>Elastic products are <a href="/downloads" class="ulink" target="_top">available to download</a> and
easy to install.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure-prereqs"></a>Azure prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>Azure Monitor should be configured to stream logs to one or more Event Hubs.
Logstash will need to access these Event Hubs instances to consume your Azure logs and metrics.
See <a class="xref" href="azure-module.html#azure-resources" title="Microsoft Azure resources">Microsoft Azure resources</a> at the end of this topic for links to Microsoft Azure documentation.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="configuring-azure"></a>Configure the module<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<p>Specify <a class="xref" href="azure-module.html#azure_config_options" title="Configuration options">options</a> for the Logstash Azure module in the
<code class="literal">logstash.yml</code> configuration file.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Basic configuration.</strong></span> You can use the <code class="literal">logstash.yml</code> file to configure inputs from multiple Event Hubs that share the same configuration.
Basic configuration is recommended for most use cases.
</li>
<li class="listitem">
<span class="strong strong"><strong>Advanced configuration.</strong></span>  The advanced configuration is available for deployments where different Event Hubs
require different configurations. The <code class="literal">logstash.yml</code> file holds your settings. Advanced configuration is not necessary or
recommended for most use cases.
</li>
</ul>
</div>
<p>See the <a href="/guide/en/logstash/6.5/plugins-inputs-azure_event_hubs.html" class="ulink" target="_top">azure_event_hubs input plugin
documentation</a> for more information about basic and advanced configuration
models.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="basic-config-sample"></a>Basic configuration sample<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>The configuration in the <code class="literal">logstash.yml</code> file is shared between Event Hubs.
Basic configuration is recommended for most use cases</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">modules:
  - name: azure
    var.elasticsearch.hosts: localhost:9200
    var.kibana.host: localhost:5601
    var.input.azure_event_hubs.consumer_group: "logstash" <a id="CO10-1"></a><i class="conum" data-value="1"></i>
    var.input.azure_event_hubs.storage_connection: "DefaultEndpointsProtocol=https;AccountName=instance1..." <a id="CO10-2"></a><i class="conum" data-value="2"></i>
    var.input.azure_event_hubs.threads: 9 <a id="CO10-3"></a><i class="conum" data-value="3"></i>
    var.input.azure_event_hubs.event_hub_connections:
      - "Endpoint=sb://...EntityPath=insights-operational-logs" <a id="CO10-4"></a><i class="conum" data-value="4"></i>
      - "Endpoint=sb://...EntityPath=insights-metrics-pt1m" <a id="CO10-5"></a><i class="conum" data-value="5"></i>
      - "Endpoint=sb://...EntityPath=insights-logs-blocks"
      - "Endpoint=sb://...EntityPath=insights-logs-databasewaitstatistics"
      - "Endpoint=sb://...EntityPath=insights-logs-errors"
      - "Endpoint=sb://...EntityPath=insights-logs-querystoreruntimestatistics"
      - "Endpoint=sb://...EntityPath=insights-logs-querystorewaitstatistics"
      - "Endpoint=sb://...EntityPath=insights-logs-timeouts"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">consumer_group</code> (optional) is highly recommended. See <a class="xref" href="azure-module.html#azure_best_practices" title="Best practices">Best practices</a>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The <code class="literal">storage_connection</code> (optional) sets the Azure Blob Storage connection for tracking processing state for Event Hubs when scaling out a deployment with multiple Logstash instances. See <a class="xref" href="azure-module.html#scaling-blob" title="Scale Event Hub consumption">Scale Event Hub consumption</a> for additional details.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>See <a class="xref" href="azure-module.html#azure_best_practices" title="Best practices">Best practices</a> for guidelines on choosing an appropriate number of threads.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>This connection sets up the consumption of Activity Logs. By default, Azure Monitor uses the <code class="literal">insights-operational-logs</code> Event Hub name. Make sure this matches the name of the Event Hub specified for Activity Logs.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>This connection and the ones below set up the consumption of SQL DB diagnostic logs and metrics. By default, Azure Monitor uses all these different Event Hub names.</p>
</td>
</tr>
</table>
</div>
<p>The basic configuration requires the <code class="literal">var.input.azure_event_hubs.</code> prefix
before a configuration option.
Notice the notation for the <code class="literal">threads</code> option.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="adv-config-sample"></a>Advanced configuration sample<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>Advanced configuration in the <code class="literal">logstash.yml</code> file supports Event Hub specific
options. Advanced configuration is available for more granular tuning of
threading and Blob Storage usage across multiple Event Hubs. Advanced
configuration is not necessary or recommended for most use cases. Use it only if
it is required for your deployment scenario.</p>
<p>You must define the <code class="literal">header</code> array with <code class="literal">name</code> in the first position. You can
define other options in any order. The per Event Hub configuration takes
precedence. Any values not defined per Event Hub use the global config value.</p>
<p>In this example <code class="literal">threads</code>, <code class="literal">consumer_group</code>, and <code class="literal">storage_connection</code> will be
applied to each of the configured Event Hubs. Note that <code class="literal">decorate_events</code> is
defined in both the global and per Event Hub configuration. The per Event Hub
configuration takes precedence, and the global configuration is effectively
ignored when the per Event Hub setting is present.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">modules:
  - name: azure
    var.elasticsearch.hosts: localhost:9200
    var.kibana.host: localhost:5601
    var.input.azure_event_hubs.decorate_events: true <a id="CO11-1"></a><i class="conum" data-value="1"></i>
    var.input.azure_event_hubs.threads: 9 <a id="CO11-2"></a><i class="conum" data-value="2"></i>
    var.input.azure_event_hubs.consumer_group: "logstash"
    var.input.azure_event_hubs.storage_connection: "DefaultEndpointsProtocol=https;AccountName=instance1..."
    var.input.azure_event_hubs.event_hubs:
      - ["name",                                    "initial_position",  "storage_container",  "decorate_events",  "event_hub_connection"]                                   <a id="CO11-3"></a><i class="conum" data-value="3"></i>
      - ["insights-operational-logs",                 "TAIL",              "activity-logs1",    "true",             "Endpoint=sb://...EntityPath=insights-operational-logs"]
      - ["insights-operational-logs",                 "TAIL",              "activity_logs2",  "true",             "Endpoint=sb://...EntityPath=insights-operational-logs"]   <a id="CO11-4"></a><i class="conum" data-value="4"></i>
      - ["insights-metrics-pt1m",                     "TAIL",              "dbmetrics",         "true",             "Endpoint=sb://...EntityPath=insights-metrics-pt1m"]
      - ["insights-logs-blocks",                      "TAIL",              "dbblocks",          "true",             "Endpoint=sb://...EntityPath=insights-logs-blocks"]
      - ["insights-logs-databasewaitstatistics",      "TAIL",              "dbwaitstats",       "false",            "Endpoint=sb://...EntityPath=insights-logs-databasewaitstatistics"]
      - ["insights-logs-errors",                      "HEAD",              "dberrors",          "true",             "Endpoint=sb://...EntityPath=insights-logs-errors"
      - ["insights-logs-querystoreruntimestatistics", "TAIL",              "dbstoreruntime",    "true",             "Endpoint=sb://...EntityPath=insights-logs-querystoreruntimestatistics"]
      - ["insights-logs-querystorewaitstatistics",    "TAIL",              "dbstorewaitstats",  "true",             "Endpoint=sb://...EntityPath=insights-logs-querystorewaitstatistics"]
      - ["insights-logs-timeouts",                    "TAIL",              "dbtimeouts",        "true",             "Endpoint=sb://...EntityPath=insights-logs-timeouts"]</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>You can specify global Event Hub options. They will be overridden by any configurations specified in the event_hubs option.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>See <a class="xref" href="azure-module.html#azure_best_practices" title="Best practices">Best practices</a> for guidelines on choosing an appropriate number of threads.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The header array must be defined with name in the first position. Other options can be defined in any order. The per Event Hub configuration takes precedence. Any values not defined per Event Hub use the global config value.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>This enables consuming from a second Activity Logs Event Hub that uses a different Blob Storage container. This is necessary to avoid the offsets from the first insights-operational-logs from overwriting the offsets for the second insights-operational-logs.</p>
</td>
</tr>
</table>
</div>
<p>The advanced configuration doesn&#8217;t require a prefix before a per Event Hub
configuration option. Notice the notation for the <code class="literal">initial_position</code> option.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="scaling-blob"></a>Scale Event Hub consumption<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>An <a href="https://azure.microsoft.com/en-us/services/storage/blobs" class="ulink" target="_top">Azure Blob Storage
account</a> is an essential part of Azure-to-Logstash configuration.
It is required for users who want to scale out multiple Logstash instances to consume from Event Hubs.</p>
<p>A Blob Storage account is a central location that enables multiple instances of
Logstash to work together to process events. It records the
offset (location) of processed events. On restart, Logstash resumes processing
exactly where it left off.</p>
<p>Configuration notes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A Blob Storage account is highly recommended for use with this module, and is
likely required for production servers.
</li>
<li class="listitem">
The <code class="literal">storage_connection</code> option passes the blob storage connection string.
</li>
<li class="listitem">
Configure all Logstash instances to use the same <code class="literal">storage_connection</code> to get the
benefits of shared processing.
</li>
</ul>
</div>
<p>Sample Blob Storage connection string:</p>
<div class="pre_wrapper lang-text">
<pre class="programlisting prettyprint lang-text">DefaultEndpointsProtocol=https;AccountName=logstash;AccountKey=ETOPnkd/hDAWidkEpPZDiXffQPku/SZdXhPSLnfqdRTalssdEuPkZwIcouzXjCLb/xPZjzhmHfwRCGo0SBSw==;EndpointSuffix=core.windows.net</pre>
</div>
<p>Find the connection string to Blob Storage here:
<a href="https://portal.azure.com" class="ulink" target="_top">Azure Portal</a><code class="literal">-&gt; Blob Storage account -&gt; Access keys</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_best_practices"></a>Best practices<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>Here are some guidelines to help you achieve a successful deployment, and avoid
data conflicts that can cause lost events.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Create a Logstash consumer group.</strong></span>
Create a new consumer group specifically for Logstash. Do not use the $default or
any other consumer group that might already be in use. Reusing consumer groups
among non-related consumers can cause unexpected behavior and possibly lost
events. All Logstash instances should use the same consumer group so that they can
work together for processing events.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Avoid overwriting offset with multiple Event Hubs.</strong></span>
The offsets (position) of the Event Hubs are stored in the configured Azure Blob
store. The Azure Blob store uses paths like a file system to store the offsets.
If the paths between multiple Event Hubs overlap, then the offsets may be stored
incorrectly.
To avoid duplicate file paths, use the advanced configuration model and make
sure that at least one of these options is different per Event Hub:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
storage_connection
</li>
<li class="listitem">
storage_container (defaults to Event Hub name if not defined)
</li>
<li class="listitem">
consumer_group
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Set number of threads correctly.</strong></span>
The number of threads should equal the number of Event Hubs plus one (or more).
Each Event Hub needs at least one thread. An additional thread is needed to help
coordinate the other threads. The number of threads should not exceed the number of Event Hubs multiplied by the
number of partitions per Event Hub plus one. Threads are
currently  available only as a global setting.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Sample: Event Hubs = 4. Partitions on each Event Hub = 3.
Minimum threads is 5 (4 Event Hubs plus one). Maximum threads is 13 (4 Event
Hubs times 3 partitions plus one).
</li>
<li class="listitem">
If you&#8217;re collecting activity logs from only one specified event hub instance,
then only 2 threads (1 Event Hub plus one) are required.
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="azure-module-setup"></a>Set up and run the module<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<p>Be sure that the <code class="literal">logstash.yml</code> file is <a class="xref" href="azure-module.html#configuring-azure" title="Configure the module">configured correctly</a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_first_time_setup"></a>First time setup<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>Run this command from the Logstash directory:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/logstash --setup</pre>
</div>
<p>The <code class="literal">--modules azure</code> option starts a Logstash pipeline for ingestion from Azure
Event Hubs. The <code class="literal">--setup</code> option creates an <code class="literal">azure-*</code> index pattern in
Elasticsearch and imports Kibana dashboards and visualizations.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_subsequent_starts"></a>Subsequent starts<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>Run this command from the Logstash directory:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/logstash</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">--setup</code> option is intended only for first-time setup. If you include
<code class="literal">--setup</code> on subsequent runs, your existing Kibana dashboards will be
overwritten.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="exploring-data-azure"></a>Explore your data<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<p>When the Logstash Azure module starts receiving events, you can begin using the
packaged Kibana dashboards to explore and visualize your data.</p>
<p>To explore your data with Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open a browser to <a href="http://localhost:5601" class="ulink" target="_top">http://localhost:5601</a> (username:
"elastic"; password: "YOUR_PASSWORD")
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Dashboard</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>[Azure Monitor] Overview</strong></span>.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="azure_config_options"></a>Configuration options<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>All Event Hubs options are common to both basic and advanced
configurations, with the following exceptions. The basic configuration uses
<code class="literal">event_hub_connections</code> to support multiple connections. The advanced
configuration uses <code class="literal">event_hubs</code> and <code class="literal">event_hub_connection</code> (singular).</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_event_hubs"></a><code class="literal">event_hubs</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#array" title="Array">array</a>
</li>
<li class="listitem">
No default value
</li>
<li class="listitem">
Ignored for basic and command line configuration
</li>
<li class="listitem">
Required for advanced configuration
</li>
</ul>
</div>
<p>Defines the per Event Hubs configuration for the <a class="xref" href="azure-module.html#adv-config-sample" title="Advanced configuration sample">advanced configuration</a>.</p>
<p>The advanced configuration uses <code class="literal">event_hub_connection</code> instead of <code class="literal">event_hub_connections</code>.
The <code class="literal">event_hub_connection</code> option is defined per Event Hub.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_event_hub_connections"></a><code class="literal">event_hub_connections</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#array" title="Array">array</a>
</li>
<li class="listitem">
No default value
</li>
<li class="listitem">
Required for basic and command line configuration
</li>
<li class="listitem">
Ignored for advanced configuration
</li>
</ul>
</div>
<p>List of connection strings that identifies the Event Hubs to be read. Connection
strings include the EntityPath for the Event Hub.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_checkpoint_interval"></a><code class="literal">checkpoint_interval</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#number" title="Number">number</a>
</li>
<li class="listitem">
Default value is <code class="literal">5</code> seconds
</li>
<li class="listitem">
Set to <code class="literal">0</code> to disable.
</li>
</ul>
</div>
<p>Interval in seconds to write checkpoints during batch processing. Checkpoints
tell Logstash where to resume processing after a restart. Checkpoints are
automatically written at the end of each batch, regardless of this setting.</p>
<p>Writing checkpoints too frequently can slow down processing unnecessarily.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_consumer_group"></a><code class="literal">consumer_group</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is <code class="literal">$Default</code>
</li>
</ul>
</div>
<p>Consumer group used to read the Event Hub(s). Create a consumer group
specifically for Logstash. Then ensure that all instances of Logstash use that
consumer group so that they can work together properly.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_decorate_events"></a><code class="literal">decorate_events</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#boolean" title="Boolean">boolean</a>
</li>
<li class="listitem">
Default value is <code class="literal">false</code>
</li>
</ul>
</div>
<p>Adds metadata about the Event Hub, including <code class="literal">Event Hub name</code>, <code class="literal">consumer_group</code>,
<code class="literal">processor_host</code>, <code class="literal">partition</code>, <code class="literal">offset</code>, <code class="literal">sequence</code>, <code class="literal">timestamp</code>, and <code class="literal">event_size</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_initial_position"></a><code class="literal">initial_position</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Valid arguments are <code class="literal">beginning</code>, <code class="literal">end</code>, <code class="literal">look_back</code>
</li>
<li class="listitem">
Default value is <code class="literal">beginning</code>
</li>
</ul>
</div>
<p>When first reading from an Event Hub, start from this position:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">beginning</code> reads all pre-existing events in the Event Hub
</li>
<li class="listitem">
<code class="literal">end</code> does not read any pre-existing events in the Event Hub
</li>
<li class="listitem">
<code class="literal">look_back</code> reads <code class="literal">end</code> minus a number of seconds worth of pre-existing events.
You control the number of seconds using the <code class="literal">initial_position_look_back</code> option.
</li>
</ul>
</div>
<p>If <code class="literal">storage_connection</code> is set, the <code class="literal">initial_position</code> value is used only
the first time Logstash reads from the Event Hub.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_initial_position_look_back"></a><code class="literal">initial_position_look_back</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#number" title="Number">number</a>
</li>
<li class="listitem">
Default value is <code class="literal">86400</code>
</li>
<li class="listitem">
Used only if <code class="literal">initial_position</code> is set to <code class="literal">look-back</code>
</li>
</ul>
</div>
<p>Number of seconds to look back to find the initial position for pre-existing
events. This option is used only if <code class="literal">initial_position</code> is set to <code class="literal">look_back</code>. If
<code class="literal">storage_connection</code> is set, this configuration applies only the first time Logstash
reads from the Event Hub.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_max_batch_size"></a><code class="literal">max_batch_size</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#number" title="Number">number</a>
</li>
<li class="listitem">
Default value is <code class="literal">125</code>
</li>
</ul>
</div>
<p>Maximum number of events retrieved and processed together. A checkpoint is
created after each batch. Increasing this value may help with performance, but
requires more memory.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_storage_connection"></a><code class="literal">storage_connection</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
No default value
</li>
</ul>
</div>
<p>Connection string for blob account storage. Blob account storage persists the
offsets between restarts, and ensures that multiple instances of Logstash
process different partitions.
When this value is set, restarts resume where processing left off.
When this value is not set, the <code class="literal">initial_position</code> value is used on every restart.</p>
<p>We strongly recommend that you define this value for production environments.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_storage_container"></a><code class="literal">storage_container</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Defaults to the Event Hub name if not defined
</li>
</ul>
</div>
<p>Name of the storage container used to persist offsets and allow multiple instances of Logstash
to work together.</p>
<p>To avoid overwriting offsets, you can use different storage containers. This is
particularly important if you are monitoring two Event Hubs with the same name.
You can use the advanced configuration model to configure different storage
containers.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="azure_threads"></a><code class="literal">threads</code><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#number" title="Number">number</a>
</li>
<li class="listitem">
Minimum value is <code class="literal">2</code>
</li>
<li class="listitem">
Default value is <code class="literal">4</code>
</li>
</ul>
</div>
<p>Total number of threads used to process events. The value you set here applies
to all Event Hubs. Even with advanced configuration, this value is a global
setting, and can&#8217;t be set per event hub.</p>
<p>The number of threads should be the number of Event Hubs plus one or more.
See <a class="xref" href="azure-module.html#azure_best_practices" title="Best practices">Best practices</a> for more information.</p>
<p><span class="strong strong"><strong>Common options</strong></span></p>
<p>The following configuration options are supported by all modules:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.elasticsearch.hosts</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#uri" title="URI">uri</a>
</li>
<li class="listitem">
Default value is "localhost:9200"
</li>
</ul>
</div>
<p>Sets the host(s) of the Elasticsearch cluster. For each host, you must specify
the hostname and port. For example, "myhost:9200". If given an <a class="xref" href="configuration-file-structure.html#array" title="Array">array</a>,
Logstash will load balance requests across the hosts specified in the hosts
parameter. It is important to exclude <a href="/guide/en/elasticsearch/reference/6.5/modules-node.html" class="ulink" target="_top">dedicated master
nodes</a> from the hosts list to prevent Logstash from sending bulk requests to the
master nodes. So this parameter should only reference either data or client
nodes in Elasticsearch.</p>
<p>Any special characters present in the URLs here MUST be URL escaped! This means #
should be put in as %23 for instance.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.elasticsearch.username</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is "elastic"
</li>
</ul>
</div>
<p>The username to authenticate to a secure Elasticsearch cluster.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.elasticsearch.password</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is "changeme"
</li>
</ul>
</div>
<p>The password to authenticate to a secure Elasticsearch cluster.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.elasticsearch.ssl.enabled</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#boolean" title="Boolean">boolean</a>
</li>
<li class="listitem">
There is no default value for this setting.
</li>
</ul>
</div>
<p>Enable SSL/TLS secured communication to the Elasticsearch cluster. Leaving this
unspecified will use whatever scheme is specified in the URLs listed in <code class="literal">hosts</code>.
If no explicit protocol is specified, plain HTTP will be used. If SSL is
explicitly disabled here, the plugin will refuse to start if an HTTPS URL is
given in hosts.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.elasticsearch.ssl.verification_mode</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is "strict"
</li>
</ul>
</div>
<p>The hostname verification setting when communicating with Elasticsearch. Set to
<code class="literal">disable</code> to turn off hostname verification. Disabling this has serious security
concerns.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.elasticsearch.ssl.certificate_authority</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
There is no default value for this setting
</li>
</ul>
</div>
<p>The path to an X.509 certificate to use to validate SSL certificates when
communicating with Elasticsearch.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.elasticsearch.ssl.certificate</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
There is no default value for this setting
</li>
</ul>
</div>
<p>The path to an X.509 certificate to use for client authentication when
communicating with Elasticsearch.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.elasticsearch.ssl.key</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
There is no default value for this setting
</li>
</ul>
</div>
<p>The path to the certificate key for client authentication when communicating
with Elasticsearch.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.host</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is "localhost:5601"
</li>
</ul>
</div>
<p>Sets the hostname and port of the Kibana instance to use for importing
dashboards and visualizations. For example: "myhost:5601".</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.scheme</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is "http"
</li>
</ul>
</div>
<p>Sets the protocol to use for reaching the Kibana instance. The options are:
"http" or "https". The default is "http".</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.username</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is "elastic"
</li>
</ul>
</div>
<p>The username to authenticate to a secured Kibana instance.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.password</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is "changeme"
</li>
</ul>
</div>
<p>The password to authenticate to a secure Kibana instance.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.ssl.enabled</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#boolean" title="Boolean">boolean</a>
</li>
<li class="listitem">
Default value is false
</li>
</ul>
</div>
<p>Enable SSL/TLS secured communication to the Kibana instance.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.ssl.verification_mode</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
Default value is "strict"
</li>
</ul>
</div>
<p>The hostname verification setting when communicating with Kibana. Set to
<code class="literal">disable</code> to turn off hostname verification. Disabling this has serious security
concerns.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.ssl.certificate_authority</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
There is no default value for this setting
</li>
</ul>
</div>
<p>The path to an X.509 certificate to use to validate SSL certificates when
communicating with Kibana.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.ssl.certificate</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
There is no default value for this setting
</li>
</ul>
</div>
<p>The path to an X.509 certificate to use for client authentication when
communicating with Kibana.</p>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.kibana.ssl.key</code></strong></span>
</span>
</dt>
<dd>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Value type is <a class="xref" href="configuration-file-structure.html#string" title="String">string</a>
</li>
<li class="listitem">
There is no default value for this setting
</li>
</ul>
</div>
<p>The path to the certificate key for client authentication when communicating
with Kibana.</p>
</dd>
</dl>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_azure_module_schema"></a>Azure module schema<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<p>This module reads data from the Azure Event Hub and adds some additional structure to the data for Activity Logs and SQL Diagnostics. The original data is always preserved and any data added or parsed will be namespaced under <em>azure</em>. For example, <em>azure.subscription</em> may have been parsed from a longer more complex URN.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
<th align="left" valign="top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>azure.subscription</p></td>
<td align="left" valign="top"><p>Azure subscription from which this data originates.</p></td>
<td align="left" valign="top"><p>Some Activity Log events may not be associated with a subscription.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.group</p></td>
<td align="left" valign="top"><p>Primary type of data.</p></td>
<td align="left" valign="top"><p>Current values are either <em>activity_log</em> or <em>sql_diagnostics</em></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.category*</p></td>
<td align="left" valign="top"><p>Secondary type of data specific to group from which the data originated</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.provider</p></td>
<td align="left" valign="top"><p>Azure provider</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.resource_group</p></td>
<td align="left" valign="top"><p>Azure resource group</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.resource_type</p></td>
<td align="left" valign="top"><p>Azure resource type</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.resource_name</p></td>
<td align="left" valign="top"><p>Azure resource name</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.database</p></td>
<td align="left" valign="top"><p>Azure database name, for display purposes</p></td>
<td align="left" valign="top"><p>SQL Diagnostics only</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.db_unique_id</p></td>
<td align="left" valign="top"><p>Azure database name that is guaranteed to be unique</p></td>
<td align="left" valign="top"><p>SQL Diagnostics only</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.server</p></td>
<td align="left" valign="top"><p>Azure server for the database</p></td>
<td align="left" valign="top"><p>SQL Diagnostics only</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>azure.server_and_database</p></td>
<td align="left" valign="top"><p>Azure server and database combined</p></td>
<td align="left" valign="top"><p>SQL Diagnostics only</p></td>
</tr>
</tbody>
</table>
</div>
<p>Notes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Activity Logs can have the following categories: Administrative, ServiceHealth, Alert, Autoscale, Security
</li>
<li class="listitem">
SQL Diagnostics can have the following categories: Metric, Blocks, Errors, Timeouts, QueryStoreRuntimeStatistics, QueryStoreWaitStatistics, DatabaseWaitStatistics, SQLInsights
</li>
</ul>
</div>
<p>Microsoft documents Activity log schema
<a href="https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-activity-log-schema" class="ulink" target="_top">here</a>.
The SQL Diagnostics data is documented
<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-metrics-diag-logging" class="ulink" target="_top">here</a>.
Elastic does not own these data models, and as such, cannot make any
assurances of information accuracy or passivity.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_special_note_properties_field"></a>Special note - Properties field<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h4>
</div></div></div>
<p>Many of the logs contain a <code class="literal">properties</code> top level field. This is often where the
most interesting data lives. There is not a fixed schema between log types for
properties fields coming from different sources.</p>
<p>For example, one log may have
<code class="literal">properties.type</code> where one log sets this a String type and another sets this an
Integer type. To avoid mapping errors, the original properties field is moved to
<code class="literal">&lt;azure.group&gt;_&lt;azure_category&gt;_properties.&lt;original_key&gt;</code>.
For example
<code class="literal">properties.type</code> may end up as <code class="literal">sql_diagnostics_Errors_properties.type</code> or
<code class="literal">activity_log_Security_properties.type</code> depending on the group/category where
the event originated.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="azure-production"></a>Deploying the module in production<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<p>Use security best practices to secure your configuration.
See <a href="/guide/en/elasticsearch/reference/6.5/secure-cluster.html" class="ulink" target="_top">Secure a cluster</a> for details and recommendations.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="azure-resources"></a>Microsoft Azure resources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/azure-module.asciidoc">edit</a></h3>
</div></div></div>
<p>Microsoft is the best source for the most up-to-date Azure information.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-azure-monitor" class="ulink" target="_top">Overview of Azure Monitor</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-metrics-diag-logging" class="ulink" target="_top">Azure SQL Database metrics and diagnostics logging</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-stream-activity-logs-event-hubs" class="ulink" target="_top">Stream the Azure Activity Log to Event Hubs</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="netflow-module.html">« Logstash Netflow Module</a>
</span>
<span class="next">
<a href="filebeat-modules.html">Working with Filebeat Modules »</a>
</span>
</div>
</div>
</body>
</html>
