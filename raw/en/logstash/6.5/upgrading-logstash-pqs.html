<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upgrading with the Persistent Queue Enabled | Logstash Reference [6.5] | Elastic</title>
<link rel="home" href="index.html" title="Logstash Reference [6.5]"/>
<link rel="up" href="upgrading-logstash.html" title="Upgrading Logstash"/>
<link rel="prev" href="upgrading-logstash-6.0.html" title="Upgrading Logstash to 6.0"/>
<link rel="next" href="configuration.html" title="Configuring Logstash"/>
<meta name="DC.type" content="Learn/Docs/Logstash/Reference/6.5"/>
<meta name="DC.subject" content="Logstash"/>
<meta name="DC.identifier" content="6.5"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Logstash Reference [6.5]</a></span>
»
<span class="breadcrumb-link"><a href="upgrading-logstash.html">Upgrading Logstash</a></span>
»
<span class="breadcrumb-node">Upgrading with the Persistent Queue Enabled</span>
</div>
<div class="navheader">
<span class="prev">
<a href="upgrading-logstash-6.0.html">« Upgrading Logstash to 6.0</a>
</span>
<span class="next">
<a href="configuration.html">Configuring Logstash »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="upgrading-logstash-pqs"></a>Upgrading with the Persistent Queue Enabled<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/upgrading.asciidoc">edit</a></h2>
</div></div></div>
<p>The following applies only if you are upgrading from Logstash version 6.2.x or
earlier with the persistent queue enabled.</p>
<p>We regret to say that due to several serialization issues in Logstash 6.2.x and
earlier, users will have to take some extra steps when upgrading Logstash with
the persistent queue enabled. While we strive to maintain backward compatibility
within a given major release, these bugs require us to break that compatibility
in version 6.3.0 to ensure correctness of operation. For more technical details
on this issue, please check our tracking github issue for this matter,
<a href="https://github.com/elastic/logstash/issues/9494" class="ulink" target="_top">#9494</a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="drain-pq"></a>Drain the Persistent Queue<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/6.5/docs/static/upgrading.asciidoc">edit</a></h3>
</div></div></div>
<p>If you use the persistent queue, we strongly recommend that you drain or delete
it before you upgrade.</p>
<p>To drain the queue:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In the logstash.yml file, set <code class="literal">queue.drain:true</code>.
</li>
<li class="listitem">
Restart Logstash for this setting to take effect.
</li>
<li class="listitem">
Shutdown Logstash (using CTRL+C or SIGTERM), and wait for the queue to empty.
</li>
</ol>
</div>
<p>When the queue is empty:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Complete the upgrade.
</li>
<li class="listitem">
Restart Logstash.
</li>
</ol>
</div>
<p>We are working to resolve issues with data incompatibilities so that these steps
won’t be required for future upgrades.</p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="upgrading-logstash-6.0.html">« Upgrading Logstash to 6.0</a>
</span>
<span class="next">
<a href="configuration.html">Configuring Logstash »</a>
</span>
</div>
</div>
</body>
</html>
