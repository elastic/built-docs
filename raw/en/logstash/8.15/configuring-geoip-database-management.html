<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configure GeoIP Database Management | Logstash Reference [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Configure GeoIP Database Management | Logstash Reference [8.15]">

<link rel="home" href="index.html" title="Logstash Reference [8.15]"/>
<link rel="up" href="geoip-database-management.html" title="Managing GeoIP Databases"/>
<link rel="prev" href="logstash-geoip-database-management.html" title="GeoIP Database Management"/>
<link rel="next" href="performance-tuning.html" title="Performance tuning"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Logstash"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Logstash/Reference/8.15"/>
<meta name="DC.subject" content="Logstash"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="logstash-geoip-database-management.html">« GeoIP Database Management</a>
</span>
<span class="next">
<a href="performance-tuning.html">Performance tuning »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Logstash Reference [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="geoip-database-management.html">Managing GeoIP Databases</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configure GeoIP Database Management</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/8.15/docs/static/geoip-database-management/configuring.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuring-geoip-database-management"></a>Configure GeoIP Database Management<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/8.15/docs/static/geoip-database-management/configuring.asciidoc">edit</a></h2>
</div></div></div>
<p>To configure
<a class="xref" href="logstash-geoip-database-management.html" title="GeoIP Database Management">GeoIP Database Management</a>:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Verify that you are using a license that includes the geoip database management
feature.</p>
<p>For more information, see <a href="/subscriptions" class="ulink" target="_top">https://www.elastic.co/subscriptions</a> and
<a href="/guide/en/kibana/8.15/managing-licenses.html" class="ulink" target="_top">License management</a>.</p>
</li>
<li class="listitem">
Specify
<a class="xref" href="configuring-geoip-database-management.html#geoip-database-management-settings" title="GeoIP database Management settings in Logstash">geoip database management settings</a> in the
<code class="literal">logstash.yml</code> file to tune the configuration as-needed.
</li>
</ol>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h3 class="title"><a id="geoip-database-management-settings"></a>GeoIP database Management settings in Logstash<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/8.15/docs/static/settings/geoip-database-management-settings.asciidoc">edit</a></h3>
</div></div></div>

<p>You can set the following <code class="literal">xpack.geoip</code> settings in <code class="literal">logstash.yml</code> to configure the <a class="xref" href="logstash-geoip-database-management.html" title="GeoIP Database Management">geoip database manager</a>.
For more information about configuring Logstash, see <a class="xref" href="logstash-settings-file.html" title="logstash.yml">logstash.yml</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">xpack.geoip.downloader.enabled</code>
</span>
</dt>
<dd>
(Boolean) If <code class="literal">true</code>, Logstash automatically downloads and manages updates for GeoIP2 databases from the <code class="literal">xpack.geoip.downloader.endpoint</code>.
If <code class="literal">false</code>, Logstash does not manage GeoIP2 databases and plugins that need a GeoIP2 database must be configured to provide their own.
</dd>
<dt>
<span class="term">
<code class="literal">xpack.geoip.downloader.endpoint</code>
</span>
</dt>
<dd>
(String) Endpoint URL used to download updates for GeoIP2 databases.
For example, <code class="literal">https://mydomain.com/overview.json</code>.
Defaults to <code class="literal">https://geoip.elastic.co/v1/database</code>.
Note that Logstash will periodically make a GET request to <code class="literal">${xpack.geoip.downloader.endpoint}?elastic_geoip_service_tos=agree</code>, expecting the list of metadata about databases typically found in <code class="literal">overview.json</code>.
</dd>
<dt>
<span class="term">
<code class="literal">xpack.geoip.downloader.poll.interval</code>
</span>
</dt>
<dd>
(Time Value) How often Logstash checks for GeoIP2 database updates at the <code class="literal">xpack.geoip.downloader.endpoint</code>.
For example, <code class="literal">6h</code> to check every six hours.
Defaults to <code class="literal">24h</code> (24 hours).
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="configuring-geoip-database-management-offline"></a>Offline and air-gapped environments<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/8.15/docs/static/geoip-database-management/configuring.asciidoc">edit</a></h3>
</div></div></div>
<p>If Logstash does not have access to the internet, or if you want to disable the database manager, set the <code class="literal">xpack.geoip.downloader.enabled</code> value to <code class="literal">false</code> in <code class="literal">logstash.yml</code>.
When the database manager is disabled, plugins that require GeoIP lookups must be configured with their own source of GeoIP databases.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_using_an_http_proxy"></a>Using an HTTP proxy<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/8.15/docs/static/geoip-database-management/configuring.asciidoc">edit</a></h4>
</div></div></div>
<p>If you can&#8217;t connect directly to the Elastic GeoIP endpoint, consider setting up an HTTP proxy server.
You can then specify the proxy with <code class="literal">http_proxy</code> environment variable.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">export http_proxy="http://PROXY_IP:PROXY_PORT"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_using_a_custom_endpoint"></a>Using a custom endpoint<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/logstash/edit/8.15/docs/static/geoip-database-management/configuring.asciidoc">edit</a></h4>
</div></div></div>
<p>If you work in an air-gapped environment and can&#8217;t update your databases from the Elastic endpoint,
You can then download databases from MaxMind and bootstrap the service.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download both <code class="literal">GeoLite2-ASN.mmdb</code> and <code class="literal">GeoLite2-City.mmdb</code> database files from the
<a href="http://dev.maxmind.com/geoip/geoip2/geolite2" class="ulink" target="_top">MaxMind site</a>.
</li>
<li class="listitem">
Copy both database files to a single directory.
</li>
<li class="listitem">
<a href="/downloads/elasticsearch" class="ulink" target="_top">Download Elasticsearch</a>.
</li>
<li class="listitem">
<p>From your Elasticsearch directory, run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">./bin/elasticsearch-geoip -s my/database/dir</pre>
</div>
</li>
<li class="listitem">
<p>Serve the static database files from your directory. For example, you can use
Docker to serve the files from nginx server:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run -p 8080:80 -v my/database/dir:/usr/share/nginx/html:ro nginx</pre>
</div>
</li>
<li class="listitem">
Specify the service&#8217;s endpoint URL in Logstash using the
<code class="literal">xpack.geoip.download.endpoint=http://localhost:8080/overview.json</code> setting in <code class="literal">logstash.yml</code>.
</li>
</ol>
</div>
<p>Logstash gets automatic updates from this service.</p>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="logstash-geoip-database-management.html">« GeoIP Database Management</a>
</span>
<span class="next">
<a href="performance-tuning.html">Performance tuning »</a>
</span>
</div>
</body>
</html>
