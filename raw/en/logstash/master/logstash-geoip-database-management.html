<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GeoIP Database Management | Logstash Reference [master] | Elastic</title>
<meta class="elastic" name="content" content="GeoIP Database Management | Logstash Reference [master]">

<link rel="home" href="index.html" title="Logstash Reference [master]"/>
<link rel="up" href="geoip-database-management.html" title="Managing GeoIP Databases"/>
<link rel="prev" href="geoip-database-management.html" title="Managing GeoIP Databases"/>
<link rel="next" href="configuring-geoip-database-management.html" title="Configure GeoIP Database Management"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Logstash"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Logstash/Reference/master"/>
<meta name="DC.subject" content="Logstash"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="geoip-database-management.html">« Managing GeoIP Databases</a>
</span>
<span class="next">
<a href="configuring-geoip-database-management.html">Configure GeoIP Database Management »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Logstash Reference [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="geoip-database-management.html">Managing GeoIP Databases</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>GeoIP Database Management</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/main/docs/static/geoip-database-management/index.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="logstash-geoip-database-management"></a>GeoIP Database Management<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/main/docs/static/geoip-database-management/index.asciidoc">edit</a></h2>
</div></div></div>
<p>Logstash provides a mechanism for provisioning and maintaining GeoIP databases, which plugins can use to ensure that they have access to an always-up-to-date and EULA-compliant database for geo enrichment.
This mechanism requires internet access or a network route to an Elastic GeoIP database service.</p>
<p>If the database manager is enabled in <code class="literal">logstash.yml</code> (as it is by default), a plugin may subscribe to a database, triggering a download if a valid database is not already available.
Logstash checks for updates every day.
When an updated database is discovered, it is downloaded in the background and made available to the plugins that rely on it.</p>
<p>The GeoIP databases are separately-licensed from MaxMind under the terms of an End User License Agreement, which prohibits a database from being used after an update has been available for more than 30 days.
When Logstash cannot reach the database service for 30 days or more to validate that a managed database is up-to-date, that database is deleted and made unavailable to the plugins that subscribed to it.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>GeoIP database management is a licensed feature of Logstash, and is only available in the Elastic-licensed complete distribution of Logstash.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="logstash-geoip-database-management-metrics"></a>Database Metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/logstash/edit/main/docs/static/geoip-database-management/metrics.asciidoc">edit</a></h3>
</div></div></div>
<p>You can monitor the managed database&#8217;s status through the <a class="xref" href="node-stats-api.html" title="Node Stats API">Node Stats API</a>.</p>
<p>The following request returns a JSON document containing database manager stats,
including:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>database status and freshness</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">geoip_download_manager.database.*.status</code></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">init</code> : initial CC database status
</li>
<li class="listitem">
<code class="literal">up_to_date</code> : using up-to-date EULA database
</li>
<li class="listitem">
<code class="literal">to_be_expired</code> : 25 days without calling service
</li>
<li class="listitem">
<code class="literal">expired</code> : 30 days without calling service
</li>
</ul>
</div>
</li>
<li class="listitem">
<code class="literal">fail_check_in_days</code> : number of days Logstash fails to call service since the last success
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>info about download successes and failures</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">geoip_download_manager.download_stats.successes</code> number of successful checks and downloads
</li>
<li class="listitem">
<code class="literal">geoip_download_manager.download_stats.failures</code> number of failed check or download
</li>
<li class="listitem">
<p><code class="literal">geoip_download_manager.download_stats.status</code></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">updating</code> : check and download at the moment
</li>
<li class="listitem">
<code class="literal">succeeded</code> : last download succeed
</li>
<li class="listitem">
<code class="literal">failed</code> : last download failed
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">curl -XGET 'localhost:9600/_node/stats/geoip_download_manager?pretty'</pre>
</div>
<p>Example response:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">{
  "geoip_download_manager" : {
    "database" : {
      "ASN" : {
        "status" : "up_to_date",
        "fail_check_in_days" : 0,
        "last_updated_at": "2021-06-21T16:06:54+02:00"
      },
      "City" : {
        "status" : "up_to_date",
        "fail_check_in_days" : 0,
        "last_updated_at": "2021-06-21T16:06:54+02:00"
      }
    },
    "download_stats" : {
      "successes" : 15,
      "failures" : 1,
      "last_checked_at" : "2021-06-21T16:07:03+02:00",
      "status" : "succeeded"
    }
  }
}</pre>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="geoip-database-management.html">« Managing GeoIP Databases</a>
</span>
<span class="next">
<a href="configuring-geoip-database-management.html">Configure GeoIP Database Management »</a>
</span>
</div>
</body>
</html>
