<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Creating single metric jobs | Machine Learning in the Elastic Stack [7.0] | Elastic</title>
<link rel="home" href="index.html" title="Machine Learning in the Elastic Stack [7.0]"/>
<link rel="up" href="ml-getting-started.html" title="Tutorial: Getting started with machine learning"/>
<link rel="prev" href="ml-gs-wizards.html" title="Creating jobs in Kibana"/>
<link rel="next" href="ml-gs-job1-manage.html" title="Managing jobs"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Machine learning/7.0"/>
<meta name="DC.subject" content="Machine learning"/>
<meta name="DC.identifier" content="7.0"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Machine Learning in the Elastic Stack [7.0]</a></span>
»
<span class="breadcrumb-link"><a href="ml-getting-started.html">Tutorial: Getting started with machine learning</a></span>
»
<span class="breadcrumb-node">Creating single metric jobs</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-gs-wizards.html">« Creating jobs in Kibana</a>
</span>
<span class="next">
<a href="ml-gs-job1-manage.html">Managing jobs »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-gs-jobs"></a>Creating single metric jobs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/stack-docs/edit/7.0/docs/en/stack/ml/anomaly-detection/getting-started-single.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>At this point in the tutorial, the goal is to detect anomalies in the
total requests received by your applications and services. The sample data
contains a single key performance indicator(KPI) to track this, which is the total
requests over time. It is therefore logical to start by creating a single metric
job for this KPI.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are using aggregated data, you can create an advanced job
and configure it to use a <code class="literal">summary_count_field_name</code>. The machine learning algorithms will
make the best possible use of summarized data in this case. For simplicity, in
this tutorial we will not make use of that advanced functionality. For more
information, see <a class="xref" href="ml-configuring-aggregation.html" title="Aggregating data for faster performance">Aggregating data for faster performance</a>.</p>
</div>
</div>
<p>A single metric job contains a single <em>detector</em>. A detector defines the type of
analysis that will occur (for example, <code class="literal">max</code>, <code class="literal">average</code>, or <code class="literal">rare</code> analytical
functions) and the fields that will be analyzed.</p>
<p>To create a single metric job in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana in your web browser. If you are running Kibana locally,
go to <code class="literal">http://localhost:5601/</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Machine Learning</strong></span> in the side navigation.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create new job</strong></span>.
</li>
<li class="listitem">
Select the index pattern that you created for the sample data.  For example,
<code class="literal">server-metrics*</code>.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Use a wizard</strong></span> section, click <span class="strong strong"><strong>Single metric</strong></span>.
</li>
<li class="listitem">
<p>Configure the job by providing the following information:<br></p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-gs-single-job.jpg" alt="Create a new job from the server-metrics index">
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>For the <span class="strong strong"><strong>Aggregation</strong></span>, select <code class="literal">Sum</code>. This value specifies the analysis
function that is used.</p>
<p>Some of the analytical functions look for single anomalous data points. For
example, <code class="literal">max</code> identifies the maximum value that is seen within a bucket.
Others perform some aggregation over the length of the bucket. For example,
<code class="literal">mean</code> calculates the mean of all the data points seen within the bucket.
Similarly, <code class="literal">count</code> calculates the total number of data points within the bucket.
In this tutorial, you are using the <code class="literal">sum</code> function, which calculates the sum of
the specified field&#8217;s values within the bucket. For descriptions of all the
functions, see <a class="xref" href="ml-functions.html" title="Function reference"><em>Function reference</em></a>.</p>
</li>
<li class="listitem">
<p>For the <span class="strong strong"><strong>Field</strong></span>, select <code class="literal">total</code>. This value specifies the field that
the detector uses in the function.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Some functions such as <code class="literal">count</code> and <code class="literal">rare</code> do not require fields.</p>
</div>
</div>
</li>
<li class="listitem">
<p>For the <span class="strong strong"><strong>Bucket span</strong></span>, enter <code class="literal">10m</code>. This value specifies the size of the
interval that the analysis is aggregated into.</p>
<p>The machine learning features use the concept of a bucket to divide up the time series
into batches for processing. For example, if you are monitoring
the total number of requests in the system,
using a bucket span of 1 hour would mean that at the end of each hour, it
calculates the sum of the requests for the last hour and computes the
anomalousness of that value compared to previous hours.</p>
<p>The bucket span has two purposes: it dictates over what time span to look for
anomalous features in data, and also determines how quickly anomalies can be
detected. Choosing a shorter bucket span enables anomalies to be detected more
quickly. However, there is a risk of being too sensitive to natural variations
or noise in the input data. Choosing too long a bucket span can mean that
interesting anomalies are averaged away. There is also the possibility that the
aggregation might smooth out some anomalies based on when the bucket starts
in time.</p>
<p>The bucket span has a significant impact on the analysis. When you&#8217;re trying to
determine what value to use, take into account the granularity at which you
want to perform the analysis, the frequency of the input data, the duration of
typical anomalies, and the frequency at which alerting is required.</p>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Determine whether you want to process all of the data or only part of it. If
you want to analyze all of the existing data, click
<span class="strong strong"><strong>Use full server-metrics* data</strong></span>. If you want to see what happens when you
stop and start datafeeds and process additional data over time, click the time
picker in the Kibana toolbar. Since the sample data spans a period of time
between March 23, 2017 and April 22, 2017, click <span class="strong strong"><strong>Absolute</strong></span>. Set the start
time to March 23, 2017 and the end time to April 1, 2017, for example. Once
you&#8217;ve got the time range set up, click the <span class="strong strong"><strong>Go</strong></span> button.<br></p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-gs-job1-time.jpg" alt="Setting the time range for the datafeed">
</div>
</div>
<p>A graph is generated, which represents the total number of requests over time.</p>
<p>Note that the <span class="strong strong"><strong>Estimate bucket span</strong></span> option is no longer greyed out in the
<span class="strong strong"><strong>Buck span</strong></span> field. This is an experimental feature that you can use to help
determine an appropriate bucket span for your data. For the purposes of this
tutorial, we will leave the bucket span at 10 minutes.</p>
</li>
<li class="listitem">
Provide a name for the job, for example <code class="literal">total-requests</code>. The job name must
be unique in your cluster. You can also optionally provide a description of the
job and create a job group.
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Create Job</strong></span>.<br></p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-gs-job1.jpg" alt="A graph of the total number of requests over time">
</div>
</div>
</li>
</ol>
</div>
<p>As the job is created, the graph is updated to give a visual representation of
the progress of machine learning as the data is processed. This view is only available whilst the
job is running.</p>
<p>When the job is created, you can choose to view the results, continue the job
in real-time, and create a watch. In this tutorial, we will look at how to
manage jobs and datafeeds before we view the results.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">create_single_metric.sh</code> script, which is included with the
<a class="xref" href="ml-gs-data.html#ml-gs-sampledata" title="Obtaining a sample data set">sample data</a>, creates a similar job and datafeed by
using the machine learning APIs. Before you run it, you must edit the USERNAME and PASSWORD
variables with your actual user ID and password. If the Elasticsearch security features
are not enabled, use the <code class="literal">create_single_metric_noauth.sh</code> script instead. For
API reference information, see <a href="/guide/en/elasticsearch/reference/7.0/ml-apis.html" class="ulink" target="_top">Machine Learning APIs</a>.</p>
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ml-gs-wizards.html">« Creating jobs in Kibana</a>
</span>
<span class="next">
<a href="ml-gs-job1-manage.html">Managing jobs »</a>
</span>
</div>
</div>
</body>
</html>
