<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Installing Marvel | Marvel Documentation [2.2] | Elastic</title>
<link rel="home" href="index.html" title="Marvel Documentation [2.2]"/>
<link rel="up" href="index.html" title="Marvel Documentation [2.2]"/>
<link rel="prev" href="getting-started.html" title="Getting Started"/>
<link rel="next" href="configuration.html" title="Configuring Marvel"/>
<meta name="DC.type" content="Learn/Docs/Legacy/Marvel/Reference/2.2"/>
<meta name="DC.subject" content="Marvel"/>
<meta name="DC.identifier" content="2.2"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
From version 5.0 onward, Marvel is part of X-Pack. For more information, see 
<a href=https://www.elastic.co/guide/en/elastic-stack-overview/current/xpack-monitoring.html>
    Monitoring the Elastic Stack</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Marvel Documentation [2.2]</a></span>
»
<span class="breadcrumb-node">Installing Marvel</span>
</div>
<div class="navheader">
<span class="prev">
<a href="getting-started.html">« Getting Started</a>
</span>
<span class="next">
<a href="configuration.html">Configuring Marvel »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="installing-marvel"></a>Installing Marvel<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h1>
</div></div></div>
<p>To use Marvel, you need to install two components:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An Elasticsearch plugin that collects data from each node in your cluster.
This plugin must be installed on every node.
</li>
<li class="listitem">
A Kibana app that provides the Marvel monitoring UI.
</li>
</ul>
</div>
<p>By default, the Marvel plugin stores data in the same Elasticsearch cluster
where it is installed. If you are monitoring a production cluster we recommend
that you store the Marvel data in a separate monitoring cluster. Sending the Marvel
data to a monitoring cluster helps ensure that you can continue to monitor your
production cluster if it&#8217;s in an unhealthy state.</p>
<p>For basic installation instructions, see <a class="xref" href="getting-started.html" title="Getting Started">Getting Started with Marvel</a>. For
information about storing Marvel data in a separate monitoring cluster, see <a class="xref" href="installing-marvel.html#monitoring-cluster" title="Setting up a Separate Monitoring Cluster">Setting up a Separate Monitoring Cluster</a>.</p>
<h3><a id="marvel-prequisites"></a>Marvel Installation Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h3>
<p>Marvel 2.2.1 requires:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elasticsearch 2.2.1.
</li>
<li class="listitem">
Kibana 4.4.0.
</li>
<li class="listitem">
A modern web browser - <a href="http://www.elastic.co/subscriptions/matrix#matrix_browsers" class="ulink" target="_top">Supported
Browsers</a>.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must run the version of Marvel that matches the version of Elasticsearch you are running.</p>
</div>
</div>
<h3><a id="package-installation"></a>Installing the Marvel Agent on a DEB/RPM Package Installation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h3>
<p>If you use the DEB/RPM packages to install Elasticsearch, by default Elasticsearch is installed in
<code class="literal">/usr/share/elasticsearch</code> and the configuration files are stored in <code class="literal">/etc/elasticsearch</code>. (For the
complete list of default paths, see <a href="/guide/en/elasticsearch/reference/2.2/setup-dir-layout.html#_deb_and_rpm" class="ulink" target="_top">Directory Layout</a> in
the Elasticsearch Reference.)</p>
<p>To install the License plugin and Marvel agent on a DEB/RPM package installation, you need to run
<code class="literal">bin/plugin install</code> from the <code class="literal">/usr/share/elasticsearch</code> directory with superuser permissions:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">cd /usr/share/elasticsearch
sudo bin/plugin install license
sudo bin/plugin install marvel-agent</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the configuration files are not in <code class="literal">/etc/elasticsearch</code> you need to specify the location of
the configuration files by including <code class="literal">-Des.path.conf</code>.</p>
</div>
</div>
<h3><a id="offline-installation"></a>Installing Marvel on Offline Machines<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h3>
<p>The Elasticsearch <code class="literal">bin/plugin</code> script and <code class="literal">bin/kibana plugin</code> require Internet access to
download and install the License and Marvel plugins. If your server doesn’t have Internet access,
you can manually download and install the plugins.</p>
<p>To install Marvel on a machine that doesn&#8217;t have Internet access:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Manually download the License and Marvel binaries:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.2.1/license-2.2.1.zip" class="ulink" target="_top">
<code class="literal">https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.2.1/license-2.2.1.zip</code></a>
(<a href="https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.2.1/license-2.2.1.zip.sha1" class="ulink" target="_top">sha1</a>)
</li>
<li class="listitem">
<a href="https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/marvel-agent/2.2.1/marvel-agent-2.2.1.zip" class="ulink" target="_top"><code class="literal">https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/marvel-agent/2.2.1/marvel-agent-2.2.1.zip</code></a> (<a href="https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/marvel-agent/2.2.1/marvel-agent-2.2.1.zip.sha1" class="ulink" target="_top">sha1</a>)
</li>
<li class="listitem">
<a href="https://download.elasticsearch.org/elasticsearch/marvel/marvel-2.2.1.tar.gz" class="ulink" target="_top">
<code class="literal">https://download.elasticsearch.org/elasticsearch/marvel/marvel-2.2.1.tar.gz</code></a> (<a href="https://download.elasticsearch.org/elasticsearch/marvel/marvel-2.2.1.tar.gz.sha1.txt" class="ulink" target="_top">sha1</a>)
</li>
</ul>
</div>
</li>
<li class="listitem">
Transfer the archive files to the offline machine.
</li>
<li class="listitem">
<p>Specify the archive files when you run <code class="literal">bin/plugin</code> and <code class="literal">bin/kibana</code>. For example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/plugin install file:///path/to/file/license-2.2.1.zip
bin/plugin install file:///path/to/file/marvel-agent-2.2.1.zip
bin/kibana plugin --install marvel --url file:///path/to/file/marvel-2.2.1.tar.gz</pre>
</div>
</li>
</ol>
</div>
<h3><a id="monitoring-cluster"></a>Setting up a Separate Monitoring Cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h3>
<p>To store Marvel data in a separate monitoring cluster:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Set up the Elasticsearch cluster you want to use for monitoring and start Elasticsearch.
For example, you might set up a two host cluster with the nodes <code class="literal">es-mon-1</code> and <code class="literal">es-mon-2</code>.
You do not need to install the Marvel agent plugin on the nodes in the monitoring cluster, only
on the production nodes you&#8217;ll be monitoring. You can configure Shield on your
monitoring cluster to protect your monitoring data. For information about how to
set up Shield, see the <a href="/guide/en/shield/current/getting-started.html" class="ulink" target="_top">Shield Reference</a>.
</li>
<li class="listitem">
<p>Configure the nodes in your production cluster to send Marvel data to your monitoring cluster by
configuring an HTTP exporter in the <code class="literal">marvel.agent.exporters</code> settings in <code class="literal">elasticsearch.yml</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">marvel.agent.exporters:
  id1:
    type: http
    host: ["http://es-mon-1:9200", "http://es-mon2:9200"]</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If Shield is enabled on the monitoring cluster, you must also configure
credentials for the agent. If SSL is enabled, you must specify the truststore to use to
verify the identity of the nodes in the monitoring cluster. For more information,
see <a href="/guide/en/shield/current/marvel.html" class="ulink" target="_top">Using Marvel with Shield</a>
in the Shield Reference.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Install the Marvel agent and License plugins on the nodes in your production cluster:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/plugin install license
bin/plugin install marvel-agent</pre>
</div>
</li>
<li class="listitem">
<p>Restart Elasticsearch on the nodes in your production cluster</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You may want to temporarily <a href="/guide/en/elasticsearch/reference/2.2/modules-cluster.html" class="ulink" target="_top">disable shard
allocation</a> before you restart your nodes to avoid unnecessary shard
reallocation during the install process.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Install the Marvel plugin into Kibana.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/kibana plugin --install elasticsearch/marvel/2.2.1</pre>
</div>
</li>
<li class="listitem">
<p>Configure Kibana to connect to your monitoring cluster by setting the <code class="literal">elasticsearch_url</code>
property in the <code class="literal">kibana.yml</code> configuration file. For example:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">elasticsearch_url: "http://es-mon-1:9200"</pre>
</div>
</li>
<li class="listitem">
Start Kibana by running <code class="literal">bin/kibana</code>.
</li>
<li class="listitem">
<p>To verify your Marvel installation, point your web browser at your Kibana host, click the App Switcher icon in the Kibana menu bar, and select Marvel.</p>
<p><span class="image"><a class="image" href="images/marvel-app-switcher.jpg"><img src="images/marvel-app-switcher.jpg" alt="Kibana App Switcher"></a></span></p>
<p>Marvel should display a list of the clusters you are monitoring.</p>
<p><span class="image"><a class="image" href="images/marvel-clusters.jpg"><img src="images/marvel-clusters.jpg" alt="Cluster Overview"></a></span></p>
</li>
</ol>
</div>
<h3><a id="using-marvel-with-shield"></a>Using Marvel with Shield<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h3>
<p>If you are using Shield to secure your Elasticsearch cluster, you need to follow the instructions
in <a href="/guide/en/shield/current/kibana.html#using-kibana4-with-shield" class="ulink" target="_top">Using
Kibana 4 with Shield</a> to set up user authentication and secure communications and then grant your
users the <code class="literal">marvel_users</code> role defined in <code class="literal">roles.yml</code>. If you are using a separate monitoring
cluster, you also need to configure credentials for the Marvel agent installed on each node of
the cluster being monitored. For more information, see <a href="/guide/en/shield/current/marvel.html" class="ulink" target="_top">
Using Marvel with Shield</a> in the Shield Reference.</p>
<h3><a id="enabling-index-creation"></a>Enabling Marvel to Create Indices<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h3>
<p>Marvel relies on Elasticsearch&#8217;s ability to automatically create new indices
when indexing documents. If you have disabled automatic index creation, you
need to configure the <code class="literal">action.auto_create_index</code> setting to allow the
creation of Marvel indices:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">action.auto_create_index: .marvel-*</pre>
</div>
<p>For more information see <a href="/guide/en/elasticsearch/reference/2.2/docs-index_.html#index-creation" class="ulink" target="_top">Index Creation</a> in the Elasticsearch
Reference.</p>
<h3><a id="upgrading"></a>Upgrading Marvel<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h3>
<p>When upgrading Marvel, you must upgrade the Marvel agent on every node you are monitoring. You
do not need to fully shut down your production cluster to perform the upgrade, you
can perform a rolling upgrade.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must run the version of Marvel that matches the version of Elasticsearch you are running. For
example, Marvel 2.2.1 requires Elasticsearch 2.2.1.</p>
</div>
</div>
<p>To upgrade Marvel:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Disable shard reallocation on the nodes you are monitoring. While this is optional,
it enables a faster startup after cluster shutdown.  If you don&#8217;t disable shard reallocation,
the nodes immediately start trying to replicate shards to each other on startup and spend a
lot of time on wasted I/O. With shard reallocation disabled, the nodes join the cluster
with their indices intact and do not attempt to rebalance. After startup is complete,
you can turn reallocation back on.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -XPUT localhost:9200/_cluster/settings -d '{
  "transient" : {
    "cluster.routing.allocation.enable" : "none"
  }
}'</pre>
</div>
</li>
<li class="listitem">
<p>Upgrade each node, one at a time:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Stop Elasticsearch.
</li>
<li class="listitem">
<p>Remove the old version of the Marvel agent from Elasticsearch:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/plugin remove marvel-agent</pre>
</div>
</li>
<li class="listitem">
<p>Install the latest version of the Marvel agent:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/plugin install marvel-agent</pre>
</div>
</li>
<li class="listitem">
If you are upgrading from Marvel 1.x and use a separate monitoring cluster,
update your exporter configuration in <code class="literal">elasticsearch.yml</code>. For more information,
see <a class="xref" href="installing-marvel.html#monitoring-cluster" title="Setting up a Separate Monitoring Cluster">Setting up a Separate Monitoring Cluster</a>.
</li>
<li class="listitem">
Start Elasticsearch and confirm that the node rejoins the cluster and that there are no errors
in the logs.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>When you&#8217;ve upgraded all of the nodes in the cluster, reenable shard allocation:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -XPUT localhost:9200/_cluster/settings -d '{
  "transient" : {
      "cluster.routing.allocation.enable" : "all"
  }
}'</pre>
</div>
</li>
<li class="listitem">
<p>Upgrade the Marvel Kibana app:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Stop Kibana.
</li>
<li class="listitem">
<p>Remove the old version of the Marvel app:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/kibana plugin --remove marvel</pre>
</div>
</li>
<li class="listitem">
<p>Install the new version of the Marvel plugin:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/kibana plugin --install elasticsearch/marvel/2.2.1</pre>
</div>
</li>
<li class="listitem">
Restart Kibana by running <code class="literal">bin/kibana</code>.
</li>
</ol>
</div>
</li>
</ol>
</div>
<h3><a id="uninstalling-marvel"></a>Uninstalling Marvel<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.2/docs/public/marvel/installing-marvel.asciidoc">edit</a></h3>
<p>To uninstall Marvel:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Shut down Elasticsearch and Kibana.
</li>
<li class="listitem">
<p>Remove the Marvel agent plugin from Elasticsearch:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/plugin remove marvel-agent</pre>
</div>
</li>
<li class="listitem">
<p>Remove the Marvel Kibana plugin:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/kibana plugin --remove marvel</pre>
</div>
</li>
<li class="listitem">
Restart Elasticsearch and Kibana.
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="getting-started.html">« Getting Started</a>
</span>
<span class="next">
<a href="configuration.html">Configuring Marvel »</a>
</span>
</div>
</div>
</body>
</html>
