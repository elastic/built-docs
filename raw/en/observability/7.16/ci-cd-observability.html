<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="Learn configuration options for Elastic Serverless Forwarder and how to transform your AWS data as it is collected from Amazon Web Services (AWS).">
<meta name="keywords" content="serverless">
<title>CI/CD Observability | Observability Guide [7.16] | Elastic</title>
<link rel="home" href="index.html" title="Observability Guide [7.16]"/>
<link rel="up" href="index.html" title="Observability Guide [7.16]"/>
<link rel="prev" href="cases-external-connectors.html" title="Configure external connectors"/>
<link rel="next" href="fields-reference.html" title="Fields reference"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/7.16"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="7.16"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Observability Guide [7.16]</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="cases-external-connectors.html">« Configure external connectors</a>
</span>
<span class="next">
<a href="fields-reference.html">Fields reference »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="ci-cd-observability"></a>CI/CD Observability<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h1>
</div></div></div>
<p>To help administrators monitor and troubleshoot their CI/CD platform and help developers
increase the speed and reliability of their CI/CD pipelines, Elastic Observability
provides visibility in Continuous Integration and Continuous Delivery (CI/CD) processes.</p>
<p>To provide monitoring dashboards, alerting, and root cause analysis on pipelines, Elastic
works with the communities of the most popular CI/CD platforms to instrument tools with
OpenTelemetry.</p>
<h3><a id="ci-cd-architecture"></a>CI/CD observability architectures<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h3>
<p>Using the APM Server, connect all your OpenTelemetry native CI/CD tools directly to Elastic Observability.</p>
<div class="imageblock">
<div class="content">
<img src="images/simple-arch-observability.png" alt="Simple architecture of CI/CD Observability">
</div>
<div class="title">Architecture of CI/CD Observability with Elastic Observability</div>
</div>
<p>A more advanced CI/CD observability architecture includes an OpenTelemetry Collector
deployed on the edge, next to the CI/CD tools. This architecture provides the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Low latency between the CI/CD tools and the collector is particularly beneficial to
ephemeral tools like the otel-cli.
</li>
<li class="listitem">
The ability to route the observability signals to multiple backends in addition to
Elastic Observability.
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/advanced-arch-observability.png" alt="Advanced architecture of CI/CD Observability">
</div>
<div class="title">Advanced architecture of CI/CD Observability with Elastic Observability</div>
</div>
<h3><a id="ci-cd-administrators"></a>Observability for CI/CD administrators<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h3>
<p>Elastic Observability allows CI/CD administrators to monitor and troubleshoot CI/CD
platforms and detect anomalies.</p>
<h4><a id="ci-cd-monitoring"></a>CI/CD platform monitoring and alerting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<p>Elastic Observability helps CI/CD administrators monitor their platform by providing KPI dashboards
of CI systems.</p>
<p>The Jenkins health dashboards provide insights on the build executions, the failures, the
provisioning of build agents, the active and idle workers, or the JVM health.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ci-cd-overview.png" alt="CI/CD overview">
</div>
<div class="title">Jenkins KPIs in Elastic Observability</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-kpis.png" alt="Jenkins KPIs">
</div>
<div class="title">Jenkins Provisioning KPIs in Elastic Observability</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-jvm-indicators.png" alt="Jenkins JVM health indicators">
</div>
<div class="title">Jenkins JVM health indicators in Elastic Observability</div>
</div>
<h4><a id="ci-cd-troubleshooting"></a>CI/CD platform troubleshooting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<p>CI/CD administrators need to assess the impact of anomalies when troubleshooting platform problems quickly,
whether troubleshooting just one pipeline to much broader outages impacting many pipelines or the entire CI/CD platform.</p>
<p>Elastic Observability enables troubleshooting CI platform outages by providing visualizations of pipeline
executions as distributed traces, along with the capability to slice and dice pipeline executions in any dimension
to assess the nature and the impact of the outage.</p>
<p>In the following image, a Jenkins CI build failed, and its exceptions are reported as errors.
Select any of those errors to view the specific information. In this case, it&#8217;s errors relating to
the CI agent that stopped.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-pipeline-build.png" alt="Jenkins pipeline builds">
</div>
<div class="title">Jenkins pipeline build error in Elastic Observability</div>
</div>
<p>The Errors overview screen provides a high-level view of the exceptions that CI builds catch.
Similar errors are grouped to quickly see which ones are affecting your services
and allow you to take action to rectify them.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-pipeline-errors.png" alt="Jenkins pipeline build errors">
</div>
<div class="title">Jenkins jobs and pipelines errors in Elastic Observability</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/concourse-ci-traces.png" alt="Concourse CI traces view">
</div>
<div class="title">Concourse CI pipeline execution as a trace in Elastic Observability</div>
</div>
<h3><a id="ci-cd-developers"></a>Observability for developers<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h3>
<p>Development teams need to continuously optimize their ever-changing CI/CD pipelines to improve
their reliability while chasing faster pipelines. Visualizations of pipelines as distributed
traces help to document what’s happening and improve performance and reliability (flaky tests and pipelines).</p>
<p>Integrating with many popular CI/CD and DevOps tools like Maven or Ansible using OpenTelemetry, Elastic Observability
solves these problems by providing deep insights into the execution of CI/CD pipelines.</p>
<h4><a id="ci-cd-visibility"></a>CI/CD pipeline visibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<p>The visualization of CI/CD pipelines as distributed traces in Elastic Observability provides
documentation and health indicators of all your pipelines.</p>
<p>The APM Service view in Elastic Observability provides a view of all your instrumented CI/CD
servers with insights on their KPIs.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-servers.png" alt="Jenkins servers view">
</div>
<div class="title">Jenkins servers in Elastic Observability</div>
</div>
<p>The Service page provides more granular insights into your CI/CD workflows by breaking down health
and performance metrics by pipeline. To quickly view which pipelines experience the most errors, are the
most frequently executed, or are the slowest, you can sort and filter the list.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-server.png" alt="Jenkins server view">
</div>
<div class="title">A Jenkins server in Elastic Observability</div>
</div>
<h4><a id="ci-cd-pipelines"></a>Individual pipeline visibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<p>Once you’ve identified the pipeline you want to troubleshoot, you can drill down to get more detailed
information about its performance over time. The pipeline summary shows a breakdown of duration and
failure rates across the pipeline’s individual builds and jobs to spot slowdowns or failures.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-pipeline-overview.png" alt="Jenkins pipeline overview">
</div>
<div class="title">Performance overview of a Jenkins pipeline in Elastic Observability</div>
</div>
<p>The pipelines and traditional jobs are instrumented automatically. If you spot a slow or failing
build and need to understand what’s happening, you can drill into the trace view of the build to look
for the high duration or errorful jobs. You can then dig into the details to understand the
source of the error.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-pipeline-trace.png" alt="Trace of a Jenkins pipeline build">
</div>
<div class="title">A Jenkins pipeline build as a trace in Elastic Observability</div>
</div>
<p>To investigate further, you can view the details of the build captured as labels.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-pipeline-context.png" alt="Attributes of a Jenkins pipeline execution">
</div>
<div class="title">Contextual attributes of a Jenkins pipeline execution in Elastic Observability</div>
</div>
<h3><a id="ci-cd-instrumentation"></a>Instrument CI/CD pipelines<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h3>
<p>Observing CI/CD pipelines is achieved by instrumenting the different CI/CD and DevOps tools.
Elastic works with the Open Source communities leveraging OpenTelemetry to provide the best coverage.</p>
<h4><a id="ci-cd-jenkins"></a>Jenkins<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<h5><a id="ci-cd-install-jenkins"></a>Install the OpenTelemetry plugin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On the Jenkins UI, go to <span class="strong strong"><strong>Manage Jenkins</strong></span> &gt; <span class="strong strong"><strong>Manage Plugins</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-plugin-manager.png" alt="Jenkins Plugin Manager">
</div>
</div>
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Available</strong></span> tab, and search for <span class="strong strong"><strong>OpenTelemetry</strong></span>.
</li>
<li class="listitem">
<p>Select the <span class="strong strong"><strong>OpenTelemetry</strong></span> checkbox and then click <span class="strong strong"><strong>Download now and install after restart</strong></span>.</p>
<p>To verify that the plugin is installed, click the <span class="strong strong"><strong>Installed</strong></span> tab, and search for <span class="strong strong"><strong>OpenTelemetry Plugin</strong></span>.</p>
</li>
</ol>
</div>
<h5><a id="ci-cd-configure-jenkins"></a>Configure the OpenTelemetry plugin<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h5>
<p>The OpenTelemetry plugin needs to be configured to report data to an OpenTelemetry service.
In addition, you will need the endpoint of the OpenTelemetry service, the type of authentication,
and the access credentials.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the Jenkins UI, go to <span class="strong strong"><strong>Manage Jenkins</strong></span> &gt; <span class="strong strong"><strong>Configure System</strong></span>.
</li>
<li class="listitem">
Go to the OpenTelemetry Plugin section.
</li>
<li class="listitem">
<p>Configure your OpenTelemetry endpoint and authentication using the Elastic APM Server URL and the APM Server authentication:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>If using the Elastic APM secret token authorization, select a <span class="strong strong"><strong>Bearer Authentication Token</strong></span>, and add the token
as a Jenkins secret text credential.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/configure-otel-plugin.png" alt="Configure OTEL plugin">
</div>
</div>
</li>
<li class="listitem">
<p>If using the Elastic API Key authorization, define the <span class="strong strong"><strong>Header Authentications</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Header name: <code class="literal">"Authorization"</code>
</li>
<li class="listitem">
Header value: a secret text credential with the value of <code class="literal">"ApiKey an_api_key"</code> (<code class="literal">an_api_key</code> is the value of the secret key)
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Go to <span class="strong strong"><strong>Add Visualisation Observability Backend</strong></span> and define the URL for your Kibana server.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/kibana-url.png" alt="Define Kibana URL">
</div>
</div>
</li>
<li class="listitem">
<p>Finally, there are additional settings to configure:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Endpoint certificates to use in communications.
</li>
<li class="listitem">
The service name and service namespace sent to the OpenTelemetry service.
</li>
<li class="listitem">
Timeouts and batch process times.
</li>
<li class="listitem">
<p>Any steps you may want to omit from the data you send.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can export the OpenTelemetry configuration as environment variables to use them with other tools like otel-cli,
Ansible Otel plugin, and so on. If you enable this option, consider that you can potentially expose the credentials in
the console output.</p>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<p>To learn more about the integration of Jenkins with Elastic Observability, see <a href="https://plugins.jenkins.io/opentelemetry/" class="ulink" target="_top">OpenTelemetry</a>.</p>
<h5><a id="ci-cd-jenkins-dashbaords"></a>Install Jenkins dashboards in Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h5>
<p>There are out of the box Kibana dashboards that help visualize some metrics for the CI/CD platform.</p>
<p>Using the <a href="/guide/en/kibana/7.16/dashboard-import-api.html" class="ulink" target="_top">Import API</a> or the Kibana UI, you
can <a href="https://github.com/jenkinsci/opentelemetry-plugin/tree/master/docs/dashboards/elastic" class="ulink" target="_top">install dashboards</a>
that are compatible with version 7.12 or higher.</p>
<p>For instance, you can follow the below steps:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Import the dashboard in the Kibana UI
</li>
</ul>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-dashboard-import.png" alt="Import kibana dashboard">
</div>
<div class="title">Import dashboard in Kibana</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The new dashboard is now ready to be used:
</li>
</ul>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-dashboard-ready.png" alt="Jenkins dashboard in Kibana">
</div>
<div class="title">Jenkins dashboard in Kibana is ready</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-dashboard.png" alt="Jenkins dashboard">
</div>
<div class="title">Jenkins dashboard in Kibana</div>
</div>
<h4><a id="ci-cd-maven"></a>Maven<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<p>The Maven OpenTelemetry extension integration provides comprehensive visibility into all of your Maven builds.
The extension generates traces for each build and performance metrics to help you understand which Maven goals
or Maven submodules are run the most, how often they fail, and how long they take to complete.</p>
<p>The context propagation from CI pipelines (Jenkins job or pipeline) is passed to the Maven build
through the <code class="literal">TRACEPARENT</code> and <code class="literal">TRACESTATE</code> environment variables that match the <a href="https://www.w3.org/TR/trace-context/" class="ulink" target="_top">W3C Trace Context specification</a>.
Therefore, everything that happens in the CI platform is also shown in the traces.</p>
<p>You can configure your Maven project with the <a href="https://github.com/open-telemetry/opentelemetry-java-contrib/tree/main/maven-extension" class="ulink" target="_top">Maven OpenTelemetry extension</a>.
For example, you can add the following snippet to your pom.xml file:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">&lt;project&gt;
  ...
  &lt;build&gt;
    &lt;extensions&gt;
      &lt;extension&gt;
          &lt;groupId&gt;io.opentelemetry.contrib&lt;/groupId&gt;
          &lt;artifactId&gt;opentelemetry-maven-extension&lt;/artifactId&gt;
          &lt;version&gt;1.9.0-alpha&lt;/version&gt;
      &lt;/extension&gt;
    &lt;/extensions&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre>
</div>
<p>You can now trigger to send the Maven build reporting performance data to Elastic Observability by
passing the configuration details as environment variables:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">export OTEL_EXPORTER_OTLP_ENDPOINT="https://elastic-apm-server.example.com:8200"
export OTEL_EXPORTER_OTLP_HEADERS="Authorization=Bearer an_apm_secret_token"
export OTEL_TRACES_EXPORTER="otlp"

mvn verify</pre>
</div>
<p>You can instrument Maven builds without modifying the pom.xml file using the Maven
command line argument “-Dmaven.ext.class.path=&#8230;&#8203;”</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">export OTEL_EXPORTER_OTLP_ENDPOINT="https://elastic-apm-server.example.com:8200"
export OTEL_EXPORTER_OTLP_HEADERS="Authorization=Bearer an_apm_secret_token"
export OTEL_TRACES_EXPORTER="otlp"

mvn -Dmaven.ext.class.path=path/to/opentelemetry-maven-extension.jar verify</pre>
</div>
<p>You can also trigger your Maven builds from the CI platform and visualize the end-to-end
pipeline execution in Elastic Observability, including the detailed steps of your CI
pipeline and the Maven build.</p>
<p>When invoking Maven builds with Jenkins, it’s unnecessary to use environment variables
to configure the Maven build (<code class="literal">OTEL_EXPORTER_OTLP_ENDPOINT…</code>) to rely on the Jenkins capability
to inject OpenTelemetry configuration as environment variables. For more details, refer to <a class="xref" href="ci-cd-observability.html#ci-cd-install-jenkins" title="Install the OpenTelemetry plugin">Install the OpenTelemetry plugin</a>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-maven-pipeline.png" alt="Maven builds in Jenkins">
</div>
<div class="title">A Jenkins pipeline executing Maven builds</div>
</div>
<p>To learn more, see the <a href="https://github.com/open-telemetry/opentelemetry-java-contrib/tree/main/maven-extension" class="ulink" target="_top">integration of Maven builds with Elastic Observability</a>.</p>
<h4><a id="ci-cd-ansible"></a>Ansible<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<p>The Ansible OpenTelemetry plugin integration provides visibility into all your
Ansible playbooks. The plugin generates traces for each run and performance metrics to help
you understand which Ansible tasks or roles are run the most, how often they
fail, and how long they take to complete.</p>
<p>You can configure your Ansible playbooks with the <a href="https://docs.ansible.com/ansible/latest/collections/community/general/opentelemetry_callback.html" class="ulink" target="_top">Ansible OpenTelemetry callback plugin</a>.
It’s required to install the Opentelemetry python libraries and configure the callback
as stated in the <a href="https://docs.ansible.com/ansible/latest/collections/community/general/opentelemetry_callback.html#examples" class="ulink" target="_top">examples</a> section.</p>
<p>The context propagation from the Jenkins job or pipeline is passed to the Ansible run. Therefore,
everything that happens in the CI is also shown in the traces.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-ansible-pipeline.png" alt="Ansible playbooks in Jenkins">
</div>
<div class="title">Visibility into your Ansible playbooks</div>
</div>
<p>This integration feeds, out of the box, the Service Map with all the services that are connected to the Ansible Playbook.
All of these features can help you quickly and visually assess your services used in your provisioning and Continuous Deployment.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ansible-service-map.png" alt="Ansible service map view">
</div>
<div class="title">ServiceMap view of a Jenkins pipeline execution instrumented with the Ansible plugin</div>
</div>
<h4><a id="ci-cd-otel-cli"></a>Otel cli<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<p><a href="https://github.com/equinix-labs/otel-cli" class="ulink" target="_top">otel-cli</a> is a command-line tool for sending OpenTelemetry
traces, which is useful if instrumenting your scripts explicitly when no other implicit
integration is in place.</p>
<p>Using the otel-cli wrapper, you can configure your build scripts implemented in shell, make, or
another scripting language. For example, instrumenting the Makefile below with otel-cli helps
visualize every command in each goal as spans.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash"># see https://blog.container-solutions.com/tagging-docker-images-the-right-way

NAME   := acmecorp/foo
TAG    := $$(git log -1 --pretty=%!H(MISSING))
IMG    := ${NAME}:${TAG}
LATEST := ${NAME}:latest

build:
  @otel-cli exec \
    --name 'docker build' \
    docker build -t ${IMG} .
  @otel-cli exec \
    --name 'docker tag' \
    docker tag ${IMG} ${LATEST}

push:
  @otel-cli exec \
    --name 'docker push' \
    --attrs "http.url=https://docker.elastic.dev" \
    docker push ${NAME}

login:
  @otel-cli exec \
    --name 'docker login' \
    --attrs 'rpc.system=grpc' \
    docker login -u ${DOCKER_USER} -p ${DOCKER_PASS}</pre>
</div>
<p>To invoke shell scripts that use otel-cli for tracing:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">export OTEL_EXPORTER_OTLP_ENDPOINT="elastic-apm-server.example.com:8200"
export OTEL_EXPORTER_OTLP_HEADERS="Authorization=Bearer an_apm_secret_token"
export OTEL_TRACES_EXPORTER="otlp"

make login build push</pre>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-makefile.png" alt="Jenkins build executing an instrumented Makefile">
</div>
<div class="title">A Jenkins build executing a Makefile instrumented with the otel-cli in Elastic Observability</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-service-map.png" alt="Jenkins service map view">
</div>
<div class="title">ServiceMap view of a Jenkins pipeline execution instrumented with the otel-cli</div>
</div>
<h4><a id="ci-cd-concourse-ci"></a>Concourse CI<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h4>
<p>To configure Concourse CI to send traces, refer to the <a href="https://concourse-ci.org/tracing.html" class="ulink" target="_top">tracing</a> docs.
In the Concourse configuration, you just need to define <code class="literal">CONCOURSE_TRACING_OTLP_ADDRESS</code>
and <code class="literal">CONCOURSE_TRACING_OTLP_HEADERS</code>.</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">CONCOURSE_TRACING_OTLP_ADDRESS=elastic-apm-server.example.com:8200
CONCOURSE_TRACING_OTLP_HEADERS=Authorization=Bearer your-secret-token</pre>
</div>
<p>Context propagation is supported; therefore, you can benefit from the integrations described above.</p>
<p>Once Concourse CI tracing is configured, Concourse CI pipeline executions are
reported in Elastic Observability.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/jenkins-concourse.png" alt="Concourse CI pipeline execution">
</div>
<div class="title">A Concourse CI pipeline execution in Elastic Observability</div>
</div>
<p>The Concourse CI doesn’t report health metrics through OpenTelemetry. However, you can use the
<a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/spanmetricsprocessor#span-metrics-processor" class="ulink" target="_top">OpenTelemetry Collector Span Metrics Processor</a>
to derive pipeline execution traces into KPI metrics like throughput and the error rate
of pipelines.</p>
<h3><a id="check-service-health-from-cd-pipelines"></a>Check service health from deployment pipelines<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/ci-cd-observability.asciidoc">edit</a></h3>
<p>Integrating automated service health checks in deployment pipelines is critical for end-to-end deployment automation, which crucially enables deployment frequency to be increased.</p>
<p>Elastic Observability exposes HTTP APIs to check the health of services. You can integrate these APIs in deployment pipelines to verify the behaviour of newly deployed instances, and either automatically continue the deployments or roll back according to the health status.</p>
<p>The following example shows a canary deployment pipeline that leverages Elastic health check HTTP APIs to automate the quality check before rolling out the deployment from the canary to the entire set of instances:</p>
<div class="imageblock">
<div class="content">
<img src="images/ci-cd-canary-deployment-pipeline.png" alt="Canary Deployment Pipeline">
</div>
</div>
<p>Perform the health check by invoking the <code class="literal">KIBANA_URL/internal/apm/services</code> API to compare the transaction error rate of the service on the newly deployed instances with a threshold value. Pass the following parameters to the invocation:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">start</code> and <code class="literal">end</code>: time interval using the <a href="https://en.wikipedia.org/wiki/ISO_8601" class="ulink" target="_top">ISO-8601</a> format (e.g. "2021-09-01T13:24:12Z" which is a UTC time)
</li>
<li class="listitem">
<code class="literal">kuery</code>: used to filter on the service name and, for example, the new version being deployed to narrow down to the canary instances. Example <code class="literal">service.name:"MY_SERVICE_NAME" AND service.version:"1.2.3"</code>
</li>
<li class="listitem">
<code class="literal">environment</code>: the environment on which the canary instances are deployed. Example: <code class="literal">production</code>.
</li>
</ul>
</div>
<p>To define the time range, use the <code class="literal">start</code> and <code class="literal">end</code> parameters. These parameters are
dates in ISO-8601 format. To query only one service, compose a filter in the param <code class="literal">kuery</code>,
then filter by the service name using the expression <code class="literal">service.name:MY_SERVICE_NAME
and service.version: SERVICE_VERSION</code>. Finally apply an <code class="literal">environment</code> filter by passing
the <code class="literal">environment</code> parameter. To select all environments, use <code class="literal">ENVIRONMENT_ALL</code>.</p>
<p>The API call requires authentication. We recommend to use an API Token to authenticate.</p>
<p>The API is subject to changes and a stable API optimized for Continous Delivery use cases will soon be published.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">def check_service_health(service_name, service_version, error_rate_threshold, kibana_url, api_token):
    now = datetime.now()
    five_minutes_ago = now - timedelta(minutes=5)
    params = {
        "start": five_minutes_ago.strftime("%Y-%m-%dT%H:%M:%SZ"),
        "end": now.strftime("%Y-%m-%dT%H:%M:%SZ"),
        "kuery": "service.name:{} and service.version:{}".format(service_name, service_version),
        "environment": "ENVIRONMENT_ALL"
    }
    url = "{}/internal/apm/services?{}".format(kibana_url, urllib.parse.urlencode(params))
    req = urllib.request.Request(url=url, headers={"Authorization": "Bearer {}".format(api_token)})
    with urllib.request.urlopen(req) as response:
     body = response.read().decode("utf8")
     obj = json.loads(body)
     if len(obj['items']) &gt; 0 and obj['items'][0].transactionErrorRate &gt; error_rate_threshold:
            raise Exception("Error rate for service {} is higher than threshold {}, current value is {}".format(service_name, error_rate_threshold, obj['items'][0].transactionErrorRate))</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="cases-external-connectors.html">« Configure external connectors</a>
</span>
<span class="next">
<a href="fields-reference.html">Fields reference »</a>
</span>
</div>
</div>
</body>
</html>
