<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="Deploy the Elastic Serverless Forwarder using Kibana and the AWS Serverless Application Repository (SAR).">
<meta name="keywords" content="serverless, AWS, SAR">
<title>Create and upload config.yaml to S3 bucket | Observability Guide [7.16] | Elastic</title>
<meta class="elastic" name="content" content="Create and upload config.yaml to S3 bucket | Observability Guide [7.16]">

<link rel="home" href="index.html" title="Observability Guide [7.16]"/>
<link rel="up" href="aws-deploy-elastic-serverless-forwarder.html" title="Deploy Elastic Serverless Forwarder"/>
<link rel="prev" href="aws-serverless-forwarder-deploy-kibana.html" title="Install AWS integration assets in Kibana"/>
<link rel="next" href="aws-serverless-forwarder-define-deploy-parameters.html" title="Define deployment parameters"/>
<meta class="elastic" name="product_version" content="7.16"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/7.16"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="7.16"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="aws-serverless-forwarder-deploy-kibana.html">« Install AWS integration assets in Kibana</a>
</span>
<span class="next">
<a href="aws-serverless-forwarder-define-deploy-parameters.html">Define deployment parameters »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Observability Guide [7.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="add-observability-data.html">Send data to Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="aws-elastic-serverless-forwarder.html">Elastic Serverless Forwarder for AWS</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="aws-deploy-elastic-serverless-forwarder.html">Deploy Elastic Serverless Forwarder</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Create and upload config.yaml to S3 bucket</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="sample-s3-config-file"></a>Create and upload <code class="literal">config.yaml</code> to S3 bucket<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h4>
</div></div></div>
<p>Elastic Serverless Forwarder requires a <code class="literal">config.yaml</code> file to be uploaded to an S3 bucket and referenced by the <code class="literal">S3_CONFIG_FILE</code> environment variable.</p>
<p>Save the following YAML content as <code class="literal">config.yaml</code> and edit as required before uploading to an S3 bucket. You should remove any inputs or arguments you are not using, and ensure you have entered the correct URLs and credentials as per the inline comments.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: "s3-sqs"
    id: "arn:aws:sqs:%REGION%:%ACCOUNT%:%QUEUENAME%"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760
  - type: "sqs"
    id: "arn:aws:sqs:%REGION%:%ACCOUNT%:%QUEUENAME%"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760
  - type: "kinesis-data-stream"
    id: "arn:aws:kinesis:%REGION%:%ACCOUNT%:stream/%STREAMNAME%"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760
  - type: "cloudwatch-logs"
    id: "arn:aws:logs:%AWS_REGION%:%AWS_ACCOUNT_ID%:log-group:%LOG_GROUP_NAME%:*"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760
  - type: "cloudwatch-logs"
    id: "arn:aws:logs:%AWS_REGION%:%AWS_ACCOUNT_ID%:log-group:%LOG_GROUP_NAME%:log-stream:%LOG_STREAM_NAME%"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="s3-config-file-fields"></a>Fields<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/7.16/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h5>
</div></div></div>
<p><code class="literal">inputs.[]</code>:</p>
<p>A list of inputs (i.e. triggers) for the Elastic Serverless Forwarder Lambda function.</p>
<p><code class="literal">inputs.[].type</code>:</p>
<p>The type of trigger input (<code class="literal">cloudwatch-logs</code>, <code class="literal">kinesis-data-stream</code>, <code class="literal">sqs</code> and <code class="literal">s3-sqs</code> are currently supported).</p>
<p><code class="literal">inputs.[].id</code>:</p>
<p>The ARN of the trigger input according to the type. Multiple input entries can have different unique ids with the same type.
Inputs of type <code class="literal">cloudwatch-logs</code> accept both CloudWatch Logs Log Group and CloudWatch Logs Log Stream ARNs.</p>
<p><code class="literal">inputs.[].outputs</code>:</p>
<p>A list of outputs (i.e. forwarding targets) for the Elastic Serverless Forwarder Lambda function. You can have multiple outputs for an input, but only one output can be defined per type.</p>
<p><code class="literal">inputs.[].outputs.[].type</code>:</p>
<p>The type of the forwarding target output (currently only <code class="literal">elasticsearch</code> supported).</p>
<p><code class="literal">inputs.[].outputs.[].args</code>:
Custom init arguments for the specified forwarding target output.</p>
<p>For <code class="literal">elasticsearch</code> the following arguments are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">args.elasticsearch_url</code>: URL of elasticsearch endpoint in the format <code class="literal">http(s)://domain.tld:port</code>. Mandatory when <code class="literal">args.cloud_id</code> is not provided. Will take precedence over <code class="literal">args.cloud_id</code> if both are defined.
</li>
<li class="listitem">
<code class="literal">args.cloud_id</code>: Cloud ID of elasticsearch endpoint. Mandatory when <code class="literal">args.elasticsearch_url</code> is not provided. Will be ignored if <code class="literal">args.elasticsearch_url</code> is defined.
</li>
<li class="listitem">
<code class="literal">args.username</code>: Username of the elasticsearch instance to connect to. Mandatory when <code class="literal">args.api_key</code> is not provided. Will take precedence over <code class="literal">args.api_key</code> if both are defined.
</li>
<li class="listitem">
<code class="literal">args.password</code> Password of the elasticsearch instance to connect to. Mandatory when <code class="literal">args.api_key</code> is not provided. Will take precedence over <code class="literal">args.api_key</code> if both are defined.
</li>
<li class="listitem">
<code class="literal">args.api_key</code>:  API key of elasticsearch endpoint in the format <code class="literal">base64encode(api_key_id:api_key_secret)</code>. Mandatory when <code class="literal">args.username</code>  and <code class="literal">args.password</code> are not provided. Will be ignored if <code class="literal">args.username</code>/<code class="literal">args.password</code> are defined.
</li>
<li class="listitem">
<code class="literal">args.es_datastream_name</code>: Name of data stream or index where logs should be forwarded to. Lambda supports automatic routing of various AWS service logs to the corresponding data streams for further processing and storage in the Elasticsearch cluster. It supports automatic routing of <code class="literal">aws.cloudtrail</code>, <code class="literal">aws.cloudwatch_logs</code>, <code class="literal">aws.elb_logs</code>, <code class="literal">aws.firewall_logs</code>, <code class="literal">aws.vpcflow</code>, and <code class="literal">aws.waf</code> logs. For other log types, if using data streams, you can optionally set its value in the configuration file according to the naming convention for data streams and available integrations. If the <code class="literal">es_datastream_name</code> is not specified and it cannot be matched with any of the above AWS services, then the value will be set to <code class="literal">logs-generic-default</code>. In versions <span class="strong strong"><strong>v0.29.1</strong></span> and below, this configuration parameter was named <code class="literal">es_index_or_datastream_name</code>. Rename the configuration parameter to <code class="literal">es_datastream_name</code> in your <code class="literal">config.yaml</code> file on the S3 bucket to continue using it in the future version. The older name <code class="literal">es_index_or_datastream_name</code> is deprecated as of version <span class="strong strong"><strong>v0.30.0</strong></span>. The related backward compatibility code is removed from version <span class="strong strong"><strong>v1.0.0</strong></span>.
</li>
<li class="listitem">
<code class="literal">args.batch_max_actions</code>: (Optional) Maximum number of actions to send in a single bulk request. Default value: 500.
</li>
<li class="listitem">
<code class="literal">args.batch_max_bytes</code>: (Optional) Maximum size in bytes to send in a single bulk request. Default value: 10485760 (10MB).
</li>
<li class="listitem">
<code class="literal">args.ssl_assert_fingerprint</code>: (Optional) SSL fingerprint for self-signed SSL certificate on HTTPS transport.
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-serverless-forwarder-deploy-kibana.html">« Install AWS integration assets in Kibana</a>
</span>
<span class="next">
<a href="aws-serverless-forwarder-define-deploy-parameters.html">Define deployment parameters »</a>
</span>
</div>
</body>
</html>
