<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ingest application traces with Elastic Agent | Observability Guide [7.17] | Elastic</title>
<meta class="elastic" name="content" content="Ingest application traces with Elastic Agent | Observability Guide [7.17]">

<link rel="home" href="index.html" title="Observability Guide [7.17]"/>
<link rel="up" href="deploy-agent-to-send-data.html" title="Deploy Elastic Agent to send data"/>
<link rel="prev" href="ingest-logs-metrics-uptime.html" title="Ingest logs, metrics, and uptime data with Elastic Agent"/>
<link rel="next" href="ingest-splunk.html" title="Ingest data from Splunk (Experimental)"/>
<meta class="elastic" name="product_version" content="7.17"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/7.17"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="7.17"/>
</head>
<body><div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Observability Guide [7.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="add-observability-data.html">Send data to Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="deploy-agent-to-send-data.html">Deploy Elastic Agent to send data</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="ingest-logs-metrics-uptime.html">« Ingest logs, metrics, and uptime data with Elastic Agent</a>
</span>
<span class="next">
<a href="ingest-splunk.html">Ingest data from Splunk (Experimental) »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ingest-traces"></a>Ingest application traces with Elastic Agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.17/docs/en/observability/ingest-traces.asciidoc">edit</a></h3>
</div></div></div>

<p>This guide describes how to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Collect Application Performance Monitoring (APM) data
</li>
<li class="listitem">
Send APM data to the Elastic Stack
</li>
<li class="listitem">
Explore and visualize the data in real-time
</li>
</ul>
</div>
<p>For feedback and questions, please contact us in the <a href="https://discuss.elastic.co/" class="ulink" target="_top">discuss forum</a>.</p>
<h5><a id="fleet-prereqs-traces"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.17/docs/en/observability/ingest-traces.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>You need Elasticsearch for storing and searching your data, and Kibana for visualizing and
managing it. You can use our
<a href="/cloud/elasticsearch-service?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">hosted Elasticsearch Service</a>
on Elastic Cloud (recommended), or self-manage the Elastic Stack on your own hardware.</p>
<p>Here&#8217;s what you need for each deployment type:</p>
<div class="tabs" data-tab-group="host">
  <div role="tablist" aria-label="Prerequisites">
    <button role="tab"
            aria-selected="true"
            aria-controls="cloud-tab-prereqs"
            id="cloud-prereqs">
      Elasticsearch Service
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="self-managed-tab-prereqs"
            id="self-managed-prereqs"
            tabindex="-1">
      Self-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="cloud-tab-prereqs"
       aria-labelledby="cloud-prereqs">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Access to a deployment of our <a href="/cloud/elasticsearch-service?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">hosted Elasticsearch Service</a>
on Elastic Cloud. The Elasticsearch Service is available on AWS, GCP, and Azure. <a href="/cloud/elasticsearch-service/signup?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">Try it out for free</a>.
This deployment must include an APM &amp; Fleet node.
</li>
<li class="listitem">
User with the superuser role. See <a href="/guide/en/elasticsearch/reference/7.17/built-in-roles.html" class="ulink" target="_top">Built-in roles</a>.
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="self-managed-tab-prereqs"
       aria-labelledby="self-managed-prereqs"
       hidden="">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Access to an Elasticsearch cluster and Kibana (version 7.17) with a basic
license. <a href="/guide/en/elastic-stack-get-started/7.17/get-started-elastic-stack.html" class="ulink" target="_top">Learn how to install the
Elastic Stack on your own hardware</a>.
</li>
<li class="listitem">
Secure, encrypted connection between Kibana and Elasticsearch. For more information,
see <a href="/guide/en/elasticsearch/reference/7.17/configuring-stack-security.html" class="ulink" target="_top">Configure security for the Elastic Stack</a>.
</li>
<li class="listitem">
User with the superuser role. See <a href="/guide/en/elasticsearch/reference/7.17/built-in-roles.html" class="ulink" target="_top">Built-in roles</a>.
</li>
<li class="listitem">
In the Elasticsearch configuration, the
<a href="/guide/en/elasticsearch/reference/7.17/security-settings.html#api-key-service-settings" class="ulink" target="_top">built-in API key
service</a> must be enabled.
(<code class="literal">xpack.security.authc.api_key.enabled: true</code>)
</li>
<li class="listitem">
In the Kibana configuration, the saved objects encryption key
must be set. Fleet requires this setting in order to save API keys and encrypt
them in Kibana. You can either set <code class="literal">xpack.encryptedSavedObjects.encryptionKey</code> to
an alphanumeric value of at least 32 characters, or run the
<a href="/guide/en/kibana/7.17/kibana-encryption-keys.html" class="ulink" target="_top"><code class="literal">kibana-encryption-keys</code> command</a> to
generate the key.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Example security settings</strong></span></p>
<p>For testing purposes, you can use the following settings to get started quickly,
but make sure you properly secure the Elastic Stack before sending real data.</p>
<p>elasticsearch.yml example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.enabled: true
xpack.security.authc.api_key.enabled: true</pre>
</div>
<p>kibana.yml example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.username: "kibana_system" <a id="CO8-1"></a><i class="conum" data-value="1"></i>
xpack.security.enabled: true
xpack.encryptedSavedObjects.encryptionKey: "something_at_least_32_characters"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO8-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The password should be stored in the Kibana keystore as described in the
<a href="/guide/en/elasticsearch/reference/7.17/security-minimal-setup.html" class="ulink" target="_top">Elasticsearch security documentation</a>.</p>
</td>
</tr>
</table>
</div>
  </div>
</div>
</li>
<li class="listitem">
An internet connection is required for Kibana to download integration packages
from the Elastic Package Registry. Make sure the Kibana server can connect to
<code class="literal">https://epr.elastic.co</code> on port <code class="literal">443</code>.
</li>
<li class="listitem">
Fleet is currently only available to users with the
<a href="/guide/en/elasticsearch/reference/7.17/built-in-roles.html" class="ulink" target="_top">superuser role</a>.
</li>
</ul>
</div>
<h5><a id="set-up-fleet-traces"></a>Step 1: Set up Fleet<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.17/docs/en/observability/ingest-traces.asciidoc">edit</a></h5>
<p>Use Fleet in Kibana to get APM data into the Elastic Stack.</p>
<p>The first time you use Fleet, you might need to set it up and add a
Fleet Server:</p>
<div class="tabs" data-tab-group="spin-up-stack">
  <div role="tablist" aria-label="Spin up">
    <button role="tab"
            aria-selected="true"
            aria-controls="cloud-tab-spinup"
            id="cloud-spinup">
      Elasticsearch Service
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="self-managed-tab-spinup"
            id="self-managed-spinup"
            tabindex="-1">
      Self-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="cloud-tab-spinup"
       aria-labelledby="cloud-spinup">
<p>Elastic Cloud runs a hosted version of Fleet Server. No extra setup is required
unless you want to scale your deployment.</p>
<p>To confirm that Fleet Server is available in your deployment:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to Kibana and go to <span class="strong strong"><strong>Management &gt; Fleet</strong></span>.
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>Agents</strong></span> tab.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Agent policy</strong></span>, look for <span class="strong strong"><strong>Elastic Cloud agent policy</strong></span>&#8201;&#8212;&#8201;Fleet Server is the agent enrolled in the Elastic Cloud agent policy.
This policy is managed by Elastic Cloud. You cannot modify it.
Confirm that the agent status is <span class="strong strong"><strong>Healthy</strong></span>.
</li>
</ol>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Don&#8217;t see the Fleet Server agent? Make sure your deployment includes an
APM &amp; Fleet node. This node is required to use Fleet Server.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fleet-server-hosted-container.png" alt="Fleet Server hosted agent">
</div>
</div>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When using our hosted Elasticsearch Service, it&#8217;s recommended that you use our hosted
version of Fleet Server. However, you can choose to deploy and self-manage
Fleet Servers.</p>
</div>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="self-managed-tab-spinup"
       aria-labelledby="self-managed-spinup"
       hidden="">
<p>To deploy a self-managed Fleet Server, install an Elastic Agent and enroll it in an
agent policy containing the Fleet Server integration.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can install only a single Elastic Agent per host, which means you cannot run
Fleet Server and another Elastic Agent on the same host unless you deploy a
containerized Fleet Server.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to Kibana and go to <span class="strong strong"><strong>Management &gt; Fleet</strong></span>. The first time you visit
this page, it might take a minute to load.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Fleet settings</strong></span>, and in the <span class="strong strong"><strong>Fleet Server hosts</strong></span> field, specify the
URLs Elastic Agents will use to connect to Fleet Server. For example,
<code class="literal">https://192.0.2.1:8220</code>, where <code class="literal">192.0.2.1</code> is the host IP where you will
install Fleet Server.
</li>
<li class="listitem">
<p>In the <span class="strong strong"><strong>Elasticsearch hosts</strong></span> field, specify the Elasticsearch URLs where Elastic Agents will send data.
For example, <code class="literal">https://192.0.2.0:9200</code>.</p>
<p>For more information about these settings, see
<a href="/guide/en/fleet/7.17/fleet-settings.html" class="ulink" target="_top">Fleet settings</a>.</p>
</li>
<li class="listitem">
Save and apply the settings.
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Agents</strong></span> tab and follow the in-product instructions to add a
Fleet server:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/add-fleet-server.png" alt="In-product instructions for adding a Fleet Server">
</div>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Notes:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Make sure you download an x64 architecture installation package.
</li>
<li class="listitem">
<p>For the agent policy, choose one with a Fleet Server integration. If
one doesn&#8217;t exist, create it.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>What is a Fleet Server policy?</strong></p>
</div></div></div>
<p>It is an agent policy that contains a Fleet Server integration. In
self-managed clusters, a default Fleet Server policy is created
automatically when you run Fleet for the first time. If you are deploying a
self-managed Fleet Server to work with our hosted Elasticsearch Service, you
must explicitly
<a href="/guide/en/fleet/7.17/agent-policy.html#create-a-policy" class="ulink" target="_top">create a new agent policy</a> that
includes a Fleet Server integration.</p>
</div>
</li>
<li class="listitem">
If you choose <span class="strong strong"><strong>Production</strong></span> deployment mode, learn how to generate certs in
<a href="/guide/en/fleet/7.17/secure-connections.html" class="ulink" target="_top">Encrypt traffic in clusters with a
self-managed Fleet Server</a>.
</li>
<li class="listitem">
It&#8217;s recommended you generate a unique service token for each
Fleet Server. For other ways to generate service tokens, see
<a href="/guide/en/elasticsearch/reference/7.17/service-tokens-command.html" class="ulink" target="_top"><code class="literal">elasticsearch-service-tokens</code></a>.
</li>
<li class="listitem">
<p>The <code class="literal">install</code> command installs the Elastic Agent as a managed service and enrolls it
in a Fleet Server policy. For example, the following command installs
a Fleet Server and uses self-signed certs:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">sudo ./elastic-agent install  -f \
  --fleet-server-es=http://localhost:9200 \
  --fleet-server-service-token=AAEbAWVsYXN0aWMvZmxlaXQtc2VydmVzL3Rva2VuLTE2MeIzNTY1NTQ3Mji6dERXeE9XbW5RRTZqNlJMWEdIRzAtZw \
  --fleet-server-policy=27467ed1-1bfd-11ec-9b88-a7c3d83e2897
  --fleet-server-insecure-http</pre>
</div>
<p>The following command installs a Fleet Server and uses certificates you
provide. Make sure you replace the values in angle brackets.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">sudo ./elastic-agent install --url=https://192.0.2.1:8220 \ <a id="CO9-1"></a><i class="conum" data-value="1"></i>
 -f \
 --fleet-server-es=https://192.0.2.0:9200 \
 --fleet-server-service-token=AAEAaWVsYXN0aWcvZmxlZXQtc2VydmVyL3rva2VuLTE2MzIzNTYcNTQ3MjI6dER1eE9XbW5RRTZqNlJMWEdIRzAtZw \
  --fleet-server-policy=27467ed1-1bfd-11ec-9b88-a7c3d83e2897 \
  --certificate-authorities=&lt;PATH_TO_CA&gt; \
  --fleet-server-es-ca=&lt;PATH_TO_ES_CERT&gt; \
  --fleet-server-cert=&lt;PATH_TO_FLEET_SERVER_CERT&gt; \
  --fleet-server-cert-key=&lt;PATH_TO_FLEET_SERVER_CERT_KEY&gt;</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The URL must match the DNS name used to generate the certificate specified
by <code class="literal">--fleet-server-cert</code>.</p>
</td>
</tr>
</table>
</div>
<p>For more Fleet Server commands, see
<a href="/guide/en/fleet/7.17/elastic-agent-cmd-options.html" class="ulink" target="_top">Elastic Agent command reference</a>.</p>
<p>If installation is successful, you&#8217;ll see the Fleet Server Elastic Agent on the
<span class="strong strong"><strong>Agents</strong></span> tab in <span class="strong strong"><strong>Fleet</strong></span>. Notice that the Default Fleet Server Policy is
assigned to the Elastic Agent. This policy is created when you run Fleet for the
first time.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/agents-tab-fleet-server.png" alt="Agent tab showing a healthy agent enrolled in the Default Fleet Server policy">
</div>
</div>
</li>
</ul>
</div>
  </div>
</div>
<p>For more information, refer to <a href="/guide/en/fleet/7.17/fleet-server.html" class="ulink" target="_top">Fleet Server</a>.</p>
<h5><a id="add-agent-to-fleet-traces"></a>Step 2: Add an Elastic Agent to Fleet<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.17/docs/en/observability/ingest-traces.asciidoc">edit</a></h5>
<div class="sidebar">
<div class="titlepage"></div>
<p>This step is optional for Elasticsearch Service users as Elastic Cloud spins up an Elastic Agent instance automatically.
Unless you want to run a separate Elastic Agent on an edge machine, Elasticsearch Service users should skip this step.</p>
</div>
<p>Elastic Agent is a single, unified agent that you can deploy to hosts or containers to
collect data and send it to the Elastic Stack. Behind the scenes, Elastic Agent runs the
Beats shippers or Elastic Endpoint required for your configuration.</p>
<p>Don&#8217;t confuse Elastic Agent with APM agents–they are different components.
In a later step, you&#8217;ll instrument your code with APM agents and send the data
to an APM Server instance that Elastic Agent spins up.</p>
<p>If you plan on enabling Real User Monitoring (RUM), you must run Elastic Agent centrally.
If RUM is disabled, you should run Elastic Agent on edge machines.</p>
<p>To send APM data to the Elastic Stack:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>On the machine where you&#8217;ll run Elastic Agent, download and extract the
installation package.</p>
<div class="tabs" data-tab-group="os">
  <div role="tablist" aria-label="Download">
    <button role="tab"
            aria-selected="true"
            aria-controls="mac-tab-download"
            id="mac-download">
      MacOS
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="linux-tab-download"
            id="linux-download"
            tabindex="-1">
      Linux
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="win-tab-download"
            id="win-download"
            tabindex="-1">
      Windows
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="deb-tab-download"
            id="deb-download"
            tabindex="-1">
      DEB
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="rpm-tab-download"
            id="rpm-download"
            tabindex="-1">
      RPM
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="mac-tab-download"
       aria-labelledby="mac-download">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-7.17.10-darwin-x86_64.tar.gz
tar xzvf elastic-agent-7.17.10-darwin-x86_64.tar.gz</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="linux-tab-download"
       aria-labelledby="linux-download"
       hidden="">
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-7.17.10-linux-x86_64.tar.gz
tar xzvf elastic-agent-7.17.10-linux-x86_64.tar.gz</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="win-tab-download"
       aria-labelledby="win-download"
       hidden="">
<div class="pre_wrapper lang-powershell">
<pre class="programlisting prettyprint lang-powershell"># PowerShell 5.0+
wget https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-7.17.10-windows-x86_64.zip -OutFile elastic-agent-7.17.10-windows-x86_64.zip
Expand-Archive .\elastic-agent-7.17.10-windows-x86_64.zip</pre>
</div>
<p>Or manually:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Download the Elastic Agent Windows zip file from the
<a href="/downloads/beats/elastic-agent" class="ulink" target="_top">download page</a>.
</li>
<li class="listitem">
Extract the contents of the zip file.
</li>
</ol>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="deb-tab-download"
       aria-labelledby="deb-download"
       hidden="">
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>To simplify upgrading to future versions of Elastic Agent, we recommended
that you use the tarball distribution instead of the DEB distribution.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-7.17.10-amd64.deb
sudo dpkg -i elastic-agent-7.17.10-amd64.deb</pre>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="rpm-tab-download"
       aria-labelledby="rpm-download"
       hidden="">
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>To simplify upgrading to future versions of Elastic Agent, we recommended
that you use the tarball distribution instead of the RPM distribution.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-7.17.10-x86_64.rpm
sudo rpm -vi elastic-agent-7.17.10-x86_64.rpm</pre>
</div>
  </div>
</div>
<p>See the <a href="/downloads/elastic-agent" class="ulink" target="_top">download page</a> for other
installation options.</p>
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Agents</strong></span> tab in Fleet, click <span class="strong strong"><strong>Add agent</strong></span>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Enroll in Fleet</strong></span>, follow the in-product installation steps (skip
the download step if you&#8217;ve already done it).</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/add-agent.png" alt="add agent">
</div>
</div>
<p>See the <a href="/downloads/elastic-agent" class="ulink" target="_top">download page</a> for other
installation options.</p>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Notes:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use the default agent policy to get started quickly. This policy includes a
system integration for collecting logs and metrics from the host system. You
can change the policy later.
</li>
<li class="listitem">
<p>On macOS, Linux (tar package), and Windows, run the <code class="literal">install</code> command to
install Elastic Agent as a managed service, enroll it in Fleet, and start the
service. The DEB and RPM packages include a service unit for Linux systems with
systemd, so use the <code class="literal">enroll</code> command instead of <code class="literal">install</code>.</p>
<div class="tabs" data-tab-group="os">
  <div role="tablist" aria-label="Enroll">
    <button role="tab"
            aria-selected="true"
            aria-controls="mac-tab-enroll"
            id="mac-enroll">
      MacOS
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="linux-tab-enroll"
            id="linux-enroll"
            tabindex="-1">
      Linux
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="win-tab-enroll"
            id="win-enroll"
            tabindex="-1">
      Windows
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="deb-tab-enroll"
            id="deb-enroll"
            tabindex="-1">
      DEB
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="rpm-tab-enroll"
            id="rpm-enroll"
            tabindex="-1">
      RPM
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="mac-tab-enroll"
       aria-labelledby="mac-enroll">
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must run this command as the root user because some
integrations require root privileges to collect sensitive data.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cd elastic-agent-7.17.10-darwin-x86_64
sudo ./elastic-agent install -f --url=&lt;fleet_server_url&gt; --enrollment-token=&lt;enrollment_token&gt; <a id="CO10-1"></a><i class="conum" data-value="1"></i> <a id="CO10-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">fleet_server_url</code> is the host and IP where Fleet Server is running, and
<code class="literal">enrollment_token</code> is the enrollment token acquired from Fleet.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Omit <code class="literal">-f</code> to run an interactive installation.</p>
</td>
</tr>
</table>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="linux-tab-enroll"
       aria-labelledby="linux-enroll"
       hidden="">
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must run this command as the root user because some
integrations require root privileges to collect sensitive data.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">cd elastic-agent-7.17.10-linux-x86_64
sudo ./elastic-agent install -f --url=&lt;fleet_server_url&gt; --enrollment-token=&lt;enrollment_token&gt; <a id="CO11-1"></a><i class="conum" data-value="1"></i> <a id="CO11-2"></a><i class="conum" data-value="2"></i> <a id="CO11-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">fleet_server_url</code> is the host and IP where Fleet Server is running, and
<code class="literal">enrollment_token</code> is the enrollment token acquired from Fleet.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This command requires a system and service manager like systemd.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO11-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Omit <code class="literal">-f</code> to run an interactive installation.</p>
</td>
</tr>
</table>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="win-tab-enroll"
       aria-labelledby="win-enroll"
       hidden="">
<p>Open a PowerShell prompt as an Administrator (right-click the PowerShell icon
and select <span class="strong strong"><strong>Run As Administrator</strong></span>).</p>
<p>From the PowerShell prompt, change to the directory where you installed Elastic Agent,
and run:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">.\elastic-agent.exe install -f --url=&lt;fleet_server_url&gt; --enrollment-token=&lt;enrollment_token&gt; <a id="CO12-1"></a><i class="conum" data-value="1"></i> <a id="CO12-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO12-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">fleet_server_url</code> is the host and IP where Fleet Server is running, and
<code class="literal">enrollment_token</code> is the enrollment token acquired from Fleet.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO12-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Omit <code class="literal">-f</code> to run an interactive installation.</p>
</td>
</tr>
</table>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="deb-tab-enroll"
       aria-labelledby="deb-enroll"
       hidden="">
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must run this command as the root user because some
integrations require root privileges to collect sensitive data.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo elastic-agent enroll --url=&lt;fleet_server_url&gt; --enrollment-token=&lt;enrollment_token&gt; <a id="CO13-1"></a><i class="conum" data-value="1"></i>
sudo systemctl enable elastic-agent <a id="CO13-2"></a><i class="conum" data-value="2"></i>
sudo systemctl start elastic-agent</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">fleet_server_url</code> is the host and IP where Fleet Server is running, and
<code class="literal">enrollment_token</code> is the enrollment token acquired from Fleet. Not sure where
Fleet Server is running? Look at the
<a href="/guide/en/fleet/7.17/fleet-settings.html" class="ulink" target="_top">Fleet settings</a> in Kibana.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO13-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The DEB package includes a service unit for Linux systems with systemd. On
these systems, you can manage Elastic Agent by using the usual systemd commands. If
you don&#8217;t have systemd, run <code class="literal">sudo service elastic-agent start</code>.</p>
</td>
</tr>
</table>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="rpm-tab-enroll"
       aria-labelledby="rpm-enroll"
       hidden="">
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must run this command as the root user because some
integrations require root privileges to collect sensitive data.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sudo elastic-agent enroll --url=&lt;fleet_server_url&gt; --enrollment-token=&lt;enrollment_token&gt; <a id="CO14-1"></a><i class="conum" data-value="1"></i>
sudo systemctl enable elastic-agent <a id="CO14-2"></a><i class="conum" data-value="2"></i>
sudo systemctl start elastic-agent</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p><code class="literal">fleet_server_url</code> is the host and IP where Fleet Server is running, and
<code class="literal">enrollment_token</code> is the enrollment token acquired from Fleet.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO14-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The RPM package includes a service unit for Linux systems with systemd. On
these systems, you can manage Elastic Agent by using the usual systemd commands. If
you don&#8217;t have systemd, run <code class="literal">sudo service elastic-agent start</code>.</p>
</td>
</tr>
</table>
</div>
  </div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you see an "x509: certificate signed by unknown authority" error, you
might be trying to enroll in a Fleet Server that uses self-signed certs. To
fix this problem in a non-production environment, pass the <code class="literal">--insecure</code> flag.
For more information, refer to the
<a href="/guide/en/fleet/7.17/fleet-troubleshooting.html#agent-enrollment-certs" class="ulink" target="_top">troubleshooting guide</a>.</p>
</div>
</div>
<p>Refer to <a href="/guide/en/fleet/7.17/installation-layout.html" class="ulink" target="_top">Installation layout</a> for the
location of installed Elastic Agent files.</p>
</li>
</ul>
</div>
<p>Because Elastic Agent is installed as an auto-starting service, it will restart
automatically if the system is rebooted.</p>
<p>To confirm that Elastic Agent is installed and running, go to the <span class="strong strong"><strong>Agents</strong></span> tab in
Fleet. Notice that the Default policy is assigned to the agent.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/kibana-fleet-agents.png" alt="Fleet showing enrolled agents">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the status hangs at Enrolling, make sure the <code class="literal">elastic-agent</code> process
is running.</p>
</div>
</div>
<p>If you run into problems:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Check the Elastic Agent logs. If you use the default policy, agent logs and metrics
are collected automatically unless you change the default settings. For more
information, refer to <a href="/guide/en/fleet/7.17/elastic-agent-logging.html" class="ulink" target="_top">View Elastic Agent logs in Fleet</a>.
</li>
<li class="listitem">
Refer to the <a href="/guide/en/fleet/7.17/fleet-troubleshooting.html" class="ulink" target="_top">troubleshooting guide</a>.
</li>
</ul>
</div>
<p>For information about managing Elastic Agent in Fleet,
refer to <a href="/guide/en/fleet/7.17/manage-agents-in-fleet.html" class="ulink" target="_top">Centrally manage Elastic Agents in Fleet</a>.</p>
<h5><a id="add-apm-integration"></a>Step 3: Add the APM integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.17/docs/en/observability/ingest-traces.asciidoc">edit</a></h5>
<p>Next, add the APM integration to the default policy used by your Elastic Agent.
Policies manage settings across a group of Elastic Agents and may contain any number of integrations
for collecting observability data from the various services running on your host.</p>
<div class="tabs" data-tab-group="add-apm-integration">
  <div role="tablist" aria-label="Add APM integration">
    <button role="tab"
            aria-selected="true"
            aria-controls="cloud-add-apm"
            id="cloud-apm">
      Elasticsearch Service
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="self-managed-add-apm"
            id="self-managed-apm"
            tabindex="-1">
      Self-managed
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="cloud-add-apm"
       aria-labelledby="cloud-apm">
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In Kibana, select <span class="strong strong"><strong>Add integrations</strong></span> &gt; <span class="strong strong"><strong>Elastic APM</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/kibana-fleet-integrations-apm.png" alt="Fleet showing APM integration">
</div>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>APM integration</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/cloud-add-apm.png" alt="Add APM integration">
</div>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Switch to Elastic Agent</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/cloud-switch-to-apm.png" alt="Switch to Elastic APM">
</div>
</div>
</li>
<li class="listitem">
<p>Confirm that you wish to switch to Elastic Agent. Some <code class="literal">apm-server.yml</code> are incompatible
with Elastic Agent and will be removed when Elastic Agent is enabled. Click <span class="strong strong"><strong>Switch to Elastic Agent</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/cloud-switch-to-ea.png" alt="Switch to Elastic Agent">
</div>
</div>
</li>
<li class="listitem">
When the APM integration finishes setting up, click <span class="strong strong"><strong>View the APM integration in Fleet</strong></span>.
</li>
<li class="listitem">
<p>As you can see, the APM integration has been added to the Elastic Cloud Agent policy.
This is the default policy for Elastic Agents hosted on Elastic Cloud.
Select <span class="strong strong"><strong>Actions</strong></span> &gt; <span class="strong strong"><strong>Edit integration</strong></span> to configure the APM integration.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/cloud-edit-apm.png" alt="Edit the APM integration">
</div>
</div>
</li>
<li class="listitem">
Make a note of the predefined Host and URL that the APM Server is listening on&#8212;&#8203;you&#8217;ll
need these in the next step.
If you made any changes to your configuration, click <span class="strong strong"><strong>save and continue</strong></span>.
</li>
</ol>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="self-managed-add-apm"
       aria-labelledby="self-managed-apm"
       hidden="">
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In Kibana, select <span class="strong strong"><strong>Add integrations</strong></span> &gt; <span class="strong strong"><strong>Elastic APM</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/kibana-fleet-integrations-apm.png" alt="Fleet showing APM integration">
</div>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Add Elastic APM</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/kibana-fleet-integrations-apm-overview.png" alt="Fleet showing APM integration overview">
</div>
</div>
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Add Elastic APM integration</strong></span> page,
define the host and port where APM Server will listen.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Apply to agent policy</strong></span>, select the default policy.
Click <span class="strong strong"><strong>Save and continue</strong></span>.</p>
<p>In this guide, you add integrations to the default policy created by
Kibana. After you learn the basics, you can create your own policies and assign
them to agents.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/add-integration-apm.png" alt="Fleet Add APM integration page">
</div>
</div>
</li>
<li class="listitem">
<p>To see the updated policy, click the <span class="strong strong"><strong>Default policy</strong></span> link.</p>
<p>The newly added APM integration should appear under <span class="strong strong"><strong>Fleet</strong></span> &gt; <span class="strong strong"><strong>Agent policies</strong></span> &gt; <span class="strong strong"><strong>Default policy</strong></span>,
along with the default System integration.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="./images/kibana-fleet-policies-default-with-apm.png" alt="Fleet showing default agent policy with apm-1 datasource">
</div>
</div>
<p>All Elastic Agents that use this policy will collect APM data from your instrumented services.</p>
</li>
</ol>
</div>
  </div>
</div>
<h5><a id="add-apm-integration-agents"></a>Step 4: Install APM agents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.17/docs/en/observability/ingest-traces.asciidoc">edit</a></h5>
<p>APM agents are written in the same language as your service.
To monitor a new service, you must install the agent and configure it with a service name,
APM Server host, and Secret token.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Service name</strong></span>: The APM integration maps an instrumented service&#8217;s name–defined in each APM agent&#8217;s configuration–
to the index that its data is stored in Elasticsearch.
Service names are case-insensitive and must be unique.
For example, you cannot have a service named <code class="literal">Foo</code> and another named <code class="literal">foo</code>.
Special characters will be removed from service names and replaced with underscores (<code class="literal">_</code>).
</li>
<li class="listitem">
<span class="strong strong"><strong>APM Server URL</strong></span>: The host and port that APM Server listens for events on.
This should match the host and port defined when setting up the APM integration.
</li>
<li class="listitem">
<span class="strong strong"><strong>Secret token</strong></span>: Authentication method for APM agent and APM Server communication.
This should match the secret token defined when setting up the APM integration.
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can edit your APM integration settings if you need to change the APM Server URL
or secret token to match your APM agents.</p>
</div>
</div>
<div class="tabs" data-tab-group="apm-agent">
  <div role="tablist" aria-label="Install">
    <button role="tab"
            aria-selected="false"
            aria-controls="go-tab-install"
            id="go-install">
      Go
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="ios-tab-install"
            id="ios-install"
            tabindex="-1">
      iOS
    </button>
    <button role="tab"
            aria-selected="true"
            aria-controls="java-tab-install"
            id="java-install"
            tabindex="-1">
      Java
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="net-tab-install"
            id="net-install"
            tabindex="-1">
      .NET
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="node-tab-install"
            id="node-install"
            tabindex="-1">
      Node.js
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="php-tab-install"
            id="php-install"
            tabindex="-1">
      PHP
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="python-tab-install"
            id="python-install"
            tabindex="-1">
      Python
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="ruby-tab-install"
            id="ruby-install"
            tabindex="-1">
      Ruby
    </button>
    <button role="tab"
        aria-selected="false"
        aria-controls="rum-tab-install"
        id="rum-install"
        tabindex="-1">
      RUM
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="go-tab-install"
       aria-labelledby="go-install"
       hidden="">
<p><span class="strong strong"><strong>Install the agent</strong></span></p>
<p>Install the APM agent packages for Go.</p>
<div class="pre_wrapper lang-go">
<pre class="programlisting prettyprint lang-go">go get go.elastic.co/apm</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Agents are libraries that run inside of your application process.
APM services are created programmatically based on the executable file name, or the <code class="literal">ELASTIC_APM_SERVICE_NAME</code> environment variable.</p>
<div class="pre_wrapper lang-go">
<pre class="programlisting prettyprint lang-go"># Initialize using environment variables:

# Set the service name. Allowed characters: a-z, A-Z, 0-9, -, _, and space.
# If ELASTIC_APM_SERVICE_NAME is not specified, the executable name will be used.
export ELASTIC_APM_SERVICE_NAME=

# Set custom APM Server URL. Default: http://localhost:8200.
export ELASTIC_APM_SERVER_URL=

# Use if APM Server requires a token
export ELASTIC_APM_SECRET_TOKEN=</pre>
</div>
<p><span class="strong strong"><strong>Instrument your application</strong></span></p>
<p>Instrument your Go application by using one of the provided instrumentation modules or by using the tracer API directly.</p>
<div class="pre_wrapper lang-go">
<pre class="programlisting prettyprint lang-go">import (
	"net/http"

	"go.elastic.co/apm/module/apmhttp"
)

func main() {
	mux := http.NewServeMux()
	...
	http.ListenAndServe(":8080", apmhttp.Wrap(mux))
}</pre>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/go/2.x/supported-tech.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/go/2.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/go/2.x/getting-started.html" class="ulink" target="_top">Detailed guide to instrumenting Go source code</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="ios-tab-install"
       aria-labelledby="ios-install"
       hidden="">
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p><span class="strong strong"><strong>Add the agent dependency to your project</strong></span></p>
<p>Add the Elastic APM iOS Agent as a
<a href="https://developer.apple.com/documentation/swift_packages/adding_package_dependencies_to_your_app" class="ulink" target="_top">package dependency</a>
to your Xcode project or your <code class="literal">Package.swift</code>:</p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">Package(
    dependencies:[
        .package(name: "iOSAgent", url: "git@github.com:elastic/apm-agent-ios.git", .branch("main")),
    ],
  targets:[
    .target(
        name: "MyApp",
        dependencies: [
            .product(name: "iOSAgent", package: "iOSAgent")
        ]
    ),
])</pre>
</div>
<p><span class="strong strong"><strong>Initialize the agent</strong></span></p>
<p>If you&#8217;re using <code class="literal">SwiftUI</code> to build your app, add the following to <code class="literal">App.swift</code>:</p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">import SwiftUI
import iOSAgent

@main
struct MyApp: App {
    init() {
        var config = AgentConfiguration()
        config.collectorAddress = "127.0.0.1" <a id="CO15-1"></a><i class="conum" data-value="1"></i>
        config.collectorPort = 8200 <a id="CO15-2"></a><i class="conum" data-value="2"></i>
        config.collectorTLS = false <a id="CO15-3"></a><i class="conum" data-value="3"></i>
        config.secretToken = "&lt;secret token&gt;" <a id="CO15-4"></a><i class="conum" data-value="4"></i>
        Agent.start(with: config)
    }
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO15-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>APM Server URL or IP address</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO15-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>APM Server port number</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO15-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enable TLS for Open telemetry exporters</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO15-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set secret token for APM server connection</p>
</td>
</tr>
</table>
</div>
<p>If you&#8217;re not using <code class="literal">SwiftUI</code>, you can add the same thing to your AppDelegate file:</p>
<p><code class="literal">AppDelegate.swift</code></p>
<div class="pre_wrapper lang-swift">
<pre class="programlisting prettyprint lang-swift">import UIKit
import iOSAgent
@main
class AppDelegate: UIResponder, UIApplicationDelegate {
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
        var config = AgentConfiguration()
        config.collectorAddress = "127.0.0.1" <a id="CO16-1"></a><i class="conum" data-value="1"></i>
        config.collectorPort = 8200 <a id="CO16-2"></a><i class="conum" data-value="2"></i>
        config.collectorTLS = false <a id="CO16-3"></a><i class="conum" data-value="3"></i>
        config.secretToken = "&lt;secret token&gt;" <a id="CO16-4"></a><i class="conum" data-value="4"></i>
        Agent.start(with: config)
        return true
    }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>APM Server url or ip address</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>APM Server port number</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enable TLS for Open telemetry exporters</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO16-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Set secret token for APM server connection</p>
</td>
</tr>
</table>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="java-tab-install"
       aria-labelledby="java-install">
<p><span class="strong strong"><strong>Download the APM agent</strong></span></p>
<p>Download the agent jar from <a href="http://search.maven.org/#search%7Cga%7C1%7Ca%3Aelastic-apm-agent" class="ulink" target="_top">Maven Central</a>.
Do not add the agent as a dependency to your application.</p>
<p><span class="strong strong"><strong>Start your application with the javaagent flag</strong></span></p>
<p>Add the <code class="literal">-javaagent</code> flag and configure the agent with system properties.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Set required service name
</li>
<li class="listitem">
Set custom APM Server URL (default: <a href="http://localhost:8200" class="ulink" target="_top">http://localhost:8200</a>)
</li>
<li class="listitem">
Set the base package of your application
</li>
</ul>
</div>
<div class="pre_wrapper lang-java">
<pre class="programlisting prettyprint lang-java">java -javaagent:/path/to/elastic-apm-agent-&lt;version&gt;.jar \
     -Delastic.apm.service_name=my-application \
     -Delastic.apm.server_urls=http://localhost:8200 \
     -Delastic.apm.secret_token= \
     -Delastic.apm.application_packages=org.example \
     -jar my-application.jar</pre>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/java/1.x/supported-technologies-details.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/java/1.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="net-tab-install"
       aria-labelledby="net-install"
       hidden="">
<p><span class="strong strong"><strong>Download the APM agent</strong></span></p>
<p>Add the agent packages from <a href="https://www.nuget.org/packages?q=Elastic.apm" class="ulink" target="_top">NuGet</a> to your .NET application.
There are multiple NuGet packages available for different use cases.</p>
<p>For an ASP.NET Core application with Entity Framework Core, download the
<a href="https://www.nuget.org/packages/Elastic.Apm.NetCoreAll" class="ulink" target="_top">Elastic.Apm.NetCoreAll</a> package.
This package will automatically add every agent component to your application.</p>
<p>To minimize the number of dependencies, you can use the
<a href="https://www.nuget.org/packages/Elastic.Apm.AspNetCore" class="ulink" target="_top">Elastic.Apm.AspNetCore</a> package for just ASP.NET Core monitoring, or the
<a href="https://www.nuget.org/packages/Elastic.Apm.EntityFrameworkCore" class="ulink" target="_top">Elastic.Apm.EfCore</a> package for just Entity Framework Core monitoring.</p>
<p>If you only want to use the public agent API for manual instrumentation, use the
<a href="https://www.nuget.org/packages/Elastic.Apm" class="ulink" target="_top">Elastic.Apm</a> package.</p>
<p><span class="strong strong"><strong>Add the agent to the application</strong></span></p>
<p>For an ASP.NET Core application with the <code class="literal">Elastic.Apm.NetCoreAll</code> package,
call the <code class="literal">UseAllElasticApm</code> method in the <code class="literal">Configure</code> method within the <code class="literal">Startup.cs</code> file:</p>
<div class="pre_wrapper lang-dotnet">
<pre class="programlisting prettyprint lang-dotnet">public class Startup
{
  public void Configure(IApplicationBuilder app, IHostingEnvironment env)
  {
    app.UseAllElasticApm(Configuration);
    //…rest of the method
  }
  //…rest of the class
}</pre>
</div>
<p>Passing an <code class="literal">IConfiguration</code> instance is optional and by doing so,
the agent will read config settings through this <code class="literal">IConfiguration</code> instance, for example,
from the <code class="literal">appsettings.json</code> file:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
    "ElasticApm": {
    "SecretToken": "",
    "ServerUrls": "http://localhost:8200", //Set custom APM Server URL (default: http://localhost:8200)
    "ServiceName" : "MyApp", //allowed characters: a-z, A-Z, 0-9, -, _, and space. Default is the entry assembly of the application
  }
}</pre>
</div>
<p>If you don’t pass an <code class="literal">IConfiguration</code> instance to the agent, for example, in a non-ASP.NET Core application,
you can configure the agent with environment variables.
See the agent reference for more information.</p>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/dotnet/1.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/dotnet/1.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="node-tab-install"
       aria-labelledby="node-install"
       hidden="">
<p><span class="strong strong"><strong>Install the APM agent</strong></span></p>
<p>Install the APM agent for Node.js as a dependency to your application.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">npm install elastic-apm-node --save</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Agents are libraries that run inside of your application process. APM services are created programmatically based on the <code class="literal">serviceName</code>.
This agent supports a variety of frameworks but can also be used with your custom stack.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">// Add this to the VERY top of the first file loaded in your app
var apm = require('elastic-apm-node').start({
  // Override service name from package.json
  // Allowed characters: a-z, A-Z, 0-9, -, _, and space
  serviceName: '',

  // Use if APM Server requires a token
  secretToken: '',

  // Set custom APM Server URL (default: http://localhost:8200)
  serverUrl: ''
})</pre>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/nodejs/3.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/nodejs/3.x/advanced-setup.html" class="ulink" target="_top">Babel/ES Modules</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/nodejs/3.x/configuring-the-agent.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="php-tab-install"
       aria-labelledby="php-install"
       hidden="">
<p><span class="strong strong"><strong>Install the agent</strong></span></p>
<p>Install the PHP agent using one of the <a href="https://github.com/elastic/apm-agent-php/releases" class="ulink" target="_top">published packages</a>.</p>
<p>To use the RPM Package (RHEL/CentOS and Fedora):</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">rpm -ivh &lt;package-file&gt;.rpm</pre>
</div>
<p>To use the DEB package (Debian and Ubuntu):</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">dpkg -i &lt;package-file&gt;.deb</pre>
</div>
<p>To use the APK package (Alpine):</p>
<div class="pre_wrapper lang-php">
<pre class="programlisting prettyprint lang-php">apk add --allow-untrusted &lt;package-file&gt;.apk</pre>
</div>
<p>If you can’t find your distribution,
you can install the agent by {apm-php-ref-v}/setup.html[building it from the source].</p>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Configure your agent inside of the <code class="literal">php.ini</code> file:</p>
<div class="pre_wrapper lang-ini">
<pre class="programlisting prettyprint lang-ini">elastic_apm.server_url=http://localhost:8200
elastic_apm.secret_token=SECRET_TOKEN
elastic_apm.service_name="My-service"</pre>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
{apm-php-ref-v}/supported-technologies.html[Supported technologies]
</li>
<li class="listitem">
{apm-php-ref-v}/configuration.html[Configuration]
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="python-tab-install"
       aria-labelledby="python-install"
       hidden="">
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Django
</span>
</dt>
<dd>
<p><span class="strong strong"><strong>Install the APM agent</strong></span></p>
<p>Install the APM agent for Python as a dependency.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">$ pip install elastic-apm</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Agents are libraries that run inside of your application process.
APM services are created programmatically based on the <code class="literal">SERVICE_NAME</code>.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python"># Add the agent to the installed apps
INSTALLED_APPS = (
  'elasticapm.contrib.django',
  # ...
)

ELASTIC_APM = {
  # Set required service name. Allowed characters:
  # a-z, A-Z, 0-9, -, _, and space
  'SERVICE_NAME': '',

  # Use if APM Server requires a token
  'SECRET_TOKEN': '',

  # Set custom APM Server URL (default: http://localhost:8200)
  'SERVER_URL': '',
}

# To send performance metrics, add our tracing middleware:
MIDDLEWARE = (
  'elasticapm.contrib.django.middleware.TracingMiddleware',
  #...
)</pre>
</div>
</dd>
<dt>
<span class="term">
Flask
</span>
</dt>
<dd>
<p><span class="strong strong"><strong>Install the APM agent</strong></span></p>
<p>Install the APM agent for Python as a dependency.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python">$ pip install elastic-apm[flask]</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Agents are libraries that run inside of your application process.
APM services are created programmatically based on the <code class="literal">SERVICE_NAME</code>.</p>
<div class="pre_wrapper lang-python">
<pre class="programlisting prettyprint lang-python"># initialize using environment variables
from elasticapm.contrib.flask import ElasticAPM
app = Flask(__name__)
apm = ElasticAPM(app)

# or configure to use ELASTIC_APM in your application settings
from elasticapm.contrib.flask import ElasticAPM
app.config['ELASTIC_APM'] = {
  # Set required service name. Allowed characters:
  # a-z, A-Z, 0-9, -, _, and space
  'SERVICE_NAME': '',

  # Use if APM Server requires a token
  'SECRET_TOKEN': '',

  # Set custom APM Server URL (default: http://localhost:8200)
  'SERVER_URL': '',
}

apm = ElasticAPM(app)</pre>
</div>
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/python/5.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/python/5.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="ruby-tab-install"
       aria-labelledby="ruby-install"
       hidden="">
<p><span class="strong strong"><strong>Install the APM agent</strong></span></p>
<p>Add the agent to your Gemfile.</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby">gem 'elastic-apm'</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Ruby on Rails
</span>
</dt>
<dd>
<p>APM is automatically started when your app boots.
Configure the agent by creating the config file <code class="literal">config/elastic_apm.yml</code>:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby"># config/elastic_apm.yml:

# Set service name - allowed characters: a-z, A-Z, 0-9, -, _ and space
# Defaults to the name of your Rails app
service_name: 'my-service'

# Use if APM Server requires a token
secret_token: ''

# Set custom APM Server URL (default: http://localhost:8200)
server_url: 'http://localhost:8200'</pre>
</div>
</dd>
<dt>
<span class="term">
Rack
</span>
</dt>
<dd>
<p>For Rack or a compatible framework, like Sinatra, include the middleware in your app and start the agent.</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby"># config.ru
  require 'sinatra/base'

  class MySinatraApp &lt; Sinatra::Base
    use ElasticAPM::Middleware

    # ...
  end

  ElasticAPM.start(
    app: MySinatraApp, # required
    config_file: '' # optional, defaults to config/elastic_apm.yml
  )

  run MySinatraApp

  at_exit { ElasticAPM.stop }</pre>
</div>
<p><span class="strong strong"><strong>Create a config file</strong></span></p>
<p>Create a config file config/elastic_apm.yml:</p>
<div class="pre_wrapper lang-ruby">
<pre class="programlisting prettyprint lang-ruby"># config/elastic_apm.yml:

# Set service name - allowed characters: a-z, A-Z, 0-9, -, _ and space
# Defaults to the name of your Rack app's class.
service_name: 'my-service'

# Use if APM Server requires a token
secret_token: ''

# Set custom APM Server URL (default: http://localhost:8200)
server_url: 'http://localhost:8200'</pre>
</div>
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/ruby/4.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/ruby/4.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
      role="tabpanel"
      id="rum-tab-install"
      aria-labelledby="rum-install"
      hidden="">
<p><span class="strong strong"><strong>Enable Real User Monitoring support in APM Server</strong></span></p>
<p>APM Server disables RUM support by default.
To enable it, set <code class="literal">apm-server.rum.enabled: true</code> in your APM Server configuration file.</p>
<p><span class="strong strong"><strong>Set up the agent</strong></span></p>
<p>Once RUM support enabled, you can set up the RUM agent.
There are two ways to do this: add the agent as a dependency,
or set it up with <code class="literal">&lt;script&gt;</code> tags.</p>
<p><span class="strong strong"><strong>Set up the agent as a dependency</strong></span></p>
<p>You can install the agent as a dependency to your application with <code class="literal">npm install @elastic/apm-rum --save</code>.</p>
<p>The agent can then be initialized and configured in your application like this:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">import { init as initApm } from '@elastic/apm-rum'
var apm = initApm({

  // Set required service name (allowed characters: a-z, A-Z, 0-9, -, _, and space)
  serviceName: 'your-app-name',

  // Set custom APM Server URL (default: http://localhost:8200)
  serverUrl: '',

  // Set service version (required for source map feature)
  serviceVersion: ''
})</pre>
</div>
<p>Framework integrations, like React or Angular, have custom dependencies.
See <a href="/guide/en/apm/agent/rum-js/5.x/framework-integrations.html" class="ulink" target="_top">framework integrations</a> for more information.</p>
<p><span class="strong strong"><strong>Set up the agent with <code class="literal">&lt;script&gt;</code> tags</strong></span></p>
<p>Alternatively, you can use <code class="literal">&lt;script&gt;</code> tags to set up and configure the agent.
Add a <code class="literal">&lt;script&gt;</code> tag to the HTML page and use the <code class="literal">elasticApm</code> global object to load and initialize the agent.
Don&#8217;t forget to download the latest version of the RUM agent from
<a href="https://github.com/elastic/apm-agent-rum-js/releases/latest" class="ulink" target="_top">GitHub</a> or
<a href="https://unpkg.com/@elastic/apm-rum/dist/bundles/elastic-apm-rum.umd.min.js" class="ulink" target="_top">UNPKG</a>,
and host the file on your Server/CDN before deploying to production.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">&lt;script src="https://your-cdn-host.com/path/to/elastic-apm-rum.umd.min.js" crossorigin&gt;&lt;/script&gt;
&lt;script&gt;
  elasticApm.init({
    serviceName: 'your-app-name',
    serverUrl: 'http://localhost:8200',
  })
&lt;/script&gt;</pre>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/rum-js/5.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/rum-js/5.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
</div>
<h5><a id="view-apm-integration-data"></a>Step 5: View your data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.17/docs/en/observability/ingest-traces.asciidoc">edit</a></h5>
<p>Back in Kibana, under Observability, select APM.
You should see application performance monitoring data flowing into the Elastic Stack!</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The built-in <code class="literal">apm_user</code> role is not compatible with the APM integration
as it only provides read access to <code class="literal">apm-*</code> indices.
For a list of indices users need access to, refer to
<a href="/guide/en/apm/guide/7.17/apm-data-streams.html" class="ulink" target="_top">APM data streams</a></p>
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/kibana-apm-sample-data.png" alt="APM app with data">
</div>
</div>
<h5><a id="_whats_next_2"></a>What&#8217;s next?<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/7.17/docs/en/observability/ingest-traces.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Now that data is streaming into the Elastic Stack, take your investigation to a
deeper level! Use <a href="/observability" class="ulink" target="_top">Elastic Observability</a>
to unify your logs, metrics, uptime, and application performance data.
</li>
<li class="listitem">
Want to protect your endpoints from security threats? Try
<a href="/security" class="ulink" target="_top">Elastic Security</a>. Adding endpoint protection is
just another integration that you add to the agent policy!
</li>
<li class="listitem">
Are your eyes bleary from staring at a wall of screens?
<a href="/guide/en/observability/7.17/create-alerts.html" class="ulink" target="_top">Create alerts</a> and find out about
problems while sipping your favorite beverage poolside.
</li>
<li class="listitem">
Want Elastic to do the heavy lifting? Use machine learning to
<a href="/guide/en/observability/7.17/inspect-log-anomalies.html" class="ulink" target="_top">detect anomalies</a>.
</li>
<li class="listitem">
Got everything working like you want it? Roll out your agent policies to
other hosts by deploying Elastic Agents across your infrastructure!
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ingest-logs-metrics-uptime.html">« Ingest logs, metrics, and uptime data with Elastic Agent</a>
</span>
<span class="next">
<a href="ingest-splunk.html">Ingest data from Splunk (Experimental) »</a>
</span>
</div>
</div>
</body>
</html>
