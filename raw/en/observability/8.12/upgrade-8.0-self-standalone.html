<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upgrade a self-installation of APM Server standalone to 8.12.2 | Elastic Observability [8.12] | Elastic</title>
<meta class="elastic" name="content" content="Upgrade a self-installation of APM Server standalone to 8.12.2 | Elastic Observability [8.12]">

<link rel="home" href="index.html" title="Elastic Observability [8.12]"/>
<link rel="up" href="upgrading-to-8.x.html" title="Upgrade to version 8.12.2"/>
<link rel="prev" href="upgrading-to-8.x.html" title="Upgrade to version 8.12.2"/>
<link rel="next" href="upgrade-8.0-self-integration.html" title="Upgrade a self-installation of the APM integration to 8.12.2"/>
<meta class="elastic" name="product_version" content="8.12"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.12"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.12"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.12]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="upgrade.html">Upgrade</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="upgrading-to-8.x.html">Upgrade to version 8.12.2</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="upgrading-to-8.x.html">« Upgrade to version 8.12.2</a>
</span>
<span class="next">
<a href="upgrade-8.0-self-integration.html">Upgrade a self-installation of the APM integration to 8.12.2 »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="upgrade-8.0-self-standalone"></a>Upgrade a self-installation of APM Server standalone to 8.12.2<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/observability/apm/upgrading-to-8.x.asciidoc">edit</a></h4>
</div></div></div>

<p>This upgrade guide is for the standalone method of running APM Server.
Only use this guide if both of the following are true:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
You have a self-installation of the Elastic Stack, i.e. you&#8217;re not using Elastic Cloud.
</li>
<li class="listitem">
You&#8217;re running the APM Server binary, i.e. you haven&#8217;t switched to the Elastic APM integration.
</li>
</ul>
</div>
<h5><a id="_prerequisites_3"></a>Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/observability/apm/upgrading-to-8.x.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Prior to upgrading to version 8.12.2, Elasticsearch, Kibana,
and APM Server must be upgraded to version 7.17.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To upgrade Elasticsearch and Kibana,
see the <a href="/guide/en/elastic-stack/7.17/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a>
</li>
<li class="listitem">
To upgrade APM Server to version 7.17, see
<a href="/guide/en/apm/guide/7.17/upgrading-to-717.html" class="ulink" target="_top">upgrade to version 7.17</a>.
</li>
</ul>
</div>
</li>
<li class="listitem">
Review the APM <a class="xref" href="release-notes.html" title="Release notes">release notes</a>, <a class="xref" href="apm-breaking.html" title="Breaking Changes">breaking changes</a>,
and Observability <a href="/guide/en/observability/8.12/whats-new.html" class="ulink" target="_top">What&#8217;s new</a> content.
</li>
</ol>
</div>
<h5><a id="_upgrade_steps"></a>Upgrade steps<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.12/docs/en/observability/apm/upgrading-to-8.x.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Upgrade the Elastic Stack to version 8.12.2</strong></span></p>
<p>The Elastic Stack (Elasticsearch and Kibana) must be upgraded before APM Server.
See the <a href="/guide/en/elastic-stack/8.12/upgrading-elastic-stack.html" class="ulink" target="_top">Elastic Stack Installation and Upgrade Guide</a> for guidance.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Install the APM integration via the Fleet UI</strong></span></p>
<p>Starting in version 8.0.0, Fleet uses the APM integration to set up and manage APM index templates,
ILM policies, and ingest pipelines. APM Server will only send data to Elasticsearch <em>after</em> the APM integration has been installed.</p>
<details open>
<summary class="title"><span class="strong strong"><strong>If you have an internet connection</strong></span></summary>
<div class="content">
<p>An internet connection is required to install the APM integration via the Fleet UI in Kibana.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and select <span class="strong strong"><strong>Add integrations</strong></span> &gt; <span class="strong strong"><strong>Elastic APM</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>APM integration</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic APM</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic Agent later</strong></span>. You do not need to run an Elastic Agent to complete the setup.
</li>
</ol>
</div>
</div>
</details>
<details>
<summary class="title"><span class="strong strong"><strong>If you don&#8217;t have an internet connection</strong></span></summary>
<div class="content">
<p>If your environment has network traffic restrictions, there are other ways to install the APM integration.
See <a href="/guide/en/fleet/8.12/air-gapped.html" class="ulink" target="_top">Air-gapped environments</a> for more information.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Option 1: Update <code class="literal">kibana.yml</code>
</span>
</dt>
<dd>
<p>Update <code class="literal">kibana.yml</code> to include the following, then restart Kibana.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.fleet.packages:
- name: apm
  version: latest</pre>
</div>
<p>See <a href="/guide/en/kibana/8.12/settings.html" class="ulink" target="_top">Configure Kibana</a> to learn more about how to edit the Kibana configuration file.</p>
</dd>
<dt>
<span class="term">
Option 2: Use the Fleet API
</span>
</dt>
<dd>
<p>Use the Fleet API to install the APM integration. To be successful, this needs to be run against the Kibana
API, not the Elasticsearch API.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">POST kbn:/api/fleet/epm/packages/apm/8.12.2
{ "force": true }</pre>
</div>
<p>See <a href="/guide/en/kibana/8.12/api.html" class="ulink" target="_top">Kibana API</a> to learn more about how to use the Kibana APIs.</p>
</dd>
</dl>
</div>
</div>
</details>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Install the 8.12.2 APM Server release</strong></span></p>
<p>See <a class="xref" href="installing.html" title="Step 1: Install">install</a> to find the command that works with your system.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you install version 8.12.2 of APM Server before installing the APM integration, you will see error logs similar to the following. You must go back and install the APM integration before data can be ingested into Elasticsearch.</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">...
{"log.level":"error","@timestamp":"2022-01-19T10:45:34.923+0800","log.logger":"beater","log.origin":{"file.name":"beater/waitready.go","file.line":62},"message":"precondition 'apm integration installed' failed: error querying Elasticsearch for integration index templates: unexpected HTTP status: 404 Not Found ({\"error\":{\"root_cause\":[{\"type\":\"resource_not_found_exception\",\"reason\":\"index template matching [traces-apm.sampled] not found\"}],\"type\":\"resource_not_found_exception\",\"reason\":\"index template matching [traces-apm.sampled] not found\"},\"status\":404}): to remediate, please install the apm integration: https://ela.st/apm-integration-quickstart","service.name":"apm-server","ecs.version":"1.6.0"}
{"log.level":"error","@timestamp":"2022-01-19T10:45:37.461+0800","log.logger":"beater","log.origin":{"file.name":"beater/waitready.go","file.line":62},"message":"precondition 'apm integration installed' failed: error querying Elasticsearch for integration index templates: unexpected HTTP status: 404 Not Found ({\"error\":{\"root_cause\":[{\"type\":\"resource_not_found_exception\",\"reason\":\"index template matching [logs-apm.error] not found\"}],\"type\":\"resource_not_found_exception\",\"reason\":\"index template matching [logs-apm.error] not found\"},\"status\":404}): to remediate, please install the apm integration: https://ela.st/apm-integration-quickstart","service.name":"apm-server","ecs.version":"1.6.0"}
...</pre>
</div>
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Review your configuration file</strong></span></p>
<p>Some settings have been removed or changed. You may need to update your <code class="literal">apm-server.yml</code> configuration
file prior to starting the APM Server.
See <a class="xref" href="directory-layout.html" title="Installation layout">Installation layout</a> for help in locating this file,
and <a class="xref" href="configuring-howto-apm-server.html" title="Configure">Configure</a> for a list of all available configuration options.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Start the APM Server</strong></span></p>
<p>To start the APM Server, run:</p>
<div class="pre_wrapper lang-bash">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-bash">./apm-server -e</pre>
</div>
<p>Additional details are available in <a class="xref" href="apm-server-starting.html" title="Step 3: Start">start the APM Server</a>.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>(Optional) Upgrade to the APM integration</strong></span></p>
<p>Got time for one more upgrade?
See <a class="xref" href="upgrade-to-apm-integration.html" title="Switch to the Elastic APM integration">Switch to the Elastic APM integration</a>.</p>
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="upgrading-to-8.x.html">« Upgrade to version 8.12.2</a>
</span>
<span class="next">
<a href="upgrade-8.0-self-integration.html">Upgrade a self-installation of the APM integration to 8.12.2 »</a>
</span>
</div>
</div>
</body>
</html>
