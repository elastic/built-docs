<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>API keys | Elastic Observability [8.17] | Elastic</title>
<meta class="elastic" name="content" content="API keys | Elastic Observability [8.17]">

<link rel="home" href="index.html" title="Elastic Observability [8.17]"/>
<link rel="up" href="apm-secure-agent-communication.html" title="Secure communication with APM agents"/>
<link rel="prev" href="apm-agent-tls.html" title="APM agent TLS communication"/>
<link rel="next" href="apm-secret-token.html" title="Secret token"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.17"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.17"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="apm-agent-tls.html">« APM agent TLS communication</a>
</span>
<span class="next">
<a href="apm-secret-token.html">Secret token »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="application-and-service-monitoring.html">Application and service monitoring</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-securing-apm-server.html">Use APM securely</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-secure-agent-communication.html">Secure communication with APM agents</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>API keys</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/solutions/observability/apm/api-keys">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="apm-api-key"></a>API keys</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
</div></div></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>API keys are sent as plain-text,
so they only provide security when used in combination with <a class="xref" href="apm-agent-tls.html" title="APM agent TLS communication">TLS</a>.</p>
</div>
</div>
<p>When enabled, API keys are used to authorize requests to the APM Server.
API keys are not applicable for APM agents running on clients, like the RUM agent,
as there is no way to prevent them from being publicly exposed.</p>
<p>You can assign one or more unique privileges to each API key:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Agent configuration</strong></span> (<code class="literal">config_agent:read</code>): Required for agents to read
<a class="xref" href="apm-agent-configuration.html" title="APM agent central configuration">Agent configuration remotely</a>.
</li>
<li class="listitem">
<span class="strong strong"><strong>Ingest</strong></span> (<code class="literal">event:write</code>): Required for ingesting agent events.
</li>
</ul>
</div>
<p>To secure the communication between APM Agents and the APM Server with API keys,
make sure <a class="xref" href="apm-agent-tls.html" title="APM agent TLS communication">TLS</a> is enabled, then complete these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="apm-api-key.html#apm-enable-api-key" title="Enable API keys">Enable API keys</a>
</li>
<li class="listitem">
<a class="xref" href="apm-api-key.html#apm-create-api-key-user" title="Create an API key user in Kibana">Create an API key user</a>
</li>
<li class="listitem">
<a class="xref" href="apm-api-key.html#apm-create-an-api-key" title="Create an API key in the Applications UI">Create an API key in Kibana</a>
</li>
<li class="listitem">
<a class="xref" href="apm-api-key.html#apm-agent-api-key" title="Set the API key in your APM agents">Set the API key in your APM agents</a>
</li>
</ol>
</div>
<div class="position-relative"><h7><a id="apm-enable-api-key"></a>Enable API keys</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<div class="tabs" data-tab-group="ts">
  <div role="tablist" aria-label="tls">
    <button role="tab"
            aria-selected="true"
            aria-controls="fm-tab-ts"
            id="fm-ts">
      Fleet-managed
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="binary-tab-ts"
            id="binary-ts"
            tabindex="-1">
      APM Server binary
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="fm-tab-ts"
       aria-labelledby="fm-ts">
<p>Enable API key authorization in the <a class="xref" href="apm-agent-auth.html#apm-api-key-auth-settings" title="API key authentication options">API key authentication options</a>.
You should also set a limit on the number of unique API keys that APM Server allows per minute;
this value should be the number of unique API keys configured in your monitored services.</p>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="binary-tab-ts"
       aria-labelledby="binary-ts"
       hidden="">
<p>API keys are disabled by default. Enable and configure this feature in the <code class="literal">apm-server.auth.api_key</code>
section of the <code class="literal">apm-server.yml</code> configuration file.</p>
<p>At a minimum, you must enable API keys,
and should set a limit on the number of unique API keys that APM Server allows per minute.
Here&#8217;s an example <code class="literal">apm-server.auth.api_key</code> config using 50 unique API keys:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">apm-server.auth.api_key.enabled: true <a id="CO45-1"></a><i class="conum" data-value="1"></i>
apm-server.auth.api_key.limit: 50 <a id="CO45-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO45-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Enables API keys</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO45-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Restricts the number of unique API keys that Elasticsearch allows each minute.
This value should be the number of unique API keys configured in your monitored services.</p>
</td>
</tr>
</table>
</div>
<p>All other configuration options are described in <a class="xref" href="apm-api-key.html" title="API keys">API keys</a>.</p>
  </div>
</div>
<div class="position-relative"><h7><a id="apm-create-api-key-user"></a>Create an API key user in Kibana</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<p>API keys can only have the same or lower access rights than the user that creates them.
Instead of using a superuser account to create API keys, you can create a role with the minimum required
privileges.</p>
<p>The user creating an APM agent API key must have at least the <code class="literal">manage_own_api_key</code> cluster privilege
and the APM application-level privileges that it wishes to grant.
In addition, when creating an API key from the Applications UI,
you&#8217;ll need the appropriate Kibana Space and Feature privileges.</p>
<p>The example below uses the Kibana <a href="/guide/en/kibana/8.17/role-management-api.html" class="ulink" target="_top">role management API</a>
to create a role named <code class="literal">apm_agent_key_role</code>.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">POST /_security/role/apm_agent_key_role
{
   "cluster": [ "manage_own_api_key" ],
   "applications": [
      {
         "application":"apm",
         "privileges":[
            "event:write",
            "config_agent:read"
         ],
         "resources":[ "*" ]
      },
      {
         "application":"kibana-.kibana",
         "privileges":[ "feature_apm.all" ],
         "resources":[ "space:default" ] <a id="CO46-1"></a><i class="conum" data-value="1"></i>
      }
   ]
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO46-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This example assigns privileges for the default space.</p>
</td>
</tr>
</table>
</div>
<p>Assign the newly created <code class="literal">apm_agent_key_role</code> role to any user that wishes to create APM agent API keys.</p>
<div class="position-relative"><h7><a id="apm-create-an-api-key"></a>Create an API key in the Applications UI</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<p>The Applications UI has a built-in workflow that you can use to easily create and view APM agent API keys.
Only API keys created in the Applications UI will show up here.</p>
<p>Using a superuser account, or a user with the role created in the previous step,
In Kibana, find <span class="strong strong"><strong>Applications</strong></span> in the main menu or use the <a href="/guide/en/kibana/8.17/introduction.html#kibana-navigation-search" class="ulink" target="_top">global search field</a>. Go to <span class="strong strong"><strong>Settings</strong></span> → <span class="strong strong"><strong>Agent keys</strong></span>.
Enter a name for your API key and select at least one privilege.</p>
<p>For example, to create an API key that can be used to ingest APM events
and read agent central configuration, select <code class="literal">config_agent:read</code> and <code class="literal">event:write</code>.</p>
<p>Click <span class="strong strong"><strong>Create APM Agent key</strong></span> and copy the Base64 encoded API key.
You will need this for the next step, and you will not be able to view it again.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/apm-ui-api-key.png" alt="Applications UI API key">
</div>
</div>
<div class="position-relative"><h7><a id="apm-agent-api-key"></a>Set the API key in your APM agents</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<p>You can now apply your newly created API keys in the configuration of each of your APM agents.
See the relevant agent documentation for additional information:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Android</strong></span>: <a href="/guide/en/apm/agent/android/current/configuration.html" class="ulink" target="_top"><code class="literal">apiKey</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Go agent</strong></span>: <a href="/guide/en/apm/agent/go/current/configuration.html#config-api-key" class="ulink" target="_top"><code class="literal">ELASTIC_APM_API_KEY</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>.NET agent</strong></span>: <a href="/guide/en/apm/agent/dotnet/current/config-reporter.html#config-api-key" class="ulink" target="_top"><code class="literal">ApiKey</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>iOS</strong></span>: <a href="/guide/en/apm/agent/swift/current/configuration.html#withApiKey" class="ulink" target="_top"><code class="literal">withApiKey</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Java agent</strong></span>: <a href="/guide/en/apm/agent/java/current/config-reporter.html#config-api-key" class="ulink" target="_top"><code class="literal">api_key</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Node.js agent</strong></span>: <a href="/guide/en/apm/agent/nodejs/current/configuration.html#api-key" class="ulink" target="_top"><code class="literal">apiKey</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>PHP agent</strong></span>: <a href="/guide/en/apm/agent/php/1.x/configuration-reference.html#config-api-key" class="ulink" target="_top"><code class="literal">api_key</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Python agent</strong></span>: <a href="/guide/en/apm/agent/python/current/configuration.html#config-api-key" class="ulink" target="_top"><code class="literal">api_key</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Ruby agent</strong></span>: <a href="/guide/en/apm/agent/ruby/current/configuration.html#config-api-key" class="ulink" target="_top"><code class="literal">api_key</code></a>
</li>
</ul>
</div>
<div class="position-relative"><h7><a id="apm-configure-api-key-alternative"></a>Alternate API key creation methods</h7><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<p>API keys can also be created and validated outside of Kibana:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="apm-api-key.html#apm-create-api-key-workflow-apm-server" title="APM Server API key workflow">APM Server API key workflow</a>
</li>
<li class="listitem">
<a class="xref" href="apm-api-key.html#apm-create-api-key-workflow-es" title="Elasticsearch API key workflow">Elasticsearch API key workflow</a>
</li>
</ul>
</div>
<div class="position-relative"><h8><a id="apm-create-api-key-workflow-apm-server"></a>APM Server API key workflow</h8><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<p>This API creation method only works with the APM Server binary.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p class="admon_title">Deprecated in 8.6.0.</p>
<p>Users should create API Keys through Kibana or the Elasticsearch REST API</p>
</div>
</div>
<p>APM Server provides a command line interface for creating, retrieving, invalidating, and verifying API keys.
Keys created using this method can only be used for communication with APM Server.</p>
<div class="position-relative"><h9><a id="apm-create-api-key-subcommands"></a><code class="literal">apikey</code> subcommands</h9><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">create</code></strong></span>
</span>
</dt>
<dd>
<p>
Create an API Key with the specified privilege(s). No required flags.
</p>
<p>The user requesting to create an API Key needs to have APM privileges used by the APM Server.
A superuser, by default, has these privileges.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Expand for more information on assigning these privileges to other users</strong></span></summary>
<div class="content">
<p>To create an APM Server user with the required privileges for creating and managing API keys:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create an <span class="strong strong"><strong>API key role</strong></span>, called something like <code class="literal">apm_api_key</code>,
that has the following <code class="literal">cluster</code> level privileges:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Privilege</th>
<th align="left" valign="top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">manage_own_api_key</code></p></td>
<td align="left" valign="top"><p>Allow APM Server to create, retrieve, and invalidate API keys</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
<p>Depending on what the <span class="strong strong"><strong>API key role</strong></span> will be used for,
also assign the appropriate <code class="literal">apm</code> application-level privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To <span class="strong strong"><strong>receive Agent configuration</strong></span>, assign <code class="literal">config_agent:read</code>.
</li>
<li class="listitem">
To <span class="strong strong"><strong>ingest agent data</strong></span>, assign <code class="literal">event:write</code>.
</li>
<li class="listitem">
To <span class="strong strong"><strong>upload source maps</strong></span>, assign <code class="literal">sourcemap:write</code>.
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</details>
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">info</code></strong></span>
</span>
</dt>
<dd>
Query API Key(s). <code class="literal">--id</code> or <code class="literal">--name</code> required.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">invalidate</code></strong></span>
</span>
</dt>
<dd>
Invalidate API Key(s). <code class="literal">--id</code> or <code class="literal">--name</code> required.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">verify</code></strong></span>
</span>
</dt>
<dd>
Check if a credentials string has the given privilege(s).
 <code class="literal">--credentials</code> required.
</dd>
</dl>
</div>
<div class="position-relative"><h9><a id="apm-create-api-key-privileges"></a>Privileges</h9><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<p>If privileges are not specified at creation time, the created key will have all privileges.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">--agent-config</code> grants the <code class="literal">config_agent:read</code> privilege
</li>
<li class="listitem">
<code class="literal">--ingest</code> grants the <code class="literal">event:write</code> privilege
</li>
<li class="listitem">
<code class="literal">--sourcemap</code> grants the <code class="literal">sourcemap:write</code> privilege
</li>
</ul>
</div>
<div class="position-relative"><h9><a id="apm-create-api-key-workflow"></a>Create an API key</h9><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<p>Create an API key with the <code class="literal">create</code> subcommand.</p>
<p>The following example creates an API key with a <code class="literal">name</code> of <code class="literal">java-001</code>,
and gives the "agent configuration" and "ingest" privileges.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server apikey create --ingest --agent-config --name java-001</pre>
</div>
<p>The response will look similar to this:</p>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">Name ........... java-001
Expiration ..... never
Id ............. qT4tz28B1g59zC3uAXfW
API Key ........ rH55zKd5QT6wvs3UbbkxOA (won't be shown again)
Credentials .... cVQ0dHoyOEIxZzU5ekMzdUFYZlc6ckg1NXpLZDVRVDZ3dnMzVWJia3hPQQ== (won't be shown again)</pre>
</div>
<p>You should always verify the privileges of an API key after creating it.
Verification can be done using the <code class="literal">verify</code> subcommand.</p>
<p>The following example verifies that the <code class="literal">java-001</code> API key has the "agent configuration" and "ingest" privileges.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server apikey verify --agent-config --ingest --credentials cVQ0dHoyOEIxZzU5ekMzdUFYZlc6ckg1NXpLZDVRVDZ3dnMzVWJia3hPQQ==</pre>
</div>
<p>If the API key has the requested privileges, the response will look similar to this:</p>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">Authorized for privilege "event:write"...:          Yes
Authorized for privilege "config_agent:read"...:    Yes</pre>
</div>
<p>To invalidate an API key, use the <code class="literal">invalidate</code> subcommand.
Due to Elasticsearch caching, there may be a delay between when this subcommand is executed and when it takes effect.</p>
<p>The following example invalidates the <code class="literal">java-001</code> API key.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server apikey invalidate --name java-001</pre>
</div>
<p>The response will look similar to this:</p>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">Invalidated keys ... qT4tz28B1g59zC3uAXfW
Error count ........ 0</pre>
</div>
<p>A full list of <code class="literal">apikey</code> subcommands and flags is available in the <a class="xref" href="apm-command-line-options.html#apm-apikey-command" title="apikey command">API key command reference</a>.</p>
<div class="position-relative"><h8><a id="apm-create-api-key-workflow-es"></a>Elasticsearch API key workflow</h8><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.17/docs/en/observability/apm/security/apm-agents/api-keys.asciidoc">edit</a></div>
<p>It is also possible to create API keys using the Elasticsearch
<a href="/guide/en/elasticsearch/reference/8.17/security-api-create-api-key.html" class="ulink" target="_top">create API key API</a>.</p>
<p>This example creates an API key named <code class="literal">java-002</code>:</p>
<div class="pre_wrapper lang-kibana">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-kibana">POST /_security/api_key
{
  "name": "java-002", <a id="CO47-1"></a><i class="conum" data-value="1"></i>
  "expiration": "1d", <a id="CO47-2"></a><i class="conum" data-value="2"></i>
  "role_descriptors": {
    "apm": {
      "applications": [
        {
          "application": "apm",
          "privileges": ["sourcemap:write", "event:write", "config_agent:read"], <a id="CO47-3"></a><i class="conum" data-value="3"></i>
          "resources": ["*"]
        }
      ]
    }
  }
}</pre>
</div>
<div class="kibana_widget" data-snippet="snippets/18.kibana"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO47-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The name of the API key</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO47-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The expiration time of the API key</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO47-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Any assigned privileges</p>
</td>
</tr>
</table>
</div>
<p>The response will look similar to this:</p>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
  "id" : "GnrUT3QB7yZbSNxKET6d",
  "name" : "java-002",
  "expiration" : 1599153532262,
  "api_key" : "RhHKisTmQ1aPCHC_TPwOvw"
}</pre>
</div>
<p>The <code class="literal">credential</code> string, which is what agents use to communicate with APM Server,
is a base64 encoded representation of the API key&#8217;s <code class="literal">id:api_key</code>.
It can be created like this:</p>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">echo -n GnrUT3QB7yZbSNxKET6d:RhHKisTmQ1aPCHC_TPwOvw | base64</pre>
</div>
<p>You can verify your API key has been base64-encoded correctly with the
<a href="/guide/en/elasticsearch/reference/8.17/security-api-authenticate.html" class="ulink" target="_top">Authenticate API</a>:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">curl -H "Authorization: ApiKey R0gzRWIzUUI3eVpiU054S3pYSy06bXQyQWl4TlZUeEcyUjd4cUZDS0NlUQ==" localhost:9200/_security/_authenticate</pre>
</div>
<p>If the API key has been encoded correctly, you&#8217;ll see a response similar to the following:</p>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">{
   "username":"1325298603",
   "roles":[],
   "full_name":null,
   "email":null,
   "metadata":{
      "saml_nameid_format":"urn:oasis:names:tc:SAML:2.0:nameid-format:transient",
      "saml(http://saml.elastic-cloud.com/attributes/principal)":[
         "1325298603"
      ],
      "saml_roles":[
         "superuser"
      ],
      "saml_principal":[
         "1325298603"
      ],
      "saml_nameid":"_7b0ab93bbdbc21d825edf7dca9879bd8d44c0be2",
      "saml(http://saml.elastic-cloud.com/attributes/roles)":[
         "superuser"
      ]
   },
   "enabled":true,
   "authentication_realm":{
      "name":"_es_api_key",
      "type":"_es_api_key"
   },
   "lookup_realm":{
      "name":"_es_api_key",
      "type":"_es_api_key"
   }
}</pre>
</div>
<p>You can then use the APM Server CLI to verify that the API key has the requested privileges:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">apm-server apikey verify --credentials R25yVVQzUUI3eVpiU054S0VUNmQ6UmhIS2lzVG1RMWFQQ0hDX1RQd092dw==</pre>
</div>
<p>If the API key has the requested privileges, the response will look similar to this:</p>
<div class="pre_wrapper lang-console-result">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console-result">Authorized for privilege "config_agent:read"...:  Yes
Authorized for privilege "event:write"...:        Yes
Authorized for privilege "sourcemap:write"...:    Yes</pre>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="apm-agent-tls.html">« APM agent TLS communication</a>
</span>
<span class="next">
<a href="apm-secret-token.html">Secret token »</a>
</span>
</div>
</body>
</html>
