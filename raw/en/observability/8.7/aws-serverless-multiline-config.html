<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="Learn configuration options for Elastic Serverless Forwarder and how to transform your AWS data as it is collected from Amazon Web Services (AWS).">
<meta name="keywords" content="serverless">
<title>Configuration options | Observability Guide [8.7] | Elastic</title>
<meta class="elastic" name="content" content="Configuration options | Observability Guide [8.7]">

<link rel="home" href="index.html" title="Observability Guide [8.7]"/>
<link rel="up" href="aws-serverless-manage-multiline-messages.html" title="Manage multiline messages"/>
<link rel="prev" href="aws-serverless-manage-multiline-messages.html" title="Manage multiline messages"/>
<link rel="next" href="aws-serverless-multiline-config-examples.html" title="Examples of multiline configuration"/>
<meta class="elastic" name="product_version" content="8.7"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.7"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.7"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="aws-serverless-manage-multiline-messages.html">« Manage multiline messages</a>
</span>
<span class="next">
<a href="aws-serverless-multiline-config-examples.html">Examples of multiline configuration »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Observability Guide [8.7]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="add-observability-data.html">Send data to Elasticsearch</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="aws-elastic-serverless-forwarder.html">Elastic Serverless Forwarder for AWS</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="aws-elastic-serverless-forwarder-configuration.html">Configuration options for Elastic Serverless Forwarder</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="aws-serverless-manage-multiline-messages.html">Manage multiline messages</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configuration options</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.7/docs/en/observability/aws-elastic-serverless-forwarder-configuration.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h5 class="title"><a id="aws-serverless-multiline-config"></a>Configuration options</h5><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/observability-docs/edit/8.7/docs/en/observability/aws-elastic-serverless-forwarder-configuration.asciidoc">edit</a></div>
</div></div></div>
<p>You can specify the following options for a specific input in the <code class="literal">config.yaml</code> file to control how the Elastic Serverless Forwarder deals with messages that span multiple lines.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: "s3-sqs"
    id: "arn:aws:sqs:%REGION%:%ACCOUNT%:%QUEUENAME%"
    multiline:
      type: pattern
      pattern: '^\\['
      negate: true
      match: after
    outputs:
      - type: "elasticsearch"
        args:
          elasticsearch_url: "arn:aws:secretsmanager:eu-central-1:123456789:secret:es_url"
          username: "arn:aws:secretsmanager:eu-west-1:123456789:secret:es_secrets:username"
          password: "arn:aws:secretsmanager:eu-west-1:123456789:secret:es_secrets:password"
          es_datastream_name: "logs-generic-default"</pre>
</div>
<p>The forwarder takes all the lines that do not start with <code class="literal">[</code> and combines them with the previous line that does. For example, you could use this configuration to join the following lines of a multiline message into a single event:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell">[beat-logstash-some-name-832-2015.11.28] IndexNotFoundException[no such index]
    at org.elasticsearch.cluster.metadata.IndexNameExpressionResolver$WildcardExpressionResolver.resolve(IndexNameExpressionResolver.java:566)
    at org.elasticsearch.cluster.metadata.IndexNameExpressionResolver.concreteIndices(IndexNameExpressionResolver.java:133)
    at org.elasticsearch.cluster.metadata.IndexNameExpressionResolver.concreteIndices(IndexNameExpressionResolver.java:77)
    at org.elasticsearch.action.admin.indices.delete.TransportDeleteIndexAction.checkBlock(TransportDeleteIndexAction.java:75)</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Note that you should escape the opening square bracket (<code class="literal">[</code>) in the regular expression, because it specifies a character class i.e. a set of characters that you wish to match. You also have to escape the backslash (<code class="literal">\</code>) used for escaping the opening square bracket as raw strings are not used. Thus, <code class="literal">^\\[</code> will produce the required regular expression upon compiling.</p>
</div>
</div>
<p><code class="literal">inputs.[].multiline.type</code> defines which aggregation method to use. The default is <code class="literal">pattern</code>. The other options are <code class="literal">count</code>, which enables you to aggregate a constant number of lines, and <code class="literal">while_pattern</code>, which aggregates lines by pattern without matching options.</p>
<p><code class="literal">inputs.[].multiline.pattern</code> differs from the patterns supported by Logstash. See <a href="https://docs.python.org/3.9/library/re.html#regular-expression-syntax" class="ulink" target="_top">Python&#8217;s 3.9 regular expression syntax</a> for a list of supported regexp patterns. Depending on how you configure other multiline options, lines that match the specified regular expression are considered either continuations of a previous line or the start of a new multiline event.</p>
<p><code class="literal">inputs.[].multiline.negate</code> defines whether the pattern is negated. The default is <code class="literal">false</code>. This setting works only with <code class="literal">pattern</code> and <code class="literal">while_pattern</code> types.</p>
<p><code class="literal">inputs.[].multiline.match</code> changes the grouping of multiple lines according to the schema below (works only with <code class="literal">pattern</code> type):</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Setting for <code class="literal">negate</code></p></td>
<td align="left" valign="top"><p>Setting for <code class="literal">match</code></p></td>
<td align="left" valign="top"><p>Result</p></td>
<td align="left" valign="top"><p>Example <code class="literal">pattern: ^b</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
<td align="left" valign="top"><p><code class="literal">after</code></p></td>
<td align="left" valign="top"><p>Consecutive lines that match the pattern are appended to the previous line that doesn’t match.</p></td>
<td align="left" valign="top"><p><span class="image"><img src="images/false-after-multi.png" alt="Lines a b b c b b become &quot;abb&quot; and &quot;cbb&quot;"></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
<td align="left" valign="top"><p><code class="literal">before</code></p></td>
<td align="left" valign="top"><p>Consecutive lines that match the pattern are prepended to the next line that doesn’t match.</p></td>
<td align="left" valign="top"><p><span class="image"><img src="images/false-after-multi.png" alt="Lines b b a b b c become &quot;bba&quot; and &quot;bbc&quot;"></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
<td align="left" valign="top"><p><code class="literal">after</code></p></td>
<td align="left" valign="top"><p>Consecutive lines that don’t match the pattern are appended to the previous line that does match.</p></td>
<td align="left" valign="top"><p><span class="image"><img src="images/true-after-multi.png" alt="Lines b a c b d e become &quot;bac&quot; and &quot;bde&quot;"></span></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
<td align="left" valign="top"><p><code class="literal">before</code></p></td>
<td align="left" valign="top"><p>Consecutive lines that don’t match the pattern are prepended to the next line that does match.</p></td>
<td align="left" valign="top"><p><span class="image"><img src="images/true-before-multi.png" alt="Lines a c b d e b become &quot;acb&quot; and &quot;deb&quot;"></span></p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">after</code> setting is equivalent to <code class="literal">previous</code> in <a href="/guide/en/logstash/current/plugins-codecs-multiline.html" class="ulink" target="_top">Logstash</a>, and <code class="literal">before</code> is equivalent to <code class="literal">next</code>.</p>
</div>
</div>
<p><code class="literal">inputs.[].multiline.flush_pattern</code> specifies a regular expression, in which the current multiline will be flushed from memory, ending the multiline-message. Works only with <code class="literal">pattern</code> type.</p>
<p><code class="literal">inputs.[].multiline.max_lines</code> defines the maximum number of lines that can be combined into one event. If the multiline message contains more than <code class="literal">max_lines</code>, any additional lines are truncated from the event. The default is <code class="literal">500</code>.</p>
<p><code class="literal">inputs.[].multiline.max_bytes</code> defines the maximum number of bytes that can be combined into one event. If the multiline message contains more than <code class="literal">max_bytes</code>, any additional content is truncated from the event. The default is <code class="literal">10485760</code>.</p>
<p><code class="literal">inputs.[].multiline.count_lines</code> defines the number of lines to aggregate into a single event. Works only with <code class="literal">count</code> type.</p>
<p><code class="literal">inputs.[].multiline.skip_newline</code> defined whether multiline events must be concatenated, stripping the line separator. If set to <code class="literal">true</code>, the line separator will be stripped. The default is <code class="literal">false</code>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-serverless-manage-multiline-messages.html">« Manage multiline messages</a>
</span>
<span class="next">
<a href="aws-serverless-multiline-config-examples.html">Examples of multiline configuration »</a>
</span>
</div>
</body>
</html>
