<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Monitor Virtual Private Cloud (VPC) Flow Logs | Elastic Observability [8.13] | Elastic</title>
<meta class="elastic" name="content" content="Monitor Virtual Private Cloud (VPC) Flow Logs | Elastic Observability [8.13]">

<link rel="home" href="index.html" title="Elastic Observability [8.13]"/>
<link rel="up" href="monitor-aws-firehose.html" title="Monitor Amazon Web Services (AWS) with Amazon Data Firehose"/>
<link rel="prev" href="monitor-aws-firehose.html" title="Monitor Amazon Web Services (AWS) with Amazon Data Firehose"/>
<link rel="next" href="monitor-aws-esf.html" title="Monitor Amazon Web Services (AWS) with Elastic Serverless Forwarder"/>
<meta class="elastic" name="product_version" content="8.13"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.13"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.13"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [8.13]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="monitor-amazon-web-services.html">Amazon Web Services (AWS) monitoring</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="monitor-aws-firehose.html">Monitor Amazon Web Services (AWS) with Amazon Data Firehose</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="monitor-aws-firehose.html">« Monitor Amazon Web Services (AWS) with Amazon Data Firehose</a>
</span>
<span class="next">
<a href="monitor-aws-esf.html">Monitor Amazon Web Services (AWS) with Elastic Serverless Forwarder »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="monitor-amazon-vpc-flow-logs"></a>Monitor Virtual Private Cloud (VPC) Flow Logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.13/docs/en/observability/cloud-monitoring/aws/monitor-aws-vpc-flow-logs.asciidoc">edit</a></h3>
</div></div></div>

<p>In this section, you&#8217;ll learn how to monitor and analyze the VPC flow logs you sent to Elastic with Amazon Data Firehose. You can choose among the following monitoring options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic Analytics Discover capabilities to manually analyze the data
</li>
<li class="listitem">
Elastic Observability’s anomaly feature to identify anomalies in the logs
</li>
<li class="listitem">
Out-of-the-box dashboard to further analyze the data
</li>
</ul>
</div>
<h5><a id="aws-firehose-prerequisites"></a>Before you begin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.13/docs/en/observability/cloud-monitoring/aws/monitor-aws-vpc-flow-logs.asciidoc">edit</a></h5>
<p>We assume that you already have:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A deployment using our hosted Elasticsearch Service on <a href="/cloud/elasticsearch-service/signup?page=docs&amp;placement=docs-body" class="ulink" target="_top">Elastic Cloud</a>. The deployment includes an Elasticsearch cluster for storing and searching your data, and Kibana for visualizing and managing your data. AWS Kinesis Data Firehose works with Elastic Stack version 7.17 or greater, running on Elastic Cloud only.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure the deployment is on AWS, because the Firehose delivery stream connects specifically to an endpoint that needs to be on AWS.</p>
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An AWS account with permissions to pull the necessary data from AWS.
</li>
<li class="listitem">
VPC flow logs enabled for the VPC where the application is deployed and configured to send data to Kinesis Data Firehose.
</li>
<li class="listitem">
A <a href="https://github.com/aws-samples/aws-three-tier-web-architecture-workshop" class="ulink" target="_top">three-tier web architecture in AWS</a>, which can ingest metrics from <a href="https://docs.elastic.co/integrations/aws" class="ulink" target="_top">several AWS services</a>.
</li>
</ul>
</div>
<h5><a id="aws-firehose-discover"></a>Use Elastic Analytics Discover to manually analyze data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.13/docs/en/observability/cloud-monitoring/aws/monitor-aws-vpc-flow-logs.asciidoc">edit</a></h5>
<p>In Elastic Analytics, you can search and filter your data, get information about the structure of the fields, and display your findings in a visualization. You can also customize and save your searches and place them on a dashboard. For more information, check the <a href="/guide/en/kibana/8.13/discover.html" class="ulink" target="_top">Discover</a> documentation.</p>
<p>For example, for your VPC flow logs you want to know:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
How many logs were accepted or rejected
</li>
<li class="listitem">
Where potential security violations occur (source IPs from outside the VPC)
</li>
<li class="listitem">
What port is generally being queried
</li>
</ul>
</div>
<p>You can filter the logs on the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Delivery stream name: <code class="literal">AWS-3-TIER-APP-VPC-LOGS</code>
</li>
<li class="listitem">
VPC flow log action: <code class="literal">REJECT</code>
</li>
<li class="listitem">
Time frame: 5 hours
</li>
<li class="listitem">
VPC network interface: Webserver 1 and Webserver 2 interfaces
</li>
</ul>
</div>
<p>You want to see what IP addresses are trying to hit your web servers. Then, you want to understand which IP addresses you’re getting the most <code class="literal">REJECT</code> actions from. You can expand the <code class="literal">source.ip</code> field and quickly get a breakdown that shows <code class="literal">185.156.73.54</code> is the most rejected for the last 3 or more hours you’ve turned on VPC flow logs.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="discover-ip-addresses.png" alt="IP addresses in Discover">
</div>
</div>
<p>You can also create a visualization by choosing <span class="strong strong"><strong>Visualize</strong></span>. You get the following donut chart, which you can add to a dashboard.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="discover-visualize-chart.png" alt="Visualization chart in Discover">
</div>
</div>
<p>On top of the IP addresses, you also want to know what port is being hit on your web servers.</p>
<p>If you select the destination port field, the pop-up shows that port <code class="literal">8081</code> is being targeted. This port is generally used for the administration of Apache Tomcat. This is a potential security issue, however port <code class="literal">8081</code> is turned off for outside traffic, hence the <code class="literal">REJECT</code>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="discover-destination-port.png" alt="Destination port in Discover">
</div>
</div>
<h5><a id="aws-firehose-ml"></a>Use Machine Learning to detect anomalies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.13/docs/en/observability/cloud-monitoring/aws/monitor-aws-vpc-flow-logs.asciidoc">edit</a></h5>
<p>Elastic Observability provides the ability to detect anomalies on logs using Machine Learning (ML). To learn more about how to use the ML analysis with your logs, check the <a href="/guide/en/kibana/8.13/xpack-ml.html" class="ulink" target="_top">Machine learning</a> documentation. You can select the following options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Log rate: Automatically detects anomalous log entry rates
</li>
<li class="listitem">
Categorization: Automatically categorizes log messages
</li>
</ul>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="ml-anomalies-detection.png" alt="Anomalies detection with ML">
</div>
</div>
<p>For your VPC flow log, you can enable both features. When you look at what was detected for anomalous log entry rates, you get the following results:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="ml-anomalies-results.png" alt="Anomalies results with ML">
</div>
</div>
<p>Elastic detected a spike in logs when you turned on VPC flow logs for your application. The rate change is being detected because you’re also ingesting VPC flow logs from another application.</p>
<p>You can drill down into this anomaly with ML and analyze further.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="ml-anomalies-explorer.png" alt="Anomalies explorer in ML">
</div>
</div>
<p>Because you know that a spike exists, you can also use the Elastic AIOps Labs Explain Log Rate Spikes capability. By grouping them, you can see what is causing some of the spikes.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="ml-spike.png" alt="Spikes in ML">
</div>
</div>
<h5><a id="aws-firehose-dashboard"></a>Use the VPC flow log dashboard<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.13/docs/en/observability/cloud-monitoring/aws/monitor-aws-vpc-flow-logs.asciidoc">edit</a></h5>
<p>Elastic provides an out-of-the-box dashboard to show the top IP addresses hitting your VPC, where they are coming from geographically, the time series of the flows, and a summary of VPC flow log rejects within the time frame.</p>
<p>You can enhance this baseline dashboard with the visualizations you find in Discover.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="flow-log-dashboard.png" alt="Flow logs dashboard">
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="monitor-aws-firehose.html">« Monitor Amazon Web Services (AWS) with Amazon Data Firehose</a>
</span>
<span class="next">
<a href="monitor-aws-esf.html">Monitor Amazon Web Services (AWS) with Elastic Serverless Forwarder »</a>
</span>
</div>
</div>
</body>
</html>
