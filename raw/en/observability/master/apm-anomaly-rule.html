<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>APM Anomaly rule | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="APM Anomaly rule | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="create-alerts-rules.html" title="Create and manage rules"/>
<link rel="prev" href="create-alerts-rules.html" title="Create and manage rules"/>
<link rel="next" href="custom-threshold-alert.html" title="Create a custom threshold rule"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="create-alerts-rules.html">« Create and manage rules</a>
</span>
<span class="next">
<a href="custom-threshold-alert.html">Create a custom threshold rule »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="incident-management.html">Incident management</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="create-alerts.html">Alerting</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="create-alerts-rules.html">Create and manage rules</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>APM Anomaly rule</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="apm-anomaly-rule"></a>APM Anomaly rule</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
</div></div></div>
<p>APM Anomaly rules trigger when the latency, throughput, or failed transaction rate of a service is abnormal.</p>
<div class="position-relative"><h6><a id="apm-anomaly-rule-filters-conditions"></a>Filters and conditions</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
<p>Because some parts of an application may be more important than others, you might have a different tolerance
for abnormal performance across services in your application. You can filter the services in your application to
apply an APM Anomaly rule to specific services (<code class="literal">SERVICE</code>), transaction types (<code class="literal">TYPE</code>), and environments (<code class="literal">ENVIRONMENT</code>).</p>
<p>Then, you can specify which conditions should result in an alert. This includes specifying:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The types of anomalies that are detected (<code class="literal">DETECTOR TYPES</code>): <code class="literal">latency</code>, <code class="literal">throughput</code>, and/or <code class="literal">failed transaction rate</code>.
</li>
<li class="listitem">
The severity level (<code class="literal">HAS ANOMALY WITH SEVERITY</code>): <code class="literal">critical</code>, <code class="literal">major</code>, <code class="literal">minor</code>, <code class="literal">warning</code>.
</li>
</ul>
</div>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Example</strong></p>
</div></div></div>
<p>This example creates a rule for all production services that would result in an alert when a critical latency
anomaly is detected:</p>
<div class="imageblock">
<div class="content">
<img src="apm-anomaly-rule-filters-conditions.png" alt="apm anomaly rule filters conditions" width="600">
</div>
</div>
</div>
<div class="position-relative"><h6><a id="_rule_schedule"></a>Rule schedule</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
<p>Define how often to evaluate the condition in seconds, minutes, hours, or days.
Checks are queued so they run as close to the defined value as capacity allows.</p>
<div class="position-relative"><h6><a id="_advanced_options"></a>Advanced options</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
<p>Optionally define an <span class="strong strong"><strong>Alert delay</strong></span>.
An alert will only occur when the specified number of consecutive runs meet the rule conditions.</p>
<div class="position-relative"><h6><a id="_actions"></a>Actions</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
<p>Extend your rules by connecting them to actions that use built-in integrations.</p>
<div class="position-relative"><h7><a id="_action_types"></a>Action types</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
<p>Supported built-in integrations include:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/kibana/master/d3security-action-type.html" class="ulink" target="_top">D3 Security</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/email-action-type.html" class="ulink" target="_top">Email</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/resilient-action-type.html" class="ulink" target="_top">IBM Resilient</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/index-action-type.html" class="ulink" target="_top">Index</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/jira-action-type.html" class="ulink" target="_top">Jira</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/teams-action-type.html" class="ulink" target="_top">Microsoft Teams</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/obs-ai-assistant-action-type.html" class="ulink" target="_top">Observability AI Assistant connector</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/opsgenie-action-type.html" class="ulink" target="_top">Opsgenie</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/pagerduty-action-type.html" class="ulink" target="_top">PagerDuty</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/server-log-action-type.html" class="ulink" target="_top">Server log</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/servicenow-itom-action-type.html" class="ulink" target="_top">ServiceNow ITOM</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/servicenow-action-type.html" class="ulink" target="_top">ServiceNow ITSM</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/servicenow-sir-action-type.html" class="ulink" target="_top">ServiceNow SecOps</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/slack-action-type.html" class="ulink" target="_top">Slack</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/swimlane-action-type.html" class="ulink" target="_top">Swimlane</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/torq-action-type.html" class="ulink" target="_top">Torq</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/webhook-action-type.html" class="ulink" target="_top">Webhook</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/xmatters-action-type.html" class="ulink" target="_top">xMatters</a>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Some connector types are paid commercial features, while others are free.
For a comparison of the Elastic subscription levels, go to
<a href="/subscriptions" class="ulink" target="_top">the subscription page</a>.</p>
</div>
</div>
<div class="position-relative"><h7><a id="_action_frequency"></a>Action frequency</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
<p>After you select a connector, you must set the action frequency.
You can choose to create a summary of alerts on each check interval or on a custom interval.
Alternatively, you can set the action frequency such that you choose how often the action runs (for example, at each check interval, only when the alert status changes, or at a custom action interval).</p>
<p>You can also further refine the conditions under which actions run by specifying that actions only run they match a KQL query or when an alert occurs within a specific time frame:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>If alert matches query</strong></span>: Enter a KQL query that defines field-value pairs or query conditions that must be met for notifications to send. The query only searches alert documents in the indices specified for the rule.
</li>
<li class="listitem">
<span class="strong strong"><strong>If alert is generated during timeframe</strong></span>: Set timeframe details. Notifications are only sent if alerts are generated within the timeframe you define.
</li>
</ul>
</div>
<div class="position-relative"><h7><a id="apm-anomaly-rule-action-variables"></a>Action variables</h7><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm-anomaly-rule.asciidoc">edit</a></div>
<p>A default message is provided as a starting point for your alert.
If you want to customize the message, add more context to the message by clicking the icon above
the message text box and selecting from a list of available variables.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To add variables to alert messages, use <a href="https://mustache.github.io/" class="ulink" target="_top">Mustache</a> template syntax, for example <code class="literal">{{variable.name}}</code>.</p>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="apm-anomaly-rule-action-variables.png" alt="apm anomaly rule action variables" width="600">
</div>
</div>
<p>The following variables are specific to this rule type.
You an also specify <a href="/guide/en/kibana/master/rule-action-variables.html" class="ulink" target="_top">variables common to all rules</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">context.alertDetailsUrl</code>
</span>
</dt>
<dd>
Link to the alert troubleshooting view for further context and details. This will be an empty string if the server.publicBaseUrl is not configured.
</dd>
<dt>
<span class="term">
<code class="literal">context.environment</code>
</span>
</dt>
<dd>
The transaction type the alert is created for.
</dd>
<dt>
<span class="term">
<code class="literal">context.reason</code>
</span>
</dt>
<dd>
A concise description of the reason for the alert.
</dd>
<dt>
<span class="term">
<code class="literal">context.serviceName</code>
</span>
</dt>
<dd>
The service the alert is created for.
</dd>
<dt>
<span class="term">
<code class="literal">context.threshold</code>
</span>
</dt>
<dd>
Any trigger value above this value will cause the alert to fire.
</dd>
<dt>
<span class="term">
<code class="literal">context.transactionType</code>
</span>
</dt>
<dd>
The transaction type the alert is created for.
</dd>
<dt>
<span class="term">
<code class="literal">context.triggerValue</code>
</span>
</dt>
<dd>
The value that breached the threshold and triggered the alert.
</dd>
<dt>
<span class="term">
<code class="literal">context.viewInAppUrl</code>
</span>
</dt>
<dd>
Link to the alert source.
</dd>
</dl>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="create-alerts-rules.html">« Create and manage rules</a>
</span>
<span class="next">
<a href="custom-threshold-alert.html">Create a custom threshold rule »</a>
</span>
</div>
</body>
</html>
