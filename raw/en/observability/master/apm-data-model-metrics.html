<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Metrics | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Metrics | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="apm-data-model.html" title="Data Model"/>
<link rel="prev" href="apm-data-model-errors.html" title="Errors"/>
<link rel="next" href="apm-data-model-metadata.html" title="Metadata"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="apm-data-model-errors.html">« Errors</a>
</span>
<span class="next">
<a href="apm-data-model-metadata.html">Metadata »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-data-model.html">Data Model</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Metrics</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="apm-data-model-metrics"></a>Metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="strong strong"><strong>Metrics</strong></span> measure the state of a system by gathering information on a regular interval. There are two types of APM metrics:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>System metrics</strong></span>: Basic infrastructure and application metrics.
</li>
<li class="listitem">
<span class="strong strong"><strong>Calculated metrics</strong></span>: Aggregated trace event metrics used to power visualizations in the APM app.
</li>
</ul>
</div>
<h5><a id="_system_metrics"></a>System metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h5>
<p>APM agents automatically pick up basic host-level metrics,
including system and process-level CPU and memory metrics.
Agent specific metrics are also available,
like <a href="/guide/en/apm/agent/java/1.x/metrics.html" class="ulink" target="_top">JVM metrics</a> in the Java Agent,
and <a href="/guide/en/apm/agent/go/2.x/metrics.html" class="ulink" target="_top">Go runtime</a> metrics in the Go Agent.</p>
<p>Infrastructure and application metrics are important sources of information when debugging production systems,
which is why we&#8217;ve made it easy to filter metrics for specific hosts or containers in the Kibana <a href="/guide/en/kibana/master/metrics.html" class="ulink" target="_top">metrics overview</a>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Most agents limit keyword fields to 1024 characters,
non-keyword fields (e.g. <code class="literal">system.memory.total</code>) to 10,000 characters.</p>
</div>
</div>
<p>Metrics are stored in metric indices.</p>
<p>For a full list of tracked metrics, see the relevant agent documentation:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/go/2.x/metrics.html" class="ulink" target="_top">Go</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/java/1.x/metrics.html" class="ulink" target="_top">Java</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/nodejs/4.x/metrics.html" class="ulink" target="_top">Node.js</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/python/6.x/metrics.html" class="ulink" target="_top">Python</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/ruby/4.x/metrics.html" class="ulink" target="_top">Ruby</a>
</li>
</ul>
</div>
<h6><a id="_example_system_metric_document"></a>Example system metric document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>This example shows what system metric documents can look like when indexed in Elasticsearch.</p>
<details>
<summary class="title">Expand Elasticsearch document</summary>
<div class="content">
<p>This example contains JVM metrics produced by the Elastic APM Java agent.
and contains two related metrics: <code class="literal">jvm.gc.time</code> and <code class="literal">jvm.gc.count</code>. These are accompanied by various fields describing
the environment in which the metrics were captured: service name, host name, Kubernetes pod UID, container ID, process ID, and more.
These fields make it possible to search and aggregate across various dimensions, such as by service, host, and Kubernetes pod.</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "container": {
    "id": "a47ed147c6ee269400f7ea4e296b3d01ec7398471bb2951907e4ea12f028bc69"
  },
  "kubernetes": {
    "pod": {
      "uid": "b0cb3baa-4619-4b82-bef5-84cc87b5f853",
      "name": "opbeans-java-7c68f48dc6-n6mzc"
    }
  },
  "process": {
    "pid": 8,
    "title": "/opt/java/openjdk/bin/java",
    "parent": {
      "pid": 1
    }
  },
  "agent": {
    "name": "java",
    "ephemeral_id": "29a27947-ed3a-4d87-b2e6-28f7a940ec2d",
    "version": "1.25.1-SNAPSHOT.UNKNOWN"
  },
  "jvm.gc.time": 11511,
  "processor": {
    "name": "metric",
    "event": "metric"
  },
  "labels": {
    "name": "Copy"
  },
  "metricset.name": "app",
  "observer": {
    "hostname": "3c5ac040e8f9",
    "name": "instance-0000000002",
    "type": "apm-server",
    "version": "7.15.0"
  },
  "@timestamp": "2021-09-14T09:52:49.454Z",
  "ecs": {
    "version": "1.11.0"
  },
  "service": {
    "node": {
      "name": "a47ed147c6ee269400f7ea4e296b3d01ec7398471bb2951907e4ea12f028bc69"
    },
    "environment": "production",
    "name": "opbeans-java",
    "runtime": {
      "name": "Java",
      "version": "11.0.11"
    },
    "language": {
      "name": "Java",
      "version": "11.0.11"
    },
    "version": "2021-09-08 03:55:06"
  },
  "jvm.gc.count": 2224,
  "host": {
    "os": {
      "platform": "Linux"
    },
    "ip": ["35.240.52.17"],
    "architecture": "amd64"
  },
  "event": {
    "ingested": "2021-09-14T09:53:00.834276431Z"
  }
}</pre>
</div>
</div>
</details>
<h5><a id="_calculated_metrics"></a>Calculated metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h5>
<p>APM agents and APM Server calculate metrics from trace events to power visualizations in the APM app.</p>
<p>Calculated metrics are an implementation detail and while we aim for stability for these data models,
the dimensions and concrete limits for aggregations are subject to change within minor version updates.</p>
<p>These metrics are described below.</p>
<h6><a id="_breakdown_metrics"></a>Breakdown metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>To power the <a href="/guide/en/kibana/master/transactions.html" class="ulink" target="_top">Time spent by span type</a> graph,
agents collect summarized metrics about the timings of spans and transactions,
broken down by span type.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">span.self_time.count</code></strong></span> and <span class="strong strong"><strong><code class="literal">span.self_time.sum.us</code></strong></span>
</span>
</dt>
<dd>
<p>These metrics measure the "self-time" for a span type, and optional subtype,
within a transaction group. Together these metrics can be used to calculate
the average duration and percentage of time spent on each type of operation
within a transaction group.</p>
<p>These metric documents can be identified by searching for <code class="literal">metricset.name: span_breakdown</code>.</p>
<p>You can filter and group by these dimensions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">transaction.name</code>: The name of the enclosing transaction group, for example <code class="literal">GET /</code>
</li>
<li class="listitem">
<code class="literal">transaction.type</code>: The type of the enclosing transaction, for example <code class="literal">request</code>
</li>
<li class="listitem">
<code class="literal">span.type</code>: The type of the span, for example <code class="literal">app</code>, <code class="literal">template</code> or <code class="literal">db</code>
</li>
<li class="listitem">
<code class="literal">span.subtype</code>: The sub-type of the span, for example <code class="literal">mysql</code> (optional)
</li>
</ul>
</div>
</dd>
</dl>
</div>
<h6><a id="_example_breakdown_metric_document"></a>Example breakdown metric document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>This example shows what breakdown metric documents can look like when indexed in Elasticsearch.</p>
<details>
<summary class="title">Expand Elasticsearch document</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "@timestamp": "2022-02-28T13:41:14.594Z",
  "agent": {
    "name": "ruby",
    "version": "4.5.0"
  },
  "data_stream": {
    "dataset": "apm.internal",
    "namespace": "default",
    "type": "metrics"
  },
  "ecs": {
    "version": "8.6.0-dev"
  },
  "event": {
    "agent_id_status": "missing",
    "ingested": "2023-06-20T09:45:03Z"
  },
  "host": {
    "architecture": "x86_64",
    "hostname": "19887b56414b",
    "ip": "127.0.0.1",
    "name": "19887b56414b",
    "os": {
      "platform": "linux"
    }
  },
  "metricset": {
    "name": "span_breakdown"
  },
  "observer": {
    "hostname": "hostname",
    "type": "apm-server",
    "version": "8.8.2"
  },
  "process": {
    "args": [
      "-C",
      "config/puma.rb"
    ],
    "pid": 150,
    "title": "/usr/local/bundle/bin/puma"
  },
  "processor": {
    "event": "metric",
    "name": "metric"
  },
  "service": {
    "environment": "production",
    "framework": {
      "name": "Ruby on Rails",
      "version": "6.1.4.1"
    },
    "language": {
      "name": "ruby",
      "version": "2.7.3"
    },
    "name": "opbeans-ruby",
    "node": {
      "name": "19887b56414b"
    },
    "runtime": {
      "name": "ruby",
      "version": "2.7.3"
    },
    "version": "None"
  },
  "span": {
    "self_time": {
      "count": 1,
      "sum": {
        "us": 3473
      }
    },
    "subtype": "controller",
    "type": "app"
  },
  "transaction": {
    "name": "Api::OrdersController#create",
    "type": "request"
  }
}</pre>
</div>
</div>
</details>
<h6><a id="_transaction_metrics"></a>Transaction metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>To power <a href="/guide/en/kibana/master/xpack-apm.html" class="ulink" target="_top">APM app</a> visualizations,
APM Server aggregates transaction events into latency distribution metrics.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">transaction.duration.summary</code></strong></span> and <span class="strong strong"><strong><code class="literal">transaction.duration.histogram</code></strong></span>
</span>
</dt>
<dd>
<p>These metrics represent the latency summary and latency distribution of transaction groups,
used to power transaction-oriented visualizations and analytics in Elastic APM.</p>
<p>These metric documents can be identified by searching for <code class="literal">metricset.name: transaction</code>.</p>
<p>You can filter and group by these dimensions (some of which are optional, for example <code class="literal">container.id</code>):</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">agent.name</code>: The name of the APM agent that instrumented the transaction, for example <code class="literal">java</code>
</li>
<li class="listitem">
<code class="literal">cloud.account.id</code>: The cloud account id of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">cloud.account.name</code>: The cloud account name of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">cloud.availability_zone</code>: The cloud availability zone hosting the service instance that served the transaction
</li>
<li class="listitem">
<code class="literal">cloud.machine.type</code>: The cloud machine type or instance type of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">cloud.project.id</code>: The cloud project identifier of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">cloud.project.name</code>: The cloud project name of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">cloud.provider</code>: The cloud provider hosting the service instance that served the transaction
</li>
<li class="listitem">
<code class="literal">cloud.region</code>: The cloud region hosting the service instance that served the transaction
</li>
<li class="listitem">
<code class="literal">cloud.service.name</code>: The cloud service name of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">container.id</code>: The container ID of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">event.outcome</code>: The outcome of the transaction, for example <code class="literal">success</code>
</li>
<li class="listitem">
<code class="literal">faas.coldstart</code>: Whether the <em>serverless</em> service that served the transaction had a cold start
</li>
<li class="listitem">
<code class="literal">faas.id</code>: The unique identifier of the invoked serverless function
</li>
<li class="listitem">
<code class="literal">faas.name</code>: The name of the lambda function
</li>
<li class="listitem">
<code class="literal">faas.trigger.type</code>: The trigger type that the lambda function was executed by of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">faas.version</code>: The version of the lambda function
</li>
<li class="listitem">
<code class="literal">host.hostname</code>: The detected hostname of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">host.name</code>: The user-defined name of the host or the detected hostname of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">host.os.platform</code>: The platform name of the service that served the transaction, for example <code class="literal">linux</code>
</li>
<li class="listitem">
<code class="literal">kubernetes.pod.name</code>: The name of the Kubernetes pod running the service that served the transaction
</li>
<li class="listitem">
<code class="literal">labels</code>: Key-value object containing string labels set globally by the APM agents. This dimension is not present for RUM agents.
</li>
<li class="listitem">
<code class="literal">metricset.interval</code>: A string with the aggregation interval the metricset represents.
</li>
<li class="listitem">
<code class="literal">numeric_labels</code>: Key-value object containing numeric labels set globally by the APM agents. This dimension is not present for RUM agents.
</li>
<li class="listitem">
<code class="literal">service.environment</code>: The environment of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">service.language.name</code>: The language name of the service that served the transaction, for example <code class="literal">Go</code>
</li>
<li class="listitem">
<code class="literal">service.language.version</code>: The language version of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">service.name</code>: The name of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">service.node.name</code>: The name of the service instance that served the transaction
</li>
<li class="listitem">
<code class="literal">service.runtime.name</code>: The runtime name of the service that served the transaction, for example <code class="literal">jRuby</code>
</li>
<li class="listitem">
<code class="literal">service.runtime.version</code>: The runtime version that served the transaction
</li>
<li class="listitem">
<code class="literal">service.version</code>: The version of the service that served the transaction
</li>
<li class="listitem">
<code class="literal">transaction.name</code>: The name of the transaction, for example <code class="literal">GET /</code>
</li>
<li class="listitem">
<code class="literal">transaction.result</code>: The result of the transaction, for example <code class="literal">HTTP 2xx</code>
</li>
<li class="listitem">
<code class="literal">transaction.root</code>: A boolean flag indicating whether the transaction is the root of a trace
</li>
<li class="listitem">
<code class="literal">transaction.type</code>: The type of the transaction, for example <code class="literal">request</code>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p>The <code class="literal">@timestamp</code> field of these documents holds the start of the aggregation interval.</p>
<h6><a id="_example_transaction_document_2"></a>Example transaction document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>This example shows what transaction documents can look like when indexed in Elasticsearch.</p>
<details>
<summary class="title">Expand Elasticsearch document</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "@timestamp": "2022-02-28T13:39:00.000Z",
  "_doc_count": 2421,
  "agent": {
    "name": "ruby"
  },
  "data_stream": {
    "dataset": "apm.transaction.1m",
    "namespace": "default",
    "type": "metrics"
  },
  "ecs": {
    "version": "8.6.0-dev"
  },
  "event": {
    "agent_id_status": "missing",
    "ingested": "2023-06-20T09:49:53Z",
    "outcome": "success",
    "success_count": {
      "sum": 2421.0,
      "value_count": 2421
    }
  },
  "host": {
    "hostname": "19887b56414b",
    "name": "19887b56414b",
    "os": {
      "platform": "linux"
    }
  },
  "metricset": {
    "interval": "1m",
    "name": "transaction"
  },
  "observer": {
    "hostname": "hostname",
    "type": "apm-server",
    "version": "8.8.2"
  },
  "processor": {
    "event": "metric",
    "name": "metric"
  },
  "service": {
    "environment": "production",
    "language": {
      "name": "ruby",
      "version": "2.7.3"
    },
    "name": "opbeans-ruby",
    "node": {
      "name": "19887b56414b"
    },
    "runtime": {
      "name": "ruby",
      "version": "2.7.3"
    },
    "version": "None"
  },
  "transaction": {
    "duration": {
      "histogram": {
        "values": [
          16255.0,
          20095.0,
          20351.0,
          24447.0,
          24703.0,
          25087.0,
          25471.0,
          26111.0,
          26623.0,
          28287.0,
          29695.0,
          30847.0,
          31231.0,
          31871.0,
          33023.0,
          36351.0,
          41727.0,
          44287.0,
          46847.0,
          56575.0,
          61695.0,
          81407.0,
          88575.0,
          107519.0
        ],
        "counts": [
          90,
          89,
          90,
          90,
          90,
          180,
          180,
          90,
          89,
          90,
          90,
          90,
          90,
          89,
          90,
          90,
          89,
          89,
          90,
          179,
          89,
          89,
          90,
          89
        ]
      },
      "summary": {
        "sum": 9.5487371E7,
        "value_count": 2421
      }
    },
    "name": "Api::CustomersController#index",
    "result": "HTTP 2xx",
    "root": true,
    "type": "request"
  }
}</pre>
</div>
</div>
</details>
<h6><a id="_service_transaction_metrics"></a>Service-transaction metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>To power <a href="/guide/en/kibana/master/xpack-apm.html" class="ulink" target="_top">APM app</a> visualizations,
APM Server aggregates transaction events into service-transaction metrics.
Service-transaction metrics are similar to transaction metrics, but they usually
have a much lower cardinality as they have significantly fewer dimensions.
The UI uses them when fewer details of the transactions are needed.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">transaction.duration.summary</code></strong></span> and <span class="strong strong"><strong><code class="literal">transaction.duration.histogram</code></strong></span>
</span>
</dt>
<dd>
<p>These metrics represent the latency summary and latency distribution of service transaction groups,
used to power service-oriented visualizations and analytics in Elastic APM.</p>
<p>These metric documents can be identified by searching for <code class="literal">metricset.name: service_transaction</code>.</p>
<p>You can filter and group by these dimensions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">agent.name</code>: The name of the APM agent that instrumented the operation, for example <code class="literal">java</code>
</li>
<li class="listitem">
<code class="literal">labels</code>: Key-value object containing string labels set globally by the APM agents. This dimension is not present for RUM agents.
</li>
<li class="listitem">
<code class="literal">metricset.interval</code>: A string with the aggregation interval the metricset represents.
</li>
<li class="listitem">
<code class="literal">numeric_labels</code>: Key-value object containing numeric labels set globally by the APM agents. This dimension is not present for RUM agents.
</li>
<li class="listitem">
<code class="literal">service.environment</code>: The environment of the service that made the request
</li>
<li class="listitem">
<code class="literal">service.language.name</code>: The language name of the service that served the transaction, for example <code class="literal">Go</code>
</li>
<li class="listitem">
<code class="literal">service.name</code>: The name of the service that made the request
</li>
<li class="listitem">
<code class="literal">transaction.type</code>: The type of the enclosing transaction, for example <code class="literal">request</code>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p>The <code class="literal">@timestamp</code> field of these documents holds the start of the aggregation interval.</p>
<h6><a id="_example_service_transaction_document"></a>Example service-transaction document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>This example shows what service-transaction documents can look like when indexed in Elasticsearch.</p>
<details>
<summary class="title">Expand Elasticsearch document</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "@timestamp": "2022-02-28T13:40:00.000Z",
  "_doc_count": 2677,
  "agent": {
    "name": "ruby"
  },
  "data_stream": {
    "dataset": "apm.service_transaction.1m",
    "namespace": "default",
    "type": "metrics"
  },
  "ecs": {
    "version": "8.6.0-dev"
  },
  "event": {
    "agent_id_status": "missing",
    "ingested": "2023-06-20T09:59:52Z",
    "success_count": {
      "sum": 2567.0,
      "value_count": 2677
    }
  },
  "metricset": {
    "interval": "1m",
    "name": "service_transaction"
  },
  "observer": {
    "hostname": "hostname",
    "type": "apm-server",
    "version": "8.8.2"
  },
  "processor": {
    "event": "metric",
    "name": "metric"
  },
  "service": {
    "environment": "production",
    "language": {
      "name": "ruby"
    },
    "name": "opbeans-ruby"
  },
  "transaction": {
    "duration": {
      "histogram": {
        "values": [
          9215.0,
          9279.0,
          10047.0,
          10687.0,
          10751.0,
          11263.0,
          12991.0,
          13631.0,
          14335.0,
          14399.0,
          15167.0,
          15295.0,
          15935.0,
          16063.0,
          16767.0,
          18047.0,
          18175.0,
          18303.0,
          18431.0,
          18559.0,
          18943.0,
          19199.0,
          19583.0,
          19711.0,
          19839.0,
          20479.0,
          20735.0,
          20863.0,
          20991.0,
          21119.0,
          21375.0,
          22143.0,
          22399.0,
          22527.0,
          22655.0,
          23167.0,
          23807.0,
          24319.0,
          24575.0,
          24959.0,
          25855.0,
          26239.0,
          26367.0,
          26623.0,
          26751.0,
          27007.0,
          27135.0,
          27263.0,
          27647.0,
          28031.0,
          28287.0,
          28543.0,
          28671.0,
          28927.0,
          29951.0,
          30079.0,
          30335.0,
          30463.0,
          31231.0,
          31487.0,
          31615.0,
          31743.0,
          32127.0,
          32383.0,
          32767.0,
          33023.0,
          33279.0,
          33535.0,
          34047.0,
          34303.0,
          34815.0,
          35071.0,
          35327.0,
          35583.0,
          36351.0,
          37631.0,
          38143.0,
          38911.0,
          39167.0,
          39679.0,
          40447.0,
          40703.0,
          40959.0,
          41215.0,
          41471.0,
          41983.0,
          42495.0,
          43007.0,
          43263.0,
          43519.0,
          43775.0,
          44799.0,
          45311.0,
          46591.0,
          46847.0,
          47103.0,
          48127.0,
          48383.0,
          48639.0,
          48895.0,
          49151.0,
          49407.0,
          49919.0,
          50431.0,
          50687.0,
          51455.0,
          51711.0,
          52223.0,
          53759.0,
          54271.0,
          54527.0,
          55039.0,
          55807.0,
          56063.0,
          56319.0,
          57087.0,
          57343.0,
          57599.0,
          58879.0,
          59647.0,
          59903.0,
          60927.0,
          61695.0,
          62719.0,
          63743.0,
          64255.0,
          64767.0,
          66559.0,
          67071.0,
          68095.0,
          68607.0,
          69119.0,
          69631.0,
          70655.0,
          71679.0,
          72191.0,
          72703.0,
          73727.0,
          74239.0,
          75775.0,
          76287.0,
          76799.0,
          77311.0,
          77823.0,
          82943.0,
          83967.0,
          84991.0,
          86015.0,
          87551.0,
          89087.0,
          89599.0,
          91647.0,
          92671.0,
          95231.0,
          95743.0,
          97279.0,
          98815.0,
          99327.0,
          99839.0,
          100863.0,
          101887.0,
          102399.0,
          102911.0,
          103423.0,
          103935.0,
          105983.0,
          109055.0,
          111615.0,
          112127.0,
          118271.0,
          119295.0,
          122879.0,
          129023.0,
          129535.0,
          132095.0,
          133119.0,
          137215.0,
          139263.0,
          140287.0,
          146431.0,
          147455.0,
          148479.0,
          152575.0,
          158719.0,
          159743.0,
          161791.0,
          165887.0,
          171007.0,
          173055.0,
          174079.0,
          178175.0,
          181247.0,
          182271.0,
          190463.0,
          193535.0,
          195583.0,
          198655.0,
          201727.0,
          212991.0,
          224255.0,
          240639.0,
          250879.0,
          262143.0,
          329727.0,
          1236991.0,
          2097151.0,
          2408447.0,
          2424831.0,
          3801087.0,
          3850239.0,
          4063231.0,
          4177919.0,
          4390911.0,
          4947967.0,
          5275647.0,
          5832703.0,
          5898239.0,
          5931007.0,
          6324223.0,
          6455295.0,
          6488063.0,
          8454143.0
        ],
        "counts": [
          9,
          9,
          9,
          9,
          10,
          9,
          9,
          9,
          9,
          9,
          10,
          10,
          18,
          9,
          10,
          18,
          9,
          10,
          9,
          9,
          18,
          19,
          9,
          19,
          9,
          9,
          9,
          9,
          19,
          9,
          10,
          18,
          9,
          9,
          18,
          10,
          9,
          9,
          9,
          9,
          10,
          18,
          10,
          18,
          9,
          18,
          9,
          9,
          10,
          9,
          10,
          9,
          9,
          9,
          9,
          9,
          9,
          27,
          9,
          9,
          10,
          9,
          10,
          9,
          19,
          9,
          19,
          9,
          9,
          19,
          9,
          18,
          28,
          9,
          27,
          18,
          18,
          10,
          10,
          9,
          10,
          9,
          10,
          10,
          18,
          29,
          18,
          9,
          9,
          9,
          10,
          9,
          9,
          9,
          9,
          19,
          19,
          10,
          10,
          10,
          18,
          19,
          9,
          9,
          10,
          18,
          10,
          19,
          9,
          9,
          9,
          10,
          10,
          10,
          9,
          9,
          18,
          9,
          9,
          9,
          9,
          19,
          18,
          18,
          10,
          18,
          9,
          38,
          9,
          9,
          18,
          19,
          9,
          9,
          18,
          9,
          18,
          9,
          9,
          9,
          10,
          19,
          27,
          10,
          18,
          28,
          19,
          9,
          20,
          18,
          18,
          10,
          9,
          9,
          9,
          28,
          9,
          10,
          9,
          9,
          19,
          28,
          9,
          18,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          10,
          9,
          9,
          10,
          9,
          29,
          9,
          10,
          10,
          18,
          9,
          10,
          9,
          19,
          10,
          9,
          18,
          10,
          9,
          9,
          10,
          10,
          9,
          9,
          10,
          9,
          10,
          9,
          9,
          10,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          9,
          10,
          9,
          10,
          10,
          10,
          18
        ]
      },
      "summary": {
        "sum": 1.027476555E9,
        "value_count": 2677
      }
    },
    "type": "request"
  }
}</pre>
</div>
</div>
</details>
<h6><a id="_service_destination_metrics"></a>Service-destination metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>To power <a href="/guide/en/kibana/master/xpack-apm.html" class="ulink" target="_top">APM app</a> visualizations,
APM Server aggregates span events into service-destination metrics.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">span.destination.service.response_time.count</code></strong></span> and <span class="strong strong"><strong><code class="literal">span.destination.service.response_time.sum.us</code></strong></span>
</span>
</dt>
<dd>
<p>These metrics measure the count and total duration of requests from one service to another service.
These are used to calculate the throughput and latency of requests to backend services such as databases in
<a href="/guide/en/kibana/master/service-maps.html" class="ulink" target="_top">Service maps</a>.</p>
<p>These metric documents can be identified by searching for <code class="literal">metricset.name: service_destination</code>.</p>
<p>You can filter and group by these dimensions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">agent.name</code>: The name of the APM agent that instrumented the operation, for example <code class="literal">java</code>
</li>
<li class="listitem">
<code class="literal">event.outcome</code>: The outcome of the operation, for example <code class="literal">success</code>
</li>
<li class="listitem">
<code class="literal">labels</code>: Key-value object containing string labels set globally by the APM agents. This dimension is not present for RUM agents.
</li>
<li class="listitem">
<code class="literal">metricset.interval</code>: A string with the aggregation interval the metricset represents.
</li>
<li class="listitem">
<code class="literal">numeric_labels</code>: Key-value object containing numeric labels set globally by the APM agents. This dimension is not present for RUM agents.
</li>
<li class="listitem">
<code class="literal">service.environment</code>: The environment of the service that made the request
</li>
<li class="listitem">
<code class="literal">service.language.name</code>: The language name of the service that served the transaction, for example <code class="literal">Go</code>
</li>
<li class="listitem">
<code class="literal">service.name</code>: The name of the service that made the request
</li>
<li class="listitem">
<code class="literal">service.target.name</code>: The target service name, for example <code class="literal">customer_db</code>
</li>
<li class="listitem">
<code class="literal">service.target.type</code>: The target service type, for example <code class="literal">mysql</code>
</li>
<li class="listitem">
<code class="literal">span.destination.service.resource</code>: The destination service resource, for example <code class="literal">mysql</code>
</li>
<li class="listitem">
<code class="literal">span.name</code>: The name of the operation, for example <code class="literal">SELECT FROM table_name</code>.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p>The <code class="literal">@timestamp</code> field of these documents holds the start of the aggregation interval.</p>
<h6><a id="_example_service_destination_document"></a>Example service-destination document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>This example shows what service-destination documents can look like when indexed in Elasticsearch.</p>
<details>
<summary class="title">Expand Elasticsearch document</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "@timestamp": "2022-02-28T13:41:00.000Z",
  "_doc_count": 7488,
  "agent": {
    "name": "ruby"
  },
  "data_stream": {
    "dataset": "apm.service_destination.1m",
    "namespace": "default",
    "type": "metrics"
  },
  "ecs": {
    "version": "8.6.0-dev"
  },
  "event": {
    "agent_id_status": "missing",
    "ingested": "2023-06-20T09:45:53Z",
    "outcome": "unknown"
  },
  "metricset": {
    "interval": "1m",
    "name": "service_destination"
  },
  "observer": {
    "hostname": "hostname",
    "type": "apm-server",
    "version": "8.8.2"
  },
  "processor": {
    "event": "metric",
    "name": "metric"
  },
  "service": {
    "environment": "production",
    "language": {
      "name": "ruby"
    },
    "name": "opbeans-ruby",
    "target": {
      "type": "postgresql"
    }
  },
  "span": {
    "destination": {
      "service": {
        "resource": "postgresql",
        "response_time": {
          "count": 7488,
          "sum": {
            "us": 21309833
          }
        }
      }
    },
    "name": "SELECT FROM product_kinds"
  }
}</pre>
</div>
</div>
</details>
<h6><a id="_service_summary_metrics"></a>Service-summary metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>To power <a href="/guide/en/kibana/master/xpack-apm.html" class="ulink" target="_top">APM app</a> visualizations,
APM Server aggregates transaction, error, log, and metric events into service-summary metrics.</p>
<p>These metric documents can be identified by searching for <code class="literal">metricset.name: service_summary</code>.</p>
<p>You can filter and group by these dimensions:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">agent.name</code>: The name of the APM agent that instrumented the operation, for example <code class="literal">java</code>
</li>
<li class="listitem">
<code class="literal">labels</code>: Key-value object containing string labels set globally by the APM agents. This dimension is not present for RUM agents.
</li>
<li class="listitem">
<code class="literal">metricset.interval</code>: A string with the aggregation interval the metricset represents.
</li>
<li class="listitem">
<code class="literal">numeric_labels</code>: Key-value object containing numeric labels set globally by the APM agents. This dimension is not present for RUM agents.
</li>
<li class="listitem">
<code class="literal">service.environment</code>: The environment of the service that made the request
</li>
<li class="listitem">
<code class="literal">service.language.name</code>: The language name of the service that served the transaction, for example <code class="literal">Go</code>
</li>
<li class="listitem">
<code class="literal">service.name</code>: The name of the service that made the request
</li>
</ul>
</div>
<p>The <code class="literal">@timestamp</code> field of these documents holds the start of the aggregation interval.</p>
<h6><a id="_example_service_summary_document"></a>Example service-summary document<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>This example shows what service-summary documents can look like when indexed in Elasticsearch.</p>
<details>
<summary class="title">Expand Elasticsearch document</summary>
<div class="content">
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "@timestamp": "2022-02-28T13:37:00.000Z",
  "agent": {
    "name": "nodejs"
  },
  "data_stream": {
    "dataset": "apm.service_summary.1m",
    "namespace": "default",
    "type": "metrics"
  },
  "ecs": {
    "version": "8.6.0-dev"
  },
  "event": {
    "agent_id_status": "missing",
    "ingested": "2023-06-20T09:45:53Z"
  },
  "metricset": {
    "interval": "1m",
    "name": "service_summary"
  },
  "observer": {
    "hostname": "hostname",
    "type": "apm-server",
    "version": "8.8.2"
  },
  "processor": {
    "event": "metric",
    "name": "metric"
  },
  "service": {
    "environment": "production",
    "language": {
      "name": "javascript"
    },
    "name": "opbeans-node"
  }
}</pre>
</div>
</div>
</details>
<h5><a id="_data_streams_4"></a>Data streams<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h5>
<p>Metrics are stored in the following data streams:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
APM internal metrics: <code class="literal">metrics-apm.internal-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM transaction metrics: <code class="literal">metrics-apm.transaction.&lt;metricset.interval&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM service destination metrics: <code class="literal">metrics-apm.service_destination.&lt;metricset.interval&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM service transaction metrics: <code class="literal">metrics-apm.service_transaction.&lt;metricset.interval&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
APM service summary metrics: <code class="literal">metrics-apm.service_summary.&lt;metricset.interval&gt;-&lt;namespace&gt;</code>
</li>
<li class="listitem">
Application metrics: <code class="literal">metrics-apm.app.&lt;service.name&gt;-&lt;namespace&gt;</code>
</li>
</ul>
</div>
<p>See <a class="xref" href="apm-data-streams.html" title="Data streams">Data streams</a> to learn more.</p>
<h5><a id="_aggregated_metrics_limits_and_overflows"></a>Aggregated metrics: limits and overflows<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h5>
<p>For all aggregated metrics, namely transaction, service-transaction, service-destination, and service-summary metrics,
there are limits on the number of unique groups tracked at any given time.</p>
<h6><a id="_limits"></a>Limits<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>Note that all the below limits may change in the future with further improvements.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>For all the following metrics, they share a limit of 1000 services per GB of APM Server.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
For transaction metrics, there is an additional limit of 5000 total transaction groups per GB of APM Server,
and each service may only consume up to 10% of the transaction groups,
which is 500 transaction groups per service per GB of APM Server.
</li>
<li class="listitem">
For service-transaction metrics, there is an additional limit of 1000 total service transaction groups per GB of APM Server,
and each service may only consume up to 10% of the service transaction groups,
which is 100 service transaction groups per service per GB of APM Server.
</li>
<li class="listitem">
For service-destination metrics, there is an additional limit of 5000 total service destination groups per GB of APM Server
starting with 10000 service destination groups for 1 GB APM Server,
and each service may only consume up to 10% of the service destination groups,
which is 1000 service destination groups for 1GB APM Server with 500 increment per GB of APM Server.
</li>
<li class="listitem">
For service-summary metrics, there is no additional limit.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>In the above, a service is defined as a combination of <code class="literal">service.name</code>, <code class="literal">service.environment</code>, <code class="literal">service.language.name</code> and <code class="literal">agent.name</code>.</p>
<h6><a id="_overflows"></a>Overflows<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/data-model.asciidoc">edit</a></h6>
<p>When a dimension has a high cardinality and exceeds the limit, the metrics will be aggregated
under a dedicated overflow bucket.</p>
<p>For example, when <code class="literal">transaction.name</code> has a lot of unique values and reaches the limit
of unique transaction groups tracked, any transactions with new <code class="literal">transaction.name</code> will be aggregated under
<code class="literal">transaction.name</code>: <code class="literal">_other</code>.</p>
<p>Another example of how the transaction group limit may be reached is if <code class="literal">transaction.name</code> contains just a few unique values,
but the service is deployed on a lot of different hosts. As <code class="literal">host.name</code> is part of the aggregation key for transaction metrics,
the max transaction group limit is reached for a service that has 100 instances, 10 different transaction names, and
4 transaction results per transaction name when connected to an APM Server with 8GB of RAM.
Once this limit is reached, any new combinations of <code class="literal">transaction.name</code>, <code class="literal">transaction.result</code>, and
<code class="literal">host.name</code> for that service will be aggregated under <code class="literal">transaction.name</code>: <code class="literal">_other</code>.</p>
<p>This issue can be resolved by increasing memory available to APM Server, or by ensuring that the dimensions do not use values
that are based on parameters that can change. For example, user ids, product ids, order numbers, query parameters, etc.,
should be stripped away from the dimensions. For the same reason, avoid high cardinality global labels (<code class="literal">labels.\*</code> and <code class="literal">numeric_labels.*</code>).</p>
<p>Aggregated metrics do not consider global labels from RUM agents in order to protect APM server from using too much memory.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="apm-data-model-errors.html">« Errors</a>
</span>
<span class="next">
<a href="apm-data-model-metadata.html">Metadata »</a>
</span>
</div>
</body>
</html>
