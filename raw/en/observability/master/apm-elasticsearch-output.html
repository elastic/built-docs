<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Configure the Elasticsearch output | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Configure the Elasticsearch output | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="apm-configuring-output.html" title="Configure the output"/>
<link rel="prev" href="apm-configure-cloud-id.html" title="Configure the output for Elasticsearch Service on Elastic Cloud"/>
<link rel="next" href="apm-logstash-output.html" title="Configure the Logstash output"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="apm-configure-cloud-id.html">« Configure the output for Elasticsearch Service on Elastic Cloud</a>
</span>
<span class="next">
<a href="apm-logstash-output.html">Configure the Logstash output »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm.html">Application performance monitoring (APM)</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-configuring-howto-apm-server.html">Configure</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="apm-configuring-output.html">Configure the output</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Configure the Elasticsearch output</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="apm-elasticsearch-output"></a>Configure the Elasticsearch output<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h4>
</div></div></div>

<div class="sidebar">
<div class="titlepage"></div>
<p><span class="image"><img src="./binary-yes-fm-no.svg" alt="supported deployment methods"></span></p>
<p>This documentation only applies to APM Server binary users.
Fleet-managed users should see <a href="/guide/en/fleet/master/elasticsearch-output.html" class="ulink" target="_top">Configure the Elasticsearch output</a>.</p>
</div>
<p>The Elasticsearch output sends events directly to Elasticsearch using the Elasticsearch HTTP API.</p>
<p>Example configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"] <a id="CO36-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO36-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>To enable SSL, add <code class="literal">https</code> to all URLs defined under <em>hosts</em>.</p>
</td>
</tr>
</table>
</div>
<p>When sending data to a secured cluster through the <code class="literal">elasticsearch</code>
output, APM Server can use any of the following authentication methods:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Basic authentication credentials (username and password).
</li>
<li class="listitem">
Token-based (API key) authentication.
</li>
<li class="listitem">
Public Key Infrastructure (PKI) certificates.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Basic authentication:</strong></span></p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  username: "apm_writer"
  password: "YOUR_PASSWORD"</pre>
</div>
<p><span class="strong strong"><strong>API key authentication:</strong></span></p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  api_key: "ZCV7VnwBgnX0T19fN8Qe:KnR6yE41RrSowb0kQ0HWoA"</pre>
</div>
<p><span class="strong strong"><strong>PKI certificate authentication:</strong></span></p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  ssl.certificate: "/etc/pki/client/cert.pem"
  ssl.key: "/etc/pki/client/cert.key"</pre>
</div>
<p>See <a class="xref" href="apm-elasticsearch-output.html#apm-securing-communication-elasticsearch" title="Secure communication with Elasticsearch">Secure communication with Elasticsearch</a> for details on each authentication method.</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_compatibility"></a>Compatibility<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h5>
</div></div></div>
<p>This output works with all compatible versions of Elasticsearch. See the
<a href="/support/matrix#matrix_compatibility" class="ulink" target="_top">Elastic Support
Matrix</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="_configuration_options_3"></a>Configuration options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h5>
</div></div></div>
<p>You can specify the following options in the <code class="literal">elasticsearch</code> section of the <code class="literal">apm-server.yml</code> config file:</p>
<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_enabled_2"></a><code class="literal">enabled</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The enabled config is a boolean setting to enable or disable the output. If set
to <code class="literal">false</code>, the output is disabled.</p>
<p>The default value is <code class="literal">true</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="apm-hosts-option"></a><code class="literal">hosts</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The list of Elasticsearch nodes to connect to. The events are distributed to
these nodes in round robin order. If one node becomes unreachable, the event is
automatically sent to another node. Each Elasticsearch node can be defined as a <code class="literal">URL</code> or <code class="literal">IP:PORT</code>.
For example: <code class="literal">http://192.15.3.2</code>, <code class="literal">https://es.found.io:9230</code> or <code class="literal">192.24.3.2:9300</code>.
If no port is specified, <code class="literal">9200</code> is used.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When a node is defined as an <code class="literal">IP:PORT</code>, the <em>scheme</em> and <em>path</em> are taken from the
<a class="xref" href="apm-elasticsearch-output.html#apm-protocol-option" title="protocol"><code class="literal">protocol</code></a> and <a class="xref" href="apm-elasticsearch-output.html#apm-path-option" title="path"><code class="literal">path</code></a> config options.</p>
</div>
</div>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["10.45.3.2:9220", "10.45.3.1:9230"] <a id="CO37-1"></a><i class="conum" data-value="1"></i>
  protocol: https
  path: /elasticsearch</pre>
</div>
<p>In the previous example, the Elasticsearch nodes are available at <code class="literal">https://10.45.3.2:9220/elasticsearch</code> and
<code class="literal">https://10.45.3.1:9230/elasticsearch</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_compression_level"></a><code class="literal">compression_level</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The gzip compression level. Setting this value to <code class="literal">0</code> disables compression.
The compression level must be in the range of <code class="literal">1</code> (best speed) to <code class="literal">9</code> (best compression).</p>
<p>Increasing the compression level will reduce the network usage but will increase the CPU usage.</p>
<p>The default value is <code class="literal">0</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_escape_html"></a><code class="literal">escape_html</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Configure escaping of HTML in strings. Set to <code class="literal">true</code> to enable escaping.</p>
<p>The default value is <code class="literal">false</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_api_key_2"></a><code class="literal">api_key</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Instead of using a username and password, you can use API keys to secure communication
with Elasticsearch. The value must be the ID of the API key and the API key joined by a colon: <code class="literal">id:api_key</code>.</p>
<p>See <a class="xref" href="apm-beats-api-keys.html" title="Grant access using API keys">Grant access using API keys</a> for more information.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_username"></a><code class="literal">username</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The basic authentication username for connecting to Elasticsearch.</p>
<p>This user needs the privileges required to publish events to Elasticsearch.
To create a user like this, see <a class="xref" href="apm-privileges-to-publish-events.html" title="Grant privileges and roles needed for writing events">Create a <em>writer</em> user</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_password"></a><code class="literal">password</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The basic authentication password for connecting to Elasticsearch.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_parameters"></a><code class="literal">parameters</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Dictionary of HTTP parameters to pass within the URL with index operations.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="apm-protocol-option"></a><code class="literal">protocol</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The name of the protocol Elasticsearch is reachable on. The options are:
<code class="literal">http</code> or <code class="literal">https</code>. The default is <code class="literal">http</code>. However, if you specify a URL for
<a class="xref" href="apm-elasticsearch-output.html#apm-hosts-option" title="hosts"><code class="literal">hosts</code></a>, the value of <code class="literal">protocol</code> is overridden by whatever scheme you
specify in the URL.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="apm-path-option"></a><code class="literal">path</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>An HTTP path prefix that is prepended to the HTTP API calls. This is useful for
the cases where Elasticsearch listens behind an HTTP reverse proxy that exports
the API under a custom prefix.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_headers"></a><code class="literal">headers</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Custom HTTP headers to add to each request created by the Elasticsearch output.
Example:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch.headers:
  X-My-Header: Header contents</pre>
</div>
<p>It is possible to specify multiple header values for the same header
name by separating them with a comma.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_proxy_url"></a><code class="literal">proxy_url</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The URL of the proxy to use when connecting to the Elasticsearch servers. The
value may be either a complete URL or a "host[:port]", in which case the "http"
scheme is assumed. If a value is not specified through the configuration file
then proxy environment variables are used. See the
<a href="https://golang.org/pkg/net/http/#ProxyFromEnvironment" class="ulink" target="_top">Go documentation</a>
for more information about the environment variables.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_max_retries"></a><code class="literal">max_retries</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of times to retry publishing an event after a publishing failure.
After the specified number of retries, the events are typically dropped.</p>
<p>Set <code class="literal">max_retries</code> to a value less than 0 to retry until all events are published.</p>
<p>The default is 3.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_flush_bytes"></a><code class="literal">flush_bytes</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The bulk request size threshold, in bytes, before flushing to Elasticsearch.
The value must have a suffix, e.g. <code class="literal">"2MB"</code>. The default is <code class="literal">1MB</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_flush_interval"></a><code class="literal">flush_interval</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum duration to accumulate events for a bulk request before being flushed to Elasticsearch.
The value must have a duration suffix, e.g. <code class="literal">"5s"</code>. The default is <code class="literal">1s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_init"></a><code class="literal">backoff.init</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The number of seconds to wait before trying to reconnect to Elasticsearch after
a network error. After waiting <code class="literal">backoff.init</code> seconds, APM Server tries to
reconnect. If the attempt fails, the backoff timer is increased exponentially up
to <code class="literal">backoff.max</code>. After a successful connection, the backoff timer is reset. The
default is <code class="literal">1s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_backoff_max"></a><code class="literal">backoff.max</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The maximum number of seconds to wait before attempting to connect to
Elasticsearch after a network error. The default is <code class="literal">60s</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_timeout"></a><code class="literal">timeout</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>The HTTP request timeout in seconds for the Elasticsearch request. The default is 90.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_ssl"></a><code class="literal">ssl</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/configure/outputs/elasticsearch.asciidoc">edit</a></h6>
</div></div></div>
<p>Configuration options for SSL parameters like the certificate authority to use
for HTTPS-based connections. If the <code class="literal">ssl</code> section is missing, the host CAs are used for HTTPS connections to
Elasticsearch.</p>
<p>See the <a class="xref" href="apm-elasticsearch-output.html#apm-securing-communication-elasticsearch" title="Secure communication with Elasticsearch">secure communication with Elasticsearch</a> guide
or <a class="xref" href="apm-configuration-ssl.html" title="SSL/TLS output settings">SSL configuration reference</a> for more information.</p>
<h5><a id="apm-securing-communication-elasticsearch"></a>Secure communication with Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/https.asciidoc">edit</a></h5>
<p>When sending data to a secured cluster through the <code class="literal">elasticsearch</code>
output, APM Server can use any of the following authentication methods:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Basic authentication credentials (username and password).
</li>
<li class="listitem">
Token-based API authentication.
</li>
<li class="listitem">
A client certificate.
</li>
</ul>
</div>
<p>Authentication is specified in the APM Server configuration file:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>To use <span class="strong strong"><strong>basic authentication</strong></span>, specify the <code class="literal">username</code> and <code class="literal">password</code> settings under <code class="literal">output.elasticsearch</code>.
For example:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  username: "apm_writer" <a id="CO37-2"></a><i class="conum" data-value="1"></i>
  password: "YOUR_PASSWORD"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO37-1"><i class="conum" data-value="1"></i></a><a href="#CO37-2"></a></p>
</td>
<td align="left" valign="top">
<p>This user needs the privileges required to publish events to Elasticsearch.
To create a user like this, see <a class="xref" href="apm-privileges-to-publish-events.html" title="Grant privileges and roles needed for writing events">Create a <em>writer</em> user</a>.</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>To use token-based <span class="strong strong"><strong>API key authentication</strong></span>, specify the <code class="literal">api_key</code> under <code class="literal">output.elasticsearch</code>.
For example:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  api_key: "KnR6yE41RrSowb0kQ0HWoA" <a id="CO38-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO38-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This API key must have the privileges required to publish events to Elasticsearch.
To create an API key like this, see <a class="xref" href="apm-beats-api-keys.html" title="Grant access using API keys">Grant access using API keys</a>.</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div id="apm-beats-tls" class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>To use <span class="strong strong"><strong>Public Key Infrastructure (PKI) certificates</strong></span> to authenticate users,
specify the <code class="literal">certificate</code> and <code class="literal">key</code> settings under <code class="literal">output.elasticsearch</code>.
For example:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  ssl.certificate: "/etc/pki/client/cert.pem" <a id="CO39-1"></a><i class="conum" data-value="1"></i>
  ssl.key: "/etc/pki/client/cert.key" <a id="CO39-2"></a><i class="conum" data-value="2"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The path to the certificate for SSL client authentication</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO39-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The client certificate key</p>
</td>
</tr>
</table>
</div>
<p>These settings assume that the
distinguished name (DN) in the certificate is mapped to the appropriate roles in
the <code class="literal">role_mapping.yml</code> file on each node in the Elasticsearch cluster. For more
information, see <a href="/guide/en/elasticsearch/reference/master/mapping-roles.html#mapping-roles-file" class="ulink" target="_top">Using role
mapping files</a>.</p>
<p>By default, APM Server uses the list of trusted certificate authorities (CA) from the
operating system where APM Server is running. If the certificate authority that signed your node certificates
is not in the host system&#8217;s trusted certificate authorities list, you need
to add the path to the <code class="literal">.pem</code> file that contains your CA&#8217;s certificate to the
APM Server configuration. This will configure APM Server to use a specific list of
CA certificates instead of the default list from the OS.</p>
<p>Here is an example configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  hosts: ["https://myEShost:9200"]
  ssl.certificate_authorities: <a id="CO40-1"></a><i class="conum" data-value="1"></i>
    - /etc/pki/my_root_ca.pem
    - /etc/pki/my_other_ca.pem
  ssl.certificate: "/etc/pki/client.pem" <a id="CO40-2"></a><i class="conum" data-value="2"></i>
  ssl.key: "/etc/pki/key.pem" <a id="CO40-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Specify the path to the local <code class="literal">.pem</code> file that contains your Certificate
Authority&#8217;s certificate. This is needed if you use your own CA to sign your node certificates.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The path to the certificate for SSL client authentication</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO40-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The client certificate key</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For any given connection, the SSL/TLS certificates must have a subject
that matches the value specified for <code class="literal">hosts</code>, or the SSL handshake fails.
For example, if you specify <code class="literal">hosts: ["foobar:9200"]</code>, the certificate MUST
include <code class="literal">foobar</code> in the subject (<code class="literal">CN=foobar</code>) or as a subject alternative name
(SAN). Make sure the hostname resolves to the correct IP address. If no DNS is available, then
you can associate the IP address with your hostname in <code class="literal">/etc/hosts</code>
(on Unix) or <code class="literal">C:\Windows\System32\drivers\etc\hosts</code> (on Windows).</p>
</div>
</div>
</li>
</ul>
</div>

<h6 class="xpack"><a id="apm-securing-communication-learn-more"></a>Learn more about secure communication<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/apm/https.asciidoc">edit</a></h6>
<p>More information on sending data to a secured cluster is available in the configuration reference:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="apm-elasticsearch-output.html" title="Configure the Elasticsearch output">Elasticsearch</a>
</li>
<li class="listitem">
<a class="xref" href="apm-configuration-ssl.html" title="SSL/TLS output settings">SSL/TLS output settings</a>
</li>
</ul>
</div>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="apm-configure-cloud-id.html">« Configure the output for Elasticsearch Service on Elastic Cloud</a>
</span>
<span class="next">
<a href="apm-logstash-output.html">Configure the Logstash output »</a>
</span>
</div>
</body>
</html>
