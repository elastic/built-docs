<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Monitor Web Application Firewall (WAF) logs | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Monitor Web Application Firewall (WAF) logs | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="ingest-aws-firehose.html" title="Monitor Amazon Web Services (AWS) with Amazon Data Firehose"/>
<link rel="prev" href="monitor-aws-firewall-firehose.html" title="Monitor AWS Network Firewall logs"/>
<link rel="next" href="monitor-aws-cloudwatch-firehose.html" title="Monitor CloudWatch logs"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="monitor-aws-firewall-firehose.html">« Monitor AWS Network Firewall logs</a>
</span>
<span class="next">
<a href="monitor-aws-cloudwatch-firehose.html">Monitor CloudWatch logs »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="monitor-amazon-web-services.html">Amazon Web Services (AWS) monitoring</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="ingest-aws-firehose.html">Monitor Amazon Web Services (AWS) with Amazon Data Firehose</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Monitor Web Application Firewall (WAF) logs</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="monitor-aws-waf-firehose"></a>Monitor Web Application Firewall (WAF) logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></h3>
</div></div></div>

<p>In this section, you&#8217;ll learn how to send AWS WAF events from AWS to your Elastic Stack using Amazon Data Firehose.</p>
<p>You will go through the following steps:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Select a WAF-compatible resource (for example, a CloudFront distribution)
</li>
<li class="listitem">
Create a delivery stream in Amazon Data Firehose
</li>
<li class="listitem">
Create a web Access Control List (ACL) to generate WAF logs
</li>
<li class="listitem">
Set up logging to forward the logs to the Elastic Stack using a Firehose stream
</li>
<li class="listitem">
Visualize your WAF logs in Kibana
</li>
</ul>
</div>
<h5><a id="firehose-waf-prerequisites"></a>Before you begin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></h5>
<p>We assume that you already have:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An AWS account with permissions to pull the necessary data from AWS.
</li>
<li class="listitem">
A deployment using our hosted Elasticsearch Service on <a href="/cloud/elasticsearch-service/signup?page=docs&amp;placement=docs-body" class="ulink" target="_top">Elastic Cloud</a>. The deployment includes an Elasticsearch cluster for storing and searching your data, and Kibana for visualizing and managing your data. AWS Data Firehose works with Elastic Stack version 7.17 or greater, running on Elastic Cloud only.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure the deployment is on AWS, because the Amazon Data Firehose delivery stream connects specifically to an endpoint that needs to be on AWS.</p>
</div>
</div>
<h5><a id="firehose-waf-step-one"></a>Step 1: Install the AWS integration in Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In Kibana, navigate to <span class="strong strong"><strong>Management</strong></span> &gt; <span class="strong strong"><strong>Integrations</strong></span> and browse the catalog to find the AWS integration.
</li>
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Settings</strong></span> tab and click <span class="strong strong"><strong>Install AWS assets</strong></span>.
</li>
</ol>
</div>
<h5><a id="firehose-waf-step-two"></a>Step 2: Create a delivery stream in Amazon Data Firehose<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the <a href="https://console.aws.amazon.com/" class="ulink" target="_top">AWS console</a> and navigate to Amazon Data Firehose.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create Firehose stream</strong></span> and choose the source and destination of your Firehose stream. Unless you are streaming data from Kinesis Data Streams, set source to <code class="literal">Direct PUT</code> and destination to <code class="literal">Elastic</code>.
</li>
<li class="listitem">
Provide a meaningful <span class="strong strong"><strong>Firehose stream name</strong></span> that will allow you to identify this delivery stream later. Your Firehose name must start with the prefix <code class="literal">aws-waf-logs-</code> or it will not show up later.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For advanced use cases, source records can be transformed by invoking a custom Lambda function. When using Elastic integrations, this should not be required.</p>
</div>
</div>
<h5><a id="firehose-waf-step-three"></a>Step 3: Specify the destination settings for your Firehose stream<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the <span class="strong strong"><strong>Destination settings</strong></span> panel, specify the following settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Elastic endpoint URL</strong></span>: Enter the Elastic endpoint URL of your Elasticsearch cluster. To find the Elasticsearch endpoint, go to the Elastic Cloud console, navigate to the Integrations page, and select <span class="strong strong"><strong>Connection details</strong></span>. Here is an example of how it looks like: <code class="literal">https://my-deployment.es.us-east-1.aws.elastic-cloud.com</code>.
</li>
<li class="listitem">
<span class="strong strong"><strong>API key</strong></span>: Enter the encoded Elastic API key. To create an API key, go to the Elastic Cloud console, navigate to the Integrations page, select <span class="strong strong"><strong>Connection details</strong></span> and click <span class="strong strong"><strong>Create and manage API keys</strong></span>. If you are using an API key with <span class="strong strong"><strong>Restrict privileges</strong></span>, make sure to review the Indices privileges to provide at least "auto_configure" &amp; "write" permissions for the indices you will be using with this delivery stream.
</li>
<li class="listitem">
<span class="strong strong"><strong>Content encoding</strong></span>: For a better network efficiency, leave content encoding set to GZIP.
</li>
<li class="listitem">
<span class="strong strong"><strong>Retry duration</strong></span>: Determines how long Firehose continues retrying the request in the event of an error. A duration of 60-300s should be suitable for most use cases.
</li>
<li class="listitem">
<span class="strong strong"><strong>es_datastream_name</strong></span>: <code class="literal">logs-aws.waf-default</code>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h5><a id="firehose-waf-step-four"></a>Step 4: Create a web access control list<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></h5>
<p>To create a new web access control list (ACL), follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the <a href="https://console.aws.amazon.com/" class="ulink" target="_top">AWS console</a> and navigate to the <span class="strong strong"><strong>WAF &amp; Shield</strong></span> page.
</li>
<li class="listitem">
Describe web ACL by entering the resource type, region, and name.
</li>
<li class="listitem">
<p>Associate it to an AWS resource. If you don&#8217;t have an existing resource, you can create and attach a web ACL to several AWS resources:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
CloudFront distribution
</li>
<li class="listitem">
Application Load Balancers
</li>
<li class="listitem">
Amazon API Gateway REST APIs
</li>
<li class="listitem">
Amazon App Runner services
</li>
<li class="listitem">
AWS AppSync GraphQL APIs
</li>
<li class="listitem">
Amazon Cognito user pools
</li>
<li class="listitem">
AWS Verified Access Instances
</li>
</ul>
</div>
</li>
<li class="listitem">
Add a 1 or 2 rules to the <span class="strong strong"><strong>Free rule groups</strong></span> list from the AWS managed rule groups. Keep all other settings to their default values.
</li>
<li class="listitem">
Set the rule priority by keeping default values.
</li>
<li class="listitem">
Configure metrics by keeping default values.
</li>
<li class="listitem">
Review and create the web ACL.
</li>
</ol>
</div>
<h5><a id="firehose-waf-step-five"></a>Step 5: Set up logging<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the web ACL you created in the previous step.
</li>
<li class="listitem">
<p>Open the <span class="strong strong"><strong>Logging and metrics</strong></span> section and edit the following settings:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Logging destination</strong></span>: select "Amazon Data Firehose stream"
</li>
<li class="listitem">
<span class="strong strong"><strong>Amazon Data Firehose stream</strong></span>: select the Firehose stream you created in step 2.
</li>
</ul>
</div>
</li>
</ol>
</div>
<p>WAF creates the required Identity and Access Management (IAM) role.
If your Firehose stream name doesn&#8217;t appear in the list, make sure the name you chose for the stream starts with <code class="literal">aws-waf-logs-</code>, as prescribed by AWS naming conventions.</p>
<h5><a id="firehose-waf-step-six"></a>Step 6: Visualize your WAF logs in Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/cloud-monitoring/aws/monitor-aws-waf-firehose.asciidoc">edit</a></h5>
<p>You can now log into your Elastic Stack to check if the WAF logs are flowing. To generate logs, you can use cURL to send HTTP requests to your testing CloudFront distribution.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">curl -i https://&lt;your cloudfront distribution&gt;.cloudfront.net</pre>
</div>
<div class="console_widget" data-snippet="snippets/55.console"></div>
<p>To maintain a steady flow of logs, you can use <code class="literal">watch -n 5</code> to repeat the command every 5 seconds.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">watch -n 5 curl -i https://&lt;your cloudfront distribution&gt;.cloudfront.net</pre>
</div>
<div class="console_widget" data-snippet="snippets/56.console"></div>
<p>Navigate to Kibana and visualize the first WAF logs in your Elastic Stack.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="firehose-waf-logs.png" alt="Firehose WAF logs in Kibana">
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="monitor-aws-firewall-firehose.html">« Monitor AWS Network Firewall logs</a>
</span>
<span class="next">
<a href="monitor-aws-cloudwatch-firehose.html">Monitor CloudWatch logs »</a>
</span>
</div>
</body>
</html>
