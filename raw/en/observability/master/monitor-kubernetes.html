<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Monitor Kubernetes: Observe the health and performance of your Kubernetes deployments | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Monitor Kubernetes: Observe the health and performance of your Kubernetes deployments | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="observability-tutorials.html" title="Tutorials"/>
<link rel="prev" href="monitor-nginx.html" title="Monitor nginx: Observe the logs and metrics of your nginx instances"/>
<link rel="next" href="redirects.html" title="Appendix A: Deleted pages"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="monitor-nginx.html">« Monitor nginx: Observe the logs and metrics of your nginx instances</a>
</span>
<span class="next">
<a href="redirects.html">Appendix A: Deleted pages »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="observability-tutorials.html">Tutorials</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Monitor Kubernetes: Observe the health and performance of your Kubernetes deployments</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="monitor-kubernetes"></a>Monitor Kubernetes: Observe the health and performance of your Kubernetes deployments<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s.asciidoc">edit</a></h2>
</div></div></div>

<p>Applications running in a containerized environment like Kubernetes pose a
unique monitoring challenge: how do you diagnose and resolve issues with
hundreds of microservices on thousands (or millions) of containers, running
in ephemeral and disposable pods?</p>
<p>A successful Kubernetes monitoring solution has a few requirements:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Monitors all layers of your technology stack, including:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The host systems where Kubernetes is running.
</li>
<li class="listitem">
Kubernetes core components, nodes, pods, and containers running within
the cluster.
</li>
<li class="listitem">
All of the applications and services are running in Kubernetes containers.
</li>
</ul>
</div>
</li>
<li class="listitem">
Automatically detects and monitors services as they appear dynamically.
</li>
<li class="listitem">
Provides a way to correlate related data so that you can group and explore
related metrics, logs, and other observability data.
</li>
</ul>
</div>
<h3><a id="_what_youll_learn_4"></a>What you’ll learn<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s.asciidoc">edit</a></h3>
<p>This guide describes how to use Elastic Observability to observe all layers of
your application, including the orchestration software itself:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Collect logs and metrics from Kubernetes and your applications
</li>
<li class="listitem">
Collect trace data from applications deployed with Kubernetes
</li>
<li class="listitem">
Centralize the data in the Elastic Stack
</li>
<li class="listitem">
Explore the data in real-time using tailored dashboards and Observability UIs
</li>
</ul>
</div>
<p>This guide describes how to deploy Elastic monitoring agents as DaemonSets using
the Elastic Agent manifest files. For other
deployment options, see the Kubernetes operator and custom resource definitions
from <a href="/guide/en/cloud-on-k8s/current/index.html" class="ulink" target="_top">Elastic Cloud on Kubernetes (ECK)</a>.</p>
<h3><a id="kubernetes-monitoring-architecture"></a>Monitoring architecture<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-overview.asciidoc">edit</a></h3>
<p>The Elastic Stack provides the following components for monitoring Kubernetes:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Elastic Agent is a single, unified way to add monitoring for data like logs and metrics to your host.
</li>
<li class="listitem">
Elastic Agent Kubernetes integration, in tandem with Elastic Agent, collects logs and metrics from Kubernetes clusters.
</li>
<li class="listitem">
APM (described later) to monitor, detect, and diagnose complex application
performance issues.
</li>
<li class="listitem">
Elasticsearch for storing and searching your data.
</li>
<li class="listitem">
Observability apps in Kibana for visualizing and managing your observability data.
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/k8s-monitoring-architecture.png" alt="Kubernetes monitoring architecture">
</div>
</div>
<p>The default installation of Elastic Agent is deployed to Kubernetes as a DaemonSet to ensure an instance is running on each node of the cluster.
It collects logs and metrics from pods, containers, and applications running on Kubernetes.</p>
<h3><a id="beats-metadata"></a>Metadata<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-overview.asciidoc">edit</a></h3>
<p>Elastic Agent provides processors for adding metadata to events. The
metadata is valuable for grouping and exploring related data. For example, when
analyzing container logs, you want to know the host and container name,
and be able to correlate logs, metrics, and traces.</p>
<p>The default deployments include processors, when needed, for enriching events
with cloud and host metadata.</p>
<div class="imageblock">
<div class="content">
<img src="images/metadata-processors.png" alt="Metadata processors for cloud" width="Kubernetes" height="and host metadata">
</div>
</div>
<p>For more on these processors, refer to the <a href="/guide/en/fleet/master/add-cloud-metadata-processor.html" class="ulink" target="_top"><code class="literal">add_cloud_metadata</code></a> and <a href="/guide/en/fleet/master/add_host_metadata-processor.html" class="ulink" target="_top"><code class="literal">add_host_metadata</code></a> documentation.</p>
<p>By default, the Kubernetes integration enriches logs and metrics with valuable metadata.</p>
<p>All Kubernetes metrics are enriched with metadata by default. The enrichment happens in code, and can be configured with the <code class="literal">add_resource_metadata</code> block on each dataset.
For more information on configuring the <code class="literal">add_resource_metadata</code> block, refer to <a class="xref" href="monitor-kubernetes.html#monitor-k8s-kubelet-configure-metadata" title="Configure kubelet API metadata enrichment">Configure kubelet API metadata enrichment</a> and <a class="xref" href="monitor-kubernetes.html#monitor-k8s-kube-state-configure-metadata" title="Configure kube-state-metrics metadata enrichment">Configure <code class="literal">kube-state-metrics</code> metadata enrichment</a>.</p>
<p>All Kubernetes logs are enriched with metadata by default. For more on configuring metadata enrichment, refer to <a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-container-logs" title="Collect Kubernetes container logs">Collect Kubernetes container logs</a>.</p>
<p>Now that you have a basic understanding of the monitoring architecture, let&#8217;s learn how to deploy monitoring to your Kubernetes environment.</p>
<h3><a id="_before_you_begin_4"></a>Before you begin<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-overview.asciidoc">edit</a></h3>
<p>Before you can monitor Kubernetes, you need the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elasticsearch for storing and searching your observability data and Kibana for visualizing and managing it.
</li>
<li class="listitem">
If you want to collect Kubernetes state metrics, you need to deploy <code class="literal">kube-state-metrics</code>.
For deployment instructions, refer to the Kubernetes <a href="https://github.com/kubernetes/kube-state-metrics#kubernetes-deployment" class="ulink" target="_top">docs</a>.
</li>
</ul>
</div>
<h3><a id="monitor-kubernetes-integration"></a>Part 1: Add and Configure the Kubernetes integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h3>
<p>To start collecting logs and metrics from your Kubernetes clusters, first add the <a href="https://docs.elastic.co/en/integrations/kubernetes" class="ulink" target="_top">Kubernetes integration</a> to your policy and configure the metrics and logs you want to collect.</p>
<h4><a id="monitor-k8s-add-integration"></a>Step 1: Add the Kubernetes integration to your deployment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>Follow these steps to add the Kubernetes integration to your policy:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Select <span class="strong strong"><strong>Add integrations</strong></span> from your deployment&#8217;s homepage.
</li>
<li class="listitem">
Enter "Kubernetes" in the search bar, and select the <span class="strong strong"><strong>Kubernetes</strong></span> integration.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Kubernetes</strong></span> at the top of the Kubernetes integration page.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add integration only (skip agent installation)</strong></span> at the bottom of the Add integration page.
</li>
</ol>
</div>
<p>Continue to <a class="xref" href="monitor-kubernetes.html#monitor-k8s-configure-integration" title="Step 2: Configure your Kubernetes integration">Step 2: Configure your Kubernetes integration</a>.</p>
<h4><a id="monitor-k8s-configure-integration"></a>Step 2: Configure your Kubernetes integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>The Kubernetes integration can fetch metrics and logs from several components.
From the <span class="strong strong"><strong>Add Kubernetes integration</strong></span> page, configure the options for the metrics and logs you want to collect.
The following sections outline the configuration options.</p>
<p><span class="strong strong"><strong>Collect Metrics</strong></span></p>
<p>Collecting metrics about Kubernetes clusters and the workloads running on top of them is a key aspect of Kubernetes observability.
You need to collect metrics about the resources running on the underlying infrastructure (for example, the machines of your Kubernetes cluster), metrics for the whole cluster, as well as individual metrics for the containers and pods.
Specifically, you need to monitor the health and performance of:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The hosts where Kubernetes components are running. Each host produces metrics
like CPU, memory, disk utilization, and disk and network I/O.
</li>
<li class="listitem">
Kubernetes containers, which produce their own set of metrics.
</li>
<li class="listitem">
The applications running as Kubernetes pods, such as application servers and
databases, each producing its own set of metrics.
</li>
<li class="listitem">
Additional Kubernetes resources (like services, deployments, cronjobs) are valuable assets of the whole infrastructure and produce their own set of metrics that need monitoring.
</li>
</ul>
</div>
<p>Elastic Agent along with the Kubernetes integration provides a unified solution to monitor all layers of your Kubernetes technology stack, so you don&#8217;t need multiple technologies to collect metrics.</p>
<p>You have the following options for collecting metrics about your Kubernetes clusters and the workloads running on top of them:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-kubelet" title="Collect Kubernetes metrics from kubelet API">Collect Kubernetes metrics from kubelet API</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-kube-state" title="Collect Kubernetes metrics from kube-state-metrics">Collect Kubernetes metrics from <code class="literal">kube-state-metrics</code></a>
</li>
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-k8s-api-metrics" title="Collect Kubernetes metrics from Kubernetes API server">Collect Kubernetes metrics from Kubernetes API server</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-k8s-proxy" title="Collect Kubernetes metrics from Kubernetes proxy">Collect Kubernetes metrics from Kubernetes proxy</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-k8s-scheduler" title="Collect Kubernetes metrics from Kubernetes scheduler">Collect Kubernetes metrics from Kubernetes scheduler</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-k8s-controller" title="Collect Kubernetes metrics from Kubernetes controller-manager">Collect Kubernetes metrics from Kubernetes controller-manager</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-k8s-api-events" title="Collect Kubernetes events from Kubernetes API Server">Collect Kubernetes events from Kubernetes API Server</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Collect logs</strong></span></p>
<p>Collecting and analyzing logs of both Kubernetes core components and various applications running on top of Kubernetes is a powerful tool for Kubernetes observability.
Containers running within Kubernetes pods publish logs to stdout or stderr.</p>
<p>You have the following options for collecting Kubernetes logs:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-container-logs" title="Collect Kubernetes container logs">Collect Kubernetes container logs</a>
</li>
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-kubernetes-integration-audit-logs" title="Collect Kubernetes audit logs">Collect Kubernetes audit logs</a>
</li>
</ul>
</div>
<h4><a id="monitor-kubernetes-integration-kubelet"></a>Collect Kubernetes metrics from kubelet API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>Collecting metrics from the kubelet API is on by default.
Kubelet is an agent that runs on each Kubernetes node that is key to managing individual pods and the nodes that host them.
For more information on kubelet, refer to the Kubernetes <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/" class="ulink" target="_top">kubelet docs</a>.</p>
<p>Elastic Agent along with the Kubernetes integration can collect metrics from the kubelet API to gather important information about the state of your Kubernetes nodes, pods, containers, and other resources.
paleExpand the following list to see all available metrics from the kubelet API.</p>
<details>
<summary class="title">Expand to see available metrics from the kubelet API</summary>
<div class="content">
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Container metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor the overall resource usage, performance, and status at the container level. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kubelet#container" class="ulink" target="_top">kubelet container metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Node metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor the overall resource usage, performance, and status at the node level. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kubelet#node" class="ulink" target="_top">kubelet node metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Pod metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor the overall resource usage, performance, and status at the pod level. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kubelet#pod" class="ulink" target="_top">kubelet pod metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>System metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor the overall resource usage, performance, and status of your system containers. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kubelet#system" class="ulink" target="_top">kubelet system metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Volume metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor the storage usage and capacity of your persistent volumes. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kubelet#system" class="ulink" target="_top">kubelet volume metrics</a>.
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</details>
<h5><a id="monitor-k8s-kubelet-configure-metrics"></a>Configure the kubelet API options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Provide the following information for each of the kubelet API options:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Add Metadata</strong></span>
</p>
</td>
<td valign="top">
<p>
This option adds metadata to events. The metadata is valuable for grouping and exploring related data. This option is on by default.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Bearer Token File</strong></span>
</p>
</td>
<td valign="top">
<p>
The file path to the token used to authenticate with the kubelet API.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Hosts</strong></span>
</p>
</td>
<td valign="top">
<p>
The address of the kubelet API server that Elastic will connect to for collecting metrics. <code class="literal">${env.NODE_NAME}</code> is an environment variable that represents the name of the Kubernetes node. Port <code class="literal">10250</code> is the default port where the kubelet API listens for HTTPS connections.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Period</strong></span>
</p>
</td>
<td valign="top">
<p>
How frequently to poll the kubelet API for metrics. The default is every 10 seconds.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>SSL Verification Mode</strong></span>
</p>
</td>
<td valign="top">
<p>
Specify how to handle SSL verification. <code class="literal">none</code> means that SSL verification is disabled.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="monitor-k8s-kubelet-configure-metadata"></a>Configure kubelet API metadata enrichment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Under <span class="strong strong"><strong>Kubernetes Container metrics</strong></span> and <span class="strong strong"><strong>Kubernetes Pod metrics</strong></span>, you can configure metadata enrichment from <span class="strong strong"><strong>Advanced options → Add node and namespace metadata</strong></span>.</p>
<p>From here, update the <code class="literal">add_resource_metadata</code> block to configure enrichment:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml"> add_resource_metadata:
   namespace:
     include_labels: ["namespacelabel1"]
   node:
     include_labels: ["nodelabel2"]
     include_annotations: ["nodeannotation1"]
   deployment: false</pre>
</div>
<h4><a id="monitor-kubernetes-integration-kube-state"></a>Collect Kubernetes metrics from <code class="literal">kube-state-metrics</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You need to deploy <code class="literal">kube-state-metrics</code> before you can use it to collect metric data.
To learn how, refer to the Kubernetes <a href="https://github.com/kubernetes/kube-state-metrics#kubernetes-deployment" class="ulink" target="_top">deployment docs</a>.</p>
</div>
</div>
<p>Collecting metrics from <code class="literal">kube-state-metrics</code> is on by default.
The <code class="literal">kube-state-metrics</code> service provides cluster-wide metrics on the health of Kubernetes objects.
Refer to the <a href="https://github.com/kubernetes/kube-state-metrics" class="ulink" target="_top">kube-state-metrics docs</a> for more information.</p>
<p><code class="literal">kube-state-metrics</code> provides horizontal sharding to support large Kubernetes deployments. Refer to the <a href="https://github.com/elastic/elastic-agent/blob/main/docs/elastic-agent-ksm-sharding.md" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> sharding</a> documentation for more information.</p>
<p>With the Kubernetes integration, you can collect a number of metrics using the <code class="literal">kube-state-metrics</code>. Expand the following list to see all available metrics from <code class="literal">kube-state-metrics</code>.</p>
<details>
<summary class="title">Expand to see available metrics from <code class="literal">kube-state-metrics</code></summary>
<div class="content">
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Container metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor Container performance to ensure efficiency and stability in pods. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_container" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> container metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>CronJob metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor CronJob performance and ensure they&#8217;re running reliably and efficiently. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_cronjob" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> CronJob metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes DaemonSet metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor DaemonSet health and distribution. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_daemonset" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> DaemonSet metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes Deployment metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor deployment status and configuration. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_deployment" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> deployment metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes Job metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor job completion statuses and execution. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_job" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> job metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes Namespace metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor namespace active and terminating statuses. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_namespace" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> namespace metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes Node metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor node health and resource usage. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_node" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> node metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes PersistentVolume metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor PersistentVolume size, status, and storage configuration. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_persistentvolume" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> PersistentVolume metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes PersistentVolumeClaim metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor PersistentVolumeClaim phases, classes, and storage requests. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_persistentvolumeclaim" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> PersistentVolumeClaim metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes Pod metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor pod health and performance. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_pod" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> pod metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes ReplicaSet metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor ReplicaSets status and the number of replicas in your ReplicaSets. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_replicaset" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> ReplicaSet metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes ResourceQuota metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor resource limits and current usage. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_resourcequota" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> ResourceQuota metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes Service metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor service configuration, accessibility, and network integration. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_service" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> service metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes StatefulSet metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor StatefulSet configuration, status, and scaling. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_statefulset" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> StatefulSet metrics</a>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Kubernetes StorageClass metrics</strong></span>
</p>
</td>
<td valign="top">
<p>
Monitor how storage is provisioned and allocated. Learn more at <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-state-metrics#state_storageclass" class="ulink" target="_top"><code class="literal">kube-state-metrics</code> StorageClass metrics</a>.
</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</details>
<h5><a id="monitor-k8s-kube-state-configure-objects"></a>Configure the <code class="literal">kube-state-metrics</code> options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Provide the following information for each of the <code class="literal">kube-state-metrics</code> options:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Add Metadata</strong></span>
</p>
</td>
<td valign="top">
<p>
This option adds metadata to events. The metadata is valuable for grouping and exploring related data. This option is on by default.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Hosts</strong></span>
</p>
</td>
<td valign="top">
<p>
The address where <code class="literal">kube-state-metrics</code> is running. Port 8080 is the default.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Leader Election</strong></span>
</p>
</td>
<td valign="top">
<p>
When on (default behavior), only the Elastic Agent that holds the leadership lock will retrieve metrics from the <code class="literal">kube_state_metrics</code>. This prevents duplicate data in multi-node Kubernetes clusters.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Period</strong></span>
</p>
</td>
<td valign="top">
<p>
How frequently to poll the <code class="literal">kube-state-metrics</code> for metrics. The default is every 10 seconds.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<h5><a id="monitor-k8s-kube-state-configure-metadata"></a>Configure <code class="literal">kube-state-metrics</code> metadata enrichment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Under <span class="strong strong"><strong>Kubernetes Container metrics</strong></span> and <span class="strong strong"><strong>Kubernetes Pod metrics</strong></span>, you can configure metadata enrichment from <span class="strong strong"><strong>Advanced options → Add node and namespace metadata</strong></span>.</p>
<p>From here, update the <code class="literal">add_resource_metadata</code> block to configure enrichment:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">add_resource_metadata:
  namespace:
   enabled: true
    #use_regex_include: false
    include_labels: ["namespacelabel1"]
    #use_regex_exclude: false
    #exclude_labels: ["namespacelabel2"]
  node:
   enabled: true
    #use_regex_include: false
    include_labels: ["nodelabel2"]
    include_annotations: ["nodeannotation1"]
    #use_regex_exclude: false
    #exclude_labels: ["nodelabel3"]
  #deployment: false
  #cronjob: false</pre>
</div>
<h4><a id="monitor-kubernetes-integration-k8s-api-metrics"></a>Collect Kubernetes metrics from Kubernetes API server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>Collecting metrics from the <code class="literal">kube-apiserver</code> is on by default.
The <code class="literal">kube-apiserver</code> sets up and validates pods, services, and other API objects.
These metrics provide insight into the API server&#8217;s performance, workload, and health.</p>
<p>Refer to <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-apiserver" class="ulink" target="_top"><code class="literal">kube-apiserver</code> metrics</a> for more on the metrics collected.</p>
<h5><a id="monitor-k8s-apiserver-configure"></a>Configure Kubernetes API server options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Provide the following information to collect <code class="literal">kube-apiserver</code> metrics:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Bearer Token File</strong></span>
</p>
</td>
<td valign="top">
<p>
The file path to the token used to authenticate with the <code class="literal">kube-apiserver</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Hosts</strong></span>
</p>
</td>
<td valign="top">
<p>
The address of the Kubernetes API server that the integration connects to. It uses the <code class="literal">KUBERNETES_SERVICE_HOST</code> and <code class="literal">KUBERNETES_SERVICE_PORT</code> environment variables.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Leader Election</strong></span>
</p>
</td>
<td valign="top">
<p>
When on (default behavior), only the Elastic Agent that holds the leadership lock will retrieve metrics from the <code class="literal">kube-apiserver</code>. This prevents duplicate data in multi-node Kubernetes clusters.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Period</strong></span>
</p>
</td>
<td valign="top">
<p>
How frequently to poll the <code class="literal">kube-state-metrics</code> for metrics. The default is every 30 seconds.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>SSL Certificate Authorities</strong></span>
</p>
</td>
<td valign="top">
<p>
The path to the certificate authority (CA) bundle used to verify the Kubernetes API server&#8217;s TLS certificate.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<h4><a id="monitor-kubernetes-integration-k8s-proxy"></a>Collect Kubernetes metrics from Kubernetes proxy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>The <code class="literal">kube-proxy</code> runs on each node and maintains network rules.
Collecting metrics from the <code class="literal">kube-proxy</code> is on by default.
These metrics provide insight into the proxy&#8217;s networking activity, performance, and resource usage.</p>
<p>Refer to <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-proxy" class="ulink" target="_top"><code class="literal">kube-proxy</code> metrics</a> for more on the metrics collected.</p>
<h5><a id="monitor-k8s-proxy-configure"></a>Configure Kubernetes proxy options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Provide the following information to collect Kubernetes Proxy metrics:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Hosts</strong></span>
</p>
</td>
<td valign="top">
<p>
The address where <code class="literal">kube-proxy</code> is running. Port 10249 is the default.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Period</strong></span>
</p>
</td>
<td valign="top">
<p>
How frequently to poll the <code class="literal">kube-state-metrics</code> for metrics. The default is every 10 seconds.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<h4><a id="monitor-kubernetes-integration-k8s-scheduler"></a>Collect Kubernetes metrics from Kubernetes scheduler<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>The kube-scheduler assigns new pods with no node assignment to the most appropriate node.
Turn this option on to get metrics from the kube-scheduler.
These metrics provide insight on the performance, resource usage, and health of the <code class="literal">kube-scheduler</code>.</p>
<p>Refer to <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-scheduler" class="ulink" target="_top"><code class="literal">kube-scheduler</code> metrics</a> for more on the metrics collected.</p>
<h5><a id="monitor-k8s-scheduler-configure"></a>Configure Kubernetes scheduler options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Provide the following information to collect Kubernetes scheduler metrics:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Bearer Token File</strong></span>
</p>
</td>
<td valign="top">
<p>
The file path to the token used to authenticate with the <code class="literal">kube-scheduler</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Hosts</strong></span>
</p>
</td>
<td valign="top">
<p>
The address and port of the <code class="literal">kube-scheduler</code> from which the Elastic integration should collect metrics. Port <code class="literal">10259</code> is the default.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Period</strong></span>
</p>
</td>
<td valign="top">
<p>
How frequently to poll the <code class="literal">kube-scheduler</code> for metrics. The default is every 10 seconds.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>SSL Verification Mode</strong></span>
</p>
</td>
<td valign="top">
<p>
Specify how to handle SSL verification. Defaults to <code class="literal">none</code> meaning that SSL verification is disabled.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<h4><a id="monitor-kubernetes-integration-k8s-controller"></a>Collect Kubernetes metrics from Kubernetes controller-manager<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>The <code class="literal">kube-controller-manager</code> regulates the state of the clusters.
Turn this option on to get metrics from the <code class="literal">kube-controller-manager</code>.
These metrics provide insight on the performance, resource usage, and health of the kube-controller-manager.</p>
<p>Refer to <a href="https://docs.elastic.co/en/integrations/kubernetes/kube-controller-manager" class="ulink" target="_top"><code class="literal">kube-controller-manager</code> metrics</a> for more on the metrics collected.</p>
<h5><a id="monitor-k8s-controller-configure"></a>Configure Kubernetes controller-manager options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Provide the following information to collect <code class="literal">kube-controller-manager</code> metrics:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Bearer Token File</strong></span>
</p>
</td>
<td valign="top">
<p>
The file path to the token used to authenticate with the <code class="literal">kube-controller-manager</code>.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Hosts</strong></span>
</p>
</td>
<td valign="top">
<p>
The address and port of the <code class="literal">kube-controller-manager</code> from which the integration should collect metrics. Port 10259 is the default.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Period</strong></span>
</p>
</td>
<td valign="top">
<p>
How frequently to poll the <code class="literal">kube-controller-manager</code> for metrics. The default is every 10 seconds.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>SSL Verification Mode</strong></span>
</p>
</td>
<td valign="top">
<p>
Specify how to handle SSL verification. Defaults to <code class="literal">none</code> meaning that SSL verification is disabled.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<h4><a id="monitor-kubernetes-integration-k8s-api-events"></a>Collect Kubernetes events from Kubernetes API Server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>Event metrics give you an overall view of what&#8217;s happening in a cluster.
These metrics help you understand what&#8217;s happening in your cluster and improve reliability and stability.
Collecting Kubernetes events from the Kubernetes API server is on by default.</p>
<p>Refer to <a href="https://docs.elastic.co/en/integrations/kubernetes/events" class="ulink" target="_top">events metrics</a> for more on the metrics collected.</p>
<h5><a id="monitor-k8s-api-events-configure"></a>Configure events from the Kubernetes API server<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Provide the following information to collect Kubernetes events metrics:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Period</strong></span>
</p>
</td>
<td valign="top">
<p>
How frequently to poll the <code class="literal">kube-api-server</code> for events. The default is every 10 seconds.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Add Metadata</strong></span>
</p>
</td>
<td valign="top">
<p>
Turn on to add metadata to events. The metadata is valuable for grouping and exploring related data.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Skip older events</strong></span>
</p>
</td>
<td valign="top">
<p>
Ignores events that occurred before a certain time
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Leader Election</strong></span>
</p>
</td>
<td valign="top">
<p>
When on (default behavior), only the Elastic Agent that holds the leadership lock will retrieve metrics from the <code class="literal">kube-apiserver</code>. This prevents duplicate data in multi-node Kubernetes clusters.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<h4><a id="monitor-kubernetes-integration-container-logs"></a>Collect Kubernetes container logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<p>Collecting and parsing Kubernetes container logs is on by default.
Containers running within Kubernetes pods publish logs to stdout or stderr.
These logs are written to a location known to kubelet.
The container parser is enabled by default. You can enable additional parsers in <span class="strong strong"><strong>advanced settings</strong></span>.</p>
<p>Metadata enrichment is also enabled by default, and is based on the Kubernetes provider. Use the <code class="literal">add_resource_metadata</code> block of the Kubernetes provider to configure it. Refer to the <a href="/guide/en/fleet/master/kubernetes-provider.html" class="ulink" target="_top">Kubernetes provider</a> docs for more on configuring the provider.</p>
<p>Refer to <a href="https://docs.elastic.co/en/integrations/kubernetes/container-logs" class="ulink" target="_top">Kubernetes container logs</a> for more on collecting container logs.</p>
<h5><a id="monitor-k8s-container-log-configure"></a>Configure Kubernetes container logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h5>
<p>Provide the following information to collect container logs:</p>
<div class="informaltable">
<table border="0" cellpadding="4px">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody valign="top">
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Use Symlinks</strong></span>
</p>
</td>
<td valign="top">
<p>
A symlink is lightweight and doesn&#8217;t contain the data of the log files, but points to their actual location. Symlinks are used by default.
</p>
</td>
</tr>
<tr>
<td valign="top">
<p>
<span class="strong strong"><strong>Condition</strong></span>
</p>
</td>
<td valign="top">
<p>
You can specify a condition to control whether a configuration is applied to the running Elastic Agent.
</p>
</td>
</tr>
</tbody>
</table>
</div>
<h4><a id="monitor-kubernetes-integration-audit-logs"></a>Collect Kubernetes audit logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h4>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Turn this option on to collect audit logs.
Kubernetes audit logs record requests that come to the Kubernetes API from internal and external components.
These logs help you understand cluster behavior and debug issues.</p>
<p>Refer to <a href="https://docs.elastic.co/en/integrations/kubernetes/audit-logs" class="ulink" target="_top">Kubernetes audit logs</a> for more on collecting audit logs.</p>
<h3><a id="monitor-k8s-update-agent-config"></a>Part 2: Configure and install the standalone Elastic Agent<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-add-integration.asciidoc">edit</a></h3>
<p>After configuring your integration, you need to download and update your manifest. First, download the manifest by completing the following steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
At the bottom of the <span class="strong strong"><strong>Add Kubernetes integration</strong></span> page, click <span class="strong strong"><strong>Save and continue</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Elastic Agent to your hosts</strong></span>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Enroll in Fleet?</strong></span>, select <span class="strong strong"><strong>Run standalone</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/run-standalone-option.png" alt="Select run standalone under Enroll in Fleet">
</div>
</div>
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Configure the agent</strong></span>, select <span class="strong strong"><strong>Download Manifest</strong></span>.
</li>
</ol>
</div>
<p>After downloading the manifest, open it and update the <code class="literal">ES_USERNAME</code> and <code class="literal">ES_PASSWORD</code> environment variables in the DaemonSet to match your Elasticsearch credentials.</p>
<p>You can also further modify the manifest to fit your needs. For example, you might want to enable autodiscovery to automatically discover container logs. Refer to the <a href="/guide/en/fleet/master/elastic-agent-kubernetes-autodiscovery.html" class="ulink" target="_top">autodiscovery docs</a> in the Fleet guide for more on enabling autodiscovery in your manifest.</p>
<p>Once you are ready to deploy your Elastic Agent:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the directory where you&#8217;ve downloaded the manifest, run the following apply command:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">kubectl apply -f elastic-agent-standalone-kubernetes.yml</pre>
</div>
</li>
<li class="listitem">
<p>Check the Elastic Agent status with the following command:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">kubectl -n kube-system get pods -l app=elastic-agent</pre>
</div>
</li>
</ol>
</div>
<p>Refer to <a href="/guide/en/fleet/master/debug-standalone-agents.html" class="ulink" target="_top">Debug standalone Elastic Agents</a> if you run into any issues with configuring or installing your Elastic Agent.</p>
<h3><a id="monitor-kubernetes-explore"></a>Part 3: Explore logs and metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-explore-logs-and-metrics.asciidoc">edit</a></h3>
<p>Use Kibana to view the metric and log data collected by Elastic Agent.
Refer to the following sections for more on viewing your data.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-k8s-explore-metrics" title="View performance and health metrics">View performance and health metrics</a>.
</li>
<li class="listitem">
<a class="xref" href="monitor-kubernetes.html#monitor-k8s-explore-logs" title="View logs">View logs</a>.
</li>
</ul>
</div>
<h4><a id="monitor-k8s-explore-metrics"></a>View performance and health metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-explore-logs-and-metrics.asciidoc">edit</a></h4>
<p>To view the performance and health metrics collected by Elastic Agent, open
Kibana and go to <span class="strong strong"><strong>Observability → Infrastructure</strong></span>.</p>
<p>On the <span class="strong strong"><strong>Inventory</strong></span> page, you can switch between different views to see an
overview of the containers and pods running on Kubernetes:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/metrics-inventory.png" alt="Inventory page that shows Kubernetes pods">
</div>
</div>
<p>For more on using the Inventory page, refer to <a class="xref" href="view-infrastructure-metrics.html" title="View infrastructure metrics by resource type">View infrastructure metrics by resource type</a>.</p>
<p>On the <span class="strong strong"><strong>Metrics Explorer</strong></span> page, you can group and analyze metrics for the
resources that you are monitoring.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/monitor-k8s-metrics-explorer.png" alt="Metrics dashboard that shows CPU usage for Kubernetes pods">
</div>
</div>
<p>For more on using the <span class="strong strong"><strong>Metrics Explorer</strong></span> page, refer to <a class="xref" href="explore-metrics.html" title="Explore infrastructure metrics over time">Explore infrastructure metrics over time</a>.</p>
<h4><a id="monitor-k8s-explore-logs"></a>View logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-explore-logs-and-metrics.asciidoc">edit</a></h4>
<p>To view Kubernetes logs, open Kibana and go to <span class="strong strong"><strong>Observability → Logs Explorer</strong></span>.
With <span class="strong strong"><strong>Logs Explorer</strong></span>, you can quickly search and filter your log data, get information about the structure of log fields, and display your findings in a visualization.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/log-explorer.png" alt="screenshot of the logs explorer main page">
</div>
</div>
<p>From <span class="strong strong"><strong>Logs Explorer</strong></span>, you can select the Kubernetes integration from the data selector to view your Kubernetes data.</p>
<p class="screenshot"><span class="image"><img src="images/logs-explorer-applications.png" alt="screenshot of the logs explorer main page" width="50%"></span></p>
<p>From here, you can filter your log data and dive deeper into individual logs to find and troubleshoot issues.
For more information, refer to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="explore-logs.html" title="Logs Explorer">Logs Explorer</a> for an over view of Logs Explorer.
</li>
<li class="listitem">
<a class="xref" href="logs-filter-and-aggregate.html#logs-filter-logs-explorer" title="Filter logs in Log Explorer">Filter logs in Log Explorer</a> for more on filtering logs in Logs Explorer.
</li>
</ul>
</div>
<h3><a id="monitor-kubernetes-application-performance"></a>Part 4: Monitor application performance<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-application-performance.asciidoc">edit</a></h3>
<p>Quickly triage and troubleshoot application performance problems with the help of Elastic
application performance monitoring (APM).</p>
<p>Think of a latency spike&#8201;&#8212;&#8201;APM can help you narrow the scope of your investigation to a single service.
Because you&#8217;ve also ingested and correlated logs and metrics, you can then link the problem to CPU and memory utilization or error log entries of a particular Kubernetes pod.</p>
<h4><a id="_step_1_set_up_apm"></a>Step 1: Set up APM<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-application-performance.asciidoc">edit</a></h4>
<p>Application monitoring data is streamed from your applications running in Kubernetes to APM,
where it is validated, processed, and transformed into Elasticsearch documents.</p>
<p>There are many ways to deploy APM when working with Kubernetes,
but this guide assumes that you&#8217;re using our hosted Elasticsearch Service on Elastic Cloud.
If you haven&#8217;t done so already, enable APM in the <a href="https://cloud.elastic.co?page=docs&amp;placement=docs-body" class="ulink" target="_top">Elasticsearch Service console</a>.</p>
<p>If you want to manage APM yourself, there are a few alternative options:</p>
<details>
<summary class="title">Expand alternatives</summary>
<div class="content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/cloud-on-k8s/current/" class="ulink" target="_top">Elastic Cloud on Kubernetes (ECK)</a>&#8201;&#8212;&#8201;The Elastic recommended approach for managing
APM Server deployed with Kubernetes.
Built on the Kubernetes Operator pattern, ECK extends basic Kubernetes orchestration capabilities
to support the setup and management of APM Server on Kubernetes.
</li>
<li class="listitem">
Deploy APM Server as a DaemonSet&#8201;&#8212;&#8201;Ensure a running instance of APM Server on each node in your cluster.
Useful when all pods in a node should share a single APM Server instance.
</li>
<li class="listitem">
Deploy APM Server as a sidecar&#8201;&#8212;&#8201;For environments that should not share an APM Server,
like when directing traces from multiple applications to separate Elasticsearch clusters.
</li>
<li class="listitem">
<a href="/guide/en/observability/master/apm-getting-started-apm-server.html" class="ulink" target="_top">Download and install APM Server</a>&#8201;&#8212;&#8201;The classic, non-Kubernetes option.
</li>
</ul>
</div>
</div>
</details>
<h4><a id="_step_2_save_your_secret_token"></a>Step 2: Save your secret token<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-application-performance.asciidoc">edit</a></h4>
<p>A <a href="/guide/en/observability/master/apm-secret-token.html" class="ulink" target="_top">secret token</a> is used to secure communication between APM agents
and APM Server. To create or update your secret token in Kibana:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open Kibana and navigate to Fleet.
</li>
<li class="listitem">
Under the <span class="strong strong"><strong>Agent policies</strong></span> tab, select the policy you would like to configure.
</li>
<li class="listitem">
Find the Elastic APM integration and select <span class="strong strong"><strong>Actions → Edit integration</strong></span>.
</li>
<li class="listitem">
Navigate to <span class="strong strong"><strong>Agent authorization → Secret token</strong></span> and set the value of your token.
</li>
<li class="listitem">
Click Save integration. The APM Server will restart before the change takes effect.
</li>
</ol>
</div>
<p>To avoid exposing the secret token, you can store it in a Kubernetes secret. For example:</p>
<div class="pre_wrapper lang-cmd">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-cmd">kubectl create secret generic apm-secret --from-literal=ELASTIC_APM_SECRET_TOKEN=asecretpassword --namespace=kube-system <a id="CO99-1"></a><i class="conum" data-value="1"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO99-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Create the secret in the same namespace that you&#8217;ll be deploying your applications in.</p>
</td>
</tr>
</table>
</div>
<p>If you&#8217;re managing APM Server yourself,
see <a href="/guide/en/observability/master/apm-secret-token.html" class="ulink" target="_top">secret token</a> for instructions on how to set up your secret token.</p>
<p>If you are using ECK to set up APM Server, the operator automatically generates an <code class="literal">{APM-server-name}-apm-token</code> secret for you.</p>
<h4><a id="_step_3_install_and_configure_apm_agents"></a>Step 3: Install and configure APM Agents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-application-performance.asciidoc">edit</a></h4>
<p>In most cases, setting up APM agents and thereby instrumenting your applications
is as easy as installing a library and adding a few lines of code.</p>
<p>Select your application&#8217;s language for details:</p>
<div class="tabs" data-tab-group="apm-agent-kube">
  <div role="tablist" aria-label="Install-kube">
    <button role="tab"
            aria-selected="false"
            aria-controls="go-tab-install-kube"
            id="go-install-kube">
      Go
    </button>
    <button role="tab"
            aria-selected="true"
            aria-controls="java-tab-install-kube"
            id="java-install-kube"
            tabindex="-1">
      Java
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="net-tab-install-kube"
            id="net-install-kube"
            tabindex="-1">
      .NET
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="node-tab-install-kube"
            id="node-install-kube"
            tabindex="-1">
      Node.js
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="php-tab-install-kube"
            id="php-install-kube"
            tabindex="-1">
      PHP
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="python-tab-install-kube"
            id="python-install-kube"
            tabindex="-1">
      Python
    </button>
    <button role="tab"
            aria-selected="false"
            aria-controls="ruby-tab-install-kube"
            id="ruby-install-kube"
            tabindex="-1">
      Ruby
    </button>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="go-tab-install-kube"
       aria-labelledby="go-install-kube"
       hidden="">
<p><span class="strong strong"><strong>Install the agent</strong></span></p>
<p>Install the APM agent packages for Go.</p>
<div class="pre_wrapper lang-go">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-go">go get go.elastic.co/apm</pre>
</div>
<p><span class="strong strong"><strong>Instrument your application</strong></span></p>
<p>Instrument your Go application by using one of the provided instrumentation modules or by using the tracer API directly.</p>
<div class="pre_wrapper lang-go">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-go">import (
	"net/http"

	"go.elastic.co/apm/module/apmhttp"
)

func main() {
	mux := http.NewServeMux()
	...
	http.ListenAndServe(":8080", apmhttp.Wrap(mux))
}</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Configure the agent using environment variables:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">        # ...
        - name: ELASTIC_APM_SERVER_URL
          value: "apm-server-url-goes-here" <a id="CO100-1"></a><i class="conum" data-value="1"></i>
        - name: ELASTIC_APM_SECRET_TOKEN
          valueFrom:
            secretKeyRef:
              name: apm-secret
              key: ELASTIC_APM_SECRET_TOKEN <a id="CO100-2"></a><i class="conum" data-value="2"></i>
        - name: ELASTIC_APM_SERVICE_NAME
          value: "service-name-goes-here" <a id="CO100-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO100-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to <code class="literal">http://localhost:8200</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO100-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Pass in <code class="literal">ELASTIC_APM_SECRET_TOKEN</code> from the <code class="literal">apm-secret</code> keystore created previously</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO100-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allowed characters: a-z, A-Z, 0-9, -, _, and space</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/go/2.x/supported-tech.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/go/2.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/go/2.x/getting-started.html" class="ulink" target="_top">Detailed guide to instrumenting Go source code</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="java-tab-install-kube"
       aria-labelledby="java-install-kube">
<p><span class="strong strong"><strong>Attach the agent</strong></span></p>
<p>The Java agent can instrument supported technologies without
any changes to an application image or code.
To do this, you&#8217;ll need an
<a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/" class="ulink" target="_top">init container</a>
based on an official Elastic APM docker image.</p>
<p>Before your application starts, copy the agent from the init container into a shared volume.
For example, with the Java agent:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">    # ...
    spec:
      volumes:
      - name: elastic-apm-agent <a id="CO101-1"></a><i class="conum" data-value="1"></i>
        emptyDir: {}
      initContainers:
      - name: elastic-java-agent
        image: docker.elastic.co/observability/apm-agent-java:1.12.0 <a id="CO101-2"></a><i class="conum" data-value="2"></i>
        volumeMounts:
        - mountPath: /elastic/apm/agent
          name: elastic-apm-agent
        command: ['cp', '-v', '/usr/agent/elastic-apm-agent.jar', '/elastic/apm/agent'] <a id="CO101-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO101-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The shared volume</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO101-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Build the <code class="literal">initContainer</code> from the official Elastic Java agent image</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO101-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Copy the agent to the shared volume</p>
</td>
</tr>
</table>
</div>
<p>The Java command line needs a way to pick up this <code class="literal">javaagent</code> configuration.
You can use the standard JVM TI <a href="https://docs.oracle.com/javase/8/docs/platform/jvmti/jvmti.html#tooloptions" class="ulink" target="_top">JAVA_TOOL_OPTIONS</a> environment variable to do this.
It doesn&#8217;t have to be explicitly specified and is picked up automatically by the JVM when it starts.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>For JVMs that don&#8217;t support this option, you can use any other environment variable&#8201;&#8212;&#8201;either one already defined in your startup script, like <code class="literal">JAVA_OPTS</code> in some servlet container scripts,
or add a dedicated empty one that will have no effect if it&#8217;s not set.</p>
</div>
</div>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">      # ...
      containers:
      - name: your-app-container
        env:
        # ...
        - name: JAVA_TOOL_OPTIONS <a id="CO102-1"></a><i class="conum" data-value="1"></i>
          value: -javaagent:/elastic/apm/agent/elastic-apm-agent.jar</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO102-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Used for the command line to pick up the <code class="literal">javaagent</code> configuration</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Configure the agent using environment variables:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">        # ...
        - name: ELASTIC_APM_SERVER_URLS
          value: "apm-server-url-goes-here" <a id="CO103-1"></a><i class="conum" data-value="1"></i>
        - name: ELASTIC_APM_SECRET_TOKEN
          valueFrom:
            secretKeyRef:
              name: apm-secret
              key: ELASTIC_APM_SECRET_TOKEN <a id="CO103-2"></a><i class="conum" data-value="2"></i>
        - name: ELASTIC_APM_SERVICE_NAME
          value: "service-name-goes-here" <a id="CO103-3"></a><i class="conum" data-value="3"></i>
        - name: ELASTIC_APM_APPLICATION_PACKAGES
          value: "org.springframework.samples.petclinic" <a id="CO103-4"></a><i class="conum" data-value="4"></i>
        - name: JAVA_TOOL_OPTIONS <a id="CO103-5"></a><i class="conum" data-value="5"></i>
          value: -javaagent:/elastic/apm/agent/elastic-apm-agent.jar</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO103-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to <code class="literal">http://localhost:8200</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO103-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Pass in <code class="literal">ELASTIC_APM_SECRET_TOKEN</code> from the <code class="literal">apm-secret</code> keystore created previously</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO103-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allowed characters: a-z, A-Z, 0-9, -, _, and space</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO103-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Used to determine whether a stack trace frame is an <em>in-app</em> frame or a <em>library</em> frame.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO103-5"><i class="conum" data-value="5"></i></a></p>
</td>
<td align="left" valign="top">
<p>Explained previously</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/java/1.x/supported-technologies-details.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/java/1.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="net-tab-install-kube"
       aria-labelledby="net-install-kube"
       hidden="">
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>These instructions are for .NET Core v2.2+.
All other use-cases require downloading the agent from NuGet and adding it to your application.
See <a href="/guide/en/apm/agent/dotnet/1.x/setup.html" class="ulink" target="_top">set up the Agent</a> for full details.
Once agent set-up is complete, jump to the <span class="strong strong"><strong>Configure the agent</strong></span> section on this page.</p>
</div>
</div>
<p><span class="strong strong"><strong>Use an init container to download and extract the agent</strong></span></p>
<p>The .Net agent automatically instruments .NET Core version 2.2 and newer without
any application code changes.
To do this, you&#8217;ll need an
<a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/" class="ulink" target="_top">init container</a>
that pulls and unzips the latest agent release:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">    # ...
    spec:
      volumes:
      - name: elastic-apm-agent <a id="CO104-1"></a><i class="conum" data-value="1"></i>
        emptyDir: {}
      initContainers:
      - name: elastic-dotnet-agent
        image: busybox
        command: ["/bin/sh","-c"] <a id="CO104-2"></a><i class="conum" data-value="2"></i>
        args: <a id="CO104-3"></a><i class="conum" data-value="3"></i>
          - wget -qO './elastic-apm-agent/ElasticApmAgent.zip' https://github.com/elastic/apm-agent-dotnet/releases/download/1.7.0/ElasticApmAgent_1.7.0.zip;
            cd elastic-apm-agent;
            cat ElasticApmAgent.zip | busybox unzip -;
        volumeMounts:
        - mountPath: /elastic-apm-agent
          name: elastic-apm-agent</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO104-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The shared volume.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO104-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Runs a shell and executes the provided <code class="literal">args</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO104-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Gets the latest <code class="literal">apm-agent-dotnet</code> release and saves it to <code class="literal">elastic-apm-agent/ElasticApmAgent.zip</code>.
Then <code class="literal">cd</code> into the directory and unzip the file&#8217;s contents. Don&#8217;t forget to update the GitHub URL in this
command with the version of the agent you&#8217;d like to use.</p>
</td>
</tr>
</table>
</div>
<p>To connect the agent to your application, point the <code class="literal">DOTNET_STARTUP_HOOKS</code> environment
variable towards <code class="literal">ElasticApmAgentStartupHook.dll</code> file that now exists in the
<code class="literal">/elastic-apm-agent</code> directory of the <code class="literal">elastic-apm-agent</code> volume.</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">      # ...
      containers:
      - name: your-app-container
        volumeMounts:
        - mountPath: /elastic-apm-agent
          name: elastic-apm-agent
        env:
        # ...
        - name: DOTNET_STARTUP_HOOKS
          value: "/elastic-apm-agent/ElasticApmAgentStartupHook.dll"</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Configure the agent using environment variables:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">        # ...
        - name: ELASTIC_APM_SERVER_URLS
          value: "apm-server-url-goes-here" <a id="CO105-1"></a><i class="conum" data-value="1"></i>
        - name: ELASTIC_APM_SECRET_TOKEN
          valueFrom:
            secretKeyRef:
              name: apm-secret
              key: ELASTIC_APM_SECRET_TOKEN <a id="CO105-2"></a><i class="conum" data-value="2"></i>
        - name: ELASTIC_APM_SERVICE_NAME
          value: "service-name-goes-here" <a id="CO105-3"></a><i class="conum" data-value="3"></i>
        - name: DOTNET_STARTUP_HOOKS <a id="CO105-4"></a><i class="conum" data-value="4"></i>
          value: "/elastic-apm-agent/ElasticApmAgentStartupHook.dll"</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO105-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to <code class="literal">http://localhost:8200</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO105-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Pass in <code class="literal">ELASTIC_APM_SECRET_TOKEN</code> from the <code class="literal">apm-secret</code> keystore created previously</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO105-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allowed characters: a-z, A-Z, 0-9, -, _, and space</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO105-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Explained previously and only required when using the no-code instrumentation method.</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/dotnet/1.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/dotnet/1.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="node-tab-install-kube"
       aria-labelledby="node-install-kube"
       hidden="">
<p><span class="strong strong"><strong>Install the APM agent</strong></span></p>
<p>Install the APM agent for Node.js as a dependency to your application.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">npm install elastic-apm-node --save</pre>
</div>
<p><span class="strong strong"><strong>Start the agent</strong></span></p>
<p>It’s important that the agent is started before you require any other modules in your Node.js application&#8201;&#8212;&#8201;before <code class="literal">express</code>, <code class="literal">http</code>, etc.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">var apm = require('elastic-apm-node').start()</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Configure the agent using environment variables:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">        # ...
        - name: ELASTIC_APM_SERVER_URL
          value: "apm-server-url-goes-here" <a id="CO106-1"></a><i class="conum" data-value="1"></i>
        - name: ELASTIC_APM_SECRET_TOKEN
          valueFrom:
            secretKeyRef:
              name: apm-secret
              key: ELASTIC_APM_SECRET_TOKEN <a id="CO106-2"></a><i class="conum" data-value="2"></i>
        - name: ELASTIC_APM_SERVICE_NAME
          value: "service-name-goes-here" <a id="CO106-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO106-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to <code class="literal">http://localhost:8200</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO106-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Pass in <code class="literal">ELASTIC_APM_SECRET_TOKEN</code> from the <code class="literal">apm-secret</code> keystore created previously</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO106-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to "name" field in package.json, if not specified. Allowed characters: a-z, A-Z, 0-9, -, _, and space</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/nodejs/4.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/nodejs/4.x/advanced-setup.html" class="ulink" target="_top">Configuring the agent</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="php-tab-install-kube"
       aria-labelledby="php-install-kube"
       hidden="">
<p><span class="strong strong"><strong>Install the agent</strong></span></p>
<p>Install the PHP agent using one of the <a href="https://github.com/elastic/apm-agent-php/releases" class="ulink" target="_top">published packages</a>.</p>
<p>To use the RPM Package (RHEL/CentOS and Fedora):</p>
<div class="pre_wrapper lang-php">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-php">rpm -ivh &lt;package-file&gt;.rpm</pre>
</div>
<p>To use the DEB package (Debian and Ubuntu):</p>
<div class="pre_wrapper lang-php">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-php">dpkg -i &lt;package-file&gt;.deb</pre>
</div>
<p>To use the APK package (Alpine):</p>
<div class="pre_wrapper lang-php">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-php">apk add --allow-untrusted &lt;package-file&gt;.apk</pre>
</div>
<p>If you can’t find your distribution,
you can install the agent by <a href="/guide/en/apm/agent/php/current/setup.html" class="ulink" target="_top">building it from the source</a>.</p>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Configure the agent using environment variables:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">        # ...
        - name: ELASTIC_APM_SERVER_URL
          value: "apm-server-url-goes-here" <a id="CO107-1"></a><i class="conum" data-value="1"></i>
        - name: ELASTIC_APM_SECRET_TOKEN
          valueFrom:
            secretKeyRef:
              name: apm-secret
              key: ELASTIC_APM_SECRET_TOKEN <a id="CO107-2"></a><i class="conum" data-value="2"></i>
        - name: ELASTIC_APM_SERVICE_NAME
          value: "service-name-goes-here" <a id="CO107-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO107-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to <code class="literal">http://localhost:8200</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO107-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Pass in <code class="literal">ELASTIC_APM_SECRET_TOKEN</code> from the <code class="literal">apm-secret</code> keystore created previously</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO107-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allowed characters: a-z, A-Z, 0-9, -, _, and space</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/php/current/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/php/current/configuration.html" class="ulink" target="_top">Configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="python-tab-install-kube"
       aria-labelledby="python-install-kube"
       hidden="">
<p><span class="strong strong"><strong>Install the APM agent</strong></span></p>
<p>Install the APM agent for Python as a dependency:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python"># Django
pip install elastic-apm

# Flask
pip install elastic-apm[flask]</pre>
</div>
<p><span class="strong strong"><strong>Add the agent to your application</strong></span></p>
<p>For Django, Add <code class="literal">elasticapm.contrib.django</code> to <code class="literal">INSTALLED_APPS</code> in your settings:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">INSTALLED_APPS = (
   # ...
   'elasticapm.contrib.django',
)</pre>
</div>
<p>For Flask, initialize the agent for your application using environment variables:</p>
<div class="pre_wrapper lang-python">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-python">from elasticapm.contrib.flask import ElasticAPM

app = Flask(__name__)

apm = ElasticAPM(app)</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Configure the agent using environment variables:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">        # ...
        - name: ELASTIC_APM_SERVER_URL
          value: "apm-server-url-goes-here" <a id="CO108-1"></a><i class="conum" data-value="1"></i>
        - name: ELASTIC_APM_SECRET_TOKEN
          valueFrom:
            secretKeyRef:
              name: apm-secret
              key: ELASTIC_APM_SECRET_TOKEN <a id="CO108-2"></a><i class="conum" data-value="2"></i>
        - name: ELASTIC_APM_SERVICE_NAME
          value: "service-name-goes-here" <a id="CO108-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO108-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to <code class="literal">http://localhost:8200</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO108-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Pass in <code class="literal">ELASTIC_APM_SECRET_TOKEN</code> from the <code class="literal">apm-secret</code> keystore created previously</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO108-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allowed characters: a-z, A-Z, 0-9, -, _, and space</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/python/6.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/python/6.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
  <div tabindex="0"
       role="tabpanel"
       id="ruby-tab-install-kube"
       aria-labelledby="ruby-install-kube"
       hidden="">
<p><span class="strong strong"><strong>Install the APM agent</strong></span></p>
<p>Add the agent to your Gemfile.</p>
<div class="pre_wrapper lang-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby">gem 'elastic-apm'</pre>
</div>
<p><span class="strong strong"><strong>Start the agent</strong></span></p>
<p>Rails: APM will automatically start when your app boots.</p>
<p>Rack: Include the middleware and start and stop Elastic APM:</p>
<div class="pre_wrapper lang-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby"># config.ru

app = lambda do |env|
  [200, {'Content-Type' =&gt; 'text/plain'}, ['ok']]
end

# Wraps all requests in transactions and reports exceptions
use ElasticAPM::Middleware

# Start an instance of the Agent
ElasticAPM.start()

run app

# Gracefully stop the agent when process exits.
# Makes sure any pending transactions have already sent.
at_exit { ElasticAPM.stop }</pre>
</div>
<p><span class="strong strong"><strong>Configure the agent</strong></span></p>
<p>Configure the agent using environment variables:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">        # ...
        - name: ELASTIC_APM_SERVER_URL
          value: "apm-server-url-goes-here" <a id="CO109-1"></a><i class="conum" data-value="1"></i>
        - name: ELASTIC_APM_SECRET_TOKEN
          valueFrom:
            secretKeyRef:
              name: apm-secret
              key: ELASTIC_APM_SECRET_TOKEN <a id="CO109-2"></a><i class="conum" data-value="2"></i>
        - name: ELASTIC_APM_SERVICE_NAME
          value: "service-name-goes-here" <a id="CO109-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO109-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Defaults to <code class="literal">http://localhost:8200</code></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO109-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Pass in <code class="literal">ELASTIC_APM_SECRET_TOKEN</code> from the <code class="literal">apm-secret</code> keystore created previously</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO109-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Allowed characters: a-z, A-Z, 0-9, -, _, and space</p>
</td>
</tr>
</table>
</div>
<p><span class="strong strong"><strong>Learn more in the agent reference</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/ruby/4.x/supported-technologies.html" class="ulink" target="_top">Supported technologies</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/ruby/4.x/configuration.html" class="ulink" target="_top">Advanced configuration</a>
</li>
</ul>
</div>
  </div>
</div>
<h4><a id="_step_4_configure_kubernetes_data"></a>Step 4: Configure Kubernetes data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-application-performance.asciidoc">edit</a></h4>
<p>In most instances, APM agents automatically read Kubernetes data from inside the
container and send it to APM Server.
If this is not the case, or if you wish to override this data,
you can set environment variables for the agents to read.
These environment variable are set via the <a href="https://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information/#the-downward-api" class="ulink" target="_top">Downward API</a>
in your Kubernetes pod spec:</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">      # ...
      containers:
      - name: your-app-container
        env:
        # ...
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: KUBERNETES_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: KUBERNETES_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: KUBERNETES_POD_UID
          valueFrom:
            fieldRef:
              fieldPath: metadata.uid</pre>
</div>
<p>The table below maps these environment variables to the APM metadata event field:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Environment variable</th>
<th align="left" valign="top">Metadata field name</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">KUBERNETES_NODE_NAME</code></p></td>
<td align="left" valign="top"><p>system.kubernetes.node.name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">KUBERNETES_POD_NAME</code></p></td>
<td align="left" valign="top"><p>system.kubernetes.pod.name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">KUBERNETES_NAMESPACE</code></p></td>
<td align="left" valign="top"><p>system.kubernetes.namespace</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">KUBERNETES_POD_UID</code></p></td>
<td align="left" valign="top"><p>system.kubernetes.pod.uid</p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="_step_5_deploy_your_application"></a>Step 5: Deploy your application<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-application-performance.asciidoc">edit</a></h4>
<p>APM agents are deployed with your application.</p>
<details>
<summary class="title">Resource configuration file example</summary>
<div class="content">
<p>A complete resource configuration file based on the previous steps.</p>
<div class="pre_wrapper lang-yml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: &lt;&lt;your-app&gt;&gt;
  namespace: kube-system
  labels:
    app: &lt;&lt;your-app&gt;&gt;
    service: &lt;&lt;your-app&gt;&gt;
spec:
  replicas: 1
  selector:
    matchLabels:
      app: &lt;&lt;your-app&gt;&gt;
  template:
    metadata:
      labels:
        app: &lt;&lt;your-app&gt;&gt;
        service: &lt;&lt;your-app&gt;&gt;
    spec:
      dnsPolicy: ClusterFirstWithHostNet
      volumes:
      - name: elastic-apm-agent
        emptyDir: {}
      initContainers:
      - name: elastic-java-agent
        image: docker.elastic.co/observability/apm-agent-java:1.12.0
        volumeMounts:
        - mountPath: /elastic/apm/agent
          name: elastic-apm-agent
        command: ['cp', '-v', '/usr/agent/elastic-apm-agent.jar', '/elastic/apm/agent']
      containers:
      - name: &lt;&lt;your-app&gt;&gt;
        image: &lt;&lt;your-app&gt;&gt;
        volumeMounts:
        - mountPath: /elastic/apm/agent
          name: elastic-apm-agent
        env:
        - name: ELASTIC_APM_SERVER_URL
          value: "apm-server-url-goes-here"
        - name: ELASTIC_APM_SECRET_TOKEN
          valueFrom:
            secretKeyRef:
              name: apm-secret
              key: ELASTIC_APM_SECRET_TOKEN
        - name: ELASTIC_APM_SERVICE_NAME
          value: "petclinic"
        - name: ELASTIC_APM_APPLICATION_PACKAGES
          value: "org.springframework.samples.petclinic"
        - name: ELASTIC_APM_ENVIRONMENT
          value: test
        - name: JAVA_TOOL_OPTIONS
          value: -javaagent:/elastic/apm/agent/elastic-apm-agent.jar
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: KUBERNETES_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: KUBERNETES_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: KUBERNETES_POD_UID
          valueFrom:
            fieldRef:
              fieldPath: metadata.uid</pre>
</div>
</div>
</details>
<div class="pre_wrapper lang-cmd">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-cmd">kubectl apply -f demo.yml</pre>
</div>
<h4><a id="_view_your_traces_in_kibana"></a>View your traces in Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s-application-performance.asciidoc">edit</a></h4>
<p>To view your application&#8217;s trace data, open Kibana and go to <span class="strong strong"><strong>Observability → Services</strong></span>.</p>
<p>The APM app allows you to monitor your software services and applications in real-time:
visualize detailed performance information on your services, identify and analyze errors,
and monitor host-level and agent-specific metrics like JVM and Go runtime metrics.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/apm-app-landing.png" alt="APM app Kubernetes">
</div>
</div>
<p>Having access to application-level insights with just a few clicks can drastically decrease the time you spend debugging errors, slow response times, and crashes.</p>
<p>Best of all, because Kubernetes environment variables have been mapped to APM metadata events,
you can filter your trace data by Kubernetes <code class="literal">namespace</code>, <code class="literal">node.name</code>, <code class="literal">pod.name</code>, and <code class="literal">pod.uid</code>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/apm-app-kubernetes-filter.png" alt="APM app Kubernetes">
</div>
</div>
<h3><a id="_whats_next_4"></a>What’s next<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/monitor-k8s/monitor-k8s.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Want to protect your endpoints from security threats? Try
<a href="/security" class="ulink" target="_top">Elastic Security</a>. Adding endpoint protection is
just another integration that you add to the agent policy!
</li>
<li class="listitem">
Are your eyes bleary from staring at a wall of screens?
<a href="/guide/en/observability/master/create-alerts.html" class="ulink" target="_top">Create alerts</a> and find out about
problems while sipping your favorite beverage poolside.
</li>
<li class="listitem">
Want Elastic to do the heavy lifting? Use machine learning to
<a href="/guide/en/observability/master/inspect-log-anomalies.html" class="ulink" target="_top">detect anomalies</a>.
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="monitor-nginx.html">« Monitor nginx: Observe the logs and metrics of your nginx instances</a>
</span>
<span class="next">
<a href="redirects.html">Appendix A: Deleted pages »</a>
</span>
</div>
</body>
</html>
