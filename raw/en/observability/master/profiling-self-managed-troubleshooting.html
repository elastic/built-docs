<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Troubleshoot the Universal Profiling backend | Elastic Observability [master] | Elastic</title>
<meta class="elastic" name="content" content="Troubleshoot the Universal Profiling backend | Elastic Observability [master]">

<link rel="home" href="index.html" title="Elastic Observability [master]"/>
<link rel="up" href="profiling-self-managed.html" title="Run Universal Profiling on self-hosted Elastic stack"/>
<link rel="prev" href="profiling-self-managed-ops.html" title="Operate the Universal Profiling backend"/>
<link rel="next" href="create-alerts.html" title="Alerting"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Observability"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/master"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="profiling-self-managed-ops.html">« Operate the Universal Profiling backend</a>
</span>
<span class="next">
<a href="create-alerts.html">Alerting »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Observability [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="universal-profiling.html">Universal Profiling</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="profiling-self-managed.html">Run Universal Profiling on self-hosted Elastic stack</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Troubleshoot the Universal Profiling backend</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="profiling-self-managed-troubleshooting"></a>Troubleshoot the Universal Profiling backend<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></h3>
</div></div></div>

<p>Refer to the following sections to troubleshoot any issues you encounter when setting up or operating the Universal Profiling backend services.</p>
<h5><a id="_application_behavior"></a>Application behavior<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></h5>
<h6><a id="_missing_stack_traces_in_the_ui"></a>Missing stack traces in the UI<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></h6>
<p>If there is a sudden drop in the number of stack traces in the UI, or if the UI is displaying none at all,
the collector service may be having trouble and thus data ingestion is impacted.</p>
<p>The status of the collector can be inferred from the health checks and the metrics exposed.</p>
<p>Most notable causes of an impaired collector are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
collector is not able to connect to the Elasticsearch cluster: the connection or authentication details may be wrong
</li>
<li class="listitem">
collector is not starting up properly: the collector may be crashing on startup, or it may be stuck in a loop (when deployed through an orchestration system): check the logs for any errors
</li>
</ul>
</div>
<h6><a id="_missing_symbols"></a>Missing symbols<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></h6>
<p>One of the most useful features of Universal Profiling is the ability to display the source code file and line number
of the stack trace frames.
This is only possible if the symbols are processed correctly in the backend services.</p>
<p>When the symbols are missing, the UI will display the stack trace frames of native applications with an hexadecimal addresses, in the form <code class="literal">0x1234abcd</code>.
If this is happening for most of the native frames, including public OS package files, this is a sign that the debug symbols are not being processed correctly.</p>
<p>It is possible to verify that the symbolizer is working correctly by using the health check endpoint and the metrics exposed.</p>
<p>The most notable causes of an impaired symbolizer are:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
symbolizer is not able to connect to the debug symbol endpoint: this is an internet-exposed endpoint, so it may be blocked by a firewall
</li>
<li class="listitem">
symbolizer is not starting up properly: the symbolizer may be crashing on startup, possibly due to misconfigurations,
or it may be stuck in a loop (when deployed through an orchestration system): check the logs for any errors
</li>
</ol>
</div>
<h5><a id="_general_troubleshooting"></a>General troubleshooting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></h5>
<h6><a id="_capacity_planning"></a>Capacity planning<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></h6>
<p>When deploying Universal Profiling Agents on a new set of machines, it is possible that the backend services will
not be able to handle the load. This is especially true if the number of Universal Profiling Agents is large, or if the Universal Profiling Agents are
deployed on machines with a large number of cores.</p>
<p>The traffic pattern of the Universal Profiling Agents is prone to bursts on startup, and the backend services may not be able to handle the burst of traffic
coming from a large number of Universal Profiling Agents at the same time.</p>
<p>Even if the capacity of the backend services was planned based on the number of Universal Profiling Agents as suggested in <a class="xref" href="profiling-self-managed-ops.html#profiling-self-managed-ops-sizing-guidance" title="Resource guide">Sizing guidance</a>,
we recommend deploying Universal Profiling Agents are in batches. For example, deploy 20% of the fleet at a time.
After deploying a batch of Universal Profiling Agents, pause for at least 30 to 60 seconds before deploying the next batch to allow the backend services to stabilize.
When the Universal Profiling Agent starts fresh on a new machine, it scans all the existing processes
and sends the executable&#8217;s metadata to the backend services. This can cause a burst of traffic that can overwhelm the backend services.</p>
<h6><a id="_inspecting_the_metrics"></a>Inspecting the metrics<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></h6>
<p>Once metrics are exposed by the backend services, it is possible to inspect them to understand the behavior of the services.
Refer to <a class="xref" href="profiling-self-managed-ops.html#profiling-self-managed-ops-monitoring-metrics" title="Metrics">Metrics</a> for instructions on how to expose metrics.</p>
<p>We don&#8217;t yet provide pre-built Kibana dashboards to monitor the services, but we have compiled a list of the most useful metrics to monitor.
The prominent peak of goroutines or memory usage is a sign that the service is under stress and may be having trouble.
If there&#8217;s the possibility of having access to Linux kernel telemetry for the hosts running the backend services, the most important metrics to monitor are the CPU throttling and the network usage.</p>
<h6><a id="_reading_debug_logs"></a>Reading debug logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/observability/profiling-self-managed-troubleshooting.asciidoc">edit</a></h6>
<p>The backend services can be configured to log at debug level, which can be useful for troubleshooting issues.
To do so, there&#8217;s a <code class="literal">verbose</code> config entry in each YAML configuration file, which can be set to <code class="literal">true</code> to enable debug logging.
The same configuration option can be set through the CLI flags, as detailed in <a class="xref" href="profiling-self-managed-ops.html#profiling-self-managed-ops-configuration-cli-overrides" title="Use CLI flags to override configuration file values">Use CLI flags to override configuration file values"</a>.</p>
<p>When running the backend services in verbose mode, the logs will be helpful to troubleshoot issues.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Debug logs create an output that is unsuited for long-running production deployments.
The verbose mode should only be enabled on a single replica at a time, and only for a short period of time,
as it reduces performance and increases the CPU usage of the service.</p>
</div>
</div>
<p>When verbose mode is enabled, there will be fine-grained information logged about the operations of the service.
In the case of collectors, the component responsible for ingesting data in Elasticsearch will be the most frequent.
For symbolizers most of the logs will be related to the processing of native frames, initially detected by the collector.</p>
<p>If you are troubleshooting startup issues for both services, logs are the most useful source of information.
On startup, each service generates logs indicating whether it was able or unable to parse configurations and begin processing incoming requests.
Any startup errors will be logged using the <code class="literal">log.level=error</code> field.
Use these error logs to find misconfigurations or other issues that could prevent the service from starting.
Errors will be logged using the <code class="literal">log.level=error</code> field: they can be used to spot misconfigurations or other issues that prevent the service from starting up.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="profiling-self-managed-ops.html">« Operate the Universal Profiling backend</a>
</span>
<span class="next">
<a href="create-alerts.html">Alerting »</a>
</span>
</div>
</body>
</html>
