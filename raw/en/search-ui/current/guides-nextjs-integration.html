<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords" content="search-bar-in-header">
<title>NextJS Integration | Search UI | Elastic</title>
<meta class="elastic" name="content" content="NextJS Integration | Search UI">

<link rel="home" href="index.html" title="Search UI"/>
<link rel="up" href="guides-using-with-vue-js.html" title="Using with Vue.js"/>
<link rel="prev" href="guides-building-a-custom-connector.html" title="Building a custom connector"/>
<link rel="next" href="api-architecture.html" title="Architecture"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Search UI"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Search UI/Guide"/>
<meta name="DC.subject" content="Search UI"/>
<meta name="DC.identifier" content="main"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="guides-building-a-custom-connector.html">« Building a custom connector</a>
</span>
<span class="next">
<a href="api-architecture.html">Architecture »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Search UI</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="guides-using-with-vue-js.html">Using with Vue.js</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>NextJS Integration</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/search-ui/edit/main/docs/guides-nextjs-integration.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="guides-nextjs-integration"></a>NextJS Integration</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/search-ui/edit/main/docs/guides-nextjs-integration.asciidoc">edit</a></div>
</div></div></div>
<div class="position-relative"><h4><a id="guides-nextjs-integration-integrating-search-ui-with-nextjs-router"></a>Integrating Search UI with NextJS Router</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/search-ui/edit/main/docs/guides-nextjs-integration.asciidoc">edit</a></div>
<p>Next JS is a popular React framework that provides a number of features out of the box, including server-side rendering, routing, and more.</p>
<p>To take advantage of being able to save the search criteria in the URL, you need to override the existing routing options and use Next Router.</p>
<p>Below is an example of how to do achieve this.</p>
<p>To highlight, we&#8217;re using React memo to prevent the component from re-rendering the Search UI chrome when the URL changes.</p>
<div class="tabs" data-tab-group="guides-nextjs-integration">
  <div role="tablist" aria-label="guides-nextjs-integration">
    <button role="tab" aria-selected="true" aria-controls="guides-nextjs-integration-pagessearchjsx-panel" id="guides-nextjs-integration-pagessearchjsx-button">
      pages/search.jsx
    </button>
    <button role="tab" aria-selected="false" aria-controls="guides-nextjs-integration-utilsusenextroutingjs-panel" id="guides-nextjs-integration-utilsusenextroutingjs-button" tabindex="-1">
      utils/useNextRouting.js
    </button>
  </div>
  <div tabindex="0" role="tabpanel" id="guides-nextjs-integration-pagessearchjsx-panel" aria-labelledby="guides-nextjs-integration-pagessearchjsx-button">
<div class="pre_wrapper lang-jsx">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-jsx">import { memo } from 'react'
import { useNextRouting } from "../utils/useNextRouting";

export default function App() {
  // useNextRouting is a custom hook that will integrate with Next Router with Search UI config
  // config is search-ui configuration.
  // baseUrl is the path to the search page
  const combinedConfig = useNextRouting(config, "&lt;baseUrl&gt;");
  return &lt;Search config={combinedConfig} /&gt;;
}

const Search = memo(({ config }) =&gt; {
  return (
    &lt;SearchProvider config={config}&gt;
      &lt;&gt;
        &lt;ResultsPerPage /&gt;
        &lt;Results config={config} /&gt;
        &lt;Paging /&gt;
      &lt;/&gt;
    &lt;/SearchProvider&gt;
    )
})</pre>
</div>
  </div>
  <div tabindex="0" role="tabpanel" id="guides-nextjs-integration-utilsusenextroutingjs-panel" aria-labelledby="guides-nextjs-integration-utilsusenextroutingjs-button" hidden="">
<div class="pre_wrapper lang-jsx">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-jsx">import { useRouter } from "next/router";
import { useMemo } from "react";

export const useNextRouting = (config, basePathUrl) =&gt; {
  const router = useRouter();
  const { asPath } = router;

  const getSearchParamsFromUrl = (url) =&gt; {
    return url.match(/\?(.+)/)?.[1] || "";
  };

  const routingOptions = {
    // read and write only the query string to search UI
    // as we are leveraging existing stateToUrl and urlToState functions
    // which are based on the query string
    readUrl: () =&gt; {
      return getSearchParamsFromUrl(asPath);
    },
    writeUrl: (url, { replaceUrl }) =&gt; {
      const method = router[replaceUrl ? "replace" : "push"];
      const params = Object.fromEntries(new URLSearchParams(url).entries());
      method({ query: { ...router.query, ...params } }, undefined, {
        shallow: true
      });
    },
    routeChangeHandler: (callback) =&gt; {
      const handler = (fullUrl) =&gt; {
        if (fullUrl.includes(basePathUrl)) {
          callback(getSearchParamsFromUrl(fullUrl));
        }
      };
      router.events.on("routeChangeComplete", handler);
      return () =&gt; {
        router.events.off("routeChangeComplete", handler);
      };
    }
  };

  return useMemo(() =&gt; {
    return {
      ...config,
      routingOptions
    };
  }, [router.isReady]);
};</pre>
</div>
  </div>
</div>
<div class="position-relative"><h4><a id="guides-nextjs-integration-integration-with-elasticsearch-connector"></a>Integration with Elasticsearch Connector</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/search-ui/edit/main/docs/guides-nextjs-integration.asciidoc">edit</a></div>
<p>We do not advise exposing your Elasticsearch instance to the public. Fortunately with NextJS, we do not need to do this. NextJS makes it very simple to build an API route so we can move the connector to the server side.</p>
<p>To start, we create a connector that will send the <code class="literal">requestState</code> and <code class="literal">queryConfig</code> over to the client side.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">// located in &lt;root&gt;/services/APIConnector.js

class APIConnector {
  constructor() {}

  onResultClick() {
    // optional. Called when a result has been clicked
  }
  onAutocompleteResultClick() {
    // optional. Called when an autocomplete result has been clicked
  }

  async onSearch(requestState, queryConfig) {
    const response = await fetch("/api/search", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        requestState,
        queryConfig
      })
    });
    return response.json();
  }

  async onAutocomplete(requestState, queryConfig) {
    const response = await fetch("api/autocomplete", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        requestState,
        queryConfig
      })
    });
    return response.json();
  }
}

export default APIConnector;</pre>
</div>
<p>then add an <code class="literal">api</code> folder within <code class="literal">&lt;root&gt;/pages</code> folder. Add two files, <code class="literal">autocomplete.js</code> and <code class="literal">search.js</code></p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">// located in &lt;root&gt;/pages/api/search.js
import ElasticsearchAPIConnector from "@elastic/search-ui-elasticsearch-connector";

const connector = new ElasticsearchAPIConnector({
  host: "&lt;elasticsearch host&gt;",
  index: "&lt;elasticsearch index&gt;",
  apiKey: "&lt;api key&gt;" // optional
});

export default async function handler(req, res) {
  const { requestState, queryConfig } = req.body;
  const response = await connector.onSearch(requestState, queryConfig);
  res.json(response);
}</pre>
</div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">// located in &lt;root&gt;/pages/api/autocomplete.js
import ElasticsearchAPIConnector from "@elastic/search-ui-elasticsearch-connector";

const connector = new ElasticsearchAPIConnector({
  host: "&lt;elasticsearch host&gt;",
  index: "&lt;elasticsearch index&gt;",
  apiKey: "&lt;api key&gt;" // optional
});

export default async function handler(req, res) {
  const { requestState, queryConfig } = req.body;
  const response = await connector.onAutocomplete(requestState, queryConfig);
  res.json(response);
}</pre>
</div>
<p>then lastly swap the elasticsearch connector to use the APIConnector. With this change, when a user searches, the search will be sent to the server and the API routes will fetch the results from Elasticsearch and will be sent back to the client.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">import Connector from "../services/APIConnector";

const apiConnector = new Connector();

const searchConfig = {
  apiConnector: apiConnector
  // ...truncated search configuration
};</pre>
</div>
<p>and then restart your nextjs app. To confirm that this is working, you should see network requests within chrome developer tools performing requests with <code class="literal">requestState</code> and <code class="literal">queryConfig</code> to the <code class="literal">/api/search</code> &amp; <code class="literal">/api/autocomplete</code> API routes and results being returned back to the client.</p>
<p>Below is an example of this running within codesandbox.</p>
<iframe
  src="https://codesandbox.io/embed/cool-blackwell-69qutv?fontsize=14&hidenavigation=1&theme=dark"
  style="width:100%;height:800px;overflow:hidden;"
  title="nextjs-server-connector-example"
  allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
  sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
></iframe>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="guides-building-a-custom-connector.html">« Building a custom connector</a>
</span>
<span class="next">
<a href="api-architecture.html">Architecture »</a>
</span>
</div>
</body>
</html>
