<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MFA Deactivation with no Re-Activation for Okta User Account | Elastic Security Solution [8.11] | Elastic</title>
<meta class="elastic" name="content" content="MFA Deactivation with no Re-Activation for Okta User Account | Elastic Security Solution [8.11]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.11]"/>
<link rel="up" href="prebuilt-rule-8-11-6-prebuilt-rules-8-11-6-appendix.html" title="Appendix Y: Downloadable rule update v8.11.6"/>
<link rel="prev" href="prebuilt-rule-8-11-6-unusual-time-or-day-for-an-rdp-session.html" title="Unusual Time or Day for an RDP Session"/>
<link rel="next" href="prebuilt-rule-8-11-6-unusual-process-spawned-by-a-host.html" title="Unusual Process Spawned by a Host"/>
<meta class="elastic" name="product_version" content="8.11"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.11"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.11"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.11]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-11-6-prebuilt-rules-8-11-6-appendix.html">Downloadable rule update v8.11.6</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-11-6-unusual-time-or-day-for-an-rdp-session.html">« Unusual Time or Day for an RDP Session</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-11-6-unusual-process-spawned-by-a-host.html">Unusual Process Spawned by a Host »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="prebuilt-rule-8-11-6-mfa-deactivation-with-no-re-activation-for-okta-user-account"></a>MFA Deactivation with no Re-Activation for Okta User Account<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.11/docs/detections/prebuilt-rules/downloadable-packages/8-11-6/prebuilt-rule-8-11-6-mfa-deactivation-with-no-re-activation-for-okta-user-account.asciidoc">edit</a></h2>
</div></div></div>
<p>Detects multi-factor authentication (MFA) deactivation with no subsequent re-activation for an Okta user account. An adversary may deactivate MFA for an Okta user account in order to weaken the authentication requirements for the account.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-okta.system*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 6h</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-12h (<a href="/guide/en/elasticsearch/reference/8.11/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/system-log/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/system-log/</a>
</li>
<li class="listitem">
<a href="https://developer.okta.com/docs/reference/api/event-types/" class="ulink" target="_top">https://developer.okta.com/docs/reference/api/event-types/</a>
</li>
<li class="listitem">
<a href="/security-labs/testing-okta-visibility-and-detection-dorothy" class="ulink" target="_top">https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Tactic: Persistence
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Data Source: Okta
</li>
<li class="listitem">
Domain: Cloud
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 207</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_investigation_guide_3596"></a>Investigation guide<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.11/docs/detections/prebuilt-rules/downloadable-packages/8-11-6/prebuilt-rule-8-11-6-mfa-deactivation-with-no-re-activation-for-okta-user-account.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-markdown">
<pre class="programlisting prettyprint lang-markdown">## Triage and analysis

### Investigating MFA Deactivation with no Re-Activation for Okta User Account

MFA is used to provide an additional layer of security for user accounts. An adversary may achieve MFA deactivation for an Okta user account to achieve persistence.

This rule fires when an Okta user account has MFA deactivated and no subsequent MFA reactivation is observed within 12 hours.

#### Possible investigation steps:

- Identify the actor related to the alert by reviewing `okta.actor.alternate_id` field in the alert. This should give the username of the account being targeted.
- Review `okta.target` or `user.target.full_name` fields to determine if deactivation was performed by a se parate user.
- Using the `okta.actor.alternate_id` field, search  for MFA re-activation events where `okta.event_type` is `user.mfa.factor.activate`.
- Review events where `okta.event_type` is `user.authenticate*` to determine if the user account had suspicious login activity.
    - Geolocation details found in `client.geo*` related fields may be useful in determining if the login activity was suspicious for this user.

#### False positive steps:

- Determine with the target user if MFA deactivation was expected.
- Determine if MFA is required for the target user account.

#### Response and remediation:

- If the MFA deactivation was not expected, consider deactivating the user
    - This should be followed by resetting the user's password and re-enabling MFA.
- If the MFA deactivation was expected, consider adding an exception to this rule to filter false positives.
- Investigate the source of the attack. If a specific machine or network is compromised, additional steps may need to be taken to address the issue.
- Encourage users to use complex, unique passwords and consider implementing multi-factor authentication.
- Check if the compromised account was used to access or alter any sensitive data, applications or systems.</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_rule_query_5402"></a>Rule query<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.11/docs/detections/prebuilt-rules/downloadable-packages/8-11-6/prebuilt-rule-8-11-6-mfa-deactivation-with-no-re-activation-for-okta-user-account.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">sequence by okta.actor.id with maxspan=12h
    [any where event.dataset == "okta.system" and okta.event_type == "user.mfa.factor.deactivate"
        and okta.outcome.result == "SUCCESS" and not okta.client.user_agent.raw_user_agent like "SFDC-Callout*"]
    ![any where event.dataset == "okta.system" and okta.event_type == "user.mfa.factor.activate"]</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Modify Authentication Process
</li>
<li class="listitem">
ID: T1556
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1556/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1556/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Multi-Factor Authentication
</li>
<li class="listitem">
ID: T1556.006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1556/006/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1556/006/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-11-6-unusual-time-or-day-for-an-rdp-session.html">« Unusual Time or Day for an RDP Session</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-11-6-unusual-process-spawned-by-a-host.html">Unusual Process Spawned by a Host »</a>
</span>
</div>
</div>
</body>
</html>
