<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS SSM Command Document Created by Rare User | Elastic Security [8.13] | Elastic</title>
<meta class="elastic" name="content" content="AWS SSM Command Document Created by Rare User | Elastic Security [8.13]">

<link rel="home" href="index.html" title="Elastic Security [8.13]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="aws-sns-email-subscription-by-rare-user.html" title="AWS SNS Email Subscription by Rare User"/>
<link rel="next" href="aws-ssm-sendcommand-execution-by-rare-user.html" title="AWS SSM SendCommand Execution by Rare User"/>
<meta class="elastic" name="product_version" content="8.13"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.13"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.13"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="aws-sns-email-subscription-by-rare-user.html">« AWS SNS Email Subscription by Rare User</a>
</span>
<span class="next">
<a href="aws-ssm-sendcommand-execution-by-rare-user.html">AWS SSM <code class="literal">SendCommand</code> Execution by Rare User »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security [8.13]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS SSM Command Document Created by Rare User</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.13/docs/detections/prebuilt-rules/rule-details/aws-ssm-command-document-created-by-rare-user.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/security/prebuilt-rules/rules/integrations/aws/execution_ssm_command_document_created_by_rare_user">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="aws-ssm-command-document-created-by-rare-user"></a>AWS SSM Command Document Created by Rare User</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.13/docs/detections/prebuilt-rules/rule-details/aws-ssm-command-document-created-by-rare-user.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies when an AWS Systems Manager (SSM) command document is created by a user who does not typically perform this action. Adversaries may create SSM command documents to execute commands on managed instances, potentially leading to unauthorized access, command and control, data exfiltration and more.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.13/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_CreateDocument.html" class="ulink" target="_top">https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_CreateDocument.html</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/documents.html" class="ulink" target="_top">https://docs.aws.amazon.com/systems-manager/latest/userguide/documents.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS SNS
</li>
<li class="listitem">
Data Source: AWS Systems Manager
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Execution
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_80"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.13/docs/detections/prebuilt-rules/rule-details/aws-ssm-command-document-created-by-rare-user.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and Analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating AWS SSM Command Document Created by Rare User</strong></span></p>
<p>This rule identifies when an AWS Systems Manager (SSM) command document is created by a user who does not typically perform this action. Creating SSM command documents can be a legitimate action but may also indicate malicious intent if done by an unusual or compromised user. Adversaries may leverage SSM documents to execute commands on managed instances, potentially leading to unauthorized access, command and control, or data exfiltration.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the Actor</strong></span>: Review the <code class="literal">aws.cloudtrail.user_identity.arn</code> field to identify who created the SSM document. Verify if this user typically creates such documents and has the appropriate permissions. It may be unexpected for certain types of users, like assumed roles or federated users, to perform this action.
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze the Document Details</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Document Name</strong></span>: Check the <code class="literal">aws.cloudtrail.request_parameters.name</code> field for the document name to understand its intended purpose.
</li>
<li class="listitem">
<span class="strong strong"><strong>Document Content</strong></span>: If possible, review <code class="literal">aws.cloudtrail.request_parameters.content</code> for any sensitive or unexpected instructions (e.g., actions for data exfiltration or privilege escalation). If not available via logs, consider reviewing the document in the AWS Management Console.
</li>
<li class="listitem">
<span class="strong strong"><strong>Contextualize the Activity with Related Events</strong></span>: Look for other CloudTrail events involving the same user ARN or IP address (<code class="literal">source.address</code>). Examine actions performed in other AWS services, such as IAM, EC2, or S3, to identify if additional suspicious behavior exists. The <code class="literal">SendCommand</code> API call may indicate attempts to execute the SSM document on managed instances.
</li>
<li class="listitem">
<span class="strong strong"><strong>Check Document Status and Metadata</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Document Status</strong></span>: Confirm the document creation status in <code class="literal">aws.cloudtrail.response_elements.documentDescription.status</code>. A status of <code class="literal">Creating</code> may indicate that the document is in progress.
</li>
<li class="listitem">
<span class="strong strong"><strong>Execution Permissions</strong></span>: Review if the document specifies <code class="literal">platformTypes</code> and <code class="literal">documentVersion</code> in <code class="literal">aws.cloudtrail.response_elements.documentDescription</code> to understand which environments may be impacted and if multiple versions exist.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Authorized Administrative Actions</strong></span>: Determine if this document creation aligns with scheduled administrative tasks or actions by authorized personnel.
</li>
<li class="listitem">
<span class="strong strong"><strong>Historical User Actions</strong></span>: Compare this action against historical activities for the user to determine if they have a history of creating similar documents, which may indicate legitimate usage.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Immediate Document Review and Deletion</strong></span>: If the document creation is deemed unauthorized, delete the document immediately and check for other similar documents created recently.
</li>
<li class="listitem">
<span class="strong strong"><strong>Enhance Monitoring and Alerts</strong></span>: Configure additional monitoring for SSM document creation events, especially when associated with untrusted or rare users.
</li>
<li class="listitem">
<span class="strong strong"><strong>Policy Update</strong></span>: Consider restricting SSM document creation permissions to specific, trusted roles or users to prevent unauthorized document creation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Incident Response</strong></span>: If the document is confirmed as part of malicious activity, treat this as a security incident. Follow incident response protocols, including containment, investigation, and remediation.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Information</strong></span></p>
<p>For further guidance on managing and securing AWS Systems Manager in your environment, refer to the <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/what-is-systems-manager.html" class="ulink" target="_top">AWS SSM documentation</a> and AWS security best practices.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_92"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.13/docs/detections/prebuilt-rules/rule-details/aws-ssm-command-document-created-by-rare-user.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "aws.cloudtrail"
    and event.provider: "ssm.amazonaws.com"
    and event.action: "CreateDocument"
    and event.outcome: "success"
    and aws.cloudtrail.response_elements: *documentType=Command*</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-sns-email-subscription-by-rare-user.html">« AWS SNS Email Subscription by Rare User</a>
</span>
<span class="next">
<a href="aws-ssm-sendcommand-execution-by-rare-user.html">AWS SSM <code class="literal">SendCommand</code> Execution by Rare User »</a>
</span>
</div>
</body>
</html>
