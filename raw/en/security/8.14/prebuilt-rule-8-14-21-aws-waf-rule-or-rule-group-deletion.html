<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS WAF Rule or Rule Group Deletion | Elastic Security Solution [8.14] | Elastic</title>
<meta class="elastic" name="content" content="AWS WAF Rule or Rule Group Deletion | Elastic Security Solution [8.14]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.14]"/>
<link rel="up" href="prebuilt-rule-8-14-21-prebuilt-rules-8-14-21-appendix.html" title="Appendix h: Downloadable rule update v8.14.21"/>
<link rel="prev" href="prebuilt-rule-8-14-21-aws-waf-access-control-list-deletion.html" title="AWS WAF Access Control List Deletion"/>
<link rel="next" href="prebuilt-rule-8-14-21-aws-ec2-deprecated-ami-discovery.html" title="AWS EC2 Deprecated AMI Discovery"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.14"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-14-21-aws-waf-access-control-list-deletion.html">« AWS WAF Access Control List Deletion</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-14-21-aws-ec2-deprecated-ami-discovery.html">AWS EC2 Deprecated AMI Discovery »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-14-21-prebuilt-rules-8-14-21-appendix.html">Downloadable rule update v8.14.21</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS WAF Rule or Rule Group Deletion</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-aws-waf-rule-or-rule-group-deletion.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-14-21-aws-waf-rule-or-rule-group-deletion"></a>AWS WAF Rule or Rule Group Deletion</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-aws-waf-rule-or-rule-group-deletion.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies the deletion of a specified AWS Web Application Firewall (WAF) rule or rule group.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-60m (<a href="/guide/en/elasticsearch/reference/8.14/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/waf/delete-rule-group.html" class="ulink" target="_top">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/waf/delete-rule-group.html</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/waf/latest/APIReference/API_waf_DeleteRuleGroup.html" class="ulink" target="_top">https://docs.aws.amazon.com/waf/latest/APIReference/API_waf_DeleteRuleGroup.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Use Case: Network Security Monitoring
</li>
<li class="listitem">
Tactic: Defense Evasion
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 207</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_4674"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-aws-waf-rule-or-rule-group-deletion.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating AWS WAF Rule or Rule Group Deletion</strong></span></p>
<p>AWS Web Application Firewall (WAF) protects web applications by filtering and monitoring HTTP requests. Adversaries may delete WAF rules or groups to disable security measures, facilitating attacks like SQL injection or cross-site scripting. The detection rule monitors AWS CloudTrail logs for successful deletion actions, signaling potential defense evasion attempts by identifying unauthorized or suspicious deletions.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the AWS CloudTrail logs to identify the user or role associated with the deletion action by examining the userIdentity field.
</li>
<li class="listitem">
Check the event.time field in the CloudTrail logs to determine when the deletion occurred and correlate it with any other suspicious activities around the same time.
</li>
<li class="listitem">
Investigate the source IP address and user agent from the CloudTrail logs to assess if the request originated from a known or expected location and device.
</li>
<li class="listitem">
Verify if the deleted WAF rule or rule group was part of a critical security configuration by reviewing the AWS WAF setup and any associated documentation.
</li>
<li class="listitem">
Contact the user or team responsible for AWS WAF management to confirm if the deletion was authorized and understand the rationale behind it.
</li>
<li class="listitem">
Examine any recent changes in IAM policies or permissions that might have allowed unauthorized users to perform the deletion action.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Routine maintenance or updates by authorized personnel can trigger rule deletions. Verify if the deletion aligns with scheduled maintenance activities and consider excluding these events from alerts.
</li>
<li class="listitem">
Automated scripts or tools used for infrastructure management might delete and recreate WAF rules as part of their normal operation. Identify these scripts and whitelist their actions to prevent unnecessary alerts.
</li>
<li class="listitem">
Changes in security policies or architecture might necessitate the removal of certain WAF rules. Ensure that such changes are documented and approved, and exclude these documented actions from triggering alerts.
</li>
<li class="listitem">
Temporary rule deletions for testing purposes by security teams can be mistaken for malicious activity. Coordinate with the security team to log these activities and exclude them from detection rules.
</li>
<li class="listitem">
Ensure that IAM roles or users with permissions to delete WAF rules are reviewed regularly. Exclude actions performed by trusted roles or users after confirming their legitimacy.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately review AWS CloudTrail logs to confirm the unauthorized deletion of WAF rules or rule groups and identify the source of the action, including the IAM user or role involved.
</li>
<li class="listitem">
Reapply the deleted WAF rules or rule groups to restore the intended security posture and prevent potential attacks such as SQL injection or cross-site scripting.
</li>
<li class="listitem">
Temporarily restrict or revoke permissions for the identified IAM user or role to prevent further unauthorized actions until a thorough investigation is completed.
</li>
<li class="listitem">
Conduct a security review of the affected AWS environment to identify any other potential security gaps or unauthorized changes that may have occurred.
</li>
<li class="listitem">
Notify the security operations team and relevant stakeholders about the incident for awareness and further investigation.
</li>
<li class="listitem">
Implement additional monitoring and alerting for AWS WAF configuration changes to detect and respond to similar unauthorized actions promptly in the future.
</li>
<li class="listitem">
Consider enabling AWS Config rules to continuously monitor and enforce compliance with WAF configurations, ensuring any unauthorized changes are automatically flagged.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_1647"></a>Setup</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-aws-waf-rule-or-rule-group-deletion.asciidoc">edit</a></div>
</div></div></div>
<p>The AWS Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_6301"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-aws-waf-rule-or-rule-group-deletion.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset:aws.cloudtrail and event.provider:(waf.amazonaws.com or waf-regional.amazonaws.com or wafv2.amazonaws.com) and event.action:(DeleteRule or DeleteRuleGroup) and event.outcome:success</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Disable or Modify Tools
</li>
<li class="listitem">
ID: T1562.001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/001/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/001/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-14-21-aws-waf-access-control-list-deletion.html">« AWS WAF Access Control List Deletion</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-14-21-aws-ec2-deprecated-ami-discovery.html">AWS EC2 Deprecated AMI Discovery »</a>
</span>
</div>
</body>
</html>
