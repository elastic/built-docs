<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kubernetes Privileged Pod Created | Elastic Security Solution [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Kubernetes Privileged Pod Created | Elastic Security Solution [8.14]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.14]"/>
<link rel="up" href="prebuilt-rule-8-14-21-prebuilt-rules-8-14-21-appendix.html" title="Appendix h: Downloadable rule update v8.14.21"/>
<link rel="prev" href="prebuilt-rule-8-14-21-kubernetes-pod-created-with-a-sensitive-hostpath-volume.html" title="Kubernetes Pod created with a Sensitive hostPath Volume"/>
<link rel="next" href="prebuilt-rule-8-14-21-kubernetes-suspicious-assignment-of-controller-service-account.html" title="Kubernetes Suspicious Assignment of Controller Service Account"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.14"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.14"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-14-21-kubernetes-pod-created-with-a-sensitive-hostpath-volume.html">« Kubernetes Pod created with a Sensitive hostPath Volume</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-14-21-kubernetes-suspicious-assignment-of-controller-service-account.html">Kubernetes Suspicious Assignment of Controller Service Account »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-14-21-prebuilt-rules-8-14-21-appendix.html">Downloadable rule update v8.14.21</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Kubernetes Privileged Pod Created</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-kubernetes-privileged-pod-created.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-14-21-kubernetes-privileged-pod-created"></a>Kubernetes Privileged Pod Created</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-kubernetes-privileged-pod-created.asciidoc">edit</a></div>
</div></div></div>
<p>This rule detects when a user creates a pod/container running in privileged mode. A highly privileged container has access to the node&#8217;s resources and breaks the isolation between containers. If compromised, an attacker can use the privileged container to gain access to the underlying host. Gaining access to the host may provide the adversary with the opportunity to achieve follow-on objectives, such as establishing persistence, moving laterally within the environment, or setting up a command and control channel on the host.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
logs-kubernetes.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: None (<a href="/guide/en/elasticsearch/reference/8.14/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://media.defense.gov/2021/Aug/03/2002820425/-1/-1/1/CTR_KUBERNETES%20HARDENING%20GUIDANCE.PDF" class="ulink" target="_top">https://media.defense.gov/2021/Aug/03/2002820425/-1/-1/1/CTR_KUBERNETES%20HARDENING%20GUIDANCE.PDF</a>
</li>
<li class="listitem">
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" class="ulink" target="_top">https://kubernetes.io/docs/tasks/configure-pod-container/security-context/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Data Source: Kubernetes
</li>
<li class="listitem">
Tactic: Execution
</li>
<li class="listitem">
Tactic: Privilege Escalation
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 205</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_4876"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-kubernetes-privileged-pod-created.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating Kubernetes Privileged Pod Created</strong></span></p>
<p>Kubernetes allows for the creation of privileged pods, which can access the host&#8217;s resources, breaking container isolation. Adversaries may exploit this to escalate privileges, access sensitive data, or establish persistence. The detection rule identifies such events by monitoring audit logs for pod creation with privileged settings, excluding known safe images, to flag potential security threats.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the Kubernetes audit logs to identify the user or service account responsible for creating the privileged pod by examining the <code class="literal">kubernetes.audit.annotations.authorization_k8s_io/decision</code> and <code class="literal">kubernetes.audit.verb:create</code> fields.
</li>
<li class="listitem">
Investigate the context of the privileged pod creation by checking the <code class="literal">kubernetes.audit.requestObject.spec.containers.image</code> field to determine if the image used is known or potentially malicious.
</li>
<li class="listitem">
Assess the necessity and legitimacy of the privileged pod by consulting with the relevant development or operations teams to understand if there was a valid reason for its creation.
</li>
<li class="listitem">
Examine the <code class="literal">kubernetes.audit.objectRef.resource:pods</code> field to identify the specific pod and its associated namespace, and verify if it aligns with expected deployment patterns or environments.
</li>
<li class="listitem">
Check for any subsequent suspicious activities or anomalies in the Kubernetes environment that may indicate further exploitation attempts, such as lateral movement or data exfiltration, following the creation of the privileged pod.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Known safe images like "docker.elastic.co/beats/elastic-agent:8.4.0" are already excluded from triggering alerts. Ensure that any additional internal or third-party images that are verified as safe are added to the exclusion list to prevent unnecessary alerts.
</li>
<li class="listitem">
Development and testing environments often use privileged pods for legitimate purposes. Consider creating separate rules or exceptions for these environments to avoid false positives while maintaining security in production.
</li>
<li class="listitem">
Automated deployment tools or scripts might create privileged pods as part of their normal operation. Review these tools and, if they are deemed safe, add their specific actions or images to the exclusion list.
</li>
<li class="listitem">
Regularly review and update the exclusion list to reflect changes in your environment, such as new safe images or changes in deployment practices, to maintain an accurate detection rule.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately isolate the affected node to prevent further exploitation and lateral movement within the cluster. This can be done by cordoning and draining the node to stop new pods from being scheduled and to safely evict existing pods.
</li>
<li class="listitem">
Terminate the privileged pod to stop any ongoing malicious activity. Ensure that the termination is logged for further analysis.
</li>
<li class="listitem">
Conduct a thorough review of the audit logs to identify any unauthorized access or actions taken by the privileged pod. Focus on any attempts to access sensitive data or escalate privileges.
</li>
<li class="listitem">
Reset credentials and access tokens that may have been exposed or compromised due to the privileged pod&#8217;s access to the host&#8217;s resources.
</li>
<li class="listitem">
Patch and update the Kubernetes environment and any affected nodes to address vulnerabilities that may have been exploited to create the privileged pod.
</li>
<li class="listitem">
Implement network segmentation and firewall rules to limit the communication capabilities of pods, especially those with elevated privileges, to reduce the risk of lateral movement.
</li>
<li class="listitem">
Escalate the incident to the security operations team for a comprehensive investigation and to assess the need for further security measures or incident response actions.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_1805"></a>Setup</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-kubernetes-privileged-pod-created.asciidoc">edit</a></div>
</div></div></div>
<p>The Kubernetes Fleet integration with Audit Logs enabled or similarly structured data is required to be compatible with this rule.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_6518"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/downloadable-packages/8-14-21/prebuilt-rule-8-14-21-kubernetes-privileged-pod-created.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset : "kubernetes.audit_logs"
  and kubernetes.audit.annotations.authorization_k8s_io/decision:"allow"
  and kubernetes.audit.objectRef.resource:pods
  and kubernetes.audit.verb:create
  and kubernetes.audit.requestObject.spec.containers.securityContext.privileged:true
  and not kubernetes.audit.requestObject.spec.containers.image: ("docker.elastic.co/beats/elastic-agent:8.4.0")</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Escape to Host
</li>
<li class="listitem">
ID: T1611
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1611/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1611/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Deploy Container
</li>
<li class="listitem">
ID: T1610
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1610/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1610/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-14-21-kubernetes-pod-created-with-a-sensitive-hostpath-volume.html">« Kubernetes Pod created with a Sensitive hostPath Volume</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-14-21-kubernetes-suspicious-assignment-of-controller-service-account.html">Kubernetes Suspicious Assignment of Controller Service Account »</a>
</span>
</div>
</body>
</html>
