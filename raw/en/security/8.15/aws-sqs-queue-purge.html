<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS SQS Queue Purge | Elastic Security Solution [8.15] | Elastic</title>
<meta class="elastic" name="content" content="AWS SQS Queue Purge | Elastic Security Solution [8.15]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.15]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="aws-sns-email-subscription-by-rare-user.html" title="AWS SNS Email Subscription by Rare User"/>
<link rel="next" href="aws-ssm-command-document-created-by-rare-user.html" title="AWS SSM Command Document Created by Rare User"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.15"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="aws-sns-email-subscription-by-rare-user.html">« AWS SNS Email Subscription by Rare User</a>
</span>
<span class="next">
<a href="aws-ssm-command-document-created-by-rare-user.html">AWS SSM Command Document Created by Rare User »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS SQS Queue Purge</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/rule-details/aws-sqs-queue-purge.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="aws-sqs-queue-purge"></a>AWS SQS Queue Purge</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/rule-details/aws-sqs-queue-purge.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies when an AWS Simple Queue Service (SQS) queue is purged. Adversaries may purge SQS queues to disrupt operations, delete messages, or impair monitoring and alerting mechanisms. This action can be used to evade detection and cover tracks by removing evidence of malicious activities.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.15/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_PurgeQueue.html" class="ulink" target="_top">https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_PurgeQueue.html</a>
</li>
<li class="listitem">
<a href="https://hackingthe.cloud/aws/exploitation/Misconfigured_Resource-Based_Policies/exploting_public_resources_attack_playbook/" class="ulink" target="_top">https://hackingthe.cloud/aws/exploitation/Misconfigured_Resource-Based_Policies/exploting_public_resources_attack_playbook/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS SQS
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Use Case: Log Auditing
</li>
<li class="listitem">
Tactic: Defense Evasion
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_84"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/rule-details/aws-sqs-queue-purge.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and Analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating AWS SQS Queue Purge</strong></span></p>
<p>This rule detects when an AWS SQS queue is purged, an action that adversaries may use to disrupt operations, delete messages, or impair monitoring and alerting mechanisms. Purging an SQS queue removes all messages, which could be used as a tactic to evade detection by deleting evidence of malicious activity or to disrupt legitimate workflows.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the Actor and Resource</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>User Identity and Permissions</strong></span>: Review the field <code class="literal">aws.cloudtrail.user_identity.arn</code> to identify the IAM user or role responsible for the purge. Validate their permissions and determine if this action aligns with their typical responsibilities.
</li>
<li class="listitem">
<span class="strong strong"><strong>SQS Queue Details</strong></span>: Examine <code class="literal">aws.cloudtrail.resources.arn</code> and <code class="literal">aws.cloudtrail.flattened.request_parameters.queueUrl</code> to identify the specific SQS queue that was purged. Check its purpose, associated workflows, and whether it handles sensitive or critical messages.
</li>
<li class="listitem">
<span class="strong strong"><strong>Evaluate the Context and Purpose of the Purge</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Time and Frequency</strong></span>: Check the timestamp (<code class="literal">@timestamp</code>) to determine when the purge occurred and whether similar events have occurred recently. Frequent or repeated purges may indicate a larger issue or ongoing malicious activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Legitimacy of the Action</strong></span>: Consult with the owner or administrator of the affected queue to verify if the purge was intentional or authorized.
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze for Potential Indicators of Malicious Activity</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Source IP and Geographic Location</strong></span>: Review <code class="literal">source.ip</code> and <code class="literal">source.geo</code> to identify the origin of the request. Anomalies, such as unexpected locations, may indicate compromise.
</li>
<li class="listitem">
<span class="strong strong"><strong>User Agent and Tooling</strong></span>: Check <code class="literal">user_agent.original</code> to confirm the tool used to perform the purge. The use of unexpected or automated tooling may raise suspicion.
</li>
<li class="listitem">
<span class="strong strong"><strong>Cross-Reference Related Activity</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Recent IAM Events</strong></span>: Search for related IAM or security-related events tied to the same actor, such as <code class="literal">CreateAccessKey</code>, <code class="literal">AssumeRole</code>, or <code class="literal">UpdateRolePolicy</code>, which could indicate privilege escalation or preparation for malicious actions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Other SQS Activity</strong></span>: Look for additional activity involving the same SQS queue, such as <code class="literal">SendMessage</code>, <code class="literal">ReceiveMessage</code>, or <code class="literal">DeleteQueue</code>, to identify further signs of unauthorized usage.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Legitimate Administrative Activity</strong></span>: Administrators may purge SQS queues as part of maintenance or cleanup processes. Validate whether the action was part of an approved operation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Automation or Testing</strong></span>: Automation tools or testing processes may perform queue purges as part of their workflow. Verify if the action aligns with known automated tasks or test scenarios.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Immediate Actions</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Restrict Access</strong></span>: If the action appears unauthorized, immediately revoke access for the actor responsible for the purge and investigate potential credential compromise.
</li>
<li class="listitem">
<span class="strong strong"><strong>Restore Data</strong></span>: If the purged queue contained critical or sensitive messages, attempt to restore them from backups if available.
</li>
<li class="listitem">
<span class="strong strong"><strong>Preventative Measures</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Enhance Monitoring</strong></span>: Enable additional monitoring for SQS-related activity to detect unusual patterns, such as frequent purges or changes to queue configurations.
</li>
<li class="listitem">
<span class="strong strong"><strong>Audit Permissions</strong></span>: Review and restrict IAM permissions for SQS to ensure only authorized users or roles can perform sensitive actions like <code class="literal">PurgeQueue</code>.
</li>
<li class="listitem">
<span class="strong strong"><strong>Policy Updates</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Apply Least Privilege</strong></span>: Adjust IAM policies to enforce the principle of least privilege, ensuring that only necessary permissions are granted. Review the policy assigned to the SQS queue as well to prevent unauthorized purges.
</li>
<li class="listitem">
<span class="strong strong"><strong>MFA Enforcement</strong></span>: Require Multi-Factor Authentication (MFA) for all users with access to sensitive AWS resources.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Information</strong></span></p>
<p>For further guidance on AWS SQS operations and best practices, refer to:
- <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_PurgeQueue.html" class="ulink" target="_top">AWS SQS PurgeQueue API Documentation</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_96"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/rule-details/aws-sqs-queue-purge.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset:"aws.cloudtrail"
    and event.provider:"sqs.amazonaws.com"
    and event.action:"PurgeQueue"
    and event.outcome:"success"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Disable or Modify Cloud Logs
</li>
<li class="listitem">
ID: T1562.008
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/008/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/008/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-sns-email-subscription-by-rare-user.html">« AWS SNS Email Subscription by Rare User</a>
</span>
<span class="next">
<a href="aws-ssm-command-document-created-by-rare-user.html">AWS SSM Command Document Created by Rare User »</a>
</span>
</div>
</body>
</html>
