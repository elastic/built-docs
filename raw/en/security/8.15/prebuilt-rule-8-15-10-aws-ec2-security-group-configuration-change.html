<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS EC2 Security Group Configuration Change | Elastic Security Solution [8.15] | Elastic</title>
<meta class="elastic" name="content" content="AWS EC2 Security Group Configuration Change | Elastic Security Solution [8.15]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.15]"/>
<link rel="up" href="prebuilt-rule-8-15-10-prebuilt-rules-8-15-10-appendix.html" title="Appendix ]: Downloadable rule update v8.15.10"/>
<link rel="prev" href="prebuilt-rule-8-15-10-aws-iam-deactivation-of-mfa-device.html" title="AWS IAM Deactivation of MFA Device"/>
<link rel="next" href="prebuilt-rule-8-15-10-aws-iam-user-created-access-keys-for-another-user.html" title="AWS IAM User Created Access Keys For Another User"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.15"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-15-10-aws-iam-deactivation-of-mfa-device.html">« AWS IAM Deactivation of MFA Device</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-15-10-aws-iam-user-created-access-keys-for-another-user.html">AWS IAM User Created Access Keys For Another User »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-15-10-prebuilt-rules-8-15-10-appendix.html">Downloadable rule update v8.15.10</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS EC2 Security Group Configuration Change</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-10/prebuilt-rule-8-15-10-aws-ec2-security-group-configuration-change.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-15-10-aws-ec2-security-group-configuration-change"></a>AWS EC2 Security Group Configuration Change</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-10/prebuilt-rule-8-15-10-aws-ec2-security-group-configuration-change.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies a change to an AWS Security Group Configuration. A security group is like a virtual firewall, and modifying configurations may allow unauthorized access. Threat actors may abuse this to establish persistence, exfiltrate data, or pivot in an AWS environment.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.15/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2-security-groups.html" class="ulink" target="_top">https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2-security-groups.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS EC2
</li>
<li class="listitem">
Use Case: Network Security Monitoring
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
<li class="listitem">
Tactic: Persistence
</li>
<li class="listitem">
Tactic: Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 207</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Austin Songer
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_3702"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-10/prebuilt-rule-8-15-10-aws-ec2-security-group-configuration-change.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Investigating AWS EC2 Security Group Configuration Change</strong></span></p>
<p>This rule identifies any changes to an AWS Security Group, which functions as a virtual firewall controlling inbound and outbound traffic for resources like EC2 instances. Modifications to a security group configuration could expose critical assets to unauthorized access. Threat actors may exploit such changes to establish persistence, exfiltrate data, or pivot within an AWS environment.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Identify the Modified Security Group</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Security Group ID</strong></span>: Check the <code class="literal">aws.cloudtrail.flattened.request_parameters.groupId</code> field to identify the specific security group affected.
</li>
<li class="listitem">
<span class="strong strong"><strong>Rule Changes</strong></span>: Review <code class="literal">aws.cloudtrail.flattened.response_elements.securityGroupRuleSet</code> to determine the new rules or configurations, including any added or removed IP ranges, protocol changes, and port specifications.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Review User Context</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>User Identity</strong></span>: Inspect the <code class="literal">aws.cloudtrail.user_identity.arn</code> field to determine which user or role made the modification. Verify if this is an authorized administrator or a potentially compromised account.
</li>
<li class="listitem">
<span class="strong strong"><strong>Access Patterns</strong></span>: Analyze whether this user regularly interacts with security group configurations or if this event is out of the ordinary for their account.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Analyze the Configuration Change</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Egress vs. Ingress</strong></span>: Determine if the change affected inbound (ingress) or outbound (egress) traffic by reviewing fields like <code class="literal">isEgress</code> in the <code class="literal">securityGroupRuleSet</code>. Unauthorized changes to outbound traffic can indicate data exfiltration attempts.
</li>
<li class="listitem">
<span class="strong strong"><strong>IP Ranges and Ports</strong></span>: Assess any added IP ranges, especially <code class="literal">0.0.0.0/0</code>, which exposes resources to the internet. Port changes should also be evaluated to ensure only necessary ports are open.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Check User Agent and Source IP</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>User Agent Analysis</strong></span>: Examine the <code class="literal">user_agent.original</code> field to identify the tool or application used, such as <code class="literal">AWS Console</code> or <code class="literal">Terraform</code>, which may reveal if the action was automated or manual.
</li>
<li class="listitem">
<span class="strong strong"><strong>Source IP and Geolocation</strong></span>: Use <code class="literal">source.address</code> and <code class="literal">source.geo</code> fields to verify if the IP address and geolocation match expected locations for your organization. Unexpected IPs or regions may indicate unauthorized access.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Evaluate for Persistence Indicators</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Repeated Changes</strong></span>: Investigate if similar changes were recently made across multiple security groups, which may suggest an attempt to maintain or expand access.
</li>
<li class="listitem">
<span class="strong strong"><strong>Permissions Review</strong></span>: Confirm that the user’s IAM policies are configured to limit changes to security groups only as necessary.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Correlate with Other CloudTrail Events</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Cross-Reference Other Security Events</strong></span>: Look for related actions like <code class="literal">AuthorizeSecurityGroupIngress</code>, <code class="literal">CreateSecurityGroup</code>, or <code class="literal">RevokeSecurityGroupIngress</code> that may indicate additional or preparatory steps for unauthorized access.
</li>
<li class="listitem">
<span class="strong strong"><strong>Monitor for IAM or Network Changes</strong></span>: Check for IAM modifications, network interface changes, or other configuration updates in the same timeframe to detect broader malicious activities.
</li>
</ul>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Routine Security Changes</strong></span>: Security group modifications may be part of regular infrastructure maintenance. Verify if this action aligns with known, scheduled administrative activities.
</li>
<li class="listitem">
<span class="strong strong"><strong>Automated Configuration Management</strong></span>: If you are using automated tools like <code class="literal">Terraform</code> or <code class="literal">CloudFormation</code>, confirm if the change matches expected configuration drift corrections or deployments.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Revert Unauthorized Changes</strong></span>: If unauthorized, revert the security group configuration to its previous state to secure the environment.
</li>
<li class="listitem">
<span class="strong strong"><strong>Restrict Security Group Permissions</strong></span>: Remove permissions to modify security groups from any compromised or unnecessary accounts to limit future access.
</li>
<li class="listitem">
<span class="strong strong"><strong>Quarantine Affected Resources</strong></span>: If necessary, isolate any affected instances or resources to prevent further unauthorized activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Audit IAM and Security Group Policies</strong></span>: Regularly review permissions related to security groups to ensure least privilege access and prevent excessive access.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Information</strong></span></p>
<p>For more details on managing AWS Security Groups and best practices, refer to the <a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2-security-groups.html" class="ulink" target="_top">AWS EC2 Security Groups Documentation</a> and AWS security best practices.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_5631"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-10/prebuilt-rule-8-15-10-aws-ec2-security-group-configuration-change.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "aws.cloudtrail"
    and event.provider: "ec2.amazonaws.com"
    and event.action:(
            "AuthorizeSecurityGroupEgress" or
            "CreateSecurityGroup" or
            "ModifyInstanceAttribute" or
            "ModifySecurityGroupRules" or
            "RevokeSecurityGroupEgress" or
            "RevokeSecurityGroupIngress")
    and event.outcome: "success"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Disable or Modify Cloud Firewall
</li>
<li class="listitem">
ID: T1562.007
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/007/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/007/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-15-10-aws-iam-deactivation-of-mfa-device.html">« AWS IAM Deactivation of MFA Device</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-15-10-aws-iam-user-created-access-keys-for-another-user.html">AWS IAM User Created Access Keys For Another User »</a>
</span>
</div>
</body>
</html>
