<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SMTP on Port 26/TCP | Elastic Security Solution [8.15] | Elastic</title>
<meta class="elastic" name="content" content="SMTP on Port 26/TCP | Elastic Security Solution [8.15]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.15]"/>
<link rel="up" href="prebuilt-rule-8-15-15-prebuilt-rules-8-15-15-appendix.html" title="Appendix b: Downloadable rule update v8.15.15"/>
<link rel="prev" href="prebuilt-rule-8-15-15-ipsec-nat-traversal-port-activity.html" title="IPSEC NAT Traversal Port Activity"/>
<link rel="next" href="prebuilt-rule-8-15-15-rdp-remote-desktop-protocol-from-the-internet.html" title="RDP (Remote Desktop Protocol) from the Internet"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.15"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-15-15-ipsec-nat-traversal-port-activity.html">« IPSEC NAT Traversal Port Activity</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-15-15-rdp-remote-desktop-protocol-from-the-internet.html">RDP (Remote Desktop Protocol) from the Internet »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-15-15-prebuilt-rules-8-15-15-appendix.html">Downloadable rule update v8.15.15</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>SMTP on Port 26/TCP</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-15/prebuilt-rule-8-15-15-smtp-on-port-26-tcp.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-15-15-smtp-on-port-26-tcp"></a>SMTP on Port 26/TCP</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-15/prebuilt-rule-8-15-15-smtp-on-port-26-tcp.asciidoc">edit</a></div>
</div></div></div>
<p>This rule detects events that may indicate use of SMTP on TCP port 26. This port is commonly used by several popular mail transfer agents to deconflict with the default SMTP port 25. This port has also been used by a malware family called BadPatch for command and control of Windows systems.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
packetbeat-*
</li>
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-network_traffic.*
</li>
<li class="listitem">
logs-panw.panos*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.15/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://unit42.paloaltonetworks.com/unit42-badpatch/" class="ulink" target="_top">https://unit42.paloaltonetworks.com/unit42-badpatch/</a>
</li>
<li class="listitem">
<a href="https://isc.sans.edu/forums/diary/Next+up+whats+up+with+TCP+port+26/25564/" class="ulink" target="_top">https://isc.sans.edu/forums/diary/Next+up+whats+up+with+TCP+port+26/25564/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Tactic: Command and Control
</li>
<li class="listitem">
Domain: Endpoint
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Data Source: PAN-OS
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 106</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_5163"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-15/prebuilt-rule-8-15-15-smtp-on-port-26-tcp.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating SMTP on Port 26/TCP</strong></span></p>
<p>SMTP, typically operating on port 25, is crucial for email transmission. However, port 26 is often used to avoid conflicts or restrictions on port 25. Adversaries exploit this by using port 26 for covert command and control, as seen with the BadPatch malware. The detection rule identifies suspicious SMTP activity on port 26 by analyzing network traffic patterns, helping to uncover potential threats.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the network traffic logs to identify any unusual patterns or anomalies associated with TCP port 26, focusing on the event.dataset fields such as network_traffic.flow or zeek.smtp.
</li>
<li class="listitem">
Analyze the source and destination IP addresses involved in the alert to determine if they are known or associated with any previous suspicious activities.
</li>
<li class="listitem">
Check for any additional alerts or logs related to the same source or destination IP addresses to identify potential patterns or repeated attempts of communication on port 26.
</li>
<li class="listitem">
Investigate the context of the communication by examining the payload data, if available, to identify any indicators of compromise or malicious content.
</li>
<li class="listitem">
Correlate the findings with threat intelligence sources to determine if the IP addresses or domains are associated with known threat actors or malware, such as BadPatch.
</li>
<li class="listitem">
Assess the risk and impact on the affected systems by determining if any sensitive data or critical systems are involved in the communication on port 26.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Legitimate mail transfer agents may use port 26 to avoid conflicts with port 25. Identify these agents and create exceptions in the detection rule to prevent unnecessary alerts.
</li>
<li class="listitem">
Some network configurations might reroute SMTP traffic to port 26 for load balancing or security reasons. Verify these configurations and whitelist known IP addresses or domains to reduce false positives.
</li>
<li class="listitem">
Internal testing or development environments might use port 26 for non-malicious purposes. Document these environments and exclude their traffic from triggering alerts.
</li>
<li class="listitem">
Certain email service providers may use port 26 as an alternative to port 25. Confirm these providers and adjust the rule to recognize their traffic as benign.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately isolate the affected system from the network to prevent further command and control communication via port 26.
</li>
<li class="listitem">
Conduct a thorough scan of the isolated system using updated antivirus and anti-malware tools to identify and remove the BadPatch malware or any other malicious software.
</li>
<li class="listitem">
Review and analyze network logs to identify any other systems that may have communicated with the same command and control server, and isolate those systems as well.
</li>
<li class="listitem">
Change all passwords and credentials that may have been compromised or accessed by the affected system to prevent unauthorized access.
</li>
<li class="listitem">
Apply security patches and updates to the affected system and any other vulnerable systems to mitigate exploitation by similar threats.
</li>
<li class="listitem">
Monitor network traffic for any further suspicious activity on port 26 and other non-standard ports, adjusting firewall rules to block unauthorized SMTP traffic.
</li>
<li class="listitem">
Escalate the incident to the security operations center (SOC) or relevant cybersecurity team for further investigation and to ensure comprehensive threat eradication.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_6630"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-15/prebuilt-rule-8-15-15-smtp-on-port-26-tcp.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">(event.dataset: (network_traffic.flow or zeek.smtp) or event.category:(network or network_traffic)) and network.transport:tcp and destination.port:26</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Control
</li>
<li class="listitem">
ID: TA0011
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0011/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0011/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Exfiltration
</li>
<li class="listitem">
ID: TA0010
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0010/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0010/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Exfiltration Over Alternative Protocol
</li>
<li class="listitem">
ID: T1048
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1048/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1048/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-15-15-ipsec-nat-traversal-port-activity.html">« IPSEC NAT Traversal Port Activity</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-15-15-rdp-remote-desktop-protocol-from-the-internet.html">RDP (Remote Desktop Protocol) from the Internet »</a>
</span>
</div>
</body>
</html>
