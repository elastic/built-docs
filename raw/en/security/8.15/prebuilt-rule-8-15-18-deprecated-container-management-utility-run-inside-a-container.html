<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Deprecated - Container Management Utility Run Inside A Container | Elastic Security Solution [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Deprecated - Container Management Utility Run Inside A Container | Elastic Security Solution [8.15]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.15]"/>
<link rel="up" href="prebuilt-rule-8-15-18-prebuilt-rules-8-15-18-appendix.html" title="Appendix e: Downloadable rule update v8.15.18"/>
<link rel="prev" href="prebuilt-rule-8-15-18-deprecated-suspicious-network-tool-launched-inside-a-container.html" title="Deprecated - Suspicious Network Tool Launched Inside A Container"/>
<link rel="next" href="prebuilt-rule-8-15-18-deprecated-file-made-executable-via-chmod-inside-a-container.html" title="Deprecated - File Made Executable via Chmod Inside A Container"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.15"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-15-18-deprecated-suspicious-network-tool-launched-inside-a-container.html">« Deprecated - Suspicious Network Tool Launched Inside A Container</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-15-18-deprecated-file-made-executable-via-chmod-inside-a-container.html">Deprecated - File Made Executable via Chmod Inside A Container »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-15-18-prebuilt-rules-8-15-18-appendix.html">Downloadable rule update v8.15.18</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Deprecated - Container Management Utility Run Inside A Container</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-18/prebuilt-rule-8-15-18-deprecated-container-management-utility-run-inside-a-container.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-15-18-deprecated-container-management-utility-run-inside-a-container"></a>Deprecated - Container Management Utility Run Inside A Container</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-18/prebuilt-rule-8-15-18-deprecated-container-management-utility-run-inside-a-container.asciidoc">edit</a></div>
</div></div></div>
<p>This rule detects when a container management binary is run from inside a container. These binaries are critical components of many containerized environments, and their presence and execution in unauthorized containers could indicate compromise or a misconfiguration.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
logs-cloud_defend*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/8.15/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>: None</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Data Source: Elastic Defend for Containers
</li>
<li class="listitem">
Domain: Container
</li>
<li class="listitem">
OS: Linux
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Execution
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic Licence v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_5726"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-18/prebuilt-rule-8-15-18-deprecated-container-management-utility-run-inside-a-container.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating Deprecated - Container Management Utility Run Inside A Container</strong></span></p>
<p>Container management utilities like Docker and Kubernetes are essential for orchestrating and managing containerized applications. They facilitate tasks such as deployment, scaling, and networking. However, adversaries can exploit these tools to execute unauthorized commands within containers, potentially leading to system compromise. The detection rule identifies suspicious execution of these utilities within containers, signaling possible misuse or misconfiguration, by monitoring specific process activities and event types.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the specific container ID where the suspicious process was executed to determine its purpose and origin.
</li>
<li class="listitem">
Examine the process name and command line arguments to understand the context of the execution and identify any anomalies or unauthorized commands.
</li>
<li class="listitem">
Check the user and permissions associated with the process to assess if it aligns with expected roles and access levels for container management tasks.
</li>
<li class="listitem">
Investigate the container&#8217;s creation and deployment history to identify any recent changes or deployments that could explain the presence of the management utility.
</li>
<li class="listitem">
Analyze network activity associated with the container to detect any unusual connections or data transfers that might indicate malicious activity.
</li>
<li class="listitem">
Correlate the event with other security alerts or logs to identify patterns or related incidents that could provide additional context or evidence of compromise.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Routine maintenance tasks within containers can trigger the rule. Exclude known maintenance scripts or processes by adding them to an allowlist if they frequently execute container management utilities.
</li>
<li class="listitem">
Development and testing environments often run container management commands for legitimate purposes. Consider excluding these environments from monitoring or adjust the rule to focus on production environments only.
</li>
<li class="listitem">
Automated deployment tools may execute container management commands as part of their workflow. Identify these tools and create exceptions for their activities to prevent false positives.
</li>
<li class="listitem">
System updates or patches might involve running container management utilities. Monitor update schedules and temporarily adjust the rule to avoid unnecessary alerts during these periods.
</li>
<li class="listitem">
Legitimate administrative actions by authorized personnel can trigger the rule. Implement user-based exceptions for known administrators to reduce false positives while maintaining security oversight.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately isolate the affected container to prevent further unauthorized access or execution of commands. This can be done by stopping the container or disconnecting it from the network.
</li>
<li class="listitem">
Review the container&#8217;s configuration and access controls to identify any misconfigurations or unauthorized access permissions that may have allowed the execution of container management utilities.
</li>
<li class="listitem">
Conduct a thorough analysis of the container&#8217;s logs and process activities to determine the extent of the compromise and identify any additional malicious activities or lateral movement attempts.
</li>
<li class="listitem">
Remove any unauthorized or suspicious binaries and scripts from the container to prevent further exploitation.
</li>
<li class="listitem">
Patch and update the container image and underlying host system to address any known vulnerabilities that may have been exploited.
</li>
<li class="listitem">
Implement stricter access controls and monitoring on container management utilities to ensure they are only accessible by authorized users and processes.
</li>
<li class="listitem">
Escalate the incident to the security operations team for further investigation and to assess the need for broader security measures across the container environment.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_2242"></a>Setup</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-18/prebuilt-rule-8-15-18-deprecated-container-management-utility-run-inside-a-container.asciidoc">edit</a></div>
</div></div></div>
<p>This rule was deprecated in the 8.18 and 9.0 versions of the Elastic Stack due to deprecation of the <em>Defend For Containers</em> integration. Users using 8.18+ versions should disable this rule and enable linux-based rules tagged "Domain: Container".</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_7216"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/prebuilt-rules/downloadable-packages/8-15-18/prebuilt-rule-8-15-18-deprecated-container-management-utility-run-inside-a-container.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">process where container.id: "*" and event.type== "start"
  and process.name: ("dockerd", "docker", "kubelet", "kube-proxy", "kubectl", "containerd", "runc", "systemd", "crictl")</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Container Administration Command
</li>
<li class="listitem">
ID: T1609
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1609/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1609/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-15-18-deprecated-suspicious-network-tool-launched-inside-a-container.html">« Deprecated - Suspicious Network Tool Launched Inside A Container</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-15-18-deprecated-file-made-executable-via-chmod-inside-a-container.html">Deprecated - File Made Executable via Chmod Inside A Container »</a>
</span>
</div>
</body>
</html>
