<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Endpoint management | Elastic Security Solution [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Endpoint management | Elastic Security Solution [8.15]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.15]"/>
<link rel="up" href="troubleshooting-ov.html" title="Troubleshooting"/>
<link rel="prev" href="ts-detection-rules.html" title="Detection rules"/>
<link rel="next" href="release-notes.html" title="Release notes"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.15"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.15"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="ts-detection-rules.html">« Detection rules</a>
</span>
<span class="next">
<a href="release-notes.html">Release notes »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="troubleshooting-ov.html">Troubleshooting</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Endpoint management</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/troubleshooting/management/ts-management.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ts-management"></a>Endpoint management<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/troubleshooting/management/ts-management.asciidoc">edit</a></h2>
</div></div></div>
<p>This topic covers common troubleshooting issues when using Elastic Security <a class="xref" href="sec-manage-intro.html" title="Manage endpoint protection">endpoint management tools</a>.</p>
<h3><a id="ts-endpoints"></a>Endpoints<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/troubleshooting/management/ts-management.asciidoc">edit</a></h3>
<details id="ts-unhealthy-agent">
<summary class="title">Unhealthy Elastic Agent status</summary>
<div class="content">
<p>In some cases, an <code class="literal">Unhealthy</code> Elastic Agent status may be caused by a failure in the Elastic Defend integration policy. In this situation, the integration and any failing features are flagged on the agent details page in Fleet. Expand each section and subsection to display individual responses from the agent.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Integration policy response information is also available from the <span class="strong strong"><strong>Endpoints</strong></span> page in the Elastic Security app (<span class="strong strong"><strong>Manage</strong></span> &#8594; <span class="strong strong"><strong>Endpoints</strong></span>, then click the link in the <span class="strong strong"><strong>Policy status</strong></span> column).</p>
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/unhealthy-agent-fleet.png" alt="Agent details page in Fleet with Unhealthy status and integration failures">
</div>
</div>
<p>Common causes of failure in the Elastic Defend integration policy include missing prerequisites or unexpected system configuration. Consult the following topics to resolve a specific error:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="deploy-elastic-endpoint.html#system-extension-endpoint" title="Approve the system extension for Elastic Endpoint">Approve the system extension for Elastic Endpoint</a> (macOS)
</li>
<li class="listitem">
<a class="xref" href="deploy-elastic-endpoint.html#enable-fda-endpoint" title="Enable Full Disk Access for Elastic Endpoint">Enable Full Disk Access for Elastic Endpoint</a> (macOS)
</li>
<li class="listitem">
<a class="xref" href="ts-management.html#linux-deadlock" title="Disabled to avoid potential system deadlock (Linux)">Resolve a potential system deadlock</a> (Linux)
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the Elastic Defend integration policy is not the cause of the <code class="literal">Unhealthy</code> agent status, refer to <a href="/guide/en/fleet/8.15/fleet-troubleshooting.html" class="ulink" target="_top">Fleet troubleshooting</a> for help with the Elastic Agent.</p>
</div>
</div>
</div>
</details>
<details id="linux-deadlock">
<summary class="title">Disabled to avoid potential system deadlock (Linux)</summary>
<div class="content">
<p>If you have an <code class="literal">Unhealthy</code> Elastic Agent status with the message <code class="literal">Disabled due to potential system deadlock</code>, that means malware protection was disabled on the Elastic Defend integration policy due to errors while monitoring a Linux host.</p>
<p>You can resolve the issue by configuring the policy&#8217;s <a class="xref" href="linux-file-monitoring.html" title="Configure Linux file system monitoring">advanced settings</a> related to <span class="strong strong"><strong>fanotify</strong></span>, a Linux feature that monitors file system events. By default, Elastic Defend works with fanotify to monitor specific file system types that Elastic has tested for compatibility, and ignores other unknown file system types.</p>
<p>If your network includes nonstandard, proprietary, or otherwise unrecognized Linux file systems that cause errors while being monitored, you can configure Elastic Defend to ignore those file systems. This allows Elastic Defend to resume monitoring and protecting the hosts on the integration policy.</p>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>Ignoring file systems can create gaps in your security coverage. Use additional security layers for any file systems ignored by Elastic Defend.</p>
</div>
</div>
<p>To resolve the potential system deadlock error:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Manage</strong></span> &#8594; <span class="strong strong"><strong>Policies</strong></span>, then click a policy&#8217;s name.
</li>
<li class="listitem">
Scroll to the bottom of the policy and click <span class="strong strong"><strong>Show advanced settings</strong></span>.
</li>
<li class="listitem">
In the setting <code class="literal">linux.advanced.fanotify.ignored_filesystems</code>, enter a comma-separated list of file system names to ignore, as they appear in <code class="literal">/proc/filesystems</code> (for example: <code class="literal">ext4,tmpfs</code>). Refer to <a class="xref" href="linux-file-monitoring.html#find-file-system-names" title="Find file system names">Find file system names</a> for more on determining the file system names.
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Save</strong></span>.</p>
<p>Once you save the policy, malware protection is re-enabled.</p>
</li>
</ol>
</div>
</div>
</details>
<details id="ts-transform-failed">
<summary class="title">Required transform failed</summary>
<div class="content">
<p>If you encounter a <code class="literal">“Required transform failed”</code> notice on the Endpoints page, you can usually resolve the issue by restarting the transform. Refer to <a href="/guide/en/elasticsearch/reference/8.15/transforms.html" class="ulink" target="_top">Transforming data</a> for more information about transforms.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/endpoints-transform-failed.png" alt="Endpoints page with Required transform failed notice">
</div>
</div>
<p>To restart a transform that’s not running:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Kibana</strong></span> &#8594; <span class="strong strong"><strong>Stack Management</strong></span> &#8594; <span class="strong strong"><strong>Data</strong></span> &#8594; <span class="strong strong"><strong>Transforms</strong></span>.
</li>
<li class="listitem">
Enter <code class="literal">endpoint.metadata</code> in the search box to find the transforms for Elastic Defend.
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Actions</strong></span> menu (<span class="strong strong"><strong>&#8230;&#8203;</strong></span>) and do one of the following for each transform, depending on the value in the <span class="strong strong"><strong>Status</strong></span> column:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">stopped</code>: Select <span class="strong strong"><strong>Start</strong></span> to restart the transform.
</li>
<li class="listitem">
<p><code class="literal">failed</code>: Select <span class="strong strong"><strong>Stop</strong></span> to first stop the transform, and then select <span class="strong strong"><strong>Start</strong></span> to restart it.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/transforms-start.png" alt="Transforms page with Start option selected">
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
On the confirmation message that displays, click <span class="strong strong"><strong>Start</strong></span> to restart the transform.
</li>
<li class="listitem">
The transform’s status changes to <code class="literal">started</code>. If it doesn&#8217;t change, refresh the page.
</li>
</ol>
</div>
</div>
</details>
<details id="ts-agent-connection">
<summary class="title">Elastic Agent and Endpoint connection issues</summary>
<div class="content">
<p>After Elastic Agent installs Endpoint, Endpoint connects to Elastic Agent over a local relay connection to report its health status and receive policy updates and response action requests. If that connection cannot be established, the Elastic Defend integration will cause Elastic Agent to be in an <code class="literal">Unhealthy</code> status, and Endpoint won&#8217;t operate properly.</p>
<h4><a id="_identify_if_the_issue_is_happening"></a>Identify if the issue is happening<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/troubleshooting/management/ts-management.asciidoc">edit</a></h4>
<p>You can identify if this issue is happening in the following ways:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Run Elastic Agent&#8217;s status command:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">sudo /opt/Elastic/Agent/elastic-agent status</code> (Linux)
</li>
<li class="listitem">
<code class="literal">sudo /Library/Elastic/Agent/elastic-agent status</code> (macOS)
</li>
<li class="listitem">
<code class="literal">c:\Program Files\Elastic\Agent\elastic-agent.exe status</code> (Windows)
</li>
</ul>
</div>
<p>If the status result for <code class="literal">endpoint-security</code> says that Endpoint has missed check-ins or <code class="literal">localhost:6788</code> cannot be bound to, it might indicate this problem is occurring.</p>
</li>
<li class="listitem">
<p>If the problem starts happening right after installing Endpoint, check the value of <code class="literal">fleet.agent.id</code> in the following file:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">/opt/Elastic/Endpoint/elastic-endpoint.yaml</code> (Linux)
</li>
<li class="listitem">
<code class="literal">/Library/Elastic/Endpoint/elastic-endpoint.yaml</code> (macOS)
</li>
<li class="listitem">
<code class="literal">c:\Program Files\Elastic\Endpoint\elastic-endpoint.yaml</code> (Windows)
</li>
</ul>
</div>
<p>If the value of <code class="literal">fleet.agent.id</code> is <code class="literal">00000000-0000-0000-0000-000000000000</code>, this indicates this problem is occurring.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If this problem starts happening after Endpoint has already been installed and working properly, then this value will have changed even though the problem is happening.</p>
</div>
</div>
</li>
</ul>
</div>
<h4><a id="_examine_endpoint_logs"></a>Examine Endpoint logs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/troubleshooting/management/ts-management.asciidoc">edit</a></h4>
<p>If you&#8217;ve confirmed that the issue is happening, you can look at Endpoint log messages to identify the cause:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">Failed to find connection to validate. Is Agent listening on 127.0.0.1:6788?</code> or <code class="literal">Failed to validate connection. Is Agent running as root/admin?</code> means that Endpoint is not able to create an initial connection to Elastic Agent over port <code class="literal">6788</code>.
</li>
<li class="listitem">
<code class="literal">Unable to make GRPC connection in deadline(60s). Fetching connection info again</code> means that Endpoint&#8217;s original connection to Elastic Agent over port <code class="literal">6788</code> worked, but the connection over port <code class="literal">6789</code> is failing.
</li>
</ul>
</div>
<h4><a id="_resolve_the_issue"></a>Resolve the issue<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.15/docs/troubleshooting/management/ts-management.asciidoc">edit</a></h4>
<p>To debug and resolve the issue, follow these steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Since 8.7.0, Endpoint diagnostics contain a file named <code class="literal">analysis.txt</code> that contains information about what may cause this issue. As of 8.11.2, Elastic Agent diagnostics automatically include Endpoint diagnostics. For previous versions, you can gather Endpoint diagnostics by running:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">sudo /opt/Elastic/Endpoint/elastic-endpoint diagnostics</code> (Linux)
</li>
<li class="listitem">
<code class="literal">sudo /Library/Elastic/Endpoint/elastic-endpoint diagnostics</code> (macOS)
</li>
<li class="listitem">
<code class="literal">c:\Program Files\Elastic\Endpoint\elastic-endpoint.exe diagnostics</code> (Windows)
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Make sure nothing else on your device is listening on ports <code class="literal">6788</code> or <code class="literal">6789</code> by running:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">sudo netstat -anp --tcp</code> (Linux)
</li>
<li class="listitem">
<code class="literal">sudo netstat -an -f inet</code> (macOS)
</li>
<li class="listitem">
<code class="literal">netstat -an</code> (Windows)
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Make sure <code class="literal">localhost</code> can be resolved to <code class="literal">127.0.0.1</code> by running:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ping -4 -c 1 localhost</code> (Linux)
</li>
<li class="listitem">
<code class="literal">ping -c 1 localhost</code> (macOS)
</li>
<li class="listitem">
<code class="literal">ping -4 localhost</code> (Windows)
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</details>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="ts-detection-rules.html">« Detection rules</a>
</span>
<span class="next">
<a href="release-notes.html">Release notes »</a>
</span>
</div>
</body>
</html>
