<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS STS Role Assumption by User | Elastic Security Solution [8.16] | Elastic</title>
<meta class="elastic" name="content" content="AWS STS Role Assumption by User | Elastic Security Solution [8.16]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.16]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="aws-sts-role-assumption-by-service.html" title="AWS STS Role Assumption by Service"/>
<link rel="next" href="aws-sts-role-chaining.html" title="AWS STS Role Chaining"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.16"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.16"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="aws-sts-role-assumption-by-service.html">« AWS STS Role Assumption by Service</a>
</span>
<span class="next">
<a href="aws-sts-role-chaining.html">AWS STS Role Chaining »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS STS Role Assumption by User</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/aws-sts-role-assumption-by-user.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/security/prebuilt-rules/rules/integrations/aws/privilege_escalation_role_assumption_by_user">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="aws-sts-role-assumption-by-user"></a>AWS STS Role Assumption by User</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/aws-sts-role-assumption-by-user.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies when a user or role has assumed a role in AWS Security Token Service (STS). Users can assume a role to obtain temporary credentials and access AWS resources. Adversaries can use this technique for credential access and privilege escalation. This is a [New Terms](<a href="/guide/en/security/current/rules-ui-create.html#create-new-terms-rule" class="ulink" target="_top">https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule</a>) rule that identifies when a service assumes a role in AWS Security Token Service (STS) to obtain temporary credentials and access AWS resources. While often legitimate, adversaries may use this technique for unauthorized access, privilege escalation, or lateral movement within an AWS environment.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: None (<a href="/guide/en/elasticsearch/reference/8.16/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html" class="ulink" target="_top">https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS STS
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Tactic: Privilege Escalation
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_108"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/aws-sts-role-assumption-by-user.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating AWS STS Role Assumption by User</strong></span></p>
<p>This rule detects when a user assumes a role in AWS Security Token Service (STS), receiving temporary credentials to access AWS resources. While often used for legitimate purposes, this action can be leveraged by adversaries to obtain unauthorized access, escalate privileges, or move laterally within an AWS environment.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the User and Assumed Role</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>User Identity</strong></span>: Check <code class="literal">aws.cloudtrail.user_identity.arn</code> and <code class="literal">aws.cloudtrail.user_identity.type</code> for details about the initiator of the <code class="literal">AssumeRole</code> action.
</li>
<li class="listitem">
<span class="strong strong"><strong>Role Assumed</strong></span>: Review <code class="literal">aws.cloudtrail.flattened.request_parameters.roleArn</code> to confirm the role assumed and ensure it aligns with the user’s standard permissions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Session Name</strong></span>: Note <code class="literal">aws.cloudtrail.flattened.request_parameters.roleSessionName</code> for context on the purpose of the session.
</li>
<li class="listitem">
<span class="strong strong"><strong>Evaluate Session Context and Credential Duration</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Session Details</strong></span>: Look into <code class="literal">aws.cloudtrail.user_identity.session_context.creation_date</code> for the start of the session and <code class="literal">aws.cloudtrail.user_identity.session_context.mfa_authenticated</code> to check for MFA usage.
</li>
<li class="listitem">
<span class="strong strong"><strong>Credential Validity</strong></span>: Examine <code class="literal">aws.cloudtrail.flattened.request_parameters.durationSeconds</code> for how long the credentials are valid.
</li>
<li class="listitem">
<span class="strong strong"><strong>Expiration Time</strong></span>: Use <code class="literal">aws.cloudtrail.flattened.response_elements.credentials.expiration</code> to confirm the credential expiration.
</li>
<li class="listitem">
<span class="strong strong"><strong>Inspect User Agent and Source Information</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>User Agent</strong></span>: Analyze the <code class="literal">user_agent.original</code> field to identify if specific tooling or SDKs like AWS CLI, Boto3, or custom agents were used.
</li>
<li class="listitem">
<span class="strong strong"><strong>Source IP and Geolocation</strong></span>: Examine <code class="literal">source.address</code> and <code class="literal">source.geo</code> fields to determine the origin of the request, confirming if it aligns with expected locations.
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with Related Events</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Identify Patterns</strong></span>: Review related CloudTrail events for unusual access patterns, such as resource access or sensitive actions following this <code class="literal">AssumeRole</code> action.
</li>
<li class="listitem">
<span class="strong strong"><strong>Filter High-Volume Roles</strong></span>: If this role or user has a high volume of access, evaluate <code class="literal">roleArn</code> or <code class="literal">user_agent</code> values for common patterns and add trusted entities as exceptions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review the Privileges of the Assumed Role</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Permissions</strong></span>: Examine permissions associated with the <code class="literal">roleArn</code> to assess its access scope.
</li>
<li class="listitem">
<span class="strong strong"><strong>Authorized Usage</strong></span>: Confirm if the role is used frequently for administrative purposes and if this aligns with the user’s regular responsibilities.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Automated Processes and Applications</strong></span>: Applications or scheduled tasks may assume roles regularly for operational purposes. Validate the consistency of the <code class="literal">user_agent</code> or <code class="literal">roleArn</code> with known automated workflows.
</li>
<li class="listitem">
<span class="strong strong"><strong>Standard IAM Policy Usage</strong></span>: Confirm if the user or application routinely assumes this specific role for normal operations by reviewing historical activity.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Terminate Unauthorized Sessions</strong></span>: If the role assumption is deemed unauthorized, revoke the session by modifying IAM policies or the permissions associated with the assumed role.
</li>
<li class="listitem">
<span class="strong strong"><strong>Strengthen Monitoring and Alerts</strong></span>: Implement additional monitoring for specific high-risk roles, especially those with elevated permissions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Regularly Manage Exceptions</strong></span>: Regularly review high-volume roles and user agent patterns to refine alerts, minimizing noise by adding trusted patterns as exceptions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Incident Response</strong></span>: If confirmed as malicious, follow incident response protocols for containment, investigation, and remediation.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Information</strong></span></p>
<p>For more details on managing and securing AWS STS in your environment, refer to the <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html" class="ulink" target="_top">AWS STS documentation</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_112"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/aws-sts-role-assumption-by-user.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "aws.cloudtrail"
    and event.provider: "sts.amazonaws.com"
    and event.action: "AssumeRole"
    and event.outcome: "success"
    and aws.cloudtrail.user_identity.type: ("AssumedRole" or "IAMUser")</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Abuse Elevation Control Mechanism
</li>
<li class="listitem">
ID: T1548
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1548/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1548/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Lateral Movement
</li>
<li class="listitem">
ID: TA0008
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0008/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0008/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Use Alternate Authentication Material
</li>
<li class="listitem">
ID: T1550
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1550/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1550/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Application Access Token
</li>
<li class="listitem">
ID: T1550.001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1550/001/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1550/001/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-sts-role-assumption-by-service.html">« AWS STS Role Assumption by Service</a>
</span>
<span class="next">
<a href="aws-sts-role-chaining.html">AWS STS Role Chaining »</a>
</span>
</div>
</body>
</html>
