<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Potential Process Name Stomping with Prctl | Elastic Security Solution [8.16] | Elastic</title>
<meta class="elastic" name="content" content="Potential Process Name Stomping with Prctl | Elastic Security Solution [8.16]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.16]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="potential-process-injection-via-powershell.html" title="Potential Process Injection via PowerShell"/>
<link rel="next" href="potential-protocol-tunneling-via-chisel-client.html" title="Potential Protocol Tunneling via Chisel Client"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.16"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.16"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="potential-process-injection-via-powershell.html">« Potential Process Injection via PowerShell</a>
</span>
<span class="next">
<a href="potential-protocol-tunneling-via-chisel-client.html">Potential Protocol Tunneling via Chisel Client »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Potential Process Name Stomping with Prctl</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/potential-process-name-stomping-with-prctl.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="potential-process-name-stomping-with-prctl"></a>Potential Process Name Stomping with Prctl</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/potential-process-name-stomping-with-prctl.asciidoc">edit</a></div>
</div></div></div>
<p>This rule leverages Auditd data to detect the use of the <code class="literal">prctl</code> syscall to potentially hide a process by changing its name. The <code class="literal">prctl</code> syscall is used to control various process attributes. Attackers can use this syscall to change the name of a process to a hidden directory or file, making it harder to detect. The query looks for the <code class="literal">prctl</code> syscall with the <code class="literal">PR_SET_NAME</code> argument set to <code class="literal">f</code> (PR_SET_NAME is used to set the name of a process).</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
logs-auditd_manager.auditd-*
</li>
<li class="listitem">
auditbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.16/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://haxrob.net/process-name-stomping/" class="ulink" target="_top">https://haxrob.net/process-name-stomping/</a>
</li>
<li class="listitem">
<a href="https://haxrob.net/hiding-in-plain-sight-part-2/" class="ulink" target="_top">https://haxrob.net/hiding-in-plain-sight-part-2/</a>
</li>
<li class="listitem">
<a href="/security-labs/linux-detection-engineering-with-auditd" class="ulink" target="_top">https://www.elastic.co/security-labs/linux-detection-engineering-with-auditd</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Data Source: Auditd Manager
</li>
<li class="listitem">
Domain: Endpoint
</li>
<li class="listitem">
OS: Linux
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Defense Evasion
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 2</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_747"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/potential-process-name-stomping-with-prctl.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating Potential Process Name Stomping with Prctl</strong></span></p>
<p>The <code class="literal">prctl</code> syscall in Linux allows processes to modify their attributes, including renaming themselves. This capability can be exploited by attackers to disguise malicious processes, making them harder to identify. The detection rule monitors for <code class="literal">prctl</code> invocations with specific arguments indicative of name changes, especially when linked to suspicious directories, thus flagging potential evasion attempts.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the process details associated with the alert, focusing on the executable path to determine if it matches any suspicious directories listed in the query, such as "/tmp/<span class="strong strong"><strong>" or "/var/tmp/</strong></span>".
</li>
<li class="listitem">
Examine the process tree to identify the parent process and any child processes spawned by the suspicious process, which may provide context on how the process was initiated and its potential impact.
</li>
<li class="listitem">
Check the command line arguments and environment variables of the process to gather additional context on its intended function and any anomalies.
</li>
<li class="listitem">
Investigate the user account under which the process is running to determine if it aligns with expected behavior or if it indicates potential compromise.
</li>
<li class="listitem">
Correlate the alert with other security events or logs, such as file modifications or network connections, to identify any related malicious activity or patterns.
</li>
<li class="listitem">
Assess the historical activity of the process executable and its associated files to determine if this behavior is new or part of a recurring pattern.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
System maintenance scripts may invoke prctl to rename processes for legitimate reasons. Review scheduled tasks and maintenance scripts in directories like /etc/cron.* and /etc/init.d to identify benign uses.
</li>
<li class="listitem">
Development environments often use prctl for testing purposes. Exclude known development directories such as /home/developer or /tmp/dev from the rule to reduce noise.
</li>
<li class="listitem">
Some monitoring or logging tools might use prctl to rename their processes for clarity. Identify these tools and add their executable paths to an exception list.
</li>
<li class="listitem">
Custom scripts or applications that manage process names for operational reasons should be documented. Exclude these scripts by specifying their paths in the rule configuration.
</li>
<li class="listitem">
Regularly review and update the exception list to ensure it reflects the current environment and does not inadvertently exclude new threats.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately isolate the affected system from the network to prevent further malicious activity or lateral movement.
</li>
<li class="listitem">
Terminate any suspicious processes identified by the detection rule, especially those with altered names in critical directories.
</li>
<li class="listitem">
Conduct a thorough review of the affected system&#8217;s process tree and file system to identify any additional signs of compromise or persistence mechanisms.
</li>
<li class="listitem">
Restore any altered or suspicious files from a known good backup to ensure system integrity.
</li>
<li class="listitem">
Update and patch the affected system to close any vulnerabilities that may have been exploited by the attacker.
</li>
<li class="listitem">
Monitor the network for any signs of similar activity or attempts to use the <code class="literal">prctl</code> syscall with the <code class="literal">PR_SET_NAME</code> argument in other systems.
</li>
<li class="listitem">
Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to determine if broader organizational impacts exist.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_480"></a>Setup</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/potential-process-name-stomping-with-prctl.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Setup</strong></span></p>
<p>This rule requires data coming in from Auditd Manager.</p>
<p><span class="strong strong"><strong>Auditd Manager Integration Setup</strong></span></p>
<p>The Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.
Auditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With <code class="literal">auditd_manager</code>, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.</p>
<p><span class="strong strong"><strong>The following steps should be executed in order to add the Elastic Agent System integration "auditd_manager" on a Linux System:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go to the Kibana home page and click “Add integrations”.
</li>
<li class="listitem">
In the query bar, search for “Auditd Manager” and select the integration to see more details about it.
</li>
<li class="listitem">
Click “Add Auditd Manager”.
</li>
<li class="listitem">
Configure the integration name and optionally add a description.
</li>
<li class="listitem">
Review optional and advanced settings accordingly.
</li>
<li class="listitem">
Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.
</li>
<li class="listitem">
Click “Save and Continue”.
</li>
<li class="listitem">
For more details on the integration refer to the <a href="https://docs.elastic.co/integrations/auditd_manager" class="ulink" target="_top">helper guide</a>.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule Specific Setup Note</strong></span></p>
<p>Auditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.
However, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the "audit rules" configuration box or the "auditd rule files" box by specifying a file to read the audit rules from.
- For this detection rule the following additional audit rules are required to be added to the integration:
 &#8201;&#8212;&#8201;"-a exit,always -F arch=b64 -S prctl -k prctl_detection"</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_795"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/rule-details/potential-process-name-stomping-with-prctl.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">process where host.os.type == "linux" and auditd.data.syscall == "prctl" and auditd.data.a0 == "f" and
process.executable like (
  "/boot/*", "/dev/shm/*", "/etc/cron.*/*", "/etc/init.d/*", "/var/run/*", "/etc/update-motd.d/*",
  "/tmp/*", "/var/log/*", "/var/tmp/*", "/home/*", "/run/shm/*", "/run/*", "./*"
)</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Masquerading
</li>
<li class="listitem">
ID: T1036
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1036/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1036/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Match Legitimate Name or Location
</li>
<li class="listitem">
ID: T1036.005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1036/005/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1036/005/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="potential-process-injection-via-powershell.html">« Potential Process Injection via PowerShell</a>
</span>
<span class="next">
<a href="potential-protocol-tunneling-via-chisel-client.html">Potential Protocol Tunneling via Chisel Client »</a>
</span>
</div>
</body>
</html>
