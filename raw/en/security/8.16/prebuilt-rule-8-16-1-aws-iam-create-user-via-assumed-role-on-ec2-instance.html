<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS IAM Create User via Assumed Role on EC2 Instance | Elastic Security Solution [8.16] | Elastic</title>
<meta class="elastic" name="content" content="AWS IAM Create User via Assumed Role on EC2 Instance | Elastic Security Solution [8.16]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.16]"/>
<link rel="up" href="prebuilt-rule-8-16-1-prebuilt-rules-8-16-1-appendix.html" title="Appendix T: Downloadable rule update v8.16.1"/>
<link rel="prev" href="prebuilt-rule-8-16-1-aws-sns-email-subscription-by-rare-user.html" title="AWS SNS Email Subscription by Rare User"/>
<link rel="next" href="prebuilt-rule-8-16-1-aws-sts-assumerole-with-new-mfa-device.html" title="AWS STS AssumeRole with New MFA Device"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.16"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.16"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-16-1-aws-sns-email-subscription-by-rare-user.html">« AWS SNS Email Subscription by Rare User</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-16-1-aws-sts-assumerole-with-new-mfa-device.html">AWS STS AssumeRole with New MFA Device »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-16-1-prebuilt-rules-8-16-1-appendix.html">Downloadable rule update v8.16.1</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS IAM Create User via Assumed Role on EC2 Instance</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-1/prebuilt-rule-8-16-1-aws-iam-create-user-via-assumed-role-on-ec2-instance.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-16-1-aws-iam-create-user-via-assumed-role-on-ec2-instance"></a>AWS IAM Create User via Assumed Role on EC2 Instance</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-1/prebuilt-rule-8-16-1-aws-iam-create-user-via-assumed-role-on-ec2-instance.asciidoc">edit</a></div>
</div></div></div>
<p>Detects the creation of an AWS Identity and Access Management (IAM) user initiated by an assumed role on an EC2 instance. Assumed roles allow users or services to temporarily adopt different AWS permissions, but the creation of IAM users through these roles—particularly from within EC2 instances—may indicate a compromised instance. Adversaries might exploit such permissions to establish persistence by creating new IAM users under unauthorized conditions.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.16/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateUser.html" class="ulink" target="_top">https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateUser.html</a>
</li>
<li class="listitem">
<a href="https://www.dionach.com/en-us/breaking-into-the-cloud-red-team-tactics-for-aws-compromise/" class="ulink" target="_top">https://www.dionach.com/en-us/breaking-into-the-cloud-red-team-tactics-for-aws-compromise/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS IAM
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Tactic: Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_3246"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-1/prebuilt-rule-8-16-1-aws-iam-create-user-via-assumed-role-on-ec2-instance.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and Analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating AWS IAM User Creation via Assumed Role on an EC2 Instance</strong></span></p>
<p>This rule detects when an AWS Identity and Access Management (IAM) user is created through an assumed role on an EC2 instance. This action may indicate a potentially compromised instance where an adversary could be using the instance’s permissions to create a new IAM user, enabling persistent unauthorized access.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the Assumed Role and Initiating Instance</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Role and Instance</strong></span>: Examine the <code class="literal">aws.cloudtrail.user_identity.arn</code> field to determine the specific EC2 instance and role used for this action (e.g., <code class="literal">arn:aws:sts::[account-id]:assumed-role/[role-name]/[instance-id]</code>). Verify if this behavior aligns with expected usage or represents an anomaly.
</li>
<li class="listitem">
<span class="strong strong"><strong>Session Context</strong></span>: Check the <code class="literal">session_issuer</code> fields in <code class="literal">aws.cloudtrail.user_identity.session_context</code> for details about the role assumed by the instance, along with <code class="literal">mfa_authenticated</code> to determine if Multi-Factor Authentication (MFA) was used.
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze the Target IAM User</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>New User Details</strong></span>: Inspect <code class="literal">aws.cloudtrail.flattened.request_parameters.userName</code> to see the username that was created. Look at <code class="literal">aws.cloudtrail.flattened.response_elements.user.userName</code> for confirmation of successful user creation, and validate if the user is expected or authorized.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review Creation Time and Context</strong></span>: Compare the creation time (<code class="literal">@timestamp</code>) of the user with other activities from the same instance and role to assess if this creation was part of a larger chain of actions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Check User Agent and Tooling</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>User Agent Analysis</strong></span>: Review <code class="literal">user_agent.original</code> to see if AWS CLI, SDK, or other tooling was used for this request. Identifiers such as <code class="literal">aws-cli</code>, <code class="literal">boto3</code>, or similar SDK names can indicate the method used, which may differentiate automation from interactive actions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Source IP and Location</strong></span>: Use the <code class="literal">source.address</code> and <code class="literal">source.geo</code> fields to identify the IP address and geographic location of the event. Verify if this aligns with expected access patterns for your environment.
</li>
<li class="listitem">
<span class="strong strong"><strong>Evaluate for Persistence Indicators</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Role Permissions</strong></span>: Check the permissions associated with the assumed role (<code class="literal">arn:aws:iam::[account-id]:role/[role-name]</code>) to determine if creating IAM users is a legitimate activity for this role.
</li>
<li class="listitem">
<span class="strong strong"><strong>Automated Role Patterns</strong></span>: If the assumed role or instance typically creates IAM users for automation purposes, validate this action against historical records to confirm if the event is consistent with normal patterns.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review Related CloudTrail Events</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Additional IAM Actions</strong></span>: Investigate for other recent IAM or CloudTrail events tied to this role or instance, especially <code class="literal">CreateAccessKey</code> or <code class="literal">AttachUserPolicy</code> actions. These could signal further attempts to empower or utilize the newly created user.
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with Other Suspicious Activities</strong></span>: Determine if other roles or instances recently initiated similar unusual actions, such as privilege escalations or data access.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Expected Automation</strong></span>: Assumed roles may be used by legitimate automated systems that create users for specific workflows. Confirm if this event aligns with known automation activities.
</li>
<li class="listitem">
<span class="strong strong"><strong>User Agent and Role Exceptions</strong></span>: If this action is routine for specific roles or user agents (e.g., <code class="literal">aws-cli</code>, <code class="literal">boto3</code>), consider adding those roles or user agents to a monitored exception list for streamlined review.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Immediate Access Review</strong></span>: If user creation was unauthorized, restrict the assumed role’s permissions to prevent further user creation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Delete Unauthorized Users</strong></span>: Confirm and remove any unauthorized IAM users, adjusting IAM policies to reduce similar risks.
</li>
<li class="listitem">
<span class="strong strong"><strong>Enhance Monitoring and Alerts</strong></span>: Enable enhanced logging or real-time alerts for this role or instance to detect further unauthorized access attempts.
</li>
<li class="listitem">
<span class="strong strong"><strong>Policy Update</strong></span>: Consider updating IAM policies associated with roles on EC2 instances to limit sensitive actions like IAM user creation.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Information</strong></span></p>
<p>For further guidance on managing IAM roles and permissions within AWS environments, refer to the <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateUser.html" class="ulink" target="_top">AWS IAM documentation</a> and AWS best practices for security.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_4726"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-1/prebuilt-rule-8-16-1-aws-iam-create-user-via-assumed-role-on-ec2-instance.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "aws.cloudtrail"
    and event.provider: "iam.amazonaws.com"
    and event.action: "CreateUser"
    and event.outcome: "success"
    and aws.cloudtrail.user_identity.type: "AssumedRole"
    and aws.cloudtrail.user_identity.arn: *i-*</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Create Account
</li>
<li class="listitem">
ID: T1136
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1136/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1136/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Cloud Account
</li>
<li class="listitem">
ID: T1136.003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1136/003/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1136/003/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-16-1-aws-sns-email-subscription-by-rare-user.html">« AWS SNS Email Subscription by Rare User</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-16-1-aws-sts-assumerole-with-new-mfa-device.html">AWS STS AssumeRole with New MFA Device »</a>
</span>
</div>
</body>
</html>
