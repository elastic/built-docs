<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS IAM Customer-Managed Policy Attached to Role by Rare User | Elastic Security Solution [8.16] | Elastic</title>
<meta class="elastic" name="content" content="AWS IAM Customer-Managed Policy Attached to Role by Rare User | Elastic Security Solution [8.16]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.16]"/>
<link rel="up" href="prebuilt-rule-8-16-1-prebuilt-rules-8-16-1-appendix.html" title="Appendix T: Downloadable rule update v8.16.1"/>
<link rel="prev" href="prebuilt-rule-8-16-1-aws-sts-assumerole-with-new-mfa-device.html" title="AWS STS AssumeRole with New MFA Device"/>
<link rel="next" href="prebuilt-rule-8-16-1-aws-sts-role-assumption-by-user.html" title="AWS STS Role Assumption by User"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.16"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.16"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-16-1-aws-sts-assumerole-with-new-mfa-device.html">« AWS STS AssumeRole with New MFA Device</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-16-1-aws-sts-role-assumption-by-user.html">AWS STS Role Assumption by User »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-16-1-prebuilt-rules-8-16-1-appendix.html">Downloadable rule update v8.16.1</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS IAM Customer-Managed Policy Attached to Role by Rare User</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-1/prebuilt-rule-8-16-1-aws-iam-customer-managed-policy-attached-to-role-by-rare-user.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-16-1-aws-iam-customer-managed-policy-attached-to-role-by-rare-user"></a>AWS IAM Customer-Managed Policy Attached to Role by Rare User</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-1/prebuilt-rule-8-16-1-aws-iam-customer-managed-policy-attached-to-role-by-rare-user.asciidoc">edit</a></div>
</div></div></div>
<p>Detects when an AWS Identity and Access Management (IAM) customer-managed policy is attached to a role by an unusual or unauthorized user. Customer-managed policies are policies created and controlled within an AWS account, granting specific permissions to roles or users when attached. This rule identifies potential privilege escalation by flagging cases where a customer-managed policy is attached to a role by an unexpected actor, which could signal unauthorized access or misuse. Attackers may attach policies to roles to expand permissions and elevate their privileges within the AWS environment. This is a [New Terms](<a href="/guide/en/security/current/rules-ui-create.html#create-new-terms-rule" class="ulink" target="_top">https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule</a>) rule that uses the <code class="literal">aws.cloudtrail.user_identity.arn</code> and <code class="literal">aws.cloudtrail.flattened.request_parameters.roleName</code> fields to check if the combination of the actor ARN and target role name has not been seen in the last 14 days.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.16/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html" class="ulink" target="_top">https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS IAM
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Tactic: Privilege Escalation
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_3891"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-1/prebuilt-rule-8-16-1-aws-iam-customer-managed-policy-attached-to-role-by-rare-user.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and Analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating AWS IAM Customer-Managed Policy Attachment to Role by Unusual User</strong></span></p>
<p>This rule detects when a customer-managed IAM policy is attached to a role by an unusual or unauthorized user. This activity may indicate a potential privilege escalation attempt within the AWS environment. Adversaries could attach policies to roles to expand permissions, thereby increasing their capabilities and achieving elevated access.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the Initiating User and Target Role</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>User Identity</strong></span>: Examine the <code class="literal">aws.cloudtrail.user_identity.arn</code> field to determine the user who initiated the policy attachment. Confirm if this user typically has permissions to modify IAM roles and if their activity is consistent with their usual responsibilities.
</li>
<li class="listitem">
<span class="strong strong"><strong>Target Role</strong></span>: Review <code class="literal">aws.cloudtrail.flattened.request_parameters.roleName</code> to identify the role to which the policy was attached. Assess whether modifying this role is expected for this user or if this action is unusual in your environment.
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze the Attached Policy</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Policy ARN</strong></span>: Inspect the <code class="literal">aws.cloudtrail.flattened.request_parameters.policyArn</code> field to identify the specific customer-managed policy attached to the role. Evaluate if this policy grants sensitive permissions, especially permissions that could enable privileged actions or data access.
</li>
<li class="listitem">
<span class="strong strong"><strong>Policy Permissions</strong></span>: Examine the policy content to determine the scope of permissions granted. Policies enabling actions like <code class="literal">s3:*</code>, <code class="literal">ec2:*</code>, or <code class="literal">iam:*</code> could be leveraged for broader access, persistence, or lateral movement.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review Source and User Agent Details</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Source IP and Location</strong></span>: Analyze the <code class="literal">source.address</code> and <code class="literal">source.geo</code> fields to confirm the IP address and geographic location where the policy attachment originated. Verify if this matches expected locations for the initiating user.
</li>
<li class="listitem">
<span class="strong strong"><strong>User Agent Analysis</strong></span>: Examine <code class="literal">user_agent.original</code> to determine if AWS CLI, SDK, or other tooling was used to perform this action. Tool identifiers like <code class="literal">aws-cli</code> or <code class="literal">boto3</code> may indicate automation, while others may suggest interactive sessions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Evaluate Anomalous Behavior Patterns</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>User’s Historical Activity</strong></span>: Check if the initiating user has a history of attaching policies to roles. An unusual pattern in policy attachments could indicate suspicious behavior, especially if the user lacks authorization.
</li>
<li class="listitem">
<span class="strong strong"><strong>Role Modification History</strong></span>: Investigate if the targeted role is frequently modified by this or other users. Repeated, unauthorized modifications to a role could signal an attempt to maintain elevated access.
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with Related CloudTrail Events</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Other IAM or CloudTrail Activities</strong></span>: Look for recent actions associated with the same user or role by reviewing <code class="literal">event.action</code> by <code class="literal">event.provider</code> to identify which AWS services were accessed. This may provide context on the user’s intent or additional actions taken.
</li>
<li class="listitem">
<span class="strong strong"><strong>Broader Suspicious Patterns</strong></span>: Identify if similar anomalous events have recently occurred, potentially suggesting a coordinated or escalating attack pattern within the AWS account.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Authorized Administrative Actions</strong></span>: IAM administrators may legitimately attach policies to roles as part of routine role management. Verify if the user is authorized and if the activity aligns with expected administrative tasks.
</li>
<li class="listitem">
<span class="strong strong"><strong>Role-Specific Modifications</strong></span>: Roles that frequently undergo policy updates may trigger this rule during standard operations. Consider monitoring for patterns or establishing known exceptions for specific users or roles where appropriate.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Immediate Access Review</strong></span>: If the policy attachment is unauthorized, consider detaching the policy and reviewing the permissions granted to the initiating user.
</li>
<li class="listitem">
<span class="strong strong"><strong>Restrict Role Modification Permissions</strong></span>: Limit which users or roles can attach policies to critical IAM roles. Apply least privilege principles to reduce the risk of unauthorized policy changes.
</li>
<li class="listitem">
<span class="strong strong"><strong>Enhance Monitoring and Alerts</strong></span>: Enable real-time alerts and monitoring on IAM policy modifications to detect similar actions promptly.
</li>
<li class="listitem">
<span class="strong strong"><strong>Regular Policy Audits</strong></span>: Conduct periodic audits of IAM policies and role permissions to ensure that unauthorized changes are quickly identified and addressed.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Information</strong></span></p>
<p>For more information on managing IAM policies and roles in AWS environments, refer to the <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html" class="ulink" target="_top">AWS IAM Documentation</a> and AWS security best practices.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_4783"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-1/prebuilt-rule-8-16-1-aws-iam-customer-managed-policy-attached-to-role-by-rare-user.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "aws.cloudtrail"
    and event.provider: "iam.amazonaws.com"
    and event.action: "AttachRolePolicy"
    and event.outcome: "success"
    and not aws.cloudtrail.flattened.request_parameters.policyArn: arn\:aws\:iam\:\:aws\:policy*</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Abuse Elevation Control Mechanism
</li>
<li class="listitem">
ID: T1548
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1548/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1548/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Temporary Elevated Cloud Access
</li>
<li class="listitem">
ID: T1548.005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1548/005/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1548/005/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-16-1-aws-sts-assumerole-with-new-mfa-device.html">« AWS STS AssumeRole with New MFA Device</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-16-1-aws-sts-role-assumption-by-user.html">AWS STS Role Assumption by User »</a>
</span>
</div>
</body>
</html>
