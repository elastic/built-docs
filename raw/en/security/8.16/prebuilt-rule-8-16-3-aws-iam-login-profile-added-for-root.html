<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS IAM Login Profile Added for Root | Elastic Security Solution [8.16] | Elastic</title>
<meta class="elastic" name="content" content="AWS IAM Login Profile Added for Root | Elastic Security Solution [8.16]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.16]"/>
<link rel="up" href="prebuilt-rule-8-16-3-prebuilt-rules-8-16-3-appendix.html" title="Appendix V: Downloadable rule update v8.16.3"/>
<link rel="prev" href="prebuilt-rule-8-16-3-prebuilt-rules-8-16-3-appendix.html" title="Appendix V: Downloadable rule update v8.16.3"/>
<link rel="next" href="prebuilt-rule-8-16-3-aws-bedrock-invocations-without-guardrails-detected-by-a-single-user-over-a-session.html" title="AWS Bedrock Invocations without Guardrails Detected by a Single User Over a Session"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.16"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.16"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-16-3-prebuilt-rules-8-16-3-appendix.html">« Appendix V: Downloadable rule update v8.16.3</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-16-3-aws-bedrock-invocations-without-guardrails-detected-by-a-single-user-over-a-session.html">AWS Bedrock Invocations without Guardrails Detected by a Single User Over a Session »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-16-3-prebuilt-rules-8-16-3-appendix.html">Downloadable rule update v8.16.3</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS IAM Login Profile Added for Root</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-3/prebuilt-rule-8-16-3-aws-iam-login-profile-added-for-root.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-16-3-aws-iam-login-profile-added-for-root"></a>AWS IAM Login Profile Added for Root</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-3/prebuilt-rule-8-16-3-aws-iam-login-profile-added-for-root.asciidoc">edit</a></div>
</div></div></div>
<p>Detects when an AWS IAM login profile is added to a root user account and is self-assigned. Adversaries, with temporary access to the root account, may add a login profile to the root user account to maintain access even if the original access key is rotated or disabled.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: esql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>: None</p>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.16/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>: None</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS IAM
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Tactic: Persistence
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_3334"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-3/prebuilt-rule-8-16-3-aws-iam-login-profile-added-for-root.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Investigating AWS IAM Login Profile Added for Root</strong></span></p>
<p>This rule detects when a login profile is added to the AWS root account. Adding a login profile to the root account, especially if self-assigned, is highly suspicious as it might indicate an adversary trying to establish persistence in the environment.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the Source and Context of the Action</strong></span>:
</li>
<li class="listitem">
Examine the <code class="literal">source.address</code> field to identify the IP address from which the request originated.
</li>
<li class="listitem">
Check the geographic location (<code class="literal">source.address</code>) to determine if the access is from an expected or unexpected region.
</li>
<li class="listitem">
Look at the <code class="literal">user_agent.original</code> field to identify the tool or browser used for this action.
</li>
<li class="listitem">
For example, a user agent like <code class="literal">Mozilla/5.0</code> might indicate interactive access, whereas <code class="literal">aws-cli</code> or SDKs suggest scripted activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Confirm Root User and Request Details</strong></span>:
</li>
<li class="listitem">
Validate the root user&#8217;s identity through <code class="literal">aws.cloudtrail.user_identity.arn</code> and ensure this activity aligns with legitimate administrative actions.
</li>
<li class="listitem">
Review <code class="literal">aws.cloudtrail.user_identity.access_key_id</code> to identify if the action was performed using temporary or permanent credentials. This access key could be used to pivot into other actions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze the Login Profile Creation</strong></span>:
</li>
<li class="listitem">
Review the <code class="literal">aws.cloudtrail.request_parameters</code> and <code class="literal">aws.cloudtrail.response_elements</code> fields for details of the created login profile.
</li>
<li class="listitem">
For example, confirm the <code class="literal">userName</code> of the profile and whether <code class="literal">passwordResetRequired</code> is set to <code class="literal">true</code>.
</li>
<li class="listitem">
Compare the <code class="literal">@timestamp</code> of this event with other recent actions by the root account to identify potential privilege escalation or abuse.
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with Other Events</strong></span>:
</li>
<li class="listitem">
Investigate for related IAM activities, such as:
</li>
<li class="listitem">
<code class="literal">CreateAccessKey</code> or <code class="literal">AttachUserPolicy</code> events targeting the root account.
</li>
<li class="listitem">
Unusual data access, privilege escalation, or management console logins.
</li>
<li class="listitem">
Check for any anomalies involving the same <code class="literal">source.address</code> or <code class="literal">aws.cloudtrail.user_identity.access_key_id</code> in the environment.
</li>
<li class="listitem">
<span class="strong strong"><strong>Evaluate Policy and Permissions</strong></span>:
</li>
<li class="listitem">
Verify the current security policies for the root account:
</li>
<li class="listitem">
Ensure password policies enforce complexity and rotation requirements.
</li>
<li class="listitem">
Check if MFA is enforced on the root account.
</li>
<li class="listitem">
Assess the broader IAM configuration for deviations from least privilege principles.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Routine Administrative Tasks</strong></span>: Adding a login profile might be a legitimate action during certain administrative processes. Verify with the relevant AWS administrators if this event aligns with routine account maintenance or emergency recovery scenarios.
</li>
<li class="listitem">
<span class="strong strong"><strong>Automation</strong></span>: If the action is part of an approved automation process (e.g., account recovery workflows), consider excluding these activities from alerting using specific user agents, IP addresses, or session attributes.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Immediate Access Review</strong></span>:
</li>
<li class="listitem">
Disable the newly created login profile (<code class="literal">aws iam delete-login-profile</code>) if it is determined to be unauthorized.
</li>
<li class="listitem">
Rotate or disable the credentials associated with the root account to prevent further abuse.
</li>
<li class="listitem">
<span class="strong strong"><strong>Enhance Monitoring and Alerts</strong></span>:
</li>
<li class="listitem">
Enable real-time monitoring and alerting for IAM actions involving the root account.
</li>
<li class="listitem">
Increase the logging verbosity for root account activities.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review and Update Security Policies</strong></span>:
</li>
<li class="listitem">
Enforce MFA for all administrative actions, including root account usage.
</li>
<li class="listitem">
Restrict programmatic access to the root account by disabling access keys unless absolutely necessary.
</li>
<li class="listitem">
<span class="strong strong"><strong>Conduct Post-Incident Analysis</strong></span>:
</li>
<li class="listitem">
Investigate how the credentials for the root account were compromised or misused.
</li>
<li class="listitem">
Strengthen the security posture by implementing account-specific guardrails and continuous monitoring.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Resources</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
AWS documentation on <a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateLoginProfile.html" class="ulink" target="_top">Login Profile Management</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_4882"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-3/prebuilt-rule-8-16-3-aws-iam-login-profile-added-for-root.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">from logs-aws.cloudtrail* metadata _id, _version, _index
| where
    // filter for CloudTrail logs from IAM
    event.dataset == "aws.cloudtrail"
    and event.provider == "iam.amazonaws.com"

    // filter for successful CreateLoginProfile API call
    and event.action == "CreateLoginProfile"
    and event.outcome == "success"

    // filter for Root member account
    and aws.cloudtrail.user_identity.type == "Root"

    // filter for an access key existing which sources from AssumeRoot
    and aws.cloudtrail.user_identity.access_key_id IS NOT NULL

    // filter on the request parameters not including UserName which assumes self-assignment
    and NOT TO_LOWER(aws.cloudtrail.request_parameters) LIKE "*username*"
| keep
    @timestamp,
    aws.cloudtrail.request_parameters,
    aws.cloudtrail.response_elements,
    aws.cloudtrail.user_identity.type,
    aws.cloudtrail.user_identity.arn,
    aws.cloudtrail.user_identity.access_key_id,
    cloud.account.id,
    event.action,
    source.address</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Cloud Accounts
</li>
<li class="listitem">
ID: T1078.004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/004/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Manipulation
</li>
<li class="listitem">
ID: T1098
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-16-3-prebuilt-rules-8-16-3-appendix.html">« Appendix V: Downloadable rule update v8.16.3</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-16-3-aws-bedrock-invocations-without-guardrails-detected-by-a-single-user-over-a-session.html">AWS Bedrock Invocations without Guardrails Detected by a Single User Over a Session »</a>
</span>
</div>
</body>
</html>
