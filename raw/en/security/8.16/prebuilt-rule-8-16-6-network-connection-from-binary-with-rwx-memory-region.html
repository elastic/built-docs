<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Network Connection from Binary with RWX Memory Region | Elastic Security Solution [8.16] | Elastic</title>
<meta class="elastic" name="content" content="Network Connection from Binary with RWX Memory Region | Elastic Security Solution [8.16]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.16]"/>
<link rel="up" href="prebuilt-rule-8-16-6-prebuilt-rules-8-16-6-appendix.html" title="Appendix Y: Downloadable rule update v8.16.6"/>
<link rel="prev" href="prebuilt-rule-8-16-6-netcat-listener-established-via-rlwrap.html" title="Netcat Listener Established via rlwrap"/>
<link rel="next" href="prebuilt-rule-8-16-6-network-connection-via-recently-compiled-executable.html" title="Network Connection via Recently Compiled Executable"/>
<meta class="elastic" name="product_version" content="8.16"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.16"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.16"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-16-6-netcat-listener-established-via-rlwrap.html">« Netcat Listener Established via rlwrap</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-16-6-network-connection-via-recently-compiled-executable.html">Network Connection via Recently Compiled Executable »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.16]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-16-6-prebuilt-rules-8-16-6-appendix.html">Downloadable rule update v8.16.6</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Network Connection from Binary with RWX Memory Region</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-6/prebuilt-rule-8-16-6-network-connection-from-binary-with-rwx-memory-region.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-16-6-network-connection-from-binary-with-rwx-memory-region"></a>Network Connection from Binary with RWX Memory Region</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-6/prebuilt-rule-8-16-6-network-connection-from-binary-with-rwx-memory-region.asciidoc">edit</a></div>
</div></div></div>
<p>Monitors for the execution of a unix binary with read, write and execute memory region permissions, followed by a network connection. The mprotect() system call is used to change the access protections on a region of memory that has already been allocated. This syscall allows a process to modify the permissions of pages in its virtual address space, enabling or disabling permissions such as read, write, and execute for those pages. RWX permissions on memory is in many cases overly permissive, and should (especially in conjunction with an outbound network connection) be analyzed thoroughly.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
logs-endpoint.events.*
</li>
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
logs-auditd_manager.auditd-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.16/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://man7.org/linux/man-pages/man2/mprotect.2.html" class="ulink" target="_top">https://man7.org/linux/man-pages/man2/mprotect.2.html</a>
</li>
<li class="listitem">
<a href="/security-labs/linux-detection-engineering-with-auditd" class="ulink" target="_top">https://www.elastic.co/security-labs/linux-detection-engineering-with-auditd</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Endpoint
</li>
<li class="listitem">
OS: Linux
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Execution
</li>
<li class="listitem">
Data Source: Elastic Defend
</li>
<li class="listitem">
Data Source: Auditd Manager
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_4500"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-6/prebuilt-rule-8-16-6-network-connection-from-binary-with-rwx-memory-region.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating Network Connection from Binary with RWX Memory Region</strong></span></p>
<p>In Linux environments, the <code class="literal">mprotect()</code> system call adjusts memory permissions, potentially enabling read, write, and execute (RWX) access. Adversaries exploit this to execute malicious code in memory, often followed by network connections to exfiltrate data or communicate with command-and-control servers. The detection rule identifies such behavior by monitoring for RWX memory changes and subsequent network activity, flagging suspicious processes for further analysis.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the process details using the process.pid and process.name fields to identify the binary that requested RWX memory permissions.
</li>
<li class="listitem">
Investigate the context of the mprotect() syscall by examining the process&#8217;s command line arguments and parent process to understand its origin and purpose.
</li>
<li class="listitem">
Analyze the network connection details, focusing on the destination.ip field, to determine if the connection was made to a known malicious IP or an unusual external server.
</li>
<li class="listitem">
Check the process&#8217;s execution history and any associated files or scripts to identify potential malicious payloads or scripts that may have been executed.
</li>
<li class="listitem">
Correlate the event with other security logs or alerts from the same host.id to identify any related suspicious activities or patterns.
</li>
<li class="listitem">
Assess the risk and impact by determining if any sensitive data was accessed or exfiltrated during the network connection attempt.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Legitimate software updates or patches may temporarily use RWX memory regions. Monitor the specific process names and verify if they are associated with known update mechanisms. Consider adding these processes to an exception list if they are verified as safe.
</li>
<li class="listitem">
Development tools and environments often require RWX permissions for debugging or testing purposes. Identify these tools and exclude them from the rule if they are part of a controlled and secure development environment.
</li>
<li class="listitem">
Certain system services or daemons, like custom web servers or network services, might use RWX memory regions for legitimate reasons. Review the process names and network destinations to determine if they are part of expected system behavior, and exclude them if confirmed.
</li>
<li class="listitem">
Security software or monitoring tools may exhibit this behavior as part of their normal operation. Validate these processes and consider excluding them if they are recognized as part of your security infrastructure.
</li>
<li class="listitem">
Custom scripts or automation tasks that require dynamic code execution might trigger this rule. Ensure these scripts are reviewed and approved, then exclude them if they are deemed non-threatening.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Isolate the affected host from the network immediately to prevent further data exfiltration or communication with potential command-and-control servers.
</li>
<li class="listitem">
Terminate the suspicious process identified by the detection rule to halt any ongoing malicious activity.
</li>
<li class="listitem">
Conduct a memory dump of the affected system to capture the current state for forensic analysis, focusing on the RWX memory regions.
</li>
<li class="listitem">
Review and analyze the network logs to identify any external IP addresses or domains the process attempted to connect to, and block these on the network firewall.
</li>
<li class="listitem">
Patch and update the affected system to the latest security updates to mitigate any known vulnerabilities that could have been exploited.
</li>
<li class="listitem">
Implement stricter memory protection policies to prevent processes from obtaining RWX permissions unless absolutely necessary.
</li>
<li class="listitem">
Escalate the incident to the security operations center (SOC) for further investigation and to determine if this is part of a larger attack campaign.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_1280"></a>Setup</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-6/prebuilt-rule-8-16-6-network-connection-from-binary-with-rwx-memory-region.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Setup</strong></span></p>
<p>This rule requires the use of the <code class="literal">auditd_manager</code> integration. <code class="literal">Auditd_manager</code> is a tool designed to simplify and enhance the management of the audit subsystem in Linux systems. It provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With <code class="literal">auditd_manager</code>, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system. The following steps should be executed in order to install and deploy <code class="literal">auditd_manager</code> on a Linux system.</p>
<pre class="screen">Kibana --&gt;
Management --&gt;
Integrations --&gt;
Auditd Manager --&gt;
Add Auditd Manager</pre>
<p><code class="literal">Auditd_manager</code> subscribes to the kernel and receives events as they occur without any additional configuration. However, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the "audit rules" configuration box or the "auditd rule files" box by specifying a file to read the audit rules from.
For this detection rule to trigger, the following additional audit rules are required to be added to the integration:</p>
<pre class="screen">-a always,exit -F arch=b64 -S mprotect</pre>
<p>Add the newly installed <code class="literal">auditd manager</code> to an agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_5544"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.16/docs/detections/prebuilt-rules/downloadable-packages/8-16-6/prebuilt-rule-8-16-6-network-connection-from-binary-with-rwx-memory-region.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">sample by host.id, process.pid, process.name
  /* auditd.data.a2 == "7" translates to RWX memory region protection (PROT_READ | PROT_WRITE | PROT_EXEC) */
  [process where host.os.type == "linux" and auditd.data.syscall == "mprotect" and auditd.data.a2 == "7" and
   not process.name == "httpd"]
  [network where host.os.type == "linux" and event.type == "start" and event.action == "connection_attempted" and
   not cidrmatch(destination.ip, "127.0.0.0/8", "169.254.0.0/16", "224.0.0.0/4", "::1")]</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Execution
</li>
<li class="listitem">
ID: TA0002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0002/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0002/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Scripting Interpreter
</li>
<li class="listitem">
ID: T1059
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1059/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1059/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Unix Shell
</li>
<li class="listitem">
ID: T1059.004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1059/004/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1059/004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Command and Control
</li>
<li class="listitem">
ID: TA0011
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0011/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0011/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Application Layer Protocol
</li>
<li class="listitem">
ID: T1071
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1071/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1071/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-16-6-netcat-listener-established-via-rlwrap.html">« Netcat Listener Established via rlwrap</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-16-6-network-connection-via-recently-compiled-executable.html">Network Connection via Recently Compiled Executable »</a>
</span>
</div>
</body>
</html>
