<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Microsoft Entra ID Conditional Access Policy (CAP) Modified | Elastic Security Solution [8.17] | Elastic</title>
<meta class="elastic" name="content" content="Microsoft Entra ID Conditional Access Policy (CAP) Modified | Elastic Security Solution [8.17]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.17]"/>
<link rel="up" href="prebuilt-rule-8-17-8-prebuilt-rules-8-17-8-appendix.html" title="Appendix [: Downloadable rule update v8.17.8"/>
<link rel="prev" href="prebuilt-rule-8-17-8-microsoft-entra-id-illicit-consent-grant-via-registered-application.html" title="Microsoft Entra ID Illicit Consent Grant via Registered Application"/>
<link rel="next" href="prebuilt-rule-8-17-8-potential-denial-of-azure-openai-ml-service.html" title="Potential Denial of Azure OpenAI ML Service"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.17"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.17"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-17-8-microsoft-entra-id-illicit-consent-grant-via-registered-application.html">« Microsoft Entra ID Illicit Consent Grant via Registered Application</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-17-8-potential-denial-of-azure-openai-ml-service.html">Potential Denial of Azure OpenAI ML Service »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-17-8-prebuilt-rules-8-17-8-appendix.html">Downloadable rule update v8.17.8</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Microsoft Entra ID Conditional Access Policy (CAP) Modified</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/downloadable-packages/8-17-8/prebuilt-rule-8-17-8-microsoft-entra-id-conditional-access-policy-cap-modified.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-17-8-microsoft-entra-id-conditional-access-policy-cap-modified"></a>Microsoft Entra ID Conditional Access Policy (CAP) Modified</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/downloadable-packages/8-17-8/prebuilt-rule-8-17-8-microsoft-entra-id-conditional-access-policy-cap-modified.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies a modification to a conditional access policy (CAP) in Microsoft Entra ID. Adversaries may modify existing CAPs to loosen access controls and maintain persistence in the environment with a compromised identity or entity.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.17/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/overview</a>
</li>
<li class="listitem">
<a href="https://www.rezonate.io/blog/microsoft-entra-id-the-complete-guide-to-conditional-access-policies/" class="ulink" target="_top">https://www.rezonate.io/blog/microsoft-entra-id-the-complete-guide-to-conditional-access-policies/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: Azure
</li>
<li class="listitem">
Data Source: Microsoft Entra ID
</li>
<li class="listitem">
Data Source: Microsoft Entra ID Audit Logs
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Use Case: Configuration Audit
</li>
<li class="listitem">
Tactic: Persistence
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 106</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_5445"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/downloadable-packages/8-17-8/prebuilt-rule-8-17-8-microsoft-entra-id-conditional-access-policy-cap-modified.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigation Guide: Microsoft Entra ID Conditional Access Policy (CAP) Modified</strong></span></p>
<p>Azure Conditional Access Policies (CAPs) are critical for enforcing secure access requirements such as multi-factor authentication (MFA), restricting specific users or groups, and managing sign-in conditions. Modifying these policies can be a technique for weakening an organization’s defenses and maintaining persistence after initial access.</p>
<p>This rule detects a successful update to a Conditional Access Policy in Microsoft Entra ID (formerly Azure AD).</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the user who modified the policy:</strong></span>
</li>
<li class="listitem">
Check the value of <code class="literal">azure.auditlogs.properties.initiated_by.user.userPrincipalName</code> to determine the identity that made the change.
</li>
<li class="listitem">
Investigate their recent activity to determine if this change was expected or authorized.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review the modified policy name:</strong></span>
</li>
<li class="listitem">
Look at <code class="literal">azure.auditlogs.properties.target_resources.*.display_name</code> to find the name of the affected policy.
</li>
<li class="listitem">
Determine whether this policy is related to critical controls (e.g., requiring MFA for admins).
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze the policy change:</strong></span>
</li>
<li class="listitem">
Compare the <code class="literal">old_value</code> and <code class="literal">new_value</code> fields under <code class="literal">azure.auditlogs.properties.target_resources.*.modified_properties.*</code>.
</li>
<li class="listitem">
Look for security-reducing changes, such as:
</li>
<li class="listitem">
Removing users/groups from enforcement.
</li>
<li class="listitem">
Disabling MFA or risk-based conditions.
</li>
<li class="listitem">
Introducing exclusions that reduce the policy’s coverage.
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with other activity:</strong></span>
</li>
<li class="listitem">
Pivot on <code class="literal">azure.auditlogs.properties.activity_datetime</code> to identify if any suspicious sign-ins occurred after the policy was modified.
</li>
<li class="listitem">
Check for related authentication logs, particularly from the same IP address (<code class="literal">azure.auditlogs.properties.initiated_by.user.ipAddress</code>).
</li>
<li class="listitem">
<span class="strong strong"><strong>Assess the user&#8217;s legitimacy:</strong></span>
</li>
<li class="listitem">
Review the initiator’s Azure role, group memberships, and whether their account was recently elevated or compromised.
</li>
<li class="listitem">
Investigate whether this user has a history of modifying policies or if this is anomalous.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Validation &amp; False Positive Considerations</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Authorized administrative changes:</strong></span> Some organizations routinely update CAPs as part of policy tuning or role-based access reviews.
</li>
<li class="listitem">
<span class="strong strong"><strong>Security reviews or automation:</strong></span> Scripts, CI/CD processes, or third-party compliance tools may programmatically update CAPs.
</li>
<li class="listitem">
<span class="strong strong"><strong>Employee lifecycle events:</strong></span> Policy changes during employee onboarding/offboarding may include updates to access policies.
</li>
</ul>
</div>
<p>If any of these cases apply and align with the activity&#8217;s context, consider tuning the rule or adding exceptions for expected patterns.</p>
<p><span class="strong strong"><strong>Response &amp; Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Revert unauthorized or insecure changes to the Conditional Access Policy immediately.
</li>
<li class="listitem">
Temporarily increase monitoring of CAP modifications and sign-in attempts.
</li>
<li class="listitem">
Lock or reset the credentials of the user account that made the change if compromise is suspected.
</li>
<li class="listitem">
Conduct a broader access review of conditional access policies and privileged user activity.
</li>
<li class="listitem">
Implement stricter change management and alerting around CAP changes.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_6420"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/downloadable-packages/8-17-8/prebuilt-rule-8-17-8-microsoft-entra-id-conditional-access-policy-cap-modified.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "azure.auditlogs"
    and event.action:"Update conditional access policy"
    and event.outcome: "success"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Modify Authentication Process
</li>
<li class="listitem">
ID: T1556
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1556/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1556/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Conditional Access Policies
</li>
<li class="listitem">
ID: T1556.009
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1556/009/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1556/009/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-17-8-microsoft-entra-id-illicit-consent-grant-via-registered-application.html">« Microsoft Entra ID Illicit Consent Grant via Registered Application</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-17-8-potential-denial-of-azure-openai-ml-service.html">Potential Denial of Azure OpenAI ML Service »</a>
</span>
</div>
</body>
</html>
