<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Azure Entra ID Rare App ID for Principal Authentication | Elastic Security [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Azure Entra ID Rare App ID for Principal Authentication | Elastic Security [8.18]">

<link rel="home" href="index.html" title="Elastic Security [8.18]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="azure-diagnostic-settings-deletion.html" title="Azure Diagnostic Settings Deletion"/>
<link rel="next" href="azure-entra-mfa-totp-brute-force-attempts.html" title="Azure Entra MFA TOTP Brute Force Attempts"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.18"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.18"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="azure-diagnostic-settings-deletion.html">« Azure Diagnostic Settings Deletion</a>
</span>
<span class="next">
<a href="azure-entra-mfa-totp-brute-force-attempts.html">Azure Entra MFA TOTP Brute Force Attempts »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Azure Entra ID Rare App ID for Principal Authentication</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/rule-details/azure-entra-id-rare-app-id-for-principal-authentication.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    A newer version is available. Check out the <a href="https://www.elastic.co/docs/reference/security/prebuilt-rules/rules/integrations/azure/initial_access_entra_rare_app_id_for_principal_auth">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="azure-entra-id-rare-app-id-for-principal-authentication"></a>Azure Entra ID Rare App ID for Principal Authentication</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/rule-details/azure-entra-id-rare-app-id-for-principal-authentication.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies rare Azure Entra ID apps IDs requesting authentication on-behalf-of a principal user. An adversary with stolen credentials may specify an Azure-managed app ID to authenticate on-behalf-of a user. This is a rare event and may indicate an attempt to bypass conditional access policies (CAP) and multi-factor authentication (MFA) requirements. The app ID specified may not be commonly used by the user based on their historical sign-in activity.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-azure*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.18/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://securityscorecard.com/wp-content/uploads/2025/02/MassiveBotnet-Report_022125_03.pdf" class="ulink" target="_top">https://securityscorecard.com/wp-content/uploads/2025/02/MassiveBotnet-Report_022125_03.pdf</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: Azure
</li>
<li class="listitem">
Data Source: Entra ID
</li>
<li class="listitem">
Data Source: Entra ID Sign-in
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Initial Access
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_192"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/rule-details/azure-entra-id-rare-app-id-for-principal-authentication.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating Azure Entra ID Rare App ID for Principal Authentication</strong></span></p>
<p>This rule identifies rare Azure Entra apps IDs requesting authentication on-behalf-of a principal user. An adversary with stolen credentials may specify an Azure-managed app ID to authenticate on-behalf-of a user. This is a rare event and may indicate an attempt to bypass conditional access policies (CAP) and multi-factor authentication (MFA) requirements. The app ID specified may not be commonly used by the user based on their historical sign-in activity.</p>
<p><span class="strong strong"><strong>This is a New Terms rule that focuses on first occurrence of the client <code class="literal">azure.signinlogs.properties.app_id</code> requesting authentication on-behalf-of the principal user <code class="literal">azure.signinlogs.properties.user_principal_name</code> in the last 14-days.</strong></span></p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Identify the source IP address from which the failed login attempts originated by reviewing <code class="literal">source.ip</code>. Determine if the IP is associated with known malicious activity using threat intelligence sources or if it belongs to a corporate VPN, proxy, or automation process.
</li>
<li class="listitem">
Analyze affected user accounts by reviewing <code class="literal">azure.signinlogs.properties.user_principal_name</code> to determine if they belong to privileged roles or high-value users. Look for patterns indicating multiple failed attempts across different users, which could suggest a password spraying attempt.
</li>
<li class="listitem">
Examine the authentication method used in <code class="literal">azure.signinlogs.properties.authentication_details</code> to identify which authentication protocols were attempted and why they failed. Legacy authentication methods may be more susceptible to brute-force attacks.
</li>
<li class="listitem">
Review the authentication error codes found in <code class="literal">azure.signinlogs.properties.status.error_code</code> to understand why the login attempts failed. Common errors include <code class="literal">50126</code> for invalid credentials, <code class="literal">50053</code> for account lockouts, <code class="literal">50055</code> for expired passwords, and <code class="literal">50056</code> for users without a password.
</li>
<li class="listitem">
Correlate failed logins with other sign-in activity by looking at <code class="literal">event.outcome</code>. Identify if there were any successful logins from the same user shortly after multiple failures or if there are different geolocations or device fingerprints associated with the same account.
</li>
<li class="listitem">
Review <code class="literal">azure.signinlogs.properties.app_id</code> to identify which applications were initiating the authentication attempts. Determine if these applications are Microsoft-owned, third-party, or custom applications and if they are authorized to access the resources.
</li>
<li class="listitem">
Check for any conditional access policies that may have been triggered by the failed login attempts by reviewing <code class="literal">azure.signinlogs.properties.authentication_requirement</code>. This can help identify if the failed attempts were due to policy enforcement or misconfiguration.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<p><span class="strong strong"><strong>Common benign scenarios</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Automated scripts or applications using non-interactive authentication may trigger this detection, particularly if they rely on legacy authentication protocols recorded in <code class="literal">azure.signinlogs.properties.authentication_protocol</code>.
</li>
<li class="listitem">
Corporate proxies or VPNs may cause multiple users to authenticate from the same IP, appearing as repeated failed attempts under <code class="literal">source.ip</code>.
</li>
<li class="listitem">
User account lockouts from forgotten passwords or misconfigured applications may show multiple authentication failures in <code class="literal">azure.signinlogs.properties.status.error_code</code>.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>How to reduce false positives</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Exclude known trusted IPs, such as corporate infrastructure, from alerts by filtering <code class="literal">source.ip</code>.
</li>
<li class="listitem">
Exlcude known custom applications from <code class="literal">azure.signinlogs.properties.app_id</code> that are authorized to use non-interactive authentication.
</li>
<li class="listitem">
Ignore principals with a history of failed logins due to legitimate reasons, such as expired passwords or account lockouts, by filtering <code class="literal">azure.signinlogs.properties.user_principal_name</code>.
</li>
<li class="listitem">
Correlate sign-in failures with password reset events or normal user behavior before triggering an alert.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<p><span class="strong strong"><strong>Immediate actions</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Block the source IP address in <code class="literal">source.ip</code> if determined to be malicious.
</li>
<li class="listitem">
Reset passwords for all affected user accounts listed in <code class="literal">azure.signinlogs.properties.user_principal_name</code> and enforce stronger password policies.
</li>
<li class="listitem">
Ensure basic authentication is disabled for all applications using legacy authentication protocols listed in <code class="literal">azure.signinlogs.properties.authentication_protocol</code>.
</li>
<li class="listitem">
Enable multi-factor authentication (MFA) for impacted accounts to mitigate credential-based attacks.
</li>
<li class="listitem">
Review conditional access policies to ensure they are correctly configured to block unauthorized access attempts recorded in <code class="literal">azure.signinlogs.properties.authentication_requirement</code>.
</li>
<li class="listitem">
Review Conditional Access policies to enforce risk-based authentication and block unauthorized access attempts recorded in <code class="literal">azure.signinlogs.properties.authentication_requirement</code>.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Long-term mitigation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Implement a zero-trust security model by enforcing least privilege access and continuous authentication.
</li>
<li class="listitem">
Regularly review and update conditional access policies to ensure they are effective against evolving threats.
</li>
<li class="listitem">
Restrict the use of legacy authentication protocols by disabling authentication methods listed in <code class="literal">azure.signinlogs.properties.client_app_used</code>.
</li>
<li class="listitem">
Regularly audit authentication logs in <code class="literal">azure.signinlogs</code> to detect abnormal login behavior and ensure early detection of potential attacks.
</li>
<li class="listitem">
Regularly rotate client credentials and secrets for applications using non-interactive authentication to reduce the risk of credential theft.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_197"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/rule-details/azure-entra-id-rare-app-id-for-principal-authentication.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "azure.signinlogs" and event.category: "authentication"
    and azure.signinlogs.properties.is_interactive: false
    and azure.signinlogs.properties.user_type: "Member"
    and not azure.signinlogs.properties.client_app_used: "Browser"
    and not source.as.organization.name: "MICROSOFT-CORP-MSN-AS-BLOCK"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Cloud Accounts
</li>
<li class="listitem">
ID: T1078.004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/004/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/004/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="azure-diagnostic-settings-deletion.html">« Azure Diagnostic Settings Deletion</a>
</span>
<span class="next">
<a href="azure-entra-mfa-totp-brute-force-attempts.html">Azure Entra MFA TOTP Brute Force Attempts »</a>
</span>
</div>
</body>
</html>
