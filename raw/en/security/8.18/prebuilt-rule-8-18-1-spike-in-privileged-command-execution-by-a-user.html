<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Spike in Privileged Command Execution by a User | Elastic Security Solution [8.18] | Elastic</title>
<meta class="elastic" name="content" content="Spike in Privileged Command Execution by a User | Elastic Security Solution [8.18]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.18]"/>
<link rel="up" href="prebuilt-rule-8-18-1-prebuilt-rules-8-18-1-appendix.html" title="Appendix T: Downloadable rule update v8.18.1"/>
<link rel="prev" href="prebuilt-rule-8-18-1-microsoft-365-illicit-consent-grant-via-registered-application.html" title="Microsoft 365 Illicit Consent Grant via Registered Application"/>
<link rel="next" href="prebuilt-rule-8-18-1-high-command-line-entropy-detected-for-privileged-commands.html" title="High Command Line Entropy Detected for Privileged Commands"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.18"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.18"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-18-1-microsoft-365-illicit-consent-grant-via-registered-application.html">« Microsoft 365 Illicit Consent Grant via Registered Application</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-18-1-high-command-line-entropy-detected-for-privileged-commands.html">High Command Line Entropy Detected for Privileged Commands »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-18-1-prebuilt-rules-8-18-1-appendix.html">Downloadable rule update v8.18.1</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Spike in Privileged Command Execution by a User</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/downloadable-packages/8-18-1/prebuilt-rule-8-18-1-spike-in-privileged-command-execution-by-a-user.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    A newer version is available. Check out the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-18-1-spike-in-privileged-command-execution-by-a-user"></a>Spike in Privileged Command Execution by a User</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/downloadable-packages/8-18-1/prebuilt-rule-8-18-1-spike-in-privileged-command-execution-by-a-user.asciidoc">edit</a></div>
</div></div></div>
<p>A machine learning job has detected an increase in the execution of privileged commands by a user, suggesting potential privileged access activity. This may indicate an attempt by the user to gain unauthorized access to sensitive or restricted parts of the system.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: machine_learning</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>: None</p>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 15m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-3h (<a href="/guide/en/elasticsearch/reference/8.18/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/security/current/prebuilt-ml-jobs.html" class="ulink" target="_top">https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html</a>
</li>
<li class="listitem">
<a href="https://docs.elastic.co/en/integrations/pad" class="ulink" target="_top">https://docs.elastic.co/en/integrations/pad</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use Case: Privileged Access Detection
</li>
<li class="listitem">
Rule Type: ML
</li>
<li class="listitem">
Rule Type: Machine Learning
</li>
<li class="listitem">
Tactic: Privilege Escalation
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_3968"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/downloadable-packages/8-18-1/prebuilt-rule-8-18-1-spike-in-privileged-command-execution-by-a-user.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating Spike in Privileged Command Execution by a User</strong></span></p>
<p>Machine learning models are employed to monitor and analyze user behavior, specifically focusing on the execution of privileged commands. These models identify anomalies that may suggest unauthorized access attempts. Adversaries often exploit valid accounts to escalate privileges and access sensitive systems. The detection rule leverages ML to flag unusual spikes in command execution, indicating potential misuse of privileged access.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the specific user account associated with the spike in privileged command execution to determine if the activity aligns with their typical behavior or job role.
</li>
<li class="listitem">
Analyze the timeline of the command execution spike to identify any patterns or specific times when the activity occurred, which may correlate with known maintenance windows or unusual access times.
</li>
<li class="listitem">
Cross-reference the commands executed with known privileged command lists to assess whether the commands are typical for the user&#8217;s role or indicative of potential misuse.
</li>
<li class="listitem">
Check for any recent changes in the user&#8217;s access rights or group memberships that might explain the increase in privileged command execution.
</li>
<li class="listitem">
Investigate any recent login activity for the user, including source IP addresses and devices, to identify any anomalies or unauthorized access attempts.
</li>
<li class="listitem">
Review any associated alerts or logs for the same user or system around the time of the spike to gather additional context or corroborating evidence of potential unauthorized access.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Routine administrative tasks by IT staff may trigger the rule. To manage this, create exceptions for known maintenance windows or specific user accounts that regularly perform these tasks.
</li>
<li class="listitem">
Automated scripts or scheduled jobs that execute privileged commands can be mistaken for anomalies. Identify and whitelist these scripts or jobs to prevent false alerts.
</li>
<li class="listitem">
Users with newly assigned roles that require elevated privileges might cause a temporary spike in command execution. Monitor these users initially and adjust the model&#8217;s sensitivity or add exceptions as needed.
</li>
<li class="listitem">
Software updates or installations that require elevated permissions can lead to false positives. Document these events and exclude them from the anomaly detection criteria.
</li>
<li class="listitem">
Training or onboarding sessions where users are learning to use new systems with privileged access can result in increased command execution. Temporarily adjust thresholds or exclude these users during the training period.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately isolate the affected user account to prevent further execution of privileged commands. This can be done by disabling the account or changing its password.
</li>
<li class="listitem">
Review recent privileged command execution logs to identify any unauthorized or suspicious activities performed by the user. Focus on commands that could alter system configurations or access sensitive data.
</li>
<li class="listitem">
Conduct a thorough investigation to determine if the user&#8217;s credentials have been compromised. This may involve checking for signs of phishing attacks or unauthorized access from unusual locations or devices.
</li>
<li class="listitem">
If unauthorized access is confirmed, reset the affected user&#8217;s credentials and any other accounts that may have been accessed using the compromised credentials.
</li>
<li class="listitem">
Notify the security team and relevant stakeholders about the incident, providing details of the detected anomaly and actions taken so far.
</li>
<li class="listitem">
Implement additional monitoring on the affected systems and user accounts to detect any further suspicious activities or attempts to regain unauthorized access.
</li>
<li class="listitem">
Review and update access controls and permissions to ensure that users have the minimum necessary privileges, reducing the risk of privilege escalation in the future.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_838"></a>Setup</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/downloadable-packages/8-18-1/prebuilt-rule-8-18-1-spike-in-privileged-command-execution-by-a-user.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Setup</strong></span></p>
<p>The rule requires the Privileged Access Detection integration assets to be installed, as well as Linux logs collected by integrations such as Elastic Defend and Sysmon Linux.</p>
<p><span class="strong strong"><strong>Privileged Access Detection Setup</strong></span></p>
<p>The Privileged Access Detection integration detects privileged access activity by identifying abnormalities in Windows, Linux and Okta events. Anomalies are detected using Elastic&#8217;s Anomaly Detection feature.</p>
<p><span class="strong strong"><strong>Prerequisite Requirements:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fleet is required for Privileged Access Detection.
</li>
<li class="listitem">
To configure Fleet Server refer to the <a href="/guide/en/fleet/current/fleet-server.html" class="ulink" target="_top">documentation</a>.
</li>
<li class="listitem">
Linux events collected by <a href="https://docs.elastic.co/en/integrations/endpoint" class="ulink" target="_top">Elastic Defend</a> or <a href="https://docs.elastic.co/en/integrations/sysmon_linux" class="ulink" target="_top">Sysmon Linux</a> integration.
</li>
<li class="listitem">
To install Elastic Defend, refer to the <a href="/guide/en/security/current/install-endpoint.html" class="ulink" target="_top">documentation</a>.
</li>
<li class="listitem">
To add Sysmon Linux integration to an Elastic Agent policy, refer to <a href="/guide/en/fleet/current/add-integration-to-policy.html" class="ulink" target="_top">this</a> guide.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>The following steps should be executed to install assets associated with the Privileged Access Detection integration:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go to the Kibana homepage. Under Management, click Integrations.
</li>
<li class="listitem">
In the query bar, search for Privileged Access Detection and select the integration to see more details about it.
</li>
<li class="listitem">
Follow the instructions under the <span class="strong strong"><strong>Installation</strong></span> section.
</li>
<li class="listitem">
For this rule to work, complete the instructions through <span class="strong strong"><strong>Add preconfigured anomaly detection jobs</strong></span>.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-18-1-microsoft-365-illicit-consent-grant-via-registered-application.html">« Microsoft 365 Illicit Consent Grant via Registered Application</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-18-1-high-command-line-entropy-detected-for-privileged-commands.html">High Command Line Entropy Detected for Privileged Commands »</a>
</span>
</div>
</body>
</html>
