<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS IAM User Created Access Keys For Another User | Elastic Security [8.19] | Elastic</title>
<meta class="elastic" name="content" content="AWS IAM User Created Access Keys For Another User | Elastic Security [8.19]">

<link rel="home" href="index.html" title="Elastic Security [8.19]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="aws-iam-user-addition-to-group.html" title="AWS IAM User Addition to Group"/>
<link rel="next" href="aws-iam-virtual-mfa-device-registration-attempt-with-session-token.html" title="AWS IAM Virtual MFA Device Registration Attempt with Session Token"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.19"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="aws-iam-user-addition-to-group.html">« AWS IAM User Addition to Group</a>
</span>
<span class="next">
<a href="aws-iam-virtual-mfa-device-registration-attempt-with-session-token.html">AWS IAM Virtual MFA Device Registration Attempt with Session Token »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS IAM User Created Access Keys For Another User</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/aws-iam-user-created-access-keys-for-another-user.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/security/prebuilt-rules/rules/integrations/aws/persistence_iam_user_created_access_keys_for_another_user">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="aws-iam-user-created-access-keys-for-another-user"></a>AWS IAM User Created Access Keys For Another User</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/aws-iam-user-created-access-keys-for-another-user.asciidoc">edit</a></div>
</div></div></div>
<p>An adversary with access to a set of compromised credentials may attempt to persist or escalate privileges by creating a new set of credentials for an existing user. This rule looks for use of the IAM <code class="literal">CreateAccessKey</code> API operation to create new programmatic access keys for another IAM user.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: esql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>: None</p>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/8.19/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://hackingthe.cloud/aws/exploitation/iam_privilege_escalation/#iamcreateaccesskey" class="ulink" target="_top">https://hackingthe.cloud/aws/exploitation/iam_privilege_escalation/#iamcreateaccesskey</a>
</li>
<li class="listitem">
<a href="https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-iam-persistence" class="ulink" target="_top">https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-iam-persistence</a>
</li>
<li class="listitem">
<a href="https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud" class="ulink" target="_top">https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateAccessKey.html" class="ulink" target="_top">https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateAccessKey.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS IAM
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Tactic: Privilege Escalation
</li>
<li class="listitem">
Tactic: Persistence
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 8</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_66"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/aws-iam-user-created-access-keys-for-another-user.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating AWS IAM User Created Access Keys For Another User</strong></span></p>
<p>AWS IAM access keys are long-term credentials that grant programmatic access to AWS resources. The <code class="literal">iam:CreateAccessKey</code> permission allows an IAM principal to generate new access keys for an existing IAM user.
While this operation can be legitimate (for example, credential rotation), it can also be abused to establish persistence or privilege escalation if one user creates keys for another account without authorization.</p>
<p>This rule identifies <code class="literal">CreateAccessKey</code> API calls where the calling user (<code class="literal">aws.cloudtrail.user_identity.arn</code>) differs from the target user (<code class="literal">aws.cloudtrail.request_parameters.userName</code>), indicating one IAM identity creating credentials for another.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Confirm both user identities and intent.</strong></span>
Identify the calling user (who performed <code class="literal">CreateAccessKey</code>) and the target user (whose access key was created). Contact both account owners or application teams to confirm if this operation was expected.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review CloudTrail event details.</strong></span>
Check the following fields directly in the alert or corresponding CloudTrail record:
</li>
<li class="listitem">
<code class="literal">source.ip</code> — does it align with expected corporate ranges or known admin automation?
</li>
<li class="listitem">
<code class="literal">user_agent.original</code> — AWS Console, CLI, SDK, or custom client? Unexpected user agents (for example, non-SDK scripts) may indicate manual or unauthorized use.
</li>
<li class="listitem">
<code class="literal">source.geo</code> fields — verify the location details are expected for the identity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with related IAM activity.</strong></span>
In CloudTrail, search for subsequent or nearby events such as:
</li>
<li class="listitem">
<code class="literal">AttachUserPolicy</code>, <code class="literal">AttachGroupPolicy</code>, <code class="literal">UpdateAssumeRolePolicy</code>, or <code class="literal">CreateUser</code>.
These can indicate privilege escalation or lateral movement.
Also review whether the same principal recently performed <code class="literal">CreateAccessKey</code> for multiple users or repeated this action across accounts.
</li>
<li class="listitem">
<span class="strong strong"><strong>Inspect the new access key’s usage.</strong></span>
Search for the newly created key ID (<code class="literal">aws.cloudtrail.response_elements.accessKey.accessKeyId</code>) in CloudTrail events following creation. Determine if it was used from unusual IP addresses, geographies, or services.
</li>
<li class="listitem">
<span class="strong strong"><strong>Assess the risk of credential compromise.</strong></span>
If you suspect malicious behavior, consider the following indicators:
</li>
<li class="listitem">
A non-admin user invoking <code class="literal">CreateAccessKey</code> for another user.
</li>
<li class="listitem">
Creation outside of normal automation pipelines.
</li>
<li class="listitem">
Use of the new key from a different IP or AWS account soon after creation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Scope related activity.</strong></span>
Review all activity from the calling user in the past 24–48 hours, focusing on <code class="literal">iam:*</code> API calls and resource creation events.
Correlate any S3, EC2, or KMS access attempts made using the new key to identify potential impact or data exposure.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Expected credential rotation.</strong></span>
Some environments delegate credential rotation responsibilities to centralized automation or specific admin roles. Confirm if the calling user is authorized for such actions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Administrative workflows.</strong></span>
Account provisioning systems may legitimately create keys on behalf of users. Check for standard tags, automation tools, or user agents that indicate managed operations.
</li>
<li class="listitem">
<span class="strong strong"><strong>Service-linked roles or external IAM automation.</strong></span>
Some AWS services create or rotate credentials automatically. Validate if the caller is a service-linked role or an automation IAM role used by a known deployment process.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="quoteblock">
<blockquote>
<p>AWS IR playbooks classify unauthorized credential creation as a <span class="strong strong"><strong>Priority-1 incident</strong></span> because it may allow persistence or privilege escalation.
The following steps scale for organizations with or without a dedicated IR team.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>1. Immediate containment</strong></span>
- Deactivate or delete the access key from the target IAM user immediately using the AWS Console, CLI, or API (<code class="literal">DeleteAccessKey</code>).
- Rotate or reset credentials for both the calling and target users to eliminate possible compromise.
- Restrict risky principals. Temporarily deny <code class="literal">iam:CreateAccessKey</code> and <code class="literal">iam:UpdateAccessKey</code> permissions for non-administrative roles while scoping the incident.
- Enable or confirm MFA on both accounts involved, if not already enforced.</p>
<p><span class="strong strong"><strong>2. Evidence preservation</strong></span>
- Export all related <code class="literal">CreateAccessKey</code>, <code class="literal">DeleteAccessKey</code>, and <code class="literal">UpdateAccessKey</code> events within ±30 minutes of the alert to an evidence bucket.
- Preserve CloudTrail, GuardDuty, and AWS Config data for the same period.
- Record key event details: caller ARN, target user, <code class="literal">accessKeyId</code>, <code class="literal">source.ip</code>, <code class="literal">userAgent</code>, and timestamps.</p>
<p><span class="strong strong"><strong>3. Scoping and investigation</strong></span>
- Search CloudTrail for usage of the new access key ID after creation. Identify any API activity or data access tied to it.
- Review IAM policy changes, group modifications, or new role assumptions around the same time.
- Determine if any additional credentials or trust policy changes were made by the same actor.
- Check for GuardDuty findings referencing anomalous credential usage or suspicious API behavior.</p>
<p><span class="strong strong"><strong>4. Recovery and hardening</strong></span>
- Remove or disable any unauthorized keys and re-enable only verified credentials.
- Implement least-privilege IAM policies to limit which users can perform <code class="literal">CreateAccessKey</code>.
- Monitor for future <code class="literal">CreateAccessKey</code> events where <code class="literal">userIdentity.arn != request_parameters.userName</code>.
- Ensure Cloudtrail, GuardDuty and Security Hub are active across all regions.
- Educate administrative users on secure key rotation processes and the risk of cross-user key creation.</p>
<p><span class="strong strong"><strong>Additional information</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong><a href="https://github.com/aws-samples/aws-incident-response-playbooks/blob/c151b0dc091755fffd4d662a8f29e2f6794da52c/playbooks/" class="ulink" target="_top">AWS IR Playbooks</a>:</strong></span> Reference “Credential Compromise” and “IAM Misuse” procedures for containment and recovery.
</li>
<li class="listitem">
<span class="strong strong"><strong><a href="https://github.com/aws-samples/aws-customer-playbook-framework/" class="ulink" target="_top">AWS Customer Playbook Framework</a>:</strong></span> See “Identity Access Review” and “Unauthorized Access Key Creation” for example response flows.
</li>
<li class="listitem">
<span class="strong strong"><strong>AWS Documentation:</strong></span> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" class="ulink" target="_top">Best practices for managing access keys</a>.
</li>
<li class="listitem">
<span class="strong strong"><strong>Security Best Practices:</strong></span> <a href="https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/" class="ulink" target="_top">AWS Knowledge Center – Security Best Practices</a>.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_68"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/aws-iam-user-created-access-keys-for-another-user.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">from logs-aws.cloudtrail-* metadata _id, _version, _index
| where event.dataset == "aws.cloudtrail"
    and event.provider == "iam.amazonaws.com"
    and event.action == "CreateAccessKey"
    and event.outcome == "success"
    and user.name != user.target.name
| keep
    @timestamp,
    cloud.account.id,
    cloud.region,
    event.provider,
    event.action,
    event.outcome,
    event.dataset,
    user.name,
    source.address,
    source.ip,
    user.target.name,
    user_agent.original,
    aws.cloudtrail.request_parameters,
    aws.cloudtrail.response_elements,
    aws.cloudtrail.user_identity.arn,
    aws.cloudtrail.user_identity.type,
    aws.cloudtrail.user_identity.access_key_id,
    source.geo.*</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Manipulation
</li>
<li class="listitem">
ID: T1098
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Additional Cloud Credentials
</li>
<li class="listitem">
ID: T1098.001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/001/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Manipulation
</li>
<li class="listitem">
ID: T1098
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Additional Cloud Credentials
</li>
<li class="listitem">
ID: T1098.001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/001/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/001/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-iam-user-addition-to-group.html">« AWS IAM User Addition to Group</a>
</span>
<span class="next">
<a href="aws-iam-virtual-mfa-device-registration-attempt-with-session-token.html">AWS IAM Virtual MFA Device Registration Attempt with Session Token »</a>
</span>
</div>
</body>
</html>
