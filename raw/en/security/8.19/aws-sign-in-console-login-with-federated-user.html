<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS Sign-In Console Login with Federated User | Elastic Security [8.19] | Elastic</title>
<meta class="elastic" name="content" content="AWS Sign-In Console Login with Federated User | Elastic Security [8.19]">

<link rel="home" href="index.html" title="Elastic Security [8.19]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="aws-service-quotas-multi-region-getservicequota-requests.html" title="AWS Service Quotas Multi-Region GetServiceQuota Requests"/>
<link rel="next" href="aws-sign-in-root-password-recovery-requested.html" title="AWS Sign-In Root Password Recovery Requested"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.19"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="aws-service-quotas-multi-region-getservicequota-requests.html">« AWS Service Quotas Multi-Region <code class="literal">GetServiceQuota</code> Requests</a>
</span>
<span class="next">
<a href="aws-sign-in-root-password-recovery-requested.html">AWS Sign-In Root Password Recovery Requested »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS Sign-In Console Login with Federated User</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/aws-sign-in-console-login-with-federated-user.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="aws-sign-in-console-login-with-federated-user"></a>AWS Sign-In Console Login with Federated User</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/aws-sign-in-console-login-with-federated-user.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies when a federated user logs into the AWS Management Console. Federated users are typically given temporary credentials to access AWS services. If a federated user logs into the AWS Management Console without using MFA, it may indicate a security risk, as MFA adds an additional layer of security to the authentication process. However, CloudTrail does not record whether a Federated User utilized MFA as part of authentication — that MFA decision often occurs at a third-party IdP (e.g., Okta, Azure AD, Google). As a result, CloudTrail fields such as MFAUsed / mfaAuthenticated appear as “No/false” for federated console logins even if IdP MFA was required. This alert should be correlated with IdP authentication logs to verify whether MFA was enforced for the session. Increase priority if you find a related "GetSigninToken" event whose source IP / ASN / geo or user-agent differs from the subsequent "ConsoleLogin" (possible token relay/abuse). Same-IP/UA pairs within a short window are more consistent with expected operator behavior and can be triaged with lower severity.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/8.19/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://hackingthe.cloud/aws/post_exploitation/create_a_console_session_from_iam_credentials/" class="ulink" target="_top">https://hackingthe.cloud/aws/post_exploitation/create_a_console_session_from_iam_credentials/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: AWS Sign-In
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Tactic: Initial Access
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 5</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_115"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/aws-sign-in-console-login-with-federated-user.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating AWS Sign-In Console Login with Federated User</strong></span></p>
<p>Federated users in AWS are granted temporary credentials to access resources, often without the need for a permanent account. This setup is convenient but can be risky if not properly secured with multi-factor authentication (MFA). Adversaries might exploit this by using stolen or misconfigured credentials to gain unauthorized access. CloudTrail alone cannot reliably indicate MFA usage for federated logins. This rule surfaces potentially risky access for analyst review and IdP correlation.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the prinicipal involved</strong></span>
</li>
<li class="listitem">
<code class="literal">aws.cloudtrail.user_identity.arn</code> (federated session ARN)
</li>
<li class="listitem">
<code class="literal">aws.cloudtrail.user_identity.session_context.session_issuer.*</code> (role ARN/name, account) of the identity that created the federated session.
</li>
<li class="listitem">
<span class="strong strong"><strong>Investigate the source context</strong></span>
</li>
<li class="listitem">
examine <code class="literal">source.ip</code>, ASN, <code class="literal">geo</code> fields, and <code class="literal">user_agent.original</code>
</li>
<li class="listitem">
Compare against normal IP ranges, known user-agents and expected locations for this identity
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Correlate to raise/lower priority</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Check IdP MFA:</strong></span> Find the corresponding IdP login around the same time and verify MFA was required and passed. If IdP shows <span class="strong strong"><strong>no MFA</strong></span>, raise severity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Federation token pivot:</strong></span> Look for a nearby <code class="literal">signin.amazonaws.com</code> <code class="literal">GetSigninToken</code> API call.
</li>
<li class="listitem">
<span class="strong strong"><strong>More suspicious:</strong></span> token creation and console login from different public IPs/ASNs/geo fields.
</li>
<li class="listitem">
<span class="strong strong"><strong>Less suspicious:</strong></span> same IP and expected user agents within ~10–15 minutes (typical operator behavior).
</li>
<li class="listitem">
<span class="strong strong"><strong>Rareness/anomaly signals:</strong></span> new/rare role or session issuer, rare source IP/ASN/geo, unusual time-of-day, multiple ConsoleLogin events from disparate networks in a short window.
</li>
<li class="listitem">
Review recent activity associated with the federated user to identify any unusual or unauthorized actions that may have occurred following the login event.
</li>
<li class="listitem">
Assess the configuration and policies of the Identity Provider (IdP) used for federated access to ensure MFA is enforced and properly configured for all users.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Related rules</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
AWS Sign-In Token Created - f754e348-f36f-4510-8087-d7f29874cc12
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Organizations using SSO for console access will routinely see federated <code class="literal">ConsoleLogin</code> where CloudTrail shows <code class="literal">MFAUsed: "No"</code> — this is expected due to IdP-side MFA.
</li>
<li class="listitem">
Internal tools/automation that create federation links (<code class="literal">GetSigninToken</code>) for operators.
</li>
<li class="listitem">
Maintain allow-lists for corp/VPN CIDRs, approved ASNs, and known automation user-agents.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If IdP confirms MFA and the source context is expected: document and close.
</li>
<li class="listitem">
If IdP shows no MFA or context is suspicious:
</li>
<li class="listitem">
Notify the security team and relevant stakeholders about the potential security breach to ensure coordinated response efforts.
</li>
<li class="listitem">
Disable/lock the IdP account pending review; invalidate IdP sessions if supported.
</li>
<li class="listitem">
Temporarily restrict access (e.g., SCPs, session policies, IP-based conditions).
</li>
<li class="listitem">
Conduct a thorough review of AWS CloudTrail logs to identify any suspicious activities or unauthorized access attempts associated with both the intitiating user and the federated user account.
</li>
<li class="listitem">
Hunt for a preceding <code class="literal">GetSigninToken</code> from a different IP/ASN/UA (possible token relay).
</li>
<li class="listitem">
Ensure IdP policy enforces MFA for AWS app access; re-verify role trust and least-privilege policies.
</li>
<li class="listitem">
Implement or enforce multi-factor authentication (MFA) for all federated user accounts to enhance security and prevent similar incidents in the future.
</li>
<li class="listitem">
Review and update IAM policies and roles associated with federated users to ensure they follow the principle of least privilege.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_119"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/aws-sign-in-console-login-with-federated-user.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "aws.cloudtrail" and
    event.provider: "signin.amazonaws.com" and
    event.action : "ConsoleLogin" and
    aws.cloudtrail.user_identity.type: "FederatedUser" and
    event.outcome: "success"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Cloud Accounts
</li>
<li class="listitem">
ID: T1078.004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/004/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/004/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-service-quotas-multi-region-getservicequota-requests.html">« AWS Service Quotas Multi-Region <code class="literal">GetServiceQuota</code> Requests</a>
</span>
<span class="next">
<a href="aws-sign-in-root-password-recovery-requested.html">AWS Sign-In Root Password Recovery Requested »</a>
</span>
</div>
</body>
</html>
