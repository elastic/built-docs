<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hidden Files and Directories via Hidden Flag | Elastic Security [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Hidden Files and Directories via Hidden Flag | Elastic Security [8.19]">

<link rel="home" href="index.html" title="Elastic Security [8.19]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="hidden-directory-creation-via-unusual-parent.html" title="Hidden Directory Creation via Unusual Parent"/>
<link rel="next" href="high-command-line-entropy-detected-for-privileged-commands.html" title="High Command Line Entropy Detected for Privileged Commands"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.19"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.19"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="hidden-directory-creation-via-unusual-parent.html">« Hidden Directory Creation via Unusual Parent</a>
</span>
<span class="next">
<a href="high-command-line-entropy-detected-for-privileged-commands.html">High Command Line Entropy Detected for Privileged Commands »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Hidden Files and Directories via Hidden Flag</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/hidden-files-and-directories-via-hidden-flag.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs/reference/security/prebuilt-rules/rules/linux/defense_evasion_creation_of_hidden_files_directories">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="hidden-files-and-directories-via-hidden-flag"></a>Hidden Files and Directories via Hidden Flag</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/hidden-files-and-directories-via-hidden-flag.asciidoc">edit</a></div>
</div></div></div>
<p>Identify activity related where adversaries can add the <em>hidden</em> flag to files to hide them from the user in an attempt to evade detection.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: eql</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
endgame-*
</li>
<li class="listitem">
logs-auditd_manager.auditd-*
</li>
<li class="listitem">
logs-endpoint.events.file*
</li>
<li class="listitem">
logs-sentinel_one_cloud_funnel.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.19/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>: None</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Endpoint
</li>
<li class="listitem">
OS: Linux
</li>
<li class="listitem">
OS: macOS
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Defense Evasion
</li>
<li class="listitem">
Data Source: Elastic Defend
</li>
<li class="listitem">
Data Source: Elastic Endgame
</li>
<li class="listitem">
Data Source: Auditd Manager
</li>
<li class="listitem">
Data Source: SentinelOne
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 107</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_427"></a>Investigation guide</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/hidden-files-and-directories-via-hidden-flag.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating Hidden Files and Directories via Hidden Flag</strong></span></p>
<p>In Unix-like systems, the <em>hidden</em> flag can be set on files to conceal them from standard directory listings, a feature often exploited by adversaries to obscure malicious files. Attackers may use commands like <code class="literal">chflags</code> to apply this flag, making detection challenging. The detection rule targets file creation events involving <code class="literal">chflags</code>, helping identify potential misuse by monitoring for suspicious activity on Linux and macOS systems.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the alert details to confirm the host operating system is Linux, as specified by the query field <code class="literal">host.os.type == "linux"</code>.
</li>
<li class="listitem">
Examine the process execution details to verify that the <code class="literal">chflags</code> command was used, as indicated by <code class="literal">process.name == "chflags"</code>.
</li>
<li class="listitem">
Investigate the file creation event to identify the specific file or directory that had the <em>hidden</em> flag applied, focusing on the <code class="literal">event.type == "creation"</code> field.
</li>
<li class="listitem">
Check the user account associated with the <code class="literal">chflags</code> command execution to determine if it aligns with expected user behavior or if it might indicate unauthorized access.
</li>
<li class="listitem">
Analyze recent system logs and user activity on the affected host to identify any other suspicious behavior or anomalies that could suggest malicious intent.
</li>
<li class="listitem">
Correlate this event with other alerts or indicators of compromise on the same host to assess if this is part of a larger attack pattern or isolated incident.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
System maintenance scripts may use the chflags command to manage file visibility for legitimate purposes. Review scheduled tasks and scripts to identify benign uses and create exceptions for these processes.
</li>
<li class="listitem">
Backup and recovery operations might employ the hidden flag to protect critical files from accidental deletion. Verify backup software configurations and exclude these operations from triggering alerts.
</li>
<li class="listitem">
Development environments could use hidden files to manage version control or configuration settings. Collaborate with development teams to understand their workflows and whitelist known development-related activities.
</li>
<li class="listitem">
Security tools and utilities may use the hidden flag as part of their normal operation to protect sensitive files. Identify these tools and add them to an exception list to prevent unnecessary alerts.
</li>
<li class="listitem">
User customization scripts might apply the hidden flag to personalize the user environment. Engage with users to document these customizations and exclude them from detection rules.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately isolate the affected system from the network to prevent further malicious activity or lateral movement.
</li>
<li class="listitem">
Terminate any suspicious processes associated with <code class="literal">chflags</code> to halt any ongoing attempts to hide files.
</li>
<li class="listitem">
Conduct a thorough review of recently created files and directories on the affected system to identify and assess any hidden files for malicious content.
</li>
<li class="listitem">
Restore any critical files that may have been hidden or altered from known good backups to ensure system integrity.
</li>
<li class="listitem">
Implement file integrity monitoring to detect unauthorized changes to file attributes, including the hidden flag, on critical systems.
</li>
<li class="listitem">
Escalate the incident to the security operations team for further investigation and to determine if additional systems are affected.
</li>
<li class="listitem">
Update and enhance endpoint detection and response (EDR) solutions to improve detection capabilities for similar threats in the future.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_460"></a>Rule query</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/rule-details/hidden-files-and-directories-via-hidden-flag.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">file where host.os.type == "linux" and event.type == "creation" and process.name == "chflags"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Hide Artifacts
</li>
<li class="listitem">
ID: T1564
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1564/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1564/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Hidden Files and Directories
</li>
<li class="listitem">
ID: T1564.001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1564/001/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1564/001/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="hidden-directory-creation-via-unusual-parent.html">« Hidden Directory Creation via Unusual Parent</a>
</span>
<span class="next">
<a href="high-command-line-entropy-detected-for-privileged-commands.html">High Command Line Entropy Detected for Privileged Commands »</a>
</span>
</div>
</body>
</html>
