<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS STS Role Chaining | Elastic Security [8.19] | Elastic</title>
<meta class="elastic" name="content" content="AWS STS Role Chaining | Elastic Security [8.19]">

<link rel="home" href="index.html" title="Elastic Security [8.19]"/>
<link rel="up" href="prebuilt-rule-8-19-8-prebuilt-rules-8-19-8-appendix.html" title="Appendix [: Downloadable rule update v8.19.8"/>
<link rel="prev" href="prebuilt-rule-8-19-8-aws-s3-static-site-javascript-file-uploaded.html" title="AWS S3 Static Site JavaScript File Uploaded"/>
<link rel="next" href="prebuilt-rule-8-19-8-microsoft-entra-id-concurrent-sign-ins-with-suspicious-properties.html" title="Microsoft Entra ID Concurrent Sign-Ins with Suspicious Properties"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.19"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-19-8-aws-s3-static-site-javascript-file-uploaded.html">« AWS S3 Static Site JavaScript File Uploaded</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-19-8-microsoft-entra-id-concurrent-sign-ins-with-suspicious-properties.html">Microsoft Entra ID Concurrent Sign-Ins with Suspicious Properties »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-19-8-prebuilt-rules-8-19-8-appendix.html">Downloadable rule update v8.19.8</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS STS Role Chaining</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-aws-sts-role-chaining.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-19-8-aws-sts-role-chaining"></a>AWS STS Role Chaining</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-aws-sts-role-chaining.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies role chaining activity. Role chaining is when you use one assumed role to assume a second role through the AWS CLI or API. While this a recognized functionality in AWS, role chaining can be abused for privilege escalation if the subsequent assumed role provides additional privileges. Role chaining can also be used as a persistence mechanism as each AssumeRole action results in a refreshed session token with a 1 hour maximum duration. This is a new terms rule that looks for the first occurance of one role (aws.cloudtrail.user_identity.session_context.session_issuer.arn) assuming another (aws.cloudtrail.resources.arn).</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-6m (<a href="/guide/en/elasticsearch/reference/8.19/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html#id_roles_terms-and-concepts" class="ulink" target="_top">https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html#id_roles_terms-and-concepts</a>
</li>
<li class="listitem">
<a href="https://www.uptycs.com/blog/detecting-anomalous-aws-sessions-temporary-credentials" class="ulink" target="_top">https://www.uptycs.com/blog/detecting-anomalous-aws-sessions-temporary-credentials</a>
</li>
<li class="listitem">
<a href="https://hackingthe.cloud/aws/post_exploitation/role-chain-juggling/" class="ulink" target="_top">https://hackingthe.cloud/aws/post_exploitation/role-chain-juggling/</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS STS
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Persistence
</li>
<li class="listitem">
Tactic: Privilege Escalation
</li>
<li class="listitem">
Tactic: Lateral Movement
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_4556"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-aws-sts-role-chaining.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating AWS STS Role Chaining</strong></span></p>
<p>Role chaining occurs when a role assumed with temporary credentials (<code class="literal">AssumeRole</code>) is used to assume another role. While supported by AWS, chaining can increase risk of Privilege escalation, if the second role grants broader permissions; and Persistence, since each chained AssumeRole refreshes the session with up to 1-hour duration. This new terms rule triggers on the first observed combination of one role (<code class="literal">aws.cloudtrail.user_identity.session_context.session_issuer.arn</code>) assuming another (<code class="literal">aws.cloudtrail.resources.arn</code>).</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Review Alert Context</strong></span>: Investigate the alert, focusing on <code class="literal">aws.cloudtrail.user_identity.session_context.session_issuer.arn</code> (the calling role) and <code class="literal">aws.cloudtrail.resources.arn</code> (the target role).
</li>
<li class="listitem">
<span class="strong strong"><strong>Determine scope and intent.</strong></span> Check <code class="literal">aws.cloudtrail.recipient_account_id</code> and <code class="literal">aws.cloudtrail.resources.account_id</code> fields to identify whether the chaining is Intra-account (within the same AWS account) or Cross-account (from another AWS account).
</li>
<li class="listitem">
<span class="strong strong"><strong>Check role privileges.</strong></span> Compare policies of the calling and target roles. Determine if chaining increases permissions (for example, access to S3 data, IAM modifications, or admin privileges).
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with other activity.</strong></span> Look for related alerts or CloudTrail activity within ±30 minutes: policy changes, unusual S3 access, or use of sensitive APIs. Use <code class="literal">aws.cloudtrail.user_identity.arn</code> to track behavior from the same role session, use <code class="literal">aws.cloudtrail.user_identity.session_context.session_issuer.arn</code> to track broader behavior from the role itself.
</li>
<li class="listitem">
<span class="strong strong"><strong>Validate legitimacy.</strong></span> Contact the account or service owner to confirm if the chaining was expected (for example, automation pipelines or federated access flows).
</li>
<li class="listitem">
<span class="strong strong"><strong>Geography &amp; source.</strong></span> Review <code class="literal">cloud.region</code>, <code class="literal">source.address</code>, and other <code class="literal">geo</code> fields to assess if the activity originates from expected regions or network ranges.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Expected role chaining.</strong></span> Some organizations use role chaining as part of multi-account access strategies. Maintain an allowlist of known <code class="literal">issuer.arn</code> - <code class="literal">target.arn</code> pairs.
</li>
<li class="listitem">
<span class="strong strong"><strong>Automation and scheduled tasks.</strong></span> CI/CD systems or monitoring tools may assume roles frequently. Validate by <code class="literal">userAgent</code> and historical behavior.
</li>
<li class="listitem">
<span class="strong strong"><strong>Test/dev environments.</strong></span> Development accounts may generate experimental chaining patterns. Tune rules or exceptions to exclude low-risk accounts.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<p><span class="strong strong"><strong>1. Immediate steps</strong></span>
- <span class="strong strong"><strong>Preserve evidence.</strong></span> Export triggering CloudTrail events (±30 minutes) into a restricted evidence bucket. Include session context, source IP, and user agent.
- <span class="strong strong"><strong>Notify owners.</strong></span> Contact the owners of both roles to validate intent.</p>
<p><span class="strong strong"><strong>2. Containment (if suspicious)</strong></span>
- <span class="strong strong"><strong>Revoke temporary credentials.</strong></span> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_revoke-sessions.html" class="ulink" target="_top">Revoke Session Permissions</a> if possible, or attach <a href="https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AWSDenyAll.html" class="ulink" target="_top">AWSDenyALL policy</a> to the originating role.
- <span class="strong strong"><strong>Restrict risky roles.</strong></span> Apply least-privilege policies or temporarily deny <code class="literal">sts:AssumeRole</code> for suspicious principals.
- <span class="strong strong"><strong>Enable monitoring.</strong></span> Ensure CloudTrail and GuardDuty are active in all regions to detect further chaining.</p>
<p><span class="strong strong"><strong>3. Scope and hunt</strong></span>
- Search for additional AssumeRole activity by the same <code class="literal">issuer.arn</code> or <code class="literal">resources.arn</code> across other accounts and regions.
- Look for privilege escalation attempts (for example, IAM <code class="literal">AttachRolePolicy</code>, <code class="literal">UpdateAssumeRolePolicy</code>) or sensitive data access following the chain.</p>
<p><span class="strong strong"><strong>4. Recovery &amp; hardening</strong></span>
- Apply least privilege to all roles, limiting trust policies to only required principals.
- Enforce MFA where possible on AssumeRole operations.
- Periodically review role chaining patterns to validate necessity; remove unused or risky trust relationships.
- Document and tune new terms exceptions for known, legitimate chains.</p>
<p><span class="strong strong"><strong>Additional information</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/aws-samples/aws-incident-response-playbooks/" class="ulink" target="_top">AWS IR Playbooks</a>: NIST-aligned templates for evidence, containment, eradication, recovery, post-incident.
</li>
<li class="listitem">
<a href="https://github.com/aws-samples/aws-customer-playbook-framework/" class="ulink" target="_top">AWS Customer Playbook Framework</a>: Practical response steps for account and IAM misuse scenarios
</li>
<li class="listitem">
AWS IAM Best Practices: <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html" class="ulink" target="_top">AWS docs</a> for reducing risk from temporary credentials.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_1049"></a>Setup</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-aws-sts-role-chaining.asciidoc">edit</a></div>
</div></div></div>
<p>The AWS Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_5431"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-aws-sts-role-chaining.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">    event.dataset : "aws.cloudtrail" and
    event.provider : "sts.amazonaws.com" and
    event.action : "AssumeRole" and
    aws.cloudtrail.user_identity.type : "AssumedRole" and
    event.outcome : "success"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Abuse Elevation Control Mechanism
</li>
<li class="listitem">
ID: T1548
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1548/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1548/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Lateral Movement
</li>
<li class="listitem">
ID: TA0008
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0008/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0008/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Use Alternate Authentication Material
</li>
<li class="listitem">
ID: T1550
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1550/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1550/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Application Access Token
</li>
<li class="listitem">
ID: T1550.001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1550/001/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1550/001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-19-8-aws-s3-static-site-javascript-file-uploaded.html">« AWS S3 Static Site JavaScript File Uploaded</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-19-8-microsoft-entra-id-concurrent-sign-ins-with-suspicious-properties.html">Microsoft Entra ID Concurrent Sign-Ins with Suspicious Properties »</a>
</span>
</div>
</body>
</html>
