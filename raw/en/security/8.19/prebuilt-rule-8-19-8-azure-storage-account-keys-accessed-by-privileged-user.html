<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Azure Storage Account Keys Accessed by Privileged User | Elastic Security [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Azure Storage Account Keys Accessed by Privileged User | Elastic Security [8.19]">

<link rel="home" href="index.html" title="Elastic Security [8.19]"/>
<link rel="up" href="prebuilt-rule-8-19-8-prebuilt-rules-8-19-8-appendix.html" title="Appendix [: Downloadable rule update v8.19.8"/>
<link rel="prev" href="prebuilt-rule-8-19-8-azure-storage-account-blob-public-access-enabled.html" title="Azure Storage Account Blob Public Access Enabled"/>
<link rel="next" href="prebuilt-rule-8-19-8-entra-id-actor-token-user-impersonation-abuse.html" title="Entra ID Actor Token User Impersonation Abuse"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.19"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-19-8-azure-storage-account-blob-public-access-enabled.html">« Azure Storage Account Blob Public Access Enabled</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-19-8-entra-id-actor-token-user-impersonation-abuse.html">Entra ID Actor Token User Impersonation Abuse »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-19-8-prebuilt-rules-8-19-8-appendix.html">Downloadable rule update v8.19.8</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Azure Storage Account Keys Accessed by Privileged User</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-azure-storage-account-keys-accessed-by-privileged-user.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-19-8-azure-storage-account-keys-accessed-by-privileged-user"></a>Azure Storage Account Keys Accessed by Privileged User</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-azure-storage-account-keys-accessed-by-privileged-user.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies unusual high-privileged access to Azure Storage Account keys by users with Owner, Contributor, or Storage Account Contributor roles. This technique was observed in STORM-0501 ransomware campaigns where compromised identities with high-privilege Azure RBAC roles retrieved access keys to perform unauthorized operations on Storage Accounts. Microsoft recommends using Shared Access Signature (SAS) models instead of direct key access for improved security. This rule detects when a user principal with high-privilege roles accesses storage keys for the first time in 7 days.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
logs-azure.activitylogs-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.19/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.microsoft.com/en-us/security/blog/2025/08/27/storm-0501s-evolving-techniques-lead-to-cloud-based-ransomware/" class="ulink" target="_top">https://www.microsoft.com/en-us/security/blog/2025/08/27/storm-0501s-evolving-techniques-lead-to-cloud-based-ransomware/</a>
</li>
<li class="listitem">
<a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage" class="ulink" target="_top">https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Domain: Identity
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Data Source: Azure
</li>
<li class="listitem">
Data Source: Azure Activity Logs
</li>
<li class="listitem">
Tactic: Credential Access
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_4550"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-azure-storage-account-keys-accessed-by-privileged-user.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and Analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating Azure Storage Account Keys Accessed by Privileged User</strong></span></p>
<p>Azure Storage Account keys provide full administrative access to storage resources. While legitimate administrators may occasionally need to access these keys, Microsoft recommends using more granular access methods like Shared Access Signatures (SAS) or Azure AD authentication. This detection identifies when users with high-privilege roles (Owner, Contributor, Storage Account Contributor, or User Access Administrator) access storage account keys, particularly focusing on unusual patterns that may indicate compromise. This technique was notably observed in STORM-0501 ransomware campaigns where compromised identities retrieved keys for unauthorized storage operations.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the <code class="literal">azure.activitylogs.identity.authorization.evidence.principal_id</code> to identify the specific user who accessed the storage account keys.
</li>
<li class="listitem">
Examine the <code class="literal">azure.resource.name</code> field to determine which storage account&#8217;s keys were accessed and assess the sensitivity of data stored there.
</li>
<li class="listitem">
Check the <code class="literal">azure.activitylogs.identity.authorization.evidence.role</code> to confirm the user&#8217;s assigned role and whether this level of access is justified for their job function.
</li>
<li class="listitem">
Investigate the timing and frequency of the key access event - multiple key retrievals in a short timeframe may indicate automated exfiltration attempts.
</li>
<li class="listitem">
Review the source IP address and geographic location of the access request to identify any anomalous access patterns or locations.
</li>
<li class="listitem">
Correlate this event with other activities by the same principal ID, looking for patterns such as permission escalations, unusual data access, or configuration changes.
</li>
<li class="listitem">
Check Azure AD sign-in logs for the user around the same timeframe to identify any suspicious authentication events or MFA bypasses.
</li>
<li class="listitem">
Examine subsequent storage account activities to determine if the retrieved keys were used for data access, modification, or exfiltration.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
DevOps and infrastructure teams may legitimately access storage keys during deployment or migration activities. Document these planned activities and consider creating exceptions for specific time windows.
</li>
<li class="listitem">
Emergency troubleshooting scenarios may require administrators to retrieve storage keys. Establish a process for documenting these emergency accesses and review them regularly.
</li>
<li class="listitem">
Automated backup or disaster recovery systems might use high-privilege service accounts that occasionally need key access. Consider using managed identities or service principals with more restricted permissions instead.
</li>
<li class="listitem">
Legacy applications that haven&#8217;t been migrated to use SAS tokens or Azure AD authentication may still require key-based access. Plan to modernize these applications and track them as exceptions in the meantime.
</li>
<li class="listitem">
New storage account provisioning by administrators will often include initial key retrieval. Consider the age of the storage account when evaluating the risk level.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately rotate the storage account keys that were accessed using Azure Portal or Azure CLI.
</li>
<li class="listitem">
Review all recent activities on the affected storage account to identify any unauthorized data access, modification, or exfiltration attempts.
</li>
<li class="listitem">
If unauthorized access is confirmed, disable the compromised user account and initiate password reset procedures.
</li>
<li class="listitem">
Audit all storage accounts accessible by the compromised identity and rotate keys for any accounts that may have been accessed.
</li>
<li class="listitem">
Implement Entra ID authentication or SAS tokens for applications currently using storage account keys to reduce future risk.
</li>
<li class="listitem">
Configure Azure Policy to restrict the listKeys operation to specific roles or require additional approval workflows.
</li>
<li class="listitem">
Review and potentially restrict the assignment of high-privilege roles like Owner and Contributor, following the principle of least privilege.
</li>
<li class="listitem">
Enable diagnostic logging for all storage accounts to maintain detailed audit trails of access and operations.
</li>
<li class="listitem">
Consider implementing Privileged Identity Management (PIM) for just-in-time access to high-privilege roles that can list storage keys.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_5425"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-8/prebuilt-rule-8-19-8-azure-storage-account-keys-accessed-by-privileged-user.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "azure.activitylogs" and
azure.activitylogs.operation_name: "MICROSOFT.STORAGE/STORAGEACCOUNTS/LISTKEYS/ACTION" and
azure.activitylogs.identity.authorization.evidence.principal_type: "User" and
azure.activitylogs.identity.authorization.evidence.role: (
    "Owner" or
    "Contributor" or
    "Storage Account Contributor" or
    "User Access Administrator"
) and event.outcome: "success"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credentials from Password Stores
</li>
<li class="listitem">
ID: T1555
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1555/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1555/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Cloud Secrets Management Stores
</li>
<li class="listitem">
ID: T1555.006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1555/006/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1555/006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Initial Access
</li>
<li class="listitem">
ID: TA0001
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0001/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0001/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Cloud Accounts
</li>
<li class="listitem">
ID: T1078.004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/004/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/004/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-19-8-azure-storage-account-blob-public-access-enabled.html">« Azure Storage Account Blob Public Access Enabled</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-19-8-entra-id-actor-token-user-impersonation-abuse.html">Entra ID Actor Token User Impersonation Abuse »</a>
</span>
</div>
</body>
</html>
