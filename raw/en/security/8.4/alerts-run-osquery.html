<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Run Osquery from a detection alert | Elastic Security Solution [8.4] | Elastic</title>
<meta class="elastic" name="content" content="Run Osquery from a detection alert | Elastic Security Solution [8.4]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.4]"/>
<link rel="up" href="detection-engine-overview.html" title="Detections and alerts"/>
<link rel="prev" href="signals-to-cases.html" title="Add detection alerts to cases"/>
<link rel="next" href="visual-event-analyzer.html" title="Visual event analyzer"/>
<meta class="elastic" name="product_version" content="8.4"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.4"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.4"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.4]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="signals-to-cases.html">« Add detection alerts to cases</a>
</span>
<span class="next">
<a href="visual-event-analyzer.html">Visual event analyzer »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="alerts-run-osquery"></a>Run Osquery from a detection alert<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.4/docs/detections/alerts-run-osquery.asciidoc">edit</a></h2>
</div></div></div>
<p><a href="/guide/en/kibana/8.4/osquery.html" class="ulink" target="_top">Osquery</a> allows you to run live queries against an alert&#8217;s host to learn more about your infrastructure and operating systems. For example, with Osquery, you can search your system for indicators of compromise that might have contributed to the alert. You can then use this data to form your investigation and alert triage efforts.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must complete the following to access Osquery and run searches against your hosts:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Enable the <a href="/guide/en/kibana/8.4/manage-osquery-integration.html" class="ulink" target="_top">Osquery manager integration</a> on the host associated with the alert.
</li>
<li class="listitem">
Update your <a href="/guide/en/kibana/8.4/osquery.html" class="ulink" target="_top">role&#8217;s privileges</a> to allow access to Osquery.
</li>
<li class="listitem">
Verify that <a href="/guide/en/fleet/8.4/view-elastic-agent-status.html" class="ulink" target="_top">Elastic Agent&#8217;s status</a> is <span class="strong strong"><strong>Healthy</strong></span>. Refer to <a href="/guide/en/fleet/8.4/fleet-troubleshooting.html" class="ulink" target="_top">Fleet Troubleshooting</a> if it is not.
</li>
</ul>
</div>
</div>
</div>
<h3><a id="osquery-alert-action"></a>Run live queries<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.4/docs/detections/alerts-run-osquery.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Do one of the following from the Alerts table:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Click the <span class="strong strong"><strong>View details</strong></span> button to open the Alert details flyout, then click <span class="strong strong"><strong>Take action &#8594; Run Osquery</strong></span>.
</li>
<li class="listitem">
Select the <span class="strong strong"><strong>More actions</strong></span> menu (<span class="strong strong"><strong>&#8230;&#8203;</strong></span>), then select <span class="strong strong"><strong>Run Osquery</strong></span>.
</li>
</ul>
</div>
</li>
<li class="listitem">
Choose to run a single query or a query pack.
</li>
<li class="listitem">
<p>Select one or more Elastic Agents or groups to query. Start typing in the search field to get suggestions for Elastic Agents by name, ID, platform, and policy.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The host associated with the alert is automatically selected. You can specify additional hosts to query.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Specify the query or pack to run:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Query</strong></span>: Select a saved query or enter a new one in the text box. After you enter the query, you can expand the <span class="strong strong"><strong>Advanced</strong></span> section to view or set <a href="/guide/en/kibana/8.4/osquery.html#osquery-map-fields" class="ulink" target="_top">mapped ECS fields</a> included in the results from the live query. Mapping ECS fields is optional.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Pack</strong></span>: Select from query packs that have been loaded and activated. After you select a pack, all of the queries in the pack are displayed.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a href="/guide/en/kibana/8.4/osquery.html#osquery-prebuilt-packs-queries" class="ulink" target="_top">prebuilt packs</a> to learn about using and managing Elastic prebuilt packs.</p>
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/setup-query.png" alt="setup query" width="80%][height=80%][Shows how to set up a single query">
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Submit</strong></span>. Queries will timeout after 5 minutes if there are no responses.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To save the query for future use, click <span class="strong strong"><strong>Save for later</strong></span> and define the ID,
description, and other <a href="/guide/en/kibana/8.4/osquery.html#osquery-manage-query" class="ulink" target="_top">details</a>.</p>
</div>
</div>
</li>
</ol>
</div>
<h3><a id="osquery-results-single"></a>Review single query results<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.4/docs/detections/alerts-run-osquery.asciidoc">edit</a></h3>
<p>Results for single queries appear in the <span class="strong strong"><strong>Results</strong></span> tab. When you run a query, the number of agents queried and query status temporarily display in a status bar above the results table. Agent responses can be <code class="literal">Sucessful</code>, <code class="literal">Not yet responded</code> (pending), and <code class="literal">Failed</code>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/single-query-results.png" alt="single query results" width="80%][height=80%][Shows query results">
</div>
</div>
<h3><a id="osquery-results-pack"></a>Review query pack results<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.4/docs/detections/alerts-run-osquery.asciidoc">edit</a></h3>
<p>Results for each query in the pack appear in the <span class="strong strong"><strong>Results</strong></span> tab. Click the expand button (<span class="image"><img src="images/pack-expand-button-osquery.png" alt="Click markdown icon" width="20" height="20"></span>) at the far right of each query row to display query results. The number of agents that were queried and their responses are shown for each query. Agent responses are color-coded. Green is <code class="literal">Sucessful</code>, <code class="literal">Not yet responded</code> (pending) is gray, and <code class="literal">Failed</code> is red.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/pack-query-results.png" alt="pack query results" width="80%][height=80%][Shows query results">
</div>
</div>
<h3><a id="osquery-investigate"></a>Investigate query results<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.4/docs/detections/alerts-run-osquery.asciidoc">edit</a></h3>
<p>From the results table, you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Click the <span class="strong strong"><strong>View in Discover</strong></span> button (<span class="image"><img src="images/discover-button-osquery.png" alt="Click markdown icon" width="20" height="20"></span>)  to explore the results in Discover.
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>View in Lens</strong></span> button (<span class="image"><img src="images/lens-button-osquery.png" alt="Click markdown icon" width="20" height="20"></span>) to navigate to Lens, where you can use the drag-and-drop <span class="strong strong"><strong>Lens</strong></span> editor to create visualizations.
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Timeline</strong></span> button (<span class="image"><img src="images/timeline-button-osquery.png" alt="Click markdown icon" width="20" height="20"></span>) to investigate a single query result in Timeline or <span class="strong strong"><strong>Add to timeline investigation</strong></span> to investigate all results. This option is only available for single query results.</p>
<p>When you open all results in Timeline, the events in Timeline are filtered based on the <code class="literal">action_ID</code> generated by the Osquery query.</p>
</li>
<li class="listitem">
View more information about the request, such as failures, by opening the <span class="strong strong"><strong>Status</strong></span> tab.
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="signals-to-cases.html">« Add detection alerts to cases</a>
</span>
<span class="next">
<a href="visual-event-analyzer.html">Visual event analyzer »</a>
</span>
</div>
</div>
</body>
</html>
