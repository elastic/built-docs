<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Add Osquery Response Actions | Elastic Security Solution [8.5] | Elastic</title>
<meta class="elastic" name="content" content="Add Osquery Response Actions | Elastic Security Solution [8.5]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.5]"/>
<link rel="up" href="use-osquery.html" title="Osquery"/>
<link rel="prev" href="use-osquery.html" title="Osquery"/>
<link rel="next" href="invest-guide-run-osquery.html" title="Run Osquery from investigation guides"/>
<meta class="elastic" name="product_version" content="8.5"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.5"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.5"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.5]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="use-osquery.html">Osquery</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="use-osquery.html">« Osquery</a>
</span>
<span class="next">
<a href="invest-guide-run-osquery.html">Run Osquery from investigation guides »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="osquery-response-action"></a>Add Osquery Response Actions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.5/docs/osquery/osquery-response-action.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Osquery Response Actions allow you to add live queries to custom query rules so you can automatically collect data on systems the rule is monitoring. Use this data to support your alert triage and investigation efforts.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Requirements</strong></p>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Osquery Response Actions require a <a href="/pricing" class="ulink" target="_top">Platinum or Enterprise subscription</a>.
</li>
<li class="listitem">
The <a href="/guide/en/kibana/8.5/manage-osquery-integration.html" class="ulink" target="_top">Osquery manager integration</a> must be installed.
</li>
<li class="listitem">
Elastic Agent&#8217;s <a href="/guide/en/fleet/8.5/monitor-elastic-agent.html" class="ulink" target="_top">status</a> must be <code class="literal">Healthy</code>. Refer to <a href="/guide/en/fleet/8.5/fleet-troubleshooting.html" class="ulink" target="_top">Fleet Troubleshooting</a> if it isn&#8217;t.
</li>
<li class="listitem">
Your role must have <a href="/guide/en/kibana/8.5/osquery.html" class="ulink" target="_top">Osquery feature privileges</a>.
</li>
</ul>
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/available-response-actions.png" alt="Available response actions">
</div>
</div>
<h3><a id="add-osquery-response-action"></a>Add Osquery Response Actions to rules<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.5/docs/osquery/osquery-response-action.asciidoc">edit</a></h3>
<p>You can add Osquery Response Actions to new or existing custom query rules. Queries run every time the rule executes.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Choose one of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>New rule</strong></span>: When you are on the last step of <a class="xref" href="rules-ui-create.html#create-custom-rule" title="Create a custom query rule">custom query rule</a> creation, go to the Response Actions section and click the <span class="strong strong"><strong>osquery</strong></span> icon.
</li>
<li class="listitem">
<span class="strong strong"><strong>Existing rule</strong></span>: Edit the rule&#8217;s settings, then go to the <span class="strong strong"><strong>Actions</strong></span> tab. In the tab, click the <span class="strong strong"><strong>osquery</strong></span> icon under the Response Actions section.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Specify whether you want to set up a single live query or a pack:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Query</strong></span>: Select a saved query or enter a new one. After you enter the query, you can expand the <span class="strong strong"><strong>Advanced</strong></span> section to view or set <a href="/guide/en/kibana/8.5/osquery.html#osquery-map-fields" class="ulink" target="_top">mapped ECS fields</a> included in the results from the live query. Mapping ECS fields is optional.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Pack</strong></span>: Select from available query packs. After you select a pack, all of the queries in the pack are displayed.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a href="/guide/en/kibana/8.5/osquery.html#osquery-prebuilt-packs-queries" class="ulink" target="_top">prebuilt packs</a> to learn about using and managing Elastic prebuilt packs.</p>
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/setup-single-query.png" alt="Shows how to set up a single query">
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>osquery</strong></span> icon to add more live queries (optional).
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create &amp; enable rule</strong></span> (for a new rule) or <span class="strong strong"><strong>Save changes</strong></span> (for existing rules) to finish adding the queries.
</li>
</ol>
</div>
<h3><a id="edit-osquery-response-action"></a>Edit Osquery Response Actions<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.5/docs/osquery/osquery-response-action.asciidoc">edit</a></h3>
<p>If you want to choose a different query or query pack for the Osquery Response Action to use, edit the rule to update the Response Action.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you edited a saved query or query pack that an Osquery Response Action is using, you must reselect the saved query or query pack on the related Osquery Response Action. Query changes are not automatically applied to Osquery Response Actions.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Edit the rule&#8217;s settings, then go to the <span class="strong strong"><strong>Actions</strong></span> tab.
</li>
<li class="listitem">
Modify the settings for Osquery Response Actions you&#8217;ve added.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save changes</strong></span>.
</li>
</ol>
</div>
<h3><a id="find-osquery-response-action-results"></a>Find query results<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/security-docs/edit/8.5/docs/osquery/osquery-response-action.asciidoc">edit</a></h3>
<p>When an alert is generated, Osquery automatically collects data on the system related to the alert. Query results are displayed within the <span class="strong strong"><strong>Osquery Results</strong></span> tab in the Alert details flyout. The number next to the <span class="strong strong"><strong>Osquery Results</strong></span> tab represents the number of queries attached to the rule.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Refer to <a class="xref" href="view-osquery-results.html" title="Examine Osquery results"><em>Examine Osquery results</em></a> for more information about query results.</p>
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/osquery-results-tab.png" alt="osquery results tab" width="80%][height=80%][Shows how to set up a single query">
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="use-osquery.html">« Osquery</a>
</span>
<span class="next">
<a href="invest-guide-run-osquery.html">Run Osquery from investigation guides »</a>
</span>
</div>
</div>
</body>
</html>
