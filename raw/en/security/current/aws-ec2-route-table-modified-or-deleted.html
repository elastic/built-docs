<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS EC2 Route Table Modified or Deleted | Elastic Security Solution [8.17] | Elastic</title>
<meta class="elastic" name="content" content="AWS EC2 Route Table Modified or Deleted | Elastic Security Solution [8.17]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.17]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="aws-ec2-network-access-control-list-deletion.html" title="AWS EC2 Network Access Control List Deletion"/>
<link rel="next" href="aws-ec2-security-group-configuration-change.html" title="AWS EC2 Security Group Configuration Change"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.17"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.17"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="aws-ec2-network-access-control-list-deletion.html">« AWS EC2 Network Access Control List Deletion</a>
</span>
<span class="next">
<a href="aws-ec2-security-group-configuration-change.html">AWS EC2 Security Group Configuration Change »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS EC2 Route Table Modified or Deleted</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/aws-ec2-route-table-modified-or-deleted.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="aws-ec2-route-table-modified-or-deleted"></a>AWS EC2 Route Table Modified or Deleted</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/aws-ec2-route-table-modified-or-deleted.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies AWS CloudTrail events where an EC2 route table or association has been modified or deleted. Route table or association modifications can be used by attackers to disrupt network traffic, reroute communications, or maintain persistence in a compromised environment. This is a [New Terms](<a href="/guide/en/security/current/rules-ui-create.html#create-new-terms-rule" class="ulink" target="_top">https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule</a>) rule that detects the first instance of this behavior by the <code class="literal">aws.cloudtrail.user_identity.arn</code> field in the last 10 days.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.17/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/easttimor/aws-incident-response#network-routing" class="ulink" target="_top">https://github.com/easttimor/aws-incident-response#network-routing</a>
</li>
<li class="listitem">
<a href="https://docs.datadoghq.com/security_platform/default_rules/aws-ec2-route-table-modified/" class="ulink" target="_top">https://docs.datadoghq.com/security_platform/default_rules/aws-ec2-route-table-modified/</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html" class="ulink" target="_top">https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRoute.html</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation" class="ulink" target="_top">https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ReplaceRouteTableAssociation</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html" class="ulink" target="_top">https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRouteTable.html</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html" class="ulink" target="_top">https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DeleteRoute.html</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html" class="ulink" target="_top">https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisassociateRouteTable.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS EC2
</li>
<li class="listitem">
Use Case: Network Security Monitoring
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
<li class="listitem">
Tactic: Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 208</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Austin Songer
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_31"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/aws-ec2-route-table-modified-or-deleted.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and Analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating AWS EC2 Route Table Modified or Deleted</strong></span></p>
<p>This rule detects modifications or deletions of AWS route tables using actions such as <code class="literal">ReplaceRoute</code>, <code class="literal">ReplaceRouteTableAssociation</code>, <code class="literal">DeleteRouteTable</code>, <code class="literal">DeleteRoute</code>, or <code class="literal">DisassociateRouteTable</code>. These actions may indicate legitimate administrative activity, but they can also be abused by attackers to disrupt network traffic, reroute communications, or maintain persistence in a compromised environment.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Review Request Parameters:</strong></span>
</li>
<li class="listitem">
Check the <code class="literal">aws.cloudtrail.flattened.request_parameters</code> field. The sub-fields may vary depending on the <code class="literal">event.action</code> (e.g., <code class="literal">routeTableId</code> for <code class="literal">DeleteRouteTable</code>, <code class="literal">destinationCidrBlock</code> for <code class="literal">ReplaceRoute</code>).
</li>
<li class="listitem">
Validate the affected route table, routes, or associations based on the API call:
</li>
<li class="listitem">
For <code class="literal">ReplaceRoute</code>: Look for changes in specific routes using <code class="literal">destinationCidrBlock</code>.
</li>
<li class="listitem">
For <code class="literal">ReplaceRouteTableAssociation</code>: Review the new association details (e.g., subnet ID).
</li>
<li class="listitem">
For <code class="literal">DeleteRouteTable</code>: Confirm the <code class="literal">routeTableId</code> of the deleted table.
</li>
<li class="listitem">
For <code class="literal">DisassociateRouteTable</code>: Verify the disassociated resources.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review User Context</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>User Identity</strong></span>: Inspect the <code class="literal">aws.cloudtrail.user_identity.arn</code> field to determine the user or role initiating the action. Investigate whether this user is authorized to perform these operations.
</li>
<li class="listitem">
<span class="strong strong"><strong>Access Key ID</strong></span>: Check the <code class="literal">aws.cloudtrail.user_identity.access_key_id</code> field to identify if the access key used was expected or potentially compromised.
</li>
<li class="listitem">
<span class="strong strong"><strong>Access Patterns</strong></span>: Validate whether the user or role has a history of performing route table modifications and whether this aligns with their expected responsibilities.
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze Request Details</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Action Type</strong></span>: Verify the specific API call in the <code class="literal">event.action</code> field (e.g., <code class="literal">ReplaceRoute</code>, <code class="literal">DeleteRouteTable</code>) to understand the nature of the modification.
</li>
<li class="listitem">
<span class="strong strong"><strong>Source IP and Geolocation</strong></span>: Examine the <code class="literal">source.address</code> and <code class="literal">source.geo</code> fields to confirm whether the request originated from a trusted location. Suspicious geolocations or IPs may indicate adversarial activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>User Agent</strong></span>: Review the <code class="literal">user_agent.original</code> field to determine the tool used for the request (e.g., AWS CLI, Terraform). Unusual or custom user agents may indicate malicious intent.
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with Other Activity</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Concurrent API Calls</strong></span>: Look for related API calls (e.g., <code class="literal">CreateRoute</code>, <code class="literal">AuthorizeSecurityGroupIngress</code>, or <code class="literal">ModifyInstanceAttribute</code>) from the same user or IP to detect broader attack patterns.
</li>
<li class="listitem">
<span class="strong strong"><strong>IAM Changes</strong></span>: Investigate whether any IAM policy updates or privilege escalation attempts preceded this activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Unusual Volume of Changes</strong></span>: Check if the user has performed multiple route table modifications or deletions in a short timeframe.
</li>
<li class="listitem">
<span class="strong strong"><strong>Validate the Intent</strong></span>:
</li>
<li class="listitem">
<span class="strong strong"><strong>Planned Changes</strong></span>: Confirm with administrators whether the route table changes were part of a planned update or maintenance activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Permissions and Justification</strong></span>: Ensure that the user or role has the least privilege necessary for these actions and that there is a valid reason for modifying the route table.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Routine Administration</strong></span>: Route table modifications are often part of routine administrative tasks, such as creating new routes, updating associations, or removing unused resources.
</li>
<li class="listitem">
<span class="strong strong"><strong>Automation Tools</strong></span>: Automated workflows, such as those executed by Terraform or CloudFormation, may trigger these events. Verify whether the <code class="literal">user_agent.original</code> field or source IP matches known automation tools.
</li>
<li class="listitem">
<span class="strong strong"><strong>Maintenance or Scaling</strong></span>: Confirm whether these actions align with maintenance activities or scaling events (e.g., adding or removing subnets).
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Revoke Unauthorized Permissions</strong></span>: If unauthorized, remove permissions for <code class="literal">ec2:ReplaceRoute</code>, <code class="literal">ec2:DeleteRouteTable</code>, or other related actions from the user or role.
</li>
<li class="listitem">
<span class="strong strong"><strong>Restore the Route Table</strong></span>:
</li>
<li class="listitem">
If critical networking was impacted, restore the route table or reapply previous configurations from backups or Terraform state files.
</li>
<li class="listitem">
Verify connectivity to affected subnets or instances to ensure no disruptions to services.
</li>
<li class="listitem">
<span class="strong strong"><strong>Audit IAM Policies</strong></span>:
</li>
<li class="listitem">
Limit route table modification permissions to specific trusted users, roles, or automation accounts.
</li>
<li class="listitem">
Implement conditions in IAM policies, such as source IP restrictions, to reduce the risk of unauthorized access.
</li>
<li class="listitem">
<span class="strong strong"><strong>Monitor and Alert</strong></span>:
</li>
<li class="listitem">
Set up additional alerts for unexpected route table modifications or deletions.
</li>
<li class="listitem">
Use VPC flow logs and CloudTrail to monitor for related suspicious activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Secure Automation</strong></span>: Ensure automation tools, such as Terraform or CloudFormation, are configured securely and that their credentials are stored in secure locations like AWS Secrets Manager.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_32"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/aws-ec2-route-table-modified-or-deleted.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: "aws.cloudtrail"
    and event.provider: "ec2.amazonaws.com"
    and event.action:(
        "ReplaceRoute" or
        "ReplaceRouteTableAssociation" or
        "DeleteRouteTable" or
        "DeleteRoute" or
        "DisassociateRouteTable"
    )
    and event.outcome: "success"
    and not source.address: (
        "cloudformation.amazonaws.com" or
        "servicecatalog.amazonaws.com" or
        "fsx.amazonaws.com"
    )</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-ec2-network-access-control-list-deletion.html">« AWS EC2 Network Access Control List Deletion</a>
</span>
<span class="next">
<a href="aws-ec2-security-group-configuration-change.html">AWS EC2 Security Group Configuration Change »</a>
</span>
</div>
</body>
</html>
