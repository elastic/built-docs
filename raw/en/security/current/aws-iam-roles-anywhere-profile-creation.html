<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AWS IAM Roles Anywhere Profile Creation | Elastic Security Solution [8.17] | Elastic</title>
<meta class="elastic" name="content" content="AWS IAM Roles Anywhere Profile Creation | Elastic Security Solution [8.17]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.17]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="aws-iam-password-recovery-requested.html" title="AWS IAM Password Recovery Requested"/>
<link rel="next" href="aws-iam-roles-anywhere-trust-anchor-created-with-external-ca.html" title="AWS IAM Roles Anywhere Trust Anchor Created with External CA"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.17"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.17"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="aws-iam-password-recovery-requested.html">« AWS IAM Password Recovery Requested</a>
</span>
<span class="next">
<a href="aws-iam-roles-anywhere-trust-anchor-created-with-external-ca.html">AWS IAM Roles Anywhere Trust Anchor Created with External CA »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>AWS IAM Roles Anywhere Profile Creation</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/aws-iam-roles-anywhere-profile-creation.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="aws-iam-roles-anywhere-profile-creation"></a>AWS IAM Roles Anywhere Profile Creation</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/aws-iam-roles-anywhere-profile-creation.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies the creation of an AWS Roles Anywhere profile. AWS Roles Anywhere is a feature that allows you to use AWS Identity and Access Management (IAM) profiles to manage access to your AWS resources from any location via trusted anchors. This rule detects the creation of a profile that can be assumed from any service. Adversaries may create profiles tied to overly permissive roles to maintain access to AWS resources. Ensure that the profile creation is expected and that the trust policy is configured securely.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-30m (<a href="/guide/en/elasticsearch/reference/8.17/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html" class="ulink" target="_top">https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html</a>
</li>
<li class="listitem">
<a href="https://docs.datadoghq.com/security/default_rules/cloudtrail-aws-iam-roles-anywhere-trust-anchor-created/" class="ulink" target="_top">https://docs.datadoghq.com/security/default_rules/cloudtrail-aws-iam-roles-anywhere-trust-anchor-created/</a>
</li>
<li class="listitem">
<a href="https://ermetic.com/blog/aws/keep-your-iam-users-close-keep-your-third-parties-even-closer-part-1/" class="ulink" target="_top">https://ermetic.com/blog/aws/keep-your-iam-users-close-keep-your-third-parties-even-closer-part-1/</a>
</li>
<li class="listitem">
<a href="https://docs.aws.amazon.com/rolesanywhere/latest/APIReference/API_CreateProfile.html" class="ulink" target="_top">https://docs.aws.amazon.com/rolesanywhere/latest/APIReference/API_CreateProfile.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: AWS IAM
</li>
<li class="listitem">
Use Case: Identity and Access Audit
</li>
<li class="listitem">
Tactic: Persistence
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 2</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_47"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/aws-iam-roles-anywhere-profile-creation.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and Analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating AWS IAM Roles Anywhere Profile Creation</strong></span></p>
<p>This rule detects the creation of an AWS Roles Anywhere profile. AWS Roles Anywhere allows you to use AWS Identity and Access Management (IAM) profiles to manage access to your AWS resources from any location via trusted anchors. Adversaries may create profiles tied to overly permissive roles to maintain access to AWS resources. It is crucial to ensure that the profile creation is expected and that the trust policy is configured securely.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Identify the Actor</strong></span>: Review the <code class="literal">aws.cloudtrail.user_identity.arn</code> and <code class="literal">aws.cloudtrail.user_identity.access_key_id</code> fields to identify who created the profile. Verify if this actor typically performs such actions and if they have the necessary permissions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review the Request Details</strong></span>: Examine the <code class="literal">aws.cloudtrail.request_parameters</code> to understand the specific details of the profile creation. Look for any unusual parameters or overly permissive roles that could suggest unauthorized or malicious activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze the Source of the Request</strong></span>: Investigate the <code class="literal">source.ip</code> and <code class="literal">source.geo</code> fields to determine the location and origin of the request. Ensure the request originated from a known and trusted location.
</li>
<li class="listitem">
<span class="strong strong"><strong>Check the Created Profile’s Permissions</strong></span>: Review the <code class="literal">roleArns</code> associated with the created profile. Verify that the roles are appropriate for the user&#8217;s intended actions and do not grant excessive permissions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Verify the Profile’s Configuration</strong></span>: Ensure that the profile&#8217;s <code class="literal">durationSeconds</code>, <code class="literal">enabled</code>, and <code class="literal">tags</code> are configured according to your organization&#8217;s security policies. Pay particular attention to any configuration that might allow prolonged access or concealment of activity.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Legitimate Administrative Actions</strong></span>: Confirm if the profile creation aligns with scheduled updates, development activities, or legitimate administrative tasks documented in change management systems.
</li>
<li class="listitem">
<span class="strong strong"><strong>Consistency Check</strong></span>: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.
</li>
<li class="listitem">
<span class="strong strong"><strong>Verify through Outcomes</strong></span>: Check the <code class="literal">aws.cloudtrail.response_elements</code> and the <code class="literal">event.outcome</code> to confirm if the profile creation was successful and intended according to policy.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Immediate Review and Reversal if Necessary</strong></span>: If the profile creation was unauthorized, disable or delete the created profile and review the associated roles and permissions for any potential misuse.
</li>
<li class="listitem">
<span class="strong strong"><strong>Enhance Monitoring and Alerts</strong></span>: Adjust monitoring systems to alert on similar actions, especially those involving sensitive roles or unexpected locations.
</li>
<li class="listitem">
<span class="strong strong"><strong>Educate and Train</strong></span>: Provide additional training to users with administrative rights on the importance of security best practices concerning profile and role management and the risks of unauthorized profile creation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Audit IAM Policies and Permissions</strong></span>: Conduct a comprehensive audit of all IAM policies and associated permissions to ensure they adhere to the principle of least privilege.
</li>
<li class="listitem">
<span class="strong strong"><strong>Incident Response</strong></span>: If there&#8217;s an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Information:</strong></span></p>
<p>For further guidance on managing AWS IAM Roles Anywhere profiles and securing AWS environments, refer to the <a href="https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html" class="ulink" target="_top">AWS Roles Anywhere documentation</a> and AWS best practices for security. Additionally, consult the following resources for specific details on profile management and potential abuse:
- <a href="https://docs.aws.amazon.com/rolesanywhere/latest/APIReference/API_CreateProfile.html" class="ulink" target="_top">AWS IAM Roles Anywhere Profile Creation API Reference</a>
- <a href="https://ermetic.com/blog/aws/keep-your-iam-users-close-keep-your-third-parties-even-closer-part-1/" class="ulink" target="_top">Ermetic Blog - Managing Third Party Access</a></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_55"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/aws-iam-roles-anywhere-profile-creation.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset:aws.cloudtrail
    and event.provider: rolesanywhere.amazonaws.com
    and event.action: CreateProfile
    and event.outcome: success</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Account Manipulation
</li>
<li class="listitem">
ID: T1098
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Additional Cloud Roles
</li>
<li class="listitem">
ID: T1098.003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1098/003/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1098/003/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="aws-iam-password-recovery-requested.html">« AWS IAM Password Recovery Requested</a>
</span>
<span class="next">
<a href="aws-iam-roles-anywhere-trust-anchor-created-with-external-ca.html">AWS IAM Roles Anywhere Trust Anchor Created with External CA »</a>
</span>
</div>
</body>
</html>
