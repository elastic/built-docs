<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Get started with CSPM for GCP | Elastic Security Solution [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Get started with CSPM for GCP | Elastic Security Solution [8.15]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.15]"/>
<link rel="up" href="cspm.html" title="Cloud security posture management"/>
<link rel="prev" href="cspm-get-started.html" title="Get started with CSPM for AWS"/>
<link rel="next" href="cspm-get-started-azure.html" title="Get started with CSPM for Azure"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.15"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.15"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="cspm-get-started.html">« Get started with CSPM for AWS</a>
</span>
<span class="next">
<a href="cspm-get-started-azure.html">Get started with CSPM for Azure »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="cloud-native-security-overview.html">Cloud native security</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="cspm.html">Cloud security posture management</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Get started with CSPM for GCP</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="cspm-get-started-gcp"></a>Get started with CSPM for GCP<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></h2>
</div></div></div>
<h4><a id="cspm-overview-gcp"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></h4>
<p>This page explains how to get started monitoring the security posture of your GCP cloud assets using the Cloud Security Posture Management (CSPM) feature.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Requirements</strong></p>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The CSPM integration is available to all Elastic Cloud users. On-premise deployments require an <a href="/pricing" class="ulink" target="_top">Enterprise subscription</a>.
</li>
<li class="listitem">
CSPM only works in the <code class="literal">Default</code> Kibana space. Installing the CSPM integration on a different Kibana space will not work.
</li>
<li class="listitem">
CSPM is supported only on AWS, GCP, and Azure commercial cloud platforms, and AWS GovCloud. Other government cloud platforms are not supported. <a href="https://github.com/elastic/kibana/issues/new/choose" class="ulink" target="_top">Click here to request support</a>.
</li>
<li class="listitem">
<p>To view posture data, you need <code class="literal">read</code> privileges for the following Elasticsearch indices:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">logs-cloud_security_posture.findings_latest-*</code>
</li>
<li class="listitem">
<code class="literal">logs-cloud_security_posture.scores-*</code>
</li>
<li class="listitem">
<code class="literal">Logs-cloud_security_posture.findings</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
The user who gives the CSPM integration GCP permissions must be a GCP project <code class="literal">admin</code>.
</li>
</ul>
</div>
</div>
<h4><a id="cspm-setup-gcp"></a>Initial setup<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></h4>
<p>You can set up CSPM for GCP either by enroling a single project, or by enroling an organization containing multiple projects. Either way, you need to first add the CSPM integration, then enable cloud account access.</p>
<h5><a id="cspm-add-and-name-integration-gcp"></a>Add your CSPM integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
From the Elastic Security <span class="strong strong"><strong>Get started</strong></span> page, click <span class="strong strong"><strong>Add integrations</strong></span>.
</li>
<li class="listitem">
Search for <code class="literal">CSPM</code>, then click on the result.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM)</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Configure integration</strong></span>, select <span class="strong strong"><strong>GCP</strong></span>, then either <span class="strong strong"><strong>GCP Organization</strong></span> (recommended) or <span class="strong strong"><strong>Single Account</strong></span>.
</li>
<li class="listitem">
Give your integration a name that matches the purpose or team of the GCP account you want to monitor, for example, <code class="literal">dev-gcp-project</code>.
</li>
</ol>
</div>
<h5><a id="cspm-set-up-cloud-access-section-gcp"></a>Set up cloud account access<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></h5>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To set up CSPM for a GCP project, you need admin privileges for the project.</p>
</div>
</div>
<p>For most users, the simplest option is to use a Google Cloud Shell script to automatically provision the necessary resources and permissions in your GCP account. This method, as well as two manual options, are described below.</p>
<h4><a id="cspm-set-up-cloudshell"></a>Cloud Shell script setup (recommended)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Under <span class="strong strong"><strong>Setup Access</strong></span>, select <span class="strong strong"><strong>Google Cloud Shell</strong></span>. Enter your GCP Project ID, and for GCP Organization deployments, your GCP Organization ID.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Where to add this integration</strong></span>:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Select <span class="strong strong"><strong>New Hosts</strong></span>.
</li>
<li class="listitem">
Name the Elastic Agent policy. Use a name that matches the purpose or team of the cloud account or accounts you want to monitor. For example, <code class="literal">dev-gcp-account</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then <span class="strong strong"><strong>Add Elastic Agent to your hosts</strong></span>. The <span class="strong strong"><strong>Add agent</strong></span> wizard appears and provides Elastic Agent binaries, which you can download and deploy to a VM in your GCP account.
</li>
</ol>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>.
</li>
<li class="listitem">
Copy the command that appears, then click <span class="strong strong"><strong>Launch Google Cloud Shell</strong></span>. It opens in a new window.
</li>
<li class="listitem">
<p>Check the box to trust Elastic&#8217;s <code class="literal">cloudbeat</code> repo, then click <span class="strong strong"><strong>Confirm</strong></span></p>
<div class="imageblock">
<div class="content">
<img src="images/cspm-cloudshell-trust.png" alt="The cloud shell confirmation popup">
</div>
</div>
</li>
<li class="listitem">
In Google Cloud Shell, execute the command you copied. Once it finishes, return to Kibana and wait for the confirmation of data received from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you encounter any issues running the command, return to Kibana and navigate again to Google Cloud Shell.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>During Cloud Shell setup, the CSPM integration adds roles to Google&#8217;s default service account, which enables custom role creation and attachment of the service account to a compute instance.
After setup, these roles are removed from the service account. If you attempt to delete the deployment but find the deployment manager lacks necessary permissions, consider adding the missing roles to the service account:
<a href="https://cloud.google.com/iam/docs/understanding-roles#resourcemanager.projectIamAdmin" class="ulink" target="_top">Project IAM Admin</a>, <a href="https://cloud.google.com/iam/docs/understanding-roles#iam.roleAdmin" class="ulink" target="_top">Role Administrator</a>.</p>
</div>
</div>
<h4><a id="cspm-set-up-manual-gcp-org"></a>Manual authentication (GCP organization)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></h4>
<p>To authenticate manually to monitor a GCP organization, you&#8217;ll need to create a new GCP service account, assign it the necessary roles, generate credentials, then provide those credentials to the CSPM integration.</p>
<p>Use the following commands, after replacing <code class="literal">&lt;SA_NAME&gt;</code> with the name of your new service account, <code class="literal">&lt;ORG_ID&gt;</code> with your GCP organization&#8217;s ID, and <code class="literal">&lt;PROJECT_ID&gt;</code> with the GCP project ID of the project where you want to provision the compute instance that will run CSPM.</p>
<p>Create a new service account:</p>
<pre class="screen">gcloud iam service-accounts create &lt;SA_NAME&gt; \
    --description="Elastic agent service account for CSPM" \
    --display-name="Elastic agent service account for CSPM" \
    --project=&lt;PROJECT_ID&gt;</pre>
<p>Assign the necessary roles to the service account:</p>
<pre class="screen">gcloud organizations add-iam-policy-binding &lt;ORG_ID&gt; \
    --member=serviceAccount:&lt;SA_NAME&gt;@&lt;PROJECT_ID&gt;.iam.gserviceaccount.com \
    --role=roles/cloudasset.viewer

gcloud organizations add-iam-policy-binding &lt;ORG_ID&gt; \
    --member=serviceAccount:&lt;SA_NAME&gt;@&lt;PROJECT_ID&gt;.iam.gserviceaccount.com \
    --role=roles/browser</pre>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">Cloud Asset Viewer</code> role grants read access to cloud asset metadata. The <code class="literal">Browser</code> role grants read access to the project hierarchy.</p>
</div>
</div>
<p>Download the credentials JSON (first, replace <code class="literal">&lt;KEY_FILE&gt;</code> with the location where you want to save it):</p>
<pre class="screen">gcloud iam service-accounts keys create &lt;KEY_FILE&gt; \
    --iam-account=&lt;SA_NAME&gt;@&lt;PROJECT_ID&gt;.iam.gserviceaccount.com</pre>
<p>Keep the credentials JSON in a secure location; you will need it later.</p>
<p>Provide credentials to the CSPM integration:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the CSPM setup screen under <span class="strong strong"><strong>Setup Access</strong></span>, select <span class="strong strong"><strong>Manual</strong></span>.
</li>
<li class="listitem">
Enter your GCP <span class="strong strong"><strong>Organization ID</strong></span>. Enter the GCP <span class="strong strong"><strong>Project ID</strong></span> of the project where you want to provision the compute instance that will run CSPM.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Credentials JSON</strong></span>, and enter the value you generated earlier.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Where to add this integration</strong></span>, select <span class="strong strong"><strong>New Hosts</strong></span>.
</li>
<li class="listitem">
Name the Elastic Agent policy. Use a name that matches the purpose or team of the cloud account or accounts you want to monitor. For example, <code class="literal">dev-gcp-account</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then follow the instructions to install Elastic Agent in your chosen GCP project.
</li>
</ol>
</div>
<p>Wait for the confirmation that Kibana received data from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.</p>
<h4><a id="cspm-set-up-manual-gcp-project"></a>Manual authentication (GCP project)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/cloud-native-security/cspm-get-started-gcp.asciidoc">edit</a></h4>
<p>To authenticate manually to monitor an individual GCP project, you&#8217;ll need to create a new GCP service account, assign it the necessary roles, generate credentials, then provide those credentials to the CSPM integration.</p>
<p>Use the following commands, after replacing <code class="literal">&lt;SA_NAME&gt;</code> with the name of your new service account, and <code class="literal">&lt;PROJECT_ID&gt;</code> with your GCP project ID.</p>
<p>Create a new service account:</p>
<pre class="screen">gcloud iam service-accounts create &lt;SA_NAME&gt; \
    --description="Elastic agent service account for CSPM" \
    --display-name="Elastic agent service account for CSPM" \
    --project=&lt;PROJECT_ID&gt;</pre>
<p>Assign the necessary roles to the service account:</p>
<pre class="screen">gcloud projects add-iam-policy-binding &lt;PROJECT_ID&gt; \
    --member=serviceAccount:&lt;SA_NAME&gt;@&lt;PROJECT_ID&gt;.iam.gserviceaccount.com \
    --role=roles/cloudasset.viewer

gcloud projects add-iam-policy-binding &lt;PROJECT_ID&gt; \
    --member=serviceAccount:&lt;SA_NAME&gt;@&lt;PROJECT_ID&gt;.iam.gserviceaccount.com \
    --role=roles/browser</pre>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">Cloud Asset Viewer</code> role grants read access to cloud asset metadata. The <code class="literal">Browser</code> role grants read access to the project hierarchy.</p>
</div>
</div>
<p>Download the credentials JSON (first, replace <code class="literal">&lt;KEY_FILE&gt;</code> with the location where you want to save it):</p>
<pre class="screen">gcloud iam service-accounts keys create &lt;KEY_FILE&gt; \
    --iam-account=&lt;SA_NAME&gt;@&lt;PROJECT_ID&gt;.iam.gserviceaccount.com</pre>
<p>Keep the credentials JSON in a secure location; you will need it later.</p>
<p>Provide credentials to the CSPM integration:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the CSPM setup screen under <span class="strong strong"><strong>Setup Access</strong></span>, select <span class="strong strong"><strong>Manual</strong></span>.
</li>
<li class="listitem">
Enter your GCP <span class="strong strong"><strong>Project ID</strong></span>.
</li>
<li class="listitem">
Select <span class="strong strong"><strong>Credentials JSON</strong></span>, and enter the value you generated earlier.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Where to add this integration</strong></span>, select <span class="strong strong"><strong>New Hosts</strong></span>.
</li>
<li class="listitem">
Name the Elastic Agent policy. Use a name that matches the purpose or team of the cloud account or accounts you want to monitor. For example, <code class="literal">dev-gcp-account</code>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then follow the instructions to install Elastic Agent in your chosen GCP project.
</li>
</ol>
</div>
<p>Wait for the confirmation that Kibana received data from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="cspm-get-started.html">« Get started with CSPM for AWS</a>
</span>
<span class="next">
<a href="cspm-get-started-azure.html">Get started with CSPM for Azure »</a>
</span>
</div>
</body>
</html>
