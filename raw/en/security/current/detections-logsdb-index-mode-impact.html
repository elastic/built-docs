<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Using logsdb index mode with Elastic Security | Elastic Security Solution [8.17] | Elastic</title>
<meta class="elastic" name="content" content="Using logsdb index mode with Elastic Security | Elastic Security Solution [8.17]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.17]"/>
<link rel="up" href="detection-engine-overview.html" title="Detections and alerts"/>
<link rel="prev" href="detections-permissions-section.html" title="Detections requirements"/>
<link rel="next" href="about-rules.html" title="About detection rules"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.17"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.17"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="detections-permissions-section.html">« Detections requirements</a>
</span>
<span class="next">
<a href="about-rules.html">About detection rules »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Using logsdb index mode with Elastic Security</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/detections-logsdb-impact.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="detections-logsdb-index-mode-impact"></a>Using logsdb index mode with Elastic Security</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/detections-logsdb-impact.asciidoc">edit</a></div>
</div></div></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To use the <a href="/guide/en/elasticsearch/reference/8.17/mapping-source-field.html#synthetic-source" class="ulink" target="_top">synthetic <code class="literal">_source</code></a> feature, you must have the appropriate subscription. Refer to the subscription page for <a href="/subscriptions/cloud" class="ulink" target="_top">Elastic Cloud</a> and <a href="/subscriptions" class="ulink" target="_top">Elastic Stack/self-managed</a> for the breakdown of available features and their associated subscription tiers.</p>
</div>
</div>
<p>This topic explains the impact of using logsdb index mode with Elastic Security.</p>
<p>With logsdb index mode, the original <code class="literal">_source</code> field is not stored in the index but can be reconstructed using <a href="/guide/en/elasticsearch/reference/8.17/mapping-source-field.html#synthetic-source" class="ulink" target="_top">synthetic <code class="literal">_source</code></a>.</p>
<p>When the <code class="literal">_source</code> is reconstructed, <a href="/guide/en/elasticsearch/reference/8.17/mapping-source-field.html#synthetic-source-modifications" class="ulink" target="_top">modifications</a> are possible. Therefore, there could be a mismatch between users' expectations and how fields are formatted.</p>
<p>Continue reading to find out how this affects specific Elastic Security components.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Logsdb index mode is fully supported, and is recommended for new Elastic Security deployments. Logsdb is not recommended for existing Elastic Security deployments unless users fully understand and accept the documented changes to detection alert documents, runtime fields, and rule actions (refer to the sections below), and have ensured that their deployment has sufficient excess hot data tier CPU capacity to support the logsdb ingesting and indexing process. Enabling logsdb without sufficient excess hot data tier CPU capacity may result in data ingestion backups and or security detection rule timeouts and errors.</p>
</div>
</div>
<div class="position-relative"><h3><a id="logsdb-alerts"></a>Alerts</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/detections-logsdb-impact.asciidoc">edit</a></div>
<p>When alerts are generated, the <code class="literal">_source</code> event is copied into the alert to retain the original data. When the logsdb index mode is applied, the <code class="literal">_source</code> event stored in the alert is reconstructed using synthetic <code class="literal">_source</code>.</p>
<p>If you&#8217;re switching to use logsdb index mode, the <code class="literal">_source</code> field stored in the alert might look different in certain situations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.17/mapping-source-field.html#synthetic-source-modifications-leaf-arrays" class="ulink" target="_top">Arrays can be reconstructed differently or deduplicated</a>
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/8.17/mapping-source-field.html#synthetic-source-modifications-field-names" class="ulink" target="_top">Field names</a>
</li>
<li class="listitem">
<code class="literal">geo_point</code> data fields (refer to <a href="/guide/en/elasticsearch/reference/8.17/mapping-source-field.html#synthetic-source-modifications-ranges" class="ulink" target="_top">Representation of ranges</a> and <a href="/guide/en/elasticsearch/reference/8.17/mapping-source-field.html#synthetic-source-precision-loss-for-point-types" class="ulink" target="_top">Reduced precision of <code class="literal">geo_point</code> values</a> for more information)
</li>
</ul>
</div>
<p>Alerts generated by the following rule types could be affected:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Custom query
</li>
<li class="listitem">
Event correlation (non-sequence only)
</li>
<li class="listitem">
Non-aggregate rule types (for example, ES|QL rules that use non-aggregating queries)
</li>
</ul>
</div>
<p>Alerts that are generated by threshold, machine learning, and event correlation sequence rules are not affected since they do not contain copies of the original source.</p>
<div class="position-relative"><h3><a id="logsdb-rule-actions"></a>Rule actions</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/detections-logsdb-impact.asciidoc">edit</a></div>
<p>While we do not recommend using <code class="literal">_source</code> for actions, in cases where the action relies on the <code class="literal">_source</code>, the same limitations and changes apply.</p>
<p>If you send alert notifications by enabling <a href="/guide/en/kibana/8.17/alerting-getting-started.html#alerting-concepts-actions" class="ulink" target="_top">actions</a> to the external systems that have workflows or automations based on fields formatted from the original source, they may be affected. In particular, this can happen when the fields used are arrays of objects.</p>
<p>We recommend checking and adjusting the rule actions using <code class="literal">_source</code> before switching to logsdb index mode.</p>
<div class="position-relative"><h3><a id="logsdb-runtime-fields"></a>Runtime fields</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/detections-logsdb-impact.asciidoc">edit</a></div>
<p>Runtime fields that reference <code class="literal">_source</code> may be affected. Some runtime fields might not work and need to be adjusted. For example, if an event was indexed with the value of <code class="literal">agent.name</code> in the dot-notation form, it will be returned in the nested form and might not work.</p>
<p>The following is an example of accessing <code class="literal">_source</code> that works with the logsdb index mode enabled:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">"source": """  emit(params._source.agent.name + "_____" + doc['agent.name'].value ); """
"source": """  emit(params._source['agent']['name'] + "_____" + doc['agent.name'].value );  """
"source": """  emit(field('agent.name').get(null) + "_____" + doc['agent.name'].value ); """
"source": """  emit($('agent.name', null) + "_____" + doc['agent.name'].value ); """</pre>
</div>
<div class="console_widget" data-snippet="snippets/2.console"></div>
<p>The following will not work with synthetic source (logsdb index mode enabled):</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">"source": """  emit(params._source['agent.name'] + "_____" + doc['agent.name'].value );  """</pre>
</div>
<div class="console_widget" data-snippet="snippets/3.console"></div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="detections-permissions-section.html">« Detections requirements</a>
</span>
<span class="next">
<a href="about-rules.html">About detection rules »</a>
</span>
</div>
</body>
</html>
