<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Permission Theft - Prevented - Elastic Endgame | Elastic Security Solution [8.17] | Elastic</title>
<meta class="elastic" name="content" content="Permission Theft - Prevented - Elastic Endgame | Elastic Security Solution [8.17]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.17]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="permission-theft-detected-elastic-endgame.html" title="Permission Theft - Detected - Elastic Endgame"/>
<link rel="next" href="persistence-via-bits-job-notify-cmdline.html" title="Persistence via BITS Job Notify Cmdline"/>
<meta class="elastic" name="product_version" content="8.17"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.17"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.17"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="permission-theft-detected-elastic-endgame.html">« Permission Theft - Detected - Elastic Endgame</a>
</span>
<span class="next">
<a href="persistence-via-bits-job-notify-cmdline.html">Persistence via BITS Job Notify Cmdline »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.17]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Permission Theft - Prevented - Elastic Endgame</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/permission-theft-prevented-elastic-endgame.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="permission-theft-prevented-elastic-endgame"></a>Permission Theft - Prevented - Elastic Endgame</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/permission-theft-prevented-elastic-endgame.asciidoc">edit</a></div>
</div></div></div>
<p>Elastic Endgame prevented Permission Theft. Click the Elastic Endgame icon in the event.module column or the link in the rule.reference column for additional information.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
endgame-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-15m (<a href="/guide/en/elasticsearch/reference/8.17/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 10000</p>
<p><span class="strong strong"><strong>References</strong></span>: None</p>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Data Source: Elastic Endgame
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Privilege Escalation
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 104</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_631"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/permission-theft-prevented-elastic-endgame.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating Permission Theft - Prevented - Elastic Endgame</strong></span></p>
<p>Elastic Endgame is a security solution that prevents unauthorized access by monitoring and blocking attempts to manipulate access tokens, a common privilege escalation tactic. Adversaries exploit token manipulation to gain elevated permissions without detection. The detection rule identifies and alerts on prevention events related to token protection, leveraging specific event types and actions to flag suspicious activities, thus mitigating potential threats.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the alert details to confirm the event.kind is <em>alert</em> and event.module is <em>endgame</em>, ensuring the alert is relevant to Elastic Endgame&#8217;s token protection.
</li>
<li class="listitem">
Examine the event.action and endgame.event_subtype_full fields to determine if the alert was triggered by a <em>token_protection_event</em>, which indicates an attempt to manipulate access tokens.
</li>
<li class="listitem">
Investigate the source and destination of the alert by analyzing associated IP addresses, user accounts, and hostnames to identify potential unauthorized access attempts.
</li>
<li class="listitem">
Check the endgame.metadata.type field to verify that the event type is <em>prevention</em>, confirming that the attempted permission theft was successfully blocked.
</li>
<li class="listitem">
Correlate the alert with other recent alerts or logs to identify patterns or repeated attempts that might indicate a persistent threat actor.
</li>
<li class="listitem">
Assess the risk score and severity level to prioritize the investigation and determine if immediate action is required to mitigate potential threats.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Routine administrative tasks involving legitimate token manipulation may trigger alerts. Review the context of the event to determine if it aligns with expected administrative activities.
</li>
<li class="listitem">
Scheduled scripts or automated processes that require token access might be flagged. Identify these processes and consider creating exceptions for known, safe operations.
</li>
<li class="listitem">
Software updates or installations that involve token changes can generate alerts. Verify the source and purpose of the update to ensure it is authorized, and exclude these events if they are part of regular maintenance.
</li>
<li class="listitem">
Security tools or monitoring solutions that interact with tokens for legitimate purposes may cause false positives. Cross-reference with known tool activities and whitelist these actions if they are verified as non-threatening.
</li>
<li class="listitem">
User behavior analytics might misinterpret legitimate user actions as suspicious. Analyze user activity patterns and adjust the detection thresholds or rules to better align with normal user behavior.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately isolate the affected system to prevent further unauthorized access or privilege escalation attempts.
</li>
<li class="listitem">
Revoke any potentially compromised access tokens and force re-authentication for affected accounts to ensure that only legitimate users regain access.
</li>
<li class="listitem">
Conduct a thorough review of recent access logs and token usage to identify any unauthorized access or actions taken by the adversary.
</li>
<li class="listitem">
Apply patches or updates to the affected systems and applications to address any vulnerabilities that may have been exploited for token manipulation.
</li>
<li class="listitem">
Implement enhanced monitoring on the affected systems to detect any further attempts at access token manipulation or privilege escalation.
</li>
<li class="listitem">
Notify the security team and relevant stakeholders about the incident, providing details of the threat and actions taken, and escalate to higher management if the threat level increases.
</li>
<li class="listitem">
Review and update access control policies and token management practices to prevent similar incidents in the future, ensuring that only necessary permissions are granted and regularly audited.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_418"></a>Setup</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/permission-theft-prevented-elastic-endgame.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Setup</strong></span></p>
<p>This rule is configured to generate more <span class="strong strong"><strong>Max alerts per run</strong></span> than the default 1000 alerts per run set for all rules. This is to ensure that it captures as many alerts as possible.</p>
<p><span class="strong strong"><strong>IMPORTANT:</strong></span> The rule&#8217;s <span class="strong strong"><strong>Max alerts per run</strong></span> setting can be superseded by the <code class="literal">xpack.alerting.rules.run.alerts.max</code> Kibana config setting, which determines the maximum alerts generated by <em>any</em> rule in the Kibana alerting framework. For example, if <code class="literal">xpack.alerting.rules.run.alerts.max</code> is set to 1000, this rule will still generate no more than 1000 alerts even if its own <span class="strong strong"><strong>Max alerts per run</strong></span> is set higher.</p>
<p>To make sure this rule can generate as many alerts as it&#8217;s configured in its own <span class="strong strong"><strong>Max alerts per run</strong></span> setting, increase the <code class="literal">xpack.alerting.rules.run.alerts.max</code> system setting accordingly.</p>
<p><span class="strong strong"><strong>NOTE:</strong></span> Changing <code class="literal">xpack.alerting.rules.run.alerts.max</code> is not possible in Serverless projects.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_678"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.17/docs/detections/prebuilt-rules/rule-details/permission-theft-prevented-elastic-endgame.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:token_protection_event or endgame.event_subtype_full:token_protection_event)</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Access Token Manipulation
</li>
<li class="listitem">
ID: T1134
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1134/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1134/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="permission-theft-detected-elastic-endgame.html">« Permission Theft - Detected - Elastic Endgame</a>
</span>
<span class="next">
<a href="persistence-via-bits-job-notify-cmdline.html">Persistence via BITS Job Notify Cmdline »</a>
</span>
</div>
</body>
</html>
