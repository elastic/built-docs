<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>High Command Line Entropy Detected for Privileged Commands | Elastic Security Solution [8.18] | Elastic</title>
<meta class="elastic" name="content" content="High Command Line Entropy Detected for Privileged Commands | Elastic Security Solution [8.18]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.18]"/>
<link rel="up" href="prebuilt-rule-8-18-1-prebuilt-rules-8-18-1-appendix.html" title="Appendix T: Downloadable rule update v8.18.1"/>
<link rel="prev" href="prebuilt-rule-8-18-1-spike-in-privileged-command-execution-by-a-user.html" title="Spike in Privileged Command Execution by a User"/>
<link rel="next" href="prebuilt-rule-8-18-1-unusual-process-detected-for-privileged-commands-by-a-user.html" title="Unusual Process Detected for Privileged Commands by a User"/>
<meta class="elastic" name="product_version" content="8.18"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.18"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.18"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-18-1-spike-in-privileged-command-execution-by-a-user.html">« Spike in Privileged Command Execution by a User</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-18-1-unusual-process-detected-for-privileged-commands-by-a-user.html">Unusual Process Detected for Privileged Commands by a User »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.18]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-18-1-prebuilt-rules-8-18-1-appendix.html">Downloadable rule update v8.18.1</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>High Command Line Entropy Detected for Privileged Commands</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/downloadable-packages/8-18-1/prebuilt-rule-8-18-1-high-command-line-entropy-detected-for-privileged-commands.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    A newer version is available. Check out the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-18-1-high-command-line-entropy-detected-for-privileged-commands"></a>High Command Line Entropy Detected for Privileged Commands</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/downloadable-packages/8-18-1/prebuilt-rule-8-18-1-high-command-line-entropy-detected-for-privileged-commands.asciidoc">edit</a></div>
</div></div></div>
<p>A machine learning job has identified an unusually high median command line entropy for privileged commands executed by a user, suggesting possible privileged access activity through command lines. High entropy often indicates that the commands may be obfuscated or deliberately complex, which can be a sign of suspicious or unauthorized use of privileged access.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: machine_learning</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>: None</p>
<p><span class="strong strong"><strong>Severity</strong></span>: low</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 21</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 15m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-3h (<a href="/guide/en/elasticsearch/reference/8.18/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/security/current/prebuilt-ml-jobs.html" class="ulink" target="_top">https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html</a>
</li>
<li class="listitem">
<a href="https://docs.elastic.co/en/integrations/pad" class="ulink" target="_top">https://docs.elastic.co/en/integrations/pad</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Use Case: Privileged Access Detection
</li>
<li class="listitem">
Rule Type: ML
</li>
<li class="listitem">
Rule Type: Machine Learning
</li>
<li class="listitem">
Tactic: Privilege Escalation
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 3</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_4027"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/downloadable-packages/8-18-1/prebuilt-rule-8-18-1-high-command-line-entropy-detected-for-privileged-commands.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<div class="quoteblock">
<blockquote>
<p><span class="strong strong"><strong>Disclaimer</strong></span>:
This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.</p>
</blockquote>
</div>
<p><span class="strong strong"><strong>Investigating High Command Line Entropy Detected for Privileged Commands</strong></span></p>
<p>Machine learning models analyze command line inputs to identify high entropy, which may indicate obfuscation or complexity in privileged commands. Adversaries exploit this by using intricate or encoded commands to mask unauthorized activities. The detection rule leverages this analysis to flag potential privilege escalation attempts, aiding in early threat identification and response.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the command line inputs flagged by the alert to identify any patterns or specific obfuscation techniques used.
</li>
<li class="listitem">
Cross-reference the user account associated with the alert against known valid accounts and recent access logs to determine if the activity aligns with expected behavior.
</li>
<li class="listitem">
Analyze the context of the commands executed, including the time of execution and the systems targeted, to assess the potential impact and scope of the activity.
</li>
<li class="listitem">
Check for any recent changes in user privileges or roles that might explain the execution of privileged commands.
</li>
<li class="listitem">
Investigate any related alerts or logs that might provide additional context or corroborate the suspicious activity, such as failed login attempts or unusual network connections.
</li>
<li class="listitem">
Consult with the user or relevant personnel to verify if the commands were part of legitimate administrative tasks or if they indicate unauthorized access.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Legitimate administrative scripts may have high entropy due to complex or encoded commands. Review and whitelist these scripts to prevent unnecessary alerts.
</li>
<li class="listitem">
Automated deployment tools often use obfuscated commands for security reasons. Identify and exclude these tools from the rule to reduce false positives.
</li>
<li class="listitem">
Security software updates might execute encoded commands as part of their process. Monitor and create exceptions for these updates to avoid misclassification.
</li>
<li class="listitem">
Developers and IT staff may use complex command lines for testing or debugging. Establish a baseline of normal activity for these users and adjust the rule accordingly.
</li>
<li class="listitem">
Scheduled tasks or cron jobs with encoded commands can trigger alerts. Document and exclude these tasks if they are verified as non-threatening.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Immediately isolate the affected system from the network to prevent further unauthorized access or lateral movement.
</li>
<li class="listitem">
Review and terminate any suspicious or unauthorized processes running under privileged accounts on the affected system.
</li>
<li class="listitem">
Reset passwords for all privileged accounts involved, ensuring they meet strong password policies to prevent unauthorized access.
</li>
<li class="listitem">
Conduct a thorough audit of recent privileged command executions to identify any unauthorized changes or data access, and revert any malicious modifications.
</li>
<li class="listitem">
Implement additional monitoring on the affected system and related accounts to detect any further suspicious activities.
</li>
<li class="listitem">
Escalate the incident to the security operations center (SOC) for a comprehensive investigation and to determine if other systems are affected.
</li>
<li class="listitem">
Update and reinforce endpoint protection measures to detect and block similar obfuscation or high-entropy command line activities in the future.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_850"></a>Setup</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.18/docs/detections/prebuilt-rules/downloadable-packages/8-18-1/prebuilt-rule-8-18-1-high-command-line-entropy-detected-for-privileged-commands.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Setup</strong></span></p>
<p>The rule requires the Privileged Access Detection integration assets to be installed, as well as Linux logs collected by integrations such as Elastic Defend and Sysmon Linux.</p>
<p><span class="strong strong"><strong>Privileged Access Detection Setup</strong></span></p>
<p>The Privileged Access Detection integration detects privileged access activity by identifying abnormalities in Windows, Linux and Okta events. Anomalies are detected using Elastic&#8217;s Anomaly Detection feature.</p>
<p><span class="strong strong"><strong>Prerequisite Requirements:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fleet is required for Privileged Access Detection.
</li>
<li class="listitem">
To configure Fleet Server refer to the <a href="/guide/en/fleet/current/fleet-server.html" class="ulink" target="_top">documentation</a>.
</li>
<li class="listitem">
Linux events collected by <a href="https://docs.elastic.co/en/integrations/endpoint" class="ulink" target="_top">Elastic Defend</a> or <a href="https://docs.elastic.co/en/integrations/sysmon_linux" class="ulink" target="_top">Sysmon Linux</a> integration.
</li>
<li class="listitem">
To install Elastic Defend, refer to the <a href="/guide/en/security/current/install-endpoint.html" class="ulink" target="_top">documentation</a>.
</li>
<li class="listitem">
To add Sysmon Linux integration to an Elastic Agent policy, refer to <a href="/guide/en/fleet/current/add-integration-to-policy.html" class="ulink" target="_top">this</a> guide.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>The following steps should be executed to install assets associated with the Privileged Access Detection integration:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go to the Kibana homepage. Under Management, click Integrations.
</li>
<li class="listitem">
In the query bar, search for Privileged Access Detection and select the integration to see more details about it.
</li>
<li class="listitem">
Follow the instructions under the <span class="strong strong"><strong>Installation</strong></span> section.
</li>
<li class="listitem">
For this rule to work, complete the instructions through <span class="strong strong"><strong>Add preconfigured anomaly detection jobs</strong></span>.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Privilege Escalation
</li>
<li class="listitem">
ID: TA0004
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0004/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0004/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Valid Accounts
</li>
<li class="listitem">
ID: T1078
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1078/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1078/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-18-1-spike-in-privileged-command-execution-by-a-user.html">« Spike in Privileged Command Execution by a User</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-18-1-unusual-process-detected-for-privileged-commands-by-a-user.html">Unusual Process Detected for Privileged Commands by a User »</a>
</span>
</div>
</body>
</html>
