<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Azure Storage Blob Retrieval via AzCopy | Elastic Security [8.19] | Elastic</title>
<meta class="elastic" name="content" content="Azure Storage Blob Retrieval via AzCopy | Elastic Security [8.19]">

<link rel="home" href="index.html" title="Elastic Security [8.19]"/>
<link rel="up" href="prebuilt-rule-8-19-9-prebuilt-rules-8-19-9-appendix.html" title="Appendix \: Downloadable rule update v8.19.9"/>
<link rel="prev" href="prebuilt-rule-8-19-9-prebuilt-rules-8-19-9-appendix.html" title="Appendix \: Downloadable rule update v8.19.9"/>
<link rel="next" href="prebuilt-rule-8-19-9-azure-compute-restore-point-collection-deleted-by-unusual-user.html" title="Azure Compute Restore Point Collection Deleted by Unusual User"/>
<meta class="elastic" name="product_version" content="8.19"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.19"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.19"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-19-9-prebuilt-rules-8-19-9-appendix.html">« Appendix \: Downloadable rule update v8.19.9</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-19-9-azure-compute-restore-point-collection-deleted-by-unusual-user.html">Azure Compute Restore Point Collection Deleted by Unusual User »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security [8.19]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-19-9-prebuilt-rules-8-19-9-appendix.html">Downloadable rule update v8.19.9</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Azure Storage Blob Retrieval via AzCopy</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-9/prebuilt-rule-8-19-9-azure-storage-blob-retrieval-via-azcopy.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="prebuilt-rule-8-19-9-azure-storage-blob-retrieval-via-azcopy"></a>Azure Storage Blob Retrieval via AzCopy</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-9/prebuilt-rule-8-19-9-azure-storage-blob-retrieval-via-azcopy.asciidoc">edit</a></div>
</div></div></div>
<p>Identifies successful GetBlob operations on Azure Storage Accounts using AzCopy user agent with SAS token authentication. AzCopy is a command-line utility for copying data to and from Azure Storage. While legitimate for data migration, adversaries may abuse AzCopy with compromised SAS tokens to exfiltrate data from Azure Storage Accounts. This rule detects the first occurrence of GetBlob operations from a specific storage account using this pattern.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: new_terms</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
logs-azure.platformlogs-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/8.19/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.microsoft.com/en-us/security/blog/2025/08/27/storm-0501s-evolving-techniques-lead-to-cloud-based-ransomware/" class="ulink" target="_top">https://www.microsoft.com/en-us/security/blog/2025/08/27/storm-0501s-evolving-techniques-lead-to-cloud-based-ransomware/</a>
</li>
<li class="listitem">
<a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10" class="ulink" target="_top">https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10</a>
</li>
<li class="listitem">
<a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview" class="ulink" target="_top">https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Domain: Storage
</li>
<li class="listitem">
Data Source: Azure
</li>
<li class="listitem">
Data Source: Azure Platform Logs
</li>
<li class="listitem">
Data Source: Azure Storage
</li>
<li class="listitem">
Use Case: Threat Detection
</li>
<li class="listitem">
Tactic: Exfiltration
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 1</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_investigation_guide_4665"></a>Investigation guide</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-9/prebuilt-rule-8-19-9-azure-storage-blob-retrieval-via-azcopy.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Triage and analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating Azure Storage Blob Retrieval via AzCopy</strong></span></p>
<p>Azure Storage Accounts provide cloud storage services for blobs, files, queues, and tables. Shared Access Signatures (SAS) tokens provide delegated access to resources in a storage account with specific permissions and time constraints. AzCopy is a Microsoft command-line utility designed for efficient data transfers to and from Azure Storage. While AzCopy is a legitimate tool, adversaries may abuse it with compromised SAS tokens to exfiltrate data from Azure Storage Accounts.</p>
<p><span class="strong strong"><strong>Possible investigation steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Review the <code class="literal">azure.platformlogs.properties.accountName</code> field to identify which storage account is being accessed and assess the sensitivity of data stored in that account.
</li>
<li class="listitem">
Examine the <code class="literal">azure.platformlogs.properties.objectKey</code> field to identify the specific blob(s) being retrieved. Determine if the accessed files contain sensitive or confidential data.
</li>
<li class="listitem">
Check the <code class="literal">source.address</code> field to identify the source IP address of the request. Investigate if this IP is unusual, unexpected, or originates from an unexpected network or geographic location.
</li>
<li class="listitem">
Review the <code class="literal">azure.platformlogs.uri</code> field to examine the SAS token parameters, including:
</li>
<li class="listitem">
<code class="literal">se</code> (expiry time): Check when the SAS token expires
</li>
<li class="listitem">
<code class="literal">sp</code> (permissions): Verify what permissions were granted (e.g., "rl" for read and list)
</li>
<li class="listitem">
<code class="literal">sv</code> (API version): Note the storage service version being used
</li>
<li class="listitem">
Examine the <code class="literal">azure.platformlogs.identity.tokenHash</code> field to identify the specific SAS token signature being used. Correlate this with SAS token generation logs to determine when and how the token was created.
</li>
<li class="listitem">
Check the <code class="literal">azure.platformlogs.properties.responseBodySize</code> field to assess the volume of data being downloaded. Multiple GetBlob operations with large response sizes may indicate bulk data exfiltration.
</li>
<li class="listitem">
Search for related GetBlob operations from the same <code class="literal">source.address</code> or with the same <code class="literal">azure.platformlogs.identity.tokenHash</code> to identify patterns of systematic data retrieval.
</li>
<li class="listitem">
Review Azure Activity Logs for recent SAS token generation events or storage account key access operations that may indicate how the adversary obtained the credentials.
</li>
<li class="listitem">
Correlate this activity with ListBlobs or ListContainers operations from the same source, as adversaries often enumerate storage contents before exfiltration.
</li>
<li class="listitem">
Investigate the <code class="literal">azure.resource.group</code> field to understand which resource group the storage account belongs to and check for any recent security events or configuration changes in that resource group.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False positive analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Routine data migration or backup operations using AzCopy with SAS tokens are common in enterprise environments. If this is expected behavior for the storage account, consider adding exceptions for specific accounts or IP ranges.
</li>
<li class="listitem">
DevOps pipelines or automated workflows may use AzCopy with SAS tokens for legitimate data transfers. Review the automation configuration and add exceptions if appropriate.
</li>
<li class="listitem">
Third-party services or partners may have authorized access to storage accounts using AzCopy and SAS tokens. Verify these relationships and create exceptions for known authorized sources.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If unauthorized access is confirmed, immediately revoke the compromised SAS token to prevent further data exfiltration.
</li>
<li class="listitem">
Review and rotate any additional SAS tokens that may have been compromised through the same attack vector.
</li>
<li class="listitem">
Assess the scope of data accessed or exfiltrated during the unauthorized GetBlob operations and determine if sensitive data was compromised.
</li>
<li class="listitem">
Implement additional monitoring and alerting for the affected storage account to detect any further suspicious activity.
</li>
<li class="listitem">
Review and strengthen SAS token generation policies, including implementing shorter expiration times and more restrictive permissions.
</li>
<li class="listitem">
Consider implementing Azure Storage firewall rules or private endpoints to restrict access to storage accounts from trusted networks only.
</li>
<li class="listitem">
Investigate how the SAS token was compromised and remediate the initial access vector to prevent future incidents.
</li>
<li class="listitem">
Document the incident and update security procedures to prevent similar compromises in the future.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_setup_1122"></a>Setup</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-9/prebuilt-rule-8-19-9-azure-storage-blob-retrieval-via-azcopy.asciidoc">edit</a></div>
</div></div></div>
<p><span class="strong strong"><strong>Required Azure Storage Diagnostic Logs</strong></span></p>
<p>To ensure this rule functions correctly, the following diagnostic logs must be enabled for Azure Storage Accounts:
- StorageRead: This log captures all read operations performed on blobs in the storage account, including GetBlob operations. These logs should be streamed to the Event Hub used for the Azure integration configuration.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_rule_query_5542"></a>Rule query</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.19/docs/detections/prebuilt-rules/downloadable-packages/8-19-9/prebuilt-rule-8-19-9-azure-storage-blob-retrieval-via-azcopy.asciidoc">edit</a></div>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset: azure.platformlogs and
    event.action: GetBlob and
    azure.platformlogs.identity.type: SAS and
    azure.platformlogs.properties.userAgentHeader: AzCopy* and
    azure.platformlogs.statusCode: 200</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Exfiltration
</li>
<li class="listitem">
ID: TA0010
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0010/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0010/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Exfiltration Over Web Service
</li>
<li class="listitem">
ID: T1567
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1567/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1567/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Exfiltration to Cloud Storage
</li>
<li class="listitem">
ID: T1567.002
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1567/002/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1567/002/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-19-9-prebuilt-rules-8-19-9-appendix.html">« Appendix \: Downloadable rule update v8.19.9</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-19-9-azure-compute-restore-point-collection-deleted-by-unusual-user.html">Azure Compute Restore Point Collection Deleted by Unusual User »</a>
</span>
</div>
</body>
</html>
