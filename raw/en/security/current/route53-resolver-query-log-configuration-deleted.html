<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Route53 Resolver Query Log Configuration Deleted | Elastic Security Solution [8.14] | Elastic</title>
<meta class="elastic" name="content" content="Route53 Resolver Query Log Configuration Deleted | Elastic Security Solution [8.14]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.14]"/>
<link rel="up" href="prebuilt-rules.html" title="Prebuilt rule reference"/>
<link rel="prev" href="roshal-archive-rar-or-powershell-file-downloaded-from-the-internet.html" title="Roshal Archive (RAR) or PowerShell File Downloaded from the Internet"/>
<link rel="next" href="sip-provider-modification.html" title="SIP Provider Modification"/>
<meta class="elastic" name="product_version" content="8.14"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.14"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.14"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.14]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rules.html">Prebuilt rule reference</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="roshal-archive-rar-or-powershell-file-downloaded-from-the-internet.html">« Roshal Archive (RAR) or PowerShell File Downloaded from the Internet</a>
</span>
<span class="next">
<a href="sip-provider-modification.html">SIP Provider Modification »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="route53-resolver-query-log-configuration-deleted"></a>Route53 Resolver Query Log Configuration Deleted<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/rule-details/route53-resolver-query-log-configuration-deleted.asciidoc">edit</a></h2>
</div></div></div>
<p>Identifies when a Route53 Resolver Query Log Configuration is deleted. When a Route53 Resolver query log configuration is deleted, Resolver stops logging DNS queries and responses for the specified configuration. Adversaries may delete query log configurations to evade detection or cover their tracks.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-aws.cloudtrail*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: medium</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 47</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 10m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-60m (<a href="/guide/en/elasticsearch/reference/8.14/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://docs.aws.amazon.com/Route53/latest/APIReference/API_route53resolver_DeleteResolverQueryLogConfig.html" class="ulink" target="_top">https://docs.aws.amazon.com/Route53/latest/APIReference/API_route53resolver_DeleteResolverQueryLogConfig.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Domain: Cloud
</li>
<li class="listitem">
Data Source: AWS
</li>
<li class="listitem">
Data Source: Amazon Web Services
</li>
<li class="listitem">
Data Source: Amazon Route53
</li>
<li class="listitem">
Use Case: Log Auditing
</li>
<li class="listitem">
Resources: Investigation Guide
</li>
<li class="listitem">
Tactic: Defense Evasion
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 2</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_investigation_guide_409"></a>Investigation guide<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/rule-details/route53-resolver-query-log-configuration-deleted.asciidoc">edit</a></h3>
</div></div></div>
<p><span class="strong strong"><strong>Triage and Analysis</strong></span></p>
<p><span class="strong strong"><strong>Investigating Route53 Resolver Query Log Configuration Deleted</strong></span></p>
<p>This rule detects when a Route53 Resolver Query Log Configuration is deleted. Deleting these configurations stops the logging of DNS queries and responses, which can significantly impede network monitoring and compromise security visibility. Adversaries may delete these configurations to evade detection, remove evidence, or obscure their activities within a network.</p>
<p>Adversaries target Route53 Resolver query log configurations because these logs can contain evidence of malicious domain queries or responses. By deleting these logs, an adversary can prevent the capture of information that could reveal unauthorized network activities, aiding in avoiding detection and thwarting incident response efforts.</p>
<p><span class="strong strong"><strong>Possible Investigation Steps</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Review the Deletion Details</strong></span>: Examine the CloudTrail logs to identify when and by whom the deletion was initiated.
</li>
<li class="listitem">
Check the <code class="literal">event.action</code> and <code class="literal">user_identity</code> elements to understand the scope and authorization of the deletion.
</li>
<li class="listitem">
<span class="strong strong"><strong>Contextualize with User Actions</strong></span>: Assess whether the deletion aligns with the user’s role and job responsibilities.
</li>
<li class="listitem">
Investigate if similar modifications have occurred recently that could suggest a pattern or broader campaign.
</li>
<li class="listitem">
<span class="strong strong"><strong>Analyze Access Patterns and Permissions</strong></span>: Verify whether the user had the appropriate permissions to delete log configurations.
</li>
<li class="listitem">
Investigate any recent permission changes that might indicate role abuse or credentials compromise.
</li>
<li class="listitem">
<span class="strong strong"><strong>Correlate with Other Security Incidents</strong></span>: Look for related security alerts or incidents that could be connected to the log deletion.
</li>
<li class="listitem">
This includes unusual network traffic, alerts from other AWS services, or findings from intrusion detection systems.
</li>
<li class="listitem">
<span class="strong strong"><strong>Interview the Responsible Team</strong></span>: If the deletion was initiated by an internal team member, confirm their intent and authorization to ensure it was a legitimate action.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>False Positive Analysis</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Legitimate Administrative Actions</strong></span>: Confirm that the deletion was part of scheduled IT operations or network management activities, possibly linked to maintenance or infrastructure updates. Validate this action against change management records or through interviews with relevant personnel.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Response and Remediation</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Restore Logs if Feasible</strong></span>: If the deletion was unauthorized, consider restoring the configuration from backups to ensure continuous visibility into DNS queries.
</li>
<li class="listitem">
<span class="strong strong"><strong>Review and Tighten Permissions</strong></span>: Ensure that only authorized personnel have the capability to delete critical configurations.
</li>
<li class="listitem">
Adjust AWS IAM policies to reinforce security measures.
</li>
<li class="listitem">
<span class="strong strong"><strong>Enhance Monitoring of Log Management</strong></span>: Implement or enhance monitoring rules to detect and alert on unauthorized changes to logging configurations, focusing on critical deletions.
</li>
<li class="listitem">
<span class="strong strong"><strong>Conduct Comprehensive Security Review</strong></span>: If the deletion is verified as malicious, initiate a thorough security assessment to identify any further unauthorized changes or ongoing malicious activities.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Additional Information</strong></span></p>
<p>For detailed instructions on managing Route53 Resolver and securing its configurations, refer to the <a href="https://docs.aws.amazon.com/Route53/latest/APIReference/API_route53resolver_DeleteResolverQueryLogConfig.html" class="ulink" target="_top">Amazon Route53 Resolver documentation</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_rule_query_787"></a>Rule query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.14/docs/detections/prebuilt-rules/rule-details/route53-resolver-query-log-configuration-deleted.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.dataset:aws.cloudtrail and event.provider: route53resolver.amazonaws.com
    and event.action: DeleteResolverQueryLogConfig and event.outcome: success</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Defense Evasion
</li>
<li class="listitem">
ID: TA0005
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0005/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0005/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Impair Defenses
</li>
<li class="listitem">
ID: T1562
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Sub-technique:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Disable or Modify Cloud Logs
</li>
<li class="listitem">
ID: T1562.008
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/techniques/T1562/008/" class="ulink" target="_top">https://attack.mitre.org/techniques/T1562/008/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="roshal-archive-rar-or-powershell-file-downloaded-from-the-internet.html">« Roshal Archive (RAR) or PowerShell File Downloaded from the Internet</a>
</span>
<span class="next">
<a href="sip-provider-modification.html">SIP Provider Modification »</a>
</span>
</div>
</div>
</body>
</html>
