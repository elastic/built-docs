<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cross-cluster search and detection rules | Elastic Security Solution [8.15] | Elastic</title>
<meta class="elastic" name="content" content="Cross-cluster search and detection rules | Elastic Security Solution [8.15]">

<link rel="home" href="index.html" title="Elastic Security Solution [8.15]"/>
<link rel="up" href="rules-ui-create.html" title="Create a detection rule"/>
<link rel="prev" href="rules-ui-create.html" title="Create a detection rule"/>
<link rel="next" href="interactive-investigation-guides.html" title="Launch Timeline from investigation guides"/>
<meta class="elastic" name="product_version" content="8.15"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/8.15"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="8.15"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="rules-ui-create.html">« Create a detection rule</a>
</span>
<span class="next">
<a href="interactive-investigation-guides.html">Launch Timeline from investigation guides »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [8.15]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="rules-ui-create.html">Create a detection rule</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Cross-cluster search and detection rules</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/rules-cross-cluster-search.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="rules-cross-cluster-search"></a>Cross-cluster search and detection rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/rules-cross-cluster-search.asciidoc">edit</a></h2>
</div></div></div>
<p><a href="/guide/en/elasticsearch/reference/8.15/modules-cross-cluster-search.html" class="ulink" target="_top">Cross-cluster search</a> is an Elasticsearch feature that allows one cluster (the <em>local</em> cluster) to query data in a separate cluster (the <em>remote</em> cluster). Elastic Security&#8217;s detection rules can perform a cross-cluster search to query data in remote clusters.</p>
<h4><a id="set-up-ccs-rules"></a>Set up cross-cluster search in detection rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/rules-cross-cluster-search.asciidoc">edit</a></h4>
<p>This section explains the general process for setting up cross-cluster search in detection rules. For specific instructions on each part of the process, refer to the linked documentation.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This procedure uses TLS certificate authentication to add remote clusters. Elastic Stack 8.10.0 introduces an alternate method using <a href="/guide/en/elasticsearch/reference/8.15/remote-clusters-api-key.html" class="ulink" target="_top">API key authentication</a>, but it is not yet supported for detection rules.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the local cluster, <a href="/guide/en/elasticsearch/reference/8.15/remote-clusters-cert.html" class="ulink" target="_top">establish trust and set up a connection</a> to the remote cluster. Note the unique name that you give to the remote cluster, because you&#8217;ll need to use it throughout this process.
</li>
<li class="listitem">
<p>On both the local and remote clusters, <a href="/guide/en/elasticsearch/reference/8.15/remote-clusters-cert.html#clusters-privileges-ccs-kibana-cert" class="ulink" target="_top">create a
role for cross-cluster search privileges</a>, and make sure the two roles have
<em>identical</em> names. Assign each role the following privileges:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Local cluster role</strong></span>: Assign the <code class="literal">read</code> privilege to the indices you want to search, using <em>both</em> the local and remote index patterns for each index. To specify a remote index, use the pattern <code class="literal">&lt;remote_cluster_name&gt;:&lt;index_name&gt;</code>.</p>
<p>For example, if the remote cluster&#8217;s name is <code class="literal">remote-security-data</code> and you want to query the <code class="literal">logs-*</code> indices, include both the <code class="literal">logs-*</code> and <code class="literal">remote-security-data:logs-*</code> index patterns and assign them the <code class="literal">read</code> privilege.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ccs-local-role.png" alt="Local cluster role configuration">
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Remote cluster role</strong></span>: Assign the <code class="literal">read</code> and <code class="literal">read_cross_cluster</code> privileges to the indices you want to search. You don&#8217;t need to include the remote cluster&#8217;s name here.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ccs-remote-role.png" alt="Remote cluster role configuration">
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>On the local cluster:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Assign the role you just created to a user who you want to configure your cross-cluster detection rules.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
This step ensures that the privileges to read remote indices are applied from the user to the rule itself. When a user creates a new rule or saves edits to an existing rule, their current privileges are saved to the rule&#8217;s API key. If that user’s privileges change in the future, the rule&#8217;s API key will not update until you manually update it. Refer to <a class="xref" href="rules-cross-cluster-search.html#update-api-key" title="Update a rule&#8217;s API key">Update a rule&#8217;s API key</a> for details.
</li>
<li class="listitem">
This user must also have the <a class="xref" href="detections-permissions-section.html#enable-detections-ui" title="Enable and access detections">appropriate privileges</a> to manage and preview rules.
</li>
</ul>
</div>
</div>
</div>
</li>
<li class="listitem">
<p>As this user, <a class="xref" href="rules-ui-create.html" title="Create a detection rule">configure a rule</a> that searches the remote indices: create or edit a rule, then enter the <code class="literal">&lt;remote_cluster_name&gt;:&lt;index_name&gt;</code> pattern in the <span class="strong strong"><strong>Source</strong></span> section.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ccs-rule-source.png" alt="Rule source configuration">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If the rule&#8217;s <span class="strong strong"><strong>Source</strong></span> uses a data view instead of index patterns, you must define the data view for cross-cluster search separately, using the <code class="literal">&lt;remote_cluster_name&gt;:&lt;index_name&gt;</code> pattern. Refer to <a href="/guide/en/kibana/8.15/data-views.html#management-cross-cluster-search" class="ulink" target="_top">Use data views with cross-cluster search</a> for more on defining a data view.</p>
</div>
</div>
</li>
<li class="listitem">
<p>(Optional) <a class="xref" href="rules-ui-create.html#preview-rules" title="Preview your rule (optional)">Preview the rule</a> to test its expected results.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The rule preview uses the current user&#8217;s cross-cluster search privileges, while the rule itself runs using the privileges snapshot saved in its API key the moment the key is created. The preview results could be different from the rule&#8217;s actual behavior if the user performing the preview has different privileges than what&#8217;s saved in the rule&#8217;s API key.</p>
</div>
</div>
</li>
<li class="listitem">
Save and enable the rule.
</li>
</ol>
</div>
</li>
</ol>
</div>
<h4><a id="update-api-key"></a>Update a rule&#8217;s API key<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/8.15/docs/detections/rules-cross-cluster-search.asciidoc">edit</a></h4>
<p>When a user creates a new rule or saves edits to an existing rule, their current privileges are saved to <a href="/guide/en/kibana/8.15/alerting-setup.html#alerting-authorization" class="ulink" target="_top">the rule&#8217;s API key</a>. If that user&#8217;s privileges change in the future, the rule <span class="strong strong"><strong><em>does not</em></strong></span> automatically update with the user&#8217;s latest privileges — you must update the rule&#8217;s API key to update its privileges.</p>
<p>To update a rule&#8217;s API key, log into the local cluster as a user with the privileges you want to apply to the rule, then do either of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Edit and save the rule.
</li>
<li class="listitem">
<p>Update the rule&#8217;s API key manually:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to Kibana &#8594; <span class="strong strong"><strong>Stack Management</strong></span> &#8594; <span class="strong strong"><strong>Rules</strong></span>.
</li>
<li class="listitem">
Use the search box and filters to find the rules you want to update. For example, use the <span class="strong strong"><strong>Type</strong></span> filter to find rules under the <span class="strong strong"><strong>Security</strong></span> category.
</li>
<li class="listitem">
<p>Select the rule&#8217;s actions menu (<span class="strong strong"><strong>&#8230;&#8203;</strong></span>), then <span class="strong strong"><strong>Update API key</strong></span>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To update multiple rules, select their checkboxes, then click <span class="strong strong"><strong>Selected <em>x</em> rules</strong></span> &#8594; <span class="strong strong"><strong>Update API keys</strong></span>.</p>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="rules-ui-create.html">« Create a detection rule</a>
</span>
<span class="next">
<a href="interactive-investigation-guides.html">Launch Timeline from investigation guides »</a>
</span>
</div>
</body>
</html>
