<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Get started with CSPM for Azure | Elastic Security Solution [master] | Elastic</title>
<meta class="elastic" name="content" content="Get started with CSPM for Azure | Elastic Security Solution [master]">

<link rel="home" href="index.html" title="Elastic Security Solution [master]"/>
<link rel="up" href="cspm.html" title="Cloud security posture management"/>
<link rel="prev" href="cspm-get-started-gcp.html" title="Get started with CSPM for GCP"/>
<link rel="next" href="cspm-findings-page.html" title="Findings page"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/master"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="cloud-native-security-overview.html">Cloud native security</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="cspm.html">Cloud security posture management</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="cspm-get-started-gcp.html">« Get started with CSPM for GCP</a>
</span>
<span class="next">
<a href="cspm-findings-page.html">Findings page »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="cspm-get-started-azure"></a>Get started with CSPM for Azure<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h2>
</div></div></div>
<h4><a id="cspm-overview-azure"></a>Overview<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h4>
<p>This page explains how to get started monitoring the security posture of your cloud assets using the Cloud Security Posture Management (CSPM) feature.</p>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Requirements</strong></p>
</div></div></div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The CSPM integration is available to all Elastic Cloud users. On-premise deployments require an <a href="/pricing" class="ulink" target="_top">Enterprise subscription</a>.
</li>
<li class="listitem">
CSPM only works in the <code class="literal">Default</code> Kibana space. Installing the CSPM integration on a different Kibana space will not work.
</li>
<li class="listitem">
CSPM is supported only on AWS, GCP, and Azure commercial cloud platforms, and AWS GovCloud. Other government cloud platforms are not supported. <a href="https://github.com/elastic/kibana/issues/new/choose" class="ulink" target="_top">Click here to request support</a>.
</li>
<li class="listitem">
<p>To view posture data, you need <code class="literal">read</code> privileges for the following Elasticsearch indices:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">logs-cloud_security_posture.findings_latest-*</code>
</li>
<li class="listitem">
<code class="literal">logs-cloud_security_posture.scores-*</code>
</li>
<li class="listitem">
<code class="literal">logs-cloud_security_posture.findings</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
The user who gives the CSPM integration permissions in Azure must be an Azure subscription <code class="literal">admin</code>.
</li>
</ul>
</div>
</div>
<h4><a id="cspm-setup-azure"></a>Set up CSPM for Azure<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h4>
<p>You can set up CSPM for Azure by by enrolling an Azure organization (management group) containing multiple subscriptions, or by enrolling a single subscription. Either way, first add the CSPM integration, then enable cloud account access.</p>
<h5><a id="cspm-add-and-name-integration-azure"></a>Add your CSPM integration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
From the Elastic Security <span class="strong strong"><strong>Get started</strong></span> page, click <span class="strong strong"><strong>Add integrations</strong></span>.
</li>
<li class="listitem">
Search for <code class="literal">CSPM</code>, then click on the result.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM)</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Configure integration</strong></span>, select <span class="strong strong"><strong>Azure</strong></span>, then select either <span class="strong strong"><strong>Azure Organization</strong></span> or <span class="strong strong"><strong>Single Subscription</strong></span>, depending on which resources you want to monitor.
</li>
<li class="listitem">
Give your integration a name that matches the purpose or team of the Azure resources you want to monitor, for example, <code class="literal">azure-CSPM-dev-1</code>.
</li>
</ol>
</div>
<h5><a id="cspm-set-up-cloud-access-section-azure"></a>Set up cloud account access<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h5>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To set up CSPM for an Azure organization or subscription, you will need admin privileges for that organization or subscription.</p>
</div>
</div>
<p>For most users, the simplest option is to use an Azure Resource Manager (ARM) template to automatically provision the necessary resources and permissions in Azure. If you prefer a more hands-on approach or require a specific configuration not supported by the ARM template, you can use one of the manual setup options described below.</p>
<h4><a id="cspm-set-up-ARM"></a>ARM template setup (recommended)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are deploying to an Azure organization, you need the following permissions: <code class="literal">Microsoft.Resources/deployments/*</code>, <code class="literal">Microsoft.Authorization/roleAssignments/write</code>. You also need to <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin" class="ulink" target="_top">elevate access to manage all Azure subscriptions and management groups</a>.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Under <span class="strong strong"><strong>Setup Access</strong></span>, select <span class="strong strong"><strong>ARM Template</strong></span>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Where to add this integration</strong></span>:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Select <span class="strong strong"><strong>New Hosts</strong></span>.
</li>
<li class="listitem">
Name the Elastic Agent policy. Use a name that matches the resources you want to monitor. For example, <code class="literal">azure-dev-policy</code>. Click <span class="strong strong"><strong>Save and continue</strong></span>. The <span class="strong strong"><strong>ARM Template deployment</strong></span> window appears.
</li>
<li class="listitem">
In a new tab, log in to the Azure portal, then return to Kibana and click <span class="strong strong"><strong>Launch ARM Template</strong></span>. This will open the ARM template in Azure.
</li>
<li class="listitem">
If you are deploying to an Azure organization, select the management group you want to monitor from the drop-down menu. Next, enter the subscription ID of the subscription where you want to deploy the VM that will scan your resources.
</li>
<li class="listitem">
Copy the <code class="literal">Fleet URL</code> and <code class="literal">Enrollment Token</code> that appear in Kibana to the corresponding fields in the ARM Template, then click <span class="strong strong"><strong>Review + create</strong></span>.
</li>
<li class="listitem">
(Optional) Change the <code class="literal">Resource Group Name</code> parameter. Otherwise the name of the resource group defaults to a timestamp prefixed with <code class="literal">cloudbeat-</code>.
</li>
</ol>
</div>
</li>
<li class="listitem">
Return to Kibana and wait for the confirmation of data received from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.
</li>
</ol>
</div>
<h4><a id="cspm-set-up-manual-azure"></a>Manual setup<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h4>
<p>For manual setup, multiple authentication methods are available:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Managed identity (recommended)
</li>
<li class="listitem">
Service principal with client secret
</li>
<li class="listitem">
Service principal with client certificate
</li>
</ul>
</div>
<h5><a id="cspm-azure-managed-identity-setup"></a>Option 1: Managed identity (recommended)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h5>
<p>This method involves creating an Azure VM (or using an existing one), giving it read access to the resources you want to monitor with CSPM, and installing Elastic Agent on it.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to the Azure portal to <a href="https://portal.azure.com/#create/Microsoft.VirtualMachine-ARM" class="ulink" target="_top">create a new Azure VM</a>.
</li>
<li class="listitem">
Follow the setup process, and make sure you enable <span class="strong strong"><strong>System assigned managed identity</strong></span> under the <span class="strong strong"><strong>Management</strong></span> tab.
</li>
<li class="listitem">
Go to your Azure subscription list and select the subscription or management group you want to monitor with CSPM.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Access control (IAM)</strong></span>, and select <span class="strong strong"><strong>Add Role Assignment</strong></span>.
</li>
<li class="listitem">
Select the <code class="literal">Reader</code> function role, assign access to <span class="strong strong"><strong>Managed Identity</strong></span>, then select your VM.
</li>
</ol>
</div>
<p>After assigning the role:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Return to the <span class="strong strong"><strong>Add CSPM</strong></span> page in Kibana.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Configure integration</strong></span>, select <span class="strong strong"><strong>Azure</strong></span>. Under <span class="strong strong"><strong>Setup access</strong></span>, select <span class="strong strong"><strong>Manual</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Where to add this integration</strong></span>, select <span class="strong strong"><strong>New hosts</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then follow the instructions to install Elastic Agent on your Azure VM.
</li>
</ol>
</div>
<p>Wait for the confirmation that Kibana received data from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.</p>
<h5><a id="cspm-azure-client-secret"></a>Option 2: Service principal with client secret<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h5>
<p>Before using this method, you must have set up a <a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-create-service-principal-portal#get-tenant-and-app-id-values-for-signing-in" class="ulink" target="_top">Microsoft Entra application and service principal that can access resources</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM) integration</strong></span> page, scroll to the <span class="strong strong"><strong>Setup access</strong></span> section, then select <span class="strong strong"><strong>Manual</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Preferred manual method</strong></span>, select <span class="strong strong"><strong>Service principal with Client Secret</strong></span>.
</li>
<li class="listitem">
Go to the <span class="strong strong"><strong>Registered apps</strong></span> section of <a href="https://ms.portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps" class="ulink" target="_top">Microsoft Entra ID</a>.
</li>
<li class="listitem">
Click on <span class="strong strong"><strong>New Registration</strong></span>, name your app and click <span class="strong strong"><strong>Register</strong></span>.
</li>
<li class="listitem">
Copy your new app&#8217;s <code class="literal">Directory (tenant) ID</code> and <code class="literal">Application (client) ID</code>. Paste them into the corresponding fields in Kibana.
</li>
<li class="listitem">
Return to the Azure portal. Select <span class="strong strong"><strong>Certificates &amp; secrets</strong></span>, then go to the <span class="strong strong"><strong>Client secrets</strong></span> tab. Click <span class="strong strong"><strong>New client secret</strong></span>.
</li>
<li class="listitem">
Copy the new secret. Paste it into the corresponding field in Kibana.
</li>
<li class="listitem">
Return to Azure. Go to your Azure subscription list and select the subscription or management group you want to monitor with CSPM.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Access control (IAM)</strong></span> and select <span class="strong strong"><strong>Add Role Assignment</strong></span>.
</li>
<li class="listitem">
Select the <code class="literal">Reader</code> function role, assign access to <span class="strong strong"><strong>User, group, or service principal</strong></span>, and select your new app.
</li>
<li class="listitem">
Return to the <span class="strong strong"><strong>Add CSPM</strong></span> page in Kibana.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Where to add this integration</strong></span>, select <span class="strong strong"><strong>New hosts</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then follow the instructions to install Elastic Agent on your selected host.
</li>
</ol>
</div>
<p>Wait for the confirmation that Kibana received data from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.</p>
<h5><a id="cspm-azure-client-certificate"></a>Option 3: Service principal with client certificate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/cspm-get-started-azure.asciidoc">edit</a></h5>
<p>Before using this method, you must have set up a <a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-create-service-principal-portal#get-tenant-and-app-id-values-for-signing-in" class="ulink" target="_top">Microsoft Entra application and service principal that can access resources</a>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
On the <span class="strong strong"><strong>Add Cloud Security Posture Management (CSPM) integration</strong></span> page, under <span class="strong strong"><strong>Setup access</strong></span>, select <span class="strong strong"><strong>Manual</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Preferred manual method</strong></span>, select <span class="strong strong"><strong>Service principal with client certificate</strong></span>.
</li>
<li class="listitem">
Go to the <span class="strong strong"><strong>Registered apps</strong></span> section of <a href="https://ms.portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps" class="ulink" target="_top">Microsoft Entra ID</a>.
</li>
<li class="listitem">
Click on <span class="strong strong"><strong>New Registration</strong></span>, name your app and click <span class="strong strong"><strong>Register</strong></span>.
</li>
<li class="listitem">
Copy your new app&#8217;s <code class="literal">Directory (tenant) ID</code> and <code class="literal">Application (client) ID</code>. Paste them into the corresponding fields in Kibana.
</li>
<li class="listitem">
Return to Azure. Go to your Azure subscription list and select the subscription or management group you want to monitor with CSPM.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Access control (IAM)</strong></span> and select <span class="strong strong"><strong>Add Role Assignment</strong></span>.
</li>
<li class="listitem">
Select the <code class="literal">Reader</code> function role, assign access to <span class="strong strong"><strong>User, group, or service principal</strong></span>, and select your new app.
</li>
</ol>
</div>
<p>Next, create a certificate. If you intend to use a password-protected certificate, you must use a pkcs12 certificate. Otherwise, you must use a pem certificate.</p>
<p>Create a pkcs12 certificate, for example:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell"># Create PEM file
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes

# Create pkcs12 bundle using legacy flag (CLI will ask for export password)
openssl pkcs12 -legacy -export -out bundle.p12 -inkey key.pem -in cert.pem</pre>
</div>
<p>Create a PEM certificate, for example:</p>
<div class="pre_wrapper lang-shell">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-shell"># Generate certificate signing request (csr) and key
openssl req -new -newkey rsa:4096 -nodes -keyout cert.key -out cert.csr

# Generate PEM and self-sign with key
openssl x509 -req -sha256 -days 365 -in cert.csr -signkey cert.key -out signed.pem

# Create bundle
cat cert.key &gt; bundle.pem
cat signed.pem &gt;&gt; bundle.pem</pre>
</div>
<p>After creating your certificate:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Return to Azure.
</li>
<li class="listitem">
Navigate to the <span class="strong strong"><strong>Certificates &amp; secrets</strong></span> menu. Select the <span class="strong strong"><strong>Certificates</strong></span> tab.
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Upload certificate</strong></span>.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If you&#8217;re using a PEM certificate that was created using the example commands above, upload <code class="literal">signed.pem</code>.
</li>
<li class="listitem">
If you&#8217;re using a pkcs12 certificate that was created using the example commands above, upload <code class="literal">cert.pem</code>.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Upload the certificate bundle to the VM where you will deploy Elastic Agent.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If you&#8217;re using a PEM certificate that was created using the example commands above, upload <code class="literal">bundle.pem</code>.
</li>
<li class="listitem">
If you&#8217;re using a pkcs12 certificate that was created using the example commands above, upload <code class="literal">bundle.p12</code>.
</li>
</ol>
</div>
</li>
<li class="listitem">
Return to the <span class="strong strong"><strong>Add CSPM</strong></span> page in Kibana.
</li>
<li class="listitem">
For <span class="strong strong"><strong>Client Certificate Path</strong></span>, enter the full path to the certificate that you uploaded to the host where you will install Elastic Agent.
</li>
<li class="listitem">
If you used a pkcs12 certificate, enter its password under <span class="strong strong"><strong>Client Certificate Password</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Where to add this integration</strong></span>, select <span class="strong strong"><strong>New hosts</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save and continue</strong></span>, then follow the instructions to install Elastic Agent on your selected host.
</li>
</ol>
</div>
<p>Wait for the confirmation that Kibana received data from your new integration. Then you can click <span class="strong strong"><strong>View Assets</strong></span> to see your data.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="cspm-get-started-gcp.html">« Get started with CSPM for GCP</a>
</span>
<span class="next">
<a href="cspm-findings-page.html">Findings page »</a>
</span>
</div>
</div>
</body>
</html>
