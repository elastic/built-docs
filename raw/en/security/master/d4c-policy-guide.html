<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Container workload protection policies | Elastic Security Solution [master] | Elastic</title>
<meta class="elastic" name="content" content="Container workload protection policies | Elastic Security Solution [master]">

<link rel="home" href="index.html" title="Elastic Security Solution [master]"/>
<link rel="up" href="d4c-overview.html" title="Container workload protection"/>
<link rel="prev" href="d4c-get-started.html" title="Get started with CWP"/>
<link rel="next" href="cloud-workload-protection.html" title="Cloud workload protection for VMs"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/master"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="cloud-native-security-overview.html">Cloud native security</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="d4c-overview.html">Container workload protection</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="d4c-get-started.html">« Get started with CWP</a>
</span>
<span class="next">
<a href="cloud-workload-protection.html">Cloud workload protection for VMs »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="d4c-policy-guide"></a>Container workload protection policies<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/d4c-policy-guide.asciidoc">edit</a></h2>
</div></div></div>
<p>To unlock the full functionality of the Defend for Containers (D4C) integration, you&#8217;ll need to understand its policy syntax. This will enable you to construct policies that precisely allow expected container behaviors and prevent unexpected behaviors — thereby hardening your container workloads' security posture.</p>
<p>D4C integration policies consist of <em>selectors</em> and <em>responses</em>. Each policy must contain at least one selector and one response. Currently, the system supports two types of selectors and responses: <code class="literal">file</code> and <code class="literal">process</code>.
Selectors define which system operations to match and can include multiple conditions (grouped using a logical <code class="literal">AND</code>) to precisely select events. Responses define which actions to take when a system operation matches the conditions specified in an associated selector.</p>
<p>The default policy described on this page provides an example that&#8217;s useful for understanding D4C policies in general. Following the description, you&#8217;ll find a comprehensive glossary of selector conditions, response fields, and actions.</p>
<h4><a id="d4c-default-policies"></a>Default policies:<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/d4c-policy-guide.asciidoc">edit</a></h4>
<p>The default D4C integration policy includes two selector-response pairs. It is designed to implement core container workload protection capabilities:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Threat Detection:</strong></span> The first selector-response pair is designed to stream process telemetry data to your Elasticsearch cluster so Elastic Security can evaluate it to detect threats. Both the selector and response are named <code class="literal">allProcesses</code>. The selector selects all fork and exec events. The associated response specifies that selected events should be logged.
</li>
<li class="listitem">
<span class="strong strong"><strong>Drift Detection &amp; Prevention:</strong></span> The second selector-response pair is designed to create alerts when container drift is detected. Both the selector and response are named <code class="literal">executableChanges</code>. The selector selects all <code class="literal">createExecutable</code> and <code class="literal">modifyExecutable</code> events. The associated response specifies that the selected events should create alerts, which will be sent to your Elasticsearch cluster. You can modify the response to block drift operations by setting it to block.
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/d4c-policy-editor.png" alt="The defend for containers policy editor with the default policies">
</div>
</div>
<h4><a id="d4c-selectors-glossary"></a>Selectors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/d4c-policy-guide.asciidoc">edit</a></h4>
<p>A selector requires a name and at least one operation. It will select all events of the specified operation types, unless you also include <em>conditions</em> to narrow down the selection. Some conditions are available for both <code class="literal">file</code> and <code class="literal">process</code> selectors, while others only available for one type of selector.</p>
<h5><a id="_common_conditions"></a>Common conditions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/d4c-policy-guide.asciidoc">edit</a></h5>
<p>These conditions are available for both <code class="literal">file</code> and <code class="literal">process</code> selectors.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>containerImageFullName</p></td>
<td align="left" valign="top"><p>A list of full container image names to match on. For example: <code class="literal">docker.io/nginx</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>containerImageName</p></td>
<td align="left" valign="top"><p>A list of container image names to match on. For example: <code class="literal">nginx</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>containerImageTag</p></td>
<td align="left" valign="top"><p>A list of container image tags to match on. For example: <code class="literal">latest</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>kubernetesClusterId</p></td>
<td align="left" valign="top"><p>A list of Kubernetes cluster IDs to match on. For consistency with KSPM, the <code class="literal">kube-system</code> namespace&#8217;s UID is used as a cluster ID.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>kubernetesClusterName</p></td>
<td align="left" valign="top"><p>A list of Kubernetes cluster names to match on.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>kubernetesNamespace</p></td>
<td align="left" valign="top"><p>A list of Kubernetes namespaces to match on.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>kubernetesPodName</p></td>
<td align="left" valign="top"><p>A list of Kubernetes pod names to match on. Trailing wildcards supported.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>kubernetesPodLabel</p></td>
<td align="left" valign="top"><p>A list of resource labels. Trailing wildcards supported (value only), for example: <code class="literal">key1:val*</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_file_selector_conditions"></a>File-selector conditions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/d4c-policy-guide.asciidoc">edit</a></h5>
<p>These conditions are available only for <code class="literal">file</code> selectors.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>operation</p></td>
<td align="left" valign="top"><p>The list of system operations to match on. Options include <code class="literal">createExecutable</code>, <code class="literal">modifyExecutable</code>, <code class="literal">createFile</code>, <code class="literal">modifyFile</code>, <code class="literal">deleteFile</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>ignoreVolumeMounts</p></td>
<td align="left" valign="top"><p>If set, ignores file operations on <em>all</em> volume mounts.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>ignoreVolumeFiles</p></td>
<td align="left" valign="top"><p>If set, ignores operations on file mounts only. For example: mounted files, <code class="literal">configMaps</code>, and secrets.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>targetFilePath</p></td>
<td align="left" valign="top"><p>A list of file paths to include. Paths are absolute and wildcards are supported. The <code class="literal">*</code> wildcard matches any sequence of characters within a single directory, while the <code class="literal">**</code> wildcard matches any sequence of characters across multiple directories and subdirectories.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>In order to ensure precise targeting of file integrity monitoring operations, a <code class="literal">TargetFilePath</code> is required whenever the <code class="literal">deleteFile</code>, <code class="literal">modifyFile</code>, or <code class="literal">createFile</code> operations are used within a selector.</p>
</div>
</div>
<h5><a id="_process_selector_conditions"></a>Process-selector conditions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/d4c-policy-guide.asciidoc">edit</a></h5>
<p>These conditions are available only for <code class="literal">process</code> selectors.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>operation</p></td>
<td align="left" valign="top"><p>The list of system operations to match on. Options include <code class="literal">fork</code> and <code class="literal">exec</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>processExecutable</p></td>
<td align="left" valign="top"><p>A list of executables (full path included) to match on. For example: <code class="literal">/usr/bin/cat</code>. Wildcard support is same as targetFilePath above.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>processName</p></td>
<td align="left" valign="top"><p>A list of process names (executable basename) to match on. For example: <code class="literal">bash</code>, <code class="literal">vi</code>, <code class="literal">cat</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>sessionLeaderInteractive</p></td>
<td align="left" valign="top"><p>If set to <code class="literal">true</code>, will only match on interactive sessions (defined as sessions with a controlling TTY).</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_response_fields"></a>Response fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/d4c-policy-guide.asciidoc">edit</a></h5>
<p>A policy can include one or more responses. Each response is comprised of the following fields:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Field</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>match</p></td>
<td align="left" valign="top"><p>An array of one or more selectors of the same type (<code class="literal">file</code> or <code class="literal">process</code>).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>exclude</p></td>
<td align="left" valign="top"><p>Optional. An array of one or more selectors to use as exclusions to everything in <code class="literal">match</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>actions</p></td>
<td align="left" valign="top"><p>An array of actions to perform when at least one <code class="literal">match</code> selector matches and none of the <code class="literal">exclude</code> selectors match. Options include <code class="literal">log</code>, <code class="literal">alert</code>, and <code class="literal">block</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<h5><a id="_response_actions"></a>Response actions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/cloud-native-security/d4c-policy-guide.asciidoc">edit</a></h5>
<p>D4C responses can include the following actions:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Action</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>log</p></td>
<td align="left" valign="top"><p>Sends events to the <code class="literal">logs-cloud_defend.file-*</code> data stream for file responses, and the <code class="literal">logs-cloud_defend.process-*</code> data stream for process responses.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>alert</p></td>
<td align="left" valign="top"><p>Writes events (file or process) to the logs-cloud_defend.alerts-* data stream.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>block</p></td>
<td align="left" valign="top">
<p>Prevents the system operation from proceeding. This blocking action happens prior to the execution of the event. It is required that the alert action be set if block is enabled.</p>
<p><span class="strong strong"><strong>Note:</strong></span> Currently, block is only supported on file operations.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="d4c-get-started.html">« Get started with CWP</a>
</span>
<span class="next">
<a href="cloud-workload-protection.html">Cloud workload protection for VMs »</a>
</span>
</div>
</div>
</body>
</html>
