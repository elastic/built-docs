<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Threat Intel Filebeat Module (v7.x) Indicator Match | Elastic Security Solution [master] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Security Solution [master]"/>
<link rel="up" href="prebuilt-rule-0-14-3-prebuilt-rules-0-14-3-appendix.html" title="Appendix F: Downloadable rule update v0.14.3"/>
<link rel="prev" href="prebuilt-rule-0-14-3-hosts-file-modified.html" title="Hosts File Modified"/>
<link rel="next" href="prebuilt-rule-0-14-3-gcp-virtual-private-cloud-route-creation.html" title="GCP Virtual Private Cloud Route Creation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/master"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-0-14-3-prebuilt-rules-0-14-3-appendix.html">Downloadable rule update v0.14.3</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-0-14-3-hosts-file-modified.html">« Hosts File Modified</a>
</span>
<span class="next">
<a href="prebuilt-rule-0-14-3-gcp-virtual-private-cloud-route-creation.html">GCP Virtual Private Cloud Route Creation »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="prebuilt-rule-0-14-3-threat-intel-filebeat-module-v7-x-indicator-match"></a>Threat Intel Filebeat Module (v7.x) Indicator Match<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/prebuilt-rules/downloadable-packages/0-14-3/prebuilt-rule-0-14-3-threat-intel-filebeat-module-v7-x-indicator-match.asciidoc">edit</a></h2>
</div></div></div>
<p>This rule is triggered when indicators from the Threat Intel Filebeat module (v7.x) has a match against local file or network observations.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: threat_match</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
auditbeat-*
</li>
<li class="listitem">
endgame-*
</li>
<li class="listitem">
filebeat-*
</li>
<li class="listitem">
logs-*
</li>
<li class="listitem">
packetbeat-*
</li>
<li class="listitem">
winlogbeat-*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: critical</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 99</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 1h</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-65m (<a href="/guide/en/elasticsearch/reference/master/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/beats/filebeat/current/filebeat-module-threatintel.html" class="ulink" target="_top">https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-threatintel.html</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Elastic Endgame
</li>
<li class="listitem">
Network
</li>
<li class="listitem">
Continuous Monitoring
</li>
<li class="listitem">
SecOps
</li>
<li class="listitem">
Monitoring
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 4</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_investigation_guide_647"></a>Investigation guide<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/prebuilt-rules/downloadable-packages/0-14-3/prebuilt-rule-0-14-3-threat-intel-filebeat-module-v7-x-indicator-match.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-markdown">
<pre class="programlisting prettyprint lang-markdown">## Triage and Analysis

### Investigating Threat Intel Indicator Matches

Threat Intel indicator match rules allow matching from a local observation such as an endpoint event that records a file
hash with an entry of a file hash stored within the Threat Intel Filebeat module. Other examples of matches can occur on
an IP address, registry path, URL and imphash.

The matches will be based on the incoming feed data so it's important to validate the data and review the results by
investigating the associated activity to determine if it requires further investigation.

If an indicator matches a local observation, the following enriched fields will be generated to identify the indicator, field, and type matched.

- `threatintel.indicator.matched.atomic` - this identifies the atomic indicator that matched the local observation
- `threatintel.indicator.matched.field` - this identifies the indicator field that matched the local observation
- `threatintel.indicator.matched.type` - this identifies the indicator type that matched the local observation

#### Possible investigation steps:
- Investigation should be validated and reviewed based on the data (file hash, registry path, URL, imphash) that was matched
and viewing the source of that activity.
- Consider the history of the indicator that was matched. Has it happened before? Is it happening on multiple machines?
These kinds of questions can help understand if the activity is related to legitimate behavior.
- Consider the user and their role within the company, is this something related to their job or work function?

### False Positive Analysis
- For any matches found, it's important to consider the initial release date of that indicator. Threat intelligence can
be a great tool for augmenting existing security processes, while at the same time it should be understood that threat
intelligence can represent a specific set of activity observed at a point in time. For example, an IP address
may have hosted malware observed in a Dridex campaign six months ago, but it's possible that IP has been remediated and
no longer represents any threat.
- Adversaries often use legitimate tools as network administrators such as `PsExec` or `AdFind`, these tools often find their
way into indicator lists creating the potential for false positives.
- It's possible after large and publicly written campaigns, curious employees might end up going directly to attacker infrastructure and generating these rules

### Response and Remediation
- If suspicious or malicious behavior is observed, immediate response should be taken to isolate activity to prevent further
post-compromise behavior.
- One example of a response if a machine matched a command and control IP address would be to add an entry to a network
device such as a firewall or proxy appliance to prevent any outbound activity from leaving that machine.
- Another example of a response with a malicious file hash match would involve validating if the file was properly quarantined,
review current running processes looking for any abnormal activity, and investigating for any other follow-up actions such as persistence or lateral movement</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_rule_query_954"></a>Rule query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/prebuilt-rules/downloadable-packages/0-14-3/prebuilt-rule-0-14-3-threat-intel-filebeat-module-v7-x-indicator-match.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">file.hash.*:* or file.pe.imphash:* or source.ip:* or destination.ip:* or url.full:* or registry.path:*</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-0-14-3-hosts-file-modified.html">« Hosts File Modified</a>
</span>
<span class="next">
<a href="prebuilt-rule-0-14-3-gcp-virtual-private-cloud-route-creation.html">GCP Virtual Private Cloud Route Creation »</a>
</span>
</div>
</div>
</body>
</html>
