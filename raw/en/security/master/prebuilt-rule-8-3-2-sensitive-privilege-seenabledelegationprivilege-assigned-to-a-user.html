<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sensitive Privilege SeEnableDelegationPrivilege assigned to a User | Elastic Security Solution [master] | Elastic</title>
<meta class="elastic" name="content" content="Sensitive Privilege SeEnableDelegationPrivilege assigned to a User | Elastic Security Solution [master]">

<link rel="home" href="index.html" title="Elastic Security Solution [master]"/>
<link rel="up" href="prebuilt-rule-8-3-2-prebuilt-rules-8-3-2-appendix.html" title="Appendix K: Downloadable rule update v8.3.2"/>
<link rel="prev" href="prebuilt-rule-8-3-2-searching-for-saved-credentials-via-vaultcmd.html" title="Searching for Saved Credentials via VaultCmd"/>
<link rel="next" href="prebuilt-rule-8-3-2-user-account-exposed-to-kerberoasting.html" title="User account exposed to Kerberoasting"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/master"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="prebuilt-rule-8-3-2-searching-for-saved-credentials-via-vaultcmd.html">« Searching for Saved Credentials via VaultCmd</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-3-2-user-account-exposed-to-kerberoasting.html">User account exposed to Kerberoasting »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="prebuilt-rule-8-3-2-prebuilt-rules-8-3-2-appendix.html">Downloadable rule update v8.3.2</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Sensitive Privilege SeEnableDelegationPrivilege assigned to a User</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/prebuilt-rules/downloadable-packages/8-3-2/prebuilt-rule-8-3-2-sensitive-privilege-seenabledelegationprivilege-assigned-to-a-user.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="prebuilt-rule-8-3-2-sensitive-privilege-seenabledelegationprivilege-assigned-to-a-user"></a>Sensitive Privilege SeEnableDelegationPrivilege assigned to a User<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/prebuilt-rules/downloadable-packages/8-3-2/prebuilt-rule-8-3-2-sensitive-privilege-seenabledelegationprivilege-assigned-to-a-user.asciidoc">edit</a></h2>
</div></div></div>
<p>Identifies the assignment of the SeEnableDelegationPrivilege sensitive "user right" to a user. The SeEnableDelegationPrivilege "user right" enables computer and user accounts to be trusted for delegation. Attackers can abuse this right to compromise Active Directory accounts and elevate their privileges.</p>
<p><span class="strong strong"><strong>Rule type</strong></span>: query</p>
<p><span class="strong strong"><strong>Rule indices</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
winlogbeat-*
</li>
<li class="listitem">
logs-system.*
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Severity</strong></span>: high</p>
<p><span class="strong strong"><strong>Risk score</strong></span>: 73</p>
<p><span class="strong strong"><strong>Runs every</strong></span>: 5m</p>
<p><span class="strong strong"><strong>Searches indices from</strong></span>: now-9m (<a href="/guide/en/elasticsearch/reference/master/common-options.html#date-math" class="ulink" target="_top">Date Math format</a>, see also <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule"><code class="literal">Additional look-back time</code></a>)</p>
<p><span class="strong strong"><strong>Maximum alerts per execution</strong></span>: 100</p>
<p><span class="strong strong"><strong>References</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://blog.harmj0y.net/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/" class="ulink" target="_top">https://blog.harmj0y.net/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/</a>
</li>
<li class="listitem">
<a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_alert_active_directory_user_control.yml" class="ulink" target="_top">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_alert_active_directory_user_control.yml</a>
</li>
<li class="listitem">
<a href="https://twitter.com/_nwodtuhs/status/1454049485080907776" class="ulink" target="_top">https://twitter.com/_nwodtuhs/status/1454049485080907776</a>
</li>
<li class="listitem">
<a href="https://www.thehacker.recipes/ad/movement/kerberos/delegations" class="ulink" target="_top">https://www.thehacker.recipes/ad/movement/kerberos/delegations</a>
</li>
<li class="listitem">
<a href="https://github.com/atc-project/atomic-threat-coverage/blob/master/Atomic_Threat_Coverage/Logging_Policies/LP_0105_windows_audit_authorization_policy_change.md" class="ulink" target="_top">https://github.com/atc-project/atomic-threat-coverage/blob/master/Atomic_Threat_Coverage/Logging_Policies/LP_0105_windows_audit_authorization_policy_change.md</a>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Tags</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
<li class="listitem">
Host
</li>
<li class="listitem">
Windows
</li>
<li class="listitem">
Threat Detection
</li>
<li class="listitem">
Credential Access
</li>
<li class="listitem">
Active Directory
</li>
<li class="listitem">
has_guide
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Version</strong></span>: 101</p>
<p><span class="strong strong"><strong>Rule authors</strong></span>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Elastic
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Rule license</strong></span>: Elastic License v2</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_investigation_guide_1732"></a>Investigation guide<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/prebuilt-rules/downloadable-packages/8-3-2/prebuilt-rule-8-3-2-sensitive-privilege-seenabledelegationprivilege-assigned-to-a-user.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-markdown">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-markdown">## Triage and analysis

### Investigating Sensitive Privilege SeEnableDelegationPrivilege assigned to a User

Kerberos delegation is an Active Directory feature that allows user and computer accounts to impersonate other accounts,
act on their behalf, and use their privileges. Delegation (constrained and unconstrained) can be configured
for user and computer objects.

Enabling unconstrained delegation for a computer causes the computer to store the ticket-granting ticket
(TGT) in memory at any time an account connects to the computer, so it can be used by the computer for impersonation
when needed. Risk is heightened if an attacker compromises computers with unconstrained delegation enabled, as they
could extract TGTs from memory and then replay them to move laterally on the domain. If the attacker coerces a privileged
user to connect to the server, or if the user does so routinely, the account will be compromised and the attacker will
be able to pass-the-ticket to privileged assets.

SeEnableDelegationPrivilege is a user right that is controlled within the Local Security Policy of a domain controller
and is managed through Group Policy. This setting is named **Enable computer and user accounts to be trusted for
delegation**.

It is critical to control the assignment of this privilege. A user with this privilege and write access to a computer
can control delegation settings, perform the attacks described above, and harvest TGTs from any user that connects to
the system.

#### Possible investigation steps

- Investigate how the privilege was assigned to the user and who assigned it.
- Investigate other potentially malicious activity that was performed by the user that assigned the privileges using the
`user.id` and `winlog.activity_id` fields as a filter during the past 48 hours.
- Investigate other alerts associated with the users/host during the past 48 hours.

### False positive analysis

- The SeEnableDelegationPrivilege privilege should not be assigned to users. If this rule is triggered in your
environment legitimately, the security team should notify the administrators about the risks of using it.

### Related rules

- KRBTGT Delegation Backdoor - e052c845-48d0-4f46-8a13-7d0aba05df82

### Response and remediation

- Initiate the incident response process based on the outcome of the triage.
- Remove the privilege from the account.
- Review the privileges of the administrator account that performed the action.
- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.
- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the
mean time to respond (MTTR).</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_rule_query_2228"></a>Rule query<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/prebuilt-rules/downloadable-packages/8-3-2/prebuilt-rule-8-3-2-sensitive-privilege-seenabledelegationprivilege-assigned-to-a-user.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">event.action: "Authorization Policy Change" and event.code:4704 and winlog.event_data.PrivilegeList:"SeEnableDelegationPrivilege"</pre>
</div>
<p><span class="strong strong"><strong>Framework</strong></span>: MITRE ATT&amp;CK<sup>TM</sup></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Credential Access
</li>
<li class="listitem">
ID: TA0006
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0006/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0006/</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Tactic:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Name: Persistence
</li>
<li class="listitem">
ID: TA0003
</li>
<li class="listitem">
Reference URL: <a href="https://attack.mitre.org/tactics/TA0003/" class="ulink" target="_top">https://attack.mitre.org/tactics/TA0003/</a>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="prebuilt-rule-8-3-2-searching-for-saved-credentials-via-vaultcmd.html">« Searching for Saved Credentials via VaultCmd</a>
</span>
<span class="next">
<a href="prebuilt-rule-8-3-2-user-account-exposed-to-kerberoasting.html">User account exposed to Kerberoasting »</a>
</span>
</div>
</body>
</html>
