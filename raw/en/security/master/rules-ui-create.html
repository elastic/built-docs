<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create a detection rule | Elastic Security Solution [master] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Security Solution [master]"/>
<link rel="up" href="detection-engine-overview.html" title="Detections and alerts"/>
<link rel="prev" href="detection-engine-overview.html" title="Detections and alerts"/>
<link rel="next" href="rules-ui-management.html" title="Manage detection rules"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/master"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="detection-engine-overview.html">Detections and alerts</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="detection-engine-overview.html">« Detections and alerts</a>
</span>
<span class="next">
<a href="rules-ui-management.html">Manage detection rules »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="rules-ui-create"></a>Create a detection rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h2>
</div></div></div>
<p>Rules run periodically and search for source events, matches, sequences, or machine learning job anomaly results
that meet their criteria. When a rule&#8217;s criteria are met, a detection alert is
created.</p>
<p>You can create the following types of rules:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-custom-rule" title="Create a custom query rule"><span class="strong strong"><strong>Custom query</strong></span></a>: Query-based rule, which searches the defined indices and
creates an alert when one or more documents match the rule&#8217;s query.
</li>
<li class="listitem">
<p><a class="xref" href="rules-ui-create.html#create-ml-rule" title="Create a machine learning rule"><span class="strong strong"><strong>Machine learning</a></strong></span>: Machine learning rule, which creates an alert when a machine learning job
discovers an anomaly above the defined threshold (see <a class="xref" href="machine-learning.html" title="Anomaly detection with machine learning">Anomaly detection with machine learning</a>).</p>
<p>For machine learning rules, the associated machine learning job must be running. If the machine learning job isn&#8217;t
running, the rule will:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Run and create alerts if existing anomaly results with scores above the defined threshold
are discovered.
</li>
<li class="listitem">
Issue an error stating the machine learning job was not running when the rule executed.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><a class="xref" href="rules-ui-create.html#create-threshold-rule" title="Create a threshold rule"><span class="strong strong"><strong>Threshold</strong></span></a>: Searches the defined indices and creates a detections alert
when the number of times the specified field&#8217;s value is present and meets the threshold during
a single execution. When multiple values meet the threshold, an alert is
generated for each value.</p>
<p>For example, if the threshold <code class="literal">field</code> is <code class="literal">source.ip</code> and its <code class="literal">value</code> is <code class="literal">10</code>, an
alert is generated for every source IP address that appears in at least 10 of
the rule&#8217;s search results.</p>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-eql-rule" title="Create an event correlation rule"><span class="strong strong"><strong>Event correlation</strong></span></a>: Searches the defined indices and creates an alert when results match an
<a href="/guide/en/elasticsearch/reference/master/eql.html" class="ulink" target="_top">Event Query Language (EQL)</a> query.
</li>
<li class="listitem">
<p><a class="xref" href="rules-ui-create.html#create-indicator-rule" title="Create an indicator match rule"><span class="strong strong"><strong>Indicator match</strong></span></a>: Creates an alert when Elastic Security index field values match field values defined in the specified indicator index patterns. For example, you can create an indicator index for IP addresses and use this index to create an alert whenever an event&#8217;s <code class="literal">destination.ip</code> equals a value in the index. Indicator index field mappings should be <a href="/guide/en/ecs/8.7" class="ulink" target="_top">ECS-compliant</a>. For information on creating Elasticsearch indices and field types, see
<a href="/guide/en/elasticsearch/reference/master/getting-started-index.html" class="ulink" target="_top">Index some documents</a>,
<a href="/guide/en/elasticsearch/reference/master/indices-create-index.html" class="ulink" target="_top">Create index API</a>, and
<a href="/guide/en/elasticsearch/reference/master/mapping-types.html" class="ulink" target="_top">Field data types</a>. If you have indicators in a standard file format, such as CSV or JSON, you can also use the Machine Learning Data Visualizer to import your indicators into an indicator index. See <a href="/guide/en/machine-learning/master/ml-getting-started.html#sample-data-visualizer" class="ulink" target="_top">Explore the data in Kibana</a> and use the <span class="strong strong"><strong>Import Data</strong></span> option to import your indicators.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also use value lists as the indicator match index. See <a class="xref" href="rules-ui-create.html#indicator-value-lists" title="Use value lists with indicator match rules">Use value lists with indicator match rules</a> at the end of this topic for more information.</p>
</div>
</div>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-new-terms-rule" title="Create a new terms rule"><span class="strong strong"><strong>New terms</strong></span></a>: Generates an alert for each new term detected in source documents within a specified time range. You can also detect a combination of up to three new terms (for example, a <code class="literal">host.ip</code> and <code class="literal">host.id</code> that have never been observed together before).
</li>
</ul>
</div>
<p>When modifying rules or managing detection alerts, you can <a class="xref" href="add-exceptions.html" title="Add and manage exceptions">add exceptions</a> that prevent a rule from generating alerts even when its criteria are met. This is useful for reducing noise, such as preventing alerts from trusted processes and internal IP addresses.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can add exceptions to custom query, machine learning, event correlation, and indicator match rule types.</p>
</div>
</div>
<p>For both prebuilt and custom rules, you can send notifications when alerts are created. Notifications can be sent via Jira, Microsoft Teams, PagerDuty, Slack, and others, and can be configured when you create or edit a rule.</p>
<p>Creating a new rule requires the following steps:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-rule-ui" title="Select rule type and scope">Select rule type and scope</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">Configure basic rule settings</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-ui-advanced-params" title="Configure advanced rule settings (optional)">Configure advanced rule settings (optional)</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule">Set the rule&#8217;s schedule</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-notifications" title="Set up alert notifications (optional)">Set up alert notifications (optional)</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-response-action" title="Set up response actions (optional)">Set up response actions (optional)</a>
</li>
</ol>
</div>
<p>At any step, you can <a class="xref" href="rules-ui-create.html#preview-rules" title="Preview your rule (optional)">preview the rule</a> before saving it to see what kind of results you can expect.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>After you activate a rule, you can check if it is running as expected
using the <a class="xref" href="alerts-ui-monitor.html" title="Monitor and troubleshoot rule executions">Monitoring tab</a> on the Rules page. If you see
values in the <code class="literal">Gap</code> column, you can <a class="xref" href="alerts-ui-monitor.html#troubleshoot-signals" title="Troubleshoot missing alerts">Troubleshoot missing alerts</a>.</p>
<p>When a rule fails to run, the Elastic Security app tries to rerun it at its next
scheduled run time.</p>
</div>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/all-rules.png" alt="Shows the Rules page">
</div>
</div>
<h3><a id="alerting-authorization-model"></a>Authorization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>Rules, including all background detection and the actions they generate, are authorized using an <a href="/guide/en/kibana/master/api-keys.html" class="ulink" target="_top">API key</a> associated with the last user to edit the rule. Upon creating or modifying a rule, an API key is generated for that user, capturing a snapshot of their privileges. The API key is then used to run all background tasks associated with the rule including detection checks and executing actions.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a rule requires certain privileges to run, such as index privileges, keep in mind that if a user without those privileges updates the rule, the rule will no longer function.</p>
</div>
</div>
<h3><a id="views-index-patterns"></a>Data views and index patterns<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>When you create a rule, you must either specify the Elasticsearch index pattens for which you&#8217;d like the rule to run, or select a <a href="/guide/en/kibana/master/data-views.html" class="ulink" target="_top">data view</a> as the data source. If you select a data view, you can select <a class="xref" href="runtime-fields.html" title="Create runtime fields in Elastic Security">runtime fields</a> associated with that data view to create a query for the rule (with the exception of machine learning rules, which do not use queries).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To access data views, ensure you have the <a href="/guide/en/kibana/master/data-views.html#data-views-read-only-access" class="ulink" target="_top">required permissions</a>.</p>
</div>
</div>
<h3><a id="create-rule-ui"></a>Select rule type and scope<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Go to <span class="strong strong"><strong>Manage</strong></span> &#8594; <span class="strong strong"><strong>Rules</strong></span> &#8594; <span class="strong strong"><strong>Create new rule</strong></span>. The <span class="strong strong"><strong>Create new rule</strong></span> page displays.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/create-new-rule.png" alt="Create new rule page" width="85%">
</div>
</div>
</li>
<li class="listitem">
<p>Select the type of rule you want to create, then follow the steps outlined in that section:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-ml-rule" title="Create a machine learning rule">Machine learning</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-custom-rule" title="Create a custom query rule">Custom query</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-threshold-rule" title="Create a threshold rule">Threshold</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-eql-rule" title="Create an event correlation rule">Event correlation</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-indicator-rule" title="Create an indicator match rule">Indicator match</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#create-new-terms-rule" title="Create a new terms rule">New terms</a>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h4><a id="create-ml-rule"></a>Create a machine learning rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>To create or edit machine learning rules, you must have the <a href="/subscriptions" class="ulink" target="_top">appropriate license</a> or use a
<a href="/cloud/elasticsearch-service/signup?baymax=docs-body&amp;elektra=docs" class="ulink" target="_top">cloud deployment</a>. Additionally, you must have the <a href="/guide/en/elasticsearch/reference/master/built-in-roles.html" class="ulink" target="_top"><code class="literal">machine_learning_admin</code></a> user
role, and the selected machine learning job must be running for the rule to function correctly.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create a rule based on a machine learning anomaly threshold, select <span class="strong strong"><strong>Machine Learning</strong></span>,
then select:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>The required machine learning jobs.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If a required job isn&#8217;t currently running, it will automatically start when you finish configuring and enable the rule.</p>
</div>
</div>
</li>
<li class="listitem">
The anomaly score threshold above which alerts are created.
</li>
</ol>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-custom-rule"></a>Create a custom query rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create a rule based on a KQL or Lucene query, select <span class="strong strong"><strong>Custom query</strong></span>,
then:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Define which Elasticsearch indices or data view the rule searches for alerts.
</li>
<li class="listitem">
<p>Use the filter and query fields to create the criteria used for detecting
alerts.</p>
<p>The following example (based on the prebuilt rule <a class="xref" href="prebuilt-rule-0-14-2-volume-shadow-copy-deleted-or-resized-via-vssadmin.html" title="Volume Shadow Copy Deleted or Resized via VssAdmin">Volume Shadow Copy Deleted or Resized via VssAdmin</a>) detects when the <code class="literal">vssadmin delete shadows</code>
Windows command is executed:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Index patterns</strong></span>: <code class="literal">winlogbeat-*</code></p>
<p>Winlogbeat ships Windows event logs to Elastic Security.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Custom query</strong></span>: <code class="literal">event.action:"Process Create (rule: ProcessCreate)" and process.name:"vssadmin.exe" and process.args:("delete" and "shadows")</code></p>
<p>Searches the <code class="literal">winlogbeat-*</code> indices for <code class="literal">vssadmin.exe</code> executions with
the <code class="literal">delete</code> and <code class="literal">shadow</code> arguments, which are used to delete a volume&#8217;s shadow
copies.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/rule-query-example.png" alt="Rule query example">
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>You can use Kibana saved queries (<span class="image"><img src="images/saved-query-menu.png" alt="Saved query menu" width="18" height="18"></span>) and queries from saved Timelines (<span class="strong strong"><strong>Import query from saved Timeline</strong></span>) as rule conditions.</p>
<p>When you use a saved query, the <span class="strong strong"><strong>Load saved query "<em>query name</em>" dynamically on each rule execution</strong></span> check box appears:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Select this to use the saved query every time the rule runs. This links the rule to the saved query, and you won&#8217;t be able to modify the rule&#8217;s <span class="strong strong"><strong>Custom query</strong></span> field or filters because the rule will only use settings from the saved query. To make changes, modify the saved query itself.
</li>
<li class="listitem">
Deselect this to load the saved query as a one-time way of populating the rule&#8217;s <span class="strong strong"><strong>Custom query</strong></span> field and filters. This copies the settings from the saved query to the rule, so you can then further adjust the rule&#8217;s query and filters as needed. If the saved query is later changed, the rule will not inherit those changes.
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p><span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span> (Optional, <a href="/pricing" class="ulink" target="_top">Platinum or higher subscription</a> required) Use <span class="strong strong"><strong>Suppress Alerts By</strong></span> to reduce the number of repeated or duplicate alerts created each time the rule runs. Enter a field name to group matching source events by the field&#8217;s unique values, and only one alert will be created for each group of events per rule execution. You can also enter multiple fields to group events by unique combinations of values.</p>
<p>You&#8217;ll still be able to view the original events associated with suppressed alerts by investigating the alert in Timeline. Refer to <a class="xref" href="alert-suppression.html" title="Suppress detection alerts">Suppress detection alerts</a> for more information.</p>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-threshold-rule"></a>Create a threshold rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create a rule based on a source event field threshold, select <span class="strong strong"><strong>Threshold</strong></span>, then:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Define which Elasticsearch indices the rule analyzes for alerts.
</li>
<li class="listitem">
<p>Use the filter and query fields to create the criteria used for detecting
alerts.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can use Kibana saved queries (<span class="image"><img src="images/saved-query-menu.png" alt="Saved query menu" width="18" height="18"></span>) and queries from saved Timelines (<span class="strong strong"><strong>Import query from saved Timeline</strong></span>) as rule conditions.</p>
</div>
</div>
</li>
<li class="listitem">
Use the <code class="literal">Group by</code> and <code class="literal">Threshold</code> fields to determine which source event field is used as a threshold and the threshold&#8217;s value.
</li>
<li class="listitem">
<p>Use the <code class="literal">Count</code> field to limit alerts by cardinality of a certain field.</p>
<p>For example, if <code class="literal">Group by</code> is <code class="literal">source.ip</code>, <code class="literal">destination.ip</code> and its <code class="literal">Threshold</code> is <code class="literal">10</code>, an alert is generated for every pair of source and destination IP addresses that appear in at least 10 of the rule&#8217;s search results.</p>
<p>You can also leave the <code class="literal">Group by</code> field undefined. The rule then creates an alert when the number of search results is equal to or greater than the threshold value. If you set <code class="literal">Count</code> to limit the results by <code class="literal">process.name</code> &gt;= 2, an alert will only be generated for source/destination IP pairs that appear with at least 2 unique process names across all events.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Alerts created by threshold rules are synthetic alerts that do not resemble the source documents. The alert itself only contains data about the fields that were aggregated over (the <code class="literal">Group by</code> fields). Other fields are omitted, because they can vary across all source documents that were counted toward the threshold. Additionally, you can reference the actual count of documents that exceeded the threshold from the <code class="literal">kibana.alert.threshold_result.count</code> field.</p>
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-eql-rule"></a>Create an event correlation rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create an event correlation rule using EQL, select <span class="strong strong"><strong>Event Correlation</strong></span>, then:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Define which Elasticsearch indices or data view the rule searches for alerts.
</li>
<li class="listitem">
<p>Add an <a href="/guide/en/elasticsearch/reference/master/eql-syntax.html" class="ulink" target="_top">EQL statement</a> used to detect alerts.</p>
<p>For example, the following rule detects when <code class="literal">msxsl.exe</code> makes an outbound
network connection:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><span class="strong strong"><strong>Index patterns</strong></span>: <code class="literal">winlogbeat-*</code></p>
<p>Winlogbeat ships Windows events to Elastic Security.</p>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>EQL query</strong></span>:</p>
<div class="pre_wrapper lang-eql">
<pre class="programlisting prettyprint lang-eql">sequence by process.entity_id
  [process
    where event.type in ("start", "process_started")
    and process.name == "msxsl.exe"]
  [network
    where event.type == "connection"
    and process.name == "msxsl.exe"
    and network.direction == "outgoing"]</pre>
</div>
<p>Searches the <code class="literal">winlogbeat-*</code> indices for sequences of a <code class="literal">msxsl.exe</code> process start
event followed by an outbound network connection event that was started by the
<code class="literal">msxsl.exe</code> process.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/eql-rule-query-example.png" alt="eql rule query example">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For sequence events, the Elastic Security app generates a single alert when all events listed in the sequence are detected. To see the matched sequence events in more detail, you can view the alert in the Timeline, and, if all events came from the same process, open the alert in Analyze Event view.</p>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>(Optional) Click the EQL settings icon (<span class="image"><img src="images/eql-settings-icon.png" alt="EQL settings icon" width="16" height="16"></span>) to configure additional fields used by <a href="/guide/en/elasticsearch/reference/master/eql.html#specify-a-timestamp-or-event-category-field" class="ulink" target="_top">EQL search</a>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Event category field</strong></span>: Contains the event classification, such as <code class="literal">process</code>, <code class="literal">file</code>, or <code class="literal">network</code>. This field is typically mapped as a field type in the <a href="/guide/en/elasticsearch/reference/master/keyword.html" class="ulink" target="_top">keyword family</a>. Defaults to the <code class="literal">event.category</code> ECS field.
</li>
<li class="listitem">
<span class="strong strong"><strong>Tiebreaker field</strong></span>: Sets a secondary field for sorting events (in ascending, lexicographic order) if they have the same timestamp.
</li>
<li class="listitem">
<span class="strong strong"><strong>Timestamp field</strong></span>: Contains the event timestamp used for sorting a sequence of events. This is different from the <span class="strong strong"><strong>Timestamp override</strong></span> advanced setting, which is used for querying events within a range. Defaults to the <code class="literal">@timestamp</code> ECS field.
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-indicator-rule"></a>Create an indicator match rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Elastic Security provides limited support for indicator match rules. See <a class="xref" href="detection-engine-overview.html#support-indicator-rules" title="Limited support for indicator match rules">Limited support for indicator match rules</a> for more information.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create a rule that searches for events whose specified field value matches the specified indicator field value in the indicator index patterns, select <span class="strong strong"><strong>Indicator Match</strong></span>, then fill in the following fields:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Source</strong></span>: The individual index patterns or data view that specifies what data to search.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Custom query</strong></span>: The query and filters used to retrieve the required results from
the Elastic Security event indices. For example, if you want to match documents that only contain a <code class="literal">destination.ip</code> address field, add <code class="literal">destination.ip : *</code>.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you want the rule to check every field in the indices, use this
wildcard expression: <code class="literal">*:*</code>.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can use Kibana saved queries (<span class="image"><img src="images/saved-query-menu.png" alt="Saved query menu" width="18" height="18"></span>) and queries from saved Timelines (<span class="strong strong"><strong>Import query from saved Timeline</strong></span>) as rule conditions.</p>
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator index patterns</strong></span>: The indicator index patterns containing field values for which you want to generate alerts. This field is automatically populated with indices specified in the <code class="literal">securitySolution:defaultThreatIndex</code> advanced setting. For more information, see <a class="xref" href="advanced-settings.html#update-threat-intel-indices" title="Update default Elastic Security threat intelligence indices">Update default Elastic Security threat intelligence indices</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Data in indicator indices must be <a class="xref" href="es-overview.html#ecs-compliant-reqs" title="ECS compliance data requirements">ECS compatible</a>, and so it must contain a <code class="literal">@timestamp</code> field.</p>
</div>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator index query</strong></span>: The query and filters used to filter the fields from
the indicator index patterns. The default query <code class="literal">@timestamp &gt; "now-30d/d"</code> searches specified indicator indices for indicators ingested during the past 30 days and rounds the start time down to the nearest day (resolves to UTC <code class="literal">00:00:00</code>).
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator mapping</strong></span>: Compares the values of the specified event and indicator field
values. When the field values are identical, an alert is generated. To define
which field values are compared from the indices add the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Field</strong></span>: The field used for comparing values in the Elastic Security event
indices.
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator index field</strong></span>: The field used for comparing values in the indicator
indices.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>You can add <code class="literal">AND</code> and <code class="literal">OR</code> clauses to define when alerts are generated.</p>
<p>For example, to create a rule that generates alerts when <code class="literal">host.name</code> <span class="strong strong"><strong>and</strong></span>
<code class="literal">destination.ip</code> field values in the <code class="literal">logs-*</code> or <code class="literal">packetbeat-*</code> Elastic Security indices
are identical to the corresponding field values in the <code class="literal">mock-threat-list</code> indicator
index, enter the rule parameters seen in the following image:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/indicator-rule-example.png" alt="Indicator match rule settings">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Before you create rules, create <a class="xref" href="timelines-ui.html" title="Investigate events in Timeline">Timeline templates</a> so
they can be selected here. When alerts generated by the rule are investigated
in the Timeline, Timeline query values are replaced with their corresponding alert
field values.</p>
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h4><a id="create-new-terms-rule"></a>Create a new terms rule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>To create a rule that searches for each new term detected in source documents, select <span class="strong strong"><strong>New Terms</strong></span>, then:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Specify what data to search by entering individual Elasticsearch index patterns or selecting an existing data view.
</li>
<li class="listitem">
<p>Use the filter and query fields to create the criteria used for detecting
alerts.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can use Kibana saved queries (<span class="image"><img src="images/saved-query-menu.png" alt="Saved query menu" width="18" height="18"></span>) and queries from saved Timelines (<span class="strong strong"><strong>Import query from saved Timeline</strong></span>) as rule conditions.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Use the <span class="strong strong"><strong>Fields</strong></span> menu to select a field to check for new terms. You can also select up to three fields to detect a combination of new terms (for example, a <code class="literal">host.ip</code> and <code class="literal">host.id</code> that have never been observed together before).</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>When checking multiple fields, full results can be produced only for documents with no more than 100 unique combinations of values in these fields. If you expect your data to produce more than 100 unique new terms combinations per document, consider checking other fields to narrow down the search.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Use the <span class="strong strong"><strong>History Window Size</strong></span> menu to specify the time range to search in minutes, hours, or days to determine if a term is new. The history window size must be larger than the rule interval plus additional look-back time, because the rule will look for terms where the only time(s) the term appears within the history window is <em>also</em> within the rule interval and additional look-back time.</p>
<p>For example, if a rule has an interval of 5 minutes, no additional look-back time, and a history window size of 7 days, a term will be considered new only if the time it appears within the last 7 days is also within the last 5 minutes. Configure the rule interval and additional look-back time when you <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule">set the rule&#8217;s schedule</a>.</p>
</li>
</ol>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Continue</strong></span> to <a class="xref" href="rules-ui-create.html#rule-ui-basic-params" title="Configure basic rule settings">configure basic rule settings</a>.
</li>
</ol>
</div>
<h3><a id="preview-rules"></a>Preview your rule (optional)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>You can preview any custom or prebuilt rule to find out how noisy it will be. For a custom rule, you can then adjust the rule&#8217;s query or other settings.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To preview rules, you need the <code class="literal">read</code> privilege to the <code class="literal">.preview.alerts-security.alerts-&lt;space-id&gt;</code> index and <code class="literal">All</code> privileges for the Security feature. Refer to <a class="xref" href="detections-permissions-section.html" title="Detections prerequisites and requirements">Detections prerequisites and requirements</a> for more information.</p>
</div>
</div>
<p>Click the <span class="strong strong"><strong>Rule preview</strong></span> button while creating or editing a rule. The preview opens in a side panel, showing a histogram and table with the alerts you can expect, based on the defined rule settings and past events in your indices.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/preview-rule.png" alt="Rule preview">
</div>
</div>
<p>The preview also includes the effects of rule exceptions and override fields. In the histogram, alerts are stacked by <code class="literal">event.category</code> (or <code class="literal">host.name</code> for machine learning rules), and alerts with multiple values are counted more than once.</p>
<p>To interact with the rule preview:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Use the date and time picker to define the preview&#8217;s time range.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Avoid setting long time ranges with short rule intervals, or the rule preview might time out.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Refresh</strong></span> to update the preview.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
When you edit the rule&#8217;s settings or the preview&#8217;s time range, the button changes from blue (<span class="image"><img src="images/rule-preview-refresh-circle.png" alt="Blue circular refresh icon" width="16" height="17"></span>) to green (<span class="image"><img src="images/rule-preview-refresh-arrow.png" alt="Green right-pointing arrow refresh icon" width="17" height="17"></span>) to indicate that the rule has been edited since the last preview.
</li>
<li class="listitem">
For a relative time range (such as <code class="literal">Last 1 hour</code>), refresh the preview to check for the latest results. (Previews don&#8217;t automatically refresh with new incoming data.)
</li>
</ul>
</div>
</li>
<li class="listitem">
Click the <span class="strong strong"><strong>View details</strong></span> icon (<span class="image"><img src="images/view-details-icon.png" alt="View details icon" width="16" height="15"></span>) in the alerts table to view the details of a particular alert.
</li>
</ul>
</div>
<h3><a id="rule-ui-basic-params"></a>Configure basic rule settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>In the <span class="strong strong"><strong>About rule</strong></span> pane, fill in the following fields:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Name</strong></span>: The rule&#8217;s name.
</li>
<li class="listitem">
<span class="strong strong"><strong>Description</strong></span>: A description of what the rule does.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Default severity</strong></span>: Select the severity level of alerts created by the rule:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Low</strong></span>: Alerts that are of interest but generally are not considered to be
security incidents. Sometimes a combination of low severity alerts can
indicate suspicious activity.
</li>
<li class="listitem">
<span class="strong strong"><strong>Medium</strong></span>: Alerts that require investigation.
</li>
<li class="listitem">
<span class="strong strong"><strong>High</strong></span>: Alerts that require an immediate investigation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Critical</strong></span>: Alerts that indicate it is highly likely a security incident has
occurred.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Severity override</strong></span> (optional): Select to use source event values to
override the <span class="strong strong"><strong>Default severity</strong></span> in generated alerts. When selected, a UI
component is displayed where you can map the source event field values to
severity levels. The following example shows how to map severity levels to <code class="literal">host.name</code>
values:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/severity-mapping-ui.png" alt="severity mapping ui">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For threshold rules, not all source event values can be used for overrides; only the fields that were aggregated over (the <code class="literal">Group by</code> fields) will contain data. Please also note that overrides are not supported for event correlation rules.</p>
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Default risk score</strong></span>: A numerical value between 0 and 100 that indicates the risk of events detected by the rule. This setting changes to a default value when you change the <span class="strong strong"><strong>Severity</strong></span> level, but you can adjust the risk score as needed. General guidelines are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">0</code> - <code class="literal">21</code> represents low severity.
</li>
<li class="listitem">
<code class="literal">22</code> - <code class="literal">47</code> represents medium severity.
</li>
<li class="listitem">
<code class="literal">48</code> - <code class="literal">73</code> represents high severity.
</li>
<li class="listitem">
<code class="literal">74</code> - <code class="literal">100</code> represents critical severity.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Risk score override</strong></span> (optional): Select to use a source event value to
override the <span class="strong strong"><strong>Default risk score</strong></span> in generated alerts. When selected, a UI
component is displayed to select the source field used for the risk
score. For example, if you want to use the source event&#8217;s risk score in
alerts:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/risk-source-field-ui.png" alt="risk source field ui">
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For threshold rules, not all source event values can be used for overrides; only the fields that were aggregated over (the <code class="literal">Group by</code> fields) will contain data.</p>
</div>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>Tags</strong></span> (optional): Words and phrases used to categorize, filter, and search
the rule.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Continue with <span class="strong strong"><strong>one</strong></span> of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-ui-advanced-params" title="Configure advanced rule settings (optional)">Configure advanced rule settings (optional)</a>
</li>
<li class="listitem">
<a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule">Set the rule&#8217;s schedule</a>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h3><a id="rule-ui-advanced-params"></a>Configure advanced rule settings (optional)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Click <span class="strong strong"><strong>Advanced settings</strong></span> and fill in the following fields where applicable:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Reference URLs</strong></span> (optional): References to information that is relevant to
the rule. For example, links to background information.
</li>
<li class="listitem">
<span class="strong strong"><strong>False positive examples</strong></span> (optional): List of common scenarios that may produce
false-positive alerts.
</li>
<li class="listitem">
<span class="strong strong"><strong>MITRE ATT&amp;CK<sup>TM</sup> threats</strong></span> (optional): Add relevant <a href="https://attack.mitre.org/" class="ulink" target="_top">MITRE</a> framework tactics, techniques, and subtechniques.
</li>
<li class="listitem">
<span class="strong strong"><strong>Investigation guide</strong></span> (optional): Information for analysts investigating
alerts created by the rule.
</li>
<li class="listitem">
<span class="strong strong"><strong>Author</strong></span> (optional): The rule&#8217;s authors.
</li>
<li class="listitem">
<span class="strong strong"><strong>License</strong></span> (optional): The rule&#8217;s license.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Elastic endpoint exceptions</strong></span> (optional): Adds all Elastic Endpoint Security
rule exceptions to this rule (refer to <a class="xref" href="add-exceptions.html#endpoint-rule-exceptions" title="Add Elastic Endpoint exceptions">Add Elastic Endpoint exceptions</a> to learn more about adding endpoint exceptions).</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you select this option, you can add
<a class="xref" href="add-exceptions.html#endpoint-rule-exceptions" title="Add Elastic Endpoint exceptions">Endpoint exceptions</a> on the Rule details page.
Additionally, all future exceptions added to the Endpoint Security rule
also affect this rule.</p>
</div>
</div>
</li>
<li class="listitem">
<span class="strong strong"><strong>Building block</strong></span> (optional): Select to create a building-block rule. By
default, alerts generated from a building-block rule are not displayed in the
UI. See <a class="xref" href="building-block-rule.html" title="About building block rules"><em>About building block rules</em></a> for more information.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator prefix override</strong></span>: Define the location of indicator data within the structure of indicator documents. When the indicator match rule executes, it queries specified indicator indices and references this setting to locate fields with indicator data. This data is used to enrich indicator match alerts with metadata about matched threat indicators. The default value for this setting is <code class="literal">threat.indicator</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your threat indicator data is at a different location, update this setting accordingly to ensure alert enrichment can still be performed.</p>
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Rule name override</strong></span> (optional): Select a source event field to use as the
rule name in the UI (Alerts table). This is useful for exposing, at a glance,
more information about an alert. For example, if the rule generates alerts from
Suricata, selecting <code class="literal">event.action</code> lets you see what action (Suricata category)
caused the event directly in the Alerts table.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For threshold rules, not all source event values can be used for overrides; only the fields that were aggregated over (the <code class="literal">Group by</code> fields) will contain data.</p>
</div>
</div>
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Timestamp override</strong></span> (optional): Select a source event timestamp field. When selected, the rule&#8217;s query uses the selected field, instead of the default <code class="literal">@timestamp</code> field, to search for alerts. This can help reduce missing alerts due to network or server outages. Specifically, if your ingest pipeline adds a timestamp when events are sent to Elasticsearch, this avoids missing alerts due to ingestion delays.
However, if you know your data source has an inaccurate <code class="literal">@timestamp</code> value, it is recommended you select the <span class="strong strong"><strong>Do not use @timestamp as a fallback timestamp field</strong></span> option to ignore the <code class="literal">@timestamp</code> field entirely.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <a href="/guide/en/beats/filebeat/master/filebeat-module-microsoft.html" class="ulink" target="_top">Microsoft</a> and
<a href="/guide/en/beats/filebeat/master/filebeat-module-google_workspace.html" class="ulink" target="_top">Google Workspace</a> Filebeat modules have an <code class="literal">event.ingested</code> timestamp field that can be used instead of the default <code class="literal">@timestamp</code> field.</p>
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Continue</strong></span>. The <span class="strong strong"><strong>Schedule rule</strong></span> pane is displayed.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/schedule-rule.png" alt="schedule rule">
</div>
</div>
</li>
<li class="listitem">
Continue with <a class="xref" href="rules-ui-create.html#rule-schedule" title="Set the rule&#8217;s schedule">setting the rule&#8217;s schedule</a>.
</li>
</ol>
</div>
<h3><a id="rule-schedule"></a>Set the rule&#8217;s schedule<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Select how often the rule runs.
</li>
<li class="listitem">
<p>Optionally, add <code class="literal">Additional look-back time</code> to the rule. When defined, the
rule searches indices with the additional time.</p>
<p>For example, if you set a rule to run every 5 minutes with an additional
look-back time of 1 minute, the rule runs every 5 minutes but analyzes the
documents added to indices during the last 6 minutes.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is recommended to set the <code class="literal">Additional look-back time</code> to at
least 1 minute. This ensures there are no missing alerts when a rule does not
run exactly at its scheduled time.</p>
<p>Elastic Security prevents duplication. Any duplicate alerts that are discovered during the
<code class="literal">Additional look-back time</code> are <em>not</em> created.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Continue</strong></span>. The <span class="strong strong"><strong>Rule actions</strong></span> pane is displayed.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/rule-actions.png" alt="rule actions">
</div>
</div>
</li>
<li class="listitem">
<p>Do either of the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Continue onto <a class="xref" href="rules-ui-create.html#rule-notifications" title="Set up alert notifications (optional)">setting up alert notifications</a> and <a class="xref" href="rules-ui-create.html#rule-response-action" title="Set up response actions (optional)">Response Actions</a> (optional).
</li>
<li class="listitem">
Create the rule (with or without activation).
</li>
</ul>
</div>
</li>
</ol>
</div>
<h3><a id="rule-notifications"></a>Set up alert notifications (optional)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>Use Kibana Actions to set up notifications sent via other systems when alerts
are generated.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>To use Kibana Actions for alert notifications, you need the
<a href="/subscriptions" class="ulink" target="_top">appropriate license</a> and your role needs <span class="strong strong"><strong>All</strong></span> privileges for the <span class="strong strong"><strong>Action and Connectors</strong></span> feature. For more information, see <a class="xref" href="case-permissions.html" title="Cases prerequisites">Cases prerequisites</a>.</p>
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Set when to send notifications:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>On each rule execution</strong></span>: Sends a notification every time new alerts are
generated.
</li>
<li class="listitem">
<span class="strong strong"><strong>Hourly</strong></span>: Sends a notification every hour.
</li>
<li class="listitem">
<span class="strong strong"><strong>Daily</strong></span>: Sends a notification every day.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Weekly</strong></span>: Sends a notification every week.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Notifications are sent only when new alerts are generated.</p>
</div>
</div>
<p>The available connector types are displayed.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/available-action-types.png" alt="Shows available connector types">
</div>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Select the required connector type, which determines how notifications are sent. For example, if you select the Jira connector, notifications are sent to your Jira system.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Each action type requires a connector. Connectors store the
information required to send the notification from the external system. You can
configure connectors while creating the rule or on the Kibana Rules and Connectors
page (<span class="strong strong"><strong>Stack Management</strong></span> &#8594; <span class="strong strong"><strong>Rules and Connectors</strong></span> &#8594; <span class="strong strong"><strong>Connectors</strong></span>). For more
information, see <a href="/guide/en/kibana/master/action-types.html" class="ulink" target="_top">Action and connector types</a>.</p>
</div>
</div>
<p>The selected connector type fields are displayed (Jira example).</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/selected-action-type.png" alt="selected action type">
</div>
</div>
</li>
<li class="listitem">
Fill in the fields for the selected connector types. For all connector types, click
the icon above the <code class="literal">Message</code> field to add
<a class="xref" href="rules-ui-create.html#rule-action-variables" title="Alert notification placeholders">placeholders</a> for rule and alert details to the
notifications.
</li>
<li class="listitem">
<p>Create the rule with or without activation.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>When you activate a rule, it is queued, and its schedule is determined by
its initial run time. For example, if you activate a rule that runs every 5
minutes at 14:03 but it does not run until 14:04, it will run again at 14:09.</p>
</div>
</div>
</li>
</ol>
</div>
<h4><a id="rule-action-variables"></a>Alert notification placeholders<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h4>
<p>You can use <a href="http://mustache.github.io/" class="ulink" target="_top">mustache syntax</a> to add the following placeholders to <a class="xref" href="rules-ui-create.html#rule-notifications" title="Set up alert notifications (optional)">rule action</a> fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">{{alert.actionGroup}}</code>: Action group of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.actionGroupName}}</code>: Human readable name of the action group of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.actionSubgroup}}</code>: Action subgroup of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{alert.id}}</code>: ID of the alert that scheduled actions for the rule
</li>
<li class="listitem">
<code class="literal">{{context.alerts}}</code>: Array of detected alerts
</li>
<li class="listitem">
<code class="literal">{{{context.results_link}}}</code>: URL to the alerts in Kibana
</li>
<li class="listitem">
<code class="literal">{{context.rule.anomaly_threshold}}</code>: Anomaly threshold score above which
alerts are generated (machine learning rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.description}}</code>: Rule description
</li>
<li class="listitem">
<code class="literal">{{context.rule.false_positives}}</code>: Rule false positives
</li>
<li class="listitem">
<code class="literal">{{context.rule.filters}}</code>: Rule filters (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.id}}</code>: Unique rule ID returned after creating the rule
</li>
<li class="listitem">
<code class="literal">{{context.rule.index}}</code>: Indices rule runs on (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.language}}</code>: Rule query language (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.machine_learning_job_id}}</code>: ID of associated machine learning job (machine learning
rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.max_signals}}</code>: Maximum allowed number of alerts per rule
execution
</li>
<li class="listitem">
<code class="literal">{{context.rule.name}}</code>: Rule name
</li>
<li class="listitem">
<code class="literal">{{context.rule.output_index}}</code>: Index to which alerts are written
</li>
<li class="listitem">
<code class="literal">{{context.rule.query}}</code>: Rule query (query rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.references}}</code>: Rule references
</li>
<li class="listitem">
<code class="literal">{{context.rule.risk_score}}</code>: Default rule risk score
</li>
<li class="listitem">
<code class="literal">{{context.rule.rule_id}}</code>: Generated or user-defined rule ID that can be
used as an identifier across systems
</li>
<li class="listitem">
<code class="literal">{{context.rule.saved_id}}</code>: Saved search ID
</li>
<li class="listitem">
<code class="literal">{{context.rule.severity}}</code>: Default rule severity
</li>
<li class="listitem">
<code class="literal">{{context.rule.threat}}</code>: Rule threat framework
</li>
<li class="listitem">
<code class="literal">{{context.rule.threshold}}</code>: Rule threshold values (threshold rules only)
</li>
<li class="listitem">
<code class="literal">{{context.rule.timeline_id}}</code>: Associated Timeline ID
</li>
<li class="listitem">
<code class="literal">{{context.rule.timeline_title}}</code>: Associated Timeline name
</li>
<li class="listitem">
<code class="literal">{{context.rule.type}}</code>: Rule type
</li>
<li class="listitem">
<code class="literal">{{context.rule.version}}</code>: Rule version
</li>
<li class="listitem">
<code class="literal">{{date}}`</code>: Date the rule scheduled the action
</li>
<li class="listitem">
<code class="literal">{{kibanaBaseUrl}}</code>: Configured <code class="literal">server.publicBaseUrl</code> value, or empty string if not configured
</li>
<li class="listitem">
<code class="literal">{{rule.id}}</code>: ID of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.name}}</code>: Name of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.spaceId}}</code>: Space ID of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.tags}}</code>: Tags of the rule
</li>
<li class="listitem">
<code class="literal">{{rule.type}}</code>: Type of rule
</li>
<li class="listitem">
<code class="literal">{{state.signals_count}}</code>: Number of alerts detected
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">{{context.rule.severity}}</code> and <code class="literal">{{context.rule.risk_score}}</code>
placeholders contain the rule&#8217;s default values even when the <span class="strong strong"><strong>Severity override</strong></span>
and <span class="strong strong"><strong>Risk score override</strong></span> options are used.</p>
</div>
</div>
<h5><a id="placeholder-examples"></a>Alert placeholder examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h5>
<p>To understand which fields to parse, see the <a class="xref" href="rule-api-overview.html" title="Detections API"><em>Detections API</em></a> to view the JSON representation of rules.</p>
<p>Example using <code class="literal">{{context.rule.filters}}</code> to output a list of filters:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{{#context.rule.filters}}
{{^meta.disabled}}{{meta.key}} {{#meta.negate}}NOT {{/meta.negate}}{{meta.type}} {{^exists}}{{meta.value}}{{meta.params.query}}{{/exists}}{{/meta.disabled}}
{{/context.rule.filters}}</pre>
</div>
<p>Example using <code class="literal">{{context.alerts}}</code> as an array, which contains each alert generated since the last time the action was executed:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{{#context.alerts}}
Detection alert for user: {{user.name}}
{{/context.alerts}}</pre>
</div>
<p>Example using the mustache "current element" notation <code class="literal">{{.}}</code> to output all the rule references in the <code class="literal">signal.rule.references</code> array:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{{#signal.rule.references}} {{.}} {{/signal.rule.references}}</pre>
</div>
<h3><a id="rule-response-action"></a>Set up response actions (optional)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>Use Response Actions to set up additional functionality that will run whenever a rule executes.</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will apply best effort to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>The Osquery Response Action allows you to include live Osquery queries with a custom query rule. When an alert is generated, Osquery automatically collects data on the system related to the alert. Refer to <a class="xref" href="osquery-response-action.html" title="Add Osquery Response Actions"><em>Add Osquery Response Actions</em></a> to learn more.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/available-response-actions.png" alt="Shows available response actions">
</div>
</div>
<h3><a id="indicator-value-lists"></a>Use value lists with indicator match rules<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/detections/rules-ui-create.asciidoc">edit</a></h3>
<p>While there are numerous ways you can add data into indicator indices, you can use value lists as the indicator match index in an indicator match rule. Take the following scenario, for example:</p>
<p>You uploaded a value list of known ransomware domains, and you want to be notified if any of those domains matches a value contained in a domain field in your security event index pattern.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Upload a value list of indicators.
</li>
<li class="listitem">
<p>Create an indicator match rule and fill in the following fields:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<span class="strong strong"><strong>Index patterns</strong></span>: The Elastic Security event indices on which the rule runs.
</li>
<li class="listitem">
<span class="strong strong"><strong>Custom query</strong></span>: The query and filters used to retrieve the required results from the Elastic Security event indices (e.g., <code class="literal">host.domain :*</code>).
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator index patterns</strong></span>: Value lists are stored in a hidden index called <code class="literal">.items-&lt;Kibana space&gt;</code>. Enter the name of the Kibana space in which this rule will run in this field.
</li>
<li class="listitem">
<span class="strong strong"><strong>Indicator index query</strong></span>: Enter the value <code class="literal">list_id :</code>, followed by the name of the value list you want to use as your indicator index (uploaded in Step 1 above).
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator mapping</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Field</strong></span>: Enter the field from the Elastic Security event indices to be used for comparing values.
</li>
<li class="listitem">
<p><span class="strong strong"><strong>Indicator index field</strong></span>: Enter the type of value list you created (i.e., <code class="literal">keyword</code>, <code class="literal">text</code>, or <code class="literal">IP</code>).</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you don&#8217;t remember this information, go to <span class="strong strong"><strong>Manage</strong></span> &#8594; <span class="strong strong"><strong>Rules</strong></span> &#8594; <span class="strong strong"><strong>Import value lists</strong></span>. Locate the appropriate value list and note the field in the corresponding <code class="literal">Type</code> column. (Examples include keyword, text, and IP.)</p>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/indicator_value_list.png" alt="indicator value list">
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="detection-engine-overview.html">« Detections and alerts</a>
</span>
<span class="next">
<a href="rules-ui-management.html">Manage detection rules »</a>
</span>
</div>
</div>
</body>
</html>
