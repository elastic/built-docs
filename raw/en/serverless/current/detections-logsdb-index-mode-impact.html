<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="">
<title>Using logsdb index mode with Elastic Security Serverless | Serverless | Elastic</title>
<meta class="elastic" name="content" content="Using logsdb index mode with Elastic Security Serverless | Serverless">

<link rel="home" href="index.html" title="Serverless"/>
<link rel="up" href="security-detection-engine-overview.html" title="Detection engine overview"/>
<link rel="prev" href="security-detections-requirements.html" title="Detections requirements"/>
<link rel="next" href="security-about-rules.html" title="About detection rules"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Serverless"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Serverless/Guide"/>
<meta name="DC.subject" content="Serverless"/>
<meta name="DC.identifier" content="main"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="security-detections-requirements.html">« Detections requirements</a>
</span>
<span class="next">
<a href="security-about-rules.html">About detection rules »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="what-is-security-serverless.html">Elastic Security Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="security-detection-engine-overview.html">Detection engine overview</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Using logsdb index mode with Elastic Security Serverless</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/rules/detections-logsdb-impact.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="detections-logsdb-index-mode-impact"></a>Using logsdb index mode with Elastic Security Serverless</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/rules/detections-logsdb-impact.asciidoc">edit</a></div>
</div></div></div>
<p>Logsdb is enabled by default for Elastic Cloud Serverless. This topic explains the impact of using logsdb index mode with Elastic Security Serverless.</p>
<p>With logsdb index mode, the original <code class="literal">_source</code> field is not stored in the index but can be reconstructed using <a href="/guide/en/elasticsearch/reference/master/mapping-source-field.html#synthetic-source" class="ulink" target="_top">synthetic <code class="literal">_source</code></a>.</p>
<p>When the <code class="literal">_source</code> is reconstructed, <a href="/guide/en/elasticsearch/reference/master/mapping-source-field.html#synthetic-source-modifications" class="ulink" target="_top">modifications</a> are possible. Therefore, there could be a mismatch between users' expectations and how fields are formatted.</p>
<p>Continue reading to find out how this affects specific Elastic Security Serverless components.</p>
<div class="position-relative"><h5><a id="logsdb-alerts"></a>Alerts</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/rules/detections-logsdb-impact.asciidoc">edit</a></div>
<p>When alerts are generated, the <code class="literal">_source</code> event is copied into the alert to retain the original data. When the logsdb index mode is applied, the <code class="literal">_source</code> event stored in the alert is reconstructed using synthetic <code class="literal">_source</code>.</p>
<p>If you&#8217;re switching to use logsdb index mode, the <code class="literal">_source</code> field stored in the alert might look different in certain situations:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/mapping-source-field.html#synthetic-source-modifications-leaf-arrays" class="ulink" target="_top">Arrays can be reconstructed differently or deduplicated</a>
</li>
<li class="listitem">
<a href="/guide/en/elasticsearch/reference/master/mapping-source-field.html#synthetic-source-modifications-field-names" class="ulink" target="_top">Field names</a>
</li>
<li class="listitem">
<code class="literal">geo_point</code> data fields (refer to <a href="/guide/en/elasticsearch/reference/master/mapping-source-field.html#synthetic-source-modifications-ranges" class="ulink" target="_top">Representation of ranges</a> and <a href="/guide/en/elasticsearch/reference/master/mapping-source-field.html#synthetic-source-precision-loss-for-point-types" class="ulink" target="_top">Reduced precision of <code class="literal">geo_point</code> values</a> for more information)
</li>
</ul>
</div>
<p>Alerts generated by the following rule types could be affected:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Custom query
</li>
<li class="listitem">
Event correlation (non-sequence only)
</li>
<li class="listitem">
Non-aggregate rule types (for example, ES|QL rules that use non-aggregating queries)
</li>
</ul>
</div>
<p>Alerts that are generated by threshold, machine learning, and event correlation sequence rules are not affected since they do not contain copies of the original source.</p>
<div class="position-relative"><h5><a id="logsdb-rule-actions"></a>Rule actions</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/rules/detections-logsdb-impact.asciidoc">edit</a></div>
<p>While we do not recommend using <code class="literal">_source</code> for actions, in cases where the action relies on the <code class="literal">_source</code>, the same limitations and changes apply.</p>
<p>If you send alert notifications by enabling <a href="/guide/en/kibana/master/alerting-getting-started.html#alerting-concepts-actions" class="ulink" target="_top">actions</a> to the external systems that have workflows or automations based on fields formatted from the original source, they may be affected. In particular, this can happen when the fields used are arrays of objects.</p>
<p>We recommend checking and adjusting the rule actions using <code class="literal">_source</code> before switching to logsdb index mode.</p>
<div class="position-relative"><h5><a id="logsdb-runtime-fields"></a>Runtime fields</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/serverless/rules/detections-logsdb-impact.asciidoc">edit</a></div>
<p>Runtime fields that reference <code class="literal">_source</code> may be affected. Some runtime fields might not work and need to be adjusted. For example, if an event was indexed with the value of <code class="literal">agent.name</code> in the dot-notation form, it will be returned in the nested form and might not work.</p>
<p>The following is an example of accessing <code class="literal">_source</code> that works with the logsdb index mode enabled:</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">"source": """  emit(params._source.agent.name + "_____" + doc['agent.name'].value ); """
"source": """  emit(params._source['agent']['name'] + "_____" + doc['agent.name'].value );  """
"source": """  emit(field('agent.name').get(null) + "_____" + doc['agent.name'].value ); """
"source": """  emit($('agent.name', null) + "_____" + doc['agent.name'].value ); """</pre>
</div>
<div class="console_widget" data-snippet="snippets/37.console"></div>
<p>The following will not work with synthetic source (logsdb index mode enabled):</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">"source": """  emit(params._source['agent.name'] + "_____" + doc['agent.name'].value );  """</pre>
</div>
<div class="console_widget" data-snippet="snippets/38.console"></div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="security-detections-requirements.html">« Detections requirements</a>
</span>
<span class="next">
<a href="security-about-rules.html">About detection rules »</a>
</span>
</div>
</body>
</html>
