<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Detect anomalies | Serverless | Elastic</title>
<meta class="elastic" name="content" content="Detect anomalies | Serverless">

<link rel="home" href="index.html" title="Serverless"/>
<link rel="up" href="observability-aiops.html" title="AIOps"/>
<link rel="prev" href="observability-aiops.html" title="AIOps"/>
<link rel="next" href="observability-aiops-tune-anomaly-detection-job.html" title="Tune your anomaly detection job"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Serverless"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Serverless/Guide"/>
<meta name="DC.subject" content="Serverless"/>
<meta name="DC.identifier" content="main"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="observability-aiops.html">« AIOps</a>
</span>
<span class="next">
<a href="observability-aiops-tune-anomaly-detection-job.html">Tune your anomaly detection job »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="what-is-observability-serverless.html">Elastic Observability serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="observability-aiops.html">AIOps</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Detect anomalies</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/aiops/aiops-detect-anomalies.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="observability-aiops-detect-anomalies"></a>Detect anomalies</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/aiops/aiops-detect-anomalies.asciidoc">edit</a></div>
</div></div></div>
<p><span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Required role</h3>
<p>The <span class="strong strong"><strong>Editor</strong></span> role or higher is required to create, run, and view anomaly detection jobs. To learn more, refer to <a class="xref" href="general-assign-user-roles.html" title="Assign user roles and privileges">Assign user roles and privileges</a>.</p>
</div>
</div>
<p>The anomaly detection feature in Observability automatically models the normal behavior of your time series data — learning trends,
periodicity, and more — in real time to identify anomalies, streamline root cause analysis, and reduce false positives.</p>
<p>To set up anomaly detection, you create and run anomaly detection jobs.
Anomaly detection jobs use proprietary machine learning algorithms to detect anomalous events or patterns, such as:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Anomalies related to temporal deviations in values, counts, or frequencies
</li>
<li class="listitem">
Anomalies related to unusual locations in geographic data
</li>
<li class="listitem">
Statistical rarity
</li>
<li class="listitem">
Unusual behaviors for a member of a population
</li>
</ul>
</div>
<p>To learn more about anomaly detection algorithms, refer to the <a href="/guide/en/machine-learning/master/ml-ad-algorithms.html" class="ulink" target="_top">machine learning</a> documentation.
Note that the machine learning documentation may contain details that are not valid when using a serverless project.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Some terms you might need to know</h3>
<p>A <em>datafeed</em> retrieves time series data from Elasticsearch and provides it to an
anomaly detection job for analysis.</p>
<p>The job uses <em>buckets</em> to divide the time series into batches for processing.
For example, a job may use a bucket span of 1 hour.</p>
<p>Each anomaly detection job contains one or more <em>detectors</em>, which define the type of
analysis that occurs (for example, <code class="literal">max</code>, <code class="literal">average</code>, or <code class="literal">rare</code> analytical
functions) and the fields that are analyzed. Some of the analytical functions
look for single anomalous data points. For example, <code class="literal">max</code> identifies the maximum
value that is seen within a bucket. Others perform some aggregation over the
length of the bucket. For example, <code class="literal">mean</code> calculates the mean of all the data
points seen within the bucket.</p>
<p>To learn more about anomaly detection, refer to the <a href="/guide/en/machine-learning/master/ml-ad-overview.html" class="ulink" target="_top">machine learning</a> documentation.</p>
</div>
</div>
<div class="position-relative"><h5><a id="create-anomaly-detection-job"></a>Create and run an anomaly detection job</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/aiops/aiops-detect-anomalies.asciidoc">edit</a></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your Observability project, go to <span class="strong strong"><strong>AIOps</strong></span> → <span class="strong strong"><strong>Anomaly detection</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Create anomaly detection job</strong></span> (or <span class="strong strong"><strong>Create job</strong></span> if other jobs exist).
</li>
<li class="listitem">
Choose a data view or saved search to access the data you want to analyze.
</li>
<li class="listitem">
<p>Select the wizard for the type of job you want to create.
The following wizards are available.
You might also see specialized wizards based on the type of data you are analyzing.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>In general, it is a good idea to start with single metric anomaly detection jobs for your key performance indicators.
After you examine these simple analysis results, you will have a better idea of what the influencers might be.
Then you can create multi-metric jobs and split the data or create more complex analysis functions as necessary.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Single metric
</span>
</dt>
<dd>
Creates simple jobs that have a single detector. A <em>detector</em> applies an analytical function to specific fields in your data. In addition to limiting the number of detectors, the single metric wizard omits many of the more advanced configuration options.
</dd>
<dt>
<span class="term">
Multi-metric
</span>
</dt>
<dd>
Creates jobs that can have more than one detector, which is more efficient than running multiple jobs against the same data.
</dd>
<dt>
<span class="term">
Population
</span>
</dt>
<dd>
Creates jobs that detect activity that is unusual compared to the behavior of the population.
</dd>
<dt>
<span class="term">
Advanced
</span>
</dt>
<dd>
Creates jobs that can have multiple detectors and enables you to configure all job settings.
</dd>
<dt>
<span class="term">
Categorization
</span>
</dt>
<dd>
Creates jobs that group log messages into categories and use <code class="literal">count</code> or <code class="literal">rare</code> functions to detect anomalies within them.
</dd>
<dt>
<span class="term">
Rare
</span>
</dt>
<dd>
Creates jobs that detect rare occurrences in time series data. Rare jobs use the <code class="literal">rare</code> or <code class="literal">freq_rare</code> functions and also detect rare occurrences in populations.
</dd>
<dt>
<span class="term">
Geo
</span>
</dt>
<dd>
Creates jobs that detect unusual occurrences in the geographic locations of your data. Your data set must contain geo data.
</dd>
</dl>
</div>
<p>For more information about job types, refer to the <a href="/guide/en/machine-learning/master/ml-anomaly-detection-job-types.html" class="ulink" target="_top">machine learning</a> documentation.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Not sure what type of job to create?</h3>
<p>Before selecting a wizard, click <span class="strong strong"><strong>Data Visualizer</strong></span> to explore the fields and metrics in your data.
To get the best results, you must understand your data, including its data types and the range and distribution of values.</p>
<p>In the <span class="strong strong"><strong>Data Visualizer</strong></span>, use the time filter to select a time period that you’re interested in exploring,
or click <span class="strong strong"><strong>Use full data</strong></span> to view the full time range of data.
Expand the fields to see details about the range and distribution of values.
When you&#8217;re done, go back to the first step and create your job.</p>
</div>
</div>
</li>
<li class="listitem">
Step through the instructions in the job creation wizard to configure your job.
You can accept the default settings for most settings now and <a class="xref" href="observability-aiops-tune-anomaly-detection-job.html" title="Tune your anomaly detection job">tune the job</a> later.
</li>
<li class="listitem">
If you want the job to start immediately when the job is created, make sure that option is selected on the summary page.
</li>
<li class="listitem">
When you&#8217;re done, click <span class="strong strong"><strong>Create job</strong></span>.
When the job runs, the machine learning features analyze the input stream of data, model its behavior, and perform analysis based on the detectors in each job.
When an event occurs outside of the baselines of normal behavior, that event is identified as an anomaly.
</li>
<li class="listitem">
After the job is started, click <span class="strong strong"><strong>View results</strong></span>.
</li>
</ol>
</div>
<div class="position-relative"><h5><a id="observability-aiops-detect-anomalies-view-the-results"></a>View the results</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/aiops/aiops-detect-anomalies.asciidoc">edit</a></div>
<p>After the anomaly detection job has processed some data,
you can view the results in Observability.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Depending on the capacity of your machine,
you might need to wait a few seconds for the analysis to generate initial results.</p>
</div>
</div>
<p>If you clicked <span class="strong strong"><strong>View results</strong></span> after creating the job, the results open in either the <span class="strong strong"><strong>Single Metric Viewer</strong></span> or <span class="strong strong"><strong>Anomaly Explorer</strong></span>.
To switch between these tools, click the icons in the upper-left corner of each tool.</p>
<p>Read the following sections to learn more about these tools:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="observability-aiops-detect-anomalies.html#view-single-metric" title="View single metric job results">View single metric job results</a>
</li>
<li class="listitem">
<a class="xref" href="observability-aiops-detect-anomalies.html#anomaly-explorer" title="View advanced or multi-metric job results">View advanced or multi-metric job results</a>
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="view-single-metric"></a>View single metric job results</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/aiops/aiops-detect-anomalies.asciidoc">edit</a></div>
<p>The <span class="strong strong"><strong>Single Metric Viewer</strong></span> contains a chart that represents the actual and expected values over time:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-detection-single-metric-viewer.png" alt="Single Metric Viewer showing analysis">
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The line in the chart represents the actual data values.
</li>
<li class="listitem">
The shaded area represents the bounds for the expected values.
</li>
<li class="listitem">
The area between the upper and lower bounds are the most likely values for the model, using a 95% confidence level.
That is to say, there is a 95% chance of the actual value falling within these bounds.
If a value is outside of this area then it will usually be identified as anomalous.
</li>
</ul>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Expected values are available only if <span class="strong strong"><strong>Enable model plot</strong></span> was selected under Job Details
when you created the job.</p>
</div>
</div>
<p>To explore your data:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If the <span class="strong strong"><strong>Single Metric Explorer</strong></span> is not already open, go to <span class="strong strong"><strong>AIOps</strong></span> → <span class="strong strong"><strong>Anomaly detection</strong></span> and click the Single Metric Explorer icon next to the job you created.
Note that the Single Metric Explorer icon will be grayed out for advanced or multi-metric jobs.
</li>
<li class="listitem">
In the time filter, specify a time range that covers the majority of the analyzed data points.
</li>
<li class="listitem">
Notice that the model improves as it processes more data.
At the beginning, the expected range of values is pretty broad, and the model is not capturing the periodicity in the data.
But it quickly learns and begins to reflect the patterns in your data.
The duration of the learning process heavily depends on the characteristics and complexity of the input data.
</li>
<li class="listitem">
<p>Look for anomaly data points, depicted by colored dots or cross symbols, and hover over a data point to see more details about the anomaly.
Note that anomalies with medium or high multi-bucket impact are depicted with a cross symbol instead of a dot.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<h3>How are anomaly scores calculated?</h3>
<p>Any data points outside the range that was predicted by the model are marked
as anomalies. In order to provide a sensible view of the results, an
<em>anomaly score</em> is calculated for each bucket time interval. The anomaly score
is a value from 0 to 100, which indicates the significance of the anomaly
compared to previously seen anomalies. The highly anomalous values are shown in
red and the low scored values are shown in blue. An interval with a high
anomaly score is significant and requires investigation.
For more information about anomaly scores, refer to the <a href="/guide/en/machine-learning/master/ml-ad-explain.html" class="ulink" target="_top">machine learning</a> documentation.</p>
</div>
</div>
</li>
<li class="listitem">
(Optional) Annotate your job results by drag-selecting a period of time and entering annotation text.
Annotations are notes that refer to events in a specific time period.
They can be created by the user or generated automatically by the anomaly detection job to reflect model changes and noteworthy occurrences.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Anomalies</strong></span>, expand each anomaly to see key details, such as the time, the actual and expected ("typical") values, and their probability.
The <span class="strong strong"><strong>Anomaly explanation</strong></span> section gives you further insights about each anomaly, such as its type and impact, to make it easier to interpret the job results:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-detection-details.png" alt="Single Metric Viewer showing anomaly details">
</div>
</div>
<p>By default, the <span class="strong strong"><strong>Anomalies</strong></span> table contains all anomalies that have a severity of "warning" or higher in the selected section of the timeline.
If you are only interested in critical anomalies, for example, you can change the severity threshold for this table.</p>
</li>
<li class="listitem">
(Optional) From the <span class="strong strong"><strong>Actions</strong></span> menu in the <span class="strong strong"><strong>Anomalies</strong></span> table, you can choose to view relevant documents in <span class="strong strong"><strong>Discover</strong></span> or create a job rule.
Job rules instruct anomaly detectors to change their behavior based on domain-specific knowledge that you provide.
To learn more, refer to <a class="xref" href="observability-aiops-tune-anomaly-detection-job.html" title="Tune your anomaly detection job">Tune your anomaly detection job</a>
</li>
</ol>
</div>
<p>After you have identified anomalies, often the next step is to try to determine
the context of those situations. For example, are there other factors that are
contributing to the problem? Are the anomalies confined to particular
applications or servers? You can begin to troubleshoot these situations by
layering additional jobs or creating multi-metric jobs.</p>
<div class="position-relative"><h5><a id="anomaly-explorer"></a>View advanced or multi-metric job results</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/aiops/aiops-detect-anomalies.asciidoc">edit</a></div>
<p>Conceptually, you can think of <em>multi-metric anomaly detection jobs</em> as running multiple independent single metric jobs.
By bundling them together in a multi-metric job, however,
you can see an overall score and shared influencers for all the metrics and all the entities in the job.
Multi-metric jobs therefore scale better than having many independent single metric jobs.
They also provide better results when you have influencers that are shared across the detectors.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<h3>What is an influencer?</h3>
<p>When you create an anomaly detection job, you can identify fields as <em>influencers</em>.
These are fields that you think contain information about someone or something that influences or contributes to anomalies.
As a best practice, do not pick too many influencers.
For example, you generally do not need more than three.
If you pick many influencers, the results can be overwhelming, and there is some overhead to the analysis.</p>
<p>To learn more about influencers, refer to the <a href="/guide/en/machine-learning/master/ml-ad-run-jobs.html#ml-ad-influencers" class="ulink" target="_top">machine learning</a> documentation.</p>
</div>
</div>
<p>You can also configure your anomaly detection jobs to split a single time series into multiple time series based on a categorical field.
For example, you could create a job for analyzing response code rates that has a single detector that splits the data based on the <code class="literal">response.keyword</code>,
and uses the <code class="literal">count</code> function to determine when the number of events is anomalous.
You might use a job like this if you want to look at both high and low request rates partitioned by response code.</p>
<p>To view advanced or multi-metric results in the
<span class="strong strong"><strong>Anomaly Explorer</strong></span>:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
If the <span class="strong strong"><strong>Anomaly Explorer</strong></span> is not already open, go to <span class="strong strong"><strong>AIOps</strong></span> → <span class="strong strong"><strong>Anomaly detection</strong></span> and click the Anomaly Explorer icon next to the job you created.
</li>
<li class="listitem">
In the time filter, specify a time range that covers the majority of the analyzed data points.
</li>
<li class="listitem">
If you specified influencers during job creation, the view includes a list of the top influencers for all of the detected anomalies in that same time period.
The list includes maximum anomaly scores, which in this case are aggregated for each influencer, for each bucket, across all detectors.
There is also a total sum of the anomaly scores for each influencer.
Use this list to help you narrow down the contributing factors and focus on the most anomalous entities.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Anomaly timeline</strong></span>, click a section in the swim lanes to obtain more information about the anomalies in that time period.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-explorer.png" alt="Anomaly Explorer showing swim lanes with anomaly selected">
</div>
</div>
<p>You can see exact times when anomalies occurred.
If there are multiple detectors or metrics in the job, you can see which caught the anomaly.
You can also switch to viewing this time series in the <span class="strong strong"><strong>Single Metric Viewer</strong></span> by selecting <span class="strong strong"><strong>View series</strong></span> in the <span class="strong strong"><strong>Actions</strong></span> menu.</p>
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Anomalies</strong></span> (in the <span class="strong strong"><strong>Anomaly Explorer</strong></span>), expand an anomaly to see key details, such as the time,
the actual and expected ("typical") values, and the influencers that contributed to the anomaly:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-detection-multi-metric-details.png" alt="Anomaly Explorer showing anomaly details">
</div>
</div>
<p>By default, the <span class="strong strong"><strong>Anomalies</strong></span> table contains all anomalies that have a severity of "warning" or higher in the selected section of the timeline.
If you are only interested in critical anomalies, for example, you can change the severity threshold for this table.</p>
<p>If your job has multiple detectors, the table aggregates the anomalies to show the highest severity anomaly per detector and entity,
which is the field value that is displayed in the <span class="strong strong"><strong>found for</strong></span> column.</p>
<p>To view all the anomalies without any aggregation, set the <span class="strong strong"><strong>Interval</strong></span> to <span class="strong strong"><strong>Show all</strong></span>.</p>
</li>
</ol>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The anomaly scores that you see in each section of the <span class="strong strong"><strong>Anomaly Explorer</strong></span> might differ slightly.
This disparity occurs because for each job there are bucket results, influencer results, and record results.
Anomaly scores are generated for each type of result.
The anomaly timeline uses the bucket-level anomaly scores.
The list of top influencers uses the influencer-level anomaly scores.
The list of anomalies uses the record-level anomaly scores.</p>
</div>
</div>
<div class="position-relative"><h5><a id="observability-aiops-detect-anomalies-next-steps"></a>Next steps</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/aiops/aiops-detect-anomalies.asciidoc">edit</a></div>
<p>After setting up an anomaly detection job, you may want to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="observability-aiops-tune-anomaly-detection-job.html" title="Tune your anomaly detection job">Tune your anomaly detection job</a>
</li>
<li class="listitem">
<a class="xref" href="observability-aiops-forecast-anomalies.html" title="Forecast future behavior">Forecast future behavior</a>
</li>
<li class="listitem">
<a class="xref" href="observability-aiops-generate-anomaly-alerts.html" title="Create an anomaly detection rule">Anomaly detection</a>
</li>
</ul>
</div>


</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="observability-aiops.html">« AIOps</a>
</span>
<span class="next">
<a href="observability-aiops-tune-anomaly-detection-job.html">Tune your anomaly detection job »</a>
</span>
</div>
</body>
</html>
