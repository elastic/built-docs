<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create an anomaly detection rule | Serverless | Elastic</title>
<meta class="elastic" name="content" content="Create an anomaly detection rule | Serverless">

<link rel="home" href="index.html" title="Serverless"/>
<link rel="up" href="observability-create-manage-rules.html" title="Create and manage rules"/>
<link rel="prev" href="observability-create-manage-rules.html" title="Create and manage rules"/>
<link rel="next" href="observability-create-anomaly-alert-rule.html" title="Create an APM anomaly rule"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Serverless"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Serverless/Guide"/>
<meta name="DC.subject" content="Serverless"/>
<meta name="DC.identifier" content="main"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="observability-create-manage-rules.html">« Create and manage rules</a>
</span>
<span class="next">
<a href="observability-create-anomaly-alert-rule.html">Create an APM anomaly rule »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="what-is-observability-serverless.html">Elastic Observability serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="observability-alerting.html">Alerting</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="observability-create-manage-rules.html">Create and manage rules</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Create an anomaly detection rule</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/alerting/aiops-generate-anomaly-alerts.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="observability-aiops-generate-anomaly-alerts"></a>Create an anomaly detection rule</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/alerting/aiops-generate-anomaly-alerts.asciidoc">edit</a></div>
</div></div></div>

<p><span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Required role</h3>
<p>The <span class="strong strong"><strong>Editor</strong></span> role or higher is required to create anomaly detection rules. To learn more, refer to <a class="xref" href="general-assign-user-roles.html" title="Assign user roles and privileges">Assign user roles and privileges</a>.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Anomaly detection alerting is in beta</h3>
<p>The Anomaly detection alerting functionality is in beta and is subject to change. The design and code is less mature than official generally available features and is being provided as-is with no warranties.</p>
</div>
</div>
<p>Create an anomaly detection rule to check for anomalies in one or more anomaly detection jobs.
If the conditions of the rule are met, an alert is created, and any actions specified in the rule are triggered.
For example, you can create a rule to check every fifteen minutes for critical anomalies and then alert you by email when they are detected.</p>
<p>To create an anomaly detection rule:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your Observability project, go to <span class="strong strong"><strong>AIOps</strong></span> → <span class="strong strong"><strong>Anomaly detection</strong></span>.
</li>
<li class="listitem">
In the list of anomaly detection jobs, find the job you want to check for anomalies.
Haven&#8217;t created a job yet? <a class="xref" href="observability-aiops-detect-anomalies.html" title="Detect anomalies">Create one now</a>.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Actions</strong></span> menu next to the job, select <span class="strong strong"><strong>Create alert rule</strong></span>.
</li>
<li class="listitem">
Specify a name and optional tags for the rule. You can use these tags later to filter alerts.
</li>
<li class="listitem">
<p>Verify that the correct job is selected and configure the alert details:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-detection-alert.png" alt="Anomaly detection alert settings">
</div>
</div>
</li>
<li class="listitem">
<p>For the result type:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Choose&#8230;&#8203;</th>
<th align="left" valign="top">To generate an alert based on&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Bucket</strong></span></p></td>
<td align="left" valign="top"><p>How unusual the anomaly was within the bucket of time</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Record</strong></span></p></td>
<td align="left" valign="top"><p>What individual anomalies are present in a time range</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Influencer</strong></span></p></td>
<td align="left" valign="top"><p>The most unusual entities in a time range</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
Adjust the <span class="strong strong"><strong>Severity</strong></span> to match the anomaly score that will trigger the action.
The anomaly score indicates the significance of a given anomaly compared to previous anomalies.
The default severity threshold is 75, which means every anomaly with an anomaly score of 75 or higher will trigger the associated action.
</li>
<li class="listitem">
(Optional) Turn on <span class="strong strong"><strong>Include interim results</strong></span> to include results that are created by the anomaly detection job <em>before</em> a bucket is finalized. These results might disappear after the bucket is fully processed.
Include interim results if you want to be notified earlier about a potential anomaly even if it might be a false positive.
</li>
<li class="listitem">
<p>(Optional) Expand and change <span class="strong strong"><strong>Advanced settings</strong></span>:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Setting</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Lookback interval</strong></span></p></td>
<td align="left" valign="top"><p>The interval used to query previous anomalies during each condition check. Setting the lookback interval lower than the default value might result in missed anomalies.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><span class="strong strong"><strong>Number of latest buckets</strong></span></p></td>
<td align="left" valign="top"><p>The number of buckets to check to obtain the highest anomaly from all the anomalies that are found during the Lookback interval. An alert is created based on the anomaly with the highest anomaly score from the most anomalous bucket.</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
(Optional) Under <span class="strong strong"><strong>Check the rule condition with an interval</strong></span>, specify an interval, then click <span class="strong strong"><strong>Test</strong></span> to check the rule condition with the interval specified.
The button is grayed out if the datafeed is not started.
To test the rule, start the data feed.
</li>
<li class="listitem">
(Optional) If you want to change how often the condition is evaluated, adjust the <span class="strong strong"><strong>Check every</strong></span> setting.
</li>
<li class="listitem">
(Optional) Set up <span class="strong strong"><strong>Actions</strong></span>.
</li>
<li class="listitem">
<span class="strong strong"><strong>Save</strong></span> your rule.
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Anomaly detection rules are defined as part of a job.
Alerts generated by these rules do not appear on the <span class="strong strong"><strong>Alerts</strong></span> page.</p>
</div>
</div>
<div class="position-relative"><h6><a id="observability-aiops-generate-anomaly-alerts-add-actions"></a>Add actions</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/alerting/aiops-generate-anomaly-alerts.asciidoc">edit</a></div>
<p>You can extend your rules with actions that interact with third-party systems, write to logs or indices, or send user notifications. You can add an action to a rule at any time. You can create rules without adding actions, and you can also define multiple actions for a single rule.</p>
<p>To add actions to rules, you must first create a connector for that service (for example, an email or external incident management system), which you can then use for different rules, each with their own action frequency.</p>
<details>
<summary class="title">Connector types</summary>
<div class="content">
<p>Connectors provide a central place to store connection information for services and integrations with third party systems.
The following connectors are available when defining actions for alerting rules:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/kibana/master/cases-action-type.html" class="ulink" target="_top">Cases</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/d3security-action-type.html" class="ulink" target="_top">D3 Security</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/email-action-type.html" class="ulink" target="_top">Email</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/resilient-action-type.html" class="ulink" target="_top">IBM Resilient</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/index-action-type.html" class="ulink" target="_top">Index</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/jira-action-type.html" class="ulink" target="_top">Jira</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/teams-action-type.html" class="ulink" target="_top">Microsoft Teams</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/obs-ai-assistant-action-type.html" class="ulink" target="_top">Observability AI Assistant</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/opsgenie-action-type.html" class="ulink" target="_top">Opsgenie</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/pagerduty-action-type.html" class="ulink" target="_top">PagerDuty</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/server-log-action-type.html" class="ulink" target="_top">Server log</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/servicenow-itom-action-type.html" class="ulink" target="_top">ServiceNow ITOM</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/servicenow-action-type.html" class="ulink" target="_top">ServiceNow ITSM</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/servicenow-sir-action-type.html" class="ulink" target="_top">ServiceNow SecOps</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/slack-action-type.html" class="ulink" target="_top">Slack</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/swimlane-action-type.html" class="ulink" target="_top">Swimlane</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/torq-action-type.html" class="ulink" target="_top">Torq</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/webhook-action-type.html" class="ulink" target="_top">Webhook</a>
</li>
<li class="listitem">
<a href="/guide/en/kibana/master/xmatters-action-type.html" class="ulink" target="_top">xMatters</a>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Some connector types are paid commercial features, while others are free.
For a comparison of the Elastic subscription levels, go to
<a href="/subscriptions" class="ulink" target="_top">the subscription page</a>.</p>
</div>
</div>
<p>For more information on creating connectors, refer to <a class="xref" href="action-connectors.html" title="Connectors">Connectors</a>.</p>
</div>
</details>
<details>
<summary class="title">Action frequency</summary>
<div class="content">
<p>After you select a connector, you must set the action frequency. You can choose to create a <span class="strong strong"><strong>Summary of alerts</strong></span> on each check interval or on a custom interval. For example, you can send email notifications that summarize the new, ongoing, and recovered alerts every twelve hours.</p>
<p>Alternatively, you can set the action frequency to <span class="strong strong"><strong>For each alert</strong></span> and specify the conditions each alert must meet for the action to run. For example, you can send an email only when alert status changes to critical.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/alert-action-frequency.png" alt="Configure when a rule is triggered">
</div>
</div>
<p>With the <span class="strong strong"><strong>Run when</strong></span> menu you can choose if an action runs when the the anomaly score matched the condition or was recovered. For example, you can add a corresponding action for each state to ensure you are alerted when the anomaly score was matched and also when it recovers.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/alert-anomaly-action-frequency-recovered.png" alt="Choose between anomaly score matched condition or recovered">
</div>
</div>
</div>
</details>
<details>
<summary class="title">Action variables</summary>
<div class="content">
<p>Use the default notification message or customize it.
You can add more context to the message by clicking the Add variable icon <span class="image"><img src="images/icons/indexOpen.svg" alt="Add variable"></span> and selecting from a list of available variables.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/action-variables-popup.png" alt="Action variables list">
</div>
</div>
<p>The following variables are specific to this rule type.
You can also specify <a href="/guide/en/kibana/master/rule-action-variables.html" class="ulink" target="_top">variables common to all rules</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">context.anomalyExplorerUrl</code>
</span>
</dt>
<dd>
URL to open in the Anomaly Explorer.
</dd>
<dt>
<span class="term">
<code class="literal">context.isInterim</code>
</span>
</dt>
<dd>
Indicate if top hits contain interim results.
</dd>
<dt>
<span class="term">
<code class="literal">context.jobIds</code>
</span>
</dt>
<dd>
List of job IDs that triggered the alert.
</dd>
<dt>
<span class="term">
<code class="literal">context.message</code>
</span>
</dt>
<dd>
Alert info message.
</dd>
<dt>
<span class="term">
<code class="literal">context.score</code>
</span>
</dt>
<dd>
Anomaly score at the time of the notification action.
</dd>
<dt>
<span class="term">
<code class="literal">context.timestamp</code>
</span>
</dt>
<dd>
The bucket timestamp of the anomaly.
</dd>
<dt>
<span class="term">
<code class="literal">context.timestampIso8601</code>
</span>
</dt>
<dd>
The bucket timestamp of the anomaly in ISO8601 format.
</dd>
<dt>
<span class="term">
<code class="literal">context.topInfluencers</code>
</span>
</dt>
<dd>
<p>
The list of top influencers. Properties include:
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">influencer_field_name</code>
</span>
</dt>
<dd>
The field name of the influencer.
</dd>
<dt>
<span class="term">
<code class="literal">influencer_field_value</code>
</span>
</dt>
<dd>
The entity that influenced, contributed to, or was to blame for the anomaly.
</dd>
<dt>
<span class="term">
<code class="literal">score</code>
</span>
</dt>
<dd>
The influencer score. A normalized score between 0-100 which shows the influencer’s overall contribution to the anomalies.
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">context.topRecords</code>
</span>
</dt>
<dd>
<p>
The list of top records. Properties include:
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">actual</code>
</span>
</dt>
<dd>
The actual value for the bucket.
</dd>
<dt>
<span class="term">
<code class="literal">by_field_value</code>
</span>
</dt>
<dd>
The value of the by field.
</dd>
<dt>
<span class="term">
<code class="literal">field_name</code>
</span>
</dt>
<dd>
Certain functions require a field to operate on, for example, <code class="literal">sum()</code>. For those functions, this value is the name of the field to be analyzed.
</dd>
<dt>
<span class="term">
<code class="literal">function</code>
</span>
</dt>
<dd>
The function in which the anomaly occurs, as specified in the detector configuration. For example, <code class="literal">max</code>.
</dd>
<dt>
<span class="term">
<code class="literal">over_field_name</code>
</span>
</dt>
<dd>
The field used to split the data.
</dd>
<dt>
<span class="term">
<code class="literal">partition_field_value</code>
</span>
</dt>
<dd>
The field used to segment the analysis.
</dd>
<dt>
<span class="term">
<code class="literal">score</code>
</span>
</dt>
<dd>
A normalized score between 0-100, which is based on the probability of the anomalousness of this record.
</dd>
<dt>
<span class="term">
<code class="literal">typical</code>
</span>
</dt>
<dd>
The typical value for the bucket, according to analytical modeling.
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</details>
<div class="position-relative"><h6><a id="observability-aiops-generate-anomaly-alerts-edit-an-anomaly-detection-rule"></a>Edit an anomaly detection rule</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/alerting/aiops-generate-anomaly-alerts.asciidoc">edit</a></div>
<p>To edit an anomaly detection rule:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your Observability project, go to <span class="strong strong"><strong>AIOps</strong></span> → <span class="strong strong"><strong>Anomaly detection</strong></span>.
</li>
<li class="listitem">
Expand the job that uses the rule you want to edit.
</li>
<li class="listitem">
On the <span class="strong strong"><strong>Job settings</strong></span> tab, under <span class="strong strong"><strong>Alert rules</strong></span>, click the rule to edit it.
</li>
</ol>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="observability-create-manage-rules.html">« Create and manage rules</a>
</span>
<span class="next">
<a href="observability-create-anomaly-alert-rule.html">Create an APM anomaly rule »</a>
</span>
</div>
</body>
</html>
