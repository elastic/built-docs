<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tune your anomaly detection job | Serverless | Elastic</title>
<meta class="elastic" name="content" content="Tune your anomaly detection job | Serverless">

<link rel="home" href="index.html" title="Serverless"/>
<link rel="up" href="observability-aiops-detect-anomalies.html" title="Detect anomalies"/>
<link rel="prev" href="observability-aiops-detect-anomalies.html" title="Detect anomalies"/>
<link rel="next" href="observability-aiops-forecast-anomalies.html" title="Forecast future behavior"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Serverless"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Serverless/Guide"/>
<meta name="DC.subject" content="Serverless"/>
<meta name="DC.identifier" content="main"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="observability-aiops-detect-anomalies.html">« Detect anomalies</a>
</span>
<span class="next">
<a href="observability-aiops-forecast-anomalies.html">Forecast future behavior »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="what-is-observability-serverless.html">Elastic Observability serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="observability-machine-learning.html">Machine learning and AIOps</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="observability-aiops-detect-anomalies.html">Detect anomalies</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Tune your anomaly detection job</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/machine-learning/aiops-tune-anomaly-detection-job.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="observability-aiops-tune-anomaly-detection-job"></a>Tune your anomaly detection job</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/machine-learning/aiops-tune-anomaly-detection-job.asciidoc">edit</a></div>
</div></div></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p class="admon_title">Required role</p>
<p>The <span class="strong strong"><strong>Editor</strong></span> role or higher is required to create calendars, add job rules, and define custom URLs. To learn more, refer to <a class="xref" href="general-manage-organization.html#general-assign-user-roles" title="Assign user roles and privileges">Assign user roles and privileges</a>.</p>
</div>
</div>
<p>After you run an anomaly detection job and view the results,
you might find that you need to alter the job configuration or settings.</p>
<p>To further tune your job, you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="observability-aiops-tune-anomaly-detection-job.html#create-calendars" title="Create calendars">Create calendars</a> that contain a list of scheduled events for which you do not want to generate anomalies, such as planned system outages or public holidays.
</li>
<li class="listitem">
<a class="xref" href="observability-aiops-tune-anomaly-detection-job.html#create-job-rules" title="Create job rules and filters">Create job rules</a> that instruct anomaly detectors to change their behavior based on domain-specific knowledge that you provide.
Your job rules can use filter lists, which contain values that you can use to include or exclude events from the machine learning analysis.
</li>
<li class="listitem">
<a class="xref" href="observability-aiops-tune-anomaly-detection-job.html#define-custom-urls" title="Define custom URLs">Define custom URLs</a> to make dashboards and other resources readily available when viewing job results.
</li>
</ul>
</div>
<p>For more information about tuning your job,
refer to the how-to guides in the <a href="/guide/en/machine-learning/8.16/anomaly-how-tos.html" class="ulink" target="_top">machine learning</a> documentation.
Note that the machine learning documentation may contain details that are not valid when using a fully-managed Elastic project.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You can also create calendars and add URLs when configuring settings during job creation,
but generally it&#8217;s easier to start with a simple job and add complexity later.</p>
</div>
</div>
<div class="position-relative"><h6><a id="create-calendars"></a>Create calendars</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/machine-learning/aiops-tune-anomaly-detection-job.asciidoc">edit</a></div>
<p>Sometimes there are periods when you expect unusual activity to take place,
such as bank holidays, "Black Friday", or planned system outages.
If you identify these events in advance, no anomalies are generated during that period.
The machine learning model is not ill-affected, and you do not receive spurious results.</p>
<p>To create a calendar and add scheduled events:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your Elastic Observability Serverless project, go to <span class="strong strong"><strong>Machine learning</strong></span> → <span class="strong strong"><strong>Settings</strong></span>.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Calendars</strong></span>, click <span class="strong strong"><strong>Create</strong></span>.
</li>
<li class="listitem">
Enter an ID and description for the calendar.
</li>
<li class="listitem">
Select the jobs you want to apply the calendar to, or turn on <span class="strong strong"><strong>Apply calendar to all jobs</strong></span>.
</li>
<li class="listitem">
<p>Under <span class="strong strong"><strong>Events</strong></span>, click <span class="strong strong"><strong>New event</strong></span> or click <span class="strong strong"><strong>Import events</strong></span> to import events from an iCalendar (ICS) file:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-detection-create-calendar.png" alt="Create new calendar page">
</div>
</div>
<p>A scheduled event must have a start time, end time, and calendar ID.
In general, scheduled events are short in duration (typically lasting from a few hours to a day) and occur infrequently.
If you have regularly occurring events, such as weekly maintenance periods,
you do not need to create scheduled events for these circumstances;
they are already handled by the machine learning analytics.
If your ICS file contains recurring events, only the first occurrence is imported.</p>
</li>
<li class="listitem">
When you&#8217;re done adding events, save your calendar.
</li>
</ol>
</div>
<p>You must identify scheduled events <em>before</em> your anomaly detection job analyzes the data for that time period.
Machine learning results are not updated retroactively.
Bucket results are generated during scheduled events, but they have an anomaly score of zero.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you use long or frequent scheduled events,
it might take longer for the machine learning analytics to learn to model your data,
and some anomalous behavior might be missed.</p>
</div>
</div>
<div class="position-relative"><h6><a id="create-job-rules"></a>Create job rules and filters</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/machine-learning/aiops-tune-anomaly-detection-job.asciidoc">edit</a></div>
<p>By default, anomaly detection is unsupervised,
and the machine learning models have no awareness of the domain of your data.
As a result, anomaly detection jobs might identify events that are statistically significant but are uninteresting when you know the larger context.</p>
<p>You can customize anomaly detection by creating custom job rules.
<em>Job rules</em> instruct anomaly detectors to change their behavior based on domain-specific knowledge that you provide.
When you create a rule, you can specify conditions, scope, and actions.
When the conditions of a rule are satisfied, its actions are triggered.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p class="admon_title">Example use case for creating a job rule</p>
<p>If you have an anomaly detector that is analyzing CPU usage,
you might decide you are only interested in anomalies where the CPU usage is greater than a certain threshold.
You can define a rule with conditions and actions that instruct the detector to refrain from generating machine learning results when there are anomalous events related to low CPU usage.
You might also decide to add a scope for the rule so that it applies only to certain machines.
The scope is defined by using machine learning filters.</p>
</div>
</div>
<p><em>Filters</em> contain a list of values that you can use to include or exclude events from the machine learning analysis.
You can use the same filter in multiple anomaly detection jobs.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p class="admon_title">Example use case for creating a filter list</p>
<p>If you are analyzing web traffic, you might create a filter that contains a list of IP addresses.
The list could contain IP addresses that you trust to upload data to your website or to send large amounts of data from behind your firewall.
You can define the rule&#8217;s scope so that the action triggers only when a specific field in your data matches (or doesn&#8217;t match) a value in the filter.
This gives you much greater control over which anomalous events affect the machine learning model and appear in the machine learning results.</p>
</div>
</div>
<p>To create a job rule, first create any filter lists you want to use in the rule, then configure the rule:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your Elastic Observability Serverless project, go to <span class="strong strong"><strong>Machine learning</strong></span> → <span class="strong strong"><strong>Settings</strong></span>.
</li>
<li class="listitem">
<p>(Optional) Create one or more filter lists:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Under <span class="strong strong"><strong>Filter lists</strong></span>, click <span class="strong strong"><strong>Create</strong></span>.
</li>
<li class="listitem">
Enter the filter list ID. This is the ID you will select when you want to use the filter list in a job rule.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add item</strong></span> and enter one item per line.
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Add</strong></span> then save the filter list:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-detection-create-filter-list.png" alt="Create filter list">
</div>
</div>
</li>
</ol>
</div>
</li>
<li class="listitem">
Open the job results in the <span class="strong strong"><strong>Single Metric Viewer</strong></span> or <span class="strong strong"><strong>Anomaly Explorer</strong></span>.
</li>
<li class="listitem">
<p>From the <span class="strong strong"><strong>Actions</strong></span> menu in the <span class="strong strong"><strong>Anomalies</strong></span> table, select <span class="strong strong"><strong>Configure job rules</strong></span>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-detection-configure-job-rules.png" alt="Configure job rules menu selection">
</div>
</div>
</li>
<li class="listitem">
Choose which actions to take when the job rule matches the anomaly: <span class="strong strong"><strong>Skip result</strong></span>, <span class="strong strong"><strong>Skip model update</strong></span>, or both.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Conditions</strong></span>, add one or more conditions that must be met for the action to be triggered.
</li>
<li class="listitem">
Under <span class="strong strong"><strong>Scope</strong></span> (if available), add one or more filter lists to limit where the job rule applies.
</li>
<li class="listitem">
Save the job rule.
Note that changes to job rules take effect for new results only.
To apply these changes to existing results, you must clone and rerun the job.
</li>
</ol>
</div>
<div class="position-relative"><h6><a id="define-custom-urls"></a>Define custom URLs</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/machine-learning/aiops-tune-anomaly-detection-job.asciidoc">edit</a></div>
<p>You can optionally attach one or more custom URLs to your anomaly detection jobs.
Links for these URLs will appear in the <span class="strong strong"><strong>Actions</strong></span> menu of the anomalies table when viewing job results in the <span class="strong strong"><strong>Single Metric Viewer</strong></span> or <span class="strong strong"><strong>Anomaly Explorer</strong></span>.
Custom URLs can point to dashboards, the Discover app, or external websites.
For example, you can define a custom URL that enables users to drill down to the source data from the results set.</p>
<p>To add a custom URL to the <span class="strong strong"><strong>Actions</strong></span> menu:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your Elastic Observability Serverless project, go to <span class="strong strong"><strong>Machine learning</strong></span> → <span class="strong strong"><strong>Jobs</strong></span>.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Actions</strong></span> menu in the job list, select <span class="strong strong"><strong>Edit job</strong></span>.
</li>
<li class="listitem">
Select the <span class="strong strong"><strong>Custom URLs</strong></span> tab, then click <span class="strong strong"><strong>Add custom URL</strong></span>.
</li>
<li class="listitem">
Enter the label to use for the link text.
</li>
<li class="listitem">
<p>Choose the type of resource you want to link to:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">If you select&#8230;&#8203;</th>
<th align="left" valign="top">Do this&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Kibana dashboard</p></td>
<td align="left" valign="top"><p>Select the dashboard you want to link to.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Discover</p></td>
<td align="left" valign="top"><p>Select the data view to use.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Other</p></td>
<td align="left" valign="top"><p>Specify the URL for the external website.</p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Test</strong></span> to test your link.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add</strong></span>, then save your changes.
</li>
</ol>
</div>
<p>Now when you view job results in <span class="strong strong"><strong>Single Metric Viewer</strong></span> or <span class="strong strong"><strong>Anomaly Explorer</strong></span>,
the <span class="strong strong"><strong>Actions</strong></span> menu includes the custom link:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/anomaly-detection-custom-url.png" alt="Create filter list">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is also possible to use string substitution in custom URLs.
For example, you might have a <span class="strong strong"><strong>Raw data</strong></span> URL defined as:</p>
<p><code class="literal">discover#/?_g=(time:(from:'$earliest$',mode:absolute,to:'$latest$'))&amp;_a=(index:ff959d40-b880-11e8-a6d9-e546fe2bba5f,query:(language:kuery,query:'customer_full_name.keyword:"$customer_full_name.keyword$"'))</code>.</p>
<p>The value of the <code class="literal">customer_full_name.keyword</code> field is passed to the target page when the link is clicked.</p>
<p>For more information about using string substitution,
refer to the <a href="/guide/en/machine-learning/8.16/ml-configuring-url.html#ml-configuring-url-strings" class="ulink" target="_top">machine learning</a> documentation.
Note that the machine learning documentation may contain details that are not valid when using a fully-managed Elastic project.</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="observability-aiops-detect-anomalies.html">« Detect anomalies</a>
</span>
<span class="next">
<a href="observability-aiops-forecast-anomalies.html">Forecast future behavior »</a>
</span>
</div>
</body>
</html>
