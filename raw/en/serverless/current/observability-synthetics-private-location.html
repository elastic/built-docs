<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Monitor resources on private networks | Serverless | Elastic</title>
<meta class="elastic" name="content" content="Monitor resources on private networks | Serverless">

<link rel="home" href="index.html" title="Serverless"/>
<link rel="up" href="observability-monitor-synthetics.html" title="Synthetic monitoring"/>
<link rel="prev" href="observability-synthetics-analyze.html" title="Analyze data from synthetic monitors"/>
<link rel="next" href="observability-synthetics-command-reference.html" title="Use the Synthetics CLI"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Serverless"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Serverless/Guide"/>
<meta name="DC.subject" content="Serverless"/>
<meta name="DC.identifier" content="main"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="observability-synthetics-analyze.html">« Analyze data from synthetic monitors</a>
</span>
<span class="next">
<a href="observability-synthetics-command-reference.html">Use the Synthetics CLI »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="what-is-observability-serverless.html">Elastic Observability serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="observability-monitor-synthetics.html">Synthetic monitoring</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Monitor resources on private networks</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="observability-synthetics-private-location"></a>Monitor resources on private networks</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
</div></div></div>
<p><span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span></p>
<p>To monitor resources on private networks you can either:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Allow Elastic&#8217;s global managed infrastructure to access your private endpoints.
</li>
<li class="listitem">
Use Elastic Agent to create a Private Location.
</li>
</ul>
</div>
<p>Private Locations via Elastic Agent require only outbound connections from your network,
while allowing Elastic&#8217;s global managed infrastructure to access a private endpoint requires
inbound access, thus posing an additional risk that users must assess.</p>
<div class="position-relative"><h5><a id="monitor-via-access-control"></a>Allow access to your private network</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
<p>To give Elastic&#8217;s global managed infrastructure access to a private endpoint, use IP address filtering, HTTP authentication, or both.</p>
<p>To grant access via IP, use <a href="https://manifest.synthetics.elastic-cloud.com/v1/ip-ranges.json" class="ulink" target="_top">this list of egress IPs</a>.
The addresses and locations on this list may change, so automating updates to
filtering rules is recommended. IP filtering alone will allow all users of Elastic&#8217;s global managed infrastructure access to your endpoints, if this
is a concern consider adding additional protection via user/password authentication via a proxy like nginx.</p>
<div class="position-relative"><h5><a id="monitor-via-private-agent"></a>Monitor via a private agent</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
<p>Private Locations allow you to run monitors from your own premises.
Before running a monitor on a Private Location, you&#8217;ll need to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="observability-synthetics-private-location.html#synthetics-private-location-fleet-agent" title="Set up Elastic Agent">Set up Elastic Agent</a>.
</li>
<li class="listitem">
<a class="xref" href="observability-synthetics-private-location.html#synthetics-private-location-connect" title="Connect to your Observability project">Connect Fleet to your Observability project</a> and enroll an Elastic Agent in Fleet.
</li>
<li class="listitem">
<a class="xref" href="observability-synthetics-private-location.html#synthetics-private-location-add" title="Add a Private Location">Add a Private Location</a> in the Synthetics UI.
</li>
</ul>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Private Locations running through Elastic Agent must have a direct connection to Elasticsearch.
Do not configure any ingest pipelines, or output via Logstash as this will prevent Synthetics from working properly and is not supported.</p>
</div>
</div>
<div class="position-relative"><h5><a id="synthetics-private-location-fleet-agent"></a>Set up Elastic Agent</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
<p>Start by setting up Elastic Agent and creating an agent policy**. For more information on agent policies and creating them, refer to <a href="/guide/en/fleet/8.16/agent-policy.html#create-a-policy" class="ulink" target="_top">Elastic Agent policy</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>A Private Location should be set up against an agent policy that runs on a single Elastic Agent.
The Elastic Agent must be <span class="strong strong"><strong>enrolled in Fleet</strong></span> (Private Locations cannot be set up using <span class="strong strong"><strong>standalone</strong></span> Elastic Agents).
Do <em>not</em> run the same agent policy on multiple agents being used for Private Locations, as you may
end up with duplicate or missing tests. Private Locations do not currently load balance tests across
multiple Elastic Agents. See <a class="xref" href="observability-synthetics-private-location.html#synthetics-private-location-scaling" title="Scaling Private Locations">Scaling Private Locations</a> for information on increasing the capacity
within a Private Location.</p>
<p>By default Private Locations are configured to allow two simultaneous browser tests and an unlimited number of lightweight checks.
As a result, if more than two browser tests are assigned to a particular Private Location, there may be a delay to run them.</p>
</div>
</div>
<div class="position-relative"><h5><a id="synthetics-private-location-connect"></a>Connect to your Observability project</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
<p>After setting up Fleet, you&#8217;ll connect Fleet to the your Observability project
and enroll an Elastic Agent in Fleet.</p>
<p>Elastic provides Docker images that you can use to run Fleet and an Elastic Agent more easily.
For monitors running on Private Locations, you <em>must</em> use the <code class="literal">elastic-agent-complete</code>
Docker image to create a self-hosted Elastic Agent node. The standard Elastic Cloud or self-hosted
Elastic Agent will not work.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">elastic-agent-complete</code> Docker image is the only way to have all available options that you see in the UI.</p>
</div>
</div>
<p>To pull the Docker image run:</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker pull docker.elastic.co/elastic-agent/elastic-agent-complete:8.16.0</pre>
</div>
<p>Then enroll and run an Elastic Agent.
You&#8217;ll need an enrollment token and the URL of the Fleet Server.
You can use the default enrollment token for your policy or create new policies
and <a href="/guide/en/fleet/8.16/fleet-enrollment-tokens.html" class="ulink" target="_top">enrollment tokens</a> as needed.</p>
<p>For more information on running Elastic Agent with Docker, refer to
<a href="/guide/en/fleet/8.16/elastic-agent-container.html" class="ulink" target="_top">Run Elastic Agent in a container</a>.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">docker run \
  --env FLEET_ENROLL=1 \
  --env FLEET_URL={fleet_server_host_url} \
  --env FLEET_ENROLLMENT_TOKEN={enrollment_token} \
  --cap-add=NET_RAW \
  --cap-add=SETUID \
  --rm docker.elastic.co/elastic-agent/elastic-agent-complete:8.16.0</pre>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">elastic-agent-complete</code> Docker image requires additional capabilities to operate correctly. Ensure
<code class="literal">NET_RAW</code> and <code class="literal">SETUID</code> are enabled on the container.</p>
</div>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You may need to set other environment variables.
Learn how in <a href="/guide/en/fleet/8.16/agent-environment-variables.html" class="ulink" target="_top">Elastic Agent environment variables guide</a>.</p>
</div>
</div>
<div class="position-relative"><h5><a id="synthetics-private-location-add"></a>Add a Private Location</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
<p>When the Elastic Agent is running you can add a new Private Location in your Observability project&#8217;s <span class="strong strong"><strong>Synthetics</strong></span> section:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Settings</strong></span>.
</li>
<li class="listitem">
Go to the <span class="strong strong"><strong>Private Locations</strong></span> tab.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add location</strong></span>.
</li>
<li class="listitem">
Give your new location a unique <em>Location name</em> and select the <em>Agent policy</em> you created above.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save</strong></span>.
</li>
</ol>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is not currently possible to use custom CAs for synthetics browser tests in private locations without following a workaround.
To learn more about the workaround, refer to the following GitHub issue:
<a href="https://github.com/elastic/synthetics/issues/717" class="ulink" target="_top">elastic/synthetics#717</a>.</p>
</div>
</div>
<div class="position-relative"><h5><a id="synthetics-private-location-scaling"></a>Scaling Private Locations</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
<p>By default Private Locations are configured to allow two simultaneous browser tests, and an unlimited number of lightweight checks.
These limits can be set via the environment variables <code class="literal">SYNTHETICS_LIMIT_{TYPE}</code>, where <code class="literal">{TYPE}</code> is one of <code class="literal">BROWSER</code>, <code class="literal">HTTP</code>, <code class="literal">TCP</code>, and <code class="literal">ICMP</code>
for the container running the Elastic Agent docker image.</p>
<p>It is critical to allocate enough memory and CPU capacity to handle configured limits.
Start by allocating at least 2 GiB of memory and two cores per browser instance to ensure consistent
performance and avoid out-of-memory errors. Then adjust as needed. Resource requirements will vary depending on workload.
Much less memory is needed for lightweight monitors. Start by allocating at least 512MiB of memory and two cores for
lightweight checks. Then increase allocated memory and CPU based on observed usage patterns.</p>
<p>These limits are for simultaneous tests, not total tests. For example, if
60 browser tests were scheduled to run once per hour and each took 1 minute to run, that would fully occupy one execution slot.
However, it is a good practice to set up execution slots with extra capacity. A good starting point would be to over-allocate by
a factor of 5. In the previous example that would mean allocating 5 slots.</p>
<div class="position-relative"><h5><a id="synthetics-private-location-next"></a>Next steps</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/main/docs/en/serverless/synthetics/synthetics-private-location.asciidoc">edit</a></div>
<p>Now you can add monitors to your Private Location in <a class="xref" href="observability-synthetics-get-started-ui.html" title="Create monitors in the Synthetics UI">the Synthetics UI</a> or using the <a class="xref" href="observability-synthetics-get-started-project.html" title="Create monitors with a Synthetics project">Elastic Synthetics library&#8217;s <code class="literal">push</code> method</a>.</p>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="observability-synthetics-analyze.html">« Analyze data from synthetic monitors</a>
</span>
<span class="next">
<a href="observability-synthetics-command-reference.html">Use the Synthetics CLI »</a>
</span>
</div>
</body>
</html>
