<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="">
<title>Rules | Serverless | Elastic</title>
<meta class="elastic" name="content" content="Rules | Serverless">

<link rel="home" href="index.html" title="Serverless"/>
<link rel="up" href="project-settings.html" title="Management settings"/>
<link rel="prev" href="reports.html" title="Reports"/>
<link rel="next" href="saved-objects.html" title="Saved objects"/>
<meta class="elastic" name="product_version" content="main"/>
<meta class="elastic" name="product_name" content="Serverless"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Serverless/Guide"/>
<meta name="DC.subject" content="Serverless"/>
<meta name="DC.identifier" content="main"/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="reports.html">« Reports</a>
</span>
<span class="next">
<a href="saved-objects.html">Saved objects »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Serverless</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="project-and-management-settings.html">Project and management settings</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="project-settings.html">Management settings</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Rules</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/docs-content/edit/main/serverless/pages/rules.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="rules"></a>Rules</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/docs-content/edit/main/serverless/pages/rules.asciidoc">edit</a></div>
</div></div></div>
<p><span class="Admonishment Admonishment--preview">
[<span class="Admonishment-title u-mono">preview</span>]
<span class="Admonishment-detail">
This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.
</span>
</span></p>
<p>This content applies to: <a class="xref" href="what-is-elasticsearch-serverless.html" title="Elasticsearch"><span class="image"><img src="images/es-badge.svg" alt="Elasticsearch"></span></a></p>
<p>In general, a rule consists of three parts:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<em>Conditions</em>: what needs to be detected?
</li>
<li class="listitem">
<em>Schedule</em>: when/how often should detection checks run?
</li>
<li class="listitem">
<em>Actions</em>: what happens when a condition is detected?
</li>
</ul>
</div>
<p>For example, when monitoring a set of servers, a rule might:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Check for average CPU usage &gt; 0.9 on each server for the last two minutes (condition).
</li>
<li class="listitem">
Check every minute (schedule).
</li>
<li class="listitem">
Send a warning email message via SMTP with subject <code class="literal">CPU on {{server}} is high</code> (action).
</li>
</ul>
</div>
<div class="position-relative"><h5><a id="rules-conditions"></a>Conditions</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/docs-content/edit/main/serverless/pages/rules.asciidoc">edit</a></div>
<p>Each project type supports a specific set of rule types.
Each <em>rule type</em> provides its own way of defining the conditions to detect, but an expression formed by a series of clauses is a common pattern.
For example, in an Elasticsearch query rule, you specify an index, a query, and a threshold, which uses a metric aggregation operation (<code class="literal">count</code>, <code class="literal">average</code>, <code class="literal">max</code>, <code class="literal">min</code>, or <code class="literal">sum</code>):</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/es-query-rule-conditions.png" alt="UI for defining rule conditions in an Elasticsearch query rule">
</div>
</div>
<div class="position-relative"><h5><a id="rules-schedule"></a>Schedule</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/docs-content/edit/main/serverless/pages/rules.asciidoc">edit</a></div>
<p>All rules must have a check interval, which defines how often to evaluate the rule conditions.
Checks are queued; they run as close to the defined value as capacity allows.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The intervals of rule checks in Kibana are approximate. Their timing is affected by factors such as the frequency at which tasks are claimed and the task load on the system. Refer to <a href="/guide/en/kibana/master/alerting-production-considerations.html" class="ulink" target="_top">Alerting production considerations</a></p>
</div>
</div>
<div class="position-relative"><h5><a id="rules-actions"></a>Actions</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/docs-content/edit/main/serverless/pages/rules.asciidoc">edit</a></div>
<p>You can add one or more actions to your rule to generate notifications when its conditions are met.
Recovery actions likewise run when rule conditions are no longer met.</p>
<p>When defining actions in a rule, you specify:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A connector
</li>
<li class="listitem">
An action frequency
</li>
<li class="listitem">
A mapping of rule values to properties exposed for that type of action
</li>
</ul>
</div>
<p>Each action uses a connector, which provides connection information for a Kibana service or third party integration, depending on where you want to send the notifications.
The specific list of connectors that you can use in your rule vary by project type.
Refer to <a class="xref" href="action-connectors.html" title="Connectors">Connectors</a>.</p>
<p>After you select a connector, set the <em>action frequency</em>.
If you want to reduce the number of notifications you receive without affecting their timeliness, some rule types support alert summaries.
For example, if you create an Elasticsearch query rule, you can set the action frequency such that you receive summaries of the new, ongoing, and recovered alerts on a custom interval:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/es-query-rule-action-summary.png" alt="UI for defining rule conditions in an Elasticsearch query rule">
</div>
</div>
<p>Alternatively, you can set the action frequency such that the action runs for each alert.
If the rule type does not support alert summaries, this is your only available option.
You must choose when the action runs (for example, at each check interval, only when the alert status changes, or at a custom action interval).
You must also choose an action group, which affects whether the action runs.
Each rule type has a specific set of valid action groups.
For example, you can set <em>Run when</em> to <code class="literal">Query matched</code> or <code class="literal">Recovered</code> for the Elasticsearch query rule:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/es-query-rule-recovery-action.png" alt="UI for defining a recovery action">
</div>
</div>
<p>Each connector supports a specific set of actions for each action group and enables different action properties.
For example, you can have actions that create an Opsgenie alert when rule conditions are met and recovery actions that close the Opsgenie alert.</p>
<p>Some types of rules enable you to further refine the conditions under which actions run.
For example, you can specify that actions run only when an alert occurs within a specific time frame or when it matches a KQL query.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are not using alert summaries, actions are triggered per alert and a rule can end up generating a large number of actions. Take the following example where a rule is monitoring three servers every minute for CPU usage &gt; 0.9, and the action frequency is <code class="literal">On check intervals</code>:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Minute 1: server X123 &gt; 0.9. <em>One email</em> is sent for server X123.
</li>
<li class="listitem">
Minute 2: X123 and Y456 &gt; 0.9. <em>Two emails</em> are sent, one for X123 and one for Y456.
</li>
<li class="listitem">
Minute 3: X123, Y456, Z789 &gt; 0.9. <em>Three emails</em> are sent, one for each of X123, Y456, Z789.
</li>
</ul>
</div>
<p>In this example, three emails are sent for server X123 in the span of 3 minutes for the same rule. Often, it&#8217;s desirable to suppress these re-notifications. If
you set the action frequency to <code class="literal">On custom action intervals</code> with an interval of 5 minutes, you reduce noise by getting emails only every 5 minutes for
servers that continue to exceed the threshold:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Minute 1: server X123 &gt; 0.9. <em>One email</em> will be sent for server X123.
</li>
<li class="listitem">
Minute 2: X123 and Y456 &gt; 0.9. <em>One email</em> will be sent for Y456.
</li>
<li class="listitem">
Minute 3: X123, Y456, Z789 &gt; 0.9. <em>One email</em> will be sent for Z789.
</li>
</ul>
</div>
<p>To get notified only once when a server exceeds the threshold, you can set the action frequency to <code class="literal">On status changes</code>. Alternatively, if the rule type supports alert summaries, consider using them to reduce the volume of notifications.</p>
</div>
</div>
<div class="position-relative"><h6><a id="rules-action-variables"></a>Action variables</h6><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/docs-content/edit/main/serverless/pages/rules.asciidoc">edit</a></div>
<p>You can pass rule values to an action at the time a condition is detected.
To view the list of variables available for your rule, click the "add rule variable" button:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/es-query-rule-action-variables.png" alt="Passing rule values to an action">
</div>
</div>
<p>For more information about common action variables, refer to <a href="/guide/en/kibana/master/rule-action-variables.html" class="ulink" target="_top">Rule actions variables</a></p>
<div class="position-relative"><h5><a id="rules-alerts"></a>Alerts</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/docs-content/edit/main/serverless/pages/rules.asciidoc">edit</a></div>
<p>When checking for a condition, a rule might identify multiple occurrences of the condition.
Kibana tracks each of these alerts separately.
Depending on the action frequency, an action occurs per alert or at the specified alert summary interval.</p>
<p>Using the server monitoring example, each server with average CPU &gt; 0.9 is tracked as an alert.
This means a separate email is sent for each server that exceeds the threshold whenever the alert status changes.</p>
<div class="position-relative"><h5><a id="rules-putting-it-all-together"></a>Putting it all together</h5><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/docs-content/edit/main/serverless/pages/rules.asciidoc">edit</a></div>
<p>A rule consists of conditions, actions, and a schedule.
When conditions are met, alerts are created that render actions and invoke them.
To make action setup and update easier, actions use connectors that centralize the information used to connect with Kibana services and third-party integrations.
The following example ties these concepts together:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/rule-concepts-summary.svg" alt="Rules" width="connectors" height="alerts and actions work together to convert detection into action">
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Any time a rule&#8217;s conditions are met, an alert is created. This example checks for servers with average CPU &gt; 0.9. Three servers meet the condition, so three alerts are created.
</li>
<li class="listitem">
Alerts create actions according to the action frequency, as long as they are not muted or throttled. When actions are created, its properties are filled with actual values. In this example, three actions are created when the threshold is met, and the template string <code class="literal">{{server}}</code> is replaced with the appropriate server name for each alert.
</li>
<li class="listitem">
Kibana runs the actions, sending notifications by using a third party integration like an email service.
</li>
<li class="listitem">
If the third party integration has connection parameters or credentials, Kibana fetches these from the appropriate connector.
</li>
</ol>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="reports.html">« Reports</a>
</span>
<span class="next">
<a href="saved-objects.html">Saved objects »</a>
</span>
</div>
</body>
</html>
