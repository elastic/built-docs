<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Installing Shield | Shield Reference [2.0] | Elastic</title>
<link rel="home" href="index.html" title="Shield Reference [2.0]"/>
<link rel="up" href="index.html" title="Shield Reference [2.0]"/>
<link rel="prev" href="how-shield-works.html" title="How Shield Works"/>
<link rel="next" href="setting-up-authentication.html" title="Setting Up User Authentication"/>
<meta name="DC.type" content="Learn/Docs/Legacy/Shield/Reference/2.0"/>
<meta name="DC.subject" content="Shield"/>
<meta name="DC.identifier" content="2.0"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
From version 5.0 onward, Shield is part of X-Pack. For more information, see
<a href=https://www.elastic.co/guide/en/elastic-stack-overview/current/elasticsearch-security.html>
    Securing the Elastic Stack</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Shield Reference [2.0]</a></span>
»
<span class="breadcrumb-node">Installing Shield</span>
</div>
<div class="navheader">
<span class="prev">
<a href="how-shield-works.html">« How Shield Works</a>
</span>
<span class="next">
<a href="setting-up-authentication.html">Setting Up User Authentication »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="installing-shield"></a>Installing Shield<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.0/docs/public/shield/installing-shield.asciidoc">edit</a></h1>
</div></div></div>
<p>The <a class="xref" href="getting-started.html" title="Getting Started with Shield">Getting Started Guide</a> steps through a basic Shield installation. This section provides some additional information about the installation prerequisites, deployment options, and the installation process for RPM/DEB package installations.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The Shield plugin must be installed on every node in the cluster and every
node must be restarted after installation. Plan for a complete cluster restart before beginning the installation process.</p>
</div>
</div>
<h3><a id="_shield_installation_prerequisites"></a>Shield Installation Prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.0/docs/public/shield/installing-shield.asciidoc">edit</a></h3>
<p>To install Shield 2.0.0, you need:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Java 7 or later
</li>
<li class="listitem">
Elasticsearch 2.0.0
</li>
<li class="listitem">
Elasticsearch License plugin 2.0.0
</li>
</ul>
</div>
<p>For information about installing the latest Oracle JDK, see <a href="http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html" class="ulink" target="_top">Java SE Downloads</a>. For information about installing Elasticsearch, see <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.0/_installation.html" class="ulink" target="_top">Installation</a> in the Elasticsearch Reference.</p>
<h3><a id="deb-rpm-install"></a>Installing Shield on a DEB/RPM Package Installation<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.0/docs/public/shield/installing-shield.asciidoc">edit</a></h3>
<p>If you use the DEB/RPM packages to install Elasticsearch, by default Elasticsearch is installed in
<code class="literal">/usr/share/elasticsearch</code> and the configuration files are stored in <code class="literal">/etc/elasticsearch</code>. (For the
complete list of default paths, see <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.0/setup-dir-layout.html#_deb_and_rpm" class="ulink" target="_top">Directory Layout</a> in
the Elasticsearch Reference.)</p>
<p>To install the Shield and License plugins on a DEB/RPM package installation, you need to run
<code class="literal">bin/plugin install</code> from the <code class="literal">/usr/share/elasticsearch</code> directory with superuser permissions. For example:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">cd /usr/share/elasticsearch
sudo bin/plugin install license
sudo bin/plugin install shield</pre>
</div>
<h3><a id="offline-install"></a>Installing Shield on Offline Machines<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.0/docs/public/shield/installing-shield.asciidoc">edit</a></h3>
<p>Elasticsearch’s <code class="literal">bin/plugin</code> script requires direct Internet access to download and install the
License and Shield plugins. If your server doesn’t have Internet access, you can manually
download and install the plugins.</p>
<p>To install Shield on a machine that doesn&#8217;t have Internet access:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Manually download the appropriate License and Shield binaries:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.0.0/license-2.0.0.zip" class="ulink" target="_top">
https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.0.0/license-2.0.0.zip</a>
</li>
<li class="listitem">
<a href="https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/shield/2.0.0/shield-2.0.0.zip" class="ulink" target="_top">
https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/shield/2.0.0/shield-2.0.0.zip</a>
</li>
</ul>
</div>
</li>
<li class="listitem">
Transfer the zip files to the offline machine.
</li>
<li class="listitem">
<p>Run <code class="literal">bin/plugin install</code> to install the plugins using the zip files. For example:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/plugin install file:///path/to/file/license-2.0.0.zip <a id="CO1-1"></a><i class="conum" data-value="1"></i>
bin/plugin install file:///path/to/file/shield-2.0.0.zip</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO1-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Note that you must specify an absolute path to the zip file after the <code class="literal">file://</code> protocol.</p>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<h3><a id="tribe-node"></a>Installing Shield on Tribe Nodes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.0/docs/public/shield/installing-shield.asciidoc">edit</a></h3>
<p>Shield supports the <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.0/modules-tribe.html" class="ulink" target="_top">Tribe Node</a>, which acts as a federated client across multiple clusters. When using Tribe Nodes with Shield, you must have the same Shield configuration (users, roles, user-role mappings, SSL/TLS CA) on each cluster, and on the Tribe Node itself, where security checking is primarily done. This, of course, also means
that all clusters must be running Shield.</p>
<p>To use a Tribe Node with Shield:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Configure the same privileges on all connected clusters. The Tribe Node has its own configuration and privileges, which need to grant access to actions and indices on all of the
connected clusters. Also, each cluster needs to grant access to indices belonging to other connected clusters as well.</p>
<p>Let&#8217;s look at an example: assuming we have two clusters, <code class="literal">cluster1</code> and <code class="literal">cluster2</code>, each one holding an index, <code class="literal">index1</code>
and <code class="literal">index2</code>. A search request that targets multiple clusters, as follows</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl -XGET tribe_node:9200/index1,index2/_search -u tribe_user:tribe_user</pre>
</div>
<p>requires <code class="literal">search</code> privileges for both <code class="literal">index1</code> and <code class="literal">index2</code> on the Tribe Node:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">tribe_user:
  indices:
    'index*': search</pre>
</div>
<p>Also, the same privileges need to be granted on the connected clusters, meaning that <code class="literal">cluster1</code> has to grant access to
<code class="literal">index2</code> even though <code class="literal">index2</code> only exists on <code class="literal">cluster2</code>; the same requirement applies for <code class="literal">index1</code> on <code class="literal">cluster2</code>. This
applies to any indices action. As for cluster state read operations (e.g. cluster state api, get mapping api etc.),
they always get executed locally on the Tribe Node, to make sure that the merged cluster state gets returned; their
privileges are then required on the Tribe Node only.</p>
</li>
<li class="listitem">
Use the same system key on all clusters. For <a class="xref" href="enable-message-authentication.html" title="Enable Message Authentication">message authentication</a> to properly work across multiple clusters, the Tribe Node
and all of the connected clusters need to share the same system key.
</li>
<li class="listitem">
Enable encryption globally. Encrypted communication via SSL/TLS can only be enabled globally, meaning that either all of the connected clusters and the Tribe Node have SSL enabled, or none of them have.
</li>
<li class="listitem">
Use the same certification authority on all clusters. When using encrypted communication, for simplicity, we recommend all of the connected clusters and the Tribe Node use
the same certification authority to generate their certificates.
</li>
</ol>
</div>
<h4><a id="_tribe_node_example"></a>Tribe Node Example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.0/docs/public/shield/installing-shield.asciidoc">edit</a></h4>
<p>Let&#8217;s see a complete example on how to use the Tribe Node with shield and the configuration required. First of all the
Shield and License plugins need to be installed and enabled on all clusters and on the Tribe Node.</p>
<p>The system key needs to be generated on one node, as described in <a class="xref" href="enable-message-authentication.html" title="Enable Message Authentication">Enabling Message Authentication</a>,
and then copied over to all of the other nodes in each cluster and the Tribe Node itself.</p>
<p>Each cluster can have its own users with <code class="literal">admin</code> privileges that don&#8217;t need to be present in the Tribe Node too. In fact,
administration tasks (e.g. create index) cannot be performed through the Tribe Node but need to be sent directly to the
corresponding cluster. The users that need to be created on Tribe Node are those that allow to get back data merged from
the different clusters through the Tribe Node itself. Let&#8217;s for instance create as follows a <code class="literal">tribe_user</code> user, with
role <code class="literal">user</code>, that has <code class="literal">read</code> privileges on any index.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/shield/esusers useradd tribe_user -p tribe_user -r user</pre>
</div>
<p>The above command needs to be executed on each cluster, since the same user needs to be present on the Tribe Node as well
as on every connected cluster.</p>
<p>The following is the configuration required on the Tribe Node, that needs to be added to <code class="literal">elasticsearch.yml</code>.
Elasticsearch allows to list specific settings per cluster. We disable multicast discovery and configure the proper unicast discovery hosts for each cluster,
as well as their cluster names:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">tribe:
  t1:
    cluster.name: tribe1
    discovery.zen.ping.multicast.enabled: false
    discovery.zen.ping.unicast.hosts: ["tribe1:9300"]
  t2:
    cluster.name: tribe2
    discovery.zen.ping.multicast.enabled: false
    discovery.zen.ping.unicast.hosts: ["tribe2:9300"]</pre>
</div>
<p>The Tribe Node can then be started and once initialized it will be ready to accept requests like the following search,
which will return documents coming from the different connected clusters:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl -XGET localhost:9200/_search -u tribe_user:tribe_user</pre>
</div>
<p>As for encrypted communication, the required settings are the same as described in <a class="xref" href="securing-communications.html" title="Securing Communications with Encryption and IP Filtering">Securing Communications with Encryption and IP Filtering</a>,
but need to be specified per tribe as we did for discovery settings above.</p>
<h3><a id="uninstalling-shield"></a>Uninstalling Shield<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/2.0/docs/public/shield/installing-shield.asciidoc">edit</a></h3>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Uninstalling Shield requires a <a href="http://www.elastic.co/guide/en/elasticsearch/reference/2.0/restart-upgrade.html" class="ulink" target="_top">full cluster restart</a>.</p>
</div>
</div>
<p>To uninstall Shield:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Shut down Elasticsearch.
</li>
<li class="listitem">
<p>Remove the Shield plugin from Elasticsearch:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/plugin remove shield</pre>
</div>
</li>
<li class="listitem">
Restart Elasticsearch.
</li>
</ol>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="how-shield-works.html">« How Shield Works</a>
</span>
<span class="next">
<a href="setting-up-authentication.html">Setting Up User Authentication »</a>
</span>
</div>
</div>
</body>
</html>
