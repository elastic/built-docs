<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Custom sources API | Workplace Search Guide | Elastic</title>
<link rel="home" href="index.html" title="Workplace Search Guide"/>
<link rel="up" href="workplace-search-api-overview.html" title="API reference"/>
<link rel="prev" href="workplace-search-api-overview.html" title="API reference"/>
<link rel="next" href="workplace-search-document-permissions-api.html" title="Document permissions API"/>
<meta name="DC.type" content="Learn/Docs/Workplace Search/Reference"/>
<meta name="DC.subject" content="Workplace Search"/>
<meta name="DC.identifier" content="7.6"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Workplace Search Guide</a></span>
»
<span class="breadcrumb-link"><a href="workplace-search-api-overview.html">API reference</a></span>
»
<span class="breadcrumb-node">Custom sources API</span>
</div>
<div class="navheader">
<span class="prev">
<a href="workplace-search-api-overview.html">« API reference</a>
</span>
<span class="next">
<a href="workplace-search-document-permissions-api.html">Document permissions API »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="workplace-search-custom-sources-api"></a>Custom sources API</h2>
</div></div></div>
<p>Index, update, and destroy documents from a Custom API Source.</p>
<p>See <a class="xref" href="workplace-search-custom-api-sources.html" title="Custom API sources">Custom API sources</a> for a conceptual walkthrough.</p>
<p><span class="strong strong"><strong>You can only create, update and destroy documents for a single Custom API Source at a time</strong></span></p>
<p>See the <a class="xref" href="workplace-search-api-overview.html" title="API reference"><em>API reference</em></a> to learn about authentication, schema design, field types, and more.</p>
<h3><a id="index-and-update"></a>Index and Update Documents</h3>
<p>Index new objects into a custom content source or update documents that already exist.</p>
<p>Schema fields are created automatically as text fields if they do not exist and cannot be deleted.</p>
<p>Maximum 100 documents per request.</p>
<hr>
<p><span class="strong strong"><strong>The Five Keys of Schema Design</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Always index new fields as the same type as existing documents.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
eg. An existing <code class="literal">date</code> field should not receive <code class="literal">geolocation</code> data.
</li>
</ul>
</div>
</li>
<li class="listitem">
Arrays are supported, but nested objects are not supported. You must flatten them.
</li>
<li class="listitem">
<span class="strong strong"><strong>Fields cannot be deleted once they have been created.</strong></span>
</li>
<li class="listitem">
The reserved fields are: <code class="literal">external_id</code>, <code class="literal">source</code>, <code class="literal">content_source_id</code>, <code class="literal">updated_at</code>, <code class="literal">last_updated</code>, <code class="literal">highlight</code>, <code class="literal">any</code>, <code class="literal">all</code>, <code class="literal">none</code>, <code class="literal">or</code>, <code class="literal">and</code>, <code class="literal">not</code>, <code class="literal">engine_id</code>, <code class="literal">_allow_permissions</code> and <code class="literal">_deny_permissions</code>.
</li>
<li class="listitem">
A field name can only contain lowercase letters, numbers, and underscores.
</li>
</ol>
</div>
<hr>
<p><code class="literal">POST /api/ws/v1/sources/[CONTENT_SOURCE_KEY]/documents/bulk_create</code></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">content_source_key</code></p></td>
<td align="left" valign="top"><p>required</p></td>
<td align="left" valign="top"><p>Unique key for a Custom API source, provided upon creation of a Custom API Source.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">access_token</code></p></td>
<td align="left" valign="top"><p>required</p></td>
<td align="left" valign="top"><p>Must be included in HTTP authorization headers.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">id</code></p></td>
<td align="left" valign="top"><p>optional</p></td>
<td align="left" valign="top"><p>ID unique to a document used to identify, modify or delete the record at a later time. If you do not provide an <code class="literal">id</code>, a BSON <code class="literal">id</code> will be created for you. Learn more about ID with the <a class="xref" href="workplace-search-api-overview.html" title="API reference"><em>API reference</em></a>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">_allow_permissions</code></p></td>
<td align="left" valign="top"><p>optional</p></td>
<td align="left" valign="top"><p>Optional for document level security. When a value is set within a document, only users with a matching permission will be able to view it.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">_deny_permissions</code></p></td>
<td align="left" valign="top"><p>optional</p></td>
<td align="left" valign="top"><p>Optional for document level security. When a value is set within a document, users with the matching permission will be unable to view it. Read the <a class="xref" href="workplace-search-document-permissions.html" title="Defining Document Permissions for Custom Sources">Document permissions for Custom Sources</a> to learn more.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">curl -X POST http://localhost:3002/api/ws/v1/sources/[CONTENT_SOURCE_KEY]/documents/bulk_create \
-H "Authorization: Bearer [ACCESS_TOKEN]" \
-H "Content-Type: application/json" \
-d '[
  {
    "_allow_permissions": ["permission1"],
    "_deny_permissions": [],
    "id" : 1234,
    "title" : "The Meaning of Time",
    "body" : "Not much. It is a made up thing.",
    "url" : "https://example.com/meaning/of/time",
    "created_at": "2019-06-01T12:00:00+00:00",
    "type": "list"
  },
  {
    "_allow_permissions": [],
    "_deny_permissions": ["permission2"],
    "id" : 1235,
    "title" : "The Meaning of Sleep",
    "body" : "Rest, recharge, and connect to the Ether.",
    "url" : "https://example.com/meaning/of/sleep",
    "created_at": "2019-06-01T12:00:00+00:00",
    "type": "list"
  },
  {
    "_allow_permissions": ["permission1"],
    "_deny_permissions": ["permission2"],
    "id" : 1236,
    "title" : "The Meaning of Life",
    "body" : "Be excellent to each other.",
    "url" : "https://example.com/meaning/of/life",
    "created_at": "2019-06-01T12:00:00+00:00",
    "type": "list"
  }
]'</pre>
</div>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  results: [
    {
       "id":"1235",
       "errors":[]
    }
  ]
}</pre>
</div>
<h3><a id="destroy"></a>Destroy Documents</h3>
<p>Remove documents from a Custom API Source.</p>
<p><code class="literal">POST /api/ws/v1/sources/[CONTENT_SOURCE_KEY]/documents/bulk_destroy</code></p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">content_source_key</code></p></td>
<td align="left" valign="top"><p>required</p></td>
<td align="left" valign="top"><p>Unique key for a Custom API source, provided upon creation of a Custom API Source.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">access_token</code></p></td>
<td align="left" valign="top"><p>required</p></td>
<td align="left" valign="top"><p>Must be included in HTTP authorization headers.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">id</code></p></td>
<td align="left" valign="top"><p>required</p></td>
<td align="left" valign="top"><p>An array of IDs associated to documents to destroy.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">curl -X POST http://localhost:3002/api/ws/v1/sources/[CONTENT_SOURCE_KEY]/documents/bulk_destroy \
-H "Authorization: Bearer [ACCESS_TOKEN]" \
-H "Content-Type: application/json" \
-d '[
  [DOCUMENT_ID_1], [DOCUMENT_ID_2]
]'</pre>
</div>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  results: [
    {
      "id":1234,
      "success":true
    },
    {
      "id":1235,
      "success":true
    }
  ]
}</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="workplace-search-api-overview.html">« API reference</a>
</span>
<span class="next">
<a href="workplace-search-document-permissions-api.html">Document permissions API »</a>
</span>
</div>
</div>
</body>
</html>
