<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Managing document access &amp; permissions for content sources | Workplace Search Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Workplace Search Guide [master]"/>
<link rel="up" href="workplace-search-permissions.html" title="Permissions &amp; Access Control"/>
<link rel="prev" href="workplace-search-permissions.html" title="Permissions &amp; Access Control"/>
<link rel="next" href="workplace-search-document-permissions.html" title="Defining Document Permissions for custom sources"/>
<meta name="DC.type" content="Learn/Docs/Workplace Search/Guide/master"/>
<meta name="DC.subject" content="Workplace Search"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Workplace Search Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="workplace-search-permissions.html">Permissions &amp; Access Control</a></span>
»
<span class="breadcrumb-node">Managing document access &amp; permissions for content sources</span>
</div>
<div class="navheader">
<span class="prev">
<a href="workplace-search-permissions.html">« Permissions &amp; Access Control</a>
</span>
<span class="next">
<a href="workplace-search-document-permissions.html">Defining Document Permissions for custom sources »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="workplace-search-sources-document-permissions"></a>Managing document access &amp; permissions for content sources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/workplace-search-docs/guides/permissions/sources-document-permissions.asciidoc">edit</a></h2>
</div></div></div>

<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The following guide applies to <span class="strong strong"><strong>first-party content sources</strong></span>. For more information on custom sources, visit the <a class="xref" href="workplace-search-document-permissions.html" title="Defining Document Permissions for custom sources">Document permissions for custom sources</a> guide.</p>
</div>
</div>
<p>Workplace Search can associate its notion of a user to a third-party&#8217;s, and in doing so limit access to documents. If a person has certain permissions on Google Drive, for example, you can associate their Google Drive user via the <a class="xref" href="workplace-search-external-identities-api.html" title="External Identities API Reference">External Identities API reference</a> to their Workplace Search user. When their Workplace Search user tries to search, their permissions are honoured. As a result, they will see documents they can see and <span class="strong strong"><strong>not</strong></span> see documents which they cannot.</p>
<p>This guide will walk you through how to do so with each supporting third-party.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="sources-permissions-first-party"></a>First-party content sources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/workplace-search-docs/guides/permissions/sources-document-permissions.asciidoc">edit</a></h3>
</div></div></div>
<p>Document permission synchronization can be enabled for sources when connecting an instance to Workplace Search.</p>
<p>We support document permission synchronization within:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="workplace-search-sources-document-permissions.html#sources-permissions-atlassian-cloud" title="Document-level permissions for Atlassian Cloud">Document-level permissions for Atlassian Cloud</a>: Jira Cloud &amp; Confluence Cloud
</li>
<li class="listitem">
<a class="xref" href="workplace-search-sources-document-permissions.html#sources-permissions-box" title="Document-level permissions for Box">Document-level permissions for Box</a>: Box
</li>
<li class="listitem">
<a class="xref" href="workplace-search-sources-document-permissions.html#sources-permissions-google" title="Document-level permissions for Google">Document-level permissions for Google</a>: Google Drive
</li>
<li class="listitem">
<a class="xref" href="workplace-search-sources-document-permissions.html#sources-permissions-microsoft" title="Document-level permissions for Microsoft">Document-level permissions for Microsoft</a>: SharePoint Online &amp; OneDrive
</li>
</ul>
</div>
<p>Once activated during connector setup, document access for a user must be mapped to Workplace Search&#8217;s notion of that user. Use the <a class="xref" href="workplace-search-external-identities-api.html" title="External Identities API Reference">External Identities API reference</a>, to provide the external <code class="literal">source_user_id</code> and link it to its associated Workplace Search <code class="literal">user</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
	"source_user_id": "john.doe@example.com",
	"user": "john.doe"
}</pre>
</div>
<p>The above example would link Google&#8217;s notion of <code class="literal">john.doe@example.com</code> and Workplace Search&#8217;s notion of <code class="literal">john.doe</code> as the same entity. Permissions are then synchronized between these entities, restricting or enabling access to documents. Different content sources will expose their notion of a user in different ways.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="sources-permissions-atlassian-cloud"></a>Document-level permissions for Atlassian Cloud<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/workplace-search-docs/guides/permissions/sources-document-permissions.asciidoc">edit</a></h4>
</div></div></div>
<p>Applies to: Confluence Cloud, Jira Cloud</p>
<p>Use the <a class="xref" href="workplace-search-external-identities-api.html" title="External Identities API Reference">external identities API</a> to map Atlassian Cloud user IDs to Workplace Search usernames for each of your Confluence and Jira content sources.</p>
<p>First, gather the following information:</p>
<div class="variablelist">
<a id="atlassian-cloud-user-ids"></a>
<dl class="variablelist">
<dt>
<span class="term">
Atlassian Cloud user IDs
</span>
</dt>
<dd>
<p>The string IDs of the Atlassian Cloud users that you&#8217;d like to map to Workplace Search usernames.
Example: <code class="literal">5b10ac8d82e05b22cc7d4ef5</code>.</p>
<p>Atlassian assigns a string ID to each of its Atlassian Cloud users.
The string identifies the user across all Atlassian Cloud products.
However, each product has its own procedure to get the IDs:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Product</th>
<th align="left" valign="top">Procedure to get user IDs</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>Confluence</p></td>
<td align="left" valign="top"><p>Within the Confluence UI, choose <span class="strong strong"><strong>Settings</strong></span> &gt; <span class="strong strong"><strong>User Management</strong></span>.
From the <span class="strong strong"><strong>Users</strong></span> screen, choose <span class="strong strong"><strong>Export Users</strong></span>.
Within the data file, locate the <code class="literal">id</code> for each user.</p>
<p>If you are using multiple Atlassian Cloud products, filter your list of IDs to only those users who can access Confluence under your Atlassian license agreement.
These users have the <em>Use Confluence</em> permission.
See <a href="https://support.atlassian.com/confluence-cloud/docs/manage-global-permissions/" class="ulink" target="_blank" rel="noopener">Manage global permissions</a> in the Atlassian documentation.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>Jira</p></td>
<td align="left" valign="top"><p>Use the <a href="https://developer.atlassian.com/cloud/jira/platform/rest/v2/api-group-users/" class="ulink" target="_blank" rel="noopener">Users resource of the Jira Cloud API</a> to request one or more users.
Within each response, locate the <code class="literal">accountId</code> for each user.</p></td>
</tr>
</tbody>
</table>
</div>
</dd>
<dt>
<span class="term">
Workplace Search usernames
</span>
</dt>
<dd>
<p>The string usernames of the Workplace Search users to which you will map Atlassian Cloud user IDs.
Example: <code class="literal">sam_smith</code>.</p>
<p>Use the appropriate UI or API to locate this information within your Elastic deployment.
The specific interface depends on how you <a class="xref" href="workplace-search-security.html" title="User Management and Security">manage users</a>.</p>
</dd>
<dt>
<span class="term">
User mappings
</span>
</dt>
<dd>
<p>A collection of mappings, where each maps an Atlassian Cloud user ID to a Workplace Search username.</p>
<p>Store this data in a format that makes sense to you.
You will need to construct one or more API requests for each user mapping.</p>
</dd>
<dt>
<span class="term">
Content source IDs and access token
</span>
</dt>
<dd>
<p>The string IDs of the Confluence or Jira content sources within your Workplace Search deployment, and your personal access token, which grants you access to write external identities through the API.</p>
<p>See <a class="xref" href="workplace-search-sources-document-permissions.html#sources-permissions-content-source-id-token" title="Content source ID and access token">Content source ID and access token</a>.</p>
</dd>
</dl>
</div>
<p>Then, send one API request per user mapping, per content source ID:</p>
<p><span class="strong strong"><strong>Request template:</strong></span></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url '&lt;WORKPLACE_SEARCH_BASE_URL&gt;/api/ws/v1/sources/&lt;CONTENT_SOURCE_ID&gt;/external_identities' \
--header 'Authorization: Bearer &lt;ACCESS_TOKEN&gt;' \
--header 'Content-Type: application/json' \
--data '{
    "user": "&lt;WORKPLACE_SEARCH_USERNAME&gt;",
    "source_user_id": "&lt;ATLASSIAN_CLOUD_USER_ID&gt;"
}'</pre>
</div>
<p><span class="strong strong"><strong>Example requests:</strong></span></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url 'http://localhost:3002/api/ws/v1/sources/40bd9d00713a5d9874444410/external_identities' \
--header 'Authorization: Bearer 64c51eee12c1f7a3be8ab0ecf9a2184106c1641e49736119414da0c0e85f3611' \
--header 'Content-Type: application/json' \
--data '{
    "user": "alex_jones",
    "source_user_id": "91e7f8ba23a0637de213ae6d"
}'</pre>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url 'https://f3fae9ab3e4f423d9d345979331ef3a1.ent-search.us-east-1.aws.cloud.es.io/api/ws/v1/sources/8fda765d3e474d44e40369d6/external_identities' \
--header 'Authorization: Bearer 7ea05c8bd50ab5c75d2b71adbcb9ae71c4034d7a4f8d6c16a8940510a951cec7' \
--header 'Content-Type: application/json' \
--data '{
    "user": "sam.smith",
    "source_user_id": "5b10ac8d82e05b22cc7d4ef5"
}'</pre>
</div>
<p><span class="strong strong"><strong>Jira Cloud notes:</strong></span></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>To ensure permissions map from Jira to Workplace Search, define <em>project permissions</em> directly on Jira Cloud groups (or users).</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Workplace Search does <span class="strong strong"><strong>not</strong></span> sync other types of permission data, such as <em>issue-level security permissions</em>.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Workplace Search syncs permission data from <em>classic Jira projects</em> only.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Workplace Search does <span class="strong strong"><strong>not</strong></span> support syncing permissions from <em>Jira next-gen projects</em>.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>To make a Jira project visible to all Workplace Search users, use the <em>Any logged in user</em> permission under <em>Application Access</em>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Workplace Search does <span class="strong strong"><strong>not</strong></span> sync the <em>Public</em> group permission.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Confluence Cloud notes:</strong></span></p>
<p>If anonymous access is enabled for a Confluence Space that you are syncing to Workplace Search, ensure anonymous access is enabled in your Confluence global permissions as well.
See <a href="https://support.atlassian.com/confluence-cloud/docs/manage-global-permissions/" class="ulink" target="_blank" rel="noopener">Manage global permissions</a> in the Atlassian documentation.</p>
<p>The space with anonymous access will be searchable by all of your Workplace Search users, even those without an external identity mapping.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="sources-permissions-box"></a>Document-level permissions for Box<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/workplace-search-docs/guides/permissions/sources-document-permissions.asciidoc">edit</a></h4>
</div></div></div>
<p>Applies to: Box</p>
<p>Use the <a class="xref" href="workplace-search-external-identities-api.html" title="External Identities API Reference">external identities API</a> to map Box user IDs to Workplace Search usernames for your Box organization content source.</p>
<p>First, gather the following information:</p>
<div class="variablelist">
<a id="box-user-ids"></a>
<dl class="variablelist">
<dt>
<span class="term">
Box user IDs
</span>
</dt>
<dd>
<p>The string IDs of the Box users that you&#8217;d like to map to Workplace Search usernames.
Example: <code class="literal">14436967113</code>.</p>
<p>Use the <a href="https://developer.box.com/reference/get-users/" class="ulink" target="_blank" rel="noopener">List enterprise users</a> endpoint of the Box API to request a list of all Box users.
Within each of the <code class="literal">entries</code>, locate the <code class="literal">id</code>.</p>
</dd>
<dt>
<span class="term">
Workplace Search usernames
</span>
</dt>
<dd>
<p>The string usernames of the Workplace Search users to which you will map Box user IDs.
Example: <code class="literal">sam_smith</code>.</p>
<p>Use the appropriate UI or API to locate this information within your Elastic deployment.
The specific interface depends on how you <a class="xref" href="workplace-search-security.html" title="User Management and Security">manage users</a>.</p>
</dd>
<dt>
<span class="term">
User mappings
</span>
</dt>
<dd>
<p>A collection of mappings, where each maps a Box user ID to a Workplace Search username.</p>
<p>Store this data in a format that makes sense to you.
You will need to construct one or more API requests for each user mapping.</p>
</dd>
<dt>
<span class="term">
Content source IDs and access token
</span>
</dt>
<dd>
<p>The string IDs of the Box organization content sources within your Workplace Search deployment, and your personal access token, which grants you access to write external identities through the API.</p>
<p>See <a class="xref" href="workplace-search-sources-document-permissions.html#sources-permissions-content-source-id-token" title="Content source ID and access token">Content source ID and access token</a>.</p>
</dd>
</dl>
</div>
<p>Then, send one API request per user mapping, per content source ID:</p>
<p><span class="strong strong"><strong>Request template:</strong></span></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url '&lt;WORKPLACE_SEARCH_BASE_URL&gt;/api/ws/v1/sources/&lt;CONTENT_SOURCE_ID&gt;/external_identities' \
--header 'Authorization: Bearer &lt;ACCESS_TOKEN&gt;' \
--header 'Content-Type: application/json' \
--data '{
    "user": "&lt;WORKPLACE_SEARCH_USERNAME&gt;",
    "source_user_id": "&lt;BOX_USER_ID&gt;"
}'</pre>
</div>
<p><span class="strong strong"><strong>Example requests:</strong></span></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url 'http://localhost:3002/api/ws/v1/sources/40bd9d00713a5d9874444410/external_identities' \
--header 'Authorization: Bearer 64c51eee12c1f7a3be8ab0ecf9a2184106c1641e49736119414da0c0e85f3611' \
--header 'Content-Type: application/json' \
--data '{
    "user": "alex_jones",
    "source_user_id": "14436967113"
}'</pre>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url 'https://f3fae9ab3e4f423d9d345979331ef3a1.ent-search.us-east-1.aws.cloud.es.io/api/ws/v1/sources/8fda765d3e474d44e40369d6/external_identities' \
--header 'Authorization: Bearer 7ea05c8bd50ab5c75d2b71adbcb9ae71c4034d7a4f8d6c16a8940510a951cec7' \
--header 'Content-Type: application/json' \
--data '{
    "user": "sam.smith",
    "source_user_id": "36658789235"
}'</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="sources-permissions-google"></a>Document-level permissions for Google<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/workplace-search-docs/guides/permissions/sources-document-permissions.asciidoc">edit</a></h4>
</div></div></div>
<p>Applies to: Google Drive</p>
<p>Use the <a class="xref" href="workplace-search-external-identities-api.html" title="External Identities API Reference">external identities API</a> to map Google user IDs to Workplace Search usernames for your Google Drive organization content source.</p>
<p>First, gather the following information:</p>
<div class="variablelist">
<a id="google-user-ids"></a>
<dl class="variablelist">
<dt>
<span class="term">
Google user IDs
</span>
</dt>
<dd>
<p>The string IDs of the Google users that you&#8217;d like to map to Workplace Search usernames.
Google user IDs are email addresses.
Example: <code class="literal">sam.smith@example.com</code>.</p>
<p>See <a href="https://support.google.com/a/answer/9772903?hl=en" class="ulink" target="_blank" rel="noopener">View or export a group&#8217;s members</a> in the Google documentation for instructions to export all users.</p>
</dd>
<dt>
<span class="term">
Workplace Search usernames
</span>
</dt>
<dd>
<p>The string usernames of the Workplace Search users to which you will map Google user IDs.
Example: <code class="literal">sam_smith</code>.</p>
<p>Use the appropriate UI or API to locate this information within your Elastic deployment.
The specific interface depends on how you <a class="xref" href="workplace-search-security.html" title="User Management and Security">manage users</a>.</p>
</dd>
<dt>
<span class="term">
User mappings
</span>
</dt>
<dd>
<p>A collection of mappings, where each maps a Google user ID to a Workplace Search username.</p>
<p>Store this data in a format that makes sense to you.
You will need to construct one or more API requests for each user mapping.</p>
</dd>
<dt>
<span class="term">
Content source IDs and access token
</span>
</dt>
<dd>
<p>The string IDs of the Google Drive organization content sources within your Workplace Search deployment, and your personal access token, which grants you access to write external identities through the API.</p>
<p>See <a class="xref" href="workplace-search-sources-document-permissions.html#sources-permissions-content-source-id-token" title="Content source ID and access token">Content source ID and access token</a>.</p>
</dd>
</dl>
</div>
<p>Then, send one API request per user mapping, per content source ID:</p>
<p><span class="strong strong"><strong>Request template:</strong></span></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url '&lt;WORKPLACE_SEARCH_BASE_URL&gt;/api/ws/v1/sources/&lt;CONTENT_SOURCE_ID&gt;/external_identities' \
--header 'Authorization: Bearer &lt;ACCESS_TOKEN&gt;' \
--header 'Content-Type: application/json' \
--data '{
    "user": "&lt;WORKPLACE_SEARCH_USERNAME&gt;",
    "source_user_id": "&lt;GOOGLE_USER_ID&gt;"
}'</pre>
</div>
<p><span class="strong strong"><strong>Example requests:</strong></span></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url 'http://localhost:3002/api/ws/v1/sources/40bd9d00713a5d9874444410/external_identities' \
--header 'Authorization: Bearer 64c51eee12c1f7a3be8ab0ecf9a2184106c1641e49736119414da0c0e85f3611' \
--header 'Content-Type: application/json' \
--data '{
    "user": "alex_jones",
    "source_user_id": "alex.jones@example.com"
}'</pre>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url 'https://f3fae9ab3e4f423d9d345979331ef3a1.ent-search.us-east-1.aws.cloud.es.io/api/ws/v1/sources/8fda765d3e474d44e40369d6/external_identities' \
--header 'Authorization: Bearer 7ea05c8bd50ab5c75d2b71adbcb9ae71c4034d7a4f8d6c16a8940510a951cec7' \
--header 'Content-Type: application/json' \
--data '{
    "user": "sam.smith",
    "source_user_id": "samsmith@example.com"
}'</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="sources-permissions-microsoft"></a>Document-level permissions for Microsoft<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/workplace-search-docs/guides/permissions/sources-document-permissions.asciidoc">edit</a></h4>
</div></div></div>
<p>Applies to: OneDrive, SharePoint Online</p>
<p>Use the <a class="xref" href="workplace-search-external-identities-api.html" title="External Identities API Reference">external identities API</a> to map user IDs from Microsoft Office 365 Groups to usernames from Workplace Search for your OneDrive and SharePoint Online organization content source.</p>
<p>First, gather the following information:</p>
<div class="variablelist">
<a id="microsoft-user-ids"></a>
<dl class="variablelist">
<dt>
<span class="term">
Microsoft Office 365 Groups user IDs
</span>
</dt>
<dd>
<p>The string IDs of the Microsoft Office 365 Groups users that you&#8217;d like to map to Workplace Search usernames.
Each ID is an opaque string.
Example: <code class="literal">32ad7bda-3de1-4a77-ee97-f3476c2cf58d</code>.</p>
<p>To export user IDs, log in to your <a href="https://admin.microsoft.com" class="ulink" target="_blank" rel="noopener">Microsoft Admin</a>, then navigate to <a href="https://admin.microsoft.com/Adminportal/Home?source=applauncher#/users" class="ulink" target="_top">Users</a>.
Select the users you would like to export, and click <span class="strong strong"><strong>Export Users</strong></span>.</p>
</dd>
<dt>
<span class="term">
Workplace Search usernames
</span>
</dt>
<dd>
<p>The string usernames of the Workplace Search users to which you will map Microsoft user IDs.
Example: <code class="literal">sam_smith</code>.</p>
<p>Use the appropriate UI or API to locate this information within your Elastic deployment.
The specific interface depends on how you <a class="xref" href="workplace-search-security.html" title="User Management and Security">manage users</a>.</p>
</dd>
<dt>
<span class="term">
User mappings
</span>
</dt>
<dd>
<p>A collection of mappings, where each maps a Microsoft user ID to a Workplace Search username.</p>
<p>Store this data in a format that makes sense to you.
You will need to construct one or more API requests for each user mapping.</p>
</dd>
<dt>
<span class="term">
Content source IDs and access token
</span>
</dt>
<dd>
<p>The string IDs of the OneDrive or SharePoint Online organization content sources within your Workplace Search deployment, and your personal access token, which grants you access to write external identities through the API.</p>
<p>See <a class="xref" href="workplace-search-sources-document-permissions.html#sources-permissions-content-source-id-token" title="Content source ID and access token">Content source ID and access token</a>.</p>
</dd>
</dl>
</div>
<p>Then, send one API request per user mapping, per content source ID:</p>
<p><span class="strong strong"><strong>Request template:</strong></span></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url '&lt;WORKPLACE_SEARCH_BASE_URL&gt;/api/ws/v1/sources/&lt;CONTENT_SOURCE_ID&gt;/external_identities' \
--header 'Authorization: Bearer &lt;ACCESS_TOKEN&gt;' \
--header 'Content-Type: application/json' \
--data '{
    "user": "&lt;WORKPLACE_SEARCH_USERNAME&gt;",
    "source_user_id": "&lt;MICROSOFT_USER_ID&gt;"
}'</pre>
</div>
<p><span class="strong strong"><strong>Example requests:</strong></span></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url 'http://localhost:3002/api/ws/v1/sources/40bd9d00713a5d9874444410/external_identities' \
--header 'Authorization: Bearer 64c51eee12c1f7a3be8ab0ecf9a2184106c1641e49736119414da0c0e85f3611' \
--header 'Content-Type: application/json' \
--data '{
    "user": "alex_jones",
    "source_user_id": "32ad7bda-3de1-4a77-ee97-f3476c2cf58d"
}'</pre>
</div>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl \
--request 'POST' \
--url 'https://f3fae9ab3e4f423d9d345979331ef3a1.ent-search.us-east-1.aws.cloud.es.io/api/ws/v1/sources/8fda765d3e474d44e40369d6/external_identities' \
--header 'Authorization: Bearer 7ea05c8bd50ab5c75d2b71adbcb9ae71c4034d7a4f8d6c16a8940510a951cec7' \
--header 'Content-Type: application/json' \
--data '{
    "user": "sam.smith",
    "source_user_id": "64bc9acd-5df2-5a88-ff98-a4496c2c568e"
}'</pre>
</div>
<p><span class="strong strong"><strong>SharePoint Online notes:</strong></span></p>
<p>SharePoint Online has the concept of a "Members" group that SharePoint Online manages itself.
The API endpoints for the "Visitors" and "Owners" groups within their grouping system cannot be accessed via API.
Therefore, if you are trying to grant access using those groups, it will not work&#8201;&#8212;&#8201;Workplace Search cannot understand them.
We recommend creating the equivalent groups in Office 365 Groups and use that to map instead.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="sources-permissions-custom"></a>Custom sources<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/workplace-search-docs/guides/permissions/sources-document-permissions.asciidoc">edit</a></h3>
</div></div></div>
<p>Custom sources allow you to ingest document access information using the <code class="literal">_allow_permissions</code> and <code class="literal">_deny_permissions</code> fields. For more information, refer to <a class="xref" href="workplace-search-custom-api-sources.html" title="Connecting custom sources">Custom API sources</a> guide.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="sources-permissions-content-source-id-token"></a>Content source ID and access token<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/workplace-search-docs/guides/permissions/sources-document-permissions.asciidoc">edit</a></h3>
</div></div></div>
<p>Each call to the external identities API must include the ID of the Workplace Search content source and an access token that identifies the Workplace Search user making the call.</p>
<p>Each of these is an opaque string, as in the following examples:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Content source ID: <code class="literal">8fda765d3e474d44e40369d6</code>.
</li>
<li class="listitem">
Access token: <code class="literal">7ea05c8bd50ab5c75d2b71adbcb9ae71c4034d7a4f8d6c16a8940510a951cec7</code>.
</li>
</ul>
</div>
<p>You can find this information in the Workplace Search administrative dashboard, within the <em>Source overview</em> of each content source.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Within the Workplace Search dashboard menu, choose <span class="strong strong"><strong>Sources</strong></span>.
</li>
<li class="listitem">
Locate the row for the desired content source, and choose <span class="strong strong"><strong>Details</strong></span>.
</li>
<li class="listitem">
Within <em>Source overview</em>, locate <em>Document-level permissions</em>.
</li>
<li class="listitem">
<p>Toggle <span class="strong strong"><strong>ID</strong></span> to expose the content source ID, and toggle <span class="strong strong"><strong>Access Token</strong></span> to expose your personal access token.</p>
<div class="imageblock">
<div class="content">
<img src="images/content-source-id-access-token.png" alt="content source id access token">
</div>
</div>
</li>
</ol>
</div>
<hr>
<p>Further reading:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="workplace-search-enabling-private-sources.html" title="Enabling private content sources">Enabling private content sources</a>
</li>
<li class="listitem">
<a class="xref" href="workplace-search-document-permissions.html" title="Defining Document Permissions for custom sources">Document permissions for custom sources</a>
</li>
<li class="listitem">
<a class="xref" href="workplace-search-external-identities-api.html" title="External Identities API Reference">External Identities API reference</a>
</li>
<li class="listitem">
<a class="xref" href="workplace-search-content-sources.html" title="Content Sources Overview"><em>Content sources</em></a>
</li>
<li class="listitem">
<a class="xref" href="workplace-search-custom-api-sources.html" title="Connecting custom sources">Custom API sources</a>
</li>
</ul>
</div>
<hr>
<p>The following sections have moved:</p>
<p><a id="sources-permissions-org-private"></a><em>Organizational Sources and Private Sources</em> → <a class="xref" href="workplace-search-permissions.html#organizational-sources-private-sources" title="Organizational Sources and Private Sources">Organizational Sources and Private Sources</a></p>
<p><a id="sources-permissions-strategy"></a><em>Which strategy should I choose?</em> → <a class="xref" href="workplace-search-permissions.html#permissions-strategy" title="Which strategy should I choose?">Which strategy should I choose?</a></p>
<p><a id="sources-permissions-private-sources"></a><em>Enabling private sources</em> → <a class="xref" href="workplace-search-enabling-private-sources.html" title="Enabling private content sources">Enabling private content sources</a></p>
<p><a id="sources-permissions-private-sources-enabling-remote"></a><em>Enabling Private Sources for Remote Content Sources</em> → <a class="xref" href="workplace-search-enabling-private-sources.html#enabling-private-sources-remote" title="Enabling private sources for remote content sources">Enabling private sources for remote content sources</a></p>
<p><a id="sources-permissions-private-sources-enabling-standard"></a><em>Enabling Private Sources for Standard Content Sources</em> → <a class="xref" href="workplace-search-enabling-private-sources.html#enabling-private-sources-standard" title="Enabling private sources for standard content sources">Enabling private sources for standard content sources</a></p>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="workplace-search-permissions.html">« Permissions &amp; Access Control</a>
</span>
<span class="next">
<a href="workplace-search-document-permissions.html">Defining Document Permissions for custom sources »</a>
</span>
</div>
</div>
</body>
</html>
