<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PagerDuty Action | X-Pack for the Elastic Stack [5.0] | Elastic</title>
<meta class="elastic" name="content" content="PagerDuty Action | X-Pack for the Elastic Stack [5.0]">

<link rel="home" href="index.html" title="X-Pack for the Elastic Stack [5.0]"/>
<link rel="up" href="actions.html" title="Actions"/>
<link rel="prev" href="actions-slack.html" title="Slack Action"/>
<link rel="next" href="transform.html" title="Transforms"/>
<meta class="elastic" name="product_version" content="5.0"/>
<meta class="elastic" name="product_name" content="X-Pack"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Legacy/XPack/Reference/5.0"/>
<meta name="DC.subject" content="X-Pack"/>
<meta name="DC.identifier" content="5.0"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
<p>
  <strong>WARNING</strong>: Version 5.0 of the Elastic Stack has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
<a href="https://www.elastic.co/guide/index.html">current release documentation</a>.
</p>
</div>
<div class="navheader">
<span class="prev">
<a href="actions-slack.html">« Slack Action</a>
</span>
<span class="next">
<a href="transform.html">Transforms »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">X-Pack for the Elastic Stack [5.0]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="xpack-alerting.html">Alerting on Cluster and Index Events</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="actions.html">Actions</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>PagerDuty Action</h1><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.0/docs/en/watcher/actions/pagerduty.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div id="url-to-v3" class="version-warning">
    <strong>IMPORTANT</strong>: This documentation is no longer updated. Refer to <a href="https://www.elastic.co/support/eol">Elastic's version policy</a> and the <a href="https://www.elastic.co/docs">latest documentation</a>.
</div>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="actions-pagerduty"></a>PagerDuty Action</h2><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.0/docs/en/watcher/actions/pagerduty.asciidoc">edit</a></div>
</div></div></div>
<p>Use the PagerDuty action to create events in <a href="https://pagerduty.com/" class="ulink" target="_top">
PagerDuty</a>. To create PagerDuty events, you must <a class="xref" href="actions-pagerduty.html#configuring-pagerduty" title="Configuring PagerDuty Accounts">configure at least one PagerDuty account</a> in <code class="literal">elasticsearch.yml</code>.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="configuring-pagerduty-actions"></a>Configuring PagerDuty Actions</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.0/docs/en/watcher/actions/pagerduty.asciidoc">edit</a></div>
</div></div></div>
<p>You configure PagerDuty actions in the <code class="literal">actions</code> array. Action-specific attributes
are specified using the <code class="literal">pagerduty</code> keyword.</p>
<p>The following snippet shows a simple PagerDuty action definition:</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">"actions" : {
  "notify-pagerduty" : {
    "transform" : { ... },
    "throttle_period" : "5m",
    "pagerduty" : {
      "description" : "Main system down, please check!" <a id="CO56-1"></a><i class="conum" data-value="1"></i>
    }
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO56-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Description of the message</p>
</td>
</tr>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="adding-context-and-payloads-to-pagerduty-actions"></a>Adding Meta Information to a PagerDuty Incident</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.0/docs/en/watcher/actions/pagerduty.asciidoc">edit</a></div>
</div></div></div>
<p>To give the PagerDuty incident some more context, you can attach the
payload as well as an array of contexts to the action.</p>
<div class="pre_wrapper lang-js">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-js">"actions" : {
  "notify-pagerduty" : {
    "throttle_period" : "5m",
    "pagerduty" : {
      "account" : "team1",
      "description" : "Main system down, please check! Happened at {{ctx.execution_time}}"
      "attach_payload" : true,
      "client" : "/foo/bar/{{ctx.watch_id}}",
      "client_url" : "http://www.example.org/",
      "context" : [
        {
          "type": "link",
          "href": "http://acme.pagerduty.com"
        },{
          "type": "link",
          "href": "http://acme.pagerduty.com",
          "text": "View the incident on {{ctx.payload.link}}"
        }
      ]
    }
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="pagerduty-action-attributes"></a>Pagerduty Action Attributes</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.0/docs/en/watcher/actions/pagerduty.asciidoc">edit</a></div>
</div></div></div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">account</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The account to use, falls back to the default one.
                            The account needs a <code class="literal">service_key_api</code> attribute.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="table">
<a id="pagerduty-event-trigger-incident-attributes"></a>
<p class="title"><strong>Table 39. Pagerduty Event Trigger Incident Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Pagerduty Event Trigger Incident Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">description</code></p></td>
<td align="center" valign="top"><p>yes</p></td>
<td align="left" valign="top"><p>A quick description for this event</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">event_type</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The event type to sent. Must be one of <code class="literal">trigger</code>,
                                <code class="literal">resolve</code> or <code class="literal">acknowledge</code>. Defaults to <code class="literal">trigger</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">incident_key</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>The incident key on the pagerduty side, also used
                                for de-duplication and allows to resolve or acknowledge
                                incidents.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">client</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>Name of the client triggering the incident, i.e.
                                <code class="literal">Watcher Monitoring</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">client_url</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>A client URL to visit to get more detailed information.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">attach_payload</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>If set to <code class="literal">true</code> the payload is attached as a detail
                                to the API call. Defaults to <code class="literal">false</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">contexts</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>An array of objects, that allow you to provide
                                additional links or images in order to provide more
                                context to the trigger.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>You can configure defaults for the above values for the whole service using the
<code class="literal">xpack.notification.pagerduty.event_defaults.*</code> properties as well as
per account using <code class="literal">xpack.notification.pagerduty.account.your_account_name.event_defaults.*</code></p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>All of those objects have templating support, so you can use data from the
      context and the payload as part of all the fields.</p>
</div>
</div>
<div class="table">
<a id="pagerduty-event-trigger-context-attributes"></a>
<p class="title"><strong>Table 40. Pagerduty Event Trigger Context Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Pagerduty Event Trigger Context Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Required</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">type</code></p></td>
<td align="center" valign="top"><p>yes</p></td>
<td align="left" valign="top"><p>One of <code class="literal">link</code> or <code class="literal">image</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">href</code></p></td>
<td align="center" valign="top"><p>yes/no</p></td>
<td align="left" valign="top"><p>A link to include more information. Must be there if the
                      type is <code class="literal">link</code>, optional if the type is <code class="literal">image</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">src</code></p></td>
<td align="center" valign="top"><p>no</p></td>
<td align="left" valign="top"><p>A src attribute for the <code class="literal">image</code> type.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="configuring-pagerduty"></a>Configuring PagerDuty Accounts</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.0/docs/en/watcher/actions/pagerduty.asciidoc">edit</a></div>
</div></div></div>
<p>You configure the accounts Watcher uses to communicate with PagerDuty in
the <code class="literal">xpack.notification.pagerduty</code> namespace in <code class="literal">elasticsearch.yml</code>.</p>
<p>To configure a PagerDuty account, you need the API integration key for
the PagerDuty service you want to send notifications to. To get the
key:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to <a href="http://pagerduty.com" class="ulink" target="_top">pagerduty.com</a> as an account administrator.
</li>
<li class="listitem">
<p>Go to <span class="strong strong"><strong>Configuration &gt; Services</strong></span> and select the PagerDuty service. The
service must use the API integration.</p>
<div class="imageblock">
<div class="content">
<img src="images/watcher/pagerduty-services.jpg" alt="pagerduty services">
</div>
</div>
</li>
<li class="listitem">
<p>Click the <span class="strong strong"><strong>Integrations</strong></span> tab and copy the API integration key.</p>
<div class="imageblock">
<div class="content">
<img src="images/watcher/pagerduty-integrations.jpg" alt="pagerduty integrations">
</div>
</div>
</li>
</ol>
</div>
<p>To configure a PagerDuty account in <code class="literal">elasticsearch.yml</code>, at a minimum you
must specify an account name and integration key:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.notification.pagerduty:
  account:
    my_pagerduty_account:
      service_api_key: d3b07384d113edec49eaa6238ad5ff0</pre>
</div>
<p>You can also specify defaults for the <a class="xref" href="actions-pagerduty.html#pagerduty-event-trigger-incident-attributes" title="Pagerduty Event Trigger Incident Attributes">PagerDuty event attributes</a>:
.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.notification.pagerduty:
  account:
    my_pagerduty_account:
      service_api_key: d3b07384d113edec49eaa6238ad5ff0
      event_defaults:
        description: "Watch notification"
        incident_key: "my_incident_key"
        client: "my_client"
        client_url: http://www.example.org
        event_type: trigger
        attach_payload: true</pre>
</div>
<p>If you configure multiple PagerDuty accounts, you either need to set a default
account or specify which account the event should be sent with in the
<a class="xref" href="actions-pagerduty.html" title="PagerDuty Action"><code class="literal">pagerduty</code></a> action.</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">xpack.notification.pagerduty:
  default_account: team1
  account:
    team1:
      ...
    team2:
      ...</pre>
</div>
<div class="position-relative"><h3><a id="actions-ssl-openjdk"></a>Using SSL/TLS with OpenJDK</h3><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.0/docs/en/watcher/actions.asciidoc">edit</a></div>
<p>As each distributor is free to choose how to package OpenJDK, it may happen,
that even despite the exact same version, an OpenJDK distribution contains
different parts under different Linux distributions.</p>
<p>This can lead to issues with any action or input that uses TLS, like the <code class="literal">jira</code>,
<code class="literal">pagerduty</code>, <code class="literal">slack</code>, <code class="literal">hipchat</code> or <code class="literal">webhook</code> one, because of missing CA certs.
If you encounter TLS errors, when writing watches that connect to TLS endpoints,
you should try to upgrade to the latest available OpenJDK distribution for your
platform and if that does not help, try to upgrade to Oracle JDK.</p>
</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="actions-slack.html">« Slack Action</a>
</span>
<span class="next">
<a href="transform.html">Transforms »</a>
</span>
</div>
</body>
</html>
