<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Auditing Security Events | X-Pack for the Elastic Stack [5.2] | Elastic</title>
<link rel="home" href="index.html" title="X-Pack for the Elastic Stack [5.2]"/>
<link rel="up" href="xpack-security.html" title="Securing Elasticsearch and Kibana"/>
<link rel="prev" href="run-as-privilege.html" title="Submitting Requests on Behalf of Other Users"/>
<link rel="next" href="encrypting-communications.html" title="Encrypting Communications"/>
<meta name="DC.type" content="Learn/Docs/Legacy/XPack/Reference/5.2"/>
<meta name="DC.subject" content="X-Pack"/>
<meta name="DC.identifier" content="5.2"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<p>
  <strong>WARNING</strong>: Version 5.2 of the Elastic Stack has passed its 
  <a href="https://www.elastic.co/support/eol">EOL date</a>. 
</p>  
<p>
  This documentation is no longer being maintained and may be removed. 
  If you are running this version, we strongly advise you to upgrade. 
  For the latest information, see the 
<a href="https://www.elastic.co/guide/index.html">current release documentation</a>.
</p>
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">X-Pack for the Elastic Stack [5.2]</a></span>
»
<span class="breadcrumb-link"><a href="xpack-security.html">Securing Elasticsearch and Kibana</a></span>
»
<span class="breadcrumb-node">Auditing Security Events</span>
</div>
<div class="navheader">
<span class="prev">
<a href="run-as-privilege.html">« Submitting Requests on Behalf of Other Users</a>
</span>
<span class="next">
<a href="encrypting-communications.html">Encrypting Communications »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="auditing"></a>Auditing Security Events<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h2>
</div></div></div>
<p>You can enable auditing to keep track of security-related events such as
authentication failures and refused connections. Logging these events enables you
to monitor your cluster for suspicious activity and provides evidence in the
event of an attack.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Audit logs are <span class="strong strong"><strong>disabled</strong></span> by default. To enable this functionality, you
must set <code class="literal">xpack.security.audit.enabled</code> to <code class="literal">true</code> in <code class="literal">elasticsearch.yml</code>.</p>
</div>
</div>
<p>X-Pack security provides two ways to persist audit logs:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The <a class="xref" href="auditing.html#audit-log-output" title="Logfile Audit Output"><code class="literal">logfile</code></a> output, which persists events to
a dedicated <code class="literal">&lt;clustername&gt;_access.log</code> file on the host&#8217;s file system.
</li>
<li class="listitem">
The <a class="xref" href="auditing.html#audit-index" title="Index Audit Output"><code class="literal">index</code></a> output, which persists events to an Elasticsearch index.
The audit index can reside on the same cluster, or a separate cluster.
</li>
</ul>
</div>
<p>By default, only the <code class="literal">logfile</code> output is used when enabling auditing.
To facilitate browsing and analyzing the events, you can also enable
indexing by setting <code class="literal">xpack.security.audit.outputs</code> in <code class="literal">elasticsearch.yml</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.audit.outputs: [ index, logfile ]</pre>
</div>
<p>The <code class="literal">index</code> output type should be used in conjunction with the <code class="literal">logfile</code>
output type Because it is possible for the <code class="literal">index</code> output type to lose
messages if the target index is unavailable, the <code class="literal">access.log</code> should be
used as the official record of events.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Audit events are batched for indexing so there is a lag before
events appear in the index. You can control how frequently batches of
events are pushed to the index by setting
<code class="literal">xpack.security.audit.index.flush_interval</code> in <code class="literal">elasticsearch.yml</code>.</p>
</div>
</div>
<h3><a id="audit-event-types"></a>Audit Event Types<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h3>
<p>Each request may generate multiple audit events.
The following is a list of the events that can be generated:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">anonymous_access_denied</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when a request is denied due to a missing
                                          authentication token.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">authentication_success</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when a user successfully authenticates.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">authentication_failed</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when the authentication token cannot be
                                          matched to a known user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">realm_authentication_failed</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged for every realm that fails to present a valid
                                          authentication token. <code class="literal">&lt;realm&gt;</code> represents the
                                          realm type.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">access_denied</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when an authenticated user attempts to execute
                                          an action they do not have the necessary
                                          <a class="xref" href="security-reference.html" title="Reference">privilege</a> to perform.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">access_granted</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when an authenticated user attempts to execute
                                          an action they have the necessary privilege to perform.
                                          When the <code class="literal">system_access_granted</code> event is included, all system
                                          (internal) actions are also logged. The default setting does
                                          not log system actions to avoid cluttering the logs.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">run_as_granted</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when an authenticated user attempts to <a class="xref" href="run-as-privilege.html" title="Submitting Requests on Behalf of Other Users">run as</a>
                                          another user that they have the necessary privileges to do.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">run_as_denied</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when an authenticated user attempts to <a class="xref" href="run-as-privilege.html" title="Submitting Requests on Behalf of Other Users">run as</a>
                                          another user action they do not have the necessary
                                          <a class="xref" href="security-reference.html" title="Reference">privilege</a> to do so.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">tampered_request</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when X-Pack security detects that the request has
                                          been tampered with. Typically relates to <code class="literal">search/scroll</code>
                                          requests when the scroll ID is believed to have been
                                          tampered with.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">connection_granted</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when an incoming TCP connection passes the
                                          <a class="xref" href="ip-filtering.html" title="Restricting Connections with IP Filtering">IP Filter</a> for a specific
                                          profile.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">connection_denied</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>Logged when an incoming TCP connection does not pass the
                                          <a class="xref" href="ip-filtering.html" title="Restricting Connections with IP Filtering">IP Filter</a> for a specific
                                          profile.</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="audit-event-attributes"></a>Audit Event Attributes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h3>
<p>The following table shows the common attributes that can be associated with every event.</p>
<div class="table">
<p class="title"><strong>Table 12. Common Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Common Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">timestamp</code></p></td>
<td align="left" valign="top"><p>When the event occurred.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">node_name</code></p></td>
<td align="left" valign="top"><p>The name of the node.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">node_host_name</code></p></td>
<td align="left" valign="top"><p>The hostname of the node.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">node_host_address</code></p></td>
<td align="left" valign="top"><p>The IP address of the node.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">layer</code></p></td>
<td align="left" valign="top"><p>The layer from which this event originated: <code class="literal">rest</code>, <code class="literal">transport</code> or <code class="literal">ip_filter</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">event_type</code></p></td>
<td align="left" valign="top"><p>The type of event that occurred: <code class="literal">anonymous_access_denied</code>,
                        <code class="literal">authentication_failed</code>, <code class="literal">access_denied</code>, <code class="literal">access_granted</code>,
                        <code class="literal">connection_granted</code>, <code class="literal">connection_denied</code>, <code class="literal">tampered_request</code>,
                        <code class="literal">run_as_granted</code>, <code class="literal">run_as_denied</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The following tables show the attributes that can be associated with each type of event.
The log level determines  which attributes are included in a log entry.</p>
<div class="table">
<p class="title"><strong>Table 13. REST anonymous_access_denied Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="REST anonymous_access_denied Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">uri</code></p></td>
<td align="left" valign="top"><p>The REST endpoint URI.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request_body</code></p></td>
<td align="left" valign="top"><p>The body of the request, if enabled.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 14. REST authentication_success Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="REST authentication_success Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">user</code></p></td>
<td align="left" valign="top"><p>The authenticated user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">realm</code></p></td>
<td align="left" valign="top"><p>The realm that authenticated the user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">uri</code></p></td>
<td align="left" valign="top"><p>The REST endpoint URI.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">params</code></p></td>
<td align="left" valign="top"><p>The REST URI query parameters.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request_body</code></p></td>
<td align="left" valign="top"><p>The body of the request, if enabled.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 15. REST authentication_failed Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="REST authentication_failed Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">principal</code></p></td>
<td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">uri</code></p></td>
<td align="left" valign="top"><p>The REST endpoint URI.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request_body</code></p></td>
<td align="left" valign="top"><p>The body of the request, if enabled.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 16. REST realm_authentication_failed Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="REST realm_authentication_failed Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">principal</code></p></td>
<td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">uri</code></p></td>
<td align="left" valign="top"><p>The REST endpoint URI.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request_body</code></p></td>
<td align="left" valign="top"><p>The body of the request, if enabled.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">realm</code></p></td>
<td align="left" valign="top"><p>The realm that failed to authenticate the user.
                      NOTE: A separate entry is logged for each
                            consulted realm.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 17. Transport anonymous_access_denied Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Transport anonymous_access_denied Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_type</code></p></td>
<td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action</code></p></td>
<td align="left" valign="top"><p>The name of the action that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request</code></p></td>
<td align="left" valign="top"><p>The type of request that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">indices</code></p></td>
<td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 18. Transport authentication_success Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Transport authentication_success Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_type</code></p></td>
<td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">user</code></p></td>
<td align="left" valign="top"><p>The authenticated user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">realm</code></p></td>
<td align="left" valign="top"><p>The realm that authenticated the user.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action</code></p></td>
<td align="left" valign="top"><p>The name of the action that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request</code></p></td>
<td align="left" valign="top"><p>The type of request that was executed.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 19. Transport authentication_failed Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Transport authentication_failed Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_type</code></p></td>
<td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">principal</code></p></td>
<td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action</code></p></td>
<td align="left" valign="top"><p>The name of the action that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request</code></p></td>
<td align="left" valign="top"><p>The type of request that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">indices</code></p></td>
<td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 20. Transport realm_authentication_failed Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Transport realm_authentication_failed Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_type</code></p></td>
<td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">principal</code></p></td>
<td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action</code></p></td>
<td align="left" valign="top"><p>The name of the action that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request</code></p></td>
<td align="left" valign="top"><p>The type of request that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">indices</code></p></td>
<td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">realm</code></p></td>
<td align="left" valign="top"><p>The realm that failed to authenticate the user.
                      NOTE: A separate entry is logged for each
                            consulted realm.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 21. Transport access_granted Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Transport access_granted Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_type</code></p></td>
<td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">principal</code></p></td>
<td align="left" valign="top"><p>The principal (username) that passed authentication.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action</code></p></td>
<td align="left" valign="top"><p>The name of the action that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request</code></p></td>
<td align="left" valign="top"><p>The type of request that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">indices</code></p></td>
<td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 22. Transport access_denied Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Transport access_denied Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_type</code></p></td>
<td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">principal</code></p></td>
<td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action</code></p></td>
<td align="left" valign="top"><p>The name of the action that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request</code></p></td>
<td align="left" valign="top"><p>The type of request that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">indices</code></p></td>
<td align="left" valign="top"><p>A comma-separated list of indices this request
                      relates to (when applicable).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 23. Transport tampered_request Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Transport tampered_request Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_type</code></p></td>
<td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">principal</code></p></td>
<td align="left" valign="top"><p>The principal (username) that failed to authenticate.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">action</code></p></td>
<td align="left" valign="top"><p>The name of the action that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">request</code></p></td>
<td align="left" valign="top"><p>The type of request that was executed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">indices</code></p></td>
<td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 24. IP Filter connection_granted Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="IP Filter connection_granted Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">transport_profile</code></p></td>
<td align="left" valign="top"><p>The transport profile the request targeted.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">rule</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="ip-filtering.html" title="Restricting Connections with IP Filtering">IP filtering</a> rule that granted
                        the request.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="table">
<p class="title"><strong>Table 25. IP Filter connection_denied Attributes</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="IP Filter connection_denied Attributes">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">origin_address</code></p></td>
<td align="left" valign="top"><p>The IP address from which the request originated.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">transport_profile</code></p></td>
<td align="left" valign="top"><p>The transport profile the request targeted.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">rule</code></p></td>
<td align="left" valign="top"><p>The <a class="xref" href="ip-filtering.html" title="Restricting Connections with IP Filtering">IP filtering</a> rule that denied
                        the request.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h3><a id="audit-log-output"></a>Logfile Audit Output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h3>
<p>The <code class="literal">logfile</code> audit output is the default output for auditing. It writes data to
the <code class="literal">&lt;clustername&gt;_access.log</code> file in the logs directory.</p>
<h3><a id="audit-log-entry-format"></a>Log Entry Format<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h3>
<p>The format of a log entry is:</p>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">[&lt;timestamp&gt;] [&lt;local_node_info&gt;] [&lt;layer&gt;] [&lt;entry_type&gt;] &lt;attribute_list&gt;</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;timestamp&gt;</code>
</span>
</dt>
<dd>
When the event occurred. You can configure the
timestamp format in <code class="literal">log4j2.properties</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;local_node_info&gt;</code>
</span>
</dt>
<dd>
Information about the local node that generated
the log entry. You can control what node information
is included by configuring the
<a class="xref" href="auditing.html#audit-log-entry-local-node-info" title="Local Node Info Settings">local node info settings</a>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;layer&gt;</code>
</span>
</dt>
<dd>
The layer from which this event originated:
<code class="literal">rest</code>, <code class="literal">transport</code> or <code class="literal">ip_filter</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;entry_type&gt;</code>
</span>
</dt>
<dd>
The type of event that occurred: <code class="literal">anonymous_access_denied</code>,
<code class="literal">authentication_failed</code>, <code class="literal">access_denied</code>, <code class="literal">access_granted</code>,
<code class="literal">connection_granted</code>, <code class="literal">connection_denied</code>.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;attribute_list&gt;</code>
</span>
</dt>
<dd>
A comma-separated list of key-value pairs that contain
data pertaining to the event. Formatted as
<code class="literal">attr1=[val1], attr2=[val2]</code>. See <a class="xref" href="auditing.html#audit-event-attributes" title="Audit Event Attributes">Audit Entry Attributes</a> for the attributes that can be included
for each type of event.
</dd>
</dl>
</div>
<h3><a id="audit-log-settings"></a>Logfile Output Settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h3>
<p>The events and some other information about what gets logged can be
controlled using settings in the <code class="literal">elasticsearch.yml</code> file.</p>
<div class="table">
<p class="title"><strong>Table 26. Audited Event Settings</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Audited Event Settings">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.logfile.events.include</code></p></td>
<td align="center" valign="top"><p><code class="literal">access_denied</code>, <code class="literal">access_granted</code>, <code class="literal">anonymous_access_denied</code>, <code class="literal">authentication_failed</code>, <code class="literal">connection_denied</code>, <code class="literal">tampered_request</code>, <code class="literal">run_as_denied</code>, <code class="literal">run_as_granted</code></p></td>
<td align="left" valign="top"><p>Includes the specified events in the output.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.logfile.events.exclude</code></p></td>
<td align="center" valign="top"><p></p></td>
<td align="left" valign="top"><p>Excludes the specified events from the output.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.logfile.events.emit_request_body</code></p></td>
<td align="center" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>Include or exclude the request body from REST requests
                                                                       on certain event types such as <code class="literal">authentication_failed</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>No filtering is performed when auditing, so sensitive data may be
audited in plain text when including the request body in audit events.</p>
</div>
</div>
<div class="table">
<a id="audit-log-entry-local-node-info"></a>
<p class="title"><strong>Table 27. Local Node Info Settings</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Local Node Info Settings">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="center" valign="top">Default</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.logfile.prefix.emit_node_name</code></p></td>
<td align="center" valign="top"><p>true</p></td>
<td align="left" valign="top"><p>Include or exclude the node&#8217;s name
                                                                               from the local node info.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.logfile.prefix.emit_node_host_address</code></p></td>
<td align="center" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>Include or exclude the node&#8217;s IP address
                                                                               from the local node info.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.logfile.prefix.emit_node_host_name</code></p></td>
<td align="center" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>Include or exclude the node&#8217;s host name
                                                                               from the local node info.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<p><a id="logging-file"></a>You configure also configure how the logfile is written in the <code class="literal">log4j2.properties</code>
file located in <code class="literal">CONFIG_DIR/x-pack</code>. By default, audit information is appended to the
<code class="literal">&lt;clustername&gt;_access.log</code> file located in the standard Elasticsearch <code class="literal">logs</code> directory
(typically located at <code class="literal">$ES_HOME/logs</code>). The file rolls over on a daily basis.</p>
<h3><a id="audit-index"></a>Index Audit Output<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h3>
<p>In addition to logging to a file, you can store audit logs in Elasticsearch
rolling indices. These indices can be either on the same cluster, or on a
remote cluster. You configure the following settings in
<code class="literal">elasticsearch.yml</code> to control how audit entries are indexed. To enable
this output, you need to configure the setting <code class="literal">xpack.security.audit.outputs</code>
in the <code class="literal">elasticsearch.yml</code> file:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.audit.outputs: [ index, logfile ]</pre>
</div>
<div class="table">
<p class="title"><strong>Table 28. Audit Log Indexing Configuration</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Audit Log Indexing Configuration">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Default Setting</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.bulk_size</code></p></td>
<td align="left" valign="top"><p><code class="literal">1000</code></p></td>
<td align="left" valign="top"><p>Controls how many audit events are batched into a single write.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.flush_interval</code></p></td>
<td align="left" valign="top"><p><code class="literal">1s</code></p></td>
<td align="left" valign="top"><p>Controls how often buffered events are flushed to the index.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.rollover</code></p></td>
<td align="left" valign="top"><p><code class="literal">daily</code></p></td>
<td align="left" valign="top"><p>Controls how often to roll over to a new index:
                                                                  <code class="literal">hourly</code>, <code class="literal">daily</code>, <code class="literal">weekly</code>, or <code class="literal">monthly</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.events.include</code></p></td>
<td align="left" valign="top"><p><code class="literal">anonymous_access_denied</code>, <code class="literal">authentication_failed</code>, <code class="literal">realm_authentication_failed</code>, <code class="literal">access_granted</code>, <code class="literal">access_denied</code>, <code class="literal">tampered_request</code>, <code class="literal">connection_granted</code>, <code class="literal">connection_denied</code>, <code class="literal">run_as_granted</code>, <code class="literal">run_as_denied</code></p></td>
<td align="left" valign="top"><p>The audit events to be indexed. See <a class="xref" href="auditing.html#audit-event-types" title="Audit Event Types">Audit Entry Types</a> for the complete list.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.events.exclude</code></p></td>
<td align="left" valign="top"><p></p></td>
<td align="left" valign="top"><p>The audit events to exclude from indexing.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.events.emit_request_body</code></p></td>
<td align="left" valign="top"><p>false</p></td>
<td align="left" valign="top"><p>Include or exclude the request body from REST requests
                                                                   on certain event types such as <code class="literal">authentication_failed</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>No filtering is performed when auditing, so sensitive data may be
audited in plain text when including the request body in audit events.</p>
</div>
</div>
<h4><a id="_audit_index_settings"></a>Audit Index Settings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h4>
<p>You can also configure settings for the indices that the events are stored in.
These settings are configured in the <code class="literal">xpack.security.audit.index.settings</code> namespace
in <code class="literal">elasticsearch.yml</code>. For example, the following configuration sets the
number of shards and replicas to 1 for the audit indices:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.audit.index.settings:
  index:
    number_of_shards: 1
    number_of_replicas: 1</pre>
</div>
<h4><a id="_forwarding_audit_logs_to_a_remote_cluster"></a>Forwarding Audit Logs to a Remote Cluster<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/x-pack/edit/5.2/docs/en/shield/auditing.asciidoc">edit</a></h4>
<p>To index audit events to a remote Elasticsearch cluster, you configure
the following <code class="literal">xpack.security.audit.index.client</code> settings.</p>
<div class="table">
<p class="title"><strong>Table 29. Remote Audit Log Indexing Configuration</strong></p>
<div class="table-contents">
<table border="1" cellpadding="4px" summary="Remote Audit Log Indexing Configuration">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Attribute</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.client.hosts</code></p></td>
<td align="left" valign="top"><p>Comma-separated list of <code class="literal">host:port</code> pairs. These hosts
                                                              should be nodes in the remote cluster.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.client.cluster.name</code></p></td>
<td align="left" valign="top"><p>The name of the remote cluster.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">xpack.security.audit.index.client.xpack.security.user</code></p></td>
<td align="left" valign="top"><p>The <code class="literal">username:password</code> pair to use to authenticate with
                                                              the remote cluster.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>You can pass additional settings to the remote client by specifying them in the
<code class="literal">xpack.security.audit.index.client</code> namespace. For example, to allow the remote
client to discover all of the nodes in the remote cluster you can specify the
<code class="literal">client.transport.sniff</code> setting:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.audit.index.client.transport.sniff: true</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="run-as-privilege.html">« Submitting Requests on Behalf of Other Users</a>
</span>
<span class="next">
<a href="encrypting-communications.html">Encrypting Communications »</a>
</span>
</div>
</div>
</body>
</html>
