<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Auditing Security Events
        | X-Pack for the Elastic Stack [5.5]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="X-Pack for the Elastic Stack [5.5]" /><link rel="up" href="xpack-security.html" title="Securing Elasticsearch and Kibana" /><link rel="prev" href="custom-roles-provider.html" title="Custom Roles Provider Extension" /><link rel="next" href="encrypting-communications.html" title="Encrypting Communications" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Legacy/XPack/Reference/5.5" /><meta name="DC.subject" content="X-Pack" /><meta name="DC.identifier" content="5.5" /><meta name="robots" content="noindex,nofollow" /></head><body><div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">X-Pack for the Elastic Stack
      [5.5]
    </a></span> » <span class="breadcrumb-link"><a href="xpack-security.html">Securing Elasticsearch and Kibana</a></span> » <span class="breadcrumb-node">Auditing Security Events</span></div><div class="navheader"><span class="prev"><a href="custom-roles-provider.html">
              « 
              Custom Roles Provider Extension</a>
           
        </span><span class="next">
           
          <a href="encrypting-communications.html">Encrypting Communications
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="auditing"></a>Auditing Security Events</h2></div></div></div><p>You can enable auditing to keep track of security-related events such as
authentication failures and refused connections. Logging these events enables you
to monitor your cluster for suspicious activity and provides evidence in the
event of an attack.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Audit logs are <span class="strong strong"><strong>disabled</strong></span> by default. To enable this functionality, you
must set <code class="literal">xpack.security.audit.enabled</code> to <code class="literal">true</code> in <code class="literal">elasticsearch.yml</code>.</p></div></div><p>X-Pack security provides two ways to persist audit logs:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">The <a class="link" href="auditing.html#audit-log-output" title="Logfile Audit Output"><code class="literal">logfile</code></a> output, which persists events to
a dedicated <code class="literal">&lt;clustername&gt;_access.log</code> file on the host’s file system.</li><li class="listitem">The <a class="link" href="auditing.html#audit-index" title="Index Audit Output"><code class="literal">index</code></a> output, which persists events to an Elasticsearch index.
The audit index can reside on the same cluster, or a separate cluster.</li></ul></div><p>By default, only the <code class="literal">logfile</code> output is used when enabling auditing.
To facilitate browsing and analyzing the events, you can also enable
indexing by setting <code class="literal">xpack.security.audit.outputs</code> in <code class="literal">elasticsearch.yml</code>:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">xpack.security.audit.outputs: [ index, logfile ]</pre></div><p>The <code class="literal">index</code> output type should be used in conjunction with the <code class="literal">logfile</code>
output type Because it is possible for the <code class="literal">index</code> output type to lose
messages if the target index is unavailable, the <code class="literal">access.log</code> should be
used as the official record of events.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Audit events are batched for indexing so there is a lag before
events appear in the index. You can control how frequently batches of
events are pushed to the index by setting
<code class="literal">xpack.security.audit.index.flush_interval</code> in <code class="literal">elasticsearch.yml</code>.</p></div></div><h3><a id="audit-event-types"></a>Audit Event Types</h3><p>Each request may generate multiple audit events.
The following is a list of the events that can be generated:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><tbody><tr><td align="left" valign="top"><p><code class="literal">anonymous_access_denied</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when a request is denied due to a missing
                                          authentication token.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">authentication_success</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when a user successfully authenticates.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">authentication_failed</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when the authentication token cannot be
                                          matched to a known user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">realm_authentication_failed</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged for every realm that fails to present a valid
                                          authentication token. <code class="literal">&lt;realm&gt;</code> represents the
                                          realm type.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">access_denied</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when an authenticated user attempts to execute
                                          an action they do not have the necessary
                                          <a class="link" href="security-reference.html" title="Reference">privilege</a> to perform.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">access_granted</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when an authenticated user attempts to execute
                                          an action they have the necessary privilege to perform.
                                          When the <code class="literal">system_access_granted</code> event is included, all system
                                          (internal) actions are also logged. The default setting does
                                          not log system actions to avoid cluttering the logs.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">run_as_granted</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when an authenticated user attempts to <a class="link" href="run-as-privilege.html" title="Submitting Requests on Behalf of Other Users">run as</a>
                                          another user that they have the necessary privileges to do.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">run_as_denied</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when an authenticated user attempts to <a class="link" href="run-as-privilege.html" title="Submitting Requests on Behalf of Other Users">run as</a>
                                          another user action they do not have the necessary
                                          <a class="link" href="security-reference.html" title="Reference">privilege</a> to do so.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">tampered_request</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when X-Pack security detects that the request has
                                          been tampered with. Typically relates to <code class="literal">search/scroll</code>
                                          requests when the scroll ID is believed to have been
                                          tampered with.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">connection_granted</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when an incoming TCP connection passes the
                                          <a class="link" href="ip-filtering.html" title="Restricting Connections with IP Filtering">IP Filter</a> for a specific
                                          profile.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">connection_denied</code></p></td><td align="left" valign="top"> </td><td align="left" valign="top"> </td><td align="left" valign="top"><p>Logged when an incoming TCP connection does not pass the
                                          <a class="link" href="ip-filtering.html" title="Restricting Connections with IP Filtering">IP Filter</a> for a specific
                                          profile.</p></td></tr></tbody></table></div><h3><a id="audit-event-attributes"></a>Audit Event Attributes</h3><p>The following table shows the common attributes that can be associated with every event.</p><div class="table"><a id="id-1.11.7.15"></a><p class="title"><strong>Table 12. Common Attributes</strong></p><div class="table-contents"><table summary="Common Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">timestamp</code></p></td><td align="left" valign="top"><p>When the event occurred.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">node_name</code></p></td><td align="left" valign="top"><p>The name of the node.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">node_host_name</code></p></td><td align="left" valign="top"><p>The hostname of the node.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">node_host_address</code></p></td><td align="left" valign="top"><p>The IP address of the node.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">layer</code></p></td><td align="left" valign="top"><p>The layer from which this event originated: <code class="literal">rest</code>, <code class="literal">transport</code> or <code class="literal">ip_filter</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">event_type</code></p></td><td align="left" valign="top"><p>The type of event that occurred: <code class="literal">anonymous_access_denied</code>,
                        <code class="literal">authentication_failed</code>, <code class="literal">access_denied</code>, <code class="literal">access_granted</code>,
                        <code class="literal">connection_granted</code>, <code class="literal">connection_denied</code>, <code class="literal">tampered_request</code>,
                        <code class="literal">run_as_granted</code>, <code class="literal">run_as_denied</code>.</p></td></tr></tbody></table></div></div><p>The following tables show the attributes that can be associated with each type of event.
The log level determines  which attributes are included in a log entry.</p><div class="table"><a id="id-1.11.7.17"></a><p class="title"><strong>Table 13. REST anonymous_access_denied Attributes</strong></p><div class="table-contents"><table summary="REST anonymous_access_denied Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">uri</code></p></td><td align="left" valign="top"><p>The REST endpoint URI.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request_body</code></p></td><td align="left" valign="top"><p>The body of the request, if enabled.</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.18"></a><p class="title"><strong>Table 14. REST authentication_success Attributes</strong></p><div class="table-contents"><table summary="REST authentication_success Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">user</code></p></td><td align="left" valign="top"><p>The authenticated user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">realm</code></p></td><td align="left" valign="top"><p>The realm that authenticated the user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">uri</code></p></td><td align="left" valign="top"><p>The REST endpoint URI.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">params</code></p></td><td align="left" valign="top"><p>The REST URI query parameters.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request_body</code></p></td><td align="left" valign="top"><p>The body of the request, if enabled.</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.19"></a><p class="title"><strong>Table 15. REST authentication_failed Attributes</strong></p><div class="table-contents"><table summary="REST authentication_failed Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">principal</code></p></td><td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">uri</code></p></td><td align="left" valign="top"><p>The REST endpoint URI.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request_body</code></p></td><td align="left" valign="top"><p>The body of the request, if enabled.</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.20"></a><p class="title"><strong>Table 16. REST realm_authentication_failed Attributes</strong></p><div class="table-contents"><table summary="REST realm_authentication_failed Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">principal</code></p></td><td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">uri</code></p></td><td align="left" valign="top"><p>The REST endpoint URI.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request_body</code></p></td><td align="left" valign="top"><p>The body of the request, if enabled.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">realm</code></p></td><td align="left" valign="top"><p>The realm that failed to authenticate the user.
                      NOTE: A separate entry is logged for each
                            consulted realm.</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.21"></a><p class="title"><strong>Table 17. Transport anonymous_access_denied Attributes</strong></p><div class="table-contents"><table summary="Transport anonymous_access_denied Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_type</code></p></td><td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">action</code></p></td><td align="left" valign="top"><p>The name of the action that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request</code></p></td><td align="left" valign="top"><p>The type of request that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">indices</code></p></td><td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.22"></a><p class="title"><strong>Table 18. Transport authentication_success Attributes</strong></p><div class="table-contents"><table summary="Transport authentication_success Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_type</code></p></td><td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">user</code></p></td><td align="left" valign="top"><p>The authenticated user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">realm</code></p></td><td align="left" valign="top"><p>The realm that authenticated the user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">action</code></p></td><td align="left" valign="top"><p>The name of the action that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request</code></p></td><td align="left" valign="top"><p>The type of request that was executed.</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.23"></a><p class="title"><strong>Table 19. Transport authentication_failed Attributes</strong></p><div class="table-contents"><table summary="Transport authentication_failed Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_type</code></p></td><td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">principal</code></p></td><td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">action</code></p></td><td align="left" valign="top"><p>The name of the action that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request</code></p></td><td align="left" valign="top"><p>The type of request that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">indices</code></p></td><td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.24"></a><p class="title"><strong>Table 20. Transport realm_authentication_failed Attributes</strong></p><div class="table-contents"><table summary="Transport realm_authentication_failed Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_type</code></p></td><td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">principal</code></p></td><td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">action</code></p></td><td align="left" valign="top"><p>The name of the action that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request</code></p></td><td align="left" valign="top"><p>The type of request that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">indices</code></p></td><td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">realm</code></p></td><td align="left" valign="top"><p>The realm that failed to authenticate the user.
                      NOTE: A separate entry is logged for each
                            consulted realm.</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.25"></a><p class="title"><strong>Table 21. Transport access_granted Attributes</strong></p><div class="table-contents"><table summary="Transport access_granted Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_type</code></p></td><td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">principal</code></p></td><td align="left" valign="top"><p>The principal (username) that passed authentication.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">action</code></p></td><td align="left" valign="top"><p>The name of the action that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request</code></p></td><td align="left" valign="top"><p>The type of request that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">indices</code></p></td><td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.26"></a><p class="title"><strong>Table 22. Transport access_denied Attributes</strong></p><div class="table-contents"><table summary="Transport access_denied Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_type</code></p></td><td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">principal</code></p></td><td align="left" valign="top"><p>The principal (username) that failed authentication.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">action</code></p></td><td align="left" valign="top"><p>The name of the action that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request</code></p></td><td align="left" valign="top"><p>The type of request that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">indices</code></p></td><td align="left" valign="top"><p>A comma-separated list of indices this request
                      relates to (when applicable).</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.27"></a><p class="title"><strong>Table 23. Transport tampered_request Attributes</strong></p><div class="table-contents"><table summary="Transport tampered_request Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_type</code></p></td><td align="left" valign="top"><p>Where the request originated: <code class="literal">rest</code> (request
                      originated from a REST API request), <code class="literal">transport</code>
                      (request was received on the transport channel),
                      <code class="literal">local_node</code> (the local node issued the request).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">principal</code></p></td><td align="left" valign="top"><p>The principal (username) that failed to authenticate.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">action</code></p></td><td align="left" valign="top"><p>The name of the action that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">request</code></p></td><td align="left" valign="top"><p>The type of request that was executed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">indices</code></p></td><td align="left" valign="top"><p>A comma-separated list of indices this request
                      pertains to (when applicable).</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.28"></a><p class="title"><strong>Table 24. IP Filter connection_granted Attributes</strong></p><div class="table-contents"><table summary="IP Filter connection_granted Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">transport_profile</code></p></td><td align="left" valign="top"><p>The transport profile the request targeted.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">rule</code></p></td><td align="left" valign="top"><p>The <a class="link" href="ip-filtering.html" title="Restricting Connections with IP Filtering">IP filtering</a> rule that granted
                        the request.</p></td></tr></tbody></table></div></div><div class="table"><a id="id-1.11.7.29"></a><p class="title"><strong>Table 25. IP Filter connection_denied Attributes</strong></p><div class="table-contents"><table summary="IP Filter connection_denied Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Attribute</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">origin_address</code></p></td><td align="left" valign="top"><p>The IP address from which the request originated.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">transport_profile</code></p></td><td align="left" valign="top"><p>The transport profile the request targeted.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">rule</code></p></td><td align="left" valign="top"><p>The <a class="link" href="ip-filtering.html" title="Restricting Connections with IP Filtering">IP filtering</a> rule that denied
                        the request.</p></td></tr></tbody></table></div></div><h3><a id="audit-log-output"></a>Logfile Audit Output</h3><p>The <code class="literal">logfile</code> audit output is the default output for auditing. It writes data to
the <code class="literal">&lt;clustername&gt;_access.log</code> file in the logs directory.</p><h3><a id="audit-log-entry-format"></a>Log Entry Format</h3><p>The format of a log entry is:</p><div class="pre_wrapper lang-txt"><pre class="programlisting prettyprint lang-txt">[&lt;timestamp&gt;] [&lt;local_node_info&gt;] [&lt;layer&gt;] [&lt;entry_type&gt;] &lt;attribute_list&gt;</pre></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;timestamp&gt;</code>       </span></dt><dd>When the event occurred. You can configure the
timestamp format in <code class="literal">log4j2.properties</code>.</dd><dt><span class="term"><code class="literal">&lt;local_node_info&gt;</code> </span></dt><dd>Information about the local node that generated
the log entry. You can control what node information
is included by configuring the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/auditing-settings.html#node-audit-settings" target="_top">local node info settings</a>.</dd><dt><span class="term"><code class="literal">&lt;layer&gt;</code>           </span></dt><dd>The layer from which this event originated:
<code class="literal">rest</code>, <code class="literal">transport</code> or <code class="literal">ip_filter</code>.</dd><dt><span class="term"><code class="literal">&lt;entry_type&gt;</code>      </span></dt><dd>The type of event that occurred: <code class="literal">anonymous_access_denied</code>,
<code class="literal">authentication_failed</code>, <code class="literal">access_denied</code>, <code class="literal">access_granted</code>,
<code class="literal">connection_granted</code>, <code class="literal">connection_denied</code>.</dd><dt><span class="term"><code class="literal">&lt;attribute_list&gt;</code>  </span></dt><dd>A comma-separated list of key-value pairs that contain
data pertaining to the event. Formatted as
<code class="literal">attr1=[val1], attr2=[val2]</code>. See <a class="link" href="auditing.html#audit-event-attributes" title="Audit Event Attributes">Audit Entry Attributes</a> for the attributes that can be included
for each type of event.</dd></dl></div><h3><a id="audit-log-settings"></a>Logfile Output Settings</h3><p>The events and some other information about what gets logged can be
controlled using settings in the <code class="literal">elasticsearch.yml</code> file. See
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/auditing-settings.html#event-audit-settings" target="_top">Audited Event Settings</a> and
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/auditing-settings.html#node-audit-settings" target="_top">Local Node Info Settings</a>.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>No filtering is performed when auditing, so sensitive data may be
audited in plain text when including the request body in audit events.</p></div></div><p><a id="logging-file"></a>You configure also configure how the logfile is written in the <code class="literal">log4j2.properties</code>
file located in <code class="literal">CONFIG_DIR/x-pack</code>. By default, audit information is appended to the
<code class="literal">&lt;clustername&gt;_access.log</code> file located in the standard Elasticsearch <code class="literal">logs</code> directory
(typically located at <code class="literal">$ES_HOME/logs</code>). The file rolls over on a daily basis.</p><h3><a id="audit-index"></a>Index Audit Output</h3><p>In addition to logging to a file, you can store audit logs in Elasticsearch
rolling indices. These indices can be either on the same cluster, or on a
remote cluster. You configure the following settings in
<code class="literal">elasticsearch.yml</code> to control how audit entries are indexed. To enable
this output, you need to configure the setting <code class="literal">xpack.security.audit.outputs</code>
in the <code class="literal">elasticsearch.yml</code> file:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">xpack.security.audit.outputs: [ index, logfile ]</pre></div><p>For more configuration options, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/auditing-settings.html#index-audit-settings" target="_top">Audit Log Indexing Configuration Settings</a>.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>No filtering is performed when auditing, so sensitive data may be
audited in plain text when including the request body in audit events.</p></div></div><h4><a id="_audit_index_settings"></a>Audit Index Settings</h4><p>You can also configure settings for the indices that the events are stored in.
These settings are configured in the <code class="literal">xpack.security.audit.index.settings</code> namespace
in <code class="literal">elasticsearch.yml</code>. For example, the following configuration sets the
number of shards and replicas to 1 for the audit indices:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">xpack.security.audit.index.settings:
  index:
    number_of_shards: 1
    number_of_replicas: 1</pre></div><h4><a id="_forwarding_audit_logs_to_a_remote_cluster"></a>Forwarding Audit Logs to a Remote Cluster</h4><p>To index audit events to a remote Elasticsearch cluster, you configure
the following <code class="literal">xpack.security.audit.index.client</code> settings:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">xpack.security.audit.index.client.hosts</code></li><li class="listitem"><code class="literal">xpack.security.audit.index.client.cluster.name</code></li><li class="listitem"><code class="literal">xpack.security.audit.index.client.xpack.security.user</code></li></ul></div><p>For more information about these settings, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/auditing-settings.html#remote-audit-settings" target="_top">Remote Audit Log Indexing Configuration Settings</a>.</p><p>You can pass additional settings to the remote client by specifying them in the
<code class="literal">xpack.security.audit.index.client</code> namespace. For example, to allow the remote
client to discover all of the nodes in the remote cluster you can specify the
<code class="literal">client.transport.sniff</code> setting:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">xpack.security.audit.index.client.transport.sniff: true</pre></div></div><div class="navfooter"><span class="prev"><a href="custom-roles-provider.html">
              « 
              Custom Roles Provider Extension</a>
           
        </span><span class="next">
           
          <a href="encrypting-communications.html">Encrypting Communications
               »
            </a></span></div></body></html>
