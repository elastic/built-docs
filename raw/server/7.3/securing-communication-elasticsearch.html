<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Secure communication with Elasticsearch | APM Server Reference [7.3] | Elastic</title>
<meta class="elastic" name="content" content="Secure communication with Elasticsearch | APM Server Reference [7.3]">

<link rel="home" href="index.html" title="APM Server Reference [7.3]"/>
<link rel="up" href="securing-apm-server.html" title="Securing APM Server"/>
<link rel="prev" href="secure-communication-agents.html" title="Secure communication with APM Agents"/>
<link rel="next" href="configuring-ssl-logstash.html" title="Secure communication with Logstash"/>
<meta class="elastic" name="product_version" content="7.3"/>
<meta class="elastic" name="product_name" content="APM"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/APM Server/Reference/7.3"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="7.3"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
A newer version is available. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div class="navheader">
<span class="prev">
<a href="secure-communication-agents.html">« Secure communication with APM Agents</a>
</span>
<span class="next">
<a href="configuring-ssl-logstash.html">Secure communication with Logstash »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link">
  <div id="related-products" class="dropdown">
  <div class="related-products-title">APM:</div>
  <div class="dropdown-anchor" tabindex="0">Server Reference<span class="dropdown-icon"></span></div>
  <div class="dropdown-content">
  <ul>
  <li class="dropdown-category">APM</li>
  <ul>
  <li><a href="/guide/en/observability/current/apm.html">Observability › APM</a></li>
  </ul>
  <li class="dropdown-category">APM agents</li>
  <ul>
  <li><a href="/guide/en/apm/agent/android/current/intro.html">Android Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/go/current/introduction.html">Go Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/swift/current/intro.html">iOS Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/java/current/intro.html">Java Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/dotnet/current/intro.html">.NET Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/nodejs/current/intro.html">Node.js Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/php/current/intro.html">PHP Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/python/current/getting-started.html">Python Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/ruby/current/introduction.html">Ruby Agent Reference</a></li>
  <li><a href="/guide/en/apm/agent/rum-js/current/intro.html">Real User Monitoring JavaScript Agent Reference</a></li>
  </ul>
  <li class="dropdown-category">APM extensions</li>
  <ul>
  <li><a href="/guide/en/apm/lambda/current/aws-lambda-arch.html">AWS Lambda extension</a></li>
  <li><a href="/guide/en/apm/attacher/current/apm-attacher.html">Attacher</a></li>
  </ul>
  </ul>
  </div>
  </div>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="securing-apm-server.html">Securing APM Server</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Secure communication with Elasticsearch</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.3/docs/copied-from-beats/shared-securing-beat.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="securing-communication-elasticsearch"></a>Secure communication with Elasticsearch</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-server/edit/7.3/docs/copied-from-beats/shared-securing-beat.asciidoc">edit</a></div>
</div></div></div>
<p>To secure the communication between APM Server and Elasticsearch, you can use
HTTPS and basic authentication. Basic authentication for Elasticsearch is
available when you enable X-Pack security (see
<a href="/guide/en/elastic-stack-overview/7.3/elasticsearch-security.html" class="ulink" target="_top">Securing the Elastic Stack</a> and <a class="xref" href="securing-beats.html" title="Configure APM Server to use X-Pack security"><em>Use X-Pack security</em></a>).
If you aren&#8217;t using X-Pack security, you can use a web proxy instead.</p>
<p>Here is a sample configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  username: apm-server <a id="CO9-1"></a><i class="conum" data-value="1"></i>
  password: verysecret <a id="CO9-2"></a><i class="conum" data-value="2"></i>
  protocol: https <a id="CO9-3"></a><i class="conum" data-value="3"></i>
  hosts: ["elasticsearch.example.com:9200"] <a id="CO9-4"></a><i class="conum" data-value="4"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The username to use for authenticating to Elasticsearch.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The password to use for authenticating to Elasticsearch.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>This setting enables the HTTPS protocol.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO9-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>The IP and port of the Elasticsearch nodes.</p>
</td>
</tr>
</table>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>To obfuscate passwords and other sensitive settings, use the
<a class="xref" href="keystore.html" title="Secrets keystore for secure settings">secrets keystore</a>.</p>
</div>
</div>
<p>APM Server verifies the validity of the server certificates and only accepts trusted
certificates. Creating a correct SSL/TLS infrastructure is outside the scope of
this document.</p>
<p>By default APM Server uses the list of trusted certificate authorities from the
operating system where APM Server is running. You can configure APM Server to use a specific list of
CA certificates instead of the list from the OS. You can also configure it to use client authentication
by specifying the certificate and key to use when the server requires the APM Server to authenticate. Here is an example
configuration:</p>
<div class="pre_wrapper lang-yaml">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-yaml">output.elasticsearch:
  username: apm-server
  password: verysecret
  protocol: https
  hosts: ["elasticsearch.example.com:9200"]
  ssl.certificate_authorities: <a id="CO10-1"></a><i class="conum" data-value="1"></i>
    - /etc/pki/my_root_ca.pem
    - /etc/pki/my_other_ca.pem
  ssl.certificate: "/etc/pki/client.pem" <a id="CO10-2"></a><i class="conum" data-value="2"></i>
  ssl.key: "/etc/pki/key.pem" <a id="CO10-3"></a><i class="conum" data-value="3"></i></pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>The list of CA certificates to trust</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The path to the certificate for SSL client authentication</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO10-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The client certificate key</p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For any given connection, the SSL/TLS certificates must have a subject
that matches the value specified for <code class="literal">hosts</code>, or the SSL handshake fails.
For example, if you specify <code class="literal">hosts: ["foobar:9200"]</code>, the certificate MUST
include <code class="literal">foobar</code> in the subject (<code class="literal">CN=foobar</code>) or as a subject alternative name
(SAN). Make sure the hostname resolves to the correct IP address. If no DNS is available, then
you can associate the IP address with your hostname in <code class="literal">/etc/hosts</code>
(on Unix) or <code class="literal">C:\Windows\System32\drivers\etc\hosts</code> (on Windows).</p>
</div>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="secure-communication-agents.html">« Secure communication with APM Agents</a>
</span>
<span class="next">
<a href="configuring-ssl-logstash.html">Secure communication with Logstash »</a>
</span>
</div>
</body>
</html>
