<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Secure communication with APM Agents | APM Server Reference [7.4] | Elastic</title>
<link rel="home" href="index.html" title="APM Server Reference [7.4]"/>
<link rel="up" href="securing-apm-server.html" title="Securing APM Server"/>
<link rel="prev" href="securing-apm-server.html" title="Securing APM Server"/>
<link rel="next" href="securing-communication-elasticsearch.html" title="Secure communication with Elasticsearch"/>
<meta name="DC.type" content="Learn/Docs/APM Server/Reference/7.4"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="7.4"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
<strong>IMPORTANT</strong>: No additional bug fixes or documentation updates
will be released for this version. For the latest information, see the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Server Reference [7.4]</a></span>
»
<span class="breadcrumb-link"><a href="securing-apm-server.html">Securing APM Server</a></span>
»
<span class="breadcrumb-node">Secure communication with APM Agents</span>
</div>
<div class="navheader">
<span class="prev">
<a href="securing-apm-server.html">« Securing APM Server</a>
</span>
<span class="next">
<a href="securing-communication-elasticsearch.html">Secure communication with Elasticsearch »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="secure-communication-agents"></a>Secure communication with APM Agents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/7.4/docs/secure-communication-agents.asciidoc">edit</a></h2>
</div></div></div>
<p>To secure the communication between APM Agents and the APM Server:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<a class="xref" href="secure-communication-agents.html#secret-token" title="Secret token">Set a secret token in your Agents and Server</a>
</li>
<li class="listitem">
<a class="xref" href="secure-communication-agents.html#ssl-setup" title="SSL/TLS communication in APM Server">Enable SSL/TLS in APM Server</a>
</li>
<li class="listitem">
<a class="xref" href="secure-communication-agents.html#https-in-agents" title="HTTPS communication in APM Agents">Enable HTTPS in your APM Agents</a>
</li>
</ol>
</div>
<h3><a id="secret-token"></a>Secret token<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/7.4/docs/secure-communication-agents.asciidoc">edit</a></h3>
<p>You can configure a secret token to authorize requests to the APM Server.
This ensures that only your agents are able to send data to your APM servers.
Both the agents and the APM servers have to be configured with the same secret token,
and secret tokens only provide security when used in combination with SSL/TLS.</p>
<p><span class="strong strong"><strong>APM Server configuration</strong></span></p>
<p>Here&#8217;s how you set the secret token in APM Server:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server.secret_token: &lt;secret-token&gt;</pre>
</div>
<p>We recommend saving the token in the APM Server <a class="xref" href="keystore.html" title="Secrets keystore for secure settings">Secrets keystore</a>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Secret tokens are not applicable for the RUM Agent,
as there is no way to prevent them from being publicly exposed.</p>
</div>
</div>
<p><span class="strong strong"><strong>Agent specific configuration</strong></span></p>
<p>Each Agent has a configuration for setting the value of the secret token:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Go Agent</strong></span>: <a href="/guide/en/apm/agent/go/current/configuration.html#config-secret-token" class="ulink" target="_top"><code class="literal">ELASTIC_APM_SECRET_TOKEN</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Java Agent</strong></span>: <a href="/guide/en/apm/agent/java/current/config-reporter.html#config-secret-token" class="ulink" target="_top"><code class="literal">secret_token</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>.NET Agent</strong></span>: <a href="/guide/en/apm/agent/dotnet/current/config-reporter.html#config-secret-token" class="ulink" target="_top"><code class="literal">ELASTIC_APM_SECRET_TOKEN</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Node.js Agent</strong></span>: <a href="/guide/en/apm/agent/nodejs/current/configuration.html#secret-token" class="ulink" target="_top"><code class="literal">Secret Token</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Python Agent</strong></span>: <a href="/guide/en/apm/agent/python/current/configuration.html#config-secret-token" class="ulink" target="_top"><code class="literal">secret_token</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Ruby Agent</strong></span>: <a href="/guide/en/apm/agent/ruby/current/configuration.html#config-secret-token" class="ulink" target="_top"><code class="literal">secret_token</code></a>
</li>
</ul>
</div>
<h3><a id="ssl-setup"></a>SSL/TLS communication in APM Server<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/7.4/docs/secure-communication-agents.asciidoc">edit</a></h3>
<p>To enable SSL/TLS, you need to enable SSL and provide both a private key and a certificate
issued by a certificate authority (CA).
You can then specify the path to those files in your configuration properties.
This will make APM Server serve HTTPS requests instead of HTTP.</p>
<p>Here&#8217;s a basic APM Server SSL config with secure communication enabled:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">apm-server.ssl.enabled: true
apm-server.ssl.key: "/etc/pki/key.pem"
apm-server.ssl.certificate: "/etc/pki/client.pem"</pre>
</div>
<p>A full list of configuration options is available in <a class="xref" href="agent-server-ssl.html" title="SSL input settings">SSL input settings</a>.</p>
<h3><a id="https-in-agents"></a>HTTPS communication in APM Agents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/apm-server/edit/7.4/docs/secure-communication-agents.asciidoc">edit</a></h3>
<p>To enable secure communication in your Agents, you need to update the configured server URL to use <code class="literal">HTTPS</code> instead of <code class="literal">HTTP</code>.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Go Agent</strong></span>: <a href="/guide/en/apm/agent/go/current/configuration.html#config-server-url" class="ulink" target="_top"><code class="literal">ELASTIC_APM_SERVER_URL</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Java Agent</strong></span>: <a href="/guide/en/apm/agent/java/current/config-reporter.html#config-server-urls" class="ulink" target="_top"><code class="literal">server_urls</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>.NET Agent</strong></span>: <a href="/guide/en/apm/agent/dotnet/current/config-reporter.html#config-server-url" class="ulink" target="_top"><code class="literal">ServerUrl</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Node.js Agent</strong></span>: <a href="/guide/en/apm/agent/nodejs/current/configuration.html#server-url" class="ulink" target="_top"><code class="literal">serverUrl</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Python Agent</strong></span>: <a href="/guide/en/apm/agent/python/current/" class="ulink" target="_top"><code class="literal">server_url</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Ruby Agent</strong></span>: <a href="/guide/en/apm/agent/ruby/current/configuration.html#config-server-url" class="ulink" target="_top"><code class="literal">server_url</code></a>
</li>
</ul>
</div>
<p>Some Agents also allow you to specify a custom certificate authority for connecting to APM Server.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Go Agent</strong></span>: <a href="/guide/en/apm/agent/go/current/configuration.html#config-server-cert" class="ulink" target="_top"><code class="literal">ELASTIC_APM_SERVER_CERT</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Python Agent</strong></span>: <a href="/guide/en/apm/agent/python/current/configuration.html#config-server-cert" class="ulink" target="_top"><code class="literal">ELASTIC_APM_SERVER_CERT</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Ruby Agent</strong></span>: <a href="/guide/en/apm/agent/ruby/current/configuration.html#config-ssl-ca-cert" class="ulink" target="_top"><code class="literal">server_ca_certedit</code></a>
</li>
</ul>
</div>
<p>Most Agents that don&#8217;t allow you specify a custom certificate will allow you to
disable verification of the SSL certificate.
This ensures encryption, but does not verify that you are sending data to the correct APM Server.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>Java Agent</strong></span>: <a href="/guide/en/apm/agent/java/current/config-reporter.html#config-verify-server-cert" class="ulink" target="_top"><code class="literal">verify_server_cert</code></a>
</li>
<li class="listitem">
<span class="strong strong"><strong>Node.js Agent</strong></span>: <a href="/guide/en/apm/agent/nodejs/current/configuration.html#validate-server-cert" class="ulink" target="_top"><code class="literal">verifyServerCert</code></a>
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="securing-apm-server.html">« Securing APM Server</a>
</span>
<span class="next">
<a href="securing-communication-elasticsearch.html">Secure communication with Elasticsearch »</a>
</span>
</div>
</div>
</body>
</html>
